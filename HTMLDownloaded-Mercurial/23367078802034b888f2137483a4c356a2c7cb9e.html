<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 9371:23367078802034b888f2137483a4c356a2c7cb9e</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 23367078802034b888f2137483a4c356a2c7cb9e" />
<meta property="og:url" content="/comm-central/rev/23367078802034b888f2137483a4c356a2c7cb9e" />
<meta property="og:description" content="Bug 560772 - Make use of mozilla::services for comm-central. r=Standard8 a=Standard8 for CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 23367078802034b888f2137483a4c356a2c7cb9e 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/23367078802034b888f2137483a4c356a2c7cb9e">shortlog</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/23367078802034b888f2137483a4c356a2c7cb9e">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e">files</a> |
changeset |
<a href="/comm-central/raw-rev/23367078802034b888f2137483a4c356a2c7cb9e">raw</a>  | <a href="/comm-central/archive/23367078802034b888f2137483a4c356a2c7cb9e.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=560772">Bug 560772</a> - Make use of mozilla::services for comm-central. r=Standard8 a=Standard8 for CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#117;&#115;&#116;&#105;&#110;&#32;&#87;&#111;&#111;&#100;&#32;&#60;&#67;&#97;&#108;&#108;&#101;&#107;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 02 Jan 2012 01:21:21 -0500</td></tr>

<tr>
 <td>changeset 9371</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/23367078802034b888f2137483a4c356a2c7cb9e">23367078802034b888f2137483a4c356a2c7cb9e</a></td>
</tr>



<tr>
<td>parent 9370</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/fb4163ac866a1ea8918c61b760e354b70e142719">fb4163ac866a1ea8918c61b760e354b70e142719</a>
</td>
</tr>

<tr>
<td>child 9372</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/465ce21de933b568b949cfa3f6561d4494b08cba">465ce21de933b568b949cfa3f6561d4494b08cba</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=23367078802034b888f2137483a4c356a2c7cb9e">7174</a></td></tr>
<tr><td>push user</td><td>Callek@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 13 Feb 2012 17:57:09 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@233670788020 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=23367078802034b888f2137483a4c356a2c7cb9e">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=23367078802034b888f2137483a4c356a2c7cb9e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=23367078802034b888f2137483a4c356a2c7cb9e&newProject=comm-central&newRevision=23367078802034b888f2137483a4c356a2c7cb9e&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=23367078802034b888f2137483a4c356a2c7cb9e&newProject=comm-central&newRevision=23367078802034b888f2137483a4c356a2c7cb9e&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=23367078802034b888f2137483a4c356a2c7cb9e&newProject=comm-central&newRevision=23367078802034b888f2137483a4c356a2c7cb9e&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a>, <a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=560772">560772</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=560772">Bug 560772</a> - Make use of mozilla::services for comm-central. r=Standard8 a=Standard8 for CLOSED TREE</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mail/components/shell/nsMailGNOMEIntegration.cpp">mail/components/shell/nsMailGNOMEIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mail/components/shell/nsMailGNOMEIntegration.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mail/components/shell/nsMailGNOMEIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mail/components/shell/nsMailGNOMEIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mail/components/shell/nsMailGNOMEIntegration.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mail/components/shell/nsMailGNOMEIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbCardProperty.cpp">mailnews/addrbook/src/nsAbCardProperty.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbCardProperty.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbCardProperty.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbCardProperty.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbCardProperty.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbCardProperty.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbDirFactoryService.cpp">mailnews/addrbook/src/nsAbDirFactoryService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbDirFactoryService.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbDirFactoryService.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbDirFactoryService.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbDirFactoryService.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbDirFactoryService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">mailnews/addrbook/src/nsAbLDAPDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbManager.cpp">mailnews/addrbook/src/nsAbManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbManager.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbManager.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbManager.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbManager.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbView.cpp">mailnews/addrbook/src/nsAbView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbView.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbView.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbView.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbView.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAbView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">mailnews/addrbook/src/nsAddbookProtocolHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddrDatabase.cpp">mailnews/addrbook/src/nsAddrDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddrDatabase.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddrDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddrDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddrDatabase.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/addrbook/src/nsAddrDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilter.cpp">mailnews/base/search/src/nsMsgFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilter.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilter.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilter.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilter.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilterService.cpp">mailnews/base/search/src/nsMsgFilterService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilterService.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilterService.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilterService.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilterService.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/search/src/nsMsgFilterService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMailDirProvider.cpp">mailnews/base/src/nsMailDirProvider.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMailDirProvider.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMailDirProvider.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMailDirProvider.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMailDirProvider.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMailDirProvider.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerUnixIntegration.cpp">mailnews/base/src/nsMessengerUnixIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerUnixIntegration.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerUnixIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerUnixIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerUnixIntegration.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerUnixIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerWinIntegration.cpp">mailnews/base/src/nsMessengerWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMessengerWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManagerDS.cpp">mailnews/base/src/nsMsgAccountManagerDS.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManagerDS.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManagerDS.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManagerDS.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManagerDS.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgAccountManagerDS.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgBiffManager.cpp">mailnews/base/src/nsMsgBiffManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgBiffManager.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgBiffManager.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgBiffManager.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgBiffManager.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgBiffManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgFolderDataSource.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgFolderDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgMailSession.cpp">mailnews/base/src/nsMsgMailSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgMailSession.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgMailSession.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgMailSession.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgMailSession.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgMailSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgOfflineManager.cpp">mailnews/base/src/nsMsgOfflineManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgOfflineManager.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgOfflineManager.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgOfflineManager.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgOfflineManager.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgOfflineManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgPrintEngine.cpp">mailnews/base/src/nsMsgPrintEngine.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgPrintEngine.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgPrintEngine.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgPrintEngine.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgPrintEngine.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgPrintEngine.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgProgress.cpp">mailnews/base/src/nsMsgProgress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgProgress.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgProgress.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgProgress.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgProgress.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgProgress.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgRDFDataSource.cpp">mailnews/base/src/nsMsgRDFDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgRDFDataSource.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgRDFDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgRDFDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgRDFDataSource.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgRDFDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgStatusFeedback.cpp">mailnews/base/src/nsMsgStatusFeedback.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgStatusFeedback.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgStatusFeedback.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgStatusFeedback.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgStatusFeedback.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsMsgStatusFeedback.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsSpamSettings.cpp">mailnews/base/src/nsSpamSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsSpamSettings.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsSpamSettings.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsSpamSettings.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsSpamSettings.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsSpamSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsStatusBarBiffManager.cpp">mailnews/base/src/nsStatusBarBiffManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsStatusBarBiffManager.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsStatusBarBiffManager.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsStatusBarBiffManager.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsStatusBarBiffManager.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/src/nsStatusBarBiffManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgMailNewsUrl.cpp">mailnews/base/util/nsMsgMailNewsUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgMailNewsUrl.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgMailNewsUrl.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgMailNewsUrl.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgMailNewsUrl.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgMailNewsUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgProtocol.cpp">mailnews/base/util/nsMsgProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgProtocol.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgProtocol.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgAttachmentHandler.cpp">mailnews/compose/src/nsMsgAttachmentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgAttachmentHandler.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgAttachmentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgAttachmentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgAttachmentHandler.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgAttachmentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompUtils.cpp">mailnews/compose/src/nsMsgCompUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompUtils.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompUtils.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompUtils.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompUtils.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgComposeService.cpp">mailnews/compose/src/nsMsgComposeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgComposeService.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgComposeService.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgComposeService.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgComposeService.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgComposeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgPrompts.cpp">mailnews/compose/src/nsMsgPrompts.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgPrompts.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgPrompts.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgPrompts.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgPrompts.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgPrompts.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgQuote.cpp">mailnews/compose/src/nsMsgQuote.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgQuote.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgQuote.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgQuote.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgQuote.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgQuote.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendLater.cpp">mailnews/compose/src/nsMsgSendLater.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendLater.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendLater.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendLater.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendLater.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendLater.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendReport.cpp">mailnews/compose/src/nsMsgSendReport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendReport.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendReport.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendReport.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendReport.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsMsgSendReport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">mailnews/db/msgdb/src/nsDBFolderInfo.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/db/msgdb/src/nsDBFolderInfo.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsAutoSyncManager.cpp">mailnews/imap/src/nsAutoSyncManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsAutoSyncManager.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsAutoSyncManager.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsAutoSyncManager.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsAutoSyncManager.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsAutoSyncManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsIMAPHostSessionList.cpp">mailnews/imap/src/nsIMAPHostSessionList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsIMAPHostSessionList.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsIMAPHostSessionList.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsIMAPHostSessionList.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsIMAPHostSessionList.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsIMAPHostSessionList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapStringBundle.cpp">mailnews/imap/src/nsImapStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/imap/src/nsImapStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/applemail/src/nsAppleMailImport.cpp">mailnews/import/applemail/src/nsAppleMailImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/applemail/src/nsAppleMailImport.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/applemail/src/nsAppleMailImport.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/applemail/src/nsAppleMailImport.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/applemail/src/nsAppleMailImport.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/applemail/src/nsAppleMailImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraFilters.cpp">mailnews/import/eudora/src/nsEudoraFilters.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraFilters.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraFilters.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraFilters.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraFilters.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraFilters.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">mailnews/import/eudora/src/nsEudoraStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/oexpress/nsOEStringBundle.cpp">mailnews/import/oexpress/nsOEStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/oexpress/nsOEStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/oexpress/nsOEStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/oexpress/nsOEStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/oexpress/nsOEStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/oexpress/nsOEStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">mailnews/import/outlook/src/nsOutlookStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportMail.cpp">mailnews/import/src/nsImportMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportMail.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportMail.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportMail.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportMail.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportStringBundle.cpp">mailnews/import/src/nsImportStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/src/nsImportStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/winlivemail/nsWMStringBundle.cpp">mailnews/import/winlivemail/nsWMStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/winlivemail/nsWMStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/winlivemail/nsWMStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/winlivemail/nsWMStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/winlivemail/nsWMStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/import/winlivemail/nsWMStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMailboxUrl.cpp">mailnews/local/src/nsMailboxUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMailboxUrl.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMailboxUrl.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMailboxUrl.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMailboxUrl.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMailboxUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMovemailService.cpp">mailnews/local/src/nsMovemailService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMovemailService.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMovemailService.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMovemailService.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMovemailService.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsMovemailService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Protocol.cpp">mailnews/local/src/nsPop3Protocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Protocol.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Protocol.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Protocol.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Protocol.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Protocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Service.cpp">mailnews/local/src/nsPop3Service.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Service.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Service.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Service.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Service.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Service.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Sink.cpp">mailnews/local/src/nsPop3Sink.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Sink.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Sink.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Sink.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Sink.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/local/src/nsPop3Sink.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiHook.cpp">mailnews/mapi/mapihook/src/msgMapiHook.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiHook.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiHook.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiHook.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiHook.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiHook.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">mailnews/mapi/mapihook/src/msgMapiSupport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mapi/mapihook/src/msgMapiSupport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/cthandlers/smimestub/nsSMIMEStub.cpp">mailnews/mime/cthandlers/smimestub/nsSMIMEStub.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/cthandlers/smimestub/nsSMIMEStub.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/cthandlers/smimestub/nsSMIMEStub.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/cthandlers/smimestub/nsSMIMEStub.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/cthandlers/smimestub/nsSMIMEStub.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/cthandlers/smimestub/nsSMIMEStub.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/src/mimemoz2.cpp">mailnews/mime/src/mimemoz2.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/src/mimemoz2.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/src/mimemoz2.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/src/mimemoz2.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/src/mimemoz2.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/mime/src/mimemoz2.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPNewsgroupList.cpp">mailnews/news/src/nsNNTPNewsgroupList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPNewsgroupList.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPNewsgroupList.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPNewsgroupList.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPNewsgroupList.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPNewsgroupList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPProtocol.cpp">mailnews/news/src/nsNNTPProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPProtocol.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPProtocol.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNNTPProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsDownloader.cpp">mailnews/news/src/nsNewsDownloader.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsDownloader.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsDownloader.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsDownloader.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsDownloader.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsDownloader.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsFolder.cpp">mailnews/news/src/nsNewsFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsFolder.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsFolder.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsFolder.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsFolder.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNewsFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/suite/shell/src/nsWindowsShellService.cpp">suite/shell/src/nsWindowsShellService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/23367078802034b888f2137483a4c356a2c7cb9e/suite/shell/src/nsWindowsShellService.cpp">file</a> |
<a href="/comm-central/annotate/23367078802034b888f2137483a4c356a2c7cb9e/suite/shell/src/nsWindowsShellService.cpp">annotate</a> |
<a href="/comm-central/diff/23367078802034b888f2137483a4c356a2c7cb9e/suite/shell/src/nsWindowsShellService.cpp">diff</a> |
<a href="/comm-central/comparison/23367078802034b888f2137483a4c356a2c7cb9e/suite/shell/src/nsWindowsShellService.cpp">comparison</a> |
<a href="/comm-central/log/23367078802034b888f2137483a4c356a2c7cb9e/suite/shell/src/nsWindowsShellService.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/shell/nsMailGNOMEIntegration.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/shell/nsMailGNOMEIntegration.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -47,16 +47,17 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #include &quot;nsIPromptService.h&quot;</span>
<a href="#l1.5"></a><span id="l1.5"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l1.6"></a><span id="l1.6"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l1.7"></a><span id="l1.7"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l1.8"></a><span id="l1.8"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l1.9"></a><span id="l1.9"> #include &quot;nsEmbedCID.h&quot;</span>
<a href="#l1.10"></a><span id="l1.10"> #include &quot;nsMemory.h&quot;</span>
<a href="#l1.11"></a><span id="l1.11"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l1.13"></a><span id="l1.13"> </span>
<a href="#l1.14"></a><span id="l1.14"> #include &lt;glib.h&gt;</span>
<a href="#l1.15"></a><span id="l1.15"> #include &lt;limits.h&gt;</span>
<a href="#l1.16"></a><span id="l1.16"> #include &lt;stdlib.h&gt;</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> static const char* const sMailProtocols[] = {</span>
<a href="#l1.19"></a><span id="l1.19">   &quot;mailto&quot;</span>
<a href="#l1.20"></a><span id="l1.20"> };</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -296,18 +297,18 @@ nsMailGNOMEIntegration::MakeDefault(cons</span>
<a href="#l1.22"></a><span id="l1.22">       rv = gconf-&gt;SetAppForProtocol(nsDependentCString(aProtocols[i]),</span>
<a href="#l1.23"></a><span id="l1.23">                                     appKeyValue);</span>
<a href="#l1.24"></a><span id="l1.24">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.25"></a><span id="l1.25">     }</span>
<a href="#l1.26"></a><span id="l1.26">   }</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28">   if (giovfs) {</span>
<a href="#l1.29"></a><span id="l1.29">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-      do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l1.34"></a><span id="l1.34"> </span>
<a href="#l1.35"></a><span id="l1.35">     nsCOMPtr&lt;nsIStringBundle&gt; brandBundle;</span>
<a href="#l1.36"></a><span id="l1.36">     rv = bundleService-&gt;CreateBundle(BRAND_PROPERTIES, getter_AddRefs(brandBundle));</span>
<a href="#l1.37"></a><span id="l1.37">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">     nsString brandShortName;</span>
<a href="#l1.40"></a><span id="l1.40">     brandBundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;brandShortName&quot;).get(),</span>
<a href="#l1.41"></a><span id="l1.41">                                    getter_Copies(brandShortName));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbCardProperty.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -56,16 +56,17 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> #include &quot;mozITXTToHTMLConv.h&quot;</span>
<a href="#l2.6"></a><span id="l2.6"> #include &quot;nsIAbManager.h&quot;</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;nsIProperty.h&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> #include &quot;prmem.h&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l2.13"></a><span id="l2.13"> </span>
<a href="#l2.14"></a><span id="l2.14"> #define PREF_MAIL_ADDR_BOOK_LASTNAMEFIRST &quot;mail.addr_book.lastnamefirst&quot;</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16"> const char sAddrbookProperties[] = &quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;;</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> enum EAppendType {</span>
<a href="#l2.19"></a><span id="l2.19">   eAppendLine,</span>
<a href="#l2.20"></a><span id="l2.20">   eAppendLabel,</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -719,18 +720,19 @@ nsresult nsAbCardProperty::ConvertToBase</span>
<a href="#l2.22"></a><span id="l2.22">   nsString xmlStr;</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24">   xmlStr.AppendLiteral(&quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;\n&quot;</span>
<a href="#l2.25"></a><span id="l2.25">                        &quot;&lt;?xml-stylesheet type=\&quot;text/css\&quot; href=\&quot;chrome://messagebody/content/addressbook/print.css\&quot;?&gt;\n&quot;</span>
<a href="#l2.26"></a><span id="l2.26">                        &quot;&lt;directory&gt;\n&quot;);</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">   // Get Address Book string and set it as title of XML document</span>
<a href="#l2.29"></a><span id="l2.29">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-  if (NS_SUCCEEDED(rv)) {</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleService =</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+  if (stringBundleService) {</span>
<a href="#l2.35"></a><span id="l2.35">     rv = stringBundleService-&gt;CreateBundle(sAddrbookProperties, getter_AddRefs(bundle));</span>
<a href="#l2.36"></a><span id="l2.36">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l2.37"></a><span id="l2.37">       nsString addrBook;</span>
<a href="#l2.38"></a><span id="l2.38">       rv = bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;addressBook&quot;).get(), getter_Copies(addrBook));</span>
<a href="#l2.39"></a><span id="l2.39">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l2.40"></a><span id="l2.40">         xmlStr.AppendLiteral(&quot;&lt;title xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot;&gt;&quot;);</span>
<a href="#l2.41"></a><span id="l2.41">         xmlStr.Append(addrBook);</span>
<a href="#l2.42"></a><span id="l2.42">         xmlStr.AppendLiteral(&quot;&lt;/title&gt;\n&quot;);</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineat">@@ -756,18 +758,19 @@ nsresult nsAbCardProperty::ConvertToXMLP</span>
<a href="#l2.44"></a><span id="l2.44">   nsresult rv;</span>
<a href="#l2.45"></a><span id="l2.45">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l2.46"></a><span id="l2.46">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l2.47"></a><span id="l2.47"> </span>
<a href="#l2.48"></a><span id="l2.48">   PRInt32 generatedNameFormat;</span>
<a href="#l2.49"></a><span id="l2.49">   rv = prefBranch-&gt;GetIntPref(PREF_MAIL_ADDR_BOOK_LASTNAMEFIRST, &amp;generatedNameFormat);</span>
<a href="#l2.50"></a><span id="l2.50">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.51"></a><span id="l2.51"> </span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleService =</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+  NS_ENSURE_TRUE(stringBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l2.57"></a><span id="l2.57"> </span>
<a href="#l2.58"></a><span id="l2.58">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l2.59"></a><span id="l2.59">   rv = stringBundleService-&gt;CreateBundle(sAddrbookProperties, getter_AddRefs(bundle));</span>
<a href="#l2.60"></a><span id="l2.60">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l2.61"></a><span id="l2.61"> </span>
<a href="#l2.62"></a><span id="l2.62">   nsString generatedName;</span>
<a href="#l2.63"></a><span id="l2.63">   rv = GenerateName(generatedNameFormat, bundle, generatedName);</span>
<a href="#l2.64"></a><span id="l2.64">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineat">@@ -1086,18 +1089,18 @@ NS_IMETHODIMP nsAbCardProperty::Generate</span>
<a href="#l2.66"></a><span id="l2.66">     aResult = firstName;</span>
<a href="#l2.67"></a><span id="l2.67">   else if (firstName.IsEmpty())</span>
<a href="#l2.68"></a><span id="l2.68">     aResult = lastName;</span>
<a href="#l2.69"></a><span id="l2.69">   else {</span>
<a href="#l2.70"></a><span id="l2.70">     nsresult rv;</span>
<a href="#l2.71"></a><span id="l2.71">     nsCOMPtr&lt;nsIStringBundle&gt; bundle(aBundle);</span>
<a href="#l2.72"></a><span id="l2.72">     if (!bundle) {</span>
<a href="#l2.73"></a><span id="l2.73">       nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleService =</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-        do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv); </span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+        mozilla::services::GetStringBundleService();</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+      NS_ENSURE_TRUE(stringBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l2.78"></a><span id="l2.78">         </span>
<a href="#l2.79"></a><span id="l2.79">       rv = stringBundleService-&gt;CreateBundle(sAddrbookProperties,</span>
<a href="#l2.80"></a><span id="l2.80">                                              getter_AddRefs(bundle));</span>
<a href="#l2.81"></a><span id="l2.81">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.82"></a><span id="l2.82">     }</span>
<a href="#l2.83"></a><span id="l2.83"> </span>
<a href="#l2.84"></a><span id="l2.84">     nsString result;</span>
<a href="#l2.85"></a><span id="l2.85"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbDirFactoryService.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbDirFactoryService.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -44,16 +44,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;nsMemory.h&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> #include &quot;plstr.h&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;nsAbDirFactoryService.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsIAbDirFactory.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13"> </span>
<a href="#l3.14"></a><span id="l3.14"> NS_IMPL_ISUPPORTS1(nsAbDirFactoryService, nsIAbDirFactoryService)</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> nsAbDirFactoryService::nsAbDirFactoryService()</span>
<a href="#l3.17"></a><span id="l3.17"> {</span>
<a href="#l3.18"></a><span id="l3.18"> }</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20"> nsAbDirFactoryService::~nsAbDirFactoryService()</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -65,18 +66,19 @@ NS_IMETHODIMP</span>
<a href="#l3.22"></a><span id="l3.22"> nsAbDirFactoryService::GetDirFactory(const nsACString &amp;aURI,</span>
<a href="#l3.23"></a><span id="l3.23">                                      nsIAbDirFactory** aDirFactory)</span>
<a href="#l3.24"></a><span id="l3.24"> {</span>
<a href="#l3.25"></a><span id="l3.25">   NS_ENSURE_ARG_POINTER(aDirFactory);</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27">   nsresult rv;</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29">   // Obtain the network IO service</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-  nsCOMPtr&lt;nsIIOService&gt; nsService(do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+  nsCOMPtr&lt;nsIIOService&gt; nsService =</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+    mozilla::services::GetIOService();</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+  NS_ENSURE_TRUE(nsService, NS_ERROR_UNEXPECTED);</span>
<a href="#l3.35"></a><span id="l3.35">     </span>
<a href="#l3.36"></a><span id="l3.36">   // Extract the scheme</span>
<a href="#l3.37"></a><span id="l3.37">   nsCAutoString scheme;</span>
<a href="#l3.38"></a><span id="l3.38">   rv = nsService-&gt;ExtractScheme(aURI, scheme);</span>
<a href="#l3.39"></a><span id="l3.39">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.40"></a><span id="l3.40"> </span>
<a href="#l3.41"></a><span id="l3.41">   // Try to find a factory using the component manager.</span>
<a href="#l3.42"></a><span id="l3.42">   nsCAutoString contractID;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPAutoCompFormatter.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -45,16 +45,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #include &quot;nsILDAPMessage.h&quot;</span>
<a href="#l4.5"></a><span id="l4.5"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l4.6"></a><span id="l4.6"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l4.7"></a><span id="l4.7"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l4.8"></a><span id="l4.8"> #include &quot;nsNetError.h&quot;</span>
<a href="#l4.9"></a><span id="l4.9"> #include &quot;nsMemory.h&quot;</span>
<a href="#l4.10"></a><span id="l4.10"> #include &quot;nsILDAPErrors.h&quot;</span>
<a href="#l4.11"></a><span id="l4.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l4.13"></a><span id="l4.13"> </span>
<a href="#l4.14"></a><span id="l4.14"> #define LDAP_ERROR_BUNDLE &quot;chrome://mozldap/locale/ldap.properties&quot;</span>
<a href="#l4.15"></a><span id="l4.15"> #define LDAP_AUTOCOMPLETE_ERROR_BUNDLE &quot;chrome://messenger/locale/addressbook/ldapAutoCompErrs.properties&quot;</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17"> NS_IMPL_ISUPPORTS2(nsAbLDAPAutoCompFormatter, </span>
<a href="#l4.18"></a><span id="l4.18"> 		   nsILDAPAutoCompFormatter, </span>
<a href="#l4.19"></a><span id="l4.19"> 		   nsIAbLDAPAutoCompFormatter)</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -176,22 +177,22 @@ nsAbLDAPAutoCompFormatter::FormatExcepti</span>
<a href="#l4.22"></a><span id="l4.22">         return NS_ERROR_NOT_AVAILABLE;</span>
<a href="#l4.23"></a><span id="l4.23">     }</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">     // get the string bundle service</span>
<a href="#l4.26"></a><span id="l4.26">     //</span>
<a href="#l4.27"></a><span id="l4.27">     nsString errMsg, ldapErrMsg, alertMsg, ldapHint;</span>
<a href="#l4.28"></a><span id="l4.28">     nsString errCodeNum;</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleSvc(do_GetService(</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-                                            NS_STRINGBUNDLE_CONTRACTID, &amp;rv)); </span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-    if (NS_FAILED(rv)) {</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleSvc =</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+        mozilla::services::GetStringBundleService();</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+    if (stringBundleSvc) {</span>
<a href="#l4.36"></a><span id="l4.36">         NS_ERROR(&quot;nsAbLDAPAutoCompleteFormatter::FormatException():&quot;</span>
<a href="#l4.37"></a><span id="l4.37">                  &quot; error getting string bundle service&quot;);</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-        return rv;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+        return NS_ERROR_UNEXPECTED;</span>
<a href="#l4.40"></a><span id="l4.40">     }</span>
<a href="#l4.41"></a><span id="l4.41"> </span>
<a href="#l4.42"></a><span id="l4.42">     // get the string bundles relevant here: the main LDAP bundle,</span>
<a href="#l4.43"></a><span id="l4.43">     // and the ldap AutoCompletion-specific bundle</span>
<a href="#l4.44"></a><span id="l4.44">     //</span>
<a href="#l4.45"></a><span id="l4.45">     nsCOMPtr&lt;nsIStringBundle&gt; ldapBundle, ldapACBundle;</span>
<a href="#l4.46"></a><span id="l4.46"> </span>
<a href="#l4.47"></a><span id="l4.47">     rv = stringBundleSvc-&gt;CreateBundle(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -50,16 +50,17 @@</span>
<a href="#l5.4"></a><span id="l5.4"> #include &quot;nsAbLDAPCard.h&quot;</span>
<a href="#l5.5"></a><span id="l5.5"> #include &quot;nsIAuthPrompt.h&quot;</span>
<a href="#l5.6"></a><span id="l5.6"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l5.7"></a><span id="l5.7"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l5.8"></a><span id="l5.8"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l5.9"></a><span id="l5.9"> #include &quot;plstr.h&quot;</span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;nsILDAPErrors.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11"> #include &quot;prmem.h&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13"> </span>
<a href="#l5.14"></a><span id="l5.14"> // Defined here since to be used</span>
<a href="#l5.15"></a><span id="l5.15"> // only locally to this file.</span>
<a href="#l5.16"></a><span id="l5.16"> enum UpdateOp {</span>
<a href="#l5.17"></a><span id="l5.17">  NO_OP,</span>
<a href="#l5.18"></a><span id="l5.18">  ENTRY_ADD,</span>
<a href="#l5.19"></a><span id="l5.19">  ENTRY_DELETE,</span>
<a href="#l5.20"></a><span id="l5.20">  ENTRY_MODIFY</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -281,19 +282,19 @@ nsresult nsAbLDAPProcessChangeLogData::G</span>
<a href="#l5.22"></a><span id="l5.22">     if (NS_FAILED(rv))</span>
<a href="#l5.23"></a><span id="l5.23">         return rv;</span>
<a href="#l5.24"></a><span id="l5.24"> </span>
<a href="#l5.25"></a><span id="l5.25">     nsCAutoString serverUri;</span>
<a href="#l5.26"></a><span id="l5.26">     rv = url-&gt;GetSpec(serverUri);</span>
<a href="#l5.27"></a><span id="l5.27">     if (NS_FAILED(rv)) </span>
<a href="#l5.28"></a><span id="l5.28">         return rv;</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-    if (NS_FAILED (rv)) </span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-        return rv ;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l5.36"></a><span id="l5.36">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l5.37"></a><span id="l5.37">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l5.38"></a><span id="l5.38">     if (NS_FAILED (rv)) </span>
<a href="#l5.39"></a><span id="l5.39">         return rv ;</span>
<a href="#l5.40"></a><span id="l5.40"> </span>
<a href="#l5.41"></a><span id="l5.41">     nsString title;</span>
<a href="#l5.42"></a><span id="l5.42">     rv = bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;AuthDlgTitle&quot;).get(), getter_Copies(title));</span>
<a href="#l5.43"></a><span id="l5.43">     if (NS_FAILED (rv)) </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -65,16 +65,17 @@</span>
<a href="#l6.4"></a><span id="l6.4"> #include &quot;nsILDAPService.h&quot;</span>
<a href="#l6.5"></a><span id="l6.5"> #include &quot;nsIAbLDAPCard.h&quot;</span>
<a href="#l6.6"></a><span id="l6.6"> #include &quot;nsAbUtils.h&quot;</span>
<a href="#l6.7"></a><span id="l6.7"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l6.8"></a><span id="l6.8"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l6.11"></a><span id="l6.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l6.13"></a><span id="l6.13"> </span>
<a href="#l6.14"></a><span id="l6.14"> #define kDefaultMaxHits 100</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16"> using namespace mozilla;</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> nsAbLDAPDirectory::nsAbLDAPDirectory() :</span>
<a href="#l6.19"></a><span id="l6.19">   nsAbDirProperty(),</span>
<a href="#l6.20"></a><span id="l6.20">   mPerformingQuery(false),</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -142,18 +143,19 @@ NS_IMETHODIMP nsAbLDAPDirectory::GetChil</span>
<a href="#l6.22"></a><span id="l6.22"> }</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24"> NS_IMETHODIMP nsAbLDAPDirectory::GetChildCards(nsISimpleEnumerator** result)</span>
<a href="#l6.25"></a><span id="l6.25"> {</span>
<a href="#l6.26"></a><span id="l6.26">     nsresult rv;</span>
<a href="#l6.27"></a><span id="l6.27">     </span>
<a href="#l6.28"></a><span id="l6.28">     // when offline, we need to get the child cards for the local, replicated mdb directory </span>
<a href="#l6.29"></a><span id="l6.29">     bool offline;</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-    nsCOMPtr &lt;nsIIOService&gt; ioService = do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+    nsCOMPtr &lt;nsIIOService&gt; ioService =</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+      mozilla::services::GetIOService();</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+    NS_ENSURE_TRUE(ioService, NS_ERROR_UNEXPECTED);</span>
<a href="#l6.35"></a><span id="l6.35">     rv = ioService-&gt;GetOffline(&amp;offline);</span>
<a href="#l6.36"></a><span id="l6.36">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l6.37"></a><span id="l6.37">     </span>
<a href="#l6.38"></a><span id="l6.38">     if (offline) {</span>
<a href="#l6.39"></a><span id="l6.39">       nsCString fileName;</span>
<a href="#l6.40"></a><span id="l6.40">       rv = GetReplicationFileName(fileName);</span>
<a href="#l6.41"></a><span id="l6.41">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l6.42"></a><span id="l6.42">       </span>
<a href="#l6.43"></a><span id="l6.43" class="difflineat">@@ -244,18 +246,19 @@ NS_IMETHODIMP nsAbLDAPDirectory::GetLDAP</span>
<a href="#l6.44"></a><span id="l6.44">      * case where it is not a preference, we need to replace the</span>
<a href="#l6.45"></a><span id="l6.45">      * &quot;moz-abldapdirectory&quot;.</span>
<a href="#l6.46"></a><span id="l6.46">      */</span>
<a href="#l6.47"></a><span id="l6.47">     URI = mURINoQuery;</span>
<a href="#l6.48"></a><span id="l6.48">     if (StringBeginsWith(URI, NS_LITERAL_CSTRING(kLDAPDirectoryRoot)))</span>
<a href="#l6.49"></a><span id="l6.49">       URI.Replace(0, kLDAPDirectoryRootLen, NS_LITERAL_CSTRING(&quot;ldap://&quot;));</span>
<a href="#l6.50"></a><span id="l6.50">   }</span>
<a href="#l6.51"></a><span id="l6.51"> </span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-  nsCOMPtr&lt;nsIIOService&gt; ioService(do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+  nsCOMPtr&lt;nsIIOService&gt; ioService =</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+    mozilla::services::GetIOService();</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+  NS_ENSURE_TRUE(ioService, NS_ERROR_UNEXPECTED);</span>
<a href="#l6.57"></a><span id="l6.57"> </span>
<a href="#l6.58"></a><span id="l6.58">   nsCOMPtr&lt;nsIURI&gt; result;</span>
<a href="#l6.59"></a><span id="l6.59">   rv = ioService-&gt;NewURI(URI, nsnull, nsnull, getter_AddRefs(result));</span>
<a href="#l6.60"></a><span id="l6.60">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.61"></a><span id="l6.61"> </span>
<a href="#l6.62"></a><span id="l6.62">   return CallQueryInterface(result, aResult);</span>
<a href="#l6.63"></a><span id="l6.63"> }</span>
<a href="#l6.64"></a><span id="l6.64"> </span>
<a href="#l6.65"></a><span id="l6.65" class="difflineat">@@ -441,18 +444,18 @@ NS_IMETHODIMP nsAbLDAPDirectory::GetRead</span>
<a href="#l6.66"></a><span id="l6.66">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.67"></a><span id="l6.67"> </span>
<a href="#l6.68"></a><span id="l6.68">   if (readOnly)</span>
<a href="#l6.69"></a><span id="l6.69">     return NS_OK;</span>
<a href="#l6.70"></a><span id="l6.70"> </span>
<a href="#l6.71"></a><span id="l6.71">   // when online, we'll allow writing as well</span>
<a href="#l6.72"></a><span id="l6.72">   bool offline;</span>
<a href="#l6.73"></a><span id="l6.73">   nsCOMPtr &lt;nsIIOService&gt; ioService =</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-    do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+    mozilla::services::GetIOService();</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+  NS_ENSURE_TRUE(ioService, NS_ERROR_UNEXPECTED);</span>
<a href="#l6.78"></a><span id="l6.78"> </span>
<a href="#l6.79"></a><span id="l6.79">   rv = ioService-&gt;GetOffline(&amp;offline);</span>
<a href="#l6.80"></a><span id="l6.80">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l6.81"></a><span id="l6.81"> </span>
<a href="#l6.82"></a><span id="l6.82">   if (!offline)</span>
<a href="#l6.83"></a><span id="l6.83">     *aReadOnly = false;</span>
<a href="#l6.84"></a><span id="l6.84"> #endif</span>
<a href="#l6.85"></a><span id="l6.85"> </span>
<a href="#l6.86"></a><span id="l6.86" class="difflineat">@@ -485,18 +488,18 @@ NS_IMETHODIMP nsAbLDAPDirectory::UseForA</span>
<a href="#l6.87"></a><span id="l6.87">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l6.88"></a><span id="l6.88"> </span>
<a href="#l6.89"></a><span id="l6.89">   // Set this to false by default to make the code easier below.</span>
<a href="#l6.90"></a><span id="l6.90">   *aResult = false;</span>
<a href="#l6.91"></a><span id="l6.91"> </span>
<a href="#l6.92"></a><span id="l6.92">   nsresult rv;</span>
<a href="#l6.93"></a><span id="l6.93">   bool offline = false;</span>
<a href="#l6.94"></a><span id="l6.94">   nsCOMPtr &lt;nsIIOService&gt; ioService =</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-    do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineplus">+    mozilla::services::GetIOService();</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineplus">+  NS_ENSURE_TRUE(ioService, NS_ERROR_UNEXPECTED);</span>
<a href="#l6.99"></a><span id="l6.99"> </span>
<a href="#l6.100"></a><span id="l6.100">   rv = ioService-&gt;GetOffline(&amp;offline);</span>
<a href="#l6.101"></a><span id="l6.101">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.102"></a><span id="l6.102"> </span>
<a href="#l6.103"></a><span id="l6.103">   // If we're online, then don't allow search during local autocomplete - must</span>
<a href="#l6.104"></a><span id="l6.104">   // use the separate LDAP autocomplete session due to the current interfaces</span>
<a href="#l6.105"></a><span id="l6.105">   if (!offline)</span>
<a href="#l6.106"></a><span id="l6.106">     return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPListenerBase.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -46,16 +46,17 @@</span>
<a href="#l7.4"></a><span id="l7.4"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l7.5"></a><span id="l7.5"> #include &quot;nsILDAPMessage.h&quot;</span>
<a href="#l7.6"></a><span id="l7.6"> #include &quot;nsILDAPErrors.h&quot;</span>
<a href="#l7.7"></a><span id="l7.7"> #include &quot;nsILoginManager.h&quot;</span>
<a href="#l7.8"></a><span id="l7.8"> #include &quot;nsILoginInfo.h&quot;</span>
<a href="#l7.9"></a><span id="l7.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l7.10"></a><span id="l7.10"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l7.11"></a><span id="l7.11"> #include &quot;nsMemory.h&quot;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l7.13"></a><span id="l7.13"> </span>
<a href="#l7.14"></a><span id="l7.14"> using namespace mozilla;</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16"> nsAbLDAPListenerBase::nsAbLDAPListenerBase(nsILDAPURL* url,</span>
<a href="#l7.17"></a><span id="l7.17">                                            nsILDAPConnection* connection,</span>
<a href="#l7.18"></a><span id="l7.18">                                            const nsACString &amp;login,</span>
<a href="#l7.19"></a><span id="l7.19">                                            const PRInt32 timeOut) :</span>
<a href="#l7.20"></a><span id="l7.20">   mDirectoryUrl(url), mConnection(connection), mLogin(login),</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -104,23 +105,23 @@ NS_IMETHODIMP nsAbLDAPListenerBase::OnLD</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23">   // If mLogin is set, we're expected to use it to get a password.</span>
<a href="#l7.24"></a><span id="l7.24">   //</span>
<a href="#l7.25"></a><span id="l7.25">   if (!mLogin.IsEmpty() &amp;&amp; !mSaslMechanism.EqualsLiteral(&quot;GSSAPI&quot;))</span>
<a href="#l7.26"></a><span id="l7.26">   {</span>
<a href="#l7.27"></a><span id="l7.27">     // get the string bundle service</span>
<a href="#l7.28"></a><span id="l7.28">     //</span>
<a href="#l7.29"></a><span id="l7.29">     nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleSvc = </span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-      do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+    if (!stringBundleSvc)</span>
<a href="#l7.34"></a><span id="l7.34">     {</span>
<a href="#l7.35"></a><span id="l7.35">       NS_ERROR(&quot;nsAbLDAPListenerBase::OnLDAPInit():&quot;</span>
<a href="#l7.36"></a><span id="l7.36">                &quot; error getting string bundle service&quot;);</span>
<a href="#l7.37"></a><span id="l7.37">       InitFailed();</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-      return rv;</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+      return NS_ERROR_UNEXPECTED;</span>
<a href="#l7.40"></a><span id="l7.40">     }</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42">     // get the LDAP string bundle</span>
<a href="#l7.43"></a><span id="l7.43">     //</span>
<a href="#l7.44"></a><span id="l7.44">     nsCOMPtr&lt;nsIStringBundle&gt; ldapBundle;</span>
<a href="#l7.45"></a><span id="l7.45">     rv = stringBundleSvc-&gt;CreateBundle(&quot;chrome://mozldap/locale/ldap.properties&quot;,</span>
<a href="#l7.46"></a><span id="l7.46">                                        getter_AddRefs(ldapBundle));</span>
<a href="#l7.47"></a><span id="l7.47">     if (NS_FAILED(rv))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -66,16 +66,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l8.5"></a><span id="l8.5"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l8.6"></a><span id="l8.6"> #include &quot;nsDirPrefs.h&quot;</span>
<a href="#l8.7"></a><span id="l8.7"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l8.8"></a><span id="l8.8"> #include &quot;nsIAbDirFactory.h&quot;</span>
<a href="#l8.9"></a><span id="l8.9"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l8.10"></a><span id="l8.10"> #include &quot;nsIIOService.h&quot;</span>
<a href="#l8.11"></a><span id="l8.11"> #include &quot;nsAbQueryStringToExpression.h&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l8.13"></a><span id="l8.13"> </span>
<a href="#l8.14"></a><span id="l8.14"> struct ExportAttributesTableStruct</span>
<a href="#l8.15"></a><span id="l8.15"> {</span>
<a href="#l8.16"></a><span id="l8.16">   const char* abPropertyName;</span>
<a href="#l8.17"></a><span id="l8.17">   PRUint32 plainTextStringID;</span>
<a href="#l8.18"></a><span id="l8.18"> };</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20"> // our schema is not fixed yet, but we still want some sort of objectclass</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineat">@@ -167,22 +168,21 @@ NS_IMPL_QUERY_INTERFACE3(nsAbManager,</span>
<a href="#l8.22"></a><span id="l8.22">                          nsIAbManager,</span>
<a href="#l8.23"></a><span id="l8.23">                          nsICommandLineHandler,</span>
<a href="#l8.24"></a><span id="l8.24">                          nsIObserver)</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26"> nsresult nsAbManager::Init()</span>
<a href="#l8.27"></a><span id="l8.27"> {</span>
<a href="#l8.28"></a><span id="l8.28">   NS_ENSURE_TRUE(NS_IsMainThread(), NS_ERROR_FAILURE);</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-  nsresult rv;</span>
<a href="#l8.31"></a><span id="l8.31">   nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-    do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+  NS_ENSURE_TRUE(observerService, NS_ERROR_UNEXPECTED);</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-  rv = observerService-&gt;AddObserver(this, &quot;profile-do-change&quot;, false);</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+  nsresult rv = observerService-&gt;AddObserver(this, &quot;profile-do-change&quot;, false);</span>
<a href="#l8.39"></a><span id="l8.39">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.40"></a><span id="l8.40"> </span>
<a href="#l8.41"></a><span id="l8.41">   rv = observerService-&gt;AddObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID,</span>
<a href="#l8.42"></a><span id="l8.42">                                     false);</span>
<a href="#l8.43"></a><span id="l8.43">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.44"></a><span id="l8.44"> </span>
<a href="#l8.45"></a><span id="l8.45">   return NS_OK;</span>
<a href="#l8.46"></a><span id="l8.46"> }</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineat">@@ -201,22 +201,21 @@ NS_IMETHODIMP nsAbManager::Observe(nsISu</span>
<a href="#l8.48"></a><span id="l8.48">     DIR_ShutDown();</span>
<a href="#l8.49"></a><span id="l8.49">     return NS_OK;</span>
<a href="#l8.50"></a><span id="l8.50">   }</span>
<a href="#l8.51"></a><span id="l8.51"> </span>
<a href="#l8.52"></a><span id="l8.52">   if (!strcmp(aTopic, NS_XPCOM_SHUTDOWN_OBSERVER_ID))</span>
<a href="#l8.53"></a><span id="l8.53">   {</span>
<a href="#l8.54"></a><span id="l8.54">     DIR_ShutDown();</span>
<a href="#l8.55"></a><span id="l8.55"> </span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-    nsresult rv;</span>
<a href="#l8.57"></a><span id="l8.57">     nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineminus">-      do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+      mozilla::services::GetObserverService();</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+    NS_ENSURE_TRUE(observerService, NS_ERROR_UNEXPECTED);</span>
<a href="#l8.62"></a><span id="l8.62"> </span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-    rv = observerService-&gt;RemoveObserver(this, &quot;profile-do-change&quot;);</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+    nsresult rv = observerService-&gt;RemoveObserver(this, &quot;profile-do-change&quot;);</span>
<a href="#l8.65"></a><span id="l8.65">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.66"></a><span id="l8.66"> </span>
<a href="#l8.67"></a><span id="l8.67">     rv = observerService-&gt;RemoveObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID);</span>
<a href="#l8.68"></a><span id="l8.68">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.69"></a><span id="l8.69">   }</span>
<a href="#l8.70"></a><span id="l8.70"> </span>
<a href="#l8.71"></a><span id="l8.71">   return NS_OK;</span>
<a href="#l8.72"></a><span id="l8.72"> }</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineat">@@ -535,18 +534,19 @@ enum ADDRESSBOOK_EXPORT_FILE_TYPE</span>
<a href="#l8.74"></a><span id="l8.74"> NS_IMETHODIMP nsAbManager::ExportAddressBook(nsIDOMWindow *aParentWin, nsIAbDirectory *aDirectory)</span>
<a href="#l8.75"></a><span id="l8.75"> {</span>
<a href="#l8.76"></a><span id="l8.76">   NS_ENSURE_ARG_POINTER(aParentWin);</span>
<a href="#l8.77"></a><span id="l8.77"> </span>
<a href="#l8.78"></a><span id="l8.78">   nsresult rv;</span>
<a href="#l8.79"></a><span id="l8.79">   nsCOMPtr&lt;nsIFilePicker&gt; filePicker = do_CreateInstance(&quot;@mozilla.org/filepicker;1&quot;, &amp;rv);</span>
<a href="#l8.80"></a><span id="l8.80">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.81"></a><span id="l8.81"> </span>
<a href="#l8.82"></a><span id="l8.82" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l8.87"></a><span id="l8.87">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l8.88"></a><span id="l8.88">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l8.89"></a><span id="l8.89">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.90"></a><span id="l8.90"> </span>
<a href="#l8.91"></a><span id="l8.91">   nsString title;</span>
<a href="#l8.92"></a><span id="l8.92">   rv = bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;ExportAddressBookTitle&quot;).get(), getter_Copies(title));</span>
<a href="#l8.93"></a><span id="l8.93">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.94"></a><span id="l8.94"> </span>
<a href="#l8.95"></a><span id="l8.95" class="difflineat">@@ -661,18 +661,19 @@ nsAbManager::ExportDirectoryToDelimitedT</span>
<a href="#l8.96"></a><span id="l8.96">   // the desired file may be read only</span>
<a href="#l8.97"></a><span id="l8.97">   if (NS_FAILED(rv))</span>
<a href="#l8.98"></a><span id="l8.98">     return rv;</span>
<a href="#l8.99"></a><span id="l8.99"> </span>
<a href="#l8.100"></a><span id="l8.100">   PRUint32 i;</span>
<a href="#l8.101"></a><span id="l8.101">   PRUint32 writeCount;</span>
<a href="#l8.102"></a><span id="l8.102">   PRUint32 length;</span>
<a href="#l8.103"></a><span id="l8.103"> </span>
<a href="#l8.104"></a><span id="l8.104" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l8.109"></a><span id="l8.109"> </span>
<a href="#l8.110"></a><span id="l8.110">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l8.111"></a><span id="l8.111">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/importMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l8.112"></a><span id="l8.112">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.113"></a><span id="l8.113"> </span>
<a href="#l8.114"></a><span id="l8.114">   nsCString revisedName;</span>
<a href="#l8.115"></a><span id="l8.115">   nsString columnName;</span>
<a href="#l8.116"></a><span id="l8.116"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbView.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbView.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -55,16 +55,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l9.5"></a><span id="l9.5"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l9.6"></a><span id="l9.6"> #include &quot;nsIPrefBranch2.h&quot;</span>
<a href="#l9.7"></a><span id="l9.7"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l9.8"></a><span id="l9.8"> #include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l9.9"></a><span id="l9.9"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l9.10"></a><span id="l9.10"> #include &quot;nsIAddrDatabase.h&quot; // for kPriEmailColumn</span>
<a href="#l9.11"></a><span id="l9.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l9.13"></a><span id="l9.13"> </span>
<a href="#l9.14"></a><span id="l9.14"> #define CARD_NOT_FOUND -1</span>
<a href="#l9.15"></a><span id="l9.15"> #define ALL_ROWS -1</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17"> #define PREF_MAIL_ADDR_BOOK_LASTNAMEFIRST &quot;mail.addr_book.lastnamefirst&quot;</span>
<a href="#l9.18"></a><span id="l9.18"> #define PREF_MAIL_ADDR_BOOK_DISPLAYNAME_AUTOGENERATION &quot;mail.addr_book.displayName.autoGeneration&quot;</span>
<a href="#l9.19"></a><span id="l9.19"> #define PREF_MAIL_ADDR_BOOK_DISPLAYNAME_LASTNAMEFIRST &quot;mail.addr_book.displayName.lastnamefirst&quot;</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21" class="difflineat">@@ -175,18 +176,18 @@ nsresult nsAbView::Initialize()</span>
<a href="#l9.22"></a><span id="l9.22">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24">   rv = pbi-&gt;AddObserver(PREF_MAIL_ADDR_BOOK_LASTNAMEFIRST, this, false);</span>
<a href="#l9.25"></a><span id="l9.25">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.26"></a><span id="l9.26"> </span>
<a href="#l9.27"></a><span id="l9.27">   if (!mABBundle)</span>
<a href="#l9.28"></a><span id="l9.28">   {</span>
<a href="#l9.29"></a><span id="l9.29">     nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleService =</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-      do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv); </span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+    NS_ENSURE_TRUE(stringBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l9.34"></a><span id="l9.34"> </span>
<a href="#l9.35"></a><span id="l9.35">     rv = stringBundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;, getter_AddRefs(mABBundle));</span>
<a href="#l9.36"></a><span id="l9.36">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.37"></a><span id="l9.37">   }</span>
<a href="#l9.38"></a><span id="l9.38"> </span>
<a href="#l9.39"></a><span id="l9.39">   return SetGeneratedNameFormatFromPrefs();</span>
<a href="#l9.40"></a><span id="l9.40"> }</span>
<a href="#l9.41"></a><span id="l9.41"> </span>
<a href="#l9.42"></a><span id="l9.42" class="difflineat">@@ -1192,18 +1193,19 @@ NS_IMETHODIMP nsAbView::SwapFirstNameLas</span>
<a href="#l9.43"></a><span id="l9.43">     nsCOMPtr&lt;nsIPrefLocalizedString&gt; pls;</span>
<a href="#l9.44"></a><span id="l9.44">     rv = pPrefBranchInt-&gt;GetComplexValue(PREF_MAIL_ADDR_BOOK_DISPLAYNAME_LASTNAMEFIRST,</span>
<a href="#l9.45"></a><span id="l9.45">                                          NS_GET_IID(nsIPrefLocalizedString), getter_AddRefs(pls));</span>
<a href="#l9.46"></a><span id="l9.46">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.47"></a><span id="l9.47"> </span>
<a href="#l9.48"></a><span id="l9.48">     nsString str;</span>
<a href="#l9.49"></a><span id="l9.49">     pls-&gt;ToString(getter_Copies(str));</span>
<a href="#l9.50"></a><span id="l9.50">     displayNameLastnamefirst = str.EqualsLiteral(&quot;true&quot;);</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l9.56"></a><span id="l9.56"> </span>
<a href="#l9.57"></a><span id="l9.57">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;, </span>
<a href="#l9.58"></a><span id="l9.58">                                      getter_AddRefs(bundle));</span>
<a href="#l9.59"></a><span id="l9.59">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.60"></a><span id="l9.60">   }</span>
<a href="#l9.61"></a><span id="l9.61"> </span>
<a href="#l9.62"></a><span id="l9.62">   for (PRInt32 i = 0; i &lt; selectionCount; i++)</span>
<a href="#l9.63"></a><span id="l9.63">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -51,16 +51,17 @@</span>
<a href="#l10.4"></a><span id="l10.4"> #include &quot;nsStringStream.h&quot;</span>
<a href="#l10.5"></a><span id="l10.5"> #include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l10.6"></a><span id="l10.6"> #include &quot;nsIAbManager.h&quot;</span>
<a href="#l10.7"></a><span id="l10.7"> #include &quot;prmem.h&quot;</span>
<a href="#l10.8"></a><span id="l10.8"> #include &quot;nsIAbView.h&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> #include &quot;nsITreeView.h&quot;</span>
<a href="#l10.10"></a><span id="l10.10"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13"> </span>
<a href="#l10.14"></a><span id="l10.14"> nsAddbookProtocolHandler::nsAddbookProtocolHandler()</span>
<a href="#l10.15"></a><span id="l10.15"> {</span>
<a href="#l10.16"></a><span id="l10.16">   mAddbookOperation = nsIAddbookUrlOperation::InvalidUrl;</span>
<a href="#l10.17"></a><span id="l10.17"> }</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19"> nsAddbookProtocolHandler::~nsAddbookProtocolHandler()</span>
<a href="#l10.20"></a><span id="l10.20"> {</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -260,18 +261,19 @@ nsAddbookProtocolHandler::BuildDirectory</span>
<a href="#l10.22"></a><span id="l10.22">   nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24">   aOutput.AppendLiteral(&quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;\n&quot;</span>
<a href="#l10.25"></a><span id="l10.25">                         &quot;&lt;?xml-stylesheet type=\&quot;text/css\&quot; href=\&quot;chrome://messagebody/content/addressbook/print.css\&quot;?&gt;\n&quot;</span>
<a href="#l10.26"></a><span id="l10.26">                         &quot;&lt;directory&gt;\n&quot;);</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">   // Get Address Book string and set it as title of XML document</span>
<a href="#l10.29"></a><span id="l10.29">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv); </span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-  if (NS_SUCCEEDED(rv)) {</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleService =</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+  if (stringBundleService) {</span>
<a href="#l10.35"></a><span id="l10.35">     rv = stringBundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l10.36"></a><span id="l10.36">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l10.37"></a><span id="l10.37">       nsString addrBook;</span>
<a href="#l10.38"></a><span id="l10.38">       rv = bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;addressBook&quot;).get(), getter_Copies(addrBook));</span>
<a href="#l10.39"></a><span id="l10.39">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l10.40"></a><span id="l10.40">         aOutput.AppendLiteral(&quot;&lt;title xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot;&gt;&quot;);</span>
<a href="#l10.41"></a><span id="l10.41">         aOutput.Append(addrBook);</span>
<a href="#l10.42"></a><span id="l10.42">         aOutput.AppendLiteral(&quot;&lt;/title&gt;\n&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -60,16 +60,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> #include &quot;nsEmbedCID.h&quot;</span>
<a href="#l11.5"></a><span id="l11.5"> #include &quot;nsIProperty.h&quot;</span>
<a href="#l11.6"></a><span id="l11.6"> #include &quot;nsIVariant.h&quot;</span>
<a href="#l11.7"></a><span id="l11.7"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l11.8"></a><span id="l11.8"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l11.9"></a><span id="l11.9"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l11.10"></a><span id="l11.10"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l11.11"></a><span id="l11.11"> #include &quot;nsIAbManager.h&quot;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l11.13"></a><span id="l11.13"> </span>
<a href="#l11.14"></a><span id="l11.14"> #define ID_PAB_TABLE            1</span>
<a href="#l11.15"></a><span id="l11.15"> #define ID_DELETEDCARDS_TABLE           2</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17"> // There's two books by default, although Mac may have one more, so set this</span>
<a href="#l11.18"></a><span id="l11.18"> // to three. Its not going to affect much, but will save us a few reallocations</span>
<a href="#l11.19"></a><span id="l11.19"> // when the cache is allocated.</span>
<a href="#l11.20"></a><span id="l11.20"> const PRUint32 kInitialAddrDBCacheSize = 3;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineat">@@ -465,18 +466,19 @@ NS_IMETHODIMP nsAddrDatabase::Open</span>
<a href="#l11.22"></a><span id="l11.22">     }</span>
<a href="#l11.23"></a><span id="l11.23">   }</span>
<a href="#l11.24"></a><span id="l11.24">   return rv;</span>
<a href="#l11.25"></a><span id="l11.25"> }</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27"> nsresult nsAddrDatabase::DisplayAlert(const PRUnichar *titleName, const PRUnichar *alertStringName, const PRUnichar **formatStrings, PRInt32 numFormatStrings)</span>
<a href="#l11.28"></a><span id="l11.28"> {</span>
<a href="#l11.29"></a><span id="l11.29">   nsresult rv;</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l11.37"></a><span id="l11.37">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l11.38"></a><span id="l11.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.39"></a><span id="l11.39"> </span>
<a href="#l11.40"></a><span id="l11.40">   nsString alertMessage;</span>
<a href="#l11.41"></a><span id="l11.41">   rv = bundle-&gt;FormatStringFromName(alertStringName, formatStrings, numFormatStrings,</span>
<a href="#l11.42"></a><span id="l11.42">     getter_Copies(alertMessage));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilter.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -57,16 +57,17 @@</span>
<a href="#l12.4"></a><span id="l12.4"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l12.5"></a><span id="l12.5"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l12.6"></a><span id="l12.6"> #include &quot;nsDateTimeFormatCID.h&quot;</span>
<a href="#l12.7"></a><span id="l12.7"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l12.8"></a><span id="l12.8"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l12.9"></a><span id="l12.9"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l12.10"></a><span id="l12.10"> #include &quot;nsMemory.h&quot;</span>
<a href="#l12.11"></a><span id="l12.11"> #include &quot;prmem.h&quot;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l12.13"></a><span id="l12.13"> </span>
<a href="#l12.14"></a><span id="l12.14"> static const char *kImapPrefix = &quot;//imap:&quot;;</span>
<a href="#l12.15"></a><span id="l12.15"> static const char *kWhitespace = &quot;\b\t\r\n &quot;;</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17"> nsMsgRuleAction::nsMsgRuleAction()</span>
<a href="#l12.18"></a><span id="l12.18"> {</span>
<a href="#l12.19"></a><span id="l12.19"> }</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21" class="difflineat">@@ -535,18 +536,18 @@ NS_IMETHODIMP nsMsgFilter::LogRuleHit(ns</span>
<a href="#l12.22"></a><span id="l12.22">     nsCString buffer;</span>
<a href="#l12.23"></a><span id="l12.23"> #ifdef MOZILLA_INTERNAL_API</span>
<a href="#l12.24"></a><span id="l12.24">     // this is big enough to hold a log entry.</span>
<a href="#l12.25"></a><span id="l12.25">     // do this so we avoid growing and copying as we append to the log.</span>
<a href="#l12.26"></a><span id="l12.26">     buffer.SetCapacity(512);</span>
<a href="#l12.27"></a><span id="l12.27"> #endif</span>
<a href="#l12.28"></a><span id="l12.28"> </span>
<a href="#l12.29"></a><span id="l12.29">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-      do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l12.34"></a><span id="l12.34"> </span>
<a href="#l12.35"></a><span id="l12.35">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l12.36"></a><span id="l12.36">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/filter.properties&quot;,</span>
<a href="#l12.37"></a><span id="l12.37">       getter_AddRefs(bundle));</span>
<a href="#l12.38"></a><span id="l12.38">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.39"></a><span id="l12.39"> </span>
<a href="#l12.40"></a><span id="l12.40">     const PRUnichar *filterLogDetectFormatStrings[4] = { filterName.get(), authorValue.get(), subjectValue.get(), dateValue.get() };</span>
<a href="#l12.41"></a><span id="l12.41">     nsString filterLogDetectStr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -224,25 +224,25 @@ nsMsgFilterService::GetStringFromBundle(</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5"> }</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> nsresult</span>
<a href="#l13.8"></a><span id="l13.8"> nsMsgFilterService::GetFilterStringBundle(nsIStringBundle **aBundle)</span>
<a href="#l13.9"></a><span id="l13.9"> {</span>
<a href="#l13.10"></a><span id="l13.10">   NS_ENSURE_ARG_POINTER(aBundle);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  nsresult rv;</span>
<a href="#l13.13"></a><span id="l13.13">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-         do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+         mozilla::services::GetStringBundleService();</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l13.17"></a><span id="l13.17">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-  if (bundleService &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+  if (bundleService)</span>
<a href="#l13.20"></a><span id="l13.20">     bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/filter.properties&quot;,</span>
<a href="#l13.21"></a><span id="l13.21">                                  getter_AddRefs(bundle));</span>
<a href="#l13.22"></a><span id="l13.22">   NS_IF_ADDREF(*aBundle = bundle);</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-  return rv;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.25"></a><span id="l13.25"> }</span>
<a href="#l13.26"></a><span id="l13.26"> </span>
<a href="#l13.27"></a><span id="l13.27"> nsresult</span>
<a href="#l13.28"></a><span id="l13.28"> nsMsgFilterService::ThrowAlertMsg(const char*aMsgName, nsIMsgWindow *aMsgWindow)</span>
<a href="#l13.29"></a><span id="l13.29"> {</span>
<a href="#l13.30"></a><span id="l13.30">   nsString alertString;</span>
<a href="#l13.31"></a><span id="l13.31">   nsresult rv = GetStringFromBundle(aMsgName, getter_Copies(alertString));</span>
<a href="#l13.32"></a><span id="l13.32">   if (NS_SUCCEEDED(rv) &amp;&amp; !alertString.IsEmpty() &amp;&amp; aMsgWindow)</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineat">@@ -1072,17 +1072,18 @@ NS_IMETHODIMP nsMsgFilterAfterTheFact::O</span>
<a href="#l13.34"></a><span id="l13.34">   return RunNextFilter();</span>
<a href="#l13.35"></a><span id="l13.35"> }</span>
<a href="#l13.36"></a><span id="l13.36"> </span>
<a href="#l13.37"></a><span id="l13.37"> bool nsMsgFilterAfterTheFact::ContinueExecutionPrompt()</span>
<a href="#l13.38"></a><span id="l13.38"> {</span>
<a href="#l13.39"></a><span id="l13.39">   if (!m_curFilter)</span>
<a href="#l13.40"></a><span id="l13.40">     return false;</span>
<a href="#l13.41"></a><span id="l13.41">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID);</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l13.45"></a><span id="l13.45">   if (!bundleService)</span>
<a href="#l13.46"></a><span id="l13.46">     return false;</span>
<a href="#l13.47"></a><span id="l13.47">   bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/filter.properties&quot;,</span>
<a href="#l13.48"></a><span id="l13.48">                               getter_AddRefs(bundle));</span>
<a href="#l13.49"></a><span id="l13.49">   if (!bundle)</span>
<a href="#l13.50"></a><span id="l13.50">     return false;</span>
<a href="#l13.51"></a><span id="l13.51">   nsString filterName;</span>
<a href="#l13.52"></a><span id="l13.52">   m_curFilter-&gt;GetFilterName(filterName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMailDirProvider.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMailDirProvider.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -43,16 +43,17 @@</span>
<a href="#l14.4"></a><span id="l14.4"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l14.5"></a><span id="l14.5"> #include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l14.6"></a><span id="l14.6"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l14.7"></a><span id="l14.7"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l14.8"></a><span id="l14.8"> #include &quot;nsIChromeRegistry.h&quot;</span>
<a href="#l14.9"></a><span id="l14.9"> #include &quot;nsICategoryManager.h&quot;</span>
<a href="#l14.10"></a><span id="l14.10"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l14.11"></a><span id="l14.11"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l14.13"></a><span id="l14.13"> </span>
<a href="#l14.14"></a><span id="l14.14"> #define MAIL_DIR_50_NAME             &quot;Mail&quot;</span>
<a href="#l14.15"></a><span id="l14.15"> #define IMAP_MAIL_DIR_50_NAME        &quot;ImapMail&quot;</span>
<a href="#l14.16"></a><span id="l14.16"> #define NEWS_DIR_50_NAME             &quot;News&quot;</span>
<a href="#l14.17"></a><span id="l14.17"> #define MSG_FOLDER_CACHE_DIR_50_NAME &quot;panacea.dat&quot;</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19"> nsresult</span>
<a href="#l14.20"></a><span id="l14.20"> nsMailDirProvider::EnsureDirectory(nsIFile *aDirectory)</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineat">@@ -223,14 +224,15 @@ nsMailDirProvider::AppendingEnumerator::</span>
<a href="#l14.22"></a><span id="l14.22"> </span>
<a href="#l14.23"></a><span id="l14.23">   return NS_OK;</span>
<a href="#l14.24"></a><span id="l14.24"> }</span>
<a href="#l14.25"></a><span id="l14.25"> </span>
<a href="#l14.26"></a><span id="l14.26"> nsMailDirProvider::AppendingEnumerator::AppendingEnumerator</span>
<a href="#l14.27"></a><span id="l14.27">     (nsISimpleEnumerator* aBase) :</span>
<a href="#l14.28"></a><span id="l14.28">   mBase(aBase)</span>
<a href="#l14.29"></a><span id="l14.29"> {</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-  nsCOMPtr&lt;nsIXULChromeRegistry&gt; packageRegistry = do_GetService(&quot;@mozilla.org/chrome/chrome-registry;1&quot;);</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+  nsCOMPtr&lt;nsIXULChromeRegistry&gt; packageRegistry =</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+    mozilla::services::GetXULChromeRegistryService();</span>
<a href="#l14.33"></a><span id="l14.33">   if (packageRegistry)</span>
<a href="#l14.34"></a><span id="l14.34">     packageRegistry-&gt;GetSelectedLocale(NS_LITERAL_CSTRING(&quot;global&quot;), mLocale);</span>
<a href="#l14.35"></a><span id="l14.35">   // Initialize mNext to begin</span>
<a href="#l14.36"></a><span id="l14.36">   GetNext(nsnull);</span>
<a href="#l14.37"></a><span id="l14.37"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -52,16 +52,17 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #include &quot;nsQuickSort.h&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l15.6"></a><span id="l15.6"> #if defined(XP_MACOSX) &amp;&amp; !defined(__LP64__)</span>
<a href="#l15.7"></a><span id="l15.7"> #include &quot;nsIAppleFileDecoder.h&quot;</span>
<a href="#l15.8"></a><span id="l15.8"> #include &quot;nsILocalFileMac.h&quot;</span>
<a href="#l15.9"></a><span id="l15.9"> #endif</span>
<a href="#l15.10"></a><span id="l15.10"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l15.13"></a><span id="l15.13"> </span>
<a href="#l15.14"></a><span id="l15.14"> // necko</span>
<a href="#l15.15"></a><span id="l15.15"> #include &quot;nsMimeTypes.h&quot;</span>
<a href="#l15.16"></a><span id="l15.16"> #include &quot;nsIURL.h&quot;</span>
<a href="#l15.17"></a><span id="l15.17"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l15.18"></a><span id="l15.18"> #include &quot;nsIStreamListener.h&quot;</span>
<a href="#l15.19"></a><span id="l15.19"> #include &quot;nsIStreamConverterService.h&quot;</span>
<a href="#l15.20"></a><span id="l15.20"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineat">@@ -1979,27 +1980,25 @@ nsSaveMsgListener::OnDataAvailable(nsIRe</span>
<a href="#l15.22"></a><span id="l15.22">   return rv;</span>
<a href="#l15.23"></a><span id="l15.23"> }</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25"> #define MESSENGER_STRING_URL       &quot;chrome://messenger/locale/messenger.properties&quot;</span>
<a href="#l15.26"></a><span id="l15.26"> </span>
<a href="#l15.27"></a><span id="l15.27"> nsresult</span>
<a href="#l15.28"></a><span id="l15.28"> nsMessenger::InitStringBundle()</span>
<a href="#l15.29"></a><span id="l15.29"> {</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-  nsresult res = NS_OK;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-  if (!mStringBundle)</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-  {</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-    const char propertyURL[] = MESSENGER_STRING_URL;</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-             do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;res);</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-    if (NS_SUCCEEDED(res) &amp;&amp; (nsnull != sBundleService))</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-      res = sBundleService-&gt;CreateBundle(propertyURL,</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-                                               getter_AddRefs(mStringBundle));</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-  }</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-  return res;</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+  if (mStringBundle)</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineplus">+    return NS_OK;</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+  const char propertyURL[] = MESSENGER_STRING_URL;</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineplus">+  NS_ENSURE_TRUE(sBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineplus">+  return sBundleService-&gt;CreateBundle(propertyURL,</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineplus">+                                      getter_AddRefs(mStringBundle));</span>
<a href="#l15.50"></a><span id="l15.50"> }</span>
<a href="#l15.51"></a><span id="l15.51"> </span>
<a href="#l15.52"></a><span id="l15.52"> void</span>
<a href="#l15.53"></a><span id="l15.53"> nsMessenger::GetString(const nsString&amp; aStringName, nsString&amp; aValue)</span>
<a href="#l15.54"></a><span id="l15.54"> {</span>
<a href="#l15.55"></a><span id="l15.55">   nsresult rv;</span>
<a href="#l15.56"></a><span id="l15.56">   aValue.Truncate();</span>
<a href="#l15.57"></a><span id="l15.57"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerUnixIntegration.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -79,16 +79,17 @@</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l16.6"></a><span id="l16.6"> #include &quot;nsToolkitCompsCID.h&quot;</span>
<a href="#l16.7"></a><span id="l16.7"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l16.8"></a><span id="l16.8"> #include &quot;msgCore.h&quot;</span>
<a href="#l16.9"></a><span id="l16.9"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l16.10"></a><span id="l16.10"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l16.11"></a><span id="l16.11"> #include &quot;nsMemory.h&quot;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l16.13"></a><span id="l16.13"> </span>
<a href="#l16.14"></a><span id="l16.14"> #define ALERT_CHROME_URL &quot;chrome://messenger/content/newmailalert.xul&quot;</span>
<a href="#l16.15"></a><span id="l16.15"> #define NEW_MAIL_ALERT_ICON &quot;chrome://messenger/skin/icons/new-mail-alert.png&quot;</span>
<a href="#l16.16"></a><span id="l16.16"> #define SHOW_ALERT_PREF &quot;mail.biff.show_alert&quot;</span>
<a href="#l16.17"></a><span id="l16.17"> #define SHOW_ALERT_PREVIEW_LENGTH &quot;mail.biff.alert.preview_length&quot;</span>
<a href="#l16.18"></a><span id="l16.18"> #define SHOW_ALERT_PREVIEW_LENGTH_DEFAULT 40</span>
<a href="#l16.19"></a><span id="l16.19"> #define SHOW_ALERT_PREVIEW &quot;mail.biff.alert.show_preview&quot;</span>
<a href="#l16.20"></a><span id="l16.20"> #define SHOW_ALERT_SENDER  &quot;mail.biff.alert.show_sender&quot;</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineat">@@ -168,24 +169,25 @@ nsMessengerUnixIntegration::OnItemUnicha</span>
<a href="#l16.22"></a><span id="l16.22"> NS_IMETHODIMP</span>
<a href="#l16.23"></a><span id="l16.23"> nsMessengerUnixIntegration::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l16.24"></a><span id="l16.24"> {</span>
<a href="#l16.25"></a><span id="l16.25">   return NS_OK;</span>
<a href="#l16.26"></a><span id="l16.26"> }</span>
<a href="#l16.27"></a><span id="l16.27"> </span>
<a href="#l16.28"></a><span id="l16.28"> nsresult nsMessengerUnixIntegration::GetStringBundle(nsIStringBundle **aBundle)</span>
<a href="#l16.29"></a><span id="l16.29"> {</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l16.31"></a><span id="l16.31">   NS_ENSURE_ARG_POINTER(aBundle);</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l16.36"></a><span id="l16.36">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-  if (bundleService &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-    bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+  bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+                              getter_AddRefs(bundle));</span>
<a href="#l16.41"></a><span id="l16.41">   bundle.swap(*aBundle);</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-  return rv;</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineplus">+  return NS_OK;</span>
<a href="#l16.44"></a><span id="l16.44"> }</span>
<a href="#l16.45"></a><span id="l16.45"> </span>
<a href="#l16.46"></a><span id="l16.46"> #ifdef MOZ_THUNDERBIRD</span>
<a href="#l16.47"></a><span id="l16.47"> bool</span>
<a href="#l16.48"></a><span id="l16.48"> nsMessengerUnixIntegration::BuildNotificationTitle(nsIMsgFolder *aFolder, nsIStringBundle *aBundle, nsString &amp;aTitle)</span>
<a href="#l16.49"></a><span id="l16.49"> {</span>
<a href="#l16.50"></a><span id="l16.50">   nsString accountName;</span>
<a href="#l16.51"></a><span id="l16.51">   aFolder-&gt;GetPrettiestName(accountName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -77,16 +77,17 @@</span>
<a href="#l17.4"></a><span id="l17.4"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l17.5"></a><span id="l17.5"> #include &quot;nsIWeakReferenceUtils.h&quot;</span>
<a href="#l17.6"></a><span id="l17.6"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l17.7"></a><span id="l17.7"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l17.8"></a><span id="l17.8"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l17.9"></a><span id="l17.9"> #ifdef MOZ_THUNDERBIRD</span>
<a href="#l17.10"></a><span id="l17.10"> #include &quot;mozilla/LookAndFeel.h&quot;</span>
<a href="#l17.11"></a><span id="l17.11"> #endif</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l17.13"></a><span id="l17.13"> </span>
<a href="#l17.14"></a><span id="l17.14"> #include &quot;nsToolkitCompsCID.h&quot;</span>
<a href="#l17.15"></a><span id="l17.15"> #include &lt;stdlib.h&gt;</span>
<a href="#l17.16"></a><span id="l17.16"> #define PROFILE_COMMANDLINE_ARG &quot; -profile &quot;</span>
<a href="#l17.17"></a><span id="l17.17"> </span>
<a href="#l17.18"></a><span id="l17.18"> #define XP_SHSetUnreadMailCounts &quot;SHSetUnreadMailCountW&quot;</span>
<a href="#l17.19"></a><span id="l17.19"> #define XP_SHEnumerateUnreadMailAccounts &quot;SHEnumerateUnreadMailAccountsW&quot;</span>
<a href="#l17.20"></a><span id="l17.20"> #define NOTIFICATIONCLASSNAME &quot;MailBiffNotificationMessageWindow&quot;</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineat">@@ -455,24 +456,25 @@ nsMessengerWinIntegration::OnItemUnichar</span>
<a href="#l17.22"></a><span id="l17.22"> NS_IMETHODIMP</span>
<a href="#l17.23"></a><span id="l17.23"> nsMessengerWinIntegration::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l17.24"></a><span id="l17.24"> {</span>
<a href="#l17.25"></a><span id="l17.25">   return NS_OK;</span>
<a href="#l17.26"></a><span id="l17.26"> }</span>
<a href="#l17.27"></a><span id="l17.27"> </span>
<a href="#l17.28"></a><span id="l17.28"> nsresult nsMessengerWinIntegration::GetStringBundle(nsIStringBundle **aBundle)</span>
<a href="#l17.29"></a><span id="l17.29"> {</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l17.31"></a><span id="l17.31">   NS_ENSURE_ARG_POINTER(aBundle);</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l17.36"></a><span id="l17.36">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">-  if (bundleService &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-    bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+  bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+                              getter_AddRefs(bundle));</span>
<a href="#l17.41"></a><span id="l17.41">   NS_IF_ADDREF(*aBundle = bundle);</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-  return rv;</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+  return NS_OK;</span>
<a href="#l17.44"></a><span id="l17.44"> }</span>
<a href="#l17.45"></a><span id="l17.45"> </span>
<a href="#l17.46"></a><span id="l17.46"> #ifndef MOZ_THUNDERBIRD</span>
<a href="#l17.47"></a><span id="l17.47"> nsresult nsMessengerWinIntegration::ShowAlertMessage(const nsString&amp; aAlertTitle,</span>
<a href="#l17.48"></a><span id="l17.48">                                                      const nsString&amp; aAlertText,</span>
<a href="#l17.49"></a><span id="l17.49">                                                      const nsACString&amp; aFolderURI)</span>
<a href="#l17.50"></a><span id="l17.50"> {</span>
<a href="#l17.51"></a><span id="l17.51">   nsresult rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -93,16 +93,17 @@</span>
<a href="#l18.4"></a><span id="l18.4"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l18.5"></a><span id="l18.5"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l18.6"></a><span id="l18.6"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l18.7"></a><span id="l18.7"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l18.8"></a><span id="l18.8"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l18.9"></a><span id="l18.9"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l18.10"></a><span id="l18.10"> #include &quot;nsIMsgFilterList.h&quot;</span>
<a href="#l18.11"></a><span id="l18.11"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l18.13"></a><span id="l18.13"> </span>
<a href="#l18.14"></a><span id="l18.14"> #define PREF_MAIL_ACCOUNTMANAGER_ACCOUNTS &quot;mail.accountmanager.accounts&quot;</span>
<a href="#l18.15"></a><span id="l18.15"> #define PREF_MAIL_ACCOUNTMANAGER_DEFAULTACCOUNT &quot;mail.accountmanager.defaultaccount&quot;</span>
<a href="#l18.16"></a><span id="l18.16"> #define PREF_MAIL_ACCOUNTMANAGER_LOCALFOLDERSSERVER &quot;mail.accountmanager.localfoldersserver&quot;</span>
<a href="#l18.17"></a><span id="l18.17"> #define PREF_MAIL_SERVER_PREFIX &quot;mail.server.&quot;</span>
<a href="#l18.18"></a><span id="l18.18"> #define ACCOUNT_PREFIX &quot;account&quot;</span>
<a href="#l18.19"></a><span id="l18.19"> #define SERVER_PREFIX &quot;server&quot;</span>
<a href="#l18.20"></a><span id="l18.20"> #define ID_PREFIX &quot;id&quot;</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineat">@@ -183,26 +184,24 @@ nsMsgAccountManager::nsMsgAccountManager</span>
<a href="#l18.22"></a><span id="l18.22">   m_userAuthenticated(false),</span>
<a href="#l18.23"></a><span id="l18.23">   m_loadingVirtualFolders(false),</span>
<a href="#l18.24"></a><span id="l18.24">   m_virtualFoldersLoaded(false)</span>
<a href="#l18.25"></a><span id="l18.25"> {</span>
<a href="#l18.26"></a><span id="l18.26"> }</span>
<a href="#l18.27"></a><span id="l18.27"> </span>
<a href="#l18.28"></a><span id="l18.28"> nsMsgAccountManager::~nsMsgAccountManager()</span>
<a href="#l18.29"></a><span id="l18.29"> {</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-  nsresult rv;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-</span>
<a href="#l18.32"></a><span id="l18.32">   if(!m_haveShutdown)</span>
<a href="#l18.33"></a><span id="l18.33">   {</span>
<a href="#l18.34"></a><span id="l18.34">     Shutdown();</span>
<a href="#l18.35"></a><span id="l18.35">     //Don't remove from Observer service in Shutdown because Shutdown also gets called</span>
<a href="#l18.36"></a><span id="l18.36">     //from xpcom shutdown observer.  And we don't want to remove from the service in that case.</span>
<a href="#l18.37"></a><span id="l18.37">     nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-         do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineplus">+      mozilla::services::GetObserverService();</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+    if (observerService)</span>
<a href="#l18.42"></a><span id="l18.42">     {</span>
<a href="#l18.43"></a><span id="l18.43">       observerService-&gt;RemoveObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID);</span>
<a href="#l18.44"></a><span id="l18.44">       observerService-&gt;RemoveObserver(this, &quot;quit-application-granted&quot;);</span>
<a href="#l18.45"></a><span id="l18.45">       observerService-&gt;RemoveObserver(this, ABOUT_TO_GO_OFFLINE_TOPIC);</span>
<a href="#l18.46"></a><span id="l18.46">       observerService-&gt;RemoveObserver(this, &quot;sleep_notification&quot;);</span>
<a href="#l18.47"></a><span id="l18.47">     }</span>
<a href="#l18.48"></a><span id="l18.48">   }</span>
<a href="#l18.49"></a><span id="l18.49"> }</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineat">@@ -218,18 +217,18 @@ nsresult nsMsgAccountManager::Init()</span>
<a href="#l18.51"></a><span id="l18.51">   m_incomingServers.Init();</span>
<a href="#l18.52"></a><span id="l18.52"> </span>
<a href="#l18.53"></a><span id="l18.53">   rv = NS_NewISupportsArray(getter_AddRefs(m_accounts));</span>
<a href="#l18.54"></a><span id="l18.54">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.55"></a><span id="l18.55"> </span>
<a href="#l18.56"></a><span id="l18.56">   rv = NS_NewISupportsArray(getter_AddRefs(mFolderListeners));</span>
<a href="#l18.57"></a><span id="l18.57"> </span>
<a href="#l18.58"></a><span id="l18.58">   nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineminus">-           do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineplus">+           mozilla::services::GetObserverService();</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineplus">+  if (NS_SUCCEEDED(rv) &amp;&amp; observerService)</span>
<a href="#l18.63"></a><span id="l18.63">   {</span>
<a href="#l18.64"></a><span id="l18.64">     observerService-&gt;AddObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID, true);</span>
<a href="#l18.65"></a><span id="l18.65">     observerService-&gt;AddObserver(this, &quot;quit-application-granted&quot; , true);</span>
<a href="#l18.66"></a><span id="l18.66">     observerService-&gt;AddObserver(this, ABOUT_TO_GO_OFFLINE_TOPIC, true);</span>
<a href="#l18.67"></a><span id="l18.67">     observerService-&gt;AddObserver(this, &quot;profile-before-change&quot;, true);</span>
<a href="#l18.68"></a><span id="l18.68">     observerService-&gt;AddObserver(this, &quot;sleep_notification&quot;, true);</span>
<a href="#l18.69"></a><span id="l18.69">   }</span>
<a href="#l18.70"></a><span id="l18.70"> </span>
<a href="#l18.71"></a><span id="l18.71" class="difflineat">@@ -834,19 +833,19 @@ nsMsgAccountManager::notifyDefaultServer</span>
<a href="#l18.72"></a><span id="l18.72">         rootFolder-&gt;NotifyBoolPropertyChanged(kDefaultServerAtom,</span>
<a href="#l18.73"></a><span id="l18.73">                                               false, true);</span>
<a href="#l18.74"></a><span id="l18.74">     }</span>
<a href="#l18.75"></a><span id="l18.75">   }</span>
<a href="#l18.76"></a><span id="l18.76"> </span>
<a href="#l18.77"></a><span id="l18.77">   if (aOldAccount &amp;&amp; aNewAccount)  //only notify if the user goes and changes default account</span>
<a href="#l18.78"></a><span id="l18.78">   {</span>
<a href="#l18.79"></a><span id="l18.79">     nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineminus">-      do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineminus">-</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineplus">+      mozilla::services::GetObserverService();</span>
<a href="#l18.84"></a><span id="l18.84" class="difflineplus">+</span>
<a href="#l18.85"></a><span id="l18.85" class="difflineplus">+    if (observerService)</span>
<a href="#l18.86"></a><span id="l18.86">       observerService-&gt;NotifyObservers(nsnull,&quot;mailDefaultAccountChanged&quot;,nsnull);</span>
<a href="#l18.87"></a><span id="l18.87">   }</span>
<a href="#l18.88"></a><span id="l18.88"> </span>
<a href="#l18.89"></a><span id="l18.89">   return NS_OK;</span>
<a href="#l18.90"></a><span id="l18.90"> }</span>
<a href="#l18.91"></a><span id="l18.91"> </span>
<a href="#l18.92"></a><span id="l18.92"> nsresult</span>
<a href="#l18.93"></a><span id="l18.93"> nsMsgAccountManager::setDefaultAccountPref(nsIMsgAccount* aDefaultAccount)</span>
<a href="#l18.94"></a><span id="l18.94" class="difflineat">@@ -2369,18 +2368,18 @@ NS_IMETHODIMP nsMsgAccountManager::GetLo</span>
<a href="#l18.95"></a><span id="l18.95"> </span>
<a href="#l18.96"></a><span id="l18.96"> nsresult nsMsgAccountManager::GetLocalFoldersPrettyName(nsString &amp;localFoldersName)</span>
<a href="#l18.97"></a><span id="l18.97"> {</span>
<a href="#l18.98"></a><span id="l18.98">   // we don't want &quot;nobody at Local Folders&quot; to show up in the</span>
<a href="#l18.99"></a><span id="l18.99">   // folder pane, so we set the pretty name to a localized &quot;Local Folders&quot;</span>
<a href="#l18.100"></a><span id="l18.100">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l18.101"></a><span id="l18.101">   nsresult rv;</span>
<a href="#l18.102"></a><span id="l18.102">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineminus">-    do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.105"></a><span id="l18.105" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l18.106"></a><span id="l18.106" class="difflineplus">+  NS_ENSURE_TRUE(sBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l18.107"></a><span id="l18.107"> </span>
<a href="#l18.108"></a><span id="l18.108">   if (sBundleService)</span>
<a href="#l18.109"></a><span id="l18.109">     rv = sBundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l18.110"></a><span id="l18.110">                                       getter_AddRefs(bundle));</span>
<a href="#l18.111"></a><span id="l18.111">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.112"></a><span id="l18.112"> </span>
<a href="#l18.113"></a><span id="l18.113">   return bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;localFolders&quot;).get(), getter_Copies(localFoldersName));</span>
<a href="#l18.114"></a><span id="l18.114"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -53,16 +53,17 @@</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5"> #include &quot;nsICategoryManager.h&quot;</span>
<a href="#l19.6"></a><span id="l19.6"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l19.7"></a><span id="l19.7"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l19.8"></a><span id="l19.8"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l19.9"></a><span id="l19.9"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l19.10"></a><span id="l19.10"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l19.11"></a><span id="l19.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l19.13"></a><span id="l19.13"> </span>
<a href="#l19.14"></a><span id="l19.14"> // turn this on to see useful output</span>
<a href="#l19.15"></a><span id="l19.15"> #undef DEBUG_amds</span>
<a href="#l19.16"></a><span id="l19.16"> </span>
<a href="#l19.17"></a><span id="l19.17"> #define NC_RDF_PAGETITLE_PREFIX               NC_NAMESPACE_URI &quot;PageTitle&quot;</span>
<a href="#l19.18"></a><span id="l19.18"> #define NC_RDF_PAGETITLE_MAIN                 NC_RDF_PAGETITLE_PREFIX &quot;Main&quot;</span>
<a href="#l19.19"></a><span id="l19.19"> #define NC_RDF_PAGETITLE_SERVER               NC_RDF_PAGETITLE_PREFIX &quot;Server&quot;</span>
<a href="#l19.20"></a><span id="l19.20"> #define NC_RDF_PAGETITLE_COPIES               NC_RDF_PAGETITLE_PREFIX &quot;Copies&quot;</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineat">@@ -353,18 +354,18 @@ nsMsgAccountManagerDataSource::GetTarget</span>
<a href="#l19.22"></a><span id="l19.22">         rv = folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l19.23"></a><span id="l19.23">         if (NS_SUCCEEDED(rv) &amp;&amp; isServer)</span>
<a href="#l19.24"></a><span id="l19.24">           rv = folder-&gt;GetPrettyName(pageTitle);</span>
<a href="#l19.25"></a><span id="l19.25">       }</span>
<a href="#l19.26"></a><span id="l19.26">       else {</span>
<a href="#l19.27"></a><span id="l19.27">         // allow for the accountmanager to be dynamically extended.</span>
<a href="#l19.28"></a><span id="l19.28"> </span>
<a href="#l19.29"></a><span id="l19.29">         nsCOMPtr&lt;nsIStringBundleService&gt; strBundleService =</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-          do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-        NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+          mozilla::services::GetStringBundleService();</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+        NS_ENSURE_TRUE(strBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l19.34"></a><span id="l19.34"> </span>
<a href="#l19.35"></a><span id="l19.35">         const char *sourceValue;</span>
<a href="#l19.36"></a><span id="l19.36">         rv = source-&gt;GetValueConst(&amp;sourceValue);</span>
<a href="#l19.37"></a><span id="l19.37">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l19.38"></a><span id="l19.38"> </span>
<a href="#l19.39"></a><span id="l19.39">         // make sure the pointer math we're about to do is safe.</span>
<a href="#l19.40"></a><span id="l19.40">         NS_ENSURE_TRUE(sourceValue &amp;&amp; (strlen(sourceValue) &gt; strlen(NC_RDF_PAGETITLE_PREFIX)), NS_ERROR_UNEXPECTED);</span>
<a href="#l19.41"></a><span id="l19.41"> </span>
<a href="#l19.42"></a><span id="l19.42" class="difflineat">@@ -1152,21 +1153,19 @@ nsMsgAccountManagerDataSource::findServe</span>
<a href="#l19.43"></a><span id="l19.43">   return true;</span>
<a href="#l19.44"></a><span id="l19.44"> }</span>
<a href="#l19.45"></a><span id="l19.45"> </span>
<a href="#l19.46"></a><span id="l19.46"> nsresult</span>
<a href="#l19.47"></a><span id="l19.47"> nsMsgAccountManagerDataSource::getStringBundle()</span>
<a href="#l19.48"></a><span id="l19.48"> {</span>
<a href="#l19.49"></a><span id="l19.49">   if (mStringBundle) return NS_OK;</span>
<a href="#l19.50"></a><span id="l19.50"> </span>
<a href="#l19.51"></a><span id="l19.51" class="difflineminus">-  nsresult rv;</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineminus">-</span>
<a href="#l19.53"></a><span id="l19.53">   nsCOMPtr&lt;nsIStringBundleService&gt; strBundleService =</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-      do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineplus">+  NS_ENSURE_TRUE(strBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l19.58"></a><span id="l19.58"> </span>
<a href="#l19.59"></a><span id="l19.59">   return strBundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/prefs.properties&quot;,</span>
<a href="#l19.60"></a><span id="l19.60">                                       getter_AddRefs(mStringBundle));</span>
<a href="#l19.61"></a><span id="l19.61"> }</span>
<a href="#l19.62"></a><span id="l19.62"> </span>
<a href="#l19.63"></a><span id="l19.63"> NS_IMETHODIMP</span>
<a href="#l19.64"></a><span id="l19.64"> nsMsgAccountManagerDataSource::OnServerLoaded(nsIMsgIncomingServer* aServer)</span>
<a href="#l19.65"></a><span id="l19.65"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/src/nsMsgBiffManager.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgBiffManager.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -47,16 +47,17 @@</span>
<a href="#l20.4"></a><span id="l20.4"> #include &quot;prlog.h&quot;</span>
<a href="#l20.5"></a><span id="l20.5"> #include &quot;nspr.h&quot;</span>
<a href="#l20.6"></a><span id="l20.6"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l20.7"></a><span id="l20.7"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l20.8"></a><span id="l20.8"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l20.9"></a><span id="l20.9"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l20.10"></a><span id="l20.10"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l20.11"></a><span id="l20.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l20.13"></a><span id="l20.13"> </span>
<a href="#l20.14"></a><span id="l20.14"> #define PREF_BIFF_JITTER &quot;mail.biff.add_interval_jitter&quot;</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16"> static NS_DEFINE_CID(kStatusBarBiffManagerCID, NS_STATUSBARBIFFMANAGER_CID);</span>
<a href="#l20.17"></a><span id="l20.17"> </span>
<a href="#l20.18"></a><span id="l20.18"> static PRLogModuleInfo *MsgBiffLogModule = nsnull;</span>
<a href="#l20.19"></a><span id="l20.19"> </span>
<a href="#l20.20"></a><span id="l20.20"> NS_IMPL_ISUPPORTS4(nsMsgBiffManager, nsIMsgBiffManager,</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineat">@@ -78,20 +79,19 @@ nsMsgBiffManager::nsMsgBiffManager()</span>
<a href="#l20.22"></a><span id="l20.22"> nsMsgBiffManager::~nsMsgBiffManager()</span>
<a href="#l20.23"></a><span id="l20.23"> {</span>
<a href="#l20.24"></a><span id="l20.24">   if (mBiffTimer)</span>
<a href="#l20.25"></a><span id="l20.25">     mBiffTimer-&gt;Cancel();</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27">   if (!mHaveShutdown)</span>
<a href="#l20.28"></a><span id="l20.28">     Shutdown();</span>
<a href="#l20.29"></a><span id="l20.29"> </span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-  nsresult rv;</span>
<a href="#l20.31"></a><span id="l20.31">   nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-       do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineplus">+  if (observerService)</span>
<a href="#l20.36"></a><span id="l20.36">   {</span>
<a href="#l20.37"></a><span id="l20.37">     observerService-&gt;RemoveObserver(this, &quot;wake_notification&quot;);</span>
<a href="#l20.38"></a><span id="l20.38">     observerService-&gt;RemoveObserver(this, &quot;sleep_notification&quot;);</span>
<a href="#l20.39"></a><span id="l20.39">   }</span>
<a href="#l20.40"></a><span id="l20.40"> }</span>
<a href="#l20.41"></a><span id="l20.41"> </span>
<a href="#l20.42"></a><span id="l20.42"> NS_IMETHODIMP nsMsgBiffManager::Init()</span>
<a href="#l20.43"></a><span id="l20.43"> {</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineat">@@ -116,18 +116,18 @@ NS_IMETHODIMP nsMsgBiffManager::Init()</span>
<a href="#l20.45"></a><span id="l20.45">   // Ensure status bar biff service has started</span>
<a href="#l20.46"></a><span id="l20.46">   nsCOMPtr&lt;nsIFolderListener&gt; statusBarBiffService = </span>
<a href="#l20.47"></a><span id="l20.47">     do_GetService(kStatusBarBiffManagerCID, &amp;rv);</span>
<a href="#l20.48"></a><span id="l20.48"> </span>
<a href="#l20.49"></a><span id="l20.49">   if (!MsgBiffLogModule)</span>
<a href="#l20.50"></a><span id="l20.50">     MsgBiffLogModule = PR_NewLogModule(&quot;MsgBiff&quot;);</span>
<a href="#l20.51"></a><span id="l20.51"> </span>
<a href="#l20.52"></a><span id="l20.52">   nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-           do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineplus">+  if (observerService)</span>
<a href="#l20.57"></a><span id="l20.57">   {</span>
<a href="#l20.58"></a><span id="l20.58">     observerService-&gt;AddObserver(this, &quot;sleep_notification&quot;, true);</span>
<a href="#l20.59"></a><span id="l20.59">     observerService-&gt;AddObserver(this, &quot;wake_notification&quot;, true);</span>
<a href="#l20.60"></a><span id="l20.60">   }</span>
<a href="#l20.61"></a><span id="l20.61">   return NS_OK;</span>
<a href="#l20.62"></a><span id="l20.62"> }</span>
<a href="#l20.63"></a><span id="l20.63"> </span>
<a href="#l20.64"></a><span id="l20.64"> NS_IMETHODIMP nsMsgBiffManager::Shutdown()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -78,16 +78,17 @@</span>
<a href="#l21.4"></a><span id="l21.4"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l21.5"></a><span id="l21.5"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l21.6"></a><span id="l21.6"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l21.7"></a><span id="l21.7"> #include &quot;nsMemory.h&quot;</span>
<a href="#l21.8"></a><span id="l21.8"> #include &quot;nsAlgorithm.h&quot;</span>
<a href="#l21.9"></a><span id="l21.9"> #include &quot;nsIAbManager.h&quot;</span>
<a href="#l21.10"></a><span id="l21.10"> #include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l21.11"></a><span id="l21.11"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l21.13"></a><span id="l21.13"> </span>
<a href="#l21.14"></a><span id="l21.14"> nsrefcnt nsMsgDBView::gInstanceCount  = 0;</span>
<a href="#l21.15"></a><span id="l21.15"> </span>
<a href="#l21.16"></a><span id="l21.16"> #ifdef SUPPORT_PRIORITY_COLORS</span>
<a href="#l21.17"></a><span id="l21.17"> nsIAtom * nsMsgDBView::kHighestPriorityAtom = nsnull;</span>
<a href="#l21.18"></a><span id="l21.18"> nsIAtom * nsMsgDBView::kHighPriorityAtom = nsnull;</span>
<a href="#l21.19"></a><span id="l21.19"> nsIAtom * nsMsgDBView::kLowestPriorityAtom = nsnull;</span>
<a href="#l21.20"></a><span id="l21.20"> nsIAtom * nsMsgDBView::kLowPriorityAtom = nsnull;</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineat">@@ -309,24 +310,25 @@ nsresult nsMsgDBView::InitLabelStrings()</span>
<a href="#l21.22"></a><span id="l21.22">     rv = GetPrefLocalizedString(prefString.get(), mLabelPrefDescriptions[i]);</span>
<a href="#l21.23"></a><span id="l21.23">   }</span>
<a href="#l21.24"></a><span id="l21.24">   return rv;</span>
<a href="#l21.25"></a><span id="l21.25"> }</span>
<a href="#l21.26"></a><span id="l21.26"> </span>
<a href="#l21.27"></a><span id="l21.27"> // helper function used to fetch strings from the messenger string bundle</span>
<a href="#l21.28"></a><span id="l21.28"> PRUnichar * nsMsgDBView::GetString(const PRUnichar *aStringName)</span>
<a href="#l21.29"></a><span id="l21.29"> {</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-  nsresult    res = NS_OK;</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+  nsresult    res = NS_ERROR_UNEXPECTED;</span>
<a href="#l21.32"></a><span id="l21.32">   PRUnichar   *ptrv = nsnull;</span>
<a href="#l21.33"></a><span id="l21.33"> </span>
<a href="#l21.34"></a><span id="l21.34">   if (!mMessengerStringBundle)</span>
<a href="#l21.35"></a><span id="l21.35">   {</span>
<a href="#l21.36"></a><span id="l21.36">     static const char propertyURL[] = MESSENGER_STRING_URL;</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;res);</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">-    if (NS_SUCCEEDED(res) &amp;&amp; sBundleService)</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+    if (sBundleService)</span>
<a href="#l21.42"></a><span id="l21.42">       res = sBundleService-&gt;CreateBundle(propertyURL, getter_AddRefs(mMessengerStringBundle));</span>
<a href="#l21.43"></a><span id="l21.43">   }</span>
<a href="#l21.44"></a><span id="l21.44"> </span>
<a href="#l21.45"></a><span id="l21.45">   if (mMessengerStringBundle)</span>
<a href="#l21.46"></a><span id="l21.46">     res = mMessengerStringBundle-&gt;GetStringFromName(aStringName, &amp;ptrv);</span>
<a href="#l21.47"></a><span id="l21.47"> </span>
<a href="#l21.48"></a><span id="l21.48">   if ( NS_SUCCEEDED(res) &amp;&amp; (ptrv) )</span>
<a href="#l21.49"></a><span id="l21.49">     return ptrv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -71,16 +71,17 @@</span>
<a href="#l22.4"></a><span id="l22.4"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l22.5"></a><span id="l22.5"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l22.6"></a><span id="l22.6"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l22.7"></a><span id="l22.7"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l22.8"></a><span id="l22.8"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l22.9"></a><span id="l22.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l22.10"></a><span id="l22.10"> #include &quot;nsMemory.h&quot;</span>
<a href="#l22.11"></a><span id="l22.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l22.13"></a><span id="l22.13"> </span>
<a href="#l22.14"></a><span id="l22.14"> #define MESSENGER_STRING_URL       &quot;chrome://messenger/locale/messenger.properties&quot;</span>
<a href="#l22.15"></a><span id="l22.15"> </span>
<a href="#l22.16"></a><span id="l22.16"> nsIRDFResource* nsMsgFolderDataSource::kNC_Child = nsnull;</span>
<a href="#l22.17"></a><span id="l22.17"> nsIRDFResource* nsMsgFolderDataSource::kNC_Folder= nsnull;</span>
<a href="#l22.18"></a><span id="l22.18"> nsIRDFResource* nsMsgFolderDataSource::kNC_Name= nsnull;</span>
<a href="#l22.19"></a><span id="l22.19"> nsIRDFResource* nsMsgFolderDataSource::kNC_Open = nsnull;</span>
<a href="#l22.20"></a><span id="l22.20"> nsIRDFResource* nsMsgFolderDataSource::kNC_FolderTreeName= nsnull;</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineat">@@ -1990,21 +1991,22 @@ nsresult nsMsgFolderDataSource::DoDelete</span>
<a href="#l22.22"></a><span id="l22.22">     nsCOMPtr&lt;nsIMsgFolder&gt; folderToDelete = do_QueryElementAt(folderArray, 0);</span>
<a href="#l22.23"></a><span id="l22.23">     PRUint32 folderFlags = 0;</span>
<a href="#l22.24"></a><span id="l22.24">     if (folderToDelete)</span>
<a href="#l22.25"></a><span id="l22.25">     {</span>
<a href="#l22.26"></a><span id="l22.26">       folderToDelete-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l22.27"></a><span id="l22.27">       if (folderFlags &amp; nsMsgFolderFlags::Virtual)</span>
<a href="#l22.28"></a><span id="l22.28">       {</span>
<a href="#l22.29"></a><span id="l22.29">         NS_ENSURE_ARG_POINTER(msgWindow);</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineminus">-        nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineplus">+        nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+          mozilla::services::GetStringBundleService();</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+        NS_ENSURE_TRUE(sBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l22.34"></a><span id="l22.34">         nsCOMPtr&lt;nsIStringBundle&gt; sMessengerStringBundle;</span>
<a href="#l22.35"></a><span id="l22.35">         nsString confirmMsg;</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineminus">-        if (NS_SUCCEEDED(rv) &amp;&amp; sBundleService)</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineminus">-          rv = sBundleService-&gt;CreateBundle(MESSENGER_STRING_URL, getter_AddRefs(sMessengerStringBundle));</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+        rv = sBundleService-&gt;CreateBundle(MESSENGER_STRING_URL, getter_AddRefs(sMessengerStringBundle));</span>
<a href="#l22.39"></a><span id="l22.39">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.40"></a><span id="l22.40">         sMessengerStringBundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;confirmSavedSearchDeleteMessage&quot;).get(), getter_Copies(confirmMsg));</span>
<a href="#l22.41"></a><span id="l22.41"> </span>
<a href="#l22.42"></a><span id="l22.42">         nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l22.43"></a><span id="l22.43">         rv = msgWindow-&gt;GetPromptDialog(getter_AddRefs(dialog));</span>
<a href="#l22.44"></a><span id="l22.44">         if (NS_SUCCEEDED(rv))</span>
<a href="#l22.45"></a><span id="l22.45">         {</span>
<a href="#l22.46"></a><span id="l22.46">           bool dialogResult;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -55,16 +55,17 @@</span>
<a href="#l23.4"></a><span id="l23.4"> #include &quot;nsIWindowMediator.h&quot;</span>
<a href="#l23.5"></a><span id="l23.5"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l23.6"></a><span id="l23.6"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l23.7"></a><span id="l23.7"> #include &quot;prcmon.h&quot;</span>
<a href="#l23.8"></a><span id="l23.8"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l23.9"></a><span id="l23.9"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l23.10"></a><span id="l23.10"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l23.11"></a><span id="l23.11"> #include &quot;nsIProperties.h&quot;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l23.13"></a><span id="l23.13"> </span>
<a href="#l23.14"></a><span id="l23.14"> NS_IMPL_THREADSAFE_ADDREF(nsMsgMailSession)</span>
<a href="#l23.15"></a><span id="l23.15"> NS_IMPL_THREADSAFE_RELEASE(nsMsgMailSession)</span>
<a href="#l23.16"></a><span id="l23.16"> NS_INTERFACE_MAP_BEGIN(nsMsgMailSession)</span>
<a href="#l23.17"></a><span id="l23.17">   NS_INTERFACE_MAP_ENTRY(nsIMsgMailSession)</span>
<a href="#l23.18"></a><span id="l23.18">   NS_INTERFACE_MAP_ENTRY(nsIFolderListener)</span>
<a href="#l23.19"></a><span id="l23.19">   NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIMsgMailSession)</span>
<a href="#l23.20"></a><span id="l23.20"> NS_INTERFACE_MAP_END_THREADSAFE</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineat">@@ -475,18 +476,18 @@ nsMsgMailSession::GetSelectedLocaleDataD</span>
<a href="#l23.22"></a><span id="l23.22"> </span>
<a href="#l23.23"></a><span id="l23.23">   nsresult rv;                                                                </span>
<a href="#l23.24"></a><span id="l23.24">   bool baseDirExists = false;                                            </span>
<a href="#l23.25"></a><span id="l23.25">   rv = defaultsDir-&gt;Exists(&amp;baseDirExists);                               </span>
<a href="#l23.26"></a><span id="l23.26">   NS_ENSURE_SUCCESS(rv,rv);                                                   </span>
<a href="#l23.27"></a><span id="l23.27"> </span>
<a href="#l23.28"></a><span id="l23.28">   if (baseDirExists) {                                                        </span>
<a href="#l23.29"></a><span id="l23.29">     nsCOMPtr&lt;nsIXULChromeRegistry&gt; packageRegistry =</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineminus">-      do_GetService(&quot;@mozilla.org/chrome/chrome-registry;1&quot;, &amp;rv);</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-    if (NS_SUCCEEDED(rv)) {                                                 </span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+      mozilla::services::GetXULChromeRegistryService();</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineplus">+    if (packageRegistry) {                                                 </span>
<a href="#l23.34"></a><span id="l23.34">       nsCAutoString localeName;                                           </span>
<a href="#l23.35"></a><span id="l23.35">       rv = packageRegistry-&gt;GetSelectedLocale(NS_LITERAL_CSTRING(&quot;global-region&quot;), localeName);</span>
<a href="#l23.36"></a><span id="l23.36"> </span>
<a href="#l23.37"></a><span id="l23.37">       if (NS_SUCCEEDED(rv) &amp;&amp; !localeName.IsEmpty()) {</span>
<a href="#l23.38"></a><span id="l23.38">         bool localeDirExists = false;                              </span>
<a href="#l23.39"></a><span id="l23.39">         nsCOMPtr&lt;nsIFile&gt; localeDataDir;                                </span>
<a href="#l23.40"></a><span id="l23.40">         </span>
<a href="#l23.41"></a><span id="l23.41">         rv = defaultsDir-&gt;Clone(getter_AddRefs(localeDataDir));     </span>
<a href="#l23.42"></a><span id="l23.42" class="difflineat">@@ -544,28 +545,30 @@ nsMsgMailSession::GetDataFilesDir(const </span>
<a href="#l23.43"></a><span id="l23.43"> NS_IMPL_ISUPPORTS3(nsMsgShutdownService, nsIMsgShutdownService, nsIUrlListener, nsIObserver)</span>
<a href="#l23.44"></a><span id="l23.44"> </span>
<a href="#l23.45"></a><span id="l23.45"> nsMsgShutdownService::nsMsgShutdownService()</span>
<a href="#l23.46"></a><span id="l23.46"> : mQuitMode(nsIAppStartup::eAttemptQuit),</span>
<a href="#l23.47"></a><span id="l23.47">   mProcessedShutdown(false),</span>
<a href="#l23.48"></a><span id="l23.48">   mQuitForced(false),</span>
<a href="#l23.49"></a><span id="l23.49">   mReadyToQuit(false)</span>
<a href="#l23.50"></a><span id="l23.50"> {</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineminus">-  nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;);</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineplus">+  nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l23.54"></a><span id="l23.54">   if (observerService)</span>
<a href="#l23.55"></a><span id="l23.55">   {</span>
<a href="#l23.56"></a><span id="l23.56">     observerService-&gt;AddObserver(this, &quot;quit-application-requested&quot;, false);</span>
<a href="#l23.57"></a><span id="l23.57">     observerService-&gt;AddObserver(this, &quot;quit-application-granted&quot;, false);</span>
<a href="#l23.58"></a><span id="l23.58">     observerService-&gt;AddObserver(this, &quot;quit-application&quot;, false);</span>
<a href="#l23.59"></a><span id="l23.59">   }</span>
<a href="#l23.60"></a><span id="l23.60"> }</span>
<a href="#l23.61"></a><span id="l23.61"> </span>
<a href="#l23.62"></a><span id="l23.62"> nsMsgShutdownService::~nsMsgShutdownService()</span>
<a href="#l23.63"></a><span id="l23.63"> {</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineminus">-  nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;);</span>
<a href="#l23.65"></a><span id="l23.65" class="difflineplus">+  nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l23.66"></a><span id="l23.66" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l23.67"></a><span id="l23.67">   if (observerService)</span>
<a href="#l23.68"></a><span id="l23.68">   {  </span>
<a href="#l23.69"></a><span id="l23.69">     observerService-&gt;RemoveObserver(this, &quot;quit-application-requested&quot;);</span>
<a href="#l23.70"></a><span id="l23.70">     observerService-&gt;RemoveObserver(this, &quot;quit-application-granted&quot;);</span>
<a href="#l23.71"></a><span id="l23.71">     observerService-&gt;RemoveObserver(this, &quot;quit-application&quot;);</span>
<a href="#l23.72"></a><span id="l23.72">   }</span>
<a href="#l23.73"></a><span id="l23.73"> }</span>
<a href="#l23.74"></a><span id="l23.74"> </span>
<a href="#l23.75"></a><span id="l23.75" class="difflineat">@@ -654,17 +657,18 @@ NS_IMETHODIMP nsMsgShutdownService::Obse</span>
<a href="#l23.76"></a><span id="l23.76">   if (!strcmp(aTopic, &quot;quit-application&quot;))</span>
<a href="#l23.77"></a><span id="l23.77">   {</span>
<a href="#l23.78"></a><span id="l23.78">     if (mProcessedShutdown)</span>
<a href="#l23.79"></a><span id="l23.79">       return NS_OK;</span>
<a href="#l23.80"></a><span id="l23.80">     else</span>
<a href="#l23.81"></a><span id="l23.81">       mQuitForced = true;</span>
<a href="#l23.82"></a><span id="l23.82">   }</span>
<a href="#l23.83"></a><span id="l23.83"> </span>
<a href="#l23.84"></a><span id="l23.84" class="difflineminus">-  nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;);</span>
<a href="#l23.85"></a><span id="l23.85" class="difflineplus">+  nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l23.86"></a><span id="l23.86" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l23.87"></a><span id="l23.87">   NS_ENSURE_STATE(observerService);</span>
<a href="#l23.88"></a><span id="l23.88">   </span>
<a href="#l23.89"></a><span id="l23.89">   nsCOMPtr&lt;nsISimpleEnumerator&gt; listenerEnum;</span>
<a href="#l23.90"></a><span id="l23.90">   nsresult rv = observerService-&gt;EnumerateObservers(&quot;msg-shutdown&quot;, getter_AddRefs(listenerEnum));</span>
<a href="#l23.91"></a><span id="l23.91">   if (NS_SUCCEEDED(rv) &amp;&amp; listenerEnum)</span>
<a href="#l23.92"></a><span id="l23.92">   {</span>
<a href="#l23.93"></a><span id="l23.93">     bool hasMore;</span>
<a href="#l23.94"></a><span id="l23.94">     listenerEnum-&gt;HasMoreElements(&amp;hasMore);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/base/src/nsMsgOfflineManager.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgOfflineManager.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -50,16 +50,17 @@</span>
<a href="#l24.4"></a><span id="l24.4"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l24.5"></a><span id="l24.5"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l24.6"></a><span id="l24.6"> #include &quot;nsIIOService.h&quot;</span>
<a href="#l24.7"></a><span id="l24.7"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l24.8"></a><span id="l24.8"> #include &quot;nsMsgNewsCID.h&quot;</span>
<a href="#l24.9"></a><span id="l24.9"> #include &quot;nsINntpService.h&quot;</span>
<a href="#l24.10"></a><span id="l24.10"> #include &quot;nsIMsgStatusFeedback.h&quot;</span>
<a href="#l24.11"></a><span id="l24.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l24.13"></a><span id="l24.13"> </span>
<a href="#l24.14"></a><span id="l24.14"> static NS_DEFINE_CID(kMsgSendLaterCID, NS_MSGSENDLATER_CID); </span>
<a href="#l24.15"></a><span id="l24.15"> </span>
<a href="#l24.16"></a><span id="l24.16"> NS_IMPL_THREADSAFE_ISUPPORTS5(nsMsgOfflineManager,</span>
<a href="#l24.17"></a><span id="l24.17">                               nsIMsgOfflineManager,</span>
<a href="#l24.18"></a><span id="l24.18">                               nsIMsgSendLaterListener,</span>
<a href="#l24.19"></a><span id="l24.19">                               nsIObserver,</span>
<a href="#l24.20"></a><span id="l24.20">                               nsISupportsWeakReference,</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineat">@@ -270,36 +271,32 @@ nsresult nsMsgOfflineManager::SendUnsent</span>
<a href="#l24.22"></a><span id="l24.22">   return AdvanceToNextState(rv);</span>
<a href="#l24.23"></a><span id="l24.23"> </span>
<a href="#l24.24"></a><span id="l24.24"> }</span>
<a href="#l24.25"></a><span id="l24.25"> </span>
<a href="#l24.26"></a><span id="l24.26"> #define MESSENGER_STRING_URL       &quot;chrome://messenger/locale/messenger.properties&quot;</span>
<a href="#l24.27"></a><span id="l24.27"> </span>
<a href="#l24.28"></a><span id="l24.28"> nsresult nsMsgOfflineManager::ShowStatus(const char *statusMsgName)</span>
<a href="#l24.29"></a><span id="l24.29"> {</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">-  nsresult res = NS_OK;</span>
<a href="#l24.31"></a><span id="l24.31">   if (!mStringBundle)</span>
<a href="#l24.32"></a><span id="l24.32">   {</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-    static const char propertyURL[] = MESSENGER_STRING_URL;</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-</span>
<a href="#l24.35"></a><span id="l24.35">     nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService = </span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-             do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;res);</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-    if (NS_SUCCEEDED(res) &amp;&amp; (nsnull != sBundleService)) </span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">-    {</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">-      res = sBundleService-&gt;CreateBundle(propertyURL, getter_AddRefs(mStringBundle));</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">-    }</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+    NS_ENSURE_TRUE(sBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+    sBundleService-&gt;CreateBundle(MESSENGER_STRING_URL, getter_AddRefs(mStringBundle));</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+    return NS_OK;</span>
<a href="#l24.45"></a><span id="l24.45">   }</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineminus">-  if (mStringBundle)</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineminus">-  {</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineminus">-    nsString statusString;</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineminus">-    res = mStringBundle-&gt;GetStringFromName(NS_ConvertASCIItoUTF16(statusMsgName).get(), getter_Copies(statusString));</span>
<a href="#l24.50"></a><span id="l24.50"> </span>
<a href="#l24.51"></a><span id="l24.51" class="difflineminus">-    if (NS_SUCCEEDED(res) &amp;&amp; m_statusFeedback)</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineminus">-      m_statusFeedback-&gt;ShowStatusString(statusString);</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-  }</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+  nsString statusString;</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineplus">+  nsresult res = mStringBundle-&gt;GetStringFromName(NS_ConvertASCIItoUTF16(statusMsgName).get(),</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineplus">+						  getter_Copies(statusString));</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+  if (NS_SUCCEEDED(res) &amp;&amp; m_statusFeedback)</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineplus">+    m_statusFeedback-&gt;ShowStatusString(statusString);</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineplus">+</span>
<a href="#l24.61"></a><span id="l24.61">   return res;</span>
<a href="#l24.62"></a><span id="l24.62"> }</span>
<a href="#l24.63"></a><span id="l24.63"> </span>
<a href="#l24.64"></a><span id="l24.64"> nsresult nsMsgOfflineManager::DownloadOfflineNewsgroups()</span>
<a href="#l24.65"></a><span id="l24.65"> {</span>
<a href="#l24.66"></a><span id="l24.66"> 	nsresult rv;</span>
<a href="#l24.67"></a><span id="l24.67">   ShowStatus(&quot;downloadingNewsgroups&quot;);</span>
<a href="#l24.68"></a><span id="l24.68">   nsCOMPtr&lt;nsINntpService&gt; nntpService(do_GetService(NS_NNTPSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineat">@@ -354,23 +351,20 @@ NS_IMETHODIMP nsMsgOfflineManager::Synch</span>
<a href="#l24.70"></a><span id="l24.70">   }</span>
<a href="#l24.71"></a><span id="l24.71">   else</span>
<a href="#l24.72"></a><span id="l24.72">     return AdvanceToNextState(NS_OK);</span>
<a href="#l24.73"></a><span id="l24.73">   return NS_OK;</span>
<a href="#l24.74"></a><span id="l24.74"> }</span>
<a href="#l24.75"></a><span id="l24.75"> </span>
<a href="#l24.76"></a><span id="l24.76"> nsresult nsMsgOfflineManager::SetOnlineState(bool online)</span>
<a href="#l24.77"></a><span id="l24.77"> {</span>
<a href="#l24.78"></a><span id="l24.78" class="difflineminus">-  nsresult rv;</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineminus">-  nsCOMPtr&lt;nsIIOService&gt; netService(do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l24.80"></a><span id="l24.80" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; netService)</span>
<a href="#l24.81"></a><span id="l24.81" class="difflineminus">-  {</span>
<a href="#l24.82"></a><span id="l24.82" class="difflineminus">-    rv = netService-&gt;SetOffline(!online);</span>
<a href="#l24.83"></a><span id="l24.83" class="difflineminus">-  }</span>
<a href="#l24.84"></a><span id="l24.84" class="difflineminus">-  return rv;</span>
<a href="#l24.85"></a><span id="l24.85" class="difflineplus">+  nsCOMPtr&lt;nsIIOService&gt; netService =</span>
<a href="#l24.86"></a><span id="l24.86" class="difflineplus">+    mozilla::services::GetIOService();</span>
<a href="#l24.87"></a><span id="l24.87" class="difflineplus">+  NS_ENSURE_TRUE(netService, NS_ERROR_UNEXPECTED);</span>
<a href="#l24.88"></a><span id="l24.88" class="difflineplus">+  return netService-&gt;SetOffline(!online);</span>
<a href="#l24.89"></a><span id="l24.89"> }</span>
<a href="#l24.90"></a><span id="l24.90"> </span>
<a href="#l24.91"></a><span id="l24.91">   // nsIUrlListener methods</span>
<a href="#l24.92"></a><span id="l24.92"> </span>
<a href="#l24.93"></a><span id="l24.93"> NS_IMETHODIMP</span>
<a href="#l24.94"></a><span id="l24.94"> nsMsgOfflineManager::OnStartRunningUrl(nsIURI * aUrl)</span>
<a href="#l24.95"></a><span id="l24.95"> {</span>
<a href="#l24.96"></a><span id="l24.96">     return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -59,16 +59,17 @@</span>
<a href="#l25.4"></a><span id="l25.4"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l25.5"></a><span id="l25.5"> #include &quot;nsIDocumentLoader.h&quot;</span>
<a href="#l25.6"></a><span id="l25.6"> #include &quot;nsIWidget.h&quot;</span>
<a href="#l25.7"></a><span id="l25.7"> #include &quot;nsIXULWindow.h&quot;</span>
<a href="#l25.8"></a><span id="l25.8"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l25.9"></a><span id="l25.9"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l25.10"></a><span id="l25.10"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l25.11"></a><span id="l25.11"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l25.13"></a><span id="l25.13"> </span>
<a href="#l25.14"></a><span id="l25.14"> // Interfaces Needed</span>
<a href="#l25.15"></a><span id="l25.15"> #include &quot;nsIBaseWindow.h&quot;</span>
<a href="#l25.16"></a><span id="l25.16"> #include &quot;nsIDocShellTreeOwner.h&quot;</span>
<a href="#l25.17"></a><span id="l25.17"> #include &quot;nsIDocShellTreeItem.h&quot;</span>
<a href="#l25.18"></a><span id="l25.18"> #include &quot;nsIDocShellTreeNode.h&quot;</span>
<a href="#l25.19"></a><span id="l25.19"> #include &quot;nsIWebNavigation.h&quot;</span>
<a href="#l25.20"></a><span id="l25.20"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineat">@@ -594,31 +595,30 @@ nsMsgPrintEngine::SetStatusMessage(const</span>
<a href="#l25.22"></a><span id="l25.22">   return NS_OK;</span>
<a href="#l25.23"></a><span id="l25.23"> }</span>
<a href="#l25.24"></a><span id="l25.24"> </span>
<a href="#l25.25"></a><span id="l25.25"> #define MESSENGER_STRING_URL       &quot;chrome://messenger/locale/messenger.properties&quot;</span>
<a href="#l25.26"></a><span id="l25.26"> </span>
<a href="#l25.27"></a><span id="l25.27"> void</span>
<a href="#l25.28"></a><span id="l25.28"> nsMsgPrintEngine::GetString(const PRUnichar *aStringName, nsString&amp; outStr)</span>
<a href="#l25.29"></a><span id="l25.29"> {</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineminus">-  nsresult    res = NS_OK;</span>
<a href="#l25.31"></a><span id="l25.31">   outStr.Truncate();</span>
<a href="#l25.32"></a><span id="l25.32"> </span>
<a href="#l25.33"></a><span id="l25.33">   if (!mStringBundle)</span>
<a href="#l25.34"></a><span id="l25.34">   {</span>
<a href="#l25.35"></a><span id="l25.35">     static const char propertyURL[] = MESSENGER_STRING_URL;</span>
<a href="#l25.36"></a><span id="l25.36"> </span>
<a href="#l25.37"></a><span id="l25.37">     nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService = </span>
<a href="#l25.38"></a><span id="l25.38" class="difflineminus">-             do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;res); </span>
<a href="#l25.39"></a><span id="l25.39" class="difflineminus">-    if (NS_SUCCEEDED(res) &amp;&amp; (nsnull != sBundleService)) </span>
<a href="#l25.40"></a><span id="l25.40" class="difflineminus">-      res = sBundleService-&gt;CreateBundle(propertyURL, getter_AddRefs(mStringBundle));</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineplus">+    if (sBundleService)</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineplus">+      sBundleService-&gt;CreateBundle(propertyURL, getter_AddRefs(mStringBundle));</span>
<a href="#l25.44"></a><span id="l25.44">   }</span>
<a href="#l25.45"></a><span id="l25.45"> </span>
<a href="#l25.46"></a><span id="l25.46">   if (mStringBundle)</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineminus">-    res = mStringBundle-&gt;GetStringFromName(aStringName, getter_Copies(outStr));</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineplus">+    mStringBundle-&gt;GetStringFromName(aStringName, getter_Copies(outStr));</span>
<a href="#l25.49"></a><span id="l25.49">   return;</span>
<a href="#l25.50"></a><span id="l25.50"> }</span>
<a href="#l25.51"></a><span id="l25.51"> </span>
<a href="#l25.52"></a><span id="l25.52"> //-----------------------------------------------------------</span>
<a href="#l25.53"></a><span id="l25.53"> void</span>
<a href="#l25.54"></a><span id="l25.54"> nsMsgPrintEngine::PrintMsgWindow()</span>
<a href="#l25.55"></a><span id="l25.55"> {</span>
<a href="#l25.56"></a><span id="l25.56">   const char* kMsgKeys[] = {&quot;PrintingMessage&quot;,  &quot;PrintPreviewMessage&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/base/src/nsMsgProgress.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgProgress.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -43,16 +43,17 @@</span>
<a href="#l26.4"></a><span id="l26.4"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l26.5"></a><span id="l26.5"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l26.6"></a><span id="l26.6"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l26.7"></a><span id="l26.7"> #include &quot;nsNetError.h&quot;</span>
<a href="#l26.8"></a><span id="l26.8"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l26.9"></a><span id="l26.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l26.10"></a><span id="l26.10"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l26.11"></a><span id="l26.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l26.13"></a><span id="l26.13"> </span>
<a href="#l26.14"></a><span id="l26.14"> NS_IMPL_THREADSAFE_ADDREF(nsMsgProgress)</span>
<a href="#l26.15"></a><span id="l26.15"> NS_IMPL_THREADSAFE_RELEASE(nsMsgProgress)</span>
<a href="#l26.16"></a><span id="l26.16"> </span>
<a href="#l26.17"></a><span id="l26.17"> NS_INTERFACE_MAP_BEGIN(nsMsgProgress)</span>
<a href="#l26.18"></a><span id="l26.18">   NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIMsgStatusFeedback)</span>
<a href="#l26.19"></a><span id="l26.19">   NS_INTERFACE_MAP_ENTRY(nsIMsgProgress)</span>
<a href="#l26.20"></a><span id="l26.20">   NS_INTERFACE_MAP_ENTRY(nsIMsgStatusFeedback)</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineat">@@ -284,15 +285,16 @@ NS_IMETHODIMP nsMsgProgress::OnProgress(</span>
<a href="#l26.22"></a><span id="l26.22">   return OnProgressChange(nsnull, request, PRInt32(aProgress), PRInt32(aProgressMax),</span>
<a href="#l26.23"></a><span id="l26.23">                           PRInt32(aProgress) /* current total progress */, PRInt32(aProgressMax) /* max total progress */);</span>
<a href="#l26.24"></a><span id="l26.24"> }</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26"> NS_IMETHODIMP nsMsgProgress::OnStatus(nsIRequest *request, nsISupports* ctxt,</span>
<a href="#l26.27"></a><span id="l26.27">                                       nsresult aStatus, const PRUnichar* aStatusArg)</span>
<a href="#l26.28"></a><span id="l26.28"> {</span>
<a href="#l26.29"></a><span id="l26.29">   nsresult rv;</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; sbs = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; sbs =</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+  NS_ENSURE_TRUE(sbs, NS_ERROR_UNEXPECTED);</span>
<a href="#l26.35"></a><span id="l26.35">   nsString str;</span>
<a href="#l26.36"></a><span id="l26.36">   rv = sbs-&gt;FormatStatusMessage(aStatus, aStatusArg, getter_Copies(str));</span>
<a href="#l26.37"></a><span id="l26.37">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.38"></a><span id="l26.38">   return ShowStatusString(str);</span>
<a href="#l26.39"></a><span id="l26.39"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/base/src/nsMsgRDFDataSource.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgRDFDataSource.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -39,16 +39,17 @@</span>
<a href="#l27.4"></a><span id="l27.4"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l27.5"></a><span id="l27.5"> #include &quot;rdf.h&quot;</span>
<a href="#l27.6"></a><span id="l27.6"> #include &quot;plstr.h&quot;</span>
<a href="#l27.7"></a><span id="l27.7"> #include &quot;nsMsgRDFUtils.h&quot;</span>
<a href="#l27.8"></a><span id="l27.8"> #include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l27.9"></a><span id="l27.9"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l27.10"></a><span id="l27.10"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l27.11"></a><span id="l27.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l27.13"></a><span id="l27.13"> </span>
<a href="#l27.14"></a><span id="l27.14"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16"> nsMsgRDFDataSource::nsMsgRDFDataSource():</span>
<a href="#l27.17"></a><span id="l27.17">     m_shuttingDown(false),</span>
<a href="#l27.18"></a><span id="l27.18">     mInitialized(false)</span>
<a href="#l27.19"></a><span id="l27.19"> {</span>
<a href="#l27.20"></a><span id="l27.20"> }</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineat">@@ -65,18 +66,19 @@ nsMsgRDFDataSource::~nsMsgRDFDataSource(</span>
<a href="#l27.22"></a><span id="l27.22"> */</span>
<a href="#l27.23"></a><span id="l27.23"> nsresult</span>
<a href="#l27.24"></a><span id="l27.24"> nsMsgRDFDataSource::Init()</span>
<a href="#l27.25"></a><span id="l27.25"> {</span>
<a href="#l27.26"></a><span id="l27.26">   NS_ENSURE_TRUE(!mInitialized, NS_ERROR_ALREADY_INITIALIZED);</span>
<a href="#l27.27"></a><span id="l27.27"> </span>
<a href="#l27.28"></a><span id="l27.28">   nsresult rv;</span>
<a href="#l27.29"></a><span id="l27.29">   /* Add an observer to XPCOM shutdown */</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineminus">-  nsCOMPtr&lt;nsIObserverService&gt; obs = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+  nsCOMPtr&lt;nsIObserverService&gt; obs =</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineplus">+  NS_ENSURE_TRUE(obs, NS_ERROR_UNEXPECTED);</span>
<a href="#l27.35"></a><span id="l27.35">   rv = obs-&gt;AddObserver(static_cast&lt;nsIObserver*&gt;(this), NS_XPCOM_SHUTDOWN_OBSERVER_ID, true);</span>
<a href="#l27.36"></a><span id="l27.36">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.37"></a><span id="l27.37"> </span>
<a href="#l27.38"></a><span id="l27.38">   getRDFService();</span>
<a href="#l27.39"></a><span id="l27.39"> </span>
<a href="#l27.40"></a><span id="l27.40">   mInitialized=true;</span>
<a href="#l27.41"></a><span id="l27.41">   return rv;</span>
<a href="#l27.42"></a><span id="l27.42"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -48,29 +48,30 @@</span>
<a href="#l28.4"></a><span id="l28.4"> #include &quot;prinrval.h&quot;</span>
<a href="#l28.5"></a><span id="l28.5"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l28.6"></a><span id="l28.6"> #include &quot;nsIMimeMiscStatus.h&quot;</span>
<a href="#l28.7"></a><span id="l28.7"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l28.8"></a><span id="l28.8"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l28.9"></a><span id="l28.9"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l28.10"></a><span id="l28.10"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l28.11"></a><span id="l28.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l28.13"></a><span id="l28.13"> </span>
<a href="#l28.14"></a><span id="l28.14"> #define MSGFEEDBACK_TIMER_INTERVAL 500</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16"> nsMsgStatusFeedback::nsMsgStatusFeedback() :</span>
<a href="#l28.17"></a><span id="l28.17">   m_lastPercent(0)</span>
<a href="#l28.18"></a><span id="l28.18"> {</span>
<a href="#l28.19"></a><span id="l28.19">   LL_I2L(m_lastProgressTime, 0);</span>
<a href="#l28.20"></a><span id="l28.20"> </span>
<a href="#l28.21"></a><span id="l28.21">   nsresult rv;</span>
<a href="#l28.22"></a><span id="l28.22">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineminus">-    do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l28.25"></a><span id="l28.25"> </span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineplus">+  if (bundleService)</span>
<a href="#l28.28"></a><span id="l28.28">     bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l28.29"></a><span id="l28.29">                                 getter_AddRefs(mBundle));</span>
<a href="#l28.30"></a><span id="l28.30"> </span>
<a href="#l28.31"></a><span id="l28.31">   m_msgLoadedAtom = MsgGetAtom(&quot;msgLoaded&quot;);</span>
<a href="#l28.32"></a><span id="l28.32"> }</span>
<a href="#l28.33"></a><span id="l28.33"> </span>
<a href="#l28.34"></a><span id="l28.34"> nsMsgStatusFeedback::~nsMsgStatusFeedback()</span>
<a href="#l28.35"></a><span id="l28.35"> {</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineat">@@ -301,15 +302,16 @@ NS_IMETHODIMP nsMsgStatusFeedback::OnPro</span>
<a href="#l28.37"></a><span id="l28.37">   return OnProgressChange(nsnull, request, PRInt32(aProgress), PRInt32(aProgressMax), </span>
<a href="#l28.38"></a><span id="l28.38">                           PRInt32(aProgress) /* current total progress */, PRInt32(aProgressMax) /* max total progress */);</span>
<a href="#l28.39"></a><span id="l28.39"> }</span>
<a href="#l28.40"></a><span id="l28.40"> </span>
<a href="#l28.41"></a><span id="l28.41"> NS_IMETHODIMP nsMsgStatusFeedback::OnStatus(nsIRequest *request, nsISupports* ctxt, </span>
<a href="#l28.42"></a><span id="l28.42">                                             nsresult aStatus, const PRUnichar* aStatusArg)</span>
<a href="#l28.43"></a><span id="l28.43"> {</span>
<a href="#l28.44"></a><span id="l28.44">   nsresult rv;</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; sbs = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; sbs =</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineplus">+  NS_ENSURE_TRUE(sbs, NS_ERROR_UNEXPECTED);</span>
<a href="#l28.50"></a><span id="l28.50">   nsString str;</span>
<a href="#l28.51"></a><span id="l28.51">   rv = sbs-&gt;FormatStatusMessage(aStatus, aStatusArg, getter_Copies(str));</span>
<a href="#l28.52"></a><span id="l28.52">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.53"></a><span id="l28.53">   return ShowStatusString(str);</span>
<a href="#l28.54"></a><span id="l28.54"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -52,16 +52,17 @@</span>
<a href="#l29.4"></a><span id="l29.4"> #include &quot;nsIImapIncomingServer.h&quot;</span>
<a href="#l29.5"></a><span id="l29.5"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l29.6"></a><span id="l29.6"> #include &quot;nsIRDFResource.h&quot;</span>
<a href="#l29.7"></a><span id="l29.7"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l29.8"></a><span id="l29.8"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l29.9"></a><span id="l29.9"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l29.10"></a><span id="l29.10"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l29.11"></a><span id="l29.11"> #include &quot;nsDateTimeFormatCID.h&quot;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l29.13"></a><span id="l29.13"> </span>
<a href="#l29.14"></a><span id="l29.14"> #include &quot;nsMailDirServiceDefs.h&quot;</span>
<a href="#l29.15"></a><span id="l29.15"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l29.16"></a><span id="l29.16"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l29.17"></a><span id="l29.17"> #include &quot;nsISimpleEnumerator.h&quot;</span>
<a href="#l29.18"></a><span id="l29.18"> #include &quot;nsIDirectoryEnumerator.h&quot;</span>
<a href="#l29.19"></a><span id="l29.19"> #include &quot;nsIMsgHeaderParser.h&quot;</span>
<a href="#l29.20"></a><span id="l29.20"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineat">@@ -704,18 +705,18 @@ NS_IMETHODIMP nsSpamSettings::LogJunkHit</span>
<a href="#l29.22"></a><span id="l29.22">   nsCString buffer;</span>
<a href="#l29.23"></a><span id="l29.23">   // this is big enough to hold a log entry.</span>
<a href="#l29.24"></a><span id="l29.24">   // do this so we avoid growing and copying as we append to the log.</span>
<a href="#l29.25"></a><span id="l29.25"> #ifdef MOZILLA_INTERNAL_API</span>
<a href="#l29.26"></a><span id="l29.26">   buffer.SetCapacity(512);</span>
<a href="#l29.27"></a><span id="l29.27"> #endif</span>
<a href="#l29.28"></a><span id="l29.28"> </span>
<a href="#l29.29"></a><span id="l29.29">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineminus">-    do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l29.34"></a><span id="l29.34"> </span>
<a href="#l29.35"></a><span id="l29.35">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l29.36"></a><span id="l29.36">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/filter.properties&quot;,</span>
<a href="#l29.37"></a><span id="l29.37">     getter_AddRefs(bundle));</span>
<a href="#l29.38"></a><span id="l29.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.39"></a><span id="l29.39"> </span>
<a href="#l29.40"></a><span id="l29.40">   const PRUnichar *junkLogDetectFormatStrings[3] = { authorValue.get(), subjectValue.get(), dateValue.get() };</span>
<a href="#l29.41"></a><span id="l29.41">   nsString junkLogDetectStr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -49,16 +49,17 @@</span>
<a href="#l30.4"></a><span id="l30.4"> #include &quot;nsIFileChannel.h&quot;</span>
<a href="#l30.5"></a><span id="l30.5"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l30.6"></a><span id="l30.6"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l30.7"></a><span id="l30.7"> #include &quot;nsIURL.h&quot;</span>
<a href="#l30.8"></a><span id="l30.8"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l30.9"></a><span id="l30.9"> #include &quot;nsIFileURL.h&quot;</span>
<a href="#l30.10"></a><span id="l30.10"> #include &quot;nsIFile.h&quot;</span>
<a href="#l30.11"></a><span id="l30.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l30.13"></a><span id="l30.13"> </span>
<a href="#l30.14"></a><span id="l30.14"> // QueryInterface, AddRef, and Release</span>
<a href="#l30.15"></a><span id="l30.15"> //</span>
<a href="#l30.16"></a><span id="l30.16"> NS_IMPL_ISUPPORTS2(nsStatusBarBiffManager, nsIStatusBarBiffManager, nsIFolderListener)</span>
<a href="#l30.17"></a><span id="l30.17"> </span>
<a href="#l30.18"></a><span id="l30.18"> nsIAtom * nsStatusBarBiffManager::kBiffStateAtom = nsnull;</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20"> nsStatusBarBiffManager::nsStatusBarBiffManager()</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineat">@@ -193,18 +194,18 @@ nsStatusBarBiffManager::OnItemIntPropert</span>
<a href="#l30.22"></a><span id="l30.22">     // we still need to update the UI.    </span>
<a href="#l30.23"></a><span id="l30.23">     if (newValue == nsIMsgFolder::nsMsgBiffState_NewMail) {</span>
<a href="#l30.24"></a><span id="l30.24">       // if we fail to play the biff sound, keep going.</span>
<a href="#l30.25"></a><span id="l30.25">       (void)PlayBiffSound();</span>
<a href="#l30.26"></a><span id="l30.26">     }</span>
<a href="#l30.27"></a><span id="l30.27">     mCurrentBiffState = newValue;</span>
<a href="#l30.28"></a><span id="l30.28"> </span>
<a href="#l30.29"></a><span id="l30.29">     // don't care if notification fails</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineminus">-    nsCOMPtr&lt;nsIObserverService&gt;</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-      observerService(do_GetService(&quot;@mozilla.org/observer-service;1&quot;));</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+    nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineplus">+      mozilla::services::GetObserverService();</span>
<a href="#l30.34"></a><span id="l30.34">       </span>
<a href="#l30.35"></a><span id="l30.35">     if (observerService)</span>
<a href="#l30.36"></a><span id="l30.36">       observerService-&gt;NotifyObservers(this, &quot;mail:biff-state-changed&quot;, nsnull);</span>
<a href="#l30.37"></a><span id="l30.37">   }</span>
<a href="#l30.38"></a><span id="l30.38">   return NS_OK;</span>
<a href="#l30.39"></a><span id="l30.39"> }</span>
<a href="#l30.40"></a><span id="l30.40"> </span>
<a href="#l30.41"></a><span id="l30.41"> NS_IMETHODIMP </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -98,16 +98,17 @@</span>
<a href="#l31.4"></a><span id="l31.4"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l31.5"></a><span id="l31.5"> #include &quot;nsIPK11TokenDB.h&quot;</span>
<a href="#l31.6"></a><span id="l31.6"> #include &quot;nsIPK11Token.h&quot;</span>
<a href="#l31.7"></a><span id="l31.7"> #include &quot;nsMsgLocalFolderHdrs.h&quot;</span>
<a href="#l31.8"></a><span id="l31.8"> #define oneHour 3600000000U</span>
<a href="#l31.9"></a><span id="l31.9"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l31.10"></a><span id="l31.10"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l31.11"></a><span id="l31.11"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l31.13"></a><span id="l31.13"> </span>
<a href="#l31.14"></a><span id="l31.14"> static PRTime gtimeOfLastPurgeCheck;    //variable to know when to check for purge_threshhold</span>
<a href="#l31.15"></a><span id="l31.15"> </span>
<a href="#l31.16"></a><span id="l31.16"> #define PREF_MAIL_PROMPT_PURGE_THRESHOLD &quot;mail.prompt_purge_threshhold&quot;</span>
<a href="#l31.17"></a><span id="l31.17"> #define PREF_MAIL_PURGE_THRESHOLD &quot;mail.purge_threshhold&quot;</span>
<a href="#l31.18"></a><span id="l31.18"> #define PREF_MAIL_PURGE_THRESHOLD_MB &quot;mail.purge_threshhold_mb&quot;</span>
<a href="#l31.19"></a><span id="l31.19"> #define PREF_MAIL_PURGE_MIGRATED &quot;mail.purge_threshold_migrated&quot;</span>
<a href="#l31.20"></a><span id="l31.20"> #define PREF_MAIL_PURGE_ASK &quot;mail.purge.ask&quot;</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineat">@@ -2906,18 +2907,18 @@ nsresult nsMsgDBFolder::PerformBiffNotif</span>
<a href="#l31.22"></a><span id="l31.22">   return NS_OK;</span>
<a href="#l31.23"></a><span id="l31.23"> }</span>
<a href="#l31.24"></a><span id="l31.24"> </span>
<a href="#l31.25"></a><span id="l31.25"> nsresult</span>
<a href="#l31.26"></a><span id="l31.26"> nsMsgDBFolder::initializeStrings()</span>
<a href="#l31.27"></a><span id="l31.27"> {</span>
<a href="#l31.28"></a><span id="l31.28">   nsresult rv;</span>
<a href="#l31.29"></a><span id="l31.29">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineminus">-      do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l31.34"></a><span id="l31.34">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l31.35"></a><span id="l31.35">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l31.36"></a><span id="l31.36">                                    getter_AddRefs(bundle));</span>
<a href="#l31.37"></a><span id="l31.37">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l31.38"></a><span id="l31.38"> </span>
<a href="#l31.39"></a><span id="l31.39">   bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;inboxFolderName&quot;).get(),</span>
<a href="#l31.40"></a><span id="l31.40">                             &amp;kLocalizedInboxName);</span>
<a href="#l31.41"></a><span id="l31.41">   bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;trashFolderName&quot;).get(),</span>
<a href="#l31.42"></a><span id="l31.42" class="difflineat">@@ -5155,25 +5156,24 @@ NS_IMETHODIMP nsMsgDBFolder::GenerateMes</span>
<a href="#l31.43"></a><span id="l31.43">   aURI = uri;</span>
<a href="#l31.44"></a><span id="l31.44">   return NS_OK;</span>
<a href="#l31.45"></a><span id="l31.45"> }</span>
<a href="#l31.46"></a><span id="l31.46"> </span>
<a href="#l31.47"></a><span id="l31.47"> nsresult</span>
<a href="#l31.48"></a><span id="l31.48"> nsMsgDBFolder::GetBaseStringBundle(nsIStringBundle **aBundle)</span>
<a href="#l31.49"></a><span id="l31.49"> {</span>
<a href="#l31.50"></a><span id="l31.50">   NS_ENSURE_ARG_POINTER(aBundle);</span>
<a href="#l31.51"></a><span id="l31.51" class="difflineminus">-  nsresult rv;</span>
<a href="#l31.52"></a><span id="l31.52">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l31.53"></a><span id="l31.53" class="difflineminus">-         do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l31.54"></a><span id="l31.54" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l31.55"></a><span id="l31.55" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l31.56"></a><span id="l31.56">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l31.57"></a><span id="l31.57" class="difflineminus">-  if (bundleService &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l31.58"></a><span id="l31.58" class="difflineminus">-    bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineplus">+  bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l31.60"></a><span id="l31.60">                                  getter_AddRefs(bundle));</span>
<a href="#l31.61"></a><span id="l31.61">   bundle.swap(*aBundle);</span>
<a href="#l31.62"></a><span id="l31.62" class="difflineminus">-  return rv;</span>
<a href="#l31.63"></a><span id="l31.63" class="difflineplus">+  return NS_OK;</span>
<a href="#l31.64"></a><span id="l31.64"> }</span>
<a href="#l31.65"></a><span id="l31.65"> </span>
<a href="#l31.66"></a><span id="l31.66"> nsresult //Do not use this routine if you have to call it very often because it creates a new bundle each time</span>
<a href="#l31.67"></a><span id="l31.67"> nsMsgDBFolder::GetStringFromBundle(const char *msgName, nsString&amp; aResult)</span>
<a href="#l31.68"></a><span id="l31.68"> {</span>
<a href="#l31.69"></a><span id="l31.69">   nsresult rv;</span>
<a href="#l31.70"></a><span id="l31.70">   nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l31.71"></a><span id="l31.71">   rv = GetBaseStringBundle(getter_AddRefs(bundle));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -72,16 +72,17 @@</span>
<a href="#l32.4"></a><span id="l32.4"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l32.5"></a><span id="l32.5"> #include &quot;nsILoginInfo.h&quot;</span>
<a href="#l32.6"></a><span id="l32.6"> #include &quot;nsILoginManager.h&quot;</span>
<a href="#l32.7"></a><span id="l32.7"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l32.8"></a><span id="l32.8"> #include &quot;nsIMsgMdnGenerator.h&quot;</span>
<a href="#l32.9"></a><span id="l32.9"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l32.10"></a><span id="l32.10"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l32.11"></a><span id="l32.11"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l32.13"></a><span id="l32.13"> </span>
<a href="#l32.14"></a><span id="l32.14"> #define PORT_NOT_SET -1</span>
<a href="#l32.15"></a><span id="l32.15"> </span>
<a href="#l32.16"></a><span id="l32.16"> nsMsgIncomingServer::nsMsgIncomingServer():</span>
<a href="#l32.17"></a><span id="l32.17">     m_rootFolder(0),</span>
<a href="#l32.18"></a><span id="l32.18">     m_numMsgsDownloaded(0),</span>
<a href="#l32.19"></a><span id="l32.19">     m_biffState(nsIMsgFolder::nsMsgBiffState_Unknown),</span>
<a href="#l32.20"></a><span id="l32.20">     m_serverBusy(false),</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineat">@@ -1614,22 +1615,22 @@ nsMsgIncomingServer::SetOfflineSupportLe</span>
<a href="#l32.22"></a><span id="l32.22">   return NS_OK;</span>
<a href="#l32.23"></a><span id="l32.23"> }</span>
<a href="#l32.24"></a><span id="l32.24"> #define BASE_MSGS_URL       &quot;chrome://messenger/locale/messenger.properties&quot;</span>
<a href="#l32.25"></a><span id="l32.25"> </span>
<a href="#l32.26"></a><span id="l32.26"> NS_IMETHODIMP nsMsgIncomingServer::DisplayOfflineMsg(nsIMsgWindow *aMsgWindow)</span>
<a href="#l32.27"></a><span id="l32.27"> {</span>
<a href="#l32.28"></a><span id="l32.28">   NS_ENSURE_ARG_POINTER(aMsgWindow);</span>
<a href="#l32.29"></a><span id="l32.29"> </span>
<a href="#l32.30"></a><span id="l32.30" class="difflineminus">-  nsresult rv;</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l32.35"></a><span id="l32.35" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l32.36"></a><span id="l32.36"> </span>
<a href="#l32.37"></a><span id="l32.37">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineminus">-  rv = bundleService-&gt;CreateBundle(BASE_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineplus">+  nsresult rv = bundleService-&gt;CreateBundle(BASE_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l32.40"></a><span id="l32.40">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l32.41"></a><span id="l32.41">   if (bundle)</span>
<a href="#l32.42"></a><span id="l32.42">   {</span>
<a href="#l32.43"></a><span id="l32.43">     nsString errorMsgTitle;</span>
<a href="#l32.44"></a><span id="l32.44">     nsString errorMsgBody;</span>
<a href="#l32.45"></a><span id="l32.45">     bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;nocachedbodybody&quot;).get(), getter_Copies(errorMsgBody));</span>
<a href="#l32.46"></a><span id="l32.46">     bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;nocachedbodytitle&quot;).get(),  getter_Copies(errorMsgTitle));</span>
<a href="#l32.47"></a><span id="l32.47">     aMsgWindow-&gt;DisplayHTMLInMessagePane(errorMsgTitle, errorMsgBody, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -51,16 +51,17 @@</span>
<a href="#l33.4"></a><span id="l33.4"> #include &quot;nsIStreamListener.h&quot;</span>
<a href="#l33.5"></a><span id="l33.5"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l33.6"></a><span id="l33.6"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l33.7"></a><span id="l33.7"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l33.8"></a><span id="l33.8"> #include &quot;nsIFile.h&quot;</span>
<a href="#l33.9"></a><span id="l33.9"> #include &quot;prmem.h&quot;</span>
<a href="#l33.10"></a><span id="l33.10"> #include &lt;time.h&gt;</span>
<a href="#l33.11"></a><span id="l33.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l33.13"></a><span id="l33.13"> </span>
<a href="#l33.14"></a><span id="l33.14"> nsMsgMailNewsUrl::nsMsgMailNewsUrl()</span>
<a href="#l33.15"></a><span id="l33.15"> {</span>
<a href="#l33.16"></a><span id="l33.16">   // nsIURI specific state</span>
<a href="#l33.17"></a><span id="l33.17">   m_errorMessage = nsnull;</span>
<a href="#l33.18"></a><span id="l33.18">   m_runningUrl = false;</span>
<a href="#l33.19"></a><span id="l33.19">   m_updatingFolder = false;</span>
<a href="#l33.20"></a><span id="l33.20">   m_addContentToCache = false;</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineat">@@ -565,18 +566,19 @@ NS_IMETHODIMP nsMsgMailNewsUrl::SchemeIs</span>
<a href="#l33.22"></a><span id="l33.22"> {</span>
<a href="#l33.23"></a><span id="l33.23">   return m_baseURL-&gt;SchemeIs(aScheme, _retval);</span>
<a href="#l33.24"></a><span id="l33.24"> }</span>
<a href="#l33.25"></a><span id="l33.25"> </span>
<a href="#l33.26"></a><span id="l33.26"> NS_IMETHODIMP nsMsgMailNewsUrl::Clone(nsIURI **_retval)</span>
<a href="#l33.27"></a><span id="l33.27"> {</span>
<a href="#l33.28"></a><span id="l33.28">   nsresult rv;</span>
<a href="#l33.29"></a><span id="l33.29">   nsCAutoString urlSpec;</span>
<a href="#l33.30"></a><span id="l33.30" class="difflineminus">-  nsCOMPtr&lt;nsIIOService&gt; ioService = do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+  nsCOMPtr&lt;nsIIOService&gt; ioService =</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineplus">+    mozilla::services::GetIOService();</span>
<a href="#l33.34"></a><span id="l33.34" class="difflineplus">+  NS_ENSURE_TRUE(ioService, NS_ERROR_UNEXPECTED);</span>
<a href="#l33.35"></a><span id="l33.35">   rv = GetSpec(urlSpec);</span>
<a href="#l33.36"></a><span id="l33.36">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.37"></a><span id="l33.37">   rv = ioService-&gt;NewURI(urlSpec, nsnull, nsnull, _retval);</span>
<a href="#l33.38"></a><span id="l33.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.39"></a><span id="l33.39"> </span>
<a href="#l33.40"></a><span id="l33.40">   // add the msg window to the cloned url</span>
<a href="#l33.41"></a><span id="l33.41">   nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow(do_QueryReferent(m_msgWindowWeak));</span>
<a href="#l33.42"></a><span id="l33.42">   if (msgWindow)</span>
<a href="#l33.43"></a><span id="l33.43" class="difflineat">@@ -595,18 +597,19 @@ NS_IMETHODIMP nsMsgMailNewsUrl::Resolve(</span>
<a href="#l33.44"></a><span id="l33.44">   // everything else shouldn't be resolved against mailnews urls.</span>
<a href="#l33.45"></a><span id="l33.45">   nsresult rv = NS_OK;</span>
<a href="#l33.46"></a><span id="l33.46"> </span>
<a href="#l33.47"></a><span id="l33.47">   if (!relativePath.IsEmpty() &amp;&amp; relativePath.First() == '#') // an anchor</span>
<a href="#l33.48"></a><span id="l33.48">     return m_baseURL-&gt;Resolve(relativePath, result);</span>
<a href="#l33.49"></a><span id="l33.49">   else</span>
<a href="#l33.50"></a><span id="l33.50">   {</span>
<a href="#l33.51"></a><span id="l33.51">     // if relativePath is a complete url with it's own scheme then allow it...</span>
<a href="#l33.52"></a><span id="l33.52" class="difflineminus">-    nsCOMPtr&lt;nsIIOService&gt; ioService = do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l33.53"></a><span id="l33.53" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.54"></a><span id="l33.54" class="difflineplus">+    nsCOMPtr&lt;nsIIOService&gt; ioService =</span>
<a href="#l33.55"></a><span id="l33.55" class="difflineplus">+      mozilla::services::GetIOService();</span>
<a href="#l33.56"></a><span id="l33.56" class="difflineplus">+    NS_ENSURE_TRUE(ioService, NS_ERROR_UNEXPECTED);</span>
<a href="#l33.57"></a><span id="l33.57">     nsCAutoString scheme;</span>
<a href="#l33.58"></a><span id="l33.58"> </span>
<a href="#l33.59"></a><span id="l33.59">     rv = ioService-&gt;ExtractScheme(relativePath, scheme);</span>
<a href="#l33.60"></a><span id="l33.60">     // if we have a fully qualified scheme then pass the relative path back as the result</span>
<a href="#l33.61"></a><span id="l33.61">     if (NS_SUCCEEDED(rv) &amp;&amp; !scheme.IsEmpty())</span>
<a href="#l33.62"></a><span id="l33.62">     {</span>
<a href="#l33.63"></a><span id="l33.63">       result = relativePath;</span>
<a href="#l33.64"></a><span id="l33.64">       rv = NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -61,16 +61,17 @@</span>
<a href="#l34.4"></a><span id="l34.4"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l34.5"></a><span id="l34.5"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l34.6"></a><span id="l34.6"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l34.7"></a><span id="l34.7"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l34.8"></a><span id="l34.8"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l34.9"></a><span id="l34.9"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l34.10"></a><span id="l34.10"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l34.11"></a><span id="l34.11"> #include &quot;nsAlgorithm.h&quot;</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l34.13"></a><span id="l34.13"> </span>
<a href="#l34.14"></a><span id="l34.14"> using namespace mozilla;</span>
<a href="#l34.15"></a><span id="l34.15"> </span>
<a href="#l34.16"></a><span id="l34.16"> NS_IMPL_THREADSAFE_ADDREF(nsMsgProtocol)</span>
<a href="#l34.17"></a><span id="l34.17"> NS_IMPL_THREADSAFE_RELEASE(nsMsgProtocol)</span>
<a href="#l34.18"></a><span id="l34.18"> </span>
<a href="#l34.19"></a><span id="l34.19"> NS_INTERFACE_MAP_BEGIN(nsMsgProtocol)</span>
<a href="#l34.20"></a><span id="l34.20">    NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIChannel)</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineat">@@ -1565,18 +1566,18 @@ PRInt32 nsMsgAsyncWriteProtocol::SendDat</span>
<a href="#l34.22"></a><span id="l34.22"> PRUnichar *FormatStringWithHostNameByID(PRInt32 stringID, nsIMsgMailNewsUrl *msgUri)</span>
<a href="#l34.23"></a><span id="l34.23"> {</span>
<a href="#l34.24"></a><span id="l34.24">   if (!msgUri)</span>
<a href="#l34.25"></a><span id="l34.25">     return nsnull;</span>
<a href="#l34.26"></a><span id="l34.26"> </span>
<a href="#l34.27"></a><span id="l34.27">   nsresult rv;</span>
<a href="#l34.28"></a><span id="l34.28"> </span>
<a href="#l34.29"></a><span id="l34.29">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineminus">-          do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, nsnull);</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineplus">+  NS_ENSURE_TRUE(sBundleService, nsnull);</span>
<a href="#l34.34"></a><span id="l34.34"> </span>
<a href="#l34.35"></a><span id="l34.35">   nsCOMPtr&lt;nsIStringBundle&gt; sBundle;</span>
<a href="#l34.36"></a><span id="l34.36">   rv = sBundleService-&gt;CreateBundle(MSGS_URL, getter_AddRefs(sBundle));</span>
<a href="#l34.37"></a><span id="l34.37">   NS_ENSURE_SUCCESS(rv, nsnull);</span>
<a href="#l34.38"></a><span id="l34.38"> </span>
<a href="#l34.39"></a><span id="l34.39">   PRUnichar *ptrv = nsnull;</span>
<a href="#l34.40"></a><span id="l34.40">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l34.41"></a><span id="l34.41">   rv = msgUri-&gt;GetServer(getter_AddRefs(server));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -99,16 +99,17 @@</span>
<a href="#l35.4"></a><span id="l35.4"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l35.5"></a><span id="l35.5"> #include &quot;nsIPlatformCharset.h&quot;</span>
<a href="#l35.6"></a><span id="l35.6"> #include &quot;nsIParser.h&quot;</span>
<a href="#l35.7"></a><span id="l35.7"> #include &quot;nsParserCIID.h&quot;</span>
<a href="#l35.8"></a><span id="l35.8"> #include &quot;nsIHTMLToTextSink.h&quot;</span>
<a href="#l35.9"></a><span id="l35.9"> #include &quot;nsIContentSink.h&quot;</span>
<a href="#l35.10"></a><span id="l35.10"> #include &quot;nsICharsetConverterManager.h&quot;</span>
<a href="#l35.11"></a><span id="l35.11"> #include &quot;nsIDocumentEncoder.h&quot;</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l35.13"></a><span id="l35.13"> </span>
<a href="#l35.14"></a><span id="l35.14"> static NS_DEFINE_CID(kCParserCID, NS_PARSER_CID);</span>
<a href="#l35.15"></a><span id="l35.15"> static NS_DEFINE_CID(kImapUrlCID, NS_IMAPURL_CID);</span>
<a href="#l35.16"></a><span id="l35.16"> static NS_DEFINE_CID(kCMailboxUrl, NS_MAILBOXURL_CID);</span>
<a href="#l35.17"></a><span id="l35.17"> static NS_DEFINE_CID(kCNntpUrlCID, NS_NNTPURL_CID);</span>
<a href="#l35.18"></a><span id="l35.18"> </span>
<a href="#l35.19"></a><span id="l35.19"> #define ILLEGAL_FOLDER_CHARS &quot;;#&quot;</span>
<a href="#l35.20"></a><span id="l35.20"> #define ILLEGAL_FOLDER_CHARS_AS_FIRST_LETTER &quot;.&quot;</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineat">@@ -512,18 +513,18 @@ nsresult FormatFileSize(PRUint64 size, b</span>
<a href="#l35.22"></a><span id="l35.22"> </span>
<a href="#l35.23"></a><span id="l35.23">   const PRUnichar *sizeAbbrNames[] = {</span>
<a href="#l35.24"></a><span id="l35.24">     byteAbbr.get(), kbAbbr.get(), mbAbbr.get(), gbAbbr.get()</span>
<a href="#l35.25"></a><span id="l35.25">   };</span>
<a href="#l35.26"></a><span id="l35.26"> </span>
<a href="#l35.27"></a><span id="l35.27">   nsresult rv;</span>
<a href="#l35.28"></a><span id="l35.28"> </span>
<a href="#l35.29"></a><span id="l35.29">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleSvc =</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineminus">-    do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+  NS_ENSURE_TRUE(bundleSvc, NS_ERROR_UNEXPECTED);</span>
<a href="#l35.34"></a><span id="l35.34"> </span>
<a href="#l35.35"></a><span id="l35.35">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l35.36"></a><span id="l35.36">   rv = bundleSvc-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l35.37"></a><span id="l35.37">                                getter_AddRefs(bundle));</span>
<a href="#l35.38"></a><span id="l35.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l35.39"></a><span id="l35.39"> </span>
<a href="#l35.40"></a><span id="l35.40">   float unitSize = size;</span>
<a href="#l35.41"></a><span id="l35.41">   PRUint32 unitIndex = 0;</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineat">@@ -816,21 +817,21 @@ nsresult NS_MsgDecodeUnescapeURLPath(con</span>
<a href="#l35.43"></a><span id="l35.43">   MsgUnescapeString(aPath, nsINetUtil::ESCAPE_URL_FILE_BASENAME |</span>
<a href="#l35.44"></a><span id="l35.44">                  nsINetUtil::ESCAPE_URL_FORCED, unescapedName);</span>
<a href="#l35.45"></a><span id="l35.45">   CopyUTF8toUTF16(unescapedName, aResult);</span>
<a href="#l35.46"></a><span id="l35.46">   return NS_OK;</span>
<a href="#l35.47"></a><span id="l35.47"> }</span>
<a href="#l35.48"></a><span id="l35.48"> </span>
<a href="#l35.49"></a><span id="l35.49"> bool WeAreOffline()</span>
<a href="#l35.50"></a><span id="l35.50"> {</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l35.52"></a><span id="l35.52">   bool offline = false;</span>
<a href="#l35.53"></a><span id="l35.53"> </span>
<a href="#l35.54"></a><span id="l35.54" class="difflineminus">-  nsCOMPtr &lt;nsIIOService&gt; ioService = do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; ioService)</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineplus">+  nsCOMPtr &lt;nsIIOService&gt; ioService =</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineplus">+    mozilla::services::GetIOService();</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineplus">+  if (ioService)</span>
<a href="#l35.59"></a><span id="l35.59">     ioService-&gt;GetOffline(&amp;offline);</span>
<a href="#l35.60"></a><span id="l35.60"> </span>
<a href="#l35.61"></a><span id="l35.61">   return offline;</span>
<a href="#l35.62"></a><span id="l35.62"> }</span>
<a href="#l35.63"></a><span id="l35.63"> </span>
<a href="#l35.64"></a><span id="l35.64"> nsresult GetExistingFolder(const nsCString&amp; aFolderURI, nsIMsgFolder **aFolder)</span>
<a href="#l35.65"></a><span id="l35.65"> {</span>
<a href="#l35.66"></a><span id="l35.66">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l35.67"></a><span id="l35.67" class="difflineat">@@ -2089,18 +2090,18 @@ NS_MSG_BASE nsresult MsgPromptLoginFaile</span>
<a href="#l35.68"></a><span id="l35.68">       do_GetService(NS_WINDOWWATCHER_CONTRACTID, &amp;rv);</span>
<a href="#l35.69"></a><span id="l35.69">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l35.70"></a><span id="l35.70"> </span>
<a href="#l35.71"></a><span id="l35.71">     rv = wwatch-&gt;GetNewPrompter(0, getter_AddRefs(dialog));</span>
<a href="#l35.72"></a><span id="l35.72">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l35.73"></a><span id="l35.73">   }</span>
<a href="#l35.74"></a><span id="l35.74"> </span>
<a href="#l35.75"></a><span id="l35.75">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleSvc =</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineminus">-    do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l35.77"></a><span id="l35.77" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l35.78"></a><span id="l35.78" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l35.79"></a><span id="l35.79" class="difflineplus">+  NS_ENSURE_TRUE(bundleSvc, NS_ERROR_UNEXPECTED);</span>
<a href="#l35.80"></a><span id="l35.80"> </span>
<a href="#l35.81"></a><span id="l35.81">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l35.82"></a><span id="l35.82">   rv = bundleSvc-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l35.83"></a><span id="l35.83">                                getter_AddRefs(bundle));</span>
<a href="#l35.84"></a><span id="l35.84">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l35.85"></a><span id="l35.85"> </span>
<a href="#l35.86"></a><span id="l35.86">   nsString message;</span>
<a href="#l35.87"></a><span id="l35.87">   NS_ConvertUTF8toUTF16 hostNameUTF16(aHostname);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -60,16 +60,17 @@</span>
<a href="#l36.4"></a><span id="l36.4"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l36.5"></a><span id="l36.5"> #include &quot;nsIMimeStreamConverter.h&quot;</span>
<a href="#l36.6"></a><span id="l36.6"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l36.7"></a><span id="l36.7"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l36.8"></a><span id="l36.8"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l36.9"></a><span id="l36.9"> #include &quot;nsComposeStrings.h&quot;</span>
<a href="#l36.10"></a><span id="l36.10"> #include &quot;nsIZipWriter.h&quot;</span>
<a href="#l36.11"></a><span id="l36.11"> #include &quot;nsIDirectoryEnumerator.h&quot;</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l36.13"></a><span id="l36.13"> </span>
<a href="#l36.14"></a><span id="l36.14"> ///////////////////////////////////////////////////////////////////////////</span>
<a href="#l36.15"></a><span id="l36.15"> // Mac Specific Attachment Handling for AppleDouble Encoded Files</span>
<a href="#l36.16"></a><span id="l36.16"> ///////////////////////////////////////////////////////////////////////////</span>
<a href="#l36.17"></a><span id="l36.17"> #ifdef XP_MACOSX</span>
<a href="#l36.18"></a><span id="l36.18"> </span>
<a href="#l36.19"></a><span id="l36.19"> #define AD_WORKING_BUFF_SIZE                  8192</span>
<a href="#l36.20"></a><span id="l36.20"> </span>
<a href="#l36.21"></a><span id="l36.21" class="difflineat">@@ -1051,18 +1052,19 @@ nsMsgAttachmentHandler::UrlExit(nsresult</span>
<a href="#l36.22"></a><span id="l36.22">     // At this point, we should probably ask a question to the user</span>
<a href="#l36.23"></a><span id="l36.23">     // if we should continue without this attachment.</span>
<a href="#l36.24"></a><span id="l36.24">     //</span>
<a href="#l36.25"></a><span id="l36.25">     bool              keepOnGoing = true;</span>
<a href="#l36.26"></a><span id="l36.26">     nsCString    turl;</span>
<a href="#l36.27"></a><span id="l36.27">     nsString     msg;</span>
<a href="#l36.28"></a><span id="l36.28">     PRUnichar         *printfString = nsnull;</span>
<a href="#l36.29"></a><span id="l36.29">     nsresult rv;</span>
<a href="#l36.30"></a><span id="l36.30" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l36.34"></a><span id="l36.34" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l36.35"></a><span id="l36.35">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l36.36"></a><span id="l36.36">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l36.37"></a><span id="l36.37">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l36.38"></a><span id="l36.38">     nsMsgDeliverMode mode = nsIMsgSend::nsMsgDeliverNow;</span>
<a href="#l36.39"></a><span id="l36.39">     m_mime_delivery_state-&gt;GetDeliveryMode(&amp;mode);</span>
<a href="#l36.40"></a><span id="l36.40">     if (mode == nsIMsgSend::nsMsgSaveAsDraft || mode == nsIMsgSend::nsMsgSaveAsTemplate)</span>
<a href="#l36.41"></a><span id="l36.41">       bundle-&gt;GetStringFromID(NS_MSG_FAILURE_ON_OBJ_EMBED_WHILE_SAVING, getter_Copies(msg));</span>
<a href="#l36.42"></a><span id="l36.42">     else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -58,16 +58,17 @@</span>
<a href="#l37.4"></a><span id="l37.4"> #include &quot;nsComposeStrings.h&quot;</span>
<a href="#l37.5"></a><span id="l37.5"> #include &quot;nsIMsgCompUtils.h&quot;</span>
<a href="#l37.6"></a><span id="l37.6"> #include &quot;nsIMsgMdnGenerator.h&quot;</span>
<a href="#l37.7"></a><span id="l37.7"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l37.8"></a><span id="l37.8"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l37.9"></a><span id="l37.9"> #include &quot;nsMemory.h&quot;</span>
<a href="#l37.10"></a><span id="l37.10"> #include &quot;nsCRTGlue.h&quot;</span>
<a href="#l37.11"></a><span id="l37.11"> #include &lt;ctype.h&gt;</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l37.13"></a><span id="l37.13"> </span>
<a href="#l37.14"></a><span id="l37.14"> NS_IMPL_ISUPPORTS1(nsMsgCompUtils, nsIMsgCompUtils)</span>
<a href="#l37.15"></a><span id="l37.15"> </span>
<a href="#l37.16"></a><span id="l37.16"> nsMsgCompUtils::nsMsgCompUtils()</span>
<a href="#l37.17"></a><span id="l37.17"> {</span>
<a href="#l37.18"></a><span id="l37.18"> }</span>
<a href="#l37.19"></a><span id="l37.19"> </span>
<a href="#l37.20"></a><span id="l37.20"> nsMsgCompUtils::~nsMsgCompUtils()</span>
<a href="#l37.21"></a><span id="l37.21" class="difflineat">@@ -624,18 +625,19 @@ mime_generate_headers (nsMsgCompFields *</span>
<a href="#l37.22"></a><span id="l37.22">   {</span>
<a href="#l37.23"></a><span id="l37.23">     bool bAddUndisclosedRecipients = true;</span>
<a href="#l37.24"></a><span id="l37.24">     prefs-&gt;GetBoolPref(&quot;mail.compose.add_undisclosed_recipients&quot;, &amp;bAddUndisclosedRecipients);</span>
<a href="#l37.25"></a><span id="l37.25">     if (bAddUndisclosedRecipients)</span>
<a href="#l37.26"></a><span id="l37.26">     {</span>
<a href="#l37.27"></a><span id="l37.27">       const char* pBcc = fields-&gt;GetBcc(); //Do not free me!</span>
<a href="#l37.28"></a><span id="l37.28">       if (pBcc &amp;&amp; *pBcc)</span>
<a href="#l37.29"></a><span id="l37.29">       {</span>
<a href="#l37.30"></a><span id="l37.30" class="difflineminus">-        nsCOMPtr&lt;nsIStringBundleService&gt; stringService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineplus">+        nsCOMPtr&lt;nsIStringBundleService&gt; stringService =</span>
<a href="#l37.33"></a><span id="l37.33" class="difflineplus">+          mozilla::services::GetStringBundleService();</span>
<a href="#l37.34"></a><span id="l37.34" class="difflineplus">+        if (stringService)</span>
<a href="#l37.35"></a><span id="l37.35">         {</span>
<a href="#l37.36"></a><span id="l37.36">           nsCOMPtr&lt;nsIStringBundle&gt; composeStringBundle;</span>
<a href="#l37.37"></a><span id="l37.37">           rv = stringService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(composeStringBundle));</span>
<a href="#l37.38"></a><span id="l37.38">           if (NS_SUCCEEDED(rv))</span>
<a href="#l37.39"></a><span id="l37.39">           {</span>
<a href="#l37.40"></a><span id="l37.40">             nsString undisclosedRecipients;</span>
<a href="#l37.41"></a><span id="l37.41">             rv = composeStringBundle-&gt;GetStringFromID(NS_MSG_UNDISCLOSED_RECIPIENTS, getter_Copies(undisclosedRecipients));</span>
<a href="#l37.42"></a><span id="l37.42">             if (NS_SUCCEEDED(rv) &amp;&amp; !undisclosedRecipients.IsEmpty())</span>
<a href="#l37.43"></a><span id="l37.43" class="difflineat">@@ -1734,29 +1736,28 @@ msg_pick_real_name (nsMsgAttachmentHandl</span>
<a href="#l37.44"></a><span id="l37.44"> </span>
<a href="#l37.45"></a><span id="l37.45"> // Utility to create a nsIURI object...</span>
<a href="#l37.46"></a><span id="l37.46"> nsresult</span>
<a href="#l37.47"></a><span id="l37.47"> nsMsgNewURL(nsIURI** aInstancePtrResult, const char * aSpec)</span>
<a href="#l37.48"></a><span id="l37.48"> {</span>
<a href="#l37.49"></a><span id="l37.49">   nsresult rv = NS_OK;</span>
<a href="#l37.50"></a><span id="l37.50">   if (nsnull == aInstancePtrResult)</span>
<a href="#l37.51"></a><span id="l37.51">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l37.52"></a><span id="l37.52" class="difflineminus">-  nsCOMPtr&lt;nsIIOService&gt; pNetService(do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; pNetService)</span>
<a href="#l37.54"></a><span id="l37.54" class="difflineplus">+  nsCOMPtr&lt;nsIIOService&gt; pNetService =</span>
<a href="#l37.55"></a><span id="l37.55" class="difflineplus">+    mozilla::services::GetIOService();</span>
<a href="#l37.56"></a><span id="l37.56" class="difflineplus">+  NS_ENSURE_TRUE(pNetService, NS_ERROR_UNEXPECTED);</span>
<a href="#l37.57"></a><span id="l37.57" class="difflineplus">+  if (PL_strstr(aSpec, &quot;://&quot;) == nsnull &amp;&amp; strncmp(aSpec, &quot;data:&quot;, 5))</span>
<a href="#l37.58"></a><span id="l37.58">   {</span>
<a href="#l37.59"></a><span id="l37.59" class="difflineminus">-    if (PL_strstr(aSpec, &quot;://&quot;) == nsnull &amp;&amp; strncmp(aSpec, &quot;data:&quot;, 5))</span>
<a href="#l37.60"></a><span id="l37.60" class="difflineminus">-    {</span>
<a href="#l37.61"></a><span id="l37.61" class="difflineminus">-      //XXXjag Temporary fix for bug 139362 until the real problem(bug 70083) get fixed</span>
<a href="#l37.62"></a><span id="l37.62" class="difflineminus">-      nsCAutoString uri(NS_LITERAL_CSTRING(&quot;http://&quot;));</span>
<a href="#l37.63"></a><span id="l37.63" class="difflineminus">-      uri.Append(aSpec);</span>
<a href="#l37.64"></a><span id="l37.64" class="difflineminus">-      rv = pNetService-&gt;NewURI(uri, nsnull, nsnull, aInstancePtrResult);</span>
<a href="#l37.65"></a><span id="l37.65" class="difflineminus">-    }</span>
<a href="#l37.66"></a><span id="l37.66" class="difflineminus">-    else</span>
<a href="#l37.67"></a><span id="l37.67" class="difflineminus">-      rv = pNetService-&gt;NewURI(nsDependentCString(aSpec), nsnull, nsnull, aInstancePtrResult);</span>
<a href="#l37.68"></a><span id="l37.68" class="difflineplus">+    //XXXjag Temporary fix for bug 139362 until the real problem(bug 70083) get fixed</span>
<a href="#l37.69"></a><span id="l37.69" class="difflineplus">+    nsCAutoString uri(NS_LITERAL_CSTRING(&quot;http://&quot;));</span>
<a href="#l37.70"></a><span id="l37.70" class="difflineplus">+    uri.Append(aSpec);</span>
<a href="#l37.71"></a><span id="l37.71" class="difflineplus">+    rv = pNetService-&gt;NewURI(uri, nsnull, nsnull, aInstancePtrResult);</span>
<a href="#l37.72"></a><span id="l37.72">   }</span>
<a href="#l37.73"></a><span id="l37.73" class="difflineplus">+  else</span>
<a href="#l37.74"></a><span id="l37.74" class="difflineplus">+    rv = pNetService-&gt;NewURI(nsDependentCString(aSpec), nsnull, nsnull, aInstancePtrResult);</span>
<a href="#l37.75"></a><span id="l37.75">   return rv;</span>
<a href="#l37.76"></a><span id="l37.76"> }</span>
<a href="#l37.77"></a><span id="l37.77"> </span>
<a href="#l37.78"></a><span id="l37.78"> bool</span>
<a href="#l37.79"></a><span id="l37.79"> nsMsgIsLocalFile(const char *url)</span>
<a href="#l37.80"></a><span id="l37.80"> {</span>
<a href="#l37.81"></a><span id="l37.81">   /*</span>
<a href="#l37.82"></a><span id="l37.82">     A url is considered as a local file if it's start with file://</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -109,16 +109,17 @@</span>
<a href="#l38.4"></a><span id="l38.4"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l38.5"></a><span id="l38.5"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l38.6"></a><span id="l38.6"> #include &quot;nsStringStream.h&quot;</span>
<a href="#l38.7"></a><span id="l38.7"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l38.8"></a><span id="l38.8"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l38.9"></a><span id="l38.9"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l38.10"></a><span id="l38.10"> #include &quot;nsITextToSubURI.h&quot;</span>
<a href="#l38.11"></a><span id="l38.11"> #include &quot;nsIAbManager.h&quot;</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l38.13"></a><span id="l38.13"> </span>
<a href="#l38.14"></a><span id="l38.14"> static void GetReplyHeaderInfo(PRInt32* reply_header_type,</span>
<a href="#l38.15"></a><span id="l38.15">                                nsString&amp; reply_header_locale,</span>
<a href="#l38.16"></a><span id="l38.16">                                nsString&amp; reply_header_authorwrote,</span>
<a href="#l38.17"></a><span id="l38.17">                                nsString&amp; reply_header_ondate,</span>
<a href="#l38.18"></a><span id="l38.18">                                nsString&amp; reply_header_separator,</span>
<a href="#l38.19"></a><span id="l38.19">                                nsString&amp; reply_header_colon,</span>
<a href="#l38.20"></a><span id="l38.20">                                nsString&amp; reply_header_originalmessage)</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineat">@@ -2103,18 +2104,19 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l38.22"></a><span id="l38.22">               bool addExtension = true;</span>
<a href="#l38.23"></a><span id="l38.23">               nsString sanitizedSubj;</span>
<a href="#l38.24"></a><span id="l38.24">               prefs-&gt;GetBoolPref(&quot;mail.forward_add_extension&quot;, &amp;addExtension);</span>
<a href="#l38.25"></a><span id="l38.25"> </span>
<a href="#l38.26"></a><span id="l38.26">               // copy subject string to sanitizedSubj, use default if empty</span>
<a href="#l38.27"></a><span id="l38.27">               if (subject.IsEmpty())</span>
<a href="#l38.28"></a><span id="l38.28">               {</span>
<a href="#l38.29"></a><span id="l38.29">                 nsresult rv;</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineminus">-                nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-                NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+                nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineplus">+                  mozilla::services::GetStringBundleService();</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineplus">+                NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l38.35"></a><span id="l38.35">                 nsCOMPtr&lt;nsIStringBundle&gt; composeBundle;</span>
<a href="#l38.36"></a><span id="l38.36">                 rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;,</span>
<a href="#l38.37"></a><span id="l38.37">                                                  getter_AddRefs(composeBundle));</span>
<a href="#l38.38"></a><span id="l38.38">                 NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l38.39"></a><span id="l38.39">                 composeBundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;messageAttachmentSafeName&quot;).get(),</span>
<a href="#l38.40"></a><span id="l38.40">                                                  getter_Copies(sanitizedSubj));</span>
<a href="#l38.41"></a><span id="l38.41">               }</span>
<a href="#l38.42"></a><span id="l38.42">               else</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineat">@@ -3901,18 +3903,19 @@ NS_IMETHODIMP nsMsgComposeSendListener::</span>
<a href="#l38.44"></a><span id="l38.44">         // Unregister ourself from msg compose progress</span>
<a href="#l38.45"></a><span id="l38.45">         progress-&gt;UnregisterListener(this);</span>
<a href="#l38.46"></a><span id="l38.46"> </span>
<a href="#l38.47"></a><span id="l38.47">         bool bCanceled = false;</span>
<a href="#l38.48"></a><span id="l38.48">         progress-&gt;GetProcessCanceledByUser(&amp;bCanceled);</span>
<a href="#l38.49"></a><span id="l38.49">         if (bCanceled)</span>
<a href="#l38.50"></a><span id="l38.50">         {</span>
<a href="#l38.51"></a><span id="l38.51">           nsresult rv;</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineminus">-          nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineminus">-          NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l38.54"></a><span id="l38.54" class="difflineplus">+          nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l38.55"></a><span id="l38.55" class="difflineplus">+            mozilla::services::GetStringBundleService();</span>
<a href="#l38.56"></a><span id="l38.56" class="difflineplus">+          NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l38.57"></a><span id="l38.57">           nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l38.58"></a><span id="l38.58">           rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l38.59"></a><span id="l38.59">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l38.60"></a><span id="l38.60">           nsString msg;</span>
<a href="#l38.61"></a><span id="l38.61">           bundle-&gt;GetStringFromID(NS_ERROR_GET_CODE(NS_MSG_CANCELLING), getter_Copies(msg));</span>
<a href="#l38.62"></a><span id="l38.62">           progress-&gt;OnStatusChange(nsnull, nsnull, 0, msg.get());</span>
<a href="#l38.63"></a><span id="l38.63">         }</span>
<a href="#l38.64"></a><span id="l38.64">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -83,16 +83,17 @@</span>
<a href="#l39.4"></a><span id="l39.4"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l39.5"></a><span id="l39.5"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l39.6"></a><span id="l39.6"> #include &quot;nsIDocumentEncoder.h&quot;</span>
<a href="#l39.7"></a><span id="l39.7"> #include &quot;nsContentCID.h&quot;</span>
<a href="#l39.8"></a><span id="l39.8"> #include &quot;nsISelection.h&quot;</span>
<a href="#l39.9"></a><span id="l39.9"> #include &quot;nsUTF8Utils.h&quot;</span>
<a href="#l39.10"></a><span id="l39.10"> #include &quot;nsILineBreaker.h&quot;</span>
<a href="#l39.11"></a><span id="l39.11"> #include &quot;nsLWBrkCIID.h&quot;</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l39.13"></a><span id="l39.13"> </span>
<a href="#l39.14"></a><span id="l39.14"> #ifdef MSGCOMP_TRACE_PERFORMANCE</span>
<a href="#l39.15"></a><span id="l39.15"> #include &quot;prlog.h&quot;</span>
<a href="#l39.16"></a><span id="l39.16"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l39.17"></a><span id="l39.17"> #include &quot;nsIMsgMessageService.h&quot;</span>
<a href="#l39.18"></a><span id="l39.18"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l39.19"></a><span id="l39.19"> #endif</span>
<a href="#l39.20"></a><span id="l39.20"> </span>
<a href="#l39.21"></a><span id="l39.21" class="difflineat">@@ -186,18 +187,19 @@ nsMsgComposeService::~nsMsgComposeServic</span>
<a href="#l39.22"></a><span id="l39.22"> }</span>
<a href="#l39.23"></a><span id="l39.23"> </span>
<a href="#l39.24"></a><span id="l39.24"> nsresult nsMsgComposeService::Init()</span>
<a href="#l39.25"></a><span id="l39.25"> {</span>
<a href="#l39.26"></a><span id="l39.26">   nsresult rv = NS_OK;</span>
<a href="#l39.27"></a><span id="l39.27">   // Register observers</span>
<a href="#l39.28"></a><span id="l39.28"> </span>
<a href="#l39.29"></a><span id="l39.29">   // Register for quit application and profile change, we will need to clear the cache.</span>
<a href="#l39.30"></a><span id="l39.30" class="difflineminus">-  nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineplus">+  nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l39.33"></a><span id="l39.33" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l39.34"></a><span id="l39.34" class="difflineplus">+  if (observerService)</span>
<a href="#l39.35"></a><span id="l39.35">   {</span>
<a href="#l39.36"></a><span id="l39.36">     rv = observerService-&gt;AddObserver(this, &quot;quit-application&quot;, true);</span>
<a href="#l39.37"></a><span id="l39.37">     rv = observerService-&gt;AddObserver(this, &quot;profile-do-change&quot;, true);</span>
<a href="#l39.38"></a><span id="l39.38">   }</span>
<a href="#l39.39"></a><span id="l39.39"> </span>
<a href="#l39.40"></a><span id="l39.40">   // Register some pref observer</span>
<a href="#l39.41"></a><span id="l39.41">   nsCOMPtr&lt;nsIPrefBranch2&gt; pbi = do_GetService(NS_PREFSERVICE_CONTRACTID);</span>
<a href="#l39.42"></a><span id="l39.42">   if (pbi)</span>
<a href="#l39.43"></a><span id="l39.43" class="difflineat">@@ -1295,19 +1297,19 @@ nsMsgComposeService::ForwardMessage(cons</span>
<a href="#l39.44"></a><span id="l39.44">   // Therefore, let's just mark it here instead.</span>
<a href="#l39.45"></a><span id="l39.45">   return folder-&gt;AddMessageDispositionState(aMsgHdr, nsIMsgFolder::nsMsgDispositionState_Forwarded);</span>
<a href="#l39.46"></a><span id="l39.46"> }</span>
<a href="#l39.47"></a><span id="l39.47"> </span>
<a href="#l39.48"></a><span id="l39.48"> nsresult nsMsgComposeService::ShowCachedComposeWindow(nsIDOMWindow *aComposeWindow, bool aShow)</span>
<a href="#l39.49"></a><span id="l39.49"> {</span>
<a href="#l39.50"></a><span id="l39.50">   nsresult rv = NS_OK;</span>
<a href="#l39.51"></a><span id="l39.51"> </span>
<a href="#l39.52"></a><span id="l39.52" class="difflineminus">-  nsCOMPtr&lt;nsIObserverService&gt; obs</span>
<a href="#l39.53"></a><span id="l39.53" class="difflineminus">-    (do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv));</span>
<a href="#l39.54"></a><span id="l39.54" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l39.55"></a><span id="l39.55" class="difflineplus">+  nsCOMPtr&lt;nsIObserverService&gt; obs =</span>
<a href="#l39.56"></a><span id="l39.56" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l39.57"></a><span id="l39.57" class="difflineplus">+  NS_ENSURE_TRUE(obs, NS_ERROR_UNEXPECTED);</span>
<a href="#l39.58"></a><span id="l39.58"> </span>
<a href="#l39.59"></a><span id="l39.59">   nsCOMPtr &lt;nsPIDOMWindow&gt; window = do_QueryInterface(aComposeWindow, &amp;rv);</span>
<a href="#l39.60"></a><span id="l39.60"> </span>
<a href="#l39.61"></a><span id="l39.61">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l39.62"></a><span id="l39.62"> </span>
<a href="#l39.63"></a><span id="l39.63">   nsIDocShell *docShell = window-&gt;GetDocShell();</span>
<a href="#l39.64"></a><span id="l39.64"> </span>
<a href="#l39.65"></a><span id="l39.65">   nsCOMPtr &lt;nsIDocShellTreeItem&gt; treeItem = do_QueryInterface(docShell, &amp;rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgPrompts.cpp</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgPrompts.cpp</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -39,40 +39,43 @@</span>
<a href="#l40.4"></a><span id="l40.4"> #include &quot;nsMsgCopy.h&quot;</span>
<a href="#l40.5"></a><span id="l40.5"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l40.6"></a><span id="l40.6"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l40.7"></a><span id="l40.7"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l40.8"></a><span id="l40.8"> #include &quot;nsComposeStrings.h&quot;</span>
<a href="#l40.9"></a><span id="l40.9"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l40.10"></a><span id="l40.10"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l40.11"></a><span id="l40.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l40.13"></a><span id="l40.13"> </span>
<a href="#l40.14"></a><span id="l40.14"> nsresult</span>
<a href="#l40.15"></a><span id="l40.15"> nsMsgGetMessageByID(PRInt32 aMsgID, nsString&amp; aResult)</span>
<a href="#l40.16"></a><span id="l40.16"> {</span>
<a href="#l40.17"></a><span id="l40.17">   nsresult rv;</span>
<a href="#l40.18"></a><span id="l40.18" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l40.19"></a><span id="l40.19" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.20"></a><span id="l40.20" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l40.21"></a><span id="l40.21" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l40.23"></a><span id="l40.23"> </span>
<a href="#l40.24"></a><span id="l40.24">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l40.25"></a><span id="l40.25">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l40.26"></a><span id="l40.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.27"></a><span id="l40.27"> </span>
<a href="#l40.28"></a><span id="l40.28">   if (NS_IS_MSG_ERROR(aMsgID))</span>
<a href="#l40.29"></a><span id="l40.29">     aMsgID = NS_ERROR_GET_CODE(aMsgID);</span>
<a href="#l40.30"></a><span id="l40.30"> </span>
<a href="#l40.31"></a><span id="l40.31">   return bundle-&gt;GetStringFromID(aMsgID, getter_Copies(aResult));</span>
<a href="#l40.32"></a><span id="l40.32"> }</span>
<a href="#l40.33"></a><span id="l40.33"> </span>
<a href="#l40.34"></a><span id="l40.34"> static nsresult</span>
<a href="#l40.35"></a><span id="l40.35"> nsMsgBuildMessageByName(const PRUnichar *aName, nsIFile *aFile, nsString&amp; aResult)</span>
<a href="#l40.36"></a><span id="l40.36"> {</span>
<a href="#l40.37"></a><span id="l40.37">   nsresult rv;</span>
<a href="#l40.38"></a><span id="l40.38" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l40.39"></a><span id="l40.39" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.40"></a><span id="l40.40" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l40.42"></a><span id="l40.42" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l40.43"></a><span id="l40.43"> </span>
<a href="#l40.44"></a><span id="l40.44">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l40.45"></a><span id="l40.45">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l40.46"></a><span id="l40.46">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.47"></a><span id="l40.47"> </span>
<a href="#l40.48"></a><span id="l40.48">   nsString path;</span>
<a href="#l40.49"></a><span id="l40.49">   aFile-&gt;GetPath(path);</span>
<a href="#l40.50"></a><span id="l40.50"> </span>
<a href="#l40.51"></a><span id="l40.51" class="difflineat">@@ -91,18 +94,19 @@ nsMsgBuildMessageWithTmpFile(nsIFile *aF</span>
<a href="#l40.52"></a><span id="l40.52"> {</span>
<a href="#l40.53"></a><span id="l40.53">   return nsMsgBuildMessageByName(NS_LITERAL_STRING(&quot;unableToOpenTmpFile&quot;).get(), aFile, aResult);</span>
<a href="#l40.54"></a><span id="l40.54"> }</span>
<a href="#l40.55"></a><span id="l40.55"> </span>
<a href="#l40.56"></a><span id="l40.56"> nsresult</span>
<a href="#l40.57"></a><span id="l40.57"> nsMsgDisplayMessageByID(nsIPrompt * aPrompt, PRInt32 msgID, const PRUnichar * windowTitle)</span>
<a href="#l40.58"></a><span id="l40.58"> {</span>
<a href="#l40.59"></a><span id="l40.59">   nsresult rv;</span>
<a href="#l40.60"></a><span id="l40.60" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l40.61"></a><span id="l40.61" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.62"></a><span id="l40.62" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l40.63"></a><span id="l40.63" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l40.64"></a><span id="l40.64" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l40.65"></a><span id="l40.65">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l40.66"></a><span id="l40.66">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l40.67"></a><span id="l40.67">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.68"></a><span id="l40.68"> </span>
<a href="#l40.69"></a><span id="l40.69">   nsString msg;</span>
<a href="#l40.70"></a><span id="l40.70">   bundle-&gt;GetStringFromID(NS_IS_MSG_ERROR(msgID) ? NS_ERROR_GET_CODE(msgID) : msgID, getter_Copies(msg));</span>
<a href="#l40.71"></a><span id="l40.71">   return nsMsgDisplayMessageByString(aPrompt, msg.get(), windowTitle);</span>
<a href="#l40.72"></a><span id="l40.72"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgQuote.cpp</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgQuote.cpp</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -51,16 +51,17 @@</span>
<a href="#l41.4"></a><span id="l41.4"> #include &quot;nsMsgCompUtils.h&quot;</span>
<a href="#l41.5"></a><span id="l41.5"> #include &quot;nsIMsgMessageService.h&quot;</span>
<a href="#l41.6"></a><span id="l41.6"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l41.7"></a><span id="l41.7"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l41.8"></a><span id="l41.8"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l41.9"></a><span id="l41.9"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l41.10"></a><span id="l41.10"> #include &quot;nsMsgCompose.h&quot;</span>
<a href="#l41.11"></a><span id="l41.11"> #include &quot;nsMsgMailNewsUrl.h&quot;</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l41.13"></a><span id="l41.13"> </span>
<a href="#l41.14"></a><span id="l41.14"> NS_IMPL_THREADSAFE_ADDREF(nsMsgQuoteListener)</span>
<a href="#l41.15"></a><span id="l41.15"> NS_IMPL_THREADSAFE_RELEASE(nsMsgQuoteListener)</span>
<a href="#l41.16"></a><span id="l41.16"> </span>
<a href="#l41.17"></a><span id="l41.17"> NS_INTERFACE_MAP_BEGIN(nsMsgQuoteListener)</span>
<a href="#l41.18"></a><span id="l41.18">    NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIMsgQuoteListener)</span>
<a href="#l41.19"></a><span id="l41.19">    NS_INTERFACE_MAP_ENTRY(nsIMimeStreamConverterListener)</span>
<a href="#l41.20"></a><span id="l41.20">    NS_INTERFACE_MAP_ENTRY(nsIMsgQuoteListener)</span>
<a href="#l41.21"></a><span id="l41.21" class="difflineat">@@ -213,18 +214,19 @@ nsMsgQuote::QuoteMessage(const char *msg</span>
<a href="#l41.22"></a><span id="l41.22">   // funky magic go get the isupports for this class which inherits from multiple interfaces.</span>
<a href="#l41.23"></a><span id="l41.23">   nsISupports * supports;</span>
<a href="#l41.24"></a><span id="l41.24">   QueryInterface(NS_GET_IID(nsISupports), (void **) &amp;supports);</span>
<a href="#l41.25"></a><span id="l41.25">   nsCOMPtr&lt;nsISupports&gt; quoteSupport = supports;</span>
<a href="#l41.26"></a><span id="l41.26">   NS_IF_RELEASE(supports);</span>
<a href="#l41.27"></a><span id="l41.27"> </span>
<a href="#l41.28"></a><span id="l41.28">   // now we want to create a necko channel for this url and we want to open it</span>
<a href="#l41.29"></a><span id="l41.29">   mQuoteChannel = nsnull;</span>
<a href="#l41.30"></a><span id="l41.30" class="difflineminus">-  nsCOMPtr&lt;nsIIOService&gt; netService(do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineplus">+  nsCOMPtr&lt;nsIIOService&gt; netService =</span>
<a href="#l41.33"></a><span id="l41.33" class="difflineplus">+    mozilla::services::GetIOService();</span>
<a href="#l41.34"></a><span id="l41.34" class="difflineplus">+  NS_ENSURE_TRUE(netService, NS_ERROR_UNEXPECTED);</span>
<a href="#l41.35"></a><span id="l41.35">   rv = netService-&gt;NewChannelFromURI(aURL, getter_AddRefs(mQuoteChannel));</span>
<a href="#l41.36"></a><span id="l41.36">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l41.37"></a><span id="l41.37">   nsCOMPtr&lt;nsISupports&gt; ctxt = do_QueryInterface(aURL);</span>
<a href="#l41.38"></a><span id="l41.38"> </span>
<a href="#l41.39"></a><span id="l41.39">   nsCOMPtr&lt;nsIStreamConverterService&gt; streamConverterService = </span>
<a href="#l41.40"></a><span id="l41.40">            do_GetService(&quot;@mozilla.org/streamConverters;1&quot;, &amp;rv);</span>
<a href="#l41.41"></a><span id="l41.41">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l41.42"></a><span id="l41.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -105,16 +105,17 @@</span>
<a href="#l42.4"></a><span id="l42.4"> #include &quot;nsIMsgMessageService.h&quot;</span>
<a href="#l42.5"></a><span id="l42.5"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l42.6"></a><span id="l42.6"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l42.7"></a><span id="l42.7"> #include &quot;nsComposeStrings.h&quot;</span>
<a href="#l42.8"></a><span id="l42.8"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l42.9"></a><span id="l42.9"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l42.10"></a><span id="l42.10"> #include &quot;nsIArray.h&quot;</span>
<a href="#l42.11"></a><span id="l42.11"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l42.13"></a><span id="l42.13"> </span>
<a href="#l42.14"></a><span id="l42.14"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l42.15"></a><span id="l42.15"> </span>
<a href="#l42.16"></a><span id="l42.16"> #define PREF_MAIL_SEND_STRUCT &quot;mail.send_struct&quot;</span>
<a href="#l42.17"></a><span id="l42.17"> #define PREF_MAIL_STRICTLY_MIME &quot;mail.strictly_mime&quot;</span>
<a href="#l42.18"></a><span id="l42.18"> #define PREF_MAIL_MESSAGE_WARNING_SIZE &quot;mailnews.message_warning_size&quot;</span>
<a href="#l42.19"></a><span id="l42.19"> #define PREF_MAIL_COLLECT_EMAIL_ADDRESS_OUTGOING &quot;mail.collect_email_address_outgoing&quot;</span>
<a href="#l42.20"></a><span id="l42.20"> #define PREF_MAIL_DONT_ATTACH_SOURCE &quot;mail.compose.dont_attach_source_of_local_network_links&quot;</span>
<a href="#l42.21"></a><span id="l42.21" class="difflineat">@@ -2124,18 +2125,19 @@ nsMsgComposeAndSend::AddCompFieldLocalAt</span>
<a href="#l42.22"></a><span id="l42.22"> </span>
<a href="#l42.23"></a><span id="l42.23">           if (m_attachments[newLoc].mTmpFile)</span>
<a href="#l42.24"></a><span id="l42.24">           {</span>
<a href="#l42.25"></a><span id="l42.25">             if (m_attachments[newLoc].mDeleteFile)</span>
<a href="#l42.26"></a><span id="l42.26">               m_attachments[newLoc].mTmpFile-&gt;Remove(false);</span>
<a href="#l42.27"></a><span id="l42.27">             m_attachments[newLoc].mTmpFile =nsnull;</span>
<a href="#l42.28"></a><span id="l42.28">           }</span>
<a href="#l42.29"></a><span id="l42.29">           nsresult rv;</span>
<a href="#l42.30"></a><span id="l42.30" class="difflineminus">-          nsCOMPtr&lt;nsIIOService&gt; ioService = do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-          NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+          nsCOMPtr&lt;nsIIOService&gt; ioService =</span>
<a href="#l42.33"></a><span id="l42.33" class="difflineplus">+            mozilla::services::GetIOService();</span>
<a href="#l42.34"></a><span id="l42.34" class="difflineplus">+          NS_ENSURE_TRUE(ioService, NS_ERROR_UNEXPECTED);</span>
<a href="#l42.35"></a><span id="l42.35">           nsCOMPtr &lt;nsIURI&gt; uri;</span>
<a href="#l42.36"></a><span id="l42.36">           rv = ioService-&gt;NewURI(url, nsnull, nsnull, getter_AddRefs(uri));</span>
<a href="#l42.37"></a><span id="l42.37">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.38"></a><span id="l42.38">           nsCOMPtr &lt;nsIFileURL&gt; fileURL = do_QueryInterface(uri);</span>
<a href="#l42.39"></a><span id="l42.39">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.40"></a><span id="l42.40">           nsCOMPtr &lt;nsIFile&gt; fileURLFile;</span>
<a href="#l42.41"></a><span id="l42.41">           fileURL-&gt;GetFile(getter_AddRefs(fileURLFile));</span>
<a href="#l42.42"></a><span id="l42.42">           m_attachments[newLoc].mTmpFile = do_QueryInterface(fileURLFile);</span>
<a href="#l42.43"></a><span id="l42.43" class="difflineat">@@ -3210,18 +3212,19 @@ nsMsgComposeAndSend::Init(</span>
<a href="#l42.44"></a><span id="l42.44">   mLastErrorReported = NS_OK;</span>
<a href="#l42.45"></a><span id="l42.45"> </span>
<a href="#l42.46"></a><span id="l42.46">   //Let make sure we retreive the correct number of related parts. It may have changed since last time</span>
<a href="#l42.47"></a><span id="l42.47">   GetMultipartRelatedCount(true);</span>
<a href="#l42.48"></a><span id="l42.48"> </span>
<a href="#l42.49"></a><span id="l42.49">   nsString msg;</span>
<a href="#l42.50"></a><span id="l42.50">   if (!mComposeBundle)</span>
<a href="#l42.51"></a><span id="l42.51">   {</span>
<a href="#l42.52"></a><span id="l42.52" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l42.53"></a><span id="l42.53" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.54"></a><span id="l42.54" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l42.55"></a><span id="l42.55" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l42.56"></a><span id="l42.56" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l42.57"></a><span id="l42.57">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l42.58"></a><span id="l42.58">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(mComposeBundle));</span>
<a href="#l42.59"></a><span id="l42.59">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.60"></a><span id="l42.60">   }</span>
<a href="#l42.61"></a><span id="l42.61"> </span>
<a href="#l42.62"></a><span id="l42.62">   // Tell the user we are assembling the message...</span>
<a href="#l42.63"></a><span id="l42.63">   mComposeBundle-&gt;GetStringFromID(NS_MSG_ASSEMBLING_MESSAGE, getter_Copies(msg));</span>
<a href="#l42.64"></a><span id="l42.64">   SetStatusMessage(msg);</span>
<a href="#l42.65"></a><span id="l42.65" class="difflineat">@@ -4011,18 +4014,19 @@ nsMsgComposeAndSend::NotifyListenerOnSto</span>
<a href="#l42.66"></a><span id="l42.66">   SetStatusMessage(msg);</span>
<a href="#l42.67"></a><span id="l42.67">   nsCOMPtr&lt;nsIPrompt&gt; prompt;</span>
<a href="#l42.68"></a><span id="l42.68">   GetDefaultPrompt(getter_AddRefs(prompt));</span>
<a href="#l42.69"></a><span id="l42.69"> </span>
<a href="#l42.70"></a><span id="l42.70">   if (NS_FAILED(aStatus))</span>
<a href="#l42.71"></a><span id="l42.71">   {</span>
<a href="#l42.72"></a><span id="l42.72">     bool retry = false;</span>
<a href="#l42.73"></a><span id="l42.73">     nsresult rv;</span>
<a href="#l42.74"></a><span id="l42.74" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l42.75"></a><span id="l42.75" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.76"></a><span id="l42.76" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l42.77"></a><span id="l42.77" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l42.78"></a><span id="l42.78" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l42.79"></a><span id="l42.79">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l42.80"></a><span id="l42.80">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l42.81"></a><span id="l42.81">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.82"></a><span id="l42.82"> </span>
<a href="#l42.83"></a><span id="l42.83">     nsString msg;</span>
<a href="#l42.84"></a><span id="l42.84">     const PRUnichar *formatStrings[] = { mSavedToFolderName.get() };</span>
<a href="#l42.85"></a><span id="l42.85"> </span>
<a href="#l42.86"></a><span id="l42.86">     rv = bundle-&gt;FormatStringFromName(NS_LITERAL_STRING(&quot;errorSavingMsg&quot;).get(),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -57,16 +57,17 @@</span>
<a href="#l43.4"></a><span id="l43.4"> #include &quot;nsIMimeConverter.h&quot;</span>
<a href="#l43.5"></a><span id="l43.5"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l43.6"></a><span id="l43.6"> #include &quot;nsComposeStrings.h&quot;</span>
<a href="#l43.7"></a><span id="l43.7"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l43.8"></a><span id="l43.8"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l43.9"></a><span id="l43.9"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l43.10"></a><span id="l43.10"> #include &quot;nsIMsgLocalMailFolder.h&quot;</span>
<a href="#l43.11"></a><span id="l43.11"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l43.13"></a><span id="l43.13"> </span>
<a href="#l43.14"></a><span id="l43.14"> // Consts for checking and sending mail in milliseconds</span>
<a href="#l43.15"></a><span id="l43.15"> </span>
<a href="#l43.16"></a><span id="l43.16"> // 1 second from mail into the unsent messages folder to initially trying to</span>
<a href="#l43.17"></a><span id="l43.17"> // send it.</span>
<a href="#l43.18"></a><span id="l43.18"> const PRUint32 kInitialMessageSendTime = 1000;</span>
<a href="#l43.19"></a><span id="l43.19"> </span>
<a href="#l43.20"></a><span id="l43.20"> NS_IMPL_ISUPPORTS7(nsMsgSendLater,</span>
<a href="#l43.21"></a><span id="l43.21" class="difflineat">@@ -129,18 +130,18 @@ nsMsgSendLater::Init()</span>
<a href="#l43.22"></a><span id="l43.22">   bool sendInBackground;</span>
<a href="#l43.23"></a><span id="l43.23">   rv = prefs-&gt;GetBoolPref(&quot;mailnews.sendInBackground&quot;, &amp;sendInBackground);</span>
<a href="#l43.24"></a><span id="l43.24">   // If we're not sending in the background, don't do anything else</span>
<a href="#l43.25"></a><span id="l43.25">   if (NS_FAILED(rv) || !sendInBackground)</span>
<a href="#l43.26"></a><span id="l43.26">     return NS_OK;</span>
<a href="#l43.27"></a><span id="l43.27"> </span>
<a href="#l43.28"></a><span id="l43.28">   // We need to know when we're shutting down.</span>
<a href="#l43.29"></a><span id="l43.29">   nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l43.30"></a><span id="l43.30" class="difflineminus">-    do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l43.33"></a><span id="l43.33" class="difflineplus">+  NS_ENSURE_TRUE(observerService, NS_ERROR_UNEXPECTED);</span>
<a href="#l43.34"></a><span id="l43.34"> </span>
<a href="#l43.35"></a><span id="l43.35">   rv = observerService-&gt;AddObserver(this, &quot;xpcom-shutdown&quot;, false);</span>
<a href="#l43.36"></a><span id="l43.36">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l43.37"></a><span id="l43.37"> </span>
<a href="#l43.38"></a><span id="l43.38">   rv = observerService-&gt;AddObserver(this, &quot;quit-application&quot;, false);</span>
<a href="#l43.39"></a><span id="l43.39">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l43.40"></a><span id="l43.40"> </span>
<a href="#l43.41"></a><span id="l43.41">   rv = observerService-&gt;AddObserver(this, &quot;msg-shutdown&quot;, false);</span>
<a href="#l43.42"></a><span id="l43.42" class="difflineat">@@ -195,18 +196,18 @@ nsMsgSendLater::Observe(nsISupports *aSu</span>
<a href="#l43.43"></a><span id="l43.43">     if (mMessageFolder)</span>
<a href="#l43.44"></a><span id="l43.44">     {</span>
<a href="#l43.45"></a><span id="l43.45">       rv = mMessageFolder-&gt;RemoveFolderListener(this);</span>
<a href="#l43.46"></a><span id="l43.46">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l43.47"></a><span id="l43.47">     }</span>
<a href="#l43.48"></a><span id="l43.48"> </span>
<a href="#l43.49"></a><span id="l43.49">     // Now remove ourselves from the observer service as well.</span>
<a href="#l43.50"></a><span id="l43.50">     nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l43.51"></a><span id="l43.51" class="difflineminus">-      do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l43.52"></a><span id="l43.52" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l43.53"></a><span id="l43.53" class="difflineplus">+      mozilla::services::GetObserverService();</span>
<a href="#l43.54"></a><span id="l43.54" class="difflineplus">+    NS_ENSURE_TRUE(observerService, NS_ERROR_UNEXPECTED);</span>
<a href="#l43.55"></a><span id="l43.55"> </span>
<a href="#l43.56"></a><span id="l43.56">     rv = observerService-&gt;RemoveObserver(this, &quot;xpcom-shutdown&quot;);</span>
<a href="#l43.57"></a><span id="l43.57">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l43.58"></a><span id="l43.58"> </span>
<a href="#l43.59"></a><span id="l43.59">     rv = observerService-&gt;RemoveObserver(this, &quot;quit-application&quot;);</span>
<a href="#l43.60"></a><span id="l43.60">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l43.61"></a><span id="l43.61"> </span>
<a href="#l43.62"></a><span id="l43.62">     rv = observerService-&gt;RemoveObserver(this, &quot;msg-shutdown&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendReport.cpp</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendReport.cpp</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -41,16 +41,17 @@</span>
<a href="#l44.4"></a><span id="l44.4"> #include &quot;msgCore.h&quot;</span>
<a href="#l44.5"></a><span id="l44.5"> #include &quot;nsIMsgCompose.h&quot;</span>
<a href="#l44.6"></a><span id="l44.6"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l44.7"></a><span id="l44.7"> #include &quot;nsMsgPrompts.h&quot;</span>
<a href="#l44.8"></a><span id="l44.8"> #include &quot;nsNetError.h&quot;</span>
<a href="#l44.9"></a><span id="l44.9"> #include &quot;nsComposeStrings.h&quot;</span>
<a href="#l44.10"></a><span id="l44.10"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l44.11"></a><span id="l44.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l44.13"></a><span id="l44.13"> </span>
<a href="#l44.14"></a><span id="l44.14"> NS_IMPL_ISUPPORTS1(nsMsgProcessReport, nsIMsgProcessReport)</span>
<a href="#l44.15"></a><span id="l44.15"> </span>
<a href="#l44.16"></a><span id="l44.16"> nsMsgProcessReport::nsMsgProcessReport()</span>
<a href="#l44.17"></a><span id="l44.17"> {</span>
<a href="#l44.18"></a><span id="l44.18">   Reset();</span>
<a href="#l44.19"></a><span id="l44.19"> }</span>
<a href="#l44.20"></a><span id="l44.20"> </span>
<a href="#l44.21"></a><span id="l44.21" class="difflineat">@@ -256,18 +257,19 @@ NS_IMETHODIMP nsMsgSendReport::DisplayRe</span>
<a href="#l44.22"></a><span id="l44.22"> </span>
<a href="#l44.23"></a><span id="l44.23">   if (showErrorOnly &amp;&amp; NS_SUCCEEDED(currError))</span>
<a href="#l44.24"></a><span id="l44.24">     return NS_OK;</span>
<a href="#l44.25"></a><span id="l44.25"> </span>
<a href="#l44.26"></a><span id="l44.26">   nsString currMessage;</span>
<a href="#l44.27"></a><span id="l44.27">   mProcessReport[mCurrentProcess]-&gt;GetMessage(getter_Copies(currMessage));</span>
<a href="#l44.28"></a><span id="l44.28"> </span>
<a href="#l44.29"></a><span id="l44.29">   nsresult rv; // don't step on currError.</span>
<a href="#l44.30"></a><span id="l44.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l44.31"></a><span id="l44.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l44.32"></a><span id="l44.32" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l44.33"></a><span id="l44.33" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l44.34"></a><span id="l44.34" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l44.35"></a><span id="l44.35">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l44.36"></a><span id="l44.36">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l44.37"></a><span id="l44.37">   if (NS_FAILED(rv))</span>
<a href="#l44.38"></a><span id="l44.38">   {</span>
<a href="#l44.39"></a><span id="l44.39">     //TODO need to display a generic hardcoded message</span>
<a href="#l44.40"></a><span id="l44.40">     mAlreadyDisplayReport = true;</span>
<a href="#l44.41"></a><span id="l44.41">     return NS_OK;  </span>
<a href="#l44.42"></a><span id="l44.42">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -75,17 +75,17 @@</span>
<a href="#l45.4"></a><span id="l45.4"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l45.5"></a><span id="l45.5"> #include &quot;nsISignatureVerifier.h&quot;</span>
<a href="#l45.6"></a><span id="l45.6"> #include &quot;nsISSLSocketControl.h&quot;</span>
<a href="#l45.7"></a><span id="l45.7"> #include &quot;nsComposeStrings.h&quot;</span>
<a href="#l45.8"></a><span id="l45.8"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l45.9"></a><span id="l45.9"> #include &quot;nsMsgCompUtils.h&quot;</span>
<a href="#l45.10"></a><span id="l45.10"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l45.11"></a><span id="l45.11"> #include &quot;MailNewsTypes2.h&quot; // for nsMsgSocketType and nsMsgAuthMethod</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l45.14"></a><span id="l45.14"> </span>
<a href="#l45.15"></a><span id="l45.15"> #ifndef XP_UNIX</span>
<a href="#l45.16"></a><span id="l45.16"> #include &lt;stdarg.h&gt;</span>
<a href="#l45.17"></a><span id="l45.17"> #endif /* !XP_UNIX */</span>
<a href="#l45.18"></a><span id="l45.18"> </span>
<a href="#l45.19"></a><span id="l45.19"> static PRLogModuleInfo *SMTPLogModule = nsnull;</span>
<a href="#l45.20"></a><span id="l45.20"> </span>
<a href="#l45.21"></a><span id="l45.21"> /* the output_buffer_size must be larger than the largest possible line</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineat">@@ -103,29 +103,29 @@ static PRLogModuleInfo *SMTPLogModule = </span>
<a href="#l45.23"></a><span id="l45.23"> // TEMPORARY HARD CODED FUNCTIONS</span>
<a href="#l45.24"></a><span id="l45.24"> ///////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l45.25"></a><span id="l45.25"> </span>
<a href="#l45.26"></a><span id="l45.26"> /* based on in NET_ExplainErrorDetails in mkmessag.c */</span>
<a href="#l45.27"></a><span id="l45.27"> nsresult nsExplainErrorDetails(nsISmtpUrl * aSmtpUrl, int code, ...)</span>
<a href="#l45.28"></a><span id="l45.28"> {</span>
<a href="#l45.29"></a><span id="l45.29">   NS_ENSURE_ARG(aSmtpUrl);</span>
<a href="#l45.30"></a><span id="l45.30"> </span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l45.32"></a><span id="l45.32">   va_list args;</span>
<a href="#l45.33"></a><span id="l45.33"> </span>
<a href="#l45.34"></a><span id="l45.34">   nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l45.35"></a><span id="l45.35">   aSmtpUrl-&gt;GetPrompt(getter_AddRefs(dialog));</span>
<a href="#l45.36"></a><span id="l45.36">   NS_ENSURE_TRUE(dialog, NS_ERROR_FAILURE);</span>
<a href="#l45.37"></a><span id="l45.37"> </span>
<a href="#l45.38"></a><span id="l45.38">   PRUnichar *  msg;</span>
<a href="#l45.39"></a><span id="l45.39">   nsString eMsg;</span>
<a href="#l45.40"></a><span id="l45.40" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l45.41"></a><span id="l45.41" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.42"></a><span id="l45.42" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l45.43"></a><span id="l45.43" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l45.44"></a><span id="l45.44" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l45.45"></a><span id="l45.45">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l45.46"></a><span id="l45.46" class="difflineminus">-  rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l45.47"></a><span id="l45.47" class="difflineplus">+  nsresult rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l45.48"></a><span id="l45.48">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.49"></a><span id="l45.49"> </span>
<a href="#l45.50"></a><span id="l45.50">   va_start (args, code);</span>
<a href="#l45.51"></a><span id="l45.51"> </span>
<a href="#l45.52"></a><span id="l45.52">   switch (code)</span>
<a href="#l45.53"></a><span id="l45.53">   {</span>
<a href="#l45.54"></a><span id="l45.54">       case NS_ERROR_SMTP_SERVER_ERROR:</span>
<a href="#l45.55"></a><span id="l45.55">       case NS_ERROR_TCP_READ_ERROR:</span>
<a href="#l45.56"></a><span id="l45.56" class="difflineat">@@ -446,21 +446,21 @@ NS_IMETHODIMP nsSmtpProtocol::OnStopRequ</span>
<a href="#l45.57"></a><span id="l45.57"> /////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l45.58"></a><span id="l45.58"> // End of nsIStreamListenerSupport</span>
<a href="#l45.59"></a><span id="l45.59"> //////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l45.60"></a><span id="l45.60"> </span>
<a href="#l45.61"></a><span id="l45.61"> void nsSmtpProtocol::UpdateStatus(PRInt32 aStatusID)</span>
<a href="#l45.62"></a><span id="l45.62"> {</span>
<a href="#l45.63"></a><span id="l45.63">   if (m_statusFeedback)</span>
<a href="#l45.64"></a><span id="l45.64">   {</span>
<a href="#l45.65"></a><span id="l45.65" class="difflineminus">-    nsresult rv;</span>
<a href="#l45.66"></a><span id="l45.66" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l45.67"></a><span id="l45.67" class="difflineminus">-    if (NS_FAILED(rv)) return;</span>
<a href="#l45.68"></a><span id="l45.68" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l45.69"></a><span id="l45.69" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l45.70"></a><span id="l45.70" class="difflineplus">+    if (!bundleService) return;</span>
<a href="#l45.71"></a><span id="l45.71">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l45.72"></a><span id="l45.72" class="difflineminus">-    rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l45.73"></a><span id="l45.73" class="difflineplus">+    nsresult rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l45.74"></a><span id="l45.74">     if (NS_FAILED(rv)) return;</span>
<a href="#l45.75"></a><span id="l45.75">     nsString msg;</span>
<a href="#l45.76"></a><span id="l45.76">     bundle-&gt;GetStringFromID(aStatusID, getter_Copies(msg));</span>
<a href="#l45.77"></a><span id="l45.77">     UpdateStatusWithString(msg.get());</span>
<a href="#l45.78"></a><span id="l45.78">   }</span>
<a href="#l45.79"></a><span id="l45.79"> }</span>
<a href="#l45.80"></a><span id="l45.80"> </span>
<a href="#l45.81"></a><span id="l45.81"> void nsSmtpProtocol::UpdateStatusWithString(const PRUnichar * aStatusString)</span>
<a href="#l45.82"></a><span id="l45.82" class="difflineat">@@ -2037,22 +2037,22 @@ nsSmtpProtocol::GetPassword(nsCString &amp;a</span>
<a href="#l45.83"></a><span id="l45.83"> </span>
<a href="#l45.84"></a><span id="l45.84"> /**</span>
<a href="#l45.85"></a><span id="l45.85">  * formatStrings is an array for the prompts, item 0 is the hostname, item 1</span>
<a href="#l45.86"></a><span id="l45.86">  * is the username.</span>
<a href="#l45.87"></a><span id="l45.87">  */</span>
<a href="#l45.88"></a><span id="l45.88"> nsresult</span>
<a href="#l45.89"></a><span id="l45.89"> nsSmtpProtocol::PromptForPassword(nsISmtpServer *aSmtpServer, nsISmtpUrl *aSmtpUrl, const PRUnichar **formatStrings, nsACString &amp;aPassword)</span>
<a href="#l45.90"></a><span id="l45.90"> {</span>
<a href="#l45.91"></a><span id="l45.91" class="difflineminus">-  nsresult rv;</span>
<a href="#l45.92"></a><span id="l45.92" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; stringService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l45.93"></a><span id="l45.93" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l45.94"></a><span id="l45.94" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; stringService =</span>
<a href="#l45.95"></a><span id="l45.95" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l45.96"></a><span id="l45.96" class="difflineplus">+  NS_ENSURE_TRUE(stringService, NS_ERROR_UNEXPECTED);</span>
<a href="#l45.97"></a><span id="l45.97"> </span>
<a href="#l45.98"></a><span id="l45.98">   nsCOMPtr&lt;nsIStringBundle&gt; composeStringBundle;</span>
<a href="#l45.99"></a><span id="l45.99" class="difflineminus">-  rv = stringService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(composeStringBundle));</span>
<a href="#l45.100"></a><span id="l45.100" class="difflineplus">+  nsresult rv = stringService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(composeStringBundle));</span>
<a href="#l45.101"></a><span id="l45.101">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l45.102"></a><span id="l45.102"> </span>
<a href="#l45.103"></a><span id="l45.103">   nsString passwordPromptString;</span>
<a href="#l45.104"></a><span id="l45.104">   if(formatStrings[1])</span>
<a href="#l45.105"></a><span id="l45.105">     rv = composeStringBundle-&gt;FormatStringFromName(</span>
<a href="#l45.106"></a><span id="l45.106">       NS_LITERAL_STRING(&quot;smtpEnterPasswordPromptWithUsername&quot;).get(),</span>
<a href="#l45.107"></a><span id="l45.107">       formatStrings, 2, getter_Copies(passwordPromptString));</span>
<a href="#l45.108"></a><span id="l45.108">   else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsDBFolderInfo.cpp</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsDBFolderInfo.cpp</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -45,16 +45,17 @@</span>
<a href="#l46.4"></a><span id="l46.4"> #include &quot;nsIPrefBranch2.h&quot;</span>
<a href="#l46.5"></a><span id="l46.5"> #include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l46.6"></a><span id="l46.6"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l46.7"></a><span id="l46.7"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l46.8"></a><span id="l46.8"> #include &quot;nsIMsgDBView.h&quot;</span>
<a href="#l46.9"></a><span id="l46.9"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l46.10"></a><span id="l46.10"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l46.11"></a><span id="l46.11"> #include &quot;nsImapCore.h&quot;</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l46.13"></a><span id="l46.13"> </span>
<a href="#l46.14"></a><span id="l46.14"> static const char *kDBFolderInfoScope = &quot;ns:msg:db:row:scope:dbfolderinfo:all&quot;;</span>
<a href="#l46.15"></a><span id="l46.15"> static const char *kDBFolderInfoTableKind = &quot;ns:msg:db:table:kind:dbfolderinfo&quot;;</span>
<a href="#l46.16"></a><span id="l46.16"> </span>
<a href="#l46.17"></a><span id="l46.17"> struct mdbOid gDBFolderInfoOID;</span>
<a href="#l46.18"></a><span id="l46.18"> </span>
<a href="#l46.19"></a><span id="l46.19"> static const char * kNumMessagesColumnName =&quot;numMsgs&quot;;</span>
<a href="#l46.20"></a><span id="l46.20"> // have to leave this as numNewMsgs even though it's numUnread Msgs</span>
<a href="#l46.21"></a><span id="l46.21" class="difflineat">@@ -232,18 +233,19 @@ nsDBFolderInfo::nsDBFolderInfo(nsMsgData</span>
<a href="#l46.22"></a><span id="l46.22">         NS_ADDREF(gFolderCharsetObserver);</span>
<a href="#l46.23"></a><span id="l46.23">         nsCOMPtr&lt;nsIPrefBranch2&gt; pbi = do_QueryInterface(prefBranch);</span>
<a href="#l46.24"></a><span id="l46.24">         if (pbi) {</span>
<a href="#l46.25"></a><span id="l46.25">           rv = pbi-&gt;AddObserver(kMAILNEWS_VIEW_DEFAULT_CHARSET, gFolderCharsetObserver, false);</span>
<a href="#l46.26"></a><span id="l46.26">           rv = pbi-&gt;AddObserver(kMAILNEWS_DEFAULT_CHARSET_OVERRIDE, gFolderCharsetObserver, false);</span>
<a href="#l46.27"></a><span id="l46.27">         }</span>
<a href="#l46.28"></a><span id="l46.28"> </span>
<a href="#l46.29"></a><span id="l46.29">         // also register for shutdown</span>
<a href="#l46.30"></a><span id="l46.30" class="difflineminus">-        nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineplus">+        nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineplus">+          mozilla::services::GetObserverService();</span>
<a href="#l46.34"></a><span id="l46.34" class="difflineplus">+        if (observerService)</span>
<a href="#l46.35"></a><span id="l46.35">         {</span>
<a href="#l46.36"></a><span id="l46.36">           rv = observerService-&gt;AddObserver(gFolderCharsetObserver, NS_XPCOM_SHUTDOWN_OBSERVER_ID, false);</span>
<a href="#l46.37"></a><span id="l46.37">         }</span>
<a href="#l46.38"></a><span id="l46.38">       }</span>
<a href="#l46.39"></a><span id="l46.39">     }</span>
<a href="#l46.40"></a><span id="l46.40">   }</span>
<a href="#l46.41"></a><span id="l46.41"> </span>
<a href="#l46.42"></a><span id="l46.42">   m_mdb = mdb;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -84,16 +84,17 @@</span>
<a href="#l47.4"></a><span id="l47.4"> #include &quot;nsLayoutCID.h&quot;</span>
<a href="#l47.5"></a><span id="l47.5"> #include &quot;nsIHTMLToTextSink.h&quot;</span>
<a href="#l47.6"></a><span id="l47.6"> #include &quot;nsIDocumentEncoder.h&quot;</span>
<a href="#l47.7"></a><span id="l47.7"> </span>
<a href="#l47.8"></a><span id="l47.8"> #include &quot;nsIncompleteGamma.h&quot;</span>
<a href="#l47.9"></a><span id="l47.9"> #include &lt;math.h&gt;</span>
<a href="#l47.10"></a><span id="l47.10"> #include &lt;prmem.h&gt;</span>
<a href="#l47.11"></a><span id="l47.11"> #include &quot;nsIMsgTraitService.h&quot;</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l47.13"></a><span id="l47.13"> </span>
<a href="#l47.14"></a><span id="l47.14"> static PRLogModuleInfo *BayesianFilterLogModule = nsnull;</span>
<a href="#l47.15"></a><span id="l47.15"> </span>
<a href="#l47.16"></a><span id="l47.16"> static NS_DEFINE_CID(kParserCID, NS_PARSER_CID);</span>
<a href="#l47.17"></a><span id="l47.17"> </span>
<a href="#l47.18"></a><span id="l47.18"> #define kDefaultJunkThreshold .99 // we override this value via a pref</span>
<a href="#l47.19"></a><span id="l47.19"> static const char* kBayesianFilterTokenDelimiters = &quot; \t\n\r\f.&quot;;</span>
<a href="#l47.20"></a><span id="l47.20"> static unsigned int kMinLengthForToken = 3; // lower bound on the number of characters in a word before we treat it as a token</span>
<a href="#l47.21"></a><span id="l47.21" class="difflineat">@@ -1281,20 +1282,19 @@ nsBayesianFilter::nsBayesianFilter()</span>
<a href="#l47.22"></a><span id="l47.22">     // start from 1</span>
<a href="#l47.23"></a><span id="l47.23">     AnalysisPerToken analysisPT(0, 0.0, 0.0);</span>
<a href="#l47.24"></a><span id="l47.24">     mAnalysisStore.AppendElement(analysisPT);</span>
<a href="#l47.25"></a><span id="l47.25">     mNextAnalysisIndex = 1;</span>
<a href="#l47.26"></a><span id="l47.26"> }</span>
<a href="#l47.27"></a><span id="l47.27"> </span>
<a href="#l47.28"></a><span id="l47.28"> nsresult nsBayesianFilter::Init()</span>
<a href="#l47.29"></a><span id="l47.29"> {</span>
<a href="#l47.30"></a><span id="l47.30" class="difflineminus">-  nsresult rv;</span>
<a href="#l47.31"></a><span id="l47.31">   nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineminus">-           do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l47.33"></a><span id="l47.33" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l47.34"></a><span id="l47.34" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l47.35"></a><span id="l47.35" class="difflineplus">+  if (observerService)</span>
<a href="#l47.36"></a><span id="l47.36">     observerService-&gt;AddObserver(this, &quot;profile-before-change&quot;, true);</span>
<a href="#l47.37"></a><span id="l47.37">   return NS_OK;</span>
<a href="#l47.38"></a><span id="l47.38"> }</span>
<a href="#l47.39"></a><span id="l47.39"> </span>
<a href="#l47.40"></a><span id="l47.40"> void</span>
<a href="#l47.41"></a><span id="l47.41"> nsBayesianFilter::TimerCallback(nsITimer* aTimer, void* aClosure)</span>
<a href="#l47.42"></a><span id="l47.42"> {</span>
<a href="#l47.43"></a><span id="l47.43">     // we will flush the training data to disk after enough time has passed</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -41,16 +41,17 @@</span>
<a href="#l48.4"></a><span id="l48.4"> #include &quot;nsIFileChannel.h&quot;</span>
<a href="#l48.5"></a><span id="l48.5"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l48.6"></a><span id="l48.6"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l48.7"></a><span id="l48.7"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l48.8"></a><span id="l48.8"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l48.9"></a><span id="l48.9"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l48.10"></a><span id="l48.10"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l48.11"></a><span id="l48.11"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l48.13"></a><span id="l48.13"> </span>
<a href="#l48.14"></a><span id="l48.14"> #define kDefaultViewPeopleIKnow &quot;People I Know&quot;</span>
<a href="#l48.15"></a><span id="l48.15"> #define kDefaultViewRecent &quot;Recent Mail&quot;</span>
<a href="#l48.16"></a><span id="l48.16"> #define kDefaultViewFiveDays &quot;Last 5 Days&quot;</span>
<a href="#l48.17"></a><span id="l48.17"> #define kDefaultViewNotJunk &quot;Not Junk&quot;</span>
<a href="#l48.18"></a><span id="l48.18"> #define kDefaultViewHasAttachments &quot;Has Attachments&quot;</span>
<a href="#l48.19"></a><span id="l48.19">  </span>
<a href="#l48.20"></a><span id="l48.20"> nsMsgMailView::nsMsgMailView()</span>
<a href="#l48.21"></a><span id="l48.21" class="difflineat">@@ -80,18 +81,19 @@ NS_IMETHODIMP nsMsgMailView::SetMailView</span>
<a href="#l48.22"></a><span id="l48.22">     return NS_OK;</span>
<a href="#l48.23"></a><span id="l48.23"> }</span>
<a href="#l48.24"></a><span id="l48.24"> </span>
<a href="#l48.25"></a><span id="l48.25"> NS_IMETHODIMP nsMsgMailView::GetPrettyName(PRUnichar ** aMailViewName)</span>
<a href="#l48.26"></a><span id="l48.26"> {</span>
<a href="#l48.27"></a><span id="l48.27">     nsresult rv = NS_OK;</span>
<a href="#l48.28"></a><span id="l48.28">     if (!mBundle)</span>
<a href="#l48.29"></a><span id="l48.29">     {</span>
<a href="#l48.30"></a><span id="l48.30" class="difflineminus">-        nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l48.31"></a><span id="l48.31" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l48.32"></a><span id="l48.32" class="difflineplus">+        nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l48.33"></a><span id="l48.33" class="difflineplus">+          mozilla::services::GetStringBundleService();</span>
<a href="#l48.34"></a><span id="l48.34" class="difflineplus">+        NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l48.35"></a><span id="l48.35">         bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/mailviews.properties&quot;,</span>
<a href="#l48.36"></a><span id="l48.36">                                     getter_AddRefs(mBundle));</span>
<a href="#l48.37"></a><span id="l48.37">     }</span>
<a href="#l48.38"></a><span id="l48.38"> </span>
<a href="#l48.39"></a><span id="l48.39">     NS_ENSURE_TRUE(mBundle, NS_ERROR_FAILURE);</span>
<a href="#l48.40"></a><span id="l48.40"> </span>
<a href="#l48.41"></a><span id="l48.41">     // see if mName has an associated pretty name inside our string bundle and if so, use that as the pretty name</span>
<a href="#l48.42"></a><span id="l48.42">     // otherwise just return mName</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -59,16 +59,17 @@</span>
<a href="#l49.4"></a><span id="l49.4"> #include &quot;nsIMsgCompUtils.h&quot;</span>
<a href="#l49.5"></a><span id="l49.5"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l49.6"></a><span id="l49.6"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l49.7"></a><span id="l49.7"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l49.8"></a><span id="l49.8"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l49.9"></a><span id="l49.9"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l49.10"></a><span id="l49.10"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l49.11"></a><span id="l49.11"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l49.13"></a><span id="l49.13"> </span>
<a href="#l49.14"></a><span id="l49.14"> #define MDN_NOT_IN_TO_CC          ((int) 0x0001)</span>
<a href="#l49.15"></a><span id="l49.15"> #define MDN_OUTSIDE_DOMAIN        ((int) 0x0002)</span>
<a href="#l49.16"></a><span id="l49.16"> </span>
<a href="#l49.17"></a><span id="l49.17"> #define HEADER_RETURN_PATH          &quot;Return-Path&quot;</span>
<a href="#l49.18"></a><span id="l49.18"> #define HEADER_DISPOSITION_NOTIFICATION_TO  &quot;Disposition-Notification-To&quot;</span>
<a href="#l49.19"></a><span id="l49.19"> #define HEADER_APPARENTLY_TO        &quot;Apparently-To&quot;</span>
<a href="#l49.20"></a><span id="l49.20"> #define HEADER_ORIGINAL_RECIPIENT     &quot;Original-Recipient&quot;</span>
<a href="#l49.21"></a><span id="l49.21" class="difflineat">@@ -127,47 +128,45 @@ nsMsgMdnGenerator::~nsMsgMdnGenerator()</span>
<a href="#l49.22"></a><span id="l49.22"> {</span>
<a href="#l49.23"></a><span id="l49.23"> }</span>
<a href="#l49.24"></a><span id="l49.24"> </span>
<a href="#l49.25"></a><span id="l49.25"> nsresult nsMsgMdnGenerator::FormatStringFromName(const PRUnichar *aName,</span>
<a href="#l49.26"></a><span id="l49.26">                                                  const PRUnichar *aString,</span>
<a href="#l49.27"></a><span id="l49.27">                                                  PRUnichar **aResultString)</span>
<a href="#l49.28"></a><span id="l49.28"> {</span>
<a href="#l49.29"></a><span id="l49.29">     DEBUG_MDN(&quot;nsMsgMdnGenerator::FormatStringFromName&quot;);</span>
<a href="#l49.30"></a><span id="l49.30" class="difflineminus">-    nsresult rv;</span>
<a href="#l49.31"></a><span id="l49.31"> </span>
<a href="#l49.32"></a><span id="l49.32" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt;</span>
<a href="#l49.33"></a><span id="l49.33" class="difflineminus">-        bundleService(do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv));</span>
<a href="#l49.34"></a><span id="l49.34" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l49.35"></a><span id="l49.35" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l49.36"></a><span id="l49.36" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l49.37"></a><span id="l49.37" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l49.38"></a><span id="l49.38"> </span>
<a href="#l49.39"></a><span id="l49.39">     nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l49.40"></a><span id="l49.40" class="difflineminus">-    rv = bundleService-&gt;CreateBundle(MDN_STRINGBUNDLE_URL,</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineminus">-                                     getter_AddRefs(bundle));</span>
<a href="#l49.42"></a><span id="l49.42" class="difflineplus">+    nsresult rv = bundleService-&gt;CreateBundle(MDN_STRINGBUNDLE_URL,</span>
<a href="#l49.43"></a><span id="l49.43" class="difflineplus">+                                              getter_AddRefs(bundle));</span>
<a href="#l49.44"></a><span id="l49.44">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l49.45"></a><span id="l49.45"> </span>
<a href="#l49.46"></a><span id="l49.46">     const PRUnichar *formatStrings[1] = { aString };</span>
<a href="#l49.47"></a><span id="l49.47">     rv = bundle-&gt;FormatStringFromName(aName,</span>
<a href="#l49.48"></a><span id="l49.48">                     formatStrings, 1, aResultString);</span>
<a href="#l49.49"></a><span id="l49.49">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l49.50"></a><span id="l49.50">     return rv;</span>
<a href="#l49.51"></a><span id="l49.51"> }</span>
<a href="#l49.52"></a><span id="l49.52"> </span>
<a href="#l49.53"></a><span id="l49.53"> nsresult nsMsgMdnGenerator::GetStringFromName(const PRUnichar *aName,</span>
<a href="#l49.54"></a><span id="l49.54">                                                PRUnichar **aResultString)</span>
<a href="#l49.55"></a><span id="l49.55"> {</span>
<a href="#l49.56"></a><span id="l49.56">     DEBUG_MDN(&quot;nsMsgMdnGenerator::GetStringFromName&quot;);</span>
<a href="#l49.57"></a><span id="l49.57" class="difflineminus">-    nsresult rv;</span>
<a href="#l49.58"></a><span id="l49.58"> </span>
<a href="#l49.59"></a><span id="l49.59" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt;</span>
<a href="#l49.60"></a><span id="l49.60" class="difflineminus">-        bundleService(do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv));</span>
<a href="#l49.61"></a><span id="l49.61" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l49.62"></a><span id="l49.62" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l49.63"></a><span id="l49.63" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l49.64"></a><span id="l49.64" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l49.65"></a><span id="l49.65"> </span>
<a href="#l49.66"></a><span id="l49.66">     nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l49.67"></a><span id="l49.67" class="difflineminus">-    rv = bundleService-&gt;CreateBundle(MDN_STRINGBUNDLE_URL,</span>
<a href="#l49.68"></a><span id="l49.68" class="difflineminus">-                                     getter_AddRefs(bundle));</span>
<a href="#l49.69"></a><span id="l49.69" class="difflineplus">+    nsresult rv = bundleService-&gt;CreateBundle(MDN_STRINGBUNDLE_URL,</span>
<a href="#l49.70"></a><span id="l49.70" class="difflineplus">+                                              getter_AddRefs(bundle));</span>
<a href="#l49.71"></a><span id="l49.71">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l49.72"></a><span id="l49.72"> </span>
<a href="#l49.73"></a><span id="l49.73">     rv = bundle-&gt;GetStringFromName(aName, aResultString);</span>
<a href="#l49.74"></a><span id="l49.74">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l49.75"></a><span id="l49.75">     return rv;</span>
<a href="#l49.76"></a><span id="l49.76"> }</span>
<a href="#l49.77"></a><span id="l49.77"> </span>
<a href="#l49.78"></a><span id="l49.78"> nsresult nsMsgMdnGenerator::StoreMDNSentFlag(nsIMsgFolder *folder,</span>
<a href="#l49.79"></a><span id="l49.79" class="difflineat">@@ -1153,18 +1152,19 @@ NS_IMETHODIMP nsMsgMdnGenerator::OnStopR</span>
<a href="#l49.80"></a><span id="l49.80">     if (NS_SUCCEEDED(rv)) </span>
<a href="#l49.81"></a><span id="l49.81">       smtpServer-&gt;GetHostname(smtpHostName);</span>
<a href="#l49.82"></a><span id="l49.82">      </span>
<a href="#l49.83"></a><span id="l49.83">     nsAutoString hostStr;</span>
<a href="#l49.84"></a><span id="l49.84">     CopyASCIItoUTF16(smtpHostName, hostStr);</span>
<a href="#l49.85"></a><span id="l49.85">     const PRUnichar *params[] = { hostStr.get() };</span>
<a href="#l49.86"></a><span id="l49.86"> </span>
<a href="#l49.87"></a><span id="l49.87">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l49.88"></a><span id="l49.88" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l49.89"></a><span id="l49.89" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l49.90"></a><span id="l49.90" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l49.91"></a><span id="l49.91" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l49.92"></a><span id="l49.92" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l49.93"></a><span id="l49.93"> </span>
<a href="#l49.94"></a><span id="l49.94">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l49.95"></a><span id="l49.95">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l49.96"></a><span id="l49.96"> </span>
<a href="#l49.97"></a><span id="l49.97">     nsString failed_msg, dialogTitle;</span>
<a href="#l49.98"></a><span id="l49.98"> </span>
<a href="#l49.99"></a><span id="l49.99">     bundle-&gt;FormatStringFromID(NS_ERROR_GET_CODE(aExitCode), params, 1, getter_Copies(failed_msg));</span>
<a href="#l49.100"></a><span id="l49.100">     bundle-&gt;GetStringFromID(NS_MSG_SEND_ERROR_TITLE, getter_Copies(dialogTitle));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/extensions/smime/src/nsMsgComposeSecure.cpp</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -48,16 +48,17 @@</span>
<a href="#l50.4"></a><span id="l50.4"> #include &quot;nsIX509CertDB.h&quot;</span>
<a href="#l50.5"></a><span id="l50.5"> #include &quot;nsMimeTypes.h&quot;</span>
<a href="#l50.6"></a><span id="l50.6"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l50.7"></a><span id="l50.7"> #include &quot;nspr.h&quot;</span>
<a href="#l50.8"></a><span id="l50.8"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l50.9"></a><span id="l50.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l50.10"></a><span id="l50.10"> #include &quot;nsMemory.h&quot;</span>
<a href="#l50.11"></a><span id="l50.11"> #include &quot;nsAlgorithm.h&quot;</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l50.13"></a><span id="l50.13"> </span>
<a href="#l50.14"></a><span id="l50.14"> #define MK_MIME_ERROR_WRITING_FILE -1</span>
<a href="#l50.15"></a><span id="l50.15"> </span>
<a href="#l50.16"></a><span id="l50.16"> #define SMIME_STRBUNDLE_URL &quot;chrome://messenger/locale/am-smime.properties&quot;</span>
<a href="#l50.17"></a><span id="l50.17"> </span>
<a href="#l50.18"></a><span id="l50.18"> static void mime_crypto_write_base64 (void *closure, const char *buf,</span>
<a href="#l50.19"></a><span id="l50.19">               unsigned long size);</span>
<a href="#l50.20"></a><span id="l50.20"> static nsresult mime_encoder_output_fn(const char *buf, PRInt32 size, void *closure);</span>
<a href="#l50.21"></a><span id="l50.21" class="difflineat">@@ -289,17 +290,17 @@ SMIMEBundleFormatStringFromName(const PR</span>
<a href="#l50.22"></a><span id="l50.22"> }</span>
<a href="#l50.23"></a><span id="l50.23"> </span>
<a href="#l50.24"></a><span id="l50.24"> bool nsMsgComposeSecure::InitializeSMIMEBundle()</span>
<a href="#l50.25"></a><span id="l50.25"> {</span>
<a href="#l50.26"></a><span id="l50.26">   if (mSMIMEBundle)</span>
<a href="#l50.27"></a><span id="l50.27">     return true;</span>
<a href="#l50.28"></a><span id="l50.28"> </span>
<a href="#l50.29"></a><span id="l50.29">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l50.30"></a><span id="l50.30" class="difflineminus">-    do_GetService(NS_STRINGBUNDLE_CONTRACTID);</span>
<a href="#l50.31"></a><span id="l50.31" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l50.32"></a><span id="l50.32">   nsresult rv = bundleService-&gt;CreateBundle(SMIME_STRBUNDLE_URL,</span>
<a href="#l50.33"></a><span id="l50.33">                                             getter_AddRefs(mSMIMEBundle));</span>
<a href="#l50.34"></a><span id="l50.34">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l50.35"></a><span id="l50.35"> </span>
<a href="#l50.36"></a><span id="l50.36">   return true;</span>
<a href="#l50.37"></a><span id="l50.37"> }</span>
<a href="#l50.38"></a><span id="l50.38"> </span>
<a href="#l50.39"></a><span id="l50.39"> void nsMsgComposeSecure::SetError(nsIMsgSendReport *sendReport, const PRUnichar *bundle_string)</span>
<a href="#l50.40"></a><span id="l50.40" class="difflineat">@@ -540,18 +541,18 @@ nsresult nsMsgComposeSecure::MimeInitMul</span>
<a href="#l50.41"></a><span id="l50.41">  FAIL:</span>
<a href="#l50.42"></a><span id="l50.42">   return rv;</span>
<a href="#l50.43"></a><span id="l50.43"> }</span>
<a href="#l50.44"></a><span id="l50.44"> </span>
<a href="#l50.45"></a><span id="l50.45"> nsresult nsMsgComposeSecure::MimeInitEncryption(bool aSign, nsIMsgSendReport *sendReport)</span>
<a href="#l50.46"></a><span id="l50.46"> {</span>
<a href="#l50.47"></a><span id="l50.47">   nsresult rv;</span>
<a href="#l50.48"></a><span id="l50.48">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleSvc =</span>
<a href="#l50.49"></a><span id="l50.49" class="difflineminus">-                  do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l50.50"></a><span id="l50.50" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l50.51"></a><span id="l50.51" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l50.52"></a><span id="l50.52" class="difflineplus">+  NS_ENSURE_TRUE(bundleSvc, NS_ERROR_UNEXPECTED);</span>
<a href="#l50.53"></a><span id="l50.53"> </span>
<a href="#l50.54"></a><span id="l50.54">   nsCOMPtr&lt;nsIStringBundle&gt; sMIMEBundle;</span>
<a href="#l50.55"></a><span id="l50.55">   nsString mime_smime_enc_content_desc;</span>
<a href="#l50.56"></a><span id="l50.56"> </span>
<a href="#l50.57"></a><span id="l50.57">   bundleSvc-&gt;CreateBundle(SMIME_STRBUNDLE_URL, getter_AddRefs(sMIMEBundle));</span>
<a href="#l50.58"></a><span id="l50.58"> </span>
<a href="#l50.59"></a><span id="l50.59">   if (!sMIMEBundle)</span>
<a href="#l50.60"></a><span id="l50.60">     return NS_ERROR_FAILURE;</span>
<a href="#l50.61"></a><span id="l50.61" class="difflineat">@@ -650,18 +651,18 @@ nsresult nsMsgComposeSecure::MimeFinishM</span>
<a href="#l50.62"></a><span id="l50.62">   nsCOMPtr&lt;nsICMSMessage&gt; cinfo = do_CreateInstance(NS_CMSMESSAGE_CONTRACTID, &amp;rv);</span>
<a href="#l50.63"></a><span id="l50.63">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l50.64"></a><span id="l50.64"> </span>
<a href="#l50.65"></a><span id="l50.65">   nsCOMPtr&lt;nsICMSEncoder&gt; encoder = do_CreateInstance(NS_CMSENCODER_CONTRACTID, &amp;rv);</span>
<a href="#l50.66"></a><span id="l50.66">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l50.67"></a><span id="l50.67"> </span>
<a href="#l50.68"></a><span id="l50.68">   char * header = nsnull;</span>
<a href="#l50.69"></a><span id="l50.69">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleSvc =</span>
<a href="#l50.70"></a><span id="l50.70" class="difflineminus">-                  do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l50.71"></a><span id="l50.71" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l50.72"></a><span id="l50.72" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l50.73"></a><span id="l50.73" class="difflineplus">+  NS_ENSURE_TRUE(bundleSvc, NS_ERROR_UNEXPECTED);</span>
<a href="#l50.74"></a><span id="l50.74"> </span>
<a href="#l50.75"></a><span id="l50.75">   nsCOMPtr&lt;nsIStringBundle&gt; sMIMEBundle;</span>
<a href="#l50.76"></a><span id="l50.76">   nsString mime_smime_sig_content_desc;</span>
<a href="#l50.77"></a><span id="l50.77"> </span>
<a href="#l50.78"></a><span id="l50.78">   bundleSvc-&gt;CreateBundle(SMIME_STRBUNDLE_URL, getter_AddRefs(sMIMEBundle));</span>
<a href="#l50.79"></a><span id="l50.79"> </span>
<a href="#l50.80"></a><span id="l50.80">   if (!sMIMEBundle)</span>
<a href="#l50.81"></a><span id="l50.81">     return NS_ERROR_FAILURE;</span>
<a href="#l50.82"></a><span id="l50.82" class="difflineat">@@ -1057,21 +1058,20 @@ NS_IMETHODIMP nsMsgComposeSecure::MimeCr</span>
<a href="#l50.83"></a><span id="l50.83">  */</span>
<a href="#l50.84"></a><span id="l50.84"> static int</span>
<a href="#l50.85"></a><span id="l50.85"> make_multipart_signed_header_string(bool outer_p,</span>
<a href="#l50.86"></a><span id="l50.86"> 									char **header_return,</span>
<a href="#l50.87"></a><span id="l50.87"> 									char **boundary_return)</span>
<a href="#l50.88"></a><span id="l50.88"> {</span>
<a href="#l50.89"></a><span id="l50.89">   *header_return = 0;</span>
<a href="#l50.90"></a><span id="l50.90">   *boundary_return = mime_make_separator(&quot;ms&quot;);</span>
<a href="#l50.91"></a><span id="l50.91" class="difflineminus">-  nsresult rv;</span>
<a href="#l50.92"></a><span id="l50.92"> </span>
<a href="#l50.93"></a><span id="l50.93">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleSvc =</span>
<a href="#l50.94"></a><span id="l50.94" class="difflineminus">-                  do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l50.95"></a><span id="l50.95" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l50.96"></a><span id="l50.96" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l50.97"></a><span id="l50.97" class="difflineplus">+  NS_ENSURE_TRUE(bundleSvc, NS_ERROR_UNEXPECTED);</span>
<a href="#l50.98"></a><span id="l50.98"> </span>
<a href="#l50.99"></a><span id="l50.99">   nsCOMPtr&lt;nsIStringBundle&gt; sMIMEBundle;</span>
<a href="#l50.100"></a><span id="l50.100">   nsString crypto_multipart_blurb;</span>
<a href="#l50.101"></a><span id="l50.101"> </span>
<a href="#l50.102"></a><span id="l50.102">   bundleSvc-&gt;CreateBundle(SMIME_STRBUNDLE_URL, getter_AddRefs(sMIMEBundle));</span>
<a href="#l50.103"></a><span id="l50.103">   if (!sMIMEBundle)</span>
<a href="#l50.104"></a><span id="l50.104">     return NS_ERROR_FAILURE;</span>
<a href="#l50.105"></a><span id="l50.105"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/imap/src/nsAutoSyncManager.cpp</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/imap/src/nsAutoSyncManager.cpp</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -49,16 +49,17 @@</span>
<a href="#l51.4"></a><span id="l51.4"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l51.5"></a><span id="l51.5"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l51.6"></a><span id="l51.6"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l51.7"></a><span id="l51.7"> #include &quot;nsImapIncomingServer.h&quot;</span>
<a href="#l51.8"></a><span id="l51.8"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l51.9"></a><span id="l51.9"> #include &quot;nsIIOService.h&quot;</span>
<a href="#l51.10"></a><span id="l51.10"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l51.11"></a><span id="l51.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l51.13"></a><span id="l51.13"> </span>
<a href="#l51.14"></a><span id="l51.14"> NS_IMPL_ISUPPORTS1(nsDefaultAutoSyncMsgStrategy, nsIAutoSyncMsgStrategy)</span>
<a href="#l51.15"></a><span id="l51.15"> </span>
<a href="#l51.16"></a><span id="l51.16"> const char* kAppIdleNotification = &quot;mail:appIdle&quot;;</span>
<a href="#l51.17"></a><span id="l51.17"> const char* kStartupDoneNotification = &quot;mail-startup-done&quot;;</span>
<a href="#l51.18"></a><span id="l51.18"> PRLogModuleInfo *gAutoSyncLog;</span>
<a href="#l51.19"></a><span id="l51.19"> </span>
<a href="#l51.20"></a><span id="l51.20"> // recommended size of each group of messages per download</span>
<a href="#l51.21"></a><span id="l51.21" class="difflineat">@@ -256,17 +257,17 @@ nsAutoSyncManager::nsAutoSyncManager()</span>
<a href="#l51.22"></a><span id="l51.22"> </span>
<a href="#l51.23"></a><span id="l51.23">   nsresult rv;</span>
<a href="#l51.24"></a><span id="l51.24">   mIdleService = do_GetService(&quot;@mozilla.org/widget/idleservice;1&quot;, &amp;rv);</span>
<a href="#l51.25"></a><span id="l51.25">   if (mIdleService)</span>
<a href="#l51.26"></a><span id="l51.26">     mIdleService-&gt;AddIdleObserver(this, kIdleTimeInSec);</span>
<a href="#l51.27"></a><span id="l51.27"> </span>
<a href="#l51.28"></a><span id="l51.28">   // Observe xpcom-shutdown event and app-idle changes</span>
<a href="#l51.29"></a><span id="l51.29">   nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l51.30"></a><span id="l51.30" class="difflineminus">-         do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l51.31"></a><span id="l51.31" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l51.32"></a><span id="l51.32"> </span>
<a href="#l51.33"></a><span id="l51.33">   rv = observerService-&gt;AddObserver(this,</span>
<a href="#l51.34"></a><span id="l51.34">                                     NS_XPCOM_SHUTDOWN_OBSERVER_ID,</span>
<a href="#l51.35"></a><span id="l51.35">                                     false);</span>
<a href="#l51.36"></a><span id="l51.36">   observerService-&gt;AddObserver(this, kAppIdleNotification, false);</span>
<a href="#l51.37"></a><span id="l51.37">   observerService-&gt;AddObserver(this, NS_IOSERVICE_OFFLINE_STATUS_TOPIC, false);</span>
<a href="#l51.38"></a><span id="l51.38">   observerService-&gt;AddObserver(this, NS_IOSERVICE_GOING_OFFLINE_TOPIC, false);</span>
<a href="#l51.39"></a><span id="l51.39">   observerService-&gt;AddObserver(this, kStartupDoneNotification, false);</span>
<a href="#l51.40"></a><span id="l51.40" class="difflineat">@@ -582,17 +583,17 @@ NS_IMETHODIMP nsAutoSyncManager::Resume(</span>
<a href="#l51.41"></a><span id="l51.41">   return NS_OK;</span>
<a href="#l51.42"></a><span id="l51.42"> }</span>
<a href="#l51.43"></a><span id="l51.43"> </span>
<a href="#l51.44"></a><span id="l51.44"> NS_IMETHODIMP nsAutoSyncManager::Observe(nsISupports*, const char *aTopic, const PRUnichar *aSomeData)</span>
<a href="#l51.45"></a><span id="l51.45"> {</span>
<a href="#l51.46"></a><span id="l51.46">   if (!PL_strcmp(aTopic, NS_XPCOM_SHUTDOWN_OBSERVER_ID))</span>
<a href="#l51.47"></a><span id="l51.47">   {</span>
<a href="#l51.48"></a><span id="l51.48">     nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l51.49"></a><span id="l51.49" class="difflineminus">-      do_GetService(&quot;@mozilla.org/observer-service;1&quot;);</span>
<a href="#l51.50"></a><span id="l51.50" class="difflineplus">+      mozilla::services::GetObserverService();</span>
<a href="#l51.51"></a><span id="l51.51">     if (observerService)</span>
<a href="#l51.52"></a><span id="l51.52">     {</span>
<a href="#l51.53"></a><span id="l51.53">       observerService-&gt;RemoveObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID);</span>
<a href="#l51.54"></a><span id="l51.54">       observerService-&gt;RemoveObserver(this, kAppIdleNotification);</span>
<a href="#l51.55"></a><span id="l51.55">       observerService-&gt;RemoveObserver(this, NS_IOSERVICE_OFFLINE_STATUS_TOPIC);</span>
<a href="#l51.56"></a><span id="l51.56">       observerService-&gt;RemoveObserver(this, NS_IOSERVICE_GOING_OFFLINE_TOPIC);</span>
<a href="#l51.57"></a><span id="l51.57">       observerService-&gt;RemoveObserver(this, kStartupDoneNotification);</span>
<a href="#l51.58"></a><span id="l51.58">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPHostSessionList.cpp</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPHostSessionList.cpp</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -42,16 +42,17 @@</span>
<a href="#l52.4"></a><span id="l52.4"> #include &quot;nsIMAPNamespace.h&quot;</span>
<a href="#l52.5"></a><span id="l52.5"> #include &quot;nsISupportsUtils.h&quot;</span>
<a href="#l52.6"></a><span id="l52.6"> #include &quot;nsIImapIncomingServer.h&quot;</span>
<a href="#l52.7"></a><span id="l52.7"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l52.8"></a><span id="l52.8"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l52.9"></a><span id="l52.9"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l52.10"></a><span id="l52.10"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l52.11"></a><span id="l52.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l52.13"></a><span id="l52.13"> </span>
<a href="#l52.14"></a><span id="l52.14"> nsIMAPHostInfo::nsIMAPHostInfo(const char *serverKey,</span>
<a href="#l52.15"></a><span id="l52.15">                                nsIImapIncomingServer *server)</span>
<a href="#l52.16"></a><span id="l52.16"> {</span>
<a href="#l52.17"></a><span id="l52.17">   fServerKey = serverKey;</span>
<a href="#l52.18"></a><span id="l52.18">   NS_ASSERTION(server, &quot;*** Fatal null imap incoming server...\n&quot;);</span>
<a href="#l52.19"></a><span id="l52.19">   server-&gt;GetServerDirectory(fOnlineDir);</span>
<a href="#l52.20"></a><span id="l52.20">   fNextHost = NULL;</span>
<a href="#l52.21"></a><span id="l52.21" class="difflineat">@@ -105,40 +106,36 @@ nsIMAPHostSessionList::nsIMAPHostSession</span>
<a href="#l52.22"></a><span id="l52.22"> nsIMAPHostSessionList::~nsIMAPHostSessionList()</span>
<a href="#l52.23"></a><span id="l52.23"> {</span>
<a href="#l52.24"></a><span id="l52.24">   ResetAll();</span>
<a href="#l52.25"></a><span id="l52.25">   PR_DestroyMonitor(gCachedHostInfoMonitor);</span>
<a href="#l52.26"></a><span id="l52.26"> }</span>
<a href="#l52.27"></a><span id="l52.27"> </span>
<a href="#l52.28"></a><span id="l52.28"> nsresult nsIMAPHostSessionList::Init()</span>
<a href="#l52.29"></a><span id="l52.29"> {</span>
<a href="#l52.30"></a><span id="l52.30" class="difflineminus">-  nsresult rv;</span>
<a href="#l52.31"></a><span id="l52.31" class="difflineminus">-  nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l52.32"></a><span id="l52.32" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l52.33"></a><span id="l52.33" class="difflineminus">-  {</span>
<a href="#l52.34"></a><span id="l52.34" class="difflineminus">-    observerService-&gt;AddObserver(this, &quot;profile-before-change&quot;, true);</span>
<a href="#l52.35"></a><span id="l52.35" class="difflineminus">-    observerService-&gt;AddObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID, true);</span>
<a href="#l52.36"></a><span id="l52.36" class="difflineminus">-  }</span>
<a href="#l52.37"></a><span id="l52.37" class="difflineminus">-  return rv;</span>
<a href="#l52.38"></a><span id="l52.38" class="difflineplus">+  nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l52.39"></a><span id="l52.39" class="difflineplus">+    mozilla::services::GetObserverService();</span>
<a href="#l52.40"></a><span id="l52.40" class="difflineplus">+  NS_ENSURE_TRUE(observerService, NS_ERROR_UNEXPECTED);</span>
<a href="#l52.41"></a><span id="l52.41" class="difflineplus">+  observerService-&gt;AddObserver(this, &quot;profile-before-change&quot;, true);</span>
<a href="#l52.42"></a><span id="l52.42" class="difflineplus">+  observerService-&gt;AddObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID, true);</span>
<a href="#l52.43"></a><span id="l52.43" class="difflineplus">+  return NS_OK;</span>
<a href="#l52.44"></a><span id="l52.44"> }</span>
<a href="#l52.45"></a><span id="l52.45"> </span>
<a href="#l52.46"></a><span id="l52.46"> </span>
<a href="#l52.47"></a><span id="l52.47"> NS_IMETHODIMP nsIMAPHostSessionList::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *someData)</span>
<a href="#l52.48"></a><span id="l52.48"> {</span>
<a href="#l52.49"></a><span id="l52.49" class="difflineminus">-  nsresult rv;</span>
<a href="#l52.50"></a><span id="l52.50">   if (!strcmp(aTopic, &quot;profile-before-change&quot;))</span>
<a href="#l52.51"></a><span id="l52.51">     ResetAll();</span>
<a href="#l52.52"></a><span id="l52.52">   else if (!strcmp(aTopic, NS_XPCOM_SHUTDOWN_OBSERVER_ID))</span>
<a href="#l52.53"></a><span id="l52.53">   {</span>
<a href="#l52.54"></a><span id="l52.54" class="difflineminus">-    nsCOMPtr&lt;nsIObserverService&gt; observerService =  do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l52.55"></a><span id="l52.55" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l52.56"></a><span id="l52.56" class="difflineminus">-    {</span>
<a href="#l52.57"></a><span id="l52.57" class="difflineminus">-      observerService-&gt;RemoveObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID);</span>
<a href="#l52.58"></a><span id="l52.58" class="difflineminus">-      observerService-&gt;RemoveObserver(this, &quot;profile-before-change&quot;);</span>
<a href="#l52.59"></a><span id="l52.59" class="difflineminus">-    }</span>
<a href="#l52.60"></a><span id="l52.60" class="difflineplus">+    nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l52.61"></a><span id="l52.61" class="difflineplus">+      mozilla::services::GetObserverService();</span>
<a href="#l52.62"></a><span id="l52.62" class="difflineplus">+    NS_ENSURE_TRUE(observerService, NS_ERROR_UNEXPECTED);</span>
<a href="#l52.63"></a><span id="l52.63" class="difflineplus">+    observerService-&gt;RemoveObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID);</span>
<a href="#l52.64"></a><span id="l52.64" class="difflineplus">+    observerService-&gt;RemoveObserver(this, &quot;profile-before-change&quot;);</span>
<a href="#l52.65"></a><span id="l52.65">   }</span>
<a href="#l52.66"></a><span id="l52.66">   return NS_OK;</span>
<a href="#l52.67"></a><span id="l52.67"> }</span>
<a href="#l52.68"></a><span id="l52.68"> </span>
<a href="#l52.69"></a><span id="l52.69"> nsIMAPHostInfo *nsIMAPHostSessionList::FindHost(const char *serverKey)</span>
<a href="#l52.70"></a><span id="l52.70"> {</span>
<a href="#l52.71"></a><span id="l52.71">   nsIMAPHostInfo *host;</span>
<a href="#l52.72"></a><span id="l52.72"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -79,16 +79,17 @@</span>
<a href="#l53.4"></a><span id="l53.4"> #include &quot;nsIMAPNamespace.h&quot;</span>
<a href="#l53.5"></a><span id="l53.5"> #include &quot;nsISignatureVerifier.h&quot;</span>
<a href="#l53.6"></a><span id="l53.6"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l53.7"></a><span id="l53.7"> #include &quot;nsITimer.h&quot;</span>
<a href="#l53.8"></a><span id="l53.8"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l53.9"></a><span id="l53.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l53.10"></a><span id="l53.10"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l53.11"></a><span id="l53.11"> #include &quot;nsCRTGlue.h&quot;</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l53.13"></a><span id="l53.13"> </span>
<a href="#l53.14"></a><span id="l53.14"> using namespace mozilla;</span>
<a href="#l53.15"></a><span id="l53.15"> </span>
<a href="#l53.16"></a><span id="l53.16"> #define PREF_TRASH_FOLDER_NAME &quot;trash_folder_name&quot;</span>
<a href="#l53.17"></a><span id="l53.17"> #define DEFAULT_TRASH_FOLDER_NAME &quot;Trash&quot;</span>
<a href="#l53.18"></a><span id="l53.18"> </span>
<a href="#l53.19"></a><span id="l53.19"> static NS_DEFINE_CID(kImapProtocolCID, NS_IMAPPROTOCOL_CID);</span>
<a href="#l53.20"></a><span id="l53.20"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l53.21"></a><span id="l53.21" class="difflineat">@@ -1972,25 +1973,23 @@ NS_IMETHODIMP  nsImapIncomingServer::FEA</span>
<a href="#l53.22"></a><span id="l53.22"> </span>
<a href="#l53.23"></a><span id="l53.23">   return AlertUser(fullMessage, aUrl);</span>
<a href="#l53.24"></a><span id="l53.24"> }</span>
<a href="#l53.25"></a><span id="l53.25"> </span>
<a href="#l53.26"></a><span id="l53.26"> #define IMAP_MSGS_URL       &quot;chrome://messenger/locale/imapMsgs.properties&quot;</span>
<a href="#l53.27"></a><span id="l53.27"> </span>
<a href="#l53.28"></a><span id="l53.28"> nsresult nsImapIncomingServer::GetStringBundle()</span>
<a href="#l53.29"></a><span id="l53.29"> {</span>
<a href="#l53.30"></a><span id="l53.30" class="difflineminus">-  nsresult res;</span>
<a href="#l53.31"></a><span id="l53.31" class="difflineminus">-  if (!m_stringBundle)</span>
<a href="#l53.32"></a><span id="l53.32" class="difflineminus">-  {</span>
<a href="#l53.33"></a><span id="l53.33" class="difflineminus">-    static const char propertyURL[] = IMAP_MSGS_URL;</span>
<a href="#l53.34"></a><span id="l53.34" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;res);</span>
<a href="#l53.35"></a><span id="l53.35" class="difflineminus">-    if (NS_SUCCEEDED(res) &amp;&amp; (nsnull != sBundleService))</span>
<a href="#l53.36"></a><span id="l53.36" class="difflineminus">-      res = sBundleService-&gt;CreateBundle(propertyURL, getter_AddRefs(m_stringBundle));</span>
<a href="#l53.37"></a><span id="l53.37" class="difflineminus">-  }</span>
<a href="#l53.38"></a><span id="l53.38" class="difflineminus">-  return (m_stringBundle) ? NS_OK : res;</span>
<a href="#l53.39"></a><span id="l53.39" class="difflineplus">+  if (m_stringBundle)</span>
<a href="#l53.40"></a><span id="l53.40" class="difflineplus">+    return NS_OK;</span>
<a href="#l53.41"></a><span id="l53.41" class="difflineplus">+</span>
<a href="#l53.42"></a><span id="l53.42" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l53.43"></a><span id="l53.43" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l53.44"></a><span id="l53.44" class="difflineplus">+  NS_ENSURE_TRUE(sBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l53.45"></a><span id="l53.45" class="difflineplus">+  return sBundleService-&gt;CreateBundle(IMAP_MSGS_URL, getter_AddRefs(m_stringBundle));</span>
<a href="#l53.46"></a><span id="l53.46"> }</span>
<a href="#l53.47"></a><span id="l53.47"> </span>
<a href="#l53.48"></a><span id="l53.48"> NS_IMETHODIMP</span>
<a href="#l53.49"></a><span id="l53.49"> nsImapIncomingServer::GetImapStringByID(PRInt32 aMsgId, nsAString&amp; aString)</span>
<a href="#l53.50"></a><span id="l53.50"> {</span>
<a href="#l53.51"></a><span id="l53.51">   nsresult res = NS_OK;</span>
<a href="#l53.52"></a><span id="l53.52">   GetStringBundle();</span>
<a href="#l53.53"></a><span id="l53.53">   if (m_stringBundle)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/imap/src/nsImapStringBundle.cpp</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapStringBundle.cpp</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -38,16 +38,17 @@</span>
<a href="#l54.4"></a><span id="l54.4"> #include &quot;prmem.h&quot;</span>
<a href="#l54.5"></a><span id="l54.5"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l54.6"></a><span id="l54.6"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l54.7"></a><span id="l54.7"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l54.8"></a><span id="l54.8"> #include &quot;nsImapStringBundle.h&quot;</span>
<a href="#l54.9"></a><span id="l54.9"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l54.10"></a><span id="l54.10"> #include &quot;nsIURI.h&quot;</span>
<a href="#l54.11"></a><span id="l54.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l54.13"></a><span id="l54.13"> </span>
<a href="#l54.14"></a><span id="l54.14"> #define IMAP_MSGS_URL       &quot;chrome://messenger/locale/imapMsgs.properties&quot;</span>
<a href="#l54.15"></a><span id="l54.15"> </span>
<a href="#l54.16"></a><span id="l54.16"> extern &quot;C&quot; </span>
<a href="#l54.17"></a><span id="l54.17"> nsresult</span>
<a href="#l54.18"></a><span id="l54.18"> IMAPGetStringByID(PRInt32 stringID, PRUnichar **aString)</span>
<a href="#l54.19"></a><span id="l54.19"> {</span>
<a href="#l54.20"></a><span id="l54.20">   nsresult res=NS_OK;</span>
<a href="#l54.21"></a><span id="l54.21" class="difflineat">@@ -57,17 +58,17 @@ IMAPGetStringByID(PRInt32 stringID, PRUn</span>
<a href="#l54.22"></a><span id="l54.22">     res = sBundle-&gt;GetStringFromID(stringID, aString);</span>
<a href="#l54.23"></a><span id="l54.23">   return res;</span>
<a href="#l54.24"></a><span id="l54.24"> }</span>
<a href="#l54.25"></a><span id="l54.25"> </span>
<a href="#l54.26"></a><span id="l54.26"> nsresult</span>
<a href="#l54.27"></a><span id="l54.27"> IMAPGetStringBundle(nsIStringBundle **aBundle)</span>
<a href="#l54.28"></a><span id="l54.28"> {</span>
<a href="#l54.29"></a><span id="l54.29">   nsresult rv=NS_OK;</span>
<a href="#l54.30"></a><span id="l54.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; stringService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l54.31"></a><span id="l54.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; stringService =</span>
<a href="#l54.33"></a><span id="l54.33" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l54.34"></a><span id="l54.34">   if (!stringService) return NS_ERROR_NULL_POINTER;</span>
<a href="#l54.35"></a><span id="l54.35">   nsCOMPtr&lt;nsIStringBundle&gt; stringBundle;</span>
<a href="#l54.36"></a><span id="l54.36">   rv = stringService-&gt;CreateBundle(IMAP_MSGS_URL, getter_AddRefs(stringBundle));</span>
<a href="#l54.37"></a><span id="l54.37">   *aBundle = stringBundle;</span>
<a href="#l54.38"></a><span id="l54.38">   NS_IF_ADDREF(*aBundle);</span>
<a href="#l54.39"></a><span id="l54.39">   return rv;</span>
<a href="#l54.40"></a><span id="l54.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -45,16 +45,17 @@</span>
<a href="#l55.4"></a><span id="l55.4"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l55.5"></a><span id="l55.5"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l55.6"></a><span id="l55.6"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l55.7"></a><span id="l55.7"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l55.8"></a><span id="l55.8"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l55.9"></a><span id="l55.9"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l55.10"></a><span id="l55.10"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l55.11"></a><span id="l55.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l55.13"></a><span id="l55.13"> </span>
<a href="#l55.14"></a><span id="l55.14"> #include &quot;nsEmlxHelperUtils.h&quot;</span>
<a href="#l55.15"></a><span id="l55.15"> #include &quot;nsAppleMailImport.h&quot;</span>
<a href="#l55.16"></a><span id="l55.16"> </span>
<a href="#l55.17"></a><span id="l55.17"> PRLogModuleInfo *APPLEMAILLOGMODULE = nsnull;</span>
<a href="#l55.18"></a><span id="l55.18"> </span>
<a href="#l55.19"></a><span id="l55.19"> // some hard-coded strings</span>
<a href="#l55.20"></a><span id="l55.20"> #define DEFAULT_MAIL_FOLDER &quot;~/Library/Mail/&quot;</span>
<a href="#l55.21"></a><span id="l55.21" class="difflineat">@@ -77,17 +78,18 @@ PRLogModuleInfo *APPLEMAILLOGMODULE = ns</span>
<a href="#l55.22"></a><span id="l55.22"> nsAppleMailImportModule::nsAppleMailImportModule()</span>
<a href="#l55.23"></a><span id="l55.23"> {</span>
<a href="#l55.24"></a><span id="l55.24">   // Init logging module.</span>
<a href="#l55.25"></a><span id="l55.25">   if (!APPLEMAILLOGMODULE)</span>
<a href="#l55.26"></a><span id="l55.26">     APPLEMAILLOGMODULE = PR_NewLogModule(&quot;APPLEMAILIMPORTLOG&quot;);</span>
<a href="#l55.27"></a><span id="l55.27"> </span>
<a href="#l55.28"></a><span id="l55.28">   IMPORT_LOG0(&quot;nsAppleMailImportModule Created&quot;);</span>
<a href="#l55.29"></a><span id="l55.29"> </span>
<a href="#l55.30"></a><span id="l55.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(NS_STRINGBUNDLE_CONTRACTID));</span>
<a href="#l55.31"></a><span id="l55.31" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l55.32"></a><span id="l55.32" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l55.33"></a><span id="l55.33">   if (bundleService)</span>
<a href="#l55.34"></a><span id="l55.34">     bundleService-&gt;CreateBundle(APPLEMAIL_MSGS_URL, getter_AddRefs(mBundle));</span>
<a href="#l55.35"></a><span id="l55.35"> }</span>
<a href="#l55.36"></a><span id="l55.36"> </span>
<a href="#l55.37"></a><span id="l55.37"> </span>
<a href="#l55.38"></a><span id="l55.38"> nsAppleMailImportModule::~nsAppleMailImportModule()</span>
<a href="#l55.39"></a><span id="l55.39"> {</span>
<a href="#l55.40"></a><span id="l55.40">   IMPORT_LOG0(&quot;nsAppleMailImportModule Deleted&quot;);</span>
<a href="#l55.41"></a><span id="l55.41" class="difflineat">@@ -162,19 +164,19 @@ NS_IMETHODIMP nsAppleMailImportModule::G</span>
<a href="#l55.42"></a><span id="l55.42"> </span>
<a href="#l55.43"></a><span id="l55.43"> nsAppleMailImportMail::nsAppleMailImportMail() : mProgress(0), mCurDepth(0)</span>
<a href="#l55.44"></a><span id="l55.44"> {</span>
<a href="#l55.45"></a><span id="l55.45">   IMPORT_LOG0(&quot;nsAppleMailImportMail created&quot;);</span>
<a href="#l55.46"></a><span id="l55.46"> }</span>
<a href="#l55.47"></a><span id="l55.47"> </span>
<a href="#l55.48"></a><span id="l55.48"> nsresult nsAppleMailImportMail::Initialize()</span>
<a href="#l55.49"></a><span id="l55.49"> {</span>
<a href="#l55.50"></a><span id="l55.50" class="difflineminus">-  nsresult rv;</span>
<a href="#l55.51"></a><span id="l55.51" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv));</span>
<a href="#l55.52"></a><span id="l55.52" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l55.53"></a><span id="l55.53" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l55.54"></a><span id="l55.54" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l55.55"></a><span id="l55.55" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l55.56"></a><span id="l55.56"> </span>
<a href="#l55.57"></a><span id="l55.57">   return bundleService-&gt;CreateBundle(APPLEMAIL_MSGS_URL, getter_AddRefs(mBundle));</span>
<a href="#l55.58"></a><span id="l55.58"> }</span>
<a href="#l55.59"></a><span id="l55.59"> </span>
<a href="#l55.60"></a><span id="l55.60"> nsAppleMailImportMail::~nsAppleMailImportMail()</span>
<a href="#l55.61"></a><span id="l55.61"> {</span>
<a href="#l55.62"></a><span id="l55.62">   IMPORT_LOG0(&quot;nsAppleMailImportMail destroyed&quot;);</span>
<a href="#l55.63"></a><span id="l55.63"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -47,16 +47,17 @@</span>
<a href="#l56.4"></a><span id="l56.4"> #include &quot;plstr.h&quot;</span>
<a href="#l56.5"></a><span id="l56.5"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l56.6"></a><span id="l56.6"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l56.7"></a><span id="l56.7"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l56.8"></a><span id="l56.8"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l56.9"></a><span id="l56.9"> #include &quot;nsIMsgFilterList.h&quot;</span>
<a href="#l56.10"></a><span id="l56.10"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l56.11"></a><span id="l56.11"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l56.13"></a><span id="l56.13"> </span>
<a href="#l56.14"></a><span id="l56.14"> #include &quot;nsEudoraFilters.h&quot;</span>
<a href="#l56.15"></a><span id="l56.15"> #include &quot;nsEudoraStringBundle.h&quot;</span>
<a href="#l56.16"></a><span id="l56.16"> </span>
<a href="#l56.17"></a><span id="l56.17"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l56.18"></a><span id="l56.18"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l56.19"></a><span id="l56.19"> #include &quot;EudoraDebugLog.h&quot;</span>
<a href="#l56.20"></a><span id="l56.20"> </span>
<a href="#l56.21"></a><span id="l56.21" class="difflineat">@@ -384,30 +385,29 @@ nsresult nsEudoraFilters::Init()</span>
<a href="#l56.22"></a><span id="l56.22">   // we need to call GetSubFolders() so that the folders get initialized</span>
<a href="#l56.23"></a><span id="l56.23">   // if they are not initialized yet.</span>
<a href="#l56.24"></a><span id="l56.24">   nsCOMPtr&lt;nsISimpleEnumerator&gt; enumerator;</span>
<a href="#l56.25"></a><span id="l56.25">   rv = localRootFolder-&gt;GetSubFolders(getter_AddRefs(enumerator));</span>
<a href="#l56.26"></a><span id="l56.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l56.27"></a><span id="l56.27"> </span>
<a href="#l56.28"></a><span id="l56.28">   // Get the name of the folder where one-off imported mail is placed</span>
<a href="#l56.29"></a><span id="l56.29">   nsAutoString folderName(NS_LITERAL_STRING(&quot;Eudora Import&quot;));</span>
<a href="#l56.30"></a><span id="l56.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(</span>
<a href="#l56.31"></a><span id="l56.31" class="difflineminus">-                                     NS_STRINGBUNDLE_CONTRACTID, &amp;rv));</span>
<a href="#l56.32"></a><span id="l56.32" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = </span>
<a href="#l56.33"></a><span id="l56.33" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l56.34"></a><span id="l56.34" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l56.35"></a><span id="l56.35" class="difflineplus">+</span>
<a href="#l56.36"></a><span id="l56.36" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l56.37"></a><span id="l56.37" class="difflineplus">+  rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/importMsgs.properties&quot;,</span>
<a href="#l56.38"></a><span id="l56.38" class="difflineplus">+                                   getter_AddRefs(bundle));</span>
<a href="#l56.39"></a><span id="l56.39">   if (NS_SUCCEEDED(rv))</span>
<a href="#l56.40"></a><span id="l56.40">   {</span>
<a href="#l56.41"></a><span id="l56.41" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l56.42"></a><span id="l56.42" class="difflineminus">-    rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/importMsgs.properties&quot;,</span>
<a href="#l56.43"></a><span id="l56.43" class="difflineminus">-                                     getter_AddRefs(bundle));</span>
<a href="#l56.44"></a><span id="l56.44" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l56.45"></a><span id="l56.45" class="difflineminus">-    {</span>
<a href="#l56.46"></a><span id="l56.46" class="difflineminus">-      nsAutoString Eudora(NS_LITERAL_STRING(&quot;Eudora&quot;));</span>
<a href="#l56.47"></a><span id="l56.47" class="difflineminus">-      const PRUnichar *moduleName[] = { Eudora.get() };</span>
<a href="#l56.48"></a><span id="l56.48" class="difflineminus">-      rv = bundle-&gt;FormatStringFromName(NS_LITERAL_STRING(&quot;ImportModuleFolderName&quot;).get(),</span>
<a href="#l56.49"></a><span id="l56.49" class="difflineminus">-                                        moduleName, 1, getter_Copies(folderName));</span>
<a href="#l56.50"></a><span id="l56.50" class="difflineminus">-    }</span>
<a href="#l56.51"></a><span id="l56.51" class="difflineplus">+    nsAutoString Eudora(NS_LITERAL_STRING(&quot;Eudora&quot;));</span>
<a href="#l56.52"></a><span id="l56.52" class="difflineplus">+    const PRUnichar *moduleName[] = { Eudora.get() };</span>
<a href="#l56.53"></a><span id="l56.53" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(NS_LITERAL_STRING(&quot;ImportModuleFolderName&quot;).get(),</span>
<a href="#l56.54"></a><span id="l56.54" class="difflineplus">+                                      moduleName, 1, getter_Copies(folderName));</span>
<a href="#l56.55"></a><span id="l56.55">   }</span>
<a href="#l56.56"></a><span id="l56.56">   localRootFolder-&gt;GetChildNamed(folderName, getter_AddRefs(m_pMailboxesRoot));</span>
<a href="#l56.57"></a><span id="l56.57">   if (!m_pMailboxesRoot)</span>
<a href="#l56.58"></a><span id="l56.58">   {</span>
<a href="#l56.59"></a><span id="l56.59">     // If no &quot;Eudora Import&quot; folder then this is a</span>
<a href="#l56.60"></a><span id="l56.60">     // migration which just puts it in the root</span>
<a href="#l56.61"></a><span id="l56.61">     m_pMailboxesRoot = localRootFolder;</span>
<a href="#l56.62"></a><span id="l56.62">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraStringBundle.cpp</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraStringBundle.cpp</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -40,34 +40,34 @@</span>
<a href="#l57.4"></a><span id="l57.4"> #include &quot;prprf.h&quot;</span>
<a href="#l57.5"></a><span id="l57.5"> #include &quot;prmem.h&quot;</span>
<a href="#l57.6"></a><span id="l57.6"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l57.7"></a><span id="l57.7"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l57.8"></a><span id="l57.8"> #include &quot;nsEudoraStringBundle.h&quot;</span>
<a href="#l57.9"></a><span id="l57.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l57.10"></a><span id="l57.10"> #include &quot;nsIURI.h&quot;</span>
<a href="#l57.11"></a><span id="l57.11"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l57.13"></a><span id="l57.13"> </span>
<a href="#l57.14"></a><span id="l57.14"> #define EUDORA_MSGS_URL       &quot;chrome://messenger/locale/eudoraImportMsgs.properties&quot;</span>
<a href="#l57.15"></a><span id="l57.15"> </span>
<a href="#l57.16"></a><span id="l57.16"> nsIStringBundle *  nsEudoraStringBundle::m_pBundle = nsnull;</span>
<a href="#l57.17"></a><span id="l57.17"> </span>
<a href="#l57.18"></a><span id="l57.18"> nsIStringBundle *nsEudoraStringBundle::GetStringBundle( void)</span>
<a href="#l57.19"></a><span id="l57.19"> {</span>
<a href="#l57.20"></a><span id="l57.20">   if (m_pBundle)</span>
<a href="#l57.21"></a><span id="l57.21">     return m_pBundle;</span>
<a href="#l57.22"></a><span id="l57.22"> </span>
<a href="#l57.23"></a><span id="l57.23" class="difflineminus">-  nsresult          rv;</span>
<a href="#l57.24"></a><span id="l57.24">   const char*       propertyURL = EUDORA_MSGS_URL;</span>
<a href="#l57.25"></a><span id="l57.25">   nsIStringBundle*  sBundle = nsnull;</span>
<a href="#l57.26"></a><span id="l57.26"> </span>
<a href="#l57.27"></a><span id="l57.27">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l57.28"></a><span id="l57.28" class="difflineminus">-           do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l57.29"></a><span id="l57.29" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; (nsnull != sBundleService))</span>
<a href="#l57.30"></a><span id="l57.30" class="difflineminus">-    rv = sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l57.31"></a><span id="l57.31" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l57.32"></a><span id="l57.32" class="difflineplus">+  if (sBundleService)</span>
<a href="#l57.33"></a><span id="l57.33" class="difflineplus">+    sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l57.34"></a><span id="l57.34"> </span>
<a href="#l57.35"></a><span id="l57.35">   m_pBundle = sBundle;</span>
<a href="#l57.36"></a><span id="l57.36">   return( sBundle);</span>
<a href="#l57.37"></a><span id="l57.37"> }</span>
<a href="#l57.38"></a><span id="l57.38"> </span>
<a href="#l57.39"></a><span id="l57.39"> void nsEudoraStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result)</span>
<a href="#l57.40"></a><span id="l57.40"> {</span>
<a href="#l57.41"></a><span id="l57.41"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEStringBundle.cpp</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEStringBundle.cpp</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -37,35 +37,34 @@</span>
<a href="#l58.4"></a><span id="l58.4"> #include &quot;prprf.h&quot;</span>
<a href="#l58.5"></a><span id="l58.5"> #include &quot;prmem.h&quot;</span>
<a href="#l58.6"></a><span id="l58.6"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l58.7"></a><span id="l58.7"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l58.8"></a><span id="l58.8"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l58.9"></a><span id="l58.9"> #include &quot;nsOEStringBundle.h&quot;</span>
<a href="#l58.10"></a><span id="l58.10"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l58.11"></a><span id="l58.11"> #include &quot;nsIURI.h&quot;</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l58.13"></a><span id="l58.13"> </span>
<a href="#l58.14"></a><span id="l58.14"> #define OE_MSGS_URL       &quot;chrome://messenger/locale/oeImportMsgs.properties&quot;</span>
<a href="#l58.15"></a><span id="l58.15"> </span>
<a href="#l58.16"></a><span id="l58.16"> nsIStringBundle *  nsOEStringBundle::m_pBundle = nsnull;</span>
<a href="#l58.17"></a><span id="l58.17"> </span>
<a href="#l58.18"></a><span id="l58.18"> nsIStringBundle *nsOEStringBundle::GetStringBundle( void)</span>
<a href="#l58.19"></a><span id="l58.19"> {</span>
<a href="#l58.20"></a><span id="l58.20">   if (m_pBundle)</span>
<a href="#l58.21"></a><span id="l58.21">     return( m_pBundle);</span>
<a href="#l58.22"></a><span id="l58.22"> </span>
<a href="#l58.23"></a><span id="l58.23" class="difflineminus">-  nsresult      rv;</span>
<a href="#l58.24"></a><span id="l58.24">   char*        propertyURL = OE_MSGS_URL;</span>
<a href="#l58.25"></a><span id="l58.25">   nsIStringBundle*  sBundle = nsnull;</span>
<a href="#l58.26"></a><span id="l58.26"> </span>
<a href="#l58.27"></a><span id="l58.27" class="difflineminus">-</span>
<a href="#l58.28"></a><span id="l58.28">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l58.29"></a><span id="l58.29" class="difflineminus">-           do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l58.30"></a><span id="l58.30" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; (nsnull != sBundleService)) {</span>
<a href="#l58.31"></a><span id="l58.31" class="difflineminus">-    rv = sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l58.32"></a><span id="l58.32" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l58.33"></a><span id="l58.33" class="difflineplus">+  if (sBundleService) {</span>
<a href="#l58.34"></a><span id="l58.34" class="difflineplus">+    sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l58.35"></a><span id="l58.35">   }</span>
<a href="#l58.36"></a><span id="l58.36"> </span>
<a href="#l58.37"></a><span id="l58.37">   m_pBundle = sBundle;</span>
<a href="#l58.38"></a><span id="l58.38"> </span>
<a href="#l58.39"></a><span id="l58.39">   return( sBundle);</span>
<a href="#l58.40"></a><span id="l58.40"> }</span>
<a href="#l58.41"></a><span id="l58.41"> </span>
<a href="#l58.42"></a><span id="l58.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookStringBundle.cpp</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookStringBundle.cpp</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -37,35 +37,34 @@</span>
<a href="#l59.4"></a><span id="l59.4"> #include &quot;prprf.h&quot;</span>
<a href="#l59.5"></a><span id="l59.5"> #include &quot;prmem.h&quot;</span>
<a href="#l59.6"></a><span id="l59.6"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l59.7"></a><span id="l59.7"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l59.8"></a><span id="l59.8"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l59.9"></a><span id="l59.9"> #include &quot;nsOutlookStringBundle.h&quot;</span>
<a href="#l59.10"></a><span id="l59.10"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l59.11"></a><span id="l59.11"> #include &quot;nsIURI.h&quot;</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l59.13"></a><span id="l59.13"> </span>
<a href="#l59.14"></a><span id="l59.14"> #define OUTLOOK_MSGS_URL       &quot;chrome://messenger/locale/outlookImportMsgs.properties&quot;</span>
<a href="#l59.15"></a><span id="l59.15"> </span>
<a href="#l59.16"></a><span id="l59.16"> nsIStringBundle *  nsOutlookStringBundle::m_pBundle = nsnull;</span>
<a href="#l59.17"></a><span id="l59.17"> </span>
<a href="#l59.18"></a><span id="l59.18"> nsIStringBundle *nsOutlookStringBundle::GetStringBundle( void)</span>
<a href="#l59.19"></a><span id="l59.19"> {</span>
<a href="#l59.20"></a><span id="l59.20">   if (m_pBundle)</span>
<a href="#l59.21"></a><span id="l59.21">     return m_pBundle;</span>
<a href="#l59.22"></a><span id="l59.22"> </span>
<a href="#l59.23"></a><span id="l59.23" class="difflineminus">-  nsresult      rv;</span>
<a href="#l59.24"></a><span id="l59.24">   char*        propertyURL = OUTLOOK_MSGS_URL;</span>
<a href="#l59.25"></a><span id="l59.25">   nsIStringBundle*  sBundle = nsnull;</span>
<a href="#l59.26"></a><span id="l59.26"> </span>
<a href="#l59.27"></a><span id="l59.27" class="difflineminus">-</span>
<a href="#l59.28"></a><span id="l59.28">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l59.29"></a><span id="l59.29" class="difflineminus">-           do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l59.30"></a><span id="l59.30" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; (nsnull != sBundleService)) {</span>
<a href="#l59.31"></a><span id="l59.31" class="difflineminus">-    rv = sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l59.32"></a><span id="l59.32" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l59.33"></a><span id="l59.33" class="difflineplus">+  if (sBundleService) {</span>
<a href="#l59.34"></a><span id="l59.34" class="difflineplus">+    sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l59.35"></a><span id="l59.35">   }</span>
<a href="#l59.36"></a><span id="l59.36"> </span>
<a href="#l59.37"></a><span id="l59.37">   m_pBundle = sBundle;</span>
<a href="#l59.38"></a><span id="l59.38"> </span>
<a href="#l59.39"></a><span id="l59.39">   return( sBundle);</span>
<a href="#l59.40"></a><span id="l59.40"> }</span>
<a href="#l59.41"></a><span id="l59.41"> </span>
<a href="#l59.42"></a><span id="l59.42"> void nsOutlookStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -68,16 +68,17 @@</span>
<a href="#l60.4"></a><span id="l60.4"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l60.5"></a><span id="l60.5"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l60.6"></a><span id="l60.6"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l60.7"></a><span id="l60.7"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l60.8"></a><span id="l60.8"> #include &quot;ImportDebug.h&quot;</span>
<a href="#l60.9"></a><span id="l60.9"> #include &quot;plstr.h&quot;</span>
<a href="#l60.10"></a><span id="l60.10"> #include &quot;MailNewsTypes.h&quot;</span>
<a href="#l60.11"></a><span id="l60.11"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l60.13"></a><span id="l60.13"> </span>
<a href="#l60.14"></a><span id="l60.14"> #define IMPORT_MSGS_URL       &quot;chrome://messenger/locale/importMsgs.properties&quot;</span>
<a href="#l60.15"></a><span id="l60.15"> </span>
<a href="#l60.16"></a><span id="l60.16"> ////////////////////////////////////////////////////////////////////////</span>
<a href="#l60.17"></a><span id="l60.17"> </span>
<a href="#l60.18"></a><span id="l60.18"> static void ImportMailThread( void *stuff);</span>
<a href="#l60.19"></a><span id="l60.19"> </span>
<a href="#l60.20"></a><span id="l60.20"> class ImportThreadData;</span>
<a href="#l60.21"></a><span id="l60.21" class="difflineat">@@ -938,19 +939,19 @@ ImportMailThread( void *stuff)</span>
<a href="#l60.22"></a><span id="l60.22"> // Creates a folder in Local Folders with the module name + mail</span>
<a href="#l60.23"></a><span id="l60.23"> // for e.g: Outlook Mail</span>
<a href="#l60.24"></a><span id="l60.24"> bool nsImportGenericMail::CreateFolder( nsIMsgFolder **ppFolder)</span>
<a href="#l60.25"></a><span id="l60.25"> {</span>
<a href="#l60.26"></a><span id="l60.26">   nsresult rv;</span>
<a href="#l60.27"></a><span id="l60.27">   *ppFolder = nsnull;</span>
<a href="#l60.28"></a><span id="l60.28"> </span>
<a href="#l60.29"></a><span id="l60.29">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l60.30"></a><span id="l60.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(</span>
<a href="#l60.31"></a><span id="l60.31" class="difflineminus">-                                     NS_STRINGBUNDLE_CONTRACTID, &amp;rv));</span>
<a href="#l60.32"></a><span id="l60.32" class="difflineminus">-  if (NS_FAILED(rv) || !bundleService)</span>
<a href="#l60.33"></a><span id="l60.33" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l60.34"></a><span id="l60.34" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l60.35"></a><span id="l60.35" class="difflineplus">+  if (!bundleService)</span>
<a href="#l60.36"></a><span id="l60.36">       return false;</span>
<a href="#l60.37"></a><span id="l60.37">   rv = bundleService-&gt;CreateBundle(IMPORT_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l60.38"></a><span id="l60.38">   if (NS_FAILED(rv))</span>
<a href="#l60.39"></a><span id="l60.39">       return false;</span>
<a href="#l60.40"></a><span id="l60.40">   nsString folderName;</span>
<a href="#l60.41"></a><span id="l60.41">   if (!m_pName.IsEmpty()) {</span>
<a href="#l60.42"></a><span id="l60.42">     const PRUnichar *moduleName[] = { m_pName.get() };</span>
<a href="#l60.43"></a><span id="l60.43">     rv = bundle-&gt;FormatStringFromName(NS_LITERAL_STRING(&quot;ImportModuleFolderName&quot;).get(),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/import/src/nsImportStringBundle.cpp</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/import/src/nsImportStringBundle.cpp</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -38,27 +38,27 @@</span>
<a href="#l61.4"></a><span id="l61.4"> #include &quot;prmem.h&quot;</span>
<a href="#l61.5"></a><span id="l61.5"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l61.6"></a><span id="l61.6"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l61.7"></a><span id="l61.7"> #include &quot;nsImportStringBundle.h&quot;</span>
<a href="#l61.8"></a><span id="l61.8"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l61.9"></a><span id="l61.9"> #include &quot;nsIURI.h&quot;</span>
<a href="#l61.10"></a><span id="l61.10"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l61.11"></a><span id="l61.11"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l61.13"></a><span id="l61.13"> </span>
<a href="#l61.14"></a><span id="l61.14"> nsresult nsImportStringBundle::GetStringBundle(const char *aPropertyURL,</span>
<a href="#l61.15"></a><span id="l61.15">                                                nsIStringBundle **aBundle)</span>
<a href="#l61.16"></a><span id="l61.16"> {</span>
<a href="#l61.17"></a><span id="l61.17">   nsresult rv;</span>
<a href="#l61.18"></a><span id="l61.18"> </span>
<a href="#l61.19"></a><span id="l61.19">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l61.20"></a><span id="l61.20" class="difflineminus">-           do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l61.21"></a><span id="l61.21" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; (nsnull != sBundleService)) {</span>
<a href="#l61.22"></a><span id="l61.22" class="difflineminus">-    rv = sBundleService-&gt;CreateBundle(aPropertyURL, aBundle);</span>
<a href="#l61.23"></a><span id="l61.23" class="difflineminus">-  }</span>
<a href="#l61.24"></a><span id="l61.24" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l61.25"></a><span id="l61.25" class="difflineplus">+  NS_ENSURE_TRUE(sBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l61.26"></a><span id="l61.26" class="difflineplus">+  rv = sBundleService-&gt;CreateBundle(aPropertyURL, aBundle);</span>
<a href="#l61.27"></a><span id="l61.27"> </span>
<a href="#l61.28"></a><span id="l61.28">   return rv;</span>
<a href="#l61.29"></a><span id="l61.29"> }</span>
<a href="#l61.30"></a><span id="l61.30"> </span>
<a href="#l61.31"></a><span id="l61.31"> void nsImportStringBundle::GetStringByID(PRInt32 aStringID,</span>
<a href="#l61.32"></a><span id="l61.32">                                          nsIStringBundle *aBundle,</span>
<a href="#l61.33"></a><span id="l61.33">                                          nsString &amp;aResult)</span>
<a href="#l61.34"></a><span id="l61.34"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMStringBundle.cpp</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMStringBundle.cpp</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -37,34 +37,34 @@</span>
<a href="#l62.4"></a><span id="l62.4"> #include &quot;prprf.h&quot;</span>
<a href="#l62.5"></a><span id="l62.5"> #include &quot;prmem.h&quot;</span>
<a href="#l62.6"></a><span id="l62.6"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l62.7"></a><span id="l62.7"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l62.8"></a><span id="l62.8"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l62.9"></a><span id="l62.9"> #include &quot;nsWMStringBundle.h&quot;</span>
<a href="#l62.10"></a><span id="l62.10"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l62.11"></a><span id="l62.11"> #include &quot;nsIURI.h&quot;</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l62.13"></a><span id="l62.13"> </span>
<a href="#l62.14"></a><span id="l62.14"> #define WM_MSGS_URL       &quot;chrome://messenger/locale/wmImportMsgs.properties&quot;</span>
<a href="#l62.15"></a><span id="l62.15"> </span>
<a href="#l62.16"></a><span id="l62.16"> nsIStringBundle *  nsWMStringBundle::m_pBundle = nsnull;</span>
<a href="#l62.17"></a><span id="l62.17"> </span>
<a href="#l62.18"></a><span id="l62.18"> nsIStringBundle *nsWMStringBundle::GetStringBundle( void)</span>
<a href="#l62.19"></a><span id="l62.19"> {</span>
<a href="#l62.20"></a><span id="l62.20">   if (m_pBundle)</span>
<a href="#l62.21"></a><span id="l62.21">     return( m_pBundle);</span>
<a href="#l62.22"></a><span id="l62.22"> </span>
<a href="#l62.23"></a><span id="l62.23" class="difflineminus">-  nsresult      rv;</span>
<a href="#l62.24"></a><span id="l62.24">   char*        propertyURL = WM_MSGS_URL;</span>
<a href="#l62.25"></a><span id="l62.25">   nsIStringBundle*  sBundle = nsnull;</span>
<a href="#l62.26"></a><span id="l62.26"> </span>
<a href="#l62.27"></a><span id="l62.27">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l62.28"></a><span id="l62.28" class="difflineminus">-           do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l62.29"></a><span id="l62.29" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; (nsnull != sBundleService)) {</span>
<a href="#l62.30"></a><span id="l62.30" class="difflineminus">-    rv = sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l62.31"></a><span id="l62.31" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l62.32"></a><span id="l62.32" class="difflineplus">+  if (sBundleService) {</span>
<a href="#l62.33"></a><span id="l62.33" class="difflineplus">+    sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l62.34"></a><span id="l62.34">   }</span>
<a href="#l62.35"></a><span id="l62.35"> </span>
<a href="#l62.36"></a><span id="l62.36">   m_pBundle = sBundle;</span>
<a href="#l62.37"></a><span id="l62.37"> </span>
<a href="#l62.38"></a><span id="l62.38">   return( sBundle);</span>
<a href="#l62.39"></a><span id="l62.39"> }</span>
<a href="#l62.40"></a><span id="l62.40"> </span>
<a href="#l62.41"></a><span id="l62.41"> void nsWMStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -105,16 +105,17 @@</span>
<a href="#l63.4"></a><span id="l63.4"> #include &quot;nsIRssIncomingServer.h&quot;</span>
<a href="#l63.5"></a><span id="l63.5"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l63.6"></a><span id="l63.6"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l63.7"></a><span id="l63.7"> #include &quot;nsReadLine.h&quot;</span>
<a href="#l63.8"></a><span id="l63.8"> #include &quot;nsLocalStrings.h&quot;</span>
<a href="#l63.9"></a><span id="l63.9"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l63.10"></a><span id="l63.10"> #include &quot;nsIMsgTraitService.h&quot;</span>
<a href="#l63.11"></a><span id="l63.11"> #include &quot;nsIStringEnumerator.h&quot;</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l63.13"></a><span id="l63.13"> </span>
<a href="#l63.14"></a><span id="l63.14"> //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l63.15"></a><span id="l63.15"> // nsLocal</span>
<a href="#l63.16"></a><span id="l63.16"> /////////////////////////////////////////////////////////////////////////////</span>
<a href="#l63.17"></a><span id="l63.17"> </span>
<a href="#l63.18"></a><span id="l63.18"> nsLocalMailCopyState::nsLocalMailCopyState() :</span>
<a href="#l63.19"></a><span id="l63.19">   m_flags(0),</span>
<a href="#l63.20"></a><span id="l63.20">   m_curDstKey(0xffffffff),</span>
<a href="#l63.21"></a><span id="l63.21" class="difflineat">@@ -873,18 +874,19 @@ nsresult nsMsgLocalMailFolder::ConfirmFo</span>
<a href="#l63.22"></a><span id="l63.22">   {</span>
<a href="#l63.23"></a><span id="l63.23">     bool confirmDeletion = true;</span>
<a href="#l63.24"></a><span id="l63.24">     nsresult rv;</span>
<a href="#l63.25"></a><span id="l63.25">     nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l63.26"></a><span id="l63.26">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l63.27"></a><span id="l63.27">     pPrefBranch-&gt;GetBoolPref(&quot;mailnews.confirm.moveFoldersToTrash&quot;, &amp;confirmDeletion);</span>
<a href="#l63.28"></a><span id="l63.28">     if (confirmDeletion)</span>
<a href="#l63.29"></a><span id="l63.29">     {</span>
<a href="#l63.30"></a><span id="l63.30" class="difflineminus">-      nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l63.31"></a><span id="l63.31" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l63.32"></a><span id="l63.32" class="difflineplus">+      nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l63.33"></a><span id="l63.33" class="difflineplus">+        mozilla::services::GetStringBundleService();</span>
<a href="#l63.34"></a><span id="l63.34" class="difflineplus">+      NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l63.35"></a><span id="l63.35">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l63.36"></a><span id="l63.36">       rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l63.37"></a><span id="l63.37">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l63.38"></a><span id="l63.38"> </span>
<a href="#l63.39"></a><span id="l63.39">       nsAutoString folderName;</span>
<a href="#l63.40"></a><span id="l63.40">       rv = aFolder-&gt;GetName(folderName);</span>
<a href="#l63.41"></a><span id="l63.41">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l63.42"></a><span id="l63.42">       const PRUnichar *formatStrings[1] = { folderName.get() };</span>
<a href="#l63.43"></a><span id="l63.43" class="difflineat">@@ -3190,18 +3192,19 @@ nsresult nsMsgLocalMailFolder::DisplayMo</span>
<a href="#l63.44"></a><span id="l63.44">       if (!msgWindow)</span>
<a href="#l63.45"></a><span id="l63.45">         return NS_OK; // not a fatal error.</span>
<a href="#l63.46"></a><span id="l63.46"> </span>
<a href="#l63.47"></a><span id="l63.47">       msgWindow-&gt;GetStatusFeedback(getter_AddRefs(mCopyState-&gt;m_statusFeedback));</span>
<a href="#l63.48"></a><span id="l63.48">     }</span>
<a href="#l63.49"></a><span id="l63.49"> </span>
<a href="#l63.50"></a><span id="l63.50">     if (!mCopyState-&gt;m_stringBundle)</span>
<a href="#l63.51"></a><span id="l63.51">     {</span>
<a href="#l63.52"></a><span id="l63.52" class="difflineminus">-      nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l63.53"></a><span id="l63.53" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l63.54"></a><span id="l63.54" class="difflineplus">+      nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l63.55"></a><span id="l63.55" class="difflineplus">+        mozilla::services::GetStringBundleService();</span>
<a href="#l63.56"></a><span id="l63.56" class="difflineplus">+      NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l63.57"></a><span id="l63.57">       rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(mCopyState-&gt;m_stringBundle));</span>
<a href="#l63.58"></a><span id="l63.58">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l63.59"></a><span id="l63.59">     }</span>
<a href="#l63.60"></a><span id="l63.60">     if (mCopyState-&gt;m_statusFeedback &amp;&amp; mCopyState-&gt;m_stringBundle)</span>
<a href="#l63.61"></a><span id="l63.61">     {</span>
<a href="#l63.62"></a><span id="l63.62">       nsString folderName;</span>
<a href="#l63.63"></a><span id="l63.63">       GetName(folderName);</span>
<a href="#l63.64"></a><span id="l63.64">       PRInt32 statusMsgId = (mCopyState-&gt;m_isMove) ? MOVING_MSGS_STATUS : COPYING_MSGS_STATUS;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxUrl.cpp</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxUrl.cpp</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -59,17 +59,17 @@</span>
<a href="#l64.4"></a><span id="l64.4"> </span>
<a href="#l64.5"></a><span id="l64.5"> // this is totally lame and MUST be removed by M6</span>
<a href="#l64.6"></a><span id="l64.6"> // the real fix is to attach the URI to the URL as it runs through netlib</span>
<a href="#l64.7"></a><span id="l64.7"> // then grab it and use it on the other side</span>
<a href="#l64.8"></a><span id="l64.8"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l64.9"></a><span id="l64.9"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l64.10"></a><span id="l64.10"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l64.11"></a><span id="l64.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l64.14"></a><span id="l64.14"> </span>
<a href="#l64.15"></a><span id="l64.15"> // helper function for parsing the search field of a url</span>
<a href="#l64.16"></a><span id="l64.16"> char * extractAttributeValue(const char * searchString, const char * attributeName);</span>
<a href="#l64.17"></a><span id="l64.17"> </span>
<a href="#l64.18"></a><span id="l64.18"> nsMailboxUrl::nsMailboxUrl()</span>
<a href="#l64.19"></a><span id="l64.19"> {</span>
<a href="#l64.20"></a><span id="l64.20">   m_mailboxAction = nsIMailboxUrl::ActionParseMailbox;</span>
<a href="#l64.21"></a><span id="l64.21">   m_filePath = nsnull;</span>
<a href="#l64.22"></a><span id="l64.22" class="difflineat">@@ -378,18 +378,19 @@ nsresult nsMailboxUrl::ParseUrl()</span>
<a href="#l64.23"></a><span id="l64.23">   // is creating an empty &quot;mailbox://&quot; uri for every message.</span>
<a href="#l64.24"></a><span id="l64.24">   if (m_file.Length() &lt; 2)</span>
<a href="#l64.25"></a><span id="l64.25">     m_filePath = nsnull;</span>
<a href="#l64.26"></a><span id="l64.26">   else</span>
<a href="#l64.27"></a><span id="l64.27">   {</span>
<a href="#l64.28"></a><span id="l64.28">     nsCString fileUri(&quot;file://&quot;);</span>
<a href="#l64.29"></a><span id="l64.29">     fileUri.Append(m_file);</span>
<a href="#l64.30"></a><span id="l64.30">     nsresult rv;</span>
<a href="#l64.31"></a><span id="l64.31" class="difflineminus">-    nsCOMPtr&lt;nsIIOService&gt; ioService = do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l64.32"></a><span id="l64.32" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l64.33"></a><span id="l64.33" class="difflineplus">+    nsCOMPtr&lt;nsIIOService&gt; ioService =</span>
<a href="#l64.34"></a><span id="l64.34" class="difflineplus">+      mozilla::services::GetIOService();</span>
<a href="#l64.35"></a><span id="l64.35" class="difflineplus">+    NS_ENSURE_TRUE(ioService, NS_ERROR_UNEXPECTED);</span>
<a href="#l64.36"></a><span id="l64.36">     nsCOMPtr &lt;nsIURI&gt; uri;</span>
<a href="#l64.37"></a><span id="l64.37">     rv = ioService-&gt;NewURI(fileUri, nsnull, nsnull, getter_AddRefs(uri));</span>
<a href="#l64.38"></a><span id="l64.38">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l64.39"></a><span id="l64.39">     nsCOMPtr &lt;nsIFileURL&gt; fileURL = do_QueryInterface(uri);</span>
<a href="#l64.40"></a><span id="l64.40">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l64.41"></a><span id="l64.41">     nsCOMPtr &lt;nsIFile&gt; fileURLFile;</span>
<a href="#l64.42"></a><span id="l64.42">     fileURL-&gt;GetFile(getter_AddRefs(fileURLFile));</span>
<a href="#l64.43"></a><span id="l64.43">     m_filePath = do_QueryInterface(fileURLFile, &amp;rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -69,16 +69,17 @@</span>
<a href="#l65.4"></a><span id="l65.4"> </span>
<a href="#l65.5"></a><span id="l65.5"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l65.6"></a><span id="l65.6"> #include &quot;nsISeekableStream.h&quot;</span>
<a href="#l65.7"></a><span id="l65.7"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l65.8"></a><span id="l65.8"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l65.9"></a><span id="l65.9"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l65.10"></a><span id="l65.10"> #include &quot;nsLocalStrings.h&quot;</span>
<a href="#l65.11"></a><span id="l65.11"> #include &quot;nsIMsgPluggableStore.h&quot;</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l65.13"></a><span id="l65.13"> </span>
<a href="#l65.14"></a><span id="l65.14"> #include &quot;prlog.h&quot;</span>
<a href="#l65.15"></a><span id="l65.15"> #if defined(PR_LOGGING)</span>
<a href="#l65.16"></a><span id="l65.16"> //</span>
<a href="#l65.17"></a><span id="l65.17"> // export NSPR_LOG_MODULES=Movemail:5</span>
<a href="#l65.18"></a><span id="l65.18"> //</span>
<a href="#l65.19"></a><span id="l65.19"> static PRLogModuleInfo *gMovemailLog = nsnull;</span>
<a href="#l65.20"></a><span id="l65.20"> #define LOG(args) PR_LOG(gMovemailLog, PR_LOG_DEBUG, args)</span>
<a href="#l65.21"></a><span id="l65.21" class="difflineat">@@ -133,18 +134,19 @@ nsMovemailService::Error(PRInt32 errorCo</span>
<a href="#l65.22"></a><span id="l65.22"> {</span>
<a href="#l65.23"></a><span id="l65.23">   if (!mMsgWindow) return;</span>
<a href="#l65.24"></a><span id="l65.24"> </span>
<a href="#l65.25"></a><span id="l65.25">   nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l65.26"></a><span id="l65.26">   nsresult rv = mMsgWindow-&gt;GetPromptDialog(getter_AddRefs(dialog));</span>
<a href="#l65.27"></a><span id="l65.27">   if (NS_FAILED(rv))</span>
<a href="#l65.28"></a><span id="l65.28">     return;</span>
<a href="#l65.29"></a><span id="l65.29"> </span>
<a href="#l65.30"></a><span id="l65.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l65.31"></a><span id="l65.31" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l65.32"></a><span id="l65.32" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l65.33"></a><span id="l65.33" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l65.34"></a><span id="l65.34" class="difflineplus">+  if (!bundleService)</span>
<a href="#l65.35"></a><span id="l65.35">     return;</span>
<a href="#l65.36"></a><span id="l65.36">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l65.37"></a><span id="l65.37">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l65.38"></a><span id="l65.38">   if (NS_FAILED(rv))</span>
<a href="#l65.39"></a><span id="l65.39">     return;</span>
<a href="#l65.40"></a><span id="l65.40"> </span>
<a href="#l65.41"></a><span id="l65.41">   nsString errStr;</span>
<a href="#l65.42"></a><span id="l65.42">   // Format the error string if necessary</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -89,16 +89,17 @@</span>
<a href="#l66.4"></a><span id="l66.4"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l66.5"></a><span id="l66.5"> #include &quot;nsLocalStrings.h&quot;</span>
<a href="#l66.6"></a><span id="l66.6"> #include &quot;nsIMsgFilterPlugin.h&quot;</span>
<a href="#l66.7"></a><span id="l66.7"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l66.8"></a><span id="l66.8"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l66.9"></a><span id="l66.9"> #include &quot;nsIMsgFilterCustomAction.h&quot;</span>
<a href="#l66.10"></a><span id="l66.10"> #include &lt;ctype.h&gt;</span>
<a href="#l66.11"></a><span id="l66.11"> #include &quot;nsIMsgPluggableStore.h&quot;</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l66.13"></a><span id="l66.13"> </span>
<a href="#l66.14"></a><span id="l66.14"> static NS_DEFINE_CID(kCMailDB, NS_MAILDB_CID);</span>
<a href="#l66.15"></a><span id="l66.15"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l66.16"></a><span id="l66.16"> </span>
<a href="#l66.17"></a><span id="l66.17"> /* the following macros actually implement addref, release and query interface for our component. */</span>
<a href="#l66.18"></a><span id="l66.18"> NS_IMPL_ISUPPORTS_INHERITED2(nsMsgMailboxParser,</span>
<a href="#l66.19"></a><span id="l66.19">                              nsParseMailMessageState,</span>
<a href="#l66.20"></a><span id="l66.20">                              nsIStreamListener,</span>
<a href="#l66.21"></a><span id="l66.21" class="difflineat">@@ -121,17 +122,19 @@ NS_IMETHODIMP nsMsgMailboxParser::OnStar</span>
<a href="#l66.22"></a><span id="l66.22">     m_startTime = PR_Now();</span>
<a href="#l66.23"></a><span id="l66.23"> </span>
<a href="#l66.24"></a><span id="l66.24"> </span>
<a href="#l66.25"></a><span id="l66.25">     // extract the appropriate event sinks from the url and initialize them in our protocol data</span>
<a href="#l66.26"></a><span id="l66.26">     // the URL should be queried for a nsIMailboxURL. If it doesn't support a mailbox URL interface then</span>
<a href="#l66.27"></a><span id="l66.27">     // we have an error.</span>
<a href="#l66.28"></a><span id="l66.28">     nsresult rv = NS_OK;</span>
<a href="#l66.29"></a><span id="l66.29"> </span>
<a href="#l66.30"></a><span id="l66.30" class="difflineminus">-    nsCOMPtr&lt;nsIIOService&gt; ioServ(do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l66.31"></a><span id="l66.31" class="difflineplus">+    nsCOMPtr&lt;nsIIOService&gt; ioServ =</span>
<a href="#l66.32"></a><span id="l66.32" class="difflineplus">+      mozilla::services::GetIOService();</span>
<a href="#l66.33"></a><span id="l66.33" class="difflineplus">+    NS_ENSURE_TRUE(ioServ, NS_ERROR_UNEXPECTED);</span>
<a href="#l66.34"></a><span id="l66.34"> </span>
<a href="#l66.35"></a><span id="l66.35">     nsCOMPtr&lt;nsIMailboxUrl&gt; runningUrl = do_QueryInterface(ctxt, &amp;rv);</span>
<a href="#l66.36"></a><span id="l66.36"> </span>
<a href="#l66.37"></a><span id="l66.37">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; url = do_QueryInterface(ctxt);</span>
<a href="#l66.38"></a><span id="l66.38">     nsCOMPtr&lt;nsIMsgFolder&gt; folder = do_QueryReferent(m_folder);</span>
<a href="#l66.39"></a><span id="l66.39"> </span>
<a href="#l66.40"></a><span id="l66.40">     if (NS_SUCCEEDED(rv) &amp;&amp; runningUrl &amp;&amp; folder)</span>
<a href="#l66.41"></a><span id="l66.41">     {</span>
<a href="#l66.42"></a><span id="l66.42" class="difflineat">@@ -312,18 +315,19 @@ nsresult nsMsgMailboxParser::Init()</span>
<a href="#l66.43"></a><span id="l66.43">   return AcquireFolderLock();</span>
<a href="#l66.44"></a><span id="l66.44"> }</span>
<a href="#l66.45"></a><span id="l66.45"> </span>
<a href="#l66.46"></a><span id="l66.46"> void nsMsgMailboxParser::UpdateStatusText (PRUint32 stringID)</span>
<a href="#l66.47"></a><span id="l66.47"> {</span>
<a href="#l66.48"></a><span id="l66.48">   if (m_statusFeedback)</span>
<a href="#l66.49"></a><span id="l66.49">   {</span>
<a href="#l66.50"></a><span id="l66.50">     nsresult rv;</span>
<a href="#l66.51"></a><span id="l66.51" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l66.52"></a><span id="l66.52" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l66.53"></a><span id="l66.53" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l66.54"></a><span id="l66.54" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l66.55"></a><span id="l66.55" class="difflineplus">+    if (!bundleService)</span>
<a href="#l66.56"></a><span id="l66.56">       return;</span>
<a href="#l66.57"></a><span id="l66.57">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l66.58"></a><span id="l66.58">     rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l66.59"></a><span id="l66.59">     if (NS_FAILED(rv))</span>
<a href="#l66.60"></a><span id="l66.60">       return;</span>
<a href="#l66.61"></a><span id="l66.61">     nsString finalString;</span>
<a href="#l66.62"></a><span id="l66.62">     if (stringID == LOCAL_STATUS_SELECTING_MAILBOX)</span>
<a href="#l66.63"></a><span id="l66.63">     {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -75,16 +75,17 @@</span>
<a href="#l67.4"></a><span id="l67.4"> #include &quot;nsISignatureVerifier.h&quot;</span>
<a href="#l67.5"></a><span id="l67.5"> #include &quot;nsISocketTransport.h&quot;</span>
<a href="#l67.6"></a><span id="l67.6"> #include &quot;nsISSLSocketControl.h&quot;</span>
<a href="#l67.7"></a><span id="l67.7"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l67.8"></a><span id="l67.8"> #include &quot;nsLocalStrings.h&quot;</span>
<a href="#l67.9"></a><span id="l67.9"> #include &quot;nsIInterfaceRequestor.h&quot;</span>
<a href="#l67.10"></a><span id="l67.10"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l67.11"></a><span id="l67.11"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l67.13"></a><span id="l67.13"> </span>
<a href="#l67.14"></a><span id="l67.14"> #define EXTRA_SAFETY_SPACE 3096</span>
<a href="#l67.15"></a><span id="l67.15"> </span>
<a href="#l67.16"></a><span id="l67.16"> PRLogModuleInfo *POP3LOGMODULE = nsnull;</span>
<a href="#l67.17"></a><span id="l67.17"> </span>
<a href="#l67.18"></a><span id="l67.18"> </span>
<a href="#l67.19"></a><span id="l67.19"> static PRIntn</span>
<a href="#l67.20"></a><span id="l67.20"> net_pop3_remove_messages_marked_delete(PLHashEntry* he,</span>
<a href="#l67.21"></a><span id="l67.21" class="difflineat">@@ -595,18 +596,19 @@ nsresult nsPop3Protocol::Initialize(nsIU</span>
<a href="#l67.22"></a><span id="l67.22">     if(NS_FAILED(rv))</span>
<a href="#l67.23"></a><span id="l67.23">       return rv;</span>
<a href="#l67.24"></a><span id="l67.24">   } // if we got a url...</span>
<a href="#l67.25"></a><span id="l67.25"> </span>
<a href="#l67.26"></a><span id="l67.26">   m_lineStreamBuffer = new nsMsgLineStreamBuffer(OUTPUT_BUFFER_SIZE, true);</span>
<a href="#l67.27"></a><span id="l67.27">   if(!m_lineStreamBuffer)</span>
<a href="#l67.28"></a><span id="l67.28">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l67.29"></a><span id="l67.29"> </span>
<a href="#l67.30"></a><span id="l67.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l67.31"></a><span id="l67.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l67.32"></a><span id="l67.32" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l67.33"></a><span id="l67.33" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l67.34"></a><span id="l67.34" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l67.35"></a><span id="l67.35">   return bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(mLocalBundle));</span>
<a href="#l67.36"></a><span id="l67.36"> }</span>
<a href="#l67.37"></a><span id="l67.37"> </span>
<a href="#l67.38"></a><span id="l67.38"> nsPop3Protocol::~nsPop3Protocol()</span>
<a href="#l67.39"></a><span id="l67.39"> {</span>
<a href="#l67.40"></a><span id="l67.40">   Cleanup();</span>
<a href="#l67.41"></a><span id="l67.41"> }</span>
<a href="#l67.42"></a><span id="l67.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -61,16 +61,17 @@</span>
<a href="#l68.4"></a><span id="l68.4"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l68.5"></a><span id="l68.5"> #include &quot;nsLocalMailFolder.h&quot;</span>
<a href="#l68.6"></a><span id="l68.6"> #include &quot;nsIMailboxUrl.h&quot;</span>
<a href="#l68.7"></a><span id="l68.7"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l68.8"></a><span id="l68.8"> #include &quot;nsLocalStrings.h&quot;</span>
<a href="#l68.9"></a><span id="l68.9"> #include &quot;nsINetUtil.h&quot;</span>
<a href="#l68.10"></a><span id="l68.10"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l68.11"></a><span id="l68.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l68.12"></a><span id="l68.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l68.13"></a><span id="l68.13"> </span>
<a href="#l68.14"></a><span id="l68.14"> #define PREF_MAIL_ROOT_POP3 &quot;mail.root.pop3&quot;        // old - for backward compatibility only</span>
<a href="#l68.15"></a><span id="l68.15"> #define PREF_MAIL_ROOT_POP3_REL &quot;mail.root.pop3-rel&quot;</span>
<a href="#l68.16"></a><span id="l68.16"> </span>
<a href="#l68.17"></a><span id="l68.17"> static NS_DEFINE_CID(kPop3UrlCID, NS_POP3URL_CID);</span>
<a href="#l68.18"></a><span id="l68.18"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l68.19"></a><span id="l68.19"> </span>
<a href="#l68.20"></a><span id="l68.20"> nsPop3Service::nsPop3Service()</span>
<a href="#l68.21"></a><span id="l68.21" class="difflineat">@@ -464,19 +465,20 @@ NS_IMETHODIMP nsPop3Service::NewURI(cons</span>
<a href="#l68.22"></a><span id="l68.22">     pop3Sink-&gt;SetBuildMessageUri(true);</span>
<a href="#l68.23"></a><span id="l68.23"> </span>
<a href="#l68.24"></a><span id="l68.24">     return NS_OK;</span>
<a href="#l68.25"></a><span id="l68.25"> }</span>
<a href="#l68.26"></a><span id="l68.26"> </span>
<a href="#l68.27"></a><span id="l68.27"> void nsPop3Service::AlertServerBusy(nsIMsgMailNewsUrl *url)</span>
<a href="#l68.28"></a><span id="l68.28"> {</span>
<a href="#l68.29"></a><span id="l68.29">   nsresult rv;</span>
<a href="#l68.30"></a><span id="l68.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l68.31"></a><span id="l68.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, void(0));</span>
<a href="#l68.32"></a><span id="l68.32" class="difflineminus">-</span>
<a href="#l68.33"></a><span id="l68.33" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l68.34"></a><span id="l68.34" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l68.35"></a><span id="l68.35" class="difflineplus">+  if (!bundleService)</span>
<a href="#l68.36"></a><span id="l68.36" class="difflineplus">+    return void(0);</span>
<a href="#l68.37"></a><span id="l68.37">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l68.38"></a><span id="l68.38">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l68.39"></a><span id="l68.39">   NS_ENSURE_SUCCESS(rv, void(0));</span>
<a href="#l68.40"></a><span id="l68.40"> </span>
<a href="#l68.41"></a><span id="l68.41">   nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow;</span>
<a href="#l68.42"></a><span id="l68.42">   nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l68.43"></a><span id="l68.43">   rv = url-&gt;GetMsgWindow(getter_AddRefs(msgWindow)); //it is ok to have null msgWindow, for example when biffing</span>
<a href="#l68.44"></a><span id="l68.44">   if (NS_FAILED(rv) || !msgWindow)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -70,16 +70,17 @@</span>
<a href="#l69.4"></a><span id="l69.4"> #include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l69.5"></a><span id="l69.5"> #include &quot;nsEmbedCID.h&quot;</span>
<a href="#l69.6"></a><span id="l69.6"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l69.7"></a><span id="l69.7"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l69.8"></a><span id="l69.8"> #include &quot;nsLocalStrings.h&quot;</span>
<a href="#l69.9"></a><span id="l69.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l69.10"></a><span id="l69.10"> #include &quot;nsIPop3Service.h&quot;</span>
<a href="#l69.11"></a><span id="l69.11"> #include &quot;nsMsgLocalCID.h&quot;</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l69.13"></a><span id="l69.13"> </span>
<a href="#l69.14"></a><span id="l69.14"> extern PRLogModuleInfo *POP3LOGMODULE;</span>
<a href="#l69.15"></a><span id="l69.15"> </span>
<a href="#l69.16"></a><span id="l69.16"> NS_IMPL_THREADSAFE_ISUPPORTS1(nsPop3Sink, nsIPop3Sink)</span>
<a href="#l69.17"></a><span id="l69.17"> </span>
<a href="#l69.18"></a><span id="l69.18"> nsPop3Sink::nsPop3Sink()</span>
<a href="#l69.19"></a><span id="l69.19"> {</span>
<a href="#l69.20"></a><span id="l69.20">     m_authed = false;</span>
<a href="#l69.21"></a><span id="l69.21" class="difflineat">@@ -756,18 +757,19 @@ nsresult nsPop3Sink::WriteLineToMailbox(</span>
<a href="#l69.22"></a><span id="l69.22">     if ((PRInt32) bytesWritten != bufferLen) return NS_ERROR_FAILURE;</span>
<a href="#l69.23"></a><span id="l69.23">   }</span>
<a href="#l69.24"></a><span id="l69.24">   return NS_OK;</span>
<a href="#l69.25"></a><span id="l69.25"> }</span>
<a href="#l69.26"></a><span id="l69.26"> </span>
<a href="#l69.27"></a><span id="l69.27"> nsresult nsPop3Sink::HandleTempDownloadFailed(nsIMsgWindow *msgWindow)</span>
<a href="#l69.28"></a><span id="l69.28"> {</span>
<a href="#l69.29"></a><span id="l69.29">   nsresult rv;</span>
<a href="#l69.30"></a><span id="l69.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l69.31"></a><span id="l69.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l69.32"></a><span id="l69.32" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l69.33"></a><span id="l69.33" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l69.34"></a><span id="l69.34" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l69.35"></a><span id="l69.35">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l69.36"></a><span id="l69.36">   rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/localMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l69.37"></a><span id="l69.37">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l69.38"></a><span id="l69.38">   nsString fromStr, subjectStr, confirmString;</span>
<a href="#l69.39"></a><span id="l69.39"> </span>
<a href="#l69.40"></a><span id="l69.40">   m_newMailParser-&gt;m_newMsgHdr-&gt;GetMime2DecodedSubject(subjectStr);</span>
<a href="#l69.41"></a><span id="l69.41">   m_newMailParser-&gt;m_newMsgHdr-&gt;GetMime2DecodedAuthor(fromStr);</span>
<a href="#l69.42"></a><span id="l69.42">   const PRUnichar *params[] = { fromStr.get(), subjectStr.get() };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -74,16 +74,17 @@</span>
<a href="#l70.4"></a><span id="l70.4"> #include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l70.5"></a><span id="l70.5"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l70.6"></a><span id="l70.6"> #include &quot;msgMapi.h&quot;</span>
<a href="#l70.7"></a><span id="l70.7"> #include &quot;msgMapiHook.h&quot;</span>
<a href="#l70.8"></a><span id="l70.8"> #include &quot;msgMapiSupport.h&quot;</span>
<a href="#l70.9"></a><span id="l70.9"> #include &quot;msgMapiMain.h&quot;</span>
<a href="#l70.10"></a><span id="l70.10"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l70.11"></a><span id="l70.11"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l70.12"></a><span id="l70.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l70.13"></a><span id="l70.13"> </span>
<a href="#l70.14"></a><span id="l70.14"> #include &quot;nsEmbedCID.h&quot;</span>
<a href="#l70.15"></a><span id="l70.15"> </span>
<a href="#l70.16"></a><span id="l70.16"> extern PRLogModuleInfo *MAPI;</span>
<a href="#l70.17"></a><span id="l70.17"> </span>
<a href="#l70.18"></a><span id="l70.18"> class nsMAPISendListener : public nsIMsgSendListener</span>
<a href="#l70.19"></a><span id="l70.19"> {</span>
<a href="#l70.20"></a><span id="l70.20"> public:</span>
<a href="#l70.21"></a><span id="l70.21" class="difflineat">@@ -160,18 +161,19 @@ bool nsMapiHook::DisplayLoginDialog(bool</span>
<a href="#l70.22"></a><span id="l70.22">                       PRUnichar **aPassword)</span>
<a href="#l70.23"></a><span id="l70.23"> {</span>
<a href="#l70.24"></a><span id="l70.24">   nsresult rv;</span>
<a href="#l70.25"></a><span id="l70.25">   bool btnResult = false;</span>
<a href="#l70.26"></a><span id="l70.26"> </span>
<a href="#l70.27"></a><span id="l70.27">   nsCOMPtr&lt;nsIPromptService&gt; dlgService(do_GetService(NS_PROMPTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l70.28"></a><span id="l70.28">   if (NS_SUCCEEDED(rv) &amp;&amp; dlgService)</span>
<a href="#l70.29"></a><span id="l70.29">   {</span>
<a href="#l70.30"></a><span id="l70.30" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv));</span>
<a href="#l70.31"></a><span id="l70.31" class="difflineminus">-    if (NS_FAILED(rv) || !bundleService) return false;</span>
<a href="#l70.32"></a><span id="l70.32" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l70.33"></a><span id="l70.33" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l70.34"></a><span id="l70.34" class="difflineplus">+    if (!bundleService) return false;</span>
<a href="#l70.35"></a><span id="l70.35"> </span>
<a href="#l70.36"></a><span id="l70.36">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l70.37"></a><span id="l70.37">     rv = bundleService-&gt;CreateBundle(MAPI_PROPERTIES_CHROME, getter_AddRefs(bundle));</span>
<a href="#l70.38"></a><span id="l70.38">     if (NS_FAILED(rv) || !bundle) return false;</span>
<a href="#l70.39"></a><span id="l70.39"> </span>
<a href="#l70.40"></a><span id="l70.40">     nsCOMPtr&lt;nsIStringBundle&gt; brandBundle;</span>
<a href="#l70.41"></a><span id="l70.41">     rv = bundleService-&gt;CreateBundle(</span>
<a href="#l70.42"></a><span id="l70.42">                     &quot;chrome://branding/locale/brand.properties&quot;,</span>
<a href="#l70.43"></a><span id="l70.43" class="difflineat">@@ -278,18 +280,19 @@ nsMapiHook::IsBlindSendAllowed()</span>
<a href="#l70.44"></a><span id="l70.44">   }</span>
<a href="#l70.45"></a><span id="l70.45">   if (!enabled)</span>
<a href="#l70.46"></a><span id="l70.46">       return false;</span>
<a href="#l70.47"></a><span id="l70.47"> </span>
<a href="#l70.48"></a><span id="l70.48">   if (!warn)</span>
<a href="#l70.49"></a><span id="l70.49">       return true; // Everything is okay.</span>
<a href="#l70.50"></a><span id="l70.50"> </span>
<a href="#l70.51"></a><span id="l70.51">   nsresult rv;</span>
<a href="#l70.52"></a><span id="l70.52" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv));</span>
<a href="#l70.53"></a><span id="l70.53" class="difflineminus">-  if (NS_FAILED(rv) || !bundleService) return false;</span>
<a href="#l70.54"></a><span id="l70.54" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l70.55"></a><span id="l70.55" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l70.56"></a><span id="l70.56" class="difflineplus">+  if (!bundleService) return false;</span>
<a href="#l70.57"></a><span id="l70.57"> </span>
<a href="#l70.58"></a><span id="l70.58">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l70.59"></a><span id="l70.59">   rv = bundleService-&gt;CreateBundle(MAPI_PROPERTIES_CHROME, getter_AddRefs(bundle));</span>
<a href="#l70.60"></a><span id="l70.60">   if (NS_FAILED(rv) || !bundle) return false;</span>
<a href="#l70.61"></a><span id="l70.61"> </span>
<a href="#l70.62"></a><span id="l70.62">   nsString warningMsg;</span>
<a href="#l70.63"></a><span id="l70.63">   rv = bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;mapiBlindSendWarning&quot;).get(),</span>
<a href="#l70.64"></a><span id="l70.64">                                       getter_Copies(warningMsg));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiSupport.cpp</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiSupport.cpp</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -34,16 +34,17 @@</span>
<a href="#l71.4"></a><span id="l71.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l71.5"></a><span id="l71.5">  *</span>
<a href="#l71.6"></a><span id="l71.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l71.7"></a><span id="l71.7"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l71.8"></a><span id="l71.8"> #include &quot;objbase.h&quot;</span>
<a href="#l71.9"></a><span id="l71.9"> #include &quot;nsISupports.h&quot;</span>
<a href="#l71.10"></a><span id="l71.10"> </span>
<a href="#l71.11"></a><span id="l71.11"> #include &quot;mozilla/ModuleUtils.h&quot;</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l71.13"></a><span id="l71.13"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l71.14"></a><span id="l71.14"> #include &quot;nsIAppStartupNotifier.h&quot;</span>
<a href="#l71.15"></a><span id="l71.15"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l71.16"></a><span id="l71.16"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l71.17"></a><span id="l71.17"> #include &quot;nsICategoryManager.h&quot;</span>
<a href="#l71.18"></a><span id="l71.18"> #include &quot;Registry.h&quot;</span>
<a href="#l71.19"></a><span id="l71.19"> #include &quot;msgMapiSupport.h&quot;</span>
<a href="#l71.20"></a><span id="l71.20"> </span>
<a href="#l71.21"></a><span id="l71.21" class="difflineat">@@ -61,18 +62,19 @@ nsMapiSupport::Observe(nsISupports *aSub</span>
<a href="#l71.22"></a><span id="l71.22">     nsresult rv = NS_OK ;</span>
<a href="#l71.23"></a><span id="l71.23"> </span>
<a href="#l71.24"></a><span id="l71.24">     if (!strcmp(aTopic, &quot;profile-after-change&quot;))</span>
<a href="#l71.25"></a><span id="l71.25">         return InitializeMAPISupport();</span>
<a href="#l71.26"></a><span id="l71.26"> </span>
<a href="#l71.27"></a><span id="l71.27">     if (!strcmp(aTopic, NS_XPCOM_SHUTDOWN_OBSERVER_ID))</span>
<a href="#l71.28"></a><span id="l71.28">         return ShutdownMAPISupport();</span>
<a href="#l71.29"></a><span id="l71.29"> </span>
<a href="#l71.30"></a><span id="l71.30" class="difflineminus">-    nsCOMPtr&lt;nsIObserverService&gt; observerService(do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv));</span>
<a href="#l71.31"></a><span id="l71.31" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l71.32"></a><span id="l71.32" class="difflineplus">+    nsCOMPtr&lt;nsIObserverService&gt; observerService =</span>
<a href="#l71.33"></a><span id="l71.33" class="difflineplus">+      mozilla::services::GetObserverService();</span>
<a href="#l71.34"></a><span id="l71.34" class="difflineplus">+    NS_ENSURE_TRUE(observerService, NS_ERROR_UNEXPECTED);</span>
<a href="#l71.35"></a><span id="l71.35">  </span>
<a href="#l71.36"></a><span id="l71.36">     rv = observerService-&gt;AddObserver(this,&quot;profile-after-change&quot;, false);</span>
<a href="#l71.37"></a><span id="l71.37">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l71.38"></a><span id="l71.38"> </span>
<a href="#l71.39"></a><span id="l71.39">     rv = observerService-&gt;AddObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID, false);</span>
<a href="#l71.40"></a><span id="l71.40">     if (NS_FAILED(rv))  return rv;</span>
<a href="#l71.41"></a><span id="l71.41"> </span>
<a href="#l71.42"></a><span id="l71.42">     return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/mailnews/mime/cthandlers/smimestub/nsSMIMEStub.cpp</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/mailnews/mime/cthandlers/smimestub/nsSMIMEStub.cpp</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -36,24 +36,25 @@</span>
<a href="#l72.4"></a><span id="l72.4">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l72.5"></a><span id="l72.5"> </span>
<a href="#l72.6"></a><span id="l72.6"> #include &quot;nsSMIMEStub.h&quot;</span>
<a href="#l72.7"></a><span id="l72.7"> </span>
<a href="#l72.8"></a><span id="l72.8"> #include &quot;mimecth.h&quot;</span>
<a href="#l72.9"></a><span id="l72.9"> #include &quot;mimexpcom.h&quot;</span>
<a href="#l72.10"></a><span id="l72.10"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l72.11"></a><span id="l72.11"> #include &quot;prmem.h&quot;</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l72.13"></a><span id="l72.13"> </span>
<a href="#l72.14"></a><span id="l72.14"> #define SMIME_PROPERTIES_URL          &quot;chrome://messenger/locale/smime.properties&quot;</span>
<a href="#l72.15"></a><span id="l72.15"> #define SMIME_STR_NOT_SUPPORTED_ID    1000</span>
<a href="#l72.16"></a><span id="l72.16"> </span>
<a href="#l72.17"></a><span id="l72.17"> static char *SMimeGetStringByID(PRInt32 aMsgId)</span>
<a href="#l72.18"></a><span id="l72.18"> {</span>
<a href="#l72.19"></a><span id="l72.19">   nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleService =</span>
<a href="#l72.20"></a><span id="l72.20" class="difflineminus">-    do_GetService(NS_STRINGBUNDLE_CONTRACTID);</span>
<a href="#l72.21"></a><span id="l72.21" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l72.22"></a><span id="l72.22"> </span>
<a href="#l72.23"></a><span id="l72.23">   nsCOMPtr&lt;nsIStringBundle&gt; stringBundle;</span>
<a href="#l72.24"></a><span id="l72.24">   stringBundleService-&gt;CreateBundle(SMIME_PROPERTIES_URL,</span>
<a href="#l72.25"></a><span id="l72.25">                                     getter_AddRefs(stringBundle));</span>
<a href="#l72.26"></a><span id="l72.26">   if (stringBundle)</span>
<a href="#l72.27"></a><span id="l72.27">   {</span>
<a href="#l72.28"></a><span id="l72.28">     nsString v;</span>
<a href="#l72.29"></a><span id="l72.29">     if (NS_SUCCEEDED(stringBundle-&gt;GetStringFromID(aMsgId, getter_Copies(v))))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -61,16 +61,17 @@</span>
<a href="#l73.4"></a><span id="l73.4"> #include &quot;nsIMimeHeaders.h&quot;</span>
<a href="#l73.5"></a><span id="l73.5"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l73.6"></a><span id="l73.6"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l73.7"></a><span id="l73.7"> #include &quot;nsDateTimeFormatCID.h&quot;</span>
<a href="#l73.8"></a><span id="l73.8"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l73.9"></a><span id="l73.9"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l73.10"></a><span id="l73.10"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l73.11"></a><span id="l73.11"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l73.13"></a><span id="l73.13"> </span>
<a href="#l73.14"></a><span id="l73.14"> static PRLogModuleInfo * gMimeEmitterLogModule = nsnull;</span>
<a href="#l73.15"></a><span id="l73.15"> </span>
<a href="#l73.16"></a><span id="l73.16"> #define   MIME_HEADER_URL      &quot;chrome://messenger/locale/mimeheader.properties&quot;</span>
<a href="#l73.17"></a><span id="l73.17"> #define   MIME_URL             &quot;chrome://messenger/locale/mime.properties&quot;</span>
<a href="#l73.18"></a><span id="l73.18"> </span>
<a href="#l73.19"></a><span id="l73.19"> NS_IMPL_THREADSAFE_ADDREF(nsMimeBaseEmitter)</span>
<a href="#l73.20"></a><span id="l73.20"> NS_IMPL_THREADSAFE_RELEASE(nsMimeBaseEmitter)</span>
<a href="#l73.21"></a><span id="l73.21" class="difflineat">@@ -239,18 +240,18 @@ nsMimeBaseEmitter::MimeGetStringByName(c</span>
<a href="#l73.22"></a><span id="l73.22"> {</span>
<a href="#l73.23"></a><span id="l73.23">   nsresult res = NS_OK;</span>
<a href="#l73.24"></a><span id="l73.24"> </span>
<a href="#l73.25"></a><span id="l73.25">   if (!m_headerStringBundle)</span>
<a href="#l73.26"></a><span id="l73.26">   {</span>
<a href="#l73.27"></a><span id="l73.27">     static const char propertyURL[] = MIME_HEADER_URL;</span>
<a href="#l73.28"></a><span id="l73.28"> </span>
<a href="#l73.29"></a><span id="l73.29">     nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l73.30"></a><span id="l73.30" class="difflineminus">-             do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;res);</span>
<a href="#l73.31"></a><span id="l73.31" class="difflineminus">-    if (NS_SUCCEEDED(res) &amp;&amp; (nsnull != sBundleService))</span>
<a href="#l73.32"></a><span id="l73.32" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l73.33"></a><span id="l73.33" class="difflineplus">+    if (sBundleService)</span>
<a href="#l73.34"></a><span id="l73.34">     {</span>
<a href="#l73.35"></a><span id="l73.35">       res = sBundleService-&gt;CreateBundle(propertyURL, getter_AddRefs(m_headerStringBundle));</span>
<a href="#l73.36"></a><span id="l73.36">     }</span>
<a href="#l73.37"></a><span id="l73.37">   }</span>
<a href="#l73.38"></a><span id="l73.38"> </span>
<a href="#l73.39"></a><span id="l73.39">   if (m_headerStringBundle)</span>
<a href="#l73.40"></a><span id="l73.40">   {</span>
<a href="#l73.41"></a><span id="l73.41">     nsString val;</span>
<a href="#l73.42"></a><span id="l73.42" class="difflineat">@@ -278,18 +279,18 @@ nsMimeBaseEmitter::MimeGetStringByID(PRI</span>
<a href="#l73.43"></a><span id="l73.43"> {</span>
<a href="#l73.44"></a><span id="l73.44">   nsresult res = NS_OK;</span>
<a href="#l73.45"></a><span id="l73.45"> </span>
<a href="#l73.46"></a><span id="l73.46">   if (!m_stringBundle)</span>
<a href="#l73.47"></a><span id="l73.47">   {</span>
<a href="#l73.48"></a><span id="l73.48">     static const char propertyURL[] = MIME_URL;</span>
<a href="#l73.49"></a><span id="l73.49"> </span>
<a href="#l73.50"></a><span id="l73.50">     nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l73.51"></a><span id="l73.51" class="difflineminus">-                            do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;res);</span>
<a href="#l73.52"></a><span id="l73.52" class="difflineminus">-    if (NS_SUCCEEDED(res))</span>
<a href="#l73.53"></a><span id="l73.53" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l73.54"></a><span id="l73.54" class="difflineplus">+    if (sBundleService)</span>
<a href="#l73.55"></a><span id="l73.55">       res = sBundleService-&gt;CreateBundle(propertyURL, getter_AddRefs(m_stringBundle));</span>
<a href="#l73.56"></a><span id="l73.56">   }</span>
<a href="#l73.57"></a><span id="l73.57"> </span>
<a href="#l73.58"></a><span id="l73.58">   if (m_stringBundle)</span>
<a href="#l73.59"></a><span id="l73.59">   {</span>
<a href="#l73.60"></a><span id="l73.60">     nsString val;</span>
<a href="#l73.61"></a><span id="l73.61"> </span>
<a href="#l73.62"></a><span id="l73.62">     res = m_stringBundle-&gt;GetStringFromID(aID, getter_Copies(val));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -57,16 +57,17 @@</span>
<a href="#l74.4"></a><span id="l74.4"> #include &quot;nsINntpUrl.h&quot;</span>
<a href="#l74.5"></a><span id="l74.5"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l74.6"></a><span id="l74.6"> #include &quot;nsIMimeConverter.h&quot;</span>
<a href="#l74.7"></a><span id="l74.7"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l74.8"></a><span id="l74.8"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l74.9"></a><span id="l74.9"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l74.10"></a><span id="l74.10"> #include &quot;nsINetUtil.h&quot;</span>
<a href="#l74.11"></a><span id="l74.11"> #include &quot;nsMemory.h&quot;</span>
<a href="#l74.12"></a><span id="l74.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l74.13"></a><span id="l74.13"> </span>
<a href="#l74.14"></a><span id="l74.14"> #define VIEW_ALL_HEADERS 2</span>
<a href="#l74.15"></a><span id="l74.15"> </span>
<a href="#l74.16"></a><span id="l74.16"> /**</span>
<a href="#l74.17"></a><span id="l74.17">  * A helper class to implement nsIUTF8StringEnumerator</span>
<a href="#l74.18"></a><span id="l74.18">  */</span>
<a href="#l74.19"></a><span id="l74.19"> </span>
<a href="#l74.20"></a><span id="l74.20"> class nsMimeStringEnumerator : public nsIUTF8StringEnumerator {</span>
<a href="#l74.21"></a><span id="l74.21" class="difflineat">@@ -432,18 +433,18 @@ nsMimeHtmlDisplayEmitter::StartAttachmen</span>
<a href="#l74.22"></a><span id="l74.22">   if (mFirst)</span>
<a href="#l74.23"></a><span id="l74.23">   {</span>
<a href="#l74.24"></a><span id="l74.24">     UtilityWrite(&quot;&lt;br&gt;&lt;fieldset class=\&quot;mimeAttachmentHeader\&quot;&gt;&quot;);</span>
<a href="#l74.25"></a><span id="l74.25">     if (!name.IsEmpty())</span>
<a href="#l74.26"></a><span id="l74.26">     {</span>
<a href="#l74.27"></a><span id="l74.27">       nsresult rv;</span>
<a href="#l74.28"></a><span id="l74.28"> </span>
<a href="#l74.29"></a><span id="l74.29">       nsCOMPtr&lt;nsIStringBundleService&gt; bundleSvc =</span>
<a href="#l74.30"></a><span id="l74.30" class="difflineminus">-        do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l74.31"></a><span id="l74.31" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l74.32"></a><span id="l74.32" class="difflineplus">+        mozilla::services::GetStringBundleService();</span>
<a href="#l74.33"></a><span id="l74.33" class="difflineplus">+      NS_ENSURE_TRUE(bundleSvc, NS_ERROR_UNEXPECTED);</span>
<a href="#l74.34"></a><span id="l74.34"> </span>
<a href="#l74.35"></a><span id="l74.35">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l74.36"></a><span id="l74.36">       rv = bundleSvc-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l74.37"></a><span id="l74.37">                                    getter_AddRefs(bundle));</span>
<a href="#l74.38"></a><span id="l74.38">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l74.39"></a><span id="l74.39"> </span>
<a href="#l74.40"></a><span id="l74.40">       nsString attachmentsHeader;</span>
<a href="#l74.41"></a><span id="l74.41">       bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;attachmentsPrintHeader&quot;).get(),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -90,16 +90,17 @@</span>
<a href="#l75.4"></a><span id="l75.4"> #include &quot;nsIParser.h&quot;</span>
<a href="#l75.5"></a><span id="l75.5"> #include &quot;nsIHTMLContentSink.h&quot;</span>
<a href="#l75.6"></a><span id="l75.6"> #include &quot;nsIContentSerializer.h&quot;</span>
<a href="#l75.7"></a><span id="l75.7"> #include &quot;nsLayoutCID.h&quot;</span>
<a href="#l75.8"></a><span id="l75.8"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l75.9"></a><span id="l75.9"> #include &quot;nsIHTMLToTextSink.h&quot;</span>
<a href="#l75.10"></a><span id="l75.10"> #include &quot;mozISanitizingSerializer.h&quot;</span>
<a href="#l75.11"></a><span id="l75.11"> // &lt;/for&gt;</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l75.13"></a><span id="l75.13"> </span>
<a href="#l75.14"></a><span id="l75.14"> // &lt;for functions=&quot;HTML2Plaintext,HTMLSantinize&quot;&gt;</span>
<a href="#l75.15"></a><span id="l75.15"> static NS_DEFINE_CID(kParserCID, NS_PARSER_CID);</span>
<a href="#l75.16"></a><span id="l75.16"> // &lt;/for&gt;</span>
<a href="#l75.17"></a><span id="l75.17"> </span>
<a href="#l75.18"></a><span id="l75.18"> #ifdef HAVE_MIME_DATA_SLOT</span>
<a href="#l75.19"></a><span id="l75.19"> #define LOCK_LAST_CACHED_MESSAGE</span>
<a href="#l75.20"></a><span id="l75.20"> #endif</span>
<a href="#l75.21"></a><span id="l75.21" class="difflineat">@@ -713,19 +714,19 @@ NotifyEmittersOfAttachmentList(MimeDispl</span>
<a href="#l75.22"></a><span id="l75.22"> extern &quot;C&quot; nsresult</span>
<a href="#l75.23"></a><span id="l75.23"> nsMimeNewURI(nsIURI** aInstancePtrResult, const char *aSpec, nsIURI *aBase)</span>
<a href="#l75.24"></a><span id="l75.24"> {</span>
<a href="#l75.25"></a><span id="l75.25">   nsresult  res;</span>
<a href="#l75.26"></a><span id="l75.26"> </span>
<a href="#l75.27"></a><span id="l75.27">   if (nsnull == aInstancePtrResult)</span>
<a href="#l75.28"></a><span id="l75.28">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l75.29"></a><span id="l75.29"> </span>
<a href="#l75.30"></a><span id="l75.30" class="difflineminus">-  nsCOMPtr&lt;nsIIOService&gt; pService(do_GetService(NS_IOSERVICE_CONTRACTID, &amp;res));</span>
<a href="#l75.31"></a><span id="l75.31" class="difflineminus">-  if (NS_FAILED(res))</span>
<a href="#l75.32"></a><span id="l75.32" class="difflineminus">-    return NS_ERROR_FACTORY_NOT_REGISTERED;</span>
<a href="#l75.33"></a><span id="l75.33" class="difflineplus">+  nsCOMPtr&lt;nsIIOService&gt; pService =</span>
<a href="#l75.34"></a><span id="l75.34" class="difflineplus">+    mozilla::services::GetIOService();</span>
<a href="#l75.35"></a><span id="l75.35" class="difflineplus">+  NS_ENSURE_TRUE(pService, NS_ERROR_FACTORY_NOT_REGISTERED);</span>
<a href="#l75.36"></a><span id="l75.36"> </span>
<a href="#l75.37"></a><span id="l75.37">   return pService-&gt;NewURI(nsDependentCString(aSpec), nsnull, aBase, aInstancePtrResult);</span>
<a href="#l75.38"></a><span id="l75.38"> }</span>
<a href="#l75.39"></a><span id="l75.39"> </span>
<a href="#l75.40"></a><span id="l75.40"> extern &quot;C&quot; nsresult</span>
<a href="#l75.41"></a><span id="l75.41"> SetMailCharacterSetToMsgWindow(MimeObject *obj, const char *aCharacterSet)</span>
<a href="#l75.42"></a><span id="l75.42"> {</span>
<a href="#l75.43"></a><span id="l75.43">   nsresult rv = NS_OK;</span>
<a href="#l75.44"></a><span id="l75.44" class="difflineat">@@ -2051,17 +2052,17 @@ mimeSetNewURL(nsMIMESession *stream, cha</span>
<a href="#l75.45"></a><span id="l75.45"> </span>
<a href="#l75.46"></a><span id="l75.46"> #define     MIME_URL &quot;chrome://messenger/locale/mime.properties&quot;</span>
<a href="#l75.47"></a><span id="l75.47"> </span>
<a href="#l75.48"></a><span id="l75.48"> extern &quot;C&quot;</span>
<a href="#l75.49"></a><span id="l75.49"> char *</span>
<a href="#l75.50"></a><span id="l75.50"> MimeGetStringByID(PRInt32 stringID)</span>
<a href="#l75.51"></a><span id="l75.51"> {</span>
<a href="#l75.52"></a><span id="l75.52">   nsCOMPtr&lt;nsIStringBundleService&gt; stringBundleService =</span>
<a href="#l75.53"></a><span id="l75.53" class="difflineminus">-    do_GetService(NS_STRINGBUNDLE_CONTRACTID);</span>
<a href="#l75.54"></a><span id="l75.54" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l75.55"></a><span id="l75.55"> </span>
<a href="#l75.56"></a><span id="l75.56">   nsCOMPtr&lt;nsIStringBundle&gt; stringBundle;</span>
<a href="#l75.57"></a><span id="l75.57">   stringBundleService-&gt;CreateBundle(MIME_URL, getter_AddRefs(stringBundle));</span>
<a href="#l75.58"></a><span id="l75.58">   if (stringBundle)</span>
<a href="#l75.59"></a><span id="l75.59">   {</span>
<a href="#l75.60"></a><span id="l75.60">     nsString v;</span>
<a href="#l75.61"></a><span id="l75.61">     if (NS_SUCCEEDED(stringBundle-&gt;GetStringFromID(stringID, getter_Copies(v))))</span>
<a href="#l75.62"></a><span id="l75.62">       return ToNewUTF8String(v);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -90,16 +90,17 @@</span>
<a href="#l76.4"></a><span id="l76.4"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l76.5"></a><span id="l76.5"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l76.6"></a><span id="l76.6"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l76.7"></a><span id="l76.7"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l76.8"></a><span id="l76.8"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l76.9"></a><span id="l76.9"> #include &quot;nsIMsgFilterCustomAction.h&quot;</span>
<a href="#l76.10"></a><span id="l76.10"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l76.11"></a><span id="l76.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l76.13"></a><span id="l76.13"> </span>
<a href="#l76.14"></a><span id="l76.14"> // update status on header download once per second</span>
<a href="#l76.15"></a><span id="l76.15"> #define MIN_STATUS_UPDATE_INTERVAL PRTime(PR_USEC_PER_SEC)</span>
<a href="#l76.16"></a><span id="l76.16"> </span>
<a href="#l76.17"></a><span id="l76.17"> </span>
<a href="#l76.18"></a><span id="l76.18"> nsNNTPNewsgroupList::nsNNTPNewsgroupList()</span>
<a href="#l76.19"></a><span id="l76.19">   : m_finishingXover(false),</span>
<a href="#l76.20"></a><span id="l76.20">   m_getOldMessages(false),</span>
<a href="#l76.21"></a><span id="l76.21" class="difflineat">@@ -333,18 +334,19 @@ nsNNTPNewsgroupList::GetRangeOfArtsToDow</span>
<a href="#l76.22"></a><span id="l76.22">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l76.23"></a><span id="l76.23">     rv = m_newsDB-&gt;GetHighWaterArticleNum(&amp;high);</span>
<a href="#l76.24"></a><span id="l76.24">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l76.25"></a><span id="l76.25">     m_knownArts.set-&gt;AddRange(low,high);</span>
<a href="#l76.26"></a><span id="l76.26">   }</span>
<a href="#l76.27"></a><span id="l76.27"> </span>
<a href="#l76.28"></a><span id="l76.28">   if (m_knownArts.set-&gt;IsMember(last_possible)) {</span>
<a href="#l76.29"></a><span id="l76.29">     nsString statusString;</span>
<a href="#l76.30"></a><span id="l76.30" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l76.31"></a><span id="l76.31" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l76.32"></a><span id="l76.32" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l76.33"></a><span id="l76.33" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l76.34"></a><span id="l76.34" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l76.35"></a><span id="l76.35"> </span>
<a href="#l76.36"></a><span id="l76.36">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l76.37"></a><span id="l76.37">     rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l76.38"></a><span id="l76.38">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l76.39"></a><span id="l76.39"> </span>
<a href="#l76.40"></a><span id="l76.40">     rv = bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;noNewMessages&quot;).get(), getter_Copies(statusString));</span>
<a href="#l76.41"></a><span id="l76.41">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l76.42"></a><span id="l76.42"> </span>
<a href="#l76.43"></a><span id="l76.43" class="difflineat">@@ -905,18 +907,19 @@ nsNNTPNewsgroupList::FinishXOVERLINE(int</span>
<a href="#l76.44"></a><span id="l76.44">     if (m_lastMsgNumber &gt; 0) {</span>
<a href="#l76.45"></a><span id="l76.45">       nsAutoString firstStr;</span>
<a href="#l76.46"></a><span id="l76.46">       firstStr.AppendInt(m_lastProcessedNumber - m_firstMsgNumber + 1);</span>
<a href="#l76.47"></a><span id="l76.47"> </span>
<a href="#l76.48"></a><span id="l76.48">       nsAutoString lastStr;</span>
<a href="#l76.49"></a><span id="l76.49">       lastStr.AppendInt(m_lastMsgNumber - m_firstMsgNumber + 1);</span>
<a href="#l76.50"></a><span id="l76.50"> </span>
<a href="#l76.51"></a><span id="l76.51">       nsString statusString;</span>
<a href="#l76.52"></a><span id="l76.52" class="difflineminus">-      nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l76.53"></a><span id="l76.53" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l76.54"></a><span id="l76.54" class="difflineplus">+      nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l76.55"></a><span id="l76.55" class="difflineplus">+        mozilla::services::GetStringBundleService();</span>
<a href="#l76.56"></a><span id="l76.56" class="difflineplus">+      NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l76.57"></a><span id="l76.57"> </span>
<a href="#l76.58"></a><span id="l76.58">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l76.59"></a><span id="l76.59">       rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l76.60"></a><span id="l76.60">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l76.61"></a><span id="l76.61"> </span>
<a href="#l76.62"></a><span id="l76.62">       const PRUnichar *formatStrings[2] = { firstStr.get(), lastStr.get() };</span>
<a href="#l76.63"></a><span id="l76.63">       rv = bundle-&gt;FormatStringFromName(NS_LITERAL_STRING(&quot;downloadingArticles&quot;).get(), formatStrings, 2, getter_Copies(statusString));</span>
<a href="#l76.64"></a><span id="l76.64">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l76.65"></a><span id="l76.65" class="difflineat">@@ -1290,18 +1293,19 @@ nsNNTPNewsgroupList::UpdateStatus(bool f</span>
<a href="#l76.66"></a><span id="l76.66">   totalToDownloadStr.AppendInt(totToDL);</span>
<a href="#l76.67"></a><span id="l76.67"> </span>
<a href="#l76.68"></a><span id="l76.68">   nsAutoString newsgroupName;</span>
<a href="#l76.69"></a><span id="l76.69">   nsresult rv = m_newsFolder-&gt;GetUnicodeName(newsgroupName);</span>
<a href="#l76.70"></a><span id="l76.70">   if (!NS_SUCCEEDED(rv))</span>
<a href="#l76.71"></a><span id="l76.71">       return;</span>
<a href="#l76.72"></a><span id="l76.72"> </span>
<a href="#l76.73"></a><span id="l76.73">   nsString statusString;</span>
<a href="#l76.74"></a><span id="l76.74" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l76.75"></a><span id="l76.75" class="difflineminus">-  if (!NS_SUCCEEDED(rv))</span>
<a href="#l76.76"></a><span id="l76.76" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l76.77"></a><span id="l76.77" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l76.78"></a><span id="l76.78" class="difflineplus">+  if (!bundleService)</span>
<a href="#l76.79"></a><span id="l76.79">     return;</span>
<a href="#l76.80"></a><span id="l76.80"> </span>
<a href="#l76.81"></a><span id="l76.81">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l76.82"></a><span id="l76.82">   rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l76.83"></a><span id="l76.83">   if (!NS_SUCCEEDED(rv))</span>
<a href="#l76.84"></a><span id="l76.84">     return;</span>
<a href="#l76.85"></a><span id="l76.85"> </span>
<a href="#l76.86"></a><span id="l76.86">   if (filtering)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -65,16 +65,17 @@</span>
<a href="#l77.4"></a><span id="l77.4"> #include &quot;nsMsgNewsCID.h&quot;</span>
<a href="#l77.5"></a><span id="l77.5"> </span>
<a href="#l77.6"></a><span id="l77.6"> #include &quot;nsINntpUrl.h&quot;</span>
<a href="#l77.7"></a><span id="l77.7"> #include &quot;prmem.h&quot;</span>
<a href="#l77.8"></a><span id="l77.8"> #include &quot;prtime.h&quot;</span>
<a href="#l77.9"></a><span id="l77.9"> #include &quot;prlog.h&quot;</span>
<a href="#l77.10"></a><span id="l77.10"> #include &quot;prerror.h&quot;</span>
<a href="#l77.11"></a><span id="l77.11"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l77.12"></a><span id="l77.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l77.13"></a><span id="l77.13"> </span>
<a href="#l77.14"></a><span id="l77.14"> #include &quot;prprf.h&quot;</span>
<a href="#l77.15"></a><span id="l77.15"> </span>
<a href="#l77.16"></a><span id="l77.16"> /* include event sink interfaces for news */</span>
<a href="#l77.17"></a><span id="l77.17"> </span>
<a href="#l77.18"></a><span id="l77.18"> #include &quot;nsIMsgHeaderParser.h&quot;</span>
<a href="#l77.19"></a><span id="l77.19"> #include &quot;nsIMsgSearchSession.h&quot;</span>
<a href="#l77.20"></a><span id="l77.20"> #include &quot;nsIMsgSearchAdapter.h&quot;</span>
<a href="#l77.21"></a><span id="l77.21" class="difflineat">@@ -1050,17 +1051,18 @@ nsresult nsNNTPProtocol::LoadUrl(nsIURI </span>
<a href="#l77.22"></a><span id="l77.22">       if (!dialog)</span>
<a href="#l77.23"></a><span id="l77.23">       {</span>
<a href="#l77.24"></a><span id="l77.24">          nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch(do_GetService(NS_WINDOWWATCHER_CONTRACTID));</span>
<a href="#l77.25"></a><span id="l77.25">          wwatch-&gt;GetNewPrompter(nsnull, getter_AddRefs(dialog));</span>
<a href="#l77.26"></a><span id="l77.26">       }</span>
<a href="#l77.27"></a><span id="l77.27"> </span>
<a href="#l77.28"></a><span id="l77.28">       nsString statusString, confirmText;</span>
<a href="#l77.29"></a><span id="l77.29">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l77.30"></a><span id="l77.30" class="difflineminus">-      nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID);</span>
<a href="#l77.31"></a><span id="l77.31" class="difflineplus">+      nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l77.32"></a><span id="l77.32" class="difflineplus">+        mozilla::services::GetStringBundleService();</span>
<a href="#l77.33"></a><span id="l77.33"> </span>
<a href="#l77.34"></a><span id="l77.34">       // to handle non-ASCII newsgroup names, we store them internally</span>
<a href="#l77.35"></a><span id="l77.35">       // as escaped. decode and unescape the newsgroup name so we'll</span>
<a href="#l77.36"></a><span id="l77.36">       // display a proper name.</span>
<a href="#l77.37"></a><span id="l77.37"> </span>
<a href="#l77.38"></a><span id="l77.38">       nsAutoString unescapedName;</span>
<a href="#l77.39"></a><span id="l77.39">       rv = NS_MsgDecodeUnescapeURLPath(group, unescapedName);</span>
<a href="#l77.40"></a><span id="l77.40">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l77.41"></a><span id="l77.41" class="difflineat">@@ -2862,18 +2864,19 @@ PRInt32 nsNNTPProtocol::ReadNewsList(nsI</span>
<a href="#l77.42"></a><span id="l77.42"> </span>
<a href="#l77.43"></a><span id="l77.43">       nsCOMPtr &lt;nsIMsgStatusFeedback&gt; msgStatusFeedback;</span>
<a href="#l77.44"></a><span id="l77.44"> </span>
<a href="#l77.45"></a><span id="l77.45">       rv = m_msgWindow-&gt;GetStatusFeedback(getter_AddRefs(msgStatusFeedback));</span>
<a href="#l77.46"></a><span id="l77.46">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l77.47"></a><span id="l77.47"> </span>
<a href="#l77.48"></a><span id="l77.48">       nsString statusString;</span>
<a href="#l77.49"></a><span id="l77.49"> </span>
<a href="#l77.50"></a><span id="l77.50" class="difflineminus">-      nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l77.51"></a><span id="l77.51" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l77.52"></a><span id="l77.52" class="difflineplus">+      nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l77.53"></a><span id="l77.53" class="difflineplus">+        mozilla::services::GetStringBundleService();</span>
<a href="#l77.54"></a><span id="l77.54" class="difflineplus">+      NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l77.55"></a><span id="l77.55"> </span>
<a href="#l77.56"></a><span id="l77.56">       nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l77.57"></a><span id="l77.57">       rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l77.58"></a><span id="l77.58">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l77.59"></a><span id="l77.59"> </span>
<a href="#l77.60"></a><span id="l77.60">       nsAutoString bytesStr;</span>
<a href="#l77.61"></a><span id="l77.61">       bytesStr.AppendInt(mBytesReceived / 1024);</span>
<a href="#l77.62"></a><span id="l77.62"> </span>
<a href="#l77.63"></a><span id="l77.63" class="difflineat">@@ -3451,18 +3454,19 @@ PRInt32 nsNNTPProtocol::ReadNewsgroupBod</span>
<a href="#l77.64"></a><span id="l77.64"> </span>
<a href="#l77.65"></a><span id="l77.65"> nsresult nsNNTPProtocol::GetNewsStringByID(PRInt32 stringID, PRUnichar **aString)</span>
<a href="#l77.66"></a><span id="l77.66"> {</span>
<a href="#l77.67"></a><span id="l77.67">   nsresult rv;</span>
<a href="#l77.68"></a><span id="l77.68">   nsAutoString resultString(NS_LITERAL_STRING(&quot;???&quot;));</span>
<a href="#l77.69"></a><span id="l77.69"> </span>
<a href="#l77.70"></a><span id="l77.70">   if (!m_stringBundle)</span>
<a href="#l77.71"></a><span id="l77.71">   {</span>
<a href="#l77.72"></a><span id="l77.72" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l77.73"></a><span id="l77.73" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l77.74"></a><span id="l77.74" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l77.75"></a><span id="l77.75" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l77.76"></a><span id="l77.76" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l77.77"></a><span id="l77.77"> </span>
<a href="#l77.78"></a><span id="l77.78">     rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(m_stringBundle));</span>
<a href="#l77.79"></a><span id="l77.79">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l77.80"></a><span id="l77.80">   }</span>
<a href="#l77.81"></a><span id="l77.81"> </span>
<a href="#l77.82"></a><span id="l77.82">   if (m_stringBundle) {</span>
<a href="#l77.83"></a><span id="l77.83">     PRUnichar *ptrv = nsnull;</span>
<a href="#l77.84"></a><span id="l77.84">     rv = m_stringBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l77.85"></a><span id="l77.85" class="difflineat">@@ -3485,18 +3489,19 @@ nsresult nsNNTPProtocol::GetNewsStringBy</span>
<a href="#l77.86"></a><span id="l77.86"> }</span>
<a href="#l77.87"></a><span id="l77.87"> </span>
<a href="#l77.88"></a><span id="l77.88"> nsresult nsNNTPProtocol::GetNewsStringByName(const char *aName, PRUnichar **aString)</span>
<a href="#l77.89"></a><span id="l77.89"> {</span>
<a href="#l77.90"></a><span id="l77.90">   nsresult rv;</span>
<a href="#l77.91"></a><span id="l77.91">   nsAutoString resultString(NS_LITERAL_STRING(&quot;???&quot;));</span>
<a href="#l77.92"></a><span id="l77.92">   if (!m_stringBundle)</span>
<a href="#l77.93"></a><span id="l77.93">   {</span>
<a href="#l77.94"></a><span id="l77.94" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l77.95"></a><span id="l77.95" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l77.96"></a><span id="l77.96" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l77.97"></a><span id="l77.97" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l77.98"></a><span id="l77.98" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l77.99"></a><span id="l77.99"> </span>
<a href="#l77.100"></a><span id="l77.100">     rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(m_stringBundle));</span>
<a href="#l77.101"></a><span id="l77.101">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l77.102"></a><span id="l77.102">   }</span>
<a href="#l77.103"></a><span id="l77.103"> </span>
<a href="#l77.104"></a><span id="l77.104">   if (m_stringBundle)</span>
<a href="#l77.105"></a><span id="l77.105">   {</span>
<a href="#l77.106"></a><span id="l77.106">     nsAutoString unicodeName;</span>
<a href="#l77.107"></a><span id="l77.107" class="difflineat">@@ -3692,17 +3697,17 @@ PRInt32 nsNNTPProtocol::DoCancel()</span>
<a href="#l77.108"></a><span id="l77.108">   // These shouldn't be set yet, since the headers haven't been &quot;flushed&quot;</span>
<a href="#l77.109"></a><span id="l77.109">   // &quot;Distribution: &quot; doesn't appear to be required, so</span>
<a href="#l77.110"></a><span id="l77.110">   // don't assert on m_cancelDistribution</span>
<a href="#l77.111"></a><span id="l77.111">   NS_ASSERTION (m_cancelID &amp;&amp;</span>
<a href="#l77.112"></a><span id="l77.112">    m_cancelFromHdr &amp;&amp;</span>
<a href="#l77.113"></a><span id="l77.113">    m_cancelNewsgroups, &quot;null ptr&quot;);</span>
<a href="#l77.114"></a><span id="l77.114"> </span>
<a href="#l77.115"></a><span id="l77.115">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l77.116"></a><span id="l77.116" class="difflineminus">-    do_GetService(NS_STRINGBUNDLE_CONTRACTID);</span>
<a href="#l77.117"></a><span id="l77.117" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l77.118"></a><span id="l77.118">   NS_ENSURE_TRUE(bundleService, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l77.119"></a><span id="l77.119"> </span>
<a href="#l77.120"></a><span id="l77.120">   nsCOMPtr&lt;nsIStringBundle&gt; brandBundle;</span>
<a href="#l77.121"></a><span id="l77.121">   bundleService-&gt;CreateBundle(&quot;chrome://branding/locale/brand.properties&quot;,</span>
<a href="#l77.122"></a><span id="l77.122">                               getter_AddRefs(brandBundle));</span>
<a href="#l77.123"></a><span id="l77.123">   NS_ENSURE_TRUE(brandBundle, NS_ERROR_FAILURE);</span>
<a href="#l77.124"></a><span id="l77.124"> </span>
<a href="#l77.125"></a><span id="l77.125">   nsString brandFullName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/mailnews/news/src/nsNewsDownloader.cpp</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsDownloader.cpp</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -51,16 +51,17 @@</span>
<a href="#l78.4"></a><span id="l78.4"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l78.5"></a><span id="l78.5"> #include &quot;nsIRequestObserver.h&quot;</span>
<a href="#l78.6"></a><span id="l78.6"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l78.7"></a><span id="l78.7"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l78.8"></a><span id="l78.8"> #include &quot;nsIMsgStatusFeedback.h&quot;</span>
<a href="#l78.9"></a><span id="l78.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l78.10"></a><span id="l78.10"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l78.11"></a><span id="l78.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l78.12"></a><span id="l78.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l78.13"></a><span id="l78.13"> </span>
<a href="#l78.14"></a><span id="l78.14"> // This file contains the news article download state machine.</span>
<a href="#l78.15"></a><span id="l78.15"> </span>
<a href="#l78.16"></a><span id="l78.16"> // if pIds is not null, download the articles whose id's are passed in. Otherwise,</span>
<a href="#l78.17"></a><span id="l78.17"> // which articles to download is determined by nsNewsDownloader object,</span>
<a href="#l78.18"></a><span id="l78.18"> // or subclasses thereof. News can download marked objects, for example.</span>
<a href="#l78.19"></a><span id="l78.19"> nsresult nsNewsDownloader::DownloadArticles(nsIMsgWindow *window, nsIMsgFolder *folder, nsTArray&lt;nsMsgKey&gt; *pIds)</span>
<a href="#l78.20"></a><span id="l78.20"> {</span>
<a href="#l78.21"></a><span id="l78.21" class="difflineat">@@ -210,18 +211,19 @@ bool nsNewsDownloader::GetNextHdrToRetri</span>
<a href="#l78.22"></a><span id="l78.22">       LL_SUB(diffSinceLastProgress, nowMS, m_lastProgressTime); // r = a - b</span>
<a href="#l78.23"></a><span id="l78.23">       LL_SUB(diffSinceLastProgress, diffSinceLastProgress, minIntervalBetweenProgress); // r = a - b</span>
<a href="#l78.24"></a><span id="l78.24">       if (!LL_GE_ZERO(diffSinceLastProgress))</span>
<a href="#l78.25"></a><span id="l78.25">         return true;</span>
<a href="#l78.26"></a><span id="l78.26">     }</span>
<a href="#l78.27"></a><span id="l78.27"> </span>
<a href="#l78.28"></a><span id="l78.28">     m_lastProgressTime = nowMS;</span>
<a href="#l78.29"></a><span id="l78.29">     nsCOMPtr &lt;nsIMsgNewsFolder&gt; newsFolder = do_QueryInterface(m_folder);</span>
<a href="#l78.30"></a><span id="l78.30" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l78.31"></a><span id="l78.31" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l78.32"></a><span id="l78.32" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l78.33"></a><span id="l78.33" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l78.34"></a><span id="l78.34" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, false);</span>
<a href="#l78.35"></a><span id="l78.35">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l78.36"></a><span id="l78.36">     rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l78.37"></a><span id="l78.37">     NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l78.38"></a><span id="l78.38"> </span>
<a href="#l78.39"></a><span id="l78.39">     nsAutoString firstStr;</span>
<a href="#l78.40"></a><span id="l78.40">     firstStr.AppendInt(m_numwrote);</span>
<a href="#l78.41"></a><span id="l78.41">     nsAutoString totalStr;</span>
<a href="#l78.42"></a><span id="l78.42">     totalStr.AppendInt(m_keysToDownload.Length());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -92,16 +92,17 @@</span>
<a href="#l79.4"></a><span id="l79.4"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l79.5"></a><span id="l79.5"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l79.6"></a><span id="l79.6"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l79.7"></a><span id="l79.7"> #include &quot;nsILoginInfo.h&quot;</span>
<a href="#l79.8"></a><span id="l79.8"> #include &quot;nsILoginManager.h&quot;</span>
<a href="#l79.9"></a><span id="l79.9"> #include &quot;nsIPromptService.h&quot;</span>
<a href="#l79.10"></a><span id="l79.10"> #include &quot;nsEmbedCID.h&quot;</span>
<a href="#l79.11"></a><span id="l79.11"> #include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l79.12"></a><span id="l79.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l79.13"></a><span id="l79.13"> </span>
<a href="#l79.14"></a><span id="l79.14"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l79.15"></a><span id="l79.15"> </span>
<a href="#l79.16"></a><span id="l79.16"> // ###tw  This really ought to be the most</span>
<a href="#l79.17"></a><span id="l79.17"> // efficient file reading size for the current</span>
<a href="#l79.18"></a><span id="l79.18"> // operating system.</span>
<a href="#l79.19"></a><span id="l79.19"> #define NEWSRC_FILE_BUFFER_SIZE 1024</span>
<a href="#l79.20"></a><span id="l79.20"> </span>
<a href="#l79.21"></a><span id="l79.21" class="difflineat">@@ -1470,18 +1471,19 @@ nsMsgNewsFolder::GetGroupUsernameWithUI(</span>
<a href="#l79.22"></a><span id="l79.22">     // let us store username-only passwords. So go direct to the dialog and</span>
<a href="#l79.23"></a><span id="l79.23">     // cut out the middle-man.</span>
<a href="#l79.24"></a><span id="l79.24">     nsCOMPtr&lt;nsIPromptService&gt; promptSvc =</span>
<a href="#l79.25"></a><span id="l79.25">       do_GetService(NS_PROMPTSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l79.26"></a><span id="l79.26">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l79.27"></a><span id="l79.27"> </span>
<a href="#l79.28"></a><span id="l79.28">     bool saveUsername = false;</span>
<a href="#l79.29"></a><span id="l79.29"> </span>
<a href="#l79.30"></a><span id="l79.30" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l79.31"></a><span id="l79.31" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l79.32"></a><span id="l79.32" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l79.33"></a><span id="l79.33" class="difflineplus">+      mozilla::services::GetStringBundleService();</span>
<a href="#l79.34"></a><span id="l79.34" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l79.35"></a><span id="l79.35"> </span>
<a href="#l79.36"></a><span id="l79.36">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l79.37"></a><span id="l79.37">     rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l79.38"></a><span id="l79.38">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l79.39"></a><span id="l79.39"> </span>
<a href="#l79.40"></a><span id="l79.40">     nsString saveUsernameText;</span>
<a href="#l79.41"></a><span id="l79.41">     rv = bundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;saveUsername&quot;).get(),</span>
<a href="#l79.42"></a><span id="l79.42">                                    getter_Copies(saveUsernameText));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -61,16 +61,17 @@</span>
<a href="#l80.4"></a><span id="l80.4"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l80.5"></a><span id="l80.5"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l80.6"></a><span id="l80.6"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l80.7"></a><span id="l80.7"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l80.8"></a><span id="l80.8"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l80.9"></a><span id="l80.9"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l80.10"></a><span id="l80.10"> #include &quot;nsISimpleEnumerator.h&quot;</span>
<a href="#l80.11"></a><span id="l80.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l80.12"></a><span id="l80.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l80.13"></a><span id="l80.13"> </span>
<a href="#l80.14"></a><span id="l80.14"> #define INVALID_VERSION         0</span>
<a href="#l80.15"></a><span id="l80.15"> #define VALID_VERSION           2</span>
<a href="#l80.16"></a><span id="l80.16"> #define NEW_NEWS_DIR_NAME       &quot;News&quot;</span>
<a href="#l80.17"></a><span id="l80.17"> #define PREF_MAIL_NEWSRC_ROOT   &quot;mail.newsrc_root&quot;</span>
<a href="#l80.18"></a><span id="l80.18"> #define PREF_MAIL_NEWSRC_ROOT_REL &quot;mail.newsrc_root-rel&quot;</span>
<a href="#l80.19"></a><span id="l80.19"> #define PREF_MAILNEWS_VIEW_DEFAULT_CHARSET &quot;mailnews.view_default_charset&quot;</span>
<a href="#l80.20"></a><span id="l80.20"> #define HOSTINFO_FILE_NAME      &quot;hostinfo.dat&quot;</span>
<a href="#l80.21"></a><span id="l80.21" class="difflineat">@@ -1593,18 +1594,19 @@ nsNntpIncomingServer::GroupNotFound(nsIM</span>
<a href="#l80.22"></a><span id="l80.22">   }</span>
<a href="#l80.23"></a><span id="l80.23"> </span>
<a href="#l80.24"></a><span id="l80.24">   if (!prompt) {</span>
<a href="#l80.25"></a><span id="l80.25">     nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch(do_GetService(NS_WINDOWWATCHER_CONTRACTID));</span>
<a href="#l80.26"></a><span id="l80.26">     rv = wwatch-&gt;GetNewPrompter(nsnull, getter_AddRefs(prompt));</span>
<a href="#l80.27"></a><span id="l80.27">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l80.28"></a><span id="l80.28">   }</span>
<a href="#l80.29"></a><span id="l80.29"> </span>
<a href="#l80.30"></a><span id="l80.30" class="difflineminus">-  nsCOMPtr &lt;nsIStringBundleService&gt; bundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID,&amp;rv);</span>
<a href="#l80.31"></a><span id="l80.31" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l80.32"></a><span id="l80.32" class="difflineplus">+  nsCOMPtr &lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l80.33"></a><span id="l80.33" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l80.34"></a><span id="l80.34" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l80.35"></a><span id="l80.35"> </span>
<a href="#l80.36"></a><span id="l80.36">   nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l80.37"></a><span id="l80.37">   rv = bundleService-&gt;CreateBundle(NEWS_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l80.38"></a><span id="l80.38">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l80.39"></a><span id="l80.39"> </span>
<a href="#l80.40"></a><span id="l80.40">   nsCString hostname;</span>
<a href="#l80.41"></a><span id="l80.41">   rv = GetHostName(hostname);</span>
<a href="#l80.42"></a><span id="l80.42">   NS_ENSURE_SUCCESS(rv,rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/suite/shell/src/nsWindowsShellService.cpp</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/suite/shell/src/nsWindowsShellService.cpp</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -60,16 +60,17 @@</span>
<a href="#l81.4"></a><span id="l81.4"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l81.5"></a><span id="l81.5"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l81.6"></a><span id="l81.6"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l81.7"></a><span id="l81.7"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l81.8"></a><span id="l81.8"> #include &quot;nsIWinTaskbar.h&quot;</span>
<a href="#l81.9"></a><span id="l81.9"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l81.10"></a><span id="l81.10"> #include &lt;mbstring.h&gt;</span>
<a href="#l81.11"></a><span id="l81.11"> #include &quot;mozilla/ModuleUtils.h&quot;</span>
<a href="#l81.12"></a><span id="l81.12" class="difflineplus">+#include &quot;mozilla/Services.h&quot;</span>
<a href="#l81.13"></a><span id="l81.13"> </span>
<a href="#l81.14"></a><span id="l81.14"> #ifdef MOZILLA_INTERNAL_API</span>
<a href="#l81.15"></a><span id="l81.15"> #define CaseInsensitiveCompare nsCaseInsensitiveStringComparator()</span>
<a href="#l81.16"></a><span id="l81.16"> #endif</span>
<a href="#l81.17"></a><span id="l81.17"> </span>
<a href="#l81.18"></a><span id="l81.18"> #ifdef _WIN32_WINNT</span>
<a href="#l81.19"></a><span id="l81.19"> #undef _WIN32_WINNT</span>
<a href="#l81.20"></a><span id="l81.20"> #endif</span>
<a href="#l81.21"></a><span id="l81.21" class="difflineat">@@ -785,19 +786,19 @@ nsWindowsShellService::SetDesktopBackgro</span>
<a href="#l81.22"></a><span id="l81.22">       return rv;</span>
<a href="#l81.23"></a><span id="l81.23">     rv = request-&gt;GetImage(getter_AddRefs(container));</span>
<a href="#l81.24"></a><span id="l81.24">   }</span>
<a href="#l81.25"></a><span id="l81.25"> </span>
<a href="#l81.26"></a><span id="l81.26">   if (!container)</span>
<a href="#l81.27"></a><span id="l81.27">     return NS_ERROR_FAILURE;</span>
<a href="#l81.28"></a><span id="l81.28"> </span>
<a href="#l81.29"></a><span id="l81.29">   // get the file name from localized strings</span>
<a href="#l81.30"></a><span id="l81.30" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt;</span>
<a href="#l81.31"></a><span id="l81.31" class="difflineminus">-    bundleService(do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv));</span>
<a href="#l81.32"></a><span id="l81.32" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l81.33"></a><span id="l81.33" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l81.34"></a><span id="l81.34" class="difflineplus">+    mozilla::services::GetStringBundleService();</span>
<a href="#l81.35"></a><span id="l81.35" class="difflineplus">+  NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l81.36"></a><span id="l81.36"> </span>
<a href="#l81.37"></a><span id="l81.37">   nsCOMPtr&lt;nsIStringBundle&gt; shellBundle;</span>
<a href="#l81.38"></a><span id="l81.38">   rv = bundleService-&gt;CreateBundle(SHELLSERVICE_PROPERTIES,</span>
<a href="#l81.39"></a><span id="l81.39">                                    getter_AddRefs(shellBundle));</span>
<a href="#l81.40"></a><span id="l81.40">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l81.41"></a><span id="l81.41">  </span>
<a href="#l81.42"></a><span id="l81.42">   // e.g. &quot;Desktop Background.bmp&quot;</span>
<a href="#l81.43"></a><span id="l81.43">   nsString fileLeafName;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

