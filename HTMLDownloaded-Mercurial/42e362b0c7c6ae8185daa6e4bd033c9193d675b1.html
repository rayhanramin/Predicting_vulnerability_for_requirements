<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 9625:42e362b0c7c6ae8185daa6e4bd033c9193d675b1</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 42e362b0c7c6ae8185daa6e4bd033c9193d675b1" />
<meta property="og:url" content="/comm-central/rev/42e362b0c7c6ae8185daa6e4bd033c9193d675b1" />
<meta property="og:description" content="add ui for cloud files, changes by mconley, squib, andreas, r=mconley, squib, etc, bug 698925" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 42e362b0c7c6ae8185daa6e4bd033c9193d675b1 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/42e362b0c7c6ae8185daa6e4bd033c9193d675b1">shortlog</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/42e362b0c7c6ae8185daa6e4bd033c9193d675b1">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1">files</a> |
changeset |
<a href="/comm-central/raw-rev/42e362b0c7c6ae8185daa6e4bd033c9193d675b1">raw</a>  | <a href="/comm-central/archive/42e362b0c7c6ae8185daa6e4bd033c9193d675b1.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
add ui for cloud files, changes by mconley, squib, andreas, r=mconley, squib, etc, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=698925">bug 698925</a>
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#97;&#118;&#105;&#100;&#32;&#66;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#32;&#60;&#98;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#64;&#110;&#118;&#101;&#110;&#116;&#117;&#114;&#101;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 12 Mar 2012 16:15:30 -0700</td></tr>

<tr>
 <td>changeset 9625</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/42e362b0c7c6ae8185daa6e4bd033c9193d675b1">42e362b0c7c6ae8185daa6e4bd033c9193d675b1</a></td>
</tr>



<tr>
<td>parent 9624</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0d9014f1f95325841c3cd01d7183b845c8043be5">0d9014f1f95325841c3cd01d7183b845c8043be5</a>
</td>
</tr>

<tr>
<td>child 9626</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/cccf1c19d8a244e6cd55272246ba8fd812edcd9a">cccf1c19d8a244e6cd55272246ba8fd812edcd9a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=42e362b0c7c6ae8185daa6e4bd033c9193d675b1">7354</a></td></tr>
<tr><td>push user</td><td>bienvenu@nventure.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 12 Mar 2012 23:15:06 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@42e362b0c7c6 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=42e362b0c7c6ae8185daa6e4bd033c9193d675b1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=42e362b0c7c6ae8185daa6e4bd033c9193d675b1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=42e362b0c7c6ae8185daa6e4bd033c9193d675b1&newProject=comm-central&newRevision=42e362b0c7c6ae8185daa6e4bd033c9193d675b1&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=42e362b0c7c6ae8185daa6e4bd033c9193d675b1&newProject=comm-central&newRevision=42e362b0c7c6ae8185daa6e4bd033c9193d675b1&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=42e362b0c7c6ae8185daa6e4bd033c9193d675b1&newProject=comm-central&newRevision=42e362b0c7c6ae8185daa6e4bd033c9193d675b1&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mconley%29&revcount=50">mconley</a>, <a href="/comm-central/log?rev=reviewer%28squib%29&revcount=50">squib</a>, <a href="/comm-central/log?rev=reviewer%28etc%29&revcount=50">etc</a>, <a href="/comm-central/log?rev=reviewer%28bug%29&revcount=50">bug</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=698925">698925</a></td></tr>




</table></div>

<div class="page_body description">add ui for cloud files, changes by mconley, squib, andreas, r=mconley, squib, etc, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=698925">bug 698925</a></div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/app/profile/all-thunderbird.js">mail/app/profile/all-thunderbird.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/app/profile/all-thunderbird.js">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/app/profile/all-thunderbird.js">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/app/profile/all-thunderbird.js">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/app/profile/all-thunderbird.js">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/app/profile/all-thunderbird.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.js">mail/base/content/browserRequest.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.js">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.js">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.js">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.js">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.xul">mail/base/content/browserRequest.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.xul">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.xul">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.xul">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.xul">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/browserRequest.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailCore.js">mail/base/content/mailCore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailCore.js">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailCore.js">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailCore.js">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailCore.js">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailCore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailWidgets.xml">mail/base/content/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/content/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/jar.mn">mail/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/jar.mn">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/jar.mn">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/Makefile.in">mail/base/modules/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/Makefile.in">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/Makefile.in">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/Makefile.in">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/Makefile.in">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/http.jsm">mail/base/modules/http.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/http.jsm">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/http.jsm">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/http.jsm">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/http.jsm">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/http.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/oauth.jsm">mail/base/modules/oauth.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/oauth.jsm">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/oauth.jsm">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/oauth.jsm">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/oauth.jsm">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/base/modules/oauth.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/Makefile.in">mail/components/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/Makefile.in">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/Makefile.in">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/Makefile.in">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/Makefile.in">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/bigFileObserver.js">mail/components/compose/content/bigFileObserver.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/bigFileObserver.js">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/bigFileObserver.js">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/bigFileObserver.js">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/bigFileObserver.js">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/bigFileObserver.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/cloudAttachmentLinkManager.js">mail/components/compose/content/cloudAttachmentLinkManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/cloudAttachmentLinkManager.js">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/cloudAttachmentLinkManager.js">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/cloudAttachmentLinkManager.js">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/cloudAttachmentLinkManager.js">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/cloudAttachmentLinkManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/messengercompose.xul">mail/components/compose/content/messengercompose.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/messengercompose.xul">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/messengercompose.xul">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/messengercompose.xul">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/messengercompose.xul">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/content/messengercompose.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/jar.mn">mail/components/compose/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/jar.mn">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/jar.mn">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/jar.mn">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/jar.mn">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/compose/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.js">mail/components/preferences/applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.js">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.js">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.js">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.js">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.xul">mail/components/preferences/applications.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.xul">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.xul">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.xul">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.xul">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/applications.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/preferences.xul">mail/components/preferences/preferences.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/preferences.xul">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/preferences.xul">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/preferences.xul">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/preferences.xul">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/components/preferences/preferences.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/installer/package-manifest.in">mail/installer/package-manifest.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/installer/package-manifest.in">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/installer/package-manifest.in">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/installer/package-manifest.in">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/installer/package-manifest.in">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/installer/package-manifest.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/Dropbox/management.dtd">mail/locales/en-US/chrome/messenger/cloudfile/Dropbox/management.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/Dropbox/management.dtd">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/Dropbox/management.dtd">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/Dropbox/management.dtd">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/Dropbox/management.dtd">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/Dropbox/management.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/management.dtd">mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/management.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/management.dtd">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/management.dtd">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/management.dtd">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/management.dtd">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/management.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/settings.dtd">mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/settings.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/settings.dtd">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/settings.dtd">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/settings.dtd">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/settings.dtd">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/settings.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/addAccountDialog.dtd">mail/locales/en-US/chrome/messenger/cloudfile/addAccountDialog.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/addAccountDialog.dtd">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/addAccountDialog.dtd">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/addAccountDialog.dtd">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/addAccountDialog.dtd">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/addAccountDialog.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/management.dtd">mail/locales/en-US/chrome/messenger/cloudfile/management.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/management.dtd">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/management.dtd">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/management.dtd">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/management.dtd">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/cloudfile/management.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/preferences/applications.dtd">mail/locales/en-US/chrome/messenger/preferences/applications.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/preferences/applications.dtd">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/preferences/applications.dtd">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/preferences/applications.dtd">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/preferences/applications.dtd">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/en-US/chrome/messenger/preferences/applications.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/jar.mn">mail/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/jar.mn">mail/themes/gnomestripe/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/jar.mn">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/jar.mn">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/jar.mn">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/jar.mn">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/browserRequest.css">mail/themes/gnomestripe/mail/browserRequest.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/browserRequest.css">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/browserRequest.css">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/browserRequest.css">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/browserRequest.css">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/browserRequest.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/compose/messengercompose.css">mail/themes/gnomestripe/mail/compose/messengercompose.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/compose/messengercompose.css">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/compose/messengercompose.css">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/compose/messengercompose.css">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/compose/messengercompose.css">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/compose/messengercompose.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/applications.css">mail/themes/gnomestripe/mail/preferences/applications.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/applications.css">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/applications.css">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/applications.css">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/applications.css">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/applications.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/preferences.css">mail/themes/gnomestripe/mail/preferences/preferences.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/preferences.css">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/preferences.css">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/preferences.css">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/preferences.css">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/gnomestripe/mail/preferences/preferences.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/jar.mn">mail/themes/pinstripe/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/jar.mn">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/jar.mn">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/jar.mn">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/jar.mn">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/browserRequest.css">mail/themes/pinstripe/mail/browserRequest.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/browserRequest.css">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/browserRequest.css">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/browserRequest.css">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/browserRequest.css">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/browserRequest.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/compose/messengercompose.css">mail/themes/pinstripe/mail/compose/messengercompose.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/compose/messengercompose.css">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/compose/messengercompose.css">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/compose/messengercompose.css">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/compose/messengercompose.css">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/compose/messengercompose.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/applications.css">mail/themes/pinstripe/mail/preferences/applications.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/applications.css">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/applications.css">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/applications.css">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/applications.css">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/applications.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/preferences.css">mail/themes/pinstripe/mail/preferences/preferences.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/preferences.css">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/preferences.css">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/preferences.css">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/preferences.css">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/pinstripe/mail/preferences/preferences.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/jar.mn">mail/themes/qute/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/jar.mn">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/jar.mn">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/jar.mn">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/jar.mn">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/browserRequest.css">mail/themes/qute/mail/browserRequest.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/browserRequest.css">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/browserRequest.css">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/browserRequest.css">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/browserRequest.css">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/browserRequest.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/applications.css">mail/themes/qute/mail/preferences/applications.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/applications.css">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/applications.css">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/applications.css">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/applications.css">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/applications.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/preferences.css">mail/themes/qute/mail/preferences/preferences.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/preferences.css">file</a> |
<a href="/comm-central/annotate/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/preferences.css">annotate</a> |
<a href="/comm-central/diff/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/preferences.css">diff</a> |
<a href="/comm-central/comparison/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/preferences.css">comparison</a> |
<a href="/comm-central/log/42e362b0c7c6ae8185daa6e4bd033c9193d675b1/mail/themes/qute/mail/preferences/preferences.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/app/profile/all-thunderbird.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/app/profile/all-thunderbird.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -477,16 +477,22 @@ pref(&quot;toolbar.customization.usesheet&quot;, f</span>
<a href="#l1.4"></a><span id="l1.4"> // Check for missing attachments?</span>
<a href="#l1.5"></a><span id="l1.5"> pref(&quot;mail.compose.attachment_reminder&quot;, true);</span>
<a href="#l1.6"></a><span id="l1.6"> // Words that should trigger a missing attachments warning.</span>
<a href="#l1.7"></a><span id="l1.7"> pref(&quot;mail.compose.attachment_reminder_keywords&quot;, &quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;);</span>
<a href="#l1.8"></a><span id="l1.8"> // When no action is taken on the inline missing attachement notification,</span>
<a href="#l1.9"></a><span id="l1.9"> // show an alert on send?</span>
<a href="#l1.10"></a><span id="l1.10"> pref(&quot;mail.compose.attachment_reminder_aggressive&quot;, true);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+// True if the user should be notified when attaching big files</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+pref(&quot;mail.compose.big_attachments.notify&quot;, true);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+// Size (in kB) to automatically prompt for conversion of attachments to</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+// cloud links</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+pref(&quot;mail.compose.big_attachments.threshold_kb&quot;, 1024);</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+</span>
<a href="#l1.18"></a><span id="l1.18"> // Set this to false to prevent instrumentation from happening, e.g., user</span>
<a href="#l1.19"></a><span id="l1.19"> // has opted out, or an enterprise wants to disable it from the git go.</span>
<a href="#l1.20"></a><span id="l1.20"> pref(&quot;mail.instrumentation.askUser&quot;, true);</span>
<a href="#l1.21"></a><span id="l1.21"> pref(&quot;mail.instrumentation.userOptedIn&quot;, false);</span>
<a href="#l1.22"></a><span id="l1.22"> pref(&quot;mail.instrumentation.postUrl&quot;, &quot;https://www.mozillamessaging.com/instrumentation&quot;);</span>
<a href="#l1.23"></a><span id="l1.23"> // not sure how this will be formatted - would be nice to make it extensible.</span>
<a href="#l1.24"></a><span id="l1.24"> pref(&quot;mail.instrumentation.lastNotificationSent&quot;, &quot;&quot;);</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26" class="difflineat">@@ -762,8 +768,12 @@ pref(&quot;browser.search.order.3&quot;, &quot;chrome:/</span>
<a href="#l1.27"></a><span id="l1.27"> // XXX Don't update yet, until we've verified how that affects us.</span>
<a href="#l1.28"></a><span id="l1.28"> pref(&quot;browser.search.update&quot;, false);</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30"> // Check whether we need to perform engine updates every 6 hours</span>
<a href="#l1.31"></a><span id="l1.31"> pref(&quot;browser.search.update.interval&quot;, 21600);</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33"> // Disable remote debugging protocol logging</span>
<a href="#l1.34"></a><span id="l1.34"> pref(&quot;devtools.debugger.log&quot;, false);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+// BigFiles</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+pref(&quot;mail.cloud_files.enabled&quot;, true);</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+pref(&quot;mail.cloud_files.inserted_urls.footer.link&quot;, &quot;http://www.getthunderbird.com&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/mail/base/content/browserRequest.js</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,113 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+const wpl = Components.interfaces.nsIWebProgressListener;</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+var reporterListener = {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  _isBusy: false,</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  get securityButton() {</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+    delete this.securityButton;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+    return this.securityButton = document.getElementById(&quot;security-button&quot;);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+  },</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+  QueryInterface: function(aIID) {</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+    if (aIID.equals(Components.interfaces.nsIWebProgressListener)   ||</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+        aIID.equals(Components.interfaces.nsISupportsWeakReference) ||</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+        aIID.equals(Components.interfaces.nsISupports))</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+      return this;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+    throw Components.results.NS_NOINTERFACE;</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+  },</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+  onStateChange: function(/*in nsIWebProgress*/ aWebProgress,</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+                     /*in nsIRequest*/ aRequest,</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+                     /*in unsigned long*/ aStateFlags,</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+                     /*in nsresult*/ aStatus) {</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+  },</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  onProgressChange: function(/*in nsIWebProgress*/ aWebProgress,</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+                        /*in nsIRequest*/ aRequest,</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+                        /*in long*/ aCurSelfProgress,</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+                        /*in long */aMaxSelfProgress,</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+                        /*in long */aCurTotalProgress,</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+                        /*in long */aMaxTotalProgress) {</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+  },</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+  onLocationChange: function(/*in nsIWebProgress*/ aWebProgress,</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+                        /*in nsIRequest*/ aRequest,</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+                        /*in nsIURI*/ aLocation) {</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+    document.getElementById(&quot;headerMessage&quot;).textContent = aLocation.spec;</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+  },</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+  onStatusChange: function(/*in nsIWebProgress*/ aWebProgress,</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+                      /*in nsIRequest*/ aRequest,</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+                      /*in nsresult*/ aStatus,</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+                      /*in wstring*/ aMessage) {</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+  },</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+  onSecurityChange: function(/*in nsIWebProgress*/ aWebProgress,</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+                        /*in nsIRequest*/ aRequest,</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+                        /*in unsigned long*/ aState) {</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+    const wpl_security_bits = wpl.STATE_IS_SECURE |</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+                              wpl.STATE_IS_BROKEN |</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+                              wpl.STATE_IS_INSECURE |</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+                              wpl.STATE_SECURE_HIGH |</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+                              wpl.STATE_SECURE_MED |</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+                              wpl.STATE_SECURE_LOW;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+    var browser = document.getElementById(&quot;requestFrame&quot;);</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+    var level;</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+    switch (aState &amp; wpl_security_bits) {</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+      case wpl.STATE_IS_SECURE | wpl.STATE_SECURE_HIGH:</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+        level = &quot;high&quot;;</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+        break;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+      case wpl.STATE_IS_SECURE | wpl.STATE_SECURE_MED:</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+      case wpl.STATE_IS_SECURE | wpl.STATE_SECURE_LOW:</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+        level = &quot;low&quot;;</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+        break;</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+      case wpl.STATE_IS_BROKEN:</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+        level = &quot;broken&quot;;</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+        break;</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+    }</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+    if (level) {</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+      this.securityButton.setAttribute(&quot;level&quot;, level);</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+      this.securityButton.hidden = false;</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+    } else {</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+      this.securityButton.hidden = true;</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+      this.securityButton.removeAttribute(&quot;level&quot;);</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+    }</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+    this.securityButton.setAttribute(&quot;tooltiptext&quot;,</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+                                     browser.securityUI.tooltipText);</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+  }</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+}</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+function cancelRequest()</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+{</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+  reportUserClosed();</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+  window.close();</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+}</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+function reportUserClosed()</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+{</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+  let request = window.arguments[0].wrappedJSObject;</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+  request.cancelled();</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+}</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+function loadRequestedUrl()</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+{</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+  let request = window.arguments[0].wrappedJSObject;</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+  document.getElementById(&quot;headerMessage&quot;).textContent = request.promptText;</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineplus">+  let account = request.account;</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineplus">+  if (request.iconURI != &quot;&quot;)</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineplus">+    document.getElementById(&quot;headerImage&quot;).src = request.iconURI;</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineplus">+</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+  var browser = document.getElementById(&quot;requestFrame&quot;);</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineplus">+  browser.addProgressListener(reporterListener,</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineplus">+                              Components.interfaces.nsIWebProgress.NOTIFY_ALL);</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineplus">+  var url = request.url;</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineplus">+  if (url != &quot;&quot;) {</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineplus">+    browser.setAttribute(&quot;src&quot;, url);</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineplus">+    document.getElementById(&quot;headerMessage&quot;).textContent = url;</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+  }</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+  request.loaded(window, browser.webProgress);</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/mail/base/content/browserRequest.xul</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,33 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+# You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/browserRequest.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+&lt;!DOCTYPE window&gt;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+&lt;window id=&quot;browserRequest&quot;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+        buttons=&quot;,&quot;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+        onload=&quot;loadRequestedUrl()&quot;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+        onclose=&quot;reportUserClosed()&quot;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+        title=&quot;&quot;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+        width=&quot;800&quot;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+        height=&quot;500&quot;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+        orient=&quot;vertical&quot;&gt;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/browserRequest.js&quot;/&gt;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+  &lt;keyset id=&quot;mainKeyset&quot;&gt;</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+    &lt;key id=&quot;key_close&quot; key=&quot;w&quot; modifiers=&quot;accel&quot; oncommand=&quot;cancelRequest()&quot;/&gt;</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+    &lt;key id=&quot;key_close2&quot;  keycode=&quot;VK_ESCAPE&quot; oncommand=&quot;cancelRequest()&quot;/&gt;</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+  &lt;/keyset&gt;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+  &lt;hbox id=&quot;header&quot;&gt;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+  &lt;hbox id=&quot;addressbox&quot; flex=&quot;1&quot; disabled=&quot;true&quot;&gt;</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+    &lt;image id=&quot;security-button&quot; src=&quot;chrome://messenger/skin/icons/mailicon32.png&quot;/&gt;</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+    &lt;description id=&quot;headerMessage&quot;/&gt;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+  &lt;/hbox&gt;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+  &lt;/hbox&gt;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+  &lt;browser type=&quot;content&quot; disablehistory=&quot;true&quot; src=&quot;about:blank&quot; id=&quot;requestFrame&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+&lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/mailCore.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/mailCore.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -623,17 +623,20 @@ function SanitizeAttachmentDisplayName(a</span>
<a href="#l4.4"></a><span id="l4.4">  * Create a TransferData object for a message attachment, either from the</span>
<a href="#l4.5"></a><span id="l4.5">  * message reader or the composer.</span>
<a href="#l4.6"></a><span id="l4.6">  *</span>
<a href="#l4.7"></a><span id="l4.7">  * @param aAttachment the attachment object</span>
<a href="#l4.8"></a><span id="l4.8">  * @return the TransferData</span>
<a href="#l4.9"></a><span id="l4.9">  */</span>
<a href="#l4.10"></a><span id="l4.10"> function CreateAttachmentTransferData(aAttachment)</span>
<a href="#l4.11"></a><span id="l4.11"> {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  if (aAttachment.contentType == &quot;text/x-moz-deleted&quot;)</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  // For now, disallow drag-and-drop on cloud attachments. In the future, we</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+  // should allow this.</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+  if (aAttachment.contentType == &quot;text/x-moz-deleted&quot; ||</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+      aAttachment.sendViaCloud)</span>
<a href="#l4.17"></a><span id="l4.17">     return;</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">   var name = aAttachment.name || aAttachment.displayName;</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21">   var data = new TransferData();</span>
<a href="#l4.22"></a><span id="l4.22">   if (aAttachment.url &amp;&amp; name)</span>
<a href="#l4.23"></a><span id="l4.23">   {</span>
<a href="#l4.24"></a><span id="l4.24">     // Only add type/filename info for non-file URLs that don't already</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/mailWidgets.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -221,16 +221,29 @@</span>
<a href="#l5.4"></a><span id="l5.4">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.5"></a><span id="l5.5">       &lt;/method&gt;</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7">       &lt;!-- Get the preferred height (the height that would allow us to fit</span>
<a href="#l5.8"></a><span id="l5.8">            everything without scrollbars) of the attachmentlist's boxObject. --&gt;</span>
<a href="#l5.9"></a><span id="l5.9">       &lt;property name=&quot;preferredHeight&quot; readonly=&quot;true&quot;</span>
<a href="#l5.10"></a><span id="l5.10">                 onget=&quot;return this.scrollbox.scrollHeight - this.scrollbox.clientHeight + this.boxObject.height;&quot;/&gt;</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+      &lt;!-- Find the attachmentitem node for the specified nsIMsgAttachment. --&gt;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+      &lt;method name=&quot;findItemForAttachment&quot;&gt;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+        &lt;parameter name=&quot;aAttachment&quot;/&gt;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+          for (let i = 0; i &lt; this.itemCount; i++) {</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+            let item = this.getItemAtIndex(i);</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+            if (item.attachment == aAttachment)</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+              return item;</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+          }</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+          return null;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+</span>
<a href="#l5.25"></a><span id="l5.25">       &lt;!-- ///////////////// private members ///////////////// --&gt;</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27">       &lt;property name=&quot;children&quot; readonly=&quot;true&quot;</span>
<a href="#l5.28"></a><span id="l5.28">                 onget=&quot;return Array.slice(this.getElementsByTagName('attachmentitem'));&quot;/&gt;</span>
<a href="#l5.29"></a><span id="l5.29">       &lt;property name=&quot;scrollbox&quot; readonly=&quot;true&quot;</span>
<a href="#l5.30"></a><span id="l5.30">                 onget=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'scrollbox');&quot;/&gt;</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32">       &lt;method name=&quot;_fireOnSelect&quot;&gt;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineat">@@ -360,16 +373,30 @@</span>
<a href="#l5.34"></a><span id="l5.34">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.35"></a><span id="l5.35">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l5.36"></a><span id="l5.36">           this.setAttribute(&quot;imagesize&quot;, val);</span>
<a href="#l5.37"></a><span id="l5.37">           this._updateImage();</span>
<a href="#l5.38"></a><span id="l5.38">           return val;</span>
<a href="#l5.39"></a><span id="l5.39">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l5.40"></a><span id="l5.40">       &lt;/property&gt;</span>
<a href="#l5.41"></a><span id="l5.41"> </span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+      &lt;property name=&quot;image&quot;&gt;</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+          return this.getAttribute(&quot;image&quot;);</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+          if (val)</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+            this.setAttribute(&quot;image&quot;, val);</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+          else</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+            this.removeAttribute(&quot;image&quot;);</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+          this._updateImage();</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+          return val;</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+</span>
<a href="#l5.56"></a><span id="l5.56">       &lt;method name=&quot;_updateImage&quot;&gt;</span>
<a href="#l5.57"></a><span id="l5.57">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.58"></a><span id="l5.58">           if (!this.hasAttribute(&quot;image&quot;)) {</span>
<a href="#l5.59"></a><span id="l5.59">             let icon = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;,</span>
<a href="#l5.60"></a><span id="l5.60">                                                                &quot;icon&quot;);</span>
<a href="#l5.61"></a><span id="l5.61">             let attr = &quot;image&quot;+this.imageSize;</span>
<a href="#l5.62"></a><span id="l5.62">             if (this.hasAttribute(attr))</span>
<a href="#l5.63"></a><span id="l5.63">               icon.setAttribute(&quot;src&quot;, this.getAttribute(attr));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/jar.mn</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/jar.mn</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -112,16 +112,18 @@ messenger.jar:</span>
<a href="#l6.4"></a><span id="l6.4">     content/messenger/glodaFacetView.css            (content/glodaFacetView.css)</span>
<a href="#l6.5"></a><span id="l6.5">     content/messenger/glodaFacetBindings.css        (content/glodaFacetBindings.css)</span>
<a href="#l6.6"></a><span id="l6.6">     content/messenger/glodaFacetBindings.xml        (content/glodaFacetBindings.xml)</span>
<a href="#l6.7"></a><span id="l6.7">     content/messenger/glodaFacetVis.js              (content/glodaFacetVis.js)</span>
<a href="#l6.8"></a><span id="l6.8">     content/messenger/quickFilterBar.xul            (content/quickFilterBar.xul)</span>
<a href="#l6.9"></a><span id="l6.9">     content/messenger/quickFilterBar.js             (content/quickFilterBar.js)</span>
<a href="#l6.10"></a><span id="l6.10">     content/messenger/quickFilterBar.css            (content/quickFilterBar.css)</span>
<a href="#l6.11"></a><span id="l6.11">     content/messenger/downloadsOverlay.xul          (content/downloadsOverlay.xul)</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+    content/messenger/browserRequest.js             (content/browserRequest.js)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    content/messenger/browserRequest.xul            (content/browserRequest.xul)</span>
<a href="#l6.14"></a><span id="l6.14"> *   content/messenger/safeMode.xul                  (content/safeMode.xul)</span>
<a href="#l6.15"></a><span id="l6.15">     content/messenger/safeMode.js                   (content/safeMode.js)</span>
<a href="#l6.16"></a><span id="l6.16"> # the following files are mail-specific overrides</span>
<a href="#l6.17"></a><span id="l6.17"> *+  content/messenger/license.html                  (/mozilla/toolkit/content/license.html)</span>
<a href="#l6.18"></a><span id="l6.18"> % override chrome://global/content/license.html chrome://messenger/content/license.html</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20"> comm.jar:</span>
<a href="#l6.21"></a><span id="l6.21"> % content communicator %content/communicator/</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/modules/Makefile.in</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/modules/Makefile.in</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -52,12 +52,14 @@ EXTRA_JS_MODULES = \</span>
<a href="#l7.4"></a><span id="l7.4">   quickFilterManager.js \</span>
<a href="#l7.5"></a><span id="l7.5">   searchSpec.js \</span>
<a href="#l7.6"></a><span id="l7.6">   MsgHdrSyntheticView.js \</span>
<a href="#l7.7"></a><span id="l7.7">   sessionStoreManager.js \</span>
<a href="#l7.8"></a><span id="l7.8">   summaryFrameManager.js \</span>
<a href="#l7.9"></a><span id="l7.9">   mailMigrator.js \</span>
<a href="#l7.10"></a><span id="l7.10">   mailInstrumentation.js \</span>
<a href="#l7.11"></a><span id="l7.11">   glodaWebSearch.js \</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+  oauth.jsm \</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  http.jsm \</span>
<a href="#l7.14"></a><span id="l7.14">   distribution.js \</span>
<a href="#l7.15"></a><span id="l7.15">   $(NULL)</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17"> include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- /dev/null</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ b/mail/base/modules/http.jsm</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -0,0 +1,61 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineplus">+</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineplus">+var EXPORTED_SYMBOLS = [&quot;doXHRequest&quot;];</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+const {classes: Cc, interfaces: Ci, utils: Cu} = Components;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+function doXHRequest(aUrl, aHeaders, aMethod, aPOSTData, aOnLoad, aOnError, aThis) {</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+  var xhr = Cc[&quot;@mozilla.org/xmlextras/xmlhttprequest;1&quot;]</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+              .createInstance(Ci.nsIXMLHttpRequest);</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+  xhr.mozBackgroundRequest = true; // no error dialogs</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+  xhr.open(aMethod, aUrl);</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+  xhr.channel.loadFlags = Ci.nsIChannel.LOAD_ANONYMOUS | // don't send cookies</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+                          Ci.nsIChannel.LOAD_BYPASS_CACHE |</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+                          Ci.nsIChannel.INHIBIT_CACHING;</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+  xhr.onerror = function(aProgressEvent) {</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+    if (aOnError) {</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+      // adapted from toolkit/mozapps/extensions/nsBlocklistService.js</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+      let request = aProgressEvent.target;</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+      let status;</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+      try {</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+        // may throw (local file or timeout)</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+        status = request.status;</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+      }</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+      catch (e) {</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+        request = request.channel.QueryInterface(Ci.nsIRequest);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+        status = request.status;</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+      }</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+      // When status is 0 we don't have a valid channel.</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+      let statusText = status ? request.statusText : &quot;offline&quot;;</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+      aOnError.call(aThis, statusText, null, this);</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+    }</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+  };</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+  xhr.onload = function (aRequest) {</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+    try {</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+      let target = aRequest.target;</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+      if (target.status != 200) {</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+        let errorText = target.responseText;</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+        if (!errorText || /&lt;(ht|\?x)ml\b/i.test(errorText))</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+          errorText = target.statusText;</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+        throw target.status + &quot; - &quot; + errorText;</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+      }</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+      if (aOnLoad)</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+        aOnLoad.call(aThis, target.responseText, this);</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+    } catch (e) {</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+      Cu.reportError(e);</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+      if (aOnError)</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+        aOnError.call(aThis, e, aRequest.target.responseText, this);</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+    }</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+  };</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+  if (aHeaders) {</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+    aHeaders.forEach(function(header) {</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+      xhr.setRequestHeader(header[0], header[1]);</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+    });</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+  }</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+  xhr.send(aPOSTData);</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+  return xhr;</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mail/base/modules/oauth.jsm</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,291 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+/**</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+ * This js module does OAuth 1.0 authentication. It was originally intended to</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+ * be shareable by various components that need Oauth, but some changes will</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+ * need to be made to support differences in OAuth usage.</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+ */</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+const {classes: Cc, interfaces: Ci, results: Cr, utils: Cu} = Components;</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+var EXPORTED_SYMBOLS = [&quot;OAuth&quot;];</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+Cu.import(&quot;resource:///modules/http.jsm&quot;);</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+Cu.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+Cu.import(&quot;resource:///modules/gloda/log4moz.js&quot;);</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+function OAuth(aDisplayName, aBaseUri, aAuthUri, aAuthToken, aAuthTokenSecret, aAppKey, aAppSecret)</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+{</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  this._userInfo = {};</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+  this.displayName = aDisplayName;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+  this.baseURI = aBaseUri;</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+  this.authURI = aAuthUri;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+  this.token = aAuthToken;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+  this.tokenSecret = aAuthTokenSecret;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+  this.consumerKey = aAppKey;</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+  this.consumerSecret = aAppSecret;</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+  this.log = Log4Moz.getConfiguredLogger(&quot;TBOAuth&quot;);</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+}</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+OAuth.prototype = {</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+  consumerKey: &quot;&quot;,</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+  consumerSecret: &quot;&quot;,</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+  completionURI: &quot;http://oauthcallback.local/&quot;,</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+  baseURI: &quot;&quot;,</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+  token : &quot;&quot;,</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+  tokenSecret : &quot;&quot;,</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+  connectSuccessCallback : null,</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+  connectFailureCallback : null,</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+  /**</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+   * Start the OAuth connection process, if not connected.</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+   *</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+   * @param aSuccess success callback, called synchronously if we are already</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+                     connected, or the connection succeeds.</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+   * @param aFailure failure callback.</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+   */</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+  connect: function(aSuccess, aFailure, aWithUI) {</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+    if (this.connected || this.connecting)</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+      return;</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+    this._enabled = true;</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+    // Get a new token if needed...</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+    if (!this.token || !this.tokenSecret) {</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+      if (!aWithUI) {</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+        aFailure();</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+        return;</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+      }</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+      this.connectSuccessCallback = aSuccess;</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+      this.connectFailureCallback = aFailure;</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+      this.log.info(&quot;don't think we have a token or token secret&quot;);</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+      this.requestToken();</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+      return;</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+    }</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+    this.log.info(&quot;Connecting using existing token&quot;);</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+    aSuccess();</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+  },</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+  /**</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+   * Sign a request and send it, using the oauth connection.</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+   * </span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+   * @param aUrl Url to open</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+   * @param aHeaders Additional headers to send</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+   * @param aMethod &quot;Get&quot;/&quot;Post&quot;/&quot;Put&quot;</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+   * @param aPOSTData Data to post</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+   * @param aOnLoad Success callback</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+   * @param aOnError Error callback</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+   * @param aThis passed as first param to success and error callbacks</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+   * @param aOAuthParams additional params to pass to request</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+   */</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+  signAndSend: function(aUrl, aHeaders, aMethod, aPOSTData, aOnLoad, aOnError, aThis,</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+                        aOAuthParams) {</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+    this.log.info(&quot;sign and send aUrl = &quot; + aUrl);</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+    const kChars =</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineplus">+      &quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz&quot;;</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineplus">+    const kNonceLength = 6;</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineplus">+    let nonce = &quot;&quot;;</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineplus">+    for (let i = 0; i &lt; kNonceLength; ++i)</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineplus">+      nonce += kChars[Math.floor(Math.random() * kChars.length)];</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+    let params = (aOAuthParams || []).concat([</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineplus">+      [&quot;oauth_consumer_key&quot;, this.consumerKey],</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineplus">+      [&quot;oauth_nonce&quot;, nonce],</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineplus">+      [&quot;oauth_signature_method&quot;, &quot;HMAC-SHA1&quot;],</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineplus">+      [&quot;oauth_token&quot;, this.token],</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineplus">+      [&quot;oauth_timestamp&quot;, Math.floor(((new Date()).getTime()) / 1000)],</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineplus">+      [&quot;oauth_version&quot;, &quot;1.0&quot;]</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineplus">+    ]);</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineplus">+</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineplus">+    // encodeURI *AND* % escape characters that encodeURIComponent doesn't.</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+    function percentEncode(aString)</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+      encodeURIComponent(aString).replace(/\!|\*|\'|\(|\)/g, function(m)</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineplus">+        ({&quot;!&quot;: &quot;%21&quot;, &quot;*&quot;: &quot;%2A&quot;, &quot;'&quot;: &quot;%27&quot;, &quot;(&quot;: &quot;%28&quot;, &quot;)&quot;: &quot;%29&quot;}[m]))</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineplus">+</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineplus">+    let dataParams = [];</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineplus">+    let url = /^https?:/.test(aUrl) ? aUrl : this.baseURI + aUrl;</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineplus">+    let urlSpec = url;</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineplus">+    let queryIndex = url.indexOf(&quot;?&quot;);</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineplus">+    if (queryIndex != -1) {</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineplus">+      urlSpec = url.slice(0, queryIndex);</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineplus">+      dataParams = url.slice(queryIndex + 1).split(&quot;&amp;&quot;)</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineplus">+                      .map(function(p) p.split(&quot;=&quot;).map(percentEncode));</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineplus">+    }</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineplus">+    this.log.info(&quot;in sign and send url = &quot; + url + &quot;\nurlSpec = &quot; + urlSpec);</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineplus">+    this.log.info(&quot;dataParams = &quot; + dataParams);</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineplus">+    let signatureKey = this.consumerSecret + &quot;&amp;&quot; + this.tokenSecret;</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineplus">+    let signatureBase =</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineplus">+      aMethod + &quot;&amp;&quot; + encodeURIComponent(urlSpec) + &quot;&amp;&quot; +</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineplus">+      params.concat(dataParams)</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineplus">+            .sort(function(a,b) (a[0] &lt; b[0]) ? -1 : (a[0] &gt; b[0]) ? 1 : 0)</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineplus">+            .map(function(p) p.map(percentEncode).join(&quot;%3D&quot;))</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+            .join(&quot;%26&quot;);</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineplus">+</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineplus">+    this.log.info(&quot;sig base = &quot; + signatureBase);</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineplus">+    let keyFactory = Cc[&quot;@mozilla.org/security/keyobjectfactory;1&quot;]</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineplus">+                     .getService(Ci.nsIKeyObjectFactory);</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineplus">+    let hmac =</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineplus">+      Cc[&quot;@mozilla.org/security/hmac;1&quot;].createInstance(Ci.nsICryptoHMAC);</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineplus">+    hmac.init(hmac.SHA1,</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineplus">+              keyFactory.keyFromString(Ci.nsIKeyObject.HMAC, signatureKey));</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineplus">+    // No UTF-8 encoding, special chars are already escaped.</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineplus">+    let bytes = [b.charCodeAt() for each (b in signatureBase)];</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineplus">+    hmac.update(bytes, bytes.length);</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineplus">+    let signature = hmac.finish(true);</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineplus">+</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineplus">+    params.push([&quot;oauth_signature&quot;, encodeURIComponent(signature)]);</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineplus">+</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineplus">+    let authorization =</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineplus">+      &quot;OAuth &quot; + params.map(function (p) p[0] + &quot;=\&quot;&quot; + p[1] + &quot;\&quot;&quot;).join(&quot;, &quot;);</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineplus">+    let headers = (aHeaders || []).concat([[&quot;Authorization&quot;, authorization]]);</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineplus">+    return doXHRequest(url, headers, aMethod, aPOSTData, aOnLoad, aOnError, aThis);</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineplus">+  },</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineplus">+  _parseURLData: function(aData) {</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineplus">+    let result = {};</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineplus">+    aData.split(&quot;&amp;&quot;).forEach(function (aParam) {</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineplus">+      let [key, value] = aParam.split(&quot;=&quot;);</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineplus">+      result[key] = value;</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineplus">+    });</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineplus">+    return result;</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineplus">+  },</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineplus">+</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineplus">+  _streamingRequest: null,</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineplus">+  _pendingData: &quot;&quot;,</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineplus">+  _receivedLength: 0,</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineplus">+  onDataAvailable: function(aRequest) {</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineplus">+    let text = aRequest.target.responseText;</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineplus">+    let newText = this._pendingData + text.slice(this._receivedLength);</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineplus">+    this.log.info(&quot;Received data: &quot; + newText);</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineplus">+    let messages = newText.split(/\r\n?/);</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineplus">+  },</span>
<a href="#l9.166"></a><span id="l9.166" class="difflineplus">+</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineplus">+  requestToken: function() {</span>
<a href="#l9.168"></a><span id="l9.168" class="difflineplus">+    let oauthParams =</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineplus">+      [[&quot;oauth_callback&quot;, encodeURIComponent(this.completionURI)]];</span>
<a href="#l9.170"></a><span id="l9.170" class="difflineplus">+    this.signAndSend(&quot;oauth/request_token&quot;,</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineplus">+                     null, &quot;POST&quot;, null,</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineplus">+                     this.onRequestTokenReceived,</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+                     this.connectFailureCallback, this,</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineplus">+                     oauthParams);</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineplus">+  },</span>
<a href="#l9.176"></a><span id="l9.176" class="difflineplus">+  onRequestTokenReceived: function(aData) {</span>
<a href="#l9.177"></a><span id="l9.177" class="difflineplus">+    this.log.info(&quot;Received request token.&quot;);</span>
<a href="#l9.178"></a><span id="l9.178" class="difflineplus">+    let data = this._parseURLData(aData);</span>
<a href="#l9.179"></a><span id="l9.179" class="difflineplus">+    if (!data.oauth_token || !data.oauth_token_secret) {</span>
<a href="#l9.180"></a><span id="l9.180" class="difflineplus">+      this.log.info(&quot;didn't get request token&quot;);</span>
<a href="#l9.181"></a><span id="l9.181" class="difflineplus">+      this.connectFailureCallback();</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineplus">+      return;</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineplus">+    }</span>
<a href="#l9.184"></a><span id="l9.184" class="difflineplus">+    this.token = data.oauth_token;</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineplus">+    this.tokenSecret = data.oauth_token_secret;</span>
<a href="#l9.186"></a><span id="l9.186" class="difflineplus">+</span>
<a href="#l9.187"></a><span id="l9.187" class="difflineplus">+    this.requestAuthorization();</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineplus">+  },</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineplus">+  requestAuthorization: function() {</span>
<a href="#l9.190"></a><span id="l9.190" class="difflineplus">+    this.log.info(&quot;requesting oauth&quot;);</span>
<a href="#l9.191"></a><span id="l9.191" class="difflineplus">+    const url = this.authURI + &quot;oauth/authorize?oauth_token=&quot;;</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineplus">+    this._browserRequest =</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineplus">+      { promptText : &quot;auth prompt&quot;,</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineplus">+        account: this,</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineplus">+        url: url + this.token + &quot;&amp;oauth_callback=&quot; + this.completionURI,</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineplus">+        _active: true,</span>
<a href="#l9.197"></a><span id="l9.197" class="difflineplus">+        iconURI : &quot;&quot;,  // would be nice to set this from the oauth user...</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineplus">+        cancelled: function() {</span>
<a href="#l9.199"></a><span id="l9.199" class="difflineplus">+          if (!this._active)</span>
<a href="#l9.200"></a><span id="l9.200" class="difflineplus">+            return;</span>
<a href="#l9.201"></a><span id="l9.201" class="difflineplus">+          this.account.log.info(&quot;auth cancelled&quot;);</span>
<a href="#l9.202"></a><span id="l9.202" class="difflineplus">+          this.account.finishAuthorizationRequest();</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineplus">+          this.account.onAuthorizationReceived(null);</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineplus">+          this.connectFailureCallback();</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineplus">+        // ### auth cancelled.</span>
<a href="#l9.206"></a><span id="l9.206" class="difflineplus">+        },</span>
<a href="#l9.207"></a><span id="l9.207" class="difflineplus">+        loaded: function(aWindow, aWebProgress) {</span>
<a href="#l9.208"></a><span id="l9.208" class="difflineplus">+          if (!this._active)</span>
<a href="#l9.209"></a><span id="l9.209" class="difflineplus">+            return;</span>
<a href="#l9.210"></a><span id="l9.210" class="difflineplus">+</span>
<a href="#l9.211"></a><span id="l9.211" class="difflineplus">+          this._listener = {</span>
<a href="#l9.212"></a><span id="l9.212" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Ci.nsIWebProgressListener,</span>
<a href="#l9.213"></a><span id="l9.213" class="difflineplus">+                                                   Ci.nsISupportsWeakReference]),</span>
<a href="#l9.214"></a><span id="l9.214" class="difflineplus">+            _cleanUp: function() {</span>
<a href="#l9.215"></a><span id="l9.215" class="difflineplus">+              this.webProgress.removeProgressListener(this);</span>
<a href="#l9.216"></a><span id="l9.216" class="difflineplus">+              this.window.close();</span>
<a href="#l9.217"></a><span id="l9.217" class="difflineplus">+              delete this.window;</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineplus">+            },</span>
<a href="#l9.219"></a><span id="l9.219" class="difflineplus">+            _checkForRedirect: function(aURL) {</span>
<a href="#l9.220"></a><span id="l9.220" class="difflineplus">+              if (aURL.indexOf(this._parent.completionURI) != 0)</span>
<a href="#l9.221"></a><span id="l9.221" class="difflineplus">+                return;</span>
<a href="#l9.222"></a><span id="l9.222" class="difflineplus">+</span>
<a href="#l9.223"></a><span id="l9.223" class="difflineplus">+              this._parent.finishAuthorizationRequest();</span>
<a href="#l9.224"></a><span id="l9.224" class="difflineplus">+              this._parent.onAuthorizationReceived(aURL);</span>
<a href="#l9.225"></a><span id="l9.225" class="difflineplus">+            },</span>
<a href="#l9.226"></a><span id="l9.226" class="difflineplus">+            onStateChange: function(aWebProgress, aRequest, aStateFlags, aStatus) {</span>
<a href="#l9.227"></a><span id="l9.227" class="difflineplus">+              const wpl = Ci.nsIWebProgressListener;</span>
<a href="#l9.228"></a><span id="l9.228" class="difflineplus">+              if (aStateFlags &amp; (wpl.STATE_START | wpl.STATE_IS_NETWORK))</span>
<a href="#l9.229"></a><span id="l9.229" class="difflineplus">+                this._checkForRedirect(aRequest.name);</span>
<a href="#l9.230"></a><span id="l9.230" class="difflineplus">+            },</span>
<a href="#l9.231"></a><span id="l9.231" class="difflineplus">+            onLocationChange: function(aWebProgress, aRequest, aLocation) {</span>
<a href="#l9.232"></a><span id="l9.232" class="difflineplus">+              this._checkForRedirect(aLocation.spec);</span>
<a href="#l9.233"></a><span id="l9.233" class="difflineplus">+            },</span>
<a href="#l9.234"></a><span id="l9.234" class="difflineplus">+            onProgressChange: function() {},</span>
<a href="#l9.235"></a><span id="l9.235" class="difflineplus">+            onStatusChange: function() {},</span>
<a href="#l9.236"></a><span id="l9.236" class="difflineplus">+            onSecurityChange: function() {},</span>
<a href="#l9.237"></a><span id="l9.237" class="difflineplus">+</span>
<a href="#l9.238"></a><span id="l9.238" class="difflineplus">+            window: aWindow,</span>
<a href="#l9.239"></a><span id="l9.239" class="difflineplus">+            webProgress: aWebProgress,</span>
<a href="#l9.240"></a><span id="l9.240" class="difflineplus">+            _parent: this.account</span>
<a href="#l9.241"></a><span id="l9.241" class="difflineplus">+          };</span>
<a href="#l9.242"></a><span id="l9.242" class="difflineplus">+        aWebProgress.addProgressListener(this._listener,</span>
<a href="#l9.243"></a><span id="l9.243" class="difflineplus">+                                         Ci.nsIWebProgress.NOTIFY_ALL);</span>
<a href="#l9.244"></a><span id="l9.244" class="difflineplus">+      },</span>
<a href="#l9.245"></a><span id="l9.245" class="difflineplus">+    };</span>
<a href="#l9.246"></a><span id="l9.246" class="difflineplus">+     this.wrappedJSObject = this._browserRequest;</span>
<a href="#l9.247"></a><span id="l9.247" class="difflineplus">+     Services.ww.openWindow(null,</span>
<a href="#l9.248"></a><span id="l9.248" class="difflineplus">+                            &quot;chrome://messenger/content/browserRequest.xul&quot;,</span>
<a href="#l9.249"></a><span id="l9.249" class="difflineplus">+                             null, &quot;chrome,centerscreen,width=980px,height=600px&quot;, this);</span>
<a href="#l9.250"></a><span id="l9.250" class="difflineplus">+  },</span>
<a href="#l9.251"></a><span id="l9.251" class="difflineplus">+  finishAuthorizationRequest: function() {</span>
<a href="#l9.252"></a><span id="l9.252" class="difflineplus">+    if (!(&quot;_browserRequest&quot; in this))</span>
<a href="#l9.253"></a><span id="l9.253" class="difflineplus">+      return;</span>
<a href="#l9.254"></a><span id="l9.254" class="difflineplus">+</span>
<a href="#l9.255"></a><span id="l9.255" class="difflineplus">+    this._browserRequest._active = false;</span>
<a href="#l9.256"></a><span id="l9.256" class="difflineplus">+    if (&quot;_listener&quot; in this._browserRequest)</span>
<a href="#l9.257"></a><span id="l9.257" class="difflineplus">+      this._browserRequest._listener._cleanUp();</span>
<a href="#l9.258"></a><span id="l9.258" class="difflineplus">+    delete this._browserRequest;</span>
<a href="#l9.259"></a><span id="l9.259" class="difflineplus">+  },</span>
<a href="#l9.260"></a><span id="l9.260" class="difflineplus">+  onAuthorizationReceived: function(aData) {</span>
<a href="#l9.261"></a><span id="l9.261" class="difflineplus">+    this.log.info(&quot;authorization received&quot;);</span>
<a href="#l9.262"></a><span id="l9.262" class="difflineplus">+    this.requestAccessToken();</span>
<a href="#l9.263"></a><span id="l9.263" class="difflineplus">+  },</span>
<a href="#l9.264"></a><span id="l9.264" class="difflineplus">+  requestAccessToken: function() {</span>
<a href="#l9.265"></a><span id="l9.265" class="difflineplus">+    this.signAndSend(&quot;oauth/access_token&quot;, null, &quot;POST&quot;, null,</span>
<a href="#l9.266"></a><span id="l9.266" class="difflineplus">+                     this.onAccessTokenReceived, this.connectFailureCallback, this,</span>
<a href="#l9.267"></a><span id="l9.267" class="difflineplus">+                     null);</span>
<a href="#l9.268"></a><span id="l9.268" class="difflineplus">+  },</span>
<a href="#l9.269"></a><span id="l9.269" class="difflineplus">+  onAccessTokenReceived: function(aData) {</span>
<a href="#l9.270"></a><span id="l9.270" class="difflineplus">+    this.log.info(&quot;Received access token. urlData = &quot; + aData);</span>
<a href="#l9.271"></a><span id="l9.271" class="difflineplus">+    let result = this._parseURLData(aData);</span>
<a href="#l9.272"></a><span id="l9.272" class="difflineplus">+</span>
<a href="#l9.273"></a><span id="l9.273" class="difflineplus">+    this.token = result.oauth_token;</span>
<a href="#l9.274"></a><span id="l9.274" class="difflineplus">+    this.tokenSecret = result.oauth_token_secret;</span>
<a href="#l9.275"></a><span id="l9.275" class="difflineplus">+    this.connectSuccessCallback();</span>
<a href="#l9.276"></a><span id="l9.276" class="difflineplus">+  },</span>
<a href="#l9.277"></a><span id="l9.277" class="difflineplus">+</span>
<a href="#l9.278"></a><span id="l9.278" class="difflineplus">+</span>
<a href="#l9.279"></a><span id="l9.279" class="difflineplus">+  cleanUp: function() {</span>
<a href="#l9.280"></a><span id="l9.280" class="difflineplus">+    this.finishAuthorizationRequest();</span>
<a href="#l9.281"></a><span id="l9.281" class="difflineplus">+    if (this._pendingRequests.length != 0) {</span>
<a href="#l9.282"></a><span id="l9.282" class="difflineplus">+      for each (let request in this._pendingRequests)</span>
<a href="#l9.283"></a><span id="l9.283" class="difflineplus">+        request.abort();</span>
<a href="#l9.284"></a><span id="l9.284" class="difflineplus">+      delete this._pendingRequests;</span>
<a href="#l9.285"></a><span id="l9.285" class="difflineplus">+    }</span>
<a href="#l9.286"></a><span id="l9.286" class="difflineplus">+    if (this._streamingRequest) {</span>
<a href="#l9.287"></a><span id="l9.287" class="difflineplus">+      this._streamingRequest.abort();</span>
<a href="#l9.288"></a><span id="l9.288" class="difflineplus">+      delete this._streamingRequest;</span>
<a href="#l9.289"></a><span id="l9.289" class="difflineplus">+    }</span>
<a href="#l9.290"></a><span id="l9.290" class="difflineplus">+  },</span>
<a href="#l9.291"></a><span id="l9.291" class="difflineplus">+  unInit: function() {</span>
<a href="#l9.292"></a><span id="l9.292" class="difflineplus">+    this.cleanUp();</span>
<a href="#l9.293"></a><span id="l9.293" class="difflineplus">+  },</span>
<a href="#l9.294"></a><span id="l9.294" class="difflineplus">+};</span>
<a href="#l9.295"></a><span id="l9.295" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/Makefile.in</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/Makefile.in</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -39,17 +39,17 @@ DEPTH   = ../..</span>
<a href="#l10.4"></a><span id="l10.4"> topsrcdir = @top_srcdir@</span>
<a href="#l10.5"></a><span id="l10.5"> srcdir    = @srcdir@</span>
<a href="#l10.6"></a><span id="l10.6"> VPATH   = @srcdir@</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10"> # Only Mac and Windows have search integration components, but we include at</span>
<a href="#l10.11"></a><span id="l10.11"> # least one module from search/ on all platforms</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-DIRS    = compose preferences addrbook migration activity search about-support wintaskbar newmailaccount</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+DIRS    = compose cloudfile preferences addrbook migration activity search about-support wintaskbar newmailaccount</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15"> ifneq (,$(filter windows gtk2 cocoa, $(MOZ_WIDGET_TOOLKIT)))</span>
<a href="#l10.16"></a><span id="l10.16"> DIRS += shell</span>
<a href="#l10.17"></a><span id="l10.17"> endif</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19"> ifdef MOZ_SAFE_BROWSING</span>
<a href="#l10.20"></a><span id="l10.20"> DIRS += phishing </span>
<a href="#l10.21"></a><span id="l10.21"> endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -43,16 +43,18 @@ Components.utils.import(&quot;resource:///mod</span>
<a href="#l11.4"></a><span id="l11.4"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l11.5"></a><span id="l11.5"> Components.utils.import(&quot;resource:///modules/attachmentChecker.js&quot;);</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7"> Components.utils.import(&quot;resource:///modules/MailUtils.js&quot;);</span>
<a href="#l11.8"></a><span id="l11.8"> Components.utils.import(&quot;resource:///modules/errUtils.js&quot;);</span>
<a href="#l11.9"></a><span id="l11.9"> Components.utils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l11.10"></a><span id="l11.10"> Components.utils.import(&quot;resource://gre/modules/InlineSpellChecker.jsm&quot;);</span>
<a href="#l11.11"></a><span id="l11.11"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;)</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+Components.utils.import(&quot;resource:///modules/cloudFileAccounts.js&quot;);</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15"> /**</span>
<a href="#l11.16"></a><span id="l11.16">  * interfaces</span>
<a href="#l11.17"></a><span id="l11.17">  */</span>
<a href="#l11.18"></a><span id="l11.18"> const nsIMsgCompDeliverMode = Components.interfaces.nsIMsgCompDeliverMode;</span>
<a href="#l11.19"></a><span id="l11.19"> const nsIMsgCompSendFormat = Components.interfaces.nsIMsgCompSendFormat;</span>
<a href="#l11.20"></a><span id="l11.20"> const nsIMsgCompConvertible = Components.interfaces.nsIMsgCompConvertible;</span>
<a href="#l11.21"></a><span id="l11.21"> const nsIMsgCompType = Components.interfaces.nsIMsgCompType;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -100,16 +102,17 @@ var gSavedSendNowKey;</span>
<a href="#l11.23"></a><span id="l11.23"> var gSendFormat;</span>
<a href="#l11.24"></a><span id="l11.24"> </span>
<a href="#l11.25"></a><span id="l11.25"> var gMsgIdentityElement;</span>
<a href="#l11.26"></a><span id="l11.26"> var gMsgAddressingWidgetTreeElement;</span>
<a href="#l11.27"></a><span id="l11.27"> var gMsgSubjectElement;</span>
<a href="#l11.28"></a><span id="l11.28"> var gMsgAttachmentElement;</span>
<a href="#l11.29"></a><span id="l11.29"> var gMsgHeadersToolbarElement;</span>
<a href="#l11.30"></a><span id="l11.30"> var gRemindLater;</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+var gComposeType;</span>
<a href="#l11.32"></a><span id="l11.32"> </span>
<a href="#l11.33"></a><span id="l11.33"> // i18n globals</span>
<a href="#l11.34"></a><span id="l11.34"> var gSendDefaultCharset;</span>
<a href="#l11.35"></a><span id="l11.35"> var gCharsetTitle;</span>
<a href="#l11.36"></a><span id="l11.36"> var gCharsetConvertManager;</span>
<a href="#l11.37"></a><span id="l11.37"> var _gComposeBundle;</span>
<a href="#l11.38"></a><span id="l11.38"> function getComposeBundle() {</span>
<a href="#l11.39"></a><span id="l11.39">   // That one has to be lazy. Getting a reference to an element with a XBL</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineat">@@ -130,16 +133,17 @@ var gDSNOptionChanged;</span>
<a href="#l11.41"></a><span id="l11.41"> var gAttachVCardOptionChanged;</span>
<a href="#l11.42"></a><span id="l11.42"> </span>
<a href="#l11.43"></a><span id="l11.43"> var gMailSession;</span>
<a href="#l11.44"></a><span id="l11.44"> var gAutoSaveInterval;</span>
<a href="#l11.45"></a><span id="l11.45"> var gAutoSaveTimeout;</span>
<a href="#l11.46"></a><span id="l11.46"> var gAutoSaveKickedIn;</span>
<a href="#l11.47"></a><span id="l11.47"> var gEditingDraft;</span>
<a href="#l11.48"></a><span id="l11.48"> var gAttachmentsSize;</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+var gNumUploadingAttachments;</span>
<a href="#l11.50"></a><span id="l11.50"> </span>
<a href="#l11.51"></a><span id="l11.51"> const kComposeAttachDirPrefName = &quot;mail.compose.attach.dir&quot;;</span>
<a href="#l11.52"></a><span id="l11.52"> </span>
<a href="#l11.53"></a><span id="l11.53"> function InitializeGlobalVariables()</span>
<a href="#l11.54"></a><span id="l11.54"> {</span>
<a href="#l11.55"></a><span id="l11.55">   gAccountManager = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;].getService(Components.interfaces.nsIMsgAccountManager);</span>
<a href="#l11.56"></a><span id="l11.56">   gIOService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;].getService(Components.interfaces.nsIIOService);</span>
<a href="#l11.57"></a><span id="l11.57">   gPromptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;].getService(Components.interfaces.nsIPromptService);</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineat">@@ -166,16 +170,17 @@ function InitializeGlobalVariables()</span>
<a href="#l11.59"></a><span id="l11.59">   gHideMenus = false;</span>
<a href="#l11.60"></a><span id="l11.60">   gRemindLater = false;</span>
<a href="#l11.61"></a><span id="l11.61"> </span>
<a href="#l11.62"></a><span id="l11.62">   gLastWindowToHaveFocus = null;</span>
<a href="#l11.63"></a><span id="l11.63">   gReceiptOptionChanged = false;</span>
<a href="#l11.64"></a><span id="l11.64">   gDSNOptionChanged = false;</span>
<a href="#l11.65"></a><span id="l11.65">   gAttachVCardOptionChanged = false;</span>
<a href="#l11.66"></a><span id="l11.66">   gAttachmentsSize = 0;</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineplus">+  gNumUploadingAttachments = 0;</span>
<a href="#l11.68"></a><span id="l11.68"> }</span>
<a href="#l11.69"></a><span id="l11.69"> InitializeGlobalVariables();</span>
<a href="#l11.70"></a><span id="l11.70"> </span>
<a href="#l11.71"></a><span id="l11.71"> function ReleaseGlobalVariables()</span>
<a href="#l11.72"></a><span id="l11.72"> {</span>
<a href="#l11.73"></a><span id="l11.73">   gAccountManager = null;</span>
<a href="#l11.74"></a><span id="l11.74">   gIOService = null;</span>
<a href="#l11.75"></a><span id="l11.75">   gPromptService = null;</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineat">@@ -427,16 +432,31 @@ var defaultController = {</span>
<a href="#l11.77"></a><span id="l11.77">       isEnabled: function() {</span>
<a href="#l11.78"></a><span id="l11.78">         return !gWindowLocked;</span>
<a href="#l11.79"></a><span id="l11.79">       },</span>
<a href="#l11.80"></a><span id="l11.80">       doCommand: function() {</span>
<a href="#l11.81"></a><span id="l11.81">         AttachFile();</span>
<a href="#l11.82"></a><span id="l11.82">       }</span>
<a href="#l11.83"></a><span id="l11.83">     },</span>
<a href="#l11.84"></a><span id="l11.84"> </span>
<a href="#l11.85"></a><span id="l11.85" class="difflineplus">+    cmd_attachCloud: {</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineplus">+        // Hide the command entirely if there are no cloud accounts or</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+        // the feature is disbled.</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+        let cmd = document.getElementById(&quot;cmd_attachCloud&quot;);</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineplus">+        cmd.hidden = !Services.prefs.getBoolPref(&quot;mail.cloud_files.enabled&quot;)</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+                     || (cloudFileAccounts.accounts.length == 0);</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineplus">+        return !cmd.hidden;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+      },</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+      doCommand: function() {</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+        // We should never actually call this, since the &lt;command&gt; node calls</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineplus">+        // a different function.</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineplus">+      }</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineplus">+    },</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineplus">+</span>
<a href="#l11.100"></a><span id="l11.100">     cmd_attachPage: {</span>
<a href="#l11.101"></a><span id="l11.101">       isEnabled: function() {</span>
<a href="#l11.102"></a><span id="l11.102">         return !gWindowLocked;</span>
<a href="#l11.103"></a><span id="l11.103">       },</span>
<a href="#l11.104"></a><span id="l11.104">       doCommand: function() {</span>
<a href="#l11.105"></a><span id="l11.105">         AttachPage();</span>
<a href="#l11.106"></a><span id="l11.106">       }</span>
<a href="#l11.107"></a><span id="l11.107">     },</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineat">@@ -483,47 +503,47 @@ var defaultController = {</span>
<a href="#l11.109"></a><span id="l11.109">       },</span>
<a href="#l11.110"></a><span id="l11.110">       doCommand: function() {</span>
<a href="#l11.111"></a><span id="l11.111">         SaveAsTemplate();</span>
<a href="#l11.112"></a><span id="l11.112">       }</span>
<a href="#l11.113"></a><span id="l11.113">     },</span>
<a href="#l11.114"></a><span id="l11.114"> </span>
<a href="#l11.115"></a><span id="l11.115">     cmd_sendButton: {</span>
<a href="#l11.116"></a><span id="l11.116">       isEnabled: function() {</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineminus">-        return !gWindowLocked;</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineplus">+        return !gWindowLocked &amp;&amp; !gNumUploadingAttachments;</span>
<a href="#l11.119"></a><span id="l11.119">       },</span>
<a href="#l11.120"></a><span id="l11.120">       doCommand: function() {</span>
<a href="#l11.121"></a><span id="l11.121">         if (gIOService &amp;&amp; gIOService.offline)</span>
<a href="#l11.122"></a><span id="l11.122">           SendMessageLater();</span>
<a href="#l11.123"></a><span id="l11.123">         else</span>
<a href="#l11.124"></a><span id="l11.124">           SendMessage();</span>
<a href="#l11.125"></a><span id="l11.125">       }</span>
<a href="#l11.126"></a><span id="l11.126">     },</span>
<a href="#l11.127"></a><span id="l11.127"> </span>
<a href="#l11.128"></a><span id="l11.128">     cmd_sendNow: {</span>
<a href="#l11.129"></a><span id="l11.129">       isEnabled: function() {</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineminus">-        return !gWindowLocked &amp;&amp; !gIsOffline;</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineplus">+        return !gWindowLocked &amp;&amp; !gIsOffline &amp;&amp; !gNumUploadingAttachments;</span>
<a href="#l11.132"></a><span id="l11.132">       },</span>
<a href="#l11.133"></a><span id="l11.133">       doCommand: function() {</span>
<a href="#l11.134"></a><span id="l11.134">         SendMessage();</span>
<a href="#l11.135"></a><span id="l11.135">       }</span>
<a href="#l11.136"></a><span id="l11.136">     },</span>
<a href="#l11.137"></a><span id="l11.137"> </span>
<a href="#l11.138"></a><span id="l11.138">     cmd_sendLater: {</span>
<a href="#l11.139"></a><span id="l11.139">       isEnabled: function() {</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineminus">-        return !gWindowLocked;</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineplus">+        return !gWindowLocked &amp;&amp; !gNumUploadingAttachments;</span>
<a href="#l11.142"></a><span id="l11.142">       },</span>
<a href="#l11.143"></a><span id="l11.143">       doCommand: function() {</span>
<a href="#l11.144"></a><span id="l11.144">         SendMessageLater();</span>
<a href="#l11.145"></a><span id="l11.145">       }</span>
<a href="#l11.146"></a><span id="l11.146">     },</span>
<a href="#l11.147"></a><span id="l11.147"> </span>
<a href="#l11.148"></a><span id="l11.148">     cmd_sendWithCheck: {</span>
<a href="#l11.149"></a><span id="l11.149">       isEnabled: function() {</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineminus">-        return !gWindowLocked;</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineplus">+        return !gWindowLocked &amp;&amp; !gNumUploadingAttachments;</span>
<a href="#l11.152"></a><span id="l11.152">       },</span>
<a href="#l11.153"></a><span id="l11.153">       doCommand: function() {</span>
<a href="#l11.154"></a><span id="l11.154">         SendMessageWithCheck();</span>
<a href="#l11.155"></a><span id="l11.155">       }</span>
<a href="#l11.156"></a><span id="l11.156">     },</span>
<a href="#l11.157"></a><span id="l11.157"> </span>
<a href="#l11.158"></a><span id="l11.158">     cmd_printSetup: {</span>
<a href="#l11.159"></a><span id="l11.159">       isEnabled: function() {</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineat">@@ -649,16 +669,81 @@ var attachmentBucketController = {</span>
<a href="#l11.161"></a><span id="l11.161">     cmd_renameAttachment: {</span>
<a href="#l11.162"></a><span id="l11.162">       isEnabled: function() {</span>
<a href="#l11.163"></a><span id="l11.163">         return MessageGetNumSelectedAttachments() == 1;</span>
<a href="#l11.164"></a><span id="l11.164">       },</span>
<a href="#l11.165"></a><span id="l11.165">       doCommand: function() {</span>
<a href="#l11.166"></a><span id="l11.166">         RenameSelectedAttachment();</span>
<a href="#l11.167"></a><span id="l11.167">       }</span>
<a href="#l11.168"></a><span id="l11.168">     },</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineplus">+</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineplus">+    cmd_convertCloud: {</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineplus">+        // Hide the command entirely if there are no cloud accounts.</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineplus">+        let cmd = document.getElementById(&quot;cmd_convertCloud&quot;);</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineplus">+        cmd.hidden = (cloudFileAccounts.accounts.length == 0);</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineplus">+        if (cmd.hidden)</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineplus">+          return false;</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineplus">+</span>
<a href="#l11.178"></a><span id="l11.178" class="difflineplus">+        let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineplus">+        for (let [,item] in Iterator(bucket.selectedItems)) {</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineplus">+          if (item.uploading)</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineplus">+            return false;</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineplus">+        }</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineplus">+        return true;</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineplus">+      },</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineplus">+      doCommand: function() {</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineplus">+        // We should never actually call this, since the &lt;command&gt; node calls</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineplus">+        // a different function.</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineplus">+      }</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineplus">+    },</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineplus">+</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineplus">+    cmd_convertAttachment: {</span>
<a href="#l11.192"></a><span id="l11.192" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineplus">+        let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineplus">+        for (let [,item] in Iterator(bucket.selectedItems)) {</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineplus">+          if (item.uploading)</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineplus">+            return false;</span>
<a href="#l11.197"></a><span id="l11.197" class="difflineplus">+        }</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineplus">+        return true;</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineplus">+      },</span>
<a href="#l11.200"></a><span id="l11.200" class="difflineplus">+      doCommand: function() {</span>
<a href="#l11.201"></a><span id="l11.201" class="difflineplus">+        convertSelectedToRegularAttachment();</span>
<a href="#l11.202"></a><span id="l11.202" class="difflineplus">+      }</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineplus">+    },</span>
<a href="#l11.204"></a><span id="l11.204" class="difflineplus">+</span>
<a href="#l11.205"></a><span id="l11.205" class="difflineplus">+    cmd_cancelUpload: {</span>
<a href="#l11.206"></a><span id="l11.206" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l11.207"></a><span id="l11.207" class="difflineplus">+        let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.208"></a><span id="l11.208" class="difflineplus">+        for (let [,item] in Iterator(bucket.selectedItems)) {</span>
<a href="#l11.209"></a><span id="l11.209" class="difflineplus">+          if (item.uploading)</span>
<a href="#l11.210"></a><span id="l11.210" class="difflineplus">+            return true;</span>
<a href="#l11.211"></a><span id="l11.211" class="difflineplus">+        }</span>
<a href="#l11.212"></a><span id="l11.212" class="difflineplus">+</span>
<a href="#l11.213"></a><span id="l11.213" class="difflineplus">+        // Hide the command entirely if the selected attachments aren't cloud</span>
<a href="#l11.214"></a><span id="l11.214" class="difflineplus">+        // files.</span>
<a href="#l11.215"></a><span id="l11.215" class="difflineplus">+        // FOr some reason, the hidden property isn't propagating from the cmd</span>
<a href="#l11.216"></a><span id="l11.216" class="difflineplus">+        // to the menuitem.</span>
<a href="#l11.217"></a><span id="l11.217" class="difflineplus">+        let menuitem = document.getElementById(&quot;context_cancelUpload&quot;);</span>
<a href="#l11.218"></a><span id="l11.218" class="difflineplus">+        menuitem.hidden = true;</span>
<a href="#l11.219"></a><span id="l11.219" class="difflineplus">+        return false;</span>
<a href="#l11.220"></a><span id="l11.220" class="difflineplus">+      },</span>
<a href="#l11.221"></a><span id="l11.221" class="difflineplus">+      doCommand: function() {</span>
<a href="#l11.222"></a><span id="l11.222" class="difflineplus">+        let fileHandler = Services.io.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l11.223"></a><span id="l11.223" class="difflineplus">+                                  .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l11.224"></a><span id="l11.224" class="difflineplus">+</span>
<a href="#l11.225"></a><span id="l11.225" class="difflineplus">+        let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.226"></a><span id="l11.226" class="difflineplus">+        for (let [,item] in Iterator(bucket.selectedItems)) {</span>
<a href="#l11.227"></a><span id="l11.227" class="difflineplus">+          if (item.uploading) {</span>
<a href="#l11.228"></a><span id="l11.228" class="difflineplus">+            let file = fileHandler.getFileFromURLSpec(item.attachment.url);</span>
<a href="#l11.229"></a><span id="l11.229" class="difflineplus">+            item.cloudProvider.cancelFileUpload(file);</span>
<a href="#l11.230"></a><span id="l11.230" class="difflineplus">+          }</span>
<a href="#l11.231"></a><span id="l11.231" class="difflineplus">+        }</span>
<a href="#l11.232"></a><span id="l11.232" class="difflineplus">+      },</span>
<a href="#l11.233"></a><span id="l11.233" class="difflineplus">+    },</span>
<a href="#l11.234"></a><span id="l11.234">   },</span>
<a href="#l11.235"></a><span id="l11.235"> </span>
<a href="#l11.236"></a><span id="l11.236">   supportsCommand: function(aCommand) {</span>
<a href="#l11.237"></a><span id="l11.237">     return (aCommand in this.commands);</span>
<a href="#l11.238"></a><span id="l11.238">   },</span>
<a href="#l11.239"></a><span id="l11.239"> </span>
<a href="#l11.240"></a><span id="l11.240">   isCommandEnabled: function(aCommand) {</span>
<a href="#l11.241"></a><span id="l11.241">     if (!this.supportsCommand(aCommand))</span>
<a href="#l11.242"></a><span id="l11.242" class="difflineat">@@ -822,16 +907,442 @@ function updateEditItems()</span>
<a href="#l11.243"></a><span id="l11.243">   goUpdateCommand(&quot;cmd_renameAttachment&quot;);</span>
<a href="#l11.244"></a><span id="l11.244">   goUpdateCommand(&quot;cmd_selectAll&quot;);</span>
<a href="#l11.245"></a><span id="l11.245">   goUpdateCommand(&quot;cmd_openAttachment&quot;);</span>
<a href="#l11.246"></a><span id="l11.246">   goUpdateCommand(&quot;cmd_find&quot;);</span>
<a href="#l11.247"></a><span id="l11.247">   goUpdateCommand(&quot;cmd_findNext&quot;);</span>
<a href="#l11.248"></a><span id="l11.248">   goUpdateCommand(&quot;cmd_findPrev&quot;);</span>
<a href="#l11.249"></a><span id="l11.249"> }</span>
<a href="#l11.250"></a><span id="l11.250"> </span>
<a href="#l11.251"></a><span id="l11.251" class="difflineplus">+function updateAttachmentItems()</span>
<a href="#l11.252"></a><span id="l11.252" class="difflineplus">+{</span>
<a href="#l11.253"></a><span id="l11.253" class="difflineplus">+  goUpdateCommand(&quot;cmd_attachCloud&quot;);</span>
<a href="#l11.254"></a><span id="l11.254" class="difflineplus">+  goUpdateCommand(&quot;cmd_convertCloud&quot;);</span>
<a href="#l11.255"></a><span id="l11.255" class="difflineplus">+  goUpdateCommand(&quot;cmd_convertAttachment&quot;);</span>
<a href="#l11.256"></a><span id="l11.256" class="difflineplus">+  goUpdateCommand(&quot;cmd_cancelUpload&quot;);</span>
<a href="#l11.257"></a><span id="l11.257" class="difflineplus">+  goUpdateCommand(&quot;cmd_delete&quot;);</span>
<a href="#l11.258"></a><span id="l11.258" class="difflineplus">+  goUpdateCommand(&quot;cmd_renameAttachment&quot;);</span>
<a href="#l11.259"></a><span id="l11.259" class="difflineplus">+  goUpdateCommand(&quot;cmd_selectAll&quot;);</span>
<a href="#l11.260"></a><span id="l11.260" class="difflineplus">+  goUpdateCommand(&quot;cmd_openAttachment&quot;);</span>
<a href="#l11.261"></a><span id="l11.261" class="difflineplus">+}</span>
<a href="#l11.262"></a><span id="l11.262" class="difflineplus">+</span>
<a href="#l11.263"></a><span id="l11.263" class="difflineplus">+/**</span>
<a href="#l11.264"></a><span id="l11.264" class="difflineplus">+ * Update all the commands for sending a message to reflect their current state.</span>
<a href="#l11.265"></a><span id="l11.265" class="difflineplus">+ */</span>
<a href="#l11.266"></a><span id="l11.266" class="difflineplus">+function updateSendCommands()</span>
<a href="#l11.267"></a><span id="l11.267" class="difflineplus">+{</span>
<a href="#l11.268"></a><span id="l11.268" class="difflineplus">+  goUpdateCommand(&quot;cmd_sendButton&quot;);</span>
<a href="#l11.269"></a><span id="l11.269" class="difflineplus">+  goUpdateCommand(&quot;cmd_sendNow&quot;);</span>
<a href="#l11.270"></a><span id="l11.270" class="difflineplus">+  goUpdateCommand(&quot;cmd_sendLater&quot;);</span>
<a href="#l11.271"></a><span id="l11.271" class="difflineplus">+  goUpdateCommand(&quot;cmd_sendWithCheck&quot;);</span>
<a href="#l11.272"></a><span id="l11.272" class="difflineplus">+}</span>
<a href="#l11.273"></a><span id="l11.273" class="difflineplus">+</span>
<a href="#l11.274"></a><span id="l11.274" class="difflineplus">+function addAttachCloudMenuItems(aParentMenu)</span>
<a href="#l11.275"></a><span id="l11.275" class="difflineplus">+{</span>
<a href="#l11.276"></a><span id="l11.276" class="difflineplus">+  while (aParentMenu.hasChildNodes())</span>
<a href="#l11.277"></a><span id="l11.277" class="difflineplus">+    aParentMenu.removeChild(aParentMenu.lastChild);</span>
<a href="#l11.278"></a><span id="l11.278" class="difflineplus">+</span>
<a href="#l11.279"></a><span id="l11.279" class="difflineplus">+  for (let [,cloudProvider] in Iterator(cloudFileAccounts.accounts)) {</span>
<a href="#l11.280"></a><span id="l11.280" class="difflineplus">+    let item = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l11.281"></a><span id="l11.281" class="difflineplus">+    let iconClass = cloudProvider.iconClass;</span>
<a href="#l11.282"></a><span id="l11.282" class="difflineplus">+    item.cloudProvider = cloudProvider;</span>
<a href="#l11.283"></a><span id="l11.283" class="difflineplus">+    item.setAttribute(&quot;label&quot;, cloudFileAccounts.getDisplayName(cloudProvider));</span>
<a href="#l11.284"></a><span id="l11.284" class="difflineplus">+</span>
<a href="#l11.285"></a><span id="l11.285" class="difflineplus">+    if (iconClass) {</span>
<a href="#l11.286"></a><span id="l11.286" class="difflineplus">+      item.setAttribute(&quot;class&quot;, &quot;menu-iconic&quot;);</span>
<a href="#l11.287"></a><span id="l11.287" class="difflineplus">+      item.setAttribute(&quot;image&quot;, iconClass);</span>
<a href="#l11.288"></a><span id="l11.288" class="difflineplus">+    }</span>
<a href="#l11.289"></a><span id="l11.289" class="difflineplus">+    aParentMenu.appendChild(item);</span>
<a href="#l11.290"></a><span id="l11.290" class="difflineplus">+  }</span>
<a href="#l11.291"></a><span id="l11.291" class="difflineplus">+}</span>
<a href="#l11.292"></a><span id="l11.292" class="difflineplus">+</span>
<a href="#l11.293"></a><span id="l11.293" class="difflineplus">+function addConvertCloudMenuItems(aParentMenu, aAfterNodeId, aRadioGroup)</span>
<a href="#l11.294"></a><span id="l11.294" class="difflineplus">+{</span>
<a href="#l11.295"></a><span id="l11.295" class="difflineplus">+  let attachment = document.getElementById(&quot;attachmentBucket&quot;).selectedItem;</span>
<a href="#l11.296"></a><span id="l11.296" class="difflineplus">+  let afterNode = document.getElementById(aAfterNodeId);</span>
<a href="#l11.297"></a><span id="l11.297" class="difflineplus">+  while (afterNode.nextSibling)</span>
<a href="#l11.298"></a><span id="l11.298" class="difflineplus">+    aParentMenu.removeChild(afterNode.nextSibling);</span>
<a href="#l11.299"></a><span id="l11.299" class="difflineplus">+</span>
<a href="#l11.300"></a><span id="l11.300" class="difflineplus">+  if (!attachment.sendViaCloud) {</span>
<a href="#l11.301"></a><span id="l11.301" class="difflineplus">+    let item = document.getElementById(&quot;context_convertAttachment&quot;);</span>
<a href="#l11.302"></a><span id="l11.302" class="difflineplus">+    item.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l11.303"></a><span id="l11.303" class="difflineplus">+  }</span>
<a href="#l11.304"></a><span id="l11.304" class="difflineplus">+</span>
<a href="#l11.305"></a><span id="l11.305" class="difflineplus">+  for (let [,cloudProvider] in Iterator(cloudFileAccounts.accounts)) {</span>
<a href="#l11.306"></a><span id="l11.306" class="difflineplus">+    let item = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l11.307"></a><span id="l11.307" class="difflineplus">+    let iconClass = cloudProvider.iconClass;</span>
<a href="#l11.308"></a><span id="l11.308" class="difflineplus">+    item.cloudProvider = cloudProvider;</span>
<a href="#l11.309"></a><span id="l11.309" class="difflineplus">+    item.setAttribute(&quot;label&quot;, cloudFileAccounts.getDisplayName(cloudProvider));</span>
<a href="#l11.310"></a><span id="l11.310" class="difflineplus">+    item.setAttribute(&quot;type&quot;, &quot;radio&quot;);</span>
<a href="#l11.311"></a><span id="l11.311" class="difflineplus">+    item.setAttribute(&quot;name&quot;, aRadioGroup);</span>
<a href="#l11.312"></a><span id="l11.312" class="difflineplus">+</span>
<a href="#l11.313"></a><span id="l11.313" class="difflineplus">+    if (attachment.cloudProvider &amp;&amp;</span>
<a href="#l11.314"></a><span id="l11.314" class="difflineplus">+        attachment.cloudProvider.accountKey == cloudProvider.accountKey) {</span>
<a href="#l11.315"></a><span id="l11.315" class="difflineplus">+      item.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l11.316"></a><span id="l11.316" class="difflineplus">+    }</span>
<a href="#l11.317"></a><span id="l11.317" class="difflineplus">+    else if (iconClass) {</span>
<a href="#l11.318"></a><span id="l11.318" class="difflineplus">+      item.setAttribute(&quot;class&quot;, &quot;menu-iconic&quot;);</span>
<a href="#l11.319"></a><span id="l11.319" class="difflineplus">+      item.setAttribute(&quot;image&quot;, iconClass);</span>
<a href="#l11.320"></a><span id="l11.320" class="difflineplus">+    }</span>
<a href="#l11.321"></a><span id="l11.321" class="difflineplus">+</span>
<a href="#l11.322"></a><span id="l11.322" class="difflineplus">+    aParentMenu.appendChild(item);</span>
<a href="#l11.323"></a><span id="l11.323" class="difflineplus">+  }</span>
<a href="#l11.324"></a><span id="l11.324" class="difflineplus">+}</span>
<a href="#l11.325"></a><span id="l11.325" class="difflineplus">+</span>
<a href="#l11.326"></a><span id="l11.326" class="difflineplus">+function uploadListener(aAttachment, aFile, aCloudProvider)</span>
<a href="#l11.327"></a><span id="l11.327" class="difflineplus">+{</span>
<a href="#l11.328"></a><span id="l11.328" class="difflineplus">+  this.attachment = aAttachment;</span>
<a href="#l11.329"></a><span id="l11.329" class="difflineplus">+  this.file = aFile;</span>
<a href="#l11.330"></a><span id="l11.330" class="difflineplus">+  this.cloudProvider = aCloudProvider;</span>
<a href="#l11.331"></a><span id="l11.331" class="difflineplus">+</span>
<a href="#l11.332"></a><span id="l11.332" class="difflineplus">+  // Notify the UI that we're starting the upload process: disable send commands</span>
<a href="#l11.333"></a><span id="l11.333" class="difflineplus">+  // and show a &quot;connecting&quot; icon for the attachment.</span>
<a href="#l11.334"></a><span id="l11.334" class="difflineplus">+  this.attachment.sendViaCloud = true;</span>
<a href="#l11.335"></a><span id="l11.335" class="difflineplus">+  gNumUploadingAttachments++;</span>
<a href="#l11.336"></a><span id="l11.336" class="difflineplus">+  updateSendCommands();</span>
<a href="#l11.337"></a><span id="l11.337" class="difflineplus">+</span>
<a href="#l11.338"></a><span id="l11.338" class="difflineplus">+  let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.339"></a><span id="l11.339" class="difflineplus">+  let item = bucket.findItemForAttachment(this.attachment);</span>
<a href="#l11.340"></a><span id="l11.340" class="difflineplus">+  if (item) {</span>
<a href="#l11.341"></a><span id="l11.341" class="difflineplus">+    item.image = &quot;chrome://messenger/skin/icons/connecting.png&quot;;</span>
<a href="#l11.342"></a><span id="l11.342" class="difflineplus">+    item.setAttribute(&quot;tooltiptext&quot;,</span>
<a href="#l11.343"></a><span id="l11.343" class="difflineplus">+      getComposeBundle().getFormattedString(&quot;cloudFileUploadingTooltip&quot;, [</span>
<a href="#l11.344"></a><span id="l11.344" class="difflineplus">+        cloudFileAccounts.getDisplayName(this.cloudProvider)</span>
<a href="#l11.345"></a><span id="l11.345" class="difflineplus">+      ]));</span>
<a href="#l11.346"></a><span id="l11.346" class="difflineplus">+    item.uploading = true;</span>
<a href="#l11.347"></a><span id="l11.347" class="difflineplus">+    item.cloudProvider = this.cloudProvider;</span>
<a href="#l11.348"></a><span id="l11.348" class="difflineplus">+  }</span>
<a href="#l11.349"></a><span id="l11.349" class="difflineplus">+}</span>
<a href="#l11.350"></a><span id="l11.350" class="difflineplus">+</span>
<a href="#l11.351"></a><span id="l11.351" class="difflineplus">+uploadListener.prototype = {</span>
<a href="#l11.352"></a><span id="l11.352" class="difflineplus">+  onStartRequest: function uploadListener_onStartRequest(aRequest, aContext) {</span>
<a href="#l11.353"></a><span id="l11.353" class="difflineplus">+    let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.354"></a><span id="l11.354" class="difflineplus">+    let item = bucket.findItemForAttachment(this.attachment);</span>
<a href="#l11.355"></a><span id="l11.355" class="difflineplus">+    if (item)</span>
<a href="#l11.356"></a><span id="l11.356" class="difflineplus">+      item.image = &quot;chrome://messenger/skin/icons/loading.png&quot;;</span>
<a href="#l11.357"></a><span id="l11.357" class="difflineplus">+  },</span>
<a href="#l11.358"></a><span id="l11.358" class="difflineplus">+</span>
<a href="#l11.359"></a><span id="l11.359" class="difflineplus">+  onStopRequest: function uploadListener_onStopRequest(aRequest, aContext,</span>
<a href="#l11.360"></a><span id="l11.360" class="difflineplus">+                                                       aStatusCode) {</span>
<a href="#l11.361"></a><span id="l11.361" class="difflineplus">+    let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.362"></a><span id="l11.362" class="difflineplus">+    let attachmentItem = bucket.findItemForAttachment(this.attachment);</span>
<a href="#l11.363"></a><span id="l11.363" class="difflineplus">+</span>
<a href="#l11.364"></a><span id="l11.364" class="difflineplus">+    if (Components.isSuccessCode(aStatusCode)) {</span>
<a href="#l11.365"></a><span id="l11.365" class="difflineplus">+      let originalUrl = this.attachment.url;</span>
<a href="#l11.366"></a><span id="l11.366" class="difflineplus">+      this.attachment.contentLocation = this.cloudProvider.urlForFile(this.file);</span>
<a href="#l11.367"></a><span id="l11.367" class="difflineplus">+      this.attachment.cloudProviderKey = this.cloudProvider.accountKey;</span>
<a href="#l11.368"></a><span id="l11.368" class="difflineplus">+      if (attachmentItem) {</span>
<a href="#l11.369"></a><span id="l11.369" class="difflineplus">+        // Update relevant bits on the attachment list item.</span>
<a href="#l11.370"></a><span id="l11.370" class="difflineplus">+        if (!attachmentItem.originalUrl)</span>
<a href="#l11.371"></a><span id="l11.371" class="difflineplus">+          attachmentItem.originalUrl = originalUrl;</span>
<a href="#l11.372"></a><span id="l11.372" class="difflineplus">+        attachmentItem.setAttribute(&quot;tooltiptext&quot;,</span>
<a href="#l11.373"></a><span id="l11.373" class="difflineplus">+          getComposeBundle().getFormattedString(&quot;cloudFileUploadedTooltip&quot;, [</span>
<a href="#l11.374"></a><span id="l11.374" class="difflineplus">+            cloudFileAccounts.getDisplayName(this.cloudProvider)</span>
<a href="#l11.375"></a><span id="l11.375" class="difflineplus">+          ]));</span>
<a href="#l11.376"></a><span id="l11.376" class="difflineplus">+        attachmentItem.uploading = false;</span>
<a href="#l11.377"></a><span id="l11.377" class="difflineplus">+</span>
<a href="#l11.378"></a><span id="l11.378" class="difflineplus">+        // Set the icon for the attachment.</span>
<a href="#l11.379"></a><span id="l11.379" class="difflineplus">+        let iconClass = this.cloudProvider.iconClass;</span>
<a href="#l11.380"></a><span id="l11.380" class="difflineplus">+        if (iconClass)</span>
<a href="#l11.381"></a><span id="l11.381" class="difflineplus">+          attachmentItem.image = iconClass;</span>
<a href="#l11.382"></a><span id="l11.382" class="difflineplus">+        else {</span>
<a href="#l11.383"></a><span id="l11.383" class="difflineplus">+          // Should we use a generic &quot;cloud&quot; icon here? Or an overlay icon?</span>
<a href="#l11.384"></a><span id="l11.384" class="difflineplus">+          // I think the provider should provide an icon, end of story.</span>
<a href="#l11.385"></a><span id="l11.385" class="difflineplus">+          attachmentItem.image = null;</span>
<a href="#l11.386"></a><span id="l11.386" class="difflineplus">+        }</span>
<a href="#l11.387"></a><span id="l11.387" class="difflineplus">+      }</span>
<a href="#l11.388"></a><span id="l11.388" class="difflineplus">+</span>
<a href="#l11.389"></a><span id="l11.389" class="difflineplus">+      let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l11.390"></a><span id="l11.390" class="difflineplus">+      event.initEvent(&quot;attachment-uploaded&quot;, true, true);</span>
<a href="#l11.391"></a><span id="l11.391" class="difflineplus">+      attachmentItem.dispatchEvent(event);</span>
<a href="#l11.392"></a><span id="l11.392" class="difflineplus">+    }</span>
<a href="#l11.393"></a><span id="l11.393" class="difflineplus">+    else if (aStatusCode == this.cloudProvider.uploadCanceled) {</span>
<a href="#l11.394"></a><span id="l11.394" class="difflineplus">+      attachmentItem.setAttribute(&quot;tooltiptext&quot;, attachmentItem.attachment.url);</span>
<a href="#l11.395"></a><span id="l11.395" class="difflineplus">+      attachmentItem.image = null;</span>
<a href="#l11.396"></a><span id="l11.396" class="difflineplus">+    }</span>
<a href="#l11.397"></a><span id="l11.397" class="difflineplus">+    else {</span>
<a href="#l11.398"></a><span id="l11.398" class="difflineplus">+      let title;</span>
<a href="#l11.399"></a><span id="l11.399" class="difflineplus">+      let msg;</span>
<a href="#l11.400"></a><span id="l11.400" class="difflineplus">+      let displayName = cloudFileAccounts.getDisplayName(this.cloudProvider);</span>
<a href="#l11.401"></a><span id="l11.401" class="difflineplus">+      let bundle = getComposeBundle();</span>
<a href="#l11.402"></a><span id="l11.402" class="difflineplus">+</span>
<a href="#l11.403"></a><span id="l11.403" class="difflineplus">+      switch (aStatusCode) {</span>
<a href="#l11.404"></a><span id="l11.404" class="difflineplus">+      case this.cloudProvider.authErr:</span>
<a href="#l11.405"></a><span id="l11.405" class="difflineplus">+        title = bundle.getString(&quot;errorCloudFileAuth.title&quot;);</span>
<a href="#l11.406"></a><span id="l11.406" class="difflineplus">+        msg = bundle.getFormattedString(&quot;errorCloudFileAuth.message&quot;,</span>
<a href="#l11.407"></a><span id="l11.407" class="difflineplus">+                                        [displayName]);</span>
<a href="#l11.408"></a><span id="l11.408" class="difflineplus">+        break;</span>
<a href="#l11.409"></a><span id="l11.409" class="difflineplus">+      case this.cloudProvider.uploadErr:</span>
<a href="#l11.410"></a><span id="l11.410" class="difflineplus">+        title = bundle.getString(&quot;errorCloudFileUpload.title&quot;);</span>
<a href="#l11.411"></a><span id="l11.411" class="difflineplus">+        msg = bundle.getFormattedString(&quot;errorCloudFileUpload.message&quot;,</span>
<a href="#l11.412"></a><span id="l11.412" class="difflineplus">+                                        [displayName,</span>
<a href="#l11.413"></a><span id="l11.413" class="difflineplus">+                                         this.attachment.name]);</span>
<a href="#l11.414"></a><span id="l11.414" class="difflineplus">+        break;</span>
<a href="#l11.415"></a><span id="l11.415" class="difflineplus">+      case this.cloudProvider.uploadWouldExceedQuota:</span>
<a href="#l11.416"></a><span id="l11.416" class="difflineplus">+        title = bundle.getString(&quot;errorCloudFileQuota.title&quot;);</span>
<a href="#l11.417"></a><span id="l11.417" class="difflineplus">+        msg = bundle.getFormattedString(&quot;errorCloudFileQuota.message&quot;,</span>
<a href="#l11.418"></a><span id="l11.418" class="difflineplus">+                                        [displayName,</span>
<a href="#l11.419"></a><span id="l11.419" class="difflineplus">+                                         this.attachment.name]);</span>
<a href="#l11.420"></a><span id="l11.420" class="difflineplus">+        break;</span>
<a href="#l11.421"></a><span id="l11.421" class="difflineplus">+      case this.cloudProvider.uploadExceedsFileLimit:</span>
<a href="#l11.422"></a><span id="l11.422" class="difflineplus">+        title = bundle.getString(&quot;errorCloudFileLimit.title&quot;);</span>
<a href="#l11.423"></a><span id="l11.423" class="difflineplus">+        msg = bundle.getFormattedString(&quot;errorCloudFileLimit.message&quot;,</span>
<a href="#l11.424"></a><span id="l11.424" class="difflineplus">+                                        [displayName,</span>
<a href="#l11.425"></a><span id="l11.425" class="difflineplus">+                                         this.attachment.name]);</span>
<a href="#l11.426"></a><span id="l11.426" class="difflineplus">+        break;</span>
<a href="#l11.427"></a><span id="l11.427" class="difflineplus">+      default:</span>
<a href="#l11.428"></a><span id="l11.428" class="difflineplus">+        title = bundle.getString(&quot;errorCloudFileOther.title&quot;);</span>
<a href="#l11.429"></a><span id="l11.429" class="difflineplus">+        msg = bundle.getFormattedString(&quot;errorCloudFileOther.message&quot;,</span>
<a href="#l11.430"></a><span id="l11.430" class="difflineplus">+                                        [displayName]);</span>
<a href="#l11.431"></a><span id="l11.431" class="difflineplus">+        break;</span>
<a href="#l11.432"></a><span id="l11.432" class="difflineplus">+      }</span>
<a href="#l11.433"></a><span id="l11.433" class="difflineplus">+</span>
<a href="#l11.434"></a><span id="l11.434" class="difflineplus">+      // TODO: support actions other than &quot;Upgrade&quot;</span>
<a href="#l11.435"></a><span id="l11.435" class="difflineplus">+      const prompt = Services.prompt;</span>
<a href="#l11.436"></a><span id="l11.436" class="difflineplus">+      let url = this.cloudProvider.providerUrlForError(aStatusCode);</span>
<a href="#l11.437"></a><span id="l11.437" class="difflineplus">+      let flags = prompt.BUTTON_POS_0 * prompt.BUTTON_TITLE_OK;</span>
<a href="#l11.438"></a><span id="l11.438" class="difflineplus">+      if (url)</span>
<a href="#l11.439"></a><span id="l11.439" class="difflineplus">+        flags += prompt.BUTTON_POS_1 * prompt.BUTTON_TITLE_IS_STRING;</span>
<a href="#l11.440"></a><span id="l11.440" class="difflineplus">+      if (prompt.confirmEx(window, title, msg, flags, null,</span>
<a href="#l11.441"></a><span id="l11.441" class="difflineplus">+                           bundle.getString(&quot;errorCloudFileUpgrade.label&quot;),</span>
<a href="#l11.442"></a><span id="l11.442" class="difflineplus">+                           null, null, {})) {</span>
<a href="#l11.443"></a><span id="l11.443" class="difflineplus">+        openLinkExternally(url);</span>
<a href="#l11.444"></a><span id="l11.444" class="difflineplus">+      }</span>
<a href="#l11.445"></a><span id="l11.445" class="difflineplus">+</span>
<a href="#l11.446"></a><span id="l11.446" class="difflineplus">+      if (attachmentItem) {</span>
<a href="#l11.447"></a><span id="l11.447" class="difflineplus">+        // Remove the loading throbber.</span>
<a href="#l11.448"></a><span id="l11.448" class="difflineplus">+        attachmentItem.image = null;</span>
<a href="#l11.449"></a><span id="l11.449" class="difflineplus">+      }</span>
<a href="#l11.450"></a><span id="l11.450" class="difflineplus">+    }</span>
<a href="#l11.451"></a><span id="l11.451" class="difflineplus">+</span>
<a href="#l11.452"></a><span id="l11.452" class="difflineplus">+    gNumUploadingAttachments--;</span>
<a href="#l11.453"></a><span id="l11.453" class="difflineplus">+    updateSendCommands();</span>
<a href="#l11.454"></a><span id="l11.454" class="difflineplus">+  },</span>
<a href="#l11.455"></a><span id="l11.455" class="difflineplus">+</span>
<a href="#l11.456"></a><span id="l11.456" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIRequestObserver,</span>
<a href="#l11.457"></a><span id="l11.457" class="difflineplus">+                                         Components.interfaces.nsISupportsWeakReference])</span>
<a href="#l11.458"></a><span id="l11.458" class="difflineplus">+};</span>
<a href="#l11.459"></a><span id="l11.459" class="difflineplus">+</span>
<a href="#l11.460"></a><span id="l11.460" class="difflineplus">+function deletionListener(aAttachment, aCloudProvider)</span>
<a href="#l11.461"></a><span id="l11.461" class="difflineplus">+{</span>
<a href="#l11.462"></a><span id="l11.462" class="difflineplus">+  this.attachment = aAttachment;</span>
<a href="#l11.463"></a><span id="l11.463" class="difflineplus">+  this.cloudProvider = aCloudProvider;</span>
<a href="#l11.464"></a><span id="l11.464" class="difflineplus">+}</span>
<a href="#l11.465"></a><span id="l11.465" class="difflineplus">+</span>
<a href="#l11.466"></a><span id="l11.466" class="difflineplus">+deletionListener.prototype = {</span>
<a href="#l11.467"></a><span id="l11.467" class="difflineplus">+  onStartRequest: function deletionListener_onStartRequest(aRequest, aContext) {</span>
<a href="#l11.468"></a><span id="l11.468" class="difflineplus">+  },</span>
<a href="#l11.469"></a><span id="l11.469" class="difflineplus">+</span>
<a href="#l11.470"></a><span id="l11.470" class="difflineplus">+  onStopRequest: function deletionListener_onStopRequest(aRequest, aContext,</span>
<a href="#l11.471"></a><span id="l11.471" class="difflineplus">+                                                         aStatusCode) {</span>
<a href="#l11.472"></a><span id="l11.472" class="difflineplus">+    if (!Components.isSuccessCode(aStatusCode)) {</span>
<a href="#l11.473"></a><span id="l11.473" class="difflineplus">+      let displayName = cloudFileAccounts.getDisplayName(this.cloudProvider);</span>
<a href="#l11.474"></a><span id="l11.474" class="difflineplus">+      Services.prompt.alert(window,</span>
<a href="#l11.475"></a><span id="l11.475" class="difflineplus">+        getComposeBundle().getString(&quot;errorCloudFileDeletion.title&quot;),</span>
<a href="#l11.476"></a><span id="l11.476" class="difflineplus">+        getComposeBundle().getFormattedString(&quot;errorCloudFileDeletion.message&quot;,</span>
<a href="#l11.477"></a><span id="l11.477" class="difflineplus">+                                              [displayName,</span>
<a href="#l11.478"></a><span id="l11.478" class="difflineplus">+                                               this.attachment.name]));</span>
<a href="#l11.479"></a><span id="l11.479" class="difflineplus">+    }</span>
<a href="#l11.480"></a><span id="l11.480" class="difflineplus">+  },</span>
<a href="#l11.481"></a><span id="l11.481" class="difflineplus">+</span>
<a href="#l11.482"></a><span id="l11.482" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIRequestObserver,</span>
<a href="#l11.483"></a><span id="l11.483" class="difflineplus">+                                         Components.interfaces.nsISupportsWeakReference])</span>
<a href="#l11.484"></a><span id="l11.484" class="difflineplus">+};</span>
<a href="#l11.485"></a><span id="l11.485" class="difflineplus">+</span>
<a href="#l11.486"></a><span id="l11.486" class="difflineplus">+/**</span>
<a href="#l11.487"></a><span id="l11.487" class="difflineplus">+ * Prompt the user for a list of files to attach via a cloud provider.</span>
<a href="#l11.488"></a><span id="l11.488" class="difflineplus">+ *</span>
<a href="#l11.489"></a><span id="l11.489" class="difflineplus">+ * @param aProvider the cloud provider to upload the files to</span>
<a href="#l11.490"></a><span id="l11.490" class="difflineplus">+ */</span>
<a href="#l11.491"></a><span id="l11.491" class="difflineplus">+function attachToCloud(aProvider)</span>
<a href="#l11.492"></a><span id="l11.492" class="difflineplus">+{</span>
<a href="#l11.493"></a><span id="l11.493" class="difflineplus">+  // We need to let the user pick local file(s) to upload to the cloud and</span>
<a href="#l11.494"></a><span id="l11.494" class="difflineplus">+  // gather url(s) to those files.</span>
<a href="#l11.495"></a><span id="l11.495" class="difflineplus">+  var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l11.496"></a><span id="l11.496" class="difflineplus">+                     .createInstance(nsIFilePicker);</span>
<a href="#l11.497"></a><span id="l11.497" class="difflineplus">+  fp.init(window, getComposeBundle().getFormattedString(</span>
<a href="#l11.498"></a><span id="l11.498" class="difflineplus">+            &quot;chooseFileToAttachViaCloud&quot;,</span>
<a href="#l11.499"></a><span id="l11.499" class="difflineplus">+            [cloudFileAccounts.getDisplayName(aProvider)]),</span>
<a href="#l11.500"></a><span id="l11.500" class="difflineplus">+          nsIFilePicker.modeOpenMultiple);</span>
<a href="#l11.501"></a><span id="l11.501" class="difflineplus">+</span>
<a href="#l11.502"></a><span id="l11.502" class="difflineplus">+  var lastDirectory = GetLastAttachDirectory();</span>
<a href="#l11.503"></a><span id="l11.503" class="difflineplus">+  if (lastDirectory)</span>
<a href="#l11.504"></a><span id="l11.504" class="difflineplus">+    fp.displayDirectory = lastDirectory;</span>
<a href="#l11.505"></a><span id="l11.505" class="difflineplus">+</span>
<a href="#l11.506"></a><span id="l11.506" class="difflineplus">+  let files = [];</span>
<a href="#l11.507"></a><span id="l11.507" class="difflineplus">+</span>
<a href="#l11.508"></a><span id="l11.508" class="difflineplus">+  fp.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l11.509"></a><span id="l11.509" class="difflineplus">+  if (fp.show() == nsIFilePicker.returnOK)</span>
<a href="#l11.510"></a><span id="l11.510" class="difflineplus">+  {</span>
<a href="#l11.511"></a><span id="l11.511" class="difflineplus">+    if (!fp.files)</span>
<a href="#l11.512"></a><span id="l11.512" class="difflineplus">+      return;</span>
<a href="#l11.513"></a><span id="l11.513" class="difflineplus">+</span>
<a href="#l11.514"></a><span id="l11.514" class="difflineplus">+    let files = [f for (f in fixIterator(fp.files,</span>
<a href="#l11.515"></a><span id="l11.515" class="difflineplus">+                                         Components.interfaces.nsILocalFile))];</span>
<a href="#l11.516"></a><span id="l11.516" class="difflineplus">+    let attachments = [FileToAttachment(f) for each (f in files)];</span>
<a href="#l11.517"></a><span id="l11.517" class="difflineplus">+</span>
<a href="#l11.518"></a><span id="l11.518" class="difflineplus">+    let i = 0;</span>
<a href="#l11.519"></a><span id="l11.519" class="difflineplus">+    let items = AddAttachments(attachments, function(aItem) {</span>
<a href="#l11.520"></a><span id="l11.520" class="difflineplus">+      let listener = new uploadListener(attachments[i], files[i], aProvider);</span>
<a href="#l11.521"></a><span id="l11.521" class="difflineplus">+      aProvider.uploadFile(files[i], listener);</span>
<a href="#l11.522"></a><span id="l11.522" class="difflineplus">+      i++;</span>
<a href="#l11.523"></a><span id="l11.523" class="difflineplus">+    });</span>
<a href="#l11.524"></a><span id="l11.524" class="difflineplus">+</span>
<a href="#l11.525"></a><span id="l11.525" class="difflineplus">+    SetLastAttachDirectory(files[files.length-1]);</span>
<a href="#l11.526"></a><span id="l11.526" class="difflineplus">+  }</span>
<a href="#l11.527"></a><span id="l11.527" class="difflineplus">+}</span>
<a href="#l11.528"></a><span id="l11.528" class="difflineplus">+</span>
<a href="#l11.529"></a><span id="l11.529" class="difflineplus">+/**</span>
<a href="#l11.530"></a><span id="l11.530" class="difflineplus">+ * Convert an array of attachments to cloud attachments.</span>
<a href="#l11.531"></a><span id="l11.531" class="difflineplus">+ *</span>
<a href="#l11.532"></a><span id="l11.532" class="difflineplus">+ * @param aItems an array of &lt;attachmentitem&gt;s containing the attachments in</span>
<a href="#l11.533"></a><span id="l11.533" class="difflineplus">+ *        question</span>
<a href="#l11.534"></a><span id="l11.534" class="difflineplus">+ * @param aProvider the cloud provider to upload the files to</span>
<a href="#l11.535"></a><span id="l11.535" class="difflineplus">+ */</span>
<a href="#l11.536"></a><span id="l11.536" class="difflineplus">+function convertListItemsToCloudAttachment(aItems, aProvider)</span>
<a href="#l11.537"></a><span id="l11.537" class="difflineplus">+{</span>
<a href="#l11.538"></a><span id="l11.538" class="difflineplus">+  let fileHandler = Services.io.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l11.539"></a><span id="l11.539" class="difflineplus">+                            .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l11.540"></a><span id="l11.540" class="difflineplus">+  let convertedAttachments = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l11.541"></a><span id="l11.541" class="difflineplus">+                                       .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l11.542"></a><span id="l11.542" class="difflineplus">+</span>
<a href="#l11.543"></a><span id="l11.543" class="difflineplus">+  for (let [,item] in Iterator(aItems)) {</span>
<a href="#l11.544"></a><span id="l11.544" class="difflineplus">+    let url = item.attachment.url;</span>
<a href="#l11.545"></a><span id="l11.545" class="difflineplus">+</span>
<a href="#l11.546"></a><span id="l11.546" class="difflineplus">+    if (item.attachment.sendViaCloud) {</span>
<a href="#l11.547"></a><span id="l11.547" class="difflineplus">+      if (item.cloudProvider &amp;&amp; item.cloudProvider == aProvider)</span>
<a href="#l11.548"></a><span id="l11.548" class="difflineplus">+        continue;</span>
<a href="#l11.549"></a><span id="l11.549" class="difflineplus">+      url = item.originalUrl;</span>
<a href="#l11.550"></a><span id="l11.550" class="difflineplus">+    }</span>
<a href="#l11.551"></a><span id="l11.551" class="difflineplus">+</span>
<a href="#l11.552"></a><span id="l11.552" class="difflineplus">+    let file = fileHandler.getFileFromURLSpec(url);</span>
<a href="#l11.553"></a><span id="l11.553" class="difflineplus">+    if (item.cloudProvider) {</span>
<a href="#l11.554"></a><span id="l11.554" class="difflineplus">+      item.cloudProvider.deleteFile(</span>
<a href="#l11.555"></a><span id="l11.555" class="difflineplus">+        file, new deletionListener(item.attachment, item.cloudProvider));</span>
<a href="#l11.556"></a><span id="l11.556" class="difflineplus">+    }</span>
<a href="#l11.557"></a><span id="l11.557" class="difflineplus">+</span>
<a href="#l11.558"></a><span id="l11.558" class="difflineplus">+    aProvider.uploadFile(file,</span>
<a href="#l11.559"></a><span id="l11.559" class="difflineplus">+                         new uploadListener(item.attachment, file, aProvider));</span>
<a href="#l11.560"></a><span id="l11.560" class="difflineplus">+    convertedAttachments.appendElement(item.attachment, false);</span>
<a href="#l11.561"></a><span id="l11.561" class="difflineplus">+  }</span>
<a href="#l11.562"></a><span id="l11.562" class="difflineplus">+</span>
<a href="#l11.563"></a><span id="l11.563" class="difflineplus">+  Services.obs.notifyObservers(convertedAttachments,</span>
<a href="#l11.564"></a><span id="l11.564" class="difflineplus">+                               &quot;mail:attachmentsConverted&quot;,</span>
<a href="#l11.565"></a><span id="l11.565" class="difflineplus">+                               aProvider.accountKey);</span>
<a href="#l11.566"></a><span id="l11.566" class="difflineplus">+}</span>
<a href="#l11.567"></a><span id="l11.567" class="difflineplus">+</span>
<a href="#l11.568"></a><span id="l11.568" class="difflineplus">+/**</span>
<a href="#l11.569"></a><span id="l11.569" class="difflineplus">+ * Convert the selected attachments to cloud attachments.</span>
<a href="#l11.570"></a><span id="l11.570" class="difflineplus">+ *</span>
<a href="#l11.571"></a><span id="l11.571" class="difflineplus">+ * @param aProvider the cloud provider to upload the files to</span>
<a href="#l11.572"></a><span id="l11.572" class="difflineplus">+ */</span>
<a href="#l11.573"></a><span id="l11.573" class="difflineplus">+function convertSelectedToCloudAttachment(aProvider)</span>
<a href="#l11.574"></a><span id="l11.574" class="difflineplus">+{</span>
<a href="#l11.575"></a><span id="l11.575" class="difflineplus">+  let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.576"></a><span id="l11.576" class="difflineplus">+  convertListItemsToCloudAttachment(bucket.selectedItems, aProvider);</span>
<a href="#l11.577"></a><span id="l11.577" class="difflineplus">+}</span>
<a href="#l11.578"></a><span id="l11.578" class="difflineplus">+</span>
<a href="#l11.579"></a><span id="l11.579" class="difflineplus">+/**</span>
<a href="#l11.580"></a><span id="l11.580" class="difflineplus">+ * Convert an array of nsIMsgAttachments to cloud attachments.</span>
<a href="#l11.581"></a><span id="l11.581" class="difflineplus">+ *</span>
<a href="#l11.582"></a><span id="l11.582" class="difflineplus">+ * @param aAttachments an array of nsIMsgAttachments</span>
<a href="#l11.583"></a><span id="l11.583" class="difflineplus">+ * @param aProvider the cloud provider to upload the files to</span>
<a href="#l11.584"></a><span id="l11.584" class="difflineplus">+ */</span>
<a href="#l11.585"></a><span id="l11.585" class="difflineplus">+function convertToCloudAttachment(aAttachments, aProvider)</span>
<a href="#l11.586"></a><span id="l11.586" class="difflineplus">+{</span>
<a href="#l11.587"></a><span id="l11.587" class="difflineplus">+  let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.588"></a><span id="l11.588" class="difflineplus">+  let items = [];</span>
<a href="#l11.589"></a><span id="l11.589" class="difflineplus">+  for (let [,attachment] in Iterator(aAttachments)) {</span>
<a href="#l11.590"></a><span id="l11.590" class="difflineplus">+    let item = bucket.findItemForAttachment(attachment);</span>
<a href="#l11.591"></a><span id="l11.591" class="difflineplus">+    if (item)</span>
<a href="#l11.592"></a><span id="l11.592" class="difflineplus">+      items.push(item);</span>
<a href="#l11.593"></a><span id="l11.593" class="difflineplus">+  }</span>
<a href="#l11.594"></a><span id="l11.594" class="difflineplus">+</span>
<a href="#l11.595"></a><span id="l11.595" class="difflineplus">+  convertListItemsToCloudAttachment(items, aProvider);</span>
<a href="#l11.596"></a><span id="l11.596" class="difflineplus">+}</span>
<a href="#l11.597"></a><span id="l11.597" class="difflineplus">+</span>
<a href="#l11.598"></a><span id="l11.598" class="difflineplus">+/**</span>
<a href="#l11.599"></a><span id="l11.599" class="difflineplus">+ * Convert an array of attachments to regular (non-cloud) attachments.</span>
<a href="#l11.600"></a><span id="l11.600" class="difflineplus">+ *</span>
<a href="#l11.601"></a><span id="l11.601" class="difflineplus">+ * @param aItems an array of &lt;attachmentitem&gt;s containing the attachments in</span>
<a href="#l11.602"></a><span id="l11.602" class="difflineplus">+ *        question</span>
<a href="#l11.603"></a><span id="l11.603" class="difflineplus">+ */</span>
<a href="#l11.604"></a><span id="l11.604" class="difflineplus">+function convertListItemsToRegularAttachment(aItems)</span>
<a href="#l11.605"></a><span id="l11.605" class="difflineplus">+{</span>
<a href="#l11.606"></a><span id="l11.606" class="difflineplus">+  let fileHandler = Services.io.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l11.607"></a><span id="l11.607" class="difflineplus">+                            .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l11.608"></a><span id="l11.608" class="difflineplus">+  let convertedAttachments = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l11.609"></a><span id="l11.609" class="difflineplus">+                                       .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l11.610"></a><span id="l11.610" class="difflineplus">+</span>
<a href="#l11.611"></a><span id="l11.611" class="difflineplus">+  for (let [,item] in Iterator(aItems)) {</span>
<a href="#l11.612"></a><span id="l11.612" class="difflineplus">+    if (!item.attachment.sendViaCloud || !item.cloudProvider)</span>
<a href="#l11.613"></a><span id="l11.613" class="difflineplus">+      continue;</span>
<a href="#l11.614"></a><span id="l11.614" class="difflineplus">+</span>
<a href="#l11.615"></a><span id="l11.615" class="difflineplus">+    let file = fileHandler.getFileFromURLSpec(item.originalUrl);</span>
<a href="#l11.616"></a><span id="l11.616" class="difflineplus">+    try {</span>
<a href="#l11.617"></a><span id="l11.617" class="difflineplus">+      // This will fail for drafts, but we can still send the message</span>
<a href="#l11.618"></a><span id="l11.618" class="difflineplus">+      // with a normal attachment.</span>
<a href="#l11.619"></a><span id="l11.619" class="difflineplus">+      item.cloudProvider.deleteFile(</span>
<a href="#l11.620"></a><span id="l11.620" class="difflineplus">+        file, new deletionListener(item.attachment, item.cloudProvider));</span>
<a href="#l11.621"></a><span id="l11.621" class="difflineplus">+    }</span>
<a href="#l11.622"></a><span id="l11.622" class="difflineplus">+    catch (ex) {</span>
<a href="#l11.623"></a><span id="l11.623" class="difflineplus">+       Components.utils.reportError(ex);</span>
<a href="#l11.624"></a><span id="l11.624" class="difflineplus">+    }</span>
<a href="#l11.625"></a><span id="l11.625" class="difflineplus">+</span>
<a href="#l11.626"></a><span id="l11.626" class="difflineplus">+    item.attachment.url = item.originalUrl;</span>
<a href="#l11.627"></a><span id="l11.627" class="difflineplus">+    item.setAttribute(&quot;tooltiptext&quot;, item.attachment.url);</span>
<a href="#l11.628"></a><span id="l11.628" class="difflineplus">+    item.attachment.sendViaCloud = false;</span>
<a href="#l11.629"></a><span id="l11.629" class="difflineplus">+</span>
<a href="#l11.630"></a><span id="l11.630" class="difflineplus">+    delete item.cloudProvider;</span>
<a href="#l11.631"></a><span id="l11.631" class="difflineplus">+    delete item.originalUrl;</span>
<a href="#l11.632"></a><span id="l11.632" class="difflineplus">+    item.image = null;</span>
<a href="#l11.633"></a><span id="l11.633" class="difflineplus">+</span>
<a href="#l11.634"></a><span id="l11.634" class="difflineplus">+    convertedAttachments.appendElement(item.attachment, false);</span>
<a href="#l11.635"></a><span id="l11.635" class="difflineplus">+  }</span>
<a href="#l11.636"></a><span id="l11.636" class="difflineplus">+  let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.637"></a><span id="l11.637" class="difflineplus">+  let event = document.createEvent(&quot;CustomEvent&quot;);</span>
<a href="#l11.638"></a><span id="l11.638" class="difflineplus">+  event.initCustomEvent(&quot;attachments-converted&quot;, true, true, convertedAttachments);</span>
<a href="#l11.639"></a><span id="l11.639" class="difflineplus">+  bucket.dispatchEvent(event);</span>
<a href="#l11.640"></a><span id="l11.640" class="difflineplus">+</span>
<a href="#l11.641"></a><span id="l11.641" class="difflineplus">+  Services.obs.notifyObservers(convertedAttachments,</span>
<a href="#l11.642"></a><span id="l11.642" class="difflineplus">+                               &quot;mail:attachmentsConverted&quot;, null);</span>
<a href="#l11.643"></a><span id="l11.643" class="difflineplus">+                               </span>
<a href="#l11.644"></a><span id="l11.644" class="difflineplus">+  // We leave the content location in for the notifications because</span>
<a href="#l11.645"></a><span id="l11.645" class="difflineplus">+  // it may be needed to identify the attachment. But clear it out now.</span>
<a href="#l11.646"></a><span id="l11.646" class="difflineplus">+  for (let [,item] in Iterator(aItems))</span>
<a href="#l11.647"></a><span id="l11.647" class="difflineplus">+    delete item.attachment.contentLocation;</span>
<a href="#l11.648"></a><span id="l11.648" class="difflineplus">+}</span>
<a href="#l11.649"></a><span id="l11.649" class="difflineplus">+</span>
<a href="#l11.650"></a><span id="l11.650" class="difflineplus">+/**</span>
<a href="#l11.651"></a><span id="l11.651" class="difflineplus">+ * Convert the selected attachments to regular (non-cloud) attachments.</span>
<a href="#l11.652"></a><span id="l11.652" class="difflineplus">+ */</span>
<a href="#l11.653"></a><span id="l11.653" class="difflineplus">+function convertSelectedToRegularAttachment()</span>
<a href="#l11.654"></a><span id="l11.654" class="difflineplus">+{</span>
<a href="#l11.655"></a><span id="l11.655" class="difflineplus">+  let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.656"></a><span id="l11.656" class="difflineplus">+  convertListItemsToRegularAttachment(bucket.selectedItems);</span>
<a href="#l11.657"></a><span id="l11.657" class="difflineplus">+}</span>
<a href="#l11.658"></a><span id="l11.658" class="difflineplus">+</span>
<a href="#l11.659"></a><span id="l11.659" class="difflineplus">+/**</span>
<a href="#l11.660"></a><span id="l11.660" class="difflineplus">+ * Convert an array of nsIMsgAttachments to regular (non-cloud) attachments.</span>
<a href="#l11.661"></a><span id="l11.661" class="difflineplus">+ *</span>
<a href="#l11.662"></a><span id="l11.662" class="difflineplus">+ * @param aAttachments an array of nsIMsgAttachments</span>
<a href="#l11.663"></a><span id="l11.663" class="difflineplus">+ */</span>
<a href="#l11.664"></a><span id="l11.664" class="difflineplus">+function convertToRegularAttachment(aAttachments)</span>
<a href="#l11.665"></a><span id="l11.665" class="difflineplus">+{</span>
<a href="#l11.666"></a><span id="l11.666" class="difflineplus">+  let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.667"></a><span id="l11.667" class="difflineplus">+  let items = [];</span>
<a href="#l11.668"></a><span id="l11.668" class="difflineplus">+  for (let [,attachment] in Iterator(aAttachments)) {</span>
<a href="#l11.669"></a><span id="l11.669" class="difflineplus">+    let item = bucket.findItemForAttachment(attachment);</span>
<a href="#l11.670"></a><span id="l11.670" class="difflineplus">+    if (item)</span>
<a href="#l11.671"></a><span id="l11.671" class="difflineplus">+      items.push(item);</span>
<a href="#l11.672"></a><span id="l11.672" class="difflineplus">+  }</span>
<a href="#l11.673"></a><span id="l11.673" class="difflineplus">+</span>
<a href="#l11.674"></a><span id="l11.674" class="difflineplus">+  convertListItemsToRegularAttachment(items);</span>
<a href="#l11.675"></a><span id="l11.675" class="difflineplus">+}</span>
<a href="#l11.676"></a><span id="l11.676" class="difflineplus">+</span>
<a href="#l11.677"></a><span id="l11.677"> function updateOptionItems()</span>
<a href="#l11.678"></a><span id="l11.678"> {</span>
<a href="#l11.679"></a><span id="l11.679">   goUpdateCommand(&quot;cmd_quoteMessage&quot;);</span>
<a href="#l11.680"></a><span id="l11.680"> }</span>
<a href="#l11.681"></a><span id="l11.681"> </span>
<a href="#l11.682"></a><span id="l11.682"> /* messageComposeOfflineQuitObserver is notified whenever the network</span>
<a href="#l11.683"></a><span id="l11.683">  * connection status has switched to offline, or when the application</span>
<a href="#l11.684"></a><span id="l11.684">  * has received a request to quit.</span>
<a href="#l11.685"></a><span id="l11.685" class="difflineat">@@ -1682,16 +2193,18 @@ function ComposeStartup(recycled, aParam</span>
<a href="#l11.686"></a><span id="l11.686">       }</span>
<a href="#l11.687"></a><span id="l11.687">       if (args.newshost)</span>
<a href="#l11.688"></a><span id="l11.688">         composeFields.newshost = args.newshost;</span>
<a href="#l11.689"></a><span id="l11.689">       if (args.body)</span>
<a href="#l11.690"></a><span id="l11.690">          composeFields.body = args.body;</span>
<a href="#l11.691"></a><span id="l11.691">     }</span>
<a href="#l11.692"></a><span id="l11.692">   }</span>
<a href="#l11.693"></a><span id="l11.693"> </span>
<a href="#l11.694"></a><span id="l11.694" class="difflineplus">+  gComposeType = params.type;</span>
<a href="#l11.695"></a><span id="l11.695" class="difflineplus">+</span>
<a href="#l11.696"></a><span id="l11.696">   // &quot; &lt;&gt;&quot; is an empty identity, and most likely not valid</span>
<a href="#l11.697"></a><span id="l11.697">   if (!params.identity || params.identity.identityName == &quot; &lt;&gt;&quot;) {</span>
<a href="#l11.698"></a><span id="l11.698">     // no pre selected identity, so use the default account</span>
<a href="#l11.699"></a><span id="l11.699">     var identities = gAccountManager.defaultAccount.identities;</span>
<a href="#l11.700"></a><span id="l11.700">     if (identities.Count() == 0)</span>
<a href="#l11.701"></a><span id="l11.701">       identities = gAccountManager.allIdentities;</span>
<a href="#l11.702"></a><span id="l11.702">     params.identity = identities.QueryElementAt(0, Components.interfaces.nsIMsgIdentity);</span>
<a href="#l11.703"></a><span id="l11.703">   }</span>
<a href="#l11.704"></a><span id="l11.704" class="difflineat">@@ -2075,19 +2588,20 @@ function GenericSendMessage(msgType)</span>
<a href="#l11.705"></a><span id="l11.705"> {</span>
<a href="#l11.706"></a><span id="l11.706">   var msgCompFields = gMsgCompose.compFields;</span>
<a href="#l11.707"></a><span id="l11.707"> </span>
<a href="#l11.708"></a><span id="l11.708">   Recipients2CompFields(msgCompFields);</span>
<a href="#l11.709"></a><span id="l11.709">   var subject = GetMsgSubjectElement().value;</span>
<a href="#l11.710"></a><span id="l11.710">   msgCompFields.subject = subject;</span>
<a href="#l11.711"></a><span id="l11.711">   Attachments2CompFields(msgCompFields);</span>
<a href="#l11.712"></a><span id="l11.712"> </span>
<a href="#l11.713"></a><span id="l11.713" class="difflineminus">-  if (msgType == nsIMsgCompDeliverMode.Now ||</span>
<a href="#l11.714"></a><span id="l11.714" class="difflineplus">+  let sending = msgType == nsIMsgCompDeliverMode.Now ||</span>
<a href="#l11.715"></a><span id="l11.715">       msgType == nsIMsgCompDeliverMode.Later ||</span>
<a href="#l11.716"></a><span id="l11.716" class="difflineminus">-      msgType == nsIMsgCompDeliverMode.Background)</span>
<a href="#l11.717"></a><span id="l11.717" class="difflineplus">+      msgType == nsIMsgCompDeliverMode.Background;</span>
<a href="#l11.718"></a><span id="l11.718" class="difflineplus">+  if (sending)</span>
<a href="#l11.719"></a><span id="l11.719">   {</span>
<a href="#l11.720"></a><span id="l11.720">     // Do we need to check the spelling?</span>
<a href="#l11.721"></a><span id="l11.721">     if (DoSpellCheckBeforeSend())</span>
<a href="#l11.722"></a><span id="l11.722">     {</span>
<a href="#l11.723"></a><span id="l11.723">       // We disable spellcheck for the following -subject line, attachment</span>
<a href="#l11.724"></a><span id="l11.724">       // pane, identity and addressing widget therefore we need to explicitly</span>
<a href="#l11.725"></a><span id="l11.725">       // focus on the mail body when we have to do a spellcheck.</span>
<a href="#l11.726"></a><span id="l11.726">       SetMsgBodyFrameFocus();</span>
<a href="#l11.727"></a><span id="l11.727" class="difflineat">@@ -2999,40 +3513,42 @@ function AttachFile()</span>
<a href="#l11.728"></a><span id="l11.728"> /**</span>
<a href="#l11.729"></a><span id="l11.729">  * Convert an nsILocalFile instance into an nsIMsgAttachment.</span>
<a href="#l11.730"></a><span id="l11.730">  *</span>
<a href="#l11.731"></a><span id="l11.731">  * @param file the nsILocalFile</span>
<a href="#l11.732"></a><span id="l11.732">  * @return an attachment pointing to the file</span>
<a href="#l11.733"></a><span id="l11.733">  */</span>
<a href="#l11.734"></a><span id="l11.734"> function FileToAttachment(file)</span>
<a href="#l11.735"></a><span id="l11.735"> {</span>
<a href="#l11.736"></a><span id="l11.736" class="difflineminus">-  let fileHandler = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l11.737"></a><span id="l11.737" class="difflineminus">-                              .getService(Components.interfaces.nsIIOService)</span>
<a href="#l11.738"></a><span id="l11.738" class="difflineminus">-                              .getProtocolHandler(&quot;file&quot;)</span>
<a href="#l11.739"></a><span id="l11.739" class="difflineminus">-                              .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l11.740"></a><span id="l11.740" class="difflineplus">+  let fileHandler = Services.io.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l11.741"></a><span id="l11.741" class="difflineplus">+                            .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l11.742"></a><span id="l11.742">   let attachment = Components.classes[&quot;@mozilla.org/messengercompose/attachment;1&quot;]</span>
<a href="#l11.743"></a><span id="l11.743">                              .createInstance(Components.interfaces.nsIMsgAttachment);</span>
<a href="#l11.744"></a><span id="l11.744"> </span>
<a href="#l11.745"></a><span id="l11.745">   attachment.url = fileHandler.getURLSpecFromFile(file);</span>
<a href="#l11.746"></a><span id="l11.746">   attachment.size = file.fileSize;</span>
<a href="#l11.747"></a><span id="l11.747">   return attachment;</span>
<a href="#l11.748"></a><span id="l11.748"> }</span>
<a href="#l11.749"></a><span id="l11.749"> </span>
<a href="#l11.750"></a><span id="l11.750"> /**</span>
<a href="#l11.751"></a><span id="l11.751">  * Add a list of attachment objects as attachments. The attachment URLs must be</span>
<a href="#l11.752"></a><span id="l11.752">  * set.</span>
<a href="#l11.753"></a><span id="l11.753">  *</span>
<a href="#l11.754"></a><span id="l11.754">  * @param aAttachments an iterable list of nsIMsgAttachment objects to add as</span>
<a href="#l11.755"></a><span id="l11.755">  *        attachments. Anything iterable with fixIterator is accepted.</span>
<a href="#l11.756"></a><span id="l11.756" class="difflineplus">+ * @param aCallback an optional callback function called immediately after</span>
<a href="#l11.757"></a><span id="l11.757" class="difflineplus">+ *        adding each attachment. Takes one argument: the newly-added</span>
<a href="#l11.758"></a><span id="l11.758" class="difflineplus">+ *        &lt;attachmentitem&gt; node.</span>
<a href="#l11.759"></a><span id="l11.759">  */</span>
<a href="#l11.760"></a><span id="l11.760" class="difflineminus">-function AddAttachments(aAttachments)</span>
<a href="#l11.761"></a><span id="l11.761" class="difflineplus">+function AddAttachments(aAttachments, aCallback)</span>
<a href="#l11.762"></a><span id="l11.762"> {</span>
<a href="#l11.763"></a><span id="l11.763">   let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.764"></a><span id="l11.764">   let addedAttachments = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l11.765"></a><span id="l11.765">                                    .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l11.766"></a><span id="l11.766" class="difflineplus">+  let items = [];</span>
<a href="#l11.767"></a><span id="l11.767"> </span>
<a href="#l11.768"></a><span id="l11.768">   for (let attachment in fixIterator(aAttachments,</span>
<a href="#l11.769"></a><span id="l11.769">                                      Components.interfaces.nsIMsgAttachment)) {</span>
<a href="#l11.770"></a><span id="l11.770">     if (!(attachment &amp;&amp; attachment.url) ||</span>
<a href="#l11.771"></a><span id="l11.771">         DuplicateFileAlreadyAttached(attachment.url))</span>
<a href="#l11.772"></a><span id="l11.772">       continue;</span>
<a href="#l11.773"></a><span id="l11.773"> </span>
<a href="#l11.774"></a><span id="l11.774">     if (!attachment.name)</span>
<a href="#l11.775"></a><span id="l11.775" class="difflineat">@@ -3056,41 +3572,58 @@ function AddAttachments(aAttachments)</span>
<a href="#l11.776"></a><span id="l11.776">     try {</span>
<a href="#l11.777"></a><span id="l11.777">       item.setAttribute(&quot;tooltiptext&quot;, decodeURI(attachment.url));</span>
<a href="#l11.778"></a><span id="l11.778">     }</span>
<a href="#l11.779"></a><span id="l11.779">     catch(e) {</span>
<a href="#l11.780"></a><span id="l11.780">       item.setAttribute(&quot;tooltiptext&quot;, attachment.url);</span>
<a href="#l11.781"></a><span id="l11.781">     }</span>
<a href="#l11.782"></a><span id="l11.782">     item.addEventListener(&quot;command&quot;, OpenSelectedAttachment, false);</span>
<a href="#l11.783"></a><span id="l11.783"> </span>
<a href="#l11.784"></a><span id="l11.784" class="difflineminus">-    // For local file urls, we are better off using the full file url because</span>
<a href="#l11.785"></a><span id="l11.785" class="difflineminus">-    // moz-icon will actually resolve the file url and get the right icon from</span>
<a href="#l11.786"></a><span id="l11.786" class="difflineminus">-    // the file url. All other urls, we should try to extract the file name from</span>
<a href="#l11.787"></a><span id="l11.787" class="difflineminus">-    // them. This fixes issues where an icon wasn't showing up if you dragged a</span>
<a href="#l11.788"></a><span id="l11.788" class="difflineminus">-    // web url that had a query or reference string after the file name and for</span>
<a href="#l11.789"></a><span id="l11.789" class="difflineminus">-    // mailnews urls where the filename is hidden in the url as a &amp;filename=</span>
<a href="#l11.790"></a><span id="l11.790" class="difflineminus">-    // part.</span>
<a href="#l11.791"></a><span id="l11.791" class="difflineminus">-    var url = gIOService.newURI(attachment.url, null, null);</span>
<a href="#l11.792"></a><span id="l11.792" class="difflineminus">-    if (url instanceof Components.interfaces.nsIURL &amp;&amp;</span>
<a href="#l11.793"></a><span id="l11.793" class="difflineminus">-        url.fileName &amp;&amp; !url.schemeIs(&quot;file&quot;))</span>
<a href="#l11.794"></a><span id="l11.794" class="difflineminus">-      item.setAttribute(&quot;image&quot;, &quot;moz-icon://&quot; + url.fileName);</span>
<a href="#l11.795"></a><span id="l11.795" class="difflineminus">-    else</span>
<a href="#l11.796"></a><span id="l11.796" class="difflineminus">-      item.setAttribute(&quot;image&quot;, &quot;moz-icon:&quot; + attachment.url);</span>
<a href="#l11.797"></a><span id="l11.797" class="difflineplus">+    if (attachment.sendViaCloud) {</span>
<a href="#l11.798"></a><span id="l11.798" class="difflineplus">+      try {</span>
<a href="#l11.799"></a><span id="l11.799" class="difflineplus">+        let cloudProvider = cloudFileAccounts.getAccount(attachment.cloudProviderKey);</span>
<a href="#l11.800"></a><span id="l11.800" class="difflineplus">+        item.cloudProvider = cloudProvider;</span>
<a href="#l11.801"></a><span id="l11.801" class="difflineplus">+        item.image = cloudProvider.iconClass;</span>
<a href="#l11.802"></a><span id="l11.802" class="difflineplus">+        item.originalUrl = attachment.url;</span>
<a href="#l11.803"></a><span id="l11.803" class="difflineplus">+      } catch (ex) {dump(ex);}</span>
<a href="#l11.804"></a><span id="l11.804" class="difflineplus">+    }</span>
<a href="#l11.805"></a><span id="l11.805" class="difflineplus">+    else {</span>
<a href="#l11.806"></a><span id="l11.806" class="difflineplus">+      // For local file urls, we are better off using the full file url because</span>
<a href="#l11.807"></a><span id="l11.807" class="difflineplus">+      // moz-icon will actually resolve the file url and get the right icon from</span>
<a href="#l11.808"></a><span id="l11.808" class="difflineplus">+      // the file url. All other urls, we should try to extract the file name from</span>
<a href="#l11.809"></a><span id="l11.809" class="difflineplus">+      // them. This fixes issues where an icon wasn't showing up if you dragged a</span>
<a href="#l11.810"></a><span id="l11.810" class="difflineplus">+      // web url that had a query or reference string after the file name and for</span>
<a href="#l11.811"></a><span id="l11.811" class="difflineplus">+      // mailnews urls where the filename is hidden in the url as a &amp;filename=</span>
<a href="#l11.812"></a><span id="l11.812" class="difflineplus">+      // part.</span>
<a href="#l11.813"></a><span id="l11.813" class="difflineplus">+      var url = gIOService.newURI(attachment.url, null, null);</span>
<a href="#l11.814"></a><span id="l11.814" class="difflineplus">+      if (url instanceof Components.interfaces.nsIURL &amp;&amp;</span>
<a href="#l11.815"></a><span id="l11.815" class="difflineplus">+          url.fileName &amp;&amp; !url.schemeIs(&quot;file&quot;))</span>
<a href="#l11.816"></a><span id="l11.816" class="difflineplus">+        item.image = &quot;moz-icon://&quot; + url.fileName;</span>
<a href="#l11.817"></a><span id="l11.817" class="difflineplus">+      else</span>
<a href="#l11.818"></a><span id="l11.818" class="difflineplus">+        item.image = &quot;moz-icon:&quot; + attachment.url;</span>
<a href="#l11.819"></a><span id="l11.819" class="difflineplus">+      }</span>
<a href="#l11.820"></a><span id="l11.820" class="difflineplus">+</span>
<a href="#l11.821"></a><span id="l11.821" class="difflineplus">+    items.push(item);</span>
<a href="#l11.822"></a><span id="l11.822" class="difflineplus">+</span>
<a href="#l11.823"></a><span id="l11.823" class="difflineplus">+    if (aCallback)</span>
<a href="#l11.824"></a><span id="l11.824" class="difflineplus">+      aCallback(item);</span>
<a href="#l11.825"></a><span id="l11.825"> </span>
<a href="#l11.826"></a><span id="l11.826">     CheckForAttachmentNotification(null);</span>
<a href="#l11.827"></a><span id="l11.827">   }</span>
<a href="#l11.828"></a><span id="l11.828"> </span>
<a href="#l11.829"></a><span id="l11.829">   if (addedAttachments.length) {</span>
<a href="#l11.830"></a><span id="l11.830">     gContentChanged = true;</span>
<a href="#l11.831"></a><span id="l11.831"> </span>
<a href="#l11.832"></a><span id="l11.832">     UpdateAttachmentBucket(true);</span>
<a href="#l11.833"></a><span id="l11.833">     let event = document.createEvent(&quot;CustomEvent&quot;);</span>
<a href="#l11.834"></a><span id="l11.834">     event.initCustomEvent(&quot;attachments-added&quot;, true, true, addedAttachments);</span>
<a href="#l11.835"></a><span id="l11.835">     bucket.dispatchEvent(event);</span>
<a href="#l11.836"></a><span id="l11.836">   }</span>
<a href="#l11.837"></a><span id="l11.837" class="difflineplus">+</span>
<a href="#l11.838"></a><span id="l11.838" class="difflineplus">+  return items;</span>
<a href="#l11.839"></a><span id="l11.839"> }</span>
<a href="#l11.840"></a><span id="l11.840"> </span>
<a href="#l11.841"></a><span id="l11.841"> /**</span>
<a href="#l11.842"></a><span id="l11.842">  * Add a file object as attachment. This is mostly just a helper function to</span>
<a href="#l11.843"></a><span id="l11.843">  * wrap a file into an nsIMsgAttachment object with it's URL set. Note: this</span>
<a href="#l11.844"></a><span id="l11.844">  * function is DEPRECATED. Use AddAttachments and FileToAttachment instead.</span>
<a href="#l11.845"></a><span id="l11.845">  *</span>
<a href="#l11.846"></a><span id="l11.846">  * @param file the nsIFile object to add as attachment</span>
<a href="#l11.847"></a><span id="l11.847" class="difflineat">@@ -3215,35 +3748,40 @@ function UpdateAttachmentBucket(aShowBuc</span>
<a href="#l11.848"></a><span id="l11.848">   }</span>
<a href="#l11.849"></a><span id="l11.849"> </span>
<a href="#l11.850"></a><span id="l11.850">   document.getElementById(&quot;attachments-box&quot;).collapsed = !aShowBucket;</span>
<a href="#l11.851"></a><span id="l11.851">   document.getElementById(&quot;attachmentbucket-sizer&quot;).collapsed = !aShowBucket;</span>
<a href="#l11.852"></a><span id="l11.852"> }</span>
<a href="#l11.853"></a><span id="l11.853"> </span>
<a href="#l11.854"></a><span id="l11.854"> function RemoveSelectedAttachment()</span>
<a href="#l11.855"></a><span id="l11.855"> {</span>
<a href="#l11.856"></a><span id="l11.856" class="difflineminus">-  var child;</span>
<a href="#l11.857"></a><span id="l11.857" class="difflineminus">-  var bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.858"></a><span id="l11.858" class="difflineplus">+  let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l11.859"></a><span id="l11.859">   if (bucket.selectedItems.length &gt; 0) {</span>
<a href="#l11.860"></a><span id="l11.860" class="difflineplus">+    let fileHandler = Services.io.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l11.861"></a><span id="l11.861" class="difflineplus">+                              .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l11.862"></a><span id="l11.862">     let removedAttachments = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l11.863"></a><span id="l11.863">                                        .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l11.864"></a><span id="l11.864"> </span>
<a href="#l11.865"></a><span id="l11.865" class="difflineminus">-    for (let i = bucket.selectedCount - 1; i &gt;= 0; i--)</span>
<a href="#l11.866"></a><span id="l11.866" class="difflineminus">-    {</span>
<a href="#l11.867"></a><span id="l11.867" class="difflineminus">-      child = bucket.removeItemAt(bucket.getIndexOfItem(bucket.getSelectedItem(i)));</span>
<a href="#l11.868"></a><span id="l11.868" class="difflineminus">-      if (child.attachment.size != -1)</span>
<a href="#l11.869"></a><span id="l11.869" class="difflineminus">-      {</span>
<a href="#l11.870"></a><span id="l11.870" class="difflineminus">-        gAttachmentsSize -= child.attachment.size;</span>
<a href="#l11.871"></a><span id="l11.871" class="difflineplus">+    for (let i = bucket.selectedCount - 1; i &gt;= 0; i--) {</span>
<a href="#l11.872"></a><span id="l11.872" class="difflineplus">+      let item = bucket.removeItemAt(bucket.getIndexOfItem(bucket.getSelectedItem(i)));</span>
<a href="#l11.873"></a><span id="l11.873" class="difflineplus">+      if (item.attachment.size != -1) {</span>
<a href="#l11.874"></a><span id="l11.874" class="difflineplus">+        gAttachmentsSize -= item.attachment.size;</span>
<a href="#l11.875"></a><span id="l11.875">         UpdateAttachmentBucket(true);</span>
<a href="#l11.876"></a><span id="l11.876">       }</span>
<a href="#l11.877"></a><span id="l11.877"> </span>
<a href="#l11.878"></a><span id="l11.878" class="difflineminus">-      removedAttachments.appendElement(child.attachment, false);</span>
<a href="#l11.879"></a><span id="l11.879" class="difflineplus">+      if (item.attachment.sendViaCloud &amp;&amp; item.cloudProvider) {</span>
<a href="#l11.880"></a><span id="l11.880" class="difflineplus">+        let file = fileHandler.getFileFromURLSpec(item.originalUrl);</span>
<a href="#l11.881"></a><span id="l11.881" class="difflineplus">+        item.cloudProvider.deleteFile(</span>
<a href="#l11.882"></a><span id="l11.882" class="difflineplus">+          file, new deletionListener(item.attachment, item.cloudProvider));</span>
<a href="#l11.883"></a><span id="l11.883" class="difflineplus">+      }</span>
<a href="#l11.884"></a><span id="l11.884" class="difflineplus">+</span>
<a href="#l11.885"></a><span id="l11.885" class="difflineplus">+      removedAttachments.appendElement(item.attachment, false);</span>
<a href="#l11.886"></a><span id="l11.886">       // Let's release the attachment object held by the node else it won't go</span>
<a href="#l11.887"></a><span id="l11.887">       // away until the window is destroyed</span>
<a href="#l11.888"></a><span id="l11.888" class="difflineminus">-      child.attachment = null;</span>
<a href="#l11.889"></a><span id="l11.889" class="difflineplus">+      item.attachment = null;</span>
<a href="#l11.890"></a><span id="l11.890">     }</span>
<a href="#l11.891"></a><span id="l11.891"> </span>
<a href="#l11.892"></a><span id="l11.892">     gContentChanged = true;</span>
<a href="#l11.893"></a><span id="l11.893"> </span>
<a href="#l11.894"></a><span id="l11.894">     let event = document.createEvent(&quot;CustomEvent&quot;);</span>
<a href="#l11.895"></a><span id="l11.895">     event.initCustomEvent(&quot;attachments-removed&quot;, true, true,</span>
<a href="#l11.896"></a><span id="l11.896">                           removedAttachments);</span>
<a href="#l11.897"></a><span id="l11.897">     bucket.dispatchEvent(event);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- /dev/null</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ b/mail/components/compose/content/bigFileObserver.js</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -0,0 +1,173 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineplus">+  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineplus">+Components.utils.import(&quot;resource:///modules/cloudFileAccounts.js&quot;);</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+var gBigFileObserver = {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  bigFiles: [],</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+  sessionHidden: false,</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+  get hidden() {</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+    return this.sessionHidden ||</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+           !Services.prefs.getBoolPref(&quot;mail.cloud_files.enabled&quot;) ||</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+           !Services.prefs.getBoolPref(&quot;mail.compose.big_attachments.notify&quot;);</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+  },</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+  hide: function(aPermanent) {</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+    if (aPermanent)</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+      Services.prefs.setBoolPref(&quot;mail.compose.big_attachments.notify&quot;, false);</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+    else</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+      this.sessionHidden = true;</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+  },</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineplus">+</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+  init: function() {</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+    let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+    bucket.addEventListener(&quot;attachments-added&quot;, this, false);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+    bucket.addEventListener(&quot;attachments-removed&quot;, this, false);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+    bucket.addEventListener(&quot;attachment-renamed&quot;, this, false);</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+    this.sessionHidden = false;</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+    this.bigFiles = [];</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+  },</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+  uninit: function() {</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+    let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+    bucket.removeEventListener(&quot;attachments-added&quot;, this, false);</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+    bucket.removeEventListener(&quot;attachments-removed&quot;, this, false);</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+    bucket.removeEventListener(&quot;attachment-renamed&quot;, this, false);</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+  },</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+  handleEvent: function(event) {</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineplus">+    if (this.hidden)</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+      return;</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+    const callbacks = {</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+      &quot;attachments-added&quot;: this.attachmentAdded,</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+      &quot;attachments-removed&quot;: this.attachmentRemoved,</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+      &quot;attachments-converted&quot;: this.attachmentConverted,</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+    };</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+    for (let attachment in fixIterator(</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+         event.detail, Components.interfaces.nsIMsgAttachment)) {</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+      callbacks[event.type].call(this, attachment);</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+    }</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+    this.updateNotification();</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+  },</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+  formatString: function (key, replacements, plural) {</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+    let str = getComposeBundle().getString(key);</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineplus">+    if (plural !== undefined)</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+      str = PluralForm.get(plural, str);</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineplus">+    if (replacements !== undefined) {</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+      for (let i = 0; i &lt; replacements.length; i++)</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+        str = str.replace(&quot;#&quot; + (i+1), replacements[i]);</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+    }</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+    return str;</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+  },</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+  attachmentAdded: function(aAttachment) {</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineplus">+    let threshold = Services.prefs.getIntPref(</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineplus">+                    &quot;mail.compose.big_attachments.threshold_kb&quot;) * 1024;</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineplus">+</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineplus">+    if (aAttachment.size &gt;= threshold &amp;&amp; !aAttachment.sendViaCloud)</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineplus">+      this.bigFiles.push(aAttachment);</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineplus">+  },</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineplus">+</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineplus">+  attachmentRemoved: function(aAttachment) {</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineplus">+    let index = this.bigFiles.indexOf(aAttachment);</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineplus">+    if (index != -1)</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineplus">+      this.bigFiles.splice(index, 1);</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineplus">+  },</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineplus">+</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineplus">+  attachmentConverted: function(aAttachment) {</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineplus">+    if (aAttachment.sendViaCloud)</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+      this.attachmentRemoved(aAttachment);</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineplus">+    else</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineplus">+      this.attachmentAdded(aAttachment);</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineplus">+  },</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineplus">+</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineplus">+  updateNotification: function() {</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineplus">+    let nb = document.getElementById(&quot;attachmentNotificationBox&quot;);</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineplus">+    let notification = nb.getNotificationWithValue(&quot;bigAttachment&quot;);</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineplus">+    let numAccounts = cloudFileAccounts.accounts.length;</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineplus">+</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineplus">+    if (this.bigFiles.length) {</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineplus">+      if (notification) {</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineplus">+        notification.label = this.formatString(&quot;bigFileDescription&quot;,</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineplus">+                                               [this.bigFiles.length],</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineplus">+                                               this.bigFiles.length);</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineplus">+        return;</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineplus">+      }</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineplus">+</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineplus">+      let buttons = [</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineplus">+        { label: this.formatString(&quot;bigFileShare.label&quot;,</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineplus">+                                   []),</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineplus">+          accessKey: this.formatString(&quot;bigFileShare.accesskey&quot;),</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineplus">+          callback: this.convertAttachments.bind(this),</span>
<a href="#l12.112"></a><span id="l12.112" class="difflineplus">+        },</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineplus">+</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineplus">+        { label: this.formatString(&quot;bigFileAttach.label&quot;,</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineplus">+                                   []),</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineplus">+          accessKey: this.formatString(&quot;bigFileAttach.accesskey&quot;),</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineplus">+          callback: this.hideNotification.bind(this),</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineplus">+        },</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineplus">+      ];</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineplus">+</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineplus">+      nb.appendNotification(this.formatString(&quot;bigFileDescription&quot;,</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineplus">+                                              [this.bigFiles.length],</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineplus">+                                              this.bigFiles.length),</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineplus">+                            &quot;bigAttachment&quot;, &quot;null&quot;, nb.PRIORITY_WARNING_MEDIUM,</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineplus">+                            buttons);</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineplus">+    }</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineplus">+    else {</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineplus">+      if (notification)</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineplus">+        nb.removeNotification(notification);</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineplus">+    }</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineplus">+  },</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineplus">+</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineplus">+  convertAttachments: function() {</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineplus">+    let cloudProvider;</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineplus">+    let accounts = cloudFileAccounts.accounts;</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineplus">+</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineplus">+    if(accounts.length == 1) {</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineplus">+      cloudProvider = accounts[0];</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineplus">+    }</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineplus">+    else if(accounts.length &gt; 1) {</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineplus">+      let selection = {};</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineplus">+      let names = [cloudFileAccounts.getDisplayName(i) for each (i in accounts)];</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineplus">+      if (Services.prompt.select(window,</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineplus">+                                 this.formatString(&quot;bigFileChooseAccount.title&quot;),</span>
<a href="#l12.145"></a><span id="l12.145" class="difflineplus">+                                 this.formatString(&quot;bigFileChooseAccount.text&quot;),</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineplus">+                                 names.length, names, selection))</span>
<a href="#l12.147"></a><span id="l12.147" class="difflineplus">+        cloudProvider = accounts[selection.value];</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineplus">+    }</span>
<a href="#l12.149"></a><span id="l12.149" class="difflineplus">+    else {</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineplus">+      let accountKey = cloudFileAccounts.addAccountDialog();</span>
<a href="#l12.151"></a><span id="l12.151" class="difflineplus">+      if (accountKey)</span>
<a href="#l12.152"></a><span id="l12.152" class="difflineplus">+        cloudProvider = cloudFileAccounts.getAccount(accountKey);</span>
<a href="#l12.153"></a><span id="l12.153" class="difflineplus">+      else</span>
<a href="#l12.154"></a><span id="l12.154" class="difflineplus">+        return true;</span>
<a href="#l12.155"></a><span id="l12.155" class="difflineplus">+    }</span>
<a href="#l12.156"></a><span id="l12.156" class="difflineplus">+</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineplus">+    if (cloudProvider)</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineplus">+      convertToCloudAttachment(this.bigFiles, cloudProvider);</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineplus">+  },</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineplus">+</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineplus">+  hideNotification: function() {</span>
<a href="#l12.162"></a><span id="l12.162" class="difflineplus">+    let never = {};</span>
<a href="#l12.163"></a><span id="l12.163" class="difflineplus">+    if (Services.prompt.confirmCheck(window,</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineplus">+                                     this.formatString(&quot;bigFileHideNotification.title&quot;),</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineplus">+                                     this.formatString(&quot;bigFileHideNotification.text&quot;),</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineplus">+                                     this.formatString(&quot;bigFileHideNotification.check&quot;),</span>
<a href="#l12.167"></a><span id="l12.167" class="difflineplus">+                                     never))</span>
<a href="#l12.168"></a><span id="l12.168" class="difflineplus">+      this.hide(never.value);</span>
<a href="#l12.169"></a><span id="l12.169" class="difflineplus">+    else</span>
<a href="#l12.170"></a><span id="l12.170" class="difflineplus">+      return true;</span>
<a href="#l12.171"></a><span id="l12.171" class="difflineplus">+  },</span>
<a href="#l12.172"></a><span id="l12.172" class="difflineplus">+};</span>
<a href="#l12.173"></a><span id="l12.173" class="difflineplus">+</span>
<a href="#l12.174"></a><span id="l12.174" class="difflineplus">+document.documentElement.addEventListener(&quot;compose-window-init&quot;,</span>
<a href="#l12.175"></a><span id="l12.175" class="difflineplus">+  gBigFileObserver.init.bind(gBigFileObserver), false);</span>
<a href="#l12.176"></a><span id="l12.176" class="difflineplus">+document.documentElement.addEventListener(&quot;compose-window-close&quot;,</span>
<a href="#l12.177"></a><span id="l12.177" class="difflineplus">+  gBigFileObserver.uninit.bind(gBigFileObserver), false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- /dev/null</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ b/mail/components/compose/content/cloudAttachmentLinkManager.js</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -0,0 +1,387 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineplus">+</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineplus">+var gCloudAttachmentLinkManager = {</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+  init: function() {</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+    this.cloudAttachments = [];</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+    bucket.addEventListener(&quot;attachment-uploaded&quot;, this, false);</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+    bucket.addEventListener(&quot;attachments-removed&quot;, this, false);</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+    bucket.addEventListener(&quot;attachments-converted&quot;, this, false);</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+    // If we're restoring a draft that has some attachments,</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+    // check to see if any of them are marked to be sent via</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+    // cloud, and if so, add them to our list.</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+    for (let i = 0; i &lt; bucket.getRowCount(); ++i) {</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+      let attachment = bucket.getItemAtIndex(i).attachment;</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+      if (attachment &amp;&amp; attachment.sendViaCloud)</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+        this.cloudAttachments.push(attachment);</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+    }</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+    gMsgCompose.RegisterStateListener(this);</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+  },</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+  uninit: function() {</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+    let bucket = document.getElementById(&quot;attachmentBucket&quot;);</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+    bucket.removeEventListener(&quot;attachment-uploaded&quot;, this, false);</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+    bucket.removeEventListener(&quot;attachments-removed&quot;, this, false);</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+    bucket.removeEventListener(&quot;attachments-converted&quot;, this, false);</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+    gMsgCompose.UnregisterStateListener(this);</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+  },</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+  NotifyComposeFieldsReady: function() {},</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+  NotifyComposeBodyReady: function() {</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+    // If we're doing an inline-forward in plain-text mode, let's</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+    // take all of the current message text, and wrap it up into</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+    // its own DIV.</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+    if (gComposeType != Components.interfaces.nsIMsgCompType.ForwardInline ||</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+        gMsgCompose.composeHTML)</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineplus">+      return;</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineplus">+    let mailDoc = document.getElementById(&quot;content-frame&quot;).contentDocument;</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+    let mailBody = mailDoc.getElementsByTagName(&quot;body&quot;)[0];</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+    let editor = GetCurrentEditor();</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+    let childNodes = mailBody.childNodes;</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+    let container = editor.createElementWithDefaults(&quot;div&quot;);</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+    for (let i = 0; i &lt; childNodes.length; ++i) {</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+      let oldChild = childNodes[i];</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+      // It's strange, but for some reason, carriage-returns seem to be truncated</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+      // during the node transfer...so we put them back.</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+      if (oldChild.nodeType == Node.TEXT_NODE)</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+        oldChild.nodeValue += &quot;\r\n&quot;;</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+      let removedChild = oldChild.parentNode.removeChild(oldChild);</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+      container.appendChild(removedChild);</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+    }</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineplus">+</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+    editor.insertLineBreak();</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+    editor.insertElementAtSelection(container, false);</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+    editor.insertLineBreak();</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+  },</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+  ComposeProcessDone: function() {},</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+  SaveInFolderDone: function() {},</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+  handleEvent: function(event) {</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+    let mailDoc = document.getElementById(&quot;content-frame&quot;).contentDocument;</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineplus">+</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineplus">+    if (event.type == &quot;attachment-uploaded&quot;) {</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineplus">+      if (this.cloudAttachments.length == 0)</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineplus">+        this._insertHeader(mailDoc);</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineplus">+</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineplus">+      let attachment = event.target.attachment;</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineplus">+      let provider = event.target.cloudProvider;</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineplus">+      this.cloudAttachments.push(attachment);</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineplus">+      this._insertItem(mailDoc, attachment, provider);</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineplus">+    }</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineplus">+    else if (event.type == &quot;attachments-removed&quot; ||</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineplus">+             event.type == &quot;attachments-converted&quot;) {</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineplus">+      let list = mailDoc.getElementById(&quot;cloudAttachmentList&quot;);</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineplus">+      let items = list.getElementsByClassName(&quot;cloudAttachmentItem&quot;);</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineplus">+</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineplus">+      for (let attachment in fixIterator(</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineplus">+           event.detail, Components.interfaces.nsIMsgAttachment)) {</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineplus">+        // Remove the attachment from the message body.</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineplus">+        for (let i = 0; i &lt; items.length; i++) {</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+          // if the attachment was removed, or was converted and is no</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineplus">+          // longer to be sent via cloud, remove from html node.</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineplus">+          if ((event.type == &quot;attachments-removed&quot; || !attachment.sendViaCloud) &amp;&amp;</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineplus">+              items[i].contentLocation == attachment.contentLocation)</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineplus">+            list.removeChild(items[i]);</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineplus">+        }</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineplus">+</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+        // Now, remove the attachment from our internal list.</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineplus">+        let index = this.cloudAttachments.indexOf(attachment);</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineplus">+        if (index != -1)</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineplus">+          this.cloudAttachments.splice(index, 1);</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineplus">+      }</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineplus">+</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineplus">+      this._updateAttachmentCount(mailDoc);</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineplus">+</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineplus">+      if (items.length == 0) {</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineplus">+        list.parentNode.removeChild(list);</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineplus">+        this._removeRoot(mailDoc);</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineplus">+      }</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineplus">+    }</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineplus">+  },</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineplus">+</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineplus">+  /**</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineplus">+   * Removes the root node for an attachment list in an HTML email.</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineplus">+   *</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineplus">+   * @param aDocument the document to remove the root node from.</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineplus">+   */</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineplus">+  _removeRoot: function(aDocument) {</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineplus">+    let header = aDocument.getElementById(&quot;cloudAttachmentListRoot&quot;);</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineplus">+    if (header)</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineplus">+      header.parentNode.removeChild(header);</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineplus">+  },</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineplus">+</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineplus">+  /**</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineplus">+   * Given some node, returns the textual HTML representation for the node</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineplus">+   * and its children.</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineplus">+   *</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineplus">+   * @param aDocument the document that the node is embedded in</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineplus">+   * @param aNode the node to get the textual representation from</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineplus">+   */</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineplus">+  _getHTMLRepresentation: function(aDocument, aNode) {</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineplus">+    let tmp = aDocument.createElement(&quot;p&quot;);</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineplus">+    tmp.appendChild(aNode);</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineplus">+    return tmp.innerHTML;</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineplus">+  },</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineplus">+</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineplus">+  /**</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineplus">+   * Generates an appropriately styled link.</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineplus">+   *</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineplus">+   * @param aDocument the document to append the link to - doesn't actually</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineplus">+   *                  get appended, but is used to generate the anchor node.</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineplus">+   * @param aContent the textual content of the link</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineplus">+   * @param aHref the HREF attribute for the generated link</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineplus">+   */</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineplus">+  _generateLink: function(aDocument, aContent, aHref) {</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineplus">+    const LINK_COLOR = &quot;#0F7EDB&quot;;</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineplus">+    let link = aDocument.createElement(&quot;a&quot;);</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineplus">+    link.href = aHref;</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineplus">+    link.textContent = aContent;</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineplus">+    link.style.cssText = &quot;color: &quot; + LINK_COLOR + &quot; !important&quot;;</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineplus">+    return link;</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineplus">+  },</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineplus">+</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineplus">+  /**</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineplus">+   * Insert the header for the cloud attachment list, which we'll use to</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineplus">+   * as an insertion point for the individual cloud attachments.</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineplus">+   *</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineplus">+   * @param aDocument the document to insert the header into</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineplus">+   */</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineplus">+  _insertHeader: function(aDocument) {</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineplus">+    let brandBundle = Services.strings.createBundle(&quot;chrome://branding/locale/brand.properties&quot;);</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineplus">+    let mailBody = aDocument.getElementsByTagName(&quot;body&quot;)[0];</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineplus">+    let editor = GetCurrentEditor();</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineplus">+    let selection = editor.selection;</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineplus">+</span>
<a href="#l13.170"></a><span id="l13.170" class="difflineplus">+    // Save off the selection ranges so we can restore them later.</span>
<a href="#l13.171"></a><span id="l13.171" class="difflineplus">+    let ranges = [];</span>
<a href="#l13.172"></a><span id="l13.172" class="difflineplus">+    for (let i = 0; i &lt; selection.rangeCount; i++)</span>
<a href="#l13.173"></a><span id="l13.173" class="difflineplus">+      ranges.push(selection.getRangeAt(i));</span>
<a href="#l13.174"></a><span id="l13.174" class="difflineplus">+</span>
<a href="#l13.175"></a><span id="l13.175" class="difflineplus">+    // Find the last text node that's a first level child of the body.</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineplus">+    // This will skip quoted text.</span>
<a href="#l13.177"></a><span id="l13.177" class="difflineplus">+    let childNodes = mailBody.childNodes;</span>
<a href="#l13.178"></a><span id="l13.178" class="difflineplus">+    // If we don't find any text nodes, we'll insert at the start of the</span>
<a href="#l13.179"></a><span id="l13.179" class="difflineplus">+    // body, which may not be quite right.</span>
<a href="#l13.180"></a><span id="l13.180" class="difflineplus">+    let childToInsertAfter = childNodes[0];</span>
<a href="#l13.181"></a><span id="l13.181" class="difflineplus">+    for (let i = childNodes.length - 1; i &gt;= 0; i--) {</span>
<a href="#l13.182"></a><span id="l13.182" class="difflineplus">+      if (childNodes[i].nodeType == Node.TEXT_NODE &amp;&amp;</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineplus">+          childNodes[i].nodeValue &amp;&amp; childNodes[i].nodeValue.length &gt; 0) {</span>
<a href="#l13.184"></a><span id="l13.184" class="difflineplus">+        childToInsertAfter = childNodes[i];</span>
<a href="#l13.185"></a><span id="l13.185" class="difflineplus">+        break;</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineplus">+      }</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineplus">+    }</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineplus">+</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineplus">+    selection.collapse(childToInsertAfter,</span>
<a href="#l13.190"></a><span id="l13.190" class="difflineplus">+                       childToInsertAfter.nodeValue ?</span>
<a href="#l13.191"></a><span id="l13.191" class="difflineplus">+                       childToInsertAfter.nodeValue.length : 0);</span>
<a href="#l13.192"></a><span id="l13.192" class="difflineplus">+</span>
<a href="#l13.193"></a><span id="l13.193" class="difflineplus">+</span>
<a href="#l13.194"></a><span id="l13.194" class="difflineplus">+    if (gMsgCompose.composeHTML) {</span>
<a href="#l13.195"></a><span id="l13.195" class="difflineplus">+      // It's really quite strange, but if we don't set</span>
<a href="#l13.196"></a><span id="l13.196" class="difflineplus">+      // the innerHTML of each element to be non-empty, then</span>
<a href="#l13.197"></a><span id="l13.197" class="difflineplus">+      // the nodes fail to be added to the compose window.</span>
<a href="#l13.198"></a><span id="l13.198" class="difflineplus">+      let root = editor.createElementWithDefaults(&quot;div&quot;);</span>
<a href="#l13.199"></a><span id="l13.199" class="difflineplus">+      root.id = &quot;cloudAttachmentListRoot&quot;;</span>
<a href="#l13.200"></a><span id="l13.200" class="difflineplus">+      root.style.padding = &quot;15px&quot;;</span>
<a href="#l13.201"></a><span id="l13.201" class="difflineplus">+      root.style.backgroundColor = &quot;#D9EDFF&quot;;</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineplus">+      root.innerHTML = &quot; &quot;;</span>
<a href="#l13.203"></a><span id="l13.203" class="difflineplus">+</span>
<a href="#l13.204"></a><span id="l13.204" class="difflineplus">+      let header = editor.createElementWithDefaults(&quot;div&quot;);</span>
<a href="#l13.205"></a><span id="l13.205" class="difflineplus">+      header.id = &quot;cloudAttachmentListHeader&quot;;</span>
<a href="#l13.206"></a><span id="l13.206" class="difflineplus">+      header.style.marginBottom = &quot;15px&quot;;</span>
<a href="#l13.207"></a><span id="l13.207" class="difflineplus">+      header.innerHTML = &quot; &quot;;</span>
<a href="#l13.208"></a><span id="l13.208" class="difflineplus">+      root.appendChild(header);</span>
<a href="#l13.209"></a><span id="l13.209" class="difflineplus">+</span>
<a href="#l13.210"></a><span id="l13.210" class="difflineplus">+      let list = editor.createElementWithDefaults(&quot;div&quot;);</span>
<a href="#l13.211"></a><span id="l13.211" class="difflineplus">+      list.id = &quot;cloudAttachmentList&quot;;</span>
<a href="#l13.212"></a><span id="l13.212" class="difflineplus">+      list.style.backgroundColor = &quot;#FFFFFF&quot;;</span>
<a href="#l13.213"></a><span id="l13.213" class="difflineplus">+      list.style.padding = &quot;15px&quot;;</span>
<a href="#l13.214"></a><span id="l13.214" class="difflineplus">+      list.display = &quot;inline-block&quot;;</span>
<a href="#l13.215"></a><span id="l13.215" class="difflineplus">+      list.innerHTML = &quot; &quot;;</span>
<a href="#l13.216"></a><span id="l13.216" class="difflineplus">+      root.appendChild(list);</span>
<a href="#l13.217"></a><span id="l13.217" class="difflineplus">+</span>
<a href="#l13.218"></a><span id="l13.218" class="difflineplus">+      let footer = editor.createElementWithDefaults(&quot;div&quot;);</span>
<a href="#l13.219"></a><span id="l13.219" class="difflineplus">+      let appLinkUrl = Services.prefs</span>
<a href="#l13.220"></a><span id="l13.220" class="difflineplus">+                               .getCharPref(&quot;mail.cloud_files.inserted_urls.footer.link&quot;);</span>
<a href="#l13.221"></a><span id="l13.221" class="difflineplus">+      let appname = this._generateLink(aDocument,</span>
<a href="#l13.222"></a><span id="l13.222" class="difflineplus">+                                       brandBundle.GetStringFromName(&quot;brandFullName&quot;),</span>
<a href="#l13.223"></a><span id="l13.223" class="difflineplus">+                                       appLinkUrl);</span>
<a href="#l13.224"></a><span id="l13.224" class="difflineplus">+</span>
<a href="#l13.225"></a><span id="l13.225" class="difflineplus">+      let applink = this._getHTMLRepresentation(aDocument, appname);</span>
<a href="#l13.226"></a><span id="l13.226" class="difflineplus">+      let footerMessage = getComposeBundle().getFormattedString(&quot;cloudAttachmentListFooter&quot;, [applink], 1);</span>
<a href="#l13.227"></a><span id="l13.227" class="difflineplus">+</span>
<a href="#l13.228"></a><span id="l13.228" class="difflineplus">+      footer.innerHTML = footerMessage;</span>
<a href="#l13.229"></a><span id="l13.229" class="difflineplus">+      footer.style.color = &quot;#444444&quot;;</span>
<a href="#l13.230"></a><span id="l13.230" class="difflineplus">+      footer.style.fontSize = &quot;small&quot;;</span>
<a href="#l13.231"></a><span id="l13.231" class="difflineplus">+      footer.style.marginTop = &quot;15px&quot;;</span>
<a href="#l13.232"></a><span id="l13.232" class="difflineplus">+      root.appendChild(footer);</span>
<a href="#l13.233"></a><span id="l13.233" class="difflineplus">+</span>
<a href="#l13.234"></a><span id="l13.234" class="difflineplus">+      editor.insertLineBreak();</span>
<a href="#l13.235"></a><span id="l13.235" class="difflineplus">+      editor.insertElementAtSelection(root, false);</span>
<a href="#l13.236"></a><span id="l13.236" class="difflineplus">+      editor.insertLineBreak();</span>
<a href="#l13.237"></a><span id="l13.237" class="difflineplus">+    }</span>
<a href="#l13.238"></a><span id="l13.238" class="difflineplus">+    else {</span>
<a href="#l13.239"></a><span id="l13.239" class="difflineplus">+      let header = editor.createElementWithDefaults(&quot;div&quot;);</span>
<a href="#l13.240"></a><span id="l13.240" class="difflineplus">+      header.id = &quot;cloudAttachmentListHeader&quot;;</span>
<a href="#l13.241"></a><span id="l13.241" class="difflineplus">+      header.innerHTML = &quot; &quot;;</span>
<a href="#l13.242"></a><span id="l13.242" class="difflineplus">+      let list = editor.createElementWithDefaults(&quot;span&quot;);</span>
<a href="#l13.243"></a><span id="l13.243" class="difflineplus">+      list.id = &quot;cloudAttachmentList&quot;;</span>
<a href="#l13.244"></a><span id="l13.244" class="difflineplus">+      list.innerHTML = &quot; &quot;;</span>
<a href="#l13.245"></a><span id="l13.245" class="difflineplus">+</span>
<a href="#l13.246"></a><span id="l13.246" class="difflineplus">+      editor.insertLineBreak();</span>
<a href="#l13.247"></a><span id="l13.247" class="difflineplus">+      editor.insertElementAtSelection(header, false);</span>
<a href="#l13.248"></a><span id="l13.248" class="difflineplus">+      editor.insertElementAtSelection(list, false);</span>
<a href="#l13.249"></a><span id="l13.249" class="difflineplus">+      editor.insertLineBreak();</span>
<a href="#l13.250"></a><span id="l13.250" class="difflineplus">+    }</span>
<a href="#l13.251"></a><span id="l13.251" class="difflineplus">+</span>
<a href="#l13.252"></a><span id="l13.252" class="difflineplus">+    // Restore the selection ranges.</span>
<a href="#l13.253"></a><span id="l13.253" class="difflineplus">+    for (let [,range] in Iterator(ranges))</span>
<a href="#l13.254"></a><span id="l13.254" class="difflineplus">+      selection.addRange(range);</span>
<a href="#l13.255"></a><span id="l13.255" class="difflineplus">+</span>
<a href="#l13.256"></a><span id="l13.256" class="difflineplus">+  },</span>
<a href="#l13.257"></a><span id="l13.257" class="difflineplus">+</span>
<a href="#l13.258"></a><span id="l13.258" class="difflineplus">+  /**</span>
<a href="#l13.259"></a><span id="l13.259" class="difflineplus">+   * Updates the count of how many attachments have been added</span>
<a href="#l13.260"></a><span id="l13.260" class="difflineplus">+   * in HTML emails.</span>
<a href="#l13.261"></a><span id="l13.261" class="difflineplus">+   *</span>
<a href="#l13.262"></a><span id="l13.262" class="difflineplus">+   * @aDocument the document that contains the cloudAttachmentListHeader node.</span>
<a href="#l13.263"></a><span id="l13.263" class="difflineplus">+   */</span>
<a href="#l13.264"></a><span id="l13.264" class="difflineplus">+  _updateAttachmentCount: function(aDocument) {</span>
<a href="#l13.265"></a><span id="l13.265" class="difflineplus">+    let header = aDocument.getElementById(&quot;cloudAttachmentListHeader&quot;);</span>
<a href="#l13.266"></a><span id="l13.266" class="difflineplus">+    if (!header)</span>
<a href="#l13.267"></a><span id="l13.267" class="difflineplus">+      return;</span>
<a href="#l13.268"></a><span id="l13.268" class="difflineplus">+</span>
<a href="#l13.269"></a><span id="l13.269" class="difflineplus">+    let count = PluralForm.get(this.cloudAttachments.length,</span>
<a href="#l13.270"></a><span id="l13.270" class="difflineplus">+                               getComposeBundle().getString(&quot;cloudAttachmentCountHeader&quot;));</span>
<a href="#l13.271"></a><span id="l13.271" class="difflineplus">+</span>
<a href="#l13.272"></a><span id="l13.272" class="difflineplus">+    header.textContent = count.replace(&quot;#1&quot;, this.cloudAttachments.length);</span>
<a href="#l13.273"></a><span id="l13.273" class="difflineplus">+  },</span>
<a href="#l13.274"></a><span id="l13.274" class="difflineplus">+</span>
<a href="#l13.275"></a><span id="l13.275" class="difflineplus">+  /**</span>
<a href="#l13.276"></a><span id="l13.276" class="difflineplus">+   * Insert the information for a cloud attachment.</span>
<a href="#l13.277"></a><span id="l13.277" class="difflineplus">+   *</span>
<a href="#l13.278"></a><span id="l13.278" class="difflineplus">+   * @param aDocument the document to insert the item into</span>
<a href="#l13.279"></a><span id="l13.279" class="difflineplus">+   * @param aAttachment the nsIMsgAttachment to insert</span>
<a href="#l13.280"></a><span id="l13.280" class="difflineplus">+   * @param aProviderType the cloud storage provider</span>
<a href="#l13.281"></a><span id="l13.281" class="difflineplus">+   */</span>
<a href="#l13.282"></a><span id="l13.282" class="difflineplus">+  _insertItem: function(aDocument, aAttachment, aProvider) {</span>
<a href="#l13.283"></a><span id="l13.283" class="difflineplus">+    let list = aDocument.getElementById(&quot;cloudAttachmentList&quot;);</span>
<a href="#l13.284"></a><span id="l13.284" class="difflineplus">+    let node = aDocument.createElement(&quot;div&quot;);</span>
<a href="#l13.285"></a><span id="l13.285" class="difflineplus">+    node.className = &quot;cloudAttachmentItem&quot;;</span>
<a href="#l13.286"></a><span id="l13.286" class="difflineplus">+    node.contentLocation = aAttachment.contentLocation;</span>
<a href="#l13.287"></a><span id="l13.287" class="difflineplus">+</span>
<a href="#l13.288"></a><span id="l13.288" class="difflineplus">+    if (gMsgCompose.composeHTML) {</span>
<a href="#l13.289"></a><span id="l13.289" class="difflineplus">+      node.style.border = &quot;1px solid #CDCDCD&quot;;</span>
<a href="#l13.290"></a><span id="l13.290" class="difflineplus">+      node.style.borderRadius = &quot;5px&quot;;</span>
<a href="#l13.291"></a><span id="l13.291" class="difflineplus">+      node.style.marginTop = &quot;10px&quot;;</span>
<a href="#l13.292"></a><span id="l13.292" class="difflineplus">+      node.style.marginBottom = &quot;10px&quot;;</span>
<a href="#l13.293"></a><span id="l13.293" class="difflineplus">+      node.style.padding = &quot;15px&quot;;</span>
<a href="#l13.294"></a><span id="l13.294" class="difflineplus">+</span>
<a href="#l13.295"></a><span id="l13.295" class="difflineplus">+      let paperclip = aDocument.createElement(&quot;img&quot;);</span>
<a href="#l13.296"></a><span id="l13.296" class="difflineplus">+      paperclip.style.marginRight = &quot;5px&quot;;</span>
<a href="#l13.297"></a><span id="l13.297" class="difflineplus">+      paperclip.style.cssFloat = &quot;left&quot;;</span>
<a href="#l13.298"></a><span id="l13.298" class="difflineplus">+      paperclip.style.width = &quot;24px&quot;;</span>
<a href="#l13.299"></a><span id="l13.299" class="difflineplus">+      paperclip.style.height = &quot;24px&quot;;</span>
<a href="#l13.300"></a><span id="l13.300" class="difflineplus">+      paperclip.src = &quot;chrome://messenger/content/cloudfile/attachment-24.png&quot;;</span>
<a href="#l13.301"></a><span id="l13.301" class="difflineplus">+      node.appendChild(paperclip);</span>
<a href="#l13.302"></a><span id="l13.302" class="difflineplus">+</span>
<a href="#l13.303"></a><span id="l13.303" class="difflineplus">+      let link = this._generateLink(aDocument, aAttachment.name,</span>
<a href="#l13.304"></a><span id="l13.304" class="difflineplus">+                                    aAttachment.contentLocation);</span>
<a href="#l13.305"></a><span id="l13.305" class="difflineplus">+      link.setAttribute(&quot;moz-do-not-send&quot;, &quot;true&quot;);</span>
<a href="#l13.306"></a><span id="l13.306" class="difflineplus">+      node.appendChild(link);</span>
<a href="#l13.307"></a><span id="l13.307" class="difflineplus">+</span>
<a href="#l13.308"></a><span id="l13.308" class="difflineplus">+      let size = aDocument.createElement(&quot;span&quot;);</span>
<a href="#l13.309"></a><span id="l13.309" class="difflineplus">+      size.textContent = &quot;(&quot; + gMessenger.formatFileSize(aAttachment.size)</span>
<a href="#l13.310"></a><span id="l13.310" class="difflineplus">+                         + &quot;)&quot;;</span>
<a href="#l13.311"></a><span id="l13.311" class="difflineplus">+      size.style.marginLeft = &quot;5px&quot;;</span>
<a href="#l13.312"></a><span id="l13.312" class="difflineplus">+      size.style.fontSize = &quot;small&quot;;</span>
<a href="#l13.313"></a><span id="l13.313" class="difflineplus">+      size.style.color = &quot;grey&quot;;</span>
<a href="#l13.314"></a><span id="l13.314" class="difflineplus">+      node.appendChild(size);</span>
<a href="#l13.315"></a><span id="l13.315" class="difflineplus">+</span>
<a href="#l13.316"></a><span id="l13.316" class="difflineplus">+      let providerIdentity = aDocument.createElement(&quot;span&quot;);</span>
<a href="#l13.317"></a><span id="l13.317" class="difflineplus">+      providerIdentity.style.cssFloat = &quot;right&quot;;</span>
<a href="#l13.318"></a><span id="l13.318" class="difflineplus">+</span>
<a href="#l13.319"></a><span id="l13.319" class="difflineplus">+      if (aProvider.iconClass) {</span>
<a href="#l13.320"></a><span id="l13.320" class="difflineplus">+        let providerIcon = aDocument.createElement(&quot;img&quot;);</span>
<a href="#l13.321"></a><span id="l13.321" class="difflineplus">+        providerIcon.src = aProvider.iconClass;</span>
<a href="#l13.322"></a><span id="l13.322" class="difflineplus">+        providerIcon.style.marginRight = &quot;5px&quot;;</span>
<a href="#l13.323"></a><span id="l13.323" class="difflineplus">+        providerIdentity.appendChild(providerIcon);</span>
<a href="#l13.324"></a><span id="l13.324" class="difflineplus">+      }</span>
<a href="#l13.325"></a><span id="l13.325" class="difflineplus">+</span>
<a href="#l13.326"></a><span id="l13.326" class="difflineplus">+      if (aProvider.serviceURL) {</span>
<a href="#l13.327"></a><span id="l13.327" class="difflineplus">+        let providerLink = this._generateLink(aDocument, aProvider.displayName,</span>
<a href="#l13.328"></a><span id="l13.328" class="difflineplus">+                                              aProvider.serviceURL);</span>
<a href="#l13.329"></a><span id="l13.329" class="difflineplus">+        providerIdentity.appendChild(providerLink);</span>
<a href="#l13.330"></a><span id="l13.330" class="difflineplus">+      } else {</span>
<a href="#l13.331"></a><span id="l13.331" class="difflineplus">+        let providerName = aDocument.createElement(&quot;span&quot;);</span>
<a href="#l13.332"></a><span id="l13.332" class="difflineplus">+        providerName.textContent = aProvider.displayName;</span>
<a href="#l13.333"></a><span id="l13.333" class="difflineplus">+        providerIdentity.appendChild(providerName);</span>
<a href="#l13.334"></a><span id="l13.334" class="difflineplus">+      }</span>
<a href="#l13.335"></a><span id="l13.335" class="difflineplus">+</span>
<a href="#l13.336"></a><span id="l13.336" class="difflineplus">+      node.appendChild(providerIdentity);</span>
<a href="#l13.337"></a><span id="l13.337" class="difflineplus">+</span>
<a href="#l13.338"></a><span id="l13.338" class="difflineplus">+      let downloadUrl = this._generateLink(aDocument,</span>
<a href="#l13.339"></a><span id="l13.339" class="difflineplus">+                                           aAttachment.contentLocation,</span>
<a href="#l13.340"></a><span id="l13.340" class="difflineplus">+                                           aAttachment.contentLocation);</span>
<a href="#l13.341"></a><span id="l13.341" class="difflineplus">+      downloadUrl.style.fontSize = &quot;small&quot;;</span>
<a href="#l13.342"></a><span id="l13.342" class="difflineplus">+      downloadUrl.style.display = &quot;block&quot;;</span>
<a href="#l13.343"></a><span id="l13.343" class="difflineplus">+</span>
<a href="#l13.344"></a><span id="l13.344" class="difflineplus">+      node.appendChild(downloadUrl);</span>
<a href="#l13.345"></a><span id="l13.345" class="difflineplus">+    }</span>
<a href="#l13.346"></a><span id="l13.346" class="difflineplus">+    else {</span>
<a href="#l13.347"></a><span id="l13.347" class="difflineplus">+      node.textContent = getComposeBundle().getFormattedString(</span>
<a href="#l13.348"></a><span id="l13.348" class="difflineplus">+        &quot;cloudAttachmentListItem&quot;,</span>
<a href="#l13.349"></a><span id="l13.349" class="difflineplus">+        [aAttachment.name, gMessenger.formatFileSize(aAttachment.size),</span>
<a href="#l13.350"></a><span id="l13.350" class="difflineplus">+         aProvider.displayName,</span>
<a href="#l13.351"></a><span id="l13.351" class="difflineplus">+         aAttachment.contentLocation]);</span>
<a href="#l13.352"></a><span id="l13.352" class="difflineplus">+    }</span>
<a href="#l13.353"></a><span id="l13.353" class="difflineplus">+</span>
<a href="#l13.354"></a><span id="l13.354" class="difflineplus">+    this._updateAttachmentCount(aDocument);</span>
<a href="#l13.355"></a><span id="l13.355" class="difflineplus">+    list.appendChild(node);</span>
<a href="#l13.356"></a><span id="l13.356" class="difflineplus">+  },</span>
<a href="#l13.357"></a><span id="l13.357" class="difflineplus">+</span>
<a href="#l13.358"></a><span id="l13.358" class="difflineplus">+  /**</span>
<a href="#l13.359"></a><span id="l13.359" class="difflineplus">+   * Event handler for when mail is sent.  For mail that is being sent</span>
<a href="#l13.360"></a><span id="l13.360" class="difflineplus">+   * (and not saved!), find any cloudAttachmentList* nodes that we've created,</span>
<a href="#l13.361"></a><span id="l13.361" class="difflineplus">+   * and strip their IDs out.  That way, if the receiving user replies by</span>
<a href="#l13.362"></a><span id="l13.362" class="difflineplus">+   * sending some BigFiles, we don't run into ID conflicts.</span>
<a href="#l13.363"></a><span id="l13.363" class="difflineplus">+   */</span>
<a href="#l13.364"></a><span id="l13.364" class="difflineplus">+  send: function(aEvent) {</span>
<a href="#l13.365"></a><span id="l13.365" class="difflineplus">+    const Ci = Components.interfaces;</span>
<a href="#l13.366"></a><span id="l13.366" class="difflineplus">+</span>
<a href="#l13.367"></a><span id="l13.367" class="difflineplus">+    let msgType = parseInt(aEvent.target.getAttribute(&quot;msgtype&quot;));</span>
<a href="#l13.368"></a><span id="l13.368" class="difflineplus">+</span>
<a href="#l13.369"></a><span id="l13.369" class="difflineplus">+    if (msgType == Ci.nsIMsgCompDeliverMode.Now ||</span>
<a href="#l13.370"></a><span id="l13.370" class="difflineplus">+        msgType == Ci.nsIMsgCompDeliverMode.Later ||</span>
<a href="#l13.371"></a><span id="l13.371" class="difflineplus">+        msgType == Ci.nsIMsgCompDeliverMode.Background) {</span>
<a href="#l13.372"></a><span id="l13.372" class="difflineplus">+</span>
<a href="#l13.373"></a><span id="l13.373" class="difflineplus">+      const kIDs = [&quot;cloudAttachmentList&quot;, &quot;cloudAttachmentListRoot&quot;,</span>
<a href="#l13.374"></a><span id="l13.374" class="difflineplus">+                    &quot;cloudAttachmentListHeader&quot;];</span>
<a href="#l13.375"></a><span id="l13.375" class="difflineplus">+      let mailDoc = document.getElementById(&quot;content-frame&quot;).contentDocument;</span>
<a href="#l13.376"></a><span id="l13.376" class="difflineplus">+</span>
<a href="#l13.377"></a><span id="l13.377" class="difflineplus">+      for each (let [, id] in Iterator(kIDs)) {</span>
<a href="#l13.378"></a><span id="l13.378" class="difflineplus">+        let element = mailDoc.getElementById(id);</span>
<a href="#l13.379"></a><span id="l13.379" class="difflineplus">+        if (element)</span>
<a href="#l13.380"></a><span id="l13.380" class="difflineplus">+          element.removeAttribute(&quot;id&quot;);</span>
<a href="#l13.381"></a><span id="l13.381" class="difflineplus">+      }</span>
<a href="#l13.382"></a><span id="l13.382" class="difflineplus">+    }</span>
<a href="#l13.383"></a><span id="l13.383" class="difflineplus">+  },</span>
<a href="#l13.384"></a><span id="l13.384" class="difflineplus">+};</span>
<a href="#l13.385"></a><span id="l13.385" class="difflineplus">+</span>
<a href="#l13.386"></a><span id="l13.386" class="difflineplus">+document.documentElement.addEventListener(&quot;compose-window-init&quot;,</span>
<a href="#l13.387"></a><span id="l13.387" class="difflineplus">+  gCloudAttachmentLinkManager.init.bind(gCloudAttachmentLinkManager), false);</span>
<a href="#l13.388"></a><span id="l13.388" class="difflineplus">+document.documentElement.addEventListener(&quot;compose-window-close&quot;,</span>
<a href="#l13.389"></a><span id="l13.389" class="difflineplus">+  gCloudAttachmentLinkManager.uninit.bind(gCloudAttachmentLinkManager), false);</span>
<a href="#l13.390"></a><span id="l13.390" class="difflineplus">+document.documentElement.addEventListener(&quot;compose-send-message&quot;,</span>
<a href="#l13.391"></a><span id="l13.391" class="difflineplus">+  gCloudAttachmentLinkManager.send.bind(gCloudAttachmentLinkManager), false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/compose/content/messengercompose.xul</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/compose/content/messengercompose.xul</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -83,18 +83,21 @@</span>
<a href="#l14.4"></a><span id="l14.4">   &lt;stringbundle id=&quot;languageBundle&quot;     src=&quot;chrome://global/locale/languageNames.properties&quot;/&gt;</span>
<a href="#l14.5"></a><span id="l14.5">   &lt;stringbundle id=&quot;brandBundle&quot;        src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l14.6"></a><span id="l14.6"> &lt;/stringbundleset&gt;</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/printUtils.js&quot;/&gt;</span>
<a href="#l14.9"></a><span id="l14.9"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/accountUtils.js&quot;/&gt;</span>
<a href="#l14.10"></a><span id="l14.10"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/widgetglue.js&quot;/&gt;</span>
<a href="#l14.11"></a><span id="l14.11"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/mailCore.js&quot;/&gt;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+&lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/contentAreaClick.js&quot;/&gt;</span>
<a href="#l14.13"></a><span id="l14.13"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://editor/content/editor.js&quot;/&gt;</span>
<a href="#l14.14"></a><span id="l14.14"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/messengercompose/MsgComposeCommands.js&quot;/&gt;</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+&lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/messengercompose/bigFileObserver.js&quot;/&gt;</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+&lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/messengercompose/cloudAttachmentLinkManager.js&quot;/&gt;</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18"> &lt;!-- drag and drop --&gt;</span>
<a href="#l14.19"></a><span id="l14.19"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/addressbook/abDragDrop.js&quot;/&gt;</span>
<a href="#l14.20"></a><span id="l14.20"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/nsDragAndDrop.js&quot;/&gt;</span>
<a href="#l14.21"></a><span id="l14.21"> </span>
<a href="#l14.22"></a><span id="l14.22"> &lt;!-- move needed functions into a single js file --&gt;</span>
<a href="#l14.23"></a><span id="l14.23"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/messengercompose/addressingWidgetOverlay.js&quot;/&gt;</span>
<a href="#l14.24"></a><span id="l14.24"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/charsetOverlay.js&quot;/&gt;</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineat">@@ -128,16 +131,17 @@</span>
<a href="#l14.26"></a><span id="l14.26">   &lt;commandset id=&quot;composerMenuItems&quot;/&gt;</span>
<a href="#l14.27"></a><span id="l14.27">   &lt;commandset id=&quot;composerEditMenuItems&quot;/&gt; </span>
<a href="#l14.28"></a><span id="l14.28">   &lt;commandset id=&quot;composerStyleMenuItems&quot;/&gt;</span>
<a href="#l14.29"></a><span id="l14.29">   &lt;commandset id=&quot;composerTableMenuItems&quot;/&gt;</span>
<a href="#l14.30"></a><span id="l14.30">   &lt;commandset id=&quot;composerListMenuItems&quot;/&gt;</span>
<a href="#l14.31"></a><span id="l14.31">   &lt;!-- File Menu --&gt;</span>
<a href="#l14.32"></a><span id="l14.32">   &lt;command id=&quot;cmd_new&quot; oncommand=&quot;goDoCommand('cmd_newMessage')&quot;/&gt;</span>
<a href="#l14.33"></a><span id="l14.33">   &lt;command id=&quot;cmd_attachFile&quot; oncommand=&quot;goDoCommand('cmd_attachFile')&quot;/&gt;</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+  &lt;command id=&quot;cmd_attachCloud&quot; oncommand=&quot;attachToCloud(event.target.cloudProvider); event.stopPropagation();&quot;/&gt;</span>
<a href="#l14.35"></a><span id="l14.35">   &lt;command id=&quot;cmd_attachPage&quot; oncommand=&quot;goDoCommand('cmd_attachPage')&quot;/&gt;</span>
<a href="#l14.36"></a><span id="l14.36">   &lt;command id=&quot;cmd_attachVCard&quot; checked=&quot;false&quot; oncommand=&quot;ToggleAttachVCard(event.target)&quot;/&gt;</span>
<a href="#l14.37"></a><span id="l14.37">   &lt;command id=&quot;cmd_close&quot; oncommand=&quot;goDoCommand('cmd_close')&quot;/&gt;</span>
<a href="#l14.38"></a><span id="l14.38">   &lt;command id=&quot;cmd_saveDefault&quot; oncommand=&quot;goDoCommand('cmd_saveDefault')&quot;/&gt;</span>
<a href="#l14.39"></a><span id="l14.39">   &lt;command id=&quot;cmd_saveAsFile&quot; oncommand=&quot;goDoCommand('cmd_saveAsFile')&quot;/&gt;</span>
<a href="#l14.40"></a><span id="l14.40">   &lt;command id=&quot;cmd_saveAsDraft&quot; oncommand=&quot;goDoCommand('cmd_saveAsDraft')&quot;/&gt;</span>
<a href="#l14.41"></a><span id="l14.41">   &lt;command id=&quot;cmd_saveAsTemplate&quot; oncommand=&quot;goDoCommand('cmd_saveAsTemplate')&quot;/&gt;</span>
<a href="#l14.42"></a><span id="l14.42">   &lt;command id=&quot;cmd_sendButton&quot; oncommand=&quot;goDoCommand('cmd_sendButton')&quot;/&gt;</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineat">@@ -175,16 +179,20 @@</span>
<a href="#l14.44"></a><span id="l14.44">   &lt;command id=&quot;minimizeWindow&quot; label=&quot;&amp;minimizeWindow.label;&quot; oncommand=&quot;window.minimize();&quot;/&gt;</span>
<a href="#l14.45"></a><span id="l14.45">   &lt;command id=&quot;zoomWindow&quot; label=&quot;&amp;zoomWindow.label;&quot; oncommand=&quot;zoomWindow();&quot;/&gt;</span>
<a href="#l14.46"></a><span id="l14.46">   &lt;command id=&quot;Tasks:Mail&quot; oncommand=&quot;toMessengerWindow();&quot;/&gt;</span>
<a href="#l14.47"></a><span id="l14.47">   &lt;command id=&quot;Tasks:AddressBook&quot; oncommand=&quot;toAddressBook();&quot;/&gt;</span>
<a href="#l14.48"></a><span id="l14.48"> #endif</span>
<a href="#l14.49"></a><span id="l14.49"> </span>
<a href="#l14.50"></a><span id="l14.50">   &lt;command id=&quot;cmd_CustomizeComposeToolbar&quot;</span>
<a href="#l14.51"></a><span id="l14.51">            oncommand=&quot;CustomizeMailToolbar('compose-toolbox', 'CustomizeComposeToolbar')&quot;/&gt;</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+  &lt;command id=&quot;cmd_convertCloud&quot; oncommand=&quot;convertSelectedToCloudAttachment(event.target.cloudProvider); event.stopPropagation();&quot;/&gt;</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+  &lt;command id=&quot;cmd_convertAttachment&quot; oncommand=&quot;goDoCommand('cmd_convertAttachment')&quot;/&gt;</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+  &lt;command id=&quot;cmd_cancelUpload&quot; oncommand=&quot;goDoCommand('cmd_cancelUpload')&quot;/&gt;</span>
<a href="#l14.56"></a><span id="l14.56"> &lt;/commandset&gt;</span>
<a href="#l14.57"></a><span id="l14.57"> </span>
<a href="#l14.58"></a><span id="l14.58"> &lt;broadcasterset id=&quot;composeBroadcasters&quot;&gt;</span>
<a href="#l14.59"></a><span id="l14.59">   &lt;broadcaster id=&quot;args&quot; value=&quot;editorType=default&quot;/&gt;</span>
<a href="#l14.60"></a><span id="l14.60">   &lt;broadcaster id=&quot;viewAddressPicker&quot; autoCheck=&quot;false&quot; type=&quot;checkbox&quot; oncommand=&quot;toggleAddressPicker();&quot;/&gt;</span>
<a href="#l14.61"></a><span id="l14.61"> &lt;/broadcasterset&gt;</span>
<a href="#l14.62"></a><span id="l14.62"> </span>
<a href="#l14.63"></a><span id="l14.63"> &lt;keyset id=&quot;tasksKeys&quot;&gt;</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineat">@@ -315,41 +323,62 @@</span>
<a href="#l14.65"></a><span id="l14.65">                 accesskey=&quot;&amp;spellAddDictionaries.accesskey;&quot;</span>
<a href="#l14.66"></a><span id="l14.66">                 oncommand=&quot;openDictionaryList();&quot;/&gt;</span>
<a href="#l14.67"></a><span id="l14.67">     &lt;/menupopup&gt;</span>
<a href="#l14.68"></a><span id="l14.68">   &lt;/menu&gt;</span>
<a href="#l14.69"></a><span id="l14.69"> </span>
<a href="#l14.70"></a><span id="l14.70"> &lt;/menupopup&gt;</span>
<a href="#l14.71"></a><span id="l14.71"> </span>
<a href="#l14.72"></a><span id="l14.72"> &lt;menupopup id=&quot;msgComposeAttachmentItemContext&quot;</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineminus">-           onpopupshowing=&quot;updateEditItems();&quot;&gt;</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+           onpopupshowing=&quot;updateAttachmentItems();&quot;&gt;</span>
<a href="#l14.75"></a><span id="l14.75">   &lt;menuitem label=&quot;&amp;openAttachment.label;&quot;</span>
<a href="#l14.76"></a><span id="l14.76">             accesskey=&quot;&amp;openAttachment.accesskey;&quot;</span>
<a href="#l14.77"></a><span id="l14.77">             command=&quot;cmd_openAttachment&quot;/&gt;</span>
<a href="#l14.78"></a><span id="l14.78">   &lt;menuitem label=&quot;&amp;removeAttachment.label;&quot;</span>
<a href="#l14.79"></a><span id="l14.79">             accesskey=&quot;&amp;removeAttachment.accesskey;&quot;</span>
<a href="#l14.80"></a><span id="l14.80">             command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l14.81"></a><span id="l14.81">   &lt;menuitem label=&quot;&amp;renameAttachment.label;&quot;</span>
<a href="#l14.82"></a><span id="l14.82">             accesskey=&quot;&amp;renameAttachment.accesskey;&quot;</span>
<a href="#l14.83"></a><span id="l14.83">             command=&quot;cmd_renameAttachment&quot;/&gt;</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+  &lt;menu label=&quot;&amp;convertCloud.label;&quot;</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+        accesskey=&quot;&amp;convertCloud.accesskey;&quot;</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+        command=&quot;cmd_convertCloud&quot;&gt;</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineplus">+    &lt;menupopup onpopupshowing=&quot;addConvertCloudMenuItems(this, 'context_convertCloudSeparator', 'context_convertCloud');&quot;&gt;</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+      &lt;menuitem id=&quot;context_convertAttachment&quot;</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+                type=&quot;radio&quot; name=&quot;context_convertCloud&quot;</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+                label=&quot;&amp;convertRegularAttachment.label;&quot;</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+                accesskey=&quot;&amp;convertRegularAttachment.accesskey;&quot;</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+                command=&quot;cmd_convertAttachment&quot;/&gt;</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineplus">+      &lt;menuseparator id=&quot;context_convertCloudSeparator&quot;/&gt;</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineplus">+    &lt;/menupopup&gt;</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+  &lt;/menu&gt;</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineplus">+  &lt;menuitem id=&quot;context_cancelUpload&quot;</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineplus">+            label=&quot;&amp;cancelUpload.label;&quot;</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineplus">+            accesskey=&quot;&amp;cancelUpload.accesskey;&quot;</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineplus">+            command=&quot;cmd_cancelUpload&quot;/&gt;</span>
<a href="#l14.100"></a><span id="l14.100">   &lt;menuseparator/&gt;</span>
<a href="#l14.101"></a><span id="l14.101">   &lt;menuitem label=&quot;&amp;selectAll.label;&quot;</span>
<a href="#l14.102"></a><span id="l14.102">             accesskey=&quot;&amp;selectAll.accesskey;&quot;</span>
<a href="#l14.103"></a><span id="l14.103">             command=&quot;cmd_selectAll&quot;/&gt;</span>
<a href="#l14.104"></a><span id="l14.104"> &lt;/menupopup&gt;</span>
<a href="#l14.105"></a><span id="l14.105"> </span>
<a href="#l14.106"></a><span id="l14.106"> &lt;menupopup id=&quot;msgComposeAttachmentListContext&quot;</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-           onpopupshowing=&quot;updateEditItems();&quot;&gt;</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineplus">+           onpopupshowing=&quot;updateAttachmentItems();&quot;&gt;</span>
<a href="#l14.109"></a><span id="l14.109">   &lt;menuitem label=&quot;&amp;selectAll.label;&quot;</span>
<a href="#l14.110"></a><span id="l14.110">             accesskey=&quot;&amp;selectAll.accesskey;&quot;</span>
<a href="#l14.111"></a><span id="l14.111">             command=&quot;cmd_selectAll&quot;/&gt;</span>
<a href="#l14.112"></a><span id="l14.112">   &lt;menuseparator/&gt;</span>
<a href="#l14.113"></a><span id="l14.113">   &lt;menuitem label=&quot;&amp;attachFile.label;&quot;</span>
<a href="#l14.114"></a><span id="l14.114">             accesskey=&quot;&amp;attachFile.accesskey;&quot;</span>
<a href="#l14.115"></a><span id="l14.115">             command=&quot;cmd_attachFile&quot;/&gt;</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineplus">+  &lt;menu label=&quot;&amp;attachCloud.label;&quot;</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineplus">+        accesskey=&quot;&amp;attachCloud.accesskey;&quot;</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineplus">+        command=&quot;cmd_attachCloud&quot;&gt;</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineplus">+    &lt;menupopup onpopupshowing=&quot;addAttachCloudMenuItems(this);&quot;/&gt;</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineplus">+  &lt;/menu&gt;</span>
<a href="#l14.121"></a><span id="l14.121">   &lt;menuitem label=&quot;&amp;attachPage.label;&quot;</span>
<a href="#l14.122"></a><span id="l14.122">             accesskey=&quot;&amp;attachPage.accesskey;&quot;</span>
<a href="#l14.123"></a><span id="l14.123">             command=&quot;cmd_attachPage&quot;/&gt;</span>
<a href="#l14.124"></a><span id="l14.124"> &lt;/menupopup&gt;</span>
<a href="#l14.125"></a><span id="l14.125"> </span>
<a href="#l14.126"></a><span id="l14.126"> &lt;menupopup id=&quot;toolbar-context-menu&quot;</span>
<a href="#l14.127"></a><span id="l14.127">            onpopupshowing=&quot;onViewToolbarsPopupShowing(event, 'compose-toolbox');&quot;&gt;</span>
<a href="#l14.128"></a><span id="l14.128">   &lt;menuseparator/&gt;</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineat">@@ -395,19 +424,23 @@</span>
<a href="#l14.130"></a><span id="l14.130">                         key=&quot;key_newMessage2&quot; oncommand=&quot;goOpenNewMessage();&quot;/&gt;</span>
<a href="#l14.131"></a><span id="l14.131">               &lt;menuseparator/&gt;</span>
<a href="#l14.132"></a><span id="l14.132">               &lt;menuitem id=&quot;menu_NewContact&quot; label=&quot;&amp;newContact.label;&quot;</span>
<a href="#l14.133"></a><span id="l14.133">                         accesskey=&quot;&amp;newContact.accesskey;&quot;</span>
<a href="#l14.134"></a><span id="l14.134">                         oncommand=&quot;window.openDialog('chrome://messenger/content/addressbook/abNewCardDialog.xul', '', 'chrome,modal,resizable=no,centerscreen');&quot;/&gt;</span>
<a href="#l14.135"></a><span id="l14.135">             &lt;/menupopup&gt;</span>
<a href="#l14.136"></a><span id="l14.136">           &lt;/menu&gt;</span>
<a href="#l14.137"></a><span id="l14.137">           &lt;menu id=&quot;menu_Attach&quot; label=&quot;&amp;attachMenu.label;&quot; accesskey=&quot;&amp;attachMenu.accesskey;&quot;&gt;</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineminus">-            &lt;menupopup id=&quot;menu_AttachPopup&quot;&gt;</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineplus">+            &lt;menupopup id=&quot;menu_AttachPopup&quot; onpopupshowing=&quot;updateAttachmentItems();&quot;&gt;</span>
<a href="#l14.140"></a><span id="l14.140">               &lt;menuitem label=&quot;&amp;attachFileCmd.label;&quot; accesskey=&quot;&amp;attachFileCmd.accesskey;&quot;</span>
<a href="#l14.141"></a><span id="l14.141">                         key=&quot;key_attachFile&quot; command=&quot;cmd_attachFile&quot;/&gt;</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineplus">+              &lt;menu label=&quot;&amp;attachCloudCmd.label;&quot; accesskey=&quot;&amp;attachCloudCmd.accesskey;&quot;</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineplus">+                    command=&quot;cmd_attachCloud&quot;&gt;</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineplus">+                &lt;menupopup onpopupshowing=&quot;addAttachCloudMenuItems(this);&quot;/&gt;</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineplus">+              &lt;/menu&gt;</span>
<a href="#l14.146"></a><span id="l14.146">               &lt;menuitem label=&quot;&amp;attachPageCmd.label;&quot; accesskey=&quot;&amp;attachPageCmd.accesskey;&quot; command=&quot;cmd_attachPage&quot;/&gt;</span>
<a href="#l14.147"></a><span id="l14.147">               &lt;menuseparator/&gt;</span>
<a href="#l14.148"></a><span id="l14.148">               &lt;menuitem type=&quot;checkbox&quot; label=&quot;&amp;attachVCardCmd.label;&quot; accesskey=&quot;&amp;attachVCardCmd.accesskey;&quot; command=&quot;cmd_attachVCard&quot;/&gt;</span>
<a href="#l14.149"></a><span id="l14.149">             &lt;/menupopup&gt;</span>
<a href="#l14.150"></a><span id="l14.150">           &lt;/menu&gt;</span>
<a href="#l14.151"></a><span id="l14.151">           &lt;menuseparator/&gt;</span>
<a href="#l14.152"></a><span id="l14.152">           &lt;menuitem id=&quot;menu_SaveCmd&quot; label=&quot;&amp;saveCmd.label;&quot; accesskey=&quot;&amp;saveCmd.accesskey;&quot;</span>
<a href="#l14.153"></a><span id="l14.153">                     key=&quot;key_save&quot; command=&quot;cmd_saveDefault&quot;/&gt;</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineat">@@ -625,22 +658,33 @@</span>
<a href="#l14.155"></a><span id="l14.155"> </span>
<a href="#l14.156"></a><span id="l14.156">     &lt;toolbarbutton class=&quot;toolbarbutton-1&quot; type=&quot;menu-button&quot;</span>
<a href="#l14.157"></a><span id="l14.157">                id=&quot;button-attach&quot; label=&quot;&amp;attachButton.label;&quot; </span>
<a href="#l14.158"></a><span id="l14.158">                tooltiptext=&quot;&amp;attachButton.tooltip;&quot; </span>
<a href="#l14.159"></a><span id="l14.159">                command=&quot;cmd_attachFile&quot;</span>
<a href="#l14.160"></a><span id="l14.160">                ondragover=&quot;nsDragAndDrop.dragOver(event, envelopeDragObserver);&quot;</span>
<a href="#l14.161"></a><span id="l14.161">                ondragdrop=&quot;nsDragAndDrop.drop(event, envelopeDragObserver);&quot;</span>
<a href="#l14.162"></a><span id="l14.162">                ondragexit=&quot;nsDragAndDrop.dragExit(event, envelopeDragObserver);&quot;&gt;</span>
<a href="#l14.163"></a><span id="l14.163" class="difflineminus">-         &lt;menupopup id=&quot;button-attachPopup&quot;&gt;</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineminus">-            &lt;menuitem label=&quot;&amp;attachFileCmd.label;&quot; accesskey=&quot;&amp;attachFileCmd.accesskey;&quot; command=&quot;cmd_attachFile&quot;/&gt;</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineminus">-            &lt;menuitem label=&quot;&amp;attachPageCmd.label;&quot; accesskey=&quot;&amp;attachPageCmd.accesskey;&quot; command=&quot;cmd_attachPage&quot;/&gt;</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineminus">-           &lt;menuseparator/&gt;</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineminus">-           &lt;menuitem type=&quot;checkbox&quot; label=&quot;&amp;attachVCardCmd.label;&quot; accesskey=&quot;&amp;attachVCardCmd.accesskey;&quot; command=&quot;cmd_attachVCard&quot;/&gt;</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineminus">-         &lt;/menupopup&gt;</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineplus">+      &lt;menupopup id=&quot;button-attachPopup&quot; onpopupshowing=&quot;updateAttachmentItems();&quot;&gt;</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineplus">+        &lt;menuitem label=&quot;&amp;attachFileCmd.label;&quot;</span>
<a href="#l14.171"></a><span id="l14.171" class="difflineplus">+                  accesskey=&quot;&amp;attachFileCmd.accesskey;&quot;</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineplus">+                  command=&quot;cmd_attachFile&quot;/&gt;</span>
<a href="#l14.173"></a><span id="l14.173" class="difflineplus">+        &lt;menu label=&quot;&amp;attachCloudCmd.label;&quot;</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineplus">+              accesskey=&quot;&amp;attachCloudCmd.accesskey;&quot;</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineplus">+              command=&quot;cmd_attachCloud&quot;&gt;</span>
<a href="#l14.176"></a><span id="l14.176" class="difflineplus">+          &lt;menupopup onpopupshowing=&quot;addAttachCloudMenuItems(this);&quot;/&gt;</span>
<a href="#l14.177"></a><span id="l14.177" class="difflineplus">+        &lt;/menu&gt;</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineplus">+        &lt;menuitem label=&quot;&amp;attachPageCmd.label;&quot;</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineplus">+                  accesskey=&quot;&amp;attachPageCmd.accesskey;&quot;</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineplus">+                  command=&quot;cmd_attachPage&quot;/&gt;</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineplus">+        &lt;menuseparator/&gt;</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineplus">+        &lt;menuitem type=&quot;checkbox&quot; label=&quot;&amp;attachVCardCmd.label;&quot;</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineplus">+                  accesskey=&quot;&amp;attachVCardCmd.accesskey;&quot;</span>
<a href="#l14.184"></a><span id="l14.184" class="difflineplus">+                  command=&quot;cmd_attachVCard&quot;/&gt;</span>
<a href="#l14.185"></a><span id="l14.185" class="difflineplus">+      &lt;/menupopup&gt;</span>
<a href="#l14.186"></a><span id="l14.186">     &lt;/toolbarbutton&gt;</span>
<a href="#l14.187"></a><span id="l14.187"> </span>
<a href="#l14.188"></a><span id="l14.188">     &lt;toolbarbutton class=&quot;toolbarbutton-1&quot; type=&quot;menu-button&quot;</span>
<a href="#l14.189"></a><span id="l14.189">                id=&quot;spellingButton&quot; label=&quot;&amp;spellingButton.label;&quot; </span>
<a href="#l14.190"></a><span id="l14.190">                tooltiptext=&quot;&amp;spellingButton.tooltip;&quot;</span>
<a href="#l14.191"></a><span id="l14.191">                command=&quot;cmd_spelling&quot;&gt;</span>
<a href="#l14.192"></a><span id="l14.192">       &lt;!-- this popup gets dynamically generated --&gt;</span>
<a href="#l14.193"></a><span id="l14.193">       &lt;menupopup id=&quot;languageMenuList&quot; oncommand=&quot;ChangeLanguage(event);&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/compose/jar.mn</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/compose/jar.mn</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,11 +1,13 @@</span>
<a href="#l15.4"></a><span id="l15.4"> messenger.jar:</span>
<a href="#l15.5"></a><span id="l15.5"> % overlay chrome://editor/content/EdImageOverlay.xul chrome://messenger/content/messengercompose/mailComposeEditorOverlay.xul</span>
<a href="#l15.6"></a><span id="l15.6"> % overlay chrome://editor/content/EdImageOverlay.xul chrome://messenger/content/messengercompose/EdImageOverlayOverlay.xul</span>
<a href="#l15.7"></a><span id="l15.7"> % overlay chrome://editor/content/EdLinkProps.xul chrome://messenger/content/messengercompose/mailComposeEditorOverlay.xul</span>
<a href="#l15.8"></a><span id="l15.8"> *   content/messenger/messengercompose/messengercompose.xul        (content/messengercompose.xul)</span>
<a href="#l15.9"></a><span id="l15.9">     content/messenger/messengercompose/MsgComposeCommands.js       (content/MsgComposeCommands.js)</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineplus">+    content/messenger/messengercompose/bigFileObserver.js          (content/bigFileObserver.js)</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineplus">+    content/messenger/messengercompose/cloudAttachmentLinkManager.js (content/cloudAttachmentLinkManager.js)</span>
<a href="#l15.12"></a><span id="l15.12">     content/messenger/messengercompose/EdImageOverlayOverlay.xul   (content/EdImageOverlayOverlay.xul)</span>
<a href="#l15.13"></a><span id="l15.13"> *   content/messenger/messengercompose/addressingWidgetOverlay.js  (content/addressingWidgetOverlay.js)</span>
<a href="#l15.14"></a><span id="l15.14"> </span>
<a href="#l15.15"></a><span id="l15.15"> comm.jar:</span>
<a href="#l15.16"></a><span id="l15.16"> *+  content/editor/editorOverlay.xul                               (content/editorOverlay.xul) </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/components/preferences/applications.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/components/preferences/applications.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -71,16 +71,21 @@ const ICON_URL_APP      = &quot;chrome://mess</span>
<a href="#l16.4"></a><span id="l16.4"> /*</span>
<a href="#l16.5"></a><span id="l16.5"> #endif</span>
<a href="#l16.6"></a><span id="l16.6"> */</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> // For CSS. Can be one of &quot;ask&quot;, &quot;save&quot;, &quot;plugin&quot; or &quot;feed&quot;. If absent, the icon URL</span>
<a href="#l16.9"></a><span id="l16.9"> // was set by us to a custom handler icon and CSS should not try to override it.</span>
<a href="#l16.10"></a><span id="l16.10"> const APP_ICON_ATTR_NAME = &quot;appHandlerIcon&quot;;</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+// CloudFile account tools used by gCloudFileTab.</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+Components.utils.import(&quot;resource:///modules/cloudFileAccounts.js&quot;);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+</span>
<a href="#l16.17"></a><span id="l16.17"> //****************************************************************************//</span>
<a href="#l16.18"></a><span id="l16.18"> // Utilities</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20"> function getDisplayNameForFile(aFile) {</span>
<a href="#l16.21"></a><span id="l16.21"> /*</span>
<a href="#l16.22"></a><span id="l16.22"> #ifdef XP_WIN</span>
<a href="#l16.23"></a><span id="l16.23"> */</span>
<a href="#l16.24"></a><span id="l16.24">   if (aFile instanceof Components.interfaces.nsILocalFileWin) {</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineat">@@ -435,16 +440,446 @@ HandlerInfoWrapper.prototype = {</span>
<a href="#l16.26"></a><span id="l16.26">       return &quot;moz-icon://goat?size=&quot; + aSize + &quot;&amp;contentType=&quot; + this.type;</span>
<a href="#l16.27"></a><span id="l16.27"> </span>
<a href="#l16.28"></a><span id="l16.28">     // FIXME: consider returning some generic icon when we can't get a URL for</span>
<a href="#l16.29"></a><span id="l16.29">     // one (for example in the case of protocol schemes).  Filed as bug 395141.</span>
<a href="#l16.30"></a><span id="l16.30">     return null;</span>
<a href="#l16.31"></a><span id="l16.31">   }</span>
<a href="#l16.32"></a><span id="l16.32"> };</span>
<a href="#l16.33"></a><span id="l16.33"> </span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+var gApplicationsTabController = {</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+  mInitialized: false,</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+  // We default to displaying the Outgoing tab, which is the tab at index 1</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+  // of the attachmentPrefs tabs.</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+  mDefaultIndex: 1,</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+  init: function() {</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineplus">+    if (this.mInitialized)</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineplus">+      return;</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineplus">+</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineplus">+    gApplicationsPane.init();</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+    let tabbox = document.getElementById(&quot;attachmentPrefs&quot;);</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineplus">+</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineplus">+    // If BigFiles is disabled, hide the &quot;Outgoing&quot; tab, and the tab</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineplus">+    // selectors, and bail out.</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineplus">+    if (!Services.prefs.getBoolPref(&quot;mail.cloud_files.enabled&quot;)) {</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+      // Default to the first tab, &quot;Incoming&quot;</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+      tabbox.selectedIndex = 0;</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+      // Hide the tab selector</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+      let tabs = document.getElementById(&quot;attachmentPrefsTabs&quot;);</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+      tabs.hidden = true;</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineplus">+      this.mInitialized = true;</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineplus">+      return;</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+    }</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineplus">+    gCloudFileTab.init();</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineplus">+</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineplus">+    let preference = document.getElementById(&quot;mail.preferences.applications.selectedTabIndex&quot;);</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineplus">+    tabbox.selectedIndex = preference.value ? preference.value : this.mDefaultIndex;</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineplus">+</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineplus">+    this.mInitialized = true;</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineplus">+  },</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineplus">+  tabSelectionChanged: function() {</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+    if (this.mInitialized)</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineplus">+      document.getElementById(&quot;mail.preferences.applications.selectedTabIndex&quot;)</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineplus">+              .valueFromPreferences = document.getElementById(&quot;attachmentPrefs&quot;)</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineplus">+              .selectedIndex;</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineplus">+  },</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineplus">+}</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineplus">+</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineplus">+var gCloudFileController = {</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+  commands: {</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineplus">+    cmd_addCloudfileAccount: {</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineplus">+        return true;</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineplus">+      },</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineplus">+      doCommand: function() {</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineplus">+        gCloudFileTab.addCloudFileAccount();</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineplus">+      },</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineplus">+    },</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineplus">+</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineplus">+    cmd_removeCloudfileAccount: {</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineplus">+        let listbox = document.getElementById(&quot;cloudFileView&quot;);</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineplus">+        return listbox.selectedCount &gt; 0;</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineplus">+      },</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+      doCommand: function() {</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineplus">+        gCloudFileTab.removeCloudFileAccount();</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineplus">+      },</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineplus">+    },</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineplus">+</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+    cmd_reauthCloudfileAccount: {</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineplus">+      isEnabled: function() {</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineplus">+        return true;</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineplus">+      },</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineplus">+      doCommand: function() {</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+        gCloudFileTab.authSelected();</span>
<a href="#l16.104"></a><span id="l16.104" class="difflineplus">+      },</span>
<a href="#l16.105"></a><span id="l16.105" class="difflineplus">+    },</span>
<a href="#l16.106"></a><span id="l16.106" class="difflineplus">+</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineplus">+  },</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineplus">+</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineplus">+  supportsCommand: function(aCommand) {</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineplus">+    return (aCommand in this.commands);</span>
<a href="#l16.111"></a><span id="l16.111" class="difflineplus">+  },</span>
<a href="#l16.112"></a><span id="l16.112" class="difflineplus">+</span>
<a href="#l16.113"></a><span id="l16.113" class="difflineplus">+  isCommandEnabled: function(aCommand) {</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineplus">+    if (!this.supportsCommand(aCommand))</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineplus">+      return false;</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineplus">+    return this.commands[aCommand].isEnabled();</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineplus">+  },</span>
<a href="#l16.118"></a><span id="l16.118" class="difflineplus">+</span>
<a href="#l16.119"></a><span id="l16.119" class="difflineplus">+  doCommand: function(aCommand) {</span>
<a href="#l16.120"></a><span id="l16.120" class="difflineplus">+    if (!this.supportsCommand(aCommand))</span>
<a href="#l16.121"></a><span id="l16.121" class="difflineplus">+      return;</span>
<a href="#l16.122"></a><span id="l16.122" class="difflineplus">+</span>
<a href="#l16.123"></a><span id="l16.123" class="difflineplus">+    let cmd = this.commands[aCommand];</span>
<a href="#l16.124"></a><span id="l16.124" class="difflineplus">+</span>
<a href="#l16.125"></a><span id="l16.125" class="difflineplus">+    if (!cmd.isEnabled())</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineplus">+      return;</span>
<a href="#l16.127"></a><span id="l16.127" class="difflineplus">+</span>
<a href="#l16.128"></a><span id="l16.128" class="difflineplus">+    cmd.doCommand();</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineplus">+  },</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineplus">+  onEvent: function(event) {},</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineplus">+}</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineplus">+</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineplus">+function CommandUpdate_CloudFile() {</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineplus">+  goUpdateCommand(&quot;cmd_removeCloudfileAccount&quot;);</span>
<a href="#l16.135"></a><span id="l16.135" class="difflineplus">+  goUpdateCommand(&quot;cmd_addCloudfileAccount&quot;);</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineplus">+}</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineplus">+</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineplus">+var gCloudFileTab = {</span>
<a href="#l16.139"></a><span id="l16.139" class="difflineplus">+  _initialized: false,</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineplus">+  _list: null,</span>
<a href="#l16.141"></a><span id="l16.141" class="difflineplus">+  _settings: null,</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineplus">+  _settingsDeck: null,</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineplus">+  _tabpanel: null,</span>
<a href="#l16.144"></a><span id="l16.144" class="difflineplus">+  _accountCache: {},</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineplus">+  _settingsPanelWrap: null,</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineplus">+  _defaultPanel: null,</span>
<a href="#l16.147"></a><span id="l16.147" class="difflineplus">+  _loadingPanel: null,</span>
<a href="#l16.148"></a><span id="l16.148" class="difflineplus">+  _authErrorPanel: null,</span>
<a href="#l16.149"></a><span id="l16.149" class="difflineplus">+</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineplus">+  get _strings() {</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineplus">+    return Services.strings</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineplus">+                   .createBundle(&quot;chrome://messenger/locale/preferences/applications.properties&quot;);</span>
<a href="#l16.153"></a><span id="l16.153" class="difflineplus">+  },</span>
<a href="#l16.154"></a><span id="l16.154" class="difflineplus">+</span>
<a href="#l16.155"></a><span id="l16.155" class="difflineplus">+  init: function() {</span>
<a href="#l16.156"></a><span id="l16.156" class="difflineplus">+    if (this._initialized)</span>
<a href="#l16.157"></a><span id="l16.157" class="difflineplus">+      return;</span>
<a href="#l16.158"></a><span id="l16.158" class="difflineplus">+</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineplus">+    this._list = document.getElementById(&quot;cloudFileView&quot;);</span>
<a href="#l16.160"></a><span id="l16.160" class="difflineplus">+    this._settingsDeck = document.getElementById(&quot;cloudFileSettingsDeck&quot;);</span>
<a href="#l16.161"></a><span id="l16.161" class="difflineplus">+    this._defaultPanel = document.getElementById(&quot;cloudFileDefaultPanel&quot;);</span>
<a href="#l16.162"></a><span id="l16.162" class="difflineplus">+    this._settingsPanelWrap = document.getElementById(&quot;cloudFileSettingsWrapper&quot;);</span>
<a href="#l16.163"></a><span id="l16.163" class="difflineplus">+    this._loadingPanel = document.getElementById(&quot;cloudFileLoadingPanel&quot;);</span>
<a href="#l16.164"></a><span id="l16.164" class="difflineplus">+    this._authErrorPanel = document.getElementById(&quot;cloudFileAuthErrorPanel&quot;);</span>
<a href="#l16.165"></a><span id="l16.165" class="difflineplus">+</span>
<a href="#l16.166"></a><span id="l16.166" class="difflineplus">+    top.controllers.appendController(gCloudFileController);</span>
<a href="#l16.167"></a><span id="l16.167" class="difflineplus">+</span>
<a href="#l16.168"></a><span id="l16.168" class="difflineplus">+    this.rebuildView();</span>
<a href="#l16.169"></a><span id="l16.169" class="difflineplus">+</span>
<a href="#l16.170"></a><span id="l16.170" class="difflineplus">+    if (this._list.itemCount &gt; 0)</span>
<a href="#l16.171"></a><span id="l16.171" class="difflineplus">+      this._list.selectedIndex = 0;</span>
<a href="#l16.172"></a><span id="l16.172" class="difflineplus">+</span>
<a href="#l16.173"></a><span id="l16.173" class="difflineplus">+    window.addEventListener(&quot;unload&quot;, this, false);</span>
<a href="#l16.174"></a><span id="l16.174" class="difflineplus">+    CommandUpdate_CloudFile();</span>
<a href="#l16.175"></a><span id="l16.175" class="difflineplus">+</span>
<a href="#l16.176"></a><span id="l16.176" class="difflineplus">+    this._initialized = true;</span>
<a href="#l16.177"></a><span id="l16.177" class="difflineplus">+  },</span>
<a href="#l16.178"></a><span id="l16.178" class="difflineplus">+</span>
<a href="#l16.179"></a><span id="l16.179" class="difflineplus">+  destroy: function CFT_destroy() {</span>
<a href="#l16.180"></a><span id="l16.180" class="difflineplus">+    // Remove any controllers or observers here.</span>
<a href="#l16.181"></a><span id="l16.181" class="difflineplus">+    top.controllers.removeController(gCloudFileController);</span>
<a href="#l16.182"></a><span id="l16.182" class="difflineplus">+    window.removeEventListener(&quot;unload&quot;, this, false);</span>
<a href="#l16.183"></a><span id="l16.183" class="difflineplus">+  },</span>
<a href="#l16.184"></a><span id="l16.184" class="difflineplus">+</span>
<a href="#l16.185"></a><span id="l16.185" class="difflineplus">+  makeRichListItemForAccount: function CFT_makeRichListItemForAccount(aAccount) {</span>
<a href="#l16.186"></a><span id="l16.186" class="difflineplus">+    let rli = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l16.187"></a><span id="l16.187" class="difflineplus">+    rli.value = aAccount.accountKey;</span>
<a href="#l16.188"></a><span id="l16.188" class="difflineplus">+    rli.setAttribute(&quot;value&quot;, aAccount.accountKey);</span>
<a href="#l16.189"></a><span id="l16.189" class="difflineplus">+    rli.setAttribute(&quot;class&quot;, &quot;cloudfileAccount&quot;);</span>
<a href="#l16.190"></a><span id="l16.190" class="difflineplus">+    rli.setAttribute(&quot;state&quot;, &quot;waiting-to-connect&quot;);</span>
<a href="#l16.191"></a><span id="l16.191" class="difflineplus">+</span>
<a href="#l16.192"></a><span id="l16.192" class="difflineplus">+    if (aAccount.iconClass)</span>
<a href="#l16.193"></a><span id="l16.193" class="difflineplus">+      rli.style.listStyleImage = &quot;url('&quot; + aAccount.iconClass + &quot;')&quot;;</span>
<a href="#l16.194"></a><span id="l16.194" class="difflineplus">+</span>
<a href="#l16.195"></a><span id="l16.195" class="difflineplus">+    let displayName = cloudFileAccounts.getDisplayName(aAccount.accountKey);</span>
<a href="#l16.196"></a><span id="l16.196" class="difflineplus">+    // Quick and ugly - accountKey:displayName for now</span>
<a href="#l16.197"></a><span id="l16.197" class="difflineplus">+    let status = document.createElement(&quot;image&quot;);</span>
<a href="#l16.198"></a><span id="l16.198" class="difflineplus">+    status.setAttribute(&quot;class&quot;, &quot;typeIcon&quot;);</span>
<a href="#l16.199"></a><span id="l16.199" class="difflineplus">+</span>
<a href="#l16.200"></a><span id="l16.200" class="difflineplus">+    rli.appendChild(status);</span>
<a href="#l16.201"></a><span id="l16.201" class="difflineplus">+    let descr = document.createElement(&quot;label&quot;);</span>
<a href="#l16.202"></a><span id="l16.202" class="difflineplus">+    descr.setAttribute(&quot;value&quot;, displayName);</span>
<a href="#l16.203"></a><span id="l16.203" class="difflineplus">+    rli.appendChild(descr);</span>
<a href="#l16.204"></a><span id="l16.204" class="difflineplus">+</span>
<a href="#l16.205"></a><span id="l16.205" class="difflineplus">+    // Set the state of the richlistitem, if applicable</span>
<a href="#l16.206"></a><span id="l16.206" class="difflineplus">+    if (aAccount.accountKey in this._accountCache) {</span>
<a href="#l16.207"></a><span id="l16.207" class="difflineplus">+      let result = this._accountCache[aAccount.accountKey].result;</span>
<a href="#l16.208"></a><span id="l16.208" class="difflineplus">+      this._mapResultToState(rli, result);</span>
<a href="#l16.209"></a><span id="l16.209" class="difflineplus">+      this._accountCache[aAccount.accountKey].listItem = rli;</span>
<a href="#l16.210"></a><span id="l16.210" class="difflineplus">+    }</span>
<a href="#l16.211"></a><span id="l16.211" class="difflineplus">+</span>
<a href="#l16.212"></a><span id="l16.212" class="difflineplus">+    return rli;</span>
<a href="#l16.213"></a><span id="l16.213" class="difflineplus">+  },</span>
<a href="#l16.214"></a><span id="l16.214" class="difflineplus">+</span>
<a href="#l16.215"></a><span id="l16.215" class="difflineplus">+  clearEntries: function CFT_clearEntries() {</span>
<a href="#l16.216"></a><span id="l16.216" class="difflineplus">+    // Clear the list of entries.</span>
<a href="#l16.217"></a><span id="l16.217" class="difflineplus">+    while (this._list.childNodes.length &gt; 0)</span>
<a href="#l16.218"></a><span id="l16.218" class="difflineplus">+      this._list.removeChild(this._list.lastChild);</span>
<a href="#l16.219"></a><span id="l16.219" class="difflineplus">+  },</span>
<a href="#l16.220"></a><span id="l16.220" class="difflineplus">+</span>
<a href="#l16.221"></a><span id="l16.221" class="difflineplus">+  rebuildView: function CFT_rebuildView() {</span>
<a href="#l16.222"></a><span id="l16.222" class="difflineplus">+    this.clearEntries();</span>
<a href="#l16.223"></a><span id="l16.223" class="difflineplus">+    let accounts = cloudFileAccounts.accounts;</span>
<a href="#l16.224"></a><span id="l16.224" class="difflineplus">+</span>
<a href="#l16.225"></a><span id="l16.225" class="difflineplus">+    // Sort the accounts by displayName.</span>
<a href="#l16.226"></a><span id="l16.226" class="difflineplus">+    function sortAccounts(a, b) {</span>
<a href="#l16.227"></a><span id="l16.227" class="difflineplus">+      let aName = cloudFileAccounts.getDisplayName(a.accountKey)</span>
<a href="#l16.228"></a><span id="l16.228" class="difflineplus">+                                   .toLowerCase();</span>
<a href="#l16.229"></a><span id="l16.229" class="difflineplus">+      let bName = cloudFileAccounts.getDisplayName(b.accountKey)</span>
<a href="#l16.230"></a><span id="l16.230" class="difflineplus">+                                   .toLowerCase();</span>
<a href="#l16.231"></a><span id="l16.231" class="difflineplus">+</span>
<a href="#l16.232"></a><span id="l16.232" class="difflineplus">+      if (aName &lt; bName)</span>
<a href="#l16.233"></a><span id="l16.233" class="difflineplus">+        return -1;</span>
<a href="#l16.234"></a><span id="l16.234" class="difflineplus">+      if (aName &gt; bName)</span>
<a href="#l16.235"></a><span id="l16.235" class="difflineplus">+        return 1;</span>
<a href="#l16.236"></a><span id="l16.236" class="difflineplus">+      return 0;</span>
<a href="#l16.237"></a><span id="l16.237" class="difflineplus">+    }</span>
<a href="#l16.238"></a><span id="l16.238" class="difflineplus">+</span>
<a href="#l16.239"></a><span id="l16.239" class="difflineplus">+    accounts.sort(sortAccounts);</span>
<a href="#l16.240"></a><span id="l16.240" class="difflineplus">+</span>
<a href="#l16.241"></a><span id="l16.241" class="difflineplus">+    for (let [, account] in Iterator(accounts)) {</span>
<a href="#l16.242"></a><span id="l16.242" class="difflineplus">+      let rli = this.makeRichListItemForAccount(account);</span>
<a href="#l16.243"></a><span id="l16.243" class="difflineplus">+      this._list.appendChild(rli);</span>
<a href="#l16.244"></a><span id="l16.244" class="difflineplus">+      if (!(account.accountKey in this._accountCache))</span>
<a href="#l16.245"></a><span id="l16.245" class="difflineplus">+        this.requestUserInfoForItem(rli, false);</span>
<a href="#l16.246"></a><span id="l16.246" class="difflineplus">+    }</span>
<a href="#l16.247"></a><span id="l16.247" class="difflineplus">+  },</span>
<a href="#l16.248"></a><span id="l16.248" class="difflineplus">+</span>
<a href="#l16.249"></a><span id="l16.249" class="difflineplus">+  requestUserInfoForItem: function CFT_requestUserInfoForItem(aItem, aWithUI) {</span>
<a href="#l16.250"></a><span id="l16.250" class="difflineplus">+    let Cr = Components.results;</span>
<a href="#l16.251"></a><span id="l16.251" class="difflineplus">+    let accountKey = aItem.value;</span>
<a href="#l16.252"></a><span id="l16.252" class="difflineplus">+    let account = cloudFileAccounts.getAccount(accountKey);</span>
<a href="#l16.253"></a><span id="l16.253" class="difflineplus">+</span>
<a href="#l16.254"></a><span id="l16.254" class="difflineplus">+    let observer = {</span>
<a href="#l16.255"></a><span id="l16.255" class="difflineplus">+      onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l16.256"></a><span id="l16.256" class="difflineplus">+        gCloudFileTab._accountCache[accountKey].result = aStatusCode;</span>
<a href="#l16.257"></a><span id="l16.257" class="difflineplus">+        gCloudFileTab.onUserInfoRequestDone(accountKey);</span>
<a href="#l16.258"></a><span id="l16.258" class="difflineplus">+      },</span>
<a href="#l16.259"></a><span id="l16.259" class="difflineplus">+      onStartRequest: function(aRequest, aContext) {</span>
<a href="#l16.260"></a><span id="l16.260" class="difflineplus">+        aItem.setAttribute(&quot;state&quot;, &quot;connecting&quot;);</span>
<a href="#l16.261"></a><span id="l16.261" class="difflineplus">+      },</span>
<a href="#l16.262"></a><span id="l16.262" class="difflineplus">+    };</span>
<a href="#l16.263"></a><span id="l16.263" class="difflineplus">+</span>
<a href="#l16.264"></a><span id="l16.264" class="difflineplus">+    let accountInfo = {account: account,</span>
<a href="#l16.265"></a><span id="l16.265" class="difflineplus">+                       listItem: aItem,</span>
<a href="#l16.266"></a><span id="l16.266" class="difflineplus">+                       result: Cr.NS_ERROR_NOT_AVAILABLE}</span>
<a href="#l16.267"></a><span id="l16.267" class="difflineplus">+</span>
<a href="#l16.268"></a><span id="l16.268" class="difflineplus">+    this._accountCache[accountKey] = accountInfo;</span>
<a href="#l16.269"></a><span id="l16.269" class="difflineplus">+</span>
<a href="#l16.270"></a><span id="l16.270" class="difflineplus">+    this._settingsDeck.selectedPanel = this._loadingPanel;</span>
<a href="#l16.271"></a><span id="l16.271" class="difflineplus">+    account.refreshUserInfo(aWithUI, observer);</span>
<a href="#l16.272"></a><span id="l16.272" class="difflineplus">+  },</span>
<a href="#l16.273"></a><span id="l16.273" class="difflineplus">+</span>
<a href="#l16.274"></a><span id="l16.274" class="difflineplus">+  onUserInfoRequestDone: function CFT_onUserInfoRequestDone(aAccountKey) {</span>
<a href="#l16.275"></a><span id="l16.275" class="difflineplus">+    this.updateRichListItem(aAccountKey);</span>
<a href="#l16.276"></a><span id="l16.276" class="difflineplus">+</span>
<a href="#l16.277"></a><span id="l16.277" class="difflineplus">+    if (this._list.selectedItem &amp;&amp;</span>
<a href="#l16.278"></a><span id="l16.278" class="difflineplus">+        this._list.selectedItem.value == aAccountKey)</span>
<a href="#l16.279"></a><span id="l16.279" class="difflineplus">+      this._showAccountInfo(aAccountKey);</span>
<a href="#l16.280"></a><span id="l16.280" class="difflineplus">+  },</span>
<a href="#l16.281"></a><span id="l16.281" class="difflineplus">+</span>
<a href="#l16.282"></a><span id="l16.282" class="difflineplus">+  updateRichListItem: function CFT_updateRichListItem(aAccountKey) {</span>
<a href="#l16.283"></a><span id="l16.283" class="difflineplus">+    let accountInfo = this._accountCache[aAccountKey];</span>
<a href="#l16.284"></a><span id="l16.284" class="difflineplus">+    if (!accountInfo)</span>
<a href="#l16.285"></a><span id="l16.285" class="difflineplus">+      return;</span>
<a href="#l16.286"></a><span id="l16.286" class="difflineplus">+</span>
<a href="#l16.287"></a><span id="l16.287" class="difflineplus">+    let item = accountInfo.listItem;</span>
<a href="#l16.288"></a><span id="l16.288" class="difflineplus">+    let result = accountInfo.result;</span>
<a href="#l16.289"></a><span id="l16.289" class="difflineplus">+    this._mapResultToState(item, result);</span>
<a href="#l16.290"></a><span id="l16.290" class="difflineplus">+  },</span>
<a href="#l16.291"></a><span id="l16.291" class="difflineplus">+</span>
<a href="#l16.292"></a><span id="l16.292" class="difflineplus">+  _mapResultToState: function CFT__mapResultToState(aItem, aResult) {</span>
<a href="#l16.293"></a><span id="l16.293" class="difflineplus">+    let Cr = Components.results;</span>
<a href="#l16.294"></a><span id="l16.294" class="difflineplus">+    let Ci = Components.interfaces;</span>
<a href="#l16.295"></a><span id="l16.295" class="difflineplus">+    let itemState = &quot;no-connection&quot;;</span>
<a href="#l16.296"></a><span id="l16.296" class="difflineplus">+</span>
<a href="#l16.297"></a><span id="l16.297" class="difflineplus">+    if (aResult == Cr.NS_OK)</span>
<a href="#l16.298"></a><span id="l16.298" class="difflineplus">+      itemState = &quot;connected&quot;;</span>
<a href="#l16.299"></a><span id="l16.299" class="difflineplus">+    else if (aResult == Ci.nsIMsgCloudFileProvider.authErr)</span>
<a href="#l16.300"></a><span id="l16.300" class="difflineplus">+      itemState = &quot;auth-error&quot;;</span>
<a href="#l16.301"></a><span id="l16.301" class="difflineplus">+    else if (aResult == Cr.NS_ERROR_NOT_AVAILABLE)</span>
<a href="#l16.302"></a><span id="l16.302" class="difflineplus">+      itemState = &quot;no-connection&quot;;</span>
<a href="#l16.303"></a><span id="l16.303" class="difflineplus">+    // TODO: What other states are there?</span>
<a href="#l16.304"></a><span id="l16.304" class="difflineplus">+</span>
<a href="#l16.305"></a><span id="l16.305" class="difflineplus">+    aItem.setAttribute(&quot;state&quot;, itemState);</span>
<a href="#l16.306"></a><span id="l16.306" class="difflineplus">+  },</span>
<a href="#l16.307"></a><span id="l16.307" class="difflineplus">+</span>
<a href="#l16.308"></a><span id="l16.308" class="difflineplus">+</span>
<a href="#l16.309"></a><span id="l16.309" class="difflineplus">+  onSelectionChanged: function CFT_onSelectionChanged() {</span>
<a href="#l16.310"></a><span id="l16.310" class="difflineplus">+    // Get the selected item</span>
<a href="#l16.311"></a><span id="l16.311" class="difflineplus">+    let selection = this._list.selectedItem;</span>
<a href="#l16.312"></a><span id="l16.312" class="difflineplus">+    if (!selection)</span>
<a href="#l16.313"></a><span id="l16.313" class="difflineplus">+      return;</span>
<a href="#l16.314"></a><span id="l16.314" class="difflineplus">+</span>
<a href="#l16.315"></a><span id="l16.315" class="difflineplus">+    // The selection tells us the key.  We need the actual</span>
<a href="#l16.316"></a><span id="l16.316" class="difflineplus">+    // provider here.</span>
<a href="#l16.317"></a><span id="l16.317" class="difflineplus">+    let accountKey = selection.value;</span>
<a href="#l16.318"></a><span id="l16.318" class="difflineplus">+    this._showAccountInfo(accountKey);</span>
<a href="#l16.319"></a><span id="l16.319" class="difflineplus">+  },</span>
<a href="#l16.320"></a><span id="l16.320" class="difflineplus">+</span>
<a href="#l16.321"></a><span id="l16.321" class="difflineplus">+  _showAccountInfo: function CFT__showAccountInfo(aAccountKey) {</span>
<a href="#l16.322"></a><span id="l16.322" class="difflineplus">+    let Ci = Components.interfaces;</span>
<a href="#l16.323"></a><span id="l16.323" class="difflineplus">+    let Cr = Components.results;</span>
<a href="#l16.324"></a><span id="l16.324" class="difflineplus">+    let account = this._accountCache[aAccountKey].account;</span>
<a href="#l16.325"></a><span id="l16.325" class="difflineplus">+    let result = this._accountCache[aAccountKey].result;</span>
<a href="#l16.326"></a><span id="l16.326" class="difflineplus">+</span>
<a href="#l16.327"></a><span id="l16.327" class="difflineplus">+    if (result == Cr.NS_ERROR_NOT_AVAILABLE)</span>
<a href="#l16.328"></a><span id="l16.328" class="difflineplus">+      this._settingsDeck.selectedPanel = this._loadingPanel;</span>
<a href="#l16.329"></a><span id="l16.329" class="difflineplus">+    else if (result == Cr.NS_OK) {</span>
<a href="#l16.330"></a><span id="l16.330" class="difflineplus">+      this._settingsDeck.selectedPanel = this._settingsPanelWrap;</span>
<a href="#l16.331"></a><span id="l16.331" class="difflineplus">+      this._showAccountManagement(account);</span>
<a href="#l16.332"></a><span id="l16.332" class="difflineplus">+    }</span>
<a href="#l16.333"></a><span id="l16.333" class="difflineplus">+    else if (result == Ci.nsIMsgCloudFileProvider.authErr) {</span>
<a href="#l16.334"></a><span id="l16.334" class="difflineplus">+      this._settingsDeck.selectedPanel = this._authErrorPanel;</span>
<a href="#l16.335"></a><span id="l16.335" class="difflineplus">+    }</span>
<a href="#l16.336"></a><span id="l16.336" class="difflineplus">+    else {</span>
<a href="#l16.337"></a><span id="l16.337" class="difflineplus">+      // TODO Handle this case...</span>
<a href="#l16.338"></a><span id="l16.338" class="difflineplus">+      dump(&quot;\n\nSome other error...\n\n&quot;);</span>
<a href="#l16.339"></a><span id="l16.339" class="difflineplus">+    }</span>
<a href="#l16.340"></a><span id="l16.340" class="difflineplus">+  },</span>
<a href="#l16.341"></a><span id="l16.341" class="difflineplus">+</span>
<a href="#l16.342"></a><span id="l16.342" class="difflineplus">+  _showAccountManagement: function CFT__showAccountManagement(aProvider) {</span>
<a href="#l16.343"></a><span id="l16.343" class="difflineplus">+    let iframe = document.createElement('iframe');</span>
<a href="#l16.344"></a><span id="l16.344" class="difflineplus">+</span>
<a href="#l16.345"></a><span id="l16.345" class="difflineplus">+    iframe.setAttribute(&quot;src&quot;, aProvider.managementURL);</span>
<a href="#l16.346"></a><span id="l16.346" class="difflineplus">+    iframe.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l16.347"></a><span id="l16.347" class="difflineplus">+</span>
<a href="#l16.348"></a><span id="l16.348" class="difflineplus">+    // If we have a past iframe, we replace it.  Else, append</span>
<a href="#l16.349"></a><span id="l16.349" class="difflineplus">+    // to the wrapper.</span>
<a href="#l16.350"></a><span id="l16.350" class="difflineplus">+    if (this._settings &amp;&amp; this._settings.parentNode)</span>
<a href="#l16.351"></a><span id="l16.351" class="difflineplus">+      this._settings.parentNode.removeChild(this._settings);</span>
<a href="#l16.352"></a><span id="l16.352" class="difflineplus">+</span>
<a href="#l16.353"></a><span id="l16.353" class="difflineplus">+    this._settingsPanelWrap.appendChild(iframe);</span>
<a href="#l16.354"></a><span id="l16.354" class="difflineplus">+    this._settings = iframe;</span>
<a href="#l16.355"></a><span id="l16.355" class="difflineplus">+</span>
<a href="#l16.356"></a><span id="l16.356" class="difflineplus">+    // When the iframe loads, populate it with the provider.</span>
<a href="#l16.357"></a><span id="l16.357" class="difflineplus">+    this._settings.contentWindow</span>
<a href="#l16.358"></a><span id="l16.358" class="difflineplus">+                  .addEventListener(&quot;load&quot;, function(e) {</span>
<a href="#l16.359"></a><span id="l16.359" class="difflineplus">+</span>
<a href="#l16.360"></a><span id="l16.360" class="difflineplus">+      iframe.contentWindow.removeEventListener(&quot;load&quot;,</span>
<a href="#l16.361"></a><span id="l16.361" class="difflineplus">+                                               arguments.callee,</span>
<a href="#l16.362"></a><span id="l16.362" class="difflineplus">+                                               false);</span>
<a href="#l16.363"></a><span id="l16.363" class="difflineplus">+      try {</span>
<a href="#l16.364"></a><span id="l16.364" class="difflineplus">+        iframe.contentWindow</span>
<a href="#l16.365"></a><span id="l16.365" class="difflineplus">+              .wrappedJSObject</span>
<a href="#l16.366"></a><span id="l16.366" class="difflineplus">+              .onLoadProvider(aProvider);</span>
<a href="#l16.367"></a><span id="l16.367" class="difflineplus">+      } catch(e) {</span>
<a href="#l16.368"></a><span id="l16.368" class="difflineplus">+        Components.utils.reportError(e);</span>
<a href="#l16.369"></a><span id="l16.369" class="difflineplus">+      }</span>
<a href="#l16.370"></a><span id="l16.370" class="difflineplus">+    }, false);</span>
<a href="#l16.371"></a><span id="l16.371" class="difflineplus">+</span>
<a href="#l16.372"></a><span id="l16.372" class="difflineplus">+    // When the iframe (or any subcontent) fires the DOMContentLoaded event,</span>
<a href="#l16.373"></a><span id="l16.373" class="difflineplus">+    // attach the _onClickLink handler to any anchor elements that we can find.</span>
<a href="#l16.374"></a><span id="l16.374" class="difflineplus">+    this._settings.contentWindow</span>
<a href="#l16.375"></a><span id="l16.375" class="difflineplus">+                  .addEventListener(&quot;DOMContentLoaded&quot;, function(e) {</span>
<a href="#l16.376"></a><span id="l16.376" class="difflineplus">+</span>
<a href="#l16.377"></a><span id="l16.377" class="difflineplus">+      iframe.contentWindow.removeEventListener(&quot;DOMContentLoaded&quot;,</span>
<a href="#l16.378"></a><span id="l16.378" class="difflineplus">+                                               arguments.callee,</span>
<a href="#l16.379"></a><span id="l16.379" class="difflineplus">+                                               false);</span>
<a href="#l16.380"></a><span id="l16.380" class="difflineplus">+</span>
<a href="#l16.381"></a><span id="l16.381" class="difflineplus">+      let doc = e.originalTarget;</span>
<a href="#l16.382"></a><span id="l16.382" class="difflineplus">+      let links = doc.getElementsByTagName(&quot;a&quot;);</span>
<a href="#l16.383"></a><span id="l16.383" class="difflineplus">+</span>
<a href="#l16.384"></a><span id="l16.384" class="difflineplus">+      for (let [, link] in Iterator(links))</span>
<a href="#l16.385"></a><span id="l16.385" class="difflineplus">+        link.addEventListener(&quot;click&quot;, gCloudFileTab._onClickLink);</span>
<a href="#l16.386"></a><span id="l16.386" class="difflineplus">+</span>
<a href="#l16.387"></a><span id="l16.387" class="difflineplus">+    }, false);</span>
<a href="#l16.388"></a><span id="l16.388" class="difflineplus">+</span>
<a href="#l16.389"></a><span id="l16.389" class="difflineplus">+    CommandUpdate_CloudFile();</span>
<a href="#l16.390"></a><span id="l16.390" class="difflineplus">+  },</span>
<a href="#l16.391"></a><span id="l16.391" class="difflineplus">+</span>
<a href="#l16.392"></a><span id="l16.392" class="difflineplus">+  _onClickLink: function CFT__onClickLink(aEvent) {</span>
<a href="#l16.393"></a><span id="l16.393" class="difflineplus">+    aEvent.preventDefault();</span>
<a href="#l16.394"></a><span id="l16.394" class="difflineplus">+    let href = aEvent.target.getAttribute(&quot;href&quot;);</span>
<a href="#l16.395"></a><span id="l16.395" class="difflineplus">+    openLinkExternally(href);</span>
<a href="#l16.396"></a><span id="l16.396" class="difflineplus">+  },</span>
<a href="#l16.397"></a><span id="l16.397" class="difflineplus">+</span>
<a href="#l16.398"></a><span id="l16.398" class="difflineplus">+  authSelected: function CFT_authSelected() {</span>
<a href="#l16.399"></a><span id="l16.399" class="difflineplus">+    let item = this._list.selectedItem;</span>
<a href="#l16.400"></a><span id="l16.400" class="difflineplus">+</span>
<a href="#l16.401"></a><span id="l16.401" class="difflineplus">+    if (!item)</span>
<a href="#l16.402"></a><span id="l16.402" class="difflineplus">+      return;</span>
<a href="#l16.403"></a><span id="l16.403" class="difflineplus">+</span>
<a href="#l16.404"></a><span id="l16.404" class="difflineplus">+    this.requestUserInfoForItem(item, true);</span>
<a href="#l16.405"></a><span id="l16.405" class="difflineplus">+  },</span>
<a href="#l16.406"></a><span id="l16.406" class="difflineplus">+</span>
<a href="#l16.407"></a><span id="l16.407" class="difflineplus">+  addCloudFileAccount: function CFT_addCloudFileAccount() {</span>
<a href="#l16.408"></a><span id="l16.408" class="difflineplus">+    let accountKey = cloudFileAccounts.addAccountDialog();</span>
<a href="#l16.409"></a><span id="l16.409" class="difflineplus">+    if (accountKey)</span>
<a href="#l16.410"></a><span id="l16.410" class="difflineplus">+      this.rebuildView();</span>
<a href="#l16.411"></a><span id="l16.411" class="difflineplus">+</span>
<a href="#l16.412"></a><span id="l16.412" class="difflineplus">+    let newItem = this._list.querySelector(&quot;richlistitem[value='&quot; + accountKey + &quot;']&quot;);</span>
<a href="#l16.413"></a><span id="l16.413" class="difflineplus">+    this._list.selectItem(newItem);</span>
<a href="#l16.414"></a><span id="l16.414" class="difflineplus">+  },</span>
<a href="#l16.415"></a><span id="l16.415" class="difflineplus">+</span>
<a href="#l16.416"></a><span id="l16.416" class="difflineplus">+  removeCloudFileAccount: function CFT_removeCloudFileAccount() {</span>
<a href="#l16.417"></a><span id="l16.417" class="difflineplus">+    // Get the selected account key</span>
<a href="#l16.418"></a><span id="l16.418" class="difflineplus">+    let selection = this._list.selectedItem;</span>
<a href="#l16.419"></a><span id="l16.419" class="difflineplus">+    if (!selection)</span>
<a href="#l16.420"></a><span id="l16.420" class="difflineplus">+      return;</span>
<a href="#l16.421"></a><span id="l16.421" class="difflineplus">+</span>
<a href="#l16.422"></a><span id="l16.422" class="difflineplus">+    let accountKey = selection.value;</span>
<a href="#l16.423"></a><span id="l16.423" class="difflineplus">+    let accountName = cloudFileAccounts.getDisplayName(accountKey);</span>
<a href="#l16.424"></a><span id="l16.424" class="difflineplus">+    // Does the user really want to remove this account?</span>
<a href="#l16.425"></a><span id="l16.425" class="difflineplus">+    let confirmMessage = this._strings</span>
<a href="#l16.426"></a><span id="l16.426" class="difflineplus">+                             .formatStringFromName(&quot;dialog_removeAccount&quot;,</span>
<a href="#l16.427"></a><span id="l16.427" class="difflineplus">+                                                   [accountName], 1);</span>
<a href="#l16.428"></a><span id="l16.428" class="difflineplus">+</span>
<a href="#l16.429"></a><span id="l16.429" class="difflineplus">+    if (confirm(confirmMessage)) {</span>
<a href="#l16.430"></a><span id="l16.430" class="difflineplus">+      this._list.clearSelection();</span>
<a href="#l16.431"></a><span id="l16.431" class="difflineplus">+      cloudFileAccounts.removeAccount(accountKey);</span>
<a href="#l16.432"></a><span id="l16.432" class="difflineplus">+      this.rebuildView();</span>
<a href="#l16.433"></a><span id="l16.433" class="difflineplus">+      this._settingsDeck.selectedPanel = this._defaultPanel;</span>
<a href="#l16.434"></a><span id="l16.434" class="difflineplus">+      delete this._accountCache[accountKey];</span>
<a href="#l16.435"></a><span id="l16.435" class="difflineplus">+      // For some reason, the focus event isn't fired, so I think</span>
<a href="#l16.436"></a><span id="l16.436" class="difflineplus">+      // we have to update the buttons manually...</span>
<a href="#l16.437"></a><span id="l16.437" class="difflineplus">+      CommandUpdate_CloudFile();</span>
<a href="#l16.438"></a><span id="l16.438" class="difflineplus">+    }</span>
<a href="#l16.439"></a><span id="l16.439" class="difflineplus">+  },</span>
<a href="#l16.440"></a><span id="l16.440" class="difflineplus">+</span>
<a href="#l16.441"></a><span id="l16.441" class="difflineplus">+  handleEvent: function CFT_handleEvent(aEvent) {</span>
<a href="#l16.442"></a><span id="l16.442" class="difflineplus">+    if (aEvent.type == &quot;unload&quot;)</span>
<a href="#l16.443"></a><span id="l16.443" class="difflineplus">+      this.destroy();</span>
<a href="#l16.444"></a><span id="l16.444" class="difflineplus">+  },</span>
<a href="#l16.445"></a><span id="l16.445" class="difflineplus">+</span>
<a href="#l16.446"></a><span id="l16.446" class="difflineplus">+  readThreshold: function CFT_readThreshold() {</span>
<a href="#l16.447"></a><span id="l16.447" class="difflineplus">+    let pref = document.getElementById(&quot;mail.compose.big_attachments.threshold_kb&quot;);</span>
<a href="#l16.448"></a><span id="l16.448" class="difflineplus">+    return pref.value / 1024;</span>
<a href="#l16.449"></a><span id="l16.449" class="difflineplus">+  },</span>
<a href="#l16.450"></a><span id="l16.450" class="difflineplus">+</span>
<a href="#l16.451"></a><span id="l16.451" class="difflineplus">+  writeThreshold: function CFT_writeThreshold() {</span>
<a href="#l16.452"></a><span id="l16.452" class="difflineplus">+    let threshold = document.getElementById(&quot;cloudFileThreshold&quot;);</span>
<a href="#l16.453"></a><span id="l16.453" class="difflineplus">+    let intValue = parseInt(threshold.value, 10);</span>
<a href="#l16.454"></a><span id="l16.454" class="difflineplus">+    return isNaN(intValue) ? 0 : intValue * 1024;</span>
<a href="#l16.455"></a><span id="l16.455" class="difflineplus">+  },</span>
<a href="#l16.456"></a><span id="l16.456" class="difflineplus">+</span>
<a href="#l16.457"></a><span id="l16.457" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Components.interfaces</span>
<a href="#l16.458"></a><span id="l16.458" class="difflineplus">+                                                   .nsIObserver,</span>
<a href="#l16.459"></a><span id="l16.459" class="difflineplus">+                                         Components.interfaces</span>
<a href="#l16.460"></a><span id="l16.460" class="difflineplus">+                                                   .nsISupportsWeakReference]),</span>
<a href="#l16.461"></a><span id="l16.461" class="difflineplus">+</span>
<a href="#l16.462"></a><span id="l16.462" class="difflineplus">+}</span>
<a href="#l16.463"></a><span id="l16.463" class="difflineplus">+</span>
<a href="#l16.464"></a><span id="l16.464"> //****************************************************************************//</span>
<a href="#l16.465"></a><span id="l16.465"> // Prefpane Controller</span>
<a href="#l16.466"></a><span id="l16.466"> </span>
<a href="#l16.467"></a><span id="l16.467"> var gApplicationsPane = {</span>
<a href="#l16.468"></a><span id="l16.468">   // The set of types the app knows how to handle.  A hash of HandlerInfoWrapper</span>
<a href="#l16.469"></a><span id="l16.469">   // objects, indexed by type.</span>
<a href="#l16.470"></a><span id="l16.470">   _handledTypes: {},</span>
<a href="#l16.471"></a><span id="l16.471"> </span>
<a href="#l16.472"></a><span id="l16.472" class="difflineat">@@ -913,16 +1348,20 @@ var gApplicationsPane = {</span>
<a href="#l16.473"></a><span id="l16.473">   },</span>
<a href="#l16.474"></a><span id="l16.474"> </span>
<a href="#l16.475"></a><span id="l16.475">   /**</span>
<a href="#l16.476"></a><span id="l16.476">    * Rebuild the actions menu for the selected entry.  Gets called by</span>
<a href="#l16.477"></a><span id="l16.477">    * the richlistitem constructor when an entry in the list gets selected.</span>
<a href="#l16.478"></a><span id="l16.478">    */</span>
<a href="#l16.479"></a><span id="l16.479">   rebuildActionsMenu: function() {</span>
<a href="#l16.480"></a><span id="l16.480">     var typeItem = this._list.selectedItem;</span>
<a href="#l16.481"></a><span id="l16.481" class="difflineplus">+</span>
<a href="#l16.482"></a><span id="l16.482" class="difflineplus">+    if (!typeItem)</span>
<a href="#l16.483"></a><span id="l16.483" class="difflineplus">+      return;</span>
<a href="#l16.484"></a><span id="l16.484" class="difflineplus">+</span>
<a href="#l16.485"></a><span id="l16.485">     var handlerInfo = this._handledTypes[typeItem.type];</span>
<a href="#l16.486"></a><span id="l16.486">     var menu =</span>
<a href="#l16.487"></a><span id="l16.487">       document.getAnonymousElementByAttribute(typeItem, &quot;class&quot;, &quot;actionsMenu&quot;);</span>
<a href="#l16.488"></a><span id="l16.488">     var menuPopup = menu.menupopup;</span>
<a href="#l16.489"></a><span id="l16.489"> </span>
<a href="#l16.490"></a><span id="l16.490">     // Clear out existing items.</span>
<a href="#l16.491"></a><span id="l16.491">     while (menuPopup.hasChildNodes())</span>
<a href="#l16.492"></a><span id="l16.492">       menuPopup.removeChild(menuPopup.lastChild);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/components/preferences/applications.xul</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/components/preferences/applications.xul</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -46,19 +46,24 @@</span>
<a href="#l17.4"></a><span id="l17.4">   %brandDTD;</span>
<a href="#l17.5"></a><span id="l17.5">   %applicationsDTD;</span>
<a href="#l17.6"></a><span id="l17.6"> ]&gt;</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8"> &lt;overlay id=&quot;ApplicationsPaneOverlay&quot;</span>
<a href="#l17.9"></a><span id="l17.9">          xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">   &lt;prefpane id=&quot;paneApplications&quot;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-            onpaneload=&quot;gApplicationsPane.init();&quot;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+            onpaneload=&quot;gApplicationsTabController.init();&quot;</span>
<a href="#l17.14"></a><span id="l17.14">             flex=&quot;1&quot;&gt;</span>
<a href="#l17.15"></a><span id="l17.15"> </span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+    &lt;preferences id=&quot;applicationsPreferences&quot;&gt;</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+      &lt;preference id=&quot;mail.preferences.applications.selectedTabIndex&quot;</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+                  name=&quot;mail.preferences.applications.selectedTabIndex&quot; type=&quot;int&quot;/&gt;</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+    &lt;/preferences&gt;</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+</span>
<a href="#l17.21"></a><span id="l17.21">     &lt;preferences id=&quot;downloadDirPreferences&quot;&gt;</span>
<a href="#l17.22"></a><span id="l17.22">       &lt;preference id=&quot;browser.download.useDownloadDir&quot;</span>
<a href="#l17.23"></a><span id="l17.23">                   name=&quot;browser.download.useDownloadDir&quot;</span>
<a href="#l17.24"></a><span id="l17.24">                   type=&quot;bool&quot;/&gt;</span>
<a href="#l17.25"></a><span id="l17.25">       &lt;preference id=&quot;browser.download.folderList&quot;</span>
<a href="#l17.26"></a><span id="l17.26">                   name=&quot;browser.download.folderList&quot;</span>
<a href="#l17.27"></a><span id="l17.27">                   type=&quot;int&quot;/&gt;</span>
<a href="#l17.28"></a><span id="l17.28">       &lt;preference id=&quot;browser.download.downloadDir&quot;</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineat">@@ -68,89 +73,189 @@</span>
<a href="#l17.30"></a><span id="l17.30">                   name=&quot;browser.download.dir&quot;</span>
<a href="#l17.31"></a><span id="l17.31">                   type=&quot;file&quot;</span>
<a href="#l17.32"></a><span id="l17.32">                   onchange=&quot;gDownloadDirSection.readDownloadDirPref();&quot;/&gt;</span>
<a href="#l17.33"></a><span id="l17.33">       &lt;preference id=&quot;pref.downloads.disable_button.edit_actions&quot;</span>
<a href="#l17.34"></a><span id="l17.34">                   name=&quot;pref.downloads.disable_button.edit_actions&quot;</span>
<a href="#l17.35"></a><span id="l17.35">                   type=&quot;bool&quot;/&gt;</span>
<a href="#l17.36"></a><span id="l17.36">     &lt;/preferences&gt;</span>
<a href="#l17.37"></a><span id="l17.37"> </span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+    &lt;preferences id=&quot;cloudFilePreferences&quot;&gt;</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+      &lt;preference id=&quot;mail.compose.big_attachments.notify&quot;</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+                  name=&quot;mail.compose.big_attachments.notify&quot;</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+                  type=&quot;bool&quot;/&gt;</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+      &lt;preference id=&quot;mail.compose.big_attachments.threshold_kb&quot;</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+                  name=&quot;mail.compose.big_attachments.threshold_kb&quot;</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+                  type=&quot;int&quot;/&gt;</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+    &lt;/preferences&gt;</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+</span>
<a href="#l17.47"></a><span id="l17.47">     &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l17.48"></a><span id="l17.48">             src=&quot;chrome://messenger/content/preferences/applications.js&quot;/&gt;</span>
<a href="#l17.49"></a><span id="l17.49"> </span>
<a href="#l17.50"></a><span id="l17.50">     &lt;commandset id=&quot;appPaneCommandSet&quot;&gt;</span>
<a href="#l17.51"></a><span id="l17.51">       &lt;command id=&quot;cmd_delete&quot;</span>
<a href="#l17.52"></a><span id="l17.52">                oncommand=&quot;gApplicationsPane.onDelete();&quot;/&gt;</span>
<a href="#l17.53"></a><span id="l17.53">     &lt;/commandset&gt;</span>
<a href="#l17.54"></a><span id="l17.54"> </span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+    &lt;commandset id=&quot;cloudFileCommandSet&quot;&gt;</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+      &lt;commandset id=&quot;cloudFileCommandSetUpdate&quot;</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+                  commandupdater=&quot;true&quot;</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+                  events=&quot;focus&quot;</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+                  oncommandupdate=&quot;CommandUpdate_CloudFile()&quot;/&gt;</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+      &lt;command id=&quot;cmd_addCloudfileAccount&quot;</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+               oncommand=&quot;goDoCommand('cmd_addCloudfileAccount');&quot;/&gt;</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+      &lt;command id=&quot;cmd_removeCloudfileAccount&quot;</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+               oncommand=&quot;goDoCommand('cmd_removeCloudfileAccount');&quot;/&gt;</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineplus">+      &lt;command id=&quot;cmd_reauthCloudfileAccount&quot;</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+               oncommand=&quot;goDoCommand('cmd_reauthCloudfileAccount');&quot;/&gt;</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineplus">+    &lt;/commandset&gt;</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+</span>
<a href="#l17.69"></a><span id="l17.69">     &lt;keyset id=&quot;appPaneKeyset&quot;&gt;</span>
<a href="#l17.70"></a><span id="l17.70">       &lt;key keycode=&quot;VK_BACK&quot; modifiers=&quot;any&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l17.71"></a><span id="l17.71">       &lt;key keycode=&quot;VK_DELETE&quot; modifiers=&quot;any&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l17.72"></a><span id="l17.72">     &lt;/keyset&gt;</span>
<a href="#l17.73"></a><span id="l17.73"> </span>
<a href="#l17.74"></a><span id="l17.74">     &lt;keyset&gt;</span>
<a href="#l17.75"></a><span id="l17.75">       &lt;key key=&quot;&amp;focusSearch1.key;&quot; modifiers=&quot;accel&quot;</span>
<a href="#l17.76"></a><span id="l17.76">            oncommand=&quot;gApplicationsPane.focusFilterBox();&quot;/&gt;</span>
<a href="#l17.77"></a><span id="l17.77">       &lt;key key=&quot;&amp;focusSearch2.key;&quot; modifiers=&quot;accel&quot;</span>
<a href="#l17.78"></a><span id="l17.78">            oncommand=&quot;gApplicationsPane.focusFilterBox();&quot;/&gt;</span>
<a href="#l17.79"></a><span id="l17.79">     &lt;/keyset&gt;</span>
<a href="#l17.80"></a><span id="l17.80"> </span>
<a href="#l17.81"></a><span id="l17.81" class="difflineminus">-    &lt;hbox&gt;</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineminus">-      &lt;textbox id=&quot;filter&quot; flex=&quot;1&quot;</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineminus">-               type=&quot;search&quot;</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineminus">-               placeholder=&quot;&amp;filter.placeholder;&quot;</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineminus">-               aria-controls=&quot;handlersView&quot;</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineminus">-               oncommand=&quot;gApplicationsPane.rebuildView();&quot;/&gt;</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineminus">-    &lt;/hbox&gt;</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineplus">+    &lt;tabbox id=&quot;attachmentPrefs&quot; flex=&quot;1&quot; onselect=&quot;gApplicationsTabController.tabSelectionChanged();&quot;&gt;</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineplus">+      &lt;tabs id=&quot;attachmentPrefsTabs&quot;&gt;</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineplus">+        &lt;tab label=&quot;&amp;attachments.incoming.label;&quot;/&gt;</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineplus">+        &lt;tab label=&quot;&amp;attachments.outgoing.label;&quot;/&gt;</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineplus">+      &lt;/tabs&gt;</span>
<a href="#l17.94"></a><span id="l17.94"> </span>
<a href="#l17.95"></a><span id="l17.95" class="difflineminus">-    &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineplus">+      &lt;tabpanels flex=&quot;1&quot;&gt;</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineplus">+        &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineplus">+          &lt;hbox&gt;</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineplus">+            &lt;textbox id=&quot;filter&quot; flex=&quot;1&quot;</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineplus">+                     type=&quot;search&quot;</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineplus">+                     placeholder=&quot;&amp;filter.placeholder;&quot;</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineplus">+                     aria-controls=&quot;handlersView&quot;</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineplus">+                     oncommand=&quot;gApplicationsPane.rebuildView();&quot;/&gt;</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineplus">+</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+          &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l17.107"></a><span id="l17.107"> </span>
<a href="#l17.108"></a><span id="l17.108" class="difflineminus">-    &lt;richlistbox id=&quot;handlersView&quot; orient=&quot;vertical&quot; persist=&quot;lastSelectedType&quot;</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineminus">-                 preference=&quot;pref.downloads.disable_button.edit_actions&quot;</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineminus">-                 onselect=&quot;gApplicationsPane.onSelectionChanged();&quot;&gt;</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineminus">-      &lt;listheader equalsize=&quot;always&quot; style=&quot;border: 0; padding: 0; -moz-appearance: none;&quot;&gt;</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineminus">-        &lt;treecol id=&quot;typeColumn&quot; label=&quot;&amp;typeColumn.label;&quot; value=&quot;type&quot;</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineminus">-                 accesskey=&quot;&amp;typeColumn.accesskey;&quot; persist=&quot;sortDirection&quot;</span>
<a href="#l17.114"></a><span id="l17.114" class="difflineminus">-                 flex=&quot;1&quot; onclick=&quot;gApplicationsPane.sort(event);&quot;</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineminus">-                 sortDirection=&quot;ascending&quot; sort=&quot;typeDescription&quot;/&gt;</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineminus">-        &lt;treecol id=&quot;actionColumn&quot; label=&quot;&amp;actionColumn2.label;&quot; value=&quot;action&quot;</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineminus">-                 accesskey=&quot;&amp;actionColumn2.accesskey;&quot; persist=&quot;sortDirection&quot;</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineminus">-                 flex=&quot;1&quot; onclick=&quot;gApplicationsPane.sort(event);&quot;/&gt;</span>
<a href="#l17.119"></a><span id="l17.119" class="difflineminus">-      &lt;/listheader&gt;</span>
<a href="#l17.120"></a><span id="l17.120" class="difflineminus">-    &lt;/richlistbox&gt;</span>
<a href="#l17.121"></a><span id="l17.121" class="difflineplus">+          &lt;richlistbox id=&quot;handlersView&quot; orient=&quot;vertical&quot; persist=&quot;lastSelectedType&quot;</span>
<a href="#l17.122"></a><span id="l17.122" class="difflineplus">+                       preference=&quot;pref.downloads.disable_button.edit_actions&quot;</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineplus">+                       onselect=&quot;gApplicationsPane.onSelectionChanged();&quot;&gt;</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineplus">+            &lt;listheader equalsize=&quot;always&quot; style=&quot;border: 0; padding: 0; -moz-appearance: none;&quot;&gt;</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineplus">+              &lt;treecol id=&quot;typeColumn&quot; label=&quot;&amp;typeColumn.label;&quot; value=&quot;type&quot;</span>
<a href="#l17.126"></a><span id="l17.126" class="difflineplus">+                       accesskey=&quot;&amp;typeColumn.accesskey;&quot; persist=&quot;sortDirection&quot;</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineplus">+                       flex=&quot;1&quot; onclick=&quot;gApplicationsPane.sort(event);&quot;</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineplus">+                       sortDirection=&quot;ascending&quot; sort=&quot;typeDescription&quot;/&gt;</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineplus">+              &lt;treecol id=&quot;actionColumn&quot; label=&quot;&amp;actionColumn2.label;&quot; value=&quot;action&quot;</span>
<a href="#l17.130"></a><span id="l17.130" class="difflineplus">+                       accesskey=&quot;&amp;actionColumn2.accesskey;&quot; persist=&quot;sortDirection&quot;</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineplus">+                       flex=&quot;1&quot; onclick=&quot;gApplicationsPane.sort(event);&quot;/&gt;</span>
<a href="#l17.132"></a><span id="l17.132" class="difflineplus">+            &lt;/listheader&gt;</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineplus">+          &lt;/richlistbox&gt;</span>
<a href="#l17.134"></a><span id="l17.134"> </span>
<a href="#l17.135"></a><span id="l17.135" class="difflineminus">-    &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l17.136"></a><span id="l17.136" class="difflineplus">+          &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l17.137"></a><span id="l17.137"> </span>
<a href="#l17.138"></a><span id="l17.138" class="difflineminus">-    &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l17.139"></a><span id="l17.139" class="difflineminus">-            src=&quot;chrome://messenger/content/preferences/downloads.js&quot;/&gt;</span>
<a href="#l17.140"></a><span id="l17.140" class="difflineplus">+          &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l17.141"></a><span id="l17.141" class="difflineplus">+                  src=&quot;chrome://messenger/content/preferences/downloads.js&quot;/&gt;</span>
<a href="#l17.142"></a><span id="l17.142"> </span>
<a href="#l17.143"></a><span id="l17.143" class="difflineminus">-    &lt;vbox align=&quot;start&quot;&gt;</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineminus">-      &lt;radiogroup id=&quot;saveWhere&quot; flex=&quot;1&quot;</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineminus">-                  preference=&quot;browser.download.useDownloadDir&quot;</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineminus">-                  onsyncfrompreference=&quot;return gDownloadDirSection.onReadUseDownloadDir();&quot;&gt;</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineminus">-      &lt;hbox id=&quot;saveToRow&quot;&gt;</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineminus">-        &lt;radio id=&quot;saveTo&quot; value=&quot;true&quot;</span>
<a href="#l17.149"></a><span id="l17.149" class="difflineminus">-               label=&quot;&amp;saveTo.label;&quot;</span>
<a href="#l17.150"></a><span id="l17.150" class="difflineminus">-               accesskey=&quot;&amp;saveTo.accesskey;&quot;</span>
<a href="#l17.151"></a><span id="l17.151" class="difflineminus">-               aria-labelledby=&quot;saveTo downloadFolder&quot;/&gt;</span>
<a href="#l17.152"></a><span id="l17.152" class="difflineminus">-        &lt;filefield id=&quot;downloadFolder&quot; flex=&quot;1&quot;</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineminus">-                   preference=&quot;browser.download.folderList&quot;</span>
<a href="#l17.154"></a><span id="l17.154" class="difflineminus">-                   preference-editable=&quot;true&quot;</span>
<a href="#l17.155"></a><span id="l17.155" class="difflineminus">-                   aria-labelledby=&quot;saveTo&quot;</span>
<a href="#l17.156"></a><span id="l17.156" class="difflineminus">-                   onsyncfrompreference=&quot;return gDownloadDirSection.readDownloadDirPref();&quot;</span>
<a href="#l17.157"></a><span id="l17.157" class="difflineminus">-                   onsynctopreference=&quot;return gDownloadDirSection.writeFolderList();&quot;/&gt;</span>
<a href="#l17.158"></a><span id="l17.158" class="difflineminus">-        &lt;button id=&quot;chooseFolder&quot; oncommand=&quot;gDownloadDirSection.chooseFolder();&quot;</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineplus">+          &lt;vbox align=&quot;start&quot;&gt;</span>
<a href="#l17.160"></a><span id="l17.160" class="difflineplus">+            &lt;radiogroup id=&quot;saveWhere&quot; flex=&quot;1&quot;</span>
<a href="#l17.161"></a><span id="l17.161" class="difflineplus">+                        preference=&quot;browser.download.useDownloadDir&quot;</span>
<a href="#l17.162"></a><span id="l17.162" class="difflineplus">+                        onsyncfrompreference=&quot;return gDownloadDirSection.onReadUseDownloadDir();&quot;&gt;</span>
<a href="#l17.163"></a><span id="l17.163" class="difflineplus">+            &lt;hbox id=&quot;saveToRow&quot;&gt;</span>
<a href="#l17.164"></a><span id="l17.164" class="difflineplus">+              &lt;radio id=&quot;saveTo&quot; value=&quot;true&quot;</span>
<a href="#l17.165"></a><span id="l17.165" class="difflineplus">+                     label=&quot;&amp;saveTo.label;&quot;</span>
<a href="#l17.166"></a><span id="l17.166" class="difflineplus">+                     accesskey=&quot;&amp;saveTo.accesskey;&quot;</span>
<a href="#l17.167"></a><span id="l17.167" class="difflineplus">+                     aria-labelledby=&quot;saveTo downloadFolder&quot;/&gt;</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineplus">+              &lt;filefield id=&quot;downloadFolder&quot; flex=&quot;1&quot;</span>
<a href="#l17.169"></a><span id="l17.169" class="difflineplus">+                         preference=&quot;browser.download.folderList&quot;</span>
<a href="#l17.170"></a><span id="l17.170" class="difflineplus">+                         preference-editable=&quot;true&quot;</span>
<a href="#l17.171"></a><span id="l17.171" class="difflineplus">+                         aria-labelledby=&quot;saveTo&quot;</span>
<a href="#l17.172"></a><span id="l17.172" class="difflineplus">+                         onsyncfrompreference=&quot;return gDownloadDirSection.readDownloadDirPref();&quot;</span>
<a href="#l17.173"></a><span id="l17.173" class="difflineplus">+                         onsynctopreference=&quot;return gDownloadDirSection.writeFolderList();&quot;/&gt;</span>
<a href="#l17.174"></a><span id="l17.174" class="difflineplus">+              &lt;button id=&quot;chooseFolder&quot; oncommand=&quot;gDownloadDirSection.chooseFolder();&quot;</span>
<a href="#l17.175"></a><span id="l17.175"> #ifdef XP_MACOSX</span>
<a href="#l17.176"></a><span id="l17.176" class="difflineminus">-                accesskey=&quot;&amp;chooseFolderMac.accesskey;&quot;</span>
<a href="#l17.177"></a><span id="l17.177" class="difflineminus">-                label=&quot;&amp;chooseFolderMac.label;&quot;</span>
<a href="#l17.178"></a><span id="l17.178" class="difflineplus">+                      accesskey=&quot;&amp;chooseFolderMac.accesskey;&quot;</span>
<a href="#l17.179"></a><span id="l17.179" class="difflineplus">+                      label=&quot;&amp;chooseFolderMac.label;&quot;</span>
<a href="#l17.180"></a><span id="l17.180"> #else</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineminus">-                accesskey=&quot;&amp;chooseFolderWin.accesskey;&quot;</span>
<a href="#l17.182"></a><span id="l17.182" class="difflineminus">-                label=&quot;&amp;chooseFolderWin.label;&quot;</span>
<a href="#l17.183"></a><span id="l17.183" class="difflineplus">+                      accesskey=&quot;&amp;chooseFolderWin.accesskey;&quot;</span>
<a href="#l17.184"></a><span id="l17.184" class="difflineplus">+                      label=&quot;&amp;chooseFolderWin.label;&quot;</span>
<a href="#l17.185"></a><span id="l17.185"> #endif</span>
<a href="#l17.186"></a><span id="l17.186" class="difflineminus">-                preference=&quot;browser.download.folderList&quot;</span>
<a href="#l17.187"></a><span id="l17.187" class="difflineminus">-                onsynctopreference=&quot;return gDownloadDirSection.writeFolderList();&quot;/&gt;</span>
<a href="#l17.188"></a><span id="l17.188" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l17.189"></a><span id="l17.189" class="difflineminus">-      &lt;radio id=&quot;alwaysAsk&quot; value=&quot;false&quot;</span>
<a href="#l17.190"></a><span id="l17.190" class="difflineminus">-             label=&quot;&amp;alwaysAsk.label;&quot; accesskey=&quot;&amp;alwaysAsk.accesskey;&quot;/&gt;</span>
<a href="#l17.191"></a><span id="l17.191" class="difflineminus">-      &lt;/radiogroup&gt;</span>
<a href="#l17.192"></a><span id="l17.192" class="difflineminus">-    &lt;/vbox&gt;</span>
<a href="#l17.193"></a><span id="l17.193" class="difflineplus">+                      preference=&quot;browser.download.folderList&quot;</span>
<a href="#l17.194"></a><span id="l17.194" class="difflineplus">+                      onsynctopreference=&quot;return gDownloadDirSection.writeFolderList();&quot;/&gt;</span>
<a href="#l17.195"></a><span id="l17.195" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l17.196"></a><span id="l17.196" class="difflineplus">+            &lt;radio id=&quot;alwaysAsk&quot; value=&quot;false&quot;</span>
<a href="#l17.197"></a><span id="l17.197" class="difflineplus">+                   label=&quot;&amp;alwaysAsk.label;&quot; accesskey=&quot;&amp;alwaysAsk.accesskey;&quot;/&gt;</span>
<a href="#l17.198"></a><span id="l17.198" class="difflineplus">+            &lt;/radiogroup&gt;</span>
<a href="#l17.199"></a><span id="l17.199" class="difflineplus">+          &lt;/vbox&gt;</span>
<a href="#l17.200"></a><span id="l17.200" class="difflineplus">+        &lt;/tabpanel&gt;</span>
<a href="#l17.201"></a><span id="l17.201" class="difflineplus">+</span>
<a href="#l17.202"></a><span id="l17.202" class="difflineplus">+        &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l17.203"></a><span id="l17.203" class="difflineplus">+          &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l17.204"></a><span id="l17.204" class="difflineplus">+            &lt;hbox id=&quot;cloudFileToggleAndThreshold&quot; align=&quot;center&quot;&gt;</span>
<a href="#l17.205"></a><span id="l17.205" class="difflineplus">+              &lt;checkbox label=&quot;&amp;enableCloudFileAccountOffer.label;&quot;</span>
<a href="#l17.206"></a><span id="l17.206" class="difflineplus">+                        preference=&quot;mail.compose.big_attachments.notify&quot;/&gt;</span>
<a href="#l17.207"></a><span id="l17.207" class="difflineplus">+              &lt;textbox id=&quot;cloudFileThreshold&quot; type=&quot;number&quot; increment=&quot;1&quot;</span>
<a href="#l17.208"></a><span id="l17.208" class="difflineplus">+                       maxlength=&quot;4&quot; size=&quot;1&quot;</span>
<a href="#l17.209"></a><span id="l17.209" class="difflineplus">+                       preference=&quot;mail.compose.big_attachments.threshold_kb&quot;</span>
<a href="#l17.210"></a><span id="l17.210" class="difflineplus">+                       onsyncfrompreference=&quot;return gCloudFileTab.readThreshold();&quot;</span>
<a href="#l17.211"></a><span id="l17.211" class="difflineplus">+                       onsynctopreference=&quot;return gCloudFileTab.writeThreshold();&quot;/&gt;</span>
<a href="#l17.212"></a><span id="l17.212" class="difflineplus">+              &lt;label control=&quot;cloudFileThreshold&quot;</span>
<a href="#l17.213"></a><span id="l17.213" class="difflineplus">+                     value=&quot;&amp;enableCloudFileAccountOffer.mb;&quot;/&gt;</span>
<a href="#l17.214"></a><span id="l17.214" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l17.215"></a><span id="l17.215" class="difflineplus">+            &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l17.216"></a><span id="l17.216" class="difflineplus">+              &lt;vbox flex=&quot;1&quot; id=&quot;provider-listing&quot;&gt;</span>
<a href="#l17.217"></a><span id="l17.217" class="difflineplus">+                &lt;richlistbox id=&quot;cloudFileView&quot; orient=&quot;vertical&quot; flex=&quot;1&quot;</span>
<a href="#l17.218"></a><span id="l17.218" class="difflineplus">+                             seltype=&quot;single&quot;</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineplus">+                             onselect=&quot;gCloudFileTab.onSelectionChanged();&quot;&gt;</span>
<a href="#l17.220"></a><span id="l17.220" class="difflineplus">+                &lt;/richlistbox&gt;</span>
<a href="#l17.221"></a><span id="l17.221" class="difflineplus">+                &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l17.222"></a><span id="l17.222" class="difflineplus">+                &lt;hbox&gt;</span>
<a href="#l17.223"></a><span id="l17.223" class="difflineplus">+                  &lt;button id=&quot;addCloudFileAccount&quot; flex=&quot;1&quot; label=&quot;&amp;addCloudFileAccount.label;&quot;</span>
<a href="#l17.224"></a><span id="l17.224" class="difflineplus">+                          accesskey=&quot;&amp;addCloudFileAccount.accesskey;&quot;</span>
<a href="#l17.225"></a><span id="l17.225" class="difflineplus">+                          command=&quot;cmd_addCloudfileAccount&quot;/&gt;</span>
<a href="#l17.226"></a><span id="l17.226" class="difflineplus">+                  &lt;button id=&quot;removeCloudFileAccount&quot; flex=&quot;1&quot;</span>
<a href="#l17.227"></a><span id="l17.227" class="difflineplus">+                          label=&quot;&amp;removeCloudFileAccount.label;&quot;</span>
<a href="#l17.228"></a><span id="l17.228" class="difflineplus">+                          accesskey=&quot;&amp;removeCloudFileAccount.accesskey;&quot;</span>
<a href="#l17.229"></a><span id="l17.229" class="difflineplus">+                          command=&quot;cmd_removeCloudfileAccount&quot;/&gt;</span>
<a href="#l17.230"></a><span id="l17.230" class="difflineplus">+                &lt;/hbox&gt;</span>
<a href="#l17.231"></a><span id="l17.231" class="difflineplus">+              &lt;/vbox&gt;</span>
<a href="#l17.232"></a><span id="l17.232" class="difflineplus">+              &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l17.233"></a><span id="l17.233" class="difflineplus">+                &lt;deck id=&quot;cloudFileSettingsDeck&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l17.234"></a><span id="l17.234" class="difflineplus">+                  &lt;vbox id=&quot;cloudFileDefaultPanel&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l17.235"></a><span id="l17.235" class="difflineplus">+                    &lt;description&gt;&amp;addCloudFileAccount.description;&lt;/description&gt;</span>
<a href="#l17.236"></a><span id="l17.236" class="difflineplus">+                  &lt;/vbox&gt;</span>
<a href="#l17.237"></a><span id="l17.237" class="difflineplus">+                  &lt;vbox id=&quot;cloudFileSettingsWrapper&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l17.238"></a><span id="l17.238" class="difflineplus">+                  &lt;/vbox&gt;</span>
<a href="#l17.239"></a><span id="l17.239" class="difflineplus">+                  &lt;vbox id=&quot;cloudFileLoadingPanel&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l17.240"></a><span id="l17.240" class="difflineplus">+                    &lt;hbox&gt;</span>
<a href="#l17.241"></a><span id="l17.241" class="difflineplus">+                      &lt;spring flex=&quot;1&quot;/&gt;</span>
<a href="#l17.242"></a><span id="l17.242" class="difflineplus">+                        &lt;image id=&quot;cloudFileLoadingSpinner&quot; /&gt;</span>
<a href="#l17.243"></a><span id="l17.243" class="difflineplus">+                      &lt;spring flex=&quot;1&quot;/&gt;</span>
<a href="#l17.244"></a><span id="l17.244" class="difflineplus">+                    &lt;/hbox&gt;</span>
<a href="#l17.245"></a><span id="l17.245" class="difflineplus">+                  &lt;/vbox&gt;</span>
<a href="#l17.246"></a><span id="l17.246" class="difflineplus">+                  &lt;vbox id=&quot;cloudFileAuthErrorPanel&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l17.247"></a><span id="l17.247" class="difflineplus">+                    &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l17.248"></a><span id="l17.248" class="difflineplus">+                    &lt;hbox&gt;</span>
<a href="#l17.249"></a><span id="l17.249" class="difflineplus">+                      &lt;spring flex=&quot;1&quot;/&gt;</span>
<a href="#l17.250"></a><span id="l17.250" class="difflineplus">+                        &lt;image id=&quot;authImage&quot;/&gt;</span>
<a href="#l17.251"></a><span id="l17.251" class="difflineplus">+                      &lt;spring flex=&quot;1&quot;/&gt;</span>
<a href="#l17.252"></a><span id="l17.252" class="difflineplus">+                    &lt;/hbox&gt;</span>
<a href="#l17.253"></a><span id="l17.253" class="difflineplus">+                    &lt;description id=&quot;authMessage&quot;&gt;&amp;authRequired.description;&lt;/description&gt;</span>
<a href="#l17.254"></a><span id="l17.254" class="difflineplus">+                    &lt;hbox&gt;</span>
<a href="#l17.255"></a><span id="l17.255" class="difflineplus">+                      &lt;spring flex=&quot;1&quot;/&gt;</span>
<a href="#l17.256"></a><span id="l17.256" class="difflineplus">+                        &lt;button command=&quot;cmd_reauthCloudfileAccount&quot; label=&quot;&amp;authRequired.button.label;&quot; accesskey=&quot;&amp;authRequired.button.accesskey;&quot;/&gt;</span>
<a href="#l17.257"></a><span id="l17.257" class="difflineplus">+                      &lt;spring flex=&quot;1&quot;/&gt;</span>
<a href="#l17.258"></a><span id="l17.258" class="difflineplus">+                     &lt;/hbox&gt;</span>
<a href="#l17.259"></a><span id="l17.259" class="difflineplus">+                    &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l17.260"></a><span id="l17.260" class="difflineplus">+                  &lt;/vbox&gt;</span>
<a href="#l17.261"></a><span id="l17.261" class="difflineplus">+                &lt;/deck&gt;</span>
<a href="#l17.262"></a><span id="l17.262" class="difflineplus">+              &lt;/vbox&gt;</span>
<a href="#l17.263"></a><span id="l17.263" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l17.264"></a><span id="l17.264" class="difflineplus">+          &lt;/vbox&gt;</span>
<a href="#l17.265"></a><span id="l17.265" class="difflineplus">+        &lt;/tabpanel&gt;</span>
<a href="#l17.266"></a><span id="l17.266" class="difflineplus">+      &lt;/tabpanels&gt;</span>
<a href="#l17.267"></a><span id="l17.267" class="difflineplus">+    &lt;/tabbox&gt;</span>
<a href="#l17.268"></a><span id="l17.268">   &lt;/prefpane&gt;</span>
<a href="#l17.269"></a><span id="l17.269"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/components/preferences/preferences.xul</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/components/preferences/preferences.xul</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -87,16 +87,19 @@</span>
<a href="#l18.4"></a><span id="l18.4"> #else</span>
<a href="#l18.5"></a><span id="l18.5">             style=&quot;&amp;prefWindow.styleGNOME;&quot;&gt;</span>
<a href="#l18.6"></a><span id="l18.6"> #endif</span>
<a href="#l18.7"></a><span id="l18.7"> #endif</span>
<a href="#l18.8"></a><span id="l18.8">   &lt;stringbundle id=&quot;bundleBrand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l18.9"></a><span id="l18.9">   &lt;stringbundle id=&quot;bundlePreferences&quot;</span>
<a href="#l18.10"></a><span id="l18.10">                 src=&quot;chrome://messenger/locale/preferences/preferences.properties&quot;/&gt;</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/contentAreaClick.js&quot;/&gt;</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+</span>
<a href="#l18.15"></a><span id="l18.15">   &lt;prefpane id=&quot;paneGeneral&quot; label=&quot;&amp;paneGeneral.title;&quot;</span>
<a href="#l18.16"></a><span id="l18.16">             src=&quot;chrome://messenger/content/preferences/general.xul&quot;/&gt;</span>
<a href="#l18.17"></a><span id="l18.17">   &lt;prefpane id=&quot;paneDisplay&quot; label=&quot;&amp;paneDisplay.title;&quot;</span>
<a href="#l18.18"></a><span id="l18.18">             src=&quot;chrome://messenger/content/preferences/display.xul&quot;/&gt;</span>
<a href="#l18.19"></a><span id="l18.19">   &lt;prefpane id=&quot;paneCompose&quot; label=&quot;&amp;paneComposition.title;&quot;</span>
<a href="#l18.20"></a><span id="l18.20">             src=&quot;chrome://messenger/content/preferences/compose.xul&quot;/&gt;</span>
<a href="#l18.21"></a><span id="l18.21">   &lt;prefpane id=&quot;paneSecurity&quot; label=&quot;&amp;paneSecurity.title;&quot;</span>
<a href="#l18.22"></a><span id="l18.22">             src=&quot;chrome://messenger/content/preferences/security.xul&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/installer/package-manifest.in</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/installer/package-manifest.in</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -137,16 +137,18 @@</span>
<a href="#l19.4"></a><span id="l19.4"> @BINPATH@/defaults/profile/mimeTypes.rdf</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6"> @BINPATH@/isp/*</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8"> @BINPATH@/components/components.manifest</span>
<a href="#l19.9"></a><span id="l19.9"> @BINPATH@/components/aboutRedirector.js</span>
<a href="#l19.10"></a><span id="l19.10"> @BINPATH@/components/activity.xpt</span>
<a href="#l19.11"></a><span id="l19.11"> @BINPATH@/components/activityComponents.manifest</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+@BINPATH@/components/cloudFileComponents.manifest</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+@BINPATH@/components/cloudfile.xpt</span>
<a href="#l19.14"></a><span id="l19.14"> @BINPATH@/components/addrbook.xpt</span>
<a href="#l19.15"></a><span id="l19.15"> @BINPATH@/components/fts3tok.xpt</span>
<a href="#l19.16"></a><span id="l19.16"> ; interfaces.manifest doesn't get packaged because it is dynamically</span>
<a href="#l19.17"></a><span id="l19.17"> ; re-created at packaging time when linking the xpts that will actually</span>
<a href="#l19.18"></a><span id="l19.18"> ; go into the package, so the test related interfaces aren't included.</span>
<a href="#l19.19"></a><span id="l19.19"> @BINPATH@/components/jetpack.xpt</span>
<a href="#l19.20"></a><span id="l19.20"> @BINPATH@/components/mime.xpt</span>
<a href="#l19.21"></a><span id="l19.21"> @BINPATH@/components/steel.xpt</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -162,16 +164,19 @@</span>
<a href="#l19.23"></a><span id="l19.23"> @BINPATH@/components/import.xpt</span>
<a href="#l19.24"></a><span id="l19.24"> @BINPATH@/components/mailview.xpt</span>
<a href="#l19.25"></a><span id="l19.25"> @BINPATH@/components/mailprofilemigration.xpt</span>
<a href="#l19.26"></a><span id="l19.26"> @BINPATH@/components/messageWakeupService.js</span>
<a href="#l19.27"></a><span id="l19.27"> @BINPATH@/components/messageWakeupService.manifest</span>
<a href="#l19.28"></a><span id="l19.28"> @BINPATH@/components/nsActivity.js</span>
<a href="#l19.29"></a><span id="l19.29"> @BINPATH@/components/nsActivityManager.js</span>
<a href="#l19.30"></a><span id="l19.30"> @BINPATH@/components/nsActivityManagerUI.js</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineplus">+@BINPATH@/components/nsYouSendIt.js</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+@BINPATH@/components/nsDropbox.js</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+@BINPATH@/components/cloudFileAccounts.js</span>
<a href="#l19.34"></a><span id="l19.34"> @BINPATH@/components/nsAddrbook.manifest</span>
<a href="#l19.35"></a><span id="l19.35"> @BINPATH@/components/nsMailNewsCommandLineHandler.js</span>
<a href="#l19.36"></a><span id="l19.36"> @BINPATH@/components/services-crypto-component.xpt</span>
<a href="#l19.37"></a><span id="l19.37"> #ifndef XP_OS2</span>
<a href="#l19.38"></a><span id="l19.38"> @BINPATH@/components/shellservice.xpt</span>
<a href="#l19.39"></a><span id="l19.39"> #endif</span>
<a href="#l19.40"></a><span id="l19.40"> @BINPATH@/components/xpcom_base.xpt</span>
<a href="#l19.41"></a><span id="l19.41"> @BINPATH@/components/xpcom_system.xpt</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">new file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- /dev/null</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/cloudfile/Dropbox/management.dtd</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -0,0 +1,4 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineplus">+   - You can obtain one at http://mozilla.org/MPL/2.0/.  --&gt;</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineplus">+&lt;!ENTITY dropboxMgmt.viewSettings &quot;View my account settings on dropbox.com&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">new file mode 100644</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineminus">--- /dev/null</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/management.dtd</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineat">@@ -0,0 +1,4 @@</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineplus">+   - You can obtain one at http://mozilla.org/MPL/2.0/.  --&gt;</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineplus">+&lt;!ENTITY youSendItMgmt.viewSettings &quot;View my account settings on yousendit.com&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">new file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- /dev/null</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/settings.dtd</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -0,0 +1,5 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineplus">+   - You can obtain one at http://mozilla.org/MPL/2.0/.  --&gt;</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineplus">+&lt;!ENTITY youSendItSettings.username &quot;Username:&quot;&gt;</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineplus">+&lt;!ENTITY youSendItSettings.needAnAccount &quot;Need an account?&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">new file mode 100644</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineminus">--- /dev/null</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/cloudfile/addAccountDialog.dtd</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineat">@@ -0,0 +1,12 @@</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l23.6"></a><span id="l23.6" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineplus">+   - You can obtain one at http://mozilla.org/MPL/2.0/.  --&gt;</span>
<a href="#l23.8"></a><span id="l23.8" class="difflineplus">+&lt;!ENTITY addAccountDialog.title   &quot;Set up Filelink&quot;&gt;</span>
<a href="#l23.9"></a><span id="l23.9" class="difflineplus">+&lt;!ENTITY addAccountDialog.menuTitle &quot;Select an online storage service&quot;&gt;</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineplus">+&lt;!ENTITY addAccountDialog.style &quot;width: 40em; min-height: 20em;&quot;&gt;</span>
<a href="#l23.11"></a><span id="l23.11" class="difflineplus">+&lt;!ENTITY addAccountDialog.accountName.label &quot;Account Name:&quot;&gt;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+&lt;!ENTITY addAccountDialog.noAccountText &quot;We're sorry, but the current version of &amp;brandShortName; only allows one account from each online storage service.&quot;&gt;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+&lt;!ENTITY addAccountDialog.createAccountText &quot;This feature allows you to send large attachments using one of several online storage services. You can either connect to an existing account, or sign up for a new account.&quot;&gt;</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+&lt;!ENTITY addAccountDialog.authorizing &quot;Checking authorization...&quot;&gt;</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+&lt;!ENTITY addAccountDialog.error &quot;An error occurred while setting up the account!&quot;&gt;</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+&lt;!ENTITY addAccountDialog.acceptButton.label &quot;Set up Account&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">new file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- /dev/null</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/cloudfile/management.dtd</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -0,0 +1,8 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineplus">+   - You can obtain one at http://mozilla.org/MPL/2.0/.  --&gt;</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineplus">+&lt;!ENTITY cloudfileMgmt.privacyPolicy &quot;Privacy Policy&quot;&gt;</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineplus">+&lt;!ENTITY cloudfileMgmt.termsOfService &quot;Terms of Service&quot;&gt;</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineplus">+&lt;!ENTITY cloudfileMgmt.usedSpace &quot;Used Space:&quot;&gt;</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineplus">+&lt;!ENTITY cloudfileMgmt.unusedSpace &quot;Unused Space:&quot;&gt;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+&lt;!ENTITY cloudfileMgmt.upgradeOffer &quot;Get more space&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -267,16 +267,20 @@ 12600=Unable to authenticate to SMTP ser</span>
<a href="#l25.4"></a><span id="l25.4"> ## Strings use for the save message dialog shown when the user close a message compose window</span>
<a href="#l25.5"></a><span id="l25.5"> saveDlogTitle=Save Message</span>
<a href="#l25.6"></a><span id="l25.6"> saveDlogMessage=Message has not been sent. Do you want to save the message in the Drafts folder?</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8"> ## generics string</span>
<a href="#l25.9"></a><span id="l25.9"> defaultSubject=(no subject)</span>
<a href="#l25.10"></a><span id="l25.10"> chooseFileToAttach=Attach File(s)</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+# LOCALIZATION NOTE (chooseFileToAttachViaCloud): %1$S is the cloud</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+# provider to save the file to.</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+chooseFileToAttachViaCloud=Attach File(s) via %1$S</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+</span>
<a href="#l25.16"></a><span id="l25.16"> ##</span>
<a href="#l25.17"></a><span id="l25.17"> windowTitlePrefix=Write:</span>
<a href="#l25.18"></a><span id="l25.18"> </span>
<a href="#l25.19"></a><span id="l25.19"> ## Strings used by the empty subject dialog</span>
<a href="#l25.20"></a><span id="l25.20"> subjectEmptyTitle=Subject Reminder</span>
<a href="#l25.21"></a><span id="l25.21"> subjectEmptyMessage=Your message doesn't have a subject.</span>
<a href="#l25.22"></a><span id="l25.22"> sendWithEmptySubjectButton=&amp;Send Without Subject</span>
<a href="#l25.23"></a><span id="l25.23"> cancelSendingButton=&amp;Cancel Sending</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineat">@@ -359,24 +363,102 @@ attachmentReminderMsg=Did you forget to </span>
<a href="#l25.25"></a><span id="l25.25"> # LOCALIZATION NOTE (attachmentReminderKeywordsMsgs): Semi-colon list of plural forms.</span>
<a href="#l25.26"></a><span id="l25.26"> # See: http://developer.mozilla.org/en/Localization_and_Plurals</span>
<a href="#l25.27"></a><span id="l25.27"> # #1 number of keywords</span>
<a href="#l25.28"></a><span id="l25.28"> attachmentReminderKeywordsMsgs=Found an attachment keyword:;Found #1 attachment keywords:</span>
<a href="#l25.29"></a><span id="l25.29"> attachmentReminderOptionsMsg=Attachment reminder words can be configured in your preferences</span>
<a href="#l25.30"></a><span id="l25.30"> attachmentReminderYesIForgot=Oh, I did!</span>
<a href="#l25.31"></a><span id="l25.31"> attachmentReminderFalseAlarm=No, Send Now</span>
<a href="#l25.32"></a><span id="l25.32"> </span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+# LOCALIZATION NOTE (bigFileDescription): Semi-colon list of plural forms.</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+# See: http://developer.mozilla.org/en/Localization_and_Plurals</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+# #1 number of big attached files</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+bigFileDescription=This is a large file. It might be better to use Filelink instead.;These are large files. It might be better to use Filelink instead.</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineplus">+bigFileShare.label=Link</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineplus">+bigFileShare.accesskey=l</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineplus">+bigFileAttach.label=Ignore</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineplus">+bigFileAttach.accesskey=i</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineplus">+</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineplus">+bigFileChooseAccount.title=Choose Account</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineplus">+bigFileChooseAccount.text=Choose a cloud account to upload the attachment to</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineplus">+</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineplus">+bigFileHideNotification.title=Don't Upload My Files</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineplus">+bigFileHideNotification.text=You won't be notified if you attach more big files to this message.</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineplus">+bigFileHideNotification.check=Never notify me of this again.</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineplus">+</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineplus">+# LOCALIZATION NOTE(cloudFileUploadingTooltip): Do not translate the string</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineplus">+# %S. %S is the display name for the cloud account the attachment is being</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineplus">+# uploaded to.</span>
<a href="#l25.52"></a><span id="l25.52" class="difflineplus">+cloudFileUploadingTooltip=Uploading to %S</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineplus">+# LOCALIZATION NOTE(cloudFileUploadedTooltip): Do not translate the string</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineplus">+# %S. %S is the display name for the cloud account the attachment was uploaded</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineplus">+# to.</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineplus">+cloudFileUploadedTooltip=Uploaded to %S</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineplus">+cloudFileUploadingNotification=Your file is being linked. It will appear in the body of the message when it's done.;Your files are being linked. They will appear in the body of the message when they're done.</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineplus">+cloudFileUploadingCancel.label=Cancel</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineplus">+cloudFileUploadingCancel.accesskey=c</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineplus">+</span>
<a href="#l25.61"></a><span id="l25.61"> ## LOCALIZATION NOTE(smtpEnterPasswordPrompt): Do not translate the</span>
<a href="#l25.62"></a><span id="l25.62"> ## word $S. Place the word $S where the host name should appear.</span>
<a href="#l25.63"></a><span id="l25.63"> smtpEnterPasswordPrompt=Enter your password for %S:</span>
<a href="#l25.64"></a><span id="l25.64"> ## LOCALIZATION NOTE(smtpEnterPasswordPromptWithUsername): Do not translate the</span>
<a href="#l25.65"></a><span id="l25.65"> ## words %1$S and %2$S. Place the word %1$S where the host name should appear,</span>
<a href="#l25.66"></a><span id="l25.66"> ## and %2$S where the user name should appear.</span>
<a href="#l25.67"></a><span id="l25.67"> smtpEnterPasswordPromptWithUsername=Enter your password for %2$S on %1$S:</span>
<a href="#l25.68"></a><span id="l25.68"> smtpEnterPasswordPromptTitle=SMTP Server Password Required</span>
<a href="#l25.69"></a><span id="l25.69"> </span>
<a href="#l25.70"></a><span id="l25.70"> # LOCALIZATION NOTE (removeAttachmentMsgs): Semi-colon list of plural forms.</span>
<a href="#l25.71"></a><span id="l25.71"> # See: http://developer.mozilla.org/en/Localization_and_Plurals</span>
<a href="#l25.72"></a><span id="l25.72"> removeAttachmentMsgs=Remove Attachment;Remove Attachments</span>
<a href="#l25.73"></a><span id="l25.73"> </span>
<a href="#l25.74"></a><span id="l25.74"> ## LOCALIZATION NOTE(errorSavingMsg): Do not translate the word %S. It</span>
<a href="#l25.75"></a><span id="l25.75"> ## will be replaced with the name of the folder the message is being saved to.</span>
<a href="#l25.76"></a><span id="l25.76"> errorSavingMsg=There was an error saving the message to %S. Retry?</span>
<a href="#l25.77"></a><span id="l25.77" class="difflineplus">+</span>
<a href="#l25.78"></a><span id="l25.78" class="difflineplus">+errorCloudFileAuth.title=Authentication Error</span>
<a href="#l25.79"></a><span id="l25.79" class="difflineplus">+## LOCALIZATION NOTE(errorCloudFileAuth.message):</span>
<a href="#l25.80"></a><span id="l25.80" class="difflineplus">+## %1$S is the name of the online storage service that authentication failed against.</span>
<a href="#l25.81"></a><span id="l25.81" class="difflineplus">+errorCloudFileAuth.message=Unable to authenticate to %1$S.</span>
<a href="#l25.82"></a><span id="l25.82" class="difflineplus">+errorCloudFileUpload.title=Upload Error</span>
<a href="#l25.83"></a><span id="l25.83" class="difflineplus">+## LOCALIZATION NOTE(errorCloudFileUpload.message):</span>
<a href="#l25.84"></a><span id="l25.84" class="difflineplus">+## %1$S is the name of the online storage service that uploading failed against.</span>
<a href="#l25.85"></a><span id="l25.85" class="difflineplus">+## %2$S is the name of the file that failed to upload.</span>
<a href="#l25.86"></a><span id="l25.86" class="difflineplus">+errorCloudFileUpload.message=Unable to upload %2$S to %1$S.</span>
<a href="#l25.87"></a><span id="l25.87" class="difflineplus">+errorCloudFileQuota.title=Quota Error</span>
<a href="#l25.88"></a><span id="l25.88" class="difflineplus">+## LOCALIZATION NOTE(errorCloudFileQuota.message):</span>
<a href="#l25.89"></a><span id="l25.89" class="difflineplus">+## %1$S is the name of the online storage service being uploaded to.</span>
<a href="#l25.90"></a><span id="l25.90" class="difflineplus">+## %2$S is the name of the file that could not be uploaded due to exceeding the storage limit.</span>
<a href="#l25.91"></a><span id="l25.91" class="difflineplus">+errorCloudFileQuota.message=Uploading %2$S to %1$S would exceed your space quota.</span>
<a href="#l25.92"></a><span id="l25.92" class="difflineplus">+errorCloudFileLimit.title=File Size Error</span>
<a href="#l25.93"></a><span id="l25.93" class="difflineplus">+## LOCALIZATION NOTE(errorCloudFileLimit.message):</span>
<a href="#l25.94"></a><span id="l25.94" class="difflineplus">+## %1$S is the name of the online storage service being uploaded to.</span>
<a href="#l25.95"></a><span id="l25.95" class="difflineplus">+## %2$S is the name of the file that could not be uploaded due to size restrictions.</span>
<a href="#l25.96"></a><span id="l25.96" class="difflineplus">+errorCloudFileLimit.message=%2$S exceeds the maximum size for %1$S.</span>
<a href="#l25.97"></a><span id="l25.97" class="difflineplus">+errorCloudFileOther.title=Unknown Error</span>
<a href="#l25.98"></a><span id="l25.98" class="difflineplus">+## LOCALIZATION NOTE(errorCloudFileOther.message):</span>
<a href="#l25.99"></a><span id="l25.99" class="difflineplus">+## %1$S is the name of the online storage service that cannot be communicated with.</span>
<a href="#l25.100"></a><span id="l25.100" class="difflineplus">+errorCloudFileOther.message=An unknown error occurred when communicating with %1$S.</span>
<a href="#l25.101"></a><span id="l25.101" class="difflineplus">+errorCloudFileDeletion.title=Deletion Error</span>
<a href="#l25.102"></a><span id="l25.102" class="difflineplus">+## LOCALIZATION NOTE(errorCloudFileDeletion.message):</span>
<a href="#l25.103"></a><span id="l25.103" class="difflineplus">+## %1$S is the name of the online storage service that the file is to be deleted from.</span>
<a href="#l25.104"></a><span id="l25.104" class="difflineplus">+## %2$S is the name of the file that failed to be deleted.</span>
<a href="#l25.105"></a><span id="l25.105" class="difflineplus">+errorCloudFileDeletion.message=There was a problem deleting %2$S from %1$S.</span>
<a href="#l25.106"></a><span id="l25.106" class="difflineplus">+</span>
<a href="#l25.107"></a><span id="l25.107" class="difflineplus">+errorCloudFileUpgrade.label=Upgrade</span>
<a href="#l25.108"></a><span id="l25.108" class="difflineplus">+</span>
<a href="#l25.109"></a><span id="l25.109" class="difflineplus">+## LOCALIZATION NOTE(cloudAttachmentCountHeader): A line of text describing how</span>
<a href="#l25.110"></a><span id="l25.110" class="difflineplus">+## many uploaded files have been appended to this message.  Emphasis should be</span>
<a href="#l25.111"></a><span id="l25.111" class="difflineplus">+## on sharing as opposed to attaching. This item is used as a header to a list,</span>
<a href="#l25.112"></a><span id="l25.112" class="difflineplus">+## hence the colon.  This header is only displayed in HTML emails.</span>
<a href="#l25.113"></a><span id="l25.113" class="difflineplus">+## Using PluralForm (so don't replace the #1).</span>
<a href="#l25.114"></a><span id="l25.114" class="difflineplus">+cloudAttachmentCountHeader=I've linked #1 file to this email:;I've linked #1 files to this email:</span>
<a href="#l25.115"></a><span id="l25.115" class="difflineplus">+</span>
<a href="#l25.116"></a><span id="l25.116" class="difflineplus">+## LOCALIZATION NOTE(cloudAttachmentListFooter): %1$S is a link, whose text</span>
<a href="#l25.117"></a><span id="l25.117" class="difflineplus">+## contents are the brandFullName of this application.</span>
<a href="#l25.118"></a><span id="l25.118" class="difflineplus">+cloudAttachmentListFooter=%1$S makes it easy to share large files over email.</span>
<a href="#l25.119"></a><span id="l25.119" class="difflineplus">+</span>
<a href="#l25.120"></a><span id="l25.120" class="difflineplus">+## LOCALIZATION NOTE(cloudAttachmentListItem): A line of text describing a cloud</span>
<a href="#l25.121"></a><span id="l25.121" class="difflineplus">+## attachment, to be inserted into the message body. Do not translate the words</span>
<a href="#l25.122"></a><span id="l25.122" class="difflineplus">+## %1$S, %2$S, %3$S, or %4$S. %1$S is the attachment name, %2$S is its size,</span>
<a href="#l25.123"></a><span id="l25.123" class="difflineplus">+## %3$S is the name of the cloud storage service, and %4$S is the link to the</span>
<a href="#l25.124"></a><span id="l25.124" class="difflineplus">+## attachment.</span>
<a href="#l25.125"></a><span id="l25.125" class="difflineplus">+cloudAttachmentListItem=* %1$S (%2$S) hosted on %3$S: %4$S</span>
<a href="#l25.126"></a><span id="l25.126" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messengercompose/messengercompose.dtd</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -12,16 +12,18 @@</span>
<a href="#l26.4"></a><span id="l26.4"> &lt;!ENTITY newMessage.accesskey &quot;M&quot;&gt;</span>
<a href="#l26.5"></a><span id="l26.5"> &lt;!ENTITY newContact.label &quot;Address Book Contact&quot;&gt;</span>
<a href="#l26.6"></a><span id="l26.6"> &lt;!ENTITY newContact.accesskey &quot;C&quot;&gt;</span>
<a href="#l26.7"></a><span id="l26.7"> &lt;!ENTITY attachMenu.label &quot;Attach&quot;&gt;</span>
<a href="#l26.8"></a><span id="l26.8"> &lt;!ENTITY attachMenu.accesskey &quot;t&quot;&gt;</span>
<a href="#l26.9"></a><span id="l26.9"> &lt;!ENTITY attachFileCmd.label &quot;File(s)&quot;&gt;</span>
<a href="#l26.10"></a><span id="l26.10"> &lt;!ENTITY attachFileCmd.accesskey &quot;F&quot;&gt;</span>
<a href="#l26.11"></a><span id="l26.11"> &lt;!ENTITY attachFileCmd.key &quot;A&quot;&gt;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+&lt;!ENTITY attachCloudCmd.label &quot;Filelink&quot;&gt;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+&lt;!ENTITY attachCloudCmd.accesskey &quot;i&quot;&gt;</span>
<a href="#l26.14"></a><span id="l26.14"> &lt;!ENTITY attachPageCmd.label &quot;Web Page&quot;&gt;</span>
<a href="#l26.15"></a><span id="l26.15"> &lt;!ENTITY attachPageCmd.accesskey &quot;W&quot;&gt;</span>
<a href="#l26.16"></a><span id="l26.16"> &lt;!--LOCALIZATION NOTE attachVCardCmd.label Don't translate the term 'vCard' --&gt;</span>
<a href="#l26.17"></a><span id="l26.17"> &lt;!ENTITY attachVCardCmd.label &quot;Personal Card (vCard)&quot;&gt;</span>
<a href="#l26.18"></a><span id="l26.18"> &lt;!ENTITY attachVCardCmd.accesskey &quot;P&quot;&gt;</span>
<a href="#l26.19"></a><span id="l26.19"> &lt;!ENTITY closeCmd.label &quot;Close&quot;&gt;</span>
<a href="#l26.20"></a><span id="l26.20"> &lt;!ENTITY closeCmd.key &quot;W&quot;&gt;</span>
<a href="#l26.21"></a><span id="l26.21"> &lt;!ENTITY closeCmd.accesskey &quot;c&quot;&gt;</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -265,16 +267,24 @@</span>
<a href="#l26.23"></a><span id="l26.23"> &lt;!ENTITY removeAttachment.label &quot;Remove Attachment&quot;&gt;</span>
<a href="#l26.24"></a><span id="l26.24"> &lt;!ENTITY removeAttachment.accesskey &quot;M&quot;&gt;</span>
<a href="#l26.25"></a><span id="l26.25"> &lt;!ENTITY renameAttachment.label &quot;Rename&quot;&gt;</span>
<a href="#l26.26"></a><span id="l26.26"> &lt;!ENTITY renameAttachment.accesskey &quot;R&quot;&gt;</span>
<a href="#l26.27"></a><span id="l26.27"> &lt;!ENTITY selectAll.label &quot;Select All&quot;&gt;</span>
<a href="#l26.28"></a><span id="l26.28"> &lt;!ENTITY selectAll.accesskey &quot;A&quot;&gt;</span>
<a href="#l26.29"></a><span id="l26.29"> &lt;!ENTITY attachFile.label &quot;Attach File(s)&quot;&gt;</span>
<a href="#l26.30"></a><span id="l26.30"> &lt;!ENTITY attachFile.accesskey &quot;F&quot;&gt;</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineplus">+&lt;!ENTITY attachCloud.label &quot;Filelink&quot;&gt;</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+&lt;!ENTITY attachCloud.accesskey &quot;i&quot;&gt;</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+&lt;!ENTITY convertCloud.label &quot;Convert to&quot;&gt;</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+&lt;!ENTITY convertCloud.accesskey &quot;C&quot;&gt;</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineplus">+&lt;!ENTITY cancelUpload.label &quot;Cancel Upload&quot;&gt;</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+&lt;!ENTITY cancelUpload.accesskey &quot;n&quot;&gt;</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineplus">+&lt;!ENTITY convertRegularAttachment.label &quot;Regular Attachment&quot;&gt;</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineplus">+&lt;!ENTITY convertRegularAttachment.accesskey &quot;A&quot;&gt;</span>
<a href="#l26.39"></a><span id="l26.39"> &lt;!ENTITY attachPage.label &quot;Attach Web Page&quot;&gt;</span>
<a href="#l26.40"></a><span id="l26.40"> &lt;!ENTITY attachPage.accesskey &quot;W&quot;&gt;</span>
<a href="#l26.41"></a><span id="l26.41"> </span>
<a href="#l26.42"></a><span id="l26.42"> &lt;!-- Spell checker context menu items --&gt;</span>
<a href="#l26.43"></a><span id="l26.43"> &lt;!ENTITY spellAddDictionaries.label &quot;Add Dictionaries&quot;&gt;</span>
<a href="#l26.44"></a><span id="l26.44"> &lt;!ENTITY spellAddDictionaries.accesskey &quot;A&quot;&gt;</span>
<a href="#l26.45"></a><span id="l26.45"> </span>
<a href="#l26.46"></a><span id="l26.46"> &lt;!-- Title for the address picker panel --&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/applications.dtd</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/applications.dtd</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -12,8 +12,23 @@</span>
<a href="#l27.4"></a><span id="l27.4"> &lt;!ENTITY saveTo.label                 &quot;Save files to&quot;&gt;</span>
<a href="#l27.5"></a><span id="l27.5"> &lt;!ENTITY saveTo.accesskey             &quot;S&quot;&gt;</span>
<a href="#l27.6"></a><span id="l27.6"> &lt;!ENTITY alwaysAsk.label              &quot;Always ask me where to save files&quot;&gt;</span>
<a href="#l27.7"></a><span id="l27.7"> &lt;!ENTITY alwaysAsk.accesskey          &quot;A&quot;&gt;</span>
<a href="#l27.8"></a><span id="l27.8"> &lt;!ENTITY chooseFolderWin.label        &quot;Browse&quot;&gt;</span>
<a href="#l27.9"></a><span id="l27.9"> &lt;!ENTITY chooseFolderWin.accesskey    &quot;B&quot;&gt;</span>
<a href="#l27.10"></a><span id="l27.10"> &lt;!ENTITY chooseFolderMac.label        &quot;Choose&quot;&gt;</span>
<a href="#l27.11"></a><span id="l27.11"> &lt;!ENTITY chooseFolderMac.accesskey    &quot;C&quot;&gt;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+&lt;!ENTITY attachments.incoming.label   &quot;Incoming&quot;&gt;</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+&lt;!ENTITY attachments.outgoing.label   &quot;Outgoing&quot;&gt;</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineplus">+&lt;!ENTITY addCloudFileAccount.label        &quot;Add&quot;&gt;</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineplus">+&lt;!ENTITY addCloudFileAccount.accesskey    &quot;A&quot;&gt;</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineplus">+&lt;!ENTITY addCloudFileAccount.description  &quot;Add a new Filelink storage service&quot;&gt;</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineplus">+&lt;!ENTITY removeCloudFileAccount.label     &quot;Remove&quot;&gt;</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineplus">+&lt;!ENTITY removeCloudFileAccount.accesskey &quot;R&quot;&gt;</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineplus">+&lt;!ENTITY authRequired.description         &quot;Your authorization is required in order to see the settings for this storage service.&quot;&gt;</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineplus">+&lt;!ENTITY authRequired.button.label        &quot;Authorize&quot;&gt;</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineplus">+&lt;!ENTITY authRequired.button.accesskey    &quot;U&quot;&gt;</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineplus">+</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineplus">+&lt;!ENTITY enableCloudFileAccountOffer.label &quot;Offer to share for files larger than&quot;&gt;</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineplus">+&lt;!ENTITY enableCloudFileAccountOffer.mb &quot;MB&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mail/locales/jar.mn</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mail/locales/jar.mn</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -116,16 +116,21 @@</span>
<a href="#l28.4"></a><span id="l28.4">   locale/@AB_CD@/messenger/addressbook/abCardViewOverlay.dtd            (%chrome/messenger/addressbook/abCardViewOverlay.dtd)</span>
<a href="#l28.5"></a><span id="l28.5">   locale/@AB_CD@/messenger/addressbook/abResultsPaneOverlay.dtd         (%chrome/messenger/addressbook/abResultsPaneOverlay.dtd)</span>
<a href="#l28.6"></a><span id="l28.6">   locale/@AB_CD@/messenger/addressbook/abMailListDialog.dtd             (%chrome/messenger/addressbook/abMailListDialog.dtd)</span>
<a href="#l28.7"></a><span id="l28.7">   locale/@AB_CD@/messenger/addressbook/addressBook.properties           (%chrome/messenger/addressbook/addressBook.properties)</span>
<a href="#l28.8"></a><span id="l28.8">   locale/@AB_CD@/messenger/addressbook/ldapAutoCompErrs.properties      (%chrome/messenger/addressbook/ldapAutoCompErrs.properties)</span>
<a href="#l28.9"></a><span id="l28.9">   locale/@AB_CD@/messenger/addressbook/pref-directory.dtd               (%chrome/messenger/addressbook/pref-directory.dtd)</span>
<a href="#l28.10"></a><span id="l28.10">   locale/@AB_CD@/messenger/addressbook/pref-directory-add.dtd           (%chrome/messenger/addressbook/pref-directory-add.dtd)</span>
<a href="#l28.11"></a><span id="l28.11">   locale/@AB_CD@/messenger/addressbook/replicationProgress.properties   (%chrome/messenger/addressbook/replicationProgress.properties)</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineplus">+  locale/@AB_CD@/messenger/cloudfile/addAccountDialog.dtd               (%chrome/messenger/cloudfile/addAccountDialog.dtd)</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  locale/@AB_CD@/messenger/cloudfile/management.dtd                     (%chrome/messenger/cloudfile/management.dtd)</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+  locale/@AB_CD@/messenger/cloudfile/Dropbox/management.dtd             (%chrome/messenger/cloudfile/Dropbox/management.dtd)</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+  locale/@AB_CD@/messenger/cloudfile/YouSendIt/management.dtd           (%chrome/messenger/cloudfile/YouSendIt/management.dtd)</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineplus">+  locale/@AB_CD@/messenger/cloudfile/YouSendIt/settings.dtd             (%chrome/messenger/cloudfile/YouSendIt/settings.dtd)</span>
<a href="#l28.17"></a><span id="l28.17">   locale/@AB_CD@/messenger/messengercompose/messengercompose.dtd        (%chrome/messenger/messengercompose/messengercompose.dtd)</span>
<a href="#l28.18"></a><span id="l28.18">   locale/@AB_CD@/messenger/messengercompose/addressingWidgetOverlay.dtd (%chrome/messenger/messengercompose/addressingWidgetOverlay.dtd)</span>
<a href="#l28.19"></a><span id="l28.19">   locale/@AB_CD@/messenger/messengercompose/askSendFormat.dtd           (%chrome/messenger/messengercompose/askSendFormat.dtd)</span>
<a href="#l28.20"></a><span id="l28.20">   locale/@AB_CD@/messenger/messengercompose/askSendFormat.properties    (%chrome/messenger/messengercompose/askSendFormat.properties)</span>
<a href="#l28.21"></a><span id="l28.21">   locale/@AB_CD@/messenger/messengercompose/sendProgress.dtd            (%chrome/messenger/messengercompose/sendProgress.dtd)</span>
<a href="#l28.22"></a><span id="l28.22">   locale/@AB_CD@/messenger/messengercompose/sendProgress.properties     (%chrome/messenger/messengercompose/sendProgress.properties)</span>
<a href="#l28.23"></a><span id="l28.23">   locale/@AB_CD@/messenger/messengercompose/composeMsgs.properties      (%chrome/messenger/messengercompose/composeMsgs.properties)</span>
<a href="#l28.24"></a><span id="l28.24">   locale/@AB_CD@/messenger/messengercompose/mailComposeEditorOverlay.dtd (%chrome/messenger/messengercompose/mailComposeEditorOverlay.dtd)</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineat">@@ -136,16 +141,17 @@</span>
<a href="#l28.26"></a><span id="l28.26">   locale/@AB_CD@/messenger/preferences/sendoptions.dtd                  (%chrome/messenger/preferences/sendoptions.dtd)</span>
<a href="#l28.27"></a><span id="l28.27">   locale/@AB_CD@/messenger/preferences/security.dtd                     (%chrome/messenger/preferences/security.dtd)</span>
<a href="#l28.28"></a><span id="l28.28">   locale/@AB_CD@/messenger/preferences/junkLog.dtd                      (%chrome/messenger/preferences/junkLog.dtd)</span>
<a href="#l28.29"></a><span id="l28.29">   locale/@AB_CD@/messenger/preferences/advanced.dtd                     (%chrome/messenger/preferences/advanced.dtd)</span>
<a href="#l28.30"></a><span id="l28.30">   locale/@AB_CD@/messenger/preferences/attachmentReminder.dtd           (%chrome/messenger/preferences/attachmentReminder.dtd)</span>
<a href="#l28.31"></a><span id="l28.31">   locale/@AB_CD@/messenger/preferences/receipts.dtd                     (%chrome/messenger/preferences/receipts.dtd)</span>
<a href="#l28.32"></a><span id="l28.32">   locale/@AB_CD@/messenger/preferences/connection.dtd                   (%chrome/messenger/preferences/connection.dtd)</span>
<a href="#l28.33"></a><span id="l28.33">   locale/@AB_CD@/messenger/preferences/applications.dtd                 (%chrome/messenger/preferences/applications.dtd)</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineplus">+  locale/@AB_CD@/messenger/preferences/applications.properties          (%chrome/messenger/preferences/applications.properties)</span>
<a href="#l28.35"></a><span id="l28.35">   locale/@AB_CD@/messenger/preferences/applicationManager.dtd           (%chrome/messenger/preferences/applicationManager.dtd)</span>
<a href="#l28.36"></a><span id="l28.36">   locale/@AB_CD@/messenger/preferences/applicationManager.properties    (%chrome/messenger/preferences/applicationManager.properties)</span>
<a href="#l28.37"></a><span id="l28.37">   locale/@AB_CD@/messenger/preferences/fonts.dtd                        (%chrome/messenger/preferences/fonts.dtd)</span>
<a href="#l28.38"></a><span id="l28.38">   locale/@AB_CD@/messenger/preferences/offline.dtd                      (%chrome/messenger/preferences/offline.dtd)</span>
<a href="#l28.39"></a><span id="l28.39">   locale/@AB_CD@/messenger/preferences/notifications.dtd                (%chrome/messenger/preferences/notifications.dtd)</span>
<a href="#l28.40"></a><span id="l28.40">   locale/@AB_CD@/messenger/preferences/preferences.properties           (%chrome/messenger/preferences/preferences.properties)</span>
<a href="#l28.41"></a><span id="l28.41">   locale/@AB_CD@/messenger/preferences/cookies.dtd                      (%chrome/messenger/preferences/cookies.dtd)</span>
<a href="#l28.42"></a><span id="l28.42">   locale/@AB_CD@/messenger/preferences/permissions.dtd                  (%chrome/messenger/preferences/permissions.dtd)</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineat">@@ -180,9 +186,9 @@</span>
<a href="#l28.44"></a><span id="l28.44"> % locale messenger-region @AB_CD@ %locale/@AB_CD@/messenger-region/</span>
<a href="#l28.45"></a><span id="l28.45">   locale/@AB_CD@/messenger-region/region.properties                     (%chrome/messenger-region/region.properties)</span>
<a href="#l28.46"></a><span id="l28.46"> % locale mozldap @AB_CD@ %locale/@AB_CD@/mozldap/</span>
<a href="#l28.47"></a><span id="l28.47">   locale/@AB_CD@/mozldap/ldap.properties                                (%chrome/mozldap/ldap.properties)</span>
<a href="#l28.48"></a><span id="l28.48"> % locale communicator @AB_CD@ %locale/@AB_CD@/communicator/</span>
<a href="#l28.49"></a><span id="l28.49">   locale/@AB_CD@/communicator/utilityOverlay.dtd                        (%chrome/communicator/utilityOverlay.dtd)</span>
<a href="#l28.50"></a><span id="l28.50"> % locale testpilot @AB_CD@ %locale/@AB_CD@/feedback/</span>
<a href="#l28.51"></a><span id="l28.51">   locale/@AB_CD@/feedback/main.dtd                       (%feedback/main.dtd)</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineminus">-  locale/@AB_CD@/feedback/main.properties                (%feedback/main.properties)</span>
<a href="#l28.53"></a><span id="l28.53">\ No newline at end of file</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineplus">+  locale/@AB_CD@/feedback/main.properties                (%feedback/main.properties)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mail/themes/gnomestripe/jar.mn</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mail/themes/gnomestripe/jar.mn</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -8,16 +8,17 @@ classic.jar:</span>
<a href="#l29.4"></a><span id="l29.4">   skin/classic/messenger/featureConfigurators/folder-columns.png    (mail/featureConfigurators/folder-columns.png)</span>
<a href="#l29.5"></a><span id="l29.5">   skin/classic/messenger/featureConfigurators/toolbars.png    (mail/featureConfigurators/toolbars.png)</span>
<a href="#l29.6"></a><span id="l29.6">   skin/classic/messenger/primaryToolbar.css                   (mail/primaryToolbar.css)</span>
<a href="#l29.7"></a><span id="l29.7">   skin/classic/messenger/aboutSupport.css                     (../qute/mail/aboutSupport.css)</span>
<a href="#l29.8"></a><span id="l29.8">   skin/classic/messenger/accountCentral.css                   (mail/accountCentral.css)</span>
<a href="#l29.9"></a><span id="l29.9">   skin/classic/messenger/accountCreation.css                  (mail/accountCreation.css)</span>
<a href="#l29.10"></a><span id="l29.10">   skin/classic/messenger/accountManage.css                    (mail/accountManage.css)</span>
<a href="#l29.11"></a><span id="l29.11">   skin/classic/messenger/accountWizard.css                    (mail/accountWizard.css)</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+  skin/classic/messenger/browserRequest.css                   (mail/browserRequest.css)</span>
<a href="#l29.13"></a><span id="l29.13">   skin/classic/messenger/section_collapsed.png                (mail/section_collapsed.png)</span>
<a href="#l29.14"></a><span id="l29.14">   skin/classic/messenger/section_expanded.png                 (mail/section_expanded.png)</span>
<a href="#l29.15"></a><span id="l29.15">   skin/classic/messenger/messageHeader.css                    (mail/messageHeader.css)</span>
<a href="#l29.16"></a><span id="l29.16">   skin/classic/messenger/messageBody.css                      (mail/messageBody.css)</span>
<a href="#l29.17"></a><span id="l29.17">   skin/classic/messenger/webSearch.css                        (mail/webSearch.css)</span>
<a href="#l29.18"></a><span id="l29.18">   skin/classic/messenger/messageQuotes.css                    (mail/messageQuotes.css)</span>
<a href="#l29.19"></a><span id="l29.19">   skin/classic/messenger/messenger.css                        (mail/messenger.css)</span>
<a href="#l29.20"></a><span id="l29.20">   skin/classic/messenger/attachmentList.css                   (mail/attachmentList.css)</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineat">@@ -94,16 +95,17 @@ classic.jar:</span>
<a href="#l29.22"></a><span id="l29.22">   skin/classic/messenger/preferences/composition.png          (mail/preferences/composition.png)</span>
<a href="#l29.23"></a><span id="l29.23">   skin/classic/messenger/preferences/security.png             (mail/preferences/security.png)</span>
<a href="#l29.24"></a><span id="l29.24">   skin/classic/messenger/preferences/attachments.png          (mail/preferences/attachments.png)</span>
<a href="#l29.25"></a><span id="l29.25">   skin/classic/messenger/preferences/applications.css         (mail/preferences/applications.css)</span>
<a href="#l29.26"></a><span id="l29.26">   skin/classic/messenger/preferences/advanced.png             (mail/preferences/advanced.png)</span>
<a href="#l29.27"></a><span id="l29.27">   skin/classic/messenger/preferences/background.png           (mail/preferences/background.png)</span>
<a href="#l29.28"></a><span id="l29.28">   skin/classic/messenger/preferences/hover.png                (mail/preferences/hover.png)</span>
<a href="#l29.29"></a><span id="l29.29">   skin/classic/messenger/preferences/selected.png             (mail/preferences/selected.png)</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineplus">+  skin/classic/messenger/preferences/auth-error.png           (mail/preferences/auth-error.png)</span>
<a href="#l29.31"></a><span id="l29.31">   skin/classic/messenger/smime/msgCompSMIMEOverlay.css        (mail/smime/msgCompSMIMEOverlay.css)</span>
<a href="#l29.32"></a><span id="l29.32">   skin/classic/messenger/smime/msgHdrViewSMIMEOverlay.css     (mail/smime/msgHdrViewSMIMEOverlay.css)</span>
<a href="#l29.33"></a><span id="l29.33">   skin/classic/messenger/smime/msgReadSMIMEOverlay.css        (mail/smime/msgReadSMIMEOverlay.css)</span>
<a href="#l29.34"></a><span id="l29.34">   skin/classic/messenger/smime/msgReadSecurityInfo.css        (mail/smime/msgReadSecurityInfo.css)</span>
<a href="#l29.35"></a><span id="l29.35">   skin/classic/messenger/smime/msgCompSecurityInfo.css        (mail/smime/msgCompSecurityInfo.css)</span>
<a href="#l29.36"></a><span id="l29.36">   skin/classic/messenger/smime/certFetchingStatus.css         (mail/smime/certFetchingStatus.css)</span>
<a href="#l29.37"></a><span id="l29.37">   skin/classic/messenger/smime/icons/hdrCryptoNotOk.png       (mail/smime/hdrCryptoNotOk.png)</span>
<a href="#l29.38"></a><span id="l29.38">   skin/classic/messenger/smime/icons/hdrCryptoOk.png          (mail/smime/hdrCryptoOk.png)</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineat">@@ -206,16 +208,18 @@ classic.jar:</span>
<a href="#l29.40"></a><span id="l29.40">   skin/classic/messenger/icons/arrow/arrow-down.png           (mail/icons/arrow/arrow-down.png)</span>
<a href="#l29.41"></a><span id="l29.41">   skin/classic/messenger/icons/arrow/arrow-left-dim.png       (mail/icons/arrow/arrow-left-dim.png)</span>
<a href="#l29.42"></a><span id="l29.42">   skin/classic/messenger/icons/arrow/arrow-right-dim.png      (mail/icons/arrow/arrow-right-dim.png)</span>
<a href="#l29.43"></a><span id="l29.43">   skin/classic/messenger/icons/arrow/arrow-up-dim.png         (mail/icons/arrow/arrow-up-dim.png)</span>
<a href="#l29.44"></a><span id="l29.44">   skin/classic/messenger/icons/arrow/arrow-down-dim.png       (mail/icons/arrow/arrow-down-dim.png)</span>
<a href="#l29.45"></a><span id="l29.45">   skin/classic/messenger/icons/arrow/foldercycler-arrow-left.png        (mail/icons/arrow/foldercycler-arrow-left.png)</span>
<a href="#l29.46"></a><span id="l29.46">   skin/classic/messenger/icons/arrow/foldercycler-arrow-right.png       (mail/icons/arrow/foldercycler-arrow-right.png)</span>
<a href="#l29.47"></a><span id="l29.47">   skin/classic/messenger/icons/search-favorite.png            (mail/icons/search-favorite.png)</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineplus">+  skin/classic/messenger/icons/connecting.png                 (mail/icons/connecting.png)</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineplus">+  skin/classic/messenger/icons/loading.png                    (mail/icons/loading.png)</span>
<a href="#l29.50"></a><span id="l29.50">   skin/classic/messenger/tagbg.png                            (mail/tagbg.png)</span>
<a href="#l29.51"></a><span id="l29.51"> % skin editor classic/1.0 %skin/classic/editor/</span>
<a href="#l29.52"></a><span id="l29.52">   skin/classic/editor/editor.css                              (editor/editor.css)</span>
<a href="#l29.53"></a><span id="l29.53">   skin/classic/editor/EditorDialog.css                        (editor/EditorDialog.css)</span>
<a href="#l29.54"></a><span id="l29.54">   skin/classic/editor/icons/img-align-bottom.gif              (editor/img-align-bottom.gif)</span>
<a href="#l29.55"></a><span id="l29.55">   skin/classic/editor/icons/img-align-left.gif                (editor/img-align-left.gif)</span>
<a href="#l29.56"></a><span id="l29.56">   skin/classic/editor/icons/img-align-middle.gif              (editor/img-align-middle.gif)</span>
<a href="#l29.57"></a><span id="l29.57">   skin/classic/editor/icons/img-align-right.gif               (editor/img-align-right.gif)</span>
<a href="#l29.58"></a><span id="l29.58" class="difflineat">@@ -223,8 +227,10 @@ classic.jar:</span>
<a href="#l29.59"></a><span id="l29.59">   skin/classic/messenger/newmailaccount/accountProvisioner.css          (mail/newmailaccount/accountProvisioner.css)</span>
<a href="#l29.60"></a><span id="l29.60">   skin/classic/messenger/newmailaccount/search.gif                      (mail/newmailaccount/search.gif)</span>
<a href="#l29.61"></a><span id="l29.61">   skin/classic/messenger/newmailaccount/spinner.gif                     (mail/newmailaccount/spinner.gif)</span>
<a href="#l29.62"></a><span id="l29.62">   skin/classic/messenger/newmailaccount/success-addons.png              (mail/newmailaccount/success-addons.png)</span>
<a href="#l29.63"></a><span id="l29.63">   skin/classic/messenger/newmailaccount/success-border.png              (mail/newmailaccount/success-border.png)</span>
<a href="#l29.64"></a><span id="l29.64">   skin/classic/messenger/newmailaccount/success-compose.png             (mail/newmailaccount/success-compose.png)</span>
<a href="#l29.65"></a><span id="l29.65">   skin/classic/messenger/newmailaccount/success-signature.png           (mail/newmailaccount/success-signature.png)</span>
<a href="#l29.66"></a><span id="l29.66">   skin/classic/messenger/newmailaccount/search.png                      (mail/newmailaccount/search.png)</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineplus">+  skin/classic/messenger/icons/dropbox.png                    (mail/icons/dropbox.png)</span>
<a href="#l29.68"></a><span id="l29.68" class="difflineplus">+  skin/classic/messenger/icons/yousendit.png                  (mail/icons/yousendit.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1">new file mode 100644</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineminus">--- /dev/null</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/browserRequest.css</span>
<a href="#l30.4"></a><span id="l30.4" class="difflineat">@@ -0,0 +1,65 @@</span>
<a href="#l30.5"></a><span id="l30.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l30.6"></a><span id="l30.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l30.7"></a><span id="l30.7" class="difflineplus">+ *</span>
<a href="#l30.8"></a><span id="l30.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l30.9"></a><span id="l30.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l30.10"></a><span id="l30.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l30.11"></a><span id="l30.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+ *</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineplus">+ * License.</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+ *</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineplus">+ * The Original Code is oauthorizer.</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+ *</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineplus">+ * The Initial Developer of the Original Code is Mozilla.</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2010</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineplus">+ *</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineplus">+ * Contributor(s):</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineplus">+ *   Shane Caraveo &lt;shanec@mozillamessaging.com&gt;</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineplus">+ *   Florian Quze &lt;florian@instantbird.org&gt;</span>
<a href="#l30.27"></a><span id="l30.27" class="difflineplus">+ *</span>
<a href="#l30.28"></a><span id="l30.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineplus">+ *</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineplus">+</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineplus">+#security-button {</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineplus">+  width: 20px;</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineplus">+  padding-right: 5px;</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineplus">+  background-repeat: no-repeat;</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineplus">+}</span>
<a href="#l30.47"></a><span id="l30.47" class="difflineplus">+</span>
<a href="#l30.48"></a><span id="l30.48" class="difflineplus">+#security-button[level=&quot;high&quot;],</span>
<a href="#l30.49"></a><span id="l30.49" class="difflineplus">+#security-button[level=&quot;low&quot;] {</span>
<a href="#l30.50"></a><span id="l30.50" class="difflineplus">+  background-image: url(&quot;chrome://messenger/skin/icons/secure.png&quot;);</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineplus">+}</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineplus">+</span>
<a href="#l30.53"></a><span id="l30.53" class="difflineplus">+#security-button[level=&quot;broken&quot;] {</span>
<a href="#l30.54"></a><span id="l30.54" class="difflineplus">+  background-image: url(&quot;chrome://messenger/skin/icons/insecure.png&quot;);</span>
<a href="#l30.55"></a><span id="l30.55" class="difflineplus">+}</span>
<a href="#l30.56"></a><span id="l30.56" class="difflineplus">+</span>
<a href="#l30.57"></a><span id="l30.57" class="difflineplus">+#header {</span>
<a href="#l30.58"></a><span id="l30.58" class="difflineplus">+  border-bottom: 1px solid black;</span>
<a href="#l30.59"></a><span id="l30.59" class="difflineplus">+  overflow: hidden;</span>
<a href="#l30.60"></a><span id="l30.60" class="difflineplus">+}</span>
<a href="#l30.61"></a><span id="l30.61" class="difflineplus">+</span>
<a href="#l30.62"></a><span id="l30.62" class="difflineplus">+#addressbox {</span>
<a href="#l30.63"></a><span id="l30.63" class="difflineplus">+  font-weight: bold;</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineplus">+  font-size: normal;</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineplus">+  -moz-appearance: textfield;</span>
<a href="#l30.66"></a><span id="l30.66" class="difflineplus">+  overflow: hidden;</span>
<a href="#l30.67"></a><span id="l30.67" class="difflineplus">+  margin: 0px 5px;</span>
<a href="#l30.68"></a><span id="l30.68" class="difflineplus">+  font-weight: normal;</span>
<a href="#l30.69"></a><span id="l30.69" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mail/themes/gnomestripe/mail/compose/messengercompose.css</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/compose/messengercompose.css</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -718,8 +718,15 @@ toolbarbutton.formatting-button {</span>
<a href="#l31.4"></a><span id="l31.4">   /* splitter grip area */</span>
<a href="#l31.5"></a><span id="l31.5">   width: 5px;</span>
<a href="#l31.6"></a><span id="l31.6">   /* make only the splitter border visible */</span>
<a href="#l31.7"></a><span id="l31.7">   -moz-margin-end: -5px;</span>
<a href="#l31.8"></a><span id="l31.8">   /* because of the negative margin needed to make the splitter visible */</span>
<a href="#l31.9"></a><span id="l31.9">   position: relative;</span>
<a href="#l31.10"></a><span id="l31.10">   z-index: 10;</span>
<a href="#l31.11"></a><span id="l31.11"> }</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+menu[command=&quot;cmd_attachCloud&quot;] .menu-iconic-left,</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+menu[command=&quot;cmd_convertCloud&quot;] .menu-iconic-left {</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+  /* Ensure that the provider icons are visible even if the Gnome theme says</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+     menus shouldn't have icons. */</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+  visibility: visible;</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/themes/gnomestripe/mail/preferences/applications.css</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/preferences/applications.css</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -48,22 +48,22 @@</span>
<a href="#l32.4"></a><span id="l32.4">   -moz-margin-end: 0;</span>
<a href="#l32.5"></a><span id="l32.5"> }</span>
<a href="#l32.6"></a><span id="l32.6"> </span>
<a href="#l32.7"></a><span id="l32.7"> .typeIcon,</span>
<a href="#l32.8"></a><span id="l32.8"> .actionIcon {</span>
<a href="#l32.9"></a><span id="l32.9">   margin: 0px 3px;</span>
<a href="#l32.10"></a><span id="l32.10"> }</span>
<a href="#l32.11"></a><span id="l32.11"> </span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-richlistitem label {</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+#handlersView richlistitem label {</span>
<a href="#l32.14"></a><span id="l32.14">   -moz-margin-start: 1px;</span>
<a href="#l32.15"></a><span id="l32.15">   margin-top: 2px;</span>
<a href="#l32.16"></a><span id="l32.16"> }</span>
<a href="#l32.17"></a><span id="l32.17"> </span>
<a href="#l32.18"></a><span id="l32.18" class="difflineminus">-richlistitem {</span>
<a href="#l32.19"></a><span id="l32.19" class="difflineplus">+#handlersView richlistitem {</span>
<a href="#l32.20"></a><span id="l32.20">   min-height: 25px;</span>
<a href="#l32.21"></a><span id="l32.21"> }</span>
<a href="#l32.22"></a><span id="l32.22"> </span>
<a href="#l32.23"></a><span id="l32.23"> richlistitem[appHandlerIcon=&quot;ask&quot;],</span>
<a href="#l32.24"></a><span id="l32.24"> menuitem[appHandlerIcon=&quot;ask&quot;] {</span>
<a href="#l32.25"></a><span id="l32.25">   list-style-image: url(&quot;chrome://messenger/skin/preferences/alwaysAsk.png&quot;);</span>
<a href="#l32.26"></a><span id="l32.26"> }</span>
<a href="#l32.27"></a><span id="l32.27"> </span>
<a href="#l32.28"></a><span id="l32.28" class="difflineat">@@ -92,11 +92,52 @@ menuitem[appHandlerIcon=&quot;plugin&quot;] {</span>
<a href="#l32.29"></a><span id="l32.29">   -moz-padding-start: 3px;</span>
<a href="#l32.30"></a><span id="l32.30"> }</span>
<a href="#l32.31"></a><span id="l32.31"> </span>
<a href="#l32.32"></a><span id="l32.32"> .shortDetails {</span>
<a href="#l32.33"></a><span id="l32.33">   text-align: right;</span>
<a href="#l32.34"></a><span id="l32.34">   color: GrayText;</span>
<a href="#l32.35"></a><span id="l32.35"> }</span>
<a href="#l32.36"></a><span id="l32.36"> </span>
<a href="#l32.37"></a><span id="l32.37" class="difflineminus">-richlistbox:focus .shortDetails.selected {</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineplus">+#handlersView richlistbox:focus .shortDetails.selected {</span>
<a href="#l32.39"></a><span id="l32.39">   color: inherit;</span>
<a href="#l32.40"></a><span id="l32.40"> }</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineplus">+</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineplus">+/**</span>
<a href="#l32.43"></a><span id="l32.43" class="difflineplus">+ * Used by the outgoing attachment manager</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineplus">+ */</span>
<a href="#l32.45"></a><span id="l32.45" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;connecting&quot;],</span>
<a href="#l32.46"></a><span id="l32.46" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;waiting-to-connect&quot;] {</span>
<a href="#l32.47"></a><span id="l32.47" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;) !important;</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineplus">+}</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineplus">+</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;auth-error&quot;],</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;no-connection&quot;] {</span>
<a href="#l32.52"></a><span id="l32.52" class="difflineplus">+  list-style-image: url(&quot;moz-icon://stock/gtk-dialog-error?size=menu&quot;)!important;</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineplus">+}</span>
<a href="#l32.54"></a><span id="l32.54" class="difflineplus">+</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineplus">+.cloudfileAccount .typeIcon {</span>
<a href="#l32.56"></a><span id="l32.56" class="difflineplus">+  max-height: 16px;</span>
<a href="#l32.57"></a><span id="l32.57" class="difflineplus">+  max-width: 16px;</span>
<a href="#l32.58"></a><span id="l32.58" class="difflineplus">+  margin-top: 3px;</span>
<a href="#l32.59"></a><span id="l32.59" class="difflineplus">+  margin-bottom: 3px;</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineplus">+}</span>
<a href="#l32.61"></a><span id="l32.61" class="difflineplus">+</span>
<a href="#l32.62"></a><span id="l32.62" class="difflineplus">+#authMessage {</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineplus">+  text-align: center;</span>
<a href="#l32.64"></a><span id="l32.64" class="difflineplus">+  padding: 0px 80px;</span>
<a href="#l32.65"></a><span id="l32.65" class="difflineplus">+}</span>
<a href="#l32.66"></a><span id="l32.66" class="difflineplus">+</span>
<a href="#l32.67"></a><span id="l32.67" class="difflineplus">+#authImage {</span>
<a href="#l32.68"></a><span id="l32.68" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/preferences/auth-error.png&quot;);</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineplus">+  width: 200px;</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineplus">+  height: 200px;</span>
<a href="#l32.71"></a><span id="l32.71" class="difflineplus">+}</span>
<a href="#l32.72"></a><span id="l32.72" class="difflineplus">+</span>
<a href="#l32.73"></a><span id="l32.73" class="difflineplus">+#cloudFileToggleAndThreshold {</span>
<a href="#l32.74"></a><span id="l32.74" class="difflineplus">+  margin-bottom: 15px;</span>
<a href="#l32.75"></a><span id="l32.75" class="difflineplus">+}</span>
<a href="#l32.76"></a><span id="l32.76" class="difflineplus">+</span>
<a href="#l32.77"></a><span id="l32.77" class="difflineplus">+#cloudFileLoadingSpinner {</span>
<a href="#l32.78"></a><span id="l32.78" class="difflineplus">+  width: 16px;</span>
<a href="#l32.79"></a><span id="l32.79" class="difflineplus">+  height: 16px;</span>
<a href="#l32.80"></a><span id="l32.80" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;);</span>
<a href="#l32.81"></a><span id="l32.81" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mail/themes/gnomestripe/mail/preferences/preferences.css</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/preferences/preferences.css</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -99,8 +99,178 @@ radio[pane=paneAdvanced] {</span>
<a href="#l33.4"></a><span id="l33.4">   border: 1px solid ThreeDShadow;</span>
<a href="#l33.5"></a><span id="l33.5"> }</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7"> #quotaPercentageBar &gt; .progress-bar {</span>
<a href="#l33.8"></a><span id="l33.8">   -moz-appearance: none;</span>
<a href="#l33.9"></a><span id="l33.9">   background-color: #88AAFF;</span>
<a href="#l33.10"></a><span id="l33.10">   opacity: .5;</span>
<a href="#l33.11"></a><span id="l33.11"> }</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+/* Attachments */</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineplus">+</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineplus">+body {</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineplus">+  font: message-box;</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineplus">+}</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineplus">+</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineplus">+a {</span>
<a href="#l33.20"></a><span id="l33.20" class="difflineplus">+  color: -moz-nativehyperlinktext;</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineplus">+  text-decoration: underline;</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineplus">+}</span>
<a href="#l33.23"></a><span id="l33.23" class="difflineplus">+</span>
<a href="#l33.24"></a><span id="l33.24" class="difflineplus">+/* Setting margins so we can start lining things up */</span>
<a href="#l33.25"></a><span id="l33.25" class="difflineplus">+#accountNameBox label, #accountName, #accountType, #provider-settings {</span>
<a href="#l33.26"></a><span id="l33.26" class="difflineplus">+  margin: 0;</span>
<a href="#l33.27"></a><span id="l33.27" class="difflineplus">+}</span>
<a href="#l33.28"></a><span id="l33.28" class="difflineplus">+</span>
<a href="#l33.29"></a><span id="l33.29" class="difflineplus">+#providerForm #username, #provider-signup {</span>
<a href="#l33.30"></a><span id="l33.30" class="difflineplus">+  width: 250px;</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineplus">+}</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineplus">+#providerForm label{</span>
<a href="#l33.34"></a><span id="l33.34" class="difflineplus">+  width: 150px;</span>
<a href="#l33.35"></a><span id="l33.35" class="difflineplus">+  text-align: right;</span>
<a href="#l33.36"></a><span id="l33.36" class="difflineplus">+//  padding-right: 3px; ???</span>
<a href="#l33.37"></a><span id="l33.37" class="difflineplus">+}</span>
<a href="#l33.38"></a><span id="l33.38" class="difflineplus">+</span>
<a href="#l33.39"></a><span id="l33.39" class="difflineplus">+#provider-signup, #accountType {</span>
<a href="#l33.40"></a><span id="l33.40" class="difflineplus">+  margin-left: 150px;</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineplus">+}</span>
<a href="#l33.42"></a><span id="l33.42" class="difflineplus">+</span>
<a href="#l33.43"></a><span id="l33.43" class="difflineplus">+#providerForm label {</span>
<a href="#l33.44"></a><span id="l33.44" class="difflineplus">+  display: inline-block;</span>
<a href="#l33.45"></a><span id="l33.45" class="difflineplus">+}</span>
<a href="#l33.46"></a><span id="l33.46" class="difflineplus">+</span>
<a href="#l33.47"></a><span id="l33.47" class="difflineplus">+#provider-signup {</span>
<a href="#l33.48"></a><span id="l33.48" class="difflineplus">+  display: block;</span>
<a href="#l33.49"></a><span id="l33.49" class="difflineplus">+}</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineplus">+</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineplus">+/* Making sure there is some spacing between elements */</span>
<a href="#l33.52"></a><span id="l33.52" class="difflineplus">+</span>
<a href="#l33.53"></a><span id="l33.53" class="difflineplus">+#createAccountText {</span>
<a href="#l33.54"></a><span id="l33.54" class="difflineplus">+  margin-bottom: 20px;</span>
<a href="#l33.55"></a><span id="l33.55" class="difflineplus">+  padding: 0px 15px;</span>
<a href="#l33.56"></a><span id="l33.56" class="difflineplus">+}</span>
<a href="#l33.57"></a><span id="l33.57" class="difflineplus">+</span>
<a href="#l33.58"></a><span id="l33.58" class="difflineplus">+#accountType {</span>
<a href="#l33.59"></a><span id="l33.59" class="difflineplus">+  margin-bottom: 5px;</span>
<a href="#l33.60"></a><span id="l33.60" class="difflineplus">+}</span>
<a href="#l33.61"></a><span id="l33.61" class="difflineplus">+</span>
<a href="#l33.62"></a><span id="l33.62" class="difflineplus">+/* I am a hack */</span>
<a href="#l33.63"></a><span id="l33.63" class="difflineplus">+#accountType {</span>
<a href="#l33.64"></a><span id="l33.64" class="difflineplus">+  margin-right: 165px;</span>
<a href="#l33.65"></a><span id="l33.65" class="difflineplus">+}</span>
<a href="#l33.66"></a><span id="l33.66" class="difflineplus">+</span>
<a href="#l33.67"></a><span id="l33.67" class="difflineplus">+#messages #authorizing image,</span>
<a href="#l33.68"></a><span id="l33.68" class="difflineplus">+#messages #error image {</span>
<a href="#l33.69"></a><span id="l33.69" class="difflineplus">+  max-width: 16px;</span>
<a href="#l33.70"></a><span id="l33.70" class="difflineplus">+  max-height: 16px;</span>
<a href="#l33.71"></a><span id="l33.71" class="difflineplus">+}</span>
<a href="#l33.72"></a><span id="l33.72" class="difflineplus">+</span>
<a href="#l33.73"></a><span id="l33.73" class="difflineplus">+#provider-header {</span>
<a href="#l33.74"></a><span id="l33.74" class="difflineplus">+  border-bottom: 1px solid black;</span>
<a href="#l33.75"></a><span id="l33.75" class="difflineplus">+  margin-bottom: 20px;</span>
<a href="#l33.76"></a><span id="l33.76" class="difflineplus">+  height: 50px;</span>
<a href="#l33.77"></a><span id="l33.77" class="difflineplus">+}</span>
<a href="#l33.78"></a><span id="l33.78" class="difflineplus">+</span>
<a href="#l33.79"></a><span id="l33.79" class="difflineplus">+#provider-name {</span>
<a href="#l33.80"></a><span id="l33.80" class="difflineplus">+  padding: 0;</span>
<a href="#l33.81"></a><span id="l33.81" class="difflineplus">+  margin: 0;</span>
<a href="#l33.82"></a><span id="l33.82" class="difflineplus">+  margin-right: 120px;</span>
<a href="#l33.83"></a><span id="l33.83" class="difflineplus">+}</span>
<a href="#l33.84"></a><span id="l33.84" class="difflineplus">+</span>
<a href="#l33.85"></a><span id="l33.85" class="difflineplus">+#provider-name h1 {</span>
<a href="#l33.86"></a><span id="l33.86" class="difflineplus">+  font-size: large;</span>
<a href="#l33.87"></a><span id="l33.87" class="difflineplus">+}</span>
<a href="#l33.88"></a><span id="l33.88" class="difflineplus">+</span>
<a href="#l33.89"></a><span id="l33.89" class="difflineplus">+#provider-name h2 {</span>
<a href="#l33.90"></a><span id="l33.90" class="difflineplus">+  font: message-box;</span>
<a href="#l33.91"></a><span id="l33.91" class="difflineplus">+}</span>
<a href="#l33.92"></a><span id="l33.92" class="difflineplus">+</span>
<a href="#l33.93"></a><span id="l33.93" class="difflineplus">+#provider-terms {</span>
<a href="#l33.94"></a><span id="l33.94" class="difflineplus">+  float: right;</span>
<a href="#l33.95"></a><span id="l33.95" class="difflineplus">+  width: 110px;</span>
<a href="#l33.96"></a><span id="l33.96" class="difflineplus">+}</span>
<a href="#l33.97"></a><span id="l33.97" class="difflineplus">+</span>
<a href="#l33.98"></a><span id="l33.98" class="difflineplus">+#provider-terms a {</span>
<a href="#l33.99"></a><span id="l33.99" class="difflineplus">+  font-size: small;</span>
<a href="#l33.100"></a><span id="l33.100" class="difflineplus">+  display: block;</span>
<a href="#l33.101"></a><span id="l33.101" class="difflineplus">+  margin-bottom: 5px;</span>
<a href="#l33.102"></a><span id="l33.102" class="difflineplus">+  text-align: right;</span>
<a href="#l33.103"></a><span id="l33.103" class="difflineplus">+}</span>
<a href="#l33.104"></a><span id="l33.104" class="difflineplus">+</span>
<a href="#l33.105"></a><span id="l33.105" class="difflineplus">+#provider-listing {</span>
<a href="#l33.106"></a><span id="l33.106" class="difflineplus">+  max-width: 150px;</span>
<a href="#l33.107"></a><span id="l33.107" class="difflineplus">+}</span>
<a href="#l33.108"></a><span id="l33.108" class="difflineplus">+</span>
<a href="#l33.109"></a><span id="l33.109" class="difflineplus">+#provider-space {</span>
<a href="#l33.110"></a><span id="l33.110" class="difflineplus">+  text-align: right;</span>
<a href="#l33.111"></a><span id="l33.111" class="difflineplus">+  margin-right: 160px;</span>
<a href="#l33.112"></a><span id="l33.112" class="difflineplus">+  margin-top: 50px;</span>
<a href="#l33.113"></a><span id="l33.113" class="difflineplus">+  height: 100px;</span>
<a href="#l33.114"></a><span id="l33.114" class="difflineplus">+}</span>
<a href="#l33.115"></a><span id="l33.115" class="difflineplus">+</span>
<a href="#l33.116"></a><span id="l33.116" class="difflineplus">+#upgrade {</span>
<a href="#l33.117"></a><span id="l33.117" class="difflineplus">+  margin-top: 1em;</span>
<a href="#l33.118"></a><span id="l33.118" class="difflineplus">+}</span>
<a href="#l33.119"></a><span id="l33.119" class="difflineplus">+</span>
<a href="#l33.120"></a><span id="l33.120" class="difflineplus">+#provider-space-visuals {</span>
<a href="#l33.121"></a><span id="l33.121" class="difflineplus">+  width: 150px;</span>
<a href="#l33.122"></a><span id="l33.122" class="difflineplus">+  height: 150px;</span>
<a href="#l33.123"></a><span id="l33.123" class="difflineplus">+  float: right;</span>
<a href="#l33.124"></a><span id="l33.124" class="difflineplus">+}</span>
<a href="#l33.125"></a><span id="l33.125" class="difflineplus">+</span>
<a href="#l33.126"></a><span id="l33.126" class="difflineplus">+#provider-account-settings {</span>
<a href="#l33.127"></a><span id="l33.127" class="difflineplus">+/*  margin-top: 100px; */</span>
<a href="#l33.128"></a><span id="l33.128" class="difflineplus">+  text-align: right;</span>
<a href="#l33.129"></a><span id="l33.129" class="difflineplus">+}</span>
<a href="#l33.130"></a><span id="l33.130" class="difflineplus">+</span>
<a href="#l33.131"></a><span id="l33.131" class="difflineplus">+.space-swatch {</span>
<a href="#l33.132"></a><span id="l33.132" class="difflineplus">+  display: inline-block;</span>
<a href="#l33.133"></a><span id="l33.133" class="difflineplus">+  width: 1em;</span>
<a href="#l33.134"></a><span id="l33.134" class="difflineplus">+  height: 1em;</span>
<a href="#l33.135"></a><span id="l33.135" class="difflineplus">+  border: 1px solid rgba(0,0,0,0.5);</span>
<a href="#l33.136"></a><span id="l33.136" class="difflineplus">+  border-radius: 2px;</span>
<a href="#l33.137"></a><span id="l33.137" class="difflineplus">+</span>
<a href="#l33.138"></a><span id="l33.138" class="difflineplus">+  vertical-align: middle;</span>
<a href="#l33.139"></a><span id="l33.139" class="difflineplus">+  -moz-margin-start: 0.5ch;</span>
<a href="#l33.140"></a><span id="l33.140" class="difflineplus">+  -moz-box-sizing: border-box;</span>
<a href="#l33.141"></a><span id="l33.141" class="difflineplus">+}</span>
<a href="#l33.142"></a><span id="l33.142" class="difflineplus">+</span>
<a href="#l33.143"></a><span id="l33.143" class="difflineplus">+/* Main pane padding */</span>
<a href="#l33.144"></a><span id="l33.144" class="difflineplus">+</span>
<a href="#l33.145"></a><span id="l33.145" class="difflineplus">+#provider-management {</span>
<a href="#l33.146"></a><span id="l33.146" class="difflineplus">+  margin: 0 10px;</span>
<a href="#l33.147"></a><span id="l33.147" class="difflineplus">+}</span>
<a href="#l33.148"></a><span id="l33.148" class="difflineplus">+</span>
<a href="#l33.149"></a><span id="l33.149" class="difflineplus">+#provider-name h1 {</span>
<a href="#l33.150"></a><span id="l33.150" class="difflineplus">+  margin: 0;</span>
<a href="#l33.151"></a><span id="l33.151" class="difflineplus">+}</span>
<a href="#l33.152"></a><span id="l33.152" class="difflineplus">+</span>
<a href="#l33.153"></a><span id="l33.153" class="difflineplus">+/* Loading panel */</span>
<a href="#l33.154"></a><span id="l33.154" class="difflineplus">+#cloudFileLoadingPanel, #cloudFileDefaultPanel {</span>
<a href="#l33.155"></a><span id="l33.155" class="difflineplus">+  text-align: center;</span>
<a href="#l33.156"></a><span id="l33.156" class="difflineplus">+  padding-top: 150px;</span>
<a href="#l33.157"></a><span id="l33.157" class="difflineplus">+}</span>
<a href="#l33.158"></a><span id="l33.158" class="difflineplus">+</span>
<a href="#l33.159"></a><span id="l33.159" class="difflineplus">+#provider-settings .indented {</span>
<a href="#l33.160"></a><span id="l33.160" class="difflineplus">+  margin-left: 150px;</span>
<a href="#l33.161"></a><span id="l33.161" class="difflineplus">+}</span>
<a href="#l33.162"></a><span id="l33.162" class="difflineplus">+</span>
<a href="#l33.163"></a><span id="l33.163" class="difflineplus">+/* Flexing */</span>
<a href="#l33.164"></a><span id="l33.164" class="difflineplus">+#provider-management {</span>
<a href="#l33.165"></a><span id="l33.165" class="difflineplus">+  height: 310px; /* As far as I can see, the height and width values needs to be hardcoded :( */</span>
<a href="#l33.166"></a><span id="l33.166" class="difflineplus">+  width: 420px;</span>
<a href="#l33.167"></a><span id="l33.167" class="difflineplus">+  display: -moz-box;</span>
<a href="#l33.168"></a><span id="l33.168" class="difflineplus">+  -moz-box-orient: vertical;</span>
<a href="#l33.169"></a><span id="l33.169" class="difflineplus">+}</span>
<a href="#l33.170"></a><span id="l33.170" class="difflineplus">+</span>
<a href="#l33.171"></a><span id="l33.171" class="difflineplus">+#provider-header {</span>
<a href="#l33.172"></a><span id="l33.172" class="difflineplus">+  -moz-box-flex: 0;</span>
<a href="#l33.173"></a><span id="l33.173" class="difflineplus">+}</span>
<a href="#l33.174"></a><span id="l33.174" class="difflineplus">+</span>
<a href="#l33.175"></a><span id="l33.175" class="difflineplus">+#provider-spacebox {</span>
<a href="#l33.176"></a><span id="l33.176" class="difflineplus">+  -moz-box-flex: 1;</span>
<a href="#l33.177"></a><span id="l33.177" class="difflineplus">+}</span>
<a href="#l33.178"></a><span id="l33.178" class="difflineplus">+</span>
<a href="#l33.179"></a><span id="l33.179" class="difflineplus">+#provider-account-settings {</span>
<a href="#l33.180"></a><span id="l33.180" class="difflineplus">+  -moz-box-flex: 0;</span>
<a href="#l33.181"></a><span id="l33.181" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mail/themes/pinstripe/jar.mn</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mail/themes/pinstripe/jar.mn</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -11,16 +11,17 @@ classic.jar:</span>
<a href="#l34.4"></a><span id="l34.4">   skin/classic/messenger/dialogs.css                             (mail/dialogs.css)</span>
<a href="#l34.5"></a><span id="l34.5">   skin/classic/messenger/messenger.css                           (mail/messenger.css)</span>
<a href="#l34.6"></a><span id="l34.6">   skin/classic/messenger/primaryToolbar.css                      (mail/primaryToolbar.css)</span>
<a href="#l34.7"></a><span id="l34.7">   skin/classic/messenger/aboutSupport.css                        (../qute/mail/aboutSupport.css)</span>
<a href="#l34.8"></a><span id="l34.8">   skin/classic/messenger/accountCentral.css                      (mail/accountCentral.css)</span>
<a href="#l34.9"></a><span id="l34.9">   skin/classic/messenger/accountCreation.css                     (mail/accountCreation.css)</span>
<a href="#l34.10"></a><span id="l34.10">   skin/classic/messenger/accountManage.css                       (mail/accountManage.css)</span>
<a href="#l34.11"></a><span id="l34.11">   skin/classic/messenger/accountWizard.css                       (mail/accountWizard.css)</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+  skin/classic/messenger/browserRequest.css                      (mail/browserRequest.css)</span>
<a href="#l34.13"></a><span id="l34.13">   skin/classic/messenger/section_collapsed.png                   (mail/section_collapsed.png)</span>
<a href="#l34.14"></a><span id="l34.14">   skin/classic/messenger/section_expanded.png                    (mail/section_expanded.png)</span>
<a href="#l34.15"></a><span id="l34.15">   skin/classic/messenger/messageHeader.css                       (mail/messageHeader.css)</span>
<a href="#l34.16"></a><span id="l34.16">   skin/classic/messenger/messageWindow.css                       (mail/messageWindow.css)</span>
<a href="#l34.17"></a><span id="l34.17">   skin/classic/messenger/messageBody.css                         (mail/messageBody.css)</span>
<a href="#l34.18"></a><span id="l34.18">   skin/classic/messenger/webSearch.css                          (mail/webSearch.css)</span>
<a href="#l34.19"></a><span id="l34.19">   skin/classic/messenger/attachmentList.css                      (mail/attachmentList.css)</span>
<a href="#l34.20"></a><span id="l34.20">   skin/classic/messenger/msgSelectOffline.css                    (mail/msgSelectOffline.css)</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineat">@@ -111,16 +112,17 @@ classic.jar:</span>
<a href="#l34.22"></a><span id="l34.22"> % skin messenger-newsblog classic/1.0 %skin/classic/messenger-newsblog/</span>
<a href="#l34.23"></a><span id="l34.23">   skin/classic/messenger-newsblog/feed-subscriptions.css         (mail/newsblog/feed-subscriptions.css)</span>
<a href="#l34.24"></a><span id="l34.24">   skin/classic/messenger/preferences/alwaysAsk.png               (mail/preferences/alwaysAsk.png)</span>
<a href="#l34.25"></a><span id="l34.25">   skin/classic/messenger/preferences/application.png             (mail/preferences/application.png)</span>
<a href="#l34.26"></a><span id="l34.26">   skin/classic/messenger/preferences/saveFile.png                (mail/preferences/saveFile.png)</span>
<a href="#l34.27"></a><span id="l34.27">   skin/classic/messenger/preferences/preferences.css             (mail/preferences/preferences.css)</span>
<a href="#l34.28"></a><span id="l34.28">   skin/classic/messenger/preferences/applications.css            (mail/preferences/applications.css)</span>
<a href="#l34.29"></a><span id="l34.29">   skin/classic/messenger/preferences/mail-options.png            (mail/preferences/mail-options.png)</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineplus">+  skin/classic/messenger/preferences/auth-error.png              (mail/preferences/auth-error.png)</span>
<a href="#l34.31"></a><span id="l34.31">   skin/classic/messenger/smime/msgCompSMIMEOverlay.css           (mail/smime/msgCompSMIMEOverlay.css)</span>
<a href="#l34.32"></a><span id="l34.32">   skin/classic/messenger/smime/msgHdrViewSMIMEOverlay.css        (mail/smime/msgHdrViewSMIMEOverlay.css)</span>
<a href="#l34.33"></a><span id="l34.33">   skin/classic/messenger/smime/msgReadSMIMEOverlay.css           (mail/smime/msgReadSMIMEOverlay.css)</span>
<a href="#l34.34"></a><span id="l34.34">   skin/classic/messenger/smime/msgReadSecurityInfo.css           (mail/smime/msgReadSecurityInfo.css)</span>
<a href="#l34.35"></a><span id="l34.35">   skin/classic/messenger/smime/msgCompSecurityInfo.css           (mail/smime/msgCompSecurityInfo.css)</span>
<a href="#l34.36"></a><span id="l34.36">   skin/classic/messenger/smime/certFetchingStatus.css            (mail/smime/certFetchingStatus.css)</span>
<a href="#l34.37"></a><span id="l34.37">   skin/classic/messenger/smime/icons/sbSignOk.png                (mail/smime/sbSignOk.png)</span>
<a href="#l34.38"></a><span id="l34.38">   skin/classic/messenger/smime/icons/sbSignUnknown.png           (mail/smime/sbSignUnknown.png)</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineat">@@ -220,16 +222,18 @@ classic.jar:</span>
<a href="#l34.40"></a><span id="l34.40">   skin/classic/messenger/icons/timeline.png                      (mail/icons/timeline.png)</span>
<a href="#l34.41"></a><span id="l34.41">   skin/classic/messenger/icons/timeline-inverted.png             (mail/icons/timeline-inverted.png)</span>
<a href="#l34.42"></a><span id="l34.42">   skin/classic/messenger/icons/empty-search-results.png          (mail/icons/empty-search-results.png)</span>
<a href="#l34.43"></a><span id="l34.43">   skin/classic/messenger/icons/black_pin.png                     (mail/icons/black_pin.png)</span>
<a href="#l34.44"></a><span id="l34.44">   skin/classic/messenger/icons/red_pin.png                       (mail/icons/red_pin.png)</span>
<a href="#l34.45"></a><span id="l34.45">   skin/classic/messenger/icons/tag1616.png                       (mail/icons/tag1616.png)</span>
<a href="#l34.46"></a><span id="l34.46">   skin/classic/messenger/icons/search-tab.png                    (mail/icons/search-tab.png)</span>
<a href="#l34.47"></a><span id="l34.47">   skin/classic/messenger/icons/message-header-toolbar.png             (mail/icons/message-header-toolbar.png)</span>
<a href="#l34.48"></a><span id="l34.48" class="difflineplus">+  skin/classic/messenger/icons/connecting.png                         (mail/icons/connecting.png)</span>
<a href="#l34.49"></a><span id="l34.49" class="difflineplus">+  skin/classic/messenger/icons/loading.png                            (mail/icons/loading.png)</span>
<a href="#l34.50"></a><span id="l34.50">   skin/classic/messenger/tabs/alltabs-box-bkgnd-icon.png              (mail/tabs/alltabs-box-bkgnd-icon.png)</span>
<a href="#l34.51"></a><span id="l34.51">   skin/classic/messenger/tabs/alltabs-box-overflow-bkgnd-animate.png  (mail/tabs/alltabs-box-overflow-bkgnd-animate.png)</span>
<a href="#l34.52"></a><span id="l34.52">   skin/classic/messenger/tabs/newtab.png                              (mail/tabs/newtab.png)</span>
<a href="#l34.53"></a><span id="l34.53">   skin/classic/messenger/tabs/tab-arrow-end.png                       (mail/tabs/tab-arrow-end.png)</span>
<a href="#l34.54"></a><span id="l34.54">   skin/classic/messenger/tabs/tab-arrow-start.png                     (mail/tabs/tab-arrow-start.png)</span>
<a href="#l34.55"></a><span id="l34.55">   skin/classic/messenger/tabs/tab-bkgnd.png                           (mail/tabs/tab-bkgnd.png)</span>
<a href="#l34.56"></a><span id="l34.56">   skin/classic/messenger/tabs/tabDragIndicator.png                    (mail/tabs/tabDragIndicator.png)</span>
<a href="#l34.57"></a><span id="l34.57">   skin/classic/messenger/tabs/tabbrowser-tabs-bkgnd.png               (mail/tabs/tabbrowser-tabs-bkgnd.png)</span>
<a href="#l34.58"></a><span id="l34.58" class="difflineat">@@ -293,9 +297,10 @@ classic.jar:</span>
<a href="#l34.59"></a><span id="l34.59">   skin/classic/messenger/newmailaccount/accountProvisioner.css          (mail/newmailaccount/accountProvisioner.css)</span>
<a href="#l34.60"></a><span id="l34.60">   skin/classic/messenger/newmailaccount/search.gif                      (mail/newmailaccount/search.gif)</span>
<a href="#l34.61"></a><span id="l34.61">   skin/classic/messenger/newmailaccount/spinner.gif                     (mail/newmailaccount/spinner.gif)</span>
<a href="#l34.62"></a><span id="l34.62">   skin/classic/messenger/newmailaccount/success-addons.png              (mail/newmailaccount/success-addons.png)</span>
<a href="#l34.63"></a><span id="l34.63">   skin/classic/messenger/newmailaccount/success-border.png              (mail/newmailaccount/success-border.png)</span>
<a href="#l34.64"></a><span id="l34.64">   skin/classic/messenger/newmailaccount/success-compose.png             (mail/newmailaccount/success-compose.png)</span>
<a href="#l34.65"></a><span id="l34.65">   skin/classic/messenger/newmailaccount/success-signature.png           (mail/newmailaccount/success-signature.png)</span>
<a href="#l34.66"></a><span id="l34.66">   skin/classic/messenger/newmailaccount/search.png                      (mail/newmailaccount/search.png)</span>
<a href="#l34.67"></a><span id="l34.67" class="difflineminus">-</span>
<a href="#l34.68"></a><span id="l34.68" class="difflineplus">+  skin/classic/messenger/icons/dropbox.png                    (mail/icons/dropbox.png)</span>
<a href="#l34.69"></a><span id="l34.69" class="difflineplus">+  skin/classic/messenger/icons/yousendit.png                  (mail/icons/yousendit.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1">new file mode 100644</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineminus">--- /dev/null</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineplus">+++ b/mail/themes/pinstripe/mail/browserRequest.css</span>
<a href="#l35.4"></a><span id="l35.4" class="difflineat">@@ -0,0 +1,75 @@</span>
<a href="#l35.5"></a><span id="l35.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l35.6"></a><span id="l35.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l35.7"></a><span id="l35.7" class="difflineplus">+ *</span>
<a href="#l35.8"></a><span id="l35.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l35.9"></a><span id="l35.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l35.10"></a><span id="l35.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l35.11"></a><span id="l35.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineplus">+ *</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineplus">+ * License.</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineplus">+ *</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineplus">+ * The Original Code is oauthorizer.</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+ *</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+ * The Initial Developer of the Original Code is Mozilla.</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2010</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineplus">+ *</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineplus">+ * Contributor(s):</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineplus">+ *   Shane Caraveo &lt;shanec@mozillamessaging.com&gt;</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineplus">+ *   Florian Quze &lt;florian@instantbird.org&gt;</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineplus">+ *</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l35.37"></a><span id="l35.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineplus">+ *</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l35.41"></a><span id="l35.41" class="difflineplus">+</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineplus">+#security-button {</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineplus">+  width: 20px;</span>
<a href="#l35.44"></a><span id="l35.44" class="difflineplus">+  padding-right: 5px;</span>
<a href="#l35.45"></a><span id="l35.45" class="difflineplus">+  background-repeat: no-repeat;</span>
<a href="#l35.46"></a><span id="l35.46" class="difflineplus">+}</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineplus">+</span>
<a href="#l35.48"></a><span id="l35.48" class="difflineplus">+#security-button[level=&quot;high&quot;],</span>
<a href="#l35.49"></a><span id="l35.49" class="difflineplus">+#security-button[level=&quot;low&quot;] {</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineplus">+  background-image: url(&quot;chrome://messenger/skin/icons/secure.png&quot;);</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineplus">+}</span>
<a href="#l35.52"></a><span id="l35.52" class="difflineplus">+</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineplus">+#security-button[level=&quot;broken&quot;] {</span>
<a href="#l35.54"></a><span id="l35.54" class="difflineplus">+  background-image: url(&quot;chrome://messenger/skin/icons/insecure.png&quot;);</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineplus">+}</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineplus">+/*</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineplus">+#header {</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineplus">+  overflow: hidden;</span>
<a href="#l35.59"></a><span id="l35.59" class="difflineplus">+  padding: 5px;</span>
<a href="#l35.60"></a><span id="l35.60" class="difflineplus">+  border-bottom: 1px solid black;</span>
<a href="#l35.61"></a><span id="l35.61" class="difflineplus">+  font-weight: bold;</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineplus">+  font-size: 1.2em;</span>
<a href="#l35.63"></a><span id="l35.63" class="difflineplus">+}</span>
<a href="#l35.64"></a><span id="l35.64" class="difflineplus">+*/</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineplus">+</span>
<a href="#l35.66"></a><span id="l35.66" class="difflineplus">+</span>
<a href="#l35.67"></a><span id="l35.67" class="difflineplus">+#header {</span>
<a href="#l35.68"></a><span id="l35.68" class="difflineplus">+    border-bottom: 1px solid rgb(105, 105, 105);</span>
<a href="#l35.69"></a><span id="l35.69" class="difflineplus">+    overflow: hidden;</span>
<a href="#l35.70"></a><span id="l35.70" class="difflineplus">+}</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineplus">+</span>
<a href="#l35.72"></a><span id="l35.72" class="difflineplus">+#addressbox {</span>
<a href="#l35.73"></a><span id="l35.73" class="difflineplus">+    font-weight: bold;</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineplus">+    font-size: normal;</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineplus">+    -moz-appearance: textfield;</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineplus">+    overflow: hidden;</span>
<a href="#l35.77"></a><span id="l35.77" class="difflineplus">+    margin: 5px 5px;</span>
<a href="#l35.78"></a><span id="l35.78" class="difflineplus">+    font-weight: normal;</span>
<a href="#l35.79"></a><span id="l35.79" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mail/themes/pinstripe/mail/compose/messengercompose.css</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mail/themes/pinstripe/mail/compose/messengercompose.css</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -1004,9 +1004,8 @@ blockquote[type=cite] &gt; blockquote {</span>
<a href="#l36.4"></a><span id="l36.4">    color: green !important;</span>
<a href="#l36.5"></a><span id="l36.5">    border-color: green !important;</span>
<a href="#l36.6"></a><span id="l36.6"> }</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8"> blockquote[type=cite] &gt; blockquote &gt; blockquote {</span>
<a href="#l36.9"></a><span id="l36.9">    color: maroon !important;</span>
<a href="#l36.10"></a><span id="l36.10">    border-color: maroon !important;</span>
<a href="#l36.11"></a><span id="l36.11"> }</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mail/themes/pinstripe/mail/preferences/applications.css</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mail/themes/pinstripe/mail/preferences/applications.css</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -88,8 +88,54 @@ menuitem[appHandlerIcon=&quot;plugin&quot;] {</span>
<a href="#l37.4"></a><span id="l37.4"> .shortDetails {</span>
<a href="#l37.5"></a><span id="l37.5">   text-align: right;</span>
<a href="#l37.6"></a><span id="l37.6">   color: GrayText;</span>
<a href="#l37.7"></a><span id="l37.7"> }</span>
<a href="#l37.8"></a><span id="l37.8"> </span>
<a href="#l37.9"></a><span id="l37.9"> richlistbox:focus .shortDetails.selected {</span>
<a href="#l37.10"></a><span id="l37.10">   color: inherit;</span>
<a href="#l37.11"></a><span id="l37.11"> }</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineplus">+</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineplus">+richlistitem.cloudfileAccount {</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineplus">+  padding: 4px;</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineplus">+}</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineplus">+</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineplus">+richlistitem.cloudfileAccount description{</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineplus">+  padding-left: 3px;</span>
<a href="#l37.20"></a><span id="l37.20" class="difflineplus">+}</span>
<a href="#l37.21"></a><span id="l37.21" class="difflineplus">+</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineplus">+/**</span>
<a href="#l37.23"></a><span id="l37.23" class="difflineplus">+ * Used by the outgoing attachment manager</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineplus">+ */</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;connecting&quot;],</span>
<a href="#l37.26"></a><span id="l37.26" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;waiting-to-connect&quot;] {</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;) !important;</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineplus">+}</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineplus">+</span>
<a href="#l37.30"></a><span id="l37.30" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;auth-error&quot;],</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;no-connection&quot;] {</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/error-16.png&quot;) !important;</span>
<a href="#l37.33"></a><span id="l37.33" class="difflineplus">+}</span>
<a href="#l37.34"></a><span id="l37.34" class="difflineplus">+</span>
<a href="#l37.35"></a><span id="l37.35" class="difflineplus">+.cloudfileAccount .typeIcon {</span>
<a href="#l37.36"></a><span id="l37.36" class="difflineplus">+  max-height: 16px;</span>
<a href="#l37.37"></a><span id="l37.37" class="difflineplus">+  max-width: 16px;</span>
<a href="#l37.38"></a><span id="l37.38" class="difflineplus">+  margin-top: 3px;</span>
<a href="#l37.39"></a><span id="l37.39" class="difflineplus">+  margin-bottom: 3px;</span>
<a href="#l37.40"></a><span id="l37.40" class="difflineplus">+}</span>
<a href="#l37.41"></a><span id="l37.41" class="difflineplus">+</span>
<a href="#l37.42"></a><span id="l37.42" class="difflineplus">+#authMessage {</span>
<a href="#l37.43"></a><span id="l37.43" class="difflineplus">+  text-align: center;</span>
<a href="#l37.44"></a><span id="l37.44" class="difflineplus">+  padding: 0px 80px;</span>
<a href="#l37.45"></a><span id="l37.45" class="difflineplus">+}</span>
<a href="#l37.46"></a><span id="l37.46" class="difflineplus">+</span>
<a href="#l37.47"></a><span id="l37.47" class="difflineplus">+#authImage {</span>
<a href="#l37.48"></a><span id="l37.48" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/preferences/auth-error.png&quot;);</span>
<a href="#l37.49"></a><span id="l37.49" class="difflineplus">+  width: 200px;</span>
<a href="#l37.50"></a><span id="l37.50" class="difflineplus">+  height: 200px;</span>
<a href="#l37.51"></a><span id="l37.51" class="difflineplus">+}</span>
<a href="#l37.52"></a><span id="l37.52" class="difflineplus">+</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineplus">+#cloudFileLoadingSpinner {</span>
<a href="#l37.54"></a><span id="l37.54" class="difflineplus">+  width: 16px;</span>
<a href="#l37.55"></a><span id="l37.55" class="difflineplus">+  height: 16px;</span>
<a href="#l37.56"></a><span id="l37.56" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;);</span>
<a href="#l37.57"></a><span id="l37.57" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mail/themes/pinstripe/mail/preferences/preferences.css</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mail/themes/pinstripe/mail/preferences/preferences.css</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -171,8 +171,183 @@ tabpanels {</span>
<a href="#l38.4"></a><span id="l38.4">   border: 1px solid #8B8B8B;</span>
<a href="#l38.5"></a><span id="l38.5"> }</span>
<a href="#l38.6"></a><span id="l38.6"> </span>
<a href="#l38.7"></a><span id="l38.7"> #quotaPercentageBar &gt; .progress-bar {</span>
<a href="#l38.8"></a><span id="l38.8">   -moz-appearance: none;</span>
<a href="#l38.9"></a><span id="l38.9">   background-color: #88AAFF;</span>
<a href="#l38.10"></a><span id="l38.10">   opacity: .5;</span>
<a href="#l38.11"></a><span id="l38.11"> }</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineplus">+</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+/* Attachments */</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineplus">+</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineplus">+body {</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineplus">+  font-size: 12px;</span>
<a href="#l38.17"></a><span id="l38.17" class="difflineplus">+}</span>
<a href="#l38.18"></a><span id="l38.18" class="difflineplus">+</span>
<a href="#l38.19"></a><span id="l38.19" class="difflineplus">+a {</span>
<a href="#l38.20"></a><span id="l38.20" class="difflineplus">+  color: -moz-nativehyperlinktext;</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineplus">+  text-decoration: underline;</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineplus">+}</span>
<a href="#l38.23"></a><span id="l38.23" class="difflineplus">+</span>
<a href="#l38.24"></a><span id="l38.24" class="difflineplus">+/* Setting margins so we can start lining things up */</span>
<a href="#l38.25"></a><span id="l38.25" class="difflineplus">+#accountNameBox label, #accountName, #accountType, #provider-settings {</span>
<a href="#l38.26"></a><span id="l38.26" class="difflineplus">+  margin: 0;</span>
<a href="#l38.27"></a><span id="l38.27" class="difflineplus">+}</span>
<a href="#l38.28"></a><span id="l38.28" class="difflineplus">+</span>
<a href="#l38.29"></a><span id="l38.29" class="difflineplus">+#providerForm #username, #provider-signup {</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineplus">+  width: 250px;</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineplus">+}</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineplus">+#providerForm label{</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineplus">+  width: 75px;</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineplus">+  text-align: right;</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineplus">+//  padding-right: 3px; ???</span>
<a href="#l38.37"></a><span id="l38.37" class="difflineplus">+}</span>
<a href="#l38.38"></a><span id="l38.38" class="difflineplus">+</span>
<a href="#l38.39"></a><span id="l38.39" class="difflineplus">+#provider-signup, #accountType {</span>
<a href="#l38.40"></a><span id="l38.40" class="difflineplus">+  margin-left: 75px;</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineplus">+}</span>
<a href="#l38.42"></a><span id="l38.42" class="difflineplus">+</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineplus">+#providerForm label {</span>
<a href="#l38.44"></a><span id="l38.44" class="difflineplus">+  display: inline-block;</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineplus">+}</span>
<a href="#l38.46"></a><span id="l38.46" class="difflineplus">+</span>
<a href="#l38.47"></a><span id="l38.47" class="difflineplus">+#provider-signup {</span>
<a href="#l38.48"></a><span id="l38.48" class="difflineplus">+  display: block;</span>
<a href="#l38.49"></a><span id="l38.49" class="difflineplus">+}</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineplus">+</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineplus">+/* Making sure there is some spacing between elements */</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineplus">+</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineplus">+#createAccountText {</span>
<a href="#l38.54"></a><span id="l38.54" class="difflineplus">+  margin-bottom: 20px;</span>
<a href="#l38.55"></a><span id="l38.55" class="difflineplus">+  padding: 0px 15px;</span>
<a href="#l38.56"></a><span id="l38.56" class="difflineplus">+}</span>
<a href="#l38.57"></a><span id="l38.57" class="difflineplus">+</span>
<a href="#l38.58"></a><span id="l38.58" class="difflineplus">+#accountType {</span>
<a href="#l38.59"></a><span id="l38.59" class="difflineplus">+  margin-bottom: 5px;</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineplus">+}</span>
<a href="#l38.61"></a><span id="l38.61" class="difflineplus">+</span>
<a href="#l38.62"></a><span id="l38.62" class="difflineplus">+/* I am a hack */</span>
<a href="#l38.63"></a><span id="l38.63" class="difflineplus">+#accountType {</span>
<a href="#l38.64"></a><span id="l38.64" class="difflineplus">+  margin-right: 80px;</span>
<a href="#l38.65"></a><span id="l38.65" class="difflineplus">+}</span>
<a href="#l38.66"></a><span id="l38.66" class="difflineplus">+</span>
<a href="#l38.67"></a><span id="l38.67" class="difflineplus">+#messages #authorizing image,</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineplus">+#messages #error image {</span>
<a href="#l38.69"></a><span id="l38.69" class="difflineplus">+  max-width: 16px;</span>
<a href="#l38.70"></a><span id="l38.70" class="difflineplus">+  max-height: 16px;</span>
<a href="#l38.71"></a><span id="l38.71" class="difflineplus">+}</span>
<a href="#l38.72"></a><span id="l38.72" class="difflineplus">+</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineplus">+#provider-header {</span>
<a href="#l38.74"></a><span id="l38.74" class="difflineplus">+  border-bottom: 1px solid #b1b1b1;</span>
<a href="#l38.75"></a><span id="l38.75" class="difflineplus">+  margin-bottom: 20px;</span>
<a href="#l38.76"></a><span id="l38.76" class="difflineplus">+  height: 50px;</span>
<a href="#l38.77"></a><span id="l38.77" class="difflineplus">+}</span>
<a href="#l38.78"></a><span id="l38.78" class="difflineplus">+</span>
<a href="#l38.79"></a><span id="l38.79" class="difflineplus">+#provider-name {</span>
<a href="#l38.80"></a><span id="l38.80" class="difflineplus">+  padding: 0;</span>
<a href="#l38.81"></a><span id="l38.81" class="difflineplus">+  margin: 0;</span>
<a href="#l38.82"></a><span id="l38.82" class="difflineplus">+  margin-right: 120px;</span>
<a href="#l38.83"></a><span id="l38.83" class="difflineplus">+}</span>
<a href="#l38.84"></a><span id="l38.84" class="difflineplus">+</span>
<a href="#l38.85"></a><span id="l38.85" class="difflineplus">+#provider-name h1 {</span>
<a href="#l38.86"></a><span id="l38.86" class="difflineplus">+  font-size: large;</span>
<a href="#l38.87"></a><span id="l38.87" class="difflineplus">+}</span>
<a href="#l38.88"></a><span id="l38.88" class="difflineplus">+</span>
<a href="#l38.89"></a><span id="l38.89" class="difflineplus">+#provider-name h2 {</span>
<a href="#l38.90"></a><span id="l38.90" class="difflineplus">+  font-size: 12px;</span>
<a href="#l38.91"></a><span id="l38.91" class="difflineplus">+}</span>
<a href="#l38.92"></a><span id="l38.92" class="difflineplus">+</span>
<a href="#l38.93"></a><span id="l38.93" class="difflineplus">+#provider-terms {</span>
<a href="#l38.94"></a><span id="l38.94" class="difflineplus">+  float: right;</span>
<a href="#l38.95"></a><span id="l38.95" class="difflineplus">+  width: 110px;</span>
<a href="#l38.96"></a><span id="l38.96" class="difflineplus">+}</span>
<a href="#l38.97"></a><span id="l38.97" class="difflineplus">+</span>
<a href="#l38.98"></a><span id="l38.98" class="difflineplus">+#provider-terms a {</span>
<a href="#l38.99"></a><span id="l38.99" class="difflineplus">+  font-size: small;</span>
<a href="#l38.100"></a><span id="l38.100" class="difflineplus">+  display: block;</span>
<a href="#l38.101"></a><span id="l38.101" class="difflineplus">+  margin-bottom: 5px;</span>
<a href="#l38.102"></a><span id="l38.102" class="difflineplus">+  text-align: right;</span>
<a href="#l38.103"></a><span id="l38.103" class="difflineplus">+}</span>
<a href="#l38.104"></a><span id="l38.104" class="difflineplus">+</span>
<a href="#l38.105"></a><span id="l38.105" class="difflineplus">+#provider-listing {</span>
<a href="#l38.106"></a><span id="l38.106" class="difflineplus">+  max-width: 150px;</span>
<a href="#l38.107"></a><span id="l38.107" class="difflineplus">+}</span>
<a href="#l38.108"></a><span id="l38.108" class="difflineplus">+</span>
<a href="#l38.109"></a><span id="l38.109" class="difflineplus">+#provider-space {</span>
<a href="#l38.110"></a><span id="l38.110" class="difflineplus">+  text-align: right;</span>
<a href="#l38.111"></a><span id="l38.111" class="difflineplus">+  margin-right: 160px;</span>
<a href="#l38.112"></a><span id="l38.112" class="difflineplus">+  margin-top: 50px;</span>
<a href="#l38.113"></a><span id="l38.113" class="difflineplus">+  height: 100px;</span>
<a href="#l38.114"></a><span id="l38.114" class="difflineplus">+}</span>
<a href="#l38.115"></a><span id="l38.115" class="difflineplus">+</span>
<a href="#l38.116"></a><span id="l38.116" class="difflineplus">+#upgrade {</span>
<a href="#l38.117"></a><span id="l38.117" class="difflineplus">+  margin-top: 1em;</span>
<a href="#l38.118"></a><span id="l38.118" class="difflineplus">+}</span>
<a href="#l38.119"></a><span id="l38.119" class="difflineplus">+</span>
<a href="#l38.120"></a><span id="l38.120" class="difflineplus">+#provider-space-visuals {</span>
<a href="#l38.121"></a><span id="l38.121" class="difflineplus">+  width: 150px;</span>
<a href="#l38.122"></a><span id="l38.122" class="difflineplus">+  height: 150px;</span>
<a href="#l38.123"></a><span id="l38.123" class="difflineplus">+  float: right;</span>
<a href="#l38.124"></a><span id="l38.124" class="difflineplus">+}</span>
<a href="#l38.125"></a><span id="l38.125" class="difflineplus">+</span>
<a href="#l38.126"></a><span id="l38.126" class="difflineplus">+#provider-account-settings {</span>
<a href="#l38.127"></a><span id="l38.127" class="difflineplus">+  text-align: right;</span>
<a href="#l38.128"></a><span id="l38.128" class="difflineplus">+}</span>
<a href="#l38.129"></a><span id="l38.129" class="difflineplus">+</span>
<a href="#l38.130"></a><span id="l38.130" class="difflineplus">+#createAccountTitle {</span>
<a href="#l38.131"></a><span id="l38.131" class="difflineplus">+  font-size: 12px;</span>
<a href="#l38.132"></a><span id="l38.132" class="difflineplus">+  font-weight: bold;</span>
<a href="#l38.133"></a><span id="l38.133" class="difflineplus">+  padding-left: 15px;</span>
<a href="#l38.134"></a><span id="l38.134" class="difflineplus">+  padding-right: 15px;</span>
<a href="#l38.135"></a><span id="l38.135" class="difflineplus">+}</span>
<a href="#l38.136"></a><span id="l38.136" class="difflineplus">+</span>
<a href="#l38.137"></a><span id="l38.137" class="difflineplus">+.space-swatch {</span>
<a href="#l38.138"></a><span id="l38.138" class="difflineplus">+  display: inline-block;</span>
<a href="#l38.139"></a><span id="l38.139" class="difflineplus">+  width: 1em;</span>
<a href="#l38.140"></a><span id="l38.140" class="difflineplus">+  height: 1em;</span>
<a href="#l38.141"></a><span id="l38.141" class="difflineplus">+  border: 1px solid rgba(0,0,0,0.5);</span>
<a href="#l38.142"></a><span id="l38.142" class="difflineplus">+  border-radius: 2px;</span>
<a href="#l38.143"></a><span id="l38.143" class="difflineplus">+  vertical-align: middle;</span>
<a href="#l38.144"></a><span id="l38.144" class="difflineplus">+  -moz-margin-start: 0.5ch;</span>
<a href="#l38.145"></a><span id="l38.145" class="difflineplus">+  -moz-box-sizing: border-box;</span>
<a href="#l38.146"></a><span id="l38.146" class="difflineplus">+}</span>
<a href="#l38.147"></a><span id="l38.147" class="difflineplus">+</span>
<a href="#l38.148"></a><span id="l38.148" class="difflineplus">+/* Main pane padding */</span>
<a href="#l38.149"></a><span id="l38.149" class="difflineplus">+</span>
<a href="#l38.150"></a><span id="l38.150" class="difflineplus">+#provider-management {</span>
<a href="#l38.151"></a><span id="l38.151" class="difflineplus">+  margin: 0 10px;</span>
<a href="#l38.152"></a><span id="l38.152" class="difflineplus">+}</span>
<a href="#l38.153"></a><span id="l38.153" class="difflineplus">+</span>
<a href="#l38.154"></a><span id="l38.154" class="difflineplus">+#provider-name h1 {</span>
<a href="#l38.155"></a><span id="l38.155" class="difflineplus">+  margin: 0;</span>
<a href="#l38.156"></a><span id="l38.156" class="difflineplus">+}</span>
<a href="#l38.157"></a><span id="l38.157" class="difflineplus">+</span>
<a href="#l38.158"></a><span id="l38.158" class="difflineplus">+/* Loading panel */</span>
<a href="#l38.159"></a><span id="l38.159" class="difflineplus">+#cloudFileLoadingPanel, #cloudFileDefaultPanel {</span>
<a href="#l38.160"></a><span id="l38.160" class="difflineplus">+  text-align: center;</span>
<a href="#l38.161"></a><span id="l38.161" class="difflineplus">+  padding-top: 150px;</span>
<a href="#l38.162"></a><span id="l38.162" class="difflineplus">+}</span>
<a href="#l38.163"></a><span id="l38.163" class="difflineplus">+</span>
<a href="#l38.164"></a><span id="l38.164" class="difflineplus">+#provider-settings .indented {</span>
<a href="#l38.165"></a><span id="l38.165" class="difflineplus">+  margin-left: 75px;</span>
<a href="#l38.166"></a><span id="l38.166" class="difflineplus">+}</span>
<a href="#l38.167"></a><span id="l38.167" class="difflineplus">+</span>
<a href="#l38.168"></a><span id="l38.168" class="difflineplus">+/* Flexing */</span>
<a href="#l38.169"></a><span id="l38.169" class="difflineplus">+#provider-management {</span>
<a href="#l38.170"></a><span id="l38.170" class="difflineplus">+  height: 390px; /* As far as I can see, the height and width values needs to be hardcoded :( */</span>
<a href="#l38.171"></a><span id="l38.171" class="difflineplus">+  width: 280px;</span>
<a href="#l38.172"></a><span id="l38.172" class="difflineplus">+  display: -moz-box;</span>
<a href="#l38.173"></a><span id="l38.173" class="difflineplus">+  -moz-box-orient: vertical;</span>
<a href="#l38.174"></a><span id="l38.174" class="difflineplus">+}</span>
<a href="#l38.175"></a><span id="l38.175" class="difflineplus">+</span>
<a href="#l38.176"></a><span id="l38.176" class="difflineplus">+#provider-header {</span>
<a href="#l38.177"></a><span id="l38.177" class="difflineplus">+  -moz-box-flex: 0;</span>
<a href="#l38.178"></a><span id="l38.178" class="difflineplus">+}</span>
<a href="#l38.179"></a><span id="l38.179" class="difflineplus">+</span>
<a href="#l38.180"></a><span id="l38.180" class="difflineplus">+#provider-spacebox {</span>
<a href="#l38.181"></a><span id="l38.181" class="difflineplus">+  -moz-box-flex: 1;</span>
<a href="#l38.182"></a><span id="l38.182" class="difflineplus">+}</span>
<a href="#l38.183"></a><span id="l38.183" class="difflineplus">+</span>
<a href="#l38.184"></a><span id="l38.184" class="difflineplus">+#provider-account-settings {</span>
<a href="#l38.185"></a><span id="l38.185" class="difflineplus">+  -moz-box-flex: 0;</span>
<a href="#l38.186"></a><span id="l38.186" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mail/themes/qute/jar.mn</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mail/themes/qute/jar.mn</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -48,16 +48,17 @@ classic.jar:</span>
<a href="#l39.4"></a><span id="l39.4">   skin/classic/messenger/featureConfigurators/folder-columns.png  (mail/featureConfigurators/folder-columns.png)</span>
<a href="#l39.5"></a><span id="l39.5">   skin/classic/messenger/featureConfigurators/toolbars.png    (mail/featureConfigurators/toolbars.png)</span>
<a href="#l39.6"></a><span id="l39.6">   skin/classic/messenger/primaryToolbar.css                   (mail/primaryToolbar.css)</span>
<a href="#l39.7"></a><span id="l39.7">   skin/classic/messenger/aboutSupport.css                     (mail/aboutSupport.css)</span>
<a href="#l39.8"></a><span id="l39.8">   skin/classic/messenger/accountCentral.css                   (mail/accountCentral.css)</span>
<a href="#l39.9"></a><span id="l39.9">   skin/classic/messenger/accountCreation.css                  (mail/accountCreation.css)</span>
<a href="#l39.10"></a><span id="l39.10">   skin/classic/messenger/accountManage.css                    (mail/accountManage.css)</span>
<a href="#l39.11"></a><span id="l39.11">   skin/classic/messenger/accountWizard.css                    (mail/accountWizard.css)</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineplus">+  skin/classic/messenger/browserRequest.css                   (mail/browserRequest.css)</span>
<a href="#l39.13"></a><span id="l39.13">   skin/classic/messenger/section_collapsed.png                (mail/section_collapsed.png)</span>
<a href="#l39.14"></a><span id="l39.14">   skin/classic/messenger/section_expanded.png                 (mail/section_expanded.png)</span>
<a href="#l39.15"></a><span id="l39.15">   skin/classic/messenger/messageHeader.css                    (mail/messageHeader.css)</span>
<a href="#l39.16"></a><span id="l39.16">   skin/classic/messenger/messageBody.css                      (mail/messageBody.css)</span>
<a href="#l39.17"></a><span id="l39.17">   skin/classic/messenger/webSearch.css                        (mail/webSearch.css)</span>
<a href="#l39.18"></a><span id="l39.18">   skin/classic/messenger/messageQuotes.css                    (mail/messageQuotes.css)</span>
<a href="#l39.19"></a><span id="l39.19">   skin/classic/messenger/messenger.css                        (mail/messenger.css)</span>
<a href="#l39.20"></a><span id="l39.20">   skin/classic/messenger/attachmentList.css                   (mail/attachmentList.css)</span>
<a href="#l39.21"></a><span id="l39.21" class="difflineat">@@ -129,16 +130,17 @@ classic.jar:</span>
<a href="#l39.22"></a><span id="l39.22">   skin/classic/messenger/preferences/security.png             (mail/preferences/security.png)</span>
<a href="#l39.23"></a><span id="l39.23">   skin/classic/messenger/preferences/attachments.png          (mail/preferences/attachments.png)</span>
<a href="#l39.24"></a><span id="l39.24">   skin/classic/messenger/preferences/applications.css         (mail/preferences/applications.css)</span>
<a href="#l39.25"></a><span id="l39.25">   skin/classic/messenger/preferences/saveFile.png             (mail/preferences/saveFile.png)</span>
<a href="#l39.26"></a><span id="l39.26">   skin/classic/messenger/preferences/advanced.png             (mail/preferences/advanced.png)</span>
<a href="#l39.27"></a><span id="l39.27">   skin/classic/messenger/preferences/background.png           (mail/preferences/background.png)</span>
<a href="#l39.28"></a><span id="l39.28">   skin/classic/messenger/preferences/hover.png                (mail/preferences/hover.png)</span>
<a href="#l39.29"></a><span id="l39.29">   skin/classic/messenger/preferences/selected.png             (mail/preferences/selected.png)</span>
<a href="#l39.30"></a><span id="l39.30" class="difflineplus">+  skin/classic/messenger/preferences/auth-error.png           (mail/preferences/auth-error.png)</span>
<a href="#l39.31"></a><span id="l39.31">   skin/classic/messenger/smime/msgCompSMIMEOverlay.css        (mail/smime/msgCompSMIMEOverlay.css)</span>
<a href="#l39.32"></a><span id="l39.32">   skin/classic/messenger/smime/msgHdrViewSMIMEOverlay.css     (mail/smime/msgHdrViewSMIMEOverlay.css)</span>
<a href="#l39.33"></a><span id="l39.33">   skin/classic/messenger/smime/msgReadSMIMEOverlay.css        (mail/smime/msgReadSMIMEOverlay.css)</span>
<a href="#l39.34"></a><span id="l39.34">   skin/classic/messenger/smime/msgReadSecurityInfo.css        (mail/smime/msgReadSecurityInfo.css)</span>
<a href="#l39.35"></a><span id="l39.35">   skin/classic/messenger/smime/msgCompSecurityInfo.css        (mail/smime/msgCompSecurityInfo.css)</span>
<a href="#l39.36"></a><span id="l39.36">   skin/classic/messenger/smime/certFetchingStatus.css         (mail/smime/certFetchingStatus.css)</span>
<a href="#l39.37"></a><span id="l39.37">   skin/classic/messenger/smime/icons/hdrCryptoNotOk.png       (mail/smime/hdrCryptoNotOk.png)</span>
<a href="#l39.38"></a><span id="l39.38">   skin/classic/messenger/smime/icons/hdrCryptoOk.png          (mail/smime/hdrCryptoOk.png)</span>
<a href="#l39.39"></a><span id="l39.39" class="difflineat">@@ -198,16 +200,17 @@ classic.jar:</span>
<a href="#l39.40"></a><span id="l39.40">   skin/classic/messenger/icons/error.png                      (mail/icons/error.png)</span>
<a href="#l39.41"></a><span id="l39.41">   skin/classic/messenger/icons/cancel.png                     (mail/icons/cancel.png)</span>
<a href="#l39.42"></a><span id="l39.42">   skin/classic/messenger/icons/tab-arrow-left.png             (mail/icons/tab-arrow-left.png)</span>
<a href="#l39.43"></a><span id="l39.43">   skin/classic/messenger/icons/tab-arrow-left-inverted.png    (mail/icons/tab-arrow-left-inverted.png)</span>
<a href="#l39.44"></a><span id="l39.44">   skin/classic/messenger/icons/mainwindow-dropdown-arrow.png  (mail/icons/mainwindow-dropdown-arrow.png)</span>
<a href="#l39.45"></a><span id="l39.45">   skin/classic/messenger/icons/mainwindow-dropdown-arrow-inverted.png  (mail/icons/mainwindow-dropdown-arrow-inverted.png)</span>
<a href="#l39.46"></a><span id="l39.46">   skin/classic/messenger/icons/tabDragIndicator.png           (mail/icons/tabDragIndicator.png)</span>
<a href="#l39.47"></a><span id="l39.47">   skin/classic/messenger/icons/tab.png                        (mail/icons/tab.png)</span>
<a href="#l39.48"></a><span id="l39.48" class="difflineplus">+  skin/classic/messenger/icons/connecting.png                 (mail/icons/connecting.png)</span>
<a href="#l39.49"></a><span id="l39.49">   skin/classic/messenger/icons/loading.png                    (mail/icons/loading.png)</span>
<a href="#l39.50"></a><span id="l39.50">   skin/classic/messenger/accountcentral/read-messages.png     (mail/accountcentral/read-messages.png)</span>
<a href="#l39.51"></a><span id="l39.51">   skin/classic/messenger/accountcentral/write-message.png     (mail/accountcentral/write-message.png)</span>
<a href="#l39.52"></a><span id="l39.52">   skin/classic/messenger/accountcentral/create-account.png    (mail/accountcentral/create-account.png)</span>
<a href="#l39.53"></a><span id="l39.53">   skin/classic/messenger/accountcentral/account-settings.png  (mail/accountcentral/account-settings.png)</span>
<a href="#l39.54"></a><span id="l39.54">   skin/classic/messenger/accountcentral/search-messages.png   (mail/accountcentral/search-messages.png)</span>
<a href="#l39.55"></a><span id="l39.55">   skin/classic/messenger/accountcentral/manage-filters.png    (mail/accountcentral/manage-filters.png)</span>
<a href="#l39.56"></a><span id="l39.56">   skin/classic/messenger/accountcentral/offline-settings.png  (mail/accountcentral/offline-settings.png)</span>
<a href="#l39.57"></a><span id="l39.57" class="difflineat">@@ -242,16 +245,18 @@ classic.jar:</span>
<a href="#l39.58"></a><span id="l39.58">   skin/classic/messenger/newmailaccount/accountProvisioner.css          (mail/newmailaccount/accountProvisioner.css)</span>
<a href="#l39.59"></a><span id="l39.59">   skin/classic/messenger/newmailaccount/search.gif                      (mail/newmailaccount/search.gif)</span>
<a href="#l39.60"></a><span id="l39.60">   skin/classic/messenger/newmailaccount/spinner.gif                     (mail/newmailaccount/spinner.gif)</span>
<a href="#l39.61"></a><span id="l39.61">   skin/classic/messenger/newmailaccount/success-addons.png              (mail/newmailaccount/success-addons.png)</span>
<a href="#l39.62"></a><span id="l39.62">   skin/classic/messenger/newmailaccount/success-border.png              (mail/newmailaccount/success-border.png)</span>
<a href="#l39.63"></a><span id="l39.63">   skin/classic/messenger/newmailaccount/success-compose.png             (mail/newmailaccount/success-compose.png)</span>
<a href="#l39.64"></a><span id="l39.64">   skin/classic/messenger/newmailaccount/success-signature.png           (mail/newmailaccount/success-signature.png)</span>
<a href="#l39.65"></a><span id="l39.65">   skin/classic/messenger/newmailaccount/search.png                      (mail/newmailaccount/search.png)</span>
<a href="#l39.66"></a><span id="l39.66" class="difflineplus">+ skin/classic/messenger/icons/dropbox.png                    (mail/icons/dropbox.png)</span>
<a href="#l39.67"></a><span id="l39.67" class="difflineplus">+ skin/classic/messenger/icons/yousendit.png                  (mail/icons/yousendit.png)</span>
<a href="#l39.68"></a><span id="l39.68"> #ifdef XP_WIN</span>
<a href="#l39.69"></a><span id="l39.69"> % skin communicator classic/1.0 %skin/classic/aero/communicator/ os=WINNT osversion&gt;=6</span>
<a href="#l39.70"></a><span id="l39.70">   skin/classic/aero/communicator/communicator.css                       (mail/communicator.css)</span>
<a href="#l39.71"></a><span id="l39.71">   skin/classic/aero/communicator/smileys.css                            (mail/smileys.css)</span>
<a href="#l39.72"></a><span id="l39.72">   skin/classic/aero/communicator/icons/smileys/smiley-smile.png         (mail/icons/smiley-smile-aero.png)</span>
<a href="#l39.73"></a><span id="l39.73">   skin/classic/aero/communicator/icons/smileys/smiley-frown.png         (mail/icons/smiley-frown-aero.png)</span>
<a href="#l39.74"></a><span id="l39.74">   skin/classic/aero/communicator/icons/smileys/smiley-wink.png          (mail/icons/smiley-wink-aero.png)</span>
<a href="#l39.75"></a><span id="l39.75">   skin/classic/aero/communicator/icons/smileys/smiley-tongue-out.png    (mail/icons/smiley-tongue-out-aero.png)</span>
<a href="#l39.76"></a><span id="l39.76" class="difflineat">@@ -357,16 +362,17 @@ classic.jar:</span>
<a href="#l39.77"></a><span id="l39.77">   skin/classic/aero/messenger/preferences/security.png             (mail/preferences/security-aero.png)</span>
<a href="#l39.78"></a><span id="l39.78">   skin/classic/aero/messenger/preferences/attachments.png          (mail/preferences/attachments-aero.png)</span>
<a href="#l39.79"></a><span id="l39.79">   skin/classic/aero/messenger/preferences/applications.css         (mail/preferences/applications.css)</span>
<a href="#l39.80"></a><span id="l39.80">   skin/classic/aero/messenger/preferences/saveFile.png             (mail/preferences/saveFile.png)</span>
<a href="#l39.81"></a><span id="l39.81">   skin/classic/aero/messenger/preferences/advanced.png             (mail/preferences/advanced-aero.png)</span>
<a href="#l39.82"></a><span id="l39.82">   skin/classic/aero/messenger/preferences/background.png           (mail/preferences/background.png)</span>
<a href="#l39.83"></a><span id="l39.83">   skin/classic/aero/messenger/preferences/hover.png                (mail/preferences/hover.png)</span>
<a href="#l39.84"></a><span id="l39.84">   skin/classic/aero/messenger/preferences/selected.png             (mail/preferences/selected.png)</span>
<a href="#l39.85"></a><span id="l39.85" class="difflineplus">+  skin/classic/aero/messenger/preferences/auth-error.png           (mail/preferences/auth-error.png)</span>
<a href="#l39.86"></a><span id="l39.86">   skin/classic/aero/messenger/smime/msgCompSMIMEOverlay.css        (mail/smime/msgCompSMIMEOverlay.css)</span>
<a href="#l39.87"></a><span id="l39.87">   skin/classic/aero/messenger/smime/msgHdrViewSMIMEOverlay.css     (mail/smime/msgHdrViewSMIMEOverlay.css)</span>
<a href="#l39.88"></a><span id="l39.88">   skin/classic/aero/messenger/smime/msgReadSMIMEOverlay.css        (mail/smime/msgReadSMIMEOverlay.css)</span>
<a href="#l39.89"></a><span id="l39.89">   skin/classic/aero/messenger/smime/msgReadSecurityInfo.css        (mail/smime/msgReadSecurityInfo.css)</span>
<a href="#l39.90"></a><span id="l39.90">   skin/classic/aero/messenger/smime/msgCompSecurityInfo.css        (mail/smime/msgCompSecurityInfo.css)</span>
<a href="#l39.91"></a><span id="l39.91">   skin/classic/aero/messenger/smime/certFetchingStatus.css         (mail/smime/certFetchingStatus.css)</span>
<a href="#l39.92"></a><span id="l39.92">   skin/classic/aero/messenger/smime/icons/hdrCryptoNotOk.png       (mail/smime/hdrCryptoNotOk-aero.png)</span>
<a href="#l39.93"></a><span id="l39.93">   skin/classic/aero/messenger/smime/icons/hdrCryptoOk.png          (mail/smime/hdrCryptoOk-aero.png)</span>
<a href="#l39.94"></a><span id="l39.94" class="difflineat">@@ -455,25 +461,27 @@ classic.jar:</span>
<a href="#l39.95"></a><span id="l39.95">   skin/classic/aero/messenger/icons/arrow/arrow-right-dim.png      (mail/icons/arrow/arrow-right-dim.png)</span>
<a href="#l39.96"></a><span id="l39.96">   skin/classic/aero/messenger/icons/arrow/arrow-up-dim.png         (mail/icons/arrow/arrow-up-dim.png)</span>
<a href="#l39.97"></a><span id="l39.97">   skin/classic/aero/messenger/icons/arrow/arrow-down-dim.png       (mail/icons/arrow/arrow-down-dim.png)</span>
<a href="#l39.98"></a><span id="l39.98">   skin/classic/aero/messenger/icons/arrow/foldercycler-arrow-left.png        (mail/icons/arrow/foldercycler-arrow-left.png)</span>
<a href="#l39.99"></a><span id="l39.99">   skin/classic/aero/messenger/icons/arrow/foldercycler-arrow-right.png       (mail/icons/arrow/foldercycler-arrow-right.png)</span>
<a href="#l39.100"></a><span id="l39.100">   skin/classic/aero/messenger/icons/search-favorite.png            (mail/icons/search-favorite.png)</span>
<a href="#l39.101"></a><span id="l39.101">   skin/classic/aero/messenger/icons/xp-pin-grey.png                (mail/icons/xp-pin-grey.png)</span>
<a href="#l39.102"></a><span id="l39.102">   skin/classic/aero/messenger/icons/xp-pin-red.png                 (mail/icons/xp-pin-red.png)</span>
<a href="#l39.103"></a><span id="l39.103" class="difflineplus">+  skin/classic/aero/messenger/icons/connecting.png                 (mail/icons/connecting.png)</span>
<a href="#l39.104"></a><span id="l39.104">   skin/classic/aero/messenger/icons/loading.png                    (mail/icons/loading.png)</span>
<a href="#l39.105"></a><span id="l39.105">   skin/classic/aero/messenger/tagbg.png                            (mail/tagbg.png)</span>
<a href="#l39.106"></a><span id="l39.106">   skin/classic/aero/messenger/icons/download.png                   (mail/icons/download.png)</span>
<a href="#l39.107"></a><span id="l39.107"> % skin messenger-newsblog classic/1.0 %skin/classic/aero/messenger-newsblog/ os=WINNT osversion&gt;=6</span>
<a href="#l39.108"></a><span id="l39.108">   skin/classic/aero/messenger-newsblog/feed-subscriptions.css      (mail/newsblog/feed-subscriptions.css)</span>
<a href="#l39.109"></a><span id="l39.109">   skin/classic/aero/messenger-newsblog/icons/rss-feed.png          (mail/newsblog/rss-feed-aero.png)</span>
<a href="#l39.110"></a><span id="l39.110">   skin/classic/aero/messenger-newsblog/icons/server-rss.png        (mail/newsblog/server-rss-aero.png)</span>
<a href="#l39.111"></a><span id="l39.111">   skin/classic/aero/messenger/newmailaccount/accountProvisioner.css          (mail/newmailaccount/accountProvisioner-aero.css)</span>
<a href="#l39.112"></a><span id="l39.112">   skin/classic/aero/messenger/newmailaccount/search.gif                      (mail/newmailaccount/search.gif)</span>
<a href="#l39.113"></a><span id="l39.113">   skin/classic/aero/messenger/newmailaccount/spinner.gif                     (mail/newmailaccount/spinner.gif)</span>
<a href="#l39.114"></a><span id="l39.114">   skin/classic/aero/messenger/newmailaccount/success-addons.png              (mail/newmailaccount/success-addons.png)</span>
<a href="#l39.115"></a><span id="l39.115">   skin/classic/aero/messenger/newmailaccount/success-border.png              (mail/newmailaccount/success-border.png)</span>
<a href="#l39.116"></a><span id="l39.116">   skin/classic/aero/messenger/newmailaccount/success-compose.png             (mail/newmailaccount/success-compose.png)</span>
<a href="#l39.117"></a><span id="l39.117">   skin/classic/aero/messenger/newmailaccount/success-signature.png           (mail/newmailaccount/success-signature.png)</span>
<a href="#l39.118"></a><span id="l39.118">   skin/classic/aero/messenger/newmailaccount/search.png                      (mail/newmailaccount/search.png)</span>
<a href="#l39.119"></a><span id="l39.119" class="difflineminus">-</span>
<a href="#l39.120"></a><span id="l39.120" class="difflineplus">+  skin/classic/aero/messenger/icons/dropbox.png                    (mail/icons/dropbox.png)</span>
<a href="#l39.121"></a><span id="l39.121" class="difflineplus">+  skin/classic/aero/messenger/icons/yousendit.png                  (mail/icons/yousendit.png)</span>
<a href="#l39.122"></a><span id="l39.122"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1">new file mode 100644</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineminus">--- /dev/null</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineplus">+++ b/mail/themes/qute/mail/browserRequest.css</span>
<a href="#l40.4"></a><span id="l40.4" class="difflineat">@@ -0,0 +1,65 @@</span>
<a href="#l40.5"></a><span id="l40.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l40.6"></a><span id="l40.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l40.7"></a><span id="l40.7" class="difflineplus">+ *</span>
<a href="#l40.8"></a><span id="l40.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l40.9"></a><span id="l40.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l40.10"></a><span id="l40.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l40.11"></a><span id="l40.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineplus">+ *</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l40.16"></a><span id="l40.16" class="difflineplus">+ * License.</span>
<a href="#l40.17"></a><span id="l40.17" class="difflineplus">+ *</span>
<a href="#l40.18"></a><span id="l40.18" class="difflineplus">+ * The Original Code is oauthorizer.</span>
<a href="#l40.19"></a><span id="l40.19" class="difflineplus">+ *</span>
<a href="#l40.20"></a><span id="l40.20" class="difflineplus">+ * The Initial Developer of the Original Code is Mozilla.</span>
<a href="#l40.21"></a><span id="l40.21" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2010</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l40.23"></a><span id="l40.23" class="difflineplus">+ *</span>
<a href="#l40.24"></a><span id="l40.24" class="difflineplus">+ * Contributor(s):</span>
<a href="#l40.25"></a><span id="l40.25" class="difflineplus">+ *   Shane Caraveo &lt;shanec@mozillamessaging.com&gt;</span>
<a href="#l40.26"></a><span id="l40.26" class="difflineplus">+ *   Florian Quze &lt;florian@instantbird.org&gt;</span>
<a href="#l40.27"></a><span id="l40.27" class="difflineplus">+ *</span>
<a href="#l40.28"></a><span id="l40.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l40.29"></a><span id="l40.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l40.30"></a><span id="l40.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l40.33"></a><span id="l40.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l40.34"></a><span id="l40.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l40.35"></a><span id="l40.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l40.36"></a><span id="l40.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l40.37"></a><span id="l40.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l40.38"></a><span id="l40.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l40.39"></a><span id="l40.39" class="difflineplus">+ *</span>
<a href="#l40.40"></a><span id="l40.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineplus">+</span>
<a href="#l40.42"></a><span id="l40.42" class="difflineplus">+#security-button {</span>
<a href="#l40.43"></a><span id="l40.43" class="difflineplus">+  width: 20px;</span>
<a href="#l40.44"></a><span id="l40.44" class="difflineplus">+  padding-right: 5px;</span>
<a href="#l40.45"></a><span id="l40.45" class="difflineplus">+  background-repeat: no-repeat;</span>
<a href="#l40.46"></a><span id="l40.46" class="difflineplus">+}</span>
<a href="#l40.47"></a><span id="l40.47" class="difflineplus">+</span>
<a href="#l40.48"></a><span id="l40.48" class="difflineplus">+#security-button[level=&quot;high&quot;],</span>
<a href="#l40.49"></a><span id="l40.49" class="difflineplus">+#security-button[level=&quot;low&quot;] {</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineplus">+  background-image: url(&quot;chrome://messenger/skin/icons/secure.png&quot;);</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineplus">+}</span>
<a href="#l40.52"></a><span id="l40.52" class="difflineplus">+</span>
<a href="#l40.53"></a><span id="l40.53" class="difflineplus">+#security-button[level=&quot;broken&quot;] {</span>
<a href="#l40.54"></a><span id="l40.54" class="difflineplus">+  background-image: url(&quot;chrome://messenger/skin/icons/insecure.png&quot;);</span>
<a href="#l40.55"></a><span id="l40.55" class="difflineplus">+}</span>
<a href="#l40.56"></a><span id="l40.56" class="difflineplus">+</span>
<a href="#l40.57"></a><span id="l40.57" class="difflineplus">+#header {</span>
<a href="#l40.58"></a><span id="l40.58" class="difflineplus">+  overflow: hidden;</span>
<a href="#l40.59"></a><span id="l40.59" class="difflineplus">+  border-bottom: 1px solid black;</span>
<a href="#l40.60"></a><span id="l40.60" class="difflineplus">+}</span>
<a href="#l40.61"></a><span id="l40.61" class="difflineplus">+</span>
<a href="#l40.62"></a><span id="l40.62" class="difflineplus">+#addressbox {</span>
<a href="#l40.63"></a><span id="l40.63" class="difflineplus">+  font-weight: bold;</span>
<a href="#l40.64"></a><span id="l40.64" class="difflineplus">+  font-size: normal;</span>
<a href="#l40.65"></a><span id="l40.65" class="difflineplus">+  -moz-appearance: textfield;</span>
<a href="#l40.66"></a><span id="l40.66" class="difflineplus">+  overflow: hidden;</span>
<a href="#l40.67"></a><span id="l40.67" class="difflineplus">+  margin: 0px 5px;</span>
<a href="#l40.68"></a><span id="l40.68" class="difflineplus">+  font-weight: normal;</span>
<a href="#l40.69"></a><span id="l40.69" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mail/themes/qute/mail/preferences/applications.css</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mail/themes/qute/mail/preferences/applications.css</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -93,8 +93,46 @@ menuitem[appHandlerIcon=&quot;plugin&quot;] {</span>
<a href="#l41.4"></a><span id="l41.4"> .shortDetails {</span>
<a href="#l41.5"></a><span id="l41.5">   text-align: right;</span>
<a href="#l41.6"></a><span id="l41.6">   color: GrayText;</span>
<a href="#l41.7"></a><span id="l41.7"> }</span>
<a href="#l41.8"></a><span id="l41.8"> </span>
<a href="#l41.9"></a><span id="l41.9"> richlistbox:focus .shortDetails.selected {</span>
<a href="#l41.10"></a><span id="l41.10">   color: inherit;</span>
<a href="#l41.11"></a><span id="l41.11"> }</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineplus">+</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+/**</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineplus">+ * Used by the outgoing attachment manager</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineplus">+ */</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineplus">+</span>
<a href="#l41.17"></a><span id="l41.17" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;connecting&quot;],</span>
<a href="#l41.18"></a><span id="l41.18" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;waiting-to-connect&quot;] {</span>
<a href="#l41.19"></a><span id="l41.19" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;) !important;</span>
<a href="#l41.20"></a><span id="l41.20" class="difflineplus">+}</span>
<a href="#l41.21"></a><span id="l41.21" class="difflineplus">+</span>
<a href="#l41.22"></a><span id="l41.22" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;auth-error&quot;],</span>
<a href="#l41.23"></a><span id="l41.23" class="difflineplus">+richlistitem.cloudfileAccount[state=&quot;no-connection&quot;] {</span>
<a href="#l41.24"></a><span id="l41.24" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/error-16.png&quot;) !important;</span>
<a href="#l41.25"></a><span id="l41.25" class="difflineplus">+}</span>
<a href="#l41.26"></a><span id="l41.26" class="difflineplus">+</span>
<a href="#l41.27"></a><span id="l41.27" class="difflineplus">+.cloudfileAccount .typeIcon {</span>
<a href="#l41.28"></a><span id="l41.28" class="difflineplus">+  max-height: 16px;</span>
<a href="#l41.29"></a><span id="l41.29" class="difflineplus">+  max-width: 16px;</span>
<a href="#l41.30"></a><span id="l41.30" class="difflineplus">+  margin-top: 3px;</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineplus">+  margin-bottom: 3px;</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineplus">+}</span>
<a href="#l41.33"></a><span id="l41.33" class="difflineplus">+</span>
<a href="#l41.34"></a><span id="l41.34" class="difflineplus">+#authMessage {</span>
<a href="#l41.35"></a><span id="l41.35" class="difflineplus">+  text-align: center;</span>
<a href="#l41.36"></a><span id="l41.36" class="difflineplus">+  padding: 0px 80px;</span>
<a href="#l41.37"></a><span id="l41.37" class="difflineplus">+}</span>
<a href="#l41.38"></a><span id="l41.38" class="difflineplus">+</span>
<a href="#l41.39"></a><span id="l41.39" class="difflineplus">+#authImage {</span>
<a href="#l41.40"></a><span id="l41.40" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/preferences/auth-error.png&quot;);</span>
<a href="#l41.41"></a><span id="l41.41" class="difflineplus">+  width: 200px;</span>
<a href="#l41.42"></a><span id="l41.42" class="difflineplus">+  height: 200px;</span>
<a href="#l41.43"></a><span id="l41.43" class="difflineplus">+}</span>
<a href="#l41.44"></a><span id="l41.44" class="difflineplus">+</span>
<a href="#l41.45"></a><span id="l41.45" class="difflineplus">+#cloudFileLoadingSpinner {</span>
<a href="#l41.46"></a><span id="l41.46" class="difflineplus">+  width: 16px;</span>
<a href="#l41.47"></a><span id="l41.47" class="difflineplus">+  height: 16px;</span>
<a href="#l41.48"></a><span id="l41.48" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;);</span>
<a href="#l41.49"></a><span id="l41.49" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mail/themes/qute/mail/preferences/preferences.css</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mail/themes/qute/mail/preferences/preferences.css</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -129,8 +129,169 @@ radio[pane=paneAdvanced] {</span>
<a href="#l42.4"></a><span id="l42.4">   border: 1px solid ThreeDShadow;</span>
<a href="#l42.5"></a><span id="l42.5"> }</span>
<a href="#l42.6"></a><span id="l42.6"> </span>
<a href="#l42.7"></a><span id="l42.7"> #quotaPercentageBar &gt; .progress-bar {</span>
<a href="#l42.8"></a><span id="l42.8">   -moz-appearance: none;</span>
<a href="#l42.9"></a><span id="l42.9">   background-color: #88AAFF;</span>
<a href="#l42.10"></a><span id="l42.10">   opacity: .5;</span>
<a href="#l42.11"></a><span id="l42.11"> }</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineplus">+</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+/* Attachments */</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineplus">+</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineplus">+body {</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineplus">+  font: message-box;</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineplus">+}</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineplus">+</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineplus">+a {</span>
<a href="#l42.20"></a><span id="l42.20" class="difflineplus">+  color: -moz-nativehyperlinktext;</span>
<a href="#l42.21"></a><span id="l42.21" class="difflineplus">+  text-decoration: underline;</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineplus">+}</span>
<a href="#l42.23"></a><span id="l42.23" class="difflineplus">+</span>
<a href="#l42.24"></a><span id="l42.24" class="difflineplus">+/* Setting margins so we can start lining things up */</span>
<a href="#l42.25"></a><span id="l42.25" class="difflineplus">+#accountNameBox label, #accountName, #accountType, #provider-settings {</span>
<a href="#l42.26"></a><span id="l42.26" class="difflineplus">+  margin: 0;</span>
<a href="#l42.27"></a><span id="l42.27" class="difflineplus">+}</span>
<a href="#l42.28"></a><span id="l42.28" class="difflineplus">+</span>
<a href="#l42.29"></a><span id="l42.29" class="difflineplus">+#providerForm #username, #provider-signup {</span>
<a href="#l42.30"></a><span id="l42.30" class="difflineplus">+  width: 250px;</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineplus">+}</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+</span>
<a href="#l42.33"></a><span id="l42.33" class="difflineplus">+#providerForm label{</span>
<a href="#l42.34"></a><span id="l42.34" class="difflineplus">+  width: 150px;</span>
<a href="#l42.35"></a><span id="l42.35" class="difflineplus">+  text-align: right;</span>
<a href="#l42.36"></a><span id="l42.36" class="difflineplus">+//  padding-right: 3px; ???</span>
<a href="#l42.37"></a><span id="l42.37" class="difflineplus">+}</span>
<a href="#l42.38"></a><span id="l42.38" class="difflineplus">+</span>
<a href="#l42.39"></a><span id="l42.39" class="difflineplus">+#provider-signup, #accountType {</span>
<a href="#l42.40"></a><span id="l42.40" class="difflineplus">+  margin-left: 150px;</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineplus">+}</span>
<a href="#l42.42"></a><span id="l42.42" class="difflineplus">+</span>
<a href="#l42.43"></a><span id="l42.43" class="difflineplus">+#providerForm label {</span>
<a href="#l42.44"></a><span id="l42.44" class="difflineplus">+  display: inline-block;</span>
<a href="#l42.45"></a><span id="l42.45" class="difflineplus">+}</span>
<a href="#l42.46"></a><span id="l42.46" class="difflineplus">+</span>
<a href="#l42.47"></a><span id="l42.47" class="difflineplus">+#provider-signup {</span>
<a href="#l42.48"></a><span id="l42.48" class="difflineplus">+  display: block;</span>
<a href="#l42.49"></a><span id="l42.49" class="difflineplus">+}</span>
<a href="#l42.50"></a><span id="l42.50" class="difflineplus">+</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineplus">+/* Making sure there is some spacing between elements */</span>
<a href="#l42.52"></a><span id="l42.52" class="difflineplus">+</span>
<a href="#l42.53"></a><span id="l42.53" class="difflineplus">+#createAccountText {</span>
<a href="#l42.54"></a><span id="l42.54" class="difflineplus">+  margin-bottom: 20px;</span>
<a href="#l42.55"></a><span id="l42.55" class="difflineplus">+  padding: 0px 15px;</span>
<a href="#l42.56"></a><span id="l42.56" class="difflineplus">+}</span>
<a href="#l42.57"></a><span id="l42.57" class="difflineplus">+</span>
<a href="#l42.58"></a><span id="l42.58" class="difflineplus">+#accountType {</span>
<a href="#l42.59"></a><span id="l42.59" class="difflineplus">+  margin-bottom: 5px;</span>
<a href="#l42.60"></a><span id="l42.60" class="difflineplus">+}</span>
<a href="#l42.61"></a><span id="l42.61" class="difflineplus">+</span>
<a href="#l42.62"></a><span id="l42.62" class="difflineplus">+/* I am a hack */</span>
<a href="#l42.63"></a><span id="l42.63" class="difflineplus">+#accountType {</span>
<a href="#l42.64"></a><span id="l42.64" class="difflineplus">+  margin-right: 62px;</span>
<a href="#l42.65"></a><span id="l42.65" class="difflineplus">+}</span>
<a href="#l42.66"></a><span id="l42.66" class="difflineplus">+</span>
<a href="#l42.67"></a><span id="l42.67" class="difflineplus">+#messages #authorizing image,</span>
<a href="#l42.68"></a><span id="l42.68" class="difflineplus">+#messages #error image {</span>
<a href="#l42.69"></a><span id="l42.69" class="difflineplus">+  max-width: 16px;</span>
<a href="#l42.70"></a><span id="l42.70" class="difflineplus">+  max-height: 16px;</span>
<a href="#l42.71"></a><span id="l42.71" class="difflineplus">+}</span>
<a href="#l42.72"></a><span id="l42.72" class="difflineplus">+</span>
<a href="#l42.73"></a><span id="l42.73" class="difflineplus">+#provider-header {</span>
<a href="#l42.74"></a><span id="l42.74" class="difflineplus">+  border-bottom: 1px solid #898c95;</span>
<a href="#l42.75"></a><span id="l42.75" class="difflineplus">+  margin-bottom: 20px;</span>
<a href="#l42.76"></a><span id="l42.76" class="difflineplus">+  padding-bottom: 20px;</span>
<a href="#l42.77"></a><span id="l42.77" class="difflineplus">+}</span>
<a href="#l42.78"></a><span id="l42.78" class="difflineplus">+</span>
<a href="#l42.79"></a><span id="l42.79" class="difflineplus">+#provider-name {</span>
<a href="#l42.80"></a><span id="l42.80" class="difflineplus">+  padding: 0;</span>
<a href="#l42.81"></a><span id="l42.81" class="difflineplus">+  margin: 0;</span>
<a href="#l42.82"></a><span id="l42.82" class="difflineplus">+  margin-right: 120px;</span>
<a href="#l42.83"></a><span id="l42.83" class="difflineplus">+}</span>
<a href="#l42.84"></a><span id="l42.84" class="difflineplus">+</span>
<a href="#l42.85"></a><span id="l42.85" class="difflineplus">+#provider-name h1 {</span>
<a href="#l42.86"></a><span id="l42.86" class="difflineplus">+  font-size: large;</span>
<a href="#l42.87"></a><span id="l42.87" class="difflineplus">+}</span>
<a href="#l42.88"></a><span id="l42.88" class="difflineplus">+</span>
<a href="#l42.89"></a><span id="l42.89" class="difflineplus">+#provider-name h2 {</span>
<a href="#l42.90"></a><span id="l42.90" class="difflineplus">+  font: message-box;</span>
<a href="#l42.91"></a><span id="l42.91" class="difflineplus">+}</span>
<a href="#l42.92"></a><span id="l42.92" class="difflineplus">+</span>
<a href="#l42.93"></a><span id="l42.93" class="difflineplus">+#provider-terms {</span>
<a href="#l42.94"></a><span id="l42.94" class="difflineplus">+  float: right;</span>
<a href="#l42.95"></a><span id="l42.95" class="difflineplus">+  width: 110px;</span>
<a href="#l42.96"></a><span id="l42.96" class="difflineplus">+}</span>
<a href="#l42.97"></a><span id="l42.97" class="difflineplus">+</span>
<a href="#l42.98"></a><span id="l42.98" class="difflineplus">+#provider-terms a {</span>
<a href="#l42.99"></a><span id="l42.99" class="difflineplus">+  display: block;</span>
<a href="#l42.100"></a><span id="l42.100" class="difflineplus">+  margin-bottom: 5px;</span>
<a href="#l42.101"></a><span id="l42.101" class="difflineplus">+  text-align: right;</span>
<a href="#l42.102"></a><span id="l42.102" class="difflineplus">+}</span>
<a href="#l42.103"></a><span id="l42.103" class="difflineplus">+</span>
<a href="#l42.104"></a><span id="l42.104" class="difflineplus">+#provider-listing {</span>
<a href="#l42.105"></a><span id="l42.105" class="difflineplus">+  max-width: 150px;</span>
<a href="#l42.106"></a><span id="l42.106" class="difflineplus">+}</span>
<a href="#l42.107"></a><span id="l42.107" class="difflineplus">+</span>
<a href="#l42.108"></a><span id="l42.108" class="difflineplus">+#provider-space {</span>
<a href="#l42.109"></a><span id="l42.109" class="difflineplus">+  text-align: right;</span>
<a href="#l42.110"></a><span id="l42.110" class="difflineplus">+  margin-right: 170px;</span>
<a href="#l42.111"></a><span id="l42.111" class="difflineplus">+  height: 100px;</span>
<a href="#l42.112"></a><span id="l42.112" class="difflineplus">+}</span>
<a href="#l42.113"></a><span id="l42.113" class="difflineplus">+</span>
<a href="#l42.114"></a><span id="l42.114" class="difflineplus">+#upgrade {</span>
<a href="#l42.115"></a><span id="l42.115" class="difflineplus">+  margin-top: 1em;</span>
<a href="#l42.116"></a><span id="l42.116" class="difflineplus">+}</span>
<a href="#l42.117"></a><span id="l42.117" class="difflineplus">+</span>
<a href="#l42.118"></a><span id="l42.118" class="difflineplus">+#provider-space-visuals {</span>
<a href="#l42.119"></a><span id="l42.119" class="difflineplus">+  float: right;</span>
<a href="#l42.120"></a><span id="l42.120" class="difflineplus">+}</span>
<a href="#l42.121"></a><span id="l42.121" class="difflineplus">+</span>
<a href="#l42.122"></a><span id="l42.122" class="difflineplus">+#provider-account-settings {</span>
<a href="#l42.123"></a><span id="l42.123" class="difflineplus">+  text-align: right;</span>
<a href="#l42.124"></a><span id="l42.124" class="difflineplus">+}</span>
<a href="#l42.125"></a><span id="l42.125" class="difflineplus">+</span>
<a href="#l42.126"></a><span id="l42.126" class="difflineplus">+.space-swatch {</span>
<a href="#l42.127"></a><span id="l42.127" class="difflineplus">+  display: inline-block;</span>
<a href="#l42.128"></a><span id="l42.128" class="difflineplus">+  width: 1em;</span>
<a href="#l42.129"></a><span id="l42.129" class="difflineplus">+  height: 1em;</span>
<a href="#l42.130"></a><span id="l42.130" class="difflineplus">+  border: 1px solid rgba(0,0,0,0.5);</span>
<a href="#l42.131"></a><span id="l42.131" class="difflineplus">+  border-radius: 2px;</span>
<a href="#l42.132"></a><span id="l42.132" class="difflineplus">+</span>
<a href="#l42.133"></a><span id="l42.133" class="difflineplus">+  vertical-align: middle;</span>
<a href="#l42.134"></a><span id="l42.134" class="difflineplus">+  -moz-margin-start: 0.5ch;</span>
<a href="#l42.135"></a><span id="l42.135" class="difflineplus">+  -moz-box-sizing: border-box;</span>
<a href="#l42.136"></a><span id="l42.136" class="difflineplus">+}</span>
<a href="#l42.137"></a><span id="l42.137" class="difflineplus">+</span>
<a href="#l42.138"></a><span id="l42.138" class="difflineplus">+/* Main pane padding */</span>
<a href="#l42.139"></a><span id="l42.139" class="difflineplus">+</span>
<a href="#l42.140"></a><span id="l42.140" class="difflineplus">+#provider-management {</span>
<a href="#l42.141"></a><span id="l42.141" class="difflineplus">+  margin: 0 10px;</span>
<a href="#l42.142"></a><span id="l42.142" class="difflineplus">+}</span>
<a href="#l42.143"></a><span id="l42.143" class="difflineplus">+</span>
<a href="#l42.144"></a><span id="l42.144" class="difflineplus">+#provider-name h1 {</span>
<a href="#l42.145"></a><span id="l42.145" class="difflineplus">+  margin: 0;</span>
<a href="#l42.146"></a><span id="l42.146" class="difflineplus">+}</span>
<a href="#l42.147"></a><span id="l42.147" class="difflineplus">+</span>
<a href="#l42.148"></a><span id="l42.148" class="difflineplus">+/* Loading panel */</span>
<a href="#l42.149"></a><span id="l42.149" class="difflineplus">+#cloudFileLoadingPanel, #cloudFileDefaultPanel {</span>
<a href="#l42.150"></a><span id="l42.150" class="difflineplus">+  text-align: center;</span>
<a href="#l42.151"></a><span id="l42.151" class="difflineplus">+  padding-top: 150px;</span>
<a href="#l42.152"></a><span id="l42.152" class="difflineplus">+}</span>
<a href="#l42.153"></a><span id="l42.153" class="difflineplus">+</span>
<a href="#l42.154"></a><span id="l42.154" class="difflineplus">+/* Flexing */</span>
<a href="#l42.155"></a><span id="l42.155" class="difflineplus">+#provider-management {</span>
<a href="#l42.156"></a><span id="l42.156" class="difflineplus">+  height: 270px; /* As far as I can see, the height and width values needs to be hardcoded :( */</span>
<a href="#l42.157"></a><span id="l42.157" class="difflineplus">+  width: 320px;</span>
<a href="#l42.158"></a><span id="l42.158" class="difflineplus">+  display: -moz-box;</span>
<a href="#l42.159"></a><span id="l42.159" class="difflineplus">+  -moz-box-orient: vertical;</span>
<a href="#l42.160"></a><span id="l42.160" class="difflineplus">+}</span>
<a href="#l42.161"></a><span id="l42.161" class="difflineplus">+</span>
<a href="#l42.162"></a><span id="l42.162" class="difflineplus">+#provider-header {</span>
<a href="#l42.163"></a><span id="l42.163" class="difflineplus">+  -moz-box-flex: 0;</span>
<a href="#l42.164"></a><span id="l42.164" class="difflineplus">+}</span>
<a href="#l42.165"></a><span id="l42.165" class="difflineplus">+</span>
<a href="#l42.166"></a><span id="l42.166" class="difflineplus">+#provider-spacebox {</span>
<a href="#l42.167"></a><span id="l42.167" class="difflineplus">+  -moz-box-flex: 1;</span>
<a href="#l42.168"></a><span id="l42.168" class="difflineplus">+}</span>
<a href="#l42.169"></a><span id="l42.169" class="difflineplus">+</span>
<a href="#l42.170"></a><span id="l42.170" class="difflineplus">+#provider-account-settings {</span>
<a href="#l42.171"></a><span id="l42.171" class="difflineplus">+  -moz-box-flex: 0;</span>
<a href="#l42.172"></a><span id="l42.172" class="difflineplus">+}</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

