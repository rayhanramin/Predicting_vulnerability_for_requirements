<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20087:e6a3cd0ad1e007cea30628f9cb96ba9085162329</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ e6a3cd0ad1e007cea30628f9cb96ba9085162329" />
<meta property="og:url" content="/comm-central/rev/e6a3cd0ad1e007cea30628f9cb96ba9085162329" />
<meta property="og:description" content="Bug 1280898 - Set up eslint for calendar files - enable prefer-arrow-callback rule. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / e6a3cd0ad1e007cea30628f9cb96ba9085162329 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/e6a3cd0ad1e007cea30628f9cb96ba9085162329">shortlog</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/e6a3cd0ad1e007cea30628f9cb96ba9085162329">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329">files</a> |
changeset |
<a href="/comm-central/raw-rev/e6a3cd0ad1e007cea30628f9cb96ba9085162329">raw</a>  | <a href="/comm-central/archive/e6a3cd0ad1e007cea30628f9cb96ba9085162329.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable prefer-arrow-callback rule. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 08 Jul 2016 14:10:46 +0200</td></tr>

<tr>
 <td>changeset 20087</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/e6a3cd0ad1e007cea30628f9cb96ba9085162329">e6a3cd0ad1e007cea30628f9cb96ba9085162329</a></td>
</tr>



<tr>
<td>parent 20086</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d0755bd52da8189fbed8fa4b7496f29bc1854289">d0755bd52da8189fbed8fa4b7496f29bc1854289</a>
</td>
</tr>

<tr>
<td>child 20088</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b5c1c8200552235f35285203c24784399dc993d8">b5c1c8200552235f35285203c24784399dc993d8</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=e6a3cd0ad1e007cea30628f9cb96ba9085162329">12311</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Sat, 17 Sep 2016 23:37:54 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0f9a99fba7f3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0f9a99fba7f36da451ca1ccdf13dc9bb66880e80">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0f9a99fba7f36da451ca1ccdf13dc9bb66880e80&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0f9a99fba7f36da451ca1ccdf13dc9bb66880e80&newProject=comm-central&newRevision=e6a3cd0ad1e007cea30628f9cb96ba9085162329&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0f9a99fba7f36da451ca1ccdf13dc9bb66880e80&newProject=comm-central&newRevision=e6a3cd0ad1e007cea30628f9cb96ba9085162329&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0f9a99fba7f36da451ca1ccdf13dc9bb66880e80&newProject=comm-central&newRevision=e6a3cd0ad1e007cea30628f9cb96ba9085162329&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">1280898</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable prefer-arrow-callback rule. r=MakeMyDay

MozReview-Commit-ID: E3n4RPWNDWu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/.eslintrc">calendar/.eslintrc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/.eslintrc">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/.eslintrc">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/.eslintrc">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/.eslintrc">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/.eslintrc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-chrome-startup.js">calendar/base/content/calendar-chrome-startup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-chrome-startup.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-chrome-startup.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-chrome-startup.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-chrome-startup.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-chrome-startup.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-invitations-manager.js">calendar/base/content/calendar-invitations-manager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-invitations-manager.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-invitations-manager.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-invitations-manager.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-invitations-manager.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-invitations-manager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.js">calendar/base/content/calendar-task-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-dialog-utils.js">calendar/base/content/dialogs/calendar-dialog-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-dialog-utils.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-dialog-utils.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-dialog-utils.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-dialog-utils.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-dialog-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">calendar/base/content/dialogs/calendar-event-dialog-attendees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">calendar/base/content/dialogs/calendar-event-dialog-reminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-print-dialog.js">calendar/base/content/dialogs/calendar-print-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-print-dialog.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-print-dialog.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-print-dialog.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-print-dialog.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/content/dialogs/calendar-print-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calProviderUtils.jsm">calendar/base/modules/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calRecurrenceUtils.jsm">calendar/base/modules/calRecurrenceUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calRecurrenceUtils.jsm">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calRecurrenceUtils.jsm">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calRecurrenceUtils.jsm">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calRecurrenceUtils.jsm">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calRecurrenceUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calUtils.jsm">calendar/base/modules/calUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calUtils.jsm">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calUtils.jsm">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calUtils.jsm">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calUtils.jsm">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calXMLUtils.jsm">calendar/base/modules/calXMLUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calXMLUtils.jsm">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calXMLUtils.jsm">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calXMLUtils.jsm">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calXMLUtils.jsm">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/modules/calXMLUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calAlarmMonitor.js">calendar/base/src/calAlarmMonitor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calAlarmMonitor.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calAlarmMonitor.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calAlarmMonitor.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calAlarmMonitor.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calAlarmMonitor.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCachedCalendar.js">calendar/base/src/calCachedCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCachedCalendar.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCachedCalendar.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCachedCalendar.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCachedCalendar.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCachedCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calDefaultACLManager.js">calendar/base/src/calDefaultACLManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calDefaultACLManager.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calDefaultACLManager.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calDefaultACLManager.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calDefaultACLManager.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calDefaultACLManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calIcsParser.js">calendar/base/src/calIcsParser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calIcsParser.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calIcsParser.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calIcsParser.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calIcsParser.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calIcsParser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calItipItem.js">calendar/base/src/calItipItem.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calItipItem.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calItipItem.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calItipItem.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calItipItem.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calItipItem.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calRecurrenceInfo.js">calendar/base/src/calRecurrenceInfo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calRecurrenceInfo.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calRecurrenceInfo.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calRecurrenceInfo.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calRecurrenceInfo.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calRecurrenceInfo.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calTimezone.js">calendar/base/src/calTimezone.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calTimezone.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calTimezone.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calTimezone.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calTimezone.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/base/src/calTimezone.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calHtmlExport.js">calendar/import-export/calHtmlExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calHtmlExport.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calHtmlExport.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calHtmlExport.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calHtmlExport.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calHtmlExport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/components/calItipProtocolHandler.js">calendar/lightning/components/calItipProtocolHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/components/calItipProtocolHandler.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/components/calItipProtocolHandler.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/components/calItipProtocolHandler.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/components/calItipProtocolHandler.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/components/calItipProtocolHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/messenger-overlay-sidebar.js">calendar/lightning/content/messenger-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/messenger-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/messenger-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/messenger-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/messenger-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/messenger-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/suite-overlay-sidebar.js">calendar/lightning/content/suite-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/suite-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/suite-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/suite-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/suite-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/lightning/content/suite-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/composite/calCompositeCalendar.js">calendar/providers/composite/calCompositeCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/composite/calCompositeCalendar.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/composite/calCompositeCalendar.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/composite/calCompositeCalendar.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/composite/calCompositeCalendar.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/composite/calCompositeCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendar.js">calendar/providers/wcap/calWcapCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendar.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendar.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendar.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendar.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendarItems.js">calendar/providers/wcap/calWcapCalendarItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendarItems.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendarItems.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendarItems.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendarItems.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapCalendarItems.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapRequest.js">calendar/providers/wcap/calWcapRequest.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapRequest.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapRequest.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapRequest.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapRequest.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapRequest.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testEventDialog.js">calendar/test/mozmill/eventDialog/testEventDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testEventDialog.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testEventDialog.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testEventDialog.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testEventDialog.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testEventDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testUTF8.js">calendar/test/mozmill/eventDialog/testUTF8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testUTF8.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testUTF8.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testUTF8.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testUTF8.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/eventDialog/testUTF8.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">calendar/test/mozmill/recurrence/testAnnualRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testDailyRecurrence.js">calendar/test/mozmill/recurrence/testDailyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testDailyRecurrence.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testDailyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testDailyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testDailyRecurrence.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testDailyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/shared-modules/calendar-utils.js">calendar/test/mozmill/shared-modules/calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/shared-modules/calendar-utils.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/shared-modules/calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/shared-modules/calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/shared-modules/calendar-utils.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/shared-modules/calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testLocalICS.js">calendar/test/mozmill/testLocalICS.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testLocalICS.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testLocalICS.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testLocalICS.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testLocalICS.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testLocalICS.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testTodayPane.js">calendar/test/mozmill/testTodayPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testTodayPane.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testTodayPane.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testTodayPane.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testTodayPane.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/testTodayPane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testDayView.js">calendar/test/mozmill/views/testDayView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testDayView.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testDayView.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testDayView.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testDayView.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testDayView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMonthView.js">calendar/test/mozmill/views/testMonthView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMonthView.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMonthView.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMonthView.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMonthView.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMonthView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMultiweekView.js">calendar/test/mozmill/views/testMultiweekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMultiweekView.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMultiweekView.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMultiweekView.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMultiweekView.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testMultiweekView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testTaskView.js">calendar/test/mozmill/views/testTaskView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testTaskView.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testTaskView.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testTaskView.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testTaskView.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testTaskView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testWeekView.js">calendar/test/mozmill/views/testWeekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testWeekView.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testWeekView.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testWeekView.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testWeekView.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/mozmill/views/testWeekView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarm.js">calendar/test/unit/test_alarm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarm.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarm.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarm.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarm.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarm.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarmservice.js">calendar/test/unit/test_alarmservice.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarmservice.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarmservice.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarmservice.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarmservice.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_alarmservice.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attachment.js">calendar/test/unit/test_attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attachment.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attachment.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attachment.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attachment.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attachment.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attendee.js">calendar/test/unit/test_attendee.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attendee.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attendee.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attendee.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attendee.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_attendee.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_bug350845.js">calendar/test/unit/test_bug350845.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_bug350845.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_bug350845.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_bug350845.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_bug350845.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_bug350845.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_deleted_items.js">calendar/test/unit/test_deleted_items.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_deleted_items.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_deleted_items.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_deleted_items.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_deleted_items.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_deleted_items.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_freebusy.js">calendar/test/unit/test_freebusy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_freebusy.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_freebusy.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_freebusy.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_freebusy.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_freebusy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_gdata_provider.js">calendar/test/unit/test_gdata_provider.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_gdata_provider.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_gdata_provider.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_gdata_provider.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_gdata_provider.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_gdata_provider.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_ics.js">calendar/test/unit/test_ics.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_ics.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_ics.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_ics.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_ics.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_ics.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_items.js">calendar/test/unit/test_items.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_items.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_items.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_items.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_items.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_items.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_relation.js">calendar/test/unit/test_relation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_relation.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_relation.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_relation.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_relation.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_relation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_storage.js">calendar/test/unit/test_storage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_storage.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_storage.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_storage.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_storage.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_storage.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_webcal.js">calendar/test/unit/test_webcal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_webcal.js">file</a> |
<a href="/comm-central/annotate/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_webcal.js">annotate</a> |
<a href="/comm-central/diff/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_webcal.js">diff</a> |
<a href="/comm-central/comparison/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_webcal.js">comparison</a> |
<a href="/comm-central/log/e6a3cd0ad1e007cea30628f9cb96ba9085162329/calendar/test/unit/test_webcal.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/.eslintrc</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/.eslintrc</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -415,13 +415,16 @@</span>
<a href="#l1.4"></a><span id="l1.4">     }],</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">     // Disallow unnecessary concatenation of strings</span>
<a href="#l1.7"></a><span id="l1.7">     &quot;no-useless-concat&quot;: 2,</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">     // Disallow unmodified conditions of loops</span>
<a href="#l1.10"></a><span id="l1.10">     &quot;no-unmodified-loop-condition&quot;: 2,</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    // Suggest using arrow functions as callbacks</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    &quot;prefer-arrow-callback&quot;: [2, { &quot;allowNamedFunctions&quot;: true }],</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15">     // The following rules will not be enabled currently, but are kept here for</span>
<a href="#l1.16"></a><span id="l1.16">     // easier updates in the future.</span>
<a href="#l1.17"></a><span id="l1.17">     &quot;no-else-return&quot;: 0,</span>
<a href="#l1.18"></a><span id="l1.18">   }</span>
<a href="#l1.19"></a><span id="l1.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -45,23 +45,20 @@ agendaListbox.init = function() {</span>
<a href="#l2.4"></a><span id="l2.4">                     agendaListbox.updateSoonSection();</span>
<a href="#l2.5"></a><span id="l2.5">                     break;</span>
<a href="#l2.6"></a><span id="l2.6">             }</span>
<a href="#l2.7"></a><span id="l2.7">         }</span>
<a href="#l2.8"></a><span id="l2.8">     };</span>
<a href="#l2.9"></a><span id="l2.9">     Services.prefs.addObserver(&quot;calendar.agendaListbox&quot;, prefObserver, false);</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">     // Make sure the agenda listbox is unloaded</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    let self = this;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-    window.addEventListener(&quot;unload&quot;,</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-                            function() {</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-                                Services.prefs.removeObserver(&quot;calendar.agendaListbox&quot;, prefObserver);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-                                self.uninit();</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-                            },</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-                            false);</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+    window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+        Services.prefs.removeObserver(&quot;calendar.agendaListbox&quot;, prefObserver);</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+        this.uninit();</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+    }, false);</span>
<a href="#l2.23"></a><span id="l2.23"> };</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25"> /**</span>
<a href="#l2.26"></a><span id="l2.26">  * Clean up the agenda listbox, used on window unload.</span>
<a href="#l2.27"></a><span id="l2.27">  */</span>
<a href="#l2.28"></a><span id="l2.28"> agendaListbox.uninit = function() {</span>
<a href="#l2.29"></a><span id="l2.29">     if (this.calendar) {</span>
<a href="#l2.30"></a><span id="l2.30">         this.calendar.removeObserver(this.calendarObserver);</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineat">@@ -1094,20 +1091,19 @@ function scheduleNextCurrentEventUpdate(</span>
<a href="#l2.32"></a><span id="l2.32">                    aRefreshCallback();</span>
<a href="#l2.33"></a><span id="l2.33">                }</span>
<a href="#l2.34"></a><span id="l2.34">            }</span>
<a href="#l2.35"></a><span id="l2.35">         };</span>
<a href="#l2.36"></a><span id="l2.36">         // Add observer</span>
<a href="#l2.37"></a><span id="l2.37">         Services.obs.addObserver(wakeObserver, &quot;wake_notification&quot;, false);</span>
<a href="#l2.38"></a><span id="l2.38"> </span>
<a href="#l2.39"></a><span id="l2.39">         // Remove observer on unload</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-        window.addEventListener(&quot;unload&quot;,</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-                                function() {</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-                                    Services.obs.removeObserver(wakeObserver, &quot;wake_notification&quot;);</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-                                }, false);</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+        window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+            Services.obs.removeObserver(wakeObserver, &quot;wake_notification&quot;);</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+        }, false);</span>
<a href="#l2.47"></a><span id="l2.47"> </span>
<a href="#l2.48"></a><span id="l2.48">         gEventTimer = Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l2.49"></a><span id="l2.49">                                    .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l2.50"></a><span id="l2.50">     } else {</span>
<a href="#l2.51"></a><span id="l2.51">         gEventTimer.cancel();</span>
<a href="#l2.52"></a><span id="l2.52">     }</span>
<a href="#l2.53"></a><span id="l2.53">     gEventTimer.initWithCallback(udCallback, aMsUntil, gEventTimer.TYPE_ONE_SHOT);</span>
<a href="#l2.54"></a><span id="l2.54"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-chrome-startup.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-chrome-startup.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -132,17 +132,17 @@ var calendarWindowPrefs = {</span>
<a href="#l3.4"></a><span id="l3.4">                     for (let win in fixIterator(Services.ww.getWindowEnumerator())) {</span>
<a href="#l3.5"></a><span id="l3.5">                         setElementValue(win.document.documentElement, attributeValue, &quot;systemcolors&quot;);</span>
<a href="#l3.6"></a><span id="l3.6">                     }</span>
<a href="#l3.7"></a><span id="l3.7">                     break;</span>
<a href="#l3.8"></a><span id="l3.8">                 }</span>
<a href="#l3.9"></a><span id="l3.9">             }</span>
<a href="#l3.10"></a><span id="l3.10">         } else if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l3.11"></a><span id="l3.11">             let win = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-            win.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+            win.addEventListener(&quot;load&quot;, () =&gt; {</span>
<a href="#l3.14"></a><span id="l3.14">                 let attributeValue = Preferences.get(&quot;calendar.view.useSystemColors&quot;, false) &amp;&amp; &quot;true&quot;;</span>
<a href="#l3.15"></a><span id="l3.15">                 setElementValue(win.document.documentElement, attributeValue, &quot;systemcolors&quot;);</span>
<a href="#l3.16"></a><span id="l3.16">             }, false);</span>
<a href="#l3.17"></a><span id="l3.17">         }</span>
<a href="#l3.18"></a><span id="l3.18">     }</span>
<a href="#l3.19"></a><span id="l3.19"> };</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -63,20 +63,19 @@ function getInvitationsManager() {</span>
<a href="#l4.4"></a><span id="l4.4">  * @constructor</span>
<a href="#l4.5"></a><span id="l4.5">  */</span>
<a href="#l4.6"></a><span id="l4.6"> function InvitationsManager() {</span>
<a href="#l4.7"></a><span id="l4.7">     this.mItemList = [];</span>
<a href="#l4.8"></a><span id="l4.8">     this.mStartDate = null;</span>
<a href="#l4.9"></a><span id="l4.9">     this.mJobsPending = 0;</span>
<a href="#l4.10"></a><span id="l4.10">     this.mTimer = null;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    let self = this;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-    window.addEventListener(&quot;unload&quot;, function() {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+    window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l4.15"></a><span id="l4.15">         // Unload handlers get removed automatically</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-        self.cancelInvitationsUpdate();</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+        this.cancelInvitationsUpdate();</span>
<a href="#l4.18"></a><span id="l4.18">     }, false);</span>
<a href="#l4.19"></a><span id="l4.19"> }</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21"> InvitationsManager.prototype = {</span>
<a href="#l4.22"></a><span id="l4.22">     mItemList: null,</span>
<a href="#l4.23"></a><span id="l4.23">     mStartDate: null,</span>
<a href="#l4.24"></a><span id="l4.24">     mJobsPending: 0,</span>
<a href="#l4.25"></a><span id="l4.25">     mTimer: null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -884,26 +884,25 @@</span>
<a href="#l5.4"></a><span id="l5.4">               if (startComparison != 0) {</span>
<a href="#l5.5"></a><span id="l5.5">                   return startComparison;</span>
<a href="#l5.6"></a><span id="l5.6">               } else {</span>
<a href="#l5.7"></a><span id="l5.7">                   // If the items start at the same time, return the longer one</span>
<a href="#l5.8"></a><span id="l5.8">                   // first</span>
<a href="#l5.9"></a><span id="l5.9">                   return bEventInfo.layoutEnd.compare(aEventInfo.layoutEnd);</span>
<a href="#l5.10"></a><span id="l5.10">               }</span>
<a href="#l5.11"></a><span id="l5.11">           }</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-          let self = this;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-          this.mEventInfos.forEach(function(aEventInfo) {</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+          this.mEventInfos.forEach((aEventInfo) =&gt; {</span>
<a href="#l5.15"></a><span id="l5.15">               let item = aEventInfo.event.clone();</span>
<a href="#l5.16"></a><span id="l5.16">               let start = item.startDate || item.entryDate || item.dueDate;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-              start = start.getInTimezone(self.mTimezone);</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+              start = start.getInTimezone(this.mTimezone);</span>
<a href="#l5.19"></a><span id="l5.19">               aEventInfo.layoutStart = start;</span>
<a href="#l5.20"></a><span id="l5.20">               let end = item.endDate || item.dueDate || item.entryDate;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-              end = end.getInTimezone(self.mTimezone);</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+              end = end.getInTimezone(this.mTimezone);</span>
<a href="#l5.23"></a><span id="l5.23">               let secEnd = start.clone();</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-              secEnd.addDuration(self.mMinDuration);</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+              secEnd.addDuration(this.mMinDuration);</span>
<a href="#l5.26"></a><span id="l5.26">               if (secEnd.nativeTime &gt; end.nativeTime) {</span>
<a href="#l5.27"></a><span id="l5.27">                    aEventInfo.layoutEnd = secEnd;</span>
<a href="#l5.28"></a><span id="l5.28">               } else {</span>
<a href="#l5.29"></a><span id="l5.29">                    aEventInfo.layoutEnd = end;</span>
<a href="#l5.30"></a><span id="l5.30">               }</span>
<a href="#l5.31"></a><span id="l5.31">               return aEventInfo;</span>
<a href="#l5.32"></a><span id="l5.32">           });</span>
<a href="#l5.33"></a><span id="l5.33">           this.mEventInfos.sort(sortByStart);</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineat">@@ -1422,21 +1421,21 @@</span>
<a href="#l5.35"></a><span id="l5.35">               scrollBy *= -1;</span>
<a href="#l5.36"></a><span id="l5.36">           } else if (diffEnd &lt; SCROLLZONE) {</span>
<a href="#l5.37"></a><span id="l5.37">               insideScrollZone = SCROLLZONE - diffEnd;</span>
<a href="#l5.38"></a><span id="l5.38">           }</span>
<a href="#l5.39"></a><span id="l5.39"> </span>
<a href="#l5.40"></a><span id="l5.40">           if (insideScrollZone) {</span>
<a href="#l5.41"></a><span id="l5.41">               let sbo = scrollbox.boxObject;</span>
<a href="#l5.42"></a><span id="l5.42">               let timeout = MAXTIMEOUT - insideScrollZone * (MAXTIMEOUT - MINTIMEOUT) / SCROLLZONE;</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-              this.mMagicScrollTimer = setTimeout(function() {</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+              this.mMagicScrollTimer = setTimeout(() =&gt; {</span>
<a href="#l5.45"></a><span id="l5.45">                   sbo.scrollBy(orient == &quot;horizontal&quot; &amp;&amp; scrollBy,</span>
<a href="#l5.46"></a><span id="l5.46">                                orient == &quot;vertical&quot; &amp;&amp; scrollBy);</span>
<a href="#l5.47"></a><span id="l5.47">                   this.onEventSweepMouseMove(event);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-              }.bind(this), timeout);</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+              }, timeout);</span>
<a href="#l5.50"></a><span id="l5.50">           }</span>
<a href="#l5.51"></a><span id="l5.51">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.52"></a><span id="l5.52">       &lt;/method&gt;</span>
<a href="#l5.53"></a><span id="l5.53"> </span>
<a href="#l5.54"></a><span id="l5.54">       &lt;!--</span>
<a href="#l5.55"></a><span id="l5.55">          - Event sweep handlers</span>
<a href="#l5.56"></a><span id="l5.56">         --&gt;</span>
<a href="#l5.57"></a><span id="l5.57">       &lt;method name=&quot;onEventSweepMouseMove&quot;&gt;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineat">@@ -2714,17 +2713,17 @@</span>
<a href="#l5.59"></a><span id="l5.59">           }</span>
<a href="#l5.60"></a><span id="l5.60">           let ppm = size / self.mVisibleMinutes;</span>
<a href="#l5.61"></a><span id="l5.61">           ppm = Math.floor(ppm * 1000) / 1000;</span>
<a href="#l5.62"></a><span id="l5.62">           if (ppm &lt; self.mMinPixelsPerMinute) {</span>
<a href="#l5.63"></a><span id="l5.63">               ppm = self.mMinPixelsPerMinute;</span>
<a href="#l5.64"></a><span id="l5.64">           }</span>
<a href="#l5.65"></a><span id="l5.65">           let ppmChanged = (self.pixelsPerMinute != ppm);</span>
<a href="#l5.66"></a><span id="l5.66">           self.pixelsPerMinute = ppm;</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-          setTimeout(function() { self.scrollToMinute(self.mFirstVisibleMinute); }, 0);</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+          setTimeout(() =&gt; self.scrollToMinute(self.mFirstVisibleMinute), 0);</span>
<a href="#l5.69"></a><span id="l5.69"> </span>
<a href="#l5.70"></a><span id="l5.70">           // Fit the weekday labels while scrolling.</span>
<a href="#l5.71"></a><span id="l5.71">           self.adjustWeekdayLength(self.getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;);</span>
<a href="#l5.72"></a><span id="l5.72"> </span>
<a href="#l5.73"></a><span id="l5.73">           // Adjust the time indicator position and the related timer.</span>
<a href="#l5.74"></a><span id="l5.74">           if (this.mTimeIndicatorInterval != 0) {</span>
<a href="#l5.75"></a><span id="l5.75">               let viewChanged = isARelayout &amp;&amp; (timeIndicator.lastView != this.id);</span>
<a href="#l5.76"></a><span id="l5.76">               let currentMode = document.getElementById(&quot;modeBroadcaster&quot;).getAttribute(&quot;mode&quot;);</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineat">@@ -3532,19 +3531,17 @@</span>
<a href="#l5.78"></a><span id="l5.78">               if (startDate.compare(this.mStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l5.79"></a><span id="l5.79">                   endDate.compare(this.mEndDate) &lt;= 0) {</span>
<a href="#l5.80"></a><span id="l5.80">                   for (let i = startDate.day; i &lt;= endDate.day; i++) {</span>
<a href="#l5.81"></a><span id="l5.81">                       occMap[i] = true;</span>
<a href="#l5.82"></a><span id="l5.82">                   }</span>
<a href="#l5.83"></a><span id="l5.83">               }</span>
<a href="#l5.84"></a><span id="l5.84">           }</span>
<a href="#l5.85"></a><span id="l5.85"> </span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-          return this.mDateColumns.filter(function(col) {</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-              return (col.date.day in occMap);</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-          });</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+          return this.mDateColumns.filter(col =&gt; col.date.day in occMap);</span>
<a href="#l5.90"></a><span id="l5.90">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.91"></a><span id="l5.91">       &lt;/method&gt;</span>
<a href="#l5.92"></a><span id="l5.92"> </span>
<a href="#l5.93"></a><span id="l5.93">       &lt;method name=&quot;findColumnsForItem&quot;&gt;</span>
<a href="#l5.94"></a><span id="l5.94">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l5.95"></a><span id="l5.95">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.96"></a><span id="l5.96">           let columns = [];</span>
<a href="#l5.97"></a><span id="l5.97"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -212,17 +212,17 @@ function contextPostponeTask(aEvent, aDu</span>
<a href="#l6.4"></a><span id="l6.4">     }</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6">     if (gTabmail &amp;&amp; gTabmail.currentTabInfo.mode.type == &quot;calendarTask&quot;) {</span>
<a href="#l6.7"></a><span id="l6.7">         postponeTask(aDuration);</span>
<a href="#l6.8"></a><span id="l6.8">     } else {</span>
<a href="#l6.9"></a><span id="l6.9">         startBatchTransaction();</span>
<a href="#l6.10"></a><span id="l6.10">         let tasks = getSelectedTasks(aEvent);</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        tasks.forEach(function(task) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+        tasks.forEach((task) =&gt; {</span>
<a href="#l6.14"></a><span id="l6.14">             if (task.entryDate || task.dueDate) {</span>
<a href="#l6.15"></a><span id="l6.15">                 let newTask = task.clone();</span>
<a href="#l6.16"></a><span id="l6.16">                 cal.shiftItem(newTask, duration);</span>
<a href="#l6.17"></a><span id="l6.17">                 doTransaction(&quot;modify&quot;, newTask, newTask.calendar, task, null);</span>
<a href="#l6.18"></a><span id="l6.18">             }</span>
<a href="#l6.19"></a><span id="l6.19">         });</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">         endBatchTransaction();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -145,20 +145,17 @@</span>
<a href="#l7.4"></a><span id="l7.4">         let ordinals = this.getAttribute(&quot;ordinals&quot;).split(&quot; &quot;);</span>
<a href="#l7.5"></a><span id="l7.5">         let widths = this.getAttribute(&quot;widths&quot;).split(&quot; &quot;);</span>
<a href="#l7.6"></a><span id="l7.6">         let sorted = this.getAttribute(&quot;sort-active&quot;);</span>
<a href="#l7.7"></a><span id="l7.7">         let sortDirection = this.getAttribute(&quot;sort-direction&quot;) || &quot;ascending&quot;;</span>
<a href="#l7.8"></a><span id="l7.8">         tree = document.getAnonymousNodes(this)[0];</span>
<a href="#l7.9"></a><span id="l7.9">         let treecols = tree.getElementsByTagNameNS(tree.namespaceURI, &quot;treecol&quot;);</span>
<a href="#l7.10"></a><span id="l7.10">         for (let i = 0; i &lt; treecols.length; i++) {</span>
<a href="#l7.11"></a><span id="l7.11">             let content = treecols[i].getAttribute(&quot;itemproperty&quot;);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-            if (names.some(</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-                function(element) {</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-                    return (element == content);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-                })) {</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+            if (names.some(element =&gt; element == content)) {</span>
<a href="#l7.17"></a><span id="l7.17">                 treecols[i].removeAttribute(&quot;hidden&quot;);</span>
<a href="#l7.18"></a><span id="l7.18">             } else {</span>
<a href="#l7.19"></a><span id="l7.19">                 treecols[i].setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l7.20"></a><span id="l7.20">             }</span>
<a href="#l7.21"></a><span id="l7.21">             if (ordinals &amp;&amp; ordinals.length &gt; 0) {</span>
<a href="#l7.22"></a><span id="l7.22">                treecols[i].ordinal = Number(ordinals.shift());</span>
<a href="#l7.23"></a><span id="l7.23">             }</span>
<a href="#l7.24"></a><span id="l7.24">             if (widths &amp;&amp; widths.length &gt; 0) {</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineat">@@ -922,20 +919,17 @@</span>
<a href="#l7.26"></a><span id="l7.26">               items: null,</span>
<a href="#l7.27"></a><span id="l7.27">               operation: null,</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29">               onOperationComplete: function(aOpCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l7.30"></a><span id="l7.30">                   if (aOpCalendar.id in this.binding.mPendingRefreshJobs) {</span>
<a href="#l7.31"></a><span id="l7.31">                       delete this.binding.mPendingRefreshJobs[aOpCalendar.id];</span>
<a href="#l7.32"></a><span id="l7.32">                   }</span>
<a href="#l7.33"></a><span id="l7.33"> </span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-                  let oldItems = this.binding.mTaskArray.filter(function(item) {</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-                      return item.calendar.id == aOpCalendar.id;</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-                  });</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+                  let oldItems = this.binding.mTaskArray.filter(item =&gt; item.calendar.id == aOpCalendar.id);</span>
<a href="#l7.39"></a><span id="l7.39">                   this.binding.mTreeView.modifyItems(this.items, oldItems);</span>
<a href="#l7.40"></a><span id="l7.40">               },</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42">               onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l7.43"></a><span id="l7.43">                   this.items = this.items.concat(aItems);</span>
<a href="#l7.44"></a><span id="l7.44">               },</span>
<a href="#l7.45"></a><span id="l7.45"> </span>
<a href="#l7.46"></a><span id="l7.46">               cancel: function() {</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineat">@@ -996,19 +990,17 @@</span>
<a href="#l7.48"></a><span id="l7.48">                 this.refreshFromCalendar(aCalendar, aFilter);</span>
<a href="#l7.49"></a><span id="l7.49">             }</span>
<a href="#l7.50"></a><span id="l7.50">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.51"></a><span id="l7.51">       &lt;/method&gt;</span>
<a href="#l7.52"></a><span id="l7.52"> </span>
<a href="#l7.53"></a><span id="l7.53">       &lt;method name=&quot;onCalendarRemoved&quot;&gt;</span>
<a href="#l7.54"></a><span id="l7.54">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l7.55"></a><span id="l7.55">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-            let tasks = this.mTaskArray.filter(function(task) {</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-                return task.calendar.id == aCalendar.id;</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-            });</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+            let tasks = this.mTaskArray.filter(task =&gt; task.calendar.id == aCalendar.id);</span>
<a href="#l7.60"></a><span id="l7.60">             this.mTreeView.removeItems(tasks);</span>
<a href="#l7.61"></a><span id="l7.61">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.62"></a><span id="l7.62">       &lt;/method&gt;</span>
<a href="#l7.63"></a><span id="l7.63"> </span>
<a href="#l7.64"></a><span id="l7.64">       &lt;method name=&quot;sortItems&quot;&gt;</span>
<a href="#l7.65"></a><span id="l7.65">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.66"></a><span id="l7.66">           if (this.mTreeView.selectedColumn) {</span>
<a href="#l7.67"></a><span id="l7.67">               let modifier = (this.mTreeView.sortDirection == &quot;descending&quot; ? -1 : 1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -257,17 +257,17 @@ function sortCalendarArray(calendars) {</span>
<a href="#l8.4"></a><span id="l8.4">             return 1;</span>
<a href="#l8.5"></a><span id="l8.5">         }</span>
<a href="#l8.6"></a><span id="l8.6">         return 0;</span>
<a href="#l8.7"></a><span id="l8.7">     }</span>
<a href="#l8.8"></a><span id="l8.8">     ret.sort(sortFunc);</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">     // check and repair pref:</span>
<a href="#l8.11"></a><span id="l8.11">     let sortOrderString = Preferences.get(&quot;calendar.list.sortOrder&quot;, &quot;&quot;);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    let wantedOrderString = ret.map(function(c) { return c.id; }).join(&quot; &quot;);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    let wantedOrderString = ret.map(c =&gt; c.id).join(&quot; &quot;);</span>
<a href="#l8.14"></a><span id="l8.14">     if (wantedOrderString != sortOrderString) {</span>
<a href="#l8.15"></a><span id="l8.15">         Preferences.set(&quot;calendar.list.sortOrder&quot;, wantedOrderString);</span>
<a href="#l8.16"></a><span id="l8.16">     }</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18">     return ret;</span>
<a href="#l8.19"></a><span id="l8.19"> }</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -639,17 +639,17 @@ var unifinderTreeView = {</span>
<a href="#l9.4"></a><span id="l9.4">             // If there is more than one item, just select them all.</span>
<a href="#l9.5"></a><span id="l9.5">             for (let item of aItemArray) {</span>
<a href="#l9.6"></a><span id="l9.6">                 let row = this.getItemRow(item);</span>
<a href="#l9.7"></a><span id="l9.7">                 this.tree.view.selection.rangedSelect(row, row, true);</span>
<a href="#l9.8"></a><span id="l9.8">             }</span>
<a href="#l9.9"></a><span id="l9.9">         }</span>
<a href="#l9.10"></a><span id="l9.10"> </span>
<a href="#l9.11"></a><span id="l9.11">         // This needs to be in a setTimeout</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-        setTimeout(function() { unifinderTreeView.resetAllowSelection(); }, 1);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+        setTimeout(() =&gt; unifinderTreeView.resetAllowSelection(), 1);</span>
<a href="#l9.14"></a><span id="l9.14">     },</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16">     /**</span>
<a href="#l9.17"></a><span id="l9.17">      * Due to a selection issue described in bug 168211 this method is needed to</span>
<a href="#l9.18"></a><span id="l9.18">      * re-add the selection listeners selection listeners.</span>
<a href="#l9.19"></a><span id="l9.19">      */</span>
<a href="#l9.20"></a><span id="l9.20">     resetAllowSelection: function() {</span>
<a href="#l9.21"></a><span id="l9.21">         if (!this.tree) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -115,17 +115,17 @@ var calendarViewController = {</span>
<a href="#l10.4"></a><span id="l10.4">         };</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6">         // Make sure we are modifying a copy of aOccurrences, otherwise we will</span>
<a href="#l10.7"></a><span id="l10.7">         // run into race conditions when the view's doDeleteItem removes the</span>
<a href="#l10.8"></a><span id="l10.8">         // array elements while we are iterating through them. While we are at</span>
<a href="#l10.9"></a><span id="l10.9">         // it, filter out any items that have readonly calendars, so that</span>
<a href="#l10.10"></a><span id="l10.10">         // checking for one total item below also works out if all but one item</span>
<a href="#l10.11"></a><span id="l10.11">         // are readonly.</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-        let occurrences = aOccurrences.filter(function(item) { return isCalendarWritable(item.calendar); });</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+        let occurrences = aOccurrences.filter(item =&gt; isCalendarWritable(item.calendar));</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15">         for (let itemToDelete of occurrences) {</span>
<a href="#l10.16"></a><span id="l10.16">             if (aUseParentItems) {</span>
<a href="#l10.17"></a><span id="l10.17">                 // Usually happens when ctrl-click is used. In that case we</span>
<a href="#l10.18"></a><span id="l10.18">                 // don't need to ask the user if he wants to delete an</span>
<a href="#l10.19"></a><span id="l10.19">                 // occurrence or not.</span>
<a href="#l10.20"></a><span id="l10.20">                 itemToDelete = itemToDelete.parentItem;</span>
<a href="#l10.21"></a><span id="l10.21">             } else if (!aDoNotConfirm &amp;&amp; occurrences.length == 1) {</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -213,17 +213,17 @@ function switchToView(aViewType) {</span>
<a href="#l10.23"></a><span id="l10.23">     }</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25">     // Set up the labels and accesskeys for the context menu</span>
<a href="#l10.26"></a><span id="l10.26">     [&quot;calendar-view-context-menu-next&quot;,</span>
<a href="#l10.27"></a><span id="l10.27">      &quot;calendar-view-context-menu-previous&quot;,</span>
<a href="#l10.28"></a><span id="l10.28">      &quot;calendar-go-menu-next&quot;,</span>
<a href="#l10.29"></a><span id="l10.29">      &quot;calendar-go-menu-previous&quot;,</span>
<a href="#l10.30"></a><span id="l10.30">      &quot;appmenu_calendar-go-menu-next&quot;,</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-     &quot;appmenu_calendar-go-menu-previous&quot;].forEach(function(x) {</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+     &quot;appmenu_calendar-go-menu-previous&quot;].forEach((x) =&gt; {</span>
<a href="#l10.33"></a><span id="l10.33">             setupViewNode(x, &quot;label&quot;);</span>
<a href="#l10.34"></a><span id="l10.34">             setupViewNode(x, &quot;accesskey&quot;);</span>
<a href="#l10.35"></a><span id="l10.35">      });</span>
<a href="#l10.36"></a><span id="l10.36"> </span>
<a href="#l10.37"></a><span id="l10.37">     // Set up the labels for the view navigation</span>
<a href="#l10.38"></a><span id="l10.38">     [&quot;previous-view-button&quot;,</span>
<a href="#l10.39"></a><span id="l10.39">      &quot;today-view-button&quot;,</span>
<a href="#l10.40"></a><span id="l10.40">      &quot;next-view-button&quot;].forEach(x =&gt; setupViewNode(x, &quot;tooltiptext&quot;));</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineat">@@ -331,20 +331,19 @@ function scheduleMidnightUpdate(aRefresh</span>
<a href="#l10.42"></a><span id="l10.42">                }</span>
<a href="#l10.43"></a><span id="l10.43">            }</span>
<a href="#l10.44"></a><span id="l10.44">         };</span>
<a href="#l10.45"></a><span id="l10.45"> </span>
<a href="#l10.46"></a><span id="l10.46">         // Add observer</span>
<a href="#l10.47"></a><span id="l10.47">         Services.obs.addObserver(wakeObserver, &quot;wake_notification&quot;, false);</span>
<a href="#l10.48"></a><span id="l10.48"> </span>
<a href="#l10.49"></a><span id="l10.49">         // Remove observer on unload</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-        window.addEventListener(&quot;unload&quot;,</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-                                function() {</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-                                    Services.obs.removeObserver(wakeObserver, &quot;wake_notification&quot;);</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-                                }, false);</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+        window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+            Services.obs.removeObserver(wakeObserver, &quot;wake_notification&quot;);</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+        }, false);</span>
<a href="#l10.57"></a><span id="l10.57">         gMidnightTimer = Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l10.58"></a><span id="l10.58">                                    .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l10.59"></a><span id="l10.59">     } else {</span>
<a href="#l10.60"></a><span id="l10.60">         gMidnightTimer.cancel();</span>
<a href="#l10.61"></a><span id="l10.61">     }</span>
<a href="#l10.62"></a><span id="l10.62">     gMidnightTimer.initWithCallback(udCallback, msUntilTomorrow, gMidnightTimer.TYPE_ONE_SHOT);</span>
<a href="#l10.63"></a><span id="l10.63"> }</span>
<a href="#l10.64"></a><span id="l10.64"> </span>
<a href="#l10.65"></a><span id="l10.65" class="difflineat">@@ -707,18 +706,17 @@ cal.navigationBar = {</span>
<a href="#l10.66"></a><span id="l10.66"> };</span>
<a href="#l10.67"></a><span id="l10.67"> </span>
<a href="#l10.68"></a><span id="l10.68"> /*</span>
<a href="#l10.69"></a><span id="l10.69">  * Timer for the time indicator in day and week view.</span>
<a href="#l10.70"></a><span id="l10.70">  */</span>
<a href="#l10.71"></a><span id="l10.71"> var timeIndicator = {</span>
<a href="#l10.72"></a><span id="l10.72">     timer: null,</span>
<a href="#l10.73"></a><span id="l10.73">     start: function(aInterval, aThis) {</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-        timeIndicator.timer = setInterval(function() { aThis.updateTimeIndicatorPosition(false); },</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-                                          aInterval * 1000);</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+        timeIndicator.timer = setInterval(() =&gt; aThis.updateTimeIndicatorPosition(false), aInterval * 1000);</span>
<a href="#l10.77"></a><span id="l10.77">     },</span>
<a href="#l10.78"></a><span id="l10.78">     cancel: function() {</span>
<a href="#l10.79"></a><span id="l10.79">         if (timeIndicator.timer) {</span>
<a href="#l10.80"></a><span id="l10.80">             clearTimeout(timeIndicator.timer);</span>
<a href="#l10.81"></a><span id="l10.81">             timeIndicator.timer = null;</span>
<a href="#l10.82"></a><span id="l10.82">         }</span>
<a href="#l10.83"></a><span id="l10.83">     },</span>
<a href="#l10.84"></a><span id="l10.84">     lastView: null</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -541,20 +541,20 @@ function updateLink() {</span>
<a href="#l11.4"></a><span id="l11.4">             return;</span>
<a href="#l11.5"></a><span id="l11.5">         }</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7">         // Only show if its either an internal protcol handler, or its external</span>
<a href="#l11.8"></a><span id="l11.8">         // and there is an external app for the scheme</span>
<a href="#l11.9"></a><span id="l11.9">         handler = cal.wrapInstance(handler, Components.interfaces.nsIExternalProtocolHandler);</span>
<a href="#l11.10"></a><span id="l11.10">         hideOrShow(!handler || handler.externalAppExistsForScheme(uri.scheme));</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-        setTimeout(function() {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-          // HACK the url-link doesn't crop when setting the value in onLoad</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-          setElementValue(&quot;url-link&quot;, itemUrlString);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-          setElementValue(&quot;url-link&quot;, itemUrlString, &quot;href&quot;);</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+        setTimeout(() =&gt; {</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+            // HACK the url-link doesn't crop when setting the value in onLoad</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+            setElementValue(&quot;url-link&quot;, itemUrlString);</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+            setElementValue(&quot;url-link&quot;, itemUrlString, &quot;href&quot;);</span>
<a href="#l11.20"></a><span id="l11.20">         }, 0);</span>
<a href="#l11.21"></a><span id="l11.21">     }</span>
<a href="#l11.22"></a><span id="l11.22"> }</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24"> /*</span>
<a href="#l11.25"></a><span id="l11.25">  * setup attendees in event and summary dialog</span>
<a href="#l11.26"></a><span id="l11.26">  */</span>
<a href="#l11.27"></a><span id="l11.27"> function setupAttendees() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -115,21 +115,19 @@ function onLoad() {</span>
<a href="#l12.4"></a><span id="l12.4">                 case &quot;calendar.view.dayendhour&quot;:</span>
<a href="#l12.5"></a><span id="l12.5">                     initTimeRange();</span>
<a href="#l12.6"></a><span id="l12.6">                     propagateDateTime();</span>
<a href="#l12.7"></a><span id="l12.7">                     break;</span>
<a href="#l12.8"></a><span id="l12.8">             }</span>
<a href="#l12.9"></a><span id="l12.9">         }</span>
<a href="#l12.10"></a><span id="l12.10">     };</span>
<a href="#l12.11"></a><span id="l12.11">     Services.prefs.addObserver(&quot;calendar.&quot;, prefObserver, false);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    window.addEventListener(&quot;unload&quot;,</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-        function() {</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-            Services.prefs.removeObserver(&quot;calendar.&quot;, prefObserver);</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-        },</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-        false);</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+    window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+        Services.prefs.removeObserver(&quot;calendar.&quot;, prefObserver);</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+    }, false);</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21">     opener.setCursor(&quot;auto&quot;);</span>
<a href="#l12.22"></a><span id="l12.22">     self.focus();</span>
<a href="#l12.23"></a><span id="l12.23"> }</span>
<a href="#l12.24"></a><span id="l12.24"> </span>
<a href="#l12.25"></a><span id="l12.25"> /**</span>
<a href="#l12.26"></a><span id="l12.26">  * This function should be called when the accept button was pressed on the</span>
<a href="#l12.27"></a><span id="l12.27">  * attendee dialog. Calls the accept function specified in the window arguments.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -97,17 +97,17 @@ function loadReminders() {</span>
<a href="#l13.4"></a><span id="l13.4">     let absDate = document.getElementById(&quot;reminder-absolute-date&quot;);</span>
<a href="#l13.5"></a><span id="l13.5">     absDate.value = cal.dateTimeToJsDate(getDefaultStartDate());</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7">     if (listbox.childNodes.length) {</span>
<a href="#l13.8"></a><span id="l13.8">         // We have reminders, select the first by default. For some reason,</span>
<a href="#l13.9"></a><span id="l13.9">         // setting the selected index in a load handler makes the selection</span>
<a href="#l13.10"></a><span id="l13.10">         // break for the set item, therefore we need a setTimeout.</span>
<a href="#l13.11"></a><span id="l13.11">         setupMaxReminders();</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-        setTimeout(function() { listbox.selectedIndex = 0; }, 0);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+        setTimeout(() =&gt; { listbox.selectedIndex = 0; }, 0);</span>
<a href="#l13.14"></a><span id="l13.14">     } else {</span>
<a href="#l13.15"></a><span id="l13.15">         // Make sure the fields are disabled if we have no alarms</span>
<a href="#l13.16"></a><span id="l13.16">         setupRadioEnabledState(true);</span>
<a href="#l13.17"></a><span id="l13.17">     }</span>
<a href="#l13.18"></a><span id="l13.18"> }</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20"> /**</span>
<a href="#l13.21"></a><span id="l13.21">  * Sets up the enabled state of the reminder details controls. Used when</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -90,17 +90,17 @@ function getPrintSettings(receiverFunc) </span>
<a href="#l14.4"></a><span id="l14.4">         settings.start = theView.startDay.clone();</span>
<a href="#l14.5"></a><span id="l14.5">         settings.end = theView.endDay.clone();</span>
<a href="#l14.6"></a><span id="l14.6">         settings.end.day += 1;</span>
<a href="#l14.7"></a><span id="l14.7">         settings.start.isDate = false;</span>
<a href="#l14.8"></a><span id="l14.8">         settings.end.isDate = false;</span>
<a href="#l14.9"></a><span id="l14.9">         break;</span>
<a href="#l14.10"></a><span id="l14.10">     case &quot;selected&quot;: {</span>
<a href="#l14.11"></a><span id="l14.11">         let selectedItems = theView.getSelectedItems({});</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-        settings.eventList = selectedItems.filter(function(item) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+        settings.eventList = selectedItems.filter((item) =&gt; {</span>
<a href="#l14.14"></a><span id="l14.14">             if (cal.isEvent(item) &amp;&amp; !settings.printEvents) {</span>
<a href="#l14.15"></a><span id="l14.15">                 return false;</span>
<a href="#l14.16"></a><span id="l14.16">             }</span>
<a href="#l14.17"></a><span id="l14.17">             if (cal.isToDo(item) &amp;&amp; !settings.printTasks) {</span>
<a href="#l14.18"></a><span id="l14.18">                 return false;</span>
<a href="#l14.19"></a><span id="l14.19">             }</span>
<a href="#l14.20"></a><span id="l14.20">             return true;</span>
<a href="#l14.21"></a><span id="l14.21">         });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -434,20 +434,17 @@ cal.itip = {</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5">         if (needsCalendar) {</span>
<a href="#l15.6"></a><span id="l15.6">             let calendars = cal.getCalendarManager().getCalendars({}).filter(cal.itip.isSchedulingCalendar);</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8">             if (aItipItem.receivedMethod == &quot;REQUEST&quot;) {</span>
<a href="#l15.9"></a><span id="l15.9">                 // try to further limit down the list to those calendars that</span>
<a href="#l15.10"></a><span id="l15.10">                 // are configured to a matching attendee;</span>
<a href="#l15.11"></a><span id="l15.11">                 let item = aItipItem.getItemList({})[0];</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-                let matchingCals = calendars.filter(</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-                    function(calendar) {</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-                        return (cal.getInvitedAttendee(item, calendar) != null);</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-                    });</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+                let matchingCals = calendars.filter(calendar =&gt; cal.getInvitedAttendee(item, calendar) != null);</span>
<a href="#l15.17"></a><span id="l15.17">                 // if there's none, we will show the whole list of calendars:</span>
<a href="#l15.18"></a><span id="l15.18">                 if (matchingCals.length &gt; 0) {</span>
<a href="#l15.19"></a><span id="l15.19">                     calendars = matchingCals;</span>
<a href="#l15.20"></a><span id="l15.20">                 }</span>
<a href="#l15.21"></a><span id="l15.21">             }</span>
<a href="#l15.22"></a><span id="l15.22"> </span>
<a href="#l15.23"></a><span id="l15.23">             if (calendars.length == 0) {</span>
<a href="#l15.24"></a><span id="l15.24">                 let msg = cal.calGetString(&quot;lightning&quot;, &quot;imipNoCalendarAvailable&quot;, null, &quot;lightning&quot;);</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineat">@@ -560,23 +557,22 @@ cal.itip = {</span>
<a href="#l15.26"></a><span id="l15.26">             if (aOriginalItem.recurrenceInfo &amp;&amp; aItem.recurrenceInfo) {</span>
<a href="#l15.27"></a><span id="l15.27">                 // check whether the two differ only in EXDATEs</span>
<a href="#l15.28"></a><span id="l15.28">                 let clonedItem = aItem.clone();</span>
<a href="#l15.29"></a><span id="l15.29">                 let exdates = [];</span>
<a href="#l15.30"></a><span id="l15.30">                 for (let ritem of clonedItem.recurrenceInfo.getRecurrenceItems({})) {</span>
<a href="#l15.31"></a><span id="l15.31">                     let wrappedRItem = cal.wrapInstance(ritem, Components.interfaces.calIRecurrenceDate);</span>
<a href="#l15.32"></a><span id="l15.32">                     if (ritem.isNegative &amp;&amp;</span>
<a href="#l15.33"></a><span id="l15.33">                         wrappedRItem &amp;&amp;</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-                        !aOriginalItem.recurrenceInfo.getRecurrenceItems({}).some(</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-                            function(r) {</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-                                let wrappedR = cal.wrapInstance(r, Components.interfaces.calIRecurrenceDate);</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-                                return r.isNegative &amp;&amp;</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-                                       wrappedR &amp;&amp;</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-                                       wrappedR.date.compare(wrappedRItem.date) == 0;</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-                            })) {</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+                        !aOriginalItem.recurrenceInfo.getRecurrenceItems({}).some((r) =&gt; {</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineplus">+                            let wrappedR = cal.wrapInstance(r, Components.interfaces.calIRecurrenceDate);</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+                            return r.isNegative &amp;&amp;</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+                                   wrappedR &amp;&amp;</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+                                   wrappedR.date.compare(wrappedRItem.date) == 0;</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+                        })) {</span>
<a href="#l15.47"></a><span id="l15.47">                         exdates.push(wrappedRItem);</span>
<a href="#l15.48"></a><span id="l15.48">                     }</span>
<a href="#l15.49"></a><span id="l15.49">                 }</span>
<a href="#l15.50"></a><span id="l15.50">                 if (exdates.length &gt; 0) {</span>
<a href="#l15.51"></a><span id="l15.51">                     // check whether really only EXDATEs have been added:</span>
<a href="#l15.52"></a><span id="l15.52">                     let recInfo = clonedItem.recurrenceInfo;</span>
<a href="#l15.53"></a><span id="l15.53">                     exdates.forEach(recInfo.deleteRecurrenceItem, recInfo);</span>
<a href="#l15.54"></a><span id="l15.54">                     if (cal.compareItemContent(clonedItem, aOriginalItem)) { // transition into &quot;delete occurrence(s)&quot;</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineat">@@ -894,21 +890,20 @@ function stripUserData(item_) {</span>
<a href="#l15.56"></a><span id="l15.56">     let propEnum = item.propertyEnumerator;</span>
<a href="#l15.57"></a><span id="l15.57">     while (propEnum.hasMoreElements()) {</span>
<a href="#l15.58"></a><span id="l15.58">         let prop = propEnum.getNext().QueryInterface(Components.interfaces.nsIProperty);</span>
<a href="#l15.59"></a><span id="l15.59">         let pname = prop.name;</span>
<a href="#l15.60"></a><span id="l15.60">         if (pname.substr(0, &quot;X-MOZ-&quot;.length) == &quot;X-MOZ-&quot;) {</span>
<a href="#l15.61"></a><span id="l15.61">             item.deleteProperty(prop.name);</span>
<a href="#l15.62"></a><span id="l15.62">         }</span>
<a href="#l15.63"></a><span id="l15.63">     }</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-    item.getAttendees({}).forEach(</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-        function(att) {</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-            att.deleteProperty(&quot;RECEIVED-SEQUENCE&quot;);</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-            att.deleteProperty(&quot;RECEIVED-DTSTAMP&quot;);</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-        });</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineplus">+    item.getAttendees({}).forEach((att) =&gt; {</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineplus">+        att.deleteProperty(&quot;RECEIVED-SEQUENCE&quot;);</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineplus">+        att.deleteProperty(&quot;RECEIVED-DTSTAMP&quot;);</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineplus">+    });</span>
<a href="#l15.73"></a><span id="l15.73">     item.setProperty(&quot;DTSTAMP&quot;, stamp);</span>
<a href="#l15.74"></a><span id="l15.74">     item.setProperty(&quot;LAST-MODIFIED&quot;, lastModified); // need to be last to undirty the item</span>
<a href="#l15.75"></a><span id="l15.75">     return item;</span>
<a href="#l15.76"></a><span id="l15.76"> }</span>
<a href="#l15.77"></a><span id="l15.77"> </span>
<a href="#l15.78"></a><span id="l15.78"> /** local to this module file</span>
<a href="#l15.79"></a><span id="l15.79">  * Takes over relevant item information from iTIP item and sets received info.</span>
<a href="#l15.80"></a><span id="l15.80">  *</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineat">@@ -1332,17 +1327,17 @@ ItipItemFinder.prototype = {</span>
<a href="#l15.82"></a><span id="l15.82">                                             // are viewing the current representation of the item, show the</span>
<a href="#l15.83"></a><span id="l15.83">                                             // accept/decline buttons. This means newer events will show the</span>
<a href="#l15.84"></a><span id="l15.84">                                             // &quot;Update&quot; button and older events will show the &quot;already</span>
<a href="#l15.85"></a><span id="l15.85">                                             // processed&quot; text.</span>
<a href="#l15.86"></a><span id="l15.86">                                             if (foundAttendee.participationStatus == &quot;NEEDS-ACTION&quot; &amp;&amp;</span>
<a href="#l15.87"></a><span id="l15.87">                                                 (item.calendar.getProperty(&quot;itip.disableRevisionChecks&quot;) ||</span>
<a href="#l15.88"></a><span id="l15.88">                                                  cal.itip.compare(itipItemItem, item) == 0)) {</span>
<a href="#l15.89"></a><span id="l15.89">                                                 actionMethod = &quot;REQUEST:NEEDS-ACTION&quot;;</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineminus">-                                                operations.push(function(opListener, partStat) {</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+                                                operations.push((opListener, partStat) =&gt; {</span>
<a href="#l15.92"></a><span id="l15.92">                                                     let changedItem = firstFoundItem.clone();</span>
<a href="#l15.93"></a><span id="l15.93">                                                     changedItem.removeAttendee(foundAttendee);</span>
<a href="#l15.94"></a><span id="l15.94">                                                     foundAttendee = foundAttendee.clone();</span>
<a href="#l15.95"></a><span id="l15.95">                                                     if (partStat) {</span>
<a href="#l15.96"></a><span id="l15.96">                                                         foundAttendee.participationStatus = partStat;</span>
<a href="#l15.97"></a><span id="l15.97">                                                     }</span>
<a href="#l15.98"></a><span id="l15.98">                                                     changedItem.addAttendee(foundAttendee);</span>
<a href="#l15.99"></a><span id="l15.99"> </span>
<a href="#l15.100"></a><span id="l15.100" class="difflineat">@@ -1352,17 +1347,17 @@ ItipItemFinder.prototype = {</span>
<a href="#l15.101"></a><span id="l15.101">                                             } else if (item.calendar.getProperty(&quot;itip.disableRevisionChecks&quot;) ||</span>
<a href="#l15.102"></a><span id="l15.102">                                                        cal.itip.compare(itipItemItem, item) &gt; 0) {</span>
<a href="#l15.103"></a><span id="l15.103">                                                 addScheduleAgentClient(newItem, item.calendar);</span>
<a href="#l15.104"></a><span id="l15.104"> </span>
<a href="#l15.105"></a><span id="l15.105">                                                 let isMinorUpdate = (cal.itip.getSequence(newItem) ==</span>
<a href="#l15.106"></a><span id="l15.106">                                                                      cal.itip.getSequence(item));</span>
<a href="#l15.107"></a><span id="l15.107">                                                 actionMethod = (isMinorUpdate ? method + &quot;:UPDATE-MINOR&quot;</span>
<a href="#l15.108"></a><span id="l15.108">                                                                               : method + &quot;:UPDATE&quot;);</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineminus">-                                                operations.push(function(opListener, partStat) {</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineplus">+                                                operations.push((opListener, partStat) =&gt; {</span>
<a href="#l15.111"></a><span id="l15.111">                                                     if (!partStat) { // keep PARTSTAT</span>
<a href="#l15.112"></a><span id="l15.112">                                                         let att_ = cal.getInvitedAttendee(item);</span>
<a href="#l15.113"></a><span id="l15.113">                                                         partStat = (att_ ? att_.participationStatus : &quot;NEEDS-ACTION&quot;);</span>
<a href="#l15.114"></a><span id="l15.114">                                                     }</span>
<a href="#l15.115"></a><span id="l15.115">                                                     newItem.removeAttendee(att);</span>
<a href="#l15.116"></a><span id="l15.116">                                                     att = att.clone();</span>
<a href="#l15.117"></a><span id="l15.117">                                                     att.participationStatus = partStat;</span>
<a href="#l15.118"></a><span id="l15.118">                                                     newItem.addAttendee(att);</span>
<a href="#l15.119"></a><span id="l15.119" class="difflineat">@@ -1417,34 +1412,25 @@ ItipItemFinder.prototype = {</span>
<a href="#l15.120"></a><span id="l15.120">                                     let newItem = modifiedItems[item.id];</span>
<a href="#l15.121"></a><span id="l15.121">                                     if (!newItem) {</span>
<a href="#l15.122"></a><span id="l15.122">                                         newItem = item.clone();</span>
<a href="#l15.123"></a><span id="l15.123">                                         modifiedItems[item.id] = newItem;</span>
<a href="#l15.124"></a><span id="l15.124"> </span>
<a href="#l15.125"></a><span id="l15.125">                                         // Make sure the provider-specified properties are copied over</span>
<a href="#l15.126"></a><span id="l15.126">                                         copyProviderProperties(this.mItipItem, itipItemItem, newItem);</span>
<a href="#l15.127"></a><span id="l15.127"> </span>
<a href="#l15.128"></a><span id="l15.128" class="difflineminus">-                                        operations.push(</span>
<a href="#l15.129"></a><span id="l15.129" class="difflineminus">-                                            function(opListener) {</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineminus">-                                                return newItem.calendar.modifyItem(newItem, item, opListener);</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineminus">-                                            });</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineplus">+                                        operations.push(opListener =&gt; newItem.calendar.modifyItem(newItem, item, opListener));</span>
<a href="#l15.133"></a><span id="l15.133">                                     }</span>
<a href="#l15.134"></a><span id="l15.134">                                     newItem.recurrenceInfo.removeOccurrenceAt(rid);</span>
<a href="#l15.135"></a><span id="l15.135">                                 } else if (item.recurrenceId &amp;&amp; (item.recurrenceId.compare(rid) == 0)) {</span>
<a href="#l15.136"></a><span id="l15.136">                                     // parentless occurrence to be deleted (future)</span>
<a href="#l15.137"></a><span id="l15.137" class="difflineminus">-                                    operations.push(</span>
<a href="#l15.138"></a><span id="l15.138" class="difflineminus">-                                        function(opListener) {</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineminus">-                                            return item.calendar.deleteItem(item, opListener);</span>
<a href="#l15.140"></a><span id="l15.140" class="difflineminus">-                                        });</span>
<a href="#l15.141"></a><span id="l15.141" class="difflineplus">+                                    operations.push(opListener =&gt; item.calendar.deleteItem(item, opListener));</span>
<a href="#l15.142"></a><span id="l15.142">                                 }</span>
<a href="#l15.143"></a><span id="l15.143">                             } else {</span>
<a href="#l15.144"></a><span id="l15.144" class="difflineminus">-                                operations.push(</span>
<a href="#l15.145"></a><span id="l15.145" class="difflineminus">-                                    function(opListener) {</span>
<a href="#l15.146"></a><span id="l15.146" class="difflineminus">-                                        return item.calendar.deleteItem(item, opListener);</span>
<a href="#l15.147"></a><span id="l15.147" class="difflineminus">-                                    });</span>
<a href="#l15.148"></a><span id="l15.148" class="difflineplus">+                                operations.push(opListener =&gt; item.calendar.deleteItem(item, opListener));</span>
<a href="#l15.149"></a><span id="l15.149">                             }</span>
<a href="#l15.150"></a><span id="l15.150">                         }</span>
<a href="#l15.151"></a><span id="l15.151">                     }</span>
<a href="#l15.152"></a><span id="l15.152">                     break;</span>
<a href="#l15.153"></a><span id="l15.153">                 }</span>
<a href="#l15.154"></a><span id="l15.154">                 default:</span>
<a href="#l15.155"></a><span id="l15.155">                     rc = Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l15.156"></a><span id="l15.156">                     break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -234,26 +234,26 @@ cal.getImipTransport = function(aCalenda</span>
<a href="#l16.4"></a><span id="l16.4"> cal.getEmailIdentityOfCalendar = function(aCalendar, outAccount) {</span>
<a href="#l16.5"></a><span id="l16.5">     cal.ASSERT(aCalendar, &quot;no calendar!&quot;, Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l16.6"></a><span id="l16.6">     let key = aCalendar.getProperty(&quot;imip.identity.key&quot;);</span>
<a href="#l16.7"></a><span id="l16.7">     if (key !== null) {</span>
<a href="#l16.8"></a><span id="l16.8">         if (key.length == 0) { // i.e. &quot;None&quot;</span>
<a href="#l16.9"></a><span id="l16.9">             return null;</span>
<a href="#l16.10"></a><span id="l16.10">         }</span>
<a href="#l16.11"></a><span id="l16.11">         let identity = null;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        cal.calIterateEmailIdentities(</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-            function(identity_, account) {</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-                if (identity_.key == key) {</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-                    identity = identity_;</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-                    if (outAccount) {</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-                        outAccount.value = account;</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineminus">-                    }</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+        cal.calIterateEmailIdentities((identity_, account) =&gt; {</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+            if (identity_.key == key) {</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+                identity = identity_;</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+                if (outAccount) {</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+                    outAccount.value = account;</span>
<a href="#l16.24"></a><span id="l16.24">                 }</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-                return (identity_.key != key);</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-            });</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+            }</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineplus">+            return (identity_.key != key);</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineplus">+        });</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+</span>
<a href="#l16.31"></a><span id="l16.31">         if (!identity) {</span>
<a href="#l16.32"></a><span id="l16.32">             // dangling identity:</span>
<a href="#l16.33"></a><span id="l16.33">             cal.WARN(&quot;Calendar &quot; + (aCalendar.uri ? aCalendar.uri.spec : aCalendar.id) +</span>
<a href="#l16.34"></a><span id="l16.34">                      &quot; has a dangling E-Mail identity configured.&quot;);</span>
<a href="#l16.35"></a><span id="l16.35">         }</span>
<a href="#l16.36"></a><span id="l16.36">         return identity;</span>
<a href="#l16.37"></a><span id="l16.37">     } else { // take default account/identity:</span>
<a href="#l16.38"></a><span id="l16.38">         let findIdentity = function(account) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -143,20 +143,20 @@ function recurrenceRule2String(recurrenc</span>
<a href="#l17.4"></a><span id="l17.4">                                 }</span>
<a href="#l17.5"></a><span id="l17.5">                                 weekdaysString_every += getRString(pluralWeekday(&quot;repeatDetailsDay&quot; + byday[i])) + &quot;, &quot;;</span>
<a href="#l17.6"></a><span id="l17.6">                             } else {</span>
<a href="#l17.7"></a><span id="l17.7">                                 if (day_position(byday[i]) &lt; -1 || day_position(byday[i]) &gt; 5) {</span>
<a href="#l17.8"></a><span id="l17.8">                                     // We support only weekdays with -1 as negative</span>
<a href="#l17.9"></a><span id="l17.9">                                     // position ('THE LAST ...').</span>
<a href="#l17.10"></a><span id="l17.10">                                     return null;</span>
<a href="#l17.11"></a><span id="l17.11">                                 }</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-                                if (byday.some(function(element) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-                                                   return (day_position(element) == 0 &amp;&amp;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-                                                           day_of_week(byday[i]) == day_of_week(element));</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-                                               })) {</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+                                if (byday.some((element) =&gt; {</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+                                                return (day_position(element) == 0 &amp;&amp;</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+                                                        day_of_week(byday[i]) == day_of_week(element));</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+                                                })) {</span>
<a href="#l17.20"></a><span id="l17.20">                                     // Prevent to build strings such as for example:</span>
<a href="#l17.21"></a><span id="l17.21">                                     // &quot;every Monday and the second Monday...&quot;.</span>
<a href="#l17.22"></a><span id="l17.22">                                     continue;</span>
<a href="#l17.23"></a><span id="l17.23">                                 }</span>
<a href="#l17.24"></a><span id="l17.24">                                 let ordinalString = &quot;repeatOrdinal&quot; + day_position(byday[i]);</span>
<a href="#l17.25"></a><span id="l17.25">                                 let dayString = &quot;repeatDetailsDay&quot; + day_of_week(byday[i]);</span>
<a href="#l17.26"></a><span id="l17.26">                                 ordinalString = nounClass(dayString, ordinalString);</span>
<a href="#l17.27"></a><span id="l17.27">                                 ordinalString = getRString(ordinalString);</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineat">@@ -178,19 +178,17 @@ function recurrenceRule2String(recurrenc</span>
<a href="#l17.29"></a><span id="l17.29">                                                .replace(&quot;#2&quot;, rule.interval);</span>
<a href="#l17.30"></a><span id="l17.30">                     }</span>
<a href="#l17.31"></a><span id="l17.31">                 } else if (checkRecurrenceRule(rule, [&quot;BYMONTHDAY&quot;])) {</span>
<a href="#l17.32"></a><span id="l17.32">                     let component = rule.getComponent(&quot;BYMONTHDAY&quot;, {});</span>
<a href="#l17.33"></a><span id="l17.33"> </span>
<a href="#l17.34"></a><span id="l17.34">                     // First, find out if the 'BYMONTHDAY' component contains</span>
<a href="#l17.35"></a><span id="l17.35">                     // any elements with a negative value lesser than -1 (&quot;the</span>
<a href="#l17.36"></a><span id="l17.36">                     // last day&quot;). If so we currently don't support any rule</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">-                    if (component.some(function(element, index, array) {</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-                                           return element &lt; -1;</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">-                                       })) {</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+                    if (component.some(element =&gt; element &lt; -1)) {</span>
<a href="#l17.41"></a><span id="l17.41">                         // we don't support any other combination for now...</span>
<a href="#l17.42"></a><span id="l17.42">                         return getRString(&quot;ruleTooComplex&quot;);</span>
<a href="#l17.43"></a><span id="l17.43">                     } else if (component.length == 1 &amp;&amp; component[0] == -1) {</span>
<a href="#l17.44"></a><span id="l17.44">                         // i.e. one day, the last day of the month</span>
<a href="#l17.45"></a><span id="l17.45">                         let monthlyString = getRString(&quot;monthlyLastDayOfNth&quot;);</span>
<a href="#l17.46"></a><span id="l17.46">                         ruleString = PluralForm.get(rule.interval, monthlyString)</span>
<a href="#l17.47"></a><span id="l17.47">                                                .replace(&quot;#1&quot;, rule.interval);</span>
<a href="#l17.48"></a><span id="l17.48">                     } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/modules/calUtils.jsm</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/modules/calUtils.jsm</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -933,26 +933,26 @@ var cal = {</span>
<a href="#l18.4"></a><span id="l18.4"> };</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6"> // local to this module;</span>
<a href="#l18.7"></a><span id="l18.7"> // will be used to clean up global objects on shutdown</span>
<a href="#l18.8"></a><span id="l18.8"> // some objects have cyclic references due to wrappers</span>
<a href="#l18.9"></a><span id="l18.9"> function shutdownCleanup(obj, prop) {</span>
<a href="#l18.10"></a><span id="l18.10">     if (!shutdownCleanup.mEntries) {</span>
<a href="#l18.11"></a><span id="l18.11">         shutdownCleanup.mEntries = [];</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-        cal.addShutdownObserver(function() {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-                for (let entry of shutdownCleanup.mEntries) {</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-                    if (entry.mProp) {</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-                        delete entry.mObj[entry.mProp];</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-                    } else {</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">-                        delete entry.mObj;</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-                    }</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+        cal.addShutdownObserver(() =&gt; {</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+            for (let entry of shutdownCleanup.mEntries) {</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+                if (entry.mProp) {</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+                    delete entry.mObj[entry.mProp];</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+                } else {</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineplus">+                    delete entry.mObj;</span>
<a href="#l18.25"></a><span id="l18.25">                 }</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineminus">-                delete shutdownCleanup.mEntries;</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineminus">-            });</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+            }</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineplus">+            delete shutdownCleanup.mEntries;</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+        });</span>
<a href="#l18.31"></a><span id="l18.31">     }</span>
<a href="#l18.32"></a><span id="l18.32">     shutdownCleanup.mEntries.push({ mObj: obj, mProp: prop });</span>
<a href="#l18.33"></a><span id="l18.33"> }</span>
<a href="#l18.34"></a><span id="l18.34"> </span>
<a href="#l18.35"></a><span id="l18.35"> // local to this module;</span>
<a href="#l18.36"></a><span id="l18.36"> // will be used to generate service accessor functions</span>
<a href="#l18.37"></a><span id="l18.37"> function generateServiceAccessor(id, iface) {</span>
<a href="#l18.38"></a><span id="l18.38">     // eslint-disable-next-line func-names</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/modules/calXMLUtils.jsm</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/modules/calXMLUtils.jsm</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -156,17 +156,17 @@ cal.xml.serializeDOM = function(doc) {</span>
<a href="#l19.4"></a><span id="l19.4"> /**</span>
<a href="#l19.5"></a><span id="l19.5">  * Escape a string for use in XML</span>
<a href="#l19.6"></a><span id="l19.6">  *</span>
<a href="#l19.7"></a><span id="l19.7">  * @param str           The string to escape</span>
<a href="#l19.8"></a><span id="l19.8">  * @param isAttribute   If true, &quot; and ' are also escaped</span>
<a href="#l19.9"></a><span id="l19.9">  * @return              The escaped string</span>
<a href="#l19.10"></a><span id="l19.10">  */</span>
<a href="#l19.11"></a><span id="l19.11"> cal.xml.escapeString = function(str, isAttribute) {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    return str.replace(/[&amp;&lt;&gt;'&quot;]/g, function(chr) {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    return str.replace(/[&amp;&lt;&gt;'&quot;]/g, (chr) =&gt; {</span>
<a href="#l19.14"></a><span id="l19.14">         switch (chr) {</span>
<a href="#l19.15"></a><span id="l19.15">             case &quot;&amp;&quot;: return &quot;&amp;amp;&quot;;</span>
<a href="#l19.16"></a><span id="l19.16">             case &quot;&lt;&quot;: return &quot;&amp;lt;&quot;;</span>
<a href="#l19.17"></a><span id="l19.17">             case &quot;&gt;&quot;: return &quot;&amp;gt;&quot;;</span>
<a href="#l19.18"></a><span id="l19.18">             case '&quot;': return (isAttribute ? &quot;&amp;quot;&quot; : chr);</span>
<a href="#l19.19"></a><span id="l19.19">             case &quot;'&quot;: return (isAttribute ? &quot;&amp;apos;&quot; : chr);</span>
<a href="#l19.20"></a><span id="l19.20">             default: return chr;</span>
<a href="#l19.21"></a><span id="l19.21">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -143,30 +143,28 @@ calAlarmMonitor.prototype = {</span>
<a href="#l20.4"></a><span id="l20.4">             // Uh oh, it seems the alarms were removed even before the window</span>
<a href="#l20.5"></a><span id="l20.5">             // finished loading. Looks like we can close it again</span>
<a href="#l20.6"></a><span id="l20.6">             calAlarmWindow.closeIfEmpty();</span>
<a href="#l20.7"></a><span id="l20.7">         }</span>
<a href="#l20.8"></a><span id="l20.8">     },</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10">     onRemoveAlarmsByItem: function(aItem) {</span>
<a href="#l20.11"></a><span id="l20.11">         let calAlarmWindow = peekAlarmWindow();</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-        this.mAlarms = this.mAlarms.filter(function(itemAlarm) {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-            let [thisItem, alarm] = itemAlarm;</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+        this.mAlarms = this.mAlarms.filter(([thisItem, alarm]) =&gt; {</span>
<a href="#l20.15"></a><span id="l20.15">             let ret = (aItem.hashId != thisItem.hashId);</span>
<a href="#l20.16"></a><span id="l20.16">             if (!ret &amp;&amp; calAlarmWindow) { // window is open</span>
<a href="#l20.17"></a><span id="l20.17">                 calAlarmWindow.removeWidgetFor(thisItem, alarm);</span>
<a href="#l20.18"></a><span id="l20.18">             }</span>
<a href="#l20.19"></a><span id="l20.19">             return ret;</span>
<a href="#l20.20"></a><span id="l20.20">         });</span>
<a href="#l20.21"></a><span id="l20.21">     },</span>
<a href="#l20.22"></a><span id="l20.22"> </span>
<a href="#l20.23"></a><span id="l20.23">     onRemoveAlarmsByCalendar: function(calendar) {</span>
<a href="#l20.24"></a><span id="l20.24">         let calAlarmWindow = peekAlarmWindow();</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineminus">-        this.mAlarms = this.mAlarms.filter(function(itemAlarm) {</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineminus">-            let [thisItem, alarm] = itemAlarm;</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineplus">+        this.mAlarms = this.mAlarms.filter(([thisItem, alarm]) =&gt; {</span>
<a href="#l20.28"></a><span id="l20.28">             let ret = (calendar.id != thisItem.calendar.id);</span>
<a href="#l20.29"></a><span id="l20.29"> </span>
<a href="#l20.30"></a><span id="l20.30">             if (!ret &amp;&amp; calAlarmWindow) { // window is open</span>
<a href="#l20.31"></a><span id="l20.31">                 calAlarmWindow.removeWidgetFor(thisItem, alarm);</span>
<a href="#l20.32"></a><span id="l20.32">             }</span>
<a href="#l20.33"></a><span id="l20.33">             return ret;</span>
<a href="#l20.34"></a><span id="l20.34">         });</span>
<a href="#l20.35"></a><span id="l20.35">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -71,17 +71,17 @@ calCachedCalendarObserverHelper.prototyp</span>
<a href="#l21.4"></a><span id="l21.4">         if (this.isCachedObserver) {</span>
<a href="#l21.5"></a><span id="l21.5">             this.home.mObservers.notify(&quot;onLoad&quot;, [this.home]);</span>
<a href="#l21.6"></a><span id="l21.6">         } else {</span>
<a href="#l21.7"></a><span id="l21.7">             // start sync action after uncached calendar has been loaded.</span>
<a href="#l21.8"></a><span id="l21.8">             // xxx todo, think about:</span>
<a href="#l21.9"></a><span id="l21.9">             // although onAddItem et al have been called, we need to fire</span>
<a href="#l21.10"></a><span id="l21.10">             // an additional onLoad completing the refresh call (-&gt;composite)</span>
<a href="#l21.11"></a><span id="l21.11">             let home = this.home;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-            home.synchronize(function(status) {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+            home.synchronize((status) =&gt; {</span>
<a href="#l21.14"></a><span id="l21.14">                 home.mObservers.notify(&quot;onLoad&quot;, [home]);</span>
<a href="#l21.15"></a><span id="l21.15">             });</span>
<a href="#l21.16"></a><span id="l21.16">         }</span>
<a href="#l21.17"></a><span id="l21.17">     },</span>
<a href="#l21.18"></a><span id="l21.18"> </span>
<a href="#l21.19"></a><span id="l21.19">     onAddItem: function(aItem) {</span>
<a href="#l21.20"></a><span id="l21.20">         if (this.isCachedObserver) {</span>
<a href="#l21.21"></a><span id="l21.21">             this.home.mObservers.notify(&quot;onAddItem&quot;, arguments);</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineat">@@ -353,22 +353,22 @@ calCachedCalendar.prototype = {</span>
<a href="#l21.23"></a><span id="l21.23">                         // TODO instead of deleting the calendar and creating a new</span>
<a href="#l21.24"></a><span id="l21.24">                         // one, maybe we want to do a &quot;real&quot; sync between the</span>
<a href="#l21.25"></a><span id="l21.25">                         // existing local calendar and the remote calendar.</span>
<a href="#l21.26"></a><span id="l21.26">                         self.setupCachedCalendar();</span>
<a href="#l21.27"></a><span id="l21.27">                         this.hasRenewedCalendar = true;</span>
<a href="#l21.28"></a><span id="l21.28">                     }</span>
<a href="#l21.29"></a><span id="l21.29"> </span>
<a href="#l21.30"></a><span id="l21.30">                     this.getsReceived++;</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-                    cal.forEach(aItems, function(item) {</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+                    cal.forEach(aItems, (item) =&gt; {</span>
<a href="#l21.33"></a><span id="l21.33">                         // Adding items recd from the Memory Calendar</span>
<a href="#l21.34"></a><span id="l21.34">                         // These may be different than what the cache has</span>
<a href="#l21.35"></a><span id="l21.35">                         completeListener.modifiedTimes[item.id] = item.lastModifiedTime;</span>
<a href="#l21.36"></a><span id="l21.36">                         self.mCachedCalendar.addItem(item, null);</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-                    }, function() {</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+                    }, () =&gt; {</span>
<a href="#l21.39"></a><span id="l21.39">                         completeListener.getsCompleted++;</span>
<a href="#l21.40"></a><span id="l21.40">                         if (completeListener.opCompleted) {</span>
<a href="#l21.41"></a><span id="l21.41">                             // onOperationComplete was called, but we were not ready yet. call it now.</span>
<a href="#l21.42"></a><span id="l21.42">                             completeListener.onOperationComplete.apply(completeListener, completeListener.opCompleted);</span>
<a href="#l21.43"></a><span id="l21.43">                             completeListener.opCompleted = false;</span>
<a href="#l21.44"></a><span id="l21.44">                         }</span>
<a href="#l21.45"></a><span id="l21.45">                     });</span>
<a href="#l21.46"></a><span id="l21.46">                 }</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineat">@@ -378,17 +378,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l21.48"></a><span id="l21.48">                 if (this.getsCompleted &lt; this.getsReceived) {</span>
<a href="#l21.49"></a><span id="l21.49">                     // If not all of our gets have been processed, then save the</span>
<a href="#l21.50"></a><span id="l21.50">                     // arguments and finish processing later.</span>
<a href="#l21.51"></a><span id="l21.51">                     this.opCompleted = Array.slice(arguments);</span>
<a href="#l21.52"></a><span id="l21.52">                     return;</span>
<a href="#l21.53"></a><span id="l21.53">                 }</span>
<a href="#l21.54"></a><span id="l21.54"> </span>
<a href="#l21.55"></a><span id="l21.55">                 if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-                    cal.forEach(self.offlineCachedItems, function(item) {</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+                    cal.forEach(self.offlineCachedItems, (item) =&gt; {</span>
<a href="#l21.58"></a><span id="l21.58">                         switch (self.offlineCachedItemFlags[item.hashId]) {</span>
<a href="#l21.59"></a><span id="l21.59">                             case cICL.OFFLINE_FLAG_CREATED_RECORD:</span>
<a href="#l21.60"></a><span id="l21.60">                                 // Created items are not present on the server, so its safe to adopt them</span>
<a href="#l21.61"></a><span id="l21.61">                                 self.adoptOfflineItem(item.clone(), null);</span>
<a href="#l21.62"></a><span id="l21.62">                                 break;</span>
<a href="#l21.63"></a><span id="l21.63">                             case cICL.OFFLINE_FLAG_MODIFIED_RECORD:</span>
<a href="#l21.64"></a><span id="l21.64">                                 // Two Cases Here:</span>
<a href="#l21.65"></a><span id="l21.65">                                 if (item.id in completeListener.modifiedTimes) {</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineat">@@ -420,23 +420,23 @@ calCachedCalendar.prototype = {</span>
<a href="#l21.67"></a><span id="l21.67">                                         // ...and has not been modified. Delete it now.</span>
<a href="#l21.68"></a><span id="l21.68">                                         self.deleteOfflineItem(item, null);</span>
<a href="#l21.69"></a><span id="l21.69">                                     }</span>
<a href="#l21.70"></a><span id="l21.70">                                 } else {</span>
<a href="#l21.71"></a><span id="l21.71">                                     // Item has already been deleted from the server, no need to change anything.</span>
<a href="#l21.72"></a><span id="l21.72">                                 }</span>
<a href="#l21.73"></a><span id="l21.73">                                 break;</span>
<a href="#l21.74"></a><span id="l21.74">                         }</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineminus">-                    }, function() {</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineplus">+                    }, () =&gt; {</span>
<a href="#l21.77"></a><span id="l21.77">                         self.offlineCachedItems = {};</span>
<a href="#l21.78"></a><span id="l21.78">                         self.offlineCachedItemFlags = {};</span>
<a href="#l21.79"></a><span id="l21.79">                         self.playbackOfflineItems(() =&gt; emptyQueue(aStatus));</span>
<a href="#l21.80"></a><span id="l21.80">                     });</span>
<a href="#l21.81"></a><span id="l21.81">                 } else {</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineminus">-                    self.playbackOfflineItems(function() { self.mCachedObserver.onLoad(self.mCachedCalendar); });</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+                    self.playbackOfflineItems(() =&gt; self.mCachedObserver.onLoad(self.mCachedCalendar));</span>
<a href="#l21.84"></a><span id="l21.84">                     emptyQueue(aStatus);</span>
<a href="#l21.85"></a><span id="l21.85">                 }</span>
<a href="#l21.86"></a><span id="l21.86">             }</span>
<a href="#l21.87"></a><span id="l21.87">         };</span>
<a href="#l21.88"></a><span id="l21.88"> </span>
<a href="#l21.89"></a><span id="l21.89">         this.getOfflineAddedItems(() =&gt; {</span>
<a href="#l21.90"></a><span id="l21.90">             this.mPendingSync = this.mUncachedCalendar.getItems(Components.interfaces.calICalendar.ITEM_FILTER_ALL_ITEMS,</span>
<a href="#l21.91"></a><span id="l21.91">                                                                     0, null, null, completeListener);</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineat">@@ -618,21 +618,19 @@ calCachedCalendar.prototype = {</span>
<a href="#l21.93"></a><span id="l21.93">         } else {</span>
<a href="#l21.94"></a><span id="l21.94">             this.downstreamRefresh();</span>
<a href="#l21.95"></a><span id="l21.95">         }</span>
<a href="#l21.96"></a><span id="l21.96">     },</span>
<a href="#l21.97"></a><span id="l21.97">     downstreamRefresh: function() {</span>
<a href="#l21.98"></a><span id="l21.98">         if (this.mUncachedCalendar.canRefresh &amp;&amp; !this.offline) {</span>
<a href="#l21.99"></a><span id="l21.99">             return this.mUncachedCalendar.refresh(); // will trigger synchronize once the calendar is loaded</span>
<a href="#l21.100"></a><span id="l21.100">         } else {</span>
<a href="#l21.101"></a><span id="l21.101" class="difflineminus">-            let self = this;</span>
<a href="#l21.102"></a><span id="l21.102" class="difflineminus">-            return this.synchronize(</span>
<a href="#l21.103"></a><span id="l21.103" class="difflineminus">-                function(status) { // fire completing onLoad for this refresh call</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineminus">-                    self.mCachedObserver.onLoad(self.mCachedCalendar);</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineminus">-                });</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineplus">+            return this.synchronize((status) =&gt; { // fire completing onLoad for this refresh call</span>
<a href="#l21.107"></a><span id="l21.107" class="difflineplus">+                this.mCachedObserver.onLoad(this.mCachedCalendar);</span>
<a href="#l21.108"></a><span id="l21.108" class="difflineplus">+            });</span>
<a href="#l21.109"></a><span id="l21.109">         }</span>
<a href="#l21.110"></a><span id="l21.110">     },</span>
<a href="#l21.111"></a><span id="l21.111"> </span>
<a href="#l21.112"></a><span id="l21.112">     addObserver: function(aObserver) {</span>
<a href="#l21.113"></a><span id="l21.113">         this.mObservers.add(aObserver);</span>
<a href="#l21.114"></a><span id="l21.114">     },</span>
<a href="#l21.115"></a><span id="l21.115">     removeObserver: function(aObserver) {</span>
<a href="#l21.116"></a><span id="l21.116">         this.mObservers.remove(aObserver);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -418,17 +418,17 @@ calCalendarManager.prototype = {</span>
<a href="#l22.4"></a><span id="l22.4">                             errorBoxButtonFlags,</span>
<a href="#l22.5"></a><span id="l22.5">                             errorBoxButtonLabel,</span>
<a href="#l22.6"></a><span id="l22.6">                             null, // No second button text</span>
<a href="#l22.7"></a><span id="l22.7">                             null, // No third button text</span>
<a href="#l22.8"></a><span id="l22.8">                             null, // No checkbox</span>
<a href="#l22.9"></a><span id="l22.9">                             { value: false }); // Unnecessary checkbox state</span>
<a href="#l22.10"></a><span id="l22.10"> </span>
<a href="#l22.11"></a><span id="l22.11">         // Disable Lightning</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-        AddonManager.getAddonByID(&quot;{e2fda1a4-762b-4020-b5ad-a41df1933103}&quot;, function(aAddon) {</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+        AddonManager.getAddonByID(&quot;{e2fda1a4-762b-4020-b5ad-a41df1933103}&quot;, (aAddon) =&gt; {</span>
<a href="#l22.14"></a><span id="l22.14">             aAddon.userDisabled = true;</span>
<a href="#l22.15"></a><span id="l22.15">             Services.startup.quit(Components.interfaces.nsIAppStartup.eRestart |</span>
<a href="#l22.16"></a><span id="l22.16">                 Components.interfaces.nsIAppStartup.eForceQuit);</span>
<a href="#l22.17"></a><span id="l22.17">         });</span>
<a href="#l22.18"></a><span id="l22.18">     },</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20">     /**</span>
<a href="#l22.21"></a><span id="l22.21">      * calICalendarManager interface</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/src/calDefaultACLManager.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/src/calDefaultACLManager.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -69,17 +69,17 @@ calDefaultCalendarACLEntry.prototype = {</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5">     hasAccessControl: false,</span>
<a href="#l23.6"></a><span id="l23.6">     userIsOwner: true,</span>
<a href="#l23.7"></a><span id="l23.7">     userCanAddItems: true,</span>
<a href="#l23.8"></a><span id="l23.8">     userCanDeleteItems: true,</span>
<a href="#l23.9"></a><span id="l23.9"> </span>
<a href="#l23.10"></a><span id="l23.10">     _getIdentities: function(aCount) {</span>
<a href="#l23.11"></a><span id="l23.11">         let identities = [];</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-        cal.calIterateEmailIdentities(function(id, ac) { identities.push(id); });</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+        cal.calIterateEmailIdentities(id =&gt; identities.push(id));</span>
<a href="#l23.14"></a><span id="l23.14">         aCount.value = identities.length;</span>
<a href="#l23.15"></a><span id="l23.15">         return identities;</span>
<a href="#l23.16"></a><span id="l23.16">     },</span>
<a href="#l23.17"></a><span id="l23.17"> </span>
<a href="#l23.18"></a><span id="l23.18">     getUserAddresses: function(aCount) {</span>
<a href="#l23.19"></a><span id="l23.19">         let identities = this.getUserIdentities(aCount);</span>
<a href="#l23.20"></a><span id="l23.20">         let addresses = identities.map(id =&gt; id.email);</span>
<a href="#l23.21"></a><span id="l23.21">         return addresses;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -357,19 +357,17 @@ calFilter.prototype = {</span>
<a href="#l24.4"></a><span id="l24.4">         // TODO: Support specifying which fields to search on</span>
<a href="#l24.5"></a><span id="l24.5">         for (let field of [&quot;SUMMARY&quot;, &quot;DESCRIPTION&quot;, &quot;LOCATION&quot;, &quot;URL&quot;]) {</span>
<a href="#l24.6"></a><span id="l24.6">             let val = aItem.getProperty(field);</span>
<a href="#l24.7"></a><span id="l24.7">             if (val &amp;&amp; val.toLowerCase().includes(searchText)) {</span>
<a href="#l24.8"></a><span id="l24.8">                 return true;</span>
<a href="#l24.9"></a><span id="l24.9">             }</span>
<a href="#l24.10"></a><span id="l24.10">         }</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-        return aItem.getCategories({}).some(function(cat) {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-            return cat.toLowerCase().includes(searchText);</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-        });</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+        return aItem.getCategories({}).some(cat =&gt; cat.toLowerCase().includes(searchText));</span>
<a href="#l24.16"></a><span id="l24.16">     },</span>
<a href="#l24.17"></a><span id="l24.17"> </span>
<a href="#l24.18"></a><span id="l24.18">     /**</span>
<a href="#l24.19"></a><span id="l24.19">      * Checks if the item matches the current filter date range.</span>
<a href="#l24.20"></a><span id="l24.20">      *</span>
<a href="#l24.21"></a><span id="l24.21">      * @param aItem               The item to check.</span>
<a href="#l24.22"></a><span id="l24.22">      * @return                    Returns true if the item falls within the date range</span>
<a href="#l24.23"></a><span id="l24.23">      *                            specified by mStartDate and mEndDate, false otherwise.</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineat">@@ -415,19 +413,17 @@ calFilter.prototype = {</span>
<a href="#l24.25"></a><span id="l24.25">         if (result &amp;&amp; props.category) {</span>
<a href="#l24.26"></a><span id="l24.26">             let cats = [];</span>
<a href="#l24.27"></a><span id="l24.27"> </span>
<a href="#l24.28"></a><span id="l24.28">             if (typeof props.category == &quot;string&quot;) {</span>
<a href="#l24.29"></a><span id="l24.29">                 cats.push(props.category);</span>
<a href="#l24.30"></a><span id="l24.30">             } else if (Array.isArray(props.category)) {</span>
<a href="#l24.31"></a><span id="l24.31">                 cats = props.category;</span>
<a href="#l24.32"></a><span id="l24.32">             }</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-            result = cats.some(function(cat) {</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-                return aItem.getCategories({}).includes(cat);</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-            });</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineplus">+            result = cats.some(cat =&gt; aItem.getCategories({}).includes(cat));</span>
<a href="#l24.37"></a><span id="l24.37">         }</span>
<a href="#l24.38"></a><span id="l24.38"> </span>
<a href="#l24.39"></a><span id="l24.39">         // test the status property. Only applies to tasks.</span>
<a href="#l24.40"></a><span id="l24.40">         if (result &amp;&amp; props.status != null &amp;&amp; cal.isToDo(aItem)) {</span>
<a href="#l24.41"></a><span id="l24.41">             let completed = aItem.isCompleted;</span>
<a href="#l24.42"></a><span id="l24.42">             let current = !aItem.completedDate || today.compare(aItem.completedDate) &lt;= 0;</span>
<a href="#l24.43"></a><span id="l24.43">             let percent = aItem.percentComplete || 0;</span>
<a href="#l24.44"></a><span id="l24.44"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/src/calIcsParser.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/src/calIcsParser.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -56,17 +56,17 @@ calIcsParser.prototype = {</span>
<a href="#l25.4"></a><span id="l25.4">             }</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6">             for (let subComp of cal.ical.subcomponentIterator(calComp)) {</span>
<a href="#l25.7"></a><span id="l25.7">                 state.submit(subComp);</span>
<a href="#l25.8"></a><span id="l25.8">             }</span>
<a href="#l25.9"></a><span id="l25.9">             calComp = rootComp.getNextSubcomponent(&quot;VCALENDAR&quot;);</span>
<a href="#l25.10"></a><span id="l25.10">         }</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-        state.join(function() {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+        state.join(() =&gt; {</span>
<a href="#l25.14"></a><span id="l25.14">             let fakedParents = {};</span>
<a href="#l25.15"></a><span id="l25.15">             // tag &quot;exceptions&quot;, i.e. items with rid:</span>
<a href="#l25.16"></a><span id="l25.16">             for (let item of state.excItems) {</span>
<a href="#l25.17"></a><span id="l25.17">                 let parent = state.uid2parent[item.id];</span>
<a href="#l25.18"></a><span id="l25.18"> </span>
<a href="#l25.19"></a><span id="l25.19">                 if (!parent) { // a parentless one, fake a master and override it's occurrence</span>
<a href="#l25.20"></a><span id="l25.20">                     parent = isEvent(item) ? createEvent() : createTodo();</span>
<a href="#l25.21"></a><span id="l25.21">                     parent.id = item.id;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/src/calItipItem.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/src/calItipItem.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -111,21 +111,20 @@ calItipItem.prototype = {</span>
<a href="#l26.4"></a><span id="l26.4">             while (propEnum.hasMoreElements()) {</span>
<a href="#l26.5"></a><span id="l26.5">                 let prop = propEnum.getNext().QueryInterface(Components.interfaces.nsIProperty);</span>
<a href="#l26.6"></a><span id="l26.6">                 let pname = prop.name;</span>
<a href="#l26.7"></a><span id="l26.7">                 if (pname != &quot;X-MOZ-FAKED-MASTER&quot; &amp;&amp; pname.substr(0, &quot;X-MOZ-&quot;.length) == &quot;X-MOZ-&quot;) {</span>
<a href="#l26.8"></a><span id="l26.8">                     item.deleteProperty(prop.name);</span>
<a href="#l26.9"></a><span id="l26.9">                 }</span>
<a href="#l26.10"></a><span id="l26.10">             }</span>
<a href="#l26.11"></a><span id="l26.11">             // never publish an organizer's RECEIVED params:</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-            item.getAttendees({}).forEach(</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-                function(att) {</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-                    att.deleteProperty(&quot;RECEIVED-SEQUENCE&quot;);</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">-                    att.deleteProperty(&quot;RECEIVED-DTSTAMP&quot;);</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineminus">-                });</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+            item.getAttendees({}).forEach((att) =&gt; {</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineplus">+                att.deleteProperty(&quot;RECEIVED-SEQUENCE&quot;);</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+                att.deleteProperty(&quot;RECEIVED-DTSTAMP&quot;);</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineplus">+            });</span>
<a href="#l26.21"></a><span id="l26.21">             item.setProperty(&quot;DTSTAMP&quot;, stamp);</span>
<a href="#l26.22"></a><span id="l26.22">             item.setProperty(&quot;LAST-MODIFIED&quot;, lastModified); // need to be last to undirty the item</span>
<a href="#l26.23"></a><span id="l26.23">         }</span>
<a href="#l26.24"></a><span id="l26.24"> </span>
<a href="#l26.25"></a><span id="l26.25">         this.mItemList = [];</span>
<a href="#l26.26"></a><span id="l26.26">         for (let item of cal.itemIterator(parser.getItems({}))) {</span>
<a href="#l26.27"></a><span id="l26.27">             cleanItem(item);</span>
<a href="#l26.28"></a><span id="l26.28">             // only push non-faked master items or</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineat">@@ -153,17 +152,17 @@ calItipItem.prototype = {</span>
<a href="#l26.30"></a><span id="l26.30">             }</span>
<a href="#l26.31"></a><span id="l26.31">         }</span>
<a href="#l26.32"></a><span id="l26.32"> </span>
<a href="#l26.33"></a><span id="l26.33">         this.mIsInitialized = true;</span>
<a href="#l26.34"></a><span id="l26.34">     },</span>
<a href="#l26.35"></a><span id="l26.35"> </span>
<a href="#l26.36"></a><span id="l26.36">     clone: function() {</span>
<a href="#l26.37"></a><span id="l26.37">         let newItem = new calItipItem();</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineminus">-        newItem.mItemList = this.mItemList.map(function(item) { return item.clone(); });</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineplus">+        newItem.mItemList = this.mItemList.map(item =&gt; item.clone());</span>
<a href="#l26.40"></a><span id="l26.40">         newItem.mReceivedMethod = this.mReceivedMethod;</span>
<a href="#l26.41"></a><span id="l26.41">         newItem.mResponseMethod = this.mResponseMethod;</span>
<a href="#l26.42"></a><span id="l26.42">         newItem.mAutoResponse = this.mAutoResponse;</span>
<a href="#l26.43"></a><span id="l26.43">         newItem.mTargetCalendar = this.mTargetCalendar;</span>
<a href="#l26.44"></a><span id="l26.44">         newItem.mIdentity = this.mIdentity;</span>
<a href="#l26.45"></a><span id="l26.45">         newItem.mLocalStatus = this.mLocalStatus;</span>
<a href="#l26.46"></a><span id="l26.46">         newItem.mIsSend = this.mIsSend;</span>
<a href="#l26.47"></a><span id="l26.47">         newItem.mIsInitialized = this.mIsInitialized;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/src/calRecurrenceInfo.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/src/calRecurrenceInfo.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -571,17 +571,17 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l27.4"></a><span id="l27.4">             dates = dates.slice(0, aMaxCount);</span>
<a href="#l27.5"></a><span id="l27.5">         }</span>
<a href="#l27.6"></a><span id="l27.6"> </span>
<a href="#l27.7"></a><span id="l27.7">         return dates;</span>
<a href="#l27.8"></a><span id="l27.8">     },</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10">     getOccurrenceDates: function(aRangeStart, aRangeEnd, aMaxCount, aCount) {</span>
<a href="#l27.11"></a><span id="l27.11">         let dates = this.calculateDates(aRangeStart, aRangeEnd, aMaxCount);</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-        dates = dates.map(function(d) { return d.rstart; });</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+        dates = dates.map(d =&gt; d.rstart);</span>
<a href="#l27.14"></a><span id="l27.14">         aCount.value = dates.length;</span>
<a href="#l27.15"></a><span id="l27.15">         return dates;</span>
<a href="#l27.16"></a><span id="l27.16">     },</span>
<a href="#l27.17"></a><span id="l27.17"> </span>
<a href="#l27.18"></a><span id="l27.18">     getOccurrences: function(aRangeStart, aRangeEnd, aMaxCount, aCount) {</span>
<a href="#l27.19"></a><span id="l27.19">         let results = [];</span>
<a href="#l27.20"></a><span id="l27.20">         let dates = this.calculateDates(aRangeStart, aRangeEnd, aMaxCount);</span>
<a href="#l27.21"></a><span id="l27.21">         if (dates.length) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/src/calTimezone.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/src/calTimezone.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -44,17 +44,17 @@ calICALJSTimezone.prototype = {</span>
<a href="#l28.4"></a><span id="l28.4">         let bundle = ICAL.Timezone.cal_tz_bundle;</span>
<a href="#l28.5"></a><span id="l28.5">         let stringName = &quot;pref.timezone.&quot; + this.tzid.replace(/\//g, &quot;.&quot;);</span>
<a href="#l28.6"></a><span id="l28.6">         let displayName = this.tzid;</span>
<a href="#l28.7"></a><span id="l28.7">         try {</span>
<a href="#l28.8"></a><span id="l28.8">             displayName = bundle.GetStringFromName(stringName);</span>
<a href="#l28.9"></a><span id="l28.9">         } catch (e) {</span>
<a href="#l28.10"></a><span id="l28.10">             // Just use the TZID if the string is mising.</span>
<a href="#l28.11"></a><span id="l28.11">         }</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-        this.__defineGetter__(&quot;displayName&quot;, function() {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+        this.__defineGetter__(&quot;displayName&quot;, () =&gt; {</span>
<a href="#l28.14"></a><span id="l28.14">             return displayName;</span>
<a href="#l28.15"></a><span id="l28.15">         });</span>
<a href="#l28.16"></a><span id="l28.16">         return displayName;</span>
<a href="#l28.17"></a><span id="l28.17">     },</span>
<a href="#l28.18"></a><span id="l28.18"> </span>
<a href="#l28.19"></a><span id="l28.19">     tostring: function() { return this.innerObject.toString(); }</span>
<a href="#l28.20"></a><span id="l28.20"> };</span>
<a href="#l28.21"></a><span id="l28.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/import-export/calHtmlExport.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/import-export/calHtmlExport.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -40,17 +40,17 @@ calHtmlExporter.prototype = {</span>
<a href="#l29.4"></a><span id="l29.4">     },</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6">     exportToStream: function(aStream, aCount, aItems, aTitle) {</span>
<a href="#l29.7"></a><span id="l29.7">         let document = cal.xml.parseFile(&quot;chrome://calendar-common/skin/printing/calHtmlExport.html&quot;);</span>
<a href="#l29.8"></a><span id="l29.8">         let itemContainer = document.getElementById(&quot;item-container&quot;);</span>
<a href="#l29.9"></a><span id="l29.9">         document.getElementById(&quot;title&quot;).textContent = aTitle || cal.calGetString(&quot;calendar&quot;, &quot;HTMLTitle&quot;);</span>
<a href="#l29.10"></a><span id="l29.10"> </span>
<a href="#l29.11"></a><span id="l29.11">         // Sort aItems</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-        aItems.sort(function(a, b) {</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+        aItems.sort((a, b) =&gt; {</span>
<a href="#l29.14"></a><span id="l29.14">             let start_a = a[cal.calGetStartDateProp(a)];</span>
<a href="#l29.15"></a><span id="l29.15">             if (!start_a) {</span>
<a href="#l29.16"></a><span id="l29.16">                 return -1;</span>
<a href="#l29.17"></a><span id="l29.17">             }</span>
<a href="#l29.18"></a><span id="l29.18">             let start_b = b[cal.calGetStartDateProp(b)];</span>
<a href="#l29.19"></a><span id="l29.19">             if (!start_b) {</span>
<a href="#l29.20"></a><span id="l29.20">                 return 1;</span>
<a href="#l29.21"></a><span id="l29.21">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -442,19 +442,17 @@ calOutlookCSVExporter.prototype = {</span>
<a href="#l30.4"></a><span id="l30.4">         headers.push(localeEn.headAllDayEvent);</span>
<a href="#l30.5"></a><span id="l30.5">         headers.push(localeEn.headAlarm);</span>
<a href="#l30.6"></a><span id="l30.6">         headers.push(localeEn.headAlarmDate);</span>
<a href="#l30.7"></a><span id="l30.7">         headers.push(localeEn.headAlarmTime);</span>
<a href="#l30.8"></a><span id="l30.8">         headers.push(localeEn.headCategories);</span>
<a href="#l30.9"></a><span id="l30.9">         headers.push(localeEn.headDescription);</span>
<a href="#l30.10"></a><span id="l30.10">         headers.push(localeEn.headLocation);</span>
<a href="#l30.11"></a><span id="l30.11">         headers.push(localeEn.headPrivate);</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-        headers = headers.map(function(v) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-            return '&quot;' + v + '&quot;';</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineminus">-        });</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+        headers = headers.map(v =&gt; '&quot;' + v + '&quot;');</span>
<a href="#l30.16"></a><span id="l30.16">         str = headers.join(&quot;,&quot;);</span>
<a href="#l30.17"></a><span id="l30.17">         str += exportLineEnding;</span>
<a href="#l30.18"></a><span id="l30.18">         aStream.write(str, str.length);</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20">         for (let item of aItems) {</span>
<a href="#l30.21"></a><span id="l30.21">             if (!cal.isEvent(item)) {</span>
<a href="#l30.22"></a><span id="l30.22">                 // XXX TODO: warn the user (once) that tasks are not supported</span>
<a href="#l30.23"></a><span id="l30.23">                 // (bug 336175)</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineat">@@ -475,17 +473,14 @@ calOutlookCSVExporter.prototype = {</span>
<a href="#l30.25"></a><span id="l30.25">             line.push(alarmDate ? localeEn.valueTrue : localeEn.valueFalse);</span>
<a href="#l30.26"></a><span id="l30.26">             line.push(alarmDate ? dateString(alarmDate) : &quot;&quot;);</span>
<a href="#l30.27"></a><span id="l30.27">             line.push(alarmDate ? timeString(alarmDate) : &quot;&quot;);</span>
<a href="#l30.28"></a><span id="l30.28">             line.push(txtString(cal.categoriesArrayToString(item.getCategories({})))); // xxx todo: what's the correct way to encode ',' in csv?, how are multi-values expressed?</span>
<a href="#l30.29"></a><span id="l30.29">             line.push(txtString(item.getProperty(&quot;DESCRIPTION&quot;)));</span>
<a href="#l30.30"></a><span id="l30.30">             line.push(txtString(item.getProperty(&quot;LOCATION&quot;)));</span>
<a href="#l30.31"></a><span id="l30.31">             line.push(item.privacy == &quot;PRIVATE&quot; ? localeEn.valueTrue : localeEn.valueFalse);</span>
<a href="#l30.32"></a><span id="l30.32"> </span>
<a href="#l30.33"></a><span id="l30.33" class="difflineminus">-            line = line.map(function(v) {</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineminus">-                v = String(v).replace(/&quot;/g, '&quot;&quot;');</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineminus">-                return '&quot;' + v + '&quot;';</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineminus">-            });</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineplus">+            line = line.map(v =&gt; `&quot;${String(v).replace(/&quot;/g, '&quot;&quot;')}&quot;`);</span>
<a href="#l30.38"></a><span id="l30.38">             str = line.join(&quot;,&quot;) + exportLineEnding;</span>
<a href="#l30.39"></a><span id="l30.39">             aStream.write(str, str.length);</span>
<a href="#l30.40"></a><span id="l30.40">         }</span>
<a href="#l30.41"></a><span id="l30.41">     }</span>
<a href="#l30.42"></a><span id="l30.42"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/lightning/components/calItipProtocolHandler.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/lightning/components/calItipProtocolHandler.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -114,20 +114,20 @@ ItipContentHandler.prototype = {</span>
<a href="#l31.4"></a><span id="l31.4">         if (!uri.startsWith(ITIP_HANDLER_PROTOCOL + &quot;:&quot;)) {</span>
<a href="#l31.5"></a><span id="l31.5">             cal.ERROR(&quot;Unexpected iTIP uri: &quot; + uri + &quot;\n&quot;);</span>
<a href="#l31.6"></a><span id="l31.6">             throw NS_ERROR_WONT_HANDLE_CONTENT;</span>
<a href="#l31.7"></a><span id="l31.7">         }</span>
<a href="#l31.8"></a><span id="l31.8">         // moz-cal-handle-itip:///?</span>
<a href="#l31.9"></a><span id="l31.9">         let paramString = uri.substring(ITIP_HANDLER_PROTOCOL.length + 4);</span>
<a href="#l31.10"></a><span id="l31.10">         let paramArray = paramString.split(&quot;&amp;&quot;);</span>
<a href="#l31.11"></a><span id="l31.11">         let paramBlock = { };</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-        paramArray.forEach(function(v) {</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+        paramArray.forEach((v) =&gt; {</span>
<a href="#l31.14"></a><span id="l31.14">             let parts = v.split(&quot;=&quot;);</span>
<a href="#l31.15"></a><span id="l31.15">             paramBlock[parts[0]] = unescape(unescape(parts[1]));</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">-            });</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+        });</span>
<a href="#l31.18"></a><span id="l31.18">         // dump(&quot;content-handler: have params &quot; + paramBlock.toSource() + &quot;\n&quot;);</span>
<a href="#l31.19"></a><span id="l31.19">         let event = cal.createEvent(paramBlock.data);</span>
<a href="#l31.20"></a><span id="l31.20">         dump(&quot;Processing iTIP event '&quot; + event.title + &quot;' from &quot; +</span>
<a href="#l31.21"></a><span id="l31.21">             event.organizer.id + &quot; (&quot; + event.id + &quot;)\n&quot;);</span>
<a href="#l31.22"></a><span id="l31.22">         let calMgr = cal.getCalendarManager();</span>
<a href="#l31.23"></a><span id="l31.23">         let cals = calMgr.getCalendars({});</span>
<a href="#l31.24"></a><span id="l31.24">         cals[0].addItem(event, null);</span>
<a href="#l31.25"></a><span id="l31.25">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -2135,17 +2135,17 @@ function uploadCloudAttachment(attachmen</span>
<a href="#l32.4"></a><span id="l32.4">                 // delete it from the attach map now, this will make sure it is</span>
<a href="#l32.5"></a><span id="l32.5">                 // not serialized if the user saves.</span>
<a href="#l32.6"></a><span id="l32.6">                 listItem.setAttribute(&quot;image&quot;, &quot;chrome://messenger/skin/icons/error.png&quot;);</span>
<a href="#l32.7"></a><span id="l32.7">                 delete gAttachMap[attachment.hashId];</span>
<a href="#l32.8"></a><span id="l32.8"> </span>
<a href="#l32.9"></a><span id="l32.9">                 // Keep the item for a while so the user can see something failed.</span>
<a href="#l32.10"></a><span id="l32.10">                 // When we have a nice notification bar, we can show more info</span>
<a href="#l32.11"></a><span id="l32.11">                 // about the failure.</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-                setTimeout(function() {</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+                setTimeout(() =&gt; {</span>
<a href="#l32.14"></a><span id="l32.14">                     listItem.remove();</span>
<a href="#l32.15"></a><span id="l32.15">                     updateAttachment();</span>
<a href="#l32.16"></a><span id="l32.16">                 }, 5000);</span>
<a href="#l32.17"></a><span id="l32.17">             }</span>
<a href="#l32.18"></a><span id="l32.18">         }</span>
<a href="#l32.19"></a><span id="l32.19">     });</span>
<a href="#l32.20"></a><span id="l32.20"> }</span>
<a href="#l32.21"></a><span id="l32.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -344,17 +344,17 @@ var calendarItemTabType = {</span>
<a href="#l33.4"></a><span id="l33.4">                         aTabmail.openTab(aState.tabType, aState.args);</span>
<a href="#l33.5"></a><span id="l33.5">                     }</span>
<a href="#l33.6"></a><span id="l33.6">                 });</span>
<a href="#l33.7"></a><span id="l33.7">             }</span>
<a href="#l33.8"></a><span id="l33.8">         }</span>
<a href="#l33.9"></a><span id="l33.9">     }</span>
<a href="#l33.10"></a><span id="l33.10"> };</span>
<a href="#l33.11"></a><span id="l33.11"> </span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-window.addEventListener(&quot;load&quot;, function(e) {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+window.addEventListener(&quot;load&quot;, (e) =&gt; {</span>
<a href="#l33.14"></a><span id="l33.14">     let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l33.15"></a><span id="l33.15">     tabmail.registerTabType(calendarTabType);</span>
<a href="#l33.16"></a><span id="l33.16">     tabmail.registerTabType(calendarItemTabType);</span>
<a href="#l33.17"></a><span id="l33.17">     tabmail.registerTabMonitor(calendarTabMonitor);</span>
<a href="#l33.18"></a><span id="l33.18"> }, false);</span>
<a href="#l33.19"></a><span id="l33.19"> </span>
<a href="#l33.20"></a><span id="l33.20"> </span>
<a href="#l33.21"></a><span id="l33.21"> function ltnOnLoad(event) {</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineat">@@ -523,17 +523,17 @@ function ltnIntegrationCheck() {</span>
<a href="#l33.23"></a><span id="l33.23">         if (cnt.value == 1 &amp;&amp;</span>
<a href="#l33.24"></a><span id="l33.24">             calMgr.getCalendarPref_(cals[0], &quot;type&quot;) == &quot;storage&quot; &amp;&amp;</span>
<a href="#l33.25"></a><span id="l33.25">             calMgr.getCalendarPref_(cals[0], &quot;name&quot;) == homeCalName) {</span>
<a href="#l33.26"></a><span id="l33.26">             // this looks like a default setup, so let's see whether the calendar contains any items</span>
<a href="#l33.27"></a><span id="l33.27">             let pCal = cal.async.promisifyCalendar(cals[0]);</span>
<a href="#l33.28"></a><span id="l33.28">             // we look at all items at any time, but we can stop if the first item was found</span>
<a href="#l33.29"></a><span id="l33.29">             // if we've found no items, we call ltnIntegrationNotification to display the bar</span>
<a href="#l33.30"></a><span id="l33.30">             pCal.getItems(Components.interfaces.calICalendar.ITEM_FILTER_ALL_ITEMS, 1, null, null)</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-                .then(function(aItems) { if (!aItems.length) { ltnIntegrationNotification(); } });</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+                .then((aItems) =&gt; { if (!aItems.length) { ltnIntegrationNotification(); } });</span>
<a href="#l33.33"></a><span id="l33.33">         }</span>
<a href="#l33.34"></a><span id="l33.34">     }</span>
<a href="#l33.35"></a><span id="l33.35"> }</span>
<a href="#l33.36"></a><span id="l33.36"> </span>
<a href="#l33.37"></a><span id="l33.37"> /* Called at midnight to tell us to redraw date-specific widgets.  Do NOT call</span>
<a href="#l33.38"></a><span id="l33.38">  * this for normal refresh, since it also calls scheduleMidnightRefresh.</span>
<a href="#l33.39"></a><span id="l33.39">  */</span>
<a href="#l33.40"></a><span id="l33.40"> function refreshUIBits() {</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineat">@@ -542,17 +542,17 @@ function refreshUIBits() {</span>
<a href="#l33.42"></a><span id="l33.42"> </span>
<a href="#l33.43"></a><span id="l33.43">         // Refresh the current view and just allow the refresh for the others</span>
<a href="#l33.44"></a><span id="l33.44">         // views when will be displayed.</span>
<a href="#l33.45"></a><span id="l33.45">         let currView = currentView();</span>
<a href="#l33.46"></a><span id="l33.46">         currView.goToDay();</span>
<a href="#l33.47"></a><span id="l33.47">         [&quot;day-view&quot;,</span>
<a href="#l33.48"></a><span id="l33.48">          &quot;week-view&quot;,</span>
<a href="#l33.49"></a><span id="l33.49">          &quot;multiweek-view&quot;,</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineminus">-         &quot;month-view&quot;].forEach(function(view) {</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineplus">+         &quot;month-view&quot;].forEach((view) =&gt; {</span>
<a href="#l33.52"></a><span id="l33.52">             if (view != currView.id) {</span>
<a href="#l33.53"></a><span id="l33.53">                 document.getElementById(view).mToggleStatus = -1;</span>
<a href="#l33.54"></a><span id="l33.54">             }</span>
<a href="#l33.55"></a><span id="l33.55">         });</span>
<a href="#l33.56"></a><span id="l33.56"> </span>
<a href="#l33.57"></a><span id="l33.57">         if (!TodayPane.showsToday()) {</span>
<a href="#l33.58"></a><span id="l33.58">             TodayPane.setDay(now());</span>
<a href="#l33.59"></a><span id="l33.59">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/lightning/content/suite-overlay-sidebar.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/lightning/content/suite-overlay-sidebar.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -16,17 +16,17 @@ var ltnSuiteUtils = {</span>
<a href="#l34.4"></a><span id="l34.4">     observe: function(subject, topic, state) {</span>
<a href="#l34.5"></a><span id="l34.5">       if (topic != &quot;lightning-startup-done&quot; &amp;&amp;</span>
<a href="#l34.6"></a><span id="l34.6">           topic != &quot;calendar-taskview-startup-done&quot;) {</span>
<a href="#l34.7"></a><span id="l34.7">         return;</span>
<a href="#l34.8"></a><span id="l34.8">       }</span>
<a href="#l34.9"></a><span id="l34.9"> </span>
<a href="#l34.10"></a><span id="l34.10">       [[&quot;CustomizeTaskActionsToolbar&quot;, &quot;task-actions-toolbox&quot;],</span>
<a href="#l34.11"></a><span id="l34.11">        [&quot;CustomizeCalendarToolbar&quot;, &quot;calendar-toolbox&quot;],</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-       [&quot;CustomizeTaskToolbar&quot;, &quot;task-toolbox&quot;]].forEach(function(eIDs) {</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+       [&quot;CustomizeTaskToolbar&quot;, &quot;task-toolbox&quot;]].forEach((eIDs) =&gt; {</span>
<a href="#l34.14"></a><span id="l34.14">         let [itemID, toolboxID] = eIDs;</span>
<a href="#l34.15"></a><span id="l34.15">         let item = document.getElementById(itemID);</span>
<a href="#l34.16"></a><span id="l34.16">         let toolbox = document.getElementById(toolboxID);</span>
<a href="#l34.17"></a><span id="l34.17">         toolbox.customizeInit = function() {</span>
<a href="#l34.18"></a><span id="l34.18">           item.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l34.19"></a><span id="l34.19">           toolboxCustomizeInit(&quot;mail-menubar&quot;);</span>
<a href="#l34.20"></a><span id="l34.20">         };</span>
<a href="#l34.21"></a><span id="l34.21">         toolbox.customizeDone = function(aToolboxChanged) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -118,19 +118,17 @@ calCompositeCalendar.prototype = {</span>
<a href="#l35.4"></a><span id="l35.4"> </span>
<a href="#l35.5"></a><span id="l35.5">     mCalendars: null,</span>
<a href="#l35.6"></a><span id="l35.6">     mDefaultCalendar: null,</span>
<a href="#l35.7"></a><span id="l35.7">     mPrefPrefix: null,</span>
<a href="#l35.8"></a><span id="l35.8">     mDefaultPref: null,</span>
<a href="#l35.9"></a><span id="l35.9">     mActivePref: null,</span>
<a href="#l35.10"></a><span id="l35.10"> </span>
<a href="#l35.11"></a><span id="l35.11">     get enabledCalendars() {</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-      return this.mCalendars.filter(</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">-        function(e) { return !e.getProperty(&quot;disabled&quot;); }</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineminus">-      );</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+      return this.mCalendars.filter(e =&gt; !e.getProperty(&quot;disabled&quot;));</span>
<a href="#l35.16"></a><span id="l35.16">     },</span>
<a href="#l35.17"></a><span id="l35.17"> </span>
<a href="#l35.18"></a><span id="l35.18">     set prefPrefix(aPrefPrefix) {</span>
<a href="#l35.19"></a><span id="l35.19">         if (this.mPrefPrefix) {</span>
<a href="#l35.20"></a><span id="l35.20">             for (let calendar of this.mCalendars) {</span>
<a href="#l35.21"></a><span id="l35.21">                 this.removeCalendar(calendar);</span>
<a href="#l35.22"></a><span id="l35.22">             }</span>
<a href="#l35.23"></a><span id="l35.23">         }</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineat">@@ -174,17 +172,17 @@ calCompositeCalendar.prototype = {</span>
<a href="#l35.25"></a><span id="l35.25">         // if we have no default calendar, we need one here</span>
<a href="#l35.26"></a><span id="l35.26">         if (this.mDefaultCalendar == null &amp;&amp; !aCalendar.getProperty(&quot;disabled&quot;)) {</span>
<a href="#l35.27"></a><span id="l35.27">             this.setDefaultCalendar(aCalendar, false);</span>
<a href="#l35.28"></a><span id="l35.28">         }</span>
<a href="#l35.29"></a><span id="l35.29">     },</span>
<a href="#l35.30"></a><span id="l35.30"> </span>
<a href="#l35.31"></a><span id="l35.31">     removeCalendar: function(aCalendar) {</span>
<a href="#l35.32"></a><span id="l35.32">         let id = aCalendar.id;</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineminus">-        let newCalendars = this.mCalendars.filter(function(calendar) { return calendar.id != id; });</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineplus">+        let newCalendars = this.mCalendars.filter(calendar =&gt; calendar.id != id);</span>
<a href="#l35.35"></a><span id="l35.35">         if (newCalendars.length != this.mCalendars) {</span>
<a href="#l35.36"></a><span id="l35.36">             this.mCalendars = newCalendars;</span>
<a href="#l35.37"></a><span id="l35.37">             if (this.mPrefPrefix) {</span>
<a href="#l35.38"></a><span id="l35.38">                 aCalendar.deleteProperty(this.mActivePref);</span>
<a href="#l35.39"></a><span id="l35.39">                 aCalendar.deleteProperty(this.mDefaultPref);</span>
<a href="#l35.40"></a><span id="l35.40">             }</span>
<a href="#l35.41"></a><span id="l35.41">             aCalendar.removeObserver(this.mObserverHelper);</span>
<a href="#l35.42"></a><span id="l35.42">             this.mCompositeObservers.notify(&quot;onCalendarRemoved&quot;, [aCalendar]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -438,21 +438,20 @@ calICSCalendar.prototype = {</span>
<a href="#l36.4"></a><span id="l36.4">             this.forceRefresh();</span>
<a href="#l36.5"></a><span id="l36.5">             ctxt.unlock(calIErrors.MODIFICATION_FAILED);</span>
<a href="#l36.6"></a><span id="l36.6">             Services.startup.exitLastWindowClosingSurvivalArea();</span>
<a href="#l36.7"></a><span id="l36.7">             return;</span>
<a href="#l36.8"></a><span id="l36.8">         }</span>
<a href="#l36.9"></a><span id="l36.9"> </span>
<a href="#l36.10"></a><span id="l36.10">         // Allow the hook to grab data of the channel, like the new etag</span>
<a href="#l36.11"></a><span id="l36.11"> </span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-        ctxt.mHooks.onAfterPut(request,</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-                               function() {</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-                                   ctxt.unlock();</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineminus">-                                   Services.startup.exitLastWindowClosingSurvivalArea();</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineminus">-                               });</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineplus">+        ctxt.mHooks.onAfterPut(request, () =&gt; {</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineplus">+            ctxt.unlock();</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineplus">+            Services.startup.exitLastWindowClosingSurvivalArea();</span>
<a href="#l36.20"></a><span id="l36.20" class="difflineplus">+        });</span>
<a href="#l36.21"></a><span id="l36.21">     },</span>
<a href="#l36.22"></a><span id="l36.22"> </span>
<a href="#l36.23"></a><span id="l36.23">     // Always use the queue, just to reduce the amount of places where</span>
<a href="#l36.24"></a><span id="l36.24">     // this.mMemoryCalendar.addItem() and friends are called. less</span>
<a href="#l36.25"></a><span id="l36.25">     // copied code.</span>
<a href="#l36.26"></a><span id="l36.26">     addItem: function(aItem, aListener) {</span>
<a href="#l36.27"></a><span id="l36.27">         this.adoptItem(aItem.clone(), aListener);</span>
<a href="#l36.28"></a><span id="l36.28">     },</span>
<a href="#l36.29"></a><span id="l36.29" class="difflineat">@@ -581,30 +580,29 @@ calICSCalendar.prototype = {</span>
<a href="#l36.30"></a><span id="l36.30"> </span>
<a href="#l36.31"></a><span id="l36.31">     lock: function() {</span>
<a href="#l36.32"></a><span id="l36.32">         this.locked = true;</span>
<a href="#l36.33"></a><span id="l36.33">     },</span>
<a href="#l36.34"></a><span id="l36.34"> </span>
<a href="#l36.35"></a><span id="l36.35">     unlock: function(errCode) {</span>
<a href="#l36.36"></a><span id="l36.36">         ASSERT(this.locked, &quot;unexpected!&quot;);</span>
<a href="#l36.37"></a><span id="l36.37"> </span>
<a href="#l36.38"></a><span id="l36.38" class="difflineminus">-        this.mModificationActions.forEach(</span>
<a href="#l36.39"></a><span id="l36.39" class="difflineminus">-            function(action) {</span>
<a href="#l36.40"></a><span id="l36.40" class="difflineminus">-                let args = action.opCompleteArgs;</span>
<a href="#l36.41"></a><span id="l36.41" class="difflineminus">-                ASSERT(args, &quot;missing onOperationComplete call!&quot;);</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineminus">-                let listener = action.listener;</span>
<a href="#l36.43"></a><span id="l36.43" class="difflineminus">-                if (listener) {</span>
<a href="#l36.44"></a><span id="l36.44" class="difflineminus">-                    if (Components.isSuccessCode(args[1]) &amp;&amp;</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineminus">-                        errCode &amp;&amp; !Components.isSuccessCode(errCode)) {</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineminus">-                        listener.onOperationComplete(args[0], errCode, args[2], args[3], null);</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineminus">-                    } else {</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineminus">-                        listener.onOperationComplete.apply(listener, args);</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineminus">-                    }</span>
<a href="#l36.50"></a><span id="l36.50" class="difflineplus">+        this.mModificationActions.forEach((action) =&gt; {</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineplus">+            let args = action.opCompleteArgs;</span>
<a href="#l36.52"></a><span id="l36.52" class="difflineplus">+            ASSERT(args, &quot;missing onOperationComplete call!&quot;);</span>
<a href="#l36.53"></a><span id="l36.53" class="difflineplus">+            let listener = action.listener;</span>
<a href="#l36.54"></a><span id="l36.54" class="difflineplus">+            if (listener) {</span>
<a href="#l36.55"></a><span id="l36.55" class="difflineplus">+                if (Components.isSuccessCode(args[1]) &amp;&amp;</span>
<a href="#l36.56"></a><span id="l36.56" class="difflineplus">+                    errCode &amp;&amp; !Components.isSuccessCode(errCode)) {</span>
<a href="#l36.57"></a><span id="l36.57" class="difflineplus">+                    listener.onOperationComplete(args[0], errCode, args[2], args[3], null);</span>
<a href="#l36.58"></a><span id="l36.58" class="difflineplus">+                } else {</span>
<a href="#l36.59"></a><span id="l36.59" class="difflineplus">+                    listener.onOperationComplete.apply(listener, args);</span>
<a href="#l36.60"></a><span id="l36.60">                 }</span>
<a href="#l36.61"></a><span id="l36.61" class="difflineminus">-            });</span>
<a href="#l36.62"></a><span id="l36.62" class="difflineplus">+            }</span>
<a href="#l36.63"></a><span id="l36.63" class="difflineplus">+        });</span>
<a href="#l36.64"></a><span id="l36.64">         this.mModificationActions = [];</span>
<a href="#l36.65"></a><span id="l36.65"> </span>
<a href="#l36.66"></a><span id="l36.66">         this.locked = false;</span>
<a href="#l36.67"></a><span id="l36.67">         this.processQueue();</span>
<a href="#l36.68"></a><span id="l36.68">     },</span>
<a href="#l36.69"></a><span id="l36.69"> </span>
<a href="#l36.70"></a><span id="l36.70">     isLocked: function() {</span>
<a href="#l36.71"></a><span id="l36.71">         return this.locked;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -213,17 +213,17 @@ calWcapCalendar.prototype = {</span>
<a href="#l37.4"></a><span id="l37.4">     issueNetworkRequest: function(</span>
<a href="#l37.5"></a><span id="l37.5">               request, respFunc, dataConvFunc, wcapCommand, params, accessRights) {</span>
<a href="#l37.6"></a><span id="l37.6">         let self = this;</span>
<a href="#l37.7"></a><span id="l37.7">         // - bootstrap problem: no cal_props, no access check, no default calId</span>
<a href="#l37.8"></a><span id="l37.8">         // - assure being logged in, thus the default cal_props are available</span>
<a href="#l37.9"></a><span id="l37.9">         // - every subscribed calendar will come along with cal_props</span>
<a href="#l37.10"></a><span id="l37.10">         return this.session.getSessionId(</span>
<a href="#l37.11"></a><span id="l37.11">             request,</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-            function(err, sessionId) {</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+            (err, sessionId) =&gt; {</span>
<a href="#l37.14"></a><span id="l37.14">                 try {</span>
<a href="#l37.15"></a><span id="l37.15">                     if (err) {</span>
<a href="#l37.16"></a><span id="l37.16">                         throw err;</span>
<a href="#l37.17"></a><span id="l37.17">                     }</span>
<a href="#l37.18"></a><span id="l37.18">                     self.assureAccess(accessRights);</span>
<a href="#l37.19"></a><span id="l37.19">                     params += (&quot;&amp;calid=&quot; + encodeURIComponent(self.calId));</span>
<a href="#l37.20"></a><span id="l37.20">                     self.session.issueNetworkRequest(request, respFunc, dataConvFunc, wcapCommand, params);</span>
<a href="#l37.21"></a><span id="l37.21">                 } catch (exc) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -269,59 +269,60 @@ var METHOD_REPLY = 4;</span>
<a href="#l38.4"></a><span id="l38.4"> var METHOD_CANCEL = 8;</span>
<a href="#l38.5"></a><span id="l38.5"> var METHOD_UPDATE = 256;</span>
<a href="#l38.6"></a><span id="l38.6"> /* eslint-enable no-unused-vars */</span>
<a href="#l38.7"></a><span id="l38.7"> </span>
<a href="#l38.8"></a><span id="l38.8"> calWcapCalendar.prototype.storeItem = function(bAddItem, item, oldItem, request) {</span>
<a href="#l38.9"></a><span id="l38.9">     function getOrgId(orgItem) {</span>
<a href="#l38.10"></a><span id="l38.10">         return (orgItem &amp;&amp; orgItem.organizer &amp;&amp; orgItem.organizer.id ? orgItem.organizer.id : null);</span>
<a href="#l38.11"></a><span id="l38.11">     }</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-    function encodeAttendees(atts) {</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+    function encodeCategories(cats) {</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineplus">+        cats = cats.concat([]);</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineplus">+        cats.sort();</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineplus">+        return cats.join(&quot;;&quot;);</span>
<a href="#l38.17"></a><span id="l38.17" class="difflineplus">+    }</span>
<a href="#l38.18"></a><span id="l38.18" class="difflineplus">+    function getPrivacy(pitem) {</span>
<a href="#l38.19"></a><span id="l38.19" class="difflineplus">+        return ((pitem.privacy &amp;&amp; pitem.privacy != &quot;&quot;) ? pitem.privacy : &quot;PUBLIC&quot;);</span>
<a href="#l38.20"></a><span id="l38.20" class="difflineplus">+    }</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineplus">+</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineplus">+    let encodeAttendees = (atts) =&gt; {</span>
<a href="#l38.23"></a><span id="l38.23">         function attendeeSort(one, two) {</span>
<a href="#l38.24"></a><span id="l38.24">             one = one.id;</span>
<a href="#l38.25"></a><span id="l38.25">             two = two.id;</span>
<a href="#l38.26"></a><span id="l38.26">             if (one == two) {</span>
<a href="#l38.27"></a><span id="l38.27">                 return 0;</span>
<a href="#l38.28"></a><span id="l38.28">             }</span>
<a href="#l38.29"></a><span id="l38.29">             return (one &lt; two ? -1 : 1);</span>
<a href="#l38.30"></a><span id="l38.30">         }</span>
<a href="#l38.31"></a><span id="l38.31">         atts = atts.concat([]);</span>
<a href="#l38.32"></a><span id="l38.32">         atts.sort(attendeeSort);</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineminus">-        return atts.map(self.encodeAttendee, self).join(&quot;;&quot;);</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineminus">-    }</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineminus">-    function encodeCategories(cats) {</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineminus">-        cats = cats.concat([]);</span>
<a href="#l38.37"></a><span id="l38.37" class="difflineminus">-        cats.sort();</span>
<a href="#l38.38"></a><span id="l38.38" class="difflineminus">-        return cats.join(&quot;;&quot;);</span>
<a href="#l38.39"></a><span id="l38.39" class="difflineminus">-    }</span>
<a href="#l38.40"></a><span id="l38.40" class="difflineminus">-    function getPrivacy(pitem) {</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineminus">-        return ((pitem.privacy &amp;&amp; pitem.privacy != &quot;&quot;) ? pitem.privacy : &quot;PUBLIC&quot;);</span>
<a href="#l38.42"></a><span id="l38.42" class="difflineminus">-    }</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineminus">-    function getAttachments(attitem) {</span>
<a href="#l38.44"></a><span id="l38.44" class="difflineplus">+        return atts.map(this.encodeAttendee, this).join(&quot;;&quot;);</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineplus">+    };</span>
<a href="#l38.46"></a><span id="l38.46" class="difflineplus">+</span>
<a href="#l38.47"></a><span id="l38.47" class="difflineplus">+    let getAttachments = (attitem) =&gt; {</span>
<a href="#l38.48"></a><span id="l38.48">         let ret;</span>
<a href="#l38.49"></a><span id="l38.49">         let attachments = attitem.attachments;</span>
<a href="#l38.50"></a><span id="l38.50">         if (attachments) {</span>
<a href="#l38.51"></a><span id="l38.51">             let strings = [];</span>
<a href="#l38.52"></a><span id="l38.52">             for (let att of attachments) {</span>
<a href="#l38.53"></a><span id="l38.53">                 let wrappedAtt = cal.wrapInstance(att, Components.interfaces.calIAttachment);</span>
<a href="#l38.54"></a><span id="l38.54">                 if (typeof att == &quot;string&quot;) {</span>
<a href="#l38.55"></a><span id="l38.55">                     strings.push(encodeURIComponent(att));</span>
<a href="#l38.56"></a><span id="l38.56">                 } else if (wrappedAtt &amp;&amp; wrappedAtt.uri) {</span>
<a href="#l38.57"></a><span id="l38.57">                     strings.push(encodeURIComponent(wrappedAtt.uri.spec));</span>
<a href="#l38.58"></a><span id="l38.58">                 } else { // xxx todo</span>
<a href="#l38.59"></a><span id="l38.59" class="difflineminus">-                    logError(&quot;only URLs supported as attachment, not: &quot; + att, self);</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineplus">+                    logError(&quot;only URLs supported as attachment, not: &quot; + att, this);</span>
<a href="#l38.61"></a><span id="l38.61">                 }</span>
<a href="#l38.62"></a><span id="l38.62">             }</span>
<a href="#l38.63"></a><span id="l38.63">             strings.sort();</span>
<a href="#l38.64"></a><span id="l38.64">             ret = strings.join(&quot;;&quot;);</span>
<a href="#l38.65"></a><span id="l38.65">         }</span>
<a href="#l38.66"></a><span id="l38.66">         return ret || &quot;&quot;;</span>
<a href="#l38.67"></a><span id="l38.67" class="difflineminus">-    }</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineplus">+    };</span>
<a href="#l38.69"></a><span id="l38.69"> </span>
<a href="#l38.70"></a><span id="l38.70" class="difflineminus">-    let self = this;</span>
<a href="#l38.71"></a><span id="l38.71">     let bIsEvent = isEvent(item);</span>
<a href="#l38.72"></a><span id="l38.72">     let bIsParent = isParent(item);</span>
<a href="#l38.73"></a><span id="l38.73"> </span>
<a href="#l38.74"></a><span id="l38.74">     let method = METHOD_PUBLISH;</span>
<a href="#l38.75"></a><span id="l38.75">     let bNoSmtpNotify = false;</span>
<a href="#l38.76"></a><span id="l38.76">     let params = &quot;&quot;;</span>
<a href="#l38.77"></a><span id="l38.77"> </span>
<a href="#l38.78"></a><span id="l38.78">     let calId = this.calId;</span>
<a href="#l38.79"></a><span id="l38.79" class="difflineat">@@ -619,26 +620,25 @@ calWcapCalendar.prototype.tunnelXProps =</span>
<a href="#l38.80"></a><span id="l38.80">             }</span>
<a href="#l38.81"></a><span id="l38.81">         } catch (exc) {</span>
<a href="#l38.82"></a><span id="l38.82">             logError(exc, this);</span>
<a href="#l38.83"></a><span id="l38.83">         }</span>
<a href="#l38.84"></a><span id="l38.84">     }</span>
<a href="#l38.85"></a><span id="l38.85"> };</span>
<a href="#l38.86"></a><span id="l38.86"> </span>
<a href="#l38.87"></a><span id="l38.87"> calWcapCalendar.prototype.adoptItem = function(item, listener) {</span>
<a href="#l38.88"></a><span id="l38.88" class="difflineminus">-    let self = this;</span>
<a href="#l38.89"></a><span id="l38.89">     let request = new calWcapRequest(</span>
<a href="#l38.90"></a><span id="l38.90" class="difflineminus">-        function(oprequest, err, newItem) {</span>
<a href="#l38.91"></a><span id="l38.91" class="difflineminus">-            self.notifyOperationComplete(listener,</span>
<a href="#l38.92"></a><span id="l38.92" class="difflineplus">+        (oprequest, err, newItem) =&gt; {</span>
<a href="#l38.93"></a><span id="l38.93" class="difflineplus">+            this.notifyOperationComplete(listener,</span>
<a href="#l38.94"></a><span id="l38.94">                                          getResultCode(err),</span>
<a href="#l38.95"></a><span id="l38.95">                                          calIOperationListener.ADD,</span>
<a href="#l38.96"></a><span id="l38.96">                                          err ? item.id : newItem.id,</span>
<a href="#l38.97"></a><span id="l38.97">                                          err ? err : newItem);</span>
<a href="#l38.98"></a><span id="l38.98" class="difflineminus">-            if (!err &amp;&amp; self == self.superCalendar) {</span>
<a href="#l38.99"></a><span id="l38.99" class="difflineminus">-                self.notifyObservers(&quot;onAddItem&quot;, [newItem]);</span>
<a href="#l38.100"></a><span id="l38.100" class="difflineplus">+            if (!err &amp;&amp; this == this.superCalendar) {</span>
<a href="#l38.101"></a><span id="l38.101" class="difflineplus">+                this.notifyObservers(&quot;onAddItem&quot;, [newItem]);</span>
<a href="#l38.102"></a><span id="l38.102">             }</span>
<a href="#l38.103"></a><span id="l38.103">         },</span>
<a href="#l38.104"></a><span id="l38.104">         log(&quot;adoptItem() call: &quot; + item.title, this));</span>
<a href="#l38.105"></a><span id="l38.105"> </span>
<a href="#l38.106"></a><span id="l38.106">     try {</span>
<a href="#l38.107"></a><span id="l38.107">         this.storeItem(true /* bAddItem */, item, null, request);</span>
<a href="#l38.108"></a><span id="l38.108">     } catch (exc) {</span>
<a href="#l38.109"></a><span id="l38.109">         request.execRespFunc(exc);</span>
<a href="#l38.110"></a><span id="l38.110" class="difflineat">@@ -646,25 +646,24 @@ calWcapCalendar.prototype.adoptItem = fu</span>
<a href="#l38.111"></a><span id="l38.111">     return request;</span>
<a href="#l38.112"></a><span id="l38.112"> };</span>
<a href="#l38.113"></a><span id="l38.113"> </span>
<a href="#l38.114"></a><span id="l38.114"> calWcapCalendar.prototype.addItem = function(item, listener) {</span>
<a href="#l38.115"></a><span id="l38.115">     this.adoptItem(item.clone(), listener);</span>
<a href="#l38.116"></a><span id="l38.116"> };</span>
<a href="#l38.117"></a><span id="l38.117"> </span>
<a href="#l38.118"></a><span id="l38.118"> calWcapCalendar.prototype.modifyItem = function(newItem, oldItem, listener) {</span>
<a href="#l38.119"></a><span id="l38.119" class="difflineminus">-    let self = this;</span>
<a href="#l38.120"></a><span id="l38.120">     let request = new calWcapRequest(</span>
<a href="#l38.121"></a><span id="l38.121" class="difflineminus">-        function(oprequest, err, item) {</span>
<a href="#l38.122"></a><span id="l38.122" class="difflineminus">-            self.notifyOperationComplete(listener,</span>
<a href="#l38.123"></a><span id="l38.123" class="difflineplus">+        (oprequest, err, item) =&gt; {</span>
<a href="#l38.124"></a><span id="l38.124" class="difflineplus">+            this.notifyOperationComplete(listener,</span>
<a href="#l38.125"></a><span id="l38.125">                                          getResultCode(err),</span>
<a href="#l38.126"></a><span id="l38.126">                                          calIOperationListener.MODIFY,</span>
<a href="#l38.127"></a><span id="l38.127">                                          newItem.id, err ? err : item);</span>
<a href="#l38.128"></a><span id="l38.128" class="difflineminus">-            if (!err &amp;&amp; self == self.superCalendar) {</span>
<a href="#l38.129"></a><span id="l38.129" class="difflineminus">-                self.notifyObservers(&quot;onModifyItem&quot;, [item, oldItem]);</span>
<a href="#l38.130"></a><span id="l38.130" class="difflineplus">+            if (!err &amp;&amp; this == this.superCalendar) {</span>
<a href="#l38.131"></a><span id="l38.131" class="difflineplus">+                this.notifyObservers(&quot;onModifyItem&quot;, [item, oldItem]);</span>
<a href="#l38.132"></a><span id="l38.132">             }</span>
<a href="#l38.133"></a><span id="l38.133">         },</span>
<a href="#l38.134"></a><span id="l38.134">         log(&quot;modifyItem() call: &quot; + newItem.id, this));</span>
<a href="#l38.135"></a><span id="l38.135"> </span>
<a href="#l38.136"></a><span id="l38.136">     try {</span>
<a href="#l38.137"></a><span id="l38.137">         if (!newItem.id) {</span>
<a href="#l38.138"></a><span id="l38.138">             throw new Components.Exception(&quot;new item has no id!&quot;);</span>
<a href="#l38.139"></a><span id="l38.139">         }</span>
<a href="#l38.140"></a><span id="l38.140" class="difflineat">@@ -673,18 +672,17 @@ calWcapCalendar.prototype.modifyItem = f</span>
<a href="#l38.141"></a><span id="l38.141">             // Due to a cs bug, EXDATEs cannot be passed with store, thus make a two-step delete then store.</span>
<a href="#l38.142"></a><span id="l38.142">             // First check if EXDATEs are passed or have been modified:</span>
<a href="#l38.143"></a><span id="l38.143">             let exdates = {};</span>
<a href="#l38.144"></a><span id="l38.144">             this.getRecurrenceParams(newItem, {}, {}, {}, exdates);</span>
<a href="#l38.145"></a><span id="l38.145">             if (oldItem) {</span>
<a href="#l38.146"></a><span id="l38.146">                 let exdates_ = {};</span>
<a href="#l38.147"></a><span id="l38.147">                 this.getRecurrenceParams(oldItem_, {}, {}, {}, exdates_);</span>
<a href="#l38.148"></a><span id="l38.148">                 // only use added elements</span>
<a href="#l38.149"></a><span id="l38.149" class="difflineminus">-                exdates.value = exdates.value.filter(</span>
<a href="#l38.150"></a><span id="l38.150" class="difflineminus">-                    function(elem) { return !exdates_.value.some(function(elem_) { return elem_ == elem; }); });</span>
<a href="#l38.151"></a><span id="l38.151" class="difflineplus">+                exdates.value = exdates.value.filter(elem =&gt; !exdates_.value.some(elem_ =&gt; elem_ == elem));</span>
<a href="#l38.152"></a><span id="l38.152">             } // else in case no oldItem is passed, nevertheless try to delete the EXDATEs</span>
<a href="#l38.153"></a><span id="l38.153">             if (exdates.value.length &gt; 0) {</span>
<a href="#l38.154"></a><span id="l38.154">                 let params = &quot;&amp;uid=&quot;;</span>
<a href="#l38.155"></a><span id="l38.155">                 // all deletes on the same item:</span>
<a href="#l38.156"></a><span id="l38.156">                 for (let i = exdates.value.length; i--;) {</span>
<a href="#l38.157"></a><span id="l38.157">                     params += encodeURIComponent(newItem.id);</span>
<a href="#l38.158"></a><span id="l38.158">                     if (i &gt; 0) {</span>
<a href="#l38.159"></a><span id="l38.159">                         params += &quot;;&quot;;</span>
<a href="#l38.160"></a><span id="l38.160" class="difflineat">@@ -696,26 +694,26 @@ calWcapCalendar.prototype.modifyItem = f</span>
<a href="#l38.161"></a><span id="l38.161">                 if (!orgCalId || (orgCalId != this.calId)) {</span>
<a href="#l38.162"></a><span id="l38.162">                     // item does not belong to this user, so don't notify:</span>
<a href="#l38.163"></a><span id="l38.163">                     params += &quot;&amp;smtp=0&amp;smtpNotify=0&amp;notify=0&quot;;</span>
<a href="#l38.164"></a><span id="l38.164">                 }</span>
<a href="#l38.165"></a><span id="l38.165">                 params += &quot;&amp;fmt-out=text%2Fxml&quot;;</span>
<a href="#l38.166"></a><span id="l38.166"> </span>
<a href="#l38.167"></a><span id="l38.167">                 request.lockPending();</span>
<a href="#l38.168"></a><span id="l38.168">                 this.issueNetworkRequest(request,</span>
<a href="#l38.169"></a><span id="l38.169" class="difflineminus">-                                         function(err, xml) {</span>
<a href="#l38.170"></a><span id="l38.170" class="difflineplus">+                                         (err, xml) =&gt; {</span>
<a href="#l38.171"></a><span id="l38.171">                                              try {</span>
<a href="#l38.172"></a><span id="l38.172">                                                  // ignore any error and continue storing the item:</span>
<a href="#l38.173"></a><span id="l38.173">                                                  if (LOG_LEVEL &gt; 0) {</span>
<a href="#l38.174"></a><span id="l38.174">                                                      log(&quot;modifyItem EXDATEs: &quot; +</span>
<a href="#l38.175"></a><span id="l38.175" class="difflineminus">-                                                         (xml ? getWcapRequestStatusString(xml) : &quot;failed!&quot;), self);</span>
<a href="#l38.176"></a><span id="l38.176" class="difflineplus">+                                                         (xml ? getWcapRequestStatusString(xml) : &quot;failed!&quot;), this);</span>
<a href="#l38.177"></a><span id="l38.177">                                                  }</span>
<a href="#l38.178"></a><span id="l38.178">                                                  // invalidate cached results:</span>
<a href="#l38.179"></a><span id="l38.179" class="difflineminus">-                                                 delete self.m_cachedResults;</span>
<a href="#l38.180"></a><span id="l38.180" class="difflineminus">-                                                 self.storeItem(false /* bAddItem */, newItem, oldItem_, request);</span>
<a href="#l38.181"></a><span id="l38.181" class="difflineplus">+                                                 delete this.m_cachedResults;</span>
<a href="#l38.182"></a><span id="l38.182" class="difflineplus">+                                                 this.storeItem(false /* bAddItem */, newItem, oldItem_, request);</span>
<a href="#l38.183"></a><span id="l38.183">                                              } finally {</span>
<a href="#l38.184"></a><span id="l38.184">                                                  request.unlockPending();</span>
<a href="#l38.185"></a><span id="l38.185">                                              }</span>
<a href="#l38.186"></a><span id="l38.186">                                          },</span>
<a href="#l38.187"></a><span id="l38.187">                                          stringToXml, isEvent(newItem) ? &quot;deleteevents_by_id&quot; : &quot;deletetodos_by_id&quot;,</span>
<a href="#l38.188"></a><span id="l38.188">                                          params, calIWcapCalendar.AC_COMP_WRITE);</span>
<a href="#l38.189"></a><span id="l38.189">                 return request;</span>
<a href="#l38.190"></a><span id="l38.190">             }</span>
<a href="#l38.191"></a><span id="l38.191" class="difflineat">@@ -726,26 +724,25 @@ calWcapCalendar.prototype.modifyItem = f</span>
<a href="#l38.192"></a><span id="l38.192">         this.storeItem(false /* bAddItem */, newItem, oldItem_, request);</span>
<a href="#l38.193"></a><span id="l38.193">     } catch (exc) {</span>
<a href="#l38.194"></a><span id="l38.194">         request.execRespFunc(exc);</span>
<a href="#l38.195"></a><span id="l38.195">     }</span>
<a href="#l38.196"></a><span id="l38.196">     return request;</span>
<a href="#l38.197"></a><span id="l38.197"> };</span>
<a href="#l38.198"></a><span id="l38.198"> </span>
<a href="#l38.199"></a><span id="l38.199"> calWcapCalendar.prototype.deleteItem = function(item, listener) {</span>
<a href="#l38.200"></a><span id="l38.200" class="difflineminus">-    let self = this;</span>
<a href="#l38.201"></a><span id="l38.201">     let request = new calWcapRequest(</span>
<a href="#l38.202"></a><span id="l38.202" class="difflineminus">-        function(oprequest, err) {</span>
<a href="#l38.203"></a><span id="l38.203" class="difflineplus">+        (oprequest, err) =&gt; {</span>
<a href="#l38.204"></a><span id="l38.204">             // xxx todo: need to notify about each deleted item if multiple?</span>
<a href="#l38.205"></a><span id="l38.205" class="difflineminus">-            self.notifyOperationComplete(listener,</span>
<a href="#l38.206"></a><span id="l38.206" class="difflineplus">+            this.notifyOperationComplete(listener,</span>
<a href="#l38.207"></a><span id="l38.207">                                          getResultCode(err),</span>
<a href="#l38.208"></a><span id="l38.208">                                          calIOperationListener.DELETE,</span>
<a href="#l38.209"></a><span id="l38.209">                                          item.id, err ? err : item);</span>
<a href="#l38.210"></a><span id="l38.210" class="difflineminus">-            if (!err &amp;&amp; self == self.superCalendar) {</span>
<a href="#l38.211"></a><span id="l38.211" class="difflineminus">-                self.notifyObservers(&quot;onDeleteItem&quot;, [item]);</span>
<a href="#l38.212"></a><span id="l38.212" class="difflineplus">+            if (!err &amp;&amp; this == this.superCalendar) {</span>
<a href="#l38.213"></a><span id="l38.213" class="difflineplus">+                this.notifyObservers(&quot;onDeleteItem&quot;, [item]);</span>
<a href="#l38.214"></a><span id="l38.214">             }</span>
<a href="#l38.215"></a><span id="l38.215">         },</span>
<a href="#l38.216"></a><span id="l38.216">         log(&quot;deleteItem() call: &quot; + item.id, this));</span>
<a href="#l38.217"></a><span id="l38.217"> </span>
<a href="#l38.218"></a><span id="l38.218">     try {</span>
<a href="#l38.219"></a><span id="l38.219">         if (!item.id) {</span>
<a href="#l38.220"></a><span id="l38.220">             throw new Components.Exception(&quot;no item id!&quot;);</span>
<a href="#l38.221"></a><span id="l38.221">         }</span>
<a href="#l38.222"></a><span id="l38.222" class="difflineat">@@ -761,24 +758,24 @@ calWcapCalendar.prototype.deleteItem = f</span>
<a href="#l38.223"></a><span id="l38.223">         if (!orgCalId || (orgCalId != this.calId)) {</span>
<a href="#l38.224"></a><span id="l38.224">             // item does not belong to this user, so don't notify:</span>
<a href="#l38.225"></a><span id="l38.225">             params += &quot;&amp;smtp=0&amp;smtpNotify=0&amp;notify=0&quot;;</span>
<a href="#l38.226"></a><span id="l38.226">         }</span>
<a href="#l38.227"></a><span id="l38.227"> </span>
<a href="#l38.228"></a><span id="l38.228">         params += &quot;&amp;fmt-out=text%2Fxml&quot;;</span>
<a href="#l38.229"></a><span id="l38.229"> </span>
<a href="#l38.230"></a><span id="l38.230">         this.issueNetworkRequest(request,</span>
<a href="#l38.231"></a><span id="l38.231" class="difflineminus">-                                 function(err, xml) {</span>
<a href="#l38.232"></a><span id="l38.232" class="difflineplus">+                                 (err, xml) =&gt; {</span>
<a href="#l38.233"></a><span id="l38.233">                                      if (err) {</span>
<a href="#l38.234"></a><span id="l38.234">                                          throw err;</span>
<a href="#l38.235"></a><span id="l38.235">                                      }</span>
<a href="#l38.236"></a><span id="l38.236">                                      // invalidate cached results:</span>
<a href="#l38.237"></a><span id="l38.237" class="difflineminus">-                                     delete self.m_cachedResults;</span>
<a href="#l38.238"></a><span id="l38.238" class="difflineplus">+                                     delete this.m_cachedResults;</span>
<a href="#l38.239"></a><span id="l38.239">                                      if (LOG_LEVEL &gt; 0) {</span>
<a href="#l38.240"></a><span id="l38.240" class="difflineminus">-                                         log(&quot;deleteItem(): &quot; + getWcapRequestStatusString(xml), self);</span>
<a href="#l38.241"></a><span id="l38.241" class="difflineplus">+                                         log(&quot;deleteItem(): &quot; + getWcapRequestStatusString(xml), this);</span>
<a href="#l38.242"></a><span id="l38.242">                                      }</span>
<a href="#l38.243"></a><span id="l38.243">                                  },</span>
<a href="#l38.244"></a><span id="l38.244">                                  stringToXml, isEvent(item) ? &quot;deleteevents_by_id&quot; : &quot;deletetodos_by_id&quot;,</span>
<a href="#l38.245"></a><span id="l38.245">                                  params, calIWcapCalendar.AC_COMP_WRITE);</span>
<a href="#l38.246"></a><span id="l38.246">     } catch (exc) {</span>
<a href="#l38.247"></a><span id="l38.247">         request.execRespFunc(exc);</span>
<a href="#l38.248"></a><span id="l38.248">     }</span>
<a href="#l38.249"></a><span id="l38.249">     return request;</span>
<a href="#l38.250"></a><span id="l38.250" class="difflineat">@@ -1016,25 +1013,24 @@ calWcapCalendar.prototype.parseItems = f</span>
<a href="#l38.251"></a><span id="l38.251"> </span>
<a href="#l38.252"></a><span id="l38.252">     if (LOG_LEVEL &gt; 1) {</span>
<a href="#l38.253"></a><span id="l38.253">         log(&quot;parseItems(): returning &quot; + items.length + &quot; items&quot;, this);</span>
<a href="#l38.254"></a><span id="l38.254">     }</span>
<a href="#l38.255"></a><span id="l38.255">     return items;</span>
<a href="#l38.256"></a><span id="l38.256"> };</span>
<a href="#l38.257"></a><span id="l38.257"> </span>
<a href="#l38.258"></a><span id="l38.258"> calWcapCalendar.prototype.getItem = function(id, listener) {</span>
<a href="#l38.259"></a><span id="l38.259" class="difflineminus">-    let self = this;</span>
<a href="#l38.260"></a><span id="l38.260">     let request = new calWcapRequest(</span>
<a href="#l38.261"></a><span id="l38.261" class="difflineminus">-        function(oprequest, err, item) {</span>
<a href="#l38.262"></a><span id="l38.262" class="difflineplus">+        (oprequest, err, item) =&gt; {</span>
<a href="#l38.263"></a><span id="l38.263">             if (checkErrorCode(err, calIWcapErrors.WCAP_FETCH_EVENTS_BY_ID_FAILED) ||</span>
<a href="#l38.264"></a><span id="l38.264">                 checkErrorCode(err, calIWcapErrors.WCAP_COMPONENT_NOT_FOUND)) {</span>
<a href="#l38.265"></a><span id="l38.265">                 // querying by id is a valid use case, even if no item is returned:</span>
<a href="#l38.266"></a><span id="l38.266">                 err = NS_OK;</span>
<a href="#l38.267"></a><span id="l38.267">             }</span>
<a href="#l38.268"></a><span id="l38.268" class="difflineminus">-            self.notifyOperationComplete(listener,</span>
<a href="#l38.269"></a><span id="l38.269" class="difflineplus">+            this.notifyOperationComplete(listener,</span>
<a href="#l38.270"></a><span id="l38.270">                                          getResultCode(err),</span>
<a href="#l38.271"></a><span id="l38.271">                                          calIOperationListener.GET,</span>
<a href="#l38.272"></a><span id="l38.272">                                          item ? item.id : null,</span>
<a href="#l38.273"></a><span id="l38.273">                                          err || item);</span>
<a href="#l38.274"></a><span id="l38.274">         },</span>
<a href="#l38.275"></a><span id="l38.275">         log(&quot;getItem() call: id=&quot; + id, this));</span>
<a href="#l38.276"></a><span id="l38.276"> </span>
<a href="#l38.277"></a><span id="l38.277">     try {</span>
<a href="#l38.278"></a><span id="l38.278" class="difflineat">@@ -1043,42 +1039,42 @@ calWcapCalendar.prototype.getItem = func</span>
<a href="#l38.279"></a><span id="l38.279">         }</span>
<a href="#l38.280"></a><span id="l38.280">         let params = &quot;&amp;relativealarm=1&amp;compressed=1&amp;recurring=1&quot;;</span>
<a href="#l38.281"></a><span id="l38.281">         params += &quot;&amp;emailorcalid=1&amp;fmt-out=text%2Fcalendar&amp;uid=&quot;;</span>
<a href="#l38.282"></a><span id="l38.282">         params += encodeURIComponent(id);</span>
<a href="#l38.283"></a><span id="l38.283"> </span>
<a href="#l38.284"></a><span id="l38.284">         // most common: try events first</span>
<a href="#l38.285"></a><span id="l38.285">         this.issueNetworkRequest(</span>
<a href="#l38.286"></a><span id="l38.286">             request,</span>
<a href="#l38.287"></a><span id="l38.287" class="difflineminus">-            function(err, eventRootComp) {</span>
<a href="#l38.288"></a><span id="l38.288" class="difflineminus">-                function notifyResult(rootComp) {</span>
<a href="#l38.289"></a><span id="l38.289" class="difflineminus">-                    let items = self.parseItems(rootComp, calICalendar.ITEM_FILTER_ALL_ITEMS, 0, null, null);</span>
<a href="#l38.290"></a><span id="l38.290" class="difflineplus">+            (err, eventRootComp) =&gt; {</span>
<a href="#l38.291"></a><span id="l38.291" class="difflineplus">+                let notifyResult = (rootComp) =&gt; {</span>
<a href="#l38.292"></a><span id="l38.292" class="difflineplus">+                    let items = this.parseItems(rootComp, calICalendar.ITEM_FILTER_ALL_ITEMS, 0, null, null);</span>
<a href="#l38.293"></a><span id="l38.293">                     if (items.length &lt; 1) {</span>
<a href="#l38.294"></a><span id="l38.294">                         throw new Components.Exception(&quot;no such item!&quot;);</span>
<a href="#l38.295"></a><span id="l38.295">                     }</span>
<a href="#l38.296"></a><span id="l38.296">                     if (items.length &gt; 1) {</span>
<a href="#l38.297"></a><span id="l38.297" class="difflineminus">-                        self.notifyError(NS_ERROR_UNEXPECTED,</span>
<a href="#l38.298"></a><span id="l38.298" class="difflineplus">+                        this.notifyError(NS_ERROR_UNEXPECTED,</span>
<a href="#l38.299"></a><span id="l38.299">                                          &quot;unexpected number of items: &quot; + items.length);</span>
<a href="#l38.300"></a><span id="l38.300">                     }</span>
<a href="#l38.301"></a><span id="l38.301">                     if (listener) {</span>
<a href="#l38.302"></a><span id="l38.302" class="difflineminus">-                        listener.onGetResult(self.superCalendar, NS_OK,</span>
<a href="#l38.303"></a><span id="l38.303" class="difflineminus">-                                             calIItemBase, log(&quot;getItem(): success. id=&quot; + id, self),</span>
<a href="#l38.304"></a><span id="l38.304" class="difflineplus">+                        listener.onGetResult(this.superCalendar, NS_OK,</span>
<a href="#l38.305"></a><span id="l38.305" class="difflineplus">+                                             calIItemBase, log(&quot;getItem(): success. id=&quot; + id, this),</span>
<a href="#l38.306"></a><span id="l38.306">                                              items.length, items);</span>
<a href="#l38.307"></a><span id="l38.307">                     }</span>
<a href="#l38.308"></a><span id="l38.308">                     request.execRespFunc(null, items[0]);</span>
<a href="#l38.309"></a><span id="l38.309" class="difflineminus">-                }</span>
<a href="#l38.310"></a><span id="l38.310" class="difflineplus">+                };</span>
<a href="#l38.311"></a><span id="l38.311">                 if (err) {</span>
<a href="#l38.312"></a><span id="l38.312">                     if (!checkErrorCode(err, calIWcapErrors.WCAP_FETCH_EVENTS_BY_ID_FAILED) &amp;&amp;</span>
<a href="#l38.313"></a><span id="l38.313">                         !checkErrorCode(err, calIWcapErrors.WCAP_COMPONENT_NOT_FOUND)) {</span>
<a href="#l38.314"></a><span id="l38.314">                         throw err;</span>
<a href="#l38.315"></a><span id="l38.315">                     }</span>
<a href="#l38.316"></a><span id="l38.316">                     // try todos:</span>
<a href="#l38.317"></a><span id="l38.317" class="difflineminus">-                    self.issueNetworkRequest(</span>
<a href="#l38.318"></a><span id="l38.318" class="difflineplus">+                    this.issueNetworkRequest(</span>
<a href="#l38.319"></a><span id="l38.319">                         request,</span>
<a href="#l38.320"></a><span id="l38.320" class="difflineminus">-                        function(fetcherr, todoRootComp) {</span>
<a href="#l38.321"></a><span id="l38.321" class="difflineplus">+                        (fetcherr, todoRootComp) =&gt; {</span>
<a href="#l38.322"></a><span id="l38.322">                             if (fetcherr) {</span>
<a href="#l38.323"></a><span id="l38.323">                                 throw fetcherr;</span>
<a href="#l38.324"></a><span id="l38.324">                             }</span>
<a href="#l38.325"></a><span id="l38.325">                             notifyResult(todoRootComp);</span>
<a href="#l38.326"></a><span id="l38.326">                         },</span>
<a href="#l38.327"></a><span id="l38.327">                         stringToIcal, &quot;fetchtodos_by_id&quot;, params, calIWcapCalendar.AC_COMP_READ);</span>
<a href="#l38.328"></a><span id="l38.328">                 } else {</span>
<a href="#l38.329"></a><span id="l38.329">                     notifyResult(eventRootComp);</span>
<a href="#l38.330"></a><span id="l38.330" class="difflineat">@@ -1126,21 +1122,20 @@ function getItemFilterParams(itemFilter)</span>
<a href="#l38.331"></a><span id="l38.331"> }</span>
<a href="#l38.332"></a><span id="l38.332"> </span>
<a href="#l38.333"></a><span id="l38.333"> calWcapCalendar.prototype.getItems = function(itemFilter, maxResults, rangeStart, rangeEnd, listener) {</span>
<a href="#l38.334"></a><span id="l38.334">     rangeStart = ensureDateTime(rangeStart);</span>
<a href="#l38.335"></a><span id="l38.335">     rangeEnd = ensureDateTime(rangeEnd);</span>
<a href="#l38.336"></a><span id="l38.336">     let zRangeStart = getIcalUTC(rangeStart);</span>
<a href="#l38.337"></a><span id="l38.337">     let zRangeEnd = getIcalUTC(rangeEnd);</span>
<a href="#l38.338"></a><span id="l38.338"> </span>
<a href="#l38.339"></a><span id="l38.339" class="difflineminus">-    let self = this;</span>
<a href="#l38.340"></a><span id="l38.340">     let request = new calWcapRequest(</span>
<a href="#l38.341"></a><span id="l38.341" class="difflineminus">-        function(oprequest, err, data) {</span>
<a href="#l38.342"></a><span id="l38.342" class="difflineminus">-            log(&quot;getItems() complete: &quot; + errorToString(err), self);</span>
<a href="#l38.343"></a><span id="l38.343" class="difflineminus">-            self.notifyOperationComplete(listener,</span>
<a href="#l38.344"></a><span id="l38.344" class="difflineplus">+        (oprequest, err, data) =&gt; {</span>
<a href="#l38.345"></a><span id="l38.345" class="difflineplus">+            log(&quot;getItems() complete: &quot; + errorToString(err), this);</span>
<a href="#l38.346"></a><span id="l38.346" class="difflineplus">+            this.notifyOperationComplete(listener,</span>
<a href="#l38.347"></a><span id="l38.347">                                          getResultCode(err),</span>
<a href="#l38.348"></a><span id="l38.348">                                          calIOperationListener.GET,</span>
<a href="#l38.349"></a><span id="l38.349">                                          null,</span>
<a href="#l38.350"></a><span id="l38.350">                                          err);</span>
<a href="#l38.351"></a><span id="l38.351">         },</span>
<a href="#l38.352"></a><span id="l38.352">         log(&quot;getItems():\n\titemFilter=0x&quot; + itemFilter.toString(0x10) +</span>
<a href="#l38.353"></a><span id="l38.353">             &quot;,\n\tmaxResults=&quot; + maxResults +</span>
<a href="#l38.354"></a><span id="l38.354">             &quot;,\n\trangeStart=&quot; + zRangeStart +</span>
<a href="#l38.355"></a><span id="l38.355" class="difflineat">@@ -1184,136 +1179,135 @@ calWcapCalendar.prototype.getItems = fun</span>
<a href="#l38.356"></a><span id="l38.356">         if (maxResults &gt; 0) {</span>
<a href="#l38.357"></a><span id="l38.357">             params += &quot;&amp;maxResults=&quot; + maxResults;</span>
<a href="#l38.358"></a><span id="l38.358">         }</span>
<a href="#l38.359"></a><span id="l38.359">         params += &quot;&amp;dtstart=&quot; + zRangeStart;</span>
<a href="#l38.360"></a><span id="l38.360">         params += &quot;&amp;dtend=&quot; + zRangeEnd;</span>
<a href="#l38.361"></a><span id="l38.361"> </span>
<a href="#l38.362"></a><span id="l38.362">         this.issueNetworkRequest(</span>
<a href="#l38.363"></a><span id="l38.363">             request,</span>
<a href="#l38.364"></a><span id="l38.364" class="difflineminus">-            function(err, icalRootComp) {</span>
<a href="#l38.365"></a><span id="l38.365" class="difflineplus">+            (err, icalRootComp) =&gt; {</span>
<a href="#l38.366"></a><span id="l38.366">                 if (err) {</span>
<a href="#l38.367"></a><span id="l38.367">                     if (checkErrorCode(err, calIWcapErrors.WCAP_ACCESS_DENIED_TO_CALENDAR)) {</span>
<a href="#l38.368"></a><span id="l38.368">                         // try free-busy times:</span>
<a href="#l38.369"></a><span id="l38.369">                         if (listener &amp;&amp;</span>
<a href="#l38.370"></a><span id="l38.370">                             (itemFilter &amp; calICalendar.ITEM_FILTER_TYPE_EVENT) &amp;&amp;</span>
<a href="#l38.371"></a><span id="l38.371">                             rangeStart &amp;&amp; rangeEnd) {</span>
<a href="#l38.372"></a><span id="l38.372">                             let freeBusyListener = { // calIGenericOperationListener:</span>
<a href="#l38.373"></a><span id="l38.373">                                 onResult: function(oprequest, result) {</span>
<a href="#l38.374"></a><span id="l38.374">                                     if (!Components.isSuccessCode(oprequest.status)) {</span>
<a href="#l38.375"></a><span id="l38.375">                                         throw oprequest.status;</span>
<a href="#l38.376"></a><span id="l38.376">                                     }</span>
<a href="#l38.377"></a><span id="l38.377">                                     let items = [];</span>
<a href="#l38.378"></a><span id="l38.378">                                     for (let entry of result) {</span>
<a href="#l38.379"></a><span id="l38.379">                                         let item = createEvent();</span>
<a href="#l38.380"></a><span id="l38.380">                                         item.id = g_busyPhantomItemUuidPrefix + getIcalUTC(entry.interval.start);</span>
<a href="#l38.381"></a><span id="l38.381" class="difflineminus">-                                        item.calendar = self.superCalendar;</span>
<a href="#l38.382"></a><span id="l38.382" class="difflineplus">+                                        item.calendar = this.superCalendar;</span>
<a href="#l38.383"></a><span id="l38.383">                                         item.title = g_busyItemTitle;</span>
<a href="#l38.384"></a><span id="l38.384">                                         item.startDate = entry.interval.start;</span>
<a href="#l38.385"></a><span id="l38.385">                                         item.endDate = entry.interval.end;</span>
<a href="#l38.386"></a><span id="l38.386">                                         item.makeImmutable();</span>
<a href="#l38.387"></a><span id="l38.387">                                         items.push(item);</span>
<a href="#l38.388"></a><span id="l38.388">                                     }</span>
<a href="#l38.389"></a><span id="l38.389" class="difflineminus">-                                    listener.onGetResult(self.superCalendar, NS_OK, calIItemBase,</span>
<a href="#l38.390"></a><span id="l38.390" class="difflineplus">+                                    listener.onGetResult(this.superCalendar, NS_OK, calIItemBase,</span>
<a href="#l38.391"></a><span id="l38.391">                                                          &quot;getItems()/free-busy&quot;, items.length, items);</span>
<a href="#l38.392"></a><span id="l38.392" class="difflineminus">-                                }</span>
<a href="#l38.393"></a><span id="l38.393" class="difflineplus">+                                }.bind(this)</span>
<a href="#l38.394"></a><span id="l38.394">                             };</span>
<a href="#l38.395"></a><span id="l38.395">                             request.attachSubRequest(</span>
<a href="#l38.396"></a><span id="l38.396" class="difflineminus">-                                self.session.getFreeBusyIntervals(</span>
<a href="#l38.397"></a><span id="l38.397" class="difflineminus">-                                    self.calId, rangeStart, rangeEnd, calIFreeBusyInterval.BUSY_ALL,</span>
<a href="#l38.398"></a><span id="l38.398" class="difflineplus">+                                this.session.getFreeBusyIntervals(</span>
<a href="#l38.399"></a><span id="l38.399" class="difflineplus">+                                    this.calId, rangeStart, rangeEnd, calIFreeBusyInterval.BUSY_ALL,</span>
<a href="#l38.400"></a><span id="l38.400">                                     freeBusyListener));</span>
<a href="#l38.401"></a><span id="l38.401">                         }</span>
<a href="#l38.402"></a><span id="l38.402">                     } else {</span>
<a href="#l38.403"></a><span id="l38.403">                         throw err;</span>
<a href="#l38.404"></a><span id="l38.404">                     }</span>
<a href="#l38.405"></a><span id="l38.405">                 } else if (listener) {</span>
<a href="#l38.406"></a><span id="l38.406" class="difflineminus">-                    let items = self.parseItems(</span>
<a href="#l38.407"></a><span id="l38.407" class="difflineplus">+                    let items = this.parseItems(</span>
<a href="#l38.408"></a><span id="l38.408">                         icalRootComp, itemFilter, maxResults,</span>
<a href="#l38.409"></a><span id="l38.409">                         rangeStart, rangeEnd);</span>
<a href="#l38.410"></a><span id="l38.410"> </span>
<a href="#l38.411"></a><span id="l38.411">                     if (CACHE_LAST_RESULTS &gt; 0) {</span>
<a href="#l38.412"></a><span id="l38.412">                         // auto invalidate after X minutes:</span>
<a href="#l38.413"></a><span id="l38.413" class="difflineminus">-                        if (!self.m_cachedResultsTimer) {</span>
<a href="#l38.414"></a><span id="l38.414" class="difflineplus">+                        if (!this.m_cachedResultsTimer) {</span>
<a href="#l38.415"></a><span id="l38.415">                             let callback = {</span>
<a href="#l38.416"></a><span id="l38.416">                                 notify: function(timer) {</span>
<a href="#l38.417"></a><span id="l38.417" class="difflineminus">-                                    if (!self.m_cachedResults) {</span>
<a href="#l38.418"></a><span id="l38.418" class="difflineplus">+                                    if (!this.m_cachedResults) {</span>
<a href="#l38.419"></a><span id="l38.419">                                         return;</span>
<a href="#l38.420"></a><span id="l38.420">                                     }</span>
<a href="#l38.421"></a><span id="l38.421">                                     let now = (new Date()).getTime();</span>
<a href="#l38.422"></a><span id="l38.422">                                     // sort out old entries:</span>
<a href="#l38.423"></a><span id="l38.423">                                     let entries = [];</span>
<a href="#l38.424"></a><span id="l38.424" class="difflineminus">-                                    for (let i = 0; i &lt; self.m_cachedResults.length; ++i) {</span>
<a href="#l38.425"></a><span id="l38.425" class="difflineminus">-                                        let entry = self.m_cachedResults[i];</span>
<a href="#l38.426"></a><span id="l38.426" class="difflineplus">+                                    for (let i = 0; i &lt; this.m_cachedResults.length; ++i) {</span>
<a href="#l38.427"></a><span id="l38.427" class="difflineplus">+                                        let entry = this.m_cachedResults[i];</span>
<a href="#l38.428"></a><span id="l38.428">                                         if ((now - entry.stamp) &lt; (CACHE_LAST_RESULTS_INVALIDATE * 1000)) {</span>
<a href="#l38.429"></a><span id="l38.429">                                             entries.push(entry);</span>
<a href="#l38.430"></a><span id="l38.430">                                         } else {</span>
<a href="#l38.431"></a><span id="l38.431">                                             log(&quot;invalidating cached entry:\n\trangeStart=&quot; +</span>
<a href="#l38.432"></a><span id="l38.432">                                                 getIcalUTC(entry.rangeStart) + &quot;\n\trangeEnd=&quot; +</span>
<a href="#l38.433"></a><span id="l38.433" class="difflineminus">-                                                getIcalUTC(entry.rangeEnd), self);</span>
<a href="#l38.434"></a><span id="l38.434" class="difflineplus">+                                                getIcalUTC(entry.rangeEnd), this);</span>
<a href="#l38.435"></a><span id="l38.435">                                         }</span>
<a href="#l38.436"></a><span id="l38.436">                                     }</span>
<a href="#l38.437"></a><span id="l38.437" class="difflineminus">-                                    self.m_cachedResults = entries;</span>
<a href="#l38.438"></a><span id="l38.438" class="difflineminus">-                                }</span>
<a href="#l38.439"></a><span id="l38.439" class="difflineplus">+                                    this.m_cachedResults = entries;</span>
<a href="#l38.440"></a><span id="l38.440" class="difflineplus">+                                }.bind(this)</span>
<a href="#l38.441"></a><span id="l38.441">                             };</span>
<a href="#l38.442"></a><span id="l38.442">                             // sort out freq:</span>
<a href="#l38.443"></a><span id="l38.443">                             let freq = Math.min(20, // default: 20secs</span>
<a href="#l38.444"></a><span id="l38.444">                                                 Math.max(1, CACHE_LAST_RESULTS_INVALIDATE));</span>
<a href="#l38.445"></a><span id="l38.445" class="difflineminus">-                            log(&quot;cached results sort out timer freq: &quot; + freq, self);</span>
<a href="#l38.446"></a><span id="l38.446" class="difflineminus">-                            self.m_cachedResultsTimer = Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l38.447"></a><span id="l38.447" class="difflineplus">+                            log(&quot;cached results sort out timer freq: &quot; + freq, this);</span>
<a href="#l38.448"></a><span id="l38.448" class="difflineplus">+                            this.m_cachedResultsTimer = Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l38.449"></a><span id="l38.449">                                                                   .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l38.450"></a><span id="l38.450" class="difflineminus">-                            self.m_cachedResultsTimer.initWithCallback(callback, freq * 1000,</span>
<a href="#l38.451"></a><span id="l38.451" class="difflineplus">+                            this.m_cachedResultsTimer.initWithCallback(callback, freq * 1000,</span>
<a href="#l38.452"></a><span id="l38.452">                                                                        Components.interfaces.nsITimer.TYPE_REPEATING_SLACK);</span>
<a href="#l38.453"></a><span id="l38.453">                         }</span>
<a href="#l38.454"></a><span id="l38.454" class="difflineminus">-                        if (!self.m_cachedResults) {</span>
<a href="#l38.455"></a><span id="l38.455" class="difflineminus">-                            self.m_cachedResults = [];</span>
<a href="#l38.456"></a><span id="l38.456" class="difflineplus">+                        if (!this.m_cachedResults) {</span>
<a href="#l38.457"></a><span id="l38.457" class="difflineplus">+                            this.m_cachedResults = [];</span>
<a href="#l38.458"></a><span id="l38.458">                         }</span>
<a href="#l38.459"></a><span id="l38.459">                         let cacheEntry = {</span>
<a href="#l38.460"></a><span id="l38.460">                             stamp: (new Date()).getTime(),</span>
<a href="#l38.461"></a><span id="l38.461">                             itemFilter: itemFilter,</span>
<a href="#l38.462"></a><span id="l38.462">                             rangeStart: (rangeStart ? rangeStart.clone() : null),</span>
<a href="#l38.463"></a><span id="l38.463">                             rangeEnd: (rangeEnd ? rangeEnd.clone() : null),</span>
<a href="#l38.464"></a><span id="l38.464">                             results: items</span>
<a href="#l38.465"></a><span id="l38.465">                         };</span>
<a href="#l38.466"></a><span id="l38.466" class="difflineminus">-                        self.m_cachedResults.unshift(cacheEntry);</span>
<a href="#l38.467"></a><span id="l38.467" class="difflineminus">-                        if (self.m_cachedResults.length &gt; CACHE_LAST_RESULTS) {</span>
<a href="#l38.468"></a><span id="l38.468" class="difflineminus">-                            self.m_cachedResults.length = CACHE_LAST_RESULTS;</span>
<a href="#l38.469"></a><span id="l38.469" class="difflineplus">+                        this.m_cachedResults.unshift(cacheEntry);</span>
<a href="#l38.470"></a><span id="l38.470" class="difflineplus">+                        if (this.m_cachedResults.length &gt; CACHE_LAST_RESULTS) {</span>
<a href="#l38.471"></a><span id="l38.471" class="difflineplus">+                            this.m_cachedResults.length = CACHE_LAST_RESULTS;</span>
<a href="#l38.472"></a><span id="l38.472">                         }</span>
<a href="#l38.473"></a><span id="l38.473">                     }</span>
<a href="#l38.474"></a><span id="l38.474"> </span>
<a href="#l38.475"></a><span id="l38.475" class="difflineminus">-                    listener.onGetResult(self.superCalendar, NS_OK, calIItemBase, &quot;getItems()&quot;, items.length, items);</span>
<a href="#l38.476"></a><span id="l38.476" class="difflineplus">+                    listener.onGetResult(this.superCalendar, NS_OK, calIItemBase, &quot;getItems()&quot;, items.length, items);</span>
<a href="#l38.477"></a><span id="l38.477">                 }</span>
<a href="#l38.478"></a><span id="l38.478">             },</span>
<a href="#l38.479"></a><span id="l38.479">             stringToIcal, &quot;fetchcomponents_by_range&quot;, params, calIWcapCalendar.AC_COMP_READ);</span>
<a href="#l38.480"></a><span id="l38.480">     } catch (exc) {</span>
<a href="#l38.481"></a><span id="l38.481">         request.execRespFunc(exc);</span>
<a href="#l38.482"></a><span id="l38.482">     }</span>
<a href="#l38.483"></a><span id="l38.483">     return request;</span>
<a href="#l38.484"></a><span id="l38.484"> };</span>
<a href="#l38.485"></a><span id="l38.485"> </span>
<a href="#l38.486"></a><span id="l38.486"> calWcapCalendar.prototype.offlineStorage = null;</span>
<a href="#l38.487"></a><span id="l38.487"> </span>
<a href="#l38.488"></a><span id="l38.488"> calWcapCalendar.prototype.resetLog = function() {</span>
<a href="#l38.489"></a><span id="l38.489">     this.deleteProperty(&quot;replay.last_stamp&quot;);</span>
<a href="#l38.490"></a><span id="l38.490"> };</span>
<a href="#l38.491"></a><span id="l38.491"> </span>
<a href="#l38.492"></a><span id="l38.492"> calWcapCalendar.prototype.replayChangesOn = function(listener) {</span>
<a href="#l38.493"></a><span id="l38.493" class="difflineminus">-    let self = this;</span>
<a href="#l38.494"></a><span id="l38.494">     let itemFilter = calICalendar.ITEM_FILTER_ALL_ITEMS;</span>
<a href="#l38.495"></a><span id="l38.495">     let dtFrom = getDatetimeFromIcalString(this.getProperty(&quot;replay.last_stamp&quot;));</span>
<a href="#l38.496"></a><span id="l38.496">     let now = getTime(); // new stamp for this sync</span>
<a href="#l38.497"></a><span id="l38.497"> </span>
<a href="#l38.498"></a><span id="l38.498">     let request_ = new calWcapRequest(</span>
<a href="#l38.499"></a><span id="l38.499" class="difflineminus">-        function(request, err) {</span>
<a href="#l38.500"></a><span id="l38.500" class="difflineplus">+        (request, err) =&gt; {</span>
<a href="#l38.501"></a><span id="l38.501">             if (err) {</span>
<a href="#l38.502"></a><span id="l38.502">                 logError(&quot;error replaying changes: &quot; + errorToString(err));</span>
<a href="#l38.503"></a><span id="l38.503" class="difflineminus">-                self.notifyError(err);</span>
<a href="#l38.504"></a><span id="l38.504" class="difflineplus">+                this.notifyError(err);</span>
<a href="#l38.505"></a><span id="l38.505">             } else {</span>
<a href="#l38.506"></a><span id="l38.506" class="difflineminus">-                log(&quot;replay succeeded.&quot;, self);</span>
<a href="#l38.507"></a><span id="l38.507" class="difflineminus">-                self.setProperty(&quot;replay.last_stamp&quot;, getIcalUTC(now));</span>
<a href="#l38.508"></a><span id="l38.508" class="difflineminus">-                log(&quot;new replay stamp: &quot; + getIcalUTC(now), self);</span>
<a href="#l38.509"></a><span id="l38.509" class="difflineplus">+                log(&quot;replay succeeded.&quot;, this);</span>
<a href="#l38.510"></a><span id="l38.510" class="difflineplus">+                this.setProperty(&quot;replay.last_stamp&quot;, getIcalUTC(now));</span>
<a href="#l38.511"></a><span id="l38.511" class="difflineplus">+                log(&quot;new replay stamp: &quot; + getIcalUTC(now), this);</span>
<a href="#l38.512"></a><span id="l38.512">             }</span>
<a href="#l38.513"></a><span id="l38.513">             if (listener) {</span>
<a href="#l38.514"></a><span id="l38.514">                 listener.onResult(request, null);</span>
<a href="#l38.515"></a><span id="l38.515">             }</span>
<a href="#l38.516"></a><span id="l38.516">         },</span>
<a href="#l38.517"></a><span id="l38.517">         log(&quot;replayChangesOn():\n\titemFilter=0x&quot; + itemFilter.toString(0x10) +</span>
<a href="#l38.518"></a><span id="l38.518">             &quot;\n\tdtFrom=&quot; + getIcalUTC(dtFrom), this));</span>
<a href="#l38.519"></a><span id="l38.519"> </span>
<a href="#l38.520"></a><span id="l38.520" class="difflineat">@@ -1323,95 +1317,95 @@ calWcapCalendar.prototype.replayChangesO</span>
<a href="#l38.521"></a><span id="l38.521">             onGetResult: function() {},</span>
<a href="#l38.522"></a><span id="l38.522">             onOperationComplete: function(aCalendar, status, opType, id, detail) {</span>
<a href="#l38.523"></a><span id="l38.523">                 if (!Components.isSuccessCode(status)) {</span>
<a href="#l38.524"></a><span id="l38.524">                     request.execRespFunc(status); // any error on writing breaks whole operation</span>
<a href="#l38.525"></a><span id="l38.525">                 }</span>
<a href="#l38.526"></a><span id="l38.526">             }</span>
<a href="#l38.527"></a><span id="l38.527">         };</span>
<a href="#l38.528"></a><span id="l38.528">         let request = new calWcapRequest(</span>
<a href="#l38.529"></a><span id="l38.529" class="difflineminus">-            function(err, data) {</span>
<a href="#l38.530"></a><span id="l38.530" class="difflineplus">+            (err, data) =&gt; {</span>
<a href="#l38.531"></a><span id="l38.531">                 let modifiedIds = {};</span>
<a href="#l38.532"></a><span id="l38.532">                 for (let item of request.m_modifiedItems) {</span>
<a href="#l38.533"></a><span id="l38.533">                     let dtCreated = item.getProperty(&quot;CREATED&quot;);</span>
<a href="#l38.534"></a><span id="l38.534">                     let bAdd = !dtCreated || !dtFrom || dtCreated.compare(dtFrom) &gt;= 0;</span>
<a href="#l38.535"></a><span id="l38.535">                     modifiedIds[item.id] = true;</span>
<a href="#l38.536"></a><span id="l38.536">                     if (bAdd) {</span>
<a href="#l38.537"></a><span id="l38.537" class="difflineminus">-                        log(&quot;replayChangesOn(): new item &quot; + item.id, self);</span>
<a href="#l38.538"></a><span id="l38.538" class="difflineminus">-                        if (self.offlineStorage) {</span>
<a href="#l38.539"></a><span id="l38.539" class="difflineminus">-                            self.offlineStorage.addItem(item, writeListener);</span>
<a href="#l38.540"></a><span id="l38.540" class="difflineplus">+                        log(&quot;replayChangesOn(): new item &quot; + item.id, this);</span>
<a href="#l38.541"></a><span id="l38.541" class="difflineplus">+                        if (this.offlineStorage) {</span>
<a href="#l38.542"></a><span id="l38.542" class="difflineplus">+                            this.offlineStorage.addItem(item, writeListener);</span>
<a href="#l38.543"></a><span id="l38.543">                         }</span>
<a href="#l38.544"></a><span id="l38.544">                     } else {</span>
<a href="#l38.545"></a><span id="l38.545" class="difflineminus">-                        log(&quot;replayChangesOn(): modified item &quot; + item.id, self);</span>
<a href="#l38.546"></a><span id="l38.546" class="difflineminus">-                        if (self.offlineStorage) {</span>
<a href="#l38.547"></a><span id="l38.547" class="difflineminus">-                            self.modifyItem(item, null, writeListener);</span>
<a href="#l38.548"></a><span id="l38.548" class="difflineplus">+                        log(&quot;replayChangesOn(): modified item &quot; + item.id, this);</span>
<a href="#l38.549"></a><span id="l38.549" class="difflineplus">+                        if (this.offlineStorage) {</span>
<a href="#l38.550"></a><span id="l38.550" class="difflineplus">+                            this.modifyItem(item, null, writeListener);</span>
<a href="#l38.551"></a><span id="l38.551">                         }</span>
<a href="#l38.552"></a><span id="l38.552">                     }</span>
<a href="#l38.553"></a><span id="l38.553">                 }</span>
<a href="#l38.554"></a><span id="l38.554">                 for (let item of request.m_deletedItems) {</span>
<a href="#l38.555"></a><span id="l38.555">                     // don't delete anything that has been touched by lastmods:</span>
<a href="#l38.556"></a><span id="l38.556">                     if (modifiedIds[item.id]) {</span>
<a href="#l38.557"></a><span id="l38.557" class="difflineminus">-                        log(&quot;replayChangesOn(): skipping deletion of &quot; + item.id, self);</span>
<a href="#l38.558"></a><span id="l38.558" class="difflineplus">+                        log(&quot;replayChangesOn(): skipping deletion of &quot; + item.id, this);</span>
<a href="#l38.559"></a><span id="l38.559">                     } else if (isParent(item)) {</span>
<a href="#l38.560"></a><span id="l38.560" class="difflineminus">-                        log(&quot;replayChangesOn(): deleted item &quot; + item.id, self);</span>
<a href="#l38.561"></a><span id="l38.561" class="difflineminus">-                        if (self.offlineStorage) {</span>
<a href="#l38.562"></a><span id="l38.562" class="difflineminus">-                            self.offlineStorage.deleteItem(item, writeListener);</span>
<a href="#l38.563"></a><span id="l38.563" class="difflineplus">+                        log(&quot;replayChangesOn(): deleted item &quot; + item.id, this);</span>
<a href="#l38.564"></a><span id="l38.564" class="difflineplus">+                        if (this.offlineStorage) {</span>
<a href="#l38.565"></a><span id="l38.565" class="difflineplus">+                            this.offlineStorage.deleteItem(item, writeListener);</span>
<a href="#l38.566"></a><span id="l38.566">                         }</span>
<a href="#l38.567"></a><span id="l38.567">                     } else { // modify parent instead of</span>
<a href="#l38.568"></a><span id="l38.568">                              // straight-forward deleteItem(). WTF.</span>
<a href="#l38.569"></a><span id="l38.569">                         let parent = item.parentItem.clone();</span>
<a href="#l38.570"></a><span id="l38.570">                         parent.recurrenceInfo.removeOccurrenceAt(item.recurrenceId);</span>
<a href="#l38.571"></a><span id="l38.571" class="difflineminus">-                        log(&quot;replayChangesOn(): modified parent &quot; + parent.id, self);</span>
<a href="#l38.572"></a><span id="l38.572" class="difflineminus">-                        if (self.offlineStorage) {</span>
<a href="#l38.573"></a><span id="l38.573" class="difflineminus">-                            self.offlineStorage.modifyItem(parent, item, writeListener);</span>
<a href="#l38.574"></a><span id="l38.574" class="difflineplus">+                        log(&quot;replayChangesOn(): modified parent &quot; + parent.id, this);</span>
<a href="#l38.575"></a><span id="l38.575" class="difflineplus">+                        if (this.offlineStorage) {</span>
<a href="#l38.576"></a><span id="l38.576" class="difflineplus">+                            this.offlineStorage.modifyItem(parent, item, writeListener);</span>
<a href="#l38.577"></a><span id="l38.577">                         }</span>
<a href="#l38.578"></a><span id="l38.578">                     }</span>
<a href="#l38.579"></a><span id="l38.579">                 }</span>
<a href="#l38.580"></a><span id="l38.580">             }, &quot;replayChangesOn() netFinishedRespFunc&quot;);</span>
<a href="#l38.581"></a><span id="l38.581">         request_.attachSubRequest(request);</span>
<a href="#l38.582"></a><span id="l38.582"> </span>
<a href="#l38.583"></a><span id="l38.583">         // assure being logged in to calc server times:</span>
<a href="#l38.584"></a><span id="l38.584">         this.session.getSessionId(</span>
<a href="#l38.585"></a><span id="l38.585">             request,</span>
<a href="#l38.586"></a><span id="l38.586" class="difflineminus">-            function(err, sessionId) {</span>
<a href="#l38.587"></a><span id="l38.587" class="difflineplus">+            (err, sessionId) =&gt; {</span>
<a href="#l38.588"></a><span id="l38.588">                 try {</span>
<a href="#l38.589"></a><span id="l38.589">                     if (err) {</span>
<a href="#l38.590"></a><span id="l38.590">                         throw err;</span>
<a href="#l38.591"></a><span id="l38.591">                     }</span>
<a href="#l38.592"></a><span id="l38.592">                     let params = &quot;&amp;relativealarm=1&amp;compressed=1&amp;recurring=1&quot; +</span>
<a href="#l38.593"></a><span id="l38.593">                                  &quot;&amp;emailorcalid=1&amp;fmt-out=text%2Fcalendar&quot;;</span>
<a href="#l38.594"></a><span id="l38.594">                     if (dtFrom) {</span>
<a href="#l38.595"></a><span id="l38.595" class="difflineminus">-                        dtFrom = self.session.getServerTime(dtFrom);</span>
<a href="#l38.596"></a><span id="l38.596" class="difflineplus">+                        dtFrom = this.session.getServerTime(dtFrom);</span>
<a href="#l38.597"></a><span id="l38.597">                     }</span>
<a href="#l38.598"></a><span id="l38.598">                     params += &quot;&amp;dtstart=&quot; + getIcalUTC(dtFrom);</span>
<a href="#l38.599"></a><span id="l38.599" class="difflineminus">-                    params += &quot;&amp;dtend=&quot; + getIcalUTC(self.session.getServerTime(now));</span>
<a href="#l38.600"></a><span id="l38.600" class="difflineplus">+                    params += &quot;&amp;dtend=&quot; + getIcalUTC(this.session.getServerTime(now));</span>
<a href="#l38.601"></a><span id="l38.601"> </span>
<a href="#l38.602"></a><span id="l38.602" class="difflineminus">-                    log(&quot;replayChangesOn(): getting last modifications...&quot;, self);</span>
<a href="#l38.603"></a><span id="l38.603" class="difflineminus">-                    self.issueNetworkRequest(</span>
<a href="#l38.604"></a><span id="l38.604" class="difflineplus">+                    log(&quot;replayChangesOn(): getting last modifications...&quot;, this);</span>
<a href="#l38.605"></a><span id="l38.605" class="difflineplus">+                    this.issueNetworkRequest(</span>
<a href="#l38.606"></a><span id="l38.606">                         request,</span>
<a href="#l38.607"></a><span id="l38.607" class="difflineminus">-                        function(fetcherr, icalRootComp) {</span>
<a href="#l38.608"></a><span id="l38.608" class="difflineplus">+                        (fetcherr, icalRootComp) =&gt; {</span>
<a href="#l38.609"></a><span id="l38.609">                             if (fetcherr) {</span>
<a href="#l38.610"></a><span id="l38.610">                                 throw fetcherr;</span>
<a href="#l38.611"></a><span id="l38.611">                             }</span>
<a href="#l38.612"></a><span id="l38.612" class="difflineminus">-                            request.m_modifiedItems = self.parseItems(icalRootComp,</span>
<a href="#l38.613"></a><span id="l38.613" class="difflineplus">+                            request.m_modifiedItems = this.parseItems(icalRootComp,</span>
<a href="#l38.614"></a><span id="l38.614">                                                                       calICalendar.ITEM_FILTER_ALL_ITEMS,</span>
<a href="#l38.615"></a><span id="l38.615">                                                                       0, null, null);</span>
<a href="#l38.616"></a><span id="l38.616">                         },</span>
<a href="#l38.617"></a><span id="l38.617">                         stringToIcal, &quot;fetchcomponents_by_lastmod&quot;,</span>
<a href="#l38.618"></a><span id="l38.618">                         params + getItemFilterParams(itemFilter),</span>
<a href="#l38.619"></a><span id="l38.619">                         calIWcapCalendar.AC_COMP_READ);</span>
<a href="#l38.620"></a><span id="l38.620"> </span>
<a href="#l38.621"></a><span id="l38.621" class="difflineminus">-                    log(&quot;replayChangesOn(): getting deleted items...&quot;, self);</span>
<a href="#l38.622"></a><span id="l38.622" class="difflineminus">-                    self.issueNetworkRequest(</span>
<a href="#l38.623"></a><span id="l38.623" class="difflineplus">+                    log(&quot;replayChangesOn(): getting deleted items...&quot;, this);</span>
<a href="#l38.624"></a><span id="l38.624" class="difflineplus">+                    this.issueNetworkRequest(</span>
<a href="#l38.625"></a><span id="l38.625">                         request,</span>
<a href="#l38.626"></a><span id="l38.626" class="difflineminus">-                        function(fetcherr, icalRootComp) {</span>
<a href="#l38.627"></a><span id="l38.627" class="difflineplus">+                        (fetcherr, icalRootComp) =&gt; {</span>
<a href="#l38.628"></a><span id="l38.628">                             if (fetcherr) {</span>
<a href="#l38.629"></a><span id="l38.629">                                 throw fetcherr;</span>
<a href="#l38.630"></a><span id="l38.630">                             }</span>
<a href="#l38.631"></a><span id="l38.631" class="difflineminus">-                            request.m_deletedItems = self.parseItems(icalRootComp,</span>
<a href="#l38.632"></a><span id="l38.632" class="difflineplus">+                            request.m_deletedItems = this.parseItems(icalRootComp,</span>
<a href="#l38.633"></a><span id="l38.633">                                                                      calICalendar.ITEM_FILTER_ALL_ITEMS,</span>
<a href="#l38.634"></a><span id="l38.634">                                                                      0, null, null);</span>
<a href="#l38.635"></a><span id="l38.635">                         },</span>
<a href="#l38.636"></a><span id="l38.636">                         stringToIcal, &quot;fetch_deletedcomponents&quot;,</span>
<a href="#l38.637"></a><span id="l38.637">                         params + getItemFilterParams(itemFilter &amp; // only component types</span>
<a href="#l38.638"></a><span id="l38.638">                                                      calICalendar.ITEM_FILTER_TYPE_ALL),</span>
<a href="#l38.639"></a><span id="l38.639">                         calIWcapCalendar.AC_COMP_READ);</span>
<a href="#l38.640"></a><span id="l38.640">                 } catch (exc) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -90,45 +90,45 @@ calWcapRequest.prototype = {</span>
<a href="#l39.4"></a><span id="l39.4">         }</span>
<a href="#l39.5"></a><span id="l39.5">         ret += &quot;, isPending=&quot; + this.isPending;</span>
<a href="#l39.6"></a><span id="l39.6">         ret += &quot;, status=&quot; + errorToString(this.status);</span>
<a href="#l39.7"></a><span id="l39.7">         return ret;</span>
<a href="#l39.8"></a><span id="l39.8">     },</span>
<a href="#l39.9"></a><span id="l39.9"> </span>
<a href="#l39.10"></a><span id="l39.10">     attachSubRequest: function(req) {</span>
<a href="#l39.11"></a><span id="l39.11">         if (req) {</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-            if (!this.m_attachedRequests.some(function(req_) { return req.id == req_.id; })) {</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+            if (!this.m_attachedRequests.some(req_ =&gt; req.id == req_.id)) {</span>
<a href="#l39.14"></a><span id="l39.14">                 if (req.isPending) {</span>
<a href="#l39.15"></a><span id="l39.15">                     this.m_attachedRequests.push(req);</span>
<a href="#l39.16"></a><span id="l39.16">                     req.parentRequest = this;</span>
<a href="#l39.17"></a><span id="l39.17">                     log(&quot;attachSubRequest()&quot;, this);</span>
<a href="#l39.18"></a><span id="l39.18">                 } else if (!this.m_locked &amp;&amp; this.m_attachedRequests.length == 0) {</span>
<a href="#l39.19"></a><span id="l39.19">                     this.execRespFunc(req.status);</span>
<a href="#l39.20"></a><span id="l39.20">                 }</span>
<a href="#l39.21"></a><span id="l39.21">             } else {</span>
<a href="#l39.22"></a><span id="l39.22">                 logError(&quot;request already attached: &quot; + req.id, this);</span>
<a href="#l39.23"></a><span id="l39.23">             }</span>
<a href="#l39.24"></a><span id="l39.24">         }</span>
<a href="#l39.25"></a><span id="l39.25">     },</span>
<a href="#l39.26"></a><span id="l39.26"> </span>
<a href="#l39.27"></a><span id="l39.27">     detachSubRequest: function(req, err) {</span>
<a href="#l39.28"></a><span id="l39.28" class="difflineminus">-        this.m_attachedRequests = this.m_attachedRequests.filter(function(req_) { return req.id != req_.id; });</span>
<a href="#l39.29"></a><span id="l39.29" class="difflineplus">+        this.m_attachedRequests = this.m_attachedRequests.filter(req_ =&gt; req.id != req_.id);</span>
<a href="#l39.30"></a><span id="l39.30">         if (err) {</span>
<a href="#l39.31"></a><span id="l39.31">             // first failing sub request stops parent request:</span>
<a href="#l39.32"></a><span id="l39.32">             this.execRespFunc(err);</span>
<a href="#l39.33"></a><span id="l39.33">         } else if (!this.m_locked &amp;&amp; this.m_attachedRequests.length == 0) {</span>
<a href="#l39.34"></a><span id="l39.34">             // assures that respFunc is executed after all sub requests have been completed:</span>
<a href="#l39.35"></a><span id="l39.35">             this.execRespFunc();</span>
<a href="#l39.36"></a><span id="l39.36">         }</span>
<a href="#l39.37"></a><span id="l39.37">     },</span>
<a href="#l39.38"></a><span id="l39.38"> </span>
<a href="#l39.39"></a><span id="l39.39">     cancelAllSubRequests: function(status) {</span>
<a href="#l39.40"></a><span id="l39.40">         let attachedRequests = this.m_attachedRequests;</span>
<a href="#l39.41"></a><span id="l39.41">         this.m_attachedRequests = [];</span>
<a href="#l39.42"></a><span id="l39.42" class="difflineminus">-        attachedRequests.forEach(function(req) { req.cancel(null); });</span>
<a href="#l39.43"></a><span id="l39.43" class="difflineplus">+        attachedRequests.forEach(req =&gt; req.cancel(null));</span>
<a href="#l39.44"></a><span id="l39.44">     },</span>
<a href="#l39.45"></a><span id="l39.45"> </span>
<a href="#l39.46"></a><span id="l39.46">     detachFromParent: function(err) {</span>
<a href="#l39.47"></a><span id="l39.47">         let parentRequest = this.m_parentRequest;</span>
<a href="#l39.48"></a><span id="l39.48">         if (parentRequest) {</span>
<a href="#l39.49"></a><span id="l39.49">             this.m_parentRequest = null;</span>
<a href="#l39.50"></a><span id="l39.50">             parentRequest.detachSubRequest(this, err);</span>
<a href="#l39.51"></a><span id="l39.51">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -187,18 +187,17 @@ calWcapSession.prototype = {</span>
<a href="#l40.4"></a><span id="l40.4">         ret.addDuration(this.m_serverTimeDiff);</span>
<a href="#l40.5"></a><span id="l40.5">         return ret;</span>
<a href="#l40.6"></a><span id="l40.6">     },</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8">     m_sessionId: null,</span>
<a href="#l40.9"></a><span id="l40.9">     m_loginQueue: null,</span>
<a href="#l40.10"></a><span id="l40.10">     m_loginLock: false,</span>
<a href="#l40.11"></a><span id="l40.11"> </span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-    getSessionId:</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-    function(request, respFunc, timedOutSessionId) {</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineplus">+    getSessionId: function(request, respFunc, timedOutSessionId) {</span>
<a href="#l40.15"></a><span id="l40.15">         if (Services.io.offline) {</span>
<a href="#l40.16"></a><span id="l40.16">             log(&quot;in offline mode.&quot;, this);</span>
<a href="#l40.17"></a><span id="l40.17">             respFunc(new Components.Exception(errorToString(NS_ERROR_OFFLINE), NS_ERROR_OFFLINE));</span>
<a href="#l40.18"></a><span id="l40.18">             return;</span>
<a href="#l40.19"></a><span id="l40.19">         }</span>
<a href="#l40.20"></a><span id="l40.20"> </span>
<a href="#l40.21"></a><span id="l40.21">         log(&quot;login queue lock: &quot; + this.m_loginLock + &quot;, length: &quot; + this.m_loginQueue.length, this);</span>
<a href="#l40.22"></a><span id="l40.22"> </span>
<a href="#l40.23"></a><span id="l40.23" class="difflineat">@@ -216,175 +215,167 @@ calWcapSession.prototype = {</span>
<a href="#l40.24"></a><span id="l40.24">             this.m_sessionId = null; // invalidate for relogin</span>
<a href="#l40.25"></a><span id="l40.25"> </span>
<a href="#l40.26"></a><span id="l40.26">             if (timedOutSessionId) {</span>
<a href="#l40.27"></a><span id="l40.27">                 log(&quot;reconnecting due to session timeout...&quot;, this);</span>
<a href="#l40.28"></a><span id="l40.28">                 getFreeBusyService().removeProvider(this);</span>
<a href="#l40.29"></a><span id="l40.29">                 getCalendarSearchService().removeProvider(this);</span>
<a href="#l40.30"></a><span id="l40.30">             }</span>
<a href="#l40.31"></a><span id="l40.31"> </span>
<a href="#l40.32"></a><span id="l40.32" class="difflineminus">-            let self = this;</span>
<a href="#l40.33"></a><span id="l40.33">             this.getSessionId_(null, // don't couple to parent request parent may be cancelled</span>
<a href="#l40.34"></a><span id="l40.34" class="difflineminus">-                               function(err, sessionId) {</span>
<a href="#l40.35"></a><span id="l40.35" class="difflineminus">-                                   log(&quot;getSessionId_resp_(): &quot; + sessionId, self);</span>
<a href="#l40.36"></a><span id="l40.36" class="difflineplus">+                               (err, sessionId) =&gt; {</span>
<a href="#l40.37"></a><span id="l40.37" class="difflineplus">+                                   log(&quot;getSessionId_resp_(): &quot; + sessionId, this);</span>
<a href="#l40.38"></a><span id="l40.38">                                    if (!err) {</span>
<a href="#l40.39"></a><span id="l40.39" class="difflineminus">-                                       self.m_sessionId = sessionId;</span>
<a href="#l40.40"></a><span id="l40.40" class="difflineminus">-                                       getFreeBusyService().addProvider(self);</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineminus">-                                       getCalendarSearchService().addProvider(self);</span>
<a href="#l40.42"></a><span id="l40.42" class="difflineplus">+                                       this.m_sessionId = sessionId;</span>
<a href="#l40.43"></a><span id="l40.43" class="difflineplus">+                                       getFreeBusyService().addProvider(this);</span>
<a href="#l40.44"></a><span id="l40.44" class="difflineplus">+                                       getCalendarSearchService().addProvider(this);</span>
<a href="#l40.45"></a><span id="l40.45">                                    }</span>
<a href="#l40.46"></a><span id="l40.46"> </span>
<a href="#l40.47"></a><span id="l40.47" class="difflineminus">-                                   let queue = self.m_loginQueue;</span>
<a href="#l40.48"></a><span id="l40.48" class="difflineminus">-                                   self.m_loginLock = false;</span>
<a href="#l40.49"></a><span id="l40.49" class="difflineminus">-                                   self.m_loginQueue = [];</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineminus">-                                   log(&quot;unlocked login queue.&quot;, self);</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineplus">+                                   let queue = this.m_loginQueue;</span>
<a href="#l40.52"></a><span id="l40.52" class="difflineplus">+                                   this.m_loginLock = false;</span>
<a href="#l40.53"></a><span id="l40.53" class="difflineplus">+                                   this.m_loginQueue = [];</span>
<a href="#l40.54"></a><span id="l40.54" class="difflineplus">+                                   log(&quot;unlocked login queue.&quot;, this);</span>
<a href="#l40.55"></a><span id="l40.55"> </span>
<a href="#l40.56"></a><span id="l40.56" class="difflineminus">-                                   function getSessionId_exec(func) {</span>
<a href="#l40.57"></a><span id="l40.57" class="difflineplus">+                                   let getSessionId_exec = (func) =&gt; {</span>
<a href="#l40.58"></a><span id="l40.58">                                        try {</span>
<a href="#l40.59"></a><span id="l40.59">                                            func(err, sessionId);</span>
<a href="#l40.60"></a><span id="l40.60">                                        } catch (exc) { // unexpected</span>
<a href="#l40.61"></a><span id="l40.61" class="difflineminus">-                                           self.notifyError(exc);</span>
<a href="#l40.62"></a><span id="l40.62" class="difflineplus">+                                           this.notifyError(exc);</span>
<a href="#l40.63"></a><span id="l40.63">                                        }</span>
<a href="#l40.64"></a><span id="l40.64" class="difflineminus">-                                   }</span>
<a href="#l40.65"></a><span id="l40.65" class="difflineplus">+                                   };</span>
<a href="#l40.66"></a><span id="l40.66">                                    // answer first request:</span>
<a href="#l40.67"></a><span id="l40.67">                                    getSessionId_exec(respFunc);</span>
<a href="#l40.68"></a><span id="l40.68">                                    // and any remaining:</span>
<a href="#l40.69"></a><span id="l40.69">                                    queue.forEach(getSessionId_exec);</span>
<a href="#l40.70"></a><span id="l40.70">                                });</span>
<a href="#l40.71"></a><span id="l40.71">         }</span>
<a href="#l40.72"></a><span id="l40.72">     },</span>
<a href="#l40.73"></a><span id="l40.73"> </span>
<a href="#l40.74"></a><span id="l40.74">     // this is a server limit for recurrencies; default is 60</span>
<a href="#l40.75"></a><span id="l40.75">     recurrenceBound: 60,</span>
<a href="#l40.76"></a><span id="l40.76"> </span>
<a href="#l40.77"></a><span id="l40.77">     getSessionId_: function(request, respFunc) {</span>
<a href="#l40.78"></a><span id="l40.78" class="difflineminus">-        let self = this;</span>
<a href="#l40.79"></a><span id="l40.79">         this.checkServerVersion(</span>
<a href="#l40.80"></a><span id="l40.80">             request,</span>
<a href="#l40.81"></a><span id="l40.81">             // probe whether server is accessible and responds:</span>
<a href="#l40.82"></a><span id="l40.82" class="difflineminus">-            function(err) {</span>
<a href="#l40.83"></a><span id="l40.83" class="difflineplus">+            (err) =&gt; {</span>
<a href="#l40.84"></a><span id="l40.84">                 if (err) {</span>
<a href="#l40.85"></a><span id="l40.85">                     respFunc(err);</span>
<a href="#l40.86"></a><span id="l40.86">                     return;</span>
<a href="#l40.87"></a><span id="l40.87">                 }</span>
<a href="#l40.88"></a><span id="l40.88">                 // lookup password manager, then try login or prompt/login:</span>
<a href="#l40.89"></a><span id="l40.89" class="difflineminus">-                log(&quot;attempting to get a session id for &quot; + self.sessionUri.spec, self);</span>
<a href="#l40.90"></a><span id="l40.90" class="difflineplus">+                log(&quot;attempting to get a session id for &quot; + this.sessionUri.spec, this);</span>
<a href="#l40.91"></a><span id="l40.91"> </span>
<a href="#l40.92"></a><span id="l40.92" class="difflineminus">-                if (!self.sessionUri.schemeIs(&quot;https&quot;) &amp;&amp;</span>
<a href="#l40.93"></a><span id="l40.93" class="difflineminus">-                    !confirmInsecureLogin(self.sessionUri)) {</span>
<a href="#l40.94"></a><span id="l40.94" class="difflineminus">-                    log(&quot;user rejected insecure login on &quot; + self.sessionUri.spec, self);</span>
<a href="#l40.95"></a><span id="l40.95" class="difflineplus">+                if (!this.sessionUri.schemeIs(&quot;https&quot;) &amp;&amp;</span>
<a href="#l40.96"></a><span id="l40.96" class="difflineplus">+                    !confirmInsecureLogin(this.sessionUri)) {</span>
<a href="#l40.97"></a><span id="l40.97" class="difflineplus">+                    log(&quot;user rejected insecure login on &quot; + this.sessionUri.spec, this);</span>
<a href="#l40.98"></a><span id="l40.98">                     respFunc(new Components.Exception(errorToString(calIWcapErrors.WCAP_LOGIN_FAILED),</span>
<a href="#l40.99"></a><span id="l40.99">                                                       calIWcapErrors.WCAP_LOGIN_FAILED));</span>
<a href="#l40.100"></a><span id="l40.100">                     return;</span>
<a href="#l40.101"></a><span id="l40.101">                 }</span>
<a href="#l40.102"></a><span id="l40.102"> </span>
<a href="#l40.103"></a><span id="l40.103" class="difflineminus">-                let outUser = { value: self.credentials.userId };</span>
<a href="#l40.104"></a><span id="l40.104" class="difflineminus">-                let outPW = { value: self.credentials.pw };</span>
<a href="#l40.105"></a><span id="l40.105" class="difflineplus">+                let outUser = { value: this.credentials.userId };</span>
<a href="#l40.106"></a><span id="l40.106" class="difflineplus">+                let outPW = { value: this.credentials.pw };</span>
<a href="#l40.107"></a><span id="l40.107">                 let outSavePW = { value: false };</span>
<a href="#l40.108"></a><span id="l40.108"> </span>
<a href="#l40.109"></a><span id="l40.109">                 if (outUser.value &amp;&amp; !outPW.value) { // lookup pw manager</span>
<a href="#l40.110"></a><span id="l40.110" class="difflineminus">-                    log(&quot;looking in pw db for: &quot; + self.uri.spec, self);</span>
<a href="#l40.111"></a><span id="l40.111" class="difflineminus">-                    cal.auth.passwordManagerGet(outUser.value, outPW, self.uri.spec, &quot;wcap login&quot;);</span>
<a href="#l40.112"></a><span id="l40.112" class="difflineplus">+                    log(&quot;looking in pw db for: &quot; + this.uri.spec, this);</span>
<a href="#l40.113"></a><span id="l40.113" class="difflineplus">+                    cal.auth.passwordManagerGet(outUser.value, outPW, this.uri.spec, &quot;wcap login&quot;);</span>
<a href="#l40.114"></a><span id="l40.114">                 }</span>
<a href="#l40.115"></a><span id="l40.115"> </span>
<a href="#l40.116"></a><span id="l40.116" class="difflineminus">-                function promptAndLoginLoop_resp(loginerr, sessionId) {</span>
<a href="#l40.117"></a><span id="l40.117" class="difflineplus">+                let promptAndLoginLoop_resp = (loginerr, sessionId) =&gt; {</span>
<a href="#l40.118"></a><span id="l40.118">                     if (checkErrorCode(loginerr, calIWcapErrors.WCAP_LOGIN_FAILED)) {</span>
<a href="#l40.119"></a><span id="l40.119" class="difflineminus">-                        log(&quot;prompting for [user/]pw...&quot;, self);</span>
<a href="#l40.120"></a><span id="l40.120" class="difflineplus">+                        log(&quot;prompting for [user/]pw...&quot;, this);</span>
<a href="#l40.121"></a><span id="l40.121">                         if (cal.auth.getCredentials(cal.calGetString(&quot;wcap&quot;, &quot;loginDialog.label&quot;),</span>
<a href="#l40.122"></a><span id="l40.122" class="difflineminus">-                                                    self.sessionUri.hostPort,</span>
<a href="#l40.123"></a><span id="l40.123" class="difflineplus">+                                                    this.sessionUri.hostPort,</span>
<a href="#l40.124"></a><span id="l40.124">                                                     outUser,</span>
<a href="#l40.125"></a><span id="l40.125">                                                     outPW,</span>
<a href="#l40.126"></a><span id="l40.126">                                                     outSavePW,</span>
<a href="#l40.127"></a><span id="l40.127" class="difflineminus">-                                                    self.credentials.userId != null)) {</span>
<a href="#l40.128"></a><span id="l40.128" class="difflineminus">-                            self.login(request, promptAndLoginLoop_resp,</span>
<a href="#l40.129"></a><span id="l40.129" class="difflineplus">+                                                    this.credentials.userId != null)) {</span>
<a href="#l40.130"></a><span id="l40.130" class="difflineplus">+                            this.login(request, promptAndLoginLoop_resp,</span>
<a href="#l40.131"></a><span id="l40.131">                                        outUser.value, outPW.value);</span>
<a href="#l40.132"></a><span id="l40.132">                         } else {</span>
<a href="#l40.133"></a><span id="l40.133" class="difflineminus">-                            log(&quot;login prompt cancelled.&quot;, self);</span>
<a href="#l40.134"></a><span id="l40.134" class="difflineminus">-                            self.defaultCalendar.setProperty(&quot;disabled&quot;, true);</span>
<a href="#l40.135"></a><span id="l40.135" class="difflineminus">-                            self.defaultCalendar.setProperty(&quot;auto-enabled&quot;, true);</span>
<a href="#l40.136"></a><span id="l40.136" class="difflineplus">+                            log(&quot;login prompt cancelled.&quot;, this);</span>
<a href="#l40.137"></a><span id="l40.137" class="difflineplus">+                            this.defaultCalendar.setProperty(&quot;disabled&quot;, true);</span>
<a href="#l40.138"></a><span id="l40.138" class="difflineplus">+                            this.defaultCalendar.setProperty(&quot;auto-enabled&quot;, true);</span>
<a href="#l40.139"></a><span id="l40.139">                             respFunc(new Components.Exception(errorToString(calIWcapErrors.WCAP_LOGIN_FAILED),</span>
<a href="#l40.140"></a><span id="l40.140">                                                               calIWcapErrors.WCAP_LOGIN_FAILED));</span>
<a href="#l40.141"></a><span id="l40.141">                         }</span>
<a href="#l40.142"></a><span id="l40.142">                     } else if (loginerr) {</span>
<a href="#l40.143"></a><span id="l40.143">                         respFunc(loginerr);</span>
<a href="#l40.144"></a><span id="l40.144">                     } else {</span>
<a href="#l40.145"></a><span id="l40.145">                         if (outSavePW.value) {</span>
<a href="#l40.146"></a><span id="l40.146">                             // so try to remove old pw from db first:</span>
<a href="#l40.147"></a><span id="l40.147" class="difflineminus">-                            cal.auth.passwordManagerSave(outUser.value, outPW.value, self.uri.spec, &quot;wcap login&quot;);</span>
<a href="#l40.148"></a><span id="l40.148" class="difflineplus">+                            cal.auth.passwordManagerSave(outUser.value, outPW.value, this.uri.spec, &quot;wcap login&quot;);</span>
<a href="#l40.149"></a><span id="l40.149">                         }</span>
<a href="#l40.150"></a><span id="l40.150" class="difflineminus">-                        self.credentials.userId = outUser.value;</span>
<a href="#l40.151"></a><span id="l40.151" class="difflineminus">-                        self.credentials.pw = outPW.value;</span>
<a href="#l40.152"></a><span id="l40.152" class="difflineminus">-                        self.setupSession(sessionId,</span>
<a href="#l40.153"></a><span id="l40.153" class="difflineminus">-                                          request,</span>
<a href="#l40.154"></a><span id="l40.154" class="difflineminus">-                                          function(setuperr) {</span>
<a href="#l40.155"></a><span id="l40.155" class="difflineminus">-                                              respFunc(setuperr, sessionId);</span>
<a href="#l40.156"></a><span id="l40.156" class="difflineminus">-                                          });</span>
<a href="#l40.157"></a><span id="l40.157" class="difflineplus">+                        this.credentials.userId = outUser.value;</span>
<a href="#l40.158"></a><span id="l40.158" class="difflineplus">+                        this.credentials.pw = outPW.value;</span>
<a href="#l40.159"></a><span id="l40.159" class="difflineplus">+                        this.setupSession(sessionId, request, (setuperr) =&gt; respFunc(setuperr, sessionId));</span>
<a href="#l40.160"></a><span id="l40.160">                     }</span>
<a href="#l40.161"></a><span id="l40.161" class="difflineminus">-                }</span>
<a href="#l40.162"></a><span id="l40.162" class="difflineplus">+                };</span>
<a href="#l40.163"></a><span id="l40.163"> </span>
<a href="#l40.164"></a><span id="l40.164">                 if (outPW.value) {</span>
<a href="#l40.165"></a><span id="l40.165" class="difflineminus">-                    self.login(request, promptAndLoginLoop_resp, outUser.value, outPW.value);</span>
<a href="#l40.166"></a><span id="l40.166" class="difflineplus">+                    this.login(request, promptAndLoginLoop_resp, outUser.value, outPW.value);</span>
<a href="#l40.167"></a><span id="l40.167">                 } else {</span>
<a href="#l40.168"></a><span id="l40.168">                     promptAndLoginLoop_resp(calIWcapErrors.WCAP_LOGIN_FAILED);</span>
<a href="#l40.169"></a><span id="l40.169">                 }</span>
<a href="#l40.170"></a><span id="l40.170">             });</span>
<a href="#l40.171"></a><span id="l40.171">     },</span>
<a href="#l40.172"></a><span id="l40.172"> </span>
<a href="#l40.173"></a><span id="l40.173">     login: function(request, respFunc, user, pw) {</span>
<a href="#l40.174"></a><span id="l40.174" class="difflineminus">-        let self = this;</span>
<a href="#l40.175"></a><span id="l40.175">         issueNetworkRequest(</span>
<a href="#l40.176"></a><span id="l40.176">             request,</span>
<a href="#l40.177"></a><span id="l40.177" class="difflineminus">-            function(err, str) {</span>
<a href="#l40.178"></a><span id="l40.178" class="difflineplus">+            (err, str) =&gt; {</span>
<a href="#l40.179"></a><span id="l40.179">                 let sessionId;</span>
<a href="#l40.180"></a><span id="l40.180">                 try {</span>
<a href="#l40.181"></a><span id="l40.181">                     if (err) {</span>
<a href="#l40.182"></a><span id="l40.182">                         throw err;</span>
<a href="#l40.183"></a><span id="l40.183">                     }</span>
<a href="#l40.184"></a><span id="l40.184">                     // currently, xml parsing at an early stage during</span>
<a href="#l40.185"></a><span id="l40.185">                     // process startup does not work reliably, so use</span>
<a href="#l40.186"></a><span id="l40.186">                     // libical parsing for now:</span>
<a href="#l40.187"></a><span id="l40.187" class="difflineminus">-                    let icalRootComp = stringToIcal(self, str);</span>
<a href="#l40.188"></a><span id="l40.188" class="difflineplus">+                    let icalRootComp = stringToIcal(this, str);</span>
<a href="#l40.189"></a><span id="l40.189">                     let prop = icalRootComp.getFirstProperty(&quot;X-NSCP-WCAP-SESSION-ID&quot;);</span>
<a href="#l40.190"></a><span id="l40.190">                     if (!prop) {</span>
<a href="#l40.191"></a><span id="l40.191">                         throw new Components.Exception(&quot;missing X-NSCP-WCAP-SESSION-ID in\n&quot; + str);</span>
<a href="#l40.192"></a><span id="l40.192">                     }</span>
<a href="#l40.193"></a><span id="l40.193">                     sessionId = prop.value;</span>
<a href="#l40.194"></a><span id="l40.194">                     prop = icalRootComp.getFirstProperty(&quot;X-NSCP-RECURRENCE-BOUND&quot;);</span>
<a href="#l40.195"></a><span id="l40.195">                     if (prop) {</span>
<a href="#l40.196"></a><span id="l40.196">                         let val = parseInt(prop.value, 10);</span>
<a href="#l40.197"></a><span id="l40.197">                         if (!isNaN(val)) {</span>
<a href="#l40.198"></a><span id="l40.198" class="difflineminus">-                            self.recurrenceBound = val;</span>
<a href="#l40.199"></a><span id="l40.199" class="difflineminus">-                            log(&quot;X-NSCP-RECURRENCE-BOUND:&quot; + self.recurrenceBound);</span>
<a href="#l40.200"></a><span id="l40.200" class="difflineplus">+                            this.recurrenceBound = val;</span>
<a href="#l40.201"></a><span id="l40.201" class="difflineplus">+                            log(&quot;X-NSCP-RECURRENCE-BOUND:&quot; + this.recurrenceBound);</span>
<a href="#l40.202"></a><span id="l40.202">                         }</span>
<a href="#l40.203"></a><span id="l40.203">                     }</span>
<a href="#l40.204"></a><span id="l40.204" class="difflineminus">-                    log(&quot;login succeeded: &quot; + sessionId, self);</span>
<a href="#l40.205"></a><span id="l40.205" class="difflineplus">+                    log(&quot;login succeeded: &quot; + sessionId, this);</span>
<a href="#l40.206"></a><span id="l40.206">                 } catch (exc) {</span>
<a href="#l40.207"></a><span id="l40.207">                     err = exc;</span>
<a href="#l40.208"></a><span id="l40.208">                     if (checkErrorCode(err, calIWcapErrors.WCAP_LOGIN_FAILED)) {</span>
<a href="#l40.209"></a><span id="l40.209" class="difflineminus">-                        log(&quot;error: &quot; + errorToString(exc), self); // log login failure</span>
<a href="#l40.210"></a><span id="l40.210" class="difflineplus">+                        log(&quot;error: &quot; + errorToString(exc), this); // log login failure</span>
<a href="#l40.211"></a><span id="l40.211">                     } else if (getErrorModule(err) == NS_ERROR_MODULE_NETWORK) {</span>
<a href="#l40.212"></a><span id="l40.212">                         // server seems unavailable:</span>
<a href="#l40.213"></a><span id="l40.213">                         err = new Components.Exception(cal.calGetString(&quot;wcap&quot;, &quot;accessingServerFailedError.text&quot;,</span>
<a href="#l40.214"></a><span id="l40.214" class="difflineminus">-                                                                        [self.sessionUri.hostPort]), exc);</span>
<a href="#l40.215"></a><span id="l40.215" class="difflineplus">+                                                                        [this.sessionUri.hostPort]), exc);</span>
<a href="#l40.216"></a><span id="l40.216">                     }</span>
<a href="#l40.217"></a><span id="l40.217">                 }</span>
<a href="#l40.218"></a><span id="l40.218">                 respFunc(err, sessionId);</span>
<a href="#l40.219"></a><span id="l40.219">             },</span>
<a href="#l40.220"></a><span id="l40.220" class="difflineminus">-            self.sessionUri.spec + &quot;login.wcap?fmt-out=text%2Fcalendar&amp;user=&quot; +</span>
<a href="#l40.221"></a><span id="l40.221" class="difflineplus">+            this.sessionUri.spec + &quot;login.wcap?fmt-out=text%2Fcalendar&amp;user=&quot; +</span>
<a href="#l40.222"></a><span id="l40.222">             encodeURIComponent(user) + &quot;&amp;password=&quot; + encodeURIComponent(pw),</span>
<a href="#l40.223"></a><span id="l40.223">             false /* no logging */);</span>
<a href="#l40.224"></a><span id="l40.224">     },</span>
<a href="#l40.225"></a><span id="l40.225"> </span>
<a href="#l40.226"></a><span id="l40.226">     logout: function(listener) {</span>
<a href="#l40.227"></a><span id="l40.227" class="difflineminus">-        let self = this;</span>
<a href="#l40.228"></a><span id="l40.228">         let request = new calWcapRequest(</span>
<a href="#l40.229"></a><span id="l40.229" class="difflineminus">-            function(oprequest, err) {</span>
<a href="#l40.230"></a><span id="l40.230" class="difflineplus">+            (oprequest, err) =&gt; {</span>
<a href="#l40.231"></a><span id="l40.231">                 if (err) {</span>
<a href="#l40.232"></a><span id="l40.232" class="difflineminus">-                    logError(err, self);</span>
<a href="#l40.233"></a><span id="l40.233" class="difflineplus">+                    logError(err, this);</span>
<a href="#l40.234"></a><span id="l40.234">                 } else {</span>
<a href="#l40.235"></a><span id="l40.235" class="difflineminus">-                    log(&quot;logout succeeded.&quot;, self);</span>
<a href="#l40.236"></a><span id="l40.236" class="difflineplus">+                    log(&quot;logout succeeded.&quot;, this);</span>
<a href="#l40.237"></a><span id="l40.237">                 }</span>
<a href="#l40.238"></a><span id="l40.238">                 if (listener) {</span>
<a href="#l40.239"></a><span id="l40.239">                     listener.onResult(oprequest, null);</span>
<a href="#l40.240"></a><span id="l40.240">                 }</span>
<a href="#l40.241"></a><span id="l40.241">             },</span>
<a href="#l40.242"></a><span id="l40.242">             log(&quot;logout&quot;, this));</span>
<a href="#l40.243"></a><span id="l40.243"> </span>
<a href="#l40.244"></a><span id="l40.244">         let url = null;</span>
<a href="#l40.245"></a><span id="l40.245" class="difflineat">@@ -398,62 +389,61 @@ calWcapSession.prototype = {</span>
<a href="#l40.246"></a><span id="l40.246">             this.m_sessionId = null;</span>
<a href="#l40.247"></a><span id="l40.247">             getFreeBusyService().removeProvider(this);</span>
<a href="#l40.248"></a><span id="l40.248">             getCalendarSearchService().removeProvider(this);</span>
<a href="#l40.249"></a><span id="l40.249">         }</span>
<a href="#l40.250"></a><span id="l40.250">         this.m_credentials = null;</span>
<a href="#l40.251"></a><span id="l40.251"> </span>
<a href="#l40.252"></a><span id="l40.252">         if (url) {</span>
<a href="#l40.253"></a><span id="l40.253">             issueNetworkRequest(request,</span>
<a href="#l40.254"></a><span id="l40.254" class="difflineminus">-                                function(err, str) {</span>
<a href="#l40.255"></a><span id="l40.255" class="difflineplus">+                                (err, str) =&gt; {</span>
<a href="#l40.256"></a><span id="l40.256">                                     if (err) {</span>
<a href="#l40.257"></a><span id="l40.257">                                         throw err;</span>
<a href="#l40.258"></a><span id="l40.258">                                     }</span>
<a href="#l40.259"></a><span id="l40.259" class="difflineminus">-                                    stringToXml(self, str, -1 /* logout successfull */);</span>
<a href="#l40.260"></a><span id="l40.260" class="difflineplus">+                                    stringToXml(this, str, -1 /* logout successfull */);</span>
<a href="#l40.261"></a><span id="l40.261">                                 }, url);</span>
<a href="#l40.262"></a><span id="l40.262">         } else {</span>
<a href="#l40.263"></a><span id="l40.263">             request.execRespFunc();</span>
<a href="#l40.264"></a><span id="l40.264">         }</span>
<a href="#l40.265"></a><span id="l40.265">         return request;</span>
<a href="#l40.266"></a><span id="l40.266">     },</span>
<a href="#l40.267"></a><span id="l40.267"> </span>
<a href="#l40.268"></a><span id="l40.268">     checkServerVersion: function(request, respFunc) {</span>
<a href="#l40.269"></a><span id="l40.269">         // currently, xml parsing at an early stage during process startup</span>
<a href="#l40.270"></a><span id="l40.270">         // does not work reliably, so use libical:</span>
<a href="#l40.271"></a><span id="l40.271" class="difflineminus">-        let self = this;</span>
<a href="#l40.272"></a><span id="l40.272">         issueNetworkRequest(</span>
<a href="#l40.273"></a><span id="l40.273">             request,</span>
<a href="#l40.274"></a><span id="l40.274" class="difflineminus">-            function(err, str) {</span>
<a href="#l40.275"></a><span id="l40.275" class="difflineplus">+            (err, str) =&gt; {</span>
<a href="#l40.276"></a><span id="l40.276">                 try {</span>
<a href="#l40.277"></a><span id="l40.277">                     let icalRootComp;</span>
<a href="#l40.278"></a><span id="l40.278">                     if (!err) {</span>
<a href="#l40.279"></a><span id="l40.279">                         try {</span>
<a href="#l40.280"></a><span id="l40.280" class="difflineminus">-                            icalRootComp = stringToIcal(self, str);</span>
<a href="#l40.281"></a><span id="l40.281" class="difflineplus">+                            icalRootComp = stringToIcal(this, str);</span>
<a href="#l40.282"></a><span id="l40.282">                         } catch (exc) {</span>
<a href="#l40.283"></a><span id="l40.283">                             err = exc;</span>
<a href="#l40.284"></a><span id="l40.284">                         }</span>
<a href="#l40.285"></a><span id="l40.285">                     }</span>
<a href="#l40.286"></a><span id="l40.286">                     if (err) {</span>
<a href="#l40.287"></a><span id="l40.287">                         if (checkErrorCode(err, calIErrors.OPERATION_CANCELLED)) {</span>
<a href="#l40.288"></a><span id="l40.288">                             throw err;</span>
<a href="#l40.289"></a><span id="l40.289">                         } else { // soft error; request denied etc.</span>
<a href="#l40.290"></a><span id="l40.290">                                  // map into localized message:</span>
<a href="#l40.291"></a><span id="l40.291">                             throw new Components.Exception(cal.calGetString(&quot;wcap&quot;, &quot;accessingServerFailedError.text&quot;,</span>
<a href="#l40.292"></a><span id="l40.292" class="difflineminus">-                                                                            [self.sessionUri.hostPort]),</span>
<a href="#l40.293"></a><span id="l40.293" class="difflineplus">+                                                                            [this.sessionUri.hostPort]),</span>
<a href="#l40.294"></a><span id="l40.294">                                                            calIWcapErrors.WCAP_LOGIN_FAILED);</span>
<a href="#l40.295"></a><span id="l40.295">                         }</span>
<a href="#l40.296"></a><span id="l40.296">                     }</span>
<a href="#l40.297"></a><span id="l40.297">                     let prop = icalRootComp.getFirstProperty(&quot;X-NSCP-WCAPVERSION&quot;);</span>
<a href="#l40.298"></a><span id="l40.298">                     if (!prop) {</span>
<a href="#l40.299"></a><span id="l40.299">                         throw new Components.Exception(&quot;missing X-NSCP-WCAPVERSION!&quot;);</span>
<a href="#l40.300"></a><span id="l40.300">                     }</span>
<a href="#l40.301"></a><span id="l40.301">                     let wcapVersion = parseInt(prop.value, 10);</span>
<a href="#l40.302"></a><span id="l40.302">                     if (wcapVersion &lt; 3) {</span>
<a href="#l40.303"></a><span id="l40.303">                         let strVers = prop.value;</span>
<a href="#l40.304"></a><span id="l40.304" class="difflineminus">-                        let vars = [self.sessionUri.hostPort];</span>
<a href="#l40.305"></a><span id="l40.305" class="difflineplus">+                        let vars = [this.sessionUri.hostPort];</span>
<a href="#l40.306"></a><span id="l40.306">                         prop = icalRootComp.getFirstProperty(&quot;PRODID&quot;);</span>
<a href="#l40.307"></a><span id="l40.307">                         vars.push(prop ? prop.value : &quot;&lt;unknown&gt;&quot;);</span>
<a href="#l40.308"></a><span id="l40.308">                         prop = icalRootComp.getFirstProperty(&quot;X-NSCP-SERVERVERSION&quot;);</span>
<a href="#l40.309"></a><span id="l40.309">                         vars.push(prop ? prop.value : &quot;&lt;unknown&gt;&quot;);</span>
<a href="#l40.310"></a><span id="l40.310">                         vars.push(strVers);</span>
<a href="#l40.311"></a><span id="l40.311"> </span>
<a href="#l40.312"></a><span id="l40.312">                         let prompt = Services.ww.getNewPrompter(null);</span>
<a href="#l40.313"></a><span id="l40.313">                         let labelText = cal.calGetString(&quot;wcap&quot;, &quot;insufficientWcapVersionConfirmation.label&quot;);</span>
<a href="#l40.314"></a><span id="l40.314" class="difflineat">@@ -462,107 +452,105 @@ calWcapSession.prototype = {</span>
<a href="#l40.315"></a><span id="l40.315">                             throw new Components.Exception(labelText, calIWcapErrors.WCAP_LOGIN_FAILED);</span>
<a href="#l40.316"></a><span id="l40.316">                         }</span>
<a href="#l40.317"></a><span id="l40.317">                     }</span>
<a href="#l40.318"></a><span id="l40.318">                 } catch (exc) {</span>
<a href="#l40.319"></a><span id="l40.319">                     err = exc;</span>
<a href="#l40.320"></a><span id="l40.320">                 }</span>
<a href="#l40.321"></a><span id="l40.321">                 respFunc(err);</span>
<a href="#l40.322"></a><span id="l40.322">             },</span>
<a href="#l40.323"></a><span id="l40.323" class="difflineminus">-            self.sessionUri.spec + &quot;version.wcap?fmt-out=text%2Fcalendar&quot;);</span>
<a href="#l40.324"></a><span id="l40.324" class="difflineplus">+            this.sessionUri.spec + &quot;version.wcap?fmt-out=text%2Fcalendar&quot;);</span>
<a href="#l40.325"></a><span id="l40.325">     },</span>
<a href="#l40.326"></a><span id="l40.326"> </span>
<a href="#l40.327"></a><span id="l40.327">     setupSession: function(sessionId, request_, respFunc) {</span>
<a href="#l40.328"></a><span id="l40.328" class="difflineminus">-        let self = this;</span>
<a href="#l40.329"></a><span id="l40.329">         let request = new calWcapRequest(</span>
<a href="#l40.330"></a><span id="l40.330" class="difflineminus">-            function(oprequest, err) {</span>
<a href="#l40.331"></a><span id="l40.331" class="difflineminus">-                log(&quot;setupSession_resp finished: &quot; + errorToString(err), self);</span>
<a href="#l40.332"></a><span id="l40.332" class="difflineplus">+            (oprequest, err) =&gt; {</span>
<a href="#l40.333"></a><span id="l40.333" class="difflineplus">+                log(&quot;setupSession_resp finished: &quot; + errorToString(err), this);</span>
<a href="#l40.334"></a><span id="l40.334">                 respFunc(err);</span>
<a href="#l40.335"></a><span id="l40.335">             },</span>
<a href="#l40.336"></a><span id="l40.336">             log(&quot;setupSession&quot;, this));</span>
<a href="#l40.337"></a><span id="l40.337">         if (request_) {</span>
<a href="#l40.338"></a><span id="l40.338">             request_.attachSubRequest(request);</span>
<a href="#l40.339"></a><span id="l40.339">         }</span>
<a href="#l40.340"></a><span id="l40.340"> </span>
<a href="#l40.341"></a><span id="l40.341">         request.lockPending();</span>
<a href="#l40.342"></a><span id="l40.342">         try {</span>
<a href="#l40.343"></a><span id="l40.343">             this.issueNetworkRequest_(</span>
<a href="#l40.344"></a><span id="l40.344">                 request,</span>
<a href="#l40.345"></a><span id="l40.345" class="difflineminus">-                function(err, data) {</span>
<a href="#l40.346"></a><span id="l40.346" class="difflineplus">+                (err, data) =&gt; {</span>
<a href="#l40.347"></a><span id="l40.347">                     if (err) {</span>
<a href="#l40.348"></a><span id="l40.348">                         throw err;</span>
<a href="#l40.349"></a><span id="l40.349">                     }</span>
<a href="#l40.350"></a><span id="l40.350" class="difflineminus">-                    self.credentials.userPrefs = data;</span>
<a href="#l40.351"></a><span id="l40.351" class="difflineminus">-                    log(&quot;installed user prefs.&quot;, self);</span>
<a href="#l40.352"></a><span id="l40.352" class="difflineplus">+                    this.credentials.userPrefs = data;</span>
<a href="#l40.353"></a><span id="l40.353" class="difflineplus">+                    log(&quot;installed user prefs.&quot;, this);</span>
<a href="#l40.354"></a><span id="l40.354"> </span>
<a href="#l40.355"></a><span id="l40.355">                     // get calprops for all registered calendars:</span>
<a href="#l40.356"></a><span id="l40.356" class="difflineminus">-                    let cals = self.getRegisteredCalendars(true);</span>
<a href="#l40.357"></a><span id="l40.357" class="difflineplus">+                    let cals = this.getRegisteredCalendars(true);</span>
<a href="#l40.358"></a><span id="l40.358"> </span>
<a href="#l40.359"></a><span id="l40.359">                     let calprops_resp = null;</span>
<a href="#l40.360"></a><span id="l40.360" class="difflineminus">-                    let defaultCal = self.defaultCalendar;</span>
<a href="#l40.361"></a><span id="l40.361" class="difflineplus">+                    let defaultCal = this.defaultCalendar;</span>
<a href="#l40.362"></a><span id="l40.362">                     if (defaultCal &amp;&amp; cals[defaultCal.calId] &amp;&amp; // default calendar is registered</span>
<a href="#l40.363"></a><span id="l40.363">                         getPref(&quot;calendar.wcap.subscriptions&quot;, true) &amp;&amp;</span>
<a href="#l40.364"></a><span id="l40.364">                         !defaultCal.getProperty(&quot;subscriptions_registered&quot;)) {</span>
<a href="#l40.365"></a><span id="l40.365">                         let hasSubscriptions = false;</span>
<a href="#l40.366"></a><span id="l40.366">                         // post register subscribed calendars:</span>
<a href="#l40.367"></a><span id="l40.367" class="difflineminus">-                        let list = self.getUserPreferences(&quot;X-NSCP-WCAP-PREF-icsSubscribed&quot;);</span>
<a href="#l40.368"></a><span id="l40.368" class="difflineplus">+                        let list = this.getUserPreferences(&quot;X-NSCP-WCAP-PREF-icsSubscribed&quot;);</span>
<a href="#l40.369"></a><span id="l40.369">                         for (let item of list) {</span>
<a href="#l40.370"></a><span id="l40.370">                             let ar = item.split(&quot;,&quot;);</span>
<a href="#l40.371"></a><span id="l40.371">                             // ',', '$' are not encoded. ',' can be handled here. WTF.</span>
<a href="#l40.372"></a><span id="l40.372">                             for (let a of ar) {</span>
<a href="#l40.373"></a><span id="l40.373">                                 let dollar = a.indexOf(&quot;$&quot;);</span>
<a href="#l40.374"></a><span id="l40.374">                                 if (dollar &gt;= 0) {</span>
<a href="#l40.375"></a><span id="l40.375">                                     let calId = a.substring(0, dollar);</span>
<a href="#l40.376"></a><span id="l40.376" class="difflineminus">-                                    if (calId != self.defaultCalId) {</span>
<a href="#l40.377"></a><span id="l40.377" class="difflineplus">+                                    if (calId != this.defaultCalId) {</span>
<a href="#l40.378"></a><span id="l40.378">                                         cals[calId] = null;</span>
<a href="#l40.379"></a><span id="l40.379">                                         hasSubscriptions = true;</span>
<a href="#l40.380"></a><span id="l40.380">                                     }</span>
<a href="#l40.381"></a><span id="l40.381">                                 }</span>
<a href="#l40.382"></a><span id="l40.382">                             }</span>
<a href="#l40.383"></a><span id="l40.383">                         }</span>
<a href="#l40.384"></a><span id="l40.384"> </span>
<a href="#l40.385"></a><span id="l40.385">                         if (hasSubscriptions) {</span>
<a href="#l40.386"></a><span id="l40.386" class="difflineminus">-                            calprops_resp = function(aCalendar) {</span>
<a href="#l40.387"></a><span id="l40.387" class="difflineplus">+                            calprops_resp = (aCalendar) =&gt; {</span>
<a href="#l40.388"></a><span id="l40.388">                                 if (aCalendar.isDefaultCalendar) {</span>
<a href="#l40.389"></a><span id="l40.389">                                     // tweak name:</span>
<a href="#l40.390"></a><span id="l40.390">                                     aCalendar.setProperty(&quot;name&quot;, aCalendar.displayName);</span>
<a href="#l40.391"></a><span id="l40.391">                                 } else {</span>
<a href="#l40.392"></a><span id="l40.392" class="difflineminus">-                                    log(&quot;registering subscribed calendar: &quot; + aCalendar.calId, self);</span>
<a href="#l40.393"></a><span id="l40.393" class="difflineplus">+                                    log(&quot;registering subscribed calendar: &quot; + aCalendar.calId, this);</span>
<a href="#l40.394"></a><span id="l40.394">                                     cal.getCalendarManager().registerCalendar(aCalendar);</span>
<a href="#l40.395"></a><span id="l40.395">                                 }</span>
<a href="#l40.396"></a><span id="l40.396">                             };</span>
<a href="#l40.397"></a><span id="l40.397">                             // do only once:</span>
<a href="#l40.398"></a><span id="l40.398">                             defaultCal.setProperty(&quot;subscriptions_registered&quot;, true);</span>
<a href="#l40.399"></a><span id="l40.399">                         }</span>
<a href="#l40.400"></a><span id="l40.400">                     }</span>
<a href="#l40.401"></a><span id="l40.401"> </span>
<a href="#l40.402"></a><span id="l40.402">                     if (!defaultCal.getProperty(&quot;user_id&quot;)) { // nail once:</span>
<a href="#l40.403"></a><span id="l40.403" class="difflineminus">-                        defaultCal.setProperty(&quot;user_id&quot;, self.credentials.userId);</span>
<a href="#l40.404"></a><span id="l40.404" class="difflineplus">+                        defaultCal.setProperty(&quot;user_id&quot;, this.credentials.userId);</span>
<a href="#l40.405"></a><span id="l40.405">                     }</span>
<a href="#l40.406"></a><span id="l40.406"> </span>
<a href="#l40.407"></a><span id="l40.407">                     if (getPref(&quot;calendar.wcap.no_get_calprops&quot;, false)) {</span>
<a href="#l40.408"></a><span id="l40.408">                         // hack around the get/search calprops mess:</span>
<a href="#l40.409"></a><span id="l40.409" class="difflineminus">-                        self.installCalProps_search_calprops(calprops_resp, sessionId, cals, request);</span>
<a href="#l40.410"></a><span id="l40.410" class="difflineplus">+                        this.installCalProps_search_calprops(calprops_resp, sessionId, cals, request);</span>
<a href="#l40.411"></a><span id="l40.411">                     } else {</span>
<a href="#l40.412"></a><span id="l40.412" class="difflineminus">-                        self.installCalProps_get_calprops(calprops_resp, sessionId, cals, request);</span>
<a href="#l40.413"></a><span id="l40.413" class="difflineplus">+                        this.installCalProps_get_calprops(calprops_resp, sessionId, cals, request);</span>
<a href="#l40.414"></a><span id="l40.414">                     }</span>
<a href="#l40.415"></a><span id="l40.415">                 },</span>
<a href="#l40.416"></a><span id="l40.416">                 stringToXml, &quot;get_userprefs&quot;,</span>
<a href="#l40.417"></a><span id="l40.417">                 &quot;&amp;fmt-out=text%2Fxml&amp;userid=&quot; + encodeURIComponent(this.credentials.userId),</span>
<a href="#l40.418"></a><span id="l40.418">                 sessionId);</span>
<a href="#l40.419"></a><span id="l40.419">             this.installServerTimeDiff(sessionId, request);</span>
<a href="#l40.420"></a><span id="l40.420">             this.installServerTimezones(sessionId, request);</span>
<a href="#l40.421"></a><span id="l40.421">         } finally {</span>
<a href="#l40.422"></a><span id="l40.422">             request.unlockPending();</span>
<a href="#l40.423"></a><span id="l40.423">         }</span>
<a href="#l40.424"></a><span id="l40.424">     },</span>
<a href="#l40.425"></a><span id="l40.425"> </span>
<a href="#l40.426"></a><span id="l40.426">     installCalProps_get_calprops: function(respFunc, sessionId, cals, request) {</span>
<a href="#l40.427"></a><span id="l40.427" class="difflineminus">-        let self = this;</span>
<a href="#l40.428"></a><span id="l40.428" class="difflineminus">-        function calprops_resp(err, data) {</span>
<a href="#l40.429"></a><span id="l40.429" class="difflineplus">+        let calprops_resp = (err, data) =&gt; {</span>
<a href="#l40.430"></a><span id="l40.430">             if (err) {</span>
<a href="#l40.431"></a><span id="l40.431">                 throw err;</span>
<a href="#l40.432"></a><span id="l40.432">             }</span>
<a href="#l40.433"></a><span id="l40.433">             // string to xml converter func without WCAP errno check:</span>
<a href="#l40.434"></a><span id="l40.434">             if (!data || data.length == 0) { // assuming time-out</span>
<a href="#l40.435"></a><span id="l40.435">                 throw new Components.Exception(errorToString(calIWcapErrors.WCAP_LOGIN_FAILED),</span>
<a href="#l40.436"></a><span id="l40.436">                                                calIWcapErrors.WCAP_LOGIN_FAILED);</span>
<a href="#l40.437"></a><span id="l40.437">             }</span>
<a href="#l40.438"></a><span id="l40.438" class="difflineat">@@ -572,49 +560,48 @@ calWcapSession.prototype = {</span>
<a href="#l40.439"></a><span id="l40.439">                 try {</span>
<a href="#l40.440"></a><span id="l40.440">                     let node = nodeList.item(i);</span>
<a href="#l40.441"></a><span id="l40.441">                     checkWcapXmlErrno(node);</span>
<a href="#l40.442"></a><span id="l40.442">                     let ar = filterXmlNodes(&quot;X-NSCP-CALPROPS-RELATIVE-CALID&quot;, node);</span>
<a href="#l40.443"></a><span id="l40.443">                     if (ar.length &gt; 0) {</span>
<a href="#l40.444"></a><span id="l40.444">                         let calId = ar[0];</span>
<a href="#l40.445"></a><span id="l40.445">                         let calendar = cals[calId];</span>
<a href="#l40.446"></a><span id="l40.446">                         if (calendar === null) {</span>
<a href="#l40.447"></a><span id="l40.447" class="difflineminus">-                            calendar = new calWcapCalendar(self);</span>
<a href="#l40.448"></a><span id="l40.448" class="difflineminus">-                            let uri = self.uri.clone();</span>
<a href="#l40.449"></a><span id="l40.449" class="difflineplus">+                            calendar = new calWcapCalendar(this);</span>
<a href="#l40.450"></a><span id="l40.450" class="difflineplus">+                            let uri = this.uri.clone();</span>
<a href="#l40.451"></a><span id="l40.451">                             uri.path += &quot;?calid=&quot; + encodeURIComponent(calId);</span>
<a href="#l40.452"></a><span id="l40.452">                             calendar.uri = uri;</span>
<a href="#l40.453"></a><span id="l40.453">                         }</span>
<a href="#l40.454"></a><span id="l40.454">                         if (calendar) {</span>
<a href="#l40.455"></a><span id="l40.455">                             calendar.m_calProps = node;</span>
<a href="#l40.456"></a><span id="l40.456">                             if (respFunc) {</span>
<a href="#l40.457"></a><span id="l40.457">                                 respFunc(calendar);</span>
<a href="#l40.458"></a><span id="l40.458">                             }</span>
<a href="#l40.459"></a><span id="l40.459">                         }</span>
<a href="#l40.460"></a><span id="l40.460">                     }</span>
<a href="#l40.461"></a><span id="l40.461">                 } catch (exc) { // ignore but log any errors on subscribed calendars:</span>
<a href="#l40.462"></a><span id="l40.462" class="difflineminus">-                    logError(exc, self);</span>
<a href="#l40.463"></a><span id="l40.463" class="difflineplus">+                    logError(exc, this);</span>
<a href="#l40.464"></a><span id="l40.464">                 }</span>
<a href="#l40.465"></a><span id="l40.465">             }</span>
<a href="#l40.466"></a><span id="l40.466" class="difflineminus">-        }</span>
<a href="#l40.467"></a><span id="l40.467" class="difflineplus">+        };</span>
<a href="#l40.468"></a><span id="l40.468"> </span>
<a href="#l40.469"></a><span id="l40.469">         let calidParam = &quot;&quot;;</span>
<a href="#l40.470"></a><span id="l40.470">         for (let calId in cals) {</span>
<a href="#l40.471"></a><span id="l40.471">             if (calidParam.length &gt; 0) {</span>
<a href="#l40.472"></a><span id="l40.472">                 calidParam += &quot;;&quot;;</span>
<a href="#l40.473"></a><span id="l40.473">             }</span>
<a href="#l40.474"></a><span id="l40.474">             calidParam += encodeURIComponent(calId);</span>
<a href="#l40.475"></a><span id="l40.475">         }</span>
<a href="#l40.476"></a><span id="l40.476" class="difflineminus">-        self.issueNetworkRequest_(request, calprops_resp,</span>
<a href="#l40.477"></a><span id="l40.477" class="difflineplus">+        this.issueNetworkRequest_(request, calprops_resp,</span>
<a href="#l40.478"></a><span id="l40.478">                                   null, &quot;get_calprops&quot;,</span>
<a href="#l40.479"></a><span id="l40.479">                                   &quot;&amp;fmt-out=text%2Fxml&amp;calid=&quot; + calidParam,</span>
<a href="#l40.480"></a><span id="l40.480">                                   sessionId);</span>
<a href="#l40.481"></a><span id="l40.481">     },</span>
<a href="#l40.482"></a><span id="l40.482"> </span>
<a href="#l40.483"></a><span id="l40.483">     installCalProps_search_calprops: function(respFunc, sessionId, cals, request) {</span>
<a href="#l40.484"></a><span id="l40.484" class="difflineminus">-        let self = this;</span>
<a href="#l40.485"></a><span id="l40.485">         let retrievedCals = {};</span>
<a href="#l40.486"></a><span id="l40.486">         let issuedSearchRequests = {};</span>
<a href="#l40.487"></a><span id="l40.487">         for (let calId in cals) {</span>
<a href="#l40.488"></a><span id="l40.488">             if (!retrievedCals[calId]) {</span>
<a href="#l40.489"></a><span id="l40.489">                 let listener = {</span>
<a href="#l40.490"></a><span id="l40.490">                     onResult: function(oprequest, result) {</span>
<a href="#l40.491"></a><span id="l40.491">                         try {</span>
<a href="#l40.492"></a><span id="l40.492">                             if (!Components.isSuccessCode(oprequest.status)) {</span>
<a href="#l40.493"></a><span id="l40.493" class="difflineat">@@ -630,21 +617,21 @@ calWcapSession.prototype = {</span>
<a href="#l40.494"></a><span id="l40.494">                                     let thisCalId = calendar.calId;</span>
<a href="#l40.495"></a><span id="l40.495">                                     if ((cals[thisCalId] !== undefined) &amp;&amp; !retrievedCals[thisCalId]) {</span>
<a href="#l40.496"></a><span id="l40.496">                                         retrievedCals[thisCalId] = calendar;</span>
<a href="#l40.497"></a><span id="l40.497">                                         if (respFunc) {</span>
<a href="#l40.498"></a><span id="l40.498">                                             respFunc(calendar);</span>
<a href="#l40.499"></a><span id="l40.499">                                         }</span>
<a href="#l40.500"></a><span id="l40.500">                                     }</span>
<a href="#l40.501"></a><span id="l40.501">                                 } catch (exc) { // ignore but log any errors on subscribed calendars:</span>
<a href="#l40.502"></a><span id="l40.502" class="difflineminus">-                                    logError(exc, self);</span>
<a href="#l40.503"></a><span id="l40.503" class="difflineplus">+                                    logError(exc, this);</span>
<a href="#l40.504"></a><span id="l40.504">                                 }</span>
<a href="#l40.505"></a><span id="l40.505">                             }</span>
<a href="#l40.506"></a><span id="l40.506">                         } catch (exc) { // ignore but log any errors on subscribed calendars:</span>
<a href="#l40.507"></a><span id="l40.507" class="difflineminus">-                            logError(exc, self);</span>
<a href="#l40.508"></a><span id="l40.508" class="difflineplus">+                            logError(exc, this);</span>
<a href="#l40.509"></a><span id="l40.509">                         }</span>
<a href="#l40.510"></a><span id="l40.510">                     }</span>
<a href="#l40.511"></a><span id="l40.511">                 };</span>
<a href="#l40.512"></a><span id="l40.512"> </span>
<a href="#l40.513"></a><span id="l40.513">                 let colon = calId.indexOf(&quot;:&quot;);</span>
<a href="#l40.514"></a><span id="l40.514">                 if (colon &gt;= 0) { // searching for secondary calendars doesn't work. WTF.</span>
<a href="#l40.515"></a><span id="l40.515">                     calId = calId.substring(0, colon);</span>
<a href="#l40.516"></a><span id="l40.516">                 }</span>
<a href="#l40.517"></a><span id="l40.517" class="difflineat">@@ -652,103 +639,99 @@ calWcapSession.prototype = {</span>
<a href="#l40.518"></a><span id="l40.518">                     issuedSearchRequests[calId] = true;</span>
<a href="#l40.519"></a><span id="l40.519">                     this.searchForCalendars(calId, calICalendarSearchProvider.HINT_EXACT_MATCH, 20, listener);</span>
<a href="#l40.520"></a><span id="l40.520">                 }</span>
<a href="#l40.521"></a><span id="l40.521">             }</span>
<a href="#l40.522"></a><span id="l40.522">         }</span>
<a href="#l40.523"></a><span id="l40.523">     },</span>
<a href="#l40.524"></a><span id="l40.524"> </span>
<a href="#l40.525"></a><span id="l40.525">     installServerTimeDiff: function(sessionId, request) {</span>
<a href="#l40.526"></a><span id="l40.526" class="difflineminus">-        let self = this;</span>
<a href="#l40.527"></a><span id="l40.527">         this.issueNetworkRequest_(</span>
<a href="#l40.528"></a><span id="l40.528">             request,</span>
<a href="#l40.529"></a><span id="l40.529" class="difflineminus">-            function(err, data) {</span>
<a href="#l40.530"></a><span id="l40.530" class="difflineplus">+            (err, data) =&gt; {</span>
<a href="#l40.531"></a><span id="l40.531">                 if (err) {</span>
<a href="#l40.532"></a><span id="l40.532">                     throw err;</span>
<a href="#l40.533"></a><span id="l40.533">                 }</span>
<a href="#l40.534"></a><span id="l40.534">                 // xxx todo: think about</span>
<a href="#l40.535"></a><span id="l40.535">                 // assure that locally calculated server time is smaller</span>
<a href="#l40.536"></a><span id="l40.536">                 // than the current (real) server time:</span>
<a href="#l40.537"></a><span id="l40.537">                 let localTime = getTime();</span>
<a href="#l40.538"></a><span id="l40.538">                 let serverTime = getDatetimeFromIcalProp(data.getFirstProperty(&quot;X-NSCP-WCAPTIME&quot;));</span>
<a href="#l40.539"></a><span id="l40.539" class="difflineminus">-                self.m_serverTimeDiff = serverTime.subtractDate(localTime);</span>
<a href="#l40.540"></a><span id="l40.540" class="difflineminus">-                log(&quot;server time diff is: &quot; + self.m_serverTimeDiff, self);</span>
<a href="#l40.541"></a><span id="l40.541" class="difflineplus">+                this.m_serverTimeDiff = serverTime.subtractDate(localTime);</span>
<a href="#l40.542"></a><span id="l40.542" class="difflineplus">+                log(&quot;server time diff is: &quot; + this.m_serverTimeDiff, this);</span>
<a href="#l40.543"></a><span id="l40.543">             },</span>
<a href="#l40.544"></a><span id="l40.544">             stringToIcal, &quot;gettime&quot;, &quot;&amp;fmt-out=text%2Fcalendar&quot;,</span>
<a href="#l40.545"></a><span id="l40.545">             sessionId);</span>
<a href="#l40.546"></a><span id="l40.546">     },</span>
<a href="#l40.547"></a><span id="l40.547"> </span>
<a href="#l40.548"></a><span id="l40.548">     installServerTimezones: function(sessionId, request) {</span>
<a href="#l40.549"></a><span id="l40.549">         this.m_serverTimezones = {};</span>
<a href="#l40.550"></a><span id="l40.550" class="difflineminus">-        let self = this;</span>
<a href="#l40.551"></a><span id="l40.551" class="difflineminus">-        self.issueNetworkRequest_(</span>
<a href="#l40.552"></a><span id="l40.552" class="difflineplus">+        this.issueNetworkRequest_(</span>
<a href="#l40.553"></a><span id="l40.553">             request,</span>
<a href="#l40.554"></a><span id="l40.554" class="difflineminus">-            function(err, data) {</span>
<a href="#l40.555"></a><span id="l40.555" class="difflineplus">+            (err, data) =&gt; {</span>
<a href="#l40.556"></a><span id="l40.556">                 if (err) {</span>
<a href="#l40.557"></a><span id="l40.557">                     throw err;</span>
<a href="#l40.558"></a><span id="l40.558">                 }</span>
<a href="#l40.559"></a><span id="l40.559">                 for (let subComp of cal.ical.calendarComponentIterator(data, &quot;VTIMEZONE&quot;)) {</span>
<a href="#l40.560"></a><span id="l40.560">                     try {</span>
<a href="#l40.561"></a><span id="l40.561">                         let tzid = subComp.getFirstProperty(&quot;TZID&quot;).value;</span>
<a href="#l40.562"></a><span id="l40.562" class="difflineminus">-                        self.m_serverTimezones[tzid] = new calWcapTimezone(self, tzid, subComp);</span>
<a href="#l40.563"></a><span id="l40.563" class="difflineplus">+                        this.m_serverTimezones[tzid] = new calWcapTimezone(this, tzid, subComp);</span>
<a href="#l40.564"></a><span id="l40.564">                     } catch (exc) { // ignore but errors:</span>
<a href="#l40.565"></a><span id="l40.565" class="difflineminus">-                        logError(exc, self);</span>
<a href="#l40.566"></a><span id="l40.566" class="difflineplus">+                        logError(exc, this);</span>
<a href="#l40.567"></a><span id="l40.567">                     }</span>
<a href="#l40.568"></a><span id="l40.568">                 }</span>
<a href="#l40.569"></a><span id="l40.569" class="difflineminus">-                log(&quot;installed timezones.&quot;, self);</span>
<a href="#l40.570"></a><span id="l40.570" class="difflineplus">+                log(&quot;installed timezones.&quot;, this);</span>
<a href="#l40.571"></a><span id="l40.571">             },</span>
<a href="#l40.572"></a><span id="l40.572">             stringToIcal, &quot;get_all_timezones&quot;, &quot;&amp;fmt-out=text%2Fcalendar&quot;,</span>
<a href="#l40.573"></a><span id="l40.573">             sessionId);</span>
<a href="#l40.574"></a><span id="l40.574">     },</span>
<a href="#l40.575"></a><span id="l40.575"> </span>
<a href="#l40.576"></a><span id="l40.576">     getCommandUrl: function(wcapCommand, params, sessionId) {</span>
<a href="#l40.577"></a><span id="l40.577">         let url = this.sessionUri.spec;</span>
<a href="#l40.578"></a><span id="l40.578">         url += wcapCommand + &quot;.wcap?appid=mozilla-calendar&amp;id=&quot;;</span>
<a href="#l40.579"></a><span id="l40.579">         url += sessionId;</span>
<a href="#l40.580"></a><span id="l40.580">         url += params;</span>
<a href="#l40.581"></a><span id="l40.581">         return url;</span>
<a href="#l40.582"></a><span id="l40.582">     },</span>
<a href="#l40.583"></a><span id="l40.583"> </span>
<a href="#l40.584"></a><span id="l40.584">     issueNetworkRequest: function(request, respFunc, dataConvFunc, wcapCommand, params) {</span>
<a href="#l40.585"></a><span id="l40.585" class="difflineminus">-        let self = this;</span>
<a href="#l40.586"></a><span id="l40.586" class="difflineminus">-        let getSessionId_resp = function(err, sessionId) {</span>
<a href="#l40.587"></a><span id="l40.587" class="difflineplus">+        let getSessionId_resp = (err, sessionId) =&gt; {</span>
<a href="#l40.588"></a><span id="l40.588">             if (err) {</span>
<a href="#l40.589"></a><span id="l40.589">                 request.execSubRespFunc(respFunc, err);</span>
<a href="#l40.590"></a><span id="l40.590">             } else {</span>
<a href="#l40.591"></a><span id="l40.591">                 // else have session uri and id:</span>
<a href="#l40.592"></a><span id="l40.592" class="difflineminus">-                self.issueNetworkRequest_(</span>
<a href="#l40.593"></a><span id="l40.593" class="difflineplus">+                this.issueNetworkRequest_(</span>
<a href="#l40.594"></a><span id="l40.594">                     request,</span>
<a href="#l40.595"></a><span id="l40.595" class="difflineminus">-                    function(loginerr, data) {</span>
<a href="#l40.596"></a><span id="l40.596" class="difflineplus">+                    (loginerr, data) =&gt; {</span>
<a href="#l40.597"></a><span id="l40.597">                         // timeout?</span>
<a href="#l40.598"></a><span id="l40.598">                         if (checkErrorCode(loginerr, calIWcapErrors.WCAP_LOGIN_FAILED)) {</span>
<a href="#l40.599"></a><span id="l40.599">                             // try again:</span>
<a href="#l40.600"></a><span id="l40.600" class="difflineminus">-                            self.getSessionId(</span>
<a href="#l40.601"></a><span id="l40.601" class="difflineplus">+                            this.getSessionId(</span>
<a href="#l40.602"></a><span id="l40.602">                                 request,</span>
<a href="#l40.603"></a><span id="l40.603">                                 getSessionId_resp,</span>
<a href="#l40.604"></a><span id="l40.604">                                 sessionId/* (old) timed-out session */);</span>
<a href="#l40.605"></a><span id="l40.605">                             return;</span>
<a href="#l40.606"></a><span id="l40.606">                         }</span>
<a href="#l40.607"></a><span id="l40.607">                         request.execSubRespFunc(respFunc, loginerr, data);</span>
<a href="#l40.608"></a><span id="l40.608">                     },</span>
<a href="#l40.609"></a><span id="l40.609">                     dataConvFunc, wcapCommand, params, sessionId);</span>
<a href="#l40.610"></a><span id="l40.610">             }</span>
<a href="#l40.611"></a><span id="l40.611">         };</span>
<a href="#l40.612"></a><span id="l40.612">         this.getSessionId(request, getSessionId_resp);</span>
<a href="#l40.613"></a><span id="l40.613">     },</span>
<a href="#l40.614"></a><span id="l40.614"> </span>
<a href="#l40.615"></a><span id="l40.615">     issueNetworkRequest_: function(request, respFunc, dataConvFunc, wcapCommand, params, sessionId) {</span>
<a href="#l40.616"></a><span id="l40.616">         let url = this.getCommandUrl(wcapCommand, params, sessionId);</span>
<a href="#l40.617"></a><span id="l40.617" class="difflineminus">-        let self = this;</span>
<a href="#l40.618"></a><span id="l40.618">         issueNetworkRequest(request,</span>
<a href="#l40.619"></a><span id="l40.619" class="difflineminus">-                            function(err, str) {</span>
<a href="#l40.620"></a><span id="l40.620" class="difflineplus">+                            (err, str) =&gt; {</span>
<a href="#l40.621"></a><span id="l40.621">                                 let data;</span>
<a href="#l40.622"></a><span id="l40.622">                                 if (!err) {</span>
<a href="#l40.623"></a><span id="l40.623">                                     try {</span>
<a href="#l40.624"></a><span id="l40.624">                                         if (dataConvFunc) {</span>
<a href="#l40.625"></a><span id="l40.625" class="difflineminus">-                                            data = dataConvFunc(self, str);</span>
<a href="#l40.626"></a><span id="l40.626" class="difflineplus">+                                            data = dataConvFunc(this, str);</span>
<a href="#l40.627"></a><span id="l40.627">                                         } else {</span>
<a href="#l40.628"></a><span id="l40.628">                                             data = str;</span>
<a href="#l40.629"></a><span id="l40.629">                                         }</span>
<a href="#l40.630"></a><span id="l40.630">                                     } catch (exc) {</span>
<a href="#l40.631"></a><span id="l40.631">                                         err = exc;</span>
<a href="#l40.632"></a><span id="l40.632">                                     }</span>
<a href="#l40.633"></a><span id="l40.633">                                 }</span>
<a href="#l40.634"></a><span id="l40.634">                                 request.execSubRespFunc(respFunc, err, data);</span>
<a href="#l40.635"></a><span id="l40.635" class="difflineat">@@ -859,21 +842,20 @@ calWcapSession.prototype = {</span>
<a href="#l40.636"></a><span id="l40.636">             }</span>
<a href="#l40.637"></a><span id="l40.637">         }</span>
<a href="#l40.638"></a><span id="l40.638">         out_count.value = ret.length;</span>
<a href="#l40.639"></a><span id="l40.639">         return ret;</span>
<a href="#l40.640"></a><span id="l40.640">     },</span>
<a href="#l40.641"></a><span id="l40.641"> </span>
<a href="#l40.642"></a><span id="l40.642">     // calICalendarSearchProvider:</span>
<a href="#l40.643"></a><span id="l40.643">     searchForCalendars: function(searchString, hints, maxResults, listener) {</span>
<a href="#l40.644"></a><span id="l40.644" class="difflineminus">-        let self = this;</span>
<a href="#l40.645"></a><span id="l40.645">         let request = new calWcapRequest(</span>
<a href="#l40.646"></a><span id="l40.646" class="difflineminus">-            function(oprequest, err, data) {</span>
<a href="#l40.647"></a><span id="l40.647" class="difflineplus">+            (oprequest, err, data) =&gt; {</span>
<a href="#l40.648"></a><span id="l40.648">                 if (err &amp;&amp; !checkErrorCode(err, calIErrors.OPERATION_CANCELLED)) {</span>
<a href="#l40.649"></a><span id="l40.649" class="difflineminus">-                    self.notifyError(err);</span>
<a href="#l40.650"></a><span id="l40.650" class="difflineplus">+                    this.notifyError(err);</span>
<a href="#l40.651"></a><span id="l40.651">                 }</span>
<a href="#l40.652"></a><span id="l40.652">                 if (listener) {</span>
<a href="#l40.653"></a><span id="l40.653">                     listener.onResult(oprequest, data);</span>
<a href="#l40.654"></a><span id="l40.654">                 }</span>
<a href="#l40.655"></a><span id="l40.655">             },</span>
<a href="#l40.656"></a><span id="l40.656">             log(&quot;searchForCalendars, searchString=&quot; + searchString, this));</span>
<a href="#l40.657"></a><span id="l40.657"> </span>
<a href="#l40.658"></a><span id="l40.658">         try {</span>
<a href="#l40.659"></a><span id="l40.659" class="difflineat">@@ -883,17 +865,17 @@ calWcapSession.prototype = {</span>
<a href="#l40.660"></a><span id="l40.660">             if (maxResults &gt; 0) {</span>
<a href="#l40.661"></a><span id="l40.661">                 params += &quot;&amp;maxResults=&quot; + maxResults;</span>
<a href="#l40.662"></a><span id="l40.662">             }</span>
<a href="#l40.663"></a><span id="l40.663">             params += &quot;&amp;name=1&amp;calid=1&amp;primaryOwner=1&amp;searchOpts=&quot; +</span>
<a href="#l40.664"></a><span id="l40.664">                        (hints &amp; calICalendarSearchProvider.HINT_EXACT_MATCH ? &quot;3&quot; : &quot;0&quot;);</span>
<a href="#l40.665"></a><span id="l40.665"> </span>
<a href="#l40.666"></a><span id="l40.666">             this.issueNetworkRequest(</span>
<a href="#l40.667"></a><span id="l40.667">                 request,</span>
<a href="#l40.668"></a><span id="l40.668" class="difflineminus">-                function(err, data) {</span>
<a href="#l40.669"></a><span id="l40.669" class="difflineplus">+                (err, data) =&gt; {</span>
<a href="#l40.670"></a><span id="l40.670">                     if (err) {</span>
<a href="#l40.671"></a><span id="l40.671">                         throw err;</span>
<a href="#l40.672"></a><span id="l40.672">                     }</span>
<a href="#l40.673"></a><span id="l40.673">                     // string to xml converter func without WCAP errno check:</span>
<a href="#l40.674"></a><span id="l40.674">                     if (!data || data.length == 0) { // assuming time-out</span>
<a href="#l40.675"></a><span id="l40.675">                         throw new Components.Exception(errorToString(calIWcapErrors.WCAP_LOGIN_FAILED),</span>
<a href="#l40.676"></a><span id="l40.676">                                                        calIWcapErrors.WCAP_LOGIN_FAILED);</span>
<a href="#l40.677"></a><span id="l40.677">                     }</span>
<a href="#l40.678"></a><span id="l40.678" class="difflineat">@@ -906,65 +888,64 @@ calWcapSession.prototype = {</span>
<a href="#l40.679"></a><span id="l40.679">                             checkWcapXmlErrno(node);</span>
<a href="#l40.680"></a><span id="l40.680">                             let ar = filterXmlNodes(&quot;X-NSCP-CALPROPS-RELATIVE-CALID&quot;, node);</span>
<a href="#l40.681"></a><span id="l40.681">                             if (ar.length &gt; 0) {</span>
<a href="#l40.682"></a><span id="l40.682">                                 let calId = ar[0];</span>
<a href="#l40.683"></a><span id="l40.683">                                 let calendar = registeredCalendars[calId];</span>
<a href="#l40.684"></a><span id="l40.684">                                 if (calendar) {</span>
<a href="#l40.685"></a><span id="l40.685">                                     calendar.m_calProps = node; // update calprops</span>
<a href="#l40.686"></a><span id="l40.686">                                 } else {</span>
<a href="#l40.687"></a><span id="l40.687" class="difflineminus">-                                    calendar = new calWcapCalendar(self, node);</span>
<a href="#l40.688"></a><span id="l40.688" class="difflineminus">-                                    let uri = self.uri.clone();</span>
<a href="#l40.689"></a><span id="l40.689" class="difflineplus">+                                    calendar = new calWcapCalendar(this, node);</span>
<a href="#l40.690"></a><span id="l40.690" class="difflineplus">+                                    let uri = this.uri.clone();</span>
<a href="#l40.691"></a><span id="l40.691">                                     uri.path += &quot;?calid=&quot; + encodeURIComponent(calId);</span>
<a href="#l40.692"></a><span id="l40.692">                                     calendar.uri = uri;</span>
<a href="#l40.693"></a><span id="l40.693">                                 }</span>
<a href="#l40.694"></a><span id="l40.694">                                 ret.push(calendar);</span>
<a href="#l40.695"></a><span id="l40.695">                             }</span>
<a href="#l40.696"></a><span id="l40.696">                         } catch (exc) {</span>
<a href="#l40.697"></a><span id="l40.697">                             switch (getResultCode(exc)) {</span>
<a href="#l40.698"></a><span id="l40.698">                                 case calIWcapErrors.WCAP_NO_ERRNO: // workaround</span>
<a href="#l40.699"></a><span id="l40.699">                                 case calIWcapErrors.WCAP_ACCESS_DENIED_TO_CALENDAR:</span>
<a href="#l40.700"></a><span id="l40.700" class="difflineminus">-                                    log(&quot;searchForCalendars_netResp() ignored error: &quot; + errorToString(exc), self);</span>
<a href="#l40.701"></a><span id="l40.701" class="difflineplus">+                                    log(&quot;searchForCalendars_netResp() ignored error: &quot; + errorToString(exc), this);</span>
<a href="#l40.702"></a><span id="l40.702">                                     break;</span>
<a href="#l40.703"></a><span id="l40.703">                                 default:</span>
<a href="#l40.704"></a><span id="l40.704" class="difflineminus">-                                    self.notifyError(exc);</span>
<a href="#l40.705"></a><span id="l40.705" class="difflineplus">+                                    this.notifyError(exc);</span>
<a href="#l40.706"></a><span id="l40.706">                                     break;</span>
<a href="#l40.707"></a><span id="l40.707">                             }</span>
<a href="#l40.708"></a><span id="l40.708">                         }</span>
<a href="#l40.709"></a><span id="l40.709">                     }</span>
<a href="#l40.710"></a><span id="l40.710" class="difflineminus">-                    log(&quot;search done. number of found calendars: &quot; + ret.length, self);</span>
<a href="#l40.711"></a><span id="l40.711" class="difflineplus">+                    log(&quot;search done. number of found calendars: &quot; + ret.length, this);</span>
<a href="#l40.712"></a><span id="l40.712">                     request.execRespFunc(null, ret);</span>
<a href="#l40.713"></a><span id="l40.713">                 },</span>
<a href="#l40.714"></a><span id="l40.714">                 null, &quot;search_calprops&quot;, params);</span>
<a href="#l40.715"></a><span id="l40.715">         } catch (exc) {</span>
<a href="#l40.716"></a><span id="l40.716">             request.execRespFunc(exc);</span>
<a href="#l40.717"></a><span id="l40.717">         }</span>
<a href="#l40.718"></a><span id="l40.718">         return request;</span>
<a href="#l40.719"></a><span id="l40.719">     },</span>
<a href="#l40.720"></a><span id="l40.720"> </span>
<a href="#l40.721"></a><span id="l40.721">     // calIFreeBusyProvider:</span>
<a href="#l40.722"></a><span id="l40.722">     getFreeBusyIntervals: function(calId, rangeStart, rangeEnd, busyTypes, listener) {</span>
<a href="#l40.723"></a><span id="l40.723">         rangeStart = ensureDateTime(rangeStart);</span>
<a href="#l40.724"></a><span id="l40.724">         rangeEnd = ensureDateTime(rangeEnd);</span>
<a href="#l40.725"></a><span id="l40.725">         let zRangeStart = getIcalUTC(rangeStart);</span>
<a href="#l40.726"></a><span id="l40.726">         let zRangeEnd = getIcalUTC(rangeEnd);</span>
<a href="#l40.727"></a><span id="l40.727"> </span>
<a href="#l40.728"></a><span id="l40.728" class="difflineminus">-        let self = this;</span>
<a href="#l40.729"></a><span id="l40.729">         let request = new calWcapRequest(</span>
<a href="#l40.730"></a><span id="l40.730" class="difflineminus">-            function(oprequest, err, data) {</span>
<a href="#l40.731"></a><span id="l40.731" class="difflineplus">+            (oprequest, err, data) =&gt; {</span>
<a href="#l40.732"></a><span id="l40.732">                 let rc = getResultCode(err);</span>
<a href="#l40.733"></a><span id="l40.733">                 switch (rc) {</span>
<a href="#l40.734"></a><span id="l40.734">                     case calIWcapErrors.WCAP_NO_ERRNO: // workaround</span>
<a href="#l40.735"></a><span id="l40.735">                     case calIWcapErrors.WCAP_ACCESS_DENIED_TO_CALENDAR:</span>
<a href="#l40.736"></a><span id="l40.736">                     case calIWcapErrors.WCAP_CALENDAR_DOES_NOT_EXIST:</span>
<a href="#l40.737"></a><span id="l40.737" class="difflineminus">-                        log(&quot;getFreeBusyIntervals_resp() error: &quot; + errorToString(err), self);</span>
<a href="#l40.738"></a><span id="l40.738" class="difflineplus">+                        log(&quot;getFreeBusyIntervals_resp() error: &quot; + errorToString(err), this);</span>
<a href="#l40.739"></a><span id="l40.739">                         break;</span>
<a href="#l40.740"></a><span id="l40.740">                     default:</span>
<a href="#l40.741"></a><span id="l40.741">                         if (!Components.isSuccessCode(rc)) {</span>
<a href="#l40.742"></a><span id="l40.742" class="difflineminus">-                            self.notifyError(err);</span>
<a href="#l40.743"></a><span id="l40.743" class="difflineplus">+                            this.notifyError(err);</span>
<a href="#l40.744"></a><span id="l40.744">                         }</span>
<a href="#l40.745"></a><span id="l40.745">                         break;</span>
<a href="#l40.746"></a><span id="l40.746">                 }</span>
<a href="#l40.747"></a><span id="l40.747">                 if (listener) {</span>
<a href="#l40.748"></a><span id="l40.748">                     listener.onResult(oprequest, data);</span>
<a href="#l40.749"></a><span id="l40.749">                 }</span>
<a href="#l40.750"></a><span id="l40.750">             },</span>
<a href="#l40.751"></a><span id="l40.751">             log(&quot;getFreeBusyIntervals():\n\tcalId=&quot; + calId +</span>
<a href="#l40.752"></a><span id="l40.752" class="difflineat">@@ -984,23 +965,23 @@ calWcapSession.prototype = {</span>
<a href="#l40.753"></a><span id="l40.753">             let params = &quot;&amp;calid=&quot; + encodeURIComponent(calId);</span>
<a href="#l40.754"></a><span id="l40.754">             params += &quot;&amp;busyonly=&quot; + (busyTypes &amp; calIFreeBusyInterval.FREE ? &quot;0&quot; : &quot;1&quot;);</span>
<a href="#l40.755"></a><span id="l40.755">             params += &quot;&amp;dtstart=&quot; + zRangeStart;</span>
<a href="#l40.756"></a><span id="l40.756">             params += &quot;&amp;dtend=&quot; + zRangeEnd;</span>
<a href="#l40.757"></a><span id="l40.757">             params += &quot;&amp;fmt-out=text%2Fxml&quot;;</span>
<a href="#l40.758"></a><span id="l40.758"> </span>
<a href="#l40.759"></a><span id="l40.759">             this.issueNetworkRequest(</span>
<a href="#l40.760"></a><span id="l40.760">                 request,</span>
<a href="#l40.761"></a><span id="l40.761" class="difflineminus">-                function(err, xml) {</span>
<a href="#l40.762"></a><span id="l40.762" class="difflineplus">+                (err, xml) =&gt; {</span>
<a href="#l40.763"></a><span id="l40.763">                     if (err) {</span>
<a href="#l40.764"></a><span id="l40.764">                         throw err;</span>
<a href="#l40.765"></a><span id="l40.765">                     }</span>
<a href="#l40.766"></a><span id="l40.766">                     if (LOG_LEVEL &gt; 0) {</span>
<a href="#l40.767"></a><span id="l40.767">                         log(&quot;getFreeBusyIntervals net_resp(): &quot; +</span>
<a href="#l40.768"></a><span id="l40.768" class="difflineminus">-                            getWcapRequestStatusString(xml), self);</span>
<a href="#l40.769"></a><span id="l40.769" class="difflineplus">+                            getWcapRequestStatusString(xml), this);</span>
<a href="#l40.770"></a><span id="l40.770">                     }</span>
<a href="#l40.771"></a><span id="l40.771">                     if (listener) {</span>
<a href="#l40.772"></a><span id="l40.772">                         let ret = [];</span>
<a href="#l40.773"></a><span id="l40.773">                         let nodeList = xml.getElementsByTagName(&quot;FB&quot;);</span>
<a href="#l40.774"></a><span id="l40.774"> </span>
<a href="#l40.775"></a><span id="l40.775">                         let fbTypeMap = {};</span>
<a href="#l40.776"></a><span id="l40.776">                         fbTypeMap.FREE = calIFreeBusyInterval.FREE;</span>
<a href="#l40.777"></a><span id="l40.777">                         fbTypeMap.BUSY = calIFreeBusyInterval.BUSY;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -55,17 +55,17 @@ var testEventDialog = function() {</span>
<a href="#l41.4"></a><span id="l41.4"> </span>
<a href="#l41.5"></a><span id="l41.5">   // pick day</span>
<a href="#l41.6"></a><span id="l41.6">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l41.7"></a><span id="l41.7">     'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l41.8"></a><span id="l41.8">   controller.sleep(sleep);</span>
<a href="#l41.9"></a><span id="l41.9"> </span>
<a href="#l41.10"></a><span id="l41.10">   // create new event</span>
<a href="#l41.11"></a><span id="l41.11">   controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l41.14"></a><span id="l41.14">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l41.15"></a><span id="l41.15"> </span>
<a href="#l41.16"></a><span id="l41.16">   // check that the start time is correct</span>
<a href="#l41.17"></a><span id="l41.17">   // next full hour except last hour hour of the day</span>
<a href="#l41.18"></a><span id="l41.18">   let now = new Date();</span>
<a href="#l41.19"></a><span id="l41.19">   let hour = now.getHours();</span>
<a href="#l41.20"></a><span id="l41.20">   let startHour = (hour == 23) ? hour : (hour + 1) % 24;</span>
<a href="#l41.21"></a><span id="l41.21">   let ampm = &quot;&quot;;</span>
<a href="#l41.22"></a><span id="l41.22" class="difflineat">@@ -136,22 +136,22 @@ var testEventDialog = function() {</span>
<a href="#l41.23"></a><span id="l41.23">   event.assertNode(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l41.24"></a><span id="l41.24">     'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;mozilla.org&quot;}'));</span>
<a href="#l41.25"></a><span id="l41.25"> </span>
<a href="#l41.26"></a><span id="l41.26">   // save</span>
<a href="#l41.27"></a><span id="l41.27">   calUtils.acceptSendingNotificationMail(event);</span>
<a href="#l41.28"></a><span id="l41.28">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l41.29"></a><span id="l41.29"> </span>
<a href="#l41.30"></a><span id="l41.30">   // catch and dismiss alarm</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length &gt; 0; }, sleep);</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length &gt; 0, sleep);</span>
<a href="#l41.33"></a><span id="l41.33">   let alarm = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;)[0]);</span>
<a href="#l41.34"></a><span id="l41.34">   // dismiss all button, label in .dtd file, bug #504635</span>
<a href="#l41.35"></a><span id="l41.35">   alarm.waitThenClick(new elementslib.Lookup(alarm.window.document, '/id(&quot;calendar-alarm-dialog&quot;)/' +</span>
<a href="#l41.36"></a><span id="l41.36">     'id(&quot;alarm-actionbar&quot;)/[1]'));</span>
<a href="#l41.37"></a><span id="l41.37" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length == 0; }, sleep);</span>
<a href="#l41.38"></a><span id="l41.38" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length == 0, sleep);</span>
<a href="#l41.39"></a><span id="l41.39"> </span>
<a href="#l41.40"></a><span id="l41.40">   // verify event and alarm icon visible every day of the month and check tooltip</span>
<a href="#l41.41"></a><span id="l41.41">   // 1st January is Thursday so there's three days to check in the first row</span>
<a href="#l41.42"></a><span id="l41.42">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l41.43"></a><span id="l41.43">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l41.44"></a><span id="l41.44">   checkIcon(eventBox, &quot;0&quot;, &quot;4&quot;);</span>
<a href="#l41.45"></a><span id="l41.45">   checkTooltip(monthView, &quot;0&quot;, &quot;4&quot;, &quot;1&quot;, startTime, endTime);</span>
<a href="#l41.46"></a><span id="l41.46"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -20,17 +20,17 @@ var testUTF8 = function() {</span>
<a href="#l42.4"></a><span id="l42.4">   let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l42.5"></a><span id="l42.5"> </span>
<a href="#l42.6"></a><span id="l42.6">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l42.7"></a><span id="l42.7">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l42.8"></a><span id="l42.8"> </span>
<a href="#l42.9"></a><span id="l42.9">   // create new event</span>
<a href="#l42.10"></a><span id="l42.10">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l42.11"></a><span id="l42.11">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)));</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l42.14"></a><span id="l42.14">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l42.15"></a><span id="l42.15"> </span>
<a href="#l42.16"></a><span id="l42.16">   // fill in name, location, description</span>
<a href="#l42.17"></a><span id="l42.17">   let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l42.18"></a><span id="l42.18">     'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l42.19"></a><span id="l42.19">     'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l42.20"></a><span id="l42.20">   event.waitForElement(titleTextBox);</span>
<a href="#l42.21"></a><span id="l42.21">   event.type(titleTextBox, UTF8string);</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineat">@@ -51,17 +51,17 @@ var testUTF8 = function() {</span>
<a href="#l42.23"></a><span id="l42.23">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l42.24"></a><span id="l42.24"> </span>
<a href="#l42.25"></a><span id="l42.25">   // open</span>
<a href="#l42.26"></a><span id="l42.26">   let eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l42.27"></a><span id="l42.27">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l42.28"></a><span id="l42.28">     '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + UTF8string.toLowerCase() + '&quot;}');</span>
<a href="#l42.29"></a><span id="l42.29">   controller.waitForElement(eventBox);</span>
<a href="#l42.30"></a><span id="l42.30">   controller.doubleClick(eventBox);</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l42.33"></a><span id="l42.33">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l42.34"></a><span id="l42.34"> </span>
<a href="#l42.35"></a><span id="l42.35">   // check values</span>
<a href="#l42.36"></a><span id="l42.36">   titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l42.37"></a><span id="l42.37">     'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l42.38"></a><span id="l42.38">     'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l42.39"></a><span id="l42.39">   event.waitForElement(titleTextBox);</span>
<a href="#l42.40"></a><span id="l42.40">   event.assertValue(titleTextBox, UTF8string);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testAnnualRecurrence.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testAnnualRecurrence.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -21,17 +21,17 @@ var testAnnualRecurrence = function() {</span>
<a href="#l43.4"></a><span id="l43.4">   controller.sleep(sleep);</span>
<a href="#l43.5"></a><span id="l43.5"> </span>
<a href="#l43.6"></a><span id="l43.6">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l43.7"></a><span id="l43.7">   calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l43.8"></a><span id="l43.8"> </span>
<a href="#l43.9"></a><span id="l43.9">   // create yearly recurring all-day event</span>
<a href="#l43.10"></a><span id="l43.10">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l43.11"></a><span id="l43.11">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l43.14"></a><span id="l43.14">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l43.15"></a><span id="l43.15">                  .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l43.16"></a><span id="l43.16">   event.sleep(sleep);</span>
<a href="#l43.17"></a><span id="l43.17">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l43.18"></a><span id="l43.18">     &quot;yearly&quot;);</span>
<a href="#l43.19"></a><span id="l43.19">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l43.20"></a><span id="l43.20">   controller.sleep(sleep);</span>
<a href="#l43.21"></a><span id="l43.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -18,23 +18,23 @@ var testBiweeklyRecurrence = function() </span>
<a href="#l44.4"></a><span id="l44.4"> </span>
<a href="#l44.5"></a><span id="l44.5">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l44.6"></a><span id="l44.6">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l44.7"></a><span id="l44.7">   calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l44.8"></a><span id="l44.8"> </span>
<a href="#l44.9"></a><span id="l44.9">   // create biweekly event</span>
<a href="#l44.10"></a><span id="l44.10">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l44.11"></a><span id="l44.11">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l44.14"></a><span id="l44.14">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l44.15"></a><span id="l44.15"> </span>
<a href="#l44.16"></a><span id="l44.16">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l44.17"></a><span id="l44.17">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l44.18"></a><span id="l44.18">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l44.19"></a><span id="l44.19" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0; });</span>
<a href="#l44.20"></a><span id="l44.20" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l44.21"></a><span id="l44.21"> </span>
<a href="#l44.22"></a><span id="l44.22">   let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l44.23"></a><span id="l44.23">     eventPath;</span>
<a href="#l44.24"></a><span id="l44.24"> </span>
<a href="#l44.25"></a><span id="l44.25">   // check day view</span>
<a href="#l44.26"></a><span id="l44.26">   for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l44.27"></a><span id="l44.27">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l44.28"></a><span id="l44.28">     calUtils.forward(controller, 14);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testDailyRecurrence.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testDailyRecurrence.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -18,17 +18,17 @@ var testDailyRecurrence = function() {</span>
<a href="#l45.4"></a><span id="l45.4"> </span>
<a href="#l45.5"></a><span id="l45.5">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l45.6"></a><span id="l45.6">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l45.7"></a><span id="l45.7">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l45.8"></a><span id="l45.8"> </span>
<a href="#l45.9"></a><span id="l45.9">   // create daily event</span>
<a href="#l45.10"></a><span id="l45.10">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l45.11"></a><span id="l45.11">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l45.14"></a><span id="l45.14">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l45.15"></a><span id="l45.15">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l45.16"></a><span id="l45.16"> </span>
<a href="#l45.17"></a><span id="l45.17">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l45.18"></a><span id="l45.18">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l45.19"></a><span id="l45.19">     &quot;daily&quot;);</span>
<a href="#l45.20"></a><span id="l45.20">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l45.21"></a><span id="l45.21"> </span>
<a href="#l45.22"></a><span id="l45.22" class="difflineat">@@ -125,25 +125,25 @@ var testDailyRecurrence = function() {</span>
<a href="#l45.23"></a><span id="l45.23">   // go to previous day to edit event to occur only on weekdays</span>
<a href="#l45.24"></a><span id="l45.24">   calUtils.back(controller, 1);</span>
<a href="#l45.25"></a><span id="l45.25"> </span>
<a href="#l45.26"></a><span id="l45.26">   calUtils.handleParentModification(controller, false);</span>
<a href="#l45.27"></a><span id="l45.27">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l45.28"></a><span id="l45.28">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l45.29"></a><span id="l45.29">       eventPath));</span>
<a href="#l45.30"></a><span id="l45.30"> </span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l45.33"></a><span id="l45.33">   event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l45.34"></a><span id="l45.34">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l45.35"></a><span id="l45.35"> </span>
<a href="#l45.36"></a><span id="l45.36">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l45.37"></a><span id="l45.37">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l45.38"></a><span id="l45.38">     &quot;every.weekday&quot;);</span>
<a href="#l45.39"></a><span id="l45.39">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l45.40"></a><span id="l45.40" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0; });</span>
<a href="#l45.41"></a><span id="l45.41" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l45.42"></a><span id="l45.42"> </span>
<a href="#l45.43"></a><span id="l45.43">   // check day view for 7 days</span>
<a href="#l45.44"></a><span id="l45.44">   let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l45.45"></a><span id="l45.45">     eventPath;</span>
<a href="#l45.46"></a><span id="l45.46">   let dates = [[2009, 1, 3],</span>
<a href="#l45.47"></a><span id="l45.47">                [2009, 1, 4]];</span>
<a href="#l45.48"></a><span id="l45.48">   for (let i = 0; i &lt; dates.length; i++) {</span>
<a href="#l45.49"></a><span id="l45.49">     calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -18,28 +18,28 @@ var testLastDayOfMonthRecurrence = funct</span>
<a href="#l46.4"></a><span id="l46.4">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l46.5"></a><span id="l46.5">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l46.6"></a><span id="l46.6">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l46.7"></a><span id="l46.7">   calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l46.8"></a><span id="l46.8"> </span>
<a href="#l46.9"></a><span id="l46.9">   // create monthly recurring event</span>
<a href="#l46.10"></a><span id="l46.10">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l46.11"></a><span id="l46.11">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l46.14"></a><span id="l46.14">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l46.15"></a><span id="l46.15">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l46.16"></a><span id="l46.16"> </span>
<a href="#l46.17"></a><span id="l46.17">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l46.18"></a><span id="l46.18">   md.start(setRecurrence);</span>
<a href="#l46.19"></a><span id="l46.19">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l46.20"></a><span id="l46.20">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l46.21"></a><span id="l46.21">     &quot;custom&quot;);</span>
<a href="#l46.22"></a><span id="l46.22"> </span>
<a href="#l46.23"></a><span id="l46.23">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l46.24"></a><span id="l46.24" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0; });</span>
<a href="#l46.25"></a><span id="l46.25" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l46.26"></a><span id="l46.26"> </span>
<a href="#l46.27"></a><span id="l46.27">   //                        date     correct row in month view</span>
<a href="#l46.28"></a><span id="l46.28">   let checkingData = [[2008, 1, 31, 5],</span>
<a href="#l46.29"></a><span id="l46.29">                       [2008, 2, 29, 5],</span>
<a href="#l46.30"></a><span id="l46.30">                       [2008, 3, 31, 6],</span>
<a href="#l46.31"></a><span id="l46.31">                       [2008, 4, 30, 5],</span>
<a href="#l46.32"></a><span id="l46.32">                       [2008, 5, 31, 5],</span>
<a href="#l46.33"></a><span id="l46.33">                       [2008, 6, 30, 5],</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -18,25 +18,25 @@ var testAnnualRecurrence = function() {</span>
<a href="#l47.4"></a><span id="l47.4">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l47.5"></a><span id="l47.5"> </span>
<a href="#l47.6"></a><span id="l47.6">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l47.7"></a><span id="l47.7">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l47.8"></a><span id="l47.8">   calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l47.9"></a><span id="l47.9"> </span>
<a href="#l47.10"></a><span id="l47.10">   // rotate view</span>
<a href="#l47.11"></a><span id="l47.11">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l47.14"></a><span id="l47.14">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l47.15"></a><span id="l47.15">     return view.orient == &quot;horizontal&quot;;</span>
<a href="#l47.16"></a><span id="l47.16">   });</span>
<a href="#l47.17"></a><span id="l47.17"> </span>
<a href="#l47.18"></a><span id="l47.18">   // create yearly recurring all-day event</span>
<a href="#l47.19"></a><span id="l47.19">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l47.20"></a><span id="l47.20">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l47.21"></a><span id="l47.21" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l47.23"></a><span id="l47.23">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l47.24"></a><span id="l47.24">                  .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l47.25"></a><span id="l47.25">   event.sleep(sleep);</span>
<a href="#l47.26"></a><span id="l47.26">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l47.27"></a><span id="l47.27">     &quot;yearly&quot;);</span>
<a href="#l47.28"></a><span id="l47.28">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l47.29"></a><span id="l47.29">   controller.sleep(sleep);</span>
<a href="#l47.30"></a><span id="l47.30"> </span>
<a href="#l47.31"></a><span id="l47.31" class="difflineat">@@ -80,17 +80,17 @@ var testAnnualRecurrence = function() {</span>
<a href="#l47.32"></a><span id="l47.32">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l47.33"></a><span id="l47.33">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l47.34"></a><span id="l47.34">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l47.35"></a><span id="l47.35">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l47.36"></a><span id="l47.36">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l47.37"></a><span id="l47.37"> </span>
<a href="#l47.38"></a><span id="l47.38">   // reset view</span>
<a href="#l47.39"></a><span id="l47.39">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l47.40"></a><span id="l47.40" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l47.41"></a><span id="l47.41" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l47.42"></a><span id="l47.42">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l47.43"></a><span id="l47.43">     return view.orient == &quot;vertical&quot;;</span>
<a href="#l47.44"></a><span id="l47.44">   });</span>
<a href="#l47.45"></a><span id="l47.45"> };</span>
<a href="#l47.46"></a><span id="l47.46"> </span>
<a href="#l47.47"></a><span id="l47.47"> var teardownTest = function(module) {</span>
<a href="#l47.48"></a><span id="l47.48">   calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l47.49"></a><span id="l47.49"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -17,31 +17,31 @@ var testBiweeklyRecurrence = function() </span>
<a href="#l48.4"></a><span id="l48.4">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l48.5"></a><span id="l48.5"> </span>
<a href="#l48.6"></a><span id="l48.6">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l48.7"></a><span id="l48.7">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l48.8"></a><span id="l48.8">   calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l48.9"></a><span id="l48.9"> </span>
<a href="#l48.10"></a><span id="l48.10">   // rotate view</span>
<a href="#l48.11"></a><span id="l48.11">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l48.14"></a><span id="l48.14">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l48.15"></a><span id="l48.15">     return view.orient == &quot;horizontal&quot;;</span>
<a href="#l48.16"></a><span id="l48.16">   });</span>
<a href="#l48.17"></a><span id="l48.17"> </span>
<a href="#l48.18"></a><span id="l48.18">   // create biweekly event</span>
<a href="#l48.19"></a><span id="l48.19">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l48.20"></a><span id="l48.20">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l48.21"></a><span id="l48.21" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l48.22"></a><span id="l48.22" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l48.23"></a><span id="l48.23">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l48.24"></a><span id="l48.24"> </span>
<a href="#l48.25"></a><span id="l48.25">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l48.26"></a><span id="l48.26">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l48.27"></a><span id="l48.27">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l48.28"></a><span id="l48.28" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0; });</span>
<a href="#l48.29"></a><span id="l48.29" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l48.30"></a><span id="l48.30"> </span>
<a href="#l48.31"></a><span id="l48.31">   let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l48.32"></a><span id="l48.32">     eventPath;</span>
<a href="#l48.33"></a><span id="l48.33"> </span>
<a href="#l48.34"></a><span id="l48.34">   // check day view</span>
<a href="#l48.35"></a><span id="l48.35">   for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l48.36"></a><span id="l48.36">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l48.37"></a><span id="l48.37">     calUtils.forward(controller, 14);</span>
<a href="#l48.38"></a><span id="l48.38" class="difflineat">@@ -105,17 +105,17 @@ var testBiweeklyRecurrence = function() </span>
<a href="#l48.39"></a><span id="l48.39">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l48.40"></a><span id="l48.40">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l48.41"></a><span id="l48.41">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l48.42"></a><span id="l48.42">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l48.43"></a><span id="l48.43"> </span>
<a href="#l48.44"></a><span id="l48.44">   // reset view</span>
<a href="#l48.45"></a><span id="l48.45">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l48.46"></a><span id="l48.46">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l48.47"></a><span id="l48.47" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l48.48"></a><span id="l48.48" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l48.49"></a><span id="l48.49">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l48.50"></a><span id="l48.50">     return view.orient == &quot;vertical&quot;;</span>
<a href="#l48.51"></a><span id="l48.51">   });</span>
<a href="#l48.52"></a><span id="l48.52"> };</span>
<a href="#l48.53"></a><span id="l48.53"> </span>
<a href="#l48.54"></a><span id="l48.54"> var teardownTest = function(module) {</span>
<a href="#l48.55"></a><span id="l48.55">   calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l48.56"></a><span id="l48.56"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -17,25 +17,25 @@ var testDailyRecurrence = function() {</span>
<a href="#l49.4"></a><span id="l49.4">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l49.5"></a><span id="l49.5"> </span>
<a href="#l49.6"></a><span id="l49.6">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l49.7"></a><span id="l49.7">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l49.8"></a><span id="l49.8">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l49.9"></a><span id="l49.9"> </span>
<a href="#l49.10"></a><span id="l49.10">   // rotate view</span>
<a href="#l49.11"></a><span id="l49.11">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l49.14"></a><span id="l49.14">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l49.15"></a><span id="l49.15">     return view.orient == &quot;horizontal&quot;;</span>
<a href="#l49.16"></a><span id="l49.16">   });</span>
<a href="#l49.17"></a><span id="l49.17"> </span>
<a href="#l49.18"></a><span id="l49.18">   // create daily event</span>
<a href="#l49.19"></a><span id="l49.19">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l49.20"></a><span id="l49.20">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l49.21"></a><span id="l49.21" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l49.22"></a><span id="l49.22" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l49.23"></a><span id="l49.23">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l49.24"></a><span id="l49.24">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l49.25"></a><span id="l49.25"> </span>
<a href="#l49.26"></a><span id="l49.26">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l49.27"></a><span id="l49.27">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l49.28"></a><span id="l49.28">     &quot;daily&quot;);</span>
<a href="#l49.29"></a><span id="l49.29">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l49.30"></a><span id="l49.30"> </span>
<a href="#l49.31"></a><span id="l49.31" class="difflineat">@@ -132,25 +132,25 @@ var testDailyRecurrence = function() {</span>
<a href="#l49.32"></a><span id="l49.32">   // go to previous day to edit event to occur only on weekdays</span>
<a href="#l49.33"></a><span id="l49.33">   calUtils.back(controller, 1);</span>
<a href="#l49.34"></a><span id="l49.34"> </span>
<a href="#l49.35"></a><span id="l49.35">   calUtils.handleParentModification(controller, false);</span>
<a href="#l49.36"></a><span id="l49.36">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l49.37"></a><span id="l49.37">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l49.38"></a><span id="l49.38">       eventPath));</span>
<a href="#l49.39"></a><span id="l49.39"> </span>
<a href="#l49.40"></a><span id="l49.40" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l49.42"></a><span id="l49.42">   event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l49.43"></a><span id="l49.43">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l49.44"></a><span id="l49.44"> </span>
<a href="#l49.45"></a><span id="l49.45">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l49.46"></a><span id="l49.46">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l49.47"></a><span id="l49.47">     &quot;every.weekday&quot;);</span>
<a href="#l49.48"></a><span id="l49.48">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l49.49"></a><span id="l49.49" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0; });</span>
<a href="#l49.50"></a><span id="l49.50" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l49.51"></a><span id="l49.51"> </span>
<a href="#l49.52"></a><span id="l49.52">   // check day view for 7 days</span>
<a href="#l49.53"></a><span id="l49.53">   let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l49.54"></a><span id="l49.54">     eventPath;</span>
<a href="#l49.55"></a><span id="l49.55">   let dates = [[2009, 1, 3],</span>
<a href="#l49.56"></a><span id="l49.56">                [2009, 1, 4]];</span>
<a href="#l49.57"></a><span id="l49.57">   for (let i = 0; i &lt; dates.length; i++) {</span>
<a href="#l49.58"></a><span id="l49.58">     calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span>
<a href="#l49.59"></a><span id="l49.59" class="difflineat">@@ -204,17 +204,17 @@ var testDailyRecurrence = function() {</span>
<a href="#l49.60"></a><span id="l49.60">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l49.61"></a><span id="l49.61">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l49.62"></a><span id="l49.62">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l49.63"></a><span id="l49.63">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l49.64"></a><span id="l49.64"> </span>
<a href="#l49.65"></a><span id="l49.65">   // reset view</span>
<a href="#l49.66"></a><span id="l49.66">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l49.67"></a><span id="l49.67">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l49.68"></a><span id="l49.68" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l49.69"></a><span id="l49.69" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l49.70"></a><span id="l49.70">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l49.71"></a><span id="l49.71">     return view.orient == &quot;vertical&quot;;</span>
<a href="#l49.72"></a><span id="l49.72">   });</span>
<a href="#l49.73"></a><span id="l49.73"> };</span>
<a href="#l49.74"></a><span id="l49.74"> </span>
<a href="#l49.75"></a><span id="l49.75"> var teardownTest = function(module) {</span>
<a href="#l49.76"></a><span id="l49.76">   calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l49.77"></a><span id="l49.77"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -17,36 +17,36 @@ var setupModule = function(module) {</span>
<a href="#l50.4"></a><span id="l50.4"> var testLastDayOfMonthRecurrence = function() {</span>
<a href="#l50.5"></a><span id="l50.5">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l50.6"></a><span id="l50.6">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l50.7"></a><span id="l50.7">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l50.8"></a><span id="l50.8">   calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l50.9"></a><span id="l50.9"> </span>
<a href="#l50.10"></a><span id="l50.10">   // rotate view</span>
<a href="#l50.11"></a><span id="l50.11">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l50.14"></a><span id="l50.14">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l50.15"></a><span id="l50.15">     return view.orient == &quot;horizontal&quot;;</span>
<a href="#l50.16"></a><span id="l50.16">   });</span>
<a href="#l50.17"></a><span id="l50.17"> </span>
<a href="#l50.18"></a><span id="l50.18">   // create monthly recurring event</span>
<a href="#l50.19"></a><span id="l50.19">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l50.20"></a><span id="l50.20">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l50.21"></a><span id="l50.21" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l50.22"></a><span id="l50.22" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l50.23"></a><span id="l50.23">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l50.24"></a><span id="l50.24">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l50.25"></a><span id="l50.25"> </span>
<a href="#l50.26"></a><span id="l50.26">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l50.27"></a><span id="l50.27">   md.start(setRecurrence);</span>
<a href="#l50.28"></a><span id="l50.28">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l50.29"></a><span id="l50.29">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l50.30"></a><span id="l50.30">     &quot;custom&quot;);</span>
<a href="#l50.31"></a><span id="l50.31"> </span>
<a href="#l50.32"></a><span id="l50.32">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l50.33"></a><span id="l50.33" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0; });</span>
<a href="#l50.34"></a><span id="l50.34" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l50.35"></a><span id="l50.35"> </span>
<a href="#l50.36"></a><span id="l50.36">   //                      date      correct row in month view</span>
<a href="#l50.37"></a><span id="l50.37">   //                   vvvvvvvvvvv  v</span>
<a href="#l50.38"></a><span id="l50.38">   let checkingData = [[2008, 1, 31, 5],</span>
<a href="#l50.39"></a><span id="l50.39">                       [2008, 2, 29, 5],</span>
<a href="#l50.40"></a><span id="l50.40">                       [2008, 3, 31, 6],</span>
<a href="#l50.41"></a><span id="l50.41">                       [2008, 4, 30, 5],</span>
<a href="#l50.42"></a><span id="l50.42">                       [2008, 5, 31, 5],</span>
<a href="#l50.43"></a><span id="l50.43" class="difflineat">@@ -101,17 +101,17 @@ var testLastDayOfMonthRecurrence = funct</span>
<a href="#l50.44"></a><span id="l50.44">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l50.45"></a><span id="l50.45">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l50.46"></a><span id="l50.46">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l50.47"></a><span id="l50.47">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l50.48"></a><span id="l50.48">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l50.49"></a><span id="l50.49"> </span>
<a href="#l50.50"></a><span id="l50.50">   // reset view</span>
<a href="#l50.51"></a><span id="l50.51">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l50.52"></a><span id="l50.52" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l50.53"></a><span id="l50.53" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l50.54"></a><span id="l50.54">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l50.55"></a><span id="l50.55">     return view.orient == &quot;vertical&quot;;</span>
<a href="#l50.56"></a><span id="l50.56">   });</span>
<a href="#l50.57"></a><span id="l50.57"> };</span>
<a href="#l50.58"></a><span id="l50.58"> </span>
<a href="#l50.59"></a><span id="l50.59"> function setRecurrence(recurrence) {</span>
<a href="#l50.60"></a><span id="l50.60">   recurrence.sleep(sleep);</span>
<a href="#l50.61"></a><span id="l50.61"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -18,17 +18,17 @@ var setupModule = function(module) {</span>
<a href="#l51.4"></a><span id="l51.4"> </span>
<a href="#l51.5"></a><span id="l51.5"> var testWeeklyNRecurrence = function() {</span>
<a href="#l51.6"></a><span id="l51.6">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l51.7"></a><span id="l51.7">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l51.8"></a><span id="l51.8">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l51.9"></a><span id="l51.9"> </span>
<a href="#l51.10"></a><span id="l51.10">   // rotate view</span>
<a href="#l51.11"></a><span id="l51.11">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l51.14"></a><span id="l51.14">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l51.15"></a><span id="l51.15">     return view.orient == &quot;horizontal&quot;;</span>
<a href="#l51.16"></a><span id="l51.16">   });</span>
<a href="#l51.17"></a><span id="l51.17"> </span>
<a href="#l51.18"></a><span id="l51.18">   // create weekly recurring event</span>
<a href="#l51.19"></a><span id="l51.19">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l51.20"></a><span id="l51.20">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l51.21"></a><span id="l51.21">   controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l51.22"></a><span id="l51.22" class="difflineat">@@ -85,17 +85,17 @@ var testWeeklyNRecurrence = function() {</span>
<a href="#l51.23"></a><span id="l51.23">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l51.24"></a><span id="l51.24">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l51.25"></a><span id="l51.25">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l51.26"></a><span id="l51.26">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l51.27"></a><span id="l51.27"> </span>
<a href="#l51.28"></a><span id="l51.28">   // reset view</span>
<a href="#l51.29"></a><span id="l51.29">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l51.30"></a><span id="l51.30">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l51.31"></a><span id="l51.31" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l51.32"></a><span id="l51.32" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l51.33"></a><span id="l51.33">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l51.34"></a><span id="l51.34">     return view.orient == &quot;vertical&quot;;</span>
<a href="#l51.35"></a><span id="l51.35">   });</span>
<a href="#l51.36"></a><span id="l51.36"> };</span>
<a href="#l51.37"></a><span id="l51.37"> </span>
<a href="#l51.38"></a><span id="l51.38"> function setRecurrence(recurrence) {</span>
<a href="#l51.39"></a><span id="l51.39">   // weekly</span>
<a href="#l51.40"></a><span id="l51.40">   recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -19,17 +19,17 @@ var setupModule = function(module) {</span>
<a href="#l52.4"></a><span id="l52.4"> </span>
<a href="#l52.5"></a><span id="l52.5"> var testWeeklyUntilRecurrence = function() {</span>
<a href="#l52.6"></a><span id="l52.6">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l52.7"></a><span id="l52.7">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l52.8"></a><span id="l52.8">   calUtils.goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l52.9"></a><span id="l52.9"> </span>
<a href="#l52.10"></a><span id="l52.10">   // rotate view</span>
<a href="#l52.11"></a><span id="l52.11">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l52.14"></a><span id="l52.14">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l52.15"></a><span id="l52.15">     return view.orient == &quot;horizontal&quot;;</span>
<a href="#l52.16"></a><span id="l52.16">   });</span>
<a href="#l52.17"></a><span id="l52.17"> </span>
<a href="#l52.18"></a><span id="l52.18">   // create weekly recurring event</span>
<a href="#l52.19"></a><span id="l52.19">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l52.20"></a><span id="l52.20">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l52.21"></a><span id="l52.21">   controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l52.22"></a><span id="l52.22" class="difflineat">@@ -112,17 +112,17 @@ var testWeeklyUntilRecurrence = function</span>
<a href="#l52.23"></a><span id="l52.23">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l52.24"></a><span id="l52.24">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l52.25"></a><span id="l52.25">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l52.26"></a><span id="l52.26">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l52.27"></a><span id="l52.27"> </span>
<a href="#l52.28"></a><span id="l52.28">   // reset view</span>
<a href="#l52.29"></a><span id="l52.29">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l52.30"></a><span id="l52.30">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l52.31"></a><span id="l52.31" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l52.32"></a><span id="l52.32" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l52.33"></a><span id="l52.33">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l52.34"></a><span id="l52.34">     return view.orient == &quot;vertical&quot;;</span>
<a href="#l52.35"></a><span id="l52.35">   });</span>
<a href="#l52.36"></a><span id="l52.36"> };</span>
<a href="#l52.37"></a><span id="l52.37"> </span>
<a href="#l52.38"></a><span id="l52.38"> function setRecurrence(recurrence) {</span>
<a href="#l52.39"></a><span id="l52.39">   // weekly</span>
<a href="#l52.40"></a><span id="l52.40">   recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -19,17 +19,17 @@ var setupModule = function(module) {</span>
<a href="#l53.4"></a><span id="l53.4"> </span>
<a href="#l53.5"></a><span id="l53.5"> var testWeeklyWithExceptionRecurrence = function() {</span>
<a href="#l53.6"></a><span id="l53.6">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l53.7"></a><span id="l53.7">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l53.8"></a><span id="l53.8">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l53.9"></a><span id="l53.9"> </span>
<a href="#l53.10"></a><span id="l53.10">   // rotate view</span>
<a href="#l53.11"></a><span id="l53.11">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l53.14"></a><span id="l53.14">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l53.15"></a><span id="l53.15">     return view.orient == &quot;horizontal&quot;;</span>
<a href="#l53.16"></a><span id="l53.16">   });</span>
<a href="#l53.17"></a><span id="l53.17"> </span>
<a href="#l53.18"></a><span id="l53.18">   // create weekly recurring event</span>
<a href="#l53.19"></a><span id="l53.19">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.20"></a><span id="l53.20">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l53.21"></a><span id="l53.21">   controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l53.22"></a><span id="l53.22" class="difflineat">@@ -204,17 +204,17 @@ var testWeeklyWithExceptionRecurrence = </span>
<a href="#l53.23"></a><span id="l53.23">   controller.click(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l53.24"></a><span id="l53.24">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l53.25"></a><span id="l53.25">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l53.26"></a><span id="l53.26">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l53.27"></a><span id="l53.27">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l53.28"></a><span id="l53.28"> </span>
<a href="#l53.29"></a><span id="l53.29">   // reset view</span>
<a href="#l53.30"></a><span id="l53.30">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l53.31"></a><span id="l53.31" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l53.32"></a><span id="l53.32" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l53.33"></a><span id="l53.33">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l53.34"></a><span id="l53.34">     return view.orient == &quot;vertical&quot;;</span>
<a href="#l53.35"></a><span id="l53.35">   });</span>
<a href="#l53.36"></a><span id="l53.36"> };</span>
<a href="#l53.37"></a><span id="l53.37"> </span>
<a href="#l53.38"></a><span id="l53.38"> function setRecurrence(recurrence) {</span>
<a href="#l53.39"></a><span id="l53.39">   // weekly</span>
<a href="#l53.40"></a><span id="l53.40">   recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -17,31 +17,31 @@ var EVENT_BOX = 0; // Use when you need </span>
<a href="#l54.4"></a><span id="l54.4"> var CANVAS_BOX = 1; // Use when you need a calendar canvas box</span>
<a href="#l54.5"></a><span id="l54.5"> var ALLDAY = 2; // Use when you need an allday canvas or event box</span>
<a href="#l54.6"></a><span id="l54.6"> </span>
<a href="#l54.7"></a><span id="l54.7"> /**</span>
<a href="#l54.8"></a><span id="l54.8">  *  Accept to send notification email with event to attendees</span>
<a href="#l54.9"></a><span id="l54.9">  *  @param controller - Mozmill window controller</span>
<a href="#l54.10"></a><span id="l54.10">  */</span>
<a href="#l54.11"></a><span id="l54.11"> function acceptSendingNotificationMail(controller) {</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-  modalDialog.plan_for_modal_dialog(&quot;commonDialog&quot;, function(dialog) {</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+  modalDialog.plan_for_modal_dialog(&quot;commonDialog&quot;, (dialog) =&gt; {</span>
<a href="#l54.14"></a><span id="l54.14">       dialog.waitThenClick(new elementslib.Lookup(dialog.window.document, '/id(&quot;commonDialog&quot;)/' +</span>
<a href="#l54.15"></a><span id="l54.15">         'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l54.16"></a><span id="l54.16">     }</span>
<a href="#l54.17"></a><span id="l54.17">   );</span>
<a href="#l54.18"></a><span id="l54.18"> </span>
<a href="#l54.19"></a><span id="l54.19">   modalDialog.wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l54.20"></a><span id="l54.20"> }</span>
<a href="#l54.21"></a><span id="l54.21"> </span>
<a href="#l54.22"></a><span id="l54.22"> /**</span>
<a href="#l54.23"></a><span id="l54.23">  *  Add an attachment with url</span>
<a href="#l54.24"></a><span id="l54.24">  *  @param controller - Mozmill window controller</span>
<a href="#l54.25"></a><span id="l54.25">  */</span>
<a href="#l54.26"></a><span id="l54.26"> function handleAddingAttachment(controller, url) {</span>
<a href="#l54.27"></a><span id="l54.27" class="difflineminus">-  modalDialog.plan_for_modal_dialog(&quot;commonDialog&quot;, function(attachment) {</span>
<a href="#l54.28"></a><span id="l54.28" class="difflineplus">+  modalDialog.plan_for_modal_dialog(&quot;commonDialog&quot;, (attachment) =&gt; {</span>
<a href="#l54.29"></a><span id="l54.29">     let input = new elementslib.ID(attachment.window.document, &quot;loginTextbox&quot;);</span>
<a href="#l54.30"></a><span id="l54.30">     attachment.waitForElement(input);</span>
<a href="#l54.31"></a><span id="l54.31">     input.getNode().value = url;</span>
<a href="#l54.32"></a><span id="l54.32">     attachment.click(new elementslib.Lookup(attachment.window.document, '/id(&quot;commonDialog&quot;)/' +</span>
<a href="#l54.33"></a><span id="l54.33">       'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l54.34"></a><span id="l54.34">   });</span>
<a href="#l54.35"></a><span id="l54.35"> </span>
<a href="#l54.36"></a><span id="l54.36">   modalDialog.wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l54.37"></a><span id="l54.37" class="difflineat">@@ -100,44 +100,44 @@ function handleParentModification(contro</span>
<a href="#l54.38"></a><span id="l54.38">  *  @param controller - Mozmill window controller</span>
<a href="#l54.39"></a><span id="l54.39">  *  @param view - day, week, multiweek or month</span>
<a href="#l54.40"></a><span id="l54.40">  */</span>
<a href="#l54.41"></a><span id="l54.41"> function switchToView(controller, view) {</span>
<a href="#l54.42"></a><span id="l54.42">   switch (view) {</span>
<a href="#l54.43"></a><span id="l54.43">     case &quot;week&quot;:</span>
<a href="#l54.44"></a><span id="l54.44">       controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l54.45"></a><span id="l54.45">         &quot;calendar-week-view-button&quot;));</span>
<a href="#l54.46"></a><span id="l54.46" class="difflineminus">-      controller.waitFor(function() {</span>
<a href="#l54.47"></a><span id="l54.47" class="difflineplus">+      controller.waitFor(() =&gt; {</span>
<a href="#l54.48"></a><span id="l54.48">         let button = new elementslib.ID(controller.window.document,</span>
<a href="#l54.49"></a><span id="l54.49">         &quot;calendar-week-view-button&quot;);</span>
<a href="#l54.50"></a><span id="l54.50">         return button.getNode().selected == true;</span>
<a href="#l54.51"></a><span id="l54.51">       });</span>
<a href="#l54.52"></a><span id="l54.52">       break;</span>
<a href="#l54.53"></a><span id="l54.53">     case &quot;multiweek&quot;:</span>
<a href="#l54.54"></a><span id="l54.54">       controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l54.55"></a><span id="l54.55">         &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l54.56"></a><span id="l54.56" class="difflineminus">-      controller.waitFor(function() {</span>
<a href="#l54.57"></a><span id="l54.57" class="difflineplus">+      controller.waitFor(() =&gt; {</span>
<a href="#l54.58"></a><span id="l54.58">         let button = new elementslib.ID(controller.window.document,</span>
<a href="#l54.59"></a><span id="l54.59">         &quot;calendar-multiweek-view-button&quot;);</span>
<a href="#l54.60"></a><span id="l54.60">         return button.getNode().selected == true;</span>
<a href="#l54.61"></a><span id="l54.61">       });</span>
<a href="#l54.62"></a><span id="l54.62">       break;</span>
<a href="#l54.63"></a><span id="l54.63">     case &quot;month&quot;:</span>
<a href="#l54.64"></a><span id="l54.64">       controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l54.65"></a><span id="l54.65">         &quot;calendar-month-view-button&quot;));</span>
<a href="#l54.66"></a><span id="l54.66" class="difflineminus">-      controller.waitFor(function() {</span>
<a href="#l54.67"></a><span id="l54.67" class="difflineplus">+      controller.waitFor(() =&gt; {</span>
<a href="#l54.68"></a><span id="l54.68">         let button = new elementslib.ID(controller.window.document,</span>
<a href="#l54.69"></a><span id="l54.69">         &quot;calendar-month-view-button&quot;);</span>
<a href="#l54.70"></a><span id="l54.70">         return button.getNode().selected == true;</span>
<a href="#l54.71"></a><span id="l54.71">       });</span>
<a href="#l54.72"></a><span id="l54.72">       break;</span>
<a href="#l54.73"></a><span id="l54.73">     default:</span>
<a href="#l54.74"></a><span id="l54.74">       controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l54.75"></a><span id="l54.75">         &quot;calendar-day-view-button&quot;));</span>
<a href="#l54.76"></a><span id="l54.76" class="difflineminus">-      controller.waitFor(function() {</span>
<a href="#l54.77"></a><span id="l54.77" class="difflineplus">+      controller.waitFor(() =&gt; {</span>
<a href="#l54.78"></a><span id="l54.78">         let button = new elementslib.ID(controller.window.document,</span>
<a href="#l54.79"></a><span id="l54.79">         &quot;calendar-day-view-button&quot;);</span>
<a href="#l54.80"></a><span id="l54.80">         return button.getNode().selected == true;</span>
<a href="#l54.81"></a><span id="l54.81">       });</span>
<a href="#l54.82"></a><span id="l54.82">   }</span>
<a href="#l54.83"></a><span id="l54.83"> }</span>
<a href="#l54.84"></a><span id="l54.84"> </span>
<a href="#l54.85"></a><span id="l54.85"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/calendar/test/mozmill/testLocalICS.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/calendar/test/mozmill/testLocalICS.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -41,17 +41,17 @@ var testLocalICS = function() {</span>
<a href="#l55.4"></a><span id="l55.4"> </span>
<a href="#l55.5"></a><span id="l55.5">   modalDialog.plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, handleNewCalendarWizard);</span>
<a href="#l55.6"></a><span id="l55.6">   controller.mainMenu.click(&quot;#ltnNewCalendar&quot;);</span>
<a href="#l55.7"></a><span id="l55.7">   modalDialog.wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l55.8"></a><span id="l55.8"> </span>
<a href="#l55.9"></a><span id="l55.9">   // create new event</span>
<a href="#l55.10"></a><span id="l55.10">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l55.11"></a><span id="l55.11">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l55.14"></a><span id="l55.14">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l55.15"></a><span id="l55.15">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l55.16"></a><span id="l55.16"> </span>
<a href="#l55.17"></a><span id="l55.17">   // let the iframe load</span>
<a href="#l55.18"></a><span id="l55.18">   let iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l55.19"></a><span id="l55.19">   event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l55.20"></a><span id="l55.20"> </span>
<a href="#l55.21"></a><span id="l55.21">   // title</span>
<a href="#l55.22"></a><span id="l55.22" class="difflineat">@@ -122,14 +122,14 @@ function handleNewCalendarWizard(wizard)</span>
<a href="#l55.23"></a><span id="l55.23">   // enter location</span>
<a href="#l55.24"></a><span id="l55.24">   wizard.type(new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l55.25"></a><span id="l55.25">     '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calendar-uri&quot;)/' +</span>
<a href="#l55.26"></a><span id="l55.26">     'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l55.27"></a><span id="l55.27">     uri);</span>
<a href="#l55.28"></a><span id="l55.28">   docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l55.29"></a><span id="l55.29"> </span>
<a href="#l55.30"></a><span id="l55.30">   // name is filled in automatically using filename</span>
<a href="#l55.31"></a><span id="l55.31" class="difflineminus">-  wizard.waitFor(function() { return docEl.getButton(&quot;next&quot;).disabled == false; });</span>
<a href="#l55.32"></a><span id="l55.32" class="difflineplus">+  wizard.waitFor(() =&gt; docEl.getButton(&quot;next&quot;).disabled == false);</span>
<a href="#l55.33"></a><span id="l55.33">   docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l55.34"></a><span id="l55.34"> </span>
<a href="#l55.35"></a><span id="l55.35">   // finish</span>
<a href="#l55.36"></a><span id="l55.36">   docEl.getButton(&quot;finish&quot;).doCommand();</span>
<a href="#l55.37"></a><span id="l55.37"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/calendar/test/mozmill/testTodayPane.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/calendar/test/mozmill/testTodayPane.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -54,64 +54,64 @@ var testTodayPane = function() {</span>
<a href="#l56.4"></a><span id="l56.4">   if (startHour &lt; 8 || startHour &gt; 16) {</span>
<a href="#l56.5"></a><span id="l56.5">     view.scrollToMinute(60 * startHour);</span>
<a href="#l56.6"></a><span id="l56.6">   }</span>
<a href="#l56.7"></a><span id="l56.7"> </span>
<a href="#l56.8"></a><span id="l56.8">   controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l56.9"></a><span id="l56.9">     'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l56.10"></a><span id="l56.10">     '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l56.11"></a><span id="l56.11">     'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + startHour + &quot;]&quot;), 1, 1);</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l56.14"></a><span id="l56.14">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l56.15"></a><span id="l56.15">   let iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l56.16"></a><span id="l56.16">   event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l56.17"></a><span id="l56.17"> </span>
<a href="#l56.18"></a><span id="l56.18">   event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l56.19"></a><span id="l56.19">   event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Today's Event&quot;);</span>
<a href="#l56.20"></a><span id="l56.20">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l56.21"></a><span id="l56.21" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0; });</span>
<a href="#l56.22"></a><span id="l56.22" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l56.23"></a><span id="l56.23"> </span>
<a href="#l56.24"></a><span id="l56.24">   // reset view</span>
<a href="#l56.25"></a><span id="l56.25">   view.scrollToMinute(60 * 8);</span>
<a href="#l56.26"></a><span id="l56.26"> </span>
<a href="#l56.27"></a><span id="l56.27">   // go to tomorrow and add an event</span>
<a href="#l56.28"></a><span id="l56.28">   controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l56.29"></a><span id="l56.29">   controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l56.30"></a><span id="l56.30">     'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l56.31"></a><span id="l56.31">     '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l56.32"></a><span id="l56.32">     'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'), 1, 1);</span>
<a href="#l56.33"></a><span id="l56.33" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l56.34"></a><span id="l56.34" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l56.35"></a><span id="l56.35">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l56.36"></a><span id="l56.36">   iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l56.37"></a><span id="l56.37">   event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l56.38"></a><span id="l56.38"> </span>
<a href="#l56.39"></a><span id="l56.39">   event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l56.40"></a><span id="l56.40">   event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Tomorrow's Event&quot;);</span>
<a href="#l56.41"></a><span id="l56.41">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l56.42"></a><span id="l56.42" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0; });</span>
<a href="#l56.43"></a><span id="l56.43" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l56.44"></a><span id="l56.44"> </span>
<a href="#l56.45"></a><span id="l56.45">   // go 5 days forward and add an event</span>
<a href="#l56.46"></a><span id="l56.46">   for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l56.47"></a><span id="l56.47">     controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l56.48"></a><span id="l56.48">   }</span>
<a href="#l56.49"></a><span id="l56.49">   controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l56.50"></a><span id="l56.50"> </span>
<a href="#l56.51"></a><span id="l56.51">   controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l56.52"></a><span id="l56.52">     'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l56.53"></a><span id="l56.53">     '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l56.54"></a><span id="l56.54">     'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'), 1, 1);</span>
<a href="#l56.55"></a><span id="l56.55" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l56.56"></a><span id="l56.56" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l56.57"></a><span id="l56.57">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l56.58"></a><span id="l56.58">   iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l56.59"></a><span id="l56.59">   event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l56.60"></a><span id="l56.60"> </span>
<a href="#l56.61"></a><span id="l56.61">   event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l56.62"></a><span id="l56.62">   event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Future's Event&quot;);</span>
<a href="#l56.63"></a><span id="l56.63">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l56.64"></a><span id="l56.64" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0; });</span>
<a href="#l56.65"></a><span id="l56.65" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l56.66"></a><span id="l56.66"> </span>
<a href="#l56.67"></a><span id="l56.67">   // go to mail tab</span>
<a href="#l56.68"></a><span id="l56.68">   controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l56.69"></a><span id="l56.69">     'id(&quot;navigation-toolbox&quot;)/id(&quot;tabs-toolbar&quot;)/id(&quot;tabcontainer&quot;)/{&quot;first-tab&quot;:&quot;true&quot;,&quot;type&quot;:&quot;folder&quot;}/' +</span>
<a href="#l56.70"></a><span id="l56.70">     'anon({&quot;class&quot;:&quot;tab-stack&quot;})/{&quot;class&quot;:&quot;tab-background&quot;}/{&quot;class&quot;:&quot;tab-background-middle&quot;}'));</span>
<a href="#l56.71"></a><span id="l56.71">   controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l56.72"></a><span id="l56.72"> </span>
<a href="#l56.73"></a><span id="l56.73">   // verify today pane open</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -48,24 +48,24 @@ var testDayView = function() {</span>
<a href="#l57.4"></a><span id="l57.4">     'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l57.5"></a><span id="l57.5">     'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l57.6"></a><span id="l57.6"> </span>
<a href="#l57.7"></a><span id="l57.7">   // pick day</span>
<a href="#l57.8"></a><span id="l57.8">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l57.9"></a><span id="l57.9">     'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l57.10"></a><span id="l57.10"> </span>
<a href="#l57.11"></a><span id="l57.11">   // verify date in view</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-  controller.waitFor(function() { return day.getNode().mDate.icalString == &quot;20090101&quot;; });</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+  controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l57.14"></a><span id="l57.14"> </span>
<a href="#l57.15"></a><span id="l57.15">   // create event at 8 AM</span>
<a href="#l57.16"></a><span id="l57.16">   controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l57.17"></a><span id="l57.17">     'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l57.18"></a><span id="l57.18">     '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l57.19"></a><span id="l57.19">     'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l57.20"></a><span id="l57.20" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l57.21"></a><span id="l57.21" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l57.22"></a><span id="l57.22">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l57.23"></a><span id="l57.23"> </span>
<a href="#l57.24"></a><span id="l57.24">   // check that the start time is correct</span>
<a href="#l57.25"></a><span id="l57.25">   let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l57.26"></a><span id="l57.26">     'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l57.27"></a><span id="l57.27">     'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l57.28"></a><span id="l57.28">     'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l57.29"></a><span id="l57.29">     'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l57.30"></a><span id="l57.30" class="difflineat">@@ -98,17 +98,17 @@ var testDayView = function() {</span>
<a href="#l57.31"></a><span id="l57.31">   // if it was created successfully, it can be opened</span>
<a href="#l57.32"></a><span id="l57.32">   let eventBox = new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l57.33"></a><span id="l57.33">     'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l57.34"></a><span id="l57.34">     '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l57.35"></a><span id="l57.35">     'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[0]/' +</span>
<a href="#l57.36"></a><span id="l57.36">     '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}');</span>
<a href="#l57.37"></a><span id="l57.37">   controller.waitForElement(eventBox);</span>
<a href="#l57.38"></a><span id="l57.38">   controller.doubleClick(eventBox);</span>
<a href="#l57.39"></a><span id="l57.39" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l57.40"></a><span id="l57.40" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l57.41"></a><span id="l57.41">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l57.42"></a><span id="l57.42"> </span>
<a href="#l57.43"></a><span id="l57.43">   // change title and save changes</span>
<a href="#l57.44"></a><span id="l57.44">   let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l57.45"></a><span id="l57.45">     'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l57.46"></a><span id="l57.46">     'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l57.47"></a><span id="l57.47">   event.waitForElement(titleTextBox);</span>
<a href="#l57.48"></a><span id="l57.48">   event.type(titleTextBox, title2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -52,25 +52,25 @@ var testMonthView = function() {</span>
<a href="#l58.4"></a><span id="l58.4">   // pick day</span>
<a href="#l58.5"></a><span id="l58.5">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l58.6"></a><span id="l58.6">     'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l58.7"></a><span id="l58.7"> </span>
<a href="#l58.8"></a><span id="l58.8">   // verify date</span>
<a href="#l58.9"></a><span id="l58.9">   let day = new elementslib.Lookup(controller.window.document, monthView +</span>
<a href="#l58.10"></a><span id="l58.10">     'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l58.11"></a><span id="l58.11">     '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-  controller.waitFor(function() { return day.getNode().mDate.icalString == &quot;20090101&quot;; });</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineplus">+  controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l58.14"></a><span id="l58.14"> </span>
<a href="#l58.15"></a><span id="l58.15">   // create event</span>
<a href="#l58.16"></a><span id="l58.16">   // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l58.17"></a><span id="l58.17">   let hour = new Date().getHours(); // remember time at click</span>
<a href="#l58.18"></a><span id="l58.18">   controller.doubleClick(new elementslib.Lookup(controller.window.document, monthView +</span>
<a href="#l58.19"></a><span id="l58.19">     'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l58.20"></a><span id="l58.20">     '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l58.21"></a><span id="l58.21" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l58.22"></a><span id="l58.22" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l58.23"></a><span id="l58.23">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l58.24"></a><span id="l58.24"> </span>
<a href="#l58.25"></a><span id="l58.25">   // check that the start time is correct</span>
<a href="#l58.26"></a><span id="l58.26">   // next full hour except last hour hour of the day</span>
<a href="#l58.27"></a><span id="l58.27">   let nextHour = (hour == 23) ? hour : (hour + 1) % 24;</span>
<a href="#l58.28"></a><span id="l58.28">   let startTime = nextHour + &quot;:00&quot;; // next full hour</span>
<a href="#l58.29"></a><span id="l58.29">   let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l58.30"></a><span id="l58.30">     'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l58.31"></a><span id="l58.31" class="difflineat">@@ -104,17 +104,17 @@ var testMonthView = function() {</span>
<a href="#l58.32"></a><span id="l58.32">     '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l58.33"></a><span id="l58.33"> </span>
<a href="#l58.34"></a><span id="l58.34">   // save</span>
<a href="#l58.35"></a><span id="l58.35">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l58.36"></a><span id="l58.36"> </span>
<a href="#l58.37"></a><span id="l58.37">   // if it was created successfully, it can be opened</span>
<a href="#l58.38"></a><span id="l58.38">   controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l58.39"></a><span id="l58.39">   controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l58.40"></a><span id="l58.40" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l58.41"></a><span id="l58.41" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l58.42"></a><span id="l58.42">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l58.43"></a><span id="l58.43"> </span>
<a href="#l58.44"></a><span id="l58.44">   // change title and save changes</span>
<a href="#l58.45"></a><span id="l58.45">   let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l58.46"></a><span id="l58.46">     'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l58.47"></a><span id="l58.47">     'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l58.48"></a><span id="l58.48">   event.waitForElement(titleTextBox);</span>
<a href="#l58.49"></a><span id="l58.49">   event.type(titleTextBox, title2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -52,25 +52,25 @@ var testMultiWeekView = function() {</span>
<a href="#l59.4"></a><span id="l59.4">   // pick day</span>
<a href="#l59.5"></a><span id="l59.5">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l59.6"></a><span id="l59.6">     'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l59.7"></a><span id="l59.7"> </span>
<a href="#l59.8"></a><span id="l59.8">   // verify date</span>
<a href="#l59.9"></a><span id="l59.9">   let day = new elementslib.Lookup(controller.window.document, multiWeekView +</span>
<a href="#l59.10"></a><span id="l59.10">     'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l59.11"></a><span id="l59.11">     '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-  controller.waitFor(function() { return day.getNode().mDate.icalString == &quot;20090101&quot;; });</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+  controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l59.14"></a><span id="l59.14"> </span>
<a href="#l59.15"></a><span id="l59.15">   // create event</span>
<a href="#l59.16"></a><span id="l59.16">   // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l59.17"></a><span id="l59.17">   let hour = new Date().getHours(); // remember time at click</span>
<a href="#l59.18"></a><span id="l59.18">   controller.doubleClick(new elementslib.Lookup(controller.window.document, multiWeekView +</span>
<a href="#l59.19"></a><span id="l59.19">     'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l59.20"></a><span id="l59.20">     '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l59.21"></a><span id="l59.21" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l59.22"></a><span id="l59.22" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l59.23"></a><span id="l59.23">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l59.24"></a><span id="l59.24"> </span>
<a href="#l59.25"></a><span id="l59.25">   // check that the start time is correct</span>
<a href="#l59.26"></a><span id="l59.26">   // next full hour except last hour hour of the day</span>
<a href="#l59.27"></a><span id="l59.27">   let nextHour = (hour == 23) ? hour : (hour + 1) % 24;</span>
<a href="#l59.28"></a><span id="l59.28">   let startTime = nextHour + &quot;:00&quot;;</span>
<a href="#l59.29"></a><span id="l59.29">   let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l59.30"></a><span id="l59.30">     'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l59.31"></a><span id="l59.31" class="difflineat">@@ -104,17 +104,17 @@ var testMultiWeekView = function() {</span>
<a href="#l59.32"></a><span id="l59.32">     '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l59.33"></a><span id="l59.33"> </span>
<a href="#l59.34"></a><span id="l59.34">   // save</span>
<a href="#l59.35"></a><span id="l59.35">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l59.36"></a><span id="l59.36"> </span>
<a href="#l59.37"></a><span id="l59.37">   // if it was created successfully, it can be opened</span>
<a href="#l59.38"></a><span id="l59.38">   controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l59.39"></a><span id="l59.39">   controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l59.40"></a><span id="l59.40" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l59.41"></a><span id="l59.41" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l59.42"></a><span id="l59.42">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l59.43"></a><span id="l59.43"> </span>
<a href="#l59.44"></a><span id="l59.44">   // change title and save changes</span>
<a href="#l59.45"></a><span id="l59.45">   let titmeTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l59.46"></a><span id="l59.46">     'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l59.47"></a><span id="l59.47">     'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l59.48"></a><span id="l59.48">   event.waitForElement(titmeTextBox);</span>
<a href="#l59.49"></a><span id="l59.49">   event.type(titmeTextBox, title2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -57,30 +57,30 @@ var testTaskView = function() {</span>
<a href="#l60.4"></a><span id="l60.4">   controller.keypress(new elementslib.Lookup(controller.window.document, taskView +</span>
<a href="#l60.5"></a><span id="l60.5">     'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l60.6"></a><span id="l60.6">     'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l60.7"></a><span id="l60.7">     &quot;VK_RETURN&quot;,</span>
<a href="#l60.8"></a><span id="l60.8">     {});</span>
<a href="#l60.9"></a><span id="l60.9"> </span>
<a href="#l60.10"></a><span id="l60.10">   // verify added</span>
<a href="#l60.11"></a><span id="l60.11">   let countAfter;</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-  controller.waitFor(function() {</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+  controller.waitFor(() =&gt; {</span>
<a href="#l60.14"></a><span id="l60.14">     countAfter = taskTreeNode.mTaskArray.length;</span>
<a href="#l60.15"></a><span id="l60.15">     return countBefore + 1 == countAfter;</span>
<a href="#l60.16"></a><span id="l60.16">   });</span>
<a href="#l60.17"></a><span id="l60.17"> </span>
<a href="#l60.18"></a><span id="l60.18">   // last added task is automatically selected so verify detail window data</span>
<a href="#l60.19"></a><span id="l60.19">   controller.assertJSProperty(new elementslib.ID(controller.window.document,</span>
<a href="#l60.20"></a><span id="l60.20">     &quot;calendar-task-details-title&quot;), &quot;textContent&quot;, title);</span>
<a href="#l60.21"></a><span id="l60.21"> </span>
<a href="#l60.22"></a><span id="l60.22">   // open added task</span>
<a href="#l60.23"></a><span id="l60.23">   // doubleclick on completion checkbox is ignored as opening action, so don't click at immediate</span>
<a href="#l60.24"></a><span id="l60.24">   // left where the checkbox is located</span>
<a href="#l60.25"></a><span id="l60.25">   controller.doubleClick(new elementslib.Lookup(controller.window.document, treeChildren), 50, 0);</span>
<a href="#l60.26"></a><span id="l60.26" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l60.27"></a><span id="l60.27" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l60.28"></a><span id="l60.28">   let task = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l60.29"></a><span id="l60.29"> </span>
<a href="#l60.30"></a><span id="l60.30">   // verify calendar</span>
<a href="#l60.31"></a><span id="l60.31">   task.waitForElement(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l60.32"></a><span id="l60.32">     'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/' +</span>
<a href="#l60.33"></a><span id="l60.33">     '{&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l60.34"></a><span id="l60.34"> </span>
<a href="#l60.35"></a><span id="l60.35">   // add description, mark needs action and add percent complete</span>
<a href="#l60.36"></a><span id="l60.36" class="difflineat">@@ -99,17 +99,17 @@ var testTaskView = function() {</span>
<a href="#l60.37"></a><span id="l60.37">   task.type(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l60.38"></a><span id="l60.38">     'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l60.39"></a><span id="l60.39">     'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/' +</span>
<a href="#l60.40"></a><span id="l60.40">     'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l60.41"></a><span id="l60.41">     percentComplete);</span>
<a href="#l60.42"></a><span id="l60.42"> </span>
<a href="#l60.43"></a><span id="l60.43">   // save</span>
<a href="#l60.44"></a><span id="l60.44">   task.click(new elementslib.ID(task.window.document, &quot;button-save&quot;));</span>
<a href="#l60.45"></a><span id="l60.45" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0; });</span>
<a href="#l60.46"></a><span id="l60.46" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l60.47"></a><span id="l60.47"> </span>
<a href="#l60.48"></a><span id="l60.48">   // verify description and status in details pane</span>
<a href="#l60.49"></a><span id="l60.49">   controller.assertValue(new elementslib.Lookup(controller.window.document, taskView +</span>
<a href="#l60.50"></a><span id="l60.50">     '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;calendar-task-details-container&quot;)/id(&quot;calendar-task-details-description&quot;)/' +</span>
<a href="#l60.51"></a><span id="l60.51">     'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l60.52"></a><span id="l60.52">     description);</span>
<a href="#l60.53"></a><span id="l60.53">   let status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l60.54"></a><span id="l60.54">     &quot;taskDetailsStatusNeedsAction&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -51,24 +51,24 @@ var testWeekView = function() {</span>
<a href="#l61.4"></a><span id="l61.4">   // pick day</span>
<a href="#l61.5"></a><span id="l61.5">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l61.6"></a><span id="l61.6">     'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l61.7"></a><span id="l61.7"> </span>
<a href="#l61.8"></a><span id="l61.8">   // verify date</span>
<a href="#l61.9"></a><span id="l61.9">   let day = new elementslib.Lookup(controller.window.document, weekView +</span>
<a href="#l61.10"></a><span id="l61.10">     'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/' +</span>
<a href="#l61.11"></a><span id="l61.11">     '{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-  controller.waitFor(function() { return day.getNode().mDate.icalString == &quot;20090101&quot;; });</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+  controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l61.14"></a><span id="l61.14"> </span>
<a href="#l61.15"></a><span id="l61.15">   // create event at 8 AM</span>
<a href="#l61.16"></a><span id="l61.16">   // Thursday of 2009-01-01 is 4th with default settings</span>
<a href="#l61.17"></a><span id="l61.17">   controller.doubleClick(new elementslib.Lookup(controller.window.document, weekView +</span>
<a href="#l61.18"></a><span id="l61.18">     'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l61.19"></a><span id="l61.19">     '[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l61.20"></a><span id="l61.20" class="difflineminus">-  controller.waitFor(function() { return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l61.21"></a><span id="l61.21" class="difflineplus">+  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l61.22"></a><span id="l61.22">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l61.23"></a><span id="l61.23"> </span>
<a href="#l61.24"></a><span id="l61.24">   // check that the start time is correct</span>
<a href="#l61.25"></a><span id="l61.25">   let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l61.26"></a><span id="l61.26">     'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l61.27"></a><span id="l61.27">     'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l61.28"></a><span id="l61.28">     'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l61.29"></a><span id="l61.29">     'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l61.30"></a><span id="l61.30" class="difflineat">@@ -96,17 +96,17 @@ var testWeekView = function() {</span>
<a href="#l61.31"></a><span id="l61.31">   event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), null, calendar);</span>
<a href="#l61.32"></a><span id="l61.32"> </span>
<a href="#l61.33"></a><span id="l61.33">   // save</span>
<a href="#l61.34"></a><span id="l61.34">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l61.35"></a><span id="l61.35"> </span>
<a href="#l61.36"></a><span id="l61.36">   // if it was created successfully, it can be opened</span>
<a href="#l61.37"></a><span id="l61.37">   controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l61.38"></a><span id="l61.38">   controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l61.39"></a><span id="l61.39" class="difflineminus">-  controller.waitFor(function() { return utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0; }, sleep);</span>
<a href="#l61.40"></a><span id="l61.40" class="difflineplus">+  controller.waitFor(() =&gt; utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l61.41"></a><span id="l61.41">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l61.42"></a><span id="l61.42"> </span>
<a href="#l61.43"></a><span id="l61.43">   // change title and save changes</span>
<a href="#l61.44"></a><span id="l61.44">   let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l61.45"></a><span id="l61.45">     'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l61.46"></a><span id="l61.46">     'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l61.47"></a><span id="l61.47">   event.waitForElement(titleTextBox);</span>
<a href="#l61.48"></a><span id="l61.48">   event.type(titleTextBox, title2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/calendar/test/unit/test_alarm.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/calendar/test/unit/test_alarm.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -55,22 +55,22 @@ function test_display_alarm() {</span>
<a href="#l62.4"></a><span id="l62.4">     // SUMMARY is not valid for ACTION:DISPLAY</span>
<a href="#l62.5"></a><span id="l62.5">     alarm.summary = &quot;test&quot;;</span>
<a href="#l62.6"></a><span id="l62.6">     equal(alarm.summary, null);</span>
<a href="#l62.7"></a><span id="l62.7"> </span>
<a href="#l62.8"></a><span id="l62.8">     // No attendees allowed</span>
<a href="#l62.9"></a><span id="l62.9">     let attendee = cal.createAttendee();</span>
<a href="#l62.10"></a><span id="l62.10">     attendee.id = &quot;mailto:horst&quot;;</span>
<a href="#l62.11"></a><span id="l62.11"> </span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-    throws(function() {</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l62.14"></a><span id="l62.14">         // DISPLAY alarm should not be able to save attendees</span>
<a href="#l62.15"></a><span id="l62.15">         alarm.addAttendee(attendee);</span>
<a href="#l62.16"></a><span id="l62.16">     }, /Alarm type AUDIO\/DISPLAY may not have attendees/);</span>
<a href="#l62.17"></a><span id="l62.17"> </span>
<a href="#l62.18"></a><span id="l62.18" class="difflineminus">-    throws(function() {</span>
<a href="#l62.19"></a><span id="l62.19" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l62.20"></a><span id="l62.20">         // DISPLAY alarm should not be able to save attachment</span>
<a href="#l62.21"></a><span id="l62.21">         alarm.addAttachment(cal.createAttachment());</span>
<a href="#l62.22"></a><span id="l62.22">     }, /Alarm type DISPLAY may not have attachments/);</span>
<a href="#l62.23"></a><span id="l62.23"> </span>
<a href="#l62.24"></a><span id="l62.24">     dump(&quot;Done\n&quot;);</span>
<a href="#l62.25"></a><span id="l62.25"> }</span>
<a href="#l62.26"></a><span id="l62.26"> </span>
<a href="#l62.27"></a><span id="l62.27"> function test_email_alarm() {</span>
<a href="#l62.28"></a><span id="l62.28" class="difflineat">@@ -410,21 +410,21 @@ function test_immutable() {</span>
<a href="#l62.29"></a><span id="l62.29">         } catch (e) {</span>
<a href="#l62.30"></a><span id="l62.30">             equal(e.result, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l62.31"></a><span id="l62.31">             continue;</span>
<a href="#l62.32"></a><span id="l62.32">         }</span>
<a href="#l62.33"></a><span id="l62.33">         do_throw(&quot;Attribute &quot; + prop + &quot; was writable while item was immutable&quot;);</span>
<a href="#l62.34"></a><span id="l62.34">     }</span>
<a href="#l62.35"></a><span id="l62.35"> </span>
<a href="#l62.36"></a><span id="l62.36">     // Functions</span>
<a href="#l62.37"></a><span id="l62.37" class="difflineminus">-    throws(function() {</span>
<a href="#l62.38"></a><span id="l62.38" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l62.39"></a><span id="l62.39">         alarm.setProperty(&quot;X-FOO&quot;, &quot;changed&quot;);</span>
<a href="#l62.40"></a><span id="l62.40">     }, /Can not modify immutable data container/);</span>
<a href="#l62.41"></a><span id="l62.41"> </span>
<a href="#l62.42"></a><span id="l62.42" class="difflineminus">-    throws(function() {</span>
<a href="#l62.43"></a><span id="l62.43" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l62.44"></a><span id="l62.44">         alarm.deleteProperty(&quot;X-FOO&quot;);</span>
<a href="#l62.45"></a><span id="l62.45">     }, /Can not modify immutable data container/);</span>
<a href="#l62.46"></a><span id="l62.46"> </span>
<a href="#l62.47"></a><span id="l62.47">     ok(!alarm.getProperty(&quot;X-DATEPROP&quot;).isMutable);</span>
<a href="#l62.48"></a><span id="l62.48"> </span>
<a href="#l62.49"></a><span id="l62.49">     dump(&quot;Done\n&quot;);</span>
<a href="#l62.50"></a><span id="l62.50"> }</span>
<a href="#l62.51"></a><span id="l62.51"> </span>
<a href="#l62.52"></a><span id="l62.52" class="difflineat">@@ -491,17 +491,17 @@ function test_clone() {</span>
<a href="#l62.53"></a><span id="l62.53">     dump(&quot;Done\n&quot;);</span>
<a href="#l62.54"></a><span id="l62.54"> }</span>
<a href="#l62.55"></a><span id="l62.55"> </span>
<a href="#l62.56"></a><span id="l62.56"> function test_serialize() {</span>
<a href="#l62.57"></a><span id="l62.57">     // most checks done by other tests, these don't fit into categories</span>
<a href="#l62.58"></a><span id="l62.58">     let alarm = cal.createAlarm();</span>
<a href="#l62.59"></a><span id="l62.59">     let srv = cal.getIcsService();</span>
<a href="#l62.60"></a><span id="l62.60"> </span>
<a href="#l62.61"></a><span id="l62.61" class="difflineminus">-    throws(function() {</span>
<a href="#l62.62"></a><span id="l62.62" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l62.63"></a><span id="l62.63">         alarm.icalComponent = srv.createIcalComponent(&quot;BARF&quot;);</span>
<a href="#l62.64"></a><span id="l62.64">     }, /0x80070057/, &quot;Invalid Argument&quot;);</span>
<a href="#l62.65"></a><span id="l62.65"> </span>
<a href="#l62.66"></a><span id="l62.66">     function addProp(k, v) { let p = srv.createIcalProperty(k); p.value = v; comp.addProperty(p); }</span>
<a href="#l62.67"></a><span id="l62.67">     function addActionDisplay() { addProp(&quot;ACTION&quot;, &quot;DISPLAY&quot;); }</span>
<a href="#l62.68"></a><span id="l62.68">     function addActionEmail() { addProp(&quot;ACTION&quot;, &quot;EMAIL&quot;); }</span>
<a href="#l62.69"></a><span id="l62.69">     function addTrigger() { addProp(&quot;TRIGGER&quot;, &quot;-PT15M&quot;); }</span>
<a href="#l62.70"></a><span id="l62.70">     function addDescr() { addProp(&quot;DESCRIPTION&quot;, &quot;TEST&quot;); }</span>
<a href="#l62.71"></a><span id="l62.71" class="difflineat">@@ -519,39 +519,39 @@ function test_serialize() {</span>
<a href="#l62.72"></a><span id="l62.72">     // Attachments and attendees</span>
<a href="#l62.73"></a><span id="l62.73">     comp = srv.createIcalComponent(&quot;VALARM&quot;);</span>
<a href="#l62.74"></a><span id="l62.74">     addActionEmail(); addTrigger(); addDescr();</span>
<a href="#l62.75"></a><span id="l62.75">     addAttendee(); addAttachment();</span>
<a href="#l62.76"></a><span id="l62.76">     alarm.icalComponent = comp;</span>
<a href="#l62.77"></a><span id="l62.77">     alarm.toString();</span>
<a href="#l62.78"></a><span id="l62.78"> </span>
<a href="#l62.79"></a><span id="l62.79">     // Missing action</span>
<a href="#l62.80"></a><span id="l62.80" class="difflineminus">-    throws(function() {</span>
<a href="#l62.81"></a><span id="l62.81" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l62.82"></a><span id="l62.82">         comp = srv.createIcalComponent(&quot;VALARM&quot;);</span>
<a href="#l62.83"></a><span id="l62.83">         addTrigger(); addDescr();</span>
<a href="#l62.84"></a><span id="l62.84">         alarm.icalComponent = comp;</span>
<a href="#l62.85"></a><span id="l62.85">     }, /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l62.86"></a><span id="l62.86"> </span>
<a href="#l62.87"></a><span id="l62.87">     // Missing trigger</span>
<a href="#l62.88"></a><span id="l62.88" class="difflineminus">-    throws(function() {</span>
<a href="#l62.89"></a><span id="l62.89" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l62.90"></a><span id="l62.90">         comp = srv.createIcalComponent(&quot;VALARM&quot;);</span>
<a href="#l62.91"></a><span id="l62.91">         addActionDisplay(); addDescr();</span>
<a href="#l62.92"></a><span id="l62.92">         alarm.icalComponent = comp;</span>
<a href="#l62.93"></a><span id="l62.93">     }, /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l62.94"></a><span id="l62.94"> </span>
<a href="#l62.95"></a><span id="l62.95">     // Missing duration with repeat</span>
<a href="#l62.96"></a><span id="l62.96" class="difflineminus">-    throws(function() {</span>
<a href="#l62.97"></a><span id="l62.97" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l62.98"></a><span id="l62.98">         comp = srv.createIcalComponent(&quot;VALARM&quot;);</span>
<a href="#l62.99"></a><span id="l62.99">         addActionDisplay(); addTrigger(); addDescr();</span>
<a href="#l62.100"></a><span id="l62.100">         addRepeat();</span>
<a href="#l62.101"></a><span id="l62.101">         alarm.icalComponent = comp;</span>
<a href="#l62.102"></a><span id="l62.102">     }, /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l62.103"></a><span id="l62.103"> </span>
<a href="#l62.104"></a><span id="l62.104">     // Missing repeat with duration</span>
<a href="#l62.105"></a><span id="l62.105" class="difflineminus">-    throws(function() {</span>
<a href="#l62.106"></a><span id="l62.106" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l62.107"></a><span id="l62.107">         comp = srv.createIcalComponent(&quot;VALARM&quot;);</span>
<a href="#l62.108"></a><span id="l62.108">         addActionDisplay(); addTrigger(); addDescr();</span>
<a href="#l62.109"></a><span id="l62.109">         addDuration();</span>
<a href="#l62.110"></a><span id="l62.110">         alarm.icalComponent = comp;</span>
<a href="#l62.111"></a><span id="l62.111">     }, /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l62.112"></a><span id="l62.112"> }</span>
<a href="#l62.113"></a><span id="l62.113"> </span>
<a href="#l62.114"></a><span id="l62.114"> function test_strings() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/calendar/test/unit/test_alarmservice.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/calendar/test/unit/test_alarmservice.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -109,17 +109,17 @@ var alarmObserver = {</span>
<a href="#l63.4"></a><span id="l63.4"> };</span>
<a href="#l63.5"></a><span id="l63.5"> </span>
<a href="#l63.6"></a><span id="l63.6"> function run_test() {</span>
<a href="#l63.7"></a><span id="l63.7">     do_get_profile();</span>
<a href="#l63.8"></a><span id="l63.8"> </span>
<a href="#l63.9"></a><span id="l63.9">     add_test(() =&gt; {</span>
<a href="#l63.10"></a><span id="l63.10">         // initialization needs to be done within the first test in order for</span>
<a href="#l63.11"></a><span id="l63.11">         // the subsequent tests to run properly</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-        do_calendar_startup(function() {</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+        do_calendar_startup(() =&gt; {</span>
<a href="#l63.14"></a><span id="l63.14">             initializeAlarmService();</span>
<a href="#l63.15"></a><span id="l63.15">             run_next_test();</span>
<a href="#l63.16"></a><span id="l63.16">         });</span>
<a href="#l63.17"></a><span id="l63.17">     });</span>
<a href="#l63.18"></a><span id="l63.18">     add_test(test_addItems);</span>
<a href="#l63.19"></a><span id="l63.19">     add_test(test_loadCalendar);</span>
<a href="#l63.20"></a><span id="l63.20">     add_test(test_modifyItems);</span>
<a href="#l63.21"></a><span id="l63.21"> </span>
<a href="#l63.22"></a><span id="l63.22" class="difflineat">@@ -193,21 +193,21 @@ function addTestItems(aCalendar) {</span>
<a href="#l63.23"></a><span id="l63.23">     // alarm more than 6 hours in the future should not have a timer set</span>
<a href="#l63.24"></a><span id="l63.24">     [item, alarm] = createEventWithAlarm(aCalendar, dt, dt, &quot;PT7H&quot;);</span>
<a href="#l63.25"></a><span id="l63.25">     alarmObserver.expectResult(aCalendar, item, alarm, EXPECT_NONE);</span>
<a href="#l63.26"></a><span id="l63.26">     aCalendar.addItem(item, null);</span>
<a href="#l63.27"></a><span id="l63.27"> </span>
<a href="#l63.28"></a><span id="l63.28">     // test multiple alarms on an item</span>
<a href="#l63.29"></a><span id="l63.29">     [item, alarm] = createEventWithAlarm(aCalendar, dt, dt);</span>
<a href="#l63.30"></a><span id="l63.30">     [[&quot;-PT1H&quot;, EXPECT_FIRED], [&quot;-PT15M&quot;, EXPECT_FIRED], [&quot;PT1H&quot;, EXPECT_TIMER],</span>
<a href="#l63.31"></a><span id="l63.31" class="difflineminus">-     [&quot;PT7H&quot;, EXPECT_NONE], [&quot;P7D&quot;, EXPECT_NONE]].forEach(function([offset, expected]) {</span>
<a href="#l63.32"></a><span id="l63.32" class="difflineplus">+     [&quot;PT7H&quot;, EXPECT_NONE], [&quot;P7D&quot;, EXPECT_NONE]].forEach(([offset, expected]) =&gt; {</span>
<a href="#l63.33"></a><span id="l63.33">         alarm = createAlarmFromDuration(offset);</span>
<a href="#l63.34"></a><span id="l63.34">         item.addAlarm(alarm);</span>
<a href="#l63.35"></a><span id="l63.35">         alarmObserver.expectResult(aCalendar, item, alarm, expected);</span>
<a href="#l63.36"></a><span id="l63.36" class="difflineminus">-    }, this);</span>
<a href="#l63.37"></a><span id="l63.37" class="difflineplus">+    });</span>
<a href="#l63.38"></a><span id="l63.38">     aCalendar.addItem(item, null);</span>
<a href="#l63.39"></a><span id="l63.39"> </span>
<a href="#l63.40"></a><span id="l63.40">     // daily repeating event starting almost 2 full days ago. The alarms on the first 2 occurrences</span>
<a href="#l63.41"></a><span id="l63.41">     // should fire, and a timer should be set for the next occurrence only</span>
<a href="#l63.42"></a><span id="l63.42">     dt = cal.now();</span>
<a href="#l63.43"></a><span id="l63.43">     dt.hour -= 47;</span>
<a href="#l63.44"></a><span id="l63.44">     [item, alarm] = createEventWithAlarm(aCalendar, dt, dt, &quot;-PT15M&quot;, &quot;RRULE:FREQ=DAILY&quot;);</span>
<a href="#l63.45"></a><span id="l63.45">     alarmObserver.expectOccurrences(aCalendar, item, alarm,</span>
<a href="#l63.46"></a><span id="l63.46" class="difflineat">@@ -325,38 +325,38 @@ function doRunTest(aOnCalendarCreated, a</span>
<a href="#l63.47"></a><span id="l63.47">     memory.id = cal.getUUID();</span>
<a href="#l63.48"></a><span id="l63.48"> </span>
<a href="#l63.49"></a><span id="l63.49">     if (aOnCalendarCreated) {</span>
<a href="#l63.50"></a><span id="l63.50">         aOnCalendarCreated.call(aOnCalendarCreated, memory);</span>
<a href="#l63.51"></a><span id="l63.51">     }</span>
<a href="#l63.52"></a><span id="l63.52"> </span>
<a href="#l63.53"></a><span id="l63.53">     calmgr.registerCalendar(memory);</span>
<a href="#l63.54"></a><span id="l63.54"> </span>
<a href="#l63.55"></a><span id="l63.55" class="difflineminus">-    alarmObserver.doOnAlarmsLoaded(memory, function() {</span>
<a href="#l63.56"></a><span id="l63.56" class="difflineplus">+    alarmObserver.doOnAlarmsLoaded(memory, () =&gt; {</span>
<a href="#l63.57"></a><span id="l63.57">         if (aOnAlarmsLoaded) {</span>
<a href="#l63.58"></a><span id="l63.58">             aOnAlarmsLoaded.call(aOnAlarmsLoaded, memory);</span>
<a href="#l63.59"></a><span id="l63.59">         }</span>
<a href="#l63.60"></a><span id="l63.60"> </span>
<a href="#l63.61"></a><span id="l63.61">         run_next_test();</span>
<a href="#l63.62"></a><span id="l63.62">     });</span>
<a href="#l63.63"></a><span id="l63.63"> }</span>
<a href="#l63.64"></a><span id="l63.64"> </span>
<a href="#l63.65"></a><span id="l63.65"> // Test the initial alarm loading of a calendar with existing data</span>
<a href="#l63.66"></a><span id="l63.66"> function test_loadCalendar() {</span>
<a href="#l63.67"></a><span id="l63.67">     doRunTest(addTestItems, alarmObserver.checkExpected.bind(alarmObserver));</span>
<a href="#l63.68"></a><span id="l63.68"> }</span>
<a href="#l63.69"></a><span id="l63.69"> </span>
<a href="#l63.70"></a><span id="l63.70"> // Test adding alarm data to a calendar already registered</span>
<a href="#l63.71"></a><span id="l63.71"> function test_addItems() {</span>
<a href="#l63.72"></a><span id="l63.72" class="difflineminus">-    doRunTest(null, function(memory) {</span>
<a href="#l63.73"></a><span id="l63.73" class="difflineplus">+    doRunTest(null, (memory) =&gt; {</span>
<a href="#l63.74"></a><span id="l63.74">         addTestItems(memory);</span>
<a href="#l63.75"></a><span id="l63.75">         alarmObserver.checkExpected();</span>
<a href="#l63.76"></a><span id="l63.76">     });</span>
<a href="#l63.77"></a><span id="l63.77"> }</span>
<a href="#l63.78"></a><span id="l63.78"> </span>
<a href="#l63.79"></a><span id="l63.79"> // Test response to modification of alarm data</span>
<a href="#l63.80"></a><span id="l63.80"> function test_modifyItems() {</span>
<a href="#l63.81"></a><span id="l63.81" class="difflineminus">-    doRunTest(null, function(memory) {</span>
<a href="#l63.82"></a><span id="l63.82" class="difflineplus">+    doRunTest(null, (memory) =&gt; {</span>
<a href="#l63.83"></a><span id="l63.83">         doModifyItemTest(memory);</span>
<a href="#l63.84"></a><span id="l63.84">         doDeleteItemTest(memory);</span>
<a href="#l63.85"></a><span id="l63.85">         doAcknowledgeTest(memory);</span>
<a href="#l63.86"></a><span id="l63.86">     });</span>
<a href="#l63.87"></a><span id="l63.87"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/calendar/test/unit/test_attachment.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/calendar/test/unit/test_attachment.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -92,17 +92,17 @@ function test_serialize() {</span>
<a href="#l64.4"></a><span id="l64.4">     attach.uri = Services.io.newURI(&quot;data:text/plain,&quot;, null, null);</span>
<a href="#l64.5"></a><span id="l64.5">     equal(attach.icalString, &quot;ATTACH;FMTTYPE=x-moz/test2:data:text/plain,\r\n&quot;);</span>
<a href="#l64.6"></a><span id="l64.6"> </span>
<a href="#l64.7"></a><span id="l64.7">     attach = cal.createAttachment();</span>
<a href="#l64.8"></a><span id="l64.8">     attach.encoding = &quot;BASE64&quot;;</span>
<a href="#l64.9"></a><span id="l64.9">     attach.uri = Services.io.newURI(&quot;data:text/plain,&quot;, null, null);</span>
<a href="#l64.10"></a><span id="l64.10">     equal(attach.icalString, &quot;ATTACH;ENCODING=BASE64:data:text/plain,\r\n&quot;);</span>
<a href="#l64.11"></a><span id="l64.11"> </span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-    throws(function() {</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l64.14"></a><span id="l64.14">         attach.icalString = &quot;X-STICKER:smiley&quot;;</span>
<a href="#l64.15"></a><span id="l64.15">     }, /Illegal value/);</span>
<a href="#l64.16"></a><span id="l64.16"> </span>
<a href="#l64.17"></a><span id="l64.17">     attach = cal.createAttachment();</span>
<a href="#l64.18"></a><span id="l64.18">     attach.uri = Services.io.newURI(&quot;data:text/plain,&quot;, null, null);</span>
<a href="#l64.19"></a><span id="l64.19">     attach.setParameter(&quot;X-PROP&quot;, &quot;VAL&quot;);</span>
<a href="#l64.20"></a><span id="l64.20">     equal(attach.icalString, &quot;ATTACH;X-PROP=VAL:data:text/plain,\r\n&quot;);</span>
<a href="#l64.21"></a><span id="l64.21">     attach.setParameter(&quot;X-PROP&quot;, null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/calendar/test/unit/test_attendee.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/calendar/test/unit/test_attendee.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -34,17 +34,17 @@ function test_values() {</span>
<a href="#l65.4"></a><span id="l65.4">         let foundAttendee = event.getAttendeeById(id);</span>
<a href="#l65.5"></a><span id="l65.5">         equal(foundAttendee, a);</span>
<a href="#l65.6"></a><span id="l65.6">     }</span>
<a href="#l65.7"></a><span id="l65.7">     function testImmutability(a, properties) {</span>
<a href="#l65.8"></a><span id="l65.8">          ok(!a.isMutable);</span>
<a href="#l65.9"></a><span id="l65.9">         // Check if setting a property throws. It should.</span>
<a href="#l65.10"></a><span id="l65.10">         for (let i = 0; i &lt; properties.length; i++) {</span>
<a href="#l65.11"></a><span id="l65.11">             let old = a[properties[i]];</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-            throws(function() {</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+            throws(() =&gt; {</span>
<a href="#l65.14"></a><span id="l65.14">                 a[properties[i]] = old + 1;</span>
<a href="#l65.15"></a><span id="l65.15">             }, /Can not modify immutable data container/);</span>
<a href="#l65.16"></a><span id="l65.16"> </span>
<a href="#l65.17"></a><span id="l65.17">             equal(a[properties[i]], old);</span>
<a href="#l65.18"></a><span id="l65.18">         }</span>
<a href="#l65.19"></a><span id="l65.19">     }</span>
<a href="#l65.20"></a><span id="l65.20"> </span>
<a href="#l65.21"></a><span id="l65.21">     // Create Attendee</span>
<a href="#l65.22"></a><span id="l65.22" class="difflineat">@@ -107,17 +107,17 @@ function test_values() {</span>
<a href="#l65.23"></a><span id="l65.23">     ok(a4.isOrganizer);</span>
<a href="#l65.24"></a><span id="l65.24">     a3.isOrganizer = false;</span>
<a href="#l65.25"></a><span id="l65.25">     ok(a4.isOrganizer);</span>
<a href="#l65.26"></a><span id="l65.26"> }</span>
<a href="#l65.27"></a><span id="l65.27"> </span>
<a href="#l65.28"></a><span id="l65.28"> function test_serialize() {</span>
<a href="#l65.29"></a><span id="l65.29">     let a = cal.createAttendee();</span>
<a href="#l65.30"></a><span id="l65.30"> </span>
<a href="#l65.31"></a><span id="l65.31" class="difflineminus">-    throws(function() {</span>
<a href="#l65.32"></a><span id="l65.32" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l65.33"></a><span id="l65.33">         // eslint-disable-next-line no-unused-expressions</span>
<a href="#l65.34"></a><span id="l65.34">         a.icalProperty;</span>
<a href="#l65.35"></a><span id="l65.35">     }, /Component not initialized/);</span>
<a href="#l65.36"></a><span id="l65.36"> </span>
<a href="#l65.37"></a><span id="l65.37">     a.id = &quot;horst&quot;;</span>
<a href="#l65.38"></a><span id="l65.38">     a.commonName = &quot;Horst&quot;;</span>
<a href="#l65.39"></a><span id="l65.39">     a.rsvp = &quot;TRUE&quot;;</span>
<a href="#l65.40"></a><span id="l65.40"> </span>
<a href="#l65.41"></a><span id="l65.41" class="difflineat">@@ -150,17 +150,17 @@ function test_serialize() {</span>
<a href="#l65.42"></a><span id="l65.42">     equal(prop.getParameter(&quot;PARTSTAT&quot;), &quot;DECLINED&quot;);</span>
<a href="#l65.43"></a><span id="l65.43">     equal(prop.getParameter(&quot;CUTYPE&quot;), &quot;RESOURCE&quot;);</span>
<a href="#l65.44"></a><span id="l65.44">     equal(prop.getParameter(&quot;X-NAME&quot;), &quot;X-VALUE&quot;);</span>
<a href="#l65.45"></a><span id="l65.45"> }</span>
<a href="#l65.46"></a><span id="l65.46"> </span>
<a href="#l65.47"></a><span id="l65.47"> function test_properties() {</span>
<a href="#l65.48"></a><span id="l65.48">     let a = cal.createAttendee();</span>
<a href="#l65.49"></a><span id="l65.49"> </span>
<a href="#l65.50"></a><span id="l65.50" class="difflineminus">-    throws(function() {</span>
<a href="#l65.51"></a><span id="l65.51" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l65.52"></a><span id="l65.52">         // eslint-disable-next-line no-unused-expressions</span>
<a href="#l65.53"></a><span id="l65.53">         a.icalProperty;</span>
<a href="#l65.54"></a><span id="l65.54">     }, /Component not initialized/);</span>
<a href="#l65.55"></a><span id="l65.55"> </span>
<a href="#l65.56"></a><span id="l65.56">     a.id = &quot;horst&quot;;</span>
<a href="#l65.57"></a><span id="l65.57">     a.commonName = &quot;Horst&quot;;</span>
<a href="#l65.58"></a><span id="l65.58">     a.rsvp = &quot;TRUE&quot;;</span>
<a href="#l65.59"></a><span id="l65.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/calendar/test/unit/test_bug350845.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/calendar/test/unit/test_bug350845.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -11,27 +11,27 @@ function run_test() {</span>
<a href="#l66.4"></a><span id="l66.4"> </span>
<a href="#l66.5"></a><span id="l66.5">     // Test getters for imported event</span>
<a href="#l66.6"></a><span id="l66.6">     equal(event.getProperty(&quot;X-FOO&quot;), &quot;QUUX&quot;);</span>
<a href="#l66.7"></a><span id="l66.7">     ok(event.hasProperty(&quot;X-FOO&quot;));</span>
<a href="#l66.8"></a><span id="l66.8">     equal(event.getPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;), &quot;BAZ&quot;);</span>
<a href="#l66.9"></a><span id="l66.9">     ok(event.hasPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;));</span>
<a href="#l66.10"></a><span id="l66.10"> </span>
<a href="#l66.11"></a><span id="l66.11">     // Test setters</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-    throws(function() {</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l66.14"></a><span id="l66.14">       event.setPropertyParameter(&quot;X-UNKNOWN&quot;, &quot;UNKNOWN&quot;, &quot;VALUE&quot;);</span>
<a href="#l66.15"></a><span id="l66.15">     }, /Property X-UNKNOWN not set/);</span>
<a href="#l66.16"></a><span id="l66.16"> </span>
<a href="#l66.17"></a><span id="l66.17">     // More setters</span>
<a href="#l66.18"></a><span id="l66.18">     event.setPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;, &quot;FNORD&quot;);</span>
<a href="#l66.19"></a><span id="l66.19">     equal(event.getPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;), &quot;FNORD&quot;);</span>
<a href="#l66.20"></a><span id="l66.20">     notEqual(event.icalString.match(/^X-FOO;X-BAR=FNORD:QUUX$/m), null);</span>
<a href="#l66.21"></a><span id="l66.21"> </span>
<a href="#l66.22"></a><span id="l66.22">     // Enumerator</span>
<a href="#l66.23"></a><span id="l66.23" class="difflineminus">-    throws(function() {</span>
<a href="#l66.24"></a><span id="l66.24" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l66.25"></a><span id="l66.25">       event.getParameterEnumerator(&quot;X-UNKNOWN&quot;);</span>
<a href="#l66.26"></a><span id="l66.26">     }, /Property X-UNKNOWN not set/);</span>
<a href="#l66.27"></a><span id="l66.27"> </span>
<a href="#l66.28"></a><span id="l66.28">     // More enumerator</span>
<a href="#l66.29"></a><span id="l66.29">     let enume = event.getParameterEnumerator(&quot;X-FOO&quot;);</span>
<a href="#l66.30"></a><span id="l66.30">     ok(enume.hasMoreElements());</span>
<a href="#l66.31"></a><span id="l66.31">     let xbar = enume.getNext().QueryInterface(Components.interfaces.nsIProperty);</span>
<a href="#l66.32"></a><span id="l66.32">     equal(xbar.name, &quot;X-BAR&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/calendar/test/unit/test_deleted_items.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/calendar/test/unit/test_deleted_items.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -7,17 +7,17 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l67.4"></a><span id="l67.4"> function run_test() {</span>
<a href="#l67.5"></a><span id="l67.5">     do_calendar_startup(run_next_test);</span>
<a href="#l67.6"></a><span id="l67.6"> }</span>
<a href="#l67.7"></a><span id="l67.7"> </span>
<a href="#l67.8"></a><span id="l67.8"> function check_delmgr_call(aFunc) {</span>
<a href="#l67.9"></a><span id="l67.9">     const mISSC = Components.interfaces.mozIStorageStatementCallback;</span>
<a href="#l67.10"></a><span id="l67.10">     let delmgr = Components.classes[&quot;@mozilla.org/calendar/deleted-items-manager;1&quot;]</span>
<a href="#l67.11"></a><span id="l67.11">                            .getService(Components.interfaces.calIDeletedItems);</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-    return new Promise(function(resolve, reject) {</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+    return new Promise((resolve, reject) =&gt; {</span>
<a href="#l67.14"></a><span id="l67.14">         delmgr.wrappedJSObject.completedNotifier.handleCompletion = (aReason) =&gt; {</span>
<a href="#l67.15"></a><span id="l67.15">             if (aReason == mISSC.REASON_FINISHED) {</span>
<a href="#l67.16"></a><span id="l67.16">                 resolve();</span>
<a href="#l67.17"></a><span id="l67.17">             } else {</span>
<a href="#l67.18"></a><span id="l67.18">                 reject(aReason);</span>
<a href="#l67.19"></a><span id="l67.19">             }</span>
<a href="#l67.20"></a><span id="l67.20">         };</span>
<a href="#l67.21"></a><span id="l67.21">         aFunc();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/calendar/test/unit/test_freebusy.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/calendar/test/unit/test_freebusy.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -51,20 +51,20 @@ function test_period() {</span>
<a href="#l68.4"></a><span id="l68.4">     period.icalString = &quot;20120101T010105/PT1S&quot;;</span>
<a href="#l68.5"></a><span id="l68.5">     equal(period.start.icalString, &quot;20120101T010105&quot;);</span>
<a href="#l68.6"></a><span id="l68.6">     equal(period.end.icalString, &quot;20120101T010106&quot;);</span>
<a href="#l68.7"></a><span id="l68.7">     equal(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l68.8"></a><span id="l68.8"> </span>
<a href="#l68.9"></a><span id="l68.9">     period.makeImmutable();</span>
<a href="#l68.10"></a><span id="l68.10">     if (!Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l68.11"></a><span id="l68.11">         // ical.js doesn't support immutability yet</span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-        throws(function() {</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineplus">+        throws(() =&gt; {</span>
<a href="#l68.14"></a><span id="l68.14">             period.start = cal.createDateTime(&quot;20120202T020202&quot;);</span>
<a href="#l68.15"></a><span id="l68.15">         }, /0x80460002/, &quot;Object is Immutable&quot;);</span>
<a href="#l68.16"></a><span id="l68.16" class="difflineminus">-        throws(function() {</span>
<a href="#l68.17"></a><span id="l68.17" class="difflineplus">+        throws(() =&gt; {</span>
<a href="#l68.18"></a><span id="l68.18">             period.end = cal.createDateTime(&quot;20120202T020202&quot;);</span>
<a href="#l68.19"></a><span id="l68.19">         }, /0x80460002/, &quot;Object is Immutable&quot;);</span>
<a href="#l68.20"></a><span id="l68.20">     }</span>
<a href="#l68.21"></a><span id="l68.21"> </span>
<a href="#l68.22"></a><span id="l68.22">     let copy = period.clone();</span>
<a href="#l68.23"></a><span id="l68.23">     equal(copy.start.icalString, &quot;20120101T010105&quot;);</span>
<a href="#l68.24"></a><span id="l68.24">     equal(copy.end.icalString, &quot;20120101T010106&quot;);</span>
<a href="#l68.25"></a><span id="l68.25">     equal(copy.duration.icalString, &quot;PT1S&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -168,17 +168,17 @@ GDataServer.prototype = {</span>
<a href="#l69.4"></a><span id="l69.4">                     { &quot;type&quot;: &quot;eventChange&quot;, &quot;method&quot;: &quot;email&quot; },</span>
<a href="#l69.5"></a><span id="l69.5">                     { &quot;type&quot;: &quot;eventCancellation&quot;, &quot;method&quot;: &quot;email&quot; }</span>
<a href="#l69.6"></a><span id="l69.6">                 ]</span>
<a href="#l69.7"></a><span id="l69.7">             }</span>
<a href="#l69.8"></a><span id="l69.8">         };</span>
<a href="#l69.9"></a><span id="l69.9">     },</span>
<a href="#l69.10"></a><span id="l69.10"> </span>
<a href="#l69.11"></a><span id="l69.11">     waitForLoad: function(aCalendar) {</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-        return new Promise(function(resolve, reject) {</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineplus">+        return new Promise((resolve, reject) =&gt; {</span>
<a href="#l69.14"></a><span id="l69.14">             let observer = cal.createAdapter(Components.interfaces.calIObserver, {</span>
<a href="#l69.15"></a><span id="l69.15">                 onLoad: function() {</span>
<a href="#l69.16"></a><span id="l69.16">                     let uncached = aCalendar.wrappedJSObject.mUncachedCalendar.wrappedJSObject;</span>
<a href="#l69.17"></a><span id="l69.17">                     aCalendar.removeObserver(observer);</span>
<a href="#l69.18"></a><span id="l69.18"> </span>
<a href="#l69.19"></a><span id="l69.19">                     if (Components.isSuccessCode(uncached._lastStatus)) {</span>
<a href="#l69.20"></a><span id="l69.20">                         resolve(aCalendar);</span>
<a href="#l69.21"></a><span id="l69.21">                     } else {</span>
<a href="#l69.22"></a><span id="l69.22" class="difflineat">@@ -196,17 +196,17 @@ GDataServer.prototype = {</span>
<a href="#l69.23"></a><span id="l69.23">                   (this.calendarId ? &quot;&amp;calendar=&quot; + encodeURIComponent(this.calendarId) : &quot;&quot;) +</span>
<a href="#l69.24"></a><span id="l69.24">                   (this.tasksId ? &quot;&amp;tasks=&quot; + encodeURIComponent(this.tasksId) : &quot;&quot;);</span>
<a href="#l69.25"></a><span id="l69.25">         let calmgr = cal.getCalendarManager();</span>
<a href="#l69.26"></a><span id="l69.26">         let client = calmgr.createCalendar(&quot;gdata&quot;, Services.io.newURI(uri, null, null));</span>
<a href="#l69.27"></a><span id="l69.27">         let uclient = client.wrappedJSObject;</span>
<a href="#l69.28"></a><span id="l69.28">         client.name = &quot;xpcshell&quot;;</span>
<a href="#l69.29"></a><span id="l69.29"> </span>
<a href="#l69.30"></a><span id="l69.30">         // Make sure we catch the last error message in case sync fails</span>
<a href="#l69.31"></a><span id="l69.31" class="difflineminus">-        monkeyPatch(uclient, &quot;replayChangesOn&quot;, function(protofunc, aListener) {</span>
<a href="#l69.32"></a><span id="l69.32" class="difflineplus">+        monkeyPatch(uclient, &quot;replayChangesOn&quot;, (protofunc, aListener) =&gt; {</span>
<a href="#l69.33"></a><span id="l69.33">             protofunc({</span>
<a href="#l69.34"></a><span id="l69.34">               onResult: function(op, detail) {</span>
<a href="#l69.35"></a><span id="l69.35">                 uclient._lastStatus = op.status;</span>
<a href="#l69.36"></a><span id="l69.36">                 uclient._lastMessage = detail;</span>
<a href="#l69.37"></a><span id="l69.37">                 aListener.onResult(op, detail);</span>
<a href="#l69.38"></a><span id="l69.38">               }</span>
<a href="#l69.39"></a><span id="l69.39">            });</span>
<a href="#l69.40"></a><span id="l69.40">         });</span>
<a href="#l69.41"></a><span id="l69.41" class="difflineat">@@ -512,17 +512,17 @@ function run_test() {</span>
<a href="#l69.42"></a><span id="l69.42"> </span>
<a href="#l69.43"></a><span id="l69.43"> add_task(function* test_migrate_cache() {</span>
<a href="#l69.44"></a><span id="l69.44">     let uriString = &quot;googleapi://xpcshell/?calendar=xpcshell%40example.com&quot;;</span>
<a href="#l69.45"></a><span id="l69.45">     let uri = Services.io.newURI(uriString, null, null);</span>
<a href="#l69.46"></a><span id="l69.46">     let client = cal.getCalendarManager().createCalendar(&quot;gdata&quot;, uri);</span>
<a href="#l69.47"></a><span id="l69.47">     let unwrapped = client.wrappedJSObject;</span>
<a href="#l69.48"></a><span id="l69.48">     let migrateStorageCache = unwrapped.migrateStorageCache.bind(unwrapped);</span>
<a href="#l69.49"></a><span id="l69.49"> </span>
<a href="#l69.50"></a><span id="l69.50" class="difflineminus">-    monkeyPatch(unwrapped, &quot;resetSync&quot;, function(protofunc) {</span>
<a href="#l69.51"></a><span id="l69.51" class="difflineplus">+    monkeyPatch(unwrapped, &quot;resetSync&quot;, (protofunc) =&gt; {</span>
<a href="#l69.52"></a><span id="l69.52">         return Promise.resolve();</span>
<a href="#l69.53"></a><span id="l69.53">     });</span>
<a href="#l69.54"></a><span id="l69.54"> </span>
<a href="#l69.55"></a><span id="l69.55">     // No version, should not reset</span>
<a href="#l69.56"></a><span id="l69.56">     equal(yield migrateStorageCache(), false);</span>
<a href="#l69.57"></a><span id="l69.57">     equal(client.getProperty(&quot;cache.version&quot;), 3);</span>
<a href="#l69.58"></a><span id="l69.58"> </span>
<a href="#l69.59"></a><span id="l69.59">     // Check migrate 1 -&gt; 2</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/calendar/test/unit/test_ics.js</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/calendar/test/unit/test_ics.js</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -213,12 +213,12 @@ function test_duration() {</span>
<a href="#l70.4"></a><span id="l70.4">     e.endDate = null;</span>
<a href="#l70.5"></a><span id="l70.5">     equal(e.duration.icalString, &quot;PT0S&quot;);</span>
<a href="#l70.6"></a><span id="l70.6"> }</span>
<a href="#l70.7"></a><span id="l70.7"> </span>
<a href="#l70.8"></a><span id="l70.8"> function test_serialize() {</span>
<a href="#l70.9"></a><span id="l70.9">     let e = cal.createEvent();</span>
<a href="#l70.10"></a><span id="l70.10">     let prop = cal.getIcsService().createIcalComponent(&quot;VTODO&quot;);</span>
<a href="#l70.11"></a><span id="l70.11"> </span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-    throws(function() {</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l70.14"></a><span id="l70.14">         e.icalComponent = prop;</span>
<a href="#l70.15"></a><span id="l70.15">     }, /Illegal value/);</span>
<a href="#l70.16"></a><span id="l70.16"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/calendar/test/unit/test_items.js</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/calendar/test/unit/test_items.js</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -214,26 +214,26 @@ function test_immutable() {</span>
<a href="#l71.4"></a><span id="l71.4"> </span>
<a href="#l71.5"></a><span id="l71.5">     // call again, should not throw</span>
<a href="#l71.6"></a><span id="l71.6">     e.makeImmutable();</span>
<a href="#l71.7"></a><span id="l71.7"> </span>
<a href="#l71.8"></a><span id="l71.8">     ok(!e.alarmLastAck.isMutable);</span>
<a href="#l71.9"></a><span id="l71.9">     ok(!org.isMutable);</span>
<a href="#l71.10"></a><span id="l71.10">     ok(!alarm.isMutable);</span>
<a href="#l71.11"></a><span id="l71.11"> </span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">-    throws(function() {</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l71.14"></a><span id="l71.14">         e.alarmLastAck = cal.createDateTime();</span>
<a href="#l71.15"></a><span id="l71.15">     }, /Can not modify immutable data container/);</span>
<a href="#l71.16"></a><span id="l71.16" class="difflineminus">-    throws(function() {</span>
<a href="#l71.17"></a><span id="l71.17" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l71.18"></a><span id="l71.18">         e.calendar = null;</span>
<a href="#l71.19"></a><span id="l71.19">     }, /Can not modify immutable data container/);</span>
<a href="#l71.20"></a><span id="l71.20" class="difflineminus">-    throws(function() {</span>
<a href="#l71.21"></a><span id="l71.21" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l71.22"></a><span id="l71.22">         e.parentItem = null;</span>
<a href="#l71.23"></a><span id="l71.23">     }, /Can not modify immutable data container/);</span>
<a href="#l71.24"></a><span id="l71.24" class="difflineminus">-    throws(function() {</span>
<a href="#l71.25"></a><span id="l71.25" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l71.26"></a><span id="l71.26">         e.setCategories(3, [&quot;d&quot;, &quot;e&quot;, &quot;f&quot;]);</span>
<a href="#l71.27"></a><span id="l71.27">     }, /Can not modify immutable data container/);</span>
<a href="#l71.28"></a><span id="l71.28"> </span>
<a href="#l71.29"></a><span id="l71.29">     let e2 = e.clone();</span>
<a href="#l71.30"></a><span id="l71.30">     e2.organizer.id = &quot;two&quot;;</span>
<a href="#l71.31"></a><span id="l71.31"> </span>
<a href="#l71.32"></a><span id="l71.32">     equal(org.id, &quot;one&quot;);</span>
<a href="#l71.33"></a><span id="l71.33">     equal(e2.organizer.id, &quot;two&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/calendar/test/unit/test_relation.js</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/calendar/test/unit/test_relation.js</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -117,12 +117,12 @@ function test_icalprop() {</span>
<a href="#l72.4"></a><span id="l72.4">     let rel2 = rel.clone();</span>
<a href="#l72.5"></a><span id="l72.5">     rel.icalProperty = prop;</span>
<a href="#l72.6"></a><span id="l72.6"> </span>
<a href="#l72.7"></a><span id="l72.7">     notEqual(rel.icalString, rel2.icalString);</span>
<a href="#l72.8"></a><span id="l72.8"> </span>
<a href="#l72.9"></a><span id="l72.9">     rel.deleteParameter(&quot;X-PROP&quot;);</span>
<a href="#l72.10"></a><span id="l72.10">     equal(rel.icalProperty.getParameter(&quot;X-PROP&quot;), null);</span>
<a href="#l72.11"></a><span id="l72.11"> </span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-    throws(function() {</span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+    throws(() =&gt; {</span>
<a href="#l72.14"></a><span id="l72.14">         rel.icalString = &quot;X-UNKNOWN:value&quot;;</span>
<a href="#l72.15"></a><span id="l72.15">     }, /Illegal value/);</span>
<a href="#l72.16"></a><span id="l72.16"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/calendar/test/unit/test_storage.js</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/calendar/test/unit/test_storage.js</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -19,17 +19,17 @@ function testAttachRoundtrip() {</span>
<a href="#l73.4"></a><span id="l73.4">                &quot;EXDATE:20120301T010101Z&quot;,</span>
<a href="#l73.5"></a><span id="l73.5">                &quot;END:VEVENT&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l73.6"></a><span id="l73.6"> </span>
<a href="#l73.7"></a><span id="l73.7">     let storageItem = createEventFromIcalString(str);</span>
<a href="#l73.8"></a><span id="l73.8"> </span>
<a href="#l73.9"></a><span id="l73.9">     do_test_pending();</span>
<a href="#l73.10"></a><span id="l73.10">     storage.addItem(storageItem, {</span>
<a href="#l73.11"></a><span id="l73.11">         onOperationComplete: function(c, s, o, i, addedItem) {</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-            do_execute_soon(function() {</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineplus">+            do_execute_soon(() =&gt; {</span>
<a href="#l73.14"></a><span id="l73.14">                 // Make sure the cache is cleared, otherwise we'll get the cached item.</span>
<a href="#l73.15"></a><span id="l73.15">                 delete storage.wrappedJSObject.mItemCache[addedItem.id];</span>
<a href="#l73.16"></a><span id="l73.16">                 storage.getItem(addedItem.id, retrieveItem);</span>
<a href="#l73.17"></a><span id="l73.17">             });</span>
<a href="#l73.18"></a><span id="l73.18">         }</span>
<a href="#l73.19"></a><span id="l73.19">     });</span>
<a href="#l73.20"></a><span id="l73.20"> </span>
<a href="#l73.21"></a><span id="l73.21">     let retrieveItem = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/calendar/test/unit/test_webcal.js</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/calendar/test/unit/test_webcal.js</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -31,13 +31,13 @@ function check_webcal_uri(aUri) {</span>
<a href="#l74.4"></a><span id="l74.4"> </span>
<a href="#l74.5"></a><span id="l74.5">     let channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l74.6"></a><span id="l74.6">                                                  null,</span>
<a href="#l74.7"></a><span id="l74.7">                                                  Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l74.8"></a><span id="l74.8">                                                  null,</span>
<a href="#l74.9"></a><span id="l74.9">                                                  Components.interfaces.nsILoadInfo.SEC_NORMAL,</span>
<a href="#l74.10"></a><span id="l74.10">                                                  Components.interfaces.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l74.11"></a><span id="l74.11"> </span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-    NetUtil.asyncFetch(channel, function(data, status, request) {</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineplus">+    NetUtil.asyncFetch(channel, (data, status, request) =&gt; {</span>
<a href="#l74.14"></a><span id="l74.14">         ok(Components.isSuccessCode(status));</span>
<a href="#l74.15"></a><span id="l74.15">         run_next_test();</span>
<a href="#l74.16"></a><span id="l74.16">     });</span>
<a href="#l74.17"></a><span id="l74.17"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

