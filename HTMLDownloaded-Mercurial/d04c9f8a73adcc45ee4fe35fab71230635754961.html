<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 12266:d04c9f8a73adcc45ee4fe35fab71230635754961</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ d04c9f8a73adcc45ee4fe35fab71230635754961" />
<meta property="og:url" content="/comm-central/rev/d04c9f8a73adcc45ee4fe35fab71230635754961" />
<meta property="og:description" content="Bug 849525 Clean up mailnews/subscribe.{js|xul} Port some improvements from Thunderbird r=Mnyromyr moa=Mnyromyr." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / d04c9f8a73adcc45ee4fe35fab71230635754961 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/d04c9f8a73adcc45ee4fe35fab71230635754961">shortlog</a> |
<a href="/comm-central/log/d04c9f8a73adcc45ee4fe35fab71230635754961">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/d04c9f8a73adcc45ee4fe35fab71230635754961">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/d04c9f8a73adcc45ee4fe35fab71230635754961">files</a> |
changeset |
<a href="/comm-central/raw-rev/d04c9f8a73adcc45ee4fe35fab71230635754961">raw</a>  | <a href="/comm-central/archive/d04c9f8a73adcc45ee4fe35fab71230635754961.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=849525">Bug 849525</a> Clean up mailnews/subscribe.{js|xul} Port some improvements from Thunderbird r=Mnyromyr moa=Mnyromyr.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#32;&#67;&#104;&#101;&#101;&#32;&#60;&#112;&#104;&#105;&#108;&#105;&#112;&#46;&#99;&#104;&#101;&#101;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 10 Apr 2013 23:17:18 +0800</td></tr>

<tr>
 <td>changeset 12266</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/d04c9f8a73adcc45ee4fe35fab71230635754961">d04c9f8a73adcc45ee4fe35fab71230635754961</a></td>
</tr>



<tr>
<td>parent 12265</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/34a222f3e8cb07e068fa8e67563860e304bc43c3">34a222f3e8cb07e068fa8e67563860e304bc43c3</a>
</td>
</tr>

<tr>
<td>child 12267</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0d3770a601e5b000829f36e21bd1345ad71255f9">0d3770a601e5b000829f36e21bd1345ad71255f9</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=d04c9f8a73adcc45ee4fe35fab71230635754961">9078</a></td></tr>
<tr><td>push user</td><td>philip.chee@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 10 Apr 2013 15:18:21 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d04c9f8a73ad [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d04c9f8a73adcc45ee4fe35fab71230635754961">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d04c9f8a73adcc45ee4fe35fab71230635754961&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d04c9f8a73adcc45ee4fe35fab71230635754961&newProject=comm-central&newRevision=34a222f3e8cb07e068fa8e67563860e304bc43c3&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d04c9f8a73adcc45ee4fe35fab71230635754961&newProject=comm-central&newRevision=34a222f3e8cb07e068fa8e67563860e304bc43c3&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d04c9f8a73adcc45ee4fe35fab71230635754961&newProject=comm-central&newRevision=34a222f3e8cb07e068fa8e67563860e304bc43c3&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Mnyromyr%29&revcount=50">Mnyromyr</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=849525">849525</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=360510">360510</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=441705">441705</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=455947">455947</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=624092">624092</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=849525">Bug 849525</a> Clean up mailnews/subscribe.{js|xul} Port some improvements from Thunderbird r=Mnyromyr moa=Mnyromyr.
Also: Comment only fixes (punctuation, capitalization) and remove some useless dump() statments.

TB patches ported:
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=360510">Bug 360510</a> - Make subsription checkboxes accessible
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=441705">Bug 441705</a> SetUpServerMenu is no longer used
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=455947">Bug 455947</a> Fix subscribe ui to select the server of the selected folder
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=624092">Bug 624092</a> - Use of undefined object SubscribeOnLoad()</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.js">suite/mailnews/subscribe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.js">file</a> |
<a href="/comm-central/annotate/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.js">annotate</a> |
<a href="/comm-central/diff/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.js">diff</a> |
<a href="/comm-central/comparison/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.js">comparison</a> |
<a href="/comm-central/log/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.xul">suite/mailnews/subscribe.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.xul">file</a> |
<a href="/comm-central/annotate/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.xul">annotate</a> |
<a href="/comm-central/diff/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.xul">diff</a> |
<a href="/comm-central/comparison/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.xul">comparison</a> |
<a href="/comm-central/log/d04c9f8a73adcc45ee4fe35fab71230635754961/suite/mailnews/subscribe.xul">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/mailnews/subscribe.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/mailnews/subscribe.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -25,17 +25,16 @@ var subscribeDS = RDF.GetDataSource(&quot;rdf</span>
<a href="#l1.4"></a><span id="l1.4"> var gSubscribeBundle;</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> function goDoCommand()</span>
<a href="#l1.7"></a><span id="l1.7"> {</span>
<a href="#l1.8"></a><span id="l1.8"> }</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> function Stop()</span>
<a href="#l1.11"></a><span id="l1.11"> {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    //dump(&quot;Stop()\n&quot;)</span>
<a href="#l1.13"></a><span id="l1.13">     if (gSubscribableServer) {</span>
<a href="#l1.14"></a><span id="l1.14">         gSubscribableServer.stopPopulating(msgWindow);</span>
<a href="#l1.15"></a><span id="l1.15">     }</span>
<a href="#l1.16"></a><span id="l1.16"> }</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> function SetServerTypeSpecificTextValues()</span>
<a href="#l1.19"></a><span id="l1.19"> {</span>
<a href="#l1.20"></a><span id="l1.20">     if (!gServerURI)</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -68,47 +67,25 @@ function SetServerTypeSpecificTextValues</span>
<a href="#l1.22"></a><span id="l1.22"> function onServerClick(event)</span>
<a href="#l1.23"></a><span id="l1.23"> {</span>
<a href="#l1.24"></a><span id="l1.24">   gServerURI = event.target.id;</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">   SetServerTypeSpecificTextValues();</span>
<a href="#l1.27"></a><span id="l1.27">   ShowCurrentList();</span>
<a href="#l1.28"></a><span id="l1.28"> }</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-function SetUpServerMenu()</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-{</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-	//dump(&quot;SetUpServerMenu()\n&quot;);</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-    var serverMenu = document.getElementById(&quot;serverMenu&quot;);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-    var menuitems = serverMenu.getElementsByAttribute(&quot;id&quot;, gServerURI);</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-	try {</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-		//dump(&quot;gServerURI=&quot;+gServerURI+&quot;\n&quot;);</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-		//dump(&quot;menuitems=&quot;+menuitems+&quot;\n&quot;);</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-		//dump(&quot;menuitems[0]=&quot;+menuitems[0]+&quot;\n&quot;);</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-		//dump(&quot;serverMenu=&quot;+serverMenu+&quot;\n&quot;);</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-    	serverMenu.selectedItem = menuitems[0];</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-	}</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-	catch (ex) {</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-		//dump(&quot;failed to set the selected server: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-	}</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-	SetServerTypeSpecificTextValues();</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-}</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-</span>
<a href="#l1.51"></a><span id="l1.51"> var MySubscribeListener = {</span>
<a href="#l1.52"></a><span id="l1.52">     OnDonePopulating: function() {</span>
<a href="#l1.53"></a><span id="l1.53">         gStatusFeedback._stopMeteors();</span>
<a href="#l1.54"></a><span id="l1.54"> </span>
<a href="#l1.55"></a><span id="l1.55">         // only re-root the tree, if it is null.</span>
<a href="#l1.56"></a><span id="l1.56">         // otherwise, we are in here because we are populating</span>
<a href="#l1.57"></a><span id="l1.57">         // a part of the tree</span>
<a href="#l1.58"></a><span id="l1.58">         var refValue = gSubscribeTree.getAttribute('ref');</span>
<a href="#l1.59"></a><span id="l1.59">         if (!refValue) {</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-            //dump(&quot;root subscribe tree at: &quot;+ gServerURI +&quot;\n&quot;);</span>
<a href="#l1.61"></a><span id="l1.61">             gSubscribeTree.database.AddDataSource(subscribeDS);</span>
<a href="#l1.62"></a><span id="l1.62">             gSubscribeTree.setAttribute('ref',gServerURI);</span>
<a href="#l1.63"></a><span id="l1.63">         }</span>
<a href="#l1.64"></a><span id="l1.64"> </span>
<a href="#l1.65"></a><span id="l1.65">         document.getElementById(&quot;refreshButton&quot;).disabled = false;</span>
<a href="#l1.66"></a><span id="l1.66">         document.getElementById(&quot;currentListTab&quot;).disabled = false;</span>
<a href="#l1.67"></a><span id="l1.67">         document.getElementById(&quot;newGroupsTab&quot;).disabled = false;</span>
<a href="#l1.68"></a><span id="l1.68">     }</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineat">@@ -178,17 +155,16 @@ function EnableSearchUI()</span>
<a href="#l1.70"></a><span id="l1.70">   else {</span>
<a href="#l1.71"></a><span id="l1.71">     gNameField.setAttribute('disabled',true);</span>
<a href="#l1.72"></a><span id="l1.72">     gNameFieldLabel.setAttribute('disabled',true);</span>
<a href="#l1.73"></a><span id="l1.73">   }</span>
<a href="#l1.74"></a><span id="l1.74"> }</span>
<a href="#l1.75"></a><span id="l1.75"> </span>
<a href="#l1.76"></a><span id="l1.76"> function SubscribeOnLoad()</span>
<a href="#l1.77"></a><span id="l1.77"> {</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-  //dump(&quot;SubscribeOnLoad()\n&quot;);</span>
<a href="#l1.79"></a><span id="l1.79">   gSubscribeBundle = document.getElementById(&quot;bundle_subscribe&quot;);</span>
<a href="#l1.80"></a><span id="l1.80">   gMessengerBundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l1.81"></a><span id="l1.81"> </span>
<a href="#l1.82"></a><span id="l1.82">   gSubscribeTree = document.getElementById(&quot;subscribeTree&quot;);</span>
<a href="#l1.83"></a><span id="l1.83">   gSearchTree = document.getElementById(&quot;searchTree&quot;);</span>
<a href="#l1.84"></a><span id="l1.84">   gSearchTreeBoxObject = document.getElementById(&quot;searchTree&quot;).treeBoxObject;</span>
<a href="#l1.85"></a><span id="l1.85">   gNameField = document.getElementById(&quot;namefield&quot;);</span>
<a href="#l1.86"></a><span id="l1.86">   gNameFieldLabel = document.getElementById(&quot;namefieldlabel&quot;);</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineat">@@ -197,58 +173,61 @@ function SubscribeOnLoad()</span>
<a href="#l1.88"></a><span id="l1.88"> </span>
<a href="#l1.89"></a><span id="l1.89">   msgWindow = Components.classes[&quot;@mozilla.org/messenger/msgwindow;1&quot;]</span>
<a href="#l1.90"></a><span id="l1.90">                         .createInstance(Components.interfaces.nsIMsgWindow);</span>
<a href="#l1.91"></a><span id="l1.91">   msgWindow.domWindow = window;</span>
<a href="#l1.92"></a><span id="l1.92">   msgWindow.statusFeedback = gStatusFeedback;</span>
<a href="#l1.93"></a><span id="l1.93">   msgWindow.rootDocShell.allowAuth = true;</span>
<a href="#l1.94"></a><span id="l1.94">   msgWindow.rootDocShell.appType = Components.interfaces.nsIDocShell.APP_TYPE_MAIL;</span>
<a href="#l1.95"></a><span id="l1.95"> </span>
<a href="#l1.96"></a><span id="l1.96" class="difflineminus">-	// look in arguments[0] for parameters</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineminus">-	if (window.arguments &amp;&amp; window.arguments[0]) {</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineminus">-		if ( window.arguments[0].okCallback ) {</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineminus">-			top.okCallback = window.arguments[0].okCallback;</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineminus">-		}</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineminus">-	}</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineminus">-	</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineminus">-	gServerURI = null;</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineminus">-	if (window.arguments[0].folder) {</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineminus">-                var folder = window.arguments[0].folder;</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineminus">-		try {</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineminus">-                        CleanUpSearchView();</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineminus">-			gSubscribableServer = folder.server.QueryInterface(Components.interfaces.nsISubscribableServer);</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineminus">-                        // enable (or disable) the search related UI</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineminus">-                        EnableSearchUI();</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineminus">-			gServerURI = folder.server.serverURI;</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineminus">-		}</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineminus">-		catch (ex) {</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineminus">-			//dump(&quot;not a subscribable server\n&quot;);</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineminus">-                        CleanUpSearchView();</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineminus">-			gSubscribableServer = null;</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineminus">-			gServerURI = null;</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineminus">-		}</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineminus">-	}</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+  // look in arguments[0] for parameters</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineplus">+  if (window.arguments &amp;&amp; window.arguments[0]) {</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+    if ( window.arguments[0].okCallback ) {</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineplus">+      top.okCallback = window.arguments[0].okCallback;</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineplus">+    }</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineplus">+  }</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineplus">+</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineplus">+  gServerURI = null;</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineplus">+  CleanUpSearchView();</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineplus">+  var folder = window.arguments[0].folder;</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineplus">+  if (folder &amp;&amp; folder.server instanceof Components.interfaces.nsISubscribableServer)</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineplus">+  {</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineplus">+    gSubscribableServer = folder.server;</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineplus">+    gServerURI = folder.server.serverURI;</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineplus">+    // enable (or disable) the search related UI</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineplus">+    EnableSearchUI();</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineplus">+  }</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineplus">+  else</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineplus">+  {</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineplus">+    gSubscribableServer = null;</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineplus">+    gServerURI = null;</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineplus">+  }</span>
<a href="#l1.142"></a><span id="l1.142"> </span>
<a href="#l1.143"></a><span id="l1.143" class="difflineminus">-	if (!gServerURI) {</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineminus">-		//dump(&quot;subscribe: no uri\n&quot;);</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineminus">-		//dump(&quot;xxx todo:  use the default news server.  right now, I'm just using the first server\n&quot;);</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineminus">-		var serverMenu = document.getElementById(&quot;serverMenu&quot;);</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineminus">-		var menuitems = serverMenu.getElementsByTagName(&quot;menuitem&quot;);</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineminus">-		</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineminus">-		if (menuitems.length &gt; 1) {</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineminus">-			gServerURI = menuitems[1].id;</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineminus">-		}</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineminus">-		else {</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineminus">-			//dump(&quot;xxx todo none of your servers are subscribable\n&quot;);</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineminus">-			//dump(&quot;xxx todo fix this by disabling subscribe if no subscribable server or, add a CREATE SERVER button, like in 4.x\n&quot;);</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineminus">-			return;</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineminus">-		}</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineminus">-	}</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineplus">+  var serverMenu = document.getElementById(&quot;serverMenu&quot;);</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineplus">+  var menuitems = serverMenu.getElementsByTagName(&quot;menuitem&quot;);</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineplus">+</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineplus">+  if (!gServerURI) {</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineplus">+    //dump(&quot;subscribe: no uri\n&quot;);</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineplus">+    //dump(&quot;xxx todo:  use the default news server.  right now, I'm just using the first server\n&quot;);</span>
<a href="#l1.164"></a><span id="l1.164"> </span>
<a href="#l1.165"></a><span id="l1.165" class="difflineminus">-	SetUpServerMenu();</span>
<a href="#l1.166"></a><span id="l1.166" class="difflineplus">+    if (menuitems.length &gt; 1) {</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineplus">+      gServerURI = menuitems[1].id;</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineplus">+    }</span>
<a href="#l1.169"></a><span id="l1.169" class="difflineplus">+    else {</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineplus">+      //dump(&quot;xxx todo none of your servers are subscribable\n&quot;);</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineplus">+      //dump(&quot;xxx todo fix this by disabling subscribe if no subscribable server or, add a CREATE SERVER button, like in 4.x\n&quot;);</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineplus">+      return;</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineplus">+    }</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineplus">+  }</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineplus">+</span>
<a href="#l1.176"></a><span id="l1.176" class="difflineplus">+  var menuitem = serverMenu.getElementsByAttribute(&quot;id&quot;, gServerURI);</span>
<a href="#l1.177"></a><span id="l1.177" class="difflineplus">+  if (menuitem.length)</span>
<a href="#l1.178"></a><span id="l1.178" class="difflineplus">+    serverMenu.selectedItem = menuitem[0];</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineplus">+</span>
<a href="#l1.180"></a><span id="l1.180" class="difflineplus">+  SetServerTypeSpecificTextValues();</span>
<a href="#l1.181"></a><span id="l1.181"> </span>
<a href="#l1.182"></a><span id="l1.182">   ShowCurrentList();</span>
<a href="#l1.183"></a><span id="l1.183"> </span>
<a href="#l1.184"></a><span id="l1.184">   gNameField.focus();</span>
<a href="#l1.185"></a><span id="l1.185"> }</span>
<a href="#l1.186"></a><span id="l1.186"> </span>
<a href="#l1.187"></a><span id="l1.187"> function subscribeOK()</span>
<a href="#l1.188"></a><span id="l1.188"> {</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineat">@@ -330,25 +309,25 @@ function SearchOnClick(event)</span>
<a href="#l1.190"></a><span id="l1.190">     // double clicked on a row, reverse state</span>
<a href="#l1.191"></a><span id="l1.191">     ReverseStateFromRow(row.value);</span>
<a href="#l1.192"></a><span id="l1.192">   }</span>
<a href="#l1.193"></a><span id="l1.193"> </span>
<a href="#l1.194"></a><span id="l1.194">   // invalidate the row</span>
<a href="#l1.195"></a><span id="l1.195">   InvalidateSearchTreeRow(row.value);</span>
<a href="#l1.196"></a><span id="l1.196"> }</span>
<a href="#l1.197"></a><span id="l1.197"> </span>
<a href="#l1.198"></a><span id="l1.198" class="difflineminus">-function ReverseStateFromRow(row)</span>
<a href="#l1.199"></a><span id="l1.199" class="difflineplus">+function ReverseStateFromRow(aRow)</span>
<a href="#l1.200"></a><span id="l1.200"> {</span>
<a href="#l1.201"></a><span id="l1.201" class="difflineminus">-    // to determine if the row is subscribed or not,</span>
<a href="#l1.202"></a><span id="l1.202" class="difflineplus">+    // To determine if the row is subscribed or not,</span>
<a href="#l1.203"></a><span id="l1.203">     // we get the properties for the &quot;subscribedColumn2&quot; cell in the row</span>
<a href="#l1.204"></a><span id="l1.204" class="difflineminus">-    // and look for the &quot;subscribed&quot; property</span>
<a href="#l1.205"></a><span id="l1.205" class="difflineminus">-    // if the &quot;subscribed&quot; atom is in the list of properties</span>
<a href="#l1.206"></a><span id="l1.206" class="difflineminus">-    // we are subscribed</span>
<a href="#l1.207"></a><span id="l1.207" class="difflineplus">+    // and look for the &quot;subscribed&quot; property.</span>
<a href="#l1.208"></a><span id="l1.208" class="difflineplus">+    // If the &quot;subscribed&quot; string is in the list of properties</span>
<a href="#l1.209"></a><span id="l1.209" class="difflineplus">+    // we are subscribed.</span>
<a href="#l1.210"></a><span id="l1.210">     var col = gSearchTree.columns[&quot;subscribedColumn2&quot;];</span>
<a href="#l1.211"></a><span id="l1.211" class="difflineminus">-    var properties = gSearchView.getCellProperties(row, col);</span>
<a href="#l1.212"></a><span id="l1.212" class="difflineplus">+    var properties = gSearchView.getCellProperties(aRow, col);</span>
<a href="#l1.213"></a><span id="l1.213">     var isSubscribed = /\bsubscribed\b/.test(properties);</span>
<a href="#l1.214"></a><span id="l1.214">     SetStateFromRow(row, !isSubscribed);</span>
<a href="#l1.215"></a><span id="l1.215"> }</span>
<a href="#l1.216"></a><span id="l1.216"> </span>
<a href="#l1.217"></a><span id="l1.217"> function SetStateFromRow(row, state)</span>
<a href="#l1.218"></a><span id="l1.218"> {</span>
<a href="#l1.219"></a><span id="l1.219">     var col = gSearchTree.columns[&quot;nameColumn2&quot;];</span>
<a href="#l1.220"></a><span id="l1.220">     var name = gSearchView.getCellText(row, col);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/mailnews/subscribe.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/mailnews/subscribe.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -126,17 +126,18 @@</span>
<a href="#l2.4"></a><span id="l2.4">                             &lt;/bindings&gt;</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6">                             &lt;action&gt;</span>
<a href="#l2.7"></a><span id="l2.7">                               &lt;treechildren&gt;</span>
<a href="#l2.8"></a><span id="l2.8">                                 &lt;treeitem uri=&quot;?member&quot;&gt;</span>
<a href="#l2.9"></a><span id="l2.9">                                   &lt;treerow&gt;</span>
<a href="#l2.10"></a><span id="l2.10">                                     &lt;treecell label=&quot;?LeafName&quot;</span>
<a href="#l2.11"></a><span id="l2.11">                                               properties=&quot;ServerType-?ServerType Subscribable-?Subscribable&quot;/&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-                                    &lt;treecell properties=&quot;Subscribed-?Subscribed Subscribable-?Subscribable&quot;/&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+                                    &lt;treecell value=&quot;?Subscribed&quot;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+                                              properties=&quot;Subscribed-?Subscribed Subscribable-?Subscribable&quot;/&gt;</span>
<a href="#l2.15"></a><span id="l2.15">                                     &lt;!-- commenting out until bug 38906 is fixed</span>
<a href="#l2.16"></a><span id="l2.16">                                     &lt;treecell label=&quot;?TotalMessages&quot;/&gt; --&gt;</span>
<a href="#l2.17"></a><span id="l2.17">                                   &lt;/treerow&gt;</span>
<a href="#l2.18"></a><span id="l2.18">                                 &lt;/treeitem&gt;</span>
<a href="#l2.19"></a><span id="l2.19">                               &lt;/treechildren&gt;</span>
<a href="#l2.20"></a><span id="l2.20">                             &lt;/action&gt;</span>
<a href="#l2.21"></a><span id="l2.21">                         &lt;/rule&gt;</span>
<a href="#l2.22"></a><span id="l2.22">                       &lt;/template&gt;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

