<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25021:ded30314a53cfd75d95db2e808f3a5fdc6b4fd62</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ded30314a53cfd75d95db2e808f3a5fdc6b4fd62" />
<meta property="og:url" content="/comm-central/rev/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62" />
<meta property="og:description" content="Bug 1497488: Don't just say &quot;unknown error&quot; when a Mozilla security error occurs when sending. r=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ded30314a53cfd75d95db2e808f3a5fdc6b4fd62 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62">shortlog</a> |
<a href="/comm-central/log/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62">files</a> |
changeset |
<a href="/comm-central/raw-rev/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62">raw</a>  | <a href="/comm-central/archive/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1497488">Bug 1497488</a>: Don't just say &quot;unknown error&quot; when a Mozilla security error occurs when sending. r=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#110;&#101;&#32;&#83;&#109;&#105;&#116;&#104;&#32;&#60;&#103;&#100;&#115;&#64;&#99;&#104;&#97;&#114;&#116;&#101;&#114;&#116;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 21 Oct 2018 02:47:15 -0400</td></tr>

<tr>
 <td>changeset 25021</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62">ded30314a53cfd75d95db2e808f3a5fdc6b4fd62</a></td>
</tr>



<tr>
<td>parent 25020</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1c2a3007c1f5ab75a11afcecd0625d827383c75a">1c2a3007c1f5ab75a11afcecd0625d827383c75a</a>
</td>
</tr>

<tr>
<td>child 25022</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/70c2176c3b1322967407ed66b46c5ae129427a1e">70c2176c3b1322967407ed66b46c5ae129427a1e</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ded30314a53cfd75d95db2e808f3a5fdc6b4fd62">15036</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 22 Oct 2018 19:52:14 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@92010c1e95c1 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=92010c1e95c1222f1fea4a07a92b23f1cbeb9848">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=92010c1e95c1222f1fea4a07a92b23f1cbeb9848&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=92010c1e95c1222f1fea4a07a92b23f1cbeb9848&newProject=comm-central&newRevision=ded30314a53cfd75d95db2e808f3a5fdc6b4fd62&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=92010c1e95c1222f1fea4a07a92b23f1cbeb9848&newProject=comm-central&newRevision=ded30314a53cfd75d95db2e808f3a5fdc6b4fd62&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=92010c1e95c1222f1fea4a07a92b23f1cbeb9848&newProject=comm-central&newRevision=ded30314a53cfd75d95db2e808f3a5fdc6b4fd62&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1497488">1497488</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1497488">Bug 1497488</a>: Don't just say &quot;unknown error&quot; when a Mozilla security error occurs when sending. r=jorgk
Now show the string defined by the Mozilla platform when a SMTP send security error occurs.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">file</a> |
<a href="/comm-central/annotate/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">annotate</a> |
<a href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">diff</a> |
<a href="/comm-central/comparison/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">comparison</a> |
<a href="/comm-central/log/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.cpp">mailnews/compose/src/nsComposeStrings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.cpp">file</a> |
<a href="/comm-central/annotate/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.cpp">annotate</a> |
<a href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.cpp">diff</a> |
<a href="/comm-central/comparison/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.cpp">comparison</a> |
<a href="/comm-central/log/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.h">mailnews/compose/src/nsComposeStrings.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.h">file</a> |
<a href="/comm-central/annotate/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.h">annotate</a> |
<a href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.h">diff</a> |
<a href="/comm-central/comparison/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.h">comparison</a> |
<a href="/comm-central/log/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsComposeStrings.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSendReport.cpp">mailnews/compose/src/nsMsgSendReport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSendReport.cpp">file</a> |
<a href="/comm-central/annotate/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSendReport.cpp">annotate</a> |
<a href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSendReport.cpp">diff</a> |
<a href="/comm-central/comparison/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSendReport.cpp">comparison</a> |
<a href="/comm-central/log/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/mailnews/compose/src/nsMsgSendReport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">file</a> |
<a href="/comm-central/annotate/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">annotate</a> |
<a href="/comm-central/diff/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">diff</a> |
<a href="/comm-central/comparison/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">comparison</a> |
<a href="/comm-central/log/ded30314a53cfd75d95db2e808f3a5fdc6b4fd62/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -23,16 +23,22 @@ errorSendingFromCommand=An error occurre</span>
<a href="#l1.4"></a><span id="l1.4"> errorSendingDataCommand=An Outgoing server (SMTP) error occurred while sending mail. The server responded:  %s.</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> ## LOCALIZATION NOTE (errorSendingMessage): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l1.7"></a><span id="l1.7"> errorSendingMessage=An error occurred while sending mail. The mail server responded:  %s. Please check the message and try again.</span>
<a href="#l1.8"></a><span id="l1.8"> postFailed=The message could not be posted because connecting to the news server failed. The server may be unavailable or is refusing connections. Please verify that your news server settings are correct and try again.</span>
<a href="#l1.9"></a><span id="l1.9"> errorQueuedDeliveryFailed=An error occurred while delivering the unsent messages.</span>
<a href="#l1.10"></a><span id="l1.10"> sendFailed=Sending of the message failed.</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+## LOCALIZATION NOTE (sendFailedUnexpected): argument %X is a hex error code value</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+sendFailedUnexpected=Failed due to unexpected error %X. No description is available.</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+## LOCALIZATION NOTE (smtpSecurityIssue): argument %S is the Outgoing server (SMTP) response</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+smtpSecurityIssue=The configuration related to %S must be corrected.</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+</span>
<a href="#l1.18"></a><span id="l1.18"> ## LOCALIZATION NOTE (smtpServerError): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l1.19"></a><span id="l1.19"> smtpServerError=An error occurred while sending mail: Outgoing server (SMTP) error. The server responded:  %s.</span>
<a href="#l1.20"></a><span id="l1.20"> unableToSendLater=Sorry, we were unable to save your message for sending later.</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22"> ## LOCALIZATION NOTE (communicationsError): argument %d is the error code</span>
<a href="#l1.23"></a><span id="l1.23"> communicationsError=A communications error occurred: %d.  Please try again.</span>
<a href="#l1.24"></a><span id="l1.24"> dontShowAlert=THIS IS JUST A PLACEHOLDER.  YOU SHOULD NEVER SEE THIS STRING.</span>
<a href="#l1.25"></a><span id="l1.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/compose/src/nsComposeStrings.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/compose/src/nsComposeStrings.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -34,18 +34,16 @@ const char* errorStringNameForErrorCode(</span>
<a href="#l2.4"></a><span id="l2.4">     case NS_ERROR_SENDING_DATA_COMMAND:</span>
<a href="#l2.5"></a><span id="l2.5">       return &quot;errorSendingDataCommand&quot;;</span>
<a href="#l2.6"></a><span id="l2.6">     case NS_ERROR_SENDING_MESSAGE:</span>
<a href="#l2.7"></a><span id="l2.7">       return &quot;errorSendingMessage&quot;;</span>
<a href="#l2.8"></a><span id="l2.8">     case NS_ERROR_POST_FAILED:</span>
<a href="#l2.9"></a><span id="l2.9">       return &quot;postFailed&quot;;</span>
<a href="#l2.10"></a><span id="l2.10">     case NS_ERROR_QUEUED_DELIVERY_FAILED:</span>
<a href="#l2.11"></a><span id="l2.11">       return &quot;errorQueuedDeliveryFailed&quot;;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    case NS_ERROR_SEND_FAILED:</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-      return &quot;sendFailed&quot;;</span>
<a href="#l2.14"></a><span id="l2.14">     case NS_ERROR_SMTP_SERVER_ERROR:</span>
<a href="#l2.15"></a><span id="l2.15">       return &quot;smtpServerError&quot;;</span>
<a href="#l2.16"></a><span id="l2.16">     case NS_MSG_UNABLE_TO_SEND_LATER:</span>
<a href="#l2.17"></a><span id="l2.17">       return &quot;unableToSendLater&quot;;</span>
<a href="#l2.18"></a><span id="l2.18">     case NS_ERROR_COMMUNICATIONS_ERROR:</span>
<a href="#l2.19"></a><span id="l2.19">       return &quot;communicationsError&quot;;</span>
<a href="#l2.20"></a><span id="l2.20">     case NS_ERROR_BUT_DONT_SHOW_ALERT:</span>
<a href="#l2.21"></a><span id="l2.21">       return &quot;dontShowAlert&quot;;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -103,16 +101,16 @@ const char* errorStringNameForErrorCode(</span>
<a href="#l2.23"></a><span id="l2.23">       return &quot;smtpAuthFailure&quot;;</span>
<a href="#l2.24"></a><span id="l2.24">     case NS_ERROR_SMTP_AUTH_GSSAPI:</span>
<a href="#l2.25"></a><span id="l2.25">       return &quot;smtpAuthGssapi&quot;;</span>
<a href="#l2.26"></a><span id="l2.26">     case NS_ERROR_SMTP_AUTH_MECH_NOT_SUPPORTED:</span>
<a href="#l2.27"></a><span id="l2.27">       return &quot;smtpAuthMechNotSupported&quot;;</span>
<a href="#l2.28"></a><span id="l2.28">     case NS_ERROR_SMTP_AUTH_NOT_SUPPORTED:</span>
<a href="#l2.29"></a><span id="l2.29">       return &quot;smtpAuthenticationNotSupported&quot;;</span>
<a href="#l2.30"></a><span id="l2.30">     case NS_ERROR_ILLEGAL_LOCALPART:</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-      return &quot;illegalLocalPart&quot;;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+      return &quot;errorIllegalLocalPart&quot;;</span>
<a href="#l2.33"></a><span id="l2.33">     default:</span>
<a href="#l2.34"></a><span id="l2.34">       return &quot;sendFailed&quot;;</span>
<a href="#l2.35"></a><span id="l2.35">   }</span>
<a href="#l2.36"></a><span id="l2.36"> #ifdef __GNUC__</span>
<a href="#l2.37"></a><span id="l2.37"> #pragma GCC diagnostic pop</span>
<a href="#l2.38"></a><span id="l2.38"> #endif</span>
<a href="#l2.39"></a><span id="l2.39"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/compose/src/nsComposeStrings.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/compose/src/nsComposeStrings.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -20,17 +20,16 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #define NS_MSG_NO_SENDER                            NS_MSG_GENERATE_FAILURE(12510)</span>
<a href="#l3.5"></a><span id="l3.5"> #define NS_MSG_NO_RECIPIENTS                        NS_MSG_GENERATE_FAILURE(12511)</span>
<a href="#l3.6"></a><span id="l3.6"> #define NS_MSG_ERROR_WRITING_FILE                   NS_MSG_GENERATE_FAILURE(12512)</span>
<a href="#l3.7"></a><span id="l3.7"> #define NS_ERROR_SENDING_FROM_COMMAND               NS_MSG_GENERATE_FAILURE(12514)</span>
<a href="#l3.8"></a><span id="l3.8"> #define NS_ERROR_SENDING_DATA_COMMAND               NS_MSG_GENERATE_FAILURE(12516)</span>
<a href="#l3.9"></a><span id="l3.9"> #define NS_ERROR_SENDING_MESSAGE                    NS_MSG_GENERATE_FAILURE(12517)</span>
<a href="#l3.10"></a><span id="l3.10"> #define NS_ERROR_POST_FAILED                        NS_MSG_GENERATE_FAILURE(12518)</span>
<a href="#l3.11"></a><span id="l3.11"> #define NS_ERROR_QUEUED_DELIVERY_FAILED             NS_MSG_GENERATE_FAILURE(12519)</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-#define NS_ERROR_SEND_FAILED                        NS_MSG_GENERATE_FAILURE(12520)</span>
<a href="#l3.13"></a><span id="l3.13"> #define NS_ERROR_SMTP_SERVER_ERROR                  NS_MSG_GENERATE_FAILURE(12524)</span>
<a href="#l3.14"></a><span id="l3.14"> #define NS_MSG_UNABLE_TO_SEND_LATER                 NS_MSG_GENERATE_FAILURE(12525)</span>
<a href="#l3.15"></a><span id="l3.15"> #define NS_ERROR_COMMUNICATIONS_ERROR               NS_MSG_GENERATE_FAILURE(12526)</span>
<a href="#l3.16"></a><span id="l3.16"> #define NS_ERROR_BUT_DONT_SHOW_ALERT                NS_MSG_GENERATE_FAILURE(12527)</span>
<a href="#l3.17"></a><span id="l3.17"> #define NS_ERROR_TCP_READ_ERROR                     NS_MSG_GENERATE_FAILURE(12528)</span>
<a href="#l3.18"></a><span id="l3.18"> #define NS_ERROR_COULD_NOT_GET_USERS_MAIL_ADDRESS   NS_MSG_GENERATE_FAILURE(12529)</span>
<a href="#l3.19"></a><span id="l3.19"> #define NS_ERROR_COULD_NOT_GET_SENDERS_IDENTITY     NS_MSG_GENERATE_FAILURE(12530)</span>
<a href="#l3.20"></a><span id="l3.20"> #define NS_ERROR_MIME_MPART_ATTACHMENT_ERROR        NS_MSG_GENERATE_FAILURE(12531)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -77,16 +77,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #include &quot;mozilla/dom/HTMLBodyElement.h&quot;</span>
<a href="#l4.5"></a><span id="l4.5"> #include &quot;mozilla/dom/HTMLImageElement.h&quot;</span>
<a href="#l4.6"></a><span id="l4.6"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l4.7"></a><span id="l4.7"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l4.8"></a><span id="l4.8"> #include &quot;nsIMsgProtocolInfo.h&quot;</span>
<a href="#l4.9"></a><span id="l4.9"> #include &quot;mozIDOMWindow.h&quot;</span>
<a href="#l4.10"></a><span id="l4.10"> #include &quot;mozilla/Preferences.h&quot;</span>
<a href="#l4.11"></a><span id="l4.11"> #include &quot;nsIURIMutator.h&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+#include &quot;nsINSSErrorsService.h&quot;</span>
<a href="#l4.13"></a><span id="l4.13"> </span>
<a href="#l4.14"></a><span id="l4.14"> using namespace mozilla;</span>
<a href="#l4.15"></a><span id="l4.15"> using namespace mozilla::dom;</span>
<a href="#l4.16"></a><span id="l4.16"> using namespace mozilla::mailnews;</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18"> static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20"> #define PREF_MAIL_SEND_STRUCT &quot;mail.send_struct&quot;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -3127,28 +3128,27 @@ NS_IMETHODIMP nsMsgComposeAndSend::SendD</span>
<a href="#l4.22"></a><span id="l4.22">         case NS_ERROR_UNKNOWN_PROXY_HOST:</span>
<a href="#l4.23"></a><span id="l4.23">           aExitCode = NS_ERROR_SMTP_SEND_FAILED_UNKNOWN_SERVER;</span>
<a href="#l4.24"></a><span id="l4.24">           break;</span>
<a href="#l4.25"></a><span id="l4.25">         case NS_ERROR_CONNECTION_REFUSED:</span>
<a href="#l4.26"></a><span id="l4.26">         case NS_ERROR_PROXY_CONNECTION_REFUSED:</span>
<a href="#l4.27"></a><span id="l4.27">           aExitCode = NS_ERROR_SMTP_SEND_FAILED_REFUSED;</span>
<a href="#l4.28"></a><span id="l4.28">           break;</span>
<a href="#l4.29"></a><span id="l4.29">         case NS_ERROR_NET_INTERRUPT:</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+        case NS_ERROR_ABORT:</span>
<a href="#l4.31"></a><span id="l4.31">           aExitCode = NS_ERROR_SMTP_SEND_FAILED_INTERRUPTED;</span>
<a href="#l4.32"></a><span id="l4.32">           break;</span>
<a href="#l4.33"></a><span id="l4.33">         case NS_ERROR_NET_TIMEOUT:</span>
<a href="#l4.34"></a><span id="l4.34">         case NS_ERROR_NET_RESET:</span>
<a href="#l4.35"></a><span id="l4.35">           aExitCode = NS_ERROR_SMTP_SEND_FAILED_TIMEOUT;</span>
<a href="#l4.36"></a><span id="l4.36">           break;</span>
<a href="#l4.37"></a><span id="l4.37">         case NS_ERROR_SMTP_PASSWORD_UNDEFINED:</span>
<a href="#l4.38"></a><span id="l4.38">             // nothing to do, just keep the code</span>
<a href="#l4.39"></a><span id="l4.39">           break;</span>
<a href="#l4.40"></a><span id="l4.40">         default:</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-          if (aExitCode != NS_ERROR_ABORT &amp;&amp; !NS_IS_MSG_ERROR(aExitCode))</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-            aExitCode = NS_ERROR_SMTP_SEND_FAILED_UNKNOWN_REASON;</span>
<a href="#l4.43"></a><span id="l4.43">           break;</span>
<a href="#l4.44"></a><span id="l4.44">       }</span>
<a href="#l4.45"></a><span id="l4.45"> #ifdef __GNUC__</span>
<a href="#l4.46"></a><span id="l4.46"> #pragma GCC diagnostic pop</span>
<a href="#l4.47"></a><span id="l4.47"> #endif</span>
<a href="#l4.48"></a><span id="l4.48">     }</span>
<a href="#l4.49"></a><span id="l4.49">     DeliverAsMailExit(aUrl, aExitCode);</span>
<a href="#l4.50"></a><span id="l4.50">   }</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineat">@@ -3488,34 +3488,64 @@ nsMsgComposeAndSend::DoDeliveryExitProce</span>
<a href="#l4.52"></a><span id="l4.52"> {</span>
<a href="#l4.53"></a><span id="l4.53">   // If we fail on the news delivery, no sense in going on so just notify</span>
<a href="#l4.54"></a><span id="l4.54">   // the user and exit.</span>
<a href="#l4.55"></a><span id="l4.55">   if (NS_FAILED(aExitCode))</span>
<a href="#l4.56"></a><span id="l4.56">   {</span>
<a href="#l4.57"></a><span id="l4.57">     const char* exitString = errorStringNameForErrorCode(aExitCode);</span>
<a href="#l4.58"></a><span id="l4.58">     nsString eMsg;</span>
<a href="#l4.59"></a><span id="l4.59">     if (aExitCode == NS_ERROR_SMTP_SEND_FAILED_UNKNOWN_SERVER ||</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-        aExitCode == NS_ERROR_SMTP_SEND_FAILED_UNKNOWN_REASON ||</span>
<a href="#l4.61"></a><span id="l4.61">         aExitCode == NS_ERROR_SMTP_SEND_FAILED_REFUSED ||</span>
<a href="#l4.62"></a><span id="l4.62">         aExitCode == NS_ERROR_SMTP_SEND_FAILED_INTERRUPTED ||</span>
<a href="#l4.63"></a><span id="l4.63">         aExitCode == NS_ERROR_SMTP_SEND_FAILED_TIMEOUT ||</span>
<a href="#l4.64"></a><span id="l4.64">         aExitCode == NS_ERROR_SMTP_PASSWORD_UNDEFINED ||</span>
<a href="#l4.65"></a><span id="l4.65">         aExitCode == NS_ERROR_SMTP_AUTH_FAILURE ||</span>
<a href="#l4.66"></a><span id="l4.66">         aExitCode == NS_ERROR_SMTP_AUTH_GSSAPI ||</span>
<a href="#l4.67"></a><span id="l4.67">         aExitCode == NS_ERROR_SMTP_AUTH_MECH_NOT_SUPPORTED ||</span>
<a href="#l4.68"></a><span id="l4.68">         aExitCode == NS_ERROR_SMTP_AUTH_NOT_SUPPORTED ||</span>
<a href="#l4.69"></a><span id="l4.69">         aExitCode == NS_ERROR_SMTP_AUTH_CHANGE_ENCRYPT_TO_PLAIN_NO_SSL ||</span>
<a href="#l4.70"></a><span id="l4.70">         aExitCode == NS_ERROR_SMTP_AUTH_CHANGE_ENCRYPT_TO_PLAIN_SSL ||</span>
<a href="#l4.71"></a><span id="l4.71">         aExitCode == NS_ERROR_SMTP_AUTH_CHANGE_PLAIN_TO_ENCRYPT ||</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-        aExitCode == NS_ERROR_STARTTLS_FAILED_EHLO_STARTTLS) {</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+        aExitCode == NS_ERROR_STARTTLS_FAILED_EHLO_STARTTLS)</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineplus">+    {</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineplus">+      // Print basic SMTP error with the server name encoded.</span>
<a href="#l4.76"></a><span id="l4.76">       FormatStringWithSMTPHostNameByName(exitString, eMsg);</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-    } else {</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-      mComposeBundle-&gt;GetStringFromName(exitString, eMsg);</span>
<a href="#l4.79"></a><span id="l4.79">     }</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+    else</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+    {</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+      nsCOMPtr&lt;nsINSSErrorsService&gt; nsserr = do_GetService(NS_NSS_ERRORS_SERVICE_CONTRACTID);</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+      if (nsserr &amp;&amp;  NS_SUCCEEDED(nsserr-&gt;GetErrorMessage(aExitCode, eMsg)))</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineplus">+      {</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineplus">+        // This is a server security issue as determined by the Mozilla platform.</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineplus">+        // To the Mozilla security message string, appended a string having</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineplus">+        // additional information with the server name encoded.</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+        nsString securityMsg;</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+        FormatStringWithSMTPHostNameByName(&quot;smtpSecurityIssue&quot;, securityMsg);</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+        eMsg.Append('\n');</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+        eMsg.Append(securityMsg);</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineplus">+      }</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineplus">+      else if (PL_strcmp(exitString, &quot;sendFailed&quot;))</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineplus">+      {</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineplus">+        // Not the default string. A mailnews error occurred that does not</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineplus">+        // require the server name to be encoded. Just print the descriptive</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineplus">+        // string.</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineplus">+        mComposeBundle-&gt;GetStringFromName(exitString, eMsg);</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineplus">+      }</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+      else</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+      {</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineplus">+        // Encode the error code in first string. Then append a supplemental</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineplus">+        // string that encodes the server name.</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineplus">+        nsString tmpStr;</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineplus">+        mComposeBundle-&gt;GetStringFromName(&quot;sendFailedUnexpected&quot;, tmpStr);</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+        nsTextFormatter::ssprintf(eMsg, tmpStr.get(), static_cast&lt;uint32_t&gt;(aExitCode));</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+        FormatStringWithSMTPHostNameByName(&quot;smtpSendFailedUnknownReason&quot;, tmpStr);</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+        eMsg.Append('\n');</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+        eMsg.Append(tmpStr);</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineplus">+      }</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineplus">+    }</span>
<a href="#l4.113"></a><span id="l4.113">     Fail(aExitCode, eMsg.get(), &amp;aExitCode);</span>
<a href="#l4.114"></a><span id="l4.114">     NotifyListenerOnStopSending(nullptr, aExitCode, nullptr, nullptr);</span>
<a href="#l4.115"></a><span id="l4.115">     return;</span>
<a href="#l4.116"></a><span id="l4.116">   }</span>
<a href="#l4.117"></a><span id="l4.117"> </span>
<a href="#l4.118"></a><span id="l4.118">   if (aCheckForMail)</span>
<a href="#l4.119"></a><span id="l4.119">   {</span>
<a href="#l4.120"></a><span id="l4.120">     if ((mCompFields-&gt;GetTo() &amp;&amp; *mCompFields-&gt;GetTo()) ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendReport.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendReport.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -277,17 +277,16 @@ NS_IMETHODIMP nsMsgSendReport::DisplayRe</span>
<a href="#l5.4"></a><span id="l5.4"> #ifdef __GNUC__</span>
<a href="#l5.5"></a><span id="l5.5"> // Temporary workaround until bug 783526 is fixed.</span>
<a href="#l5.6"></a><span id="l5.6"> #pragma GCC diagnostic push</span>
<a href="#l5.7"></a><span id="l5.7"> #pragma GCC diagnostic ignored &quot;-Wswitch&quot;</span>
<a href="#l5.8"></a><span id="l5.8"> #endif</span>
<a href="#l5.9"></a><span id="l5.9">     switch (currError)</span>
<a href="#l5.10"></a><span id="l5.10">     {</span>
<a href="#l5.11"></a><span id="l5.11">       case NS_BINDING_ABORTED:</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-      case NS_ERROR_SEND_FAILED:</span>
<a href="#l5.13"></a><span id="l5.13">       case NS_ERROR_SEND_FAILED_BUT_NNTP_OK:</span>
<a href="#l5.14"></a><span id="l5.14">       case NS_MSG_FAILED_COPY_OPERATION:</span>
<a href="#l5.15"></a><span id="l5.15">       case NS_MSG_UNABLE_TO_SEND_LATER:</span>
<a href="#l5.16"></a><span id="l5.16">       case NS_MSG_UNABLE_TO_SAVE_DRAFT:</span>
<a href="#l5.17"></a><span id="l5.17">       case NS_MSG_UNABLE_TO_SAVE_TEMPLATE:</span>
<a href="#l5.18"></a><span id="l5.18">         //Ignore, don't need to repeat ourself.</span>
<a href="#l5.19"></a><span id="l5.19">         break;</span>
<a href="#l5.20"></a><span id="l5.20">       default:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -23,16 +23,22 @@ errorSendingFromCommand=An error occurre</span>
<a href="#l6.4"></a><span id="l6.4"> errorSendingDataCommand=An Outgoing server (SMTP) error occurred while sending mail. The server responded:  %s.</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> ## LOCALIZATION NOTE (errorSendingMessage): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l6.7"></a><span id="l6.7"> errorSendingMessage=An error occurred while sending mail. The mail server responded:  %s. Please check the message and try again.</span>
<a href="#l6.8"></a><span id="l6.8"> postFailed=The message could not be posted because connecting to the news server failed. The server may be unavailable or is refusing connections. Please verify that your news server settings are correct and try again.</span>
<a href="#l6.9"></a><span id="l6.9"> errorQueuedDeliveryFailed=An error occurred while delivering unsent messages.</span>
<a href="#l6.10"></a><span id="l6.10"> sendFailed=Sending of the message failed.</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+## LOCALIZATION NOTE (sendFailedUnexpected): argument %X is a hex error code value</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+sendFailedUnexpected=Failed due to unexpected error %X. No description is available.</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+## LOCALIZATION NOTE (smtpSecurityIssue): argument %S is the Outgoing smtp server name</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+smtpSecurityIssue=The configuration related to %S must be corrected.</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+</span>
<a href="#l6.18"></a><span id="l6.18"> ## LOCALIZATION NOTE (smtpServerError): argument %s is the Outgoing server (SMTP) response</span>
<a href="#l6.19"></a><span id="l6.19"> smtpServerError=An error occurred while sending mail: Outgoing server (SMTP) error. The server responded:  %s.</span>
<a href="#l6.20"></a><span id="l6.20"> unableToSendLater=Sorry, we were unable to save your message for sending later.</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22"> ## LOCALIZATION NOTE (communicationsError): argument %d is the error code</span>
<a href="#l6.23"></a><span id="l6.23"> communicationsError=A communications error occurred: %d.  Please try again.</span>
<a href="#l6.24"></a><span id="l6.24"> dontShowAlert=THIS IS JUST A PLACEHOLDER.  YOU SHOULD NEVER SEE THIS STRING.</span>
<a href="#l6.25"></a><span id="l6.25"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

