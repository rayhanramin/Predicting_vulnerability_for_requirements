<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25290:61f67f491dd7c5c1e80be45aeadb3d5cbba37978</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 61f67f491dd7c5c1e80be45aeadb3d5cbba37978" />
<meta property="og:url" content="/comm-central/rev/61f67f491dd7c5c1e80be45aeadb3d5cbba37978" />
<meta property="og:description" content="Bug 1508942 - Remove more plugins code; disable plugins by content policy. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 61f67f491dd7c5c1e80be45aeadb3d5cbba37978 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/61f67f491dd7c5c1e80be45aeadb3d5cbba37978">shortlog</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/61f67f491dd7c5c1e80be45aeadb3d5cbba37978">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978">files</a> |
changeset |
<a href="/comm-central/raw-rev/61f67f491dd7c5c1e80be45aeadb3d5cbba37978">raw</a>  | <a href="/comm-central/archive/61f67f491dd7c5c1e80be45aeadb3d5cbba37978.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1508942">Bug 1508942</a> - Remove more plugins code; disable plugins by content policy. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 28 Nov 2018 10:29:36 +1300</td></tr>

<tr>
 <td>changeset 25290</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/61f67f491dd7c5c1e80be45aeadb3d5cbba37978">61f67f491dd7c5c1e80be45aeadb3d5cbba37978</a></td>
</tr>



<tr>
<td>parent 25289</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d01f1963d14968aeffa96a43c22715edc9fab90a">d01f1963d14968aeffa96a43c22715edc9fab90a</a>
</td>
</tr>

<tr>
<td>child 25291</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/48522dae2fd481e1e7e6b62d82f3e724c47637ee">48522dae2fd481e1e7e6b62d82f3e724c47637ee</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=61f67f491dd7c5c1e80be45aeadb3d5cbba37978">15175</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 28 Nov 2018 18:00:51 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@48522dae2fd4 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=48522dae2fd481e1e7e6b62d82f3e724c47637ee">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=48522dae2fd481e1e7e6b62d82f3e724c47637ee&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=48522dae2fd481e1e7e6b62d82f3e724c47637ee&newProject=comm-central&newRevision=2a56bbf3704832de7085764738e0d32c354208e7&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=48522dae2fd481e1e7e6b62d82f3e724c47637ee&newProject=comm-central&newRevision=2a56bbf3704832de7085764738e0d32c354208e7&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=48522dae2fd481e1e7e6b62d82f3e724c47637ee&newProject=comm-central&newRevision=2a56bbf3704832de7085764738e0d32c354208e7&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1508942">1508942</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1508942">Bug 1508942</a> - Remove more plugins code; disable plugins by content policy. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/app/profile/all-thunderbird.js">mail/app/profile/all-thunderbird.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/app/profile/all-thunderbird.js">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/app/profile/all-thunderbird.js">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/app/profile/all-thunderbird.js">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/app/profile/all-thunderbird.js">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/app/profile/all-thunderbird.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/base/content/extensionsOverlay.css">mail/base/content/extensionsOverlay.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/base/content/extensionsOverlay.css">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/base/content/extensionsOverlay.css">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/base/content/extensionsOverlay.css">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/base/content/extensionsOverlay.css">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/base/content/extensionsOverlay.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/about-support/content/aboutSupport.xhtml">mail/components/about-support/content/aboutSupport.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/about-support/content/aboutSupport.xhtml">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/about-support/content/aboutSupport.xhtml">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/about-support/content/aboutSupport.xhtml">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/about-support/content/aboutSupport.xhtml">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/about-support/content/aboutSupport.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/actionsshared.js">mail/components/preferences/actionsshared.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/actionsshared.js">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/actionsshared.js">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/actionsshared.js">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/actionsshared.js">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/actionsshared.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/applications.js">mail/components/preferences/applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/applications.js">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/applications.js">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/applications.js">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/applications.js">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/components/preferences/applications.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/messenger.properties">mail/locales/en-US/chrome/messenger/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/messenger.properties">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/messenger.properties">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/messenger.properties">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/messenger.properties">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/messenger.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">mail/locales/en-US/chrome/messenger/preferences/preferences.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/testsuite-targets.mk">mail/testsuite-targets.mk</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/testsuite-targets.mk">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/testsuite-targets.mk">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/testsuite-targets.mk">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/testsuite-targets.mk">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/testsuite-targets.mk">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/linux/mail/preferences/applications.css">mail/themes/linux/mail/preferences/applications.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/linux/mail/preferences/applications.css">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/linux/mail/preferences/applications.css">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/linux/mail/preferences/applications.css">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/linux/mail/preferences/applications.css">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/linux/mail/preferences/applications.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/osx/mail/preferences/applications.css">mail/themes/osx/mail/preferences/applications.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/osx/mail/preferences/applications.css">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/osx/mail/preferences/applications.css">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/osx/mail/preferences/applications.css">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/osx/mail/preferences/applications.css">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/osx/mail/preferences/applications.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/windows/mail/preferences/applications.css">mail/themes/windows/mail/preferences/applications.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/windows/mail/preferences/applications.css">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/windows/mail/preferences/applications.css">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/windows/mail/preferences/applications.css">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/windows/mail/preferences/applications.css">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mail/themes/windows/mail/preferences/applications.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mailnews/base/src/nsMsgContentPolicy.cpp">mailnews/base/src/nsMsgContentPolicy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mailnews/base/src/nsMsgContentPolicy.cpp">file</a> |
<a href="/comm-central/annotate/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mailnews/base/src/nsMsgContentPolicy.cpp">annotate</a> |
<a href="/comm-central/diff/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mailnews/base/src/nsMsgContentPolicy.cpp">diff</a> |
<a href="/comm-central/comparison/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mailnews/base/src/nsMsgContentPolicy.cpp">comparison</a> |
<a href="/comm-central/log/61f67f491dd7c5c1e80be45aeadb3d5cbba37978/mailnews/base/src/nsMsgContentPolicy.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/app/profile/all-thunderbird.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/app/profile/all-thunderbird.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -246,19 +246,16 @@ pref(&quot;browser.preferences.instantApply&quot;,</span>
<a href="#l1.4"></a><span id="l1.4"> pref(&quot;browser.preferences.instantApply&quot;, true);</span>
<a href="#l1.5"></a><span id="l1.5"> #endif</span>
<a href="#l1.6"></a><span id="l1.6"> #ifdef XP_MACOSX</span>
<a href="#l1.7"></a><span id="l1.7"> pref(&quot;browser.preferences.animateFadeIn&quot;, true);</span>
<a href="#l1.8"></a><span id="l1.8"> #else</span>
<a href="#l1.9"></a><span id="l1.9"> pref(&quot;browser.preferences.animateFadeIn&quot;, false);</span>
<a href="#l1.10"></a><span id="l1.10"> #endif</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-pref(&quot;browser.download.show_plugins_in_list&quot;, false);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-pref(&quot;browser.download.hide_plugins_without_extensions&quot;, true);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-</span>
<a href="#l1.15"></a><span id="l1.15"> pref(&quot;accessibility.typeaheadfind&quot;, false);</span>
<a href="#l1.16"></a><span id="l1.16"> pref(&quot;accessibility.typeaheadfind.timeout&quot;, 5000);</span>
<a href="#l1.17"></a><span id="l1.17"> pref(&quot;accessibility.typeaheadfind.linksonly&quot;, false);</span>
<a href="#l1.18"></a><span id="l1.18"> pref(&quot;accessibility.typeaheadfind.flashBar&quot;, 1);</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> pref(&quot;mail.close_message_window.on_delete&quot;, false);</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22"> // Number of lines of To/CC/BCC address headers to show before &quot;more&quot;</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineat">@@ -379,17 +376,17 @@ pref(&quot;network.protocol-handler.warn-exte</span>
<a href="#l1.24"></a><span id="l1.24"> pref(&quot;network.protocol-handler.warn-external.https&quot;, false);</span>
<a href="#l1.25"></a><span id="l1.25"> pref(&quot;network.protocol-handler.warn-external.ftp&quot;, false);</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27"> pref(&quot;network.hosts.smtp_server&quot;,           &quot;mail&quot;);</span>
<a href="#l1.28"></a><span id="l1.28"> pref(&quot;network.hosts.pop_server&quot;,            &quot;mail&quot;);</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30"> // Temporarily add 'preferences' and 'newserror' to the list of about: pages that do not have a CSP specified.</span>
<a href="#l1.31"></a><span id="l1.31"> // The list should be kept in sync with the one in m-c/modules/libpref/init/all.js. See bug 1495983.</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-pref(&quot;csp.about_uris_without_csp&quot;, &quot;preferences,newserror,blank,printpreview,srcdoc,about,addons,cache-entry,config,crashes,debugging,devtools,downloads,home,memory,networking,newtab,performance,plugins,policies,profiles,restartrequired,searchreset,serviceworkers,sessionrestore,support,sync-log,telemetry,url-classifier,webrtc,welcomeback&quot;);</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+pref(&quot;csp.about_uris_without_csp&quot;, &quot;preferences,newserror,blank,printpreview,srcdoc,about,addons,cache-entry,config,crashes,debugging,devtools,downloads,home,memory,networking,newtab,performance,policies,profiles,restartrequired,searchreset,serviceworkers,sessionrestore,support,sync-log,telemetry,url-classifier,webrtc,welcomeback&quot;);</span>
<a href="#l1.34"></a><span id="l1.34"> </span>
<a href="#l1.35"></a><span id="l1.35"> pref(&quot;security.warn_entering_secure&quot;, false);</span>
<a href="#l1.36"></a><span id="l1.36"> pref(&quot;security.warn_entering_weak&quot;, false);</span>
<a href="#l1.37"></a><span id="l1.37"> pref(&quot;security.warn_leaving_secure&quot;, false);</span>
<a href="#l1.38"></a><span id="l1.38"> pref(&quot;security.warn_viewing_mixed&quot;, false);</span>
<a href="#l1.39"></a><span id="l1.39"> </span>
<a href="#l1.40"></a><span id="l1.40"> pref(&quot;general.config.obscure_value&quot;, 0); // for MCD .cfg files</span>
<a href="#l1.41"></a><span id="l1.41"> </span>
<a href="#l1.42"></a><span id="l1.42" class="difflineat">@@ -707,76 +704,16 @@ pref(&quot;places.frecency.permRedirectVisitB</span>
<a href="#l1.43"></a><span id="l1.43"> pref(&quot;places.frecency.tempRedirectVisitBonus&quot;, 0);</span>
<a href="#l1.44"></a><span id="l1.44"> pref(&quot;places.frecency.reloadVisitBonus&quot;, 0);</span>
<a href="#l1.45"></a><span id="l1.45"> pref(&quot;places.frecency.defaultVisitBonus&quot;, 0);</span>
<a href="#l1.46"></a><span id="l1.46"> </span>
<a href="#l1.47"></a><span id="l1.47"> // bonus (in percent) for place types for frecency calculations</span>
<a href="#l1.48"></a><span id="l1.48"> pref(&quot;places.frecency.unvisitedBookmarkBonus&quot;, 140);</span>
<a href="#l1.49"></a><span id="l1.49"> pref(&quot;places.frecency.unvisitedTypedBonus&quot;, 200);</span>
<a href="#l1.50"></a><span id="l1.50"> </span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-// The default for this pref reflects whether the build is capable of IPC.</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-// (Turning it on in a no-IPC build will have no effect.)</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-#ifdef XP_MACOSX</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-// i386 ipc preferences</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-pref(&quot;dom.ipc.plugins.enabled.i386&quot;, false);</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-pref(&quot;dom.ipc.plugins.enabled.i386.flash player.plugin&quot;, true);</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineminus">-pref(&quot;dom.ipc.plugins.enabled.i386.javaplugin2_npapi.plugin&quot;, true);</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-pref(&quot;dom.ipc.plugins.enabled.i386.javaappletplugin.plugin&quot;, true);</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-// x86_64 ipc preferences</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-pref(&quot;dom.ipc.plugins.enabled.x86_64&quot;, true);</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineminus">-#else</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-pref(&quot;dom.ipc.plugins.enabled&quot;, true);</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-#endif</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineminus">-// This pref governs whether we attempt to work around problems caused by</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-// plugins using OS calls to manipulate the cursor while running out-of-</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-// process.  These workarounds all involve intercepting (hooking) certain</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-// OS calls in the plugin process, then arranging to make certain OS calls</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-// in the browser process.  Eventually plugins will be required to use the</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-// NPAPI to manipulate the cursor, and these workarounds will be removed.</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-// See bug 621117.</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-#ifdef XP_MACOSX</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-pref(&quot;dom.ipc.plugins.nativeCursorSupport&quot;, true);</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineminus">-#endif</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineminus">-</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineminus">-// Refer to bug 1509297 for details. For now, we disable the new UA widget to make tests pass.</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-pref(&quot;dom.ua_widget.enabled&quot;, false);</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-// plugin finder service url</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineminus">-pref(&quot;pfs.datasource.url&quot;, &quot;https://pfs.mozilla.org/plugins/PluginFinderService.</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineminus">-php?mimetype=%PLUGIN_MIMETYPE%&amp;appID=%APP_ID%&amp;appVersion=%APP_VERSION%&amp;clientOS=</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-%CLIENT_OS%&amp;chromeLocale=%CHROME_LOCALE%&amp;appRelease=%APP_RELEASE%&quot;);</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineminus">-</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineminus">-// By default we show an infobar message when pages require plugins that are</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineminus">-// outdated.</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineminus">-pref(&quot;plugins.hide_infobar_for_outdated_plugin&quot;, false);</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineminus">-</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineminus">-#ifdef XP_MACOSX</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineminus">-pref(&quot;plugins.use_layers&quot;, false);</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineminus">-pref(&quot;plugins.hide_infobar_for_carbon_failure_plugin&quot;, false);</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineminus">-#endif</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineminus">-</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineminus">-pref(&quot;plugins.update.url&quot;, &quot;https://www.mozilla.org/%LOCALE%/plugincheck/&quot;);</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineminus">-pref(&quot;plugins.update.notifyUser&quot;, false);</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineminus">-pref(&quot;plugins.crash.supportUrl&quot;, &quot;https://live.thunderbird.net/%APP%/plugin-crashed?locale=%LOCALE%&amp;version=%VERSION%&amp;os=%OS%&amp;buildid=%APPBUILDID%&quot;);</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineminus">-</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineminus">-// Click-to-play has not been ported for TB yet, see bug 814168.</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineminus">-// The default plugin state should be changed to &quot;ask to activate&quot; when this</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineminus">-// has been done.</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineminus">-pref(&quot;plugins.click_to_play&quot;, false);</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineminus">-// Disable by default.</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineminus">-pref(&quot;plugin.default.state&quot;, 0);</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineminus">-</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineminus">-// Plugins bundled in XPIs are enabled by default.</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineminus">-pref(&quot;plugin.defaultXpi.state&quot;, 2);</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineminus">-</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineminus">-// Flash is enabled and Java is disabled by default.</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineminus">-pref(&quot;plugin.state.flash&quot;, 2);</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineminus">-pref(&quot;plugin.state.java&quot;, 0);</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineminus">-</span>
<a href="#l1.111"></a><span id="l1.111"> // Windows taskbar support</span>
<a href="#l1.112"></a><span id="l1.112"> #ifdef XP_WIN</span>
<a href="#l1.113"></a><span id="l1.113"> pref(&quot;mail.taskbar.lists.enabled&quot;, true);</span>
<a href="#l1.114"></a><span id="l1.114"> pref(&quot;mail.taskbar.lists.tasks.enabled&quot;, true);</span>
<a href="#l1.115"></a><span id="l1.115"> #endif</span>
<a href="#l1.116"></a><span id="l1.116"> </span>
<a href="#l1.117"></a><span id="l1.117"> // Disable hardware accelerated layers</span>
<a href="#l1.118"></a><span id="l1.118"> pref(&quot;layers.acceleration.disabled&quot;, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/extensionsOverlay.css</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/extensionsOverlay.css</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -23,11 +23,15 @@</span>
<a href="#l2.4"></a><span id="l2.4">   width: 664px;</span>
<a href="#l2.5"></a><span id="l2.5">   padding: 4px;</span>
<a href="#l2.6"></a><span id="l2.6"> }</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> #tb-legacy-extensions-notice &gt; .alert &gt; description {</span>
<a href="#l2.9"></a><span id="l2.9">   margin: 0;</span>
<a href="#l2.10"></a><span id="l2.10"> }</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+#category-plugin {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  display: none;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+}</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+</span>
<a href="#l2.16"></a><span id="l2.16"> .addon[status=&quot;installed&quot;] {</span>
<a href="#l2.17"></a><span id="l2.17">   -moz-binding: url(&quot;chrome://messenger/content/extensions.xml#thunderbird-addon-generic&quot;);</span>
<a href="#l2.18"></a><span id="l2.18"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/about-support/content/aboutSupport.xhtml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/about-support/content/aboutSupport.xhtml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -193,26 +193,16 @@</span>
<a href="#l3.4"></a><span id="l3.4">                &lt;/button&gt;</span>
<a href="#l3.5"></a><span id="l3.5">                &lt;span id=&quot;profile-dir-box&quot;&gt;</span>
<a href="#l3.6"></a><span id="l3.6">                &lt;/span&gt;</span>
<a href="#l3.7"></a><span id="l3.7">             &lt;/td&gt;</span>
<a href="#l3.8"></a><span id="l3.8">           &lt;/tr&gt;</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">           &lt;tr class=&quot;no-copy&quot;&gt;</span>
<a href="#l3.11"></a><span id="l3.11">             &lt;th class=&quot;column&quot;&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-              &amp;aboutSupport.appBasicsEnabledPlugins;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-            &lt;/th&gt;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-            &lt;td&gt;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-              &lt;a href=&quot;about:plugins&quot; target=&quot;_blank&quot;&gt;about:plugins&lt;/a&gt;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-            &lt;/td&gt;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-          &lt;/tr&gt;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-          &lt;tr class=&quot;no-copy&quot;&gt;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-            &lt;th class=&quot;column&quot;&gt;</span>
<a href="#l3.22"></a><span id="l3.22">               &amp;aboutSupport.appBasicsBuildConfig;</span>
<a href="#l3.23"></a><span id="l3.23">             &lt;/th&gt;</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25">             &lt;td&gt;</span>
<a href="#l3.26"></a><span id="l3.26">               &lt;a href=&quot;about:buildconfig&quot; target=&quot;_blank&quot;&gt;about:buildconfig&lt;/a&gt;</span>
<a href="#l3.27"></a><span id="l3.27">             &lt;/td&gt;</span>
<a href="#l3.28"></a><span id="l3.28">           &lt;/tr&gt;</span>
<a href="#l3.29"></a><span id="l3.29"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/preferences/actionsshared.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/preferences/actionsshared.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -2,29 +2,25 @@</span>
<a href="#l4.4"></a><span id="l4.4">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.6"></a><span id="l4.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> var FILEACTION_SAVE_TO_DISK     = 1;</span>
<a href="#l4.9"></a><span id="l4.9"> var FILEACTION_OPEN_INTERNALLY  = 2;</span>
<a href="#l4.10"></a><span id="l4.10"> var FILEACTION_OPEN_DEFAULT     = 3;</span>
<a href="#l4.11"></a><span id="l4.11"> var FILEACTION_OPEN_CUSTOM      = 4;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-var FILEACTION_OPEN_PLUGIN      = 5;</span>
<a href="#l4.13"></a><span id="l4.13"> function FileAction() {</span>
<a href="#l4.14"></a><span id="l4.14"> }</span>
<a href="#l4.15"></a><span id="l4.15"> FileAction.prototype = {</span>
<a href="#l4.16"></a><span id="l4.16">   type: &quot;&quot;,</span>
<a href="#l4.17"></a><span id="l4.17">   extension: &quot;&quot;,</span>
<a href="#l4.18"></a><span id="l4.18">   hasExtension: true,</span>
<a href="#l4.19"></a><span id="l4.19">   editable: true,</span>
<a href="#l4.20"></a><span id="l4.20">   smallIcon: &quot;&quot;,</span>
<a href="#l4.21"></a><span id="l4.21">   bigIcon: &quot;&quot;,</span>
<a href="#l4.22"></a><span id="l4.22">   typeName: &quot;&quot;,</span>
<a href="#l4.23"></a><span id="l4.23">   action: &quot;&quot;,</span>
<a href="#l4.24"></a><span id="l4.24">   mimeInfo: null,</span>
<a href="#l4.25"></a><span id="l4.25">   customHandler: &quot;&quot;,</span>
<a href="#l4.26"></a><span id="l4.26">   handleMode: false,</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-  pluginAvailable: false,</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-  pluginEnabled: false,</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-  handledOnlyByPlugin: false,</span>
<a href="#l4.30"></a><span id="l4.30"> };</span>
<a href="#l4.31"></a><span id="l4.31"> </span>
<a href="#l4.32"></a><span id="l4.32"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/preferences/applications.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/preferences/applications.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -6,30 +6,17 @@</span>
<a href="#l5.4"></a><span id="l5.4"> // applications.inc.xul</span>
<a href="#l5.5"></a><span id="l5.5"> /* globals ICON_URL_APP */</span>
<a href="#l5.6"></a><span id="l5.6"> // mail/base/content/contentAreaClick.js</span>
<a href="#l5.7"></a><span id="l5.7"> /* globals openLinkExternally */</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> // ------------------------------</span>
<a href="#l5.10"></a><span id="l5.10"> // Constants &amp; Enumeration Values</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-var PREF_DISABLED_PLUGIN_TYPES = &quot;plugin.disable_full_page_plugin_for_types&quot;;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-// Preferences that affect which entries to show in the list.</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-var PREF_SHOW_PLUGINS_IN_LIST = &quot;browser.download.show_plugins_in_list&quot;;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-var PREF_HIDE_PLUGINS_WITHOUT_EXTENSIONS =</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-  &quot;browser.download.hide_plugins_without_extensions&quot;;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-// The nsHandlerInfoAction enumeration values in nsIHandlerInfo identify</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-// the actions the application can take with content of various types.</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-// But since nsIHandlerInfo doesn't support plugins, there's no value</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-// identifying the &quot;use plugin&quot; action, so we use this constant instead.</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-var kActionUsePlugin = 5;</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-// For CSS. Can be one of &quot;ask&quot;, &quot;save&quot;, &quot;plugin&quot; or &quot;feed&quot;. If absent, the icon URL</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+// For CSS. Can be one of &quot;ask&quot;, &quot;save&quot;, or &quot;feed&quot;. If absent, the icon URL</span>
<a href="#l5.27"></a><span id="l5.27"> // was set by us to a custom handler icon and CSS should not try to override it.</span>
<a href="#l5.28"></a><span id="l5.28"> var APP_ICON_ATTR_NAME = &quot;appHandlerIcon&quot;;</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30"> var gNodeToObjectMap = new WeakMap();</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32"> // CloudFile account tools used by gCloudFileTab.</span>
<a href="#l5.33"></a><span id="l5.33"> ChromeUtils.import(&quot;resource:///modules/cloudFileAccounts.js&quot;);</span>
<a href="#l5.34"></a><span id="l5.34"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineat">@@ -119,47 +106,26 @@ class HandlerListItem {</span>
<a href="#l5.36"></a><span id="l5.36"> </span>
<a href="#l5.37"></a><span id="l5.37"> /**</span>
<a href="#l5.38"></a><span id="l5.38">  * This object wraps nsIHandlerInfo with some additional functionality</span>
<a href="#l5.39"></a><span id="l5.39">  * the Applications prefpane needs to display and allow modification of</span>
<a href="#l5.40"></a><span id="l5.40">  * the list of handled types.</span>
<a href="#l5.41"></a><span id="l5.41">  *</span>
<a href="#l5.42"></a><span id="l5.42">  * We create an instance of this wrapper for each entry we might display</span>
<a href="#l5.43"></a><span id="l5.43">  * in the prefpane, and we compose the instances from various sources,</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">- * including navigator.plugins and the handler service.</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+ * including the handler service.</span>
<a href="#l5.46"></a><span id="l5.46">  *</span>
<a href="#l5.47"></a><span id="l5.47">  * We don't implement all the original nsIHandlerInfo functionality,</span>
<a href="#l5.48"></a><span id="l5.48">  * just the stuff that the prefpane needs.</span>
<a href="#l5.49"></a><span id="l5.49">  */</span>
<a href="#l5.50"></a><span id="l5.50"> class HandlerInfoWrapper {</span>
<a href="#l5.51"></a><span id="l5.51">   constructor(type, handlerInfo) {</span>
<a href="#l5.52"></a><span id="l5.52">     this.type = type;</span>
<a href="#l5.53"></a><span id="l5.53">     this.wrappedHandlerInfo = handlerInfo;</span>
<a href="#l5.54"></a><span id="l5.54">     this.disambiguateDescription = false;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-    // A plugin that can handle this type, if any.</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-    //</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-    // Note: just because we have one doesn't mean it *will* handle the type.</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-    // That depends on whether or not the type is in the list of types for which</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-    // plugin handling is disabled.</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-    this.pluginName = &quot;&quot;;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-    // Whether or not this type is only handled by a plugin or is also handled</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-    // by some user-configured action as specified in the handler info object.</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-    //</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-    // Note: we can't just check if there's a handler info object for this type,</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-    // because OS and user configuration is mixed up in the handler info object,</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-    // so we always need to retrieve it for the OS info and can't tell whether</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-    // it represents only OS-default information or user-configured information.</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-    //</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-    // FIXME: once handler info records are broken up into OS-provided records</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-    // and user-configured records, stop using this boolean flag and simply</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-    // check for the presence of a user-configured record to determine whether</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-    // or not this type is only handled by a plugin.  Filed as bug 395142.</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-    this.handledOnlyByPlugin = false;</span>
<a href="#l5.76"></a><span id="l5.76">   }</span>
<a href="#l5.77"></a><span id="l5.77"> </span>
<a href="#l5.78"></a><span id="l5.78">   get description() {</span>
<a href="#l5.79"></a><span id="l5.79">     if (this.wrappedHandlerInfo.description)</span>
<a href="#l5.80"></a><span id="l5.80">       return this.wrappedHandlerInfo.description;</span>
<a href="#l5.81"></a><span id="l5.81"> </span>
<a href="#l5.82"></a><span id="l5.82">     if (this.primaryExtension) {</span>
<a href="#l5.83"></a><span id="l5.83">       var extension = this.primaryExtension.toUpperCase();</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineat">@@ -228,20 +194,16 @@ class HandlerInfoWrapper {</span>
<a href="#l5.85"></a><span id="l5.85">       // Is it because the app can't actually do that?  But if that's true,</span>
<a href="#l5.86"></a><span id="l5.86">       // then why would a preferredAction ever get set to this value</span>
<a href="#l5.87"></a><span id="l5.87">       // in the first place?</span>
<a href="#l5.88"></a><span id="l5.88"> </span>
<a href="#l5.89"></a><span id="l5.89">       case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l5.90"></a><span id="l5.90">         return gApplicationsPane._prefsBundle.getFormattedString(&quot;useDefault&quot;,</span>
<a href="#l5.91"></a><span id="l5.91">           [this.defaultDescription]);</span>
<a href="#l5.92"></a><span id="l5.92"> </span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-      case kActionUsePlugin:</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-        return gApplicationsPane._prefsBundle.getFormattedString(&quot;usePluginIn&quot;,</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-          [this.pluginName,</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-          gApplicationsPane._brandShortName]);</span>
<a href="#l5.97"></a><span id="l5.97">       default:</span>
<a href="#l5.98"></a><span id="l5.98">         throw new Error(`Unexpected preferredAction: ${this.preferredAction}`);</span>
<a href="#l5.99"></a><span id="l5.99">     }</span>
<a href="#l5.100"></a><span id="l5.100">   }</span>
<a href="#l5.101"></a><span id="l5.101"> </span>
<a href="#l5.102"></a><span id="l5.102">   get actionIconClass() {</span>
<a href="#l5.103"></a><span id="l5.103">     if (this.alwaysAskBeforeHandling) {</span>
<a href="#l5.104"></a><span id="l5.104">       return &quot;ask&quot;;</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineat">@@ -250,19 +212,16 @@ class HandlerInfoWrapper {</span>
<a href="#l5.106"></a><span id="l5.106">     switch (this.preferredAction) {</span>
<a href="#l5.107"></a><span id="l5.107">       case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l5.108"></a><span id="l5.108">         return &quot;save&quot;;</span>
<a href="#l5.109"></a><span id="l5.109"> </span>
<a href="#l5.110"></a><span id="l5.110">       case Ci.nsIHandlerInfo.handleInternally:</span>
<a href="#l5.111"></a><span id="l5.111">         if (this instanceof InternalHandlerInfoWrapper) {</span>
<a href="#l5.112"></a><span id="l5.112">           return &quot;ask&quot;;</span>
<a href="#l5.113"></a><span id="l5.113">         }</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineminus">-</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineminus">-      case kActionUsePlugin:</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineminus">-        return &quot;plugin&quot;;</span>
<a href="#l5.117"></a><span id="l5.117">     }</span>
<a href="#l5.118"></a><span id="l5.118"> </span>
<a href="#l5.119"></a><span id="l5.119">     return &quot;&quot;;</span>
<a href="#l5.120"></a><span id="l5.120">   }</span>
<a href="#l5.121"></a><span id="l5.121"> </span>
<a href="#l5.122"></a><span id="l5.122">   get actionIcon() {</span>
<a href="#l5.123"></a><span id="l5.123">     switch (this.preferredAction) {</span>
<a href="#l5.124"></a><span id="l5.124">       case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineat">@@ -351,20 +310,16 @@ class HandlerInfoWrapper {</span>
<a href="#l5.126"></a><span id="l5.126">   }</span>
<a href="#l5.127"></a><span id="l5.127"> </span>
<a href="#l5.128"></a><span id="l5.128">   get defaultDescription() {</span>
<a href="#l5.129"></a><span id="l5.129">     return this.wrappedHandlerInfo.defaultDescription;</span>
<a href="#l5.130"></a><span id="l5.130">   }</span>
<a href="#l5.131"></a><span id="l5.131"> </span>
<a href="#l5.132"></a><span id="l5.132">   // What to do with content of this type.</span>
<a href="#l5.133"></a><span id="l5.133">   get preferredAction() {</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-    // If we have an enabled plugin, then the action is to use that plugin.</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineminus">-    if (this.plugin &amp;&amp; !this.isDisabledPluginType)</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-      return kActionUsePlugin;</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-</span>
<a href="#l5.138"></a><span id="l5.138">     // If the action is to use a helper app, but we don't have a preferred</span>
<a href="#l5.139"></a><span id="l5.139">     // handler app, then switch to using the system default, if any; otherwise</span>
<a href="#l5.140"></a><span id="l5.140">     // fall back to saving to disk, which is the default action in nsMIMEInfo.</span>
<a href="#l5.141"></a><span id="l5.141">     // Note: &quot;save to disk&quot; is an invalid value for protocol info objects,</span>
<a href="#l5.142"></a><span id="l5.142">     // but the alwaysAskBeforeHandling getter will detect that situation</span>
<a href="#l5.143"></a><span id="l5.143">     // and always return true in that case to override this invalid value.</span>
<a href="#l5.144"></a><span id="l5.144">     if (this.wrappedHandlerInfo.preferredAction ==</span>
<a href="#l5.145"></a><span id="l5.145">           Ci.nsIHandlerInfo.useHelperApp &amp;&amp;</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineat">@@ -373,34 +328,20 @@ class HandlerInfoWrapper {</span>
<a href="#l5.147"></a><span id="l5.147">         return Ci.nsIHandlerInfo.useSystemDefault;</span>
<a href="#l5.148"></a><span id="l5.148">       return Ci.nsIHandlerInfo.saveToDisk;</span>
<a href="#l5.149"></a><span id="l5.149">     }</span>
<a href="#l5.150"></a><span id="l5.150"> </span>
<a href="#l5.151"></a><span id="l5.151">     return this.wrappedHandlerInfo.preferredAction;</span>
<a href="#l5.152"></a><span id="l5.152">   }</span>
<a href="#l5.153"></a><span id="l5.153"> </span>
<a href="#l5.154"></a><span id="l5.154">   set preferredAction(aNewValue) {</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineminus">-    // We don't modify the preferred action if the new action is to use a plugin</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineminus">-    // because handler info objects don't understand our custom &quot;use plugin&quot;</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineminus">-    // value.  Also, leaving it untouched means that we can automatically revert</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineminus">-    // to the old setting if the user ever removes the plugin.</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineminus">-</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineminus">-    if (aNewValue != kActionUsePlugin)</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineminus">-      this.wrappedHandlerInfo.preferredAction = aNewValue;</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineplus">+    this.wrappedHandlerInfo.preferredAction = aNewValue;</span>
<a href="#l5.163"></a><span id="l5.163">   }</span>
<a href="#l5.164"></a><span id="l5.164"> </span>
<a href="#l5.165"></a><span id="l5.165">   get alwaysAskBeforeHandling() {</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineminus">-    // If this type is handled only by a plugin, we can't trust the value</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineminus">-    // in the handler info object, since it'll be a default based on the absence</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineminus">-    // of any user configuration, and the default in that case is to always ask,</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineminus">-    // even though we never ask for content handled by a plugin, so special case</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineminus">-    // plugin-handled types by returning false here.</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineminus">-    if (this.plugin &amp;&amp; this.handledOnlyByPlugin)</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineminus">-      return false;</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineminus">-</span>
<a href="#l5.174"></a><span id="l5.174">     // If this is a protocol type and the preferred action is &quot;save to disk&quot;,</span>
<a href="#l5.175"></a><span id="l5.175">     // which is invalid for such types, then return true here to override that</span>
<a href="#l5.176"></a><span id="l5.176">     // action.  This could happen when the preferred action is to use a helper</span>
<a href="#l5.177"></a><span id="l5.177">     // app, but the preferredApplicationHandler is invalid, and there isn't</span>
<a href="#l5.178"></a><span id="l5.178">     // a default handler, so the preferredAction getter returns save to disk</span>
<a href="#l5.179"></a><span id="l5.179">     // instead.</span>
<a href="#l5.180"></a><span id="l5.180">     if (!(this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo) &amp;&amp;</span>
<a href="#l5.181"></a><span id="l5.181">         this.preferredAction == Ci.nsIHandlerInfo.saveToDisk)</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineat">@@ -409,78 +350,26 @@ class HandlerInfoWrapper {</span>
<a href="#l5.183"></a><span id="l5.183">     return this.wrappedHandlerInfo.alwaysAskBeforeHandling;</span>
<a href="#l5.184"></a><span id="l5.184">   }</span>
<a href="#l5.185"></a><span id="l5.185"> </span>
<a href="#l5.186"></a><span id="l5.186">   set alwaysAskBeforeHandling(aNewValue) {</span>
<a href="#l5.187"></a><span id="l5.187">     this.wrappedHandlerInfo.alwaysAskBeforeHandling = aNewValue;</span>
<a href="#l5.188"></a><span id="l5.188">   }</span>
<a href="#l5.189"></a><span id="l5.189"> </span>
<a href="#l5.190"></a><span id="l5.190">   // The primary file extension associated with this type, if any.</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineminus">-  //</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineminus">-  // XXX Plugin objects contain an array of MimeType objects with &quot;suffixes&quot;</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineminus">-  // properties; if this object has an associated plugin, shouldn't we check</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineminus">-  // those properties for an extension?</span>
<a href="#l5.195"></a><span id="l5.195">   get primaryExtension() {</span>
<a href="#l5.196"></a><span id="l5.196">     try {</span>
<a href="#l5.197"></a><span id="l5.197">       if (this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo &amp;&amp;</span>
<a href="#l5.198"></a><span id="l5.198">           this.wrappedHandlerInfo.primaryExtension)</span>
<a href="#l5.199"></a><span id="l5.199">         return this.wrappedHandlerInfo.primaryExtension;</span>
<a href="#l5.200"></a><span id="l5.200">     } catch (ex) {}</span>
<a href="#l5.201"></a><span id="l5.201"> </span>
<a href="#l5.202"></a><span id="l5.202">     return null;</span>
<a href="#l5.203"></a><span id="l5.203">   }</span>
<a href="#l5.204"></a><span id="l5.204"> </span>
<a href="#l5.205"></a><span id="l5.205" class="difflineminus">-  get isDisabledPluginType() {</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineminus">-    return this._getDisabledPluginTypes().includes(this.type);</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineminus">-  }</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineminus">-</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineminus">-  _getDisabledPluginTypes() {</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineminus">-    var types = &quot;&quot;;</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineminus">-</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineminus">-    if (Services.prefs.prefHasUserValue(PREF_DISABLED_PLUGIN_TYPES))</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineminus">-      types = Services.prefs.getCharPref(PREF_DISABLED_PLUGIN_TYPES);</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineminus">-</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineminus">-    // Only split if the string isn't empty so we don't end up with an array</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineminus">-    // containing a single empty string.</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineminus">-    if (types != &quot;&quot;)</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineminus">-      return types.split(&quot;,&quot;);</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineminus">-</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineminus">-    return [];</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineminus">-  }</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineminus">-</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineminus">-  disablePluginType() {</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineminus">-    var disabledPluginTypes = this._getDisabledPluginTypes();</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineminus">-</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineminus">-    if (!disabledPluginTypes.includes(this.type))</span>
<a href="#l5.227"></a><span id="l5.227" class="difflineminus">-      disabledPluginTypes.push(this.type);</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineminus">-</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineminus">-    Services.prefs.setCharPref(PREF_DISABLED_PLUGIN_TYPES,</span>
<a href="#l5.230"></a><span id="l5.230" class="difflineminus">-                               disabledPluginTypes.join(&quot;,&quot;));</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineminus">-</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineminus">-    // Update the category manager so existing browser windows update.</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineminus">-    Services.catMan.deleteCategoryEntry(&quot;Gecko-Content-Viewers&quot;, this.type, false);</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineminus">-  }</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineminus">-</span>
<a href="#l5.236"></a><span id="l5.236" class="difflineminus">-  enablePluginType() {</span>
<a href="#l5.237"></a><span id="l5.237" class="difflineminus">-    var disabledPluginTypes = this._getDisabledPluginTypes();</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineminus">-</span>
<a href="#l5.239"></a><span id="l5.239" class="difflineminus">-    var type = this.type;</span>
<a href="#l5.240"></a><span id="l5.240" class="difflineminus">-    disabledPluginTypes = disabledPluginTypes.filter(v =&gt; v != type);</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineminus">-</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineminus">-    Services.prefs.setCharPref(PREF_DISABLED_PLUGIN_TYPES,</span>
<a href="#l5.243"></a><span id="l5.243" class="difflineminus">-                               disabledPluginTypes.join(&quot;,&quot;));</span>
<a href="#l5.244"></a><span id="l5.244" class="difflineminus">-</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineminus">-    // Update the category manager so existing browser windows update.</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineminus">-    Services.catMan.addCategoryEntry(</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineminus">-      &quot;Gecko-Content-Viewers&quot;, this.type,</span>
<a href="#l5.248"></a><span id="l5.248" class="difflineminus">-      &quot;@mozilla.org/content/plugin/document-loader-factory;1&quot;,</span>
<a href="#l5.249"></a><span id="l5.249" class="difflineminus">-      false, true</span>
<a href="#l5.250"></a><span id="l5.250" class="difflineminus">-    );</span>
<a href="#l5.251"></a><span id="l5.251" class="difflineminus">-  }</span>
<a href="#l5.252"></a><span id="l5.252" class="difflineminus">-</span>
<a href="#l5.253"></a><span id="l5.253">   // -------</span>
<a href="#l5.254"></a><span id="l5.254">   // Storage</span>
<a href="#l5.255"></a><span id="l5.255"> </span>
<a href="#l5.256"></a><span id="l5.256">   store() {</span>
<a href="#l5.257"></a><span id="l5.257">     gHandlerService.store(this.wrappedHandlerInfo);</span>
<a href="#l5.258"></a><span id="l5.258">   }</span>
<a href="#l5.259"></a><span id="l5.259"> </span>
<a href="#l5.260"></a><span id="l5.260">   remove() {</span>
<a href="#l5.261"></a><span id="l5.261" class="difflineat">@@ -905,24 +794,16 @@ var gApplicationsPane = {</span>
<a href="#l5.262"></a><span id="l5.262">   init() {</span>
<a href="#l5.263"></a><span id="l5.263">     // Initialize shortcuts to some commonly accessed elements &amp; values.</span>
<a href="#l5.264"></a><span id="l5.264">     this._brandShortName =</span>
<a href="#l5.265"></a><span id="l5.265">       document.getElementById(&quot;bundleBrand&quot;).getString(&quot;brandShortName&quot;);</span>
<a href="#l5.266"></a><span id="l5.266">     this._prefsBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l5.267"></a><span id="l5.267">     this._list = document.getElementById(&quot;handlersView&quot;);</span>
<a href="#l5.268"></a><span id="l5.268">     this._filter = document.getElementById(&quot;filter&quot;);</span>
<a href="#l5.269"></a><span id="l5.269"> </span>
<a href="#l5.270"></a><span id="l5.270" class="difflineminus">-    // Observe preferences that influence what we display so we can rebuild</span>
<a href="#l5.271"></a><span id="l5.271" class="difflineminus">-    // the view when they change.</span>
<a href="#l5.272"></a><span id="l5.272" class="difflineminus">-    Services.prefs.addObserver(PREF_SHOW_PLUGINS_IN_LIST, this);</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineminus">-    Services.prefs.addObserver(PREF_HIDE_PLUGINS_WITHOUT_EXTENSIONS, this);</span>
<a href="#l5.274"></a><span id="l5.274" class="difflineminus">-</span>
<a href="#l5.275"></a><span id="l5.275" class="difflineminus">-    // Listen for window unload so we can remove our preference observers.</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineminus">-    window.addEventListener(&quot;unload&quot;, this, {capture: false, once: true});</span>
<a href="#l5.277"></a><span id="l5.277" class="difflineminus">-</span>
<a href="#l5.278"></a><span id="l5.278">     // Figure out how we should be sorting the list.  We persist sort settings</span>
<a href="#l5.279"></a><span id="l5.279">     // across sessions, so we can't assume the default sort column/direction.</span>
<a href="#l5.280"></a><span id="l5.280">     // XXX should we be using the XUL sort service instead?</span>
<a href="#l5.281"></a><span id="l5.281">     this._sortColumn = document.getElementById(&quot;typeColumn&quot;);</span>
<a href="#l5.282"></a><span id="l5.282">     if (document.getElementById(&quot;actionColumn&quot;).hasAttribute(&quot;sortDirection&quot;)) {</span>
<a href="#l5.283"></a><span id="l5.283">       this._sortColumn = document.getElementById(&quot;actionColumn&quot;);</span>
<a href="#l5.284"></a><span id="l5.284">       // The typeColumn element always has a sortDirection attribute,</span>
<a href="#l5.285"></a><span id="l5.285">       // either because it was persisted or because the default value</span>
<a href="#l5.286"></a><span id="l5.286" class="difflineat">@@ -944,155 +825,54 @@ var gApplicationsPane = {</span>
<a href="#l5.287"></a><span id="l5.287">       self.rebuildView();</span>
<a href="#l5.288"></a><span id="l5.288"> </span>
<a href="#l5.289"></a><span id="l5.289">       // Notify observers that the UI is now ready</span>
<a href="#l5.290"></a><span id="l5.290">       Services.obs.notifyObservers(window, &quot;app-handler-pane-loaded&quot;);</span>
<a href="#l5.291"></a><span id="l5.291">     };</span>
<a href="#l5.292"></a><span id="l5.292">     setTimeout(_delayedPaneLoad, 0, this);</span>
<a href="#l5.293"></a><span id="l5.293">   },</span>
<a href="#l5.294"></a><span id="l5.294"> </span>
<a href="#l5.295"></a><span id="l5.295" class="difflineminus">-  destroy() {</span>
<a href="#l5.296"></a><span id="l5.296" class="difflineminus">-    Services.prefs.removeObserver(PREF_SHOW_PLUGINS_IN_LIST, this);</span>
<a href="#l5.297"></a><span id="l5.297" class="difflineminus">-    Services.prefs.removeObserver(PREF_HIDE_PLUGINS_WITHOUT_EXTENSIONS, this);</span>
<a href="#l5.298"></a><span id="l5.298" class="difflineminus">-  },</span>
<a href="#l5.299"></a><span id="l5.299" class="difflineminus">-</span>
<a href="#l5.300"></a><span id="l5.300" class="difflineminus">-  // -----------</span>
<a href="#l5.301"></a><span id="l5.301" class="difflineminus">-  // nsISupports</span>
<a href="#l5.302"></a><span id="l5.302" class="difflineminus">-</span>
<a href="#l5.303"></a><span id="l5.303" class="difflineminus">-  QueryInterface: ChromeUtils.generateQI([&quot;nsIObserver&quot;]),</span>
<a href="#l5.304"></a><span id="l5.304" class="difflineminus">-</span>
<a href="#l5.305"></a><span id="l5.305" class="difflineminus">-  // -----------</span>
<a href="#l5.306"></a><span id="l5.306" class="difflineminus">-  // nsIObserver</span>
<a href="#l5.307"></a><span id="l5.307" class="difflineminus">-</span>
<a href="#l5.308"></a><span id="l5.308" class="difflineminus">-  observe(aSubject, aTopic, aData) {</span>
<a href="#l5.309"></a><span id="l5.309" class="difflineminus">-    // Rebuild the list when there are changes to preferences that influence</span>
<a href="#l5.310"></a><span id="l5.310" class="difflineminus">-    // whether or not to show certain entries in the list.</span>
<a href="#l5.311"></a><span id="l5.311" class="difflineminus">-    if (aTopic == &quot;nsPref:changed&quot; &amp;&amp; !this._storingAction) {</span>
<a href="#l5.312"></a><span id="l5.312" class="difflineminus">-      // These two prefs alter the list of visible types, so we have to rebuild</span>
<a href="#l5.313"></a><span id="l5.313" class="difflineminus">-      // that list when they change.</span>
<a href="#l5.314"></a><span id="l5.314" class="difflineminus">-      if (aData == PREF_SHOW_PLUGINS_IN_LIST ||</span>
<a href="#l5.315"></a><span id="l5.315" class="difflineminus">-          aData == PREF_HIDE_PLUGINS_WITHOUT_EXTENSIONS) {</span>
<a href="#l5.316"></a><span id="l5.316" class="difflineminus">-        this._rebuildVisibleTypes();</span>
<a href="#l5.317"></a><span id="l5.317" class="difflineminus">-        this._sortVisibleTypes();</span>
<a href="#l5.318"></a><span id="l5.318" class="difflineminus">-      }</span>
<a href="#l5.319"></a><span id="l5.319" class="difflineminus">-</span>
<a href="#l5.320"></a><span id="l5.320" class="difflineminus">-      // All the prefs we observe can affect what we display, so we rebuild</span>
<a href="#l5.321"></a><span id="l5.321" class="difflineminus">-      // the view when any of them changes.</span>
<a href="#l5.322"></a><span id="l5.322" class="difflineminus">-      this.rebuildView();</span>
<a href="#l5.323"></a><span id="l5.323" class="difflineminus">-    }</span>
<a href="#l5.324"></a><span id="l5.324" class="difflineminus">-  },</span>
<a href="#l5.325"></a><span id="l5.325" class="difflineminus">-</span>
<a href="#l5.326"></a><span id="l5.326" class="difflineminus">-  // -------------</span>
<a href="#l5.327"></a><span id="l5.327" class="difflineminus">-  // EventListener</span>
<a href="#l5.328"></a><span id="l5.328" class="difflineminus">-</span>
<a href="#l5.329"></a><span id="l5.329" class="difflineminus">-  handleEvent(aEvent) {</span>
<a href="#l5.330"></a><span id="l5.330" class="difflineminus">-    if (aEvent.type == &quot;unload&quot;)</span>
<a href="#l5.331"></a><span id="l5.331" class="difflineminus">-      this.destroy();</span>
<a href="#l5.332"></a><span id="l5.332" class="difflineminus">-  },</span>
<a href="#l5.333"></a><span id="l5.333" class="difflineminus">-</span>
<a href="#l5.334"></a><span id="l5.334">   // ---------------------------</span>
<a href="#l5.335"></a><span id="l5.335">   // Composed Model Construction</span>
<a href="#l5.336"></a><span id="l5.336"> </span>
<a href="#l5.337"></a><span id="l5.337">   _loadData() {</span>
<a href="#l5.338"></a><span id="l5.338" class="difflineminus">-    this._loadPluginHandlers();</span>
<a href="#l5.339"></a><span id="l5.339">     this._loadApplicationHandlers();</span>
<a href="#l5.340"></a><span id="l5.340">   },</span>
<a href="#l5.341"></a><span id="l5.341"> </span>
<a href="#l5.342"></a><span id="l5.342">   /**</span>
<a href="#l5.343"></a><span id="l5.343" class="difflineminus">-   * Load the set of handlers defined by plugins.</span>
<a href="#l5.344"></a><span id="l5.344" class="difflineminus">-   *</span>
<a href="#l5.345"></a><span id="l5.345" class="difflineminus">-   * Note: if there's more than one plugin for a given MIME type, we assume</span>
<a href="#l5.346"></a><span id="l5.346" class="difflineminus">-   * the last one is the one that the application will use.  That may not be</span>
<a href="#l5.347"></a><span id="l5.347" class="difflineminus">-   * correct, but it's how we've been doing it for years.</span>
<a href="#l5.348"></a><span id="l5.348" class="difflineminus">-   *</span>
<a href="#l5.349"></a><span id="l5.349" class="difflineminus">-   * Perhaps we should instead query navigator.mimeTypes for the set of types</span>
<a href="#l5.350"></a><span id="l5.350" class="difflineminus">-   * supported by the application and then get the plugin from each MIME type's</span>
<a href="#l5.351"></a><span id="l5.351" class="difflineminus">-   * enabledPlugin property.  But if there's a plugin for a type, we need</span>
<a href="#l5.352"></a><span id="l5.352" class="difflineminus">-   * to know about it even if it isn't enabled, since we're going to give</span>
<a href="#l5.353"></a><span id="l5.353" class="difflineminus">-   * the user an option to enable it.</span>
<a href="#l5.354"></a><span id="l5.354" class="difflineminus">-   *</span>
<a href="#l5.355"></a><span id="l5.355" class="difflineminus">-   * Also note that enabledPlugin does not get updated when</span>
<a href="#l5.356"></a><span id="l5.356" class="difflineminus">-   * plugin.disable_full_page_plugin_for_types changes, so even if we could use</span>
<a href="#l5.357"></a><span id="l5.357" class="difflineminus">-   * enabledPlugin to get the plugin that would be used, we'd still need to</span>
<a href="#l5.358"></a><span id="l5.358" class="difflineminus">-   * check the pref ourselves to find out if it's enabled.</span>
<a href="#l5.359"></a><span id="l5.359" class="difflineminus">-   */</span>
<a href="#l5.360"></a><span id="l5.360" class="difflineminus">-  _loadPluginHandlers() {</span>
<a href="#l5.361"></a><span id="l5.361" class="difflineminus">-    &quot;use strict&quot;;</span>
<a href="#l5.362"></a><span id="l5.362" class="difflineminus">-</span>
<a href="#l5.363"></a><span id="l5.363" class="difflineminus">-    let mimeTypes = navigator.mimeTypes;</span>
<a href="#l5.364"></a><span id="l5.364" class="difflineminus">-</span>
<a href="#l5.365"></a><span id="l5.365" class="difflineminus">-    for (let mimeType of mimeTypes) {</span>
<a href="#l5.366"></a><span id="l5.366" class="difflineminus">-      let handlerInfoWrapper;</span>
<a href="#l5.367"></a><span id="l5.367" class="difflineminus">-      if (mimeType.type in this._handledTypes) {</span>
<a href="#l5.368"></a><span id="l5.368" class="difflineminus">-        handlerInfoWrapper = this._handledTypes[mimeType.type];</span>
<a href="#l5.369"></a><span id="l5.369" class="difflineminus">-      } else {</span>
<a href="#l5.370"></a><span id="l5.370" class="difflineminus">-        let wrappedHandlerInfo =</span>
<a href="#l5.371"></a><span id="l5.371" class="difflineminus">-          gMIMEService.getFromTypeAndExtension(mimeType.type, null);</span>
<a href="#l5.372"></a><span id="l5.372" class="difflineminus">-        handlerInfoWrapper = new HandlerInfoWrapper(mimeType.type, wrappedHandlerInfo);</span>
<a href="#l5.373"></a><span id="l5.373" class="difflineminus">-        handlerInfoWrapper.handledOnlyByPlugin = true;</span>
<a href="#l5.374"></a><span id="l5.374" class="difflineminus">-        this._handledTypes[mimeType.type] = handlerInfoWrapper;</span>
<a href="#l5.375"></a><span id="l5.375" class="difflineminus">-      }</span>
<a href="#l5.376"></a><span id="l5.376" class="difflineminus">-      handlerInfoWrapper.pluginName = mimeType.enabledPlugin.name;</span>
<a href="#l5.377"></a><span id="l5.377" class="difflineminus">-    }</span>
<a href="#l5.378"></a><span id="l5.378" class="difflineminus">-  },</span>
<a href="#l5.379"></a><span id="l5.379" class="difflineminus">-</span>
<a href="#l5.380"></a><span id="l5.380" class="difflineminus">-  /**</span>
<a href="#l5.381"></a><span id="l5.381">    * Load the set of handlers defined by the application datastore.</span>
<a href="#l5.382"></a><span id="l5.382">    */</span>
<a href="#l5.383"></a><span id="l5.383">   _loadApplicationHandlers() {</span>
<a href="#l5.384"></a><span id="l5.384">     var wrappedHandlerInfos = gHandlerService.enumerate();</span>
<a href="#l5.385"></a><span id="l5.385">     while (wrappedHandlerInfos.hasMoreElements()) {</span>
<a href="#l5.386"></a><span id="l5.386">       let wrappedHandlerInfo =</span>
<a href="#l5.387"></a><span id="l5.387">         wrappedHandlerInfos.getNext().QueryInterface(Ci.nsIHandlerInfo);</span>
<a href="#l5.388"></a><span id="l5.388">       let type = wrappedHandlerInfo.type;</span>
<a href="#l5.389"></a><span id="l5.389"> </span>
<a href="#l5.390"></a><span id="l5.390">       let handlerInfoWrapper;</span>
<a href="#l5.391"></a><span id="l5.391">       if (type in this._handledTypes) {</span>
<a href="#l5.392"></a><span id="l5.392">         handlerInfoWrapper = this._handledTypes[type];</span>
<a href="#l5.393"></a><span id="l5.393">       } else {</span>
<a href="#l5.394"></a><span id="l5.394">         handlerInfoWrapper = new HandlerInfoWrapper(type, wrappedHandlerInfo);</span>
<a href="#l5.395"></a><span id="l5.395">         this._handledTypes[type] = handlerInfoWrapper;</span>
<a href="#l5.396"></a><span id="l5.396">       }</span>
<a href="#l5.397"></a><span id="l5.397" class="difflineminus">-</span>
<a href="#l5.398"></a><span id="l5.398" class="difflineminus">-      handlerInfoWrapper.handledOnlyByPlugin = false;</span>
<a href="#l5.399"></a><span id="l5.399">     }</span>
<a href="#l5.400"></a><span id="l5.400">   },</span>
<a href="#l5.401"></a><span id="l5.401"> </span>
<a href="#l5.402"></a><span id="l5.402">   // -----------------</span>
<a href="#l5.403"></a><span id="l5.403">   // View Construction</span>
<a href="#l5.404"></a><span id="l5.404"> </span>
<a href="#l5.405"></a><span id="l5.405">   _rebuildVisibleTypes() {</span>
<a href="#l5.406"></a><span id="l5.406">     // Reset the list of visible types and the visible type description.</span>
<a href="#l5.407"></a><span id="l5.407">     this._visibleTypes.length = 0;</span>
<a href="#l5.408"></a><span id="l5.408">     this._visibleDescriptions.clear();</span>
<a href="#l5.409"></a><span id="l5.409"> </span>
<a href="#l5.410"></a><span id="l5.410" class="difflineminus">-    // Get the preferences that help determine what types to show.</span>
<a href="#l5.411"></a><span id="l5.411" class="difflineminus">-    var showPlugins = Services.prefs.getBoolPref(PREF_SHOW_PLUGINS_IN_LIST);</span>
<a href="#l5.412"></a><span id="l5.412" class="difflineminus">-    var hidePluginsWithoutExtensions =</span>
<a href="#l5.413"></a><span id="l5.413" class="difflineminus">-      Services.prefs.getBoolPref(PREF_HIDE_PLUGINS_WITHOUT_EXTENSIONS);</span>
<a href="#l5.414"></a><span id="l5.414" class="difflineminus">-</span>
<a href="#l5.415"></a><span id="l5.415">     for (let type in this._handledTypes) {</span>
<a href="#l5.416"></a><span id="l5.416">       let handlerInfo = this._handledTypes[type];</span>
<a href="#l5.417"></a><span id="l5.417"> </span>
<a href="#l5.418"></a><span id="l5.418" class="difflineminus">-      // Hide plugins without associated extensions if so prefed so we don't</span>
<a href="#l5.419"></a><span id="l5.419" class="difflineminus">-      // show a whole bunch of obscure types handled by plugins on Mac.</span>
<a href="#l5.420"></a><span id="l5.420" class="difflineminus">-      // Note: though protocol types don't have extensions, we still show them;</span>
<a href="#l5.421"></a><span id="l5.421" class="difflineminus">-      // the pref is only meant to be applied to MIME types, since plugins are</span>
<a href="#l5.422"></a><span id="l5.422" class="difflineminus">-      // only associated with MIME types.</span>
<a href="#l5.423"></a><span id="l5.423" class="difflineminus">-      // FIXME: should we also check the &quot;suffixes&quot; property of the plugin?</span>
<a href="#l5.424"></a><span id="l5.424" class="difflineminus">-      // Filed as bug 395135.</span>
<a href="#l5.425"></a><span id="l5.425" class="difflineminus">-      if (hidePluginsWithoutExtensions &amp;&amp; handlerInfo.handledOnlyByPlugin &amp;&amp;</span>
<a href="#l5.426"></a><span id="l5.426" class="difflineminus">-          handlerInfo.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo &amp;&amp;</span>
<a href="#l5.427"></a><span id="l5.427" class="difflineminus">-          !handlerInfo.primaryExtension)</span>
<a href="#l5.428"></a><span id="l5.428" class="difflineminus">-        continue;</span>
<a href="#l5.429"></a><span id="l5.429" class="difflineminus">-</span>
<a href="#l5.430"></a><span id="l5.430" class="difflineminus">-      // Hide types handled only by plugins if so prefed.</span>
<a href="#l5.431"></a><span id="l5.431" class="difflineminus">-      if (handlerInfo.handledOnlyByPlugin &amp;&amp; !showPlugins)</span>
<a href="#l5.432"></a><span id="l5.432" class="difflineminus">-        continue;</span>
<a href="#l5.433"></a><span id="l5.433" class="difflineminus">-</span>
<a href="#l5.434"></a><span id="l5.434">       // We couldn't find any reason to exclude the type, so include it.</span>
<a href="#l5.435"></a><span id="l5.435">       this._visibleTypes.push(handlerInfo);</span>
<a href="#l5.436"></a><span id="l5.436"> </span>
<a href="#l5.437"></a><span id="l5.437">       let otherHandlerInfo = this._visibleDescriptions</span>
<a href="#l5.438"></a><span id="l5.438">                                  .get(handlerInfo.description);</span>
<a href="#l5.439"></a><span id="l5.439">       if (!otherHandlerInfo) {</span>
<a href="#l5.440"></a><span id="l5.440">         // This is the first type with this description that we encountered</span>
<a href="#l5.441"></a><span id="l5.441">         // while rebuilding the _visibleTypes array this time. Make sure the</span>
<a href="#l5.442"></a><span id="l5.442" class="difflineat">@@ -1293,29 +1073,16 @@ var gApplicationsPane = {</span>
<a href="#l5.443"></a><span id="l5.443">       // Attach the handler app object to the menu item so we can use it</span>
<a href="#l5.444"></a><span id="l5.444">       // to make changes to the datastore when the user selects the item.</span>
<a href="#l5.445"></a><span id="l5.445">       menuItem.handlerApp = possibleApp;</span>
<a href="#l5.446"></a><span id="l5.446"> </span>
<a href="#l5.447"></a><span id="l5.447">       menuPopup.appendChild(menuItem);</span>
<a href="#l5.448"></a><span id="l5.448">       possibleAppMenuItems.push(menuItem);</span>
<a href="#l5.449"></a><span id="l5.449">     }</span>
<a href="#l5.450"></a><span id="l5.450"> </span>
<a href="#l5.451"></a><span id="l5.451" class="difflineminus">-    // Create a menu item for the plugin.</span>
<a href="#l5.452"></a><span id="l5.452" class="difflineminus">-    if (handlerInfo.plugin) {</span>
<a href="#l5.453"></a><span id="l5.453" class="difflineminus">-      var pluginMenuItem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l5.454"></a><span id="l5.454" class="difflineminus">-      pluginMenuItem.setAttribute(&quot;action&quot;, kActionUsePlugin);</span>
<a href="#l5.455"></a><span id="l5.455" class="difflineminus">-      let label = this._prefsBundle.getFormattedString(&quot;usePluginIn&quot;,</span>
<a href="#l5.456"></a><span id="l5.456" class="difflineminus">-                                                       [handlerInfo.plugin.name,</span>
<a href="#l5.457"></a><span id="l5.457" class="difflineminus">-                                                        this._brandShortName]);</span>
<a href="#l5.458"></a><span id="l5.458" class="difflineminus">-      pluginMenuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l5.459"></a><span id="l5.459" class="difflineminus">-      pluginMenuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l5.460"></a><span id="l5.460" class="difflineminus">-      pluginMenuItem.setAttribute(APP_ICON_ATTR_NAME, &quot;plugin&quot;);</span>
<a href="#l5.461"></a><span id="l5.461" class="difflineminus">-      menuPopup.appendChild(pluginMenuItem);</span>
<a href="#l5.462"></a><span id="l5.462" class="difflineminus">-    }</span>
<a href="#l5.463"></a><span id="l5.463" class="difflineminus">-</span>
<a href="#l5.464"></a><span id="l5.464">     // Create a menu item for selecting a local application.</span>
<a href="#l5.465"></a><span id="l5.465">     let createItem = true;</span>
<a href="#l5.466"></a><span id="l5.466">     if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l5.467"></a><span id="l5.467">       // On Windows, selecting an application to open another application</span>
<a href="#l5.468"></a><span id="l5.468">       // would be meaningless so we special case executables.</span>
<a href="#l5.469"></a><span id="l5.469">       var executableType = Cc[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l5.470"></a><span id="l5.470">                              .getService(Ci.nsIMIMEService)</span>
<a href="#l5.471"></a><span id="l5.471">                              .getTypeFromExtension(&quot;exe&quot;);</span>
<a href="#l5.472"></a><span id="l5.472" class="difflineat">@@ -1359,19 +1126,16 @@ var gApplicationsPane = {</span>
<a href="#l5.473"></a><span id="l5.473">       case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l5.474"></a><span id="l5.474">         menu.selectedItem = defaultMenuItem;</span>
<a href="#l5.475"></a><span id="l5.475">         break;</span>
<a href="#l5.476"></a><span id="l5.476">       case Ci.nsIHandlerInfo.useHelperApp:</span>
<a href="#l5.477"></a><span id="l5.477">         if (preferredApp)</span>
<a href="#l5.478"></a><span id="l5.478">           menu.selectedItem =</span>
<a href="#l5.479"></a><span id="l5.479">             possibleAppMenuItems.filter(v =&gt; v.handlerApp.equals(preferredApp))[0];</span>
<a href="#l5.480"></a><span id="l5.480">         break;</span>
<a href="#l5.481"></a><span id="l5.481" class="difflineminus">-      case kActionUsePlugin:</span>
<a href="#l5.482"></a><span id="l5.482" class="difflineminus">-        menu.selectedItem = pluginMenuItem;</span>
<a href="#l5.483"></a><span id="l5.483" class="difflineminus">-        break;</span>
<a href="#l5.484"></a><span id="l5.484">       case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l5.485"></a><span id="l5.485">         menu.selectedItem = saveMenuItem;</span>
<a href="#l5.486"></a><span id="l5.486">         break;</span>
<a href="#l5.487"></a><span id="l5.487">     }</span>
<a href="#l5.488"></a><span id="l5.488">     // menu.selectedItem may be null if the preferredAction is</span>
<a href="#l5.489"></a><span id="l5.489">     // useSystemDefault, but handlerInfo.hasDefaultHandler returns false.</span>
<a href="#l5.490"></a><span id="l5.490">     // For now, we'll just use the askMenuItem to avoid ugly exceptions.</span>
<a href="#l5.491"></a><span id="l5.491">     menu.previousSelectedItem = menu.selectedItem || askMenuItem;</span>
<a href="#l5.492"></a><span id="l5.492" class="difflineat">@@ -1469,22 +1233,16 @@ var gApplicationsPane = {</span>
<a href="#l5.493"></a><span id="l5.493">     var typeItem = this._list.selectedItem;</span>
<a href="#l5.494"></a><span id="l5.494">     var handlerInfo = this._handledTypes[typeItem.type];</span>
<a href="#l5.495"></a><span id="l5.495"> </span>
<a href="#l5.496"></a><span id="l5.496">     if (aActionItem.hasAttribute(&quot;alwaysAsk&quot;)) {</span>
<a href="#l5.497"></a><span id="l5.497">       handlerInfo.alwaysAskBeforeHandling = true;</span>
<a href="#l5.498"></a><span id="l5.498">     } else if (aActionItem.hasAttribute(&quot;action&quot;)) {</span>
<a href="#l5.499"></a><span id="l5.499">       let action = parseInt(aActionItem.getAttribute(&quot;action&quot;));</span>
<a href="#l5.500"></a><span id="l5.500"> </span>
<a href="#l5.501"></a><span id="l5.501" class="difflineminus">-      // Set the plugin state if we're enabling or disabling a plugin.</span>
<a href="#l5.502"></a><span id="l5.502" class="difflineminus">-      if (action == kActionUsePlugin)</span>
<a href="#l5.503"></a><span id="l5.503" class="difflineminus">-        handlerInfo.enablePluginType();</span>
<a href="#l5.504"></a><span id="l5.504" class="difflineminus">-      else if (handlerInfo.plugin &amp;&amp; !handlerInfo.isDisabledPluginType)</span>
<a href="#l5.505"></a><span id="l5.505" class="difflineminus">-        handlerInfo.disablePluginType();</span>
<a href="#l5.506"></a><span id="l5.506" class="difflineminus">-</span>
<a href="#l5.507"></a><span id="l5.507">       // Set the preferred application handler.</span>
<a href="#l5.508"></a><span id="l5.508">       // We leave the existing preferred app in the list when we set</span>
<a href="#l5.509"></a><span id="l5.509">       // the preferred action to something other than useHelperApp so that</span>
<a href="#l5.510"></a><span id="l5.510">       // legacy datastores that don't have the preferred app in the list</span>
<a href="#l5.511"></a><span id="l5.511">       // of possible apps still include the preferred app in the list of apps</span>
<a href="#l5.512"></a><span id="l5.512">       // the user can choose to handle the type.</span>
<a href="#l5.513"></a><span id="l5.513">       if (action == Ci.nsIHandlerInfo.useHelperApp)</span>
<a href="#l5.514"></a><span id="l5.514">         handlerInfo.preferredApplicationHandler = aActionItem.handlerApp;</span>
<a href="#l5.515"></a><span id="l5.515" class="difflineat">@@ -1493,20 +1251,16 @@ var gApplicationsPane = {</span>
<a href="#l5.516"></a><span id="l5.516">       handlerInfo.alwaysAskBeforeHandling = false;</span>
<a href="#l5.517"></a><span id="l5.517"> </span>
<a href="#l5.518"></a><span id="l5.518">       // Set the preferred action.</span>
<a href="#l5.519"></a><span id="l5.519">       handlerInfo.preferredAction = action;</span>
<a href="#l5.520"></a><span id="l5.520">     }</span>
<a href="#l5.521"></a><span id="l5.521"> </span>
<a href="#l5.522"></a><span id="l5.522">     handlerInfo.store();</span>
<a href="#l5.523"></a><span id="l5.523"> </span>
<a href="#l5.524"></a><span id="l5.524" class="difflineminus">-    // Make sure the handler info object is flagged to indicate that there is</span>
<a href="#l5.525"></a><span id="l5.525" class="difflineminus">-    // now some user configuration for the type.</span>
<a href="#l5.526"></a><span id="l5.526" class="difflineminus">-    handlerInfo.handledOnlyByPlugin = false;</span>
<a href="#l5.527"></a><span id="l5.527" class="difflineminus">-</span>
<a href="#l5.528"></a><span id="l5.528">     // Update the action label and image to reflect the new preferred action.</span>
<a href="#l5.529"></a><span id="l5.529">     HandlerListItem.forNode(typeItem).refreshAction();</span>
<a href="#l5.530"></a><span id="l5.530">   },</span>
<a href="#l5.531"></a><span id="l5.531"> </span>
<a href="#l5.532"></a><span id="l5.532">   manageApp(aEvent) {</span>
<a href="#l5.533"></a><span id="l5.533">     // Don't let the normal &quot;on select action&quot; handler get this event,</span>
<a href="#l5.534"></a><span id="l5.534">     // as we handle it specially ourselves.</span>
<a href="#l5.535"></a><span id="l5.535">     aEvent.stopPropagation();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -724,34 +724,16 @@ safeModeRestartPromptTitle=Restart with </span>
<a href="#l6.4"></a><span id="l6.4"> safeModeRestartPromptMessage=Are you sure you want to disable all add-ons and restart?</span>
<a href="#l6.5"></a><span id="l6.5"> safeModeRestartButton=Restart</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7"> # LOCALIZATION NOTE (downloadAndInstallButton.label): %S is replaced by the</span>
<a href="#l6.8"></a><span id="l6.8"> # version of the update: &quot;Update to 28.0&quot;.</span>
<a href="#l6.9"></a><span id="l6.9"> update.downloadAndInstallButton.label=Update to %S</span>
<a href="#l6.10"></a><span id="l6.10"> update.downloadAndInstallButton.accesskey=U</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-outdatedpluginsMessage.title=Some plugins used by this page are out of date.</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-outdatedpluginsMessage.updateButton.label=Update Plugins…</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-outdatedpluginsMessage.updateButton.accesskey=U</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-blockedpluginsMessage.title=Some plugins required by this page have been blocked for your protection.</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-blockedpluginsMessage.infoButton.label=Details…</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-blockedpluginsMessage.infoButton.accesskey=D</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-blockedpluginsMessage.searchButton.label=Update Plugins…</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-blockedpluginsMessage.searchButton.accesskey=U</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-crashedpluginsMessage.title=The %S plugin has crashed.</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-crashedpluginsMessage.reloadButton.label=Reload page</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-crashedpluginsMessage.reloadButton.accesskey=R</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-crashedpluginsMessage.submitButton.label=Submit a crash report</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-crashedpluginsMessage.submitButton.accesskey=S</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-crashedpluginsMessage.learnMore=Learn More…</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">-carbonFailurePluginsMessage.message=This page asks to use a plugin that can only run in 32-bit mode</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-carbonFailurePluginsMessage.restartButton.label=Restart in 32-bit mode</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-carbonFailurePluginsMessage.restartButton.accesskey=R</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-</span>
<a href="#l6.30"></a><span id="l6.30"> # Sanitize</span>
<a href="#l6.31"></a><span id="l6.31"> # LOCALIZATION NOTE (sanitizeDialog2.everything.title): When &quot;Time range to</span>
<a href="#l6.32"></a><span id="l6.32"> # clear&quot; is set to &quot;Everything&quot;, the Clear Recent History dialog's title is</span>
<a href="#l6.33"></a><span id="l6.33"> # changed to this.  See UI mockup and comment 11 at bug 480169 --&gt;</span>
<a href="#l6.34"></a><span id="l6.34"> sanitizeDialog2.everything.title=Clear All History</span>
<a href="#l6.35"></a><span id="l6.35"> sanitizeButtonOK=Clear Now</span>
<a href="#l6.36"></a><span id="l6.36"> # LOCALIZATION NOTE (sanitizeEverythingWarning2): Warning that appears when</span>
<a href="#l6.37"></a><span id="l6.37"> # &quot;Time range to clear&quot; is set to &quot;Everything&quot; in Clear Recent History dialog,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/preferences.properties</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/preferences.properties</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -33,21 +33,16 @@ useDefault=Use %S (default)</span>
<a href="#l7.4"></a><span id="l7.4"> useOtherApp=Use other…</span>
<a href="#l7.5"></a><span id="l7.5"> fpTitleChooseApp=Select Helper Application</span>
<a href="#l7.6"></a><span id="l7.6"> manageApp=Application Details…</span>
<a href="#l7.7"></a><span id="l7.7"> alwaysAsk=Always ask</span>
<a href="#l7.8"></a><span id="l7.8"> delete=Delete Action</span>
<a href="#l7.9"></a><span id="l7.9"> confirmDeleteTitle=Delete Action</span>
<a href="#l7.10"></a><span id="l7.10"> confirmDeleteText=Are you sure you want to delete this action?</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-# LOCALIZATION NOTE (usePluginIn):</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-# %1$S = plugin name (for example &quot;QuickTime Plugin-in 7.2&quot;)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-# %2$S = brandShortName from brand.properties (for example &quot;Shredder&quot;)</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-usePluginIn=Use %1$S (in %2$S)</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-</span>
<a href="#l7.17"></a><span id="l7.17"> # LOCALIZATION NOTE (typeDescriptionWithDetails):</span>
<a href="#l7.18"></a><span id="l7.18"> # %1$S = type description (for example &quot;Portable Document Format&quot;)</span>
<a href="#l7.19"></a><span id="l7.19"> # %2$S = details (see below, for example &quot;(application/pdf: .pdf, .pdfx)&quot;)</span>
<a href="#l7.20"></a><span id="l7.20"> typeDescriptionWithDetails=%1$S %2$S</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22"> # LOCALIZATION NOTE (typeDetailsWithTypeOrExt):</span>
<a href="#l7.23"></a><span id="l7.23"> # %1$S = type or extensions (for example &quot;application/pdf&quot;, or &quot;.pdf, .pdfx&quot;)</span>
<a href="#l7.24"></a><span id="l7.24"> typeDetailsWithTypeOrExt=(%1$S)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/testsuite-targets.mk</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/testsuite-targets.mk</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -28,28 +28,26 @@ find-solo-test = $(if $(and $(SOLO_TEST)</span>
<a href="#l8.4"></a><span id="l8.4"> # PYTHONHOME messes very badly with virtualenv setups, so unset it.</span>
<a href="#l8.5"></a><span id="l8.5"> mozmill:</span>
<a href="#l8.6"></a><span id="l8.6"> 	$(call check-no-solo,SOLOVAR is specified. Perhaps you meant mozmill-one.)</span>
<a href="#l8.7"></a><span id="l8.7"> 	unset PYTHONHOME &amp;&amp; cd $(MOZMILLDIR) &amp;&amp; MACOSX_DEPLOYMENT_TARGET= \</span>
<a href="#l8.8"></a><span id="l8.8"> 	$(MOZMILLPYTHON) runtestlist.py --list=mozmilltests.list \</span>
<a href="#l8.9"></a><span id="l8.9"> 	--binary=$(abspath $(BINARY)) \</span>
<a href="#l8.10"></a><span id="l8.10"> 	--dir=$(commtopsrcdir)/mail/test/mozmill \</span>
<a href="#l8.11"></a><span id="l8.11"> 	--symbols-path=$(ABS_DIST)/crashreporter-symbols \</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-	--plugins-path=$(ABS_DIST)/plugins \</span>
<a href="#l8.13"></a><span id="l8.13"> 	--testing-modules-dir=$(topobjdir)/_tests/modules \</span>
<a href="#l8.14"></a><span id="l8.14"> 	$(MOZMILL_EXTRA)</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16"> mozmill-one: solo-test = $(find-solo-test)</span>
<a href="#l8.17"></a><span id="l8.17"> mozmill-one:</span>
<a href="#l8.18"></a><span id="l8.18"> 	unset PYTHONHOME &amp;&amp; cd $(MOZMILLDIR) &amp;&amp; MACOSX_DEPLOYMENT_TARGET= \</span>
<a href="#l8.19"></a><span id="l8.19"> 	$(MOZMILLPYTHON) runtest.py \</span>
<a href="#l8.20"></a><span id="l8.20"> 	--test=$(commtopsrcdir)/mail/test/mozmill/$(solo-test) \</span>
<a href="#l8.21"></a><span id="l8.21"> 	--binary=$(abspath $(BINARY)) \</span>
<a href="#l8.22"></a><span id="l8.22"> 	--symbols-path=$(ABS_DIST)/crashreporter-symbols \</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-	--plugins-path=$(ABS_DIST)/plugins \</span>
<a href="#l8.24"></a><span id="l8.24"> 	--testing-modules-dir=$(topobjdir)/_tests/modules \</span>
<a href="#l8.25"></a><span id="l8.25"> 	$(MOZMILL_EXTRA)</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27"> # We need to add the mozmill tests to the package for tests.</span>
<a href="#l8.28"></a><span id="l8.28"> # If Lightning is enabled, also stage the lightning extension</span>
<a href="#l8.29"></a><span id="l8.29"> ifdef MOZ_CALENDAR</span>
<a href="#l8.30"></a><span id="l8.30"> package-tests: stage-calendar</span>
<a href="#l8.31"></a><span id="l8.31"> else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/themes/linux/mail/preferences/applications.css</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/themes/linux/mail/preferences/applications.css</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -30,21 +30,16 @@ menuitem[appHandlerIcon=&quot;ask&quot;] {</span>
<a href="#l9.4"></a><span id="l9.4">   list-style-image: url(&quot;chrome://messenger/skin/preferences/alwaysAsk.png&quot;);</span>
<a href="#l9.5"></a><span id="l9.5"> }</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> richlistitem[appHandlerIcon=&quot;save&quot;],</span>
<a href="#l9.8"></a><span id="l9.8"> menuitem[appHandlerIcon=&quot;save&quot;] {</span>
<a href="#l9.9"></a><span id="l9.9">   list-style-image: url(&quot;moz-icon://stock/gtk-save?size=menu&quot;);</span>
<a href="#l9.10"></a><span id="l9.10"> }</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-richlistitem[appHandlerIcon=&quot;plugin&quot;],</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-menuitem[appHandlerIcon=&quot;plugin&quot;] {</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-  list-style-image: url(&quot;chrome://global/skin/plugins/pluginGeneric.svg&quot;);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-}</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-</span>
<a href="#l9.17"></a><span id="l9.17"> .actionsMenu .menulist-icon {</span>
<a href="#l9.18"></a><span id="l9.18">   margin-inline-end: 1px;</span>
<a href="#l9.19"></a><span id="l9.19">   height: 16px;</span>
<a href="#l9.20"></a><span id="l9.20">   width: 16px;</span>
<a href="#l9.21"></a><span id="l9.21"> }</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23"> .actionsMenu &gt; menupopup &gt; menuitem &gt; .menu-iconic-left {</span>
<a href="#l9.24"></a><span id="l9.24">   padding-inline-start: 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/themes/osx/mail/preferences/applications.css</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/themes/osx/mail/preferences/applications.css</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -33,21 +33,16 @@ menuitem[appHandlerIcon=&quot;ask&quot;] {</span>
<a href="#l10.4"></a><span id="l10.4">   list-style-image: url(&quot;chrome://messenger/skin/preferences/alwaysAsk.png&quot;);</span>
<a href="#l10.5"></a><span id="l10.5"> }</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7"> richlistitem[appHandlerIcon=&quot;save&quot;],</span>
<a href="#l10.8"></a><span id="l10.8"> menuitem[appHandlerIcon=&quot;save&quot;] {</span>
<a href="#l10.9"></a><span id="l10.9">   list-style-image: url(&quot;chrome://messenger/skin/preferences/saveFile.png&quot;);</span>
<a href="#l10.10"></a><span id="l10.10"> }</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-richlistitem[appHandlerIcon=&quot;plugin&quot;],</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-menuitem[appHandlerIcon=&quot;plugin&quot;] {</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-  list-style-image: url(&quot;chrome://global/skin/plugins/pluginGeneric.svg&quot;);</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-}</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-</span>
<a href="#l10.17"></a><span id="l10.17"> .actionsMenu .menulist-icon {</span>
<a href="#l10.18"></a><span id="l10.18">   margin-inline-end: 1px;</span>
<a href="#l10.19"></a><span id="l10.19"> }</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21"> .actionsMenu &gt; menupopup &gt; menuitem &gt; .menu-iconic-left {</span>
<a href="#l10.22"></a><span id="l10.22">   padding-inline-start: 3px;</span>
<a href="#l10.23"></a><span id="l10.23">   padding-inline-end: 1px;</span>
<a href="#l10.24"></a><span id="l10.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/themes/windows/mail/preferences/applications.css</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/themes/windows/mail/preferences/applications.css</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -34,21 +34,16 @@ menuitem[appHandlerIcon=&quot;ask&quot;] {</span>
<a href="#l11.4"></a><span id="l11.4">   list-style-image: url(&quot;chrome://messenger/skin/preferences/alwaysAsk.png&quot;);</span>
<a href="#l11.5"></a><span id="l11.5"> }</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7"> richlistitem[appHandlerIcon=&quot;save&quot;],</span>
<a href="#l11.8"></a><span id="l11.8"> menuitem[appHandlerIcon=&quot;save&quot;] {</span>
<a href="#l11.9"></a><span id="l11.9">   list-style-image: url(&quot;chrome://messenger/skin/preferences/saveFile.png&quot;);</span>
<a href="#l11.10"></a><span id="l11.10"> }</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-richlistitem[appHandlerIcon=&quot;plugin&quot;],</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-menuitem[appHandlerIcon=&quot;plugin&quot;] {</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-  list-style-image: url(&quot;chrome://global/skin/plugins/pluginGeneric.svg&quot;);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-}</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-</span>
<a href="#l11.17"></a><span id="l11.17"> .actionsMenu .menulist-icon {</span>
<a href="#l11.18"></a><span id="l11.18">   margin-inline-end: 3px;</span>
<a href="#l11.19"></a><span id="l11.19"> }</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21"> .actionsMenu &gt; menupopup &gt; menuitem &gt; .menu-iconic-left {</span>
<a href="#l11.22"></a><span id="l11.22">   padding-inline-start: 0px;</span>
<a href="#l11.23"></a><span id="l11.23">   padding-inline-end: 2px;</span>
<a href="#l11.24"></a><span id="l11.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -855,36 +855,35 @@ nsresult nsMsgContentPolicy::SetDisableI</span>
<a href="#l12.4"></a><span id="l12.4">   }</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6">   if (!isAllowedContent) {</span>
<a href="#l12.7"></a><span id="l12.7">     // Disable JavaScript on message URLs.</span>
<a href="#l12.8"></a><span id="l12.8">     rv = docShell-&gt;SetAllowJavascript(false);</span>
<a href="#l12.9"></a><span id="l12.9">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.10"></a><span id="l12.10">     rv = docShell-&gt;SetAllowContentRetargetingOnChildren(false);</span>
<a href="#l12.11"></a><span id="l12.11">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    rv = docShell-&gt;SetAllowPlugins(false);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15">     uint32_t sandboxFlags;</span>
<a href="#l12.16"></a><span id="l12.16">     rv = docShell-&gt;GetSandboxFlags(&amp;sandboxFlags);</span>
<a href="#l12.17"></a><span id="l12.17">     sandboxFlags |= SANDBOXED_FORMS;</span>
<a href="#l12.18"></a><span id="l12.18">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.19"></a><span id="l12.19">     rv = docShell-&gt;SetSandboxFlags(sandboxFlags);</span>
<a href="#l12.20"></a><span id="l12.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.21"></a><span id="l12.21">   }</span>
<a href="#l12.22"></a><span id="l12.22">   else {</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-    // JavaScript and plugins are allowed on non-message URLs.</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+    // JavaScript is allowed on non-message URLs.</span>
<a href="#l12.25"></a><span id="l12.25">     rv = docShell-&gt;SetAllowJavascript(true);</span>
<a href="#l12.26"></a><span id="l12.26">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.27"></a><span id="l12.27">     rv = docShell-&gt;SetAllowContentRetargetingOnChildren(true);</span>
<a href="#l12.28"></a><span id="l12.28">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-    rv = docShell-&gt;SetAllowPlugins(true);</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.31"></a><span id="l12.31">   }</span>
<a href="#l12.32"></a><span id="l12.32"> </span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+  rv = docShell-&gt;SetAllowPlugins(false);</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+</span>
<a href="#l12.36"></a><span id="l12.36">   return NS_OK;</span>
<a href="#l12.37"></a><span id="l12.37"> }</span>
<a href="#l12.38"></a><span id="l12.38"> </span>
<a href="#l12.39"></a><span id="l12.39"> /**</span>
<a href="#l12.40"></a><span id="l12.40">  * Gets the root docshell from a requesting context.</span>
<a href="#l12.41"></a><span id="l12.41">  */</span>
<a href="#l12.42"></a><span id="l12.42"> nsresult</span>
<a href="#l12.43"></a><span id="l12.43"> nsMsgContentPolicy::GetRootDocShellForContext(nsISupports *aRequestingContext,</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineat">@@ -1022,31 +1021,28 @@ nsMsgContentPolicy::OnLocationChange(nsI</span>
<a href="#l12.45"></a><span id="l12.45"> </span>
<a href="#l12.46"></a><span id="l12.46">   nsCOMPtr&lt;nsIMsgMessageUrl&gt; messageUrl = do_QueryInterface(aLocation, &amp;rv);</span>
<a href="#l12.47"></a><span id="l12.47">   mozilla::Unused &lt;&lt; messageUrl;</span>
<a href="#l12.48"></a><span id="l12.48">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l12.49"></a><span id="l12.49">     // Disable javascript on message URLs.</span>
<a href="#l12.50"></a><span id="l12.50">     rv = docShell-&gt;SetAllowJavascript(false);</span>
<a href="#l12.51"></a><span id="l12.51">     NS_ASSERTION(NS_SUCCEEDED(rv),</span>
<a href="#l12.52"></a><span id="l12.52">                  &quot;Failed to set javascript disabled on docShell&quot;);</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-    // Also disable plugins if the preference requires it.</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-    rv = docShell-&gt;SetAllowPlugins(false);</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-    NS_ASSERTION(NS_SUCCEEDED(rv),</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineminus">-                 &quot;Failed to set plugins disabled on docShell&quot;);</span>
<a href="#l12.57"></a><span id="l12.57">   }</span>
<a href="#l12.58"></a><span id="l12.58">   else {</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-    // Disable javascript and plugins are allowed on non-message URLs.</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+    // Javascript is allowed on non-message URLs. Plugins are not.</span>
<a href="#l12.61"></a><span id="l12.61">     rv = docShell-&gt;SetAllowJavascript(true);</span>
<a href="#l12.62"></a><span id="l12.62">     NS_ASSERTION(NS_SUCCEEDED(rv),</span>
<a href="#l12.63"></a><span id="l12.63">                  &quot;Failed to set javascript allowed on docShell&quot;);</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-    rv = docShell-&gt;SetAllowPlugins(true);</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-    NS_ASSERTION(NS_SUCCEEDED(rv),</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-                 &quot;Failed to set plugins allowed on docShell&quot;);</span>
<a href="#l12.67"></a><span id="l12.67">   }</span>
<a href="#l12.68"></a><span id="l12.68"> </span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+  rv = docShell-&gt;SetAllowPlugins(false);</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+  NS_ASSERTION(NS_SUCCEEDED(rv),</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+               &quot;Failed to set plugins disabled on docShell&quot;);</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+</span>
<a href="#l12.73"></a><span id="l12.73">   return NS_OK;</span>
<a href="#l12.74"></a><span id="l12.74"> }</span>
<a href="#l12.75"></a><span id="l12.75"> </span>
<a href="#l12.76"></a><span id="l12.76"> NS_IMETHODIMP</span>
<a href="#l12.77"></a><span id="l12.77"> nsMsgContentPolicy::OnStatusChange(nsIWebProgress *aWebProgress,</span>
<a href="#l12.78"></a><span id="l12.78">                                    nsIRequest *aRequest, nsresult aStatus,</span>
<a href="#l12.79"></a><span id="l12.79">                                    const char16_t *aMessage)</span>
<a href="#l12.80"></a><span id="l12.80"> {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

