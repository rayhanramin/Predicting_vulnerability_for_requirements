<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 19848:378b9a66d495685964abbdfdd9da25879dd409ad</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 378b9a66d495685964abbdfdd9da25879dd409ad" />
<meta property="og:url" content="/comm-central/rev/378b9a66d495685964abbdfdd9da25879dd409ad" />
<meta property="og:description" content="Bug 1292569 - convert functions containing yield to standard generators (function*) to make xpcshell tests pass. f=asuth, r+a=jorgk CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 378b9a66d495685964abbdfdd9da25879dd409ad 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/378b9a66d495685964abbdfdd9da25879dd409ad">shortlog</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/378b9a66d495685964abbdfdd9da25879dd409ad">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad">files</a> |
changeset |
<a href="/comm-central/raw-rev/378b9a66d495685964abbdfdd9da25879dd409ad">raw</a>  | <a href="/comm-central/archive/378b9a66d495685964abbdfdd9da25879dd409ad.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1292569">Bug 1292569</a> - convert functions containing yield to standard generators (function*) to make xpcshell tests pass. f=asuth, r+a=jorgk CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 08 Aug 2016 15:09:00 +0200</td></tr>

<tr>
 <td>changeset 19848</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/378b9a66d495685964abbdfdd9da25879dd409ad">378b9a66d495685964abbdfdd9da25879dd409ad</a></td>
</tr>



<tr>
<td>parent 19847</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f7e1f4d6f62f32de5d8156001283664ecb621072">f7e1f4d6f62f32de5d8156001283664ecb621072</a>
</td>
</tr>

<tr>
<td>child 19849</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/adc56f0cd5b514b27a96cebb31afe02503971b0c">adc56f0cd5b514b27a96cebb31afe02503971b0c</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=378b9a66d495685964abbdfdd9da25879dd409ad">12156</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 09 Aug 2016 03:24:04 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@adc56f0cd5b5 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=adc56f0cd5b514b27a96cebb31afe02503971b0c">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=adc56f0cd5b514b27a96cebb31afe02503971b0c&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=adc56f0cd5b514b27a96cebb31afe02503971b0c&newProject=comm-central&newRevision=378b9a66d495685964abbdfdd9da25879dd409ad&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=adc56f0cd5b514b27a96cebb31afe02503971b0c&newProject=comm-central&newRevision=378b9a66d495685964abbdfdd9da25879dd409ad&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=adc56f0cd5b514b27a96cebb31afe02503971b0c&newProject=comm-central&newRevision=378b9a66d495685964abbdfdd9da25879dd409ad&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1292569">1292569</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1292569">Bug 1292569</a> - convert functions containing yield to standard generators (function*) to make xpcshell tests pass. f=asuth, r+a=jorgk CLOSED TREE</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_imapFolder.js">mail/base/test/unit/test_viewWrapper_imapFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_imapFolder.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_imapFolder.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_imapFolder.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_imapFolder.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_imapFolder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_logic.js">mail/base/test/unit/test_viewWrapper_logic.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_logic.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_logic.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_logic.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_logic.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_logic.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_realFolder.js">mail/base/test/unit/test_viewWrapper_realFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_realFolder.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_realFolder.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_realFolder.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_realFolder.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_realFolder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolder.js">mail/base/test/unit/test_viewWrapper_virtualFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolder.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolder.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolder.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolder.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">mail/test/mozmill/shared-modules/test-folder-display-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_compactFailure.js">mailnews/base/test/unit/test_compactFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_compactFailure.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_compactFailure.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_compactFailure.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_compactFailure.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_compactFailure.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_copyToInvalidDB.js">mailnews/base/test/unit/test_copyToInvalidDB.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_copyToInvalidDB.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_copyToInvalidDB.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_copyToInvalidDB.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_copyToInvalidDB.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_copyToInvalidDB.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_detachToFile.js">mailnews/base/test/unit/test_detachToFile.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_detachToFile.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_detachToFile.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_detachToFile.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_detachToFile.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_detachToFile.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_junkingWhenDisabled.js">mailnews/base/test/unit/test_junkingWhenDisabled.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_junkingWhenDisabled.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_junkingWhenDisabled.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_junkingWhenDisabled.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_junkingWhenDisabled.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_junkingWhenDisabled.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_mimemaltdetach.js">mailnews/base/test/unit/test_mimemaltdetach.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_mimemaltdetach.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_mimemaltdetach.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_mimemaltdetach.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_mimemaltdetach.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_mimemaltdetach.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView.js">mailnews/base/test/unit/test_nsMsgDBView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">mailnews/base/test/unit/test_nsMsgDBView_headerValues.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_quarantineFilterMove.js">mailnews/base/test/unit/test_quarantineFilterMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_quarantineFilterMove.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_quarantineFilterMove.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_quarantineFilterMove.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_quarantineFilterMove.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_quarantineFilterMove.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_retention.js">mailnews/base/test/unit/test_retention.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_retention.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_retention.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_retention.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_retention.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_retention.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/compose/test/unit/test_sendMessageLater2.js">mailnews/compose/test/unit/test_sendMessageLater2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/compose/test/unit/test_sendMessageLater2.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/compose/test/unit/test_sendMessageLater2.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/compose/test/unit/test_sendMessageLater2.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/compose/test/unit/test_sendMessageLater2.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/compose/test/unit/test_sendMessageLater2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/modules/indexer.js">mailnews/db/gloda/modules/indexer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/modules/indexer.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/modules/indexer.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/modules/indexer.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/modules/indexer.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/modules/indexer.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_gloda_content.js">mailnews/db/gloda/test/unit/base_gloda_content.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_gloda_content.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_gloda_content.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_gloda_content.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_gloda_content.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_gloda_content.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_junk.js">mailnews/db/gloda/test/unit/base_index_junk.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_junk.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_junk.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_junk.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_junk.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_junk.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_messages.js">mailnews/db/gloda/test/unit/base_index_messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_messages.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_messages.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_messages.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_messages.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_index_messages.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_query_messages.js">mailnews/db/gloda/test/unit/base_query_messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_query_messages.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_query_messages.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_query_messages.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_query_messages.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/base_query_messages.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/genericIndexer.js">mailnews/db/gloda/test/unit/resources/genericIndexer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/genericIndexer.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/genericIndexer.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/genericIndexer.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/genericIndexer.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/genericIndexer.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">mailnews/db/gloda/test/unit/resources/glodaTestHelper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/mockIndexer.js">mailnews/db/gloda/test/unit/resources/mockIndexer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/mockIndexer.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/mockIndexer.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/mockIndexer.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/mockIndexer.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/resources/mockIndexer.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_folder_logic.js">mailnews/db/gloda/test/unit/test_folder_logic.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_folder_logic.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_folder_logic.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_folder_logic.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_folder_logic.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_folder_logic.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">mailnews/db/gloda/test/unit/test_fts3_tokenizer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_addressbook.js">mailnews/db/gloda/test/unit/test_index_addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_addressbook.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_addressbook.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_addressbook.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_addressbook.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_bad_messages.js">mailnews/db/gloda/test/unit/test_index_bad_messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_bad_messages.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_bad_messages.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_bad_messages.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_bad_messages.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_bad_messages.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_compaction.js">mailnews/db/gloda/test/unit/test_index_compaction.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_compaction.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_compaction.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_compaction.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_compaction.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_compaction.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_messages_local.js">mailnews/db/gloda/test/unit/test_index_messages_local.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_messages_local.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_messages_local.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_messages_local.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_messages_local.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_messages_local.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">mailnews/db/gloda/test/unit/test_index_sweep_folder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_index_sweep_folder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_intl.js">mailnews/db/gloda/test/unit/test_intl.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_intl.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_intl.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_intl.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_intl.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_intl.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_migration.js">mailnews/db/gloda/test/unit/test_migration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_migration.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_migration.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_migration.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_migration.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_migration.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">mailnews/db/gloda/test/unit/test_mime_attachments_size.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_attachments_size.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_emitter.js">mailnews/db/gloda/test/unit/test_mime_emitter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_emitter.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_emitter.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_emitter.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_emitter.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_mime_emitter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_msg_search.js">mailnews/db/gloda/test/unit/test_msg_search.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_msg_search.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_msg_search.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_msg_search.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_msg_search.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_msg_search.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_noun_mimetype.js">mailnews/db/gloda/test/unit/test_noun_mimetype.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_noun_mimetype.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_noun_mimetype.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_noun_mimetype.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_noun_mimetype.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_noun_mimetype.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_query_core.js">mailnews/db/gloda/test/unit/test_query_core.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_query_core.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_query_core.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_query_core.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_query_core.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_query_core.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_startup_offline.js">mailnews/db/gloda/test/unit/test_startup_offline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_startup_offline.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_startup_offline.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_startup_offline.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_startup_offline.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/db/gloda/test/unit/test_startup_offline.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_autosync_date_constraints.js">mailnews/imap/test/unit/test_autosync_date_constraints.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_autosync_date_constraints.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_autosync_date_constraints.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_autosync_date_constraints.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_autosync_date_constraints.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_autosync_date_constraints.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bccProperty.js">mailnews/imap/test/unit/test_bccProperty.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bccProperty.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bccProperty.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bccProperty.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bccProperty.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bccProperty.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bug460636.js">mailnews/imap/test/unit/test_bug460636.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bug460636.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bug460636.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bug460636.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bug460636.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_bug460636.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_chunkLastLF.js">mailnews/imap/test/unit/test_chunkLastLF.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_chunkLastLF.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_chunkLastLF.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_chunkLastLF.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_chunkLastLF.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_chunkLastLF.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_compactOfflineStore.js">mailnews/imap/test/unit/test_compactOfflineStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_compactOfflineStore.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_compactOfflineStore.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_compactOfflineStore.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_compactOfflineStore.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_compactOfflineStore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_copyThenMove.js">mailnews/imap/test/unit/test_copyThenMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_copyThenMove.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_copyThenMove.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_copyThenMove.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_copyThenMove.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_copyThenMove.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dod.js">mailnews/imap/test/unit/test_dod.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dod.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dod.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dod.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dod.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dod.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dontStatNoSelect.js">mailnews/imap/test/unit/test_dontStatNoSelect.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dontStatNoSelect.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dontStatNoSelect.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dontStatNoSelect.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dontStatNoSelect.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_dontStatNoSelect.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_fetchCustomAttribute.js">mailnews/imap/test/unit/test_fetchCustomAttribute.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_fetchCustomAttribute.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_fetchCustomAttribute.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_fetchCustomAttribute.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_fetchCustomAttribute.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_fetchCustomAttribute.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_filterCustomHeaders.js">mailnews/imap/test/unit/test_filterCustomHeaders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_filterCustomHeaders.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_filterCustomHeaders.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_filterCustomHeaders.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_filterCustomHeaders.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_filterCustomHeaders.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_folderOfflineFlags.js">mailnews/imap/test/unit/test_folderOfflineFlags.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_folderOfflineFlags.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_folderOfflineFlags.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_folderOfflineFlags.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_folderOfflineFlags.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_folderOfflineFlags.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailAttributes.js">mailnews/imap/test/unit/test_gmailAttributes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailAttributes.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailAttributes.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailAttributes.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailAttributes.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailAttributes.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">mailnews/imap/test/unit/test_gmailOfflineMsgStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAttachmentSaves.js">mailnews/imap/test/unit/test_imapAttachmentSaves.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAttachmentSaves.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAttachmentSaves.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAttachmentSaves.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAttachmentSaves.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAttachmentSaves.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAutoSync.js">mailnews/imap/test/unit/test_imapAutoSync.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAutoSync.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAutoSync.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAutoSync.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAutoSync.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapAutoSync.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapContentLength.js">mailnews/imap/test/unit/test_imapContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapContentLength.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapContentLength.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapContentLength.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapContentLength.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapCopyTimeout.js">mailnews/imap/test/unit/test_imapCopyTimeout.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapCopyTimeout.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapCopyTimeout.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapCopyTimeout.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapCopyTimeout.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapCopyTimeout.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFlagChange.js">mailnews/imap/test/unit/test_imapFlagChange.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFlagChange.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFlagChange.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFlagChange.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFlagChange.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFlagChange.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFolderCopy.js">mailnews/imap/test/unit/test_imapFolderCopy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFolderCopy.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFolderCopy.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFolderCopy.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFolderCopy.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapFolderCopy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrChunking.js">mailnews/imap/test/unit/test_imapHdrChunking.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrChunking.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrChunking.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrChunking.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrChunking.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrChunking.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrStreaming.js">mailnews/imap/test/unit/test_imapHdrStreaming.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrStreaming.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrStreaming.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrStreaming.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrStreaming.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHdrStreaming.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHighWater.js">mailnews/imap/test/unit/test_imapHighWater.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHighWater.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHighWater.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHighWater.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHighWater.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapHighWater.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapRename.js">mailnews/imap/test/unit/test_imapRename.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapRename.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapRename.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapRename.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapRename.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapRename.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapSearch.js">mailnews/imap/test/unit/test_imapSearch.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapSearch.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapSearch.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapSearch.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapSearch.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapSearch.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">mailnews/imap/test/unit/test_imapStatusCloseDBs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">mailnews/imap/test/unit/test_imapStoreMsgOffline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapUndo.js">mailnews/imap/test/unit/test_imapUndo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapUndo.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapUndo.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapUndo.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapUndo.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_imapUndo.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_largeOfflineStore.js">mailnews/imap/test/unit/test_largeOfflineStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_largeOfflineStore.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_largeOfflineStore.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_largeOfflineStore.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_largeOfflineStore.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_largeOfflineStore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listClosesDB.js">mailnews/imap/test/unit/test_listClosesDB.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listClosesDB.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listClosesDB.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listClosesDB.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listClosesDB.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listClosesDB.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listSubscribed.js">mailnews/imap/test/unit/test_listSubscribed.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listSubscribed.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listSubscribed.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listSubscribed.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listSubscribed.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_listSubscribed.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilter.js">mailnews/imap/test/unit/test_localToImapFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilter.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilter.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilter.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilter.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_lsub.js">mailnews/imap/test/unit/test_lsub.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_lsub.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_lsub.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_lsub.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_lsub.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_lsub.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_mailboxes.js">mailnews/imap/test/unit/test_mailboxes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_mailboxes.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_mailboxes.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_mailboxes.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_mailboxes.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_mailboxes.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineDraftDataloss.js">mailnews/imap/test/unit/test_offlineDraftDataloss.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineDraftDataloss.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineDraftDataloss.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineDraftDataloss.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineDraftDataloss.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineDraftDataloss.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineStoreLocking.js">mailnews/imap/test/unit/test_offlineStoreLocking.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineStoreLocking.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineStoreLocking.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineStoreLocking.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineStoreLocking.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_offlineStoreLocking.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_partsOnDemand.js">mailnews/imap/test/unit/test_partsOnDemand.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_partsOnDemand.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_partsOnDemand.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_partsOnDemand.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_partsOnDemand.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_partsOnDemand.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_preserveDataOnMove.js">mailnews/imap/test/unit/test_preserveDataOnMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_preserveDataOnMove.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_preserveDataOnMove.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_preserveDataOnMove.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_preserveDataOnMove.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_preserveDataOnMove.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveImapDraft.js">mailnews/imap/test/unit/test_saveImapDraft.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveImapDraft.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveImapDraft.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveImapDraft.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveImapDraft.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveImapDraft.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveTemplate.js">mailnews/imap/test/unit/test_saveTemplate.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveTemplate.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveTemplate.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveTemplate.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveTemplate.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_saveTemplate.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_starttlsFailure.js">mailnews/imap/test/unit/test_starttlsFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_starttlsFailure.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_starttlsFailure.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_starttlsFailure.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_starttlsFailure.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_starttlsFailure.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">mailnews/imap/test/unit/test_stopMovingToLocalFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_subfolderLocation.js">mailnews/imap/test/unit/test_subfolderLocation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_subfolderLocation.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_subfolderLocation.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_subfolderLocation.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_subfolderLocation.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_subfolderLocation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_syncChanges.js">mailnews/imap/test/unit/test_syncChanges.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_syncChanges.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_syncChanges.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_syncChanges.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_syncChanges.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_syncChanges.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_trustSpamAssassin.js">mailnews/imap/test/unit/test_trustSpamAssassin.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_trustSpamAssassin.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_trustSpamAssassin.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_trustSpamAssassin.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_trustSpamAssassin.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/imap/test/unit/test_trustSpamAssassin.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_folderLoaded.js">mailnews/local/test/unit/test_folderLoaded.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_folderLoaded.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_folderLoaded.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_folderLoaded.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_folderLoaded.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_folderLoaded.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure2.js">mailnews/local/test/unit/test_pop3PasswordFailure2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure2.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure2.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure2.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure2.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure3.js">mailnews/local/test/unit/test_pop3PasswordFailure3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure3.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure3.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure3.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure3.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_pop3PasswordFailure3.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_streamHeaders.js">mailnews/local/test/unit/test_streamHeaders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_streamHeaders.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_streamHeaders.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_streamHeaders.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_streamHeaders.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/local/test/unit/test_streamHeaders.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_alternate_p7m_handling.js">mailnews/mime/test/unit/test_alternate_p7m_handling.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_alternate_p7m_handling.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_alternate_p7m_handling.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_alternate_p7m_handling.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_alternate_p7m_handling.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_alternate_p7m_handling.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_attachment_size.js">mailnews/mime/test/unit/test_attachment_size.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_attachment_size.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_attachment_size.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_attachment_size.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_attachment_size.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_attachment_size.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_badContentType.js">mailnews/mime/test/unit/test_badContentType.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_badContentType.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_badContentType.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_badContentType.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_badContentType.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_badContentType.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_hidden_attachments.js">mailnews/mime/test/unit/test_hidden_attachments.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_hidden_attachments.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_hidden_attachments.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_hidden_attachments.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_hidden_attachments.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_hidden_attachments.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_message_attachment.js">mailnews/mime/test/unit/test_message_attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_message_attachment.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_message_attachment.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_message_attachment.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_message_attachment.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_message_attachment.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_rfc822_body.js">mailnews/mime/test/unit/test_rfc822_body.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_rfc822_body.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_rfc822_body.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_rfc822_body.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_rfc822_body.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_rfc822_body.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_text_attachment.js">mailnews/mime/test/unit/test_text_attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_text_attachment.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_text_attachment.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_text_attachment.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_text_attachment.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/mime/test/unit/test_text_attachment.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_bug695309.js">mailnews/news/test/unit/test_bug695309.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_bug695309.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_bug695309.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_bug695309.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_bug695309.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_bug695309.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_internalUris.js">mailnews/news/test/unit/test_internalUris.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_internalUris.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_internalUris.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_internalUris.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_internalUris.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_internalUris.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_nntpPasswordFailure.js">mailnews/news/test/unit/test_nntpPasswordFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_nntpPasswordFailure.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_nntpPasswordFailure.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_nntpPasswordFailure.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_nntpPasswordFailure.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/news/test/unit/test_nntpPasswordFailure.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/test/resources/asyncTestUtils.js">mailnews/test/resources/asyncTestUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/test/resources/asyncTestUtils.js">file</a> |
<a href="/comm-central/annotate/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/test/resources/asyncTestUtils.js">annotate</a> |
<a href="/comm-central/diff/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/test/resources/asyncTestUtils.js">diff</a> |
<a href="/comm-central/comparison/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/test/resources/asyncTestUtils.js">comparison</a> |
<a href="/comm-central/log/378b9a66d495685964abbdfdd9da25879dd409ad/mailnews/test/resources/asyncTestUtils.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -3,29 +3,29 @@ load(&quot;../../../../mailnews/resources/asy</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> load(&quot;../../../../mailnews/resources/messageGenerator.js&quot;);</span>
<a href="#l1.6"></a><span id="l1.6"> load(&quot;../../../../mailnews/resources/messageModifier.js&quot;);</span>
<a href="#l1.7"></a><span id="l1.7"> load(&quot;../../../../mailnews/resources/messageInjection.js&quot;);</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> load(&quot;resources/viewWrapperTestUtils.js&quot;);</span>
<a href="#l1.10"></a><span id="l1.10"> initViewWrapperTestUtils({mode: &quot;imap&quot;, offline: false});</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-function test_real_folder_load_and_move_to_trash() {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+function* test_real_folder_load_and_move_to_trash() {</span>
<a href="#l1.14"></a><span id="l1.14">   let viewWrapper = make_view_wrapper();</span>
<a href="#l1.15"></a><span id="l1.15">   let [msgFolder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17">   yield wait_for_message_injection();</span>
<a href="#l1.18"></a><span id="l1.18">   yield async_view_open(viewWrapper, get_real_injection_folder(msgFolder));</span>
<a href="#l1.19"></a><span id="l1.19">   verify_messages_in_view(msgSet, viewWrapper);</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21">   yield async_trash_messages(msgSet);</span>
<a href="#l1.22"></a><span id="l1.22">   verify_empty_view(viewWrapper);</span>
<a href="#l1.23"></a><span id="l1.23"> }</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-function test_empty_trash() {</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+function* test_empty_trash() {</span>
<a href="#l1.27"></a><span id="l1.27">   let viewWrapper = make_view_wrapper();</span>
<a href="#l1.28"></a><span id="l1.28">   let trashHandle = get_trash_folder();</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30">   yield wait_for_async_promises();</span>
<a href="#l1.31"></a><span id="l1.31">   let trashFolder = get_real_injection_folder(trashHandle);</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33">   yield async_view_open(viewWrapper, trashFolder);</span>
<a href="#l1.34"></a><span id="l1.34"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_imapFolder.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_imapFolder.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -17,17 +17,17 @@ initViewWrapperTestUtils({mode: &quot;imap&quot;, </span>
<a href="#l2.4"></a><span id="l2.4"> /**</span>
<a href="#l2.5"></a><span id="l2.5">  * Create an empty folder, inject messages into it without triggering an</span>
<a href="#l2.6"></a><span id="l2.6">  *  updateFolder, sanity check that we believe there are no messages in the</span>
<a href="#l2.7"></a><span id="l2.7">  *  folder, then enter, making sure we immediately enter and that the view</span>
<a href="#l2.8"></a><span id="l2.8">  *  properly updates to reflect there being the right set of messages.</span>
<a href="#l2.9"></a><span id="l2.9">  * (It will fail to update if the db change listener ended up detaching itself</span>
<a href="#l2.10"></a><span id="l2.10">  *  and not reattaching correctly when the updateFolder completes.)</span>
<a href="#l2.11"></a><span id="l2.11">  */</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-function test_enter_imap_folder_requiring_update_folder_immediately() {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+function* test_enter_imap_folder_requiring_update_folder_immediately() {</span>
<a href="#l2.14"></a><span id="l2.14">   // - create the folder and wait for the IMAP op to complete</span>
<a href="#l2.15"></a><span id="l2.15">   let folderHandle = make_empty_folder();</span>
<a href="#l2.16"></a><span id="l2.16">   yield wait_for_async_promises();</span>
<a href="#l2.17"></a><span id="l2.17">   let msgFolder = get_real_injection_folder(folderHandle);</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">   // - add the messages</span>
<a href="#l2.20"></a><span id="l2.20">   let [msgSet] = make_new_sets_in_folder(folderHandle, [{count: 1}], true);</span>
<a href="#l2.21"></a><span id="l2.21">   yield wait_for_message_injection();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_logic.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_logic.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -8,17 +8,17 @@ load(&quot;../../../../mailnews/resources/mes</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> load(&quot;resources/viewWrapperTestUtils.js&quot;);</span>
<a href="#l3.6"></a><span id="l3.6"> initViewWrapperTestUtils();</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> /**</span>
<a href="#l3.9"></a><span id="l3.9">  * Verify that flipping between threading and grouped by sort settings properly</span>
<a href="#l3.10"></a><span id="l3.10">  *  clears the other flag.  (Because they're mutually exclusive, you see.)</span>
<a href="#l3.11"></a><span id="l3.11">  */</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-function test_threading_grouping_mutual_exclusion () {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+function* test_threading_grouping_mutual_exclusion () {</span>
<a href="#l3.14"></a><span id="l3.14">   let viewWrapper = make_view_wrapper();</span>
<a href="#l3.15"></a><span id="l3.15">   let folder = make_empty_folder();</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l3.18"></a><span id="l3.18">   // enter an update that will never conclude.  this is fine.</span>
<a href="#l3.19"></a><span id="l3.19">   viewWrapper.beginViewUpdate();</span>
<a href="#l3.20"></a><span id="l3.20">   viewWrapper.showThreaded = true;</span>
<a href="#l3.21"></a><span id="l3.21">   assert_true(viewWrapper.showThreaded,</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -33,17 +33,17 @@ function test_threading_grouping_mutual_</span>
<a href="#l3.23"></a><span id="l3.23">               &quot;view should be grouped by sort&quot;);</span>
<a href="#l3.24"></a><span id="l3.24"> }</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26"> /**</span>
<a href="#l3.27"></a><span id="l3.27">  * Verify that flipping between the &quot;View... Threads...&quot; menu cases supported by</span>
<a href="#l3.28"></a><span id="l3.28">  *  |showUnreadOnly| / |specialViewThreadsWithUnread| /</span>
<a href="#l3.29"></a><span id="l3.29">  *  |specialViewThreadsWithUnread| has them all be properly mutually exclusive.</span>
<a href="#l3.30"></a><span id="l3.30">  */</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-function test_threads_special_views_mutual_exclusion() {</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+function* test_threads_special_views_mutual_exclusion() {</span>
<a href="#l3.33"></a><span id="l3.33">   let viewWrapper = make_view_wrapper();</span>
<a href="#l3.34"></a><span id="l3.34">   let folder = make_empty_folder();</span>
<a href="#l3.35"></a><span id="l3.35"> </span>
<a href="#l3.36"></a><span id="l3.36">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l3.37"></a><span id="l3.37">   // enter an update that will never conclude. this is fine.</span>
<a href="#l3.38"></a><span id="l3.38">   viewWrapper.beginViewUpdate();</span>
<a href="#l3.39"></a><span id="l3.39"> </span>
<a href="#l3.40"></a><span id="l3.40">   // turn on the special view, make sure we think it took</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineat">@@ -76,17 +76,17 @@ function test_threads_special_views_mutu</span>
<a href="#l3.42"></a><span id="l3.42">   do_check_false(viewWrapper.specialViewWatchedThreadsWithUnread);</span>
<a href="#l3.43"></a><span id="l3.43"> }</span>
<a href="#l3.44"></a><span id="l3.44"> </span>
<a href="#l3.45"></a><span id="l3.45"> /**</span>
<a href="#l3.46"></a><span id="l3.46">  * Do a quick test of primary sorting to make sure we're actually changing the</span>
<a href="#l3.47"></a><span id="l3.47">  *  sort order.  (However, we are not responsible for verifying correctness of</span>
<a href="#l3.48"></a><span id="l3.48">  *  the sort.)</span>
<a href="#l3.49"></a><span id="l3.49">  */</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-function test_sort_primary() {</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+function* test_sort_primary() {</span>
<a href="#l3.52"></a><span id="l3.52">   let viewWrapper = make_view_wrapper();</span>
<a href="#l3.53"></a><span id="l3.53">   // we need to put messages in the folder or the sort logic doesn't actually</span>
<a href="#l3.54"></a><span id="l3.54">   //  save the sort state. (this is the C++ view's fault.)</span>
<a href="#l3.55"></a><span id="l3.55">   let [folder, msgSet] = make_folder_with_sets(1);</span>
<a href="#l3.56"></a><span id="l3.56"> </span>
<a href="#l3.57"></a><span id="l3.57">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l3.58"></a><span id="l3.58">   viewWrapper.sort(Ci.nsMsgViewSortType.byDate,</span>
<a href="#l3.59"></a><span id="l3.59">                    Ci.nsMsgViewSortOrder.ascending);</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineat">@@ -101,17 +101,17 @@ function test_sort_primary() {</span>
<a href="#l3.61"></a><span id="l3.61">                 &quot;sort should be by author&quot;, true);</span>
<a href="#l3.62"></a><span id="l3.62">   assert_equals(viewWrapper.dbView.sortOrder, Ci.nsMsgViewSortOrder.descending,</span>
<a href="#l3.63"></a><span id="l3.63">                 &quot;sort order should be descending&quot;, true);</span>
<a href="#l3.64"></a><span id="l3.64"> }</span>
<a href="#l3.65"></a><span id="l3.65"> </span>
<a href="#l3.66"></a><span id="l3.66"> /**</span>
<a href="#l3.67"></a><span id="l3.67">  * Verify that we handle explicit secondary sorts correctly.</span>
<a href="#l3.68"></a><span id="l3.68">  */</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-function test_sort_secondary_explicit() {</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+function* test_sort_secondary_explicit() {</span>
<a href="#l3.71"></a><span id="l3.71">   let viewWrapper = make_view_wrapper();</span>
<a href="#l3.72"></a><span id="l3.72">   // we need to put messages in the folder or the sort logic doesn't actually</span>
<a href="#l3.73"></a><span id="l3.73">   //  save the sort state. (this is the C++ view's fault.)</span>
<a href="#l3.74"></a><span id="l3.74">   let [folder, msgSet] = make_folder_with_sets(1);</span>
<a href="#l3.75"></a><span id="l3.75"> </span>
<a href="#l3.76"></a><span id="l3.76">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l3.77"></a><span id="l3.77">   viewWrapper.sort(Ci.nsMsgViewSortType.byAuthor,</span>
<a href="#l3.78"></a><span id="l3.78">                    Ci.nsMsgViewSortOrder.ascending,</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineat">@@ -139,17 +139,17 @@ function test_sort_secondary_explicit() </span>
<a href="#l3.80"></a><span id="l3.80"> /**</span>
<a href="#l3.81"></a><span id="l3.81">  * Verify that we handle implicit secondary sorts correctly.</span>
<a href="#l3.82"></a><span id="l3.82">  * An implicit secondary sort is when we sort by Y, then we sort by X, and it's</span>
<a href="#l3.83"></a><span id="l3.83">  *  okay to have the effective sort of [X, Y].  The UI has/wants this, so, uh,</span>
<a href="#l3.84"></a><span id="l3.84">  *  let's make sure we obey its assumptions unless we have gone and made the UI</span>
<a href="#l3.85"></a><span id="l3.85">  *  be explicit about these things.  We can't simply depend on the view to do</span>
<a href="#l3.86"></a><span id="l3.86">  *  this for us.  Why?  Because we re-create the view all the bloody time.</span>
<a href="#l3.87"></a><span id="l3.87">  */</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-function test_sort_secondary_implicit() {</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineplus">+function* test_sort_secondary_implicit() {</span>
<a href="#l3.90"></a><span id="l3.90">   let viewWrapper = make_view_wrapper();</span>
<a href="#l3.91"></a><span id="l3.91">   // we need to put messages in the folder or the sort logic doesn't actually</span>
<a href="#l3.92"></a><span id="l3.92">   //  save the sort state. (this is the C++ view's fault.)</span>
<a href="#l3.93"></a><span id="l3.93">   let [folder, msgSet] = make_folder_with_sets(1);</span>
<a href="#l3.94"></a><span id="l3.94"> </span>
<a href="#l3.95"></a><span id="l3.95">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l3.96"></a><span id="l3.96">   viewWrapper.magicSort(Ci.nsMsgViewSortType.bySubject,</span>
<a href="#l3.97"></a><span id="l3.97">                         Ci.nsMsgViewSortOrder.descending);</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineat">@@ -176,17 +176,17 @@ function test_sort_secondary_implicit() </span>
<a href="#l3.99"></a><span id="l3.99">  * Test that group-by-sort does not explode even if we try and get it to use</span>
<a href="#l3.100"></a><span id="l3.100">  *  sorts that are illegal for group-by-sort mode.  It is important that we</span>
<a href="#l3.101"></a><span id="l3.101">  *  test both illegal primary sorts (fixed a while back) plus illegal</span>
<a href="#l3.102"></a><span id="l3.102">  *  secondary sorts (fixing now).</span>
<a href="#l3.103"></a><span id="l3.103">  *</span>
<a href="#l3.104"></a><span id="l3.104">  * Note: Sorting changes are synchronous, but toggling grouped by sort requries</span>
<a href="#l3.105"></a><span id="l3.105">  *  a view rebuild.</span>
<a href="#l3.106"></a><span id="l3.106">  */</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-function test_sort_group_by_sort() {</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+function* test_sort_group_by_sort() {</span>
<a href="#l3.109"></a><span id="l3.109">   let viewWrapper = make_view_wrapper();</span>
<a href="#l3.110"></a><span id="l3.110">   // we need to put messages in the folder or the sort logic doesn't actually</span>
<a href="#l3.111"></a><span id="l3.111">   //  save the sort state. (this is the C++ view's fault.)</span>
<a href="#l3.112"></a><span id="l3.112">   let [folder, msgSet] = make_folder_with_sets(1);</span>
<a href="#l3.113"></a><span id="l3.113">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l3.114"></a><span id="l3.114"> </span>
<a href="#l3.115"></a><span id="l3.115">   // - start out by being in an illegal (for group-by-sort) sort mode and</span>
<a href="#l3.116"></a><span id="l3.116">   //  switch to group-by-sort.</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineat">@@ -222,17 +222,17 @@ function test_sort_group_by_sort() {</span>
<a href="#l3.118"></a><span id="l3.118">                 &quot;remaining (primary) sort type should be date&quot;);</span>
<a href="#l3.119"></a><span id="l3.119"> }</span>
<a href="#l3.120"></a><span id="l3.120"> </span>
<a href="#l3.121"></a><span id="l3.121"> /**</span>
<a href="#l3.122"></a><span id="l3.122">  * Verify that mailview changes are properly persisted but that we only use them</span>
<a href="#l3.123"></a><span id="l3.123">  *  when the listener indicates we should use them (because the widget is</span>
<a href="#l3.124"></a><span id="l3.124">  *  presumably visible).</span>
<a href="#l3.125"></a><span id="l3.125">  */</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-function test_mailviews_persistence() {</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+function* test_mailviews_persistence() {</span>
<a href="#l3.128"></a><span id="l3.128">   let viewWrapper = make_view_wrapper();</span>
<a href="#l3.129"></a><span id="l3.129">   let folder = make_empty_folder();</span>
<a href="#l3.130"></a><span id="l3.130"> </span>
<a href="#l3.131"></a><span id="l3.131">   // open the folder, ensure it is using the default mail view</span>
<a href="#l3.132"></a><span id="l3.132">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l3.133"></a><span id="l3.133">   do_check_eq(viewWrapper.mailViewIndex, MailViewConstants.kViewItemAll);</span>
<a href="#l3.134"></a><span id="l3.134"> </span>
<a href="#l3.135"></a><span id="l3.135">   // set the view so as to be persisted</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_realFolder.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_realFolder.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -16,28 +16,28 @@ initViewWrapperTestUtils();</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> /* ===== Real Folder, no features ===== */</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9"> /**</span>
<a href="#l4.10"></a><span id="l4.10">  * Open a pre-populated real folder, make sure all the messages show up.</span>
<a href="#l4.11"></a><span id="l4.11">  */</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-function test_real_folder_load() {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+function* test_real_folder_load() {</span>
<a href="#l4.14"></a><span id="l4.14">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.15"></a><span id="l4.15">   let [msgFolder, msgSet] = make_folder_with_sets(1);</span>
<a href="#l4.16"></a><span id="l4.16">   yield async_view_open(viewWrapper, msgFolder);</span>
<a href="#l4.17"></a><span id="l4.17">   verify_messages_in_view(msgSet, viewWrapper);</span>
<a href="#l4.18"></a><span id="l4.18"> }</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20"> /**</span>
<a href="#l4.21"></a><span id="l4.21">  * Open a real folder, add some messages, make sure they show up, remove some</span>
<a href="#l4.22"></a><span id="l4.22">  *  messages, make sure they go away.</span>
<a href="#l4.23"></a><span id="l4.23">  */</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-function test_real_folder_update() {</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+function* test_real_folder_update() {</span>
<a href="#l4.26"></a><span id="l4.26">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">   // start with an empty folder</span>
<a href="#l4.29"></a><span id="l4.29">   let msgFolder = make_empty_folder();</span>
<a href="#l4.30"></a><span id="l4.30">   yield async_view_open(viewWrapper, msgFolder);</span>
<a href="#l4.31"></a><span id="l4.31">   verify_empty_view(viewWrapper);</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33">   // add messages (none -&gt; some)</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineat">@@ -57,17 +57,17 @@ function test_real_folder_update() {</span>
<a href="#l4.35"></a><span id="l4.35">   verify_empty_view(viewWrapper);</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37"> }</span>
<a href="#l4.38"></a><span id="l4.38"> </span>
<a href="#l4.39"></a><span id="l4.39"> /**</span>
<a href="#l4.40"></a><span id="l4.40">  * Open a real folder, verify, open another folder, verify.  We are testing</span>
<a href="#l4.41"></a><span id="l4.41">  *  ability to change folders without exploding.</span>
<a href="#l4.42"></a><span id="l4.42">  */</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-function test_real_folder_load_after_real_folder_load() {</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+function* test_real_folder_load_after_real_folder_load() {</span>
<a href="#l4.45"></a><span id="l4.45">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.46"></a><span id="l4.46"> </span>
<a href="#l4.47"></a><span id="l4.47">   let [folderOne, setOne] = make_folder_with_sets(1);</span>
<a href="#l4.48"></a><span id="l4.48">   yield async_view_open(viewWrapper, folderOne);</span>
<a href="#l4.49"></a><span id="l4.49">   verify_messages_in_view(setOne, viewWrapper);</span>
<a href="#l4.50"></a><span id="l4.50"> </span>
<a href="#l4.51"></a><span id="l4.51">   let [folderTwo, setTwo] = make_folder_with_sets(1);</span>
<a href="#l4.52"></a><span id="l4.52">   yield async_view_open(viewWrapper, folderTwo);</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineat">@@ -80,17 +80,17 @@ function test_real_folder_load_after_rea</span>
<a href="#l4.54"></a><span id="l4.54">  *  expected outcome do this by creating the view from scratch with the view</span>
<a href="#l4.55"></a><span id="l4.55">  *  flags applied.  The view threading persistence test handles making sure</span>
<a href="#l4.56"></a><span id="l4.56">  *  that changes in threading on-the-fly work from the perspective of the</span>
<a href="#l4.57"></a><span id="l4.57">  *  bits and what not.  None of these are tests of the view implementation's</span>
<a href="#l4.58"></a><span id="l4.58">  *  threading/grouping logic, just sanity checking that we are doing the right</span>
<a href="#l4.59"></a><span id="l4.59">  *  thing.</span>
<a href="#l4.60"></a><span id="l4.60">  */</span>
<a href="#l4.61"></a><span id="l4.61"> </span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-function test_real_folder_threading_unthreaded() {</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+function* test_real_folder_threading_unthreaded() {</span>
<a href="#l4.64"></a><span id="l4.64">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.65"></a><span id="l4.65">   let folder = make_empty_folder();</span>
<a href="#l4.66"></a><span id="l4.66"> </span>
<a href="#l4.67"></a><span id="l4.67">   // create a single maximally nested thread.</span>
<a href="#l4.68"></a><span id="l4.68">   const count = 10;</span>
<a href="#l4.69"></a><span id="l4.69">   let messageSet =</span>
<a href="#l4.70"></a><span id="l4.70">     new SyntheticMessageSet(gMessageScenarioFactory.directReply(count));</span>
<a href="#l4.71"></a><span id="l4.71">   add_sets_to_folder(folder, [messageSet]);</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineat">@@ -105,17 +105,17 @@ function test_real_folder_threading_unth</span>
<a href="#l4.73"></a><span id="l4.73">                      &quot;View threaded bit should not be set.&quot;);</span>
<a href="#l4.74"></a><span id="l4.74">   assert_bit_not_set(viewWrapper._viewFlags,</span>
<a href="#l4.75"></a><span id="l4.75">                      Ci.nsMsgViewFlagsType.kGroupBySort,</span>
<a href="#l4.76"></a><span id="l4.76">                      &quot;View group-by-sort bit should not be set.&quot;);</span>
<a href="#l4.77"></a><span id="l4.77">   yield async_view_end_update(viewWrapper);</span>
<a href="#l4.78"></a><span id="l4.78">   verify_view_level_histogram({0: count}, viewWrapper);</span>
<a href="#l4.79"></a><span id="l4.79"> }</span>
<a href="#l4.80"></a><span id="l4.80"> </span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-function test_real_folder_threading_threaded() {</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+function* test_real_folder_threading_threaded() {</span>
<a href="#l4.83"></a><span id="l4.83">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.84"></a><span id="l4.84">   let folder = make_empty_folder();</span>
<a href="#l4.85"></a><span id="l4.85"> </span>
<a href="#l4.86"></a><span id="l4.86">   // create a single maximally nested thread.</span>
<a href="#l4.87"></a><span id="l4.87">   const count = 10;</span>
<a href="#l4.88"></a><span id="l4.88">   let messageSet =</span>
<a href="#l4.89"></a><span id="l4.89">     new SyntheticMessageSet(gMessageScenarioFactory.directReply(count));</span>
<a href="#l4.90"></a><span id="l4.90">   add_sets_to_folder(folder, [messageSet]);</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineat">@@ -138,17 +138,17 @@ function test_real_folder_threading_thre</span>
<a href="#l4.92"></a><span id="l4.92">   verify_view_row_at_index_is_container(viewWrapper, 0);</span>
<a href="#l4.93"></a><span id="l4.93">   // do the histogram test to verify threading...</span>
<a href="#l4.94"></a><span id="l4.94">   let expectedHisto = {};</span>
<a href="#l4.95"></a><span id="l4.95">   for (let i = 0; i &lt; count; i++)</span>
<a href="#l4.96"></a><span id="l4.96">     expectedHisto[i] = 1;</span>
<a href="#l4.97"></a><span id="l4.97">   verify_view_level_histogram(expectedHisto, viewWrapper);</span>
<a href="#l4.98"></a><span id="l4.98"> }</span>
<a href="#l4.99"></a><span id="l4.99"> </span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-function test_real_folder_threading_grouped_by_sort() {</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+function* test_real_folder_threading_grouped_by_sort() {</span>
<a href="#l4.102"></a><span id="l4.102">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.103"></a><span id="l4.103"> </span>
<a href="#l4.104"></a><span id="l4.104">   // create some messages that belong to the 'in this week' bucket when sorting</span>
<a href="#l4.105"></a><span id="l4.105">   //  by date and grouping by date.</span>
<a href="#l4.106"></a><span id="l4.106">   const count = 5;</span>
<a href="#l4.107"></a><span id="l4.107">   let [folder, messageSet] = make_folder_with_sets([</span>
<a href="#l4.108"></a><span id="l4.108">     {count: count, age: {days: 2}, age_incr: {mins: 1}}]);</span>
<a href="#l4.109"></a><span id="l4.109"> </span>
<a href="#l4.110"></a><span id="l4.110" class="difflineat">@@ -174,17 +174,17 @@ function test_real_folder_threading_grou</span>
<a href="#l4.111"></a><span id="l4.111">   // and make sure the first dude is a dummy</span>
<a href="#l4.112"></a><span id="l4.112">   verify_view_row_at_index_is_dummy(viewWrapper, 0);</span>
<a href="#l4.113"></a><span id="l4.113"> }</span>
<a href="#l4.114"></a><span id="l4.114"> </span>
<a href="#l4.115"></a><span id="l4.115"> /**</span>
<a href="#l4.116"></a><span id="l4.116">  * Verify that we the threading modes are persisted.  We are only checking</span>
<a href="#l4.117"></a><span id="l4.117">  *  flags here; we trust the previous tests to have done their job.</span>
<a href="#l4.118"></a><span id="l4.118">  */</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineminus">-function test_real_folder_threading_persistence() {</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+function* test_real_folder_threading_persistence() {</span>
<a href="#l4.121"></a><span id="l4.121">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.122"></a><span id="l4.122">   let folder = make_empty_folder();</span>
<a href="#l4.123"></a><span id="l4.123"> </span>
<a href="#l4.124"></a><span id="l4.124">   // create a single maximally nested thread.</span>
<a href="#l4.125"></a><span id="l4.125">   const count = 10;</span>
<a href="#l4.126"></a><span id="l4.126">   let messageSet =</span>
<a href="#l4.127"></a><span id="l4.127">     new SyntheticMessageSet(gMessageScenarioFactory.directReply(count));</span>
<a href="#l4.128"></a><span id="l4.128">   add_sets_to_folder(folder, [messageSet]);</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineat">@@ -263,17 +263,17 @@ function test_real_folder_threading_pers</span>
<a href="#l4.130"></a><span id="l4.130">  *  easily testable at this time.</span>
<a href="#l4.131"></a><span id="l4.131">  */</span>
<a href="#l4.132"></a><span id="l4.132"> </span>
<a href="#l4.133"></a><span id="l4.133"> /**</span>
<a href="#l4.134"></a><span id="l4.134">  * Test the kUnreadOnly flag usage.  This functionality is equivalent to the</span>
<a href="#l4.135"></a><span id="l4.135">  *  mailview kViewItemUnread case, so it uses roughly the same test as</span>
<a href="#l4.136"></a><span id="l4.136">  *  test_real_folder_mail_views_unread.</span>
<a href="#l4.137"></a><span id="l4.137">  */</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineminus">-function test_real_folder_flags_show_unread() {</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineplus">+function* test_real_folder_flags_show_unread() {</span>
<a href="#l4.140"></a><span id="l4.140">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.141"></a><span id="l4.141"> </span>
<a href="#l4.142"></a><span id="l4.142">   let [folder, setOne, setTwo] = make_folder_with_sets(2);</span>
<a href="#l4.143"></a><span id="l4.143"> </span>
<a href="#l4.144"></a><span id="l4.144">   // everything is unread to start with! #1</span>
<a href="#l4.145"></a><span id="l4.145">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l4.146"></a><span id="l4.146">   viewWrapper.beginViewUpdate();</span>
<a href="#l4.147"></a><span id="l4.147">   viewWrapper.showUnreadOnly = true;</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineat">@@ -309,17 +309,17 @@ function test_real_folder_flags_show_unr</span>
<a href="#l4.149"></a><span id="l4.149">  *    requires refreshing the view (unless the message has been deleted).</span>
<a href="#l4.150"></a><span id="l4.150">  */</span>
<a href="#l4.151"></a><span id="l4.151"> </span>
<a href="#l4.152"></a><span id="l4.152"> /**</span>
<a href="#l4.153"></a><span id="l4.153">  * Test the kViewItemUnread mail-view case.  This functionality is equivalent</span>
<a href="#l4.154"></a><span id="l4.154">  *  to the kUnreadOnly view flag case, so it uses roughly the same test as</span>
<a href="#l4.155"></a><span id="l4.155">  *  test_real_folder_flags_show_unread.</span>
<a href="#l4.156"></a><span id="l4.156">  */</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">-function test_real_folder_mail_views_unread() {</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineplus">+function* test_real_folder_mail_views_unread() {</span>
<a href="#l4.159"></a><span id="l4.159">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.160"></a><span id="l4.160"> </span>
<a href="#l4.161"></a><span id="l4.161">   let [folder, setOne, setTwo] = make_folder_with_sets(2);</span>
<a href="#l4.162"></a><span id="l4.162"> </span>
<a href="#l4.163"></a><span id="l4.163">   // everything is unread to start with! #1</span>
<a href="#l4.164"></a><span id="l4.164">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l4.165"></a><span id="l4.165">   yield async_view_set_mail_view(viewWrapper, MailViewConstants.kViewItemUnread);</span>
<a href="#l4.166"></a><span id="l4.166">   verify_messages_in_view([setOne, setTwo], viewWrapper);</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineat">@@ -334,17 +334,17 @@ function test_real_folder_mail_views_unr</span>
<a href="#l4.168"></a><span id="l4.168">   verify_messages_in_view([setOne, setThree], viewWrapper);</span>
<a href="#l4.169"></a><span id="l4.169"> </span>
<a href="#l4.170"></a><span id="l4.170">   // make those things un-read again. #2</span>
<a href="#l4.171"></a><span id="l4.171">   setTwo.setRead(false);</span>
<a href="#l4.172"></a><span id="l4.172">   yield async_view_refresh(viewWrapper); // QUICKSEARCH-VIEW-LIMITATION-REMOVE</span>
<a href="#l4.173"></a><span id="l4.173">   verify_messages_in_view([setOne, setTwo, setThree], viewWrapper);</span>
<a href="#l4.174"></a><span id="l4.174"> }</span>
<a href="#l4.175"></a><span id="l4.175"> </span>
<a href="#l4.176"></a><span id="l4.176" class="difflineminus">-function test_real_folder_mail_views_tags() {</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineplus">+function* test_real_folder_mail_views_tags() {</span>
<a href="#l4.178"></a><span id="l4.178">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.179"></a><span id="l4.179"> </span>
<a href="#l4.180"></a><span id="l4.180">   // setup the initial set with the tag</span>
<a href="#l4.181"></a><span id="l4.181">   let [folder, setOne, setTwo] = make_folder_with_sets(2);</span>
<a href="#l4.182"></a><span id="l4.182">   setOne.addTag('$label1');</span>
<a href="#l4.183"></a><span id="l4.183"> </span>
<a href="#l4.184"></a><span id="l4.184">   // open, apply mail view constraint, see those messages</span>
<a href="#l4.185"></a><span id="l4.185">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineat">@@ -374,17 +374,17 @@ function test_real_folder_mail_views_not</span>
<a href="#l4.187"></a><span id="l4.187"> }</span>
<a href="#l4.188"></a><span id="l4.188"> </span>
<a href="#l4.189"></a><span id="l4.189"> function test_real_folder_mail_views_custom_people_i_know() {</span>
<a href="#l4.190"></a><span id="l4.190">   // blurg. address book.</span>
<a href="#l4.191"></a><span id="l4.191">   punt();</span>
<a href="#l4.192"></a><span id="l4.192"> }</span>
<a href="#l4.193"></a><span id="l4.193"> </span>
<a href="#l4.194"></a><span id="l4.194"> // recent mail = less than 1 day</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineminus">-function test_real_folder_mail_views_custom_recent_mail() {</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineplus">+function* test_real_folder_mail_views_custom_recent_mail() {</span>
<a href="#l4.197"></a><span id="l4.197">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.198"></a><span id="l4.198"> </span>
<a href="#l4.199"></a><span id="l4.199">   // create a set that meets the threshold and a set that does not</span>
<a href="#l4.200"></a><span id="l4.200">   let [folder, setRecent, setOld] = make_folder_with_sets([</span>
<a href="#l4.201"></a><span id="l4.201">     {age: {mins: 0}},</span>
<a href="#l4.202"></a><span id="l4.202">     {age: {days: 2}, age_incr: {mins: 1}},</span>
<a href="#l4.203"></a><span id="l4.203">   ]);</span>
<a href="#l4.204"></a><span id="l4.204"> </span>
<a href="#l4.205"></a><span id="l4.205" class="difflineat">@@ -401,17 +401,17 @@ function test_real_folder_mail_views_cus</span>
<a href="#l4.206"></a><span id="l4.206">   // make sure that all we see is our previous recent set and our new recent set</span>
<a href="#l4.207"></a><span id="l4.207">   verify_messages_in_view([setRecent, setMoreRecent], viewWrapper);</span>
<a href="#l4.208"></a><span id="l4.208"> </span>
<a href="#l4.209"></a><span id="l4.209">   // we aren't going to mess with the system clock, so no #3.</span>
<a href="#l4.210"></a><span id="l4.210">   // (we are assuming that the underlying code handles message deletion.  also,</span>
<a href="#l4.211"></a><span id="l4.211">   //  we are taking the position that message timestamps should not change.)</span>
<a href="#l4.212"></a><span id="l4.212"> }</span>
<a href="#l4.213"></a><span id="l4.213"> </span>
<a href="#l4.214"></a><span id="l4.214" class="difflineminus">-function test_real_folder_mail_views_custom_last_5_days() {</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineplus">+function* test_real_folder_mail_views_custom_last_5_days() {</span>
<a href="#l4.216"></a><span id="l4.216">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.217"></a><span id="l4.217"> </span>
<a href="#l4.218"></a><span id="l4.218">   // create a set that meets the threshold and a set that does not</span>
<a href="#l4.219"></a><span id="l4.219">   let [folder, setRecent, setOld] = make_folder_with_sets([</span>
<a href="#l4.220"></a><span id="l4.220">     {age: {days: 2}, age_incr: {mins: 1}},</span>
<a href="#l4.221"></a><span id="l4.221">     {age: {days: 6}, age_incr: {mins: 1}},</span>
<a href="#l4.222"></a><span id="l4.222">   ]);</span>
<a href="#l4.223"></a><span id="l4.223"> </span>
<a href="#l4.224"></a><span id="l4.224" class="difflineat">@@ -428,17 +428,17 @@ function test_real_folder_mail_views_cus</span>
<a href="#l4.225"></a><span id="l4.225">   // make sure that all we see is our previous recent set and our new recent set</span>
<a href="#l4.226"></a><span id="l4.226">   verify_messages_in_view([setRecent, setMoreRecent], viewWrapper);</span>
<a href="#l4.227"></a><span id="l4.227"> </span>
<a href="#l4.228"></a><span id="l4.228">   // we aren't going to mess with the system clock, so no #3.</span>
<a href="#l4.229"></a><span id="l4.229">   // (we are assuming that the underlying code handles message deletion.  also,</span>
<a href="#l4.230"></a><span id="l4.230">   //  we are taking the position that message timestamps should not change.)</span>
<a href="#l4.231"></a><span id="l4.231"> }</span>
<a href="#l4.232"></a><span id="l4.232"> </span>
<a href="#l4.233"></a><span id="l4.233" class="difflineminus">-function test_real_folder_mail_views_custom_not_junk() {</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineplus">+function* test_real_folder_mail_views_custom_not_junk() {</span>
<a href="#l4.235"></a><span id="l4.235">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.236"></a><span id="l4.236"> </span>
<a href="#l4.237"></a><span id="l4.237">   let [folder, setJunk, setNotJunk] = make_folder_with_sets(2);</span>
<a href="#l4.238"></a><span id="l4.238">   setJunk.setJunk(true);</span>
<a href="#l4.239"></a><span id="l4.239">   setNotJunk.setJunk(false);</span>
<a href="#l4.240"></a><span id="l4.240"> </span>
<a href="#l4.241"></a><span id="l4.241">   // open, see non-junk messages. #1</span>
<a href="#l4.242"></a><span id="l4.242">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineat">@@ -452,17 +452,17 @@ function test_real_folder_mail_views_cus</span>
<a href="#l4.244"></a><span id="l4.244">   verify_messages_in_view([setNotJunk, setFlippy], viewWrapper);</span>
<a href="#l4.245"></a><span id="l4.245"> </span>
<a href="#l4.246"></a><span id="l4.246">   // oops! they should be junk! #3</span>
<a href="#l4.247"></a><span id="l4.247">   setFlippy.setJunk(true);</span>
<a href="#l4.248"></a><span id="l4.248">   yield async_view_refresh(viewWrapper);</span>
<a href="#l4.249"></a><span id="l4.249">   verify_messages_in_view(setNotJunk, viewWrapper);</span>
<a href="#l4.250"></a><span id="l4.250"> }</span>
<a href="#l4.251"></a><span id="l4.251"> </span>
<a href="#l4.252"></a><span id="l4.252" class="difflineminus">-function test_real_folder_mail_views_custom_has_attachments() {</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineplus">+function* test_real_folder_mail_views_custom_has_attachments() {</span>
<a href="#l4.254"></a><span id="l4.254">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.255"></a><span id="l4.255"> </span>
<a href="#l4.256"></a><span id="l4.256">   let attachSetDef = {attachments: [{filename: 'foo.png',</span>
<a href="#l4.257"></a><span id="l4.257">                                      contentType: 'image/png',</span>
<a href="#l4.258"></a><span id="l4.258">                                      encoding: 'base64', charset: null,</span>
<a href="#l4.259"></a><span id="l4.259">                                      body: 'YWJj\n', format: null}]};</span>
<a href="#l4.260"></a><span id="l4.260">   let noAttachSetDef = {};</span>
<a href="#l4.261"></a><span id="l4.261"> </span>
<a href="#l4.262"></a><span id="l4.262" class="difflineat">@@ -474,17 +474,17 @@ function test_real_folder_mail_views_cus</span>
<a href="#l4.263"></a><span id="l4.263"> </span>
<a href="#l4.264"></a><span id="l4.264">   let [setMoreAttach, setMoreNoAttach] =</span>
<a href="#l4.265"></a><span id="l4.265">     make_new_sets_in_folder(folder, [attachSetDef, noAttachSetDef]);</span>
<a href="#l4.266"></a><span id="l4.266">   verify_messages_in_view([setAttach, setMoreAttach], viewWrapper);</span>
<a href="#l4.267"></a><span id="l4.267"> }</span>
<a href="#l4.268"></a><span id="l4.268"> </span>
<a href="#l4.269"></a><span id="l4.269"> /* ===== Real Folder, Special Views ===== */</span>
<a href="#l4.270"></a><span id="l4.270"> </span>
<a href="#l4.271"></a><span id="l4.271" class="difflineminus">-function test_real_folder_special_views_threads_with_unread() {</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineplus">+function* test_real_folder_special_views_threads_with_unread() {</span>
<a href="#l4.273"></a><span id="l4.273">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.274"></a><span id="l4.274">   let folder = make_empty_folder();</span>
<a href="#l4.275"></a><span id="l4.275"> </span>
<a href="#l4.276"></a><span id="l4.276">   // create two maximally nested threads and add them to the folder.</span>
<a href="#l4.277"></a><span id="l4.277">   const count = 10;</span>
<a href="#l4.278"></a><span id="l4.278">   let setThreadOne =</span>
<a href="#l4.279"></a><span id="l4.279">     new SyntheticMessageSet(gMessageScenarioFactory.directReply(count));</span>
<a href="#l4.280"></a><span id="l4.280">   let setThreadTwo =</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineat">@@ -520,32 +520,32 @@ function test_real_folder_special_views_</span>
<a href="#l4.282"></a><span id="l4.282">   yield async_view_refresh(viewWrapper);</span>
<a href="#l4.283"></a><span id="l4.283">   verify_messages_in_view([setThreadOne, setThreadTwo], viewWrapper);</span>
<a href="#l4.284"></a><span id="l4.284"> }</span>
<a href="#l4.285"></a><span id="l4.285"> </span>
<a href="#l4.286"></a><span id="l4.286"> /**</span>
<a href="#l4.287"></a><span id="l4.287">  * Make sure that we restore special views from their persisted state when</span>
<a href="#l4.288"></a><span id="l4.288">  *  opening the view.</span>
<a href="#l4.289"></a><span id="l4.289">  */</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineminus">-function test_real_folder_special_views_persist() {</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineplus">+function* test_real_folder_special_views_persist() {</span>
<a href="#l4.292"></a><span id="l4.292">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.293"></a><span id="l4.293">   let folder = make_empty_folder();</span>
<a href="#l4.294"></a><span id="l4.294"> </span>
<a href="#l4.295"></a><span id="l4.295">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l4.296"></a><span id="l4.296">   viewWrapper.beginViewUpdate();</span>
<a href="#l4.297"></a><span id="l4.297">   viewWrapper.specialViewThreadsWithUnread = true;</span>
<a href="#l4.298"></a><span id="l4.298">   yield async_view_end_update(viewWrapper);</span>
<a href="#l4.299"></a><span id="l4.299">   viewWrapper.close();</span>
<a href="#l4.300"></a><span id="l4.300"> </span>
<a href="#l4.301"></a><span id="l4.301">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l4.302"></a><span id="l4.302">   assert_true(viewWrapper.specialViewThreadsWithUnread,</span>
<a href="#l4.303"></a><span id="l4.303">               &quot;We should be in threads-with-unread special view mode.&quot;);</span>
<a href="#l4.304"></a><span id="l4.304"> }</span>
<a href="#l4.305"></a><span id="l4.305"> </span>
<a href="#l4.306"></a><span id="l4.306" class="difflineminus">-function test_real_folder_mark_read_on_exit() {</span>
<a href="#l4.307"></a><span id="l4.307" class="difflineplus">+function* test_real_folder_mark_read_on_exit() {</span>
<a href="#l4.308"></a><span id="l4.308">   // set a pref so that the local folders account will think we should</span>
<a href="#l4.309"></a><span id="l4.309">   // mark messages read when leaving the folder.</span>
<a href="#l4.310"></a><span id="l4.310">   Services.prefs.setBoolPref(&quot;mailnews.mark_message_read.none&quot;, true);</span>
<a href="#l4.311"></a><span id="l4.311"> </span>
<a href="#l4.312"></a><span id="l4.312">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.313"></a><span id="l4.313">   let folder = make_empty_folder();</span>
<a href="#l4.314"></a><span id="l4.314">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l4.315"></a><span id="l4.315"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_virtualFolder.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_virtualFolder.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -20,17 +20,17 @@ load(&quot;../../../../mailnews/resources/mes</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> load(&quot;resources/viewWrapperTestUtils.js&quot;);</span>
<a href="#l5.6"></a><span id="l5.6"> initViewWrapperTestUtils();</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> /**</span>
<a href="#l5.9"></a><span id="l5.9">  * Make sure we open a virtual folder backed by a single underlying folder</span>
<a href="#l5.10"></a><span id="l5.10">  *  correctly; no constraints.</span>
<a href="#l5.11"></a><span id="l5.11">  */</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-function test_virtual_folder_single_load_no_pred() {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+function* test_virtual_folder_single_load_no_pred() {</span>
<a href="#l5.14"></a><span id="l5.14">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16">   let [folderOne, setOne] = make_folder_with_sets(1);</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18">   let virtFolder = make_virtual_folder([folderOne], {});</span>
<a href="#l5.19"></a><span id="l5.19">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21">   do_check_true(viewWrapper.isVirtual);</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -42,17 +42,17 @@ function test_virtual_folder_single_load</span>
<a href="#l5.23"></a><span id="l5.23">   verify_messages_in_view(setOne, viewWrapper);</span>
<a href="#l5.24"></a><span id="l5.24">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l5.25"></a><span id="l5.25"> }</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27"> /**</span>
<a href="#l5.28"></a><span id="l5.28">  * Make sure we open a virtual folder backed by a single underlying folder</span>
<a href="#l5.29"></a><span id="l5.29">  *  correctly; one constraint.</span>
<a href="#l5.30"></a><span id="l5.30">  */</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-function test_virtual_folder_single_load_simple_pred() {</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+function* test_virtual_folder_single_load_simple_pred() {</span>
<a href="#l5.33"></a><span id="l5.33">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35">   let [folderOne, oneSubjFoo, oneNopers] = make_folder_with_sets([</span>
<a href="#l5.36"></a><span id="l5.36">     {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l5.37"></a><span id="l5.37"> </span>
<a href="#l5.38"></a><span id="l5.38">   let virtFolder = make_virtual_folder([folderOne],</span>
<a href="#l5.39"></a><span id="l5.39">                                        {subject: &quot;foo&quot;});</span>
<a href="#l5.40"></a><span id="l5.40">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineat">@@ -60,17 +60,17 @@ function test_virtual_folder_single_load</span>
<a href="#l5.42"></a><span id="l5.42">   verify_messages_in_view(oneSubjFoo, viewWrapper);</span>
<a href="#l5.43"></a><span id="l5.43">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l5.44"></a><span id="l5.44"> }</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46"> /**</span>
<a href="#l5.47"></a><span id="l5.47">  * Make sure we open a virtual folder backed by a single underlying folder</span>
<a href="#l5.48"></a><span id="l5.48">  *  correctly; two constraints ANDed together.</span>
<a href="#l5.49"></a><span id="l5.49">  */</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-function test_virtual_folder_single_load_complex_pred() {</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+function* test_virtual_folder_single_load_complex_pred() {</span>
<a href="#l5.52"></a><span id="l5.52">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.53"></a><span id="l5.53"> </span>
<a href="#l5.54"></a><span id="l5.54">   let whoBar = make_person_with_word_in_name(&quot;bar&quot;);</span>
<a href="#l5.55"></a><span id="l5.55"> </span>
<a href="#l5.56"></a><span id="l5.56">   let [folderOne, oneSubjOnly, oneFromOnly, oneBoth, oneNone] =</span>
<a href="#l5.57"></a><span id="l5.57">     make_folder_with_sets([{subject: &quot;foo&quot;}, {from: whoBar},</span>
<a href="#l5.58"></a><span id="l5.58">                            {subject: &quot;foo&quot;, from: whoBar}, {}]);</span>
<a href="#l5.59"></a><span id="l5.59"> </span>
<a href="#l5.60"></a><span id="l5.60" class="difflineat">@@ -83,17 +83,17 @@ function test_virtual_folder_single_load</span>
<a href="#l5.61"></a><span id="l5.61">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l5.62"></a><span id="l5.62"> }</span>
<a href="#l5.63"></a><span id="l5.63"> </span>
<a href="#l5.64"></a><span id="l5.64"> /**</span>
<a href="#l5.65"></a><span id="l5.65">  * Open a single-backed virtual folder, verify, open another single-backed</span>
<a href="#l5.66"></a><span id="l5.66">  *  virtual folder, verify.  We are testing our ability to change folders</span>
<a href="#l5.67"></a><span id="l5.67">  *  without exploding.</span>
<a href="#l5.68"></a><span id="l5.68">  */</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-function test_virtual_folder_single_load_after_load() {</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+function* test_virtual_folder_single_load_after_load() {</span>
<a href="#l5.71"></a><span id="l5.71">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.72"></a><span id="l5.72"> </span>
<a href="#l5.73"></a><span id="l5.73">   let [folderOne, oneSubjFoo, oneNopers] = make_folder_with_sets([</span>
<a href="#l5.74"></a><span id="l5.74">     {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l5.75"></a><span id="l5.75">   let virtOne = make_virtual_folder([folderOne],</span>
<a href="#l5.76"></a><span id="l5.76">                                     {subject: &quot;foo&quot;});</span>
<a href="#l5.77"></a><span id="l5.77">   yield async_view_open(viewWrapper, virtOne);</span>
<a href="#l5.78"></a><span id="l5.78">   verify_messages_in_view([oneSubjFoo], viewWrapper);</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineat">@@ -108,34 +108,34 @@ function test_virtual_folder_single_load</span>
<a href="#l5.80"></a><span id="l5.80">   virtOne.parent.propagateDelete(virtOne, true, null);</span>
<a href="#l5.81"></a><span id="l5.81">   virtTwo.parent.propagateDelete(virtTwo, true, null);</span>
<a href="#l5.82"></a><span id="l5.82"> }</span>
<a href="#l5.83"></a><span id="l5.83"> </span>
<a href="#l5.84"></a><span id="l5.84"> /**</span>
<a href="#l5.85"></a><span id="l5.85">  * Make sure we open a virtual folder backed by multiple underlying folders</span>
<a href="#l5.86"></a><span id="l5.86">  *  correctly; no constraints.</span>
<a href="#l5.87"></a><span id="l5.87">  */</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-function test_virtual_folder_multi_load_no_pred() {</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+function* test_virtual_folder_multi_load_no_pred() {</span>
<a href="#l5.90"></a><span id="l5.90">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.91"></a><span id="l5.91"> </span>
<a href="#l5.92"></a><span id="l5.92">   let [folderOne, setOne] = make_folder_with_sets(1);</span>
<a href="#l5.93"></a><span id="l5.93">   let [folderTwo, setTwo] = make_folder_with_sets(1);</span>
<a href="#l5.94"></a><span id="l5.94"> </span>
<a href="#l5.95"></a><span id="l5.95">   let virtFolder = make_virtual_folder([folderOne, folderTwo], {});</span>
<a href="#l5.96"></a><span id="l5.96">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l5.97"></a><span id="l5.97"> </span>
<a href="#l5.98"></a><span id="l5.98">   verify_messages_in_view([setOne, setTwo], viewWrapper);</span>
<a href="#l5.99"></a><span id="l5.99">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l5.100"></a><span id="l5.100"> }</span>
<a href="#l5.101"></a><span id="l5.101"> </span>
<a href="#l5.102"></a><span id="l5.102"> /**</span>
<a href="#l5.103"></a><span id="l5.103">  * Make sure the sort order of a virtual folder backed by multiple underlying</span>
<a href="#l5.104"></a><span id="l5.104">  * folders is persistent.</span>
<a href="#l5.105"></a><span id="l5.105">  */</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-function test_virtual_folder_multi_sortorder_persistence() {</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+function* test_virtual_folder_multi_sortorder_persistence() {</span>
<a href="#l5.108"></a><span id="l5.108">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.109"></a><span id="l5.109"> </span>
<a href="#l5.110"></a><span id="l5.110">   let [folderOne, setOne] = make_folder_with_sets(1);</span>
<a href="#l5.111"></a><span id="l5.111">   let [folderTwo, setTwo] = make_folder_with_sets(1);</span>
<a href="#l5.112"></a><span id="l5.112"> </span>
<a href="#l5.113"></a><span id="l5.113">   let virtFolder = make_virtual_folder([folderOne, folderTwo], {});</span>
<a href="#l5.114"></a><span id="l5.114">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l5.115"></a><span id="l5.115"> </span>
<a href="#l5.116"></a><span id="l5.116" class="difflineat">@@ -152,17 +152,17 @@ function test_virtual_folder_multi_sorto</span>
<a href="#l5.117"></a><span id="l5.117">                &quot;should have remembered sort order.&quot;);</span>
<a href="#l5.118"></a><span id="l5.118">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l5.119"></a><span id="l5.119"> }</span>
<a href="#l5.120"></a><span id="l5.120"> </span>
<a href="#l5.121"></a><span id="l5.121"> /**</span>
<a href="#l5.122"></a><span id="l5.122">  * Make sure we open a virtual folder backed by multiple underlying folders</span>
<a href="#l5.123"></a><span id="l5.123">  *  correctly; one constraint.</span>
<a href="#l5.124"></a><span id="l5.124">  */</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineminus">-function test_virtual_folder_multi_load_simple_pred() {</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineplus">+function* test_virtual_folder_multi_load_simple_pred() {</span>
<a href="#l5.127"></a><span id="l5.127">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.128"></a><span id="l5.128"> </span>
<a href="#l5.129"></a><span id="l5.129">   let [folderOne, oneSubjFoo, oneNopers] = make_folder_with_sets([</span>
<a href="#l5.130"></a><span id="l5.130">     {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l5.131"></a><span id="l5.131">   let [folderTwo, twoSubjFoo, twoNopers] = make_folder_with_sets([</span>
<a href="#l5.132"></a><span id="l5.132">     {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l5.133"></a><span id="l5.133"> </span>
<a href="#l5.134"></a><span id="l5.134">   let virtFolder = make_virtual_folder([folderOne, folderTwo],</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineat">@@ -172,17 +172,17 @@ function test_virtual_folder_multi_load_</span>
<a href="#l5.136"></a><span id="l5.136">   verify_messages_in_view([oneSubjFoo, twoSubjFoo], viewWrapper);</span>
<a href="#l5.137"></a><span id="l5.137">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l5.138"></a><span id="l5.138"> }</span>
<a href="#l5.139"></a><span id="l5.139"> </span>
<a href="#l5.140"></a><span id="l5.140"> /**</span>
<a href="#l5.141"></a><span id="l5.141">  * Make sure we open a virtual folder backed by multiple underlying folders</span>
<a href="#l5.142"></a><span id="l5.142">  *  correctly; two constraints ANDed together.</span>
<a href="#l5.143"></a><span id="l5.143">  */</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineminus">-function test_virtual_folder_multi_load_complex_pred() {</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+function* test_virtual_folder_multi_load_complex_pred() {</span>
<a href="#l5.146"></a><span id="l5.146">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.147"></a><span id="l5.147"> </span>
<a href="#l5.148"></a><span id="l5.148">   let whoBar = make_person_with_word_in_name(&quot;bar&quot;);</span>
<a href="#l5.149"></a><span id="l5.149"> </span>
<a href="#l5.150"></a><span id="l5.150">   let [folderOne, oneSubjOnly, oneFromOnly, oneBoth, oneNone] =</span>
<a href="#l5.151"></a><span id="l5.151">     make_folder_with_sets([{subject: &quot;foo&quot;}, {from: whoBar},</span>
<a href="#l5.152"></a><span id="l5.152">                            {subject: &quot;foo&quot;, from: whoBar}, {}]);</span>
<a href="#l5.153"></a><span id="l5.153">   let [folderTwo, twoSubjOnly, twoFromOnly, twoBoth, twoNone] =</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineat">@@ -193,33 +193,33 @@ function test_virtual_folder_multi_load_</span>
<a href="#l5.155"></a><span id="l5.155">                                        {subject: &quot;foo&quot;, from: &quot;bar&quot;},</span>
<a href="#l5.156"></a><span id="l5.156">                                        /* and? */ true);</span>
<a href="#l5.157"></a><span id="l5.157">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l5.158"></a><span id="l5.158"> </span>
<a href="#l5.159"></a><span id="l5.159">   verify_messages_in_view([oneBoth, twoBoth], viewWrapper);</span>
<a href="#l5.160"></a><span id="l5.160">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l5.161"></a><span id="l5.161"> }</span>
<a href="#l5.162"></a><span id="l5.162"> </span>
<a href="#l5.163"></a><span id="l5.163" class="difflineminus">-function test_virtual_folder_multi_load_alotta_folders_no_pred() {</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineplus">+function* test_virtual_folder_multi_load_alotta_folders_no_pred() {</span>
<a href="#l5.165"></a><span id="l5.165">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.166"></a><span id="l5.166"> </span>
<a href="#l5.167"></a><span id="l5.167">   const folderCount = 4;</span>
<a href="#l5.168"></a><span id="l5.168">   const messageCount = 64;</span>
<a href="#l5.169"></a><span id="l5.169"> </span>
<a href="#l5.170"></a><span id="l5.170">   let [folders, setOne] = make_folders_with_sets(folderCount,</span>
<a href="#l5.171"></a><span id="l5.171">                                                  [{count: messageCount}]);</span>
<a href="#l5.172"></a><span id="l5.172"> </span>
<a href="#l5.173"></a><span id="l5.173">   let virtFolder = make_virtual_folder(folders, {});</span>
<a href="#l5.174"></a><span id="l5.174">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l5.175"></a><span id="l5.175"> </span>
<a href="#l5.176"></a><span id="l5.176">   verify_messages_in_view([setOne], viewWrapper);</span>
<a href="#l5.177"></a><span id="l5.177">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l5.178"></a><span id="l5.178"> }</span>
<a href="#l5.179"></a><span id="l5.179"> </span>
<a href="#l5.180"></a><span id="l5.180" class="difflineminus">-function test_virtual_folder_multi_load_alotta_folders_simple_pred() {</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineplus">+function* test_virtual_folder_multi_load_alotta_folders_simple_pred() {</span>
<a href="#l5.182"></a><span id="l5.182">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.183"></a><span id="l5.183"> </span>
<a href="#l5.184"></a><span id="l5.184">   const folderCount = 16;</span>
<a href="#l5.185"></a><span id="l5.185">   const messageCount = 256;</span>
<a href="#l5.186"></a><span id="l5.186"> </span>
<a href="#l5.187"></a><span id="l5.187">   let [folders, setOne] = make_folders_with_sets(folderCount,</span>
<a href="#l5.188"></a><span id="l5.188">     [{subject: &quot;foo&quot;, count: messageCount}]);</span>
<a href="#l5.189"></a><span id="l5.189"> </span>
<a href="#l5.190"></a><span id="l5.190" class="difflineat">@@ -229,17 +229,17 @@ function test_virtual_folder_multi_load_</span>
<a href="#l5.191"></a><span id="l5.191">   verify_messages_in_view([setOne], viewWrapper);</span>
<a href="#l5.192"></a><span id="l5.192">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l5.193"></a><span id="l5.193"> }</span>
<a href="#l5.194"></a><span id="l5.194"> </span>
<a href="#l5.195"></a><span id="l5.195"> /**</span>
<a href="#l5.196"></a><span id="l5.196">  * Make sure that opening a virtual folder backed by multiple real folders, then</span>
<a href="#l5.197"></a><span id="l5.197">  *  opening another virtual folder of the same variety works without explosions.</span>
<a href="#l5.198"></a><span id="l5.198">  */</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineminus">-function test_virtual_folder_multi_load_after_load() {</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineplus">+function* test_virtual_folder_multi_load_after_load() {</span>
<a href="#l5.201"></a><span id="l5.201">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.202"></a><span id="l5.202"> </span>
<a href="#l5.203"></a><span id="l5.203">   let [foldersOne, oneSubjFoo, oneNopers] = make_folders_with_sets(2, [</span>
<a href="#l5.204"></a><span id="l5.204">     {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l5.205"></a><span id="l5.205">   let virtOne = make_virtual_folder(foldersOne, {subject: &quot;foo&quot;});</span>
<a href="#l5.206"></a><span id="l5.206">   yield async_view_open(viewWrapper, virtOne);</span>
<a href="#l5.207"></a><span id="l5.207">   verify_messages_in_view([oneSubjFoo], viewWrapper);</span>
<a href="#l5.208"></a><span id="l5.208"> </span>
<a href="#l5.209"></a><span id="l5.209" class="difflineat">@@ -259,17 +259,17 @@ function test_virtual_folder_multi_load_</span>
<a href="#l5.210"></a><span id="l5.210"> </span>
<a href="#l5.211"></a><span id="l5.211"> /**</span>
<a href="#l5.212"></a><span id="l5.212">  * Make sure that opening a virtual folder backed by a single real folder, then</span>
<a href="#l5.213"></a><span id="l5.213">  *  a multi-backed one, then the single-backed one again doesn't explode.</span>
<a href="#l5.214"></a><span id="l5.214">  *</span>
<a href="#l5.215"></a><span id="l5.215">  * This is just test_virtual_folder_multi_load_after_load with foldersOne told</span>
<a href="#l5.216"></a><span id="l5.216">  *  to create just a single folder.</span>
<a href="#l5.217"></a><span id="l5.217">  */</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineminus">-function test_virtual_folder_combo_load_after_load() {</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineplus">+function* test_virtual_folder_combo_load_after_load() {</span>
<a href="#l5.220"></a><span id="l5.220">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.221"></a><span id="l5.221"> </span>
<a href="#l5.222"></a><span id="l5.222">   let [foldersOne, oneSubjFoo, oneNopers] = make_folders_with_sets(1, [</span>
<a href="#l5.223"></a><span id="l5.223">     {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l5.224"></a><span id="l5.224">   let virtOne = make_virtual_folder(foldersOne, {subject: &quot;foo&quot;});</span>
<a href="#l5.225"></a><span id="l5.225">   yield async_view_open(viewWrapper, virtOne);</span>
<a href="#l5.226"></a><span id="l5.226">   verify_messages_in_view([oneSubjFoo], viewWrapper);</span>
<a href="#l5.227"></a><span id="l5.227"> </span>
<a href="#l5.228"></a><span id="l5.228" class="difflineat">@@ -286,17 +286,17 @@ function test_virtual_folder_combo_load_</span>
<a href="#l5.229"></a><span id="l5.229">   virtOne.parent.propagateDelete(virtOne, true, null);</span>
<a href="#l5.230"></a><span id="l5.230">   virtTwo.parent.propagateDelete(virtTwo, true, null);</span>
<a href="#l5.231"></a><span id="l5.231"> }</span>
<a href="#l5.232"></a><span id="l5.232"> </span>
<a href="#l5.233"></a><span id="l5.233"> /**</span>
<a href="#l5.234"></a><span id="l5.234">  * Make sure that if a server is listed in a virtual folder's search Uris that</span>
<a href="#l5.235"></a><span id="l5.235">  *  it does not get into our list of _underlyingFolders.</span>
<a href="#l5.236"></a><span id="l5.236">  */</span>
<a href="#l5.237"></a><span id="l5.237" class="difflineminus">-function test_virtual_folder_filters_out_servers() {</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineplus">+function* test_virtual_folder_filters_out_servers() {</span>
<a href="#l5.239"></a><span id="l5.239">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.240"></a><span id="l5.240"> </span>
<a href="#l5.241"></a><span id="l5.241">   let [folders] = make_folders_with_sets(2, []);</span>
<a href="#l5.242"></a><span id="l5.242">   folders.push(folders[0].rootFolder);</span>
<a href="#l5.243"></a><span id="l5.243">   let virtFolder = make_virtual_folder(folders, {});</span>
<a href="#l5.244"></a><span id="l5.244">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l5.245"></a><span id="l5.245"> </span>
<a href="#l5.246"></a><span id="l5.246">   assert_equals(viewWrapper._underlyingFolders.length, 2,</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineat">@@ -304,17 +304,17 @@ function test_virtual_folder_filters_out</span>
<a href="#l5.248"></a><span id="l5.248">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l5.249"></a><span id="l5.249"> }</span>
<a href="#l5.250"></a><span id="l5.250"> </span>
<a href="#l5.251"></a><span id="l5.251"> /**</span>
<a href="#l5.252"></a><span id="l5.252">  * Verify that if one of the folders backing our virtual folder is deleted that</span>
<a href="#l5.253"></a><span id="l5.253">  *  we do not explode.  Then verify that if we remove the rest of them that the</span>
<a href="#l5.254"></a><span id="l5.254">  *  view wrapper closes itself.</span>
<a href="#l5.255"></a><span id="l5.255">  */</span>
<a href="#l5.256"></a><span id="l5.256" class="difflineminus">-function test_virtual_folder_underlying_folder_deleted() {</span>
<a href="#l5.257"></a><span id="l5.257" class="difflineplus">+function* test_virtual_folder_underlying_folder_deleted() {</span>
<a href="#l5.258"></a><span id="l5.258">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.259"></a><span id="l5.259"> </span>
<a href="#l5.260"></a><span id="l5.260">   let [folderOne, oneSubjFoo, oneNopers] = make_folder_with_sets([</span>
<a href="#l5.261"></a><span id="l5.261">     {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l5.262"></a><span id="l5.262">   let [folderTwo, twoSubjFoo, twoNopers] = make_folder_with_sets([</span>
<a href="#l5.263"></a><span id="l5.263">     {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l5.264"></a><span id="l5.264"> </span>
<a href="#l5.265"></a><span id="l5.265">   let virtFolder = make_virtual_folder([folderOne, folderTwo],</span>
<a href="#l5.266"></a><span id="l5.266" class="difflineat">@@ -339,17 +339,17 @@ function test_virtual_folder_underlying_</span>
<a href="#l5.267"></a><span id="l5.267"> </span>
<a href="#l5.268"></a><span id="l5.268"> /* ===== Virtual Folder, Mail Views ===== */</span>
<a href="#l5.269"></a><span id="l5.269"> </span>
<a href="#l5.270"></a><span id="l5.270"> /*</span>
<a href="#l5.271"></a><span id="l5.271">  * We do not need to test all of the mail view permutations, realFolder</span>
<a href="#l5.272"></a><span id="l5.272">  *  already did that.  We just need to make sure it works at all.</span>
<a href="#l5.273"></a><span id="l5.273">  */</span>
<a href="#l5.274"></a><span id="l5.274"> </span>
<a href="#l5.275"></a><span id="l5.275" class="difflineminus">-function test_virtual_folder_mail_views_unread(aNumFolders) {</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineplus">+function* test_virtual_folder_mail_views_unread(aNumFolders) {</span>
<a href="#l5.277"></a><span id="l5.277">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.278"></a><span id="l5.278"> </span>
<a href="#l5.279"></a><span id="l5.279">   let [folders, fooOne, fooTwo, nopeOne, nopeTwo] = make_folders_with_sets(</span>
<a href="#l5.280"></a><span id="l5.280">     aNumFolders, [{subject: &quot;foo 1&quot;}, {subject: &quot;foo 2&quot;}, {}, {}]);</span>
<a href="#l5.281"></a><span id="l5.281">   let virtFolder = make_virtual_folder(folders, {subject: &quot;foo&quot;});</span>
<a href="#l5.282"></a><span id="l5.282"> </span>
<a href="#l5.283"></a><span id="l5.283">   // everything is unread to start with!</span>
<a href="#l5.284"></a><span id="l5.284">   yield async_view_open(viewWrapper, virtFolder);</span>
<a href="#l5.285"></a><span id="l5.285" class="difflineat">@@ -374,17 +374,17 @@ function test_virtual_folder_mail_views_</span>
<a href="#l5.286"></a><span id="l5.286">   verify_messages_in_view([fooOne, fooTwo, fooThree], viewWrapper);</span>
<a href="#l5.287"></a><span id="l5.287">   virtFolder.parent.propagateDelete(virtFolder, true, null);</span>
<a href="#l5.288"></a><span id="l5.288"> }</span>
<a href="#l5.289"></a><span id="l5.289"> </span>
<a href="#l5.290"></a><span id="l5.290"> // This tests that clearing the new messages in a folder also clears the</span>
<a href="#l5.291"></a><span id="l5.291"> // new flag on saved search folders based on the real folder. This could be a</span>
<a href="#l5.292"></a><span id="l5.292"> // core view test, or a mozmill test, but I think the view wrapper stuff</span>
<a href="#l5.293"></a><span id="l5.293"> // is involved in some of the issues here, so this is a compromise.</span>
<a href="#l5.294"></a><span id="l5.294" class="difflineminus">-function test_virtual_folder_mail_new_handling() {</span>
<a href="#l5.295"></a><span id="l5.295" class="difflineplus">+function* test_virtual_folder_mail_new_handling() {</span>
<a href="#l5.296"></a><span id="l5.296">   let viewWrapper = make_view_wrapper();</span>
<a href="#l5.297"></a><span id="l5.297"> </span>
<a href="#l5.298"></a><span id="l5.298">   let [folders, fooOne, fooTwo] = make_folders_with_sets(</span>
<a href="#l5.299"></a><span id="l5.299">     1, [{subject: &quot;foo 1&quot;}, {subject: &quot;foo 2&quot;}]);</span>
<a href="#l5.300"></a><span id="l5.300">   let folder = folders[0];</span>
<a href="#l5.301"></a><span id="l5.301">   let virtFolder = make_virtual_folder(folders, {subject: &quot;foo&quot;});</span>
<a href="#l5.302"></a><span id="l5.302"> </span>
<a href="#l5.303"></a><span id="l5.303">   yield async_view_open(viewWrapper, folder);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -43,17 +43,17 @@ var gCustomSearchTermSubject = {</span>
<a href="#l6.4"></a><span id="l6.4"> };</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> MailServices.filters.addCustomTerm(gCustomSearchTermSubject);</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> /**</span>
<a href="#l6.9"></a><span id="l6.9">  * Make sure we open a virtual folder backed by a single underlying folder</span>
<a href="#l6.10"></a><span id="l6.10">  *  correctly, with a custom search term.</span>
<a href="#l6.11"></a><span id="l6.11">  */</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-function test_virtual_folder_single_load_custom_pred() {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+function* test_virtual_folder_single_load_custom_pred() {</span>
<a href="#l6.14"></a><span id="l6.14">   let viewWrapper = make_view_wrapper();</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16">   let [folderOne, oneSubjFoo, oneNopers] = make_folder_with_sets([</span>
<a href="#l6.17"></a><span id="l6.17">     {subject: &quot;foo&quot;}, {}]);</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19">   yield wait_for_message_injection();</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">   let virtFolder = make_virtual_folder(folderOne,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -885,17 +885,19 @@ function select_none(aController) {</span>
<a href="#l7.4"></a><span id="l7.4">  * @param aViewIndex An absolute index (integer &gt;= 0), slice-style index (&lt; 0),</span>
<a href="#l7.5"></a><span id="l7.5">  *     or a SyntheticMessageSet (we only care about the first message in it).</span>
<a href="#l7.6"></a><span id="l7.6">  */</span>
<a href="#l7.7"></a><span id="l7.7"> function _normalize_view_index(aViewIndex, aController) {</span>
<a href="#l7.8"></a><span id="l7.8">   if (aController == null)</span>
<a href="#l7.9"></a><span id="l7.9">     aController = mc;</span>
<a href="#l7.10"></a><span id="l7.10">   // SyntheticMessageSet special-case</span>
<a href="#l7.11"></a><span id="l7.11">   if (typeof(aViewIndex) != &quot;number&quot;) {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    let msgHdr = aViewIndex.msgHdrs().next().value;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    let msgHdrIter = aViewIndex.msgHdrs();</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+    let msgHdr = msgHdrIter.next().value;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    msgHdrIter.return();</span>
<a href="#l7.16"></a><span id="l7.16">     // do not expand</span>
<a href="#l7.17"></a><span id="l7.17">     aViewIndex = aController.dbView.findIndexOfMsgHdr(msgHdr, false);</span>
<a href="#l7.18"></a><span id="l7.18">   }</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20">   if (aViewIndex &lt; 0)</span>
<a href="#l7.21"></a><span id="l7.21">     return aController.dbView.QueryInterface(Ci.nsITreeView).rowCount +</span>
<a href="#l7.22"></a><span id="l7.22">       aViewIndex;</span>
<a href="#l7.23"></a><span id="l7.23">   return aViewIndex;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/test/unit/test_compactFailure.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_compactFailure.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -83,33 +83,33 @@ function teardown_db_service_mock() {</span>
<a href="#l8.4"></a><span id="l8.4"> function generate_messages() {</span>
<a href="#l8.5"></a><span id="l8.5">   let messageGenerator = new MessageGenerator();</span>
<a href="#l8.6"></a><span id="l8.6">   let scenarioFactory = new MessageScenarioFactory(messageGenerator);</span>
<a href="#l8.7"></a><span id="l8.7">   let messages = [];</span>
<a href="#l8.8"></a><span id="l8.8">   messages = messages.concat(scenarioFactory.directReply(10));</span>
<a href="#l8.9"></a><span id="l8.9">   return messages;</span>
<a href="#l8.10"></a><span id="l8.10"> }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-function setup_target_folder() {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+function* setup_target_folder() {</span>
<a href="#l8.14"></a><span id="l8.14">   gTargetFolder = localAccountUtils.rootFolder.createLocalSubfolder(&quot;Target&quot;);</span>
<a href="#l8.15"></a><span id="l8.15">   addMessagesToFolder(generate_messages(), gTargetFolder);</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">   mailTestUtils.updateFolderAndNotify(gTargetFolder, async_driver);</span>
<a href="#l8.18"></a><span id="l8.18">   yield false;</span>
<a href="#l8.19"></a><span id="l8.19"> }</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-function setup_open_failure_folder() {</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+function* setup_open_failure_folder() {</span>
<a href="#l8.23"></a><span id="l8.23">   gTargetFolder = localAccountUtils.rootFolder.createLocalSubfolder(&quot;ShouldFail&quot;);</span>
<a href="#l8.24"></a><span id="l8.24">   addMessagesToFolder(generate_messages(), gTargetFolder);</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26">   mailTestUtils.updateFolderAndNotify(gTargetFolder, async_driver);</span>
<a href="#l8.27"></a><span id="l8.27">   yield false;</span>
<a href="#l8.28"></a><span id="l8.28"> }</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-function delete_all_messages() {</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+function* delete_all_messages() {</span>
<a href="#l8.32"></a><span id="l8.32">   let enumerator = gTargetFolder.messages;</span>
<a href="#l8.33"></a><span id="l8.33">   let headers = [];</span>
<a href="#l8.34"></a><span id="l8.34">   while (enumerator.hasMoreElements())</span>
<a href="#l8.35"></a><span id="l8.35">     headers.push(enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37">   let array = toXPCOMArray(headers, Ci.nsIMutableArray);</span>
<a href="#l8.38"></a><span id="l8.38"> </span>
<a href="#l8.39"></a><span id="l8.39">   gTargetFolder.deleteMessages(array, null, false, true, asyncCopyListener, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/test/unit/test_copyToInvalidDB.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_copyToInvalidDB.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -14,17 +14,17 @@ Components.utils.import(&quot;resource:///mod</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5"> var gMsg1;</span>
<a href="#l9.6"></a><span id="l9.6"> var gMessages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l9.7"></a><span id="l9.7"> var gCurTestNum;</span>
<a href="#l9.8"></a><span id="l9.8"> var gMsgId1;</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10"> var gTestFolder, gTestFolder2;</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-function setup_globals(aNextFunc) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+function* setup_globals(aNextFunc) {</span>
<a href="#l9.14"></a><span id="l9.14">   var messageGenerator = new MessageGenerator();</span>
<a href="#l9.15"></a><span id="l9.15">   gMsg1 = messageGenerator.makeMessage();</span>
<a href="#l9.16"></a><span id="l9.16">   let msg2 = messageGenerator.makeMessage({inReplyTo: gMsg1});</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18">   let messages = [];</span>
<a href="#l9.19"></a><span id="l9.19">   messages = messages.concat([gMsg1, msg2]);</span>
<a href="#l9.20"></a><span id="l9.20">   let msgSet = new SyntheticMessageSet(messages);</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -38,17 +38,17 @@ function setup_globals(aNextFunc) {</span>
<a href="#l9.23"></a><span id="l9.23"> }</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25"> function run_test() {</span>
<a href="#l9.26"></a><span id="l9.26">   configure_message_injection({mode: &quot;local&quot;});</span>
<a href="#l9.27"></a><span id="l9.27">   do_test_pending();</span>
<a href="#l9.28"></a><span id="l9.28">   async_run({func: actually_run_test});</span>
<a href="#l9.29"></a><span id="l9.29"> }</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-function actually_run_test() {</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+function* actually_run_test() {</span>
<a href="#l9.33"></a><span id="l9.33">   yield async_run({func: setup_globals});</span>
<a href="#l9.34"></a><span id="l9.34">   gTestFolder2.msgDatabase.summaryValid = false;</span>
<a href="#l9.35"></a><span id="l9.35">   gTestFolder2.msgDatabase = null;</span>
<a href="#l9.36"></a><span id="l9.36">   gTestFolder2.ForceDBClosed();</span>
<a href="#l9.37"></a><span id="l9.37">   let dbPath = gTestFolder2.filePath;</span>
<a href="#l9.38"></a><span id="l9.38">   dbPath.leafName = dbPath.leafName + &quot;.msf&quot;;</span>
<a href="#l9.39"></a><span id="l9.39">   dbPath.remove(false);</span>
<a href="#l9.40"></a><span id="l9.40">   gTestFolder2.msgDatabase = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/test/unit/test_detachToFile.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_detachToFile.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -16,52 +16,52 @@ Components.utils.import(&quot;resource:///mod</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5"> var tests = [</span>
<a href="#l10.6"></a><span id="l10.6">   startCopy,</span>
<a href="#l10.7"></a><span id="l10.7">   startMime,</span>
<a href="#l10.8"></a><span id="l10.8">   startDetach,</span>
<a href="#l10.9"></a><span id="l10.9">   testDetach,</span>
<a href="#l10.10"></a><span id="l10.10"> ]</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-function startCopy()</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+function* startCopy()</span>
<a href="#l10.14"></a><span id="l10.14"> {</span>
<a href="#l10.15"></a><span id="l10.15">   // Get a message into the local filestore.</span>
<a href="#l10.16"></a><span id="l10.16">   var mailFile = do_get_file(&quot;../../../data/external-attach-test&quot;);</span>
<a href="#l10.17"></a><span id="l10.17">   MailServices.copy.CopyFileMessage(mailFile, localAccountUtils.inboxFolder, null,</span>
<a href="#l10.18"></a><span id="l10.18">                                     false, 0, &quot;&quot;, asyncCopyListener, null);</span>
<a href="#l10.19"></a><span id="l10.19">   yield false;</span>
<a href="#l10.20"></a><span id="l10.20"> }</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22"> // process the message through mime</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-function startMime()</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+function* startMime()</span>
<a href="#l10.25"></a><span id="l10.25"> {</span>
<a href="#l10.26"></a><span id="l10.26">   let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">   mimeMsg.MsgHdrToMimeMessage(msgHdr, gCallbackObject, gCallbackObject.callback,</span>
<a href="#l10.29"></a><span id="l10.29">                               true /* allowDownload */);</span>
<a href="#l10.30"></a><span id="l10.30">   yield false;</span>
<a href="#l10.31"></a><span id="l10.31"> }</span>
<a href="#l10.32"></a><span id="l10.32"> </span>
<a href="#l10.33"></a><span id="l10.33"> // detach any found attachments</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-function startDetach()</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+function* startDetach()</span>
<a href="#l10.36"></a><span id="l10.36"> {</span>
<a href="#l10.37"></a><span id="l10.37">   let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l10.38"></a><span id="l10.38">   let msgURI = msgHdr.folder.generateMessageURI(msgHdr.messageKey);</span>
<a href="#l10.39"></a><span id="l10.39"> </span>
<a href="#l10.40"></a><span id="l10.40">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l10.41"></a><span id="l10.41">   let attachment = gCallbackObject.attachments[0];</span>
<a href="#l10.42"></a><span id="l10.42"> </span>
<a href="#l10.43"></a><span id="l10.43">   messenger.detachAttachmentsWOPrompts(do_get_profile(), 1,</span>
<a href="#l10.44"></a><span id="l10.44">                                        [attachment.contentType], [attachment.url],</span>
<a href="#l10.45"></a><span id="l10.45">                                        [attachment.name], [msgURI], asyncUrlListener);</span>
<a href="#l10.46"></a><span id="l10.46">   yield false;</span>
<a href="#l10.47"></a><span id="l10.47"> }</span>
<a href="#l10.48"></a><span id="l10.48"> </span>
<a href="#l10.49"></a><span id="l10.49"> // test that the detachment was successful</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-function testDetach()</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+function* testDetach()</span>
<a href="#l10.52"></a><span id="l10.52"> {</span>
<a href="#l10.53"></a><span id="l10.53">   // This test seems to fail on Linux without the following delay.</span>
<a href="#l10.54"></a><span id="l10.54">   do_timeout(200, async_driver);</span>
<a href="#l10.55"></a><span id="l10.55">   yield false;</span>
<a href="#l10.56"></a><span id="l10.56">   // The message contained a file &quot;check.pdf&quot; which should</span>
<a href="#l10.57"></a><span id="l10.57">   //  now exist in the profile directory.</span>
<a href="#l10.58"></a><span id="l10.58">   let checkFile = do_get_profile().clone();</span>
<a href="#l10.59"></a><span id="l10.59">   checkFile.append(&quot;check.pdf&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/test/unit/test_junkingWhenDisabled.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_junkingWhenDisabled.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -108,17 +108,17 @@ function addMessages() {</span>
<a href="#l11.4"></a><span id="l11.4">   // add another message in case the first one moved</span>
<a href="#l11.5"></a><span id="l11.5">   let messages = [];</span>
<a href="#l11.6"></a><span id="l11.6">   let msg1 = gMessageGenerator.makeMessage();</span>
<a href="#l11.7"></a><span id="l11.7">   messages = messages.concat([msg1]);</span>
<a href="#l11.8"></a><span id="l11.8">   let msgSet = new SyntheticMessageSet(messages);</span>
<a href="#l11.9"></a><span id="l11.9">   return add_sets_to_folders(gLocalInboxFolder, [msgSet]);</span>
<a href="#l11.10"></a><span id="l11.10"> }</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-function junkMessages() {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+function* junkMessages() {</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15">   // select and junk all messages</span>
<a href="#l11.16"></a><span id="l11.16">   gDBView.doCommand(Ci.nsMsgViewCommandType.selectAll);</span>
<a href="#l11.17"></a><span id="l11.17">   gDBView.doCommand(Ci.nsMsgViewCommandType.junk);</span>
<a href="#l11.18"></a><span id="l11.18">   yield false;</span>
<a href="#l11.19"></a><span id="l11.19"> }</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21"> // Our listener, which captures events and does the real tests.</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -169,17 +169,17 @@ function run_test() {</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24">   async_run({func: actually_run_test});</span>
<a href="#l11.25"></a><span id="l11.25"> }</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27"> var view_types = [</span>
<a href="#l11.28"></a><span id="l11.28">   [&quot;threaded&quot;, ViewFlags.kThreadedDisplay],</span>
<a href="#l11.29"></a><span id="l11.29"> ];</span>
<a href="#l11.30"></a><span id="l11.30"> </span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-function actually_run_test() {</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+function* actually_run_test() {</span>
<a href="#l11.33"></a><span id="l11.33">   yield async_run({func: setup_globals});</span>
<a href="#l11.34"></a><span id="l11.34">   dump(&quot;Num Messages: &quot; + gLocalInboxFolder.msgDatabase.dBFolderInfo.numMessages + &quot;\n&quot;);</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36">   // for each view type...</span>
<a href="#l11.37"></a><span id="l11.37">   for (let view_type_and_flags of view_types) {</span>
<a href="#l11.38"></a><span id="l11.38">     let [view_type, view_flags] = view_type_and_flags;</span>
<a href="#l11.39"></a><span id="l11.39"> </span>
<a href="#l11.40"></a><span id="l11.40">     // ... run each test</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/test/unit/test_mimemaltdetach.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_mimemaltdetach.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -17,52 +17,52 @@ Components.utils.import(&quot;resource:///mod</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> var tests = [</span>
<a href="#l12.6"></a><span id="l12.6">   startCopy,</span>
<a href="#l12.7"></a><span id="l12.7">   startMime,</span>
<a href="#l12.8"></a><span id="l12.8">   startDetach,</span>
<a href="#l12.9"></a><span id="l12.9">   testDetach,</span>
<a href="#l12.10"></a><span id="l12.10"> ]</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-function startCopy()</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+function* startCopy()</span>
<a href="#l12.14"></a><span id="l12.14"> {</span>
<a href="#l12.15"></a><span id="l12.15">   // Get a message into the local filestore.</span>
<a href="#l12.16"></a><span id="l12.16">   let mailFile = do_get_file(&quot;../../../data/multipartmalt-detach&quot;);</span>
<a href="#l12.17"></a><span id="l12.17">   MailServices.copy.CopyFileMessage(mailFile, localAccountUtils.inboxFolder, null,</span>
<a href="#l12.18"></a><span id="l12.18">                                     false, 0, &quot;&quot;, asyncCopyListener, null);</span>
<a href="#l12.19"></a><span id="l12.19">   yield false;</span>
<a href="#l12.20"></a><span id="l12.20"> }</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22"> // process the message through mime</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-function startMime()</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+function* startMime()</span>
<a href="#l12.25"></a><span id="l12.25"> {</span>
<a href="#l12.26"></a><span id="l12.26">   let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">   mimeMsg.MsgHdrToMimeMessage(msgHdr, gCallbackObject, gCallbackObject.callback,</span>
<a href="#l12.29"></a><span id="l12.29">                               true /* allowDownload */);</span>
<a href="#l12.30"></a><span id="l12.30">   yield false;</span>
<a href="#l12.31"></a><span id="l12.31"> }</span>
<a href="#l12.32"></a><span id="l12.32"> </span>
<a href="#l12.33"></a><span id="l12.33"> // detach any found attachments</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-function startDetach()</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+function* startDetach()</span>
<a href="#l12.36"></a><span id="l12.36"> {</span>
<a href="#l12.37"></a><span id="l12.37">   let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l12.38"></a><span id="l12.38">   let msgURI = msgHdr.folder.generateMessageURI(msgHdr.messageKey);</span>
<a href="#l12.39"></a><span id="l12.39"> </span>
<a href="#l12.40"></a><span id="l12.40">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l12.41"></a><span id="l12.41">   let attachment = gCallbackObject.attachments[0];</span>
<a href="#l12.42"></a><span id="l12.42"> </span>
<a href="#l12.43"></a><span id="l12.43">   messenger.detachAttachmentsWOPrompts(do_get_profile(), 1,</span>
<a href="#l12.44"></a><span id="l12.44">                                        [attachment.contentType], [attachment.url],</span>
<a href="#l12.45"></a><span id="l12.45">                                        [attachment.name], [msgURI], asyncUrlListener);</span>
<a href="#l12.46"></a><span id="l12.46">   yield false;</span>
<a href="#l12.47"></a><span id="l12.47"> }</span>
<a href="#l12.48"></a><span id="l12.48"> </span>
<a href="#l12.49"></a><span id="l12.49"> // test that the detachment was successful</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-function testDetach()</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+function* testDetach()</span>
<a href="#l12.52"></a><span id="l12.52"> {</span>
<a href="#l12.53"></a><span id="l12.53">   // This test seems to fail on Linux without the following delay.</span>
<a href="#l12.54"></a><span id="l12.54">   do_timeout(200, async_driver);</span>
<a href="#l12.55"></a><span id="l12.55">   yield false;</span>
<a href="#l12.56"></a><span id="l12.56">   // The message contained a file &quot;head_update.txt&quot; which should</span>
<a href="#l12.57"></a><span id="l12.57">   //  now exist in the profile directory.</span>
<a href="#l12.58"></a><span id="l12.58">   let checkFile = do_get_profile().clone();</span>
<a href="#l12.59"></a><span id="l12.59">   checkFile.append(&quot;head_update.txt&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsMsgDBView.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsMsgDBView.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -756,17 +756,17 @@ function test_group_sort_collapseAll_exp</span>
<a href="#l13.4"></a><span id="l13.4">     view_throw(&quot;Expected grouped by custom column, ZA sortOrder smsg3 value to be B&quot;);</span>
<a href="#l13.5"></a><span id="l13.5">   assert_view_index_is_dummy(2);</span>
<a href="#l13.6"></a><span id="l13.6">   assert_view_index_is_not_dummy(3);</span>
<a href="#l13.7"></a><span id="l13.7">   assert_view_index_is_not_dummy(4);</span>
<a href="#l13.8"></a><span id="l13.8">   if (authorFirstLetterCustomColumn.getSortStringForRow(gDBView.getMsgHdrAt(4)) != &quot;A&quot;)</span>
<a href="#l13.9"></a><span id="l13.9">     view_throw(&quot;Expected grouped by custom column, ZA sortOrder smsg2 value to be A&quot;);</span>
<a href="#l13.10"></a><span id="l13.10"> }</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-function test_group_dummies_under_mutation_by_date() {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+function* test_group_dummies_under_mutation_by_date() {</span>
<a href="#l13.14"></a><span id="l13.14">   // - start with an empty folder</span>
<a href="#l13.15"></a><span id="l13.15">   let save_gTestFolder = gTestFolder;</span>
<a href="#l13.16"></a><span id="l13.16">   gTestFolder = make_empty_folder();</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18">   // - create the view</span>
<a href="#l13.19"></a><span id="l13.19">   setup_view(&quot;group&quot;, ViewFlags.kGroupBySort);</span>
<a href="#l13.20"></a><span id="l13.20">   gDBView.sort(SortType.byDate, SortOrder.ascending);</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -962,17 +962,17 @@ var tests_for_specific_views = {</span>
<a href="#l13.23"></a><span id="l13.23"> };</span>
<a href="#l13.24"></a><span id="l13.24"> </span>
<a href="#l13.25"></a><span id="l13.25"> function run_test() {</span>
<a href="#l13.26"></a><span id="l13.26">   configure_message_injection({mode: &quot;local&quot;});</span>
<a href="#l13.27"></a><span id="l13.27">   do_test_pending();</span>
<a href="#l13.28"></a><span id="l13.28">   async_run({func: actually_run_test});</span>
<a href="#l13.29"></a><span id="l13.29"> }</span>
<a href="#l13.30"></a><span id="l13.30"> </span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-function actually_run_test() {</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+function* actually_run_test() {</span>
<a href="#l13.33"></a><span id="l13.33">   dump(&quot;in actually_run_test\n&quot;);</span>
<a href="#l13.34"></a><span id="l13.34">   yield async_run({func: setup_globals});</span>
<a href="#l13.35"></a><span id="l13.35">   dump(&quot;Num Messages: &quot; + gTestFolder.msgDatabase.dBFolderInfo.numMessages + &quot;\n&quot;);</span>
<a href="#l13.36"></a><span id="l13.36"> </span>
<a href="#l13.37"></a><span id="l13.37">   // for each view type...</span>
<a href="#l13.38"></a><span id="l13.38">   for (let [, view_type_and_flags] in Iterator(view_types)) {</span>
<a href="#l13.39"></a><span id="l13.39">     let [view_type, view_flags] = view_type_and_flags;</span>
<a href="#l13.40"></a><span id="l13.40">     dump(&quot;===== Testing View Type: &quot; + view_type + &quot; flags: &quot; + view_flags +</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsMsgDBView_headerValues.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -31,17 +31,17 @@ var tests = [</span>
<a href="#l14.4"></a><span id="l14.4">   [{from: &quot;John Doe \xF5 &lt;db@null.invalid&gt;&quot;,</span>
<a href="#l14.5"></a><span id="l14.5">      clobberHeaders: { &quot;Content-type&quot; : &quot;text/plain; charset=ISO-8859-2&quot; }},</span>
<a href="#l14.6"></a><span id="l14.6"> 	{sender: &quot;John Doe ő&quot;}],</span>
<a href="#l14.7"></a><span id="l14.7">   [{from: &quot;=?UTF-8?Q?H=C3=A5s=C3=A4ther=2C_David?= &lt;db@null.invalid&gt;&quot;,</span>
<a href="#l14.8"></a><span id="l14.8">      clobberHeaders: { &quot;Content-type&quot; : &quot;text/plain; charset=ISO-8859-2&quot; }},</span>
<a href="#l14.9"></a><span id="l14.9">     {sender: &quot;Håsäther, David&quot;}],</span>
<a href="#l14.10"></a><span id="l14.10"> ];</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-function real_test() {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+function* real_test() {</span>
<a href="#l14.14"></a><span id="l14.14">   // Add the messages to the folder</span>
<a href="#l14.15"></a><span id="l14.15">   let msgGenerator = new MessageGenerator();</span>
<a href="#l14.16"></a><span id="l14.16">   let genMessages = tests.map(data =&gt; msgGenerator.makeMessage(data[0]));</span>
<a href="#l14.17"></a><span id="l14.17">   let folder = make_empty_folder();</span>
<a href="#l14.18"></a><span id="l14.18">   yield add_sets_to_folder(folder, [new SyntheticMessageSet(genMessages)]);</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20">   // Make the DB view</span>
<a href="#l14.21"></a><span id="l14.21">   let dbviewContractId = &quot;@mozilla.org/messenger/msgdbview;1?type=threaded&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/test/unit/test_quarantineFilterMove.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_quarantineFilterMove.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -51,17 +51,17 @@ var gTestArray =</span>
<a href="#l15.4"></a><span id="l15.4">     let firstMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l15.5"></a><span id="l15.5">     let secondMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l15.6"></a><span id="l15.6">     // Check that the messages have content</span>
<a href="#l15.7"></a><span id="l15.7">     messageContent = getContentFromMessage(firstMsgHdr);</span>
<a href="#l15.8"></a><span id="l15.8">     do_check_true(messageContent.includes(&quot;Some User &lt;bugmail@example.org&gt; changed&quot;));</span>
<a href="#l15.9"></a><span id="l15.9">     messageContent = getContentFromMessage(secondMsgHdr);</span>
<a href="#l15.10"></a><span id="l15.10">     do_check_true(messageContent.includes(&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=436880&quot;));</span>
<a href="#l15.11"></a><span id="l15.11">   },</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  function copyMovedMessages() {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  function* copyMovedMessages() {</span>
<a href="#l15.14"></a><span id="l15.14">     let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l15.15"></a><span id="l15.15">     let enumerator = gMoveFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l15.16"></a><span id="l15.16">     let firstMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l15.17"></a><span id="l15.17">     let secondMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l15.18"></a><span id="l15.18">     messages.appendElement(firstMsgHdr, false);</span>
<a href="#l15.19"></a><span id="l15.19">     messages.appendElement(secondMsgHdr, false);</span>
<a href="#l15.20"></a><span id="l15.20">     let promiseCopyListener = new PromiseTestUtils.PromiseCopyListener();</span>
<a href="#l15.21"></a><span id="l15.21">     MailServices.copy.CopyMessages(gMoveFolder, messages, gMoveFolder2, false,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/test/unit/test_retention.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_retention.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -29,17 +29,17 @@ function setup_globals(aNextFunc) {</span>
<a href="#l16.4"></a><span id="l16.4"> }</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> function run_test() {</span>
<a href="#l16.7"></a><span id="l16.7">   configure_message_injection({mode: &quot;local&quot;});</span>
<a href="#l16.8"></a><span id="l16.8">   do_test_pending();</span>
<a href="#l16.9"></a><span id="l16.9">   async_run({func: actually_run_test});</span>
<a href="#l16.10"></a><span id="l16.10"> }</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-function actually_run_test() {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+function* actually_run_test() {</span>
<a href="#l16.14"></a><span id="l16.14">   yield async_run({func: setup_globals});</span>
<a href="#l16.15"></a><span id="l16.15">   let numMessages = 10;</span>
<a href="#l16.16"></a><span id="l16.16">   gTestFolder.msgDatabase = null;</span>
<a href="#l16.17"></a><span id="l16.17">   gTestFolder.applyRetentionSettings();</span>
<a href="#l16.18"></a><span id="l16.18">   const gDbService = Cc[&quot;@mozilla.org/msgDatabase/msgDBService;1&quot;]</span>
<a href="#l16.19"></a><span id="l16.19">                        .getService(Ci.nsIMsgDBService);</span>
<a href="#l16.20"></a><span id="l16.20">   // adding messages leaves some headers around as garbage - make sure</span>
<a href="#l16.21"></a><span id="l16.21">   // those are cleaned up so the db will get closed.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_gmail.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -25,17 +25,17 @@ var handler;</span>
<a href="#l17.4"></a><span id="l17.4"> var tests = [</span>
<a href="#l17.5"></a><span id="l17.5">   setupMailboxes,</span>
<a href="#l17.6"></a><span id="l17.6">   testXlist,</span>
<a href="#l17.7"></a><span id="l17.7">   endTest</span>
<a href="#l17.8"></a><span id="l17.8"> ]</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10"> // mbox mailboxes cannot contain both child mailboxes and messages, so this will</span>
<a href="#l17.11"></a><span id="l17.11"> // be one test case.</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-function setupMailboxes()</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+function* setupMailboxes()</span>
<a href="#l17.14"></a><span id="l17.14"> {</span>
<a href="#l17.15"></a><span id="l17.15">   IMAPPump.mailbox.specialUseFlag = &quot;\\Inbox&quot;;</span>
<a href="#l17.16"></a><span id="l17.16">   IMAPPump.daemon.createMailbox(&quot;[Gmail]&quot;, {flags : [&quot;\\Noselect&quot;]});</span>
<a href="#l17.17"></a><span id="l17.17">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/All Mail&quot;, {specialUseFlag : &quot;\\AllMail&quot;});</span>
<a href="#l17.18"></a><span id="l17.18">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/Drafts&quot;, {specialUseFlag : &quot;\\Drafts&quot;});</span>
<a href="#l17.19"></a><span id="l17.19">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/Sent&quot;, {specialUseFlag : &quot;\\Sent&quot;});</span>
<a href="#l17.20"></a><span id="l17.20">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/Spam&quot;, {specialUseFlag : &quot;\\Spam&quot;});</span>
<a href="#l17.21"></a><span id="l17.21">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/Starred&quot;, {specialUseFlag : &quot;\\Starred&quot;});</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -46,17 +46,17 @@ function setupMailboxes()</span>
<a href="#l17.23"></a><span id="l17.23">   let response = handler.onError('1', 'LOGIN user password');</span>
<a href="#l17.24"></a><span id="l17.24">   do_check_true(response.includes('OK'));</span>
<a href="#l17.25"></a><span id="l17.25">   // wait for imap pump to do its thing or else we get memory leaks</span>
<a href="#l17.26"></a><span id="l17.26">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l17.27"></a><span id="l17.27">   yield false;</span>
<a href="#l17.28"></a><span id="l17.28"> }</span>
<a href="#l17.29"></a><span id="l17.29"> </span>
<a href="#l17.30"></a><span id="l17.30"> // test that 'XLIST &quot;&quot; &quot;*&quot;' returns the proper responses</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-function testXlist()</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+function* testXlist()</span>
<a href="#l17.33"></a><span id="l17.33"> {</span>
<a href="#l17.34"></a><span id="l17.34">   let response = handler.onError('2', 'XLIST &quot;&quot; &quot;*&quot;');</span>
<a href="#l17.35"></a><span id="l17.35"> </span>
<a href="#l17.36"></a><span id="l17.36">   do_check_true(response.includes('* LIST (\\HasNoChildren \\Inbox) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l17.37"></a><span id="l17.37">   do_check_true(response.includes('* LIST (\\Noselect \\HasChildren) &quot;/&quot; &quot;[Gmail]&quot;'));</span>
<a href="#l17.38"></a><span id="l17.38">   do_check_true(response.includes('* LIST (\\HasNoChildren \\AllMail) &quot;/&quot; &quot;[Gmail]/All Mail&quot;'));</span>
<a href="#l17.39"></a><span id="l17.39">   do_check_true(response.includes('* LIST (\\HasNoChildren \\Drafts) &quot;/&quot; &quot;[Gmail]/Drafts&quot;'));</span>
<a href="#l17.40"></a><span id="l17.40">   do_check_true(response.includes('* LIST (\\HasNoChildren \\Sent) &quot;/&quot; &quot;[Gmail]/Sent&quot;'));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_testsuite_fakeserver_imapd_list-extended.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -31,17 +31,17 @@ var tests = [</span>
<a href="#l18.4"></a><span id="l18.4">   testListReturnChilderen,</span>
<a href="#l18.5"></a><span id="l18.5">   testListReturnSubscribed,</span>
<a href="#l18.6"></a><span id="l18.6">   testListSelectMultiple,</span>
<a href="#l18.7"></a><span id="l18.7">   endTest</span>
<a href="#l18.8"></a><span id="l18.8"> ]</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10"> // mbox mailboxes cannot contain both child mailboxes and messages, so this will</span>
<a href="#l18.11"></a><span id="l18.11"> // be one test case.</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-function setupMailboxes()</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+function* setupMailboxes()</span>
<a href="#l18.14"></a><span id="l18.14"> {</span>
<a href="#l18.15"></a><span id="l18.15">   IMAPPump.mailbox.flags = [&quot;\\Marked&quot;, &quot;\\NoInferiors&quot;];</span>
<a href="#l18.16"></a><span id="l18.16">   IMAPPump.mailbox.subscribed = true;</span>
<a href="#l18.17"></a><span id="l18.17">   IMAPPump.daemon.createMailbox(&quot;Fruit&quot;, {});</span>
<a href="#l18.18"></a><span id="l18.18">   IMAPPump.daemon.createMailbox(&quot;Fruit/Apple&quot;, {});</span>
<a href="#l18.19"></a><span id="l18.19">   IMAPPump.daemon.createMailbox(&quot;Fruit/Banana&quot;, {subscribed : true});</span>
<a href="#l18.20"></a><span id="l18.20">   IMAPPump.daemon.createMailbox(&quot;Fruit/Peach&quot;, {nonExistent : true,</span>
<a href="#l18.21"></a><span id="l18.21">                                             subscribed : true});</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -54,17 +54,17 @@ function setupMailboxes()</span>
<a href="#l18.23"></a><span id="l18.23">   let response = handler.onError('1', 'LOGIN user password');</span>
<a href="#l18.24"></a><span id="l18.24">   do_check_true(response.includes('OK'));</span>
<a href="#l18.25"></a><span id="l18.25">   // wait for imap pump to do it's thing or else we get memory leaks</span>
<a href="#l18.26"></a><span id="l18.26">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l18.27"></a><span id="l18.27">   yield false;</span>
<a href="#l18.28"></a><span id="l18.28"> }</span>
<a href="#l18.29"></a><span id="l18.29"> </span>
<a href="#l18.30"></a><span id="l18.30"> // test that 'LIST &quot;&quot; &quot;*&quot;' returns the proper responses (standard LIST usage)</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-function testList()</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+function* testList()</span>
<a href="#l18.33"></a><span id="l18.33"> {</span>
<a href="#l18.34"></a><span id="l18.34">   let response = handler.onError('2', 'LIST &quot;&quot; &quot;*&quot;');</span>
<a href="#l18.35"></a><span id="l18.35"> </span>
<a href="#l18.36"></a><span id="l18.36">   do_check_true(response.includes('* LIST (\\Marked \\NoInferiors) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l18.37"></a><span id="l18.37">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Fruit&quot;'));</span>
<a href="#l18.38"></a><span id="l18.38">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Fruit/Apple&quot;'));</span>
<a href="#l18.39"></a><span id="l18.39">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Fruit/Banana&quot;'));</span>
<a href="#l18.40"></a><span id="l18.40">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineat">@@ -72,17 +72,17 @@ function testList()</span>
<a href="#l18.42"></a><span id="l18.42">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l18.43"></a><span id="l18.43">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Corn&quot;'));</span>
<a href="#l18.44"></a><span id="l18.44">   do_check_false(response.includes('Peach'));</span>
<a href="#l18.45"></a><span id="l18.45"> </span>
<a href="#l18.46"></a><span id="l18.46">   yield true;</span>
<a href="#l18.47"></a><span id="l18.47"> }</span>
<a href="#l18.48"></a><span id="l18.48"> </span>
<a href="#l18.49"></a><span id="l18.49"> // test that 'LIST (SUBSCRIBED) &quot;&quot; &quot;*&quot;' returns the proper responses</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-function testListSelectSubscribed()</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+function* testListSelectSubscribed()</span>
<a href="#l18.52"></a><span id="l18.52"> {</span>
<a href="#l18.53"></a><span id="l18.53">   let response = handler.onError('3', 'LIST (SUBSCRIBED) &quot;&quot; &quot;*&quot;');</span>
<a href="#l18.54"></a><span id="l18.54"> </span>
<a href="#l18.55"></a><span id="l18.55">   do_check_true(response.includes('* LIST (\\Marked \\NoInferiors \\Subscribed) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l18.56"></a><span id="l18.56">   do_check_true(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Fruit/Banana&quot;'));</span>
<a href="#l18.57"></a><span id="l18.57">   do_check_true(response.includes('* LIST (\\Subscribed \\NonExistent) &quot;/&quot; &quot;Fruit/Peach&quot;'));</span>
<a href="#l18.58"></a><span id="l18.58">   do_check_true(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Vegetable&quot;'));</span>
<a href="#l18.59"></a><span id="l18.59">   do_check_true(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineat">@@ -90,17 +90,17 @@ function testListSelectSubscribed()</span>
<a href="#l18.61"></a><span id="l18.61">   do_check_false(response.includes('Apple'));</span>
<a href="#l18.62"></a><span id="l18.62">   do_check_false(response.includes('Tofu'));</span>
<a href="#l18.63"></a><span id="l18.63">   do_check_false(response.includes('Corn'));</span>
<a href="#l18.64"></a><span id="l18.64"> </span>
<a href="#l18.65"></a><span id="l18.65">   yield true;</span>
<a href="#l18.66"></a><span id="l18.66"> }</span>
<a href="#l18.67"></a><span id="l18.67"> </span>
<a href="#l18.68"></a><span id="l18.68"> // test that 'LIST &quot;&quot; &quot;%&quot; RETURN (CHILDEREN)' returns the proper responses</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineminus">-function testListReturnChilderen()</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineplus">+function* testListReturnChilderen()</span>
<a href="#l18.71"></a><span id="l18.71"> {</span>
<a href="#l18.72"></a><span id="l18.72">   let response = handler.onError('4', 'LIST &quot;&quot; &quot;%&quot; RETURN (CHILDREN)');</span>
<a href="#l18.73"></a><span id="l18.73"> </span>
<a href="#l18.74"></a><span id="l18.74">   do_check_true(response.includes('* LIST (\\Marked \\NoInferiors) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l18.75"></a><span id="l18.75">   do_check_true(response.includes('* LIST (\\HasChildren) &quot;/&quot; &quot;Fruit&quot;'));</span>
<a href="#l18.76"></a><span id="l18.76">   do_check_true(response.includes('* LIST (\\HasNoChildren) &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l18.77"></a><span id="l18.77">   do_check_true(response.includes('* LIST (\\HasChildren) &quot;/&quot; &quot;Vegetable&quot;'));</span>
<a href="#l18.78"></a><span id="l18.78">   do_check_false(response.includes('Apple'));</span>
<a href="#l18.79"></a><span id="l18.79" class="difflineat">@@ -108,17 +108,17 @@ function testListReturnChilderen()</span>
<a href="#l18.80"></a><span id="l18.80">   do_check_false(response.includes('Peach'));</span>
<a href="#l18.81"></a><span id="l18.81">   do_check_false(response.includes('Broccoli'));</span>
<a href="#l18.82"></a><span id="l18.82">   do_check_false(response.includes('Corn'));</span>
<a href="#l18.83"></a><span id="l18.83"> </span>
<a href="#l18.84"></a><span id="l18.84">   yield true;</span>
<a href="#l18.85"></a><span id="l18.85"> }</span>
<a href="#l18.86"></a><span id="l18.86"> </span>
<a href="#l18.87"></a><span id="l18.87"> // test that 'LIST &quot;&quot; &quot;*&quot; RETURN (SUBSCRIBED)' returns the proper responses</span>
<a href="#l18.88"></a><span id="l18.88" class="difflineminus">-function testListReturnSubscribed()</span>
<a href="#l18.89"></a><span id="l18.89" class="difflineplus">+function* testListReturnSubscribed()</span>
<a href="#l18.90"></a><span id="l18.90"> {</span>
<a href="#l18.91"></a><span id="l18.91">   let response = handler.onError('5', 'LIST &quot;&quot; &quot;*&quot; RETURN (SUBSCRIBED)');</span>
<a href="#l18.92"></a><span id="l18.92"> </span>
<a href="#l18.93"></a><span id="l18.93">   do_check_true(response.includes('* LIST (\\Marked \\NoInferiors \\Subscribed) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l18.94"></a><span id="l18.94">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Fruit&quot;'));</span>
<a href="#l18.95"></a><span id="l18.95">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Fruit/Apple&quot;'));</span>
<a href="#l18.96"></a><span id="l18.96">   do_check_true(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Fruit/Banana&quot;'));</span>
<a href="#l18.97"></a><span id="l18.97">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l18.98"></a><span id="l18.98" class="difflineat">@@ -126,17 +126,17 @@ function testListReturnSubscribed()</span>
<a href="#l18.99"></a><span id="l18.99">   do_check_true(response.includes('* LIST (\\Subscribed) &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l18.100"></a><span id="l18.100">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Corn&quot;'));</span>
<a href="#l18.101"></a><span id="l18.101">   do_check_false(response.includes('Peach'));</span>
<a href="#l18.102"></a><span id="l18.102"> </span>
<a href="#l18.103"></a><span id="l18.103">   yield true;</span>
<a href="#l18.104"></a><span id="l18.104"> }</span>
<a href="#l18.105"></a><span id="l18.105"> </span>
<a href="#l18.106"></a><span id="l18.106"> // test that 'LIST &quot;&quot; (&quot;INBOX&quot; &quot;Tofu&quot; &quot;Vegetable/%&quot;)' returns the proper responses</span>
<a href="#l18.107"></a><span id="l18.107" class="difflineminus">-function testListSelectMultiple()</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineplus">+function* testListSelectMultiple()</span>
<a href="#l18.109"></a><span id="l18.109"> {</span>
<a href="#l18.110"></a><span id="l18.110">   let response = handler._dispatchCommand('LIST', ['', '(&quot;INBOX&quot; &quot;Tofu&quot; &quot;Vegetable/%&quot;)']);</span>
<a href="#l18.111"></a><span id="l18.111"> </span>
<a href="#l18.112"></a><span id="l18.112">   do_check_true(response.includes('* LIST (\\Marked \\NoInferiors) &quot;/&quot; &quot;INBOX&quot;'));</span>
<a href="#l18.113"></a><span id="l18.113">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Tofu&quot;'));</span>
<a href="#l18.114"></a><span id="l18.114">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Broccoli&quot;'));</span>
<a href="#l18.115"></a><span id="l18.115">   do_check_true(response.includes('* LIST () &quot;/&quot; &quot;Vegetable/Corn&quot;'));</span>
<a href="#l18.116"></a><span id="l18.116">   do_check_false(response.includes('&quot;Vegetable&quot;'));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMessageLater2.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMessageLater2.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -177,17 +177,17 @@ function sendUnsentMessages()</span>
<a href="#l19.4"></a><span id="l19.4">   return false;</span>
<a href="#l19.5"></a><span id="l19.5"> }</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> function runServerTest()</span>
<a href="#l19.8"></a><span id="l19.8"> {</span>
<a href="#l19.9"></a><span id="l19.9">   server.performTest();</span>
<a href="#l19.10"></a><span id="l19.10"> }</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-function actually_run_test() {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+function* actually_run_test() {</span>
<a href="#l19.14"></a><span id="l19.14">   dump(&quot;in actually_run_test\n&quot;);</span>
<a href="#l19.15"></a><span id="l19.15"> </span>
<a href="#l19.16"></a><span id="l19.16">   dump(&quot;Copy Mesage from file to folder\n&quot;);</span>
<a href="#l19.17"></a><span id="l19.17">   yield async_run({func: sendMessageLater, args: [0]});</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19">   dump(&quot;Send unsent message\n&quot;);</span>
<a href="#l19.20"></a><span id="l19.20">   yield async_run({func: sendUnsentMessages});</span>
<a href="#l19.21"></a><span id="l19.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/db/gloda/modules/indexer.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/indexer.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -814,24 +814,24 @@ var GlodaIndexer = {</span>
<a href="#l20.4"></a><span id="l20.4">       }</span>
<a href="#l20.5"></a><span id="l20.5">       else</span>
<a href="#l20.6"></a><span id="l20.6">         args = arguments; //Array.slice.call(arguments);</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8">       let result;</span>
<a href="#l20.9"></a><span id="l20.9">       if (args.length == 0)</span>
<a href="#l20.10"></a><span id="l20.10">         result = this._batch.next().value;</span>
<a href="#l20.11"></a><span id="l20.11">       else if (args.length == 1)</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-        result = this._batch.send(args[0]);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+        result = this._batch.next(args[0]).value;</span>
<a href="#l20.14"></a><span id="l20.14">       else // arguments works with destructuring assignment</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-        result = this._batch.send(args);</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+        result = this._batch.next(args).value;</span>
<a href="#l20.17"></a><span id="l20.17">       switch (result) {</span>
<a href="#l20.18"></a><span id="l20.18">         // job's done, close the batch and re-schedule ourselves if there's more</span>
<a href="#l20.19"></a><span id="l20.19">         //  to do.</span>
<a href="#l20.20"></a><span id="l20.20">         case this.kWorkDone:</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">-          this._batch.close();</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+          this._batch.return();</span>
<a href="#l20.23"></a><span id="l20.23">           this._batch = null;</span>
<a href="#l20.24"></a><span id="l20.24">           // (intentional fall-through to re-scheduling logic)</span>
<a href="#l20.25"></a><span id="l20.25">         // the batch wants to get re-scheduled, do so.</span>
<a href="#l20.26"></a><span id="l20.26">         case this.kWorkPause:</span>
<a href="#l20.27"></a><span id="l20.27">           if (this.indexing)</span>
<a href="#l20.28"></a><span id="l20.28">             this._timer.initWithCallback(this._timerCallbackDriver,</span>
<a href="#l20.29"></a><span id="l20.29">                                          this._INDEX_INTERVAL,</span>
<a href="#l20.30"></a><span id="l20.30">                                          Ci.nsITimer.TYPE_ONE_SHOT);</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineat">@@ -886,20 +886,20 @@ var GlodaIndexer = {</span>
<a href="#l20.32"></a><span id="l20.32">      * @public</span>
<a href="#l20.33"></a><span id="l20.33">      */</span>
<a href="#l20.34"></a><span id="l20.34">     pushAndGo: function gloda_index_callbackhandle_pushAndGo(aIterator,</span>
<a href="#l20.35"></a><span id="l20.35">                                                              aContext) {</span>
<a href="#l20.36"></a><span id="l20.36">       this.push(aIterator, aContext);</span>
<a href="#l20.37"></a><span id="l20.37">       return GlodaIndexer.kWorkSync;</span>
<a href="#l20.38"></a><span id="l20.38">     },</span>
<a href="#l20.39"></a><span id="l20.39">     /**</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">-     * Pop the active generator off the stack and close it.</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineplus">+     * Pop the active generator off the stack.</span>
<a href="#l20.42"></a><span id="l20.42">      */</span>
<a href="#l20.43"></a><span id="l20.43">     pop: function gloda_index_callbackhandle_pop() {</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-      this.activeIterator.close();</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+      this.activeIterator.return();</span>
<a href="#l20.46"></a><span id="l20.46">       this.activeStack.pop();</span>
<a href="#l20.47"></a><span id="l20.47">       this.contextStack.pop();</span>
<a href="#l20.48"></a><span id="l20.48">       if (this.activeStack.length)</span>
<a href="#l20.49"></a><span id="l20.49">         this.activeIterator = this.activeStack[this.activeStack.length - 1];</span>
<a href="#l20.50"></a><span id="l20.50">       else</span>
<a href="#l20.51"></a><span id="l20.51">         this.activeIterator = null;</span>
<a href="#l20.52"></a><span id="l20.52">     },</span>
<a href="#l20.53"></a><span id="l20.53">     /**</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineat">@@ -1007,31 +1007,30 @@ var GlodaIndexer = {</span>
<a href="#l20.55"></a><span id="l20.55">       //     are dominating the main thread.</span>
<a href="#l20.56"></a><span id="l20.56">       this._perfIndexStopwatch.start();</span>
<a href="#l20.57"></a><span id="l20.57">       // For telemetry purposes, we want to know how many messages we've been</span>
<a href="#l20.58"></a><span id="l20.58">       //  processing during that batch, and how long it took, pauses included.</span>
<a href="#l20.59"></a><span id="l20.59">       let t0 = Date.now();</span>
<a href="#l20.60"></a><span id="l20.60">       this._indexedMessageCount = 0;</span>
<a href="#l20.61"></a><span id="l20.61">       batchCount = 0;</span>
<a href="#l20.62"></a><span id="l20.62">       while (batchCount &lt; this._indexTokens) {</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineminus">-</span>
<a href="#l20.64"></a><span id="l20.64">         if ((this._callbackHandle.activeIterator === null) &amp;&amp;</span>
<a href="#l20.65"></a><span id="l20.65">             !this._hireJobWorker()) {</span>
<a href="#l20.66"></a><span id="l20.66">           haveMoreWork = false;</span>
<a href="#l20.67"></a><span id="l20.67">           break;</span>
<a href="#l20.68"></a><span id="l20.68">         }</span>
<a href="#l20.69"></a><span id="l20.69">         batchCount++;</span>
<a href="#l20.70"></a><span id="l20.70"> </span>
<a href="#l20.71"></a><span id="l20.71">         // XXX for performance, we may want to move the try outside the for loop</span>
<a href="#l20.72"></a><span id="l20.72">         //  with a quasi-redundant outer loop that shunts control back inside</span>
<a href="#l20.73"></a><span id="l20.73">         //  if we left the loop due to an exception (without consuming all the</span>
<a href="#l20.74"></a><span id="l20.74">         //  tokens.)</span>
<a href="#l20.75"></a><span id="l20.75">         try {</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineminus">-          switch (this._callbackHandle.activeIterator.send(</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineminus">-                    this._workBatchData)) {</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineplus">+          switch (this._callbackHandle</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineplus">+                      .activeIterator.next(this._workBatchData).value) {</span>
<a href="#l20.80"></a><span id="l20.80">             case this.kWorkSync:</span>
<a href="#l20.81"></a><span id="l20.81">               this._workBatchData = undefined;</span>
<a href="#l20.82"></a><span id="l20.82">               break;</span>
<a href="#l20.83"></a><span id="l20.83">             case this.kWorkAsync:</span>
<a href="#l20.84"></a><span id="l20.84">               this._workBatchData = yield this.kWorkAsync;</span>
<a href="#l20.85"></a><span id="l20.85">               break;</span>
<a href="#l20.86"></a><span id="l20.86">             case this.kWorkDone:</span>
<a href="#l20.87"></a><span id="l20.87">               this._callbackHandle.pop();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/base_gloda_content.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/base_gloda_content.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -119,17 +119,17 @@ function glodaInfoStasher(aSynthMessage,</span>
<a href="#l21.4"></a><span id="l21.4">       messageInfos[iMsg]._glodaMsg = aGlodaMessage;</span>
<a href="#l21.5"></a><span id="l21.5">     }</span>
<a href="#l21.6"></a><span id="l21.6">   }</span>
<a href="#l21.7"></a><span id="l21.7"> }</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9"> /**</span>
<a href="#l21.10"></a><span id="l21.10">  * Actually inject all the messages we created above.</span>
<a href="#l21.11"></a><span id="l21.11">  */</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-function setup_inject_messages() {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+function* setup_inject_messages() {</span>
<a href="#l21.14"></a><span id="l21.14">   let msgSet = new SyntheticMessageSet(messageInfos.map(info =&gt; info._synMsg));</span>
<a href="#l21.15"></a><span id="l21.15">   let folder = make_empty_folder();</span>
<a href="#l21.16"></a><span id="l21.16">   yield add_sets_to_folders(folder, [msgSet]);</span>
<a href="#l21.17"></a><span id="l21.17">   yield wait_for_gloda_indexer(msgSet, {verifier: glodaInfoStasher});</span>
<a href="#l21.18"></a><span id="l21.18"> }</span>
<a href="#l21.19"></a><span id="l21.19"> </span>
<a href="#l21.20"></a><span id="l21.20"> function test_stream_message(info) {</span>
<a href="#l21.21"></a><span id="l21.21">   let msgHdr = info._glodaMsg.folderMessage;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/base_index_junk.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/base_index_junk.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -15,17 +15,17 @@ load(&quot;resources/glodaTestHelper.js&quot;);</span>
<a href="#l22.4"></a><span id="l22.4"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l22.5"></a><span id="l22.5"> </span>
<a href="#l22.6"></a><span id="l22.6"> var SPAM_BODY = {body: &quot;superspam superspam superspam eevil eevil eevil&quot;};</span>
<a href="#l22.7"></a><span id="l22.7"> var HAM_BODY = {body: &quot;ham ham ham nice nice nice happy happy happy&quot;};</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9"> /**</span>
<a href="#l22.10"></a><span id="l22.10">  * Make SPAM_BODY be known as spammy and HAM_BODY be known as hammy.</span>
<a href="#l22.11"></a><span id="l22.11">  */</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-function setup_spam_filter() {</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+function* setup_spam_filter() {</span>
<a href="#l22.14"></a><span id="l22.14">   let [folder, spamSet, hamSet] = make_folder_with_sets([</span>
<a href="#l22.15"></a><span id="l22.15">     {count: 1, body: SPAM_BODY}, {count: 1, body: HAM_BODY}]);</span>
<a href="#l22.16"></a><span id="l22.16">   yield wait_for_message_injection();</span>
<a href="#l22.17"></a><span id="l22.17">   yield wait_for_gloda_indexer([spamSet, hamSet]);</span>
<a href="#l22.18"></a><span id="l22.18"> </span>
<a href="#l22.19"></a><span id="l22.19">   let junkListener = {</span>
<a href="#l22.20"></a><span id="l22.20">     onMessageClassified: function() {</span>
<a href="#l22.21"></a><span id="l22.21">       async_driver();</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineat">@@ -54,17 +54,17 @@ function setup_spam_filter() {</span>
<a href="#l22.23"></a><span id="l22.23"> /**</span>
<a href="#l22.24"></a><span id="l22.24">  * Because gloda defers indexing until after junk, we should never index a</span>
<a href="#l22.25"></a><span id="l22.25">  *  message that gets marked as junk.  So if we inject a message that will</span>
<a href="#l22.26"></a><span id="l22.26">  *  definitely be marked as junk (thanks to use of terms that guarantee it),</span>
<a href="#l22.27"></a><span id="l22.27">  *  the indexer should never index it.</span>
<a href="#l22.28"></a><span id="l22.28">  *</span>
<a href="#l22.29"></a><span id="l22.29">  * ONLY THIS TEST ACTUALLY RELIES ON THE BAYESIAN CLASSIFIER.</span>
<a href="#l22.30"></a><span id="l22.30">  */</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-function test_never_indexes_a_message_marked_as_junk() {</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+function* test_never_indexes_a_message_marked_as_junk() {</span>
<a href="#l22.33"></a><span id="l22.33">   mark_sub_test_start(&quot;event-driven does not index junk&quot;);</span>
<a href="#l22.34"></a><span id="l22.34"> </span>
<a href="#l22.35"></a><span id="l22.35">   // make a message that will be marked as junk from the get-go</span>
<a href="#l22.36"></a><span id="l22.36">   let [folder, msgSet] = make_folder_with_sets([{count: 1, body: SPAM_BODY}]);</span>
<a href="#l22.37"></a><span id="l22.37">   yield wait_for_message_injection();</span>
<a href="#l22.38"></a><span id="l22.38">   // since the message is junk, gloda should not index it!</span>
<a href="#l22.39"></a><span id="l22.39">   yield wait_for_gloda_indexer([]);</span>
<a href="#l22.40"></a><span id="l22.40"> </span>
<a href="#l22.41"></a><span id="l22.41" class="difflineat">@@ -81,17 +81,17 @@ function reset_spam_filter() {</span>
<a href="#l22.42"></a><span id="l22.42"> }</span>
<a href="#l22.43"></a><span id="l22.43"> </span>
<a href="#l22.44"></a><span id="l22.44"> /**</span>
<a href="#l22.45"></a><span id="l22.45">  * Marking a message as junk is equivalent to deleting the message, un-mark it</span>
<a href="#l22.46"></a><span id="l22.46">  *  and it should go back to being a happy message (with the same gloda-id!).</span>
<a href="#l22.47"></a><span id="l22.47">  *</span>
<a href="#l22.48"></a><span id="l22.48">  * THIS TEST DOES NOT RELY ON THE BAYESIAN CLASSIFIER.</span>
<a href="#l22.49"></a><span id="l22.49">  */</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineminus">-function test_mark_as_junk_is_deletion_mark_as_not_junk_is_exposure() {</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineplus">+function* test_mark_as_junk_is_deletion_mark_as_not_junk_is_exposure() {</span>
<a href="#l22.52"></a><span id="l22.52">   mark_sub_test_start(&quot;mark as junk is deletion&quot;);</span>
<a href="#l22.53"></a><span id="l22.53">   // create a message; it should get indexed</span>
<a href="#l22.54"></a><span id="l22.54">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l22.55"></a><span id="l22.55">   yield wait_for_message_injection();</span>
<a href="#l22.56"></a><span id="l22.56">   yield wait_for_gloda_indexer([msgSet], {augment: true});</span>
<a href="#l22.57"></a><span id="l22.57"> </span>
<a href="#l22.58"></a><span id="l22.58">   let glodaId = msgSet.glodaMessages[0].id;</span>
<a href="#l22.59"></a><span id="l22.59"> </span>
<a href="#l22.60"></a><span id="l22.60" class="difflineat">@@ -114,17 +114,17 @@ function test_mark_as_junk_is_deletion_m</span>
<a href="#l22.61"></a><span id="l22.61">  * Moving a message to the junk folder is equivalent to deletion.  Gloda does</span>
<a href="#l22.62"></a><span id="l22.62">  *  not index junk folders at all, which is why this is an important and</span>
<a href="#l22.63"></a><span id="l22.63">  *  independent determination from marking a message directly as junk.</span>
<a href="#l22.64"></a><span id="l22.64">  *</span>
<a href="#l22.65"></a><span id="l22.65">  * The move to the junk folder is performed without using any explicit junk</span>
<a href="#l22.66"></a><span id="l22.66">  *  support code.  This ends up being effectively the same underlying logic test</span>
<a href="#l22.67"></a><span id="l22.67">  *  as base_index_messages' test of moving a message to the trash folder.</span>
<a href="#l22.68"></a><span id="l22.68">  */</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineminus">-function test_message_moving_to_junk_folder_is_deletion() {</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineplus">+function* test_message_moving_to_junk_folder_is_deletion() {</span>
<a href="#l22.71"></a><span id="l22.71">   // create and index two messages in a conversation</span>
<a href="#l22.72"></a><span id="l22.72">   let [folder, msgSet] = make_folder_with_sets([{count: 2, msgsPerThread: 2}]);</span>
<a href="#l22.73"></a><span id="l22.73">   yield wait_for_message_injection();</span>
<a href="#l22.74"></a><span id="l22.74">   yield wait_for_gloda_indexer([msgSet], {augment: true});</span>
<a href="#l22.75"></a><span id="l22.75"> </span>
<a href="#l22.76"></a><span id="l22.76">   let convId = msgSet.glodaMessages[0].conversation.id;</span>
<a href="#l22.77"></a><span id="l22.77">   let firstGlodaId = msgSet.glodaMessages[0].id;</span>
<a href="#l22.78"></a><span id="l22.78">   let secondGlodaId = msgSet.glodaMessages[1].id;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/base_index_messages.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/base_index_messages.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -32,17 +32,17 @@ var goOffline = false;</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5"> /* ===== Indexing Basics ===== */</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7"> /**</span>
<a href="#l23.8"></a><span id="l23.8">  * Index a message, wait for a commit, make sure the header gets the property</span>
<a href="#l23.9"></a><span id="l23.9">  *  set correctly.  Then modify the message, verify the dirty property shows</span>
<a href="#l23.10"></a><span id="l23.10">  *  up, flush again, and make sure the dirty property goes clean again.</span>
<a href="#l23.11"></a><span id="l23.11">  */</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-function test_pending_commit_tracker_flushes_correctly() {</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+function* test_pending_commit_tracker_flushes_correctly() {</span>
<a href="#l23.14"></a><span id="l23.14">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l23.15"></a><span id="l23.15">   yield wait_for_message_injection();</span>
<a href="#l23.16"></a><span id="l23.16">   yield wait_for_gloda_indexer(msgSet, {augment: true});</span>
<a href="#l23.17"></a><span id="l23.17"> </span>
<a href="#l23.18"></a><span id="l23.18">   // before the flush, there should be no gloda-id property</span>
<a href="#l23.19"></a><span id="l23.19">   let msgHdr = msgSet.getMsgHdr(0);</span>
<a href="#l23.20"></a><span id="l23.20">   // get it as a string to make sure it's empty rather than possessing a value</span>
<a href="#l23.21"></a><span id="l23.21">   do_check_eq(msgHdr.getStringProperty(&quot;gloda-id&quot;), &quot;&quot;);</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineat">@@ -75,17 +75,17 @@ function test_pending_commit_tracker_flu</span>
<a href="#l23.23"></a><span id="l23.23"> }</span>
<a href="#l23.24"></a><span id="l23.24"> </span>
<a href="#l23.25"></a><span id="l23.25"> /**</span>
<a href="#l23.26"></a><span id="l23.26">  * Make sure that PendingCommitTracker causes a msgdb commit to occur so that</span>
<a href="#l23.27"></a><span id="l23.27">  *  if the nsIMsgFolder's msgDatabase attribute has already been nulled</span>
<a href="#l23.28"></a><span id="l23.28">  *  (which is normally how we force a msgdb commit), that the changes to the</span>
<a href="#l23.29"></a><span id="l23.29">  *  header actually hit the disk.</span>
<a href="#l23.30"></a><span id="l23.30">  */</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-function test_pending_commit_causes_msgdb_commit() {</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+function* test_pending_commit_causes_msgdb_commit() {</span>
<a href="#l23.33"></a><span id="l23.33">   // new message, index it</span>
<a href="#l23.34"></a><span id="l23.34">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l23.35"></a><span id="l23.35">   yield wait_for_message_injection();</span>
<a href="#l23.36"></a><span id="l23.36">   yield wait_for_gloda_indexer(msgSet, {augment: true});</span>
<a href="#l23.37"></a><span id="l23.37"> </span>
<a href="#l23.38"></a><span id="l23.38">   // force the msgDatabase closed; the sqlite commit will not yet have occurred</span>
<a href="#l23.39"></a><span id="l23.39">   get_real_injection_folder(folder).msgDatabase = null;</span>
<a href="#l23.40"></a><span id="l23.40">   // make the commit happen, this causes the header to get set.</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineat">@@ -102,17 +102,17 @@ function test_pending_commit_causes_msgd</span>
<a href="#l23.42"></a><span id="l23.42"> /**</span>
<a href="#l23.43"></a><span id="l23.43">  * Give the indexing sweep a workout.</span>
<a href="#l23.44"></a><span id="l23.44">  *</span>
<a href="#l23.45"></a><span id="l23.45">  * This includes:</span>
<a href="#l23.46"></a><span id="l23.46">  * - Basic indexing sweep across never-before-indexed folders.</span>
<a href="#l23.47"></a><span id="l23.47">  * - Indexing sweep across folders with just some changes.</span>
<a href="#l23.48"></a><span id="l23.48">  * - Filthy pass.</span>
<a href="#l23.49"></a><span id="l23.49">  */</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineminus">-function test_indexing_sweep() {</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineplus">+function* test_indexing_sweep() {</span>
<a href="#l23.52"></a><span id="l23.52">   // -- Never-before-indexed folders</span>
<a href="#l23.53"></a><span id="l23.53">   mark_sub_test_start(&quot;never before indexed folders&quot;);</span>
<a href="#l23.54"></a><span id="l23.54">   // turn off event-driven indexing</span>
<a href="#l23.55"></a><span id="l23.55">   configure_gloda_indexing({event: false});</span>
<a href="#l23.56"></a><span id="l23.56"> </span>
<a href="#l23.57"></a><span id="l23.57">   let [folderA, setA1, setA2] = make_folder_with_sets([{count: 3},</span>
<a href="#l23.58"></a><span id="l23.58">                                                        {count: 2}]);</span>
<a href="#l23.59"></a><span id="l23.59">   yield wait_for_message_injection();</span>
<a href="#l23.60"></a><span id="l23.60" class="difflineat">@@ -194,17 +194,17 @@ function test_indexing_sweep() {</span>
<a href="#l23.61"></a><span id="l23.61"> }</span>
<a href="#l23.62"></a><span id="l23.62"> </span>
<a href="#l23.63"></a><span id="l23.63"> </span>
<a href="#l23.64"></a><span id="l23.64"> /**</span>
<a href="#l23.65"></a><span id="l23.65">  * We used to screw up and downgrade filthy folders to dirty if we saw an event</span>
<a href="#l23.66"></a><span id="l23.66">  *  happen in the folder before we got to the folder; this tests that we no</span>
<a href="#l23.67"></a><span id="l23.67">  *  longer do that.</span>
<a href="#l23.68"></a><span id="l23.68">  */</span>
<a href="#l23.69"></a><span id="l23.69" class="difflineminus">-function test_event_driven_indexing_does_not_mess_with_filthy_folders() {</span>
<a href="#l23.70"></a><span id="l23.70" class="difflineplus">+function* test_event_driven_indexing_does_not_mess_with_filthy_folders() {</span>
<a href="#l23.71"></a><span id="l23.71">   // add a folder with a message.</span>
<a href="#l23.72"></a><span id="l23.72">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l23.73"></a><span id="l23.73">   yield wait_for_message_injection();</span>
<a href="#l23.74"></a><span id="l23.74">   yield wait_for_gloda_indexer([msgSet]);</span>
<a href="#l23.75"></a><span id="l23.75"> </span>
<a href="#l23.76"></a><span id="l23.76">   // fake marking the folder filthy.</span>
<a href="#l23.77"></a><span id="l23.77">   let glodaFolder = Gloda.getFolderForFolder(get_real_injection_folder(folder));</span>
<a href="#l23.78"></a><span id="l23.78">   glodaFolder._dirtyStatus = glodaFolder.kFolderFilthy;</span>
<a href="#l23.79"></a><span id="l23.79" class="difflineat">@@ -222,17 +222,17 @@ function test_event_driven_indexing_does</span>
<a href="#l23.80"></a><span id="l23.80">   // make the folder dirty and let an indexing sweep take care of this so we</span>
<a href="#l23.81"></a><span id="l23.81">   //  don't get extra events in subsequent tests.</span>
<a href="#l23.82"></a><span id="l23.82">   glodaFolder._dirtyStatus = glodaFolder.kFolderDirty;</span>
<a href="#l23.83"></a><span id="l23.83">   GlodaMsgIndexer.indexingSweepNeeded = true;</span>
<a href="#l23.84"></a><span id="l23.84">   // (the message won't get indexed though)</span>
<a href="#l23.85"></a><span id="l23.85">   yield wait_for_gloda_indexer([]);</span>
<a href="#l23.86"></a><span id="l23.86"> }</span>
<a href="#l23.87"></a><span id="l23.87"> </span>
<a href="#l23.88"></a><span id="l23.88" class="difflineminus">-function test_indexing_never_priority() {</span>
<a href="#l23.89"></a><span id="l23.89" class="difflineplus">+function* test_indexing_never_priority() {</span>
<a href="#l23.90"></a><span id="l23.90"> </span>
<a href="#l23.91"></a><span id="l23.91">   // add a folder with a bunch of messages</span>
<a href="#l23.92"></a><span id="l23.92">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l23.93"></a><span id="l23.93">   yield wait_for_message_injection();</span>
<a href="#l23.94"></a><span id="l23.94"> </span>
<a href="#l23.95"></a><span id="l23.95">   // index it, and augment the msgSet with the glodaMessages array</span>
<a href="#l23.96"></a><span id="l23.96">   // for later use by sqlExpectCount</span>
<a href="#l23.97"></a><span id="l23.97">   yield wait_for_gloda_indexer([msgSet], {augment: true});</span>
<a href="#l23.98"></a><span id="l23.98" class="difflineat">@@ -258,17 +258,17 @@ function test_indexing_never_priority() </span>
<a href="#l23.99"></a><span id="l23.99">   make_new_sets_in_folder(folder, [{count: 1}]);</span>
<a href="#l23.100"></a><span id="l23.100">   yield wait_for_message_injection();</span>
<a href="#l23.101"></a><span id="l23.101"> </span>
<a href="#l23.102"></a><span id="l23.102">   // make sure that indexing returns nothing</span>
<a href="#l23.103"></a><span id="l23.103">   GlodaMsgIndexer.indexingSweepNeeded = true;</span>
<a href="#l23.104"></a><span id="l23.104">   yield wait_for_gloda_indexer([]);</span>
<a href="#l23.105"></a><span id="l23.105"> }</span>
<a href="#l23.106"></a><span id="l23.106"> </span>
<a href="#l23.107"></a><span id="l23.107" class="difflineminus">-function test_setting_indexing_priority_never_while_indexing() {</span>
<a href="#l23.108"></a><span id="l23.108" class="difflineplus">+function* test_setting_indexing_priority_never_while_indexing() {</span>
<a href="#l23.109"></a><span id="l23.109"> </span>
<a href="#l23.110"></a><span id="l23.110">   if (!message_injection_is_local())</span>
<a href="#l23.111"></a><span id="l23.111">     return;</span>
<a href="#l23.112"></a><span id="l23.112"> </span>
<a href="#l23.113"></a><span id="l23.113">   // Configure the gloda indexer to hang while streaming the message.</span>
<a href="#l23.114"></a><span id="l23.114">   configure_gloda_indexing({hangWhile: &quot;streaming&quot;});</span>
<a href="#l23.115"></a><span id="l23.115"> </span>
<a href="#l23.116"></a><span id="l23.116">   // create a folder with a message inside.</span>
<a href="#l23.117"></a><span id="l23.117" class="difflineat">@@ -309,34 +309,34 @@ function allMessageInSameConversation(aS</span>
<a href="#l23.118"></a><span id="l23.118"> }</span>
<a href="#l23.119"></a><span id="l23.119"> </span>
<a href="#l23.120"></a><span id="l23.120"> /**</span>
<a href="#l23.121"></a><span id="l23.121">  * Test our conversation/threading logic in the straight-forward direct</span>
<a href="#l23.122"></a><span id="l23.122">  *  reply case, the missing intermediary case, and the siblings with missing</span>
<a href="#l23.123"></a><span id="l23.123">  *  parent case.  We also test all permutations of receipt of those messages.</span>
<a href="#l23.124"></a><span id="l23.124">  * (Also tests that we index new messages.)</span>
<a href="#l23.125"></a><span id="l23.125">  */</span>
<a href="#l23.126"></a><span id="l23.126" class="difflineminus">-function test_threading() {</span>
<a href="#l23.127"></a><span id="l23.127" class="difflineplus">+function* test_threading() {</span>
<a href="#l23.128"></a><span id="l23.128">   mark_sub_test_start(&quot;direct reply&quot;);</span>
<a href="#l23.129"></a><span id="l23.129">   yield indexAndPermuteMessages(scenarios.directReply,</span>
<a href="#l23.130"></a><span id="l23.130">                                 allMessageInSameConversation);</span>
<a href="#l23.131"></a><span id="l23.131">   mark_sub_test_start(&quot;missing intermediary&quot;);</span>
<a href="#l23.132"></a><span id="l23.132">   yield indexAndPermuteMessages(scenarios.missingIntermediary,</span>
<a href="#l23.133"></a><span id="l23.133">                                 allMessageInSameConversation);</span>
<a href="#l23.134"></a><span id="l23.134">   mark_sub_test_start(&quot;siblings missing parent&quot;);</span>
<a href="#l23.135"></a><span id="l23.135">   yield indexAndPermuteMessages(scenarios.siblingsMissingParent,</span>
<a href="#l23.136"></a><span id="l23.136">                                 allMessageInSameConversation);</span>
<a href="#l23.137"></a><span id="l23.137"> }</span>
<a href="#l23.138"></a><span id="l23.138"> </span>
<a href="#l23.139"></a><span id="l23.139"> /**</span>
<a href="#l23.140"></a><span id="l23.140">  * Test the bit that says &quot;if we're fulltext-indexing the message and we</span>
<a href="#l23.141"></a><span id="l23.141">  *  discover it didn't have any attachments, clear the attachment bit from the</span>
<a href="#l23.142"></a><span id="l23.142">  *  message header&quot;.</span>
<a href="#l23.143"></a><span id="l23.143">  */</span>
<a href="#l23.144"></a><span id="l23.144" class="difflineminus">-function test_attachment_flag() {</span>
<a href="#l23.145"></a><span id="l23.145" class="difflineplus">+function* test_attachment_flag() {</span>
<a href="#l23.146"></a><span id="l23.146">   // create a synthetic message with an attachment that won't normally be listed</span>
<a href="#l23.147"></a><span id="l23.147">   // in the attachment pane (Content-Disposition: inline, no filename, and</span>
<a href="#l23.148"></a><span id="l23.148">   // displayable inline)</span>
<a href="#l23.149"></a><span id="l23.149">   let smsg = msgGen.makeMessage({</span>
<a href="#l23.150"></a><span id="l23.150">     name: 'test message with part 1.2 attachment',</span>
<a href="#l23.151"></a><span id="l23.151">     attachments: [{ body: 'attachment',</span>
<a href="#l23.152"></a><span id="l23.152">                     filename: '',</span>
<a href="#l23.153"></a><span id="l23.153">                     format: '' }],</span>
<a href="#l23.154"></a><span id="l23.154" class="difflineat">@@ -387,17 +387,17 @@ var fundamentalGlodaMsgAttachmentUrls;</span>
<a href="#l23.155"></a><span id="l23.155"> var fundamentalGlodaMessageId;</span>
<a href="#l23.156"></a><span id="l23.156"> </span>
<a href="#l23.157"></a><span id="l23.157"> /**</span>
<a href="#l23.158"></a><span id="l23.158">  * Test that we extract the 'fundamental attributes' of a message properly</span>
<a href="#l23.159"></a><span id="l23.159">  *  'Fundamental' in this case is talking about the attributes defined/extracted</span>
<a href="#l23.160"></a><span id="l23.160">  *  by gloda's fundattr.js and perhaps the core message indexing logic itself</span>
<a href="#l23.161"></a><span id="l23.161">  *  (which show up as kSpecial* attributes in fundattr.js anyways.)</span>
<a href="#l23.162"></a><span id="l23.162">  */</span>
<a href="#l23.163"></a><span id="l23.163" class="difflineminus">-function test_attributes_fundamental() {</span>
<a href="#l23.164"></a><span id="l23.164" class="difflineplus">+function* test_attributes_fundamental() {</span>
<a href="#l23.165"></a><span id="l23.165">   // create a synthetic message with attachment</span>
<a href="#l23.166"></a><span id="l23.166">   let smsg = msgGen.makeMessage({</span>
<a href="#l23.167"></a><span id="l23.167">     name: 'test message',</span>
<a href="#l23.168"></a><span id="l23.168">     bodyPart: new SyntheticPartMultiMixed([</span>
<a href="#l23.169"></a><span id="l23.169">       new SyntheticPartLeaf({body: 'I like cheese!'}),</span>
<a href="#l23.170"></a><span id="l23.170">       msgGen.makeMessage({ body: { body: 'I like wine!' }}), // that's one attachment</span>
<a href="#l23.171"></a><span id="l23.171">     ]),</span>
<a href="#l23.172"></a><span id="l23.172">     attachments: [</span>
<a href="#l23.173"></a><span id="l23.173" class="difflineat">@@ -499,17 +499,17 @@ function verify_attributes_fundamental(s</span>
<a href="#l23.174"></a><span id="l23.174">   }</span>
<a href="#l23.175"></a><span id="l23.175"> }</span>
<a href="#l23.176"></a><span id="l23.176"> </span>
<a href="#l23.177"></a><span id="l23.177"> /**</span>
<a href="#l23.178"></a><span id="l23.178">  * We now move the message into another folder, wait for it to be indexed,</span>
<a href="#l23.179"></a><span id="l23.179">  * and make sure the magic url getter for GlodaAttachment returns a proper</span>
<a href="#l23.180"></a><span id="l23.180">  * URL.</span>
<a href="#l23.181"></a><span id="l23.181">  */</span>
<a href="#l23.182"></a><span id="l23.182" class="difflineminus">-function test_moved_message_attributes() {</span>
<a href="#l23.183"></a><span id="l23.183" class="difflineplus">+function* test_moved_message_attributes() {</span>
<a href="#l23.184"></a><span id="l23.184">   if (!expectFulltextResults)</span>
<a href="#l23.185"></a><span id="l23.185">     return;</span>
<a href="#l23.186"></a><span id="l23.186"> </span>
<a href="#l23.187"></a><span id="l23.187">   // Don't ask me why, let destFolder = make_empty_folder would result in a</span>
<a href="#l23.188"></a><span id="l23.188">   // random error when running test_index_messages_imap_offline.js ...</span>
<a href="#l23.189"></a><span id="l23.189">   let [destFolder, ignoreSet] = make_folder_with_sets([{count: 2}]);</span>
<a href="#l23.190"></a><span id="l23.190">   fundamentalFolderHandle = destFolder;</span>
<a href="#l23.191"></a><span id="l23.191">   yield wait_for_message_injection();</span>
<a href="#l23.192"></a><span id="l23.192" class="difflineat">@@ -574,17 +574,17 @@ function verify_attributes_fundamental_f</span>
<a href="#l23.193"></a><span id="l23.193">   return aGlodaMessage.headerMessageID;</span>
<a href="#l23.194"></a><span id="l23.194"> }</span>
<a href="#l23.195"></a><span id="l23.195"> </span>
<a href="#l23.196"></a><span id="l23.196"> /* ===== Explicit Attributes (per explattr.js) ===== */</span>
<a href="#l23.197"></a><span id="l23.197"> </span>
<a href="#l23.198"></a><span id="l23.198"> /**</span>
<a href="#l23.199"></a><span id="l23.199">  * Test the attributes defined by explattr.js.</span>
<a href="#l23.200"></a><span id="l23.200">  */</span>
<a href="#l23.201"></a><span id="l23.201" class="difflineminus">-function test_attributes_explicit() {</span>
<a href="#l23.202"></a><span id="l23.202" class="difflineplus">+function* test_attributes_explicit() {</span>
<a href="#l23.203"></a><span id="l23.203">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l23.204"></a><span id="l23.204">   yield wait_for_message_injection();</span>
<a href="#l23.205"></a><span id="l23.205">   yield wait_for_gloda_indexer(msgSet, {augment: true});</span>
<a href="#l23.206"></a><span id="l23.206">   let gmsg = msgSet.glodaMessages[0];</span>
<a href="#l23.207"></a><span id="l23.207"> </span>
<a href="#l23.208"></a><span id="l23.208">   // -- Star</span>
<a href="#l23.209"></a><span id="l23.209">   mark_sub_test_start(&quot;Star&quot;);</span>
<a href="#l23.210"></a><span id="l23.210">   msgSet.setStarred(true);</span>
<a href="#l23.211"></a><span id="l23.211" class="difflineat">@@ -637,17 +637,17 @@ function test_attributes_explicit() {</span>
<a href="#l23.212"></a><span id="l23.212"> </span>
<a href="#l23.213"></a><span id="l23.213">   // -- Forwarded</span>
<a href="#l23.214"></a><span id="l23.214"> }</span>
<a href="#l23.215"></a><span id="l23.215"> </span>
<a href="#l23.216"></a><span id="l23.216"> </span>
<a href="#l23.217"></a><span id="l23.217"> /**</span>
<a href="#l23.218"></a><span id="l23.218">  * Test non-query-able attributes</span>
<a href="#l23.219"></a><span id="l23.219">  */</span>
<a href="#l23.220"></a><span id="l23.220" class="difflineminus">-function test_attributes_cant_query() {</span>
<a href="#l23.221"></a><span id="l23.221" class="difflineplus">+function* test_attributes_cant_query() {</span>
<a href="#l23.222"></a><span id="l23.222">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l23.223"></a><span id="l23.223">   yield wait_for_message_injection();</span>
<a href="#l23.224"></a><span id="l23.224">   yield wait_for_gloda_indexer(msgSet, {augment: true});</span>
<a href="#l23.225"></a><span id="l23.225">   let gmsg = msgSet.glodaMessages[0];</span>
<a href="#l23.226"></a><span id="l23.226"> </span>
<a href="#l23.227"></a><span id="l23.227">   // -- Star</span>
<a href="#l23.228"></a><span id="l23.228">   mark_sub_test_start(&quot;Star&quot;);</span>
<a href="#l23.229"></a><span id="l23.229">   msgSet.setStarred(true);</span>
<a href="#l23.230"></a><span id="l23.230" class="difflineat">@@ -678,17 +678,17 @@ function test_attributes_cant_query() {</span>
<a href="#l23.231"></a><span id="l23.231"> </span>
<a href="#l23.232"></a><span id="l23.232">   // -- Forwarded</span>
<a href="#l23.233"></a><span id="l23.233"> }</span>
<a href="#l23.234"></a><span id="l23.234"> </span>
<a href="#l23.235"></a><span id="l23.235"> /**</span>
<a href="#l23.236"></a><span id="l23.236">  * Have the participants be in our addressbook prior to indexing so that we can</span>
<a href="#l23.237"></a><span id="l23.237">  *  verify that the hand-off to the addressbook indexer does not cause breakage.</span>
<a href="#l23.238"></a><span id="l23.238">  */</span>
<a href="#l23.239"></a><span id="l23.239" class="difflineminus">-function test_people_in_addressbook() {</span>
<a href="#l23.240"></a><span id="l23.240" class="difflineplus">+function* test_people_in_addressbook() {</span>
<a href="#l23.241"></a><span id="l23.241">   var senderPair = msgGen.makeNameAndAddress(),</span>
<a href="#l23.242"></a><span id="l23.242">       recipPair = msgGen.makeNameAndAddress();</span>
<a href="#l23.243"></a><span id="l23.243">   </span>
<a href="#l23.244"></a><span id="l23.244">   // - add both people to the address book</span>
<a href="#l23.245"></a><span id="l23.245">   makeABCardForAddressPair(senderPair);</span>
<a href="#l23.246"></a><span id="l23.246">   makeABCardForAddressPair(recipPair);</span>
<a href="#l23.247"></a><span id="l23.247"> </span>
<a href="#l23.248"></a><span id="l23.248">   let [folder, msgSet] = make_folder_with_sets([</span>
<a href="#l23.249"></a><span id="l23.249" class="difflineat">@@ -709,17 +709,17 @@ function test_people_in_addressbook() {</span>
<a href="#l23.250"></a><span id="l23.250"> /* ===== fulltexts Indexing ===== */</span>
<a href="#l23.251"></a><span id="l23.251"> </span>
<a href="#l23.252"></a><span id="l23.252"> /**</span>
<a href="#l23.253"></a><span id="l23.253">  * Make sure that we are using the saneBodySize flag.  This is basically the</span>
<a href="#l23.254"></a><span id="l23.254">  *  test_sane_bodies test from test_mime_emitter but we pull the indexedBodyText</span>
<a href="#l23.255"></a><span id="l23.255">  *  off the message to check and also make sure that the text contents slice</span>
<a href="#l23.256"></a><span id="l23.256">  *  off the end rather than the beginning.</span>
<a href="#l23.257"></a><span id="l23.257">  */</span>
<a href="#l23.258"></a><span id="l23.258" class="difflineminus">-function test_streamed_bodies_are_size_capped() {</span>
<a href="#l23.259"></a><span id="l23.259" class="difflineplus">+function* test_streamed_bodies_are_size_capped() {</span>
<a href="#l23.260"></a><span id="l23.260">   if (!expectFulltextResults)</span>
<a href="#l23.261"></a><span id="l23.261">     return;</span>
<a href="#l23.262"></a><span id="l23.262"> </span>
<a href="#l23.263"></a><span id="l23.263">   let hugeString =</span>
<a href="#l23.264"></a><span id="l23.264">     &quot;qqqqxxxx qqqqxxx qqqqxxx qqqqxxx qqqqxxx qqqqxxx qqqqxxx \r\n&quot;;</span>
<a href="#l23.265"></a><span id="l23.265">   const powahsOfTwo = 10;</span>
<a href="#l23.266"></a><span id="l23.266">   for (let i = 0; i &lt; powahsOfTwo; i++) {</span>
<a href="#l23.267"></a><span id="l23.267">     hugeString = hugeString + hugeString;</span>
<a href="#l23.268"></a><span id="l23.268" class="difflineat">@@ -753,17 +753,17 @@ function test_streamed_bodies_are_size_c</span>
<a href="#l23.269"></a><span id="l23.269">  * Test actually deleting a message on a per-message basis (not just nuking the</span>
<a href="#l23.270"></a><span id="l23.270">  *  folder like emptying the trash does.)</span>
<a href="#l23.271"></a><span id="l23.271">  *</span>
<a href="#l23.272"></a><span id="l23.272">  * Logic situations:</span>
<a href="#l23.273"></a><span id="l23.273">  * - Non-last message in a conversation, twin.</span>
<a href="#l23.274"></a><span id="l23.274">  * - Non-last message in a conversation, not a twin.</span>
<a href="#l23.275"></a><span id="l23.275">  * - Last message in a conversation</span>
<a href="#l23.276"></a><span id="l23.276">  */</span>
<a href="#l23.277"></a><span id="l23.277" class="difflineminus">-function test_message_deletion() {</span>
<a href="#l23.278"></a><span id="l23.278" class="difflineplus">+function* test_message_deletion() {</span>
<a href="#l23.279"></a><span id="l23.279">   mark_sub_test_start(&quot;non-last message in conv, twin&quot;);</span>
<a href="#l23.280"></a><span id="l23.280">   // create and index two messages in a conversation</span>
<a href="#l23.281"></a><span id="l23.281">   let [folder, convSet] = make_folder_with_sets([{count: 2, msgsPerThread: 2}]);</span>
<a href="#l23.282"></a><span id="l23.282">   yield wait_for_message_injection();</span>
<a href="#l23.283"></a><span id="l23.283">   yield wait_for_gloda_indexer([convSet], {augment: true});</span>
<a href="#l23.284"></a><span id="l23.284"> </span>
<a href="#l23.285"></a><span id="l23.285">   // Twin the first message in a different folder owing to our reliance on</span>
<a href="#l23.286"></a><span id="l23.286">   //  message-id's in the SyntheticMessageSet logic.  (This is also why we broke</span>
<a href="#l23.287"></a><span id="l23.287" class="difflineat">@@ -918,17 +918,17 @@ function test_message_deletion() {</span>
<a href="#l23.288"></a><span id="l23.288"> </span>
<a href="#l23.289"></a><span id="l23.289">   // -- identity culling verification</span>
<a href="#l23.290"></a><span id="l23.290">   mark_sub_test_start(&quot;identity culling verification&quot;);</span>
<a href="#l23.291"></a><span id="l23.291">   // The identities associated with that message should no longer exist, nor</span>
<a href="#l23.292"></a><span id="l23.292">   //  should their contacts.</span>
<a href="#l23.293"></a><span id="l23.293"> </span>
<a href="#l23.294"></a><span id="l23.294"> }</span>
<a href="#l23.295"></a><span id="l23.295"> </span>
<a href="#l23.296"></a><span id="l23.296" class="difflineminus">-function test_moving_to_trash_marks_deletion() {</span>
<a href="#l23.297"></a><span id="l23.297" class="difflineplus">+function* test_moving_to_trash_marks_deletion() {</span>
<a href="#l23.298"></a><span id="l23.298">   // create and index two messages in a conversation</span>
<a href="#l23.299"></a><span id="l23.299">   let [folder, msgSet] = make_folder_with_sets([{count: 2, msgsPerThread: 2}]);</span>
<a href="#l23.300"></a><span id="l23.300">   yield wait_for_message_injection();</span>
<a href="#l23.301"></a><span id="l23.301">   yield wait_for_gloda_indexer([msgSet], {augment: true});</span>
<a href="#l23.302"></a><span id="l23.302"> </span>
<a href="#l23.303"></a><span id="l23.303">   let convId = msgSet.glodaMessages[0].conversation.id;</span>
<a href="#l23.304"></a><span id="l23.304">   let firstGlodaId = msgSet.glodaMessages[0].id;</span>
<a href="#l23.305"></a><span id="l23.305">   let secondGlodaId = msgSet.glodaMessages[1].id;</span>
<a href="#l23.306"></a><span id="l23.306" class="difflineat">@@ -966,17 +966,17 @@ function test_moving_to_trash_marks_dele</span>
<a href="#l23.307"></a><span id="l23.307">   queryExpect(msgPrivQuery, []);</span>
<a href="#l23.308"></a><span id="l23.308">   yield false; // queryExpect is async</span>
<a href="#l23.309"></a><span id="l23.309"> }</span>
<a href="#l23.310"></a><span id="l23.310"> </span>
<a href="#l23.311"></a><span id="l23.311"> /**</span>
<a href="#l23.312"></a><span id="l23.312">  * Deletion that occurs because a folder got deleted.</span>
<a href="#l23.313"></a><span id="l23.313">  *  There is no hand-holding involving the headers that were in the folder.</span>
<a href="#l23.314"></a><span id="l23.314">  */</span>
<a href="#l23.315"></a><span id="l23.315" class="difflineminus">-function test_folder_nuking_message_deletion() {</span>
<a href="#l23.316"></a><span id="l23.316" class="difflineplus">+function* test_folder_nuking_message_deletion() {</span>
<a href="#l23.317"></a><span id="l23.317">   // create and index two messages in a conversation</span>
<a href="#l23.318"></a><span id="l23.318">   let [folder, msgSet] = make_folder_with_sets([{count: 2, msgsPerThread: 2}]);</span>
<a href="#l23.319"></a><span id="l23.319">   yield wait_for_message_injection();</span>
<a href="#l23.320"></a><span id="l23.320">   yield wait_for_gloda_indexer([msgSet], {augment: true});</span>
<a href="#l23.321"></a><span id="l23.321"> </span>
<a href="#l23.322"></a><span id="l23.322">   let convId = msgSet.glodaMessages[0].conversation.id;</span>
<a href="#l23.323"></a><span id="l23.323">   let firstGlodaId = msgSet.glodaMessages[0].id;</span>
<a href="#l23.324"></a><span id="l23.324">   let secondGlodaId = msgSet.glodaMessages[1].id;</span>
<a href="#l23.325"></a><span id="l23.325" class="difflineat">@@ -1026,17 +1026,17 @@ function get_nsIMsgFolder(aFolder) {</span>
<a href="#l23.326"></a><span id="l23.326"> </span>
<a href="#l23.327"></a><span id="l23.327"> function get_testFolder(aFolder) {</span>
<a href="#l23.328"></a><span id="l23.328">   if ((typeof aFolder) != &quot;string&quot;)</span>
<a href="#l23.329"></a><span id="l23.329">     return aFolder.URI;</span>
<a href="#l23.330"></a><span id="l23.330">   else</span>
<a href="#l23.331"></a><span id="l23.331">     return aFolder;</span>
<a href="#l23.332"></a><span id="l23.332"> }</span>
<a href="#l23.333"></a><span id="l23.333"> </span>
<a href="#l23.334"></a><span id="l23.334" class="difflineminus">-function test_folder_deletion_nested() {</span>
<a href="#l23.335"></a><span id="l23.335" class="difflineplus">+function* test_folder_deletion_nested() {</span>
<a href="#l23.336"></a><span id="l23.336">   // add a folder with a bunch of messages</span>
<a href="#l23.337"></a><span id="l23.337">   let [folder1, msgSet1] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l23.338"></a><span id="l23.338">   yield wait_for_message_injection();</span>
<a href="#l23.339"></a><span id="l23.339"> </span>
<a href="#l23.340"></a><span id="l23.340">   let [folder2, msgSet2] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l23.341"></a><span id="l23.341">   yield wait_for_message_injection();</span>
<a href="#l23.342"></a><span id="l23.342"> </span>
<a href="#l23.343"></a><span id="l23.343">   // index these folders, and augment the msgSet with the glodaMessages array</span>
<a href="#l23.344"></a><span id="l23.344" class="difflineat">@@ -1087,32 +1087,32 @@ function test_folder_deletion_nested() {</span>
<a href="#l23.345"></a><span id="l23.345"> }</span>
<a href="#l23.346"></a><span id="l23.346"> </span>
<a href="#l23.347"></a><span id="l23.347"> /* ===== IMAP Nuances ===== */</span>
<a href="#l23.348"></a><span id="l23.348"> </span>
<a href="#l23.349"></a><span id="l23.349"> /**</span>
<a href="#l23.350"></a><span id="l23.350">  * Verify that for IMAP folders we still see an index a message that is added</span>
<a href="#l23.351"></a><span id="l23.351">  *  as read.</span>
<a href="#l23.352"></a><span id="l23.352">  */</span>
<a href="#l23.353"></a><span id="l23.353" class="difflineminus">-function test_imap_add_unread_to_folder() {</span>
<a href="#l23.354"></a><span id="l23.354" class="difflineplus">+function* test_imap_add_unread_to_folder() {</span>
<a href="#l23.355"></a><span id="l23.355">   if (message_injection_is_local())</span>
<a href="#l23.356"></a><span id="l23.356">     return;</span>
<a href="#l23.357"></a><span id="l23.357"> </span>
<a href="#l23.358"></a><span id="l23.358">   let [srcFolder, msgSet] = make_folder_with_sets([{count: 1, read: true}]);</span>
<a href="#l23.359"></a><span id="l23.359">   yield wait_for_message_injection();</span>
<a href="#l23.360"></a><span id="l23.360">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l23.361"></a><span id="l23.361"> }</span>
<a href="#l23.362"></a><span id="l23.362"> </span>
<a href="#l23.363"></a><span id="l23.363"> /* ===== Message Moving ===== */</span>
<a href="#l23.364"></a><span id="l23.364"> </span>
<a href="#l23.365"></a><span id="l23.365"> /**</span>
<a href="#l23.366"></a><span id="l23.366">  * Moving a message between folders should result in us knowing that the message</span>
<a href="#l23.367"></a><span id="l23.367">  *  is in the target location.</span>
<a href="#l23.368"></a><span id="l23.368">  */</span>
<a href="#l23.369"></a><span id="l23.369" class="difflineminus">-function test_message_moving() {</span>
<a href="#l23.370"></a><span id="l23.370" class="difflineplus">+function* test_message_moving() {</span>
<a href="#l23.371"></a><span id="l23.371">   // - inject and insert</span>
<a href="#l23.372"></a><span id="l23.372">   // source folder with the message we care about</span>
<a href="#l23.373"></a><span id="l23.373">   let [srcFolder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l23.374"></a><span id="l23.374">   yield wait_for_message_injection();</span>
<a href="#l23.375"></a><span id="l23.375">   // dest folder with some messages in it to test some wacky local folder moving</span>
<a href="#l23.376"></a><span id="l23.376">   //  logic.  (Local moves try and update the correspondence immediately.)</span>
<a href="#l23.377"></a><span id="l23.377">   let [destFolder, ignoreSet] = make_folder_with_sets([{count: 2}]);</span>
<a href="#l23.378"></a><span id="l23.378">   yield wait_for_message_injection();</span>
<a href="#l23.379"></a><span id="l23.379" class="difflineat">@@ -1170,17 +1170,17 @@ function test_message_moving() {</span>
<a href="#l23.380"></a><span id="l23.380"> </span>
<a href="#l23.381"></a><span id="l23.381"> </span>
<a href="#l23.382"></a><span id="l23.382"> /* ===== Sweep Complications ==== */</span>
<a href="#l23.383"></a><span id="l23.383"> </span>
<a href="#l23.384"></a><span id="l23.384"> /**</span>
<a href="#l23.385"></a><span id="l23.385">  * Make sure that a message indexed by event-driven indexing does not</span>
<a href="#l23.386"></a><span id="l23.386">  *  get reindexed by sweep indexing that follows.</span>
<a href="#l23.387"></a><span id="l23.387">  */</span>
<a href="#l23.388"></a><span id="l23.388" class="difflineminus">-function test_sweep_indexing_does_not_reindex_event_indexed() {</span>
<a href="#l23.389"></a><span id="l23.389" class="difflineplus">+function* test_sweep_indexing_does_not_reindex_event_indexed() {</span>
<a href="#l23.390"></a><span id="l23.390">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l23.391"></a><span id="l23.391">   yield wait_for_message_injection();</span>
<a href="#l23.392"></a><span id="l23.392"> </span>
<a href="#l23.393"></a><span id="l23.393">   // wait for the event sweep to complete</span>
<a href="#l23.394"></a><span id="l23.394">   yield wait_for_gloda_indexer([msgSet]);</span>
<a href="#l23.395"></a><span id="l23.395"> </span>
<a href="#l23.396"></a><span id="l23.396">   // force a sweep of the folder</span>
<a href="#l23.397"></a><span id="l23.397">   GlodaMsgIndexer.indexFolder(get_real_injection_folder(folder));</span>
<a href="#l23.398"></a><span id="l23.398" class="difflineat">@@ -1191,17 +1191,17 @@ function test_sweep_indexing_does_not_re</span>
<a href="#l23.399"></a><span id="l23.399">  * Verify that moving apparently gloda-indexed messages from a filthy folder or</span>
<a href="#l23.400"></a><span id="l23.400">  *  one that simply should not be gloda indexed does not result in the target</span>
<a href="#l23.401"></a><span id="l23.401">  *  messages having the gloda-id property on them.  To avoid messing with too</span>
<a href="#l23.402"></a><span id="l23.402">  *  many invariants we do the 'folder should not be gloda indexed' case.</span>
<a href="#l23.403"></a><span id="l23.403">  * Uh, and of course, the message should still get indexed once we clear the</span>
<a href="#l23.404"></a><span id="l23.404">  *  filthy gloda-id off of it given that it is moving from a folder that is not</span>
<a href="#l23.405"></a><span id="l23.405">  *  indexed to one that is indexed.</span>
<a href="#l23.406"></a><span id="l23.406">  */</span>
<a href="#l23.407"></a><span id="l23.407" class="difflineminus">-function test_filthy_moves_slash_move_from_unindexed_to_indexed() {</span>
<a href="#l23.408"></a><span id="l23.408" class="difflineplus">+function* test_filthy_moves_slash_move_from_unindexed_to_indexed() {</span>
<a href="#l23.409"></a><span id="l23.409">   // - inject</span>
<a href="#l23.410"></a><span id="l23.410">   // the source folder needs a flag so we don't index it</span>
<a href="#l23.411"></a><span id="l23.411">   let srcFolder = make_empty_folder(null, [Ci.nsMsgFolderFlags.Junk]);</span>
<a href="#l23.412"></a><span id="l23.412">   // the destination folder has to be something we want to index though;</span>
<a href="#l23.413"></a><span id="l23.413">   let destFolder = make_empty_folder();</span>
<a href="#l23.414"></a><span id="l23.414">   let [msgSet] = make_new_sets_in_folder(srcFolder, [{count: 1}]);</span>
<a href="#l23.415"></a><span id="l23.415">   yield wait_for_message_injection();</span>
<a href="#l23.416"></a><span id="l23.416"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/base_query_messages.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/base_query_messages.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -213,17 +213,17 @@ function glodaInfoStasher(aSynthMessage,</span>
<a href="#l24.4"></a><span id="l24.4"> </span>
<a href="#l24.5"></a><span id="l24.5"> // We override these for the IMAP tests</span>
<a href="#l24.6"></a><span id="l24.6"> var pre_setup_populate_hook = function default_pre_setup_populate_hook() {</span>
<a href="#l24.7"></a><span id="l24.7"> };</span>
<a href="#l24.8"></a><span id="l24.8"> var post_setup_populate_hook = function default_post_setup_populate_hook() {</span>
<a href="#l24.9"></a><span id="l24.9"> };</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11"> // first, we must populate our message store with delicious messages.</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-function setup_populate() {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+function* setup_populate() {</span>
<a href="#l24.14"></a><span id="l24.14">   world.glodaHolderCollection = Gloda.explicitCollection(Gloda.NOUN_MESSAGE,</span>
<a href="#l24.15"></a><span id="l24.15">     []);</span>
<a href="#l24.16"></a><span id="l24.16"> </span>
<a href="#l24.17"></a><span id="l24.17">   world.peoples = msgGen.makeNamesAndAddresses(world.NUM_AUTHORS);</span>
<a href="#l24.18"></a><span id="l24.18">   world.outlierAuthor = msgGen.makeNameAndAddress();</span>
<a href="#l24.19"></a><span id="l24.19">   world.outlierFriend = msgGen.makeNameAndAddress();</span>
<a href="#l24.20"></a><span id="l24.20">   // set up the per-conversation values with blanks initially</span>
<a href="#l24.21"></a><span id="l24.21">   for (let iConvo = 0; iConvo &lt; world.NUM_CONVERSATIONS; iConvo++) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/resources/genericIndexer.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/resources/genericIndexer.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -28,17 +28,17 @@ var GenericIndexer = {</span>
<a href="#l25.4"></a><span id="l25.4">   indexObjects: function(aObjects) {</span>
<a href="#l25.5"></a><span id="l25.5">     indexingInProgress = true;</span>
<a href="#l25.6"></a><span id="l25.6">     this._log.debug(&quot;enqueuing &quot; + aObjects.length +</span>
<a href="#l25.7"></a><span id="l25.7">       &quot; generic objects with id: &quot; + aObjects[0].NOUN_ID);</span>
<a href="#l25.8"></a><span id="l25.8">     GlodaIndexer.indexJob(new IndexingJob(&quot;generic&quot;, null,</span>
<a href="#l25.9"></a><span id="l25.9">                                           aObjects.concat()));</span>
<a href="#l25.10"></a><span id="l25.10">   },</span>
<a href="#l25.11"></a><span id="l25.11">   /* implementation */</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  _worker_index_generic: function(aJob, aCallbackHandle) {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  _worker_index_generic: function*(aJob, aCallbackHandle) {</span>
<a href="#l25.14"></a><span id="l25.14">     this._log.debug(&quot;Beginning indexing &quot; + aJob.items.length +</span>
<a href="#l25.15"></a><span id="l25.15">                     &quot; generic items&quot;);</span>
<a href="#l25.16"></a><span id="l25.16">     for (let [, item] in Iterator(aJob.items)) {</span>
<a href="#l25.17"></a><span id="l25.17">       this._log.debug(&quot;Indexing: &quot; + item);</span>
<a href="#l25.18"></a><span id="l25.18">       yield aCallbackHandle.pushAndGo(</span>
<a href="#l25.19"></a><span id="l25.19">         Gloda.grokNounItem(item, {},</span>
<a href="#l25.20"></a><span id="l25.20">                            item.id === undefined, item.id === undefined,</span>
<a href="#l25.21"></a><span id="l25.21">                            aCallbackHandle,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/resources/glodaTestHelper.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -642,17 +642,17 @@ var _indexMessageState = {</span>
<a href="#l26.4"></a><span id="l26.4">    */</span>
<a href="#l26.5"></a><span id="l26.5">   _numFullIndexed: 0,</span>
<a href="#l26.6"></a><span id="l26.6"> </span>
<a href="#l26.7"></a><span id="l26.7">   providerName: &quot;glodaTestHelper:fakeProvider&quot;,</span>
<a href="#l26.8"></a><span id="l26.8">   /**</span>
<a href="#l26.9"></a><span id="l26.9">    * Fake attribute provider processing function so we can distinguish</span>
<a href="#l26.10"></a><span id="l26.10">    *  between fully reindexed messages and fast-path modified messages.</span>
<a href="#l26.11"></a><span id="l26.11">    */</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  process: function(aItem, aRawReps, aIsConceptuallyNew, aCallbackHandle) {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+  process: function*(aItem, aRawReps, aIsConceptuallyNew, aCallbackHandle) {</span>
<a href="#l26.14"></a><span id="l26.14">     this._numFullIndexed++;</span>
<a href="#l26.15"></a><span id="l26.15"> </span>
<a href="#l26.16"></a><span id="l26.16">     yield Gloda.kWorkDone;</span>
<a href="#l26.17"></a><span id="l26.17">   },</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19">   _numItemsAdded : 0,</span>
<a href="#l26.20"></a><span id="l26.20"> </span>
<a href="#l26.21"></a><span id="l26.21">   /**</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -731,17 +731,17 @@ function indexAndPermuteMessages(aScenar</span>
<a href="#l26.23"></a><span id="l26.23">                     args: [aScenarioMaker, aVerifier]});</span>
<a href="#l26.24"></a><span id="l26.24"> }</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26"> /**</span>
<a href="#l26.27"></a><span id="l26.27">  * Actual worker for |indexAndPermuteMessages|.  This only exists because</span>
<a href="#l26.28"></a><span id="l26.28">  *  |indexAndPermuteMessages| can't be a generator itself, so it just shims to</span>
<a href="#l26.29"></a><span id="l26.29">  *  us.</span>
<a href="#l26.30"></a><span id="l26.30">  */</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-function _runPermutations(aScenarioMaker, aVerifier) {</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+function* _runPermutations(aScenarioMaker, aVerifier) {</span>
<a href="#l26.33"></a><span id="l26.33">   let folder = make_empty_folder();</span>
<a href="#l26.34"></a><span id="l26.34"> </span>
<a href="#l26.35"></a><span id="l26.35">   // To calculate the permutations, we need to actually see what gets produced.</span>
<a href="#l26.36"></a><span id="l26.36">   let scenarioMessages = aScenarioMaker();</span>
<a href="#l26.37"></a><span id="l26.37">   let numPermutations = Math.min(factorial(scenarioMessages.length), 32);</span>
<a href="#l26.38"></a><span id="l26.38">   for (let iPermutation = 0; iPermutation &lt; numPermutations; iPermutation++) {</span>
<a href="#l26.39"></a><span id="l26.39">     mark_sub_test_start(&quot;Permutation&quot;,</span>
<a href="#l26.40"></a><span id="l26.40">                         (iPermutation + 1) + &quot;/&quot; + numPermutations,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/resources/mockIndexer.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/resources/mockIndexer.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -22,17 +22,17 @@ var MockIndexer = {</span>
<a href="#l27.4"></a><span id="l27.4">   initialSweepCalled: false,</span>
<a href="#l27.5"></a><span id="l27.5">   indexForever: function() {</span>
<a href="#l27.6"></a><span id="l27.6">     GlodaIndexer.indexJob(new IndexingJob(&quot;forever&quot;, null));</span>
<a href="#l27.7"></a><span id="l27.7">   },</span>
<a href="#l27.8"></a><span id="l27.8">   stopIndexingForever: function() {</span>
<a href="#l27.9"></a><span id="l27.9">     GlodaIndexer.callbackDriver();</span>
<a href="#l27.10"></a><span id="l27.10">   },</span>
<a href="#l27.11"></a><span id="l27.11">   /* implementation */</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  _worker_index_forever: function(aJob, aCallbackHandle) {</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  _worker_index_forever: function*(aJob, aCallbackHandle) {</span>
<a href="#l27.14"></a><span id="l27.14">     // pretend that something async is happening, but nothing is really</span>
<a href="#l27.15"></a><span id="l27.15">     //  happening!  muahahaha!</span>
<a href="#l27.16"></a><span id="l27.16">     //</span>
<a href="#l27.17"></a><span id="l27.17">     yield GlodaIndexer.kWorkAsync;</span>
<a href="#l27.18"></a><span id="l27.18">     yield GlodaIndexer.kWorkDone;</span>
<a href="#l27.19"></a><span id="l27.19">   }</span>
<a href="#l27.20"></a><span id="l27.20"> };</span>
<a href="#l27.21"></a><span id="l27.21"> GlodaIndexer.registerIndexer(MockIndexer);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -20,17 +20,17 @@ function getLiveFolderCount() {</span>
<a href="#l28.4"></a><span id="l28.4">   return Object.keys(GlodaDatastore._liveGlodaFolders).length;</span>
<a href="#l28.5"></a><span id="l28.5"> }</span>
<a href="#l28.6"></a><span id="l28.6"> </span>
<a href="#l28.7"></a><span id="l28.7"> /**</span>
<a href="#l28.8"></a><span id="l28.8">  * Meddle with internals of live folder tracking, create a synthetic message and</span>
<a href="#l28.9"></a><span id="l28.9">  *  index it. We do the actual work involving the headers and folders in</span>
<a href="#l28.10"></a><span id="l28.10">  *  poke_and_verify_msf_closure.</span>
<a href="#l28.11"></a><span id="l28.11">  */</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-function test_msf_closure() {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+function* test_msf_closure() {</span>
<a href="#l28.14"></a><span id="l28.14">   // before doing anything, the indexer should not be tracking any live folders</span>
<a href="#l28.15"></a><span id="l28.15">   do_check_false(GlodaDatastore._folderCleanupActive);</span>
<a href="#l28.16"></a><span id="l28.16">   do_check_eq(0, getLiveFolderCount());</span>
<a href="#l28.17"></a><span id="l28.17"> </span>
<a href="#l28.18"></a><span id="l28.18">   // make the datastore's folder cleanup timer never be at risk of firing</span>
<a href="#l28.19"></a><span id="l28.19">   GlodaDatastore._folderCleanupTimerInterval = 1000000000;</span>
<a href="#l28.20"></a><span id="l28.20">   // set the acceptably old threshold so it will never age out</span>
<a href="#l28.21"></a><span id="l28.21">   GlodaFolder.prototype.ACCEPTABLY_OLD_THRESHOLD = 1000000000;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_folder_logic.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_folder_logic.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -16,17 +16,17 @@ function test_newly_created_folders_star</span>
<a href="#l29.4"></a><span id="l29.4">   do_check_eq(glodaFolder.dirtyStatus, glodaFolder.kFolderClean);</span>
<a href="#l29.5"></a><span id="l29.5"> }</span>
<a href="#l29.6"></a><span id="l29.6"> </span>
<a href="#l29.7"></a><span id="l29.7"> /**</span>
<a href="#l29.8"></a><span id="l29.8">  * Deleted folders should not leave behind any mapping, and that mapping</span>
<a href="#l29.9"></a><span id="l29.9">  *  definitely should not interfere with a newly created folder of the same</span>
<a href="#l29.10"></a><span id="l29.10">  *  name.</span>
<a href="#l29.11"></a><span id="l29.11">  */</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-function test_deleted_folder_tombstones_get_forgotten() {</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+function* test_deleted_folder_tombstones_get_forgotten() {</span>
<a href="#l29.14"></a><span id="l29.14">   let oldFolder = make_empty_folder(&quot;volver&quot;);</span>
<a href="#l29.15"></a><span id="l29.15">   let oldGlodaFolder = Gloda.getFolderForFolder(oldFolder);</span>
<a href="#l29.16"></a><span id="l29.16">   yield async_delete_folder(oldFolder);</span>
<a href="#l29.17"></a><span id="l29.17"> </span>
<a href="#l29.18"></a><span id="l29.18">   // the tombstone needs to know it is deleted</span>
<a href="#l29.19"></a><span id="l29.19">   do_check_true(oldGlodaFolder._deleted);</span>
<a href="#l29.20"></a><span id="l29.20"> </span>
<a href="#l29.21"></a><span id="l29.21">   let newFolder = make_empty_folder(&quot;volver&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_fts3_tokenizer.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -64,17 +64,17 @@ var intlPhrases = [</span>
<a href="#l30.4"></a><span id="l30.4">  *  subject, body, and attachment name are populated using the encodings in</span>
<a href="#l30.5"></a><span id="l30.5">  *  the phrase's &quot;encodings&quot; attribute, one encoding per message.  Make sure</span>
<a href="#l30.6"></a><span id="l30.6">  *  that the strings as exposed by the gloda representation are equal to the</span>
<a href="#l30.7"></a><span id="l30.7">  *  expected/actual value.</span>
<a href="#l30.8"></a><span id="l30.8">  * Stash each created synthetic message in a resultList list on the phrase so</span>
<a href="#l30.9"></a><span id="l30.9">  *  that we can use them as expected query results in</span>
<a href="#l30.10"></a><span id="l30.10">  *  |test_fulltextsearch|.</span>
<a href="#l30.11"></a><span id="l30.11">  */</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-function test_index(aPhrase) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+function* test_index(aPhrase) {</span>
<a href="#l30.14"></a><span id="l30.14">   // create a synthetic message for each of the delightful encoding types</span>
<a href="#l30.15"></a><span id="l30.15">   let messages = [];</span>
<a href="#l30.16"></a><span id="l30.16">   aPhrase.resultList = [];</span>
<a href="#l30.17"></a><span id="l30.17">   for (let charset in aPhrase.encodings) {</span>
<a href="#l30.18"></a><span id="l30.18">     let [quoted, bodyEncoded] = aPhrase.encodings[charset];</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20">     let smsg = gMessageGenerator.makeMessage({</span>
<a href="#l30.21"></a><span id="l30.21">       subject: quoted,</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineat">@@ -117,30 +117,30 @@ function verify_index(smsg, gmsg) {</span>
<a href="#l30.23"></a><span id="l30.23"> </span>
<a href="#l30.24"></a><span id="l30.24"> /**</span>
<a href="#l30.25"></a><span id="l30.25">  * - Check that the 'aa' token was never emitted (we don't emit two-letter</span>
<a href="#l30.26"></a><span id="l30.26">  *   tokens unless they're CJK).</span>
<a href="#l30.27"></a><span id="l30.27">  * - Check that the '\u81ea\u52d5' token was emitted, because it's CJK.</span>
<a href="#l30.28"></a><span id="l30.28">  * - Check that the 'bbb' token was duly emitted (three letters is more than two</span>
<a href="#l30.29"></a><span id="l30.29">  *   letters so it's tokenized).</span>
<a href="#l30.30"></a><span id="l30.30">  */</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-function test_token_count() {</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+function* test_token_count() {</span>
<a href="#l30.33"></a><span id="l30.33">   yield sqlExpectCount(0,</span>
<a href="#l30.34"></a><span id="l30.34">     &quot;SELECT COUNT(*) FROM messagesText where messagesText MATCH 'aa'&quot;);</span>
<a href="#l30.35"></a><span id="l30.35">   yield sqlExpectCount(1,</span>
<a href="#l30.36"></a><span id="l30.36">     &quot;SELECT COUNT(*) FROM messagesText where messagesText MATCH 'bbb'&quot;);</span>
<a href="#l30.37"></a><span id="l30.37">   yield sqlExpectCount(1,</span>
<a href="#l30.38"></a><span id="l30.38">     &quot;SELECT COUNT(*) FROM messagesText where messagesText MATCH '\u81ea\u52d5'&quot;);</span>
<a href="#l30.39"></a><span id="l30.39"> }</span>
<a href="#l30.40"></a><span id="l30.40"> </span>
<a href="#l30.41"></a><span id="l30.41"> /**</span>
<a href="#l30.42"></a><span id="l30.42">  * For each phrase, make sure that all of the searchPhrases either match or fail</span>
<a href="#l30.43"></a><span id="l30.43">  *  to match as appropriate.</span>
<a href="#l30.44"></a><span id="l30.44">  */</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineminus">-function test_fulltextsearch(aPhrase)</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineplus">+function* test_fulltextsearch(aPhrase)</span>
<a href="#l30.47"></a><span id="l30.47"> {</span>
<a href="#l30.48"></a><span id="l30.48">   for (let searchPhrase of aPhrase.searchPhrases) {</span>
<a href="#l30.49"></a><span id="l30.49">     let query = Gloda.newQuery(Gloda.NOUN_MESSAGE);</span>
<a href="#l30.50"></a><span id="l30.50">     query.bodyMatches(searchPhrase.body);</span>
<a href="#l30.51"></a><span id="l30.51">     queryExpect(query, searchPhrase.match ? aPhrase.resultList : []);</span>
<a href="#l30.52"></a><span id="l30.52">     yield false; // queryExpect is async</span>
<a href="#l30.53"></a><span id="l30.53">   }</span>
<a href="#l30.54"></a><span id="l30.54"> }</span>
<a href="#l30.55"></a><span id="l30.55" class="difflineat">@@ -208,17 +208,17 @@ function msgSearchExpectCount(aCount, aF</span>
<a href="#l30.56"></a><span id="l30.56">   return false;</span>
<a href="#l30.57"></a><span id="l30.57"> }</span>
<a href="#l30.58"></a><span id="l30.58"> </span>
<a href="#l30.59"></a><span id="l30.59"> /**</span>
<a href="#l30.60"></a><span id="l30.60">  * We make sure that the Gloda module that builds the query drops two-letter</span>
<a href="#l30.61"></a><span id="l30.61">  * tokens, otherwise this would result in an empty search (no matches for</span>
<a href="#l30.62"></a><span id="l30.62">  * two-letter tokens).</span>
<a href="#l30.63"></a><span id="l30.63">  */</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineminus">-function test_query_builder() {</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineplus">+function* test_query_builder() {</span>
<a href="#l30.66"></a><span id="l30.66">   // aa should be dropped, and we have one message containing the bbb token.</span>
<a href="#l30.67"></a><span id="l30.67">   yield msgSearchExpectCount(1, &quot;aa bbb&quot;);</span>
<a href="#l30.68"></a><span id="l30.68">   // the CJK part should not be dropped, and match message 1; the bbb token</span>
<a href="#l30.69"></a><span id="l30.69">   // should not be dropped, and match message 2; 0 results returned because no</span>
<a href="#l30.70"></a><span id="l30.70">   // message has the two tokens in it</span>
<a href="#l30.71"></a><span id="l30.71">   yield msgSearchExpectCount(0, &quot;\u81ea\u52d5 bbb&quot;);</span>
<a href="#l30.72"></a><span id="l30.72"> }</span>
<a href="#l30.73"></a><span id="l30.73"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_addressbook.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_addressbook.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -51,17 +51,17 @@ function get_cached_gloda_identity_for_e</span>
<a href="#l31.4"></a><span id="l31.4"> var EMAIL_ADDRESS = &quot;all.over@the.world.invalid&quot;;</span>
<a href="#l31.5"></a><span id="l31.5"> var DISPLAY_NAME = &quot;every day&quot;;</span>
<a href="#l31.6"></a><span id="l31.6"> </span>
<a href="#l31.7"></a><span id="l31.7"> var identityCollection;</span>
<a href="#l31.8"></a><span id="l31.8"> </span>
<a href="#l31.9"></a><span id="l31.9"> /**</span>
<a href="#l31.10"></a><span id="l31.10">  * Create an e-mail so the identity can exist.</span>
<a href="#l31.11"></a><span id="l31.11">  */</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-function setup_create_identity() {</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+function* setup_create_identity() {</span>
<a href="#l31.14"></a><span id="l31.14">   let [msgSet] = make_new_sets_in_folder(gInbox, [</span>
<a href="#l31.15"></a><span id="l31.15">                    {count: 1, from: [DISPLAY_NAME, EMAIL_ADDRESS]}]);</span>
<a href="#l31.16"></a><span id="l31.16">   yield wait_for_message_injection();</span>
<a href="#l31.17"></a><span id="l31.17">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l31.18"></a><span id="l31.18"> </span>
<a href="#l31.19"></a><span id="l31.19">   // okay, but it knows it has no card because indexing thinks stuff.</span>
<a href="#l31.20"></a><span id="l31.20">   // so let's flush all caches and create a query that just knows about the</span>
<a href="#l31.21"></a><span id="l31.21">   //  identity.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_bad_messages.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_bad_messages.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -26,17 +26,17 @@ var illegalMessageTemplates = [</span>
<a href="#l32.4"></a><span id="l32.4">     }</span>
<a href="#l32.5"></a><span id="l32.5">   }</span>
<a href="#l32.6"></a><span id="l32.6"> ];</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8"> /**</span>
<a href="#l32.9"></a><span id="l32.9">  * Using exciting templates from |illegalMessageTemplates|, verify that gloda</span>
<a href="#l32.10"></a><span id="l32.10">  *  fails to index them and marks the messages bad.</span>
<a href="#l32.11"></a><span id="l32.11">  */</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-function test_illegal_message(aInfo) {</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+function* test_illegal_message(aInfo) {</span>
<a href="#l32.14"></a><span id="l32.14">   // Inject the messages.</span>
<a href="#l32.15"></a><span id="l32.15">   let [msgSet] = make_new_sets_in_folder(gInbox, [</span>
<a href="#l32.16"></a><span id="l32.16">                    {count: 1, clobberHeaders: aInfo.clobberHeaders}]);</span>
<a href="#l32.17"></a><span id="l32.17">   yield wait_for_message_injection();</span>
<a href="#l32.18"></a><span id="l32.18"> </span>
<a href="#l32.19"></a><span id="l32.19">   // indexing should complete without actually indexing the message</span>
<a href="#l32.20"></a><span id="l32.20">   yield wait_for_gloda_indexer([], {recovered: 1, failedToRecover: 0,</span>
<a href="#l32.21"></a><span id="l32.21">                                     cleanedUp: 0, hadNoCleanUp: 0});</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineat">@@ -47,17 +47,17 @@ function test_illegal_message(aInfo) {</span>
<a href="#l32.23"></a><span id="l32.23"> </span>
<a href="#l32.24"></a><span id="l32.24">   // make sure gloda does not think the message is indexed</span>
<a href="#l32.25"></a><span id="l32.25">   do_check_eq(Gloda.isMessageIndexed(msgHdr), false);</span>
<a href="#l32.26"></a><span id="l32.26"> }</span>
<a href="#l32.27"></a><span id="l32.27"> </span>
<a href="#l32.28"></a><span id="l32.28"> /**</span>
<a href="#l32.29"></a><span id="l32.29">  * A byzantine failure to stream should not sink us.  Fake a failure.</span>
<a href="#l32.30"></a><span id="l32.30">  */</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-function test_streaming_failure() {</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+function* test_streaming_failure() {</span>
<a href="#l32.33"></a><span id="l32.33">   configure_gloda_indexing({injectFaultIn: &quot;streaming&quot;});</span>
<a href="#l32.34"></a><span id="l32.34"> </span>
<a href="#l32.35"></a><span id="l32.35">   // Inject the messages.</span>
<a href="#l32.36"></a><span id="l32.36">   let [msgSet] = make_new_sets_in_folder(gInbox, [{count: 1}]);</span>
<a href="#l32.37"></a><span id="l32.37">   yield wait_for_message_injection();</span>
<a href="#l32.38"></a><span id="l32.38"> </span>
<a href="#l32.39"></a><span id="l32.39">   // indexing should complete without actually indexing the message</span>
<a href="#l32.40"></a><span id="l32.40">   yield wait_for_gloda_indexer([], {recovered: 1, failedToRecover: 0,</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineat">@@ -73,17 +73,17 @@ function test_streaming_failure() {</span>
<a href="#l32.42"></a><span id="l32.42">   configure_gloda_indexing({});</span>
<a href="#l32.43"></a><span id="l32.43"> }</span>
<a href="#l32.44"></a><span id="l32.44"> </span>
<a href="#l32.45"></a><span id="l32.45"> /**</span>
<a href="#l32.46"></a><span id="l32.46">  * If we have one bad message followed by a good message, the good message</span>
<a href="#l32.47"></a><span id="l32.47">  *  should still get indexed.  Additionally, if we do a sweep on the folder,</span>
<a href="#l32.48"></a><span id="l32.48">  *  we should not attempt to index the message again.</span>
<a href="#l32.49"></a><span id="l32.49">  */</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineminus">-function test_recovery_and_no_second_attempts() {</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineplus">+function* test_recovery_and_no_second_attempts() {</span>
<a href="#l32.52"></a><span id="l32.52">   let [badSet, goodSet] = make_new_sets_in_folder(gInbox, [</span>
<a href="#l32.53"></a><span id="l32.53">                    {count: 1, clobberHeaders: {From: &quot;&quot;}},</span>
<a href="#l32.54"></a><span id="l32.54">                    {count: 1}]);</span>
<a href="#l32.55"></a><span id="l32.55">   yield wait_for_message_injection();</span>
<a href="#l32.56"></a><span id="l32.56"> </span>
<a href="#l32.57"></a><span id="l32.57">   yield wait_for_gloda_indexer([goodSet], {recovered: 1});</span>
<a href="#l32.58"></a><span id="l32.58"> </span>
<a href="#l32.59"></a><span id="l32.59">   // index the folder; no messages should get indexed and there should be no</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineat">@@ -92,17 +92,17 @@ function test_recovery_and_no_second_att</span>
<a href="#l32.61"></a><span id="l32.61">   yield wait_for_gloda_indexer([], {recovered: 0, failedToRecover: 0,</span>
<a href="#l32.62"></a><span id="l32.62">                                     cleanedUp: 0, hadNoCleanUp: 0});</span>
<a href="#l32.63"></a><span id="l32.63"> }</span>
<a href="#l32.64"></a><span id="l32.64"> </span>
<a href="#l32.65"></a><span id="l32.65"> /**</span>
<a href="#l32.66"></a><span id="l32.66">  * Make sure that we attempt to reindex a dirty bad message and that when we</span>
<a href="#l32.67"></a><span id="l32.67">  *  fail that we clear the dirty bit.</span>
<a href="#l32.68"></a><span id="l32.68">  */</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineminus">-function test_reindex_on_dirty_clear_dirty_on_fail() {</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineplus">+function* test_reindex_on_dirty_clear_dirty_on_fail() {</span>
<a href="#l32.71"></a><span id="l32.71">   // Inject a new illegal message</span>
<a href="#l32.72"></a><span id="l32.72">   let [msgSet] = make_new_sets_in_folder(gInbox, [{</span>
<a href="#l32.73"></a><span id="l32.73">                    count: 1,</span>
<a href="#l32.74"></a><span id="l32.74">                    clobberHeaders: illegalMessageTemplates[0].clobberHeaders,</span>
<a href="#l32.75"></a><span id="l32.75">                  }]);</span>
<a href="#l32.76"></a><span id="l32.76">   yield wait_for_message_injection();</span>
<a href="#l32.77"></a><span id="l32.77"> </span>
<a href="#l32.78"></a><span id="l32.78">   // indexing should complete without actually indexing the message</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_compaction.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_compaction.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -40,17 +40,17 @@ Services.prefs.setCharPref(&quot;mail.serverD</span>
<a href="#l33.4"></a><span id="l33.4"> </span>
<a href="#l33.5"></a><span id="l33.5"> </span>
<a href="#l33.6"></a><span id="l33.6"> /**</span>
<a href="#l33.7"></a><span id="l33.7">  * Verify that the message keys match between the message headers and the</span>
<a href="#l33.8"></a><span id="l33.8">  *  (augmented on) gloda messages that correspond to the headers.</span>
<a href="#l33.9"></a><span id="l33.9">  */</span>
<a href="#l33.10"></a><span id="l33.10"> function verify_message_keys(aSynSet) {</span>
<a href="#l33.11"></a><span id="l33.11">   let iMsg = 0;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  for (let msgHdr of aSynSet.msgHdrs) {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+  for (let msgHdr of aSynSet.msgHdrs()) {</span>
<a href="#l33.14"></a><span id="l33.14">     let glodaMsg = aSynSet.glodaMessages[iMsg++];</span>
<a href="#l33.15"></a><span id="l33.15">     if (msgHdr.messageKey != glodaMsg.messageKey)</span>
<a href="#l33.16"></a><span id="l33.16">       mark_failure([&quot;Message header&quot;, msgHdr,</span>
<a href="#l33.17"></a><span id="l33.17">                     &quot;should have message key &quot; + msgHdr.messageKey +</span>
<a href="#l33.18"></a><span id="l33.18">                      &quot; but has key &quot; + glodaMsg.messageKey + &quot; per gloda msg&quot;,</span>
<a href="#l33.19"></a><span id="l33.19">                     glodaMsg]);</span>
<a href="#l33.20"></a><span id="l33.20">   }</span>
<a href="#l33.21"></a><span id="l33.21">   mark_action(&quot;actual&quot;, &quot;verified message keys after compaction&quot;, []);</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineat">@@ -69,17 +69,17 @@ var indexingPassPermutations = [</span>
<a href="#l33.23"></a><span id="l33.23"> </span>
<a href="#l33.24"></a><span id="l33.24"> /**</span>
<a href="#l33.25"></a><span id="l33.25">  * Compact a folder that we were not indexing.  Make sure gloda's representations</span>
<a href="#l33.26"></a><span id="l33.26">  *  get updated to the new message keys.</span>
<a href="#l33.27"></a><span id="l33.27">  *</span>
<a href="#l33.28"></a><span id="l33.28">  * This is parameterized because the logic has special cases to deal with</span>
<a href="#l33.29"></a><span id="l33.29">  *  messages that were pending commit that got blown away.</span>
<a href="#l33.30"></a><span id="l33.30">  */</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-function test_compaction_indexing_pass(aParam) {</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+function* test_compaction_indexing_pass(aParam) {</span>
<a href="#l33.33"></a><span id="l33.33">   // Create 5 messages.  We will move just the third message so the first two</span>
<a href="#l33.34"></a><span id="l33.34">   //  message keep their keys and the last two change.  (We want 2 for both</span>
<a href="#l33.35"></a><span id="l33.35">   //  cases to avoid edge cases.)</span>
<a href="#l33.36"></a><span id="l33.36">   let [folder, sameSet, moveSet, shiftSet] = make_folder_with_sets([</span>
<a href="#l33.37"></a><span id="l33.37">     {count: 2}, {count: 1}, {count: 2}]);</span>
<a href="#l33.38"></a><span id="l33.38">   yield wait_for_message_injection();</span>
<a href="#l33.39"></a><span id="l33.39">   yield wait_for_gloda_indexer([sameSet, moveSet, shiftSet], {augment: true});</span>
<a href="#l33.40"></a><span id="l33.40"> </span>
<a href="#l33.41"></a><span id="l33.41" class="difflineat">@@ -105,17 +105,17 @@ function test_compaction_indexing_pass(a</span>
<a href="#l33.42"></a><span id="l33.42">   verify_message_keys(shiftSet);</span>
<a href="#l33.43"></a><span id="l33.43"> }</span>
<a href="#l33.44"></a><span id="l33.44"> </span>
<a href="#l33.45"></a><span id="l33.45"> /**</span>
<a href="#l33.46"></a><span id="l33.46">  * Make sure that an indexing sweep performs a compaction pass if we kill the</span>
<a href="#l33.47"></a><span id="l33.47">  *  compaction job automatically scheduled by the conclusion of the compaction.</span>
<a href="#l33.48"></a><span id="l33.48">  *  (Simulating the user quitting before all compactions have been processed.)</span>
<a href="#l33.49"></a><span id="l33.49">  */</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineminus">-function test_sweep_performs_compaction() {</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineplus">+function* test_sweep_performs_compaction() {</span>
<a href="#l33.52"></a><span id="l33.52">   let [folder, moveSet, staySet] = make_folder_with_sets([</span>
<a href="#l33.53"></a><span id="l33.53">     {count: 1}, {count: 1}]);</span>
<a href="#l33.54"></a><span id="l33.54">   yield wait_for_message_injection();</span>
<a href="#l33.55"></a><span id="l33.55">   yield wait_for_gloda_indexer([moveSet, staySet], {augment: true});</span>
<a href="#l33.56"></a><span id="l33.56"> </span>
<a href="#l33.57"></a><span id="l33.57">   // move the message to another folder</span>
<a href="#l33.58"></a><span id="l33.58">   let otherFolder = make_empty_folder();</span>
<a href="#l33.59"></a><span id="l33.59">   yield async_move_messages(moveSet, otherFolder);</span>
<a href="#l33.60"></a><span id="l33.60" class="difflineat">@@ -149,17 +149,17 @@ function test_sweep_performs_compaction(</span>
<a href="#l33.61"></a><span id="l33.61">   verify_message_keys(staySet);</span>
<a href="#l33.62"></a><span id="l33.62"> }</span>
<a href="#l33.63"></a><span id="l33.63"> </span>
<a href="#l33.64"></a><span id="l33.64"> /**</span>
<a href="#l33.65"></a><span id="l33.65">  * Make sure that if we compact a folder then move messages out of it and/or</span>
<a href="#l33.66"></a><span id="l33.66">  *  delete messages from it before its compaction pass happens that the</span>
<a href="#l33.67"></a><span id="l33.67">  *  compaction pass properly marks the messages deleted.</span>
<a href="#l33.68"></a><span id="l33.68">  */</span>
<a href="#l33.69"></a><span id="l33.69" class="difflineminus">-function test_moves_and_deletions_on_compacted_folder_edge_case() {</span>
<a href="#l33.70"></a><span id="l33.70" class="difflineplus">+function* test_moves_and_deletions_on_compacted_folder_edge_case() {</span>
<a href="#l33.71"></a><span id="l33.71">   let [folder, compactMoveSet, moveSet, delSet, staySet] =</span>
<a href="#l33.72"></a><span id="l33.72">     make_folder_with_sets([{count: 1}, {count: 1}, {count: 1}, {count: 1}]);</span>
<a href="#l33.73"></a><span id="l33.73">   yield wait_for_message_injection();</span>
<a href="#l33.74"></a><span id="l33.74">   yield wait_for_gloda_indexer([compactMoveSet, moveSet, delSet, staySet],</span>
<a href="#l33.75"></a><span id="l33.75">                                {augment: true});</span>
<a href="#l33.76"></a><span id="l33.76"> </span>
<a href="#l33.77"></a><span id="l33.77">   // move the message to another folder</span>
<a href="#l33.78"></a><span id="l33.78">   let otherFolder = make_empty_folder();</span>
<a href="#l33.79"></a><span id="l33.79" class="difflineat">@@ -213,17 +213,17 @@ function test_moves_and_deletions_on_com</span>
<a href="#l33.80"></a><span id="l33.80">  * Induce a compaction while we are in the middle of indexing.  Make sure we</span>
<a href="#l33.81"></a><span id="l33.81">  *  clean up and that the folder ends</span>
<a href="#l33.82"></a><span id="l33.82">  *</span>
<a href="#l33.83"></a><span id="l33.83">  * Note that in order for compaction to happen there has to be something for</span>
<a href="#l33.84"></a><span id="l33.84">  *  compaction to do, so our prep involves moving a message to another folder.</span>
<a href="#l33.85"></a><span id="l33.85">  *  (Deletion actually produces more legwork for gloda whereas a local move is</span>
<a href="#l33.86"></a><span id="l33.86">  *  almost entirely free.)</span>
<a href="#l33.87"></a><span id="l33.87">  */</span>
<a href="#l33.88"></a><span id="l33.88" class="difflineminus">-function test_compaction_interrupting_indexing() {</span>
<a href="#l33.89"></a><span id="l33.89" class="difflineplus">+function* test_compaction_interrupting_indexing() {</span>
<a href="#l33.90"></a><span id="l33.90">   // create a folder with a message inside.</span>
<a href="#l33.91"></a><span id="l33.91">   let [folder, compactionFodderSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l33.92"></a><span id="l33.92">   yield wait_for_message_injection();</span>
<a href="#l33.93"></a><span id="l33.93">   yield wait_for_gloda_indexer([compactionFodderSet]);</span>
<a href="#l33.94"></a><span id="l33.94"> </span>
<a href="#l33.95"></a><span id="l33.95">   // move that message to another folder</span>
<a href="#l33.96"></a><span id="l33.96">   let otherFolder = make_empty_folder();</span>
<a href="#l33.97"></a><span id="l33.97">   yield async_move_messages(compactionFodderSet, otherFolder);</span>
<a href="#l33.98"></a><span id="l33.98" class="difflineat">@@ -254,17 +254,17 @@ function test_compaction_interrupting_in</span>
<a href="#l33.99"></a><span id="l33.99">   //  so in the end the message will get indexed.</span>
<a href="#l33.100"></a><span id="l33.100">   // Also, make sure a cleanup was observed.</span>
<a href="#l33.101"></a><span id="l33.101">   yield wait_for_gloda_indexer([msgSet], {cleanedUp: 1});</span>
<a href="#l33.102"></a><span id="l33.102"> }</span>
<a href="#l33.103"></a><span id="l33.103"> </span>
<a href="#l33.104"></a><span id="l33.104"> /**</span>
<a href="#l33.105"></a><span id="l33.105">  *</span>
<a href="#l33.106"></a><span id="l33.106">  */</span>
<a href="#l33.107"></a><span id="l33.107" class="difflineminus">-function test_do_not_enter_compacting_folders() {</span>
<a href="#l33.108"></a><span id="l33.108" class="difflineplus">+function* test_do_not_enter_compacting_folders() {</span>
<a href="#l33.109"></a><span id="l33.109">   // turn off indexing...</span>
<a href="#l33.110"></a><span id="l33.110">   configure_gloda_indexing({event: false});</span>
<a href="#l33.111"></a><span id="l33.111"> </span>
<a href="#l33.112"></a><span id="l33.112">   // create a folder with a message inside.</span>
<a href="#l33.113"></a><span id="l33.113">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l33.114"></a><span id="l33.114">   yield wait_for_message_injection();</span>
<a href="#l33.115"></a><span id="l33.115"> </span>
<a href="#l33.116"></a><span id="l33.116">   // lie and claim we are compacting that folder</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_messages_local.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_messages_local.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -3,17 +3,17 @@</span>
<a href="#l34.4"></a><span id="l34.4">  */</span>
<a href="#l34.5"></a><span id="l34.5"> </span>
<a href="#l34.6"></a><span id="l34.6"> load(&quot;base_index_messages.js&quot;);</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8"> /**</span>
<a href="#l34.9"></a><span id="l34.9">  * Make sure that if we have to reparse a local folder we do not hang or</span>
<a href="#l34.10"></a><span id="l34.10">  *  anything.  (We had a regression where we would hang.)</span>
<a href="#l34.11"></a><span id="l34.11">  */</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-function test_reparse_of_local_folder_works() {</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+function* test_reparse_of_local_folder_works() {</span>
<a href="#l34.14"></a><span id="l34.14">   // index a folder</span>
<a href="#l34.15"></a><span id="l34.15">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l34.16"></a><span id="l34.16">   yield wait_for_message_injection();</span>
<a href="#l34.17"></a><span id="l34.17">   yield wait_for_gloda_indexer(msgSet);</span>
<a href="#l34.18"></a><span id="l34.18"> </span>
<a href="#l34.19"></a><span id="l34.19">   // force a db flush so we do not have any outstanding references to the</span>
<a href="#l34.20"></a><span id="l34.20">   //  folder or its headers.</span>
<a href="#l34.21"></a><span id="l34.21">   yield wait_for_gloda_db_flush();</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineat">@@ -33,17 +33,17 @@ tests.unshift(test_reparse_of_local_fold</span>
<a href="#l34.23"></a><span id="l34.23">  * Ensure that fromJSON for a non-singular attribute properly filters out</span>
<a href="#l34.24"></a><span id="l34.24">  *  &quot;undefined&quot; return values, specifically as it relates to tags.  When the</span>
<a href="#l34.25"></a><span id="l34.25">  *  user removes them Gloda doesn't actually re-index the messages so the</span>
<a href="#l34.26"></a><span id="l34.26">  *  values will still be there when we next load the message.</span>
<a href="#l34.27"></a><span id="l34.27">  *</span>
<a href="#l34.28"></a><span id="l34.28">  * We directly monkey with the state of NounTag for no really good reason, but</span>
<a href="#l34.29"></a><span id="l34.29">  *  maybe it cuts down on disk I/O because we don't have to touch prefs.</span>
<a href="#l34.30"></a><span id="l34.30">  */</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-function test_fromjson_of_removed_tag() {</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+function* test_fromjson_of_removed_tag() {</span>
<a href="#l34.33"></a><span id="l34.33">   // -- inject</span>
<a href="#l34.34"></a><span id="l34.34">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l34.35"></a><span id="l34.35">   yield wait_for_message_injection();</span>
<a href="#l34.36"></a><span id="l34.36">   yield wait_for_gloda_indexer(msgSet, {augment: true});</span>
<a href="#l34.37"></a><span id="l34.37">   let gmsg = msgSet.glodaMessages[0];</span>
<a href="#l34.38"></a><span id="l34.38"> </span>
<a href="#l34.39"></a><span id="l34.39">   // -- tag</span>
<a href="#l34.40"></a><span id="l34.40">   let tag = TagNoun.getTag(&quot;$label4&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_sweep_folder.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_sweep_folder.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -36,17 +36,17 @@ GlodaMsgIndexer._indexerGetEnumerator = </span>
<a href="#l35.4"></a><span id="l35.4"> /**</span>
<a href="#l35.5"></a><span id="l35.5">  * Create a folder indexing job for the given injection folder handle and</span>
<a href="#l35.6"></a><span id="l35.6">  * run it until completion.</span>
<a href="#l35.7"></a><span id="l35.7">  */</span>
<a href="#l35.8"></a><span id="l35.8"> function spin_folder_indexer() {</span>
<a href="#l35.9"></a><span id="l35.9">   return async_run({func: _spin_folder_indexer_gen,</span>
<a href="#l35.10"></a><span id="l35.10">                     args: arguments});</span>
<a href="#l35.11"></a><span id="l35.11"> }</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-function _spin_folder_indexer_gen(aFolderHandle, aExpectedJobGoal) {</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+function* _spin_folder_indexer_gen(aFolderHandle, aExpectedJobGoal) {</span>
<a href="#l35.14"></a><span id="l35.14">   let msgFolder = get_real_injection_folder(aFolderHandle);</span>
<a href="#l35.15"></a><span id="l35.15"> </span>
<a href="#l35.16"></a><span id="l35.16">   // cheat and use indexFolder to build the job for us</span>
<a href="#l35.17"></a><span id="l35.17">   GlodaMsgIndexer.indexFolder(msgFolder);</span>
<a href="#l35.18"></a><span id="l35.18">   // steal that job...</span>
<a href="#l35.19"></a><span id="l35.19">   let job = GlodaIndexer._indexQueue.pop();</span>
<a href="#l35.20"></a><span id="l35.20">   GlodaIndexer._indexingJobGoal--;</span>
<a href="#l35.21"></a><span id="l35.21"> </span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -70,24 +70,24 @@ function _spin_folder_indexer_gen(aFolde</span>
<a href="#l35.23"></a><span id="l35.23">  *  certain range for our logic testing.</span>
<a href="#l35.24"></a><span id="l35.24">  */</span>
<a href="#l35.25"></a><span id="l35.25"> var arbitraryGlodaId = 4096;</span>
<a href="#l35.26"></a><span id="l35.26"> </span>
<a href="#l35.27"></a><span id="l35.27"> /**</span>
<a href="#l35.28"></a><span id="l35.28">  * When we enter a filthy folder we should be marking all the messages as filthy</span>
<a href="#l35.29"></a><span id="l35.29">  *  that have gloda-id's and committing.</span>
<a href="#l35.30"></a><span id="l35.30">  */</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-function test_propagate_filthy_from_folder_to_messages() {</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+function* test_propagate_filthy_from_folder_to_messages() {</span>
<a href="#l35.33"></a><span id="l35.33">   // mark the folder as filthy</span>
<a href="#l35.34"></a><span id="l35.34">   let [folder, msgSet] = make_folder_with_sets([{count: 3}]);</span>
<a href="#l35.35"></a><span id="l35.35">   let glodaFolder = Gloda.getFolderForFolder(folder);</span>
<a href="#l35.36"></a><span id="l35.36">   glodaFolder._dirtyStatus = glodaFolder.kFolderFilthy;</span>
<a href="#l35.37"></a><span id="l35.37"> </span>
<a href="#l35.38"></a><span id="l35.38">   // mark each header with a gloda-id so they can get marked filthy</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineminus">-  for (let msgHdr of msgSet.msgHdrs) {</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineplus">+  for (let msgHdr of msgSet.msgHdrs()) {</span>
<a href="#l35.41"></a><span id="l35.41">     msgHdr.setUint32Property(&quot;gloda-id&quot;, arbitraryGlodaId);</span>
<a href="#l35.42"></a><span id="l35.42">   }</span>
<a href="#l35.43"></a><span id="l35.43"> </span>
<a href="#l35.44"></a><span id="l35.44">   // force the database to see it as filthy so we can verify it changes</span>
<a href="#l35.45"></a><span id="l35.45">   glodaFolder._datastore.updateFolderDirtyStatus(glodaFolder);</span>
<a href="#l35.46"></a><span id="l35.46">   yield sqlExpectCount(1,</span>
<a href="#l35.47"></a><span id="l35.47">     &quot;SELECT COUNT(*) FROM folderLocations WHERE id = ? &quot; +</span>
<a href="#l35.48"></a><span id="l35.48">       &quot;AND dirtyStatus = ?&quot;, glodaFolder.id, glodaFolder.kFolderFilthy);</span>
<a href="#l35.49"></a><span id="l35.49" class="difflineat">@@ -100,28 +100,28 @@ function test_propagate_filthy_from_fold</span>
<a href="#l35.50"></a><span id="l35.50">   do_check_eq(glodaFolder.dirtyStatus, glodaFolder.kFolderDirty);</span>
<a href="#l35.51"></a><span id="l35.51">   // make sure the database sees it as dirty</span>
<a href="#l35.52"></a><span id="l35.52">   yield sqlExpectCount(1,</span>
<a href="#l35.53"></a><span id="l35.53">     &quot;SELECT COUNT(*) FROM folderLocations WHERE id = ? &quot; +</span>
<a href="#l35.54"></a><span id="l35.54">       &quot;AND dirtyStatus = ?&quot;, glodaFolder.id, glodaFolder.kFolderDirty);</span>
<a href="#l35.55"></a><span id="l35.55"> </span>
<a href="#l35.56"></a><span id="l35.56">   // The messages should be filthy per the headers (we force a commit of the</span>
<a href="#l35.57"></a><span id="l35.57">   //  database.)</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineminus">-  for (let msgHdr of msgSet.msgHdrs) {</span>
<a href="#l35.59"></a><span id="l35.59" class="difflineplus">+  for (let msgHdr of msgSet.msgHdrs()) {</span>
<a href="#l35.60"></a><span id="l35.60">     do_check_eq(msgHdr.getUint32Property(&quot;gloda-dirty&quot;),</span>
<a href="#l35.61"></a><span id="l35.61">                 GlodaMsgIndexer.kMessageFilthy);</span>
<a href="#l35.62"></a><span id="l35.62">   }</span>
<a href="#l35.63"></a><span id="l35.63"> }</span>
<a href="#l35.64"></a><span id="l35.64"> </span>
<a href="#l35.65"></a><span id="l35.65"> </span>
<a href="#l35.66"></a><span id="l35.66"> /**</span>
<a href="#l35.67"></a><span id="l35.67">  * Make sure our counting pass and our indexing passes gets it right.  We test</span>
<a href="#l35.68"></a><span id="l35.68">  *  with 0,1,2 messages matching.</span>
<a href="#l35.69"></a><span id="l35.69">  */</span>
<a href="#l35.70"></a><span id="l35.70" class="difflineminus">-function test_count_pass() {</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineplus">+function* test_count_pass() {</span>
<a href="#l35.72"></a><span id="l35.72">   let [folder, msgSet] = make_folder_with_sets([{count: 2}]);</span>
<a href="#l35.73"></a><span id="l35.73">   yield wait_for_message_injection();</span>
<a href="#l35.74"></a><span id="l35.74"> </span>
<a href="#l35.75"></a><span id="l35.75">   let hdrs = msgSet.msgHdrList;</span>
<a href="#l35.76"></a><span id="l35.76"> </span>
<a href="#l35.77"></a><span id="l35.77">   // - (clean) messages with gloda-id's do not get indexed</span>
<a href="#l35.78"></a><span id="l35.78">   // nothing is indexed at this point, so all 2.</span>
<a href="#l35.79"></a><span id="l35.79">   explode_enumeration_after = 2;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_intl.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_intl.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -189,17 +189,17 @@ var intlPhrases = [</span>
<a href="#l36.4"></a><span id="l36.4">  *  subject, body, and attachment name are populated using the encodings in</span>
<a href="#l36.5"></a><span id="l36.5">  *  the phrase's &quot;encodings&quot; attribute, one encoding per message.  Make sure</span>
<a href="#l36.6"></a><span id="l36.6">  *  that the strings as exposed by the gloda representation are equal to the</span>
<a href="#l36.7"></a><span id="l36.7">  *  expected/actual value.</span>
<a href="#l36.8"></a><span id="l36.8">  * Stash each created synthetic message in a resultList list on the phrase so</span>
<a href="#l36.9"></a><span id="l36.9">  *  that we can use them as expected query results in</span>
<a href="#l36.10"></a><span id="l36.10">  *  |test_fulltextsearch|.</span>
<a href="#l36.11"></a><span id="l36.11">  */</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-function test_index(aPhrase) {</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+function* test_index(aPhrase) {</span>
<a href="#l36.14"></a><span id="l36.14">   // create a synthetic message for each of the delightful encoding types</span>
<a href="#l36.15"></a><span id="l36.15">   let messages = [];</span>
<a href="#l36.16"></a><span id="l36.16">   aPhrase.resultList = [];</span>
<a href="#l36.17"></a><span id="l36.17">   for (let charset in aPhrase.encodings) {</span>
<a href="#l36.18"></a><span id="l36.18">     let [quoted, bodyEncoded] = aPhrase.encodings[charset];</span>
<a href="#l36.19"></a><span id="l36.19"> </span>
<a href="#l36.20"></a><span id="l36.20">     let smsg = gMessageGenerator.makeMessage({</span>
<a href="#l36.21"></a><span id="l36.21">       subject: quoted,</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineat">@@ -239,33 +239,33 @@ function verify_index(smsg, gmsg) {</span>
<a href="#l36.23"></a><span id="l36.23">       &quot; (len: &quot; + attachmentName.length + &quot;)&quot;);</span>
<a href="#l36.24"></a><span id="l36.24">   do_check_eq(actual, attachmentName);</span>
<a href="#l36.25"></a><span id="l36.25"> }</span>
<a href="#l36.26"></a><span id="l36.26"> </span>
<a href="#l36.27"></a><span id="l36.27"> /**</span>
<a href="#l36.28"></a><span id="l36.28">  * For each phrase, make sure that all of the searchPhrases either match or fail</span>
<a href="#l36.29"></a><span id="l36.29">  *  to match as appropriate.</span>
<a href="#l36.30"></a><span id="l36.30">  */</span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-function test_fulltextsearch(aPhrase)</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineplus">+function* test_fulltextsearch(aPhrase)</span>
<a href="#l36.33"></a><span id="l36.33"> {</span>
<a href="#l36.34"></a><span id="l36.34">   for (let searchPhrase of aPhrase.searchPhrases) {</span>
<a href="#l36.35"></a><span id="l36.35">     let query = Gloda.newQuery(Gloda.NOUN_MESSAGE);</span>
<a href="#l36.36"></a><span id="l36.36">     query.bodyMatches(searchPhrase.body);</span>
<a href="#l36.37"></a><span id="l36.37">     queryExpect(query, searchPhrase.match ? aPhrase.resultList : []);</span>
<a href="#l36.38"></a><span id="l36.38">     yield false; // queryExpect is async</span>
<a href="#l36.39"></a><span id="l36.39">   }</span>
<a href="#l36.40"></a><span id="l36.40"> }</span>
<a href="#l36.41"></a><span id="l36.41"> </span>
<a href="#l36.42"></a><span id="l36.42"> </span>
<a href="#l36.43"></a><span id="l36.43"> /**</span>
<a href="#l36.44"></a><span id="l36.44">  * Names with encoded commas in them can screw up our mail address parsing if</span>
<a href="#l36.45"></a><span id="l36.45">  *  we perform the mime decoding prior to handing the mail address off for</span>
<a href="#l36.46"></a><span id="l36.46">  *  parsing.</span>
<a href="#l36.47"></a><span id="l36.47">  */</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineminus">-function test_encoding_complications_with_mail_addresses() {</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineplus">+function* test_encoding_complications_with_mail_addresses() {</span>
<a href="#l36.50"></a><span id="l36.50">   let basePair = gMessageGenerator.makeNameAndAddress();</span>
<a href="#l36.51"></a><span id="l36.51">   // The =2C encodes a comma!</span>
<a href="#l36.52"></a><span id="l36.52">   let encodedCommaPair = [&quot;=?iso-8859-1?Q?=DFnake=2C_=DFammy?=&quot;,</span>
<a href="#l36.53"></a><span id="l36.53">                           basePair[1]];</span>
<a href="#l36.54"></a><span id="l36.54">   // &quot;Snake, Sammy&quot;, but with a much cooler looking S-like character!</span>
<a href="#l36.55"></a><span id="l36.55">   let decodedName = &quot;\u00dfnake, \u00dfammy&quot;;</span>
<a href="#l36.56"></a><span id="l36.56">   // Use the thing with the comma in it for all cases; previously there was an</span>
<a href="#l36.57"></a><span id="l36.57">   //  asymmetry between to and cc...</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_migration.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_migration.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -12,17 +12,17 @@</span>
<a href="#l37.4"></a><span id="l37.4"> </span>
<a href="#l37.5"></a><span id="l37.5"> load(&quot;resources/glodaTestHelper.js&quot;);</span>
<a href="#l37.6"></a><span id="l37.6"> </span>
<a href="#l37.7"></a><span id="l37.7"> /**</span>
<a href="#l37.8"></a><span id="l37.8">  * Fix the fallout from bug 732372 (with this patch for bug 734507) which left</span>
<a href="#l37.9"></a><span id="l37.9">  *  identities whose e-mails were in the address book without contacts and then</span>
<a href="#l37.10"></a><span id="l37.10">  *  broke messages involving them.</span>
<a href="#l37.11"></a><span id="l37.11">  */</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-function test_fix_missing_contacts_and_fallout() {</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+function* test_fix_missing_contacts_and_fallout() {</span>
<a href="#l37.14"></a><span id="l37.14">   // -- setup</span>
<a href="#l37.15"></a><span id="l37.15"> </span>
<a href="#l37.16"></a><span id="l37.16">   // - Create 4 e-mail addresses, 2 of which are in the address book.  (We want</span>
<a href="#l37.17"></a><span id="l37.17">   //    to make sure we have to iterate, hence &gt;1).</span>
<a href="#l37.18"></a><span id="l37.18">   let abPeeps = gMessageGenerator.makeNamesAndAddresses(2),</span>
<a href="#l37.19"></a><span id="l37.19">       nonAbPeeps = gMessageGenerator.makeNamesAndAddresses(2);</span>
<a href="#l37.20"></a><span id="l37.20">   makeABCardForAddressPair(abPeeps[0]);</span>
<a href="#l37.21"></a><span id="l37.21">   makeABCardForAddressPair(abPeeps[1]);</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineat">@@ -60,17 +60,17 @@ function test_fix_missing_contacts_and_f</span>
<a href="#l37.23"></a><span id="l37.23">                yesMsgSet.glodaMessages[0].from.contact.id + &quot;, &quot; +</span>
<a href="#l37.24"></a><span id="l37.24">                yesMsgSet.glodaMessages[0].to[0].contact.id + &quot;)&quot;);</span>
<a href="#l37.25"></a><span id="l37.25"> </span>
<a href="#l37.26"></a><span id="l37.26">   // - Nuke the gloda caches so we totally forget those contact records.</span>
<a href="#l37.27"></a><span id="l37.27">   nukeGlodaCachesAndCollections();</span>
<a href="#l37.28"></a><span id="l37.28"> </span>
<a href="#l37.29"></a><span id="l37.29">   // - Manually mark the messages involving the inAB people with the _old_ bad</span>
<a href="#l37.30"></a><span id="l37.30">   //    id marker so that our scan will see them.</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineminus">-  for (let msgHdr of yesMsgSet.msgHdrs) {</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineplus">+  for (let msgHdr of yesMsgSet.msgHdrs()) {</span>
<a href="#l37.33"></a><span id="l37.33">     msgHdr.setUint32Property(&quot;gloda-id&quot;, GLODA_OLD_BAD_MESSAGE_ID);</span>
<a href="#l37.34"></a><span id="l37.34">   }</span>
<a href="#l37.35"></a><span id="l37.35"> </span>
<a href="#l37.36"></a><span id="l37.36">   // - mark the db schema version to the version with the bug (26)</span>
<a href="#l37.37"></a><span id="l37.37">   // sanity check that gloda actually populates the value with the current</span>
<a href="#l37.38"></a><span id="l37.38">   //  version correctly...</span>
<a href="#l37.39"></a><span id="l37.39">   do_check_eq(GlodaDatastore._actualSchemaVersion,</span>
<a href="#l37.40"></a><span id="l37.40">               GlodaDatastore._schemaVersion);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_mime_attachments_size.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_mime_attachments_size.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -218,17 +218,17 @@ function check_attachments(aMimeMsg, eps</span>
<a href="#l38.4"></a><span id="l38.4">   if (checkTotalSize !== false) {</span>
<a href="#l38.5"></a><span id="l38.5">     dump(&quot;*** Total size comparison: &quot; + totalSize + &quot; vs &quot; + aMimeMsg.size + &quot;\n&quot;);</span>
<a href="#l38.6"></a><span id="l38.6">     do_check_true(Math.abs(aMimeMsg.size - totalSize) &lt;= epsilon);</span>
<a href="#l38.7"></a><span id="l38.7">   }</span>
<a href="#l38.8"></a><span id="l38.8"> </span>
<a href="#l38.9"></a><span id="l38.9">   async_driver();</span>
<a href="#l38.10"></a><span id="l38.10"> }</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-function test_message_attachments(info) {</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+function* test_message_attachments(info) {</span>
<a href="#l38.14"></a><span id="l38.14">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l38.15"></a><span id="l38.15">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l38.16"></a><span id="l38.16">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l38.17"></a><span id="l38.17"> </span>
<a href="#l38.18"></a><span id="l38.18">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l38.19"></a><span id="l38.19">   // dump(synMsg.toMboxString()+&quot;\n&quot;);</span>
<a href="#l38.20"></a><span id="l38.20"> </span>
<a href="#l38.21"></a><span id="l38.21">   MsgHdrToMimeMessage(msgHdr, null, function(aMsgHdr, aMimeMsg) {</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineat">@@ -304,17 +304,17 @@ function check_bogus_parts(aMimeMsg, { e</span>
<a href="#l38.23"></a><span id="l38.23">     let totalSize = htmlText.length + partSize;</span>
<a href="#l38.24"></a><span id="l38.24">     dump(totalSize+&quot; vs &quot;+aMimeMsg.size+&quot;\n&quot;);</span>
<a href="#l38.25"></a><span id="l38.25">     do_check_true(Math.abs(aMimeMsg.size - totalSize) &lt;= epsilon);</span>
<a href="#l38.26"></a><span id="l38.26">   }</span>
<a href="#l38.27"></a><span id="l38.27"> </span>
<a href="#l38.28"></a><span id="l38.28">   async_driver();</span>
<a href="#l38.29"></a><span id="l38.29"> }</span>
<a href="#l38.30"></a><span id="l38.30"> </span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-function test_bogus_messages(info) {</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+function* test_bogus_messages(info) {</span>
<a href="#l38.33"></a><span id="l38.33">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l38.34"></a><span id="l38.34">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l38.35"></a><span id="l38.35">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l38.36"></a><span id="l38.36"> </span>
<a href="#l38.37"></a><span id="l38.37">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l38.38"></a><span id="l38.38">   // dump(synMsg.toMboxString());</span>
<a href="#l38.39"></a><span id="l38.39"> </span>
<a href="#l38.40"></a><span id="l38.40">   MsgHdrToMimeMessage(msgHdr, null, function(aMsgHdr, aMimeMsg) {</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineat">@@ -332,17 +332,17 @@ function test_bogus_messages(info) {</span>
<a href="#l38.42"></a><span id="l38.42"> var messageHaveAttachmentsInfos = [</span>
<a href="#l38.43"></a><span id="l38.43">   {</span>
<a href="#l38.44"></a><span id="l38.44">     name: 'multipart/related',</span>
<a href="#l38.45"></a><span id="l38.45">     bodyPart: new SyntheticPartMultiMixed([partHtml, partTachVCard]),</span>
<a href="#l38.46"></a><span id="l38.46">     number: 1,</span>
<a href="#l38.47"></a><span id="l38.47">   },</span>
<a href="#l38.48"></a><span id="l38.48"> ];</span>
<a href="#l38.49"></a><span id="l38.49"> </span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-function test_have_attachments(info) {</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineplus">+function* test_have_attachments(info) {</span>
<a href="#l38.52"></a><span id="l38.52">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l38.53"></a><span id="l38.53">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l38.54"></a><span id="l38.54">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l38.55"></a><span id="l38.55"> </span>
<a href="#l38.56"></a><span id="l38.56">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l38.57"></a><span id="l38.57">   // dump(synMsg.toMboxString());</span>
<a href="#l38.58"></a><span id="l38.58"> </span>
<a href="#l38.59"></a><span id="l38.59">   MsgHdrToMimeMessage(msgHdr, null, function(aMsgHdr, aMimeMsg) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_mime_emitter.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_mime_emitter.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -284,17 +284,17 @@ var messageInfos = [</span>
<a href="#l39.4"></a><span id="l39.4">   },</span>
<a href="#l39.5"></a><span id="l39.5">   {</span>
<a href="#l39.6"></a><span id="l39.6">     name: 'empty multipart section produces no child',</span>
<a href="#l39.7"></a><span id="l39.7">     bodyPart: new SyntheticPartMultiMixed([partText, partEmpty, partTachText])</span>
<a href="#l39.8"></a><span id="l39.8">   },</span>
<a href="#l39.9"></a><span id="l39.9"> ];</span>
<a href="#l39.10"></a><span id="l39.10"> </span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-function test_stream_message(info) {</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+function* test_stream_message(info) {</span>
<a href="#l39.14"></a><span id="l39.14">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l39.15"></a><span id="l39.15">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l39.16"></a><span id="l39.16">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l39.17"></a><span id="l39.17"> </span>
<a href="#l39.18"></a><span id="l39.18">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l39.19"></a><span id="l39.19"> </span>
<a href="#l39.20"></a><span id="l39.20">   MsgHdrToMimeMessage(msgHdr, null, function(aMsgHdr, aMimeMsg) {</span>
<a href="#l39.21"></a><span id="l39.21">     verify_stream_message(info, synMsg, aMsgHdr, aMimeMsg);</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineat">@@ -396,17 +396,17 @@ function verify_stream_message(aInfo, aS</span>
<a href="#l39.23"></a><span id="l39.23">        &quot;\n\n&quot;);</span>
<a href="#l39.24"></a><span id="l39.24"> </span>
<a href="#l39.25"></a><span id="l39.25">   async_driver();</span>
<a href="#l39.26"></a><span id="l39.26"> }</span>
<a href="#l39.27"></a><span id="l39.27"> </span>
<a href="#l39.28"></a><span id="l39.28"> /**</span>
<a href="#l39.29"></a><span id="l39.29">  * Stream</span>
<a href="#l39.30"></a><span id="l39.30">  */</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-function test_sane_bodies() {</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineplus">+function* test_sane_bodies() {</span>
<a href="#l39.33"></a><span id="l39.33">   // 60 bytes long... (becomes 59 on the other side when \r is dropped)</span>
<a href="#l39.34"></a><span id="l39.34">   let hugeString =</span>
<a href="#l39.35"></a><span id="l39.35">     &quot;don't know what you want but I can't  stream it anymore...\r\n&quot;;</span>
<a href="#l39.36"></a><span id="l39.36">   const powahsOfTwo = 10;</span>
<a href="#l39.37"></a><span id="l39.37">   for (let i = 0; i &lt; powahsOfTwo; i++) {</span>
<a href="#l39.38"></a><span id="l39.38">     hugeString = hugeString + hugeString;</span>
<a href="#l39.39"></a><span id="l39.39">   }</span>
<a href="#l39.40"></a><span id="l39.40">   // this will come out to be 60k, of course.</span>
<a href="#l39.41"></a><span id="l39.41" class="difflineat">@@ -498,17 +498,17 @@ var expectedAttachmentsInfo = [</span>
<a href="#l39.42"></a><span id="l39.42">     allUserAttachmentsContentTypes: [&quot;message/rfc822&quot;]</span>
<a href="#l39.43"></a><span id="l39.43">   },</span>
<a href="#l39.44"></a><span id="l39.44">   {</span>
<a href="#l39.45"></a><span id="l39.45">     allAttachmentsContentTypes: [&quot;application/x-funky&quot;, &quot;image/png&quot;, &quot;application/x-funky&quot;],</span>
<a href="#l39.46"></a><span id="l39.46">     allUserAttachmentsContentTypes: [&quot;application/x-funky&quot;, &quot;message/rfc822&quot;]</span>
<a href="#l39.47"></a><span id="l39.47">   },</span>
<a href="#l39.48"></a><span id="l39.48"> ];</span>
<a href="#l39.49"></a><span id="l39.49"> </span>
<a href="#l39.50"></a><span id="l39.50" class="difflineminus">-function test_attachments_correctness () {</span>
<a href="#l39.51"></a><span id="l39.51" class="difflineplus">+function* test_attachments_correctness () {</span>
<a href="#l39.52"></a><span id="l39.52">   for (let [i, params] of attMessagesParams.entries()) {</span>
<a href="#l39.53"></a><span id="l39.53">     let synMsg = gMessageGenerator.makeMessage(params);</span>
<a href="#l39.54"></a><span id="l39.54">     let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l39.55"></a><span id="l39.55">     yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l39.56"></a><span id="l39.56"> </span>
<a href="#l39.57"></a><span id="l39.57">     let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l39.58"></a><span id="l39.58">     // dump(synMsg.toMboxString()+&quot;\n\n&quot;);</span>
<a href="#l39.59"></a><span id="l39.59"> </span>
<a href="#l39.60"></a><span id="l39.60" class="difflineat">@@ -564,17 +564,17 @@ var weirdMessageInfos = [</span>
<a href="#l39.61"></a><span id="l39.61">   {</span>
<a href="#l39.62"></a><span id="l39.62">     name: 'test message with part 1.2 attachment',</span>
<a href="#l39.63"></a><span id="l39.63">     attachments: [{ body: 'attachment',</span>
<a href="#l39.64"></a><span id="l39.64">                     filename: '',</span>
<a href="#l39.65"></a><span id="l39.65">                     format: '' }],</span>
<a href="#l39.66"></a><span id="l39.66">   },</span>
<a href="#l39.67"></a><span id="l39.67"> ];</span>
<a href="#l39.68"></a><span id="l39.68"> </span>
<a href="#l39.69"></a><span id="l39.69" class="difflineminus">-function test_part12_not_an_attachment() {</span>
<a href="#l39.70"></a><span id="l39.70" class="difflineplus">+function* test_part12_not_an_attachment() {</span>
<a href="#l39.71"></a><span id="l39.71">   let synMsg = gMessageGenerator.makeMessage(weirdMessageInfos[0]);</span>
<a href="#l39.72"></a><span id="l39.72">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l39.73"></a><span id="l39.73">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l39.74"></a><span id="l39.74"> </span>
<a href="#l39.75"></a><span id="l39.75">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l39.76"></a><span id="l39.76">   // dump(synMsg.toMboxString());</span>
<a href="#l39.77"></a><span id="l39.77"> </span>
<a href="#l39.78"></a><span id="l39.78">   MsgHdrToMimeMessage(msgHdr, null, function(aMsgHdr, aMimeMsg) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_msg_search.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_msg_search.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -61,61 +61,61 @@ function asyncMsgSearcherExpect(aFulltex</span>
<a href="#l40.4"></a><span id="l40.4">   queryExpect(searcher.buildFulltextQuery(), aExpectedSet);</span>
<a href="#l40.5"></a><span id="l40.5">   return false;</span>
<a href="#l40.6"></a><span id="l40.6"> }</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8"> /**</span>
<a href="#l40.9"></a><span id="l40.9">  * Verify that the ranking function is using the weights as expected.  We do not</span>
<a href="#l40.10"></a><span id="l40.10">  *  need to test all the permutations</span>
<a href="#l40.11"></a><span id="l40.11">  */</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-function test_fulltext_weighting_by_column() {</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+function* test_fulltext_weighting_by_column() {</span>
<a href="#l40.14"></a><span id="l40.14">   let ustr = unique_string();</span>
<a href="#l40.15"></a><span id="l40.15">   let [folder, subjSet, bodySet] = make_folder_with_sets(</span>
<a href="#l40.16"></a><span id="l40.16">     [{count: 1, subject: ustr}, {count: 1, body: {body: ustr}}]);</span>
<a href="#l40.17"></a><span id="l40.17">   yield wait_for_gloda_indexer([subjSet, bodySet]);</span>
<a href="#l40.18"></a><span id="l40.18">   yield asyncMsgSearcherExpect(ustr, subjSet);</span>
<a href="#l40.19"></a><span id="l40.19"> }</span>
<a href="#l40.20"></a><span id="l40.20"> </span>
<a href="#l40.21"></a><span id="l40.21"> /**</span>
<a href="#l40.22"></a><span id="l40.22">  * A term mentioned 3 times in the body is worth more than twice in the subject.</span>
<a href="#l40.23"></a><span id="l40.23">  * (This is because the subject saturates at one occurrence worth 2.0 and the</span>
<a href="#l40.24"></a><span id="l40.24">  * body does not saturate until 10, each worth 1.0.)</span>
<a href="#l40.25"></a><span id="l40.25">  */</span>
<a href="#l40.26"></a><span id="l40.26" class="difflineminus">-function test_fulltext_weighting_saturation() {</span>
<a href="#l40.27"></a><span id="l40.27" class="difflineplus">+function* test_fulltext_weighting_saturation() {</span>
<a href="#l40.28"></a><span id="l40.28">   let ustr = unique_string();</span>
<a href="#l40.29"></a><span id="l40.29">   let double_ustr = ustr + &quot; &quot; + ustr;</span>
<a href="#l40.30"></a><span id="l40.30">   let thrice_ustr = ustr + &quot; &quot; + ustr + &quot; &quot; + ustr;</span>
<a href="#l40.31"></a><span id="l40.31">   let [folder, subjSet, bodySet] = make_folder_with_sets(</span>
<a href="#l40.32"></a><span id="l40.32">     [{count: 1, subject: double_ustr}, {count: 1, body: {body: thrice_ustr}}]);</span>
<a href="#l40.33"></a><span id="l40.33">   yield wait_for_gloda_indexer([subjSet, bodySet]);</span>
<a href="#l40.34"></a><span id="l40.34">   yield asyncMsgSearcherExpect(ustr, bodySet);</span>
<a href="#l40.35"></a><span id="l40.35"> }</span>
<a href="#l40.36"></a><span id="l40.36"> </span>
<a href="#l40.37"></a><span id="l40.37"> /**</span>
<a href="#l40.38"></a><span id="l40.38">  * Use a starred message with the same fulltext match characteristics as another</span>
<a href="#l40.39"></a><span id="l40.39">  * message to verify the preference goes the right way.  Have the starred</span>
<a href="#l40.40"></a><span id="l40.40">  * message be the older message for safety.</span>
<a href="#l40.41"></a><span id="l40.41">  */</span>
<a href="#l40.42"></a><span id="l40.42" class="difflineminus">-function test_static_interestingness_boost_works() {</span>
<a href="#l40.43"></a><span id="l40.43" class="difflineplus">+function* test_static_interestingness_boost_works() {</span>
<a href="#l40.44"></a><span id="l40.44">   let ustr = unique_string();</span>
<a href="#l40.45"></a><span id="l40.45">   let [folder, starred, notStarred] = make_folder_with_sets(</span>
<a href="#l40.46"></a><span id="l40.46">     [{count: 1, subject: ustr}, {count: 1, subject: ustr}]);</span>
<a href="#l40.47"></a><span id="l40.47">   // index in their native state</span>
<a href="#l40.48"></a><span id="l40.48">   yield wait_for_gloda_indexer([starred, notStarred]);</span>
<a href="#l40.49"></a><span id="l40.49">   // star and index</span>
<a href="#l40.50"></a><span id="l40.50">   starred.setStarred(true);</span>
<a href="#l40.51"></a><span id="l40.51">   yield wait_for_gloda_indexer([starred]);</span>
<a href="#l40.52"></a><span id="l40.52">   // stars upon thars wins</span>
<a href="#l40.53"></a><span id="l40.53">   yield asyncMsgSearcherExpect(ustr, starred);</span>
<a href="#l40.54"></a><span id="l40.54"> }</span>
<a href="#l40.55"></a><span id="l40.55"> </span>
<a href="#l40.56"></a><span id="l40.56"> /**</span>
<a href="#l40.57"></a><span id="l40.57">  * Make sure that the query does not retrieve more than actually matches.</span>
<a href="#l40.58"></a><span id="l40.58">  */</span>
<a href="#l40.59"></a><span id="l40.59" class="difflineminus">-function test_joins_do_not_return_everybody() {</span>
<a href="#l40.60"></a><span id="l40.60" class="difflineplus">+function* test_joins_do_not_return_everybody() {</span>
<a href="#l40.61"></a><span id="l40.61">   let ustr = unique_string();</span>
<a href="#l40.62"></a><span id="l40.62">   let [folder, subjSet] = make_folder_with_sets([{count: 1, subject: ustr}]);</span>
<a href="#l40.63"></a><span id="l40.63">   yield wait_for_gloda_indexer([subjSet]);</span>
<a href="#l40.64"></a><span id="l40.64">   yield asyncMsgSearcherExpect(ustr, subjSet, 2);</span>
<a href="#l40.65"></a><span id="l40.65"> }</span>
<a href="#l40.66"></a><span id="l40.66"> </span>
<a href="#l40.67"></a><span id="l40.67"> var tests = [</span>
<a href="#l40.68"></a><span id="l40.68">   test_fulltext_weighting_by_column,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_noun_mimetype.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_noun_mimetype.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -18,17 +18,17 @@ Components.utils.import(&quot;resource:///mod</span>
<a href="#l41.4"></a><span id="l41.4"> var passResults = [];</span>
<a href="#l41.5"></a><span id="l41.5"> var curPassResults;</span>
<a href="#l41.6"></a><span id="l41.6"> /**</span>
<a href="#l41.7"></a><span id="l41.7">  * Setup a new 'pass' by nuking the MimeTypeNoun's state if it has any.  The</span>
<a href="#l41.8"></a><span id="l41.8">  *  goal here is to verify that the database persistence is actually working,</span>
<a href="#l41.9"></a><span id="l41.9">  *  and we can only do that if we convince it to nuke its authoritative 'cache'</span>
<a href="#l41.10"></a><span id="l41.10">  *  and grab a new copy.</span>
<a href="#l41.11"></a><span id="l41.11">  */</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-function new_pass() {</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+function* new_pass() {</span>
<a href="#l41.14"></a><span id="l41.14">   // we have to nuke if it has already happened...</span>
<a href="#l41.15"></a><span id="l41.15">   if (passResults.length) {</span>
<a href="#l41.16"></a><span id="l41.16">     MimeTypeNoun._mimeTypes = {};</span>
<a href="#l41.17"></a><span id="l41.17">     MimeTypeNoun._mimeTypesByID = {};</span>
<a href="#l41.18"></a><span id="l41.18">     MimeTypeNoun._mimeTypeHighID = {};</span>
<a href="#l41.19"></a><span id="l41.19">     MimeTypeNoun._highID = 0;</span>
<a href="#l41.20"></a><span id="l41.20">     MimeTypeNoun._init();</span>
<a href="#l41.21"></a><span id="l41.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_query_core.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_query_core.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -102,17 +102,17 @@ Widget.prototype = {</span>
<a href="#l42.4"></a><span id="l42.4"> </span>
<a href="#l42.5"></a><span id="l42.5">   toString: function () {</span>
<a href="#l42.6"></a><span id="l42.6">     return &quot;&quot; + this.id;</span>
<a href="#l42.7"></a><span id="l42.7">   }</span>
<a href="#l42.8"></a><span id="l42.8"> };</span>
<a href="#l42.9"></a><span id="l42.9"> </span>
<a href="#l42.10"></a><span id="l42.10"> var WidgetProvider = {</span>
<a href="#l42.11"></a><span id="l42.11">   providerName: &quot;widget&quot;,</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  process: function () {</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+  process: function*() {</span>
<a href="#l42.14"></a><span id="l42.14">     yield Gloda.kWorkDone;</span>
<a href="#l42.15"></a><span id="l42.15">   }</span>
<a href="#l42.16"></a><span id="l42.16"> };</span>
<a href="#l42.17"></a><span id="l42.17"> </span>
<a href="#l42.18"></a><span id="l42.18"> var WidgetNoun;</span>
<a href="#l42.19"></a><span id="l42.19"> function setup_test_noun_and_attributes() {</span>
<a href="#l42.20"></a><span id="l42.20">   // --- noun</span>
<a href="#l42.21"></a><span id="l42.21">   WidgetNoun = Gloda.defineNoun({</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineat">@@ -274,17 +274,17 @@ var testUnique = 100;</span>
<a href="#l42.23"></a><span id="l42.23">  * Widgets with multiIntAttr populated with one or more values.</span>
<a href="#l42.24"></a><span id="l42.24">  */</span>
<a href="#l42.25"></a><span id="l42.25"> var nonSingularWidgets;</span>
<a href="#l42.26"></a><span id="l42.26"> /**</span>
<a href="#l42.27"></a><span id="l42.27">  * Widgets with multiIntAttr unpopulated.</span>
<a href="#l42.28"></a><span id="l42.28">  */</span>
<a href="#l42.29"></a><span id="l42.29"> var singularWidgets;</span>
<a href="#l42.30"></a><span id="l42.30"> </span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-function setup_non_singular_values() {</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+function* setup_non_singular_values() {</span>
<a href="#l42.33"></a><span id="l42.33">   testUnique++;</span>
<a href="#l42.34"></a><span id="l42.34">   let origin = new Date(&quot;2007/01/01&quot;);</span>
<a href="#l42.35"></a><span id="l42.35">   nonSingularWidgets = [</span>
<a href="#l42.36"></a><span id="l42.36">     new Widget(testUnique, origin, &quot;ns1&quot;, 0, &quot;&quot;, &quot;&quot;),</span>
<a href="#l42.37"></a><span id="l42.37">     new Widget(testUnique, origin, &quot;ns2&quot;, 0, &quot;&quot;, &quot;&quot;),</span>
<a href="#l42.38"></a><span id="l42.38">   ];</span>
<a href="#l42.39"></a><span id="l42.39">   singularWidgets = [</span>
<a href="#l42.40"></a><span id="l42.40">     new Widget(testUnique, origin, &quot;s1&quot;, 0, &quot;&quot;, &quot;&quot;),</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineat">@@ -312,17 +312,17 @@ function test_query_has_value_for_non_si</span>
<a href="#l42.42"></a><span id="l42.42">  *  empty set.  We don't find the one without the attribute since that's</span>
<a href="#l42.43"></a><span id="l42.43">  *  actually something different.</span>
<a href="#l42.44"></a><span id="l42.44">  * We also want to test that re-indexing properly adds/removes the attribute</span>
<a href="#l42.45"></a><span id="l42.45">  *  so change the object and make sure everything happens correctly.</span>
<a href="#l42.46"></a><span id="l42.46">  *</span>
<a href="#l42.47"></a><span id="l42.47">  * @tests gloda.datastore.sqlgen.kConstraintIn.emptySet</span>
<a href="#l42.48"></a><span id="l42.48">  * @tests gloda.query.test.kConstraintIn.emptySet</span>
<a href="#l42.49"></a><span id="l42.49">  */</span>
<a href="#l42.50"></a><span id="l42.50" class="difflineminus">-function test_empty_set_logic() {</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineplus">+function* test_empty_set_logic() {</span>
<a href="#l42.52"></a><span id="l42.52">   // - initial query based on the setup previously</span>
<a href="#l42.53"></a><span id="l42.53">   mark_sub_test_start(&quot;initial index case&quot;);</span>
<a href="#l42.54"></a><span id="l42.54">   let query = Gloda.newQuery(WidgetNoun.id);</span>
<a href="#l42.55"></a><span id="l42.55">   query.inum(testUnique);</span>
<a href="#l42.56"></a><span id="l42.56">   query.multiIntAttr(null);</span>
<a href="#l42.57"></a><span id="l42.57">   queryExpect(query, [singularWidgets[0]]);</span>
<a href="#l42.58"></a><span id="l42.58">   yield false;</span>
<a href="#l42.59"></a><span id="l42.59"> </span>
<a href="#l42.60"></a><span id="l42.60" class="difflineat">@@ -376,17 +376,17 @@ var SCORE_FOR_FULLTEXT_MATCH = 1;</span>
<a href="#l42.61"></a><span id="l42.61"> /**</span>
<a href="#l42.62"></a><span id="l42.62">  * Roughly how many characters are in each offset match.</span>
<a href="#l42.63"></a><span id="l42.63">  */</span>
<a href="#l42.64"></a><span id="l42.64"> var OFFSET_CHARS_PER_FULLTEXT_MATCH = 8;</span>
<a href="#l42.65"></a><span id="l42.65"> </span>
<a href="#l42.66"></a><span id="l42.66"> var fooWidgets = null;</span>
<a href="#l42.67"></a><span id="l42.67"> var barBazWidgets = null;</span>
<a href="#l42.68"></a><span id="l42.68"> </span>
<a href="#l42.69"></a><span id="l42.69" class="difflineminus">-function setup_search_ranking_idiom() {</span>
<a href="#l42.70"></a><span id="l42.70" class="difflineplus">+function* setup_search_ranking_idiom() {</span>
<a href="#l42.71"></a><span id="l42.71">   // --- build some widgets for testing.  use inum to represent the expected</span>
<a href="#l42.72"></a><span id="l42.72">   //  result sequence</span>
<a href="#l42.73"></a><span id="l42.73">   // setup a base date...</span>
<a href="#l42.74"></a><span id="l42.74">   let origin = new Date(&quot;2008/01/01&quot;);</span>
<a href="#l42.75"></a><span id="l42.75">   let daymore = new Date(&quot;2008/01/02&quot;);</span>
<a href="#l42.76"></a><span id="l42.76">   let monthmore = new Date(&quot;2008/02/01&quot;);</span>
<a href="#l42.77"></a><span id="l42.77">   fooWidgets = [</span>
<a href="#l42.78"></a><span id="l42.78">     // -- setup the term &quot;foo&quot; to do frequency tests</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_smime_mimemsg_representation.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -29,17 +29,17 @@ function initNSS() {</span>
<a href="#l43.4"></a><span id="l43.4">     keydb.copyTo(profile, f);</span>
<a href="#l43.5"></a><span id="l43.5">   }</span>
<a href="#l43.6"></a><span id="l43.6"> </span>
<a href="#l43.7"></a><span id="l43.7">   // Ensure NSS is initialized.</span>
<a href="#l43.8"></a><span id="l43.8">   Cc[&quot;@mozilla.org/psm;1&quot;].getService(Ci.nsISupports);</span>
<a href="#l43.9"></a><span id="l43.9"> }</span>
<a href="#l43.10"></a><span id="l43.10"> </span>
<a href="#l43.11"></a><span id="l43.11"> var gInbox;</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-function test_smime_mimemsg() {</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+function* test_smime_mimemsg() {</span>
<a href="#l43.14"></a><span id="l43.14">   let msg = msgGen.makeEncryptedSMimeMessage({</span>
<a href="#l43.15"></a><span id="l43.15">     from: [&quot;Tinderbox&quot;, &quot;tinderbox@foo.invalid&quot;],</span>
<a href="#l43.16"></a><span id="l43.16">     to: [[&quot;Tinderbox&quot;, &quot;tinderbox@foo.invalid&quot;]],</span>
<a href="#l43.17"></a><span id="l43.17">     subject: &quot;Albertine disparue (La Fugitive)&quot;,</span>
<a href="#l43.18"></a><span id="l43.18">     body: { body: encrypted_blurb },</span>
<a href="#l43.19"></a><span id="l43.19">   });</span>
<a href="#l43.20"></a><span id="l43.20">   let synSet = new SyntheticMessageSet([msg]);</span>
<a href="#l43.21"></a><span id="l43.21">   yield add_sets_to_folder(gInbox, [synSet]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_startup_offline.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_startup_offline.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -14,17 +14,17 @@ Services.io.manageOfflineStatus = false;</span>
<a href="#l44.4"></a><span id="l44.4"> Services.io.offline = true;</span>
<a href="#l44.5"></a><span id="l44.5"> </span>
<a href="#l44.6"></a><span id="l44.6"> load(&quot;resources/glodaTestHelper.js&quot;);</span>
<a href="#l44.7"></a><span id="l44.7"> </span>
<a href="#l44.8"></a><span id="l44.8"> /**</span>
<a href="#l44.9"></a><span id="l44.9">  * Make sure that if we have to reparse a local folder we do not hang or</span>
<a href="#l44.10"></a><span id="l44.10">  *  anything.  (We had a regression where we would hang.)</span>
<a href="#l44.11"></a><span id="l44.11">  */</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-function test_gloda_offline_startup() {</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+function* test_gloda_offline_startup() {</span>
<a href="#l44.14"></a><span id="l44.14">   // Set up a folder for indexing and check the message doesn't get indexed.</span>
<a href="#l44.15"></a><span id="l44.15">   let [folder, msgSet] = make_folder_with_sets([{count: 1}]);</span>
<a href="#l44.16"></a><span id="l44.16">   yield wait_for_message_injection();</span>
<a href="#l44.17"></a><span id="l44.17">   yield wait_for_gloda_indexer();</span>
<a href="#l44.18"></a><span id="l44.18"> </span>
<a href="#l44.19"></a><span id="l44.19">   // Now go online...</span>
<a href="#l44.20"></a><span id="l44.20">   Services.io.offline = false;</span>
<a href="#l44.21"></a><span id="l44.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_autosync_date_constraints.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_autosync_date_constraints.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -19,17 +19,17 @@ function addMessagesToServer(messages, m</span>
<a href="#l45.4"></a><span id="l45.4">   {</span>
<a href="#l45.5"></a><span id="l45.5">     let dataUri = 'data:text/plain,' + message.toMessageString();</span>
<a href="#l45.6"></a><span id="l45.6">     mailbox.addMessage(new imapMessage(dataUri, mailbox.uidnext++, []));</span>
<a href="#l45.7"></a><span id="l45.7">   });</span>
<a href="#l45.8"></a><span id="l45.8"> }</span>
<a href="#l45.9"></a><span id="l45.9"> </span>
<a href="#l45.10"></a><span id="l45.10"> var tests = [</span>
<a href="#l45.11"></a><span id="l45.11">   setup,</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  function downloadForOffline() {</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+  function* downloadForOffline() {</span>
<a href="#l45.14"></a><span id="l45.14">     // ...and download for offline use.</span>
<a href="#l45.15"></a><span id="l45.15">     // This downloads all messages, ignoring the autosync age constraints.</span>
<a href="#l45.16"></a><span id="l45.16">     IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l45.17"></a><span id="l45.17">     yield false;</span>
<a href="#l45.18"></a><span id="l45.18">   },</span>
<a href="#l45.19"></a><span id="l45.19">   function applyRetentionSettings() {</span>
<a href="#l45.20"></a><span id="l45.20">     IMAPPump.inbox.applyRetentionSettings();</span>
<a href="#l45.21"></a><span id="l45.21">     let enumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_bccProperty.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_bccProperty.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -15,17 +15,17 @@ var gMsgFile = do_get_file(&quot;../../../dat</span>
<a href="#l46.4"></a><span id="l46.4"> </span>
<a href="#l46.5"></a><span id="l46.5"> var tests = [</span>
<a href="#l46.6"></a><span id="l46.6">   setup,</span>
<a href="#l46.7"></a><span id="l46.7">   downloadAllForOffline,</span>
<a href="#l46.8"></a><span id="l46.8">   checkBccs,</span>
<a href="#l46.9"></a><span id="l46.9">   teardown</span>
<a href="#l46.10"></a><span id="l46.10"> ];</span>
<a href="#l46.11"></a><span id="l46.11"> </span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-function setup() {</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+function* setup() {</span>
<a href="#l46.14"></a><span id="l46.14">   setupIMAPPump();</span>
<a href="#l46.15"></a><span id="l46.15"> </span>
<a href="#l46.16"></a><span id="l46.16">   /*</span>
<a href="#l46.17"></a><span id="l46.17">    * Ok, prelude done. Read the original message from disk</span>
<a href="#l46.18"></a><span id="l46.18">    * (through a file URI), and add it to the Inbox.</span>
<a href="#l46.19"></a><span id="l46.19">    */</span>
<a href="#l46.20"></a><span id="l46.20">   let msgfileuri =</span>
<a href="#l46.21"></a><span id="l46.21">     Services.io.newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l46.22"></a><span id="l46.22" class="difflineat">@@ -33,17 +33,17 @@ function setup() {</span>
<a href="#l46.23"></a><span id="l46.23">   IMAPPump.mailbox.addMessage(new imapMessage(msgfileuri.spec,</span>
<a href="#l46.24"></a><span id="l46.24">                                           IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l46.25"></a><span id="l46.25"> </span>
<a href="#l46.26"></a><span id="l46.26">   // ...and download for offline use.</span>
<a href="#l46.27"></a><span id="l46.27">   IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l46.28"></a><span id="l46.28">   yield false;</span>
<a href="#l46.29"></a><span id="l46.29"> }</span>
<a href="#l46.30"></a><span id="l46.30"> </span>
<a href="#l46.31"></a><span id="l46.31" class="difflineminus">-function downloadAllForOffline() {</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineplus">+function* downloadAllForOffline() {</span>
<a href="#l46.33"></a><span id="l46.33">   IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l46.34"></a><span id="l46.34">   yield false;</span>
<a href="#l46.35"></a><span id="l46.35"> }</span>
<a href="#l46.36"></a><span id="l46.36"> </span>
<a href="#l46.37"></a><span id="l46.37"> function checkBccs() {</span>
<a href="#l46.38"></a><span id="l46.38">   // locate the new message by enumerating through the database</span>
<a href="#l46.39"></a><span id="l46.39">   let enumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l46.40"></a><span id="l46.40">   while(enumerator.hasMoreElements()) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_bug460636.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_bug460636.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -14,17 +14,17 @@ var gFileName = &quot;bug460636&quot;;</span>
<a href="#l47.4"></a><span id="l47.4"> var gMsgFile = do_get_file(&quot;../../../data/&quot; + gFileName);</span>
<a href="#l47.5"></a><span id="l47.5">                      </span>
<a href="#l47.6"></a><span id="l47.6"> var tests = [</span>
<a href="#l47.7"></a><span id="l47.7">   setup,</span>
<a href="#l47.8"></a><span id="l47.8">   checkSavedMessage,</span>
<a href="#l47.9"></a><span id="l47.9">   teardown</span>
<a href="#l47.10"></a><span id="l47.10"> ];</span>
<a href="#l47.11"></a><span id="l47.11"> </span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-function setup() {</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+function* setup() {</span>
<a href="#l47.14"></a><span id="l47.14">   setupIMAPPump();</span>
<a href="#l47.15"></a><span id="l47.15"> </span>
<a href="#l47.16"></a><span id="l47.16">   /*</span>
<a href="#l47.17"></a><span id="l47.17">    * Ok, prelude done. Read the original message from disk</span>
<a href="#l47.18"></a><span id="l47.18">    * (through a file URI), and add it to the Inbox.</span>
<a href="#l47.19"></a><span id="l47.19">    */</span>
<a href="#l47.20"></a><span id="l47.20">   var msgfileuri =</span>
<a href="#l47.21"></a><span id="l47.21">     Services.io.newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_chunkLastLF.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_chunkLastLF.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -51,17 +51,17 @@ function run_test()</span>
<a href="#l48.4"></a><span id="l48.4">   // The server doesn't support more than one connection</span>
<a href="#l48.5"></a><span id="l48.5">   Services.prefs.setIntPref(&quot;mail.server.server1.max_cached_connections&quot;, 1);</span>
<a href="#l48.6"></a><span id="l48.6">   // We aren't interested in downloading messages automatically</span>
<a href="#l48.7"></a><span id="l48.7">   Services.prefs.setBoolPref(&quot;mail.server.server1.download_on_biff&quot;, false);</span>
<a href="#l48.8"></a><span id="l48.8"> </span>
<a href="#l48.9"></a><span id="l48.9">   async_run_tests([verifyContentLength, endTest]);</span>
<a href="#l48.10"></a><span id="l48.10"> }</span>
<a href="#l48.11"></a><span id="l48.11"> </span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-function verifyContentLength()</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+function* verifyContentLength()</span>
<a href="#l48.14"></a><span id="l48.14"> {</span>
<a href="#l48.15"></a><span id="l48.15">   dump(&quot;adding message to server\n&quot;);</span>
<a href="#l48.16"></a><span id="l48.16">   // Add a message to the IMAP server</span>
<a href="#l48.17"></a><span id="l48.17">   addMessageToServer(gFile, gIMAPDaemon.getMailbox(&quot;INBOX&quot;));</span>
<a href="#l48.18"></a><span id="l48.18"> </span>
<a href="#l48.19"></a><span id="l48.19">   let imapS = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span>
<a href="#l48.20"></a><span id="l48.20">                 .getService(Ci.nsIMsgMessageService);</span>
<a href="#l48.21"></a><span id="l48.21"> </span>
<a href="#l48.22"></a><span id="l48.22" class="difflineat">@@ -100,17 +100,17 @@ function verifyContentLength()</span>
<a href="#l48.23"></a><span id="l48.23">   //                                                        Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l48.24"></a><span id="l48.24">   // Currently attachments have their content length set to the length of the</span>
<a href="#l48.25"></a><span id="l48.25">   // entire message</span>
<a href="#l48.26"></a><span id="l48.26">   // do_check_eq(attachmentChannel.contentLength, gFile.fileSize);</span>
<a href="#l48.27"></a><span id="l48.27"> </span>
<a href="#l48.28"></a><span id="l48.28">   yield true;</span>
<a href="#l48.29"></a><span id="l48.29"> }</span>
<a href="#l48.30"></a><span id="l48.30"> </span>
<a href="#l48.31"></a><span id="l48.31" class="difflineminus">-function endTest()</span>
<a href="#l48.32"></a><span id="l48.32" class="difflineplus">+function* endTest()</span>
<a href="#l48.33"></a><span id="l48.33"> {</span>
<a href="#l48.34"></a><span id="l48.34">   gIMAPIncomingServer.closeCachedConnections();</span>
<a href="#l48.35"></a><span id="l48.35">   gIMAPServer.stop();</span>
<a href="#l48.36"></a><span id="l48.36">   let thread = gThreadManager.currentThread;</span>
<a href="#l48.37"></a><span id="l48.37">   while (thread.hasPendingEvents())</span>
<a href="#l48.38"></a><span id="l48.38">     thread.processNextEvent(true);</span>
<a href="#l48.39"></a><span id="l48.39"> </span>
<a href="#l48.40"></a><span id="l48.40">   yield true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -81,75 +81,75 @@ function checkOfflineStore(prevOfflineSt</span>
<a href="#l49.4"></a><span id="l49.4">   }</span>
<a href="#l49.5"></a><span id="l49.5">   // check that the offline store shrunk by at least 100 bytes.</span>
<a href="#l49.6"></a><span id="l49.6">   // (exact calculation might be fragile).</span>
<a href="#l49.7"></a><span id="l49.7">   do_check_true(prevOfflineStoreSize &gt; IMAPPump.inbox.filePath.fileSize + 100);</span>
<a href="#l49.8"></a><span id="l49.8"> }</span>
<a href="#l49.9"></a><span id="l49.9"> </span>
<a href="#l49.10"></a><span id="l49.10"> var tests = [</span>
<a href="#l49.11"></a><span id="l49.11">   setup,</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  function downloadForOffline() {</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+  function* downloadForOffline() {</span>
<a href="#l49.14"></a><span id="l49.14">     // ...and download for offline use.</span>
<a href="#l49.15"></a><span id="l49.15">     dump(&quot;Downloading for offline use\n&quot;);</span>
<a href="#l49.16"></a><span id="l49.16">     IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l49.17"></a><span id="l49.17">     yield false;</span>
<a href="#l49.18"></a><span id="l49.18">   },</span>
<a href="#l49.19"></a><span id="l49.19" class="difflineminus">-  function markOneMsgDeleted() {</span>
<a href="#l49.20"></a><span id="l49.20" class="difflineplus">+  function* markOneMsgDeleted() {</span>
<a href="#l49.21"></a><span id="l49.21">     // mark a message deleted, and then do a compact of just</span>
<a href="#l49.22"></a><span id="l49.22">     // that folder.</span>
<a href="#l49.23"></a><span id="l49.23">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId5);</span>
<a href="#l49.24"></a><span id="l49.24">     let array = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l49.25"></a><span id="l49.25">     array.appendElement(msgHdr, false);</span>
<a href="#l49.26"></a><span id="l49.26">     // store the deleted flag</span>
<a href="#l49.27"></a><span id="l49.27">     IMAPPump.inbox.storeImapFlags(0x0008, true, [msgHdr.messageKey], 1, asyncUrlListener);</span>
<a href="#l49.28"></a><span id="l49.28">     yield false;</span>
<a href="#l49.29"></a><span id="l49.29">   },</span>
<a href="#l49.30"></a><span id="l49.30" class="difflineminus">-  function compactOneFolder() {</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineplus">+  function* compactOneFolder() {</span>
<a href="#l49.32"></a><span id="l49.32">     IMAPPump.incomingServer.deleteModel = Ci.nsMsgImapDeleteModels.IMAPDelete;</span>
<a href="#l49.33"></a><span id="l49.33">     // asyncUrlListener will get called when both expunge and offline store</span>
<a href="#l49.34"></a><span id="l49.34">     // compaction are finished. dummyMsgWindow is required to make the backend</span>
<a href="#l49.35"></a><span id="l49.35">     // compact the offline store.</span>
<a href="#l49.36"></a><span id="l49.36">     IMAPPump.inbox.compact(asyncUrlListener, gDummyMsgWindow);</span>
<a href="#l49.37"></a><span id="l49.37">     yield false;</span>
<a href="#l49.38"></a><span id="l49.38">   },</span>
<a href="#l49.39"></a><span id="l49.39" class="difflineminus">-  function deleteOneMessage() {</span>
<a href="#l49.40"></a><span id="l49.40" class="difflineplus">+  function* deleteOneMessage() {</span>
<a href="#l49.41"></a><span id="l49.41">     // check that nstmp file has been cleaned up.</span>
<a href="#l49.42"></a><span id="l49.42">     let tmpFile = gRootFolder.filePath;</span>
<a href="#l49.43"></a><span id="l49.43">     tmpFile.append(&quot;nstmp&quot;);</span>
<a href="#l49.44"></a><span id="l49.44">     do_check_false(tmpFile.exists());</span>
<a href="#l49.45"></a><span id="l49.45">     dump(&quot;deleting one message\n&quot;);</span>
<a href="#l49.46"></a><span id="l49.46">     IMAPPump.incomingServer.deleteModel = Ci.nsMsgImapDeleteModels.MoveToTrash;</span>
<a href="#l49.47"></a><span id="l49.47">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l49.48"></a><span id="l49.48">     let array = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l49.49"></a><span id="l49.49">     array.appendElement(msgHdr, false);</span>
<a href="#l49.50"></a><span id="l49.50">     IMAPPump.inbox.deleteMessages(array, null, false, true, CopyListener, false);</span>
<a href="#l49.51"></a><span id="l49.51">     let trashFolder = gRootFolder.getChildNamed(&quot;Trash&quot;);</span>
<a href="#l49.52"></a><span id="l49.52">     // hack to force uid validity to get initialized for trash.</span>
<a href="#l49.53"></a><span id="l49.53">     trashFolder.updateFolder(null);</span>
<a href="#l49.54"></a><span id="l49.54">     yield false;</span>
<a href="#l49.55"></a><span id="l49.55">   },</span>
<a href="#l49.56"></a><span id="l49.56" class="difflineminus">-  function compactOfflineStore() {</span>
<a href="#l49.57"></a><span id="l49.57" class="difflineplus">+  function* compactOfflineStore() {</span>
<a href="#l49.58"></a><span id="l49.58">     dump(&quot;compacting offline store\n&quot;);</span>
<a href="#l49.59"></a><span id="l49.59">     gImapInboxOfflineStoreSize = IMAPPump.inbox.filePath.fileSize;</span>
<a href="#l49.60"></a><span id="l49.60">     gRootFolder.compactAll(asyncUrlListener, null, true);</span>
<a href="#l49.61"></a><span id="l49.61">     yield false;</span>
<a href="#l49.62"></a><span id="l49.62">   },</span>
<a href="#l49.63"></a><span id="l49.63" class="difflineminus">-  function checkCompactionResult() {</span>
<a href="#l49.64"></a><span id="l49.64" class="difflineplus">+  function* checkCompactionResult() {</span>
<a href="#l49.65"></a><span id="l49.65">     checkOfflineStore(gImapInboxOfflineStoreSize);</span>
<a href="#l49.66"></a><span id="l49.66">     asyncUrlListener.OnStopRunningUrl(null, 0);</span>
<a href="#l49.67"></a><span id="l49.67">     yield false;</span>
<a href="#l49.68"></a><span id="l49.68">   },</span>
<a href="#l49.69"></a><span id="l49.69" class="difflineminus">-  function testPendingRemoval() {</span>
<a href="#l49.70"></a><span id="l49.70" class="difflineplus">+  function* testPendingRemoval() {</span>
<a href="#l49.71"></a><span id="l49.71">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId2);</span>
<a href="#l49.72"></a><span id="l49.72">     IMAPPump.inbox.markPendingRemoval(msgHdr, true);</span>
<a href="#l49.73"></a><span id="l49.73">     gImapInboxOfflineStoreSize = IMAPPump.inbox.filePath.fileSize;</span>
<a href="#l49.74"></a><span id="l49.74">     gRootFolder.compactAll(asyncUrlListener, null, true);</span>
<a href="#l49.75"></a><span id="l49.75">     yield false;</span>
<a href="#l49.76"></a><span id="l49.76">   },</span>
<a href="#l49.77"></a><span id="l49.77" class="difflineminus">-  function checkCompactionResult() {</span>
<a href="#l49.78"></a><span id="l49.78" class="difflineplus">+  function* checkCompactionResult() {</span>
<a href="#l49.79"></a><span id="l49.79">     let tmpFile = gRootFolder.filePath;</span>
<a href="#l49.80"></a><span id="l49.80">     tmpFile.append(&quot;nstmp&quot;);</span>
<a href="#l49.81"></a><span id="l49.81">     do_check_false(tmpFile.exists());</span>
<a href="#l49.82"></a><span id="l49.82">     checkOfflineStore(gImapInboxOfflineStoreSize);</span>
<a href="#l49.83"></a><span id="l49.83">     asyncUrlListener.OnStopRunningUrl(null, 0);</span>
<a href="#l49.84"></a><span id="l49.84">     yield false;</span>
<a href="#l49.85"></a><span id="l49.85">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId2);</span>
<a href="#l49.86"></a><span id="l49.86">     do_check_eq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Offline, 0);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -15,68 +15,68 @@ var gLastKey;</span>
<a href="#l50.4"></a><span id="l50.4"> var gMessages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l50.5"></a><span id="l50.5"> var gCopyService = MailServices.copy;</span>
<a href="#l50.6"></a><span id="l50.6"> </span>
<a href="#l50.7"></a><span id="l50.7"> Components.utils.import(&quot;resource:///modules/folderUtils.jsm&quot;);</span>
<a href="#l50.8"></a><span id="l50.8"> Components.utils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l50.9"></a><span id="l50.9"> </span>
<a href="#l50.10"></a><span id="l50.10"> var tests = [</span>
<a href="#l50.11"></a><span id="l50.11">   setup,</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-  function copyFolder1() {</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+  function* copyFolder1() {</span>
<a href="#l50.14"></a><span id="l50.14">     dump(&quot;gEmpty1 &quot; + gEmptyLocal1.URI + &quot;\n&quot;);</span>
<a href="#l50.15"></a><span id="l50.15">     let folders = new Array;</span>
<a href="#l50.16"></a><span id="l50.16">     folders.push(gEmptyLocal1.QueryInterface(Ci.nsIMsgFolder));</span>
<a href="#l50.17"></a><span id="l50.17">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l50.18"></a><span id="l50.18">     gCopyService.CopyFolders(array, IMAPPump.inbox, false, CopyListener, null);</span>
<a href="#l50.19"></a><span id="l50.19">     yield false;</span>
<a href="#l50.20"></a><span id="l50.20">   },</span>
<a href="#l50.21"></a><span id="l50.21" class="difflineminus">-  function copyFolder2() {</span>
<a href="#l50.22"></a><span id="l50.22" class="difflineplus">+  function* copyFolder2() {</span>
<a href="#l50.23"></a><span id="l50.23">     dump(&quot;gEmpty2 &quot; + gEmptyLocal2.URI + &quot;\n&quot;);</span>
<a href="#l50.24"></a><span id="l50.24">     let folders = new Array;</span>
<a href="#l50.25"></a><span id="l50.25">     folders.push(gEmptyLocal2);</span>
<a href="#l50.26"></a><span id="l50.26">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l50.27"></a><span id="l50.27">     gCopyService.CopyFolders(array, IMAPPump.inbox, false, CopyListener, null);</span>
<a href="#l50.28"></a><span id="l50.28">     yield false;</span>
<a href="#l50.29"></a><span id="l50.29">   },</span>
<a href="#l50.30"></a><span id="l50.30" class="difflineminus">-  function getLocalMessage1() {</span>
<a href="#l50.31"></a><span id="l50.31" class="difflineplus">+  function* getLocalMessage1() {</span>
<a href="#l50.32"></a><span id="l50.32">     dump(&quot;getLocalMessage\n&quot;);</span>
<a href="#l50.33"></a><span id="l50.33">     var file = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l50.34"></a><span id="l50.34">     gCopyService.CopyFileMessage(file, localAccountUtils.inboxFolder, null, false, 0,</span>
<a href="#l50.35"></a><span id="l50.35">                                 &quot;&quot;, CopyListener, null);</span>
<a href="#l50.36"></a><span id="l50.36">     yield false;</span>
<a href="#l50.37"></a><span id="l50.37">   },</span>
<a href="#l50.38"></a><span id="l50.38" class="difflineminus">-  function getLocalMessage2() {</span>
<a href="#l50.39"></a><span id="l50.39" class="difflineplus">+  function* getLocalMessage2() {</span>
<a href="#l50.40"></a><span id="l50.40">     gMessages.appendElement(localAccountUtils.inboxFolder.GetMessageHeader(gLastKey),</span>
<a href="#l50.41"></a><span id="l50.41">                             false);</span>
<a href="#l50.42"></a><span id="l50.42">     dump(&quot;getLocalMessage\n&quot;);</span>
<a href="#l50.43"></a><span id="l50.43">     var file = do_get_file(&quot;../../../data/draft1&quot;);</span>
<a href="#l50.44"></a><span id="l50.44">     gCopyService.CopyFileMessage(file, localAccountUtils.inboxFolder, null, false, 0,</span>
<a href="#l50.45"></a><span id="l50.45">                                 &quot;&quot;, CopyListener, null);</span>
<a href="#l50.46"></a><span id="l50.46">     yield false;</span>
<a href="#l50.47"></a><span id="l50.47">   },</span>
<a href="#l50.48"></a><span id="l50.48" class="difflineminus">-  function copyMessages() {</span>
<a href="#l50.49"></a><span id="l50.49" class="difflineplus">+  function* copyMessages() {</span>
<a href="#l50.50"></a><span id="l50.50">     gMessages.appendElement(localAccountUtils.inboxFolder.GetMessageHeader(gLastKey),</span>
<a href="#l50.51"></a><span id="l50.51">                             false);</span>
<a href="#l50.52"></a><span id="l50.52">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l50.53"></a><span id="l50.53">     gCopyService.CopyMessages(localAccountUtils.inboxFolder, gMessages, folder1, false,</span>
<a href="#l50.54"></a><span id="l50.54">                               CopyListener, null, false);</span>
<a href="#l50.55"></a><span id="l50.55">     yield false;</span>
<a href="#l50.56"></a><span id="l50.56">   },</span>
<a href="#l50.57"></a><span id="l50.57" class="difflineminus">-  function moveMessages() {</span>
<a href="#l50.58"></a><span id="l50.58" class="difflineplus">+  function* moveMessages() {</span>
<a href="#l50.59"></a><span id="l50.59">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l50.60"></a><span id="l50.60">       gCopyService.CopyMessages(localAccountUtils.inboxFolder, gMessages, folder2, true,</span>
<a href="#l50.61"></a><span id="l50.61">                                 CopyListener, null, false);</span>
<a href="#l50.62"></a><span id="l50.62">     yield false;</span>
<a href="#l50.63"></a><span id="l50.63">   },</span>
<a href="#l50.64"></a><span id="l50.64" class="difflineminus">-  function update1() {</span>
<a href="#l50.65"></a><span id="l50.65" class="difflineplus">+  function* update1() {</span>
<a href="#l50.66"></a><span id="l50.66">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;).QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l50.67"></a><span id="l50.67">     folder1.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l50.68"></a><span id="l50.68">     yield false;</span>
<a href="#l50.69"></a><span id="l50.69">   },</span>
<a href="#l50.70"></a><span id="l50.70" class="difflineminus">-  function update2() {</span>
<a href="#l50.71"></a><span id="l50.71" class="difflineplus">+  function* update2() {</span>
<a href="#l50.72"></a><span id="l50.72">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;).QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l50.73"></a><span id="l50.73">     folder2.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l50.74"></a><span id="l50.74">     yield false;</span>
<a href="#l50.75"></a><span id="l50.75">   },</span>
<a href="#l50.76"></a><span id="l50.76">   function verifyFolders() {</span>
<a href="#l50.77"></a><span id="l50.77">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l50.78"></a><span id="l50.78">     do_check_eq(folderCount(folder1), 2);</span>
<a href="#l50.79"></a><span id="l50.79">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_customCommandReturnsFetchResponse.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -33,27 +33,27 @@ var tests = [</span>
<a href="#l51.4"></a><span id="l51.4">   loadImapMessage,</span>
<a href="#l51.5"></a><span id="l51.5">   testStoreCustomList,</span>
<a href="#l51.6"></a><span id="l51.6">   testStoreMinusCustomList,</span>
<a href="#l51.7"></a><span id="l51.7">   testStorePlusCustomList,</span>
<a href="#l51.8"></a><span id="l51.8">   endTest</span>
<a href="#l51.9"></a><span id="l51.9"> ]</span>
<a href="#l51.10"></a><span id="l51.10"> </span>
<a href="#l51.11"></a><span id="l51.11"> // load and update a message in the imap fake server</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-function loadImapMessage()</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+function* loadImapMessage()</span>
<a href="#l51.14"></a><span id="l51.14"> {</span>
<a href="#l51.15"></a><span id="l51.15">   gMessage = new imapMessage(specForFileName(gMessageFileName),</span>
<a href="#l51.16"></a><span id="l51.16">     IMAPPump.mailbox.uidnext++, []);</span>
<a href="#l51.17"></a><span id="l51.17">   gMessage.xCustomList = [];</span>
<a href="#l51.18"></a><span id="l51.18">   IMAPPump.mailbox.addMessage(gMessage);</span>
<a href="#l51.19"></a><span id="l51.19">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l51.20"></a><span id="l51.20">   yield false;</span>
<a href="#l51.21"></a><span id="l51.21"> }</span>
<a href="#l51.22"></a><span id="l51.22"> </span>
<a href="#l51.23"></a><span id="l51.23" class="difflineminus">-function testStoreCustomList()</span>
<a href="#l51.24"></a><span id="l51.24" class="difflineplus">+function* testStoreCustomList()</span>
<a href="#l51.25"></a><span id="l51.25"> {</span>
<a href="#l51.26"></a><span id="l51.26">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l51.27"></a><span id="l51.27">   gExpectedLength = gCustomList.length;</span>
<a href="#l51.28"></a><span id="l51.28">   let uri = IMAPPump.inbox.issueCommandOnMsgs(&quot;STORE&quot;, msgHdr.messageKey +</span>
<a href="#l51.29"></a><span id="l51.29">     &quot; X-CUSTOM-LIST (&quot; + gCustomList.join(&quot; &quot;) + &quot;)&quot;, gMsgWindow);</span>
<a href="#l51.30"></a><span id="l51.30">   uri.QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l51.31"></a><span id="l51.31">   uri.RegisterListener(storeCustomListSetListener);</span>
<a href="#l51.32"></a><span id="l51.32">   yield false;</span>
<a href="#l51.33"></a><span id="l51.33" class="difflineat">@@ -67,17 +67,17 @@ var storeCustomListSetListener = {</span>
<a href="#l51.34"></a><span id="l51.34">     aUrl.QueryInterface(Ci.nsIImapUrl);</span>
<a href="#l51.35"></a><span id="l51.35">     do_check_eq(aUrl.customCommandResult,</span>
<a href="#l51.36"></a><span id="l51.36">       &quot;(&quot; + gMessage.xCustomList.join(&quot; &quot;) + &quot;)&quot;);</span>
<a href="#l51.37"></a><span id="l51.37">     do_check_eq(gMessage.xCustomList.length, gExpectedLength);</span>
<a href="#l51.38"></a><span id="l51.38">     async_driver();</span>
<a href="#l51.39"></a><span id="l51.39">   }</span>
<a href="#l51.40"></a><span id="l51.40"> };</span>
<a href="#l51.41"></a><span id="l51.41"> </span>
<a href="#l51.42"></a><span id="l51.42" class="difflineminus">-function testStoreMinusCustomList()</span>
<a href="#l51.43"></a><span id="l51.43" class="difflineplus">+function* testStoreMinusCustomList()</span>
<a href="#l51.44"></a><span id="l51.44"> {</span>
<a href="#l51.45"></a><span id="l51.45">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l51.46"></a><span id="l51.46">   gExpectedLength--;</span>
<a href="#l51.47"></a><span id="l51.47">   let uri = IMAPPump.inbox.issueCommandOnMsgs(&quot;STORE&quot;, msgHdr.messageKey +</span>
<a href="#l51.48"></a><span id="l51.48">     &quot; -X-CUSTOM-LIST (&quot; + gCustomList[0] + &quot;)&quot;, gMsgWindow);</span>
<a href="#l51.49"></a><span id="l51.49">   uri.QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l51.50"></a><span id="l51.50">   uri.RegisterListener(storeCustomListRemovedListener);</span>
<a href="#l51.51"></a><span id="l51.51">   yield false;</span>
<a href="#l51.52"></a><span id="l51.52" class="difflineat">@@ -91,17 +91,17 @@ var storeCustomListRemovedListener = {</span>
<a href="#l51.53"></a><span id="l51.53">     aUrl.QueryInterface(Ci.nsIImapUrl);</span>
<a href="#l51.54"></a><span id="l51.54">     do_check_eq(aUrl.customCommandResult,</span>
<a href="#l51.55"></a><span id="l51.55">       &quot;(&quot; + gMessage.xCustomList.join(&quot; &quot;) + &quot;)&quot;);</span>
<a href="#l51.56"></a><span id="l51.56">     do_check_eq(gMessage.xCustomList.length, gExpectedLength);</span>
<a href="#l51.57"></a><span id="l51.57">     async_driver();</span>
<a href="#l51.58"></a><span id="l51.58">   }</span>
<a href="#l51.59"></a><span id="l51.59"> };</span>
<a href="#l51.60"></a><span id="l51.60"> </span>
<a href="#l51.61"></a><span id="l51.61" class="difflineminus">-function testStorePlusCustomList()</span>
<a href="#l51.62"></a><span id="l51.62" class="difflineplus">+function* testStorePlusCustomList()</span>
<a href="#l51.63"></a><span id="l51.63"> {</span>
<a href="#l51.64"></a><span id="l51.64">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l51.65"></a><span id="l51.65">   gExpectedLength++;</span>
<a href="#l51.66"></a><span id="l51.66">   let uri = IMAPPump.inbox.issueCommandOnMsgs(&quot;STORE&quot;, msgHdr.messageKey +</span>
<a href="#l51.67"></a><span id="l51.67">     ' +X-CUSTOM-LIST (&quot;Custom4&quot;)', gMsgWindow);</span>
<a href="#l51.68"></a><span id="l51.68">   uri.QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l51.69"></a><span id="l51.69">   uri.RegisterListener(storeCustomListAddedListener);</span>
<a href="#l51.70"></a><span id="l51.70">   yield false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -43,17 +43,17 @@ function run_test()</span>
<a href="#l52.4"></a><span id="l52.4"> </span>
<a href="#l52.5"></a><span id="l52.5">   gServer = makeServer(gIMAPDaemon, &quot;&quot;);</span>
<a href="#l52.6"></a><span id="l52.6">   gIMAPIncomingServer = createLocalIMAPServer(gServer.port);</span>
<a href="#l52.7"></a><span id="l52.7"> </span>
<a href="#l52.8"></a><span id="l52.8">   //start first test</span>
<a href="#l52.9"></a><span id="l52.9">   async_run_tests(tests);</span>
<a href="#l52.10"></a><span id="l52.10"> }</span>
<a href="#l52.11"></a><span id="l52.11"> </span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-function streamMessages() {</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+function* streamMessages() {</span>
<a href="#l52.14"></a><span id="l52.14">   let inbox = gIMAPDaemon.getMailbox(&quot;INBOX&quot;);</span>
<a href="#l52.15"></a><span id="l52.15">   let imapS = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span>
<a href="#l52.16"></a><span id="l52.16">                 .getService(Ci.nsIMsgMessageService);</span>
<a href="#l52.17"></a><span id="l52.17">   let fileNames = [];</span>
<a href="#l52.18"></a><span id="l52.18">   let msgFiles = do_get_file(&quot;../../../data/&quot;).directoryEntries;</span>
<a href="#l52.19"></a><span id="l52.19">   while (msgFiles.hasMoreElements()) {</span>
<a href="#l52.20"></a><span id="l52.20">     let file = msgFiles.getNext();</span>
<a href="#l52.21"></a><span id="l52.21">     let msgfileuri =</span>
<a href="#l52.22"></a><span id="l52.22" class="difflineat">@@ -119,17 +119,17 @@ var gStreamListener = {</span>
<a href="#l52.23"></a><span id="l52.23">     if (this._stream == null) {</span>
<a href="#l52.24"></a><span id="l52.24">       this._stream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;].createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l52.25"></a><span id="l52.25">       this._stream.init(aInputStream);</span>
<a href="#l52.26"></a><span id="l52.26">     }</span>
<a href="#l52.27"></a><span id="l52.27">     this._data += this._stream.read(aCount);</span>
<a href="#l52.28"></a><span id="l52.28">   },</span>
<a href="#l52.29"></a><span id="l52.29"> };</span>
<a href="#l52.30"></a><span id="l52.30"> </span>
<a href="#l52.31"></a><span id="l52.31" class="difflineminus">-function endTest() {</span>
<a href="#l52.32"></a><span id="l52.32" class="difflineplus">+function* endTest() {</span>
<a href="#l52.33"></a><span id="l52.33">   gIMAPIncomingServer.closeCachedConnections();</span>
<a href="#l52.34"></a><span id="l52.34">   gServer.stop();</span>
<a href="#l52.35"></a><span id="l52.35">   let thread = Services.tm.currentThread;</span>
<a href="#l52.36"></a><span id="l52.36">   while (thread.hasPendingEvents())</span>
<a href="#l52.37"></a><span id="l52.37">     thread.processNextEvent(true);</span>
<a href="#l52.38"></a><span id="l52.38">   yield true;</span>
<a href="#l52.39"></a><span id="l52.39"> }</span>
<a href="#l52.40"></a><span id="l52.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_dontStatNoSelect.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_dontStatNoSelect.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -66,33 +66,33 @@ function run_test() {</span>
<a href="#l53.4"></a><span id="l53.4">   gFolder1 = rootFolder.getChildNamed(&quot;folder 1&quot;);</span>
<a href="#l53.5"></a><span id="l53.5">   gFolder2 = rootFolder.getChildNamed(&quot;folder 2&quot;);</span>
<a href="#l53.6"></a><span id="l53.6">   gFolder1.setFlag(Ci.nsMsgFolderFlags.CheckNew);</span>
<a href="#l53.7"></a><span id="l53.7">   gFolder2.setFlag(Ci.nsMsgFolderFlags.CheckNew);</span>
<a href="#l53.8"></a><span id="l53.8">   //start first test</span>
<a href="#l53.9"></a><span id="l53.9">   async_run_tests(tests);</span>
<a href="#l53.10"></a><span id="l53.10"> }</span>
<a href="#l53.11"></a><span id="l53.11"> </span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-function checkStatSelect() {</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+function* checkStatSelect() {</span>
<a href="#l53.14"></a><span id="l53.14">   // imap fake server's resetTest resets the authentication state - charming.</span>
<a href="#l53.15"></a><span id="l53.15">   // So poke the _test member directly.</span>
<a href="#l53.16"></a><span id="l53.16">   gServer._test = true;</span>
<a href="#l53.17"></a><span id="l53.17">   gIMAPInbox.getNewMessages(null, null);</span>
<a href="#l53.18"></a><span id="l53.18">   gServer.performTest(&quot;STATUS&quot;);</span>
<a href="#l53.19"></a><span id="l53.19">   // We want to wait for the STATUS to be really done before we issue</span>
<a href="#l53.20"></a><span id="l53.20">   // more STATUS commands, so we do a NOOP on the</span>
<a href="#l53.21"></a><span id="l53.21">   // INBOX, and since we only have one connection with the fake server,</span>
<a href="#l53.22"></a><span id="l53.22">   // that will essentially serialize things.</span>
<a href="#l53.23"></a><span id="l53.23">   gServer._test = true;</span>
<a href="#l53.24"></a><span id="l53.24">   gIMAPInbox.updateFolder(null);</span>
<a href="#l53.25"></a><span id="l53.25">   gServer.performTest(&quot;NOOP&quot;);</span>
<a href="#l53.26"></a><span id="l53.26">   yield true;</span>
<a href="#l53.27"></a><span id="l53.27"> }</span>
<a href="#l53.28"></a><span id="l53.28"> </span>
<a href="#l53.29"></a><span id="l53.29" class="difflineminus">-function checkStatNoSelect() {</span>
<a href="#l53.30"></a><span id="l53.30" class="difflineplus">+function* checkStatNoSelect() {</span>
<a href="#l53.31"></a><span id="l53.31">   // folder 2 should have been stat'd, but not folder 1. All we can really check</span>
<a href="#l53.32"></a><span id="l53.32">   // is that folder 2 was stat'd and that its unread msg count is 1</span>
<a href="#l53.33"></a><span id="l53.33">   do_check_eq(gFolder2.getNumUnread(false), 1);</span>
<a href="#l53.34"></a><span id="l53.34">   addMessageToFolder(gFolder2Mailbox);</span>
<a href="#l53.35"></a><span id="l53.35">   gFolder1.clearFlag(Ci.nsMsgFolderFlags.ImapNoselect);</span>
<a href="#l53.36"></a><span id="l53.36">   gServer._test = true;</span>
<a href="#l53.37"></a><span id="l53.37">   // we've cleared the ImapNoselect flag, so we will attempt to STAT folder 1,</span>
<a href="#l53.38"></a><span id="l53.38">   // which will fail. So we verify that we go on and STAT folder 2, and that</span>
<a href="#l53.39"></a><span id="l53.39" class="difflineat">@@ -113,17 +113,17 @@ function addMessageToFolder(mbox) {</span>
<a href="#l53.40"></a><span id="l53.40">   let msgURI =</span>
<a href="#l53.41"></a><span id="l53.41">     Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l53.42"></a><span id="l53.42">                        btoa(messages[0].toMessageString()),</span>
<a href="#l53.43"></a><span id="l53.43">                        null, null);</span>
<a href="#l53.44"></a><span id="l53.44">   let message = new imapMessage(msgURI.spec, mbox.uidnext++);</span>
<a href="#l53.45"></a><span id="l53.45">   mbox.addMessage(message);</span>
<a href="#l53.46"></a><span id="l53.46"> }</span>
<a href="#l53.47"></a><span id="l53.47"> </span>
<a href="#l53.48"></a><span id="l53.48" class="difflineminus">-function endTest()</span>
<a href="#l53.49"></a><span id="l53.49" class="difflineplus">+function* endTest()</span>
<a href="#l53.50"></a><span id="l53.50"> {</span>
<a href="#l53.51"></a><span id="l53.51">   do_check_eq(gFolder2.getNumUnread(false), 2);</span>
<a href="#l53.52"></a><span id="l53.52">   // Clean up the server in preparation</span>
<a href="#l53.53"></a><span id="l53.53">   gServer.resetTest();</span>
<a href="#l53.54"></a><span id="l53.54">   gImapServer.closeCachedConnections();</span>
<a href="#l53.55"></a><span id="l53.55">   gServer.performTest();</span>
<a href="#l53.56"></a><span id="l53.56">   gServer.stop();</span>
<a href="#l53.57"></a><span id="l53.57">   yield true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_fetchCustomAttribute.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_fetchCustomAttribute.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -31,30 +31,30 @@ setupIMAPPump(&quot;CUSTOM1&quot;);</span>
<a href="#l54.4"></a><span id="l54.4"> var tests = [</span>
<a href="#l54.5"></a><span id="l54.5">   loadImapMessage,</span>
<a href="#l54.6"></a><span id="l54.6">   testFetchCustomValue,</span>
<a href="#l54.7"></a><span id="l54.7">   testFetchCustomList,</span>
<a href="#l54.8"></a><span id="l54.8">   endTest</span>
<a href="#l54.9"></a><span id="l54.9"> ]</span>
<a href="#l54.10"></a><span id="l54.10"> </span>
<a href="#l54.11"></a><span id="l54.11"> // load and update a message in the imap fake server</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-function loadImapMessage()</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+function* loadImapMessage()</span>
<a href="#l54.14"></a><span id="l54.14"> {</span>
<a href="#l54.15"></a><span id="l54.15">   let message = new imapMessage(specForFileName(gMessage),</span>
<a href="#l54.16"></a><span id="l54.16">                           IMAPPump.mailbox.uidnext++, []);</span>
<a href="#l54.17"></a><span id="l54.17">   message.xCustomValue = gCustomValue;</span>
<a href="#l54.18"></a><span id="l54.18">   message.xCustomList = gCustomList;</span>
<a href="#l54.19"></a><span id="l54.19">   IMAPPump.mailbox.addMessage(message);</span>
<a href="#l54.20"></a><span id="l54.20">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l54.21"></a><span id="l54.21">   yield false;</span>
<a href="#l54.22"></a><span id="l54.22"> }</span>
<a href="#l54.23"></a><span id="l54.23"> </span>
<a href="#l54.24"></a><span id="l54.24"> // Used to verify that nsIServerResponseParser.msg_fetch() can handle</span>
<a href="#l54.25"></a><span id="l54.25"> // not in a parenthesis group - Bug 750012</span>
<a href="#l54.26"></a><span id="l54.26" class="difflineminus">-function testFetchCustomValue()</span>
<a href="#l54.27"></a><span id="l54.27" class="difflineplus">+function* testFetchCustomValue()</span>
<a href="#l54.28"></a><span id="l54.28"> {</span>
<a href="#l54.29"></a><span id="l54.29">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l54.30"></a><span id="l54.30">   let uri = IMAPPump.inbox.fetchCustomMsgAttribute(&quot;X-CUSTOM-VALUE&quot;, msgHdr.messageKey, gMsgWindow);</span>
<a href="#l54.31"></a><span id="l54.31">   uri.QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l54.32"></a><span id="l54.32">   uri.RegisterListener(fetchCustomValueListener);</span>
<a href="#l54.33"></a><span id="l54.33">   yield false;</span>
<a href="#l54.34"></a><span id="l54.34"> }</span>
<a href="#l54.35"></a><span id="l54.35"> </span>
<a href="#l54.36"></a><span id="l54.36" class="difflineat">@@ -65,17 +65,17 @@ var fetchCustomValueListener = {</span>
<a href="#l54.37"></a><span id="l54.37">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l54.38"></a><span id="l54.38">     aUrl.QueryInterface(Ci.nsIImapUrl);</span>
<a href="#l54.39"></a><span id="l54.39">     do_check_eq(aUrl.customAttributeResult, gCustomValue);</span>
<a href="#l54.40"></a><span id="l54.40">     async_driver();</span>
<a href="#l54.41"></a><span id="l54.41">   }</span>
<a href="#l54.42"></a><span id="l54.42"> };</span>
<a href="#l54.43"></a><span id="l54.43"> </span>
<a href="#l54.44"></a><span id="l54.44"> // Used to verify that nsIServerResponseParser.msg_fetch() can handle a parenthesis group - Bug 735542</span>
<a href="#l54.45"></a><span id="l54.45" class="difflineminus">-function testFetchCustomList()</span>
<a href="#l54.46"></a><span id="l54.46" class="difflineplus">+function* testFetchCustomList()</span>
<a href="#l54.47"></a><span id="l54.47"> {</span>
<a href="#l54.48"></a><span id="l54.48">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l54.49"></a><span id="l54.49">   let uri = IMAPPump.inbox.fetchCustomMsgAttribute(&quot;X-CUSTOM-LIST&quot;, msgHdr.messageKey, gMsgWindow);</span>
<a href="#l54.50"></a><span id="l54.50">   uri.QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l54.51"></a><span id="l54.51">   uri.RegisterListener(fetchCustomListListener);</span>
<a href="#l54.52"></a><span id="l54.52">   yield false;</span>
<a href="#l54.53"></a><span id="l54.53"> }</span>
<a href="#l54.54"></a><span id="l54.54"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_filterCustomHeaders.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_filterCustomHeaders.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -45,28 +45,28 @@ function run_test()</span>
<a href="#l55.4"></a><span id="l55.4">   let action = filter.createAction();</span>
<a href="#l55.5"></a><span id="l55.5">   action.type = Ci.nsMsgFilterAction.MarkRead;</span>
<a href="#l55.6"></a><span id="l55.6">   filter.appendAction(action);</span>
<a href="#l55.7"></a><span id="l55.7">   filterList.insertFilterAt(0, filter);</span>
<a href="#l55.8"></a><span id="l55.8"> </span>
<a href="#l55.9"></a><span id="l55.9">   async_run_tests(tests);</span>
<a href="#l55.10"></a><span id="l55.10"> }</span>
<a href="#l55.11"></a><span id="l55.11"> </span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-function setupTest() {</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+function* setupTest() {</span>
<a href="#l55.14"></a><span id="l55.14">   Services.prefs.setBoolPref(&quot;mail.server.default.autosync_offline_stores&quot;, false);</span>
<a href="#l55.15"></a><span id="l55.15">   let file = do_get_file(&quot;../../../data/bugmail19&quot;);</span>
<a href="#l55.16"></a><span id="l55.16">   let msgfileuri = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l55.17"></a><span id="l55.17"> </span>
<a href="#l55.18"></a><span id="l55.18">   IMAPPump.mailbox.addMessage(new imapMessage(msgfileuri.spec,</span>
<a href="#l55.19"></a><span id="l55.19">                                           IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l55.20"></a><span id="l55.20">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l55.21"></a><span id="l55.21">   yield false;</span>
<a href="#l55.22"></a><span id="l55.22"> }</span>
<a href="#l55.23"></a><span id="l55.23"> </span>
<a href="#l55.24"></a><span id="l55.24" class="difflineminus">-function checkFilterResults() {</span>
<a href="#l55.25"></a><span id="l55.25" class="difflineplus">+function* checkFilterResults() {</span>
<a href="#l55.26"></a><span id="l55.26">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l55.27"></a><span id="l55.27">   do_check_true(msgHdr.isRead);</span>
<a href="#l55.28"></a><span id="l55.28">   yield true;</span>
<a href="#l55.29"></a><span id="l55.29"> }</span>
<a href="#l55.30"></a><span id="l55.30"> </span>
<a href="#l55.31"></a><span id="l55.31"> // Cleanup</span>
<a href="#l55.32"></a><span id="l55.32"> function endTest() {</span>
<a href="#l55.33"></a><span id="l55.33">   IMAPPump.server.performTest(&quot;UID STORE&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_folderOfflineFlags.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_folderOfflineFlags.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -25,17 +25,17 @@ var tests = [</span>
<a href="#l56.4"></a><span id="l56.4">   testTrashNotOffline,</span>
<a href="#l56.5"></a><span id="l56.5">   testJunkNotOffline,</span>
<a href="#l56.6"></a><span id="l56.6">   teardown</span>
<a href="#l56.7"></a><span id="l56.7"> ];</span>
<a href="#l56.8"></a><span id="l56.8"> </span>
<a href="#l56.9"></a><span id="l56.9"> /**</span>
<a href="#l56.10"></a><span id="l56.10">  * Setup the mailboxes that will be used for this test.</span>
<a href="#l56.11"></a><span id="l56.11">  */</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-function setup() {</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+function* setup() {</span>
<a href="#l56.14"></a><span id="l56.14">   setupIMAPPump(&quot;GMail&quot;);</span>
<a href="#l56.15"></a><span id="l56.15"> </span>
<a href="#l56.16"></a><span id="l56.16">   IMAPPump.mailbox.subscribed = true;</span>
<a href="#l56.17"></a><span id="l56.17">   IMAPPump.mailbox.specialUseFlag = &quot;\\Inbox&quot;;</span>
<a href="#l56.18"></a><span id="l56.18">   IMAPPump.daemon.createMailbox(&quot;[Gmail]&quot;, {flags : [&quot;\\Noselect&quot;], subscribed: true});</span>
<a href="#l56.19"></a><span id="l56.19">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/All Mail&quot;, {specialUseFlag : &quot;\\AllMail&quot;, subscribed: true});</span>
<a href="#l56.20"></a><span id="l56.20">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/Drafts&quot;, {specialUseFlag : &quot;\\Drafts&quot;, subscribed: true});</span>
<a href="#l56.21"></a><span id="l56.21">   IMAPPump.daemon.createMailbox(&quot;[Gmail]/Sent&quot;, {specialUseFlag : &quot;\\Sent&quot;, subscribed: true});</span>
<a href="#l56.22"></a><span id="l56.22" class="difflineat">@@ -49,17 +49,17 @@ function setup() {</span>
<a href="#l56.23"></a><span id="l56.23">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l56.24"></a><span id="l56.24"> </span>
<a href="#l56.25"></a><span id="l56.25">   yield false;</span>
<a href="#l56.26"></a><span id="l56.26"> }</span>
<a href="#l56.27"></a><span id="l56.27"> </span>
<a href="#l56.28"></a><span id="l56.28"> /**</span>
<a href="#l56.29"></a><span id="l56.29">  * Test that folders generally are marked for offline use by default.</span>
<a href="#l56.30"></a><span id="l56.30">  */</span>
<a href="#l56.31"></a><span id="l56.31" class="difflineminus">-function testGeneralFoldersOffline() {</span>
<a href="#l56.32"></a><span id="l56.32" class="difflineplus">+function* testGeneralFoldersOffline() {</span>
<a href="#l56.33"></a><span id="l56.33">   do_check_true(IMAPPump.inbox.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l56.34"></a><span id="l56.34"> </span>
<a href="#l56.35"></a><span id="l56.35">   let gmail = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;[Gmail]&quot;);</span>
<a href="#l56.36"></a><span id="l56.36"> </span>
<a href="#l56.37"></a><span id="l56.37">   let allmail = gmail.getFolderWithFlags(Ci.nsMsgFolderFlags.Archive);</span>
<a href="#l56.38"></a><span id="l56.38">   do_check_true(allmail.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l56.39"></a><span id="l56.39"> </span>
<a href="#l56.40"></a><span id="l56.40">   let drafts = gmail.getFolderWithFlags(Ci.nsMsgFolderFlags.Drafts);</span>
<a href="#l56.41"></a><span id="l56.41" class="difflineat">@@ -77,27 +77,27 @@ function testGeneralFoldersOffline() {</span>
<a href="#l56.42"></a><span id="l56.42">   do_check_true(folder2.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l56.43"></a><span id="l56.43"> </span>
<a href="#l56.44"></a><span id="l56.44">   yield true;</span>
<a href="#l56.45"></a><span id="l56.45"> }</span>
<a href="#l56.46"></a><span id="l56.46"> </span>
<a href="#l56.47"></a><span id="l56.47"> /**</span>
<a href="#l56.48"></a><span id="l56.48">  * Test that Trash isn't flagged for offline use by default.</span>
<a href="#l56.49"></a><span id="l56.49">  */</span>
<a href="#l56.50"></a><span id="l56.50" class="difflineminus">-function testTrashNotOffline() {</span>
<a href="#l56.51"></a><span id="l56.51" class="difflineplus">+function* testTrashNotOffline() {</span>
<a href="#l56.52"></a><span id="l56.52">   let gmail = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;[Gmail]&quot;);</span>
<a href="#l56.53"></a><span id="l56.53">   let trash = gmail.getFolderWithFlags(Ci.nsMsgFolderFlags.Trash);</span>
<a href="#l56.54"></a><span id="l56.54">   do_check_false(trash.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l56.55"></a><span id="l56.55">   yield true;</span>
<a href="#l56.56"></a><span id="l56.56"> }</span>
<a href="#l56.57"></a><span id="l56.57"> </span>
<a href="#l56.58"></a><span id="l56.58"> /**</span>
<a href="#l56.59"></a><span id="l56.59">  * Test that Junk isn't flagged for offline use by default.</span>
<a href="#l56.60"></a><span id="l56.60">  */</span>
<a href="#l56.61"></a><span id="l56.61" class="difflineminus">-function testJunkNotOffline() {</span>
<a href="#l56.62"></a><span id="l56.62" class="difflineplus">+function* testJunkNotOffline() {</span>
<a href="#l56.63"></a><span id="l56.63">   let gmail = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;[Gmail]&quot;);</span>
<a href="#l56.64"></a><span id="l56.64">   let spam = gmail.getFolderWithFlags(Ci.nsMsgFolderFlags.Junk);</span>
<a href="#l56.65"></a><span id="l56.65">   do_check_false(spam.getFlag(Ci.nsMsgFolderFlags.Offline));</span>
<a href="#l56.66"></a><span id="l56.66">   yield true;</span>
<a href="#l56.67"></a><span id="l56.67"> }</span>
<a href="#l56.68"></a><span id="l56.68"> </span>
<a href="#l56.69"></a><span id="l56.69"> /** Cleanup at the end. */</span>
<a href="#l56.70"></a><span id="l56.70"> function teardown() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_gmailAttributes.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_gmailAttributes.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -44,17 +44,17 @@ var tests = [</span>
<a href="#l57.4"></a><span id="l57.4">   loadImapMessage,</span>
<a href="#l57.5"></a><span id="l57.5">   testFetchXGmMsgid,</span>
<a href="#l57.6"></a><span id="l57.6">   testFetchXGmThrid,</span>
<a href="#l57.7"></a><span id="l57.7">   testFetchXGmLabels,</span>
<a href="#l57.8"></a><span id="l57.8">   endTest</span>
<a href="#l57.9"></a><span id="l57.9"> ]</span>
<a href="#l57.10"></a><span id="l57.10"> </span>
<a href="#l57.11"></a><span id="l57.11"> // load and update a message in the imap fake server</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-function loadImapMessage()</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+function* loadImapMessage()</span>
<a href="#l57.14"></a><span id="l57.14"> {</span>
<a href="#l57.15"></a><span id="l57.15">   let message = new imapMessage(specForFileName(gMessage),</span>
<a href="#l57.16"></a><span id="l57.16">                                 IMAPPump.mailbox.uidnext++, []);</span>
<a href="#l57.17"></a><span id="l57.17">   message.xGmMsgid = gXGmMsgid;</span>
<a href="#l57.18"></a><span id="l57.18">   message.xGmThrid = gXGmThrid;</span>
<a href="#l57.19"></a><span id="l57.19">   message.xGmLabels = gXGmLabels;</span>
<a href="#l57.20"></a><span id="l57.20">   IMAPPump.mailbox.addMessage(message);</span>
<a href="#l57.21"></a><span id="l57.21">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -90,45 +90,45 @@ function setup() {</span>
<a href="#l58.4"></a><span id="l58.4">                             IMAPPump.mailbox.uidnext++, []);</span>
<a href="#l58.5"></a><span id="l58.5">   message.messageId = gMsgId1;</span>
<a href="#l58.6"></a><span id="l58.6">   message.xGmMsgid = gXGmMsgid1;</span>
<a href="#l58.7"></a><span id="l58.7">   message.xGmThrid = gXGmThrid1;</span>
<a href="#l58.8"></a><span id="l58.8">   message.xGmLabels = gXGmLabels11; // With labels excluding &quot;//INBOX&quot;</span>
<a href="#l58.9"></a><span id="l58.9">   IMAPPump.mailbox.addMessage(message);</span>
<a href="#l58.10"></a><span id="l58.10"> }</span>
<a href="#l58.11"></a><span id="l58.11"> </span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-function updateFolder() {</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineplus">+function* updateFolder() {</span>
<a href="#l58.14"></a><span id="l58.14">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l58.15"></a><span id="l58.15">   yield false;</span>
<a href="#l58.16"></a><span id="l58.16"> }</span>
<a href="#l58.17"></a><span id="l58.17"> </span>
<a href="#l58.18"></a><span id="l58.18" class="difflineminus">-function selectInboxMsg() {</span>
<a href="#l58.19"></a><span id="l58.19" class="difflineplus">+function* selectInboxMsg() {</span>
<a href="#l58.20"></a><span id="l58.20">   // Select mesasage1 from inbox which makes message1 available in offline store.</span>
<a href="#l58.21"></a><span id="l58.21">   let imapService = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span>
<a href="#l58.22"></a><span id="l58.22">                         .getService(Ci.nsIMsgMessageService);</span>
<a href="#l58.23"></a><span id="l58.23">   let db = IMAPPump.inbox.msgDatabase;</span>
<a href="#l58.24"></a><span id="l58.24">   let msg1 = db.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l58.25"></a><span id="l58.25">   let url = new Object;</span>
<a href="#l58.26"></a><span id="l58.26">   imapService.DisplayMessage(IMAPPump.inbox.getUriForMsg(msg1), streamListener,</span>
<a href="#l58.27"></a><span id="l58.27">                              null, asyncUrlListener, null, url);</span>
<a href="#l58.28"></a><span id="l58.28">   yield false;</span>
<a href="#l58.29"></a><span id="l58.29"> }</span>
<a href="#l58.30"></a><span id="l58.30"> </span>
<a href="#l58.31"></a><span id="l58.31" class="difflineminus">-function StreamMessageInbox() {</span>
<a href="#l58.32"></a><span id="l58.32" class="difflineplus">+function* StreamMessageInbox() {</span>
<a href="#l58.33"></a><span id="l58.33">   // Stream message1 from inbox</span>
<a href="#l58.34"></a><span id="l58.34">   let newMsgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l58.35"></a><span id="l58.35">   let msgURI = newMsgHdr.folder.getUriForMsg(newMsgHdr);</span>
<a href="#l58.36"></a><span id="l58.36">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l58.37"></a><span id="l58.37">   let msgServ = messenger.messageServiceFromURI(msgURI);</span>
<a href="#l58.38"></a><span id="l58.38">   msgServ.streamMessage(msgURI, gStreamListener, null, null, false, &quot;&quot;, false);</span>
<a href="#l58.39"></a><span id="l58.39">   gImapInboxOfflineStoreSizeInitial = IMAPPump.inbox.filePath.fileSize; // Initial Size of Inbox</span>
<a href="#l58.40"></a><span id="l58.40">   yield false;</span>
<a href="#l58.41"></a><span id="l58.41"> }</span>
<a href="#l58.42"></a><span id="l58.42"> </span>
<a href="#l58.43"></a><span id="l58.43" class="difflineminus">-function createAndUpdate() {</span>
<a href="#l58.44"></a><span id="l58.44" class="difflineplus">+function* createAndUpdate() {</span>
<a href="#l58.45"></a><span id="l58.45">   let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l58.46"></a><span id="l58.46">   fooFolder =  rootFolder.getChildNamed(&quot;foo&quot;).QueryInterface(Ci.nsIMsgImapMailFolder); // We have created the mailbox earlier.</span>
<a href="#l58.47"></a><span id="l58.47">   fooFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l58.48"></a><span id="l58.48">   yield false;</span>
<a href="#l58.49"></a><span id="l58.49"> }</span>
<a href="#l58.50"></a><span id="l58.50"> </span>
<a href="#l58.51"></a><span id="l58.51"> function addFoo() {</span>
<a href="#l58.52"></a><span id="l58.52">   // Adding our test message</span>
<a href="#l58.53"></a><span id="l58.53" class="difflineat">@@ -144,44 +144,44 @@ function addFoo() {</span>
<a href="#l58.54"></a><span id="l58.54">                                  fooBox.uidnext++, []);</span>
<a href="#l58.55"></a><span id="l58.55">   message1.messageId = gMsgId2;</span>
<a href="#l58.56"></a><span id="l58.56">   message1.xGmMsgid = gXGmMsgid2;</span>
<a href="#l58.57"></a><span id="l58.57">   message1.xGmThrid = gXGmThrid2;</span>
<a href="#l58.58"></a><span id="l58.58">   message1.xGmLabels = gXGmLabels2;</span>
<a href="#l58.59"></a><span id="l58.59">   fooBox.addMessage(message1);</span>
<a href="#l58.60"></a><span id="l58.60"> }</span>
<a href="#l58.61"></a><span id="l58.61"> </span>
<a href="#l58.62"></a><span id="l58.62" class="difflineminus">-function updateFoo() {</span>
<a href="#l58.63"></a><span id="l58.63" class="difflineplus">+function* updateFoo() {</span>
<a href="#l58.64"></a><span id="l58.64">   fooFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l58.65"></a><span id="l58.65">   yield false;</span>
<a href="#l58.66"></a><span id="l58.66"> }</span>
<a href="#l58.67"></a><span id="l58.67"> </span>
<a href="#l58.68"></a><span id="l58.68" class="difflineminus">-function selectFooMsg() {</span>
<a href="#l58.69"></a><span id="l58.69" class="difflineplus">+function* selectFooMsg() {</span>
<a href="#l58.70"></a><span id="l58.70">   // Select message2 from fooFolder, which makes fooFolder a local folder.</span>
<a href="#l58.71"></a><span id="l58.71">   let imapService = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span>
<a href="#l58.72"></a><span id="l58.72">                        .getService(Ci.nsIMsgMessageService);</span>
<a href="#l58.73"></a><span id="l58.73">   let msg1 = fooFolder.msgDatabase.getMsgHdrForMessageID(gMsgId2);</span>
<a href="#l58.74"></a><span id="l58.74">   let url = new Object;</span>
<a href="#l58.75"></a><span id="l58.75">   imapService.DisplayMessage(fooFolder.getUriForMsg(msg1), streamListener,</span>
<a href="#l58.76"></a><span id="l58.76">                              null, asyncUrlListener, null, url);</span>
<a href="#l58.77"></a><span id="l58.77">   yield false;</span>
<a href="#l58.78"></a><span id="l58.78"> }</span>
<a href="#l58.79"></a><span id="l58.79"> </span>
<a href="#l58.80"></a><span id="l58.80" class="difflineminus">-function StreamMessageFoo() {</span>
<a href="#l58.81"></a><span id="l58.81" class="difflineplus">+function* StreamMessageFoo() {</span>
<a href="#l58.82"></a><span id="l58.82">   // Stream message2 from fooFolder</span>
<a href="#l58.83"></a><span id="l58.83">   let newMsgHdr = fooFolder.msgDatabase.getMsgHdrForMessageID(gMsgId2);</span>
<a href="#l58.84"></a><span id="l58.84">   let msgURI = newMsgHdr.folder.getUriForMsg(newMsgHdr);</span>
<a href="#l58.85"></a><span id="l58.85">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l58.86"></a><span id="l58.86">   let msgServ = messenger.messageServiceFromURI(msgURI);</span>
<a href="#l58.87"></a><span id="l58.87">   msgServ.streamMessage(msgURI, gStreamListener, null, null, false, &quot;&quot;, false);</span>
<a href="#l58.88"></a><span id="l58.88">   gFooOfflineStoreSizeInitial = fooFolder.filePath.fileSize;</span>
<a href="#l58.89"></a><span id="l58.89">   yield false;</span>
<a href="#l58.90"></a><span id="l58.90"> }</span>
<a href="#l58.91"></a><span id="l58.91"> </span>
<a href="#l58.92"></a><span id="l58.92" class="difflineminus">-function crossStreaming() {</span>
<a href="#l58.93"></a><span id="l58.93" class="difflineplus">+function* crossStreaming() {</span>
<a href="#l58.94"></a><span id="l58.94">   /**</span>
<a href="#l58.95"></a><span id="l58.95">    * Streaming message1 from fooFolder. message1 is present in</span>
<a href="#l58.96"></a><span id="l58.96">    * offline store of inbox. We now test that streaming the message1</span>
<a href="#l58.97"></a><span id="l58.97">    * from fooFolder does not make us add message1 to offline store of</span>
<a href="#l58.98"></a><span id="l58.98">    * fooFolder. We check this by comparing the sizes of inbox and fooFolder</span>
<a href="#l58.99"></a><span id="l58.99">    * before and after streaming.</span>
<a href="#l58.100"></a><span id="l58.100">    */</span>
<a href="#l58.101"></a><span id="l58.101">   let msg2 = fooFolder.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapAttachmentSaves.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapAttachmentSaves.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -34,17 +34,17 @@ var tests = [</span>
<a href="#l59.4"></a><span id="l59.4">   loadImapMessage,</span>
<a href="#l59.5"></a><span id="l59.5">   startMime,</span>
<a href="#l59.6"></a><span id="l59.6">   startDetach,</span>
<a href="#l59.7"></a><span id="l59.7">   testDetach,</span>
<a href="#l59.8"></a><span id="l59.8">   endTest</span>
<a href="#l59.9"></a><span id="l59.9"> ]</span>
<a href="#l59.10"></a><span id="l59.10"> </span>
<a href="#l59.11"></a><span id="l59.11"> // load and update a message in the imap fake server</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-function loadImapMessage()</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+function* loadImapMessage()</span>
<a href="#l59.14"></a><span id="l59.14"> {</span>
<a href="#l59.15"></a><span id="l59.15">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l59.16"></a><span id="l59.16">   // create a synthetic message with attachment</span>
<a href="#l59.17"></a><span id="l59.17">   let smsg = gMessageGenerator.makeMessage({</span>
<a href="#l59.18"></a><span id="l59.18">     attachments: [</span>
<a href="#l59.19"></a><span id="l59.19">       {filename: kAttachFileName, body: 'I like cheese!'}</span>
<a href="#l59.20"></a><span id="l59.20">     ],</span>
<a href="#l59.21"></a><span id="l59.21">   });</span>
<a href="#l59.22"></a><span id="l59.22" class="difflineat">@@ -61,43 +61,43 @@ function loadImapMessage()</span>
<a href="#l59.23"></a><span id="l59.23">   do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l59.24"></a><span id="l59.24">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l59.25"></a><span id="l59.25">   do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l59.26"></a><span id="l59.26"> </span>
<a href="#l59.27"></a><span id="l59.27">   yield true;</span>
<a href="#l59.28"></a><span id="l59.28"> }</span>
<a href="#l59.29"></a><span id="l59.29"> </span>
<a href="#l59.30"></a><span id="l59.30"> // process the message through mime</span>
<a href="#l59.31"></a><span id="l59.31" class="difflineminus">-function startMime()</span>
<a href="#l59.32"></a><span id="l59.32" class="difflineplus">+function* startMime()</span>
<a href="#l59.33"></a><span id="l59.33"> {</span>
<a href="#l59.34"></a><span id="l59.34">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l59.35"></a><span id="l59.35"> </span>
<a href="#l59.36"></a><span id="l59.36">   mimeMsg.MsgHdrToMimeMessage(msgHdr, gCallbackObject, gCallbackObject.callback,</span>
<a href="#l59.37"></a><span id="l59.37">                               true /* allowDownload */);</span>
<a href="#l59.38"></a><span id="l59.38">   yield false;</span>
<a href="#l59.39"></a><span id="l59.39"> }</span>
<a href="#l59.40"></a><span id="l59.40"> </span>
<a href="#l59.41"></a><span id="l59.41"> // detach any found attachments</span>
<a href="#l59.42"></a><span id="l59.42" class="difflineminus">-function startDetach()</span>
<a href="#l59.43"></a><span id="l59.43" class="difflineplus">+function* startDetach()</span>
<a href="#l59.44"></a><span id="l59.44"> {</span>
<a href="#l59.45"></a><span id="l59.45">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l59.46"></a><span id="l59.46">   let msgURI = msgHdr.folder.generateMessageURI(msgHdr.messageKey);</span>
<a href="#l59.47"></a><span id="l59.47"> </span>
<a href="#l59.48"></a><span id="l59.48">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l59.49"></a><span id="l59.49">   let attachment = gCallbackObject.attachments[0];</span>
<a href="#l59.50"></a><span id="l59.50"> </span>
<a href="#l59.51"></a><span id="l59.51">   messenger.detachAttachmentsWOPrompts(do_get_profile(), 1,</span>
<a href="#l59.52"></a><span id="l59.52">                                        [attachment.contentType], [attachment.url],</span>
<a href="#l59.53"></a><span id="l59.53">                                        [attachment.name], [msgURI], null);</span>
<a href="#l59.54"></a><span id="l59.54">   // deletion of original message should kick async_driver.</span>
<a href="#l59.55"></a><span id="l59.55">   yield false;</span>
<a href="#l59.56"></a><span id="l59.56"> }</span>
<a href="#l59.57"></a><span id="l59.57"> </span>
<a href="#l59.58"></a><span id="l59.58"> // test that the detachment was successful</span>
<a href="#l59.59"></a><span id="l59.59" class="difflineminus">-function testDetach()</span>
<a href="#l59.60"></a><span id="l59.60" class="difflineplus">+function* testDetach()</span>
<a href="#l59.61"></a><span id="l59.61"> {</span>
<a href="#l59.62"></a><span id="l59.62">   // This test seems to fail on Linux without the following delay.</span>
<a href="#l59.63"></a><span id="l59.63">   mailTestUtils.do_timeout_function(200, async_driver);</span>
<a href="#l59.64"></a><span id="l59.64">   yield false;</span>
<a href="#l59.65"></a><span id="l59.65">   // Check that the file attached to the message now exists in the profile </span>
<a href="#l59.66"></a><span id="l59.66">   // directory.</span>
<a href="#l59.67"></a><span id="l59.67">   let checkFile = do_get_profile().clone();</span>
<a href="#l59.68"></a><span id="l59.68">   checkFile.append(kAttachFileName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapAutoSync.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapAutoSync.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -45,29 +45,29 @@ var tests = [</span>
<a href="#l60.4"></a><span id="l60.4">   test_triggerAutoSyncIdle,</span>
<a href="#l60.5"></a><span id="l60.5">   test_moveMessageToTargetFolder,</span>
<a href="#l60.6"></a><span id="l60.6">   test_waitForTargetUpdate,</span>
<a href="#l60.7"></a><span id="l60.7">   endTest</span>
<a href="#l60.8"></a><span id="l60.8"> ]</span>
<a href="#l60.9"></a><span id="l60.9"> </span>
<a href="#l60.10"></a><span id="l60.10"> var gTargetFolder;</span>
<a href="#l60.11"></a><span id="l60.11"> </span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-function test_createTargetFolder()</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+function* test_createTargetFolder()</span>
<a href="#l60.14"></a><span id="l60.14"> {</span>
<a href="#l60.15"></a><span id="l60.15">   gAutoSyncManager.addListener(gAutoSyncListener);</span>
<a href="#l60.16"></a><span id="l60.16"> </span>
<a href="#l60.17"></a><span id="l60.17">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;targetFolder&quot;, null);</span>
<a href="#l60.18"></a><span id="l60.18">   yield false;</span>
<a href="#l60.19"></a><span id="l60.19">   gTargetFolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;targetFolder&quot;);</span>
<a href="#l60.20"></a><span id="l60.20">   do_check_true(gTargetFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l60.21"></a><span id="l60.21">   // set folder to be checked for new messages when inbox is checked.</span>
<a href="#l60.22"></a><span id="l60.22">   gTargetFolder.setFlag(Ci.nsMsgFolderFlags.CheckNew);</span>
<a href="#l60.23"></a><span id="l60.23"> }</span>
<a href="#l60.24"></a><span id="l60.24"> </span>
<a href="#l60.25"></a><span id="l60.25" class="difflineminus">-function test_checkForNewMessages()</span>
<a href="#l60.26"></a><span id="l60.26" class="difflineplus">+function* test_checkForNewMessages()</span>
<a href="#l60.27"></a><span id="l60.27"> {</span>
<a href="#l60.28"></a><span id="l60.28">   addMessageToFolder(gTargetFolder);</span>
<a href="#l60.29"></a><span id="l60.29">   // This will update the INBOX and STATUS targetFolder. We only care about</span>
<a href="#l60.30"></a><span id="l60.30">   // the latter.</span>
<a href="#l60.31"></a><span id="l60.31">   IMAPPump.inbox.getNewMessages(null, null);</span>
<a href="#l60.32"></a><span id="l60.32">   IMAPPump.server.performTest(&quot;STATUS&quot;);</span>
<a href="#l60.33"></a><span id="l60.33">   // Now we'd like to make autosync update folders it knows about, to</span>
<a href="#l60.34"></a><span id="l60.34">   // get the initial autosync out of the way.</span>
<a href="#l60.35"></a><span id="l60.35" class="difflineat">@@ -81,33 +81,33 @@ function test_triggerAutoSyncIdle()</span>
<a href="#l60.36"></a><span id="l60.36">   gAutoSyncListener._waitingForDiscoveryList.push(gTargetFolder);</span>
<a href="#l60.37"></a><span id="l60.37">   gAutoSyncListener._waitingForDiscovery = true;</span>
<a href="#l60.38"></a><span id="l60.38">   let observer = gAutoSyncManager.QueryInterface(Ci.nsIObserver);</span>
<a href="#l60.39"></a><span id="l60.39">   observer.observe(null, &quot;mail-startup-done&quot;, &quot;&quot;);</span>
<a href="#l60.40"></a><span id="l60.40">   observer.observe(null, &quot;mail:appIdle&quot;, &quot;idle&quot;);</span>
<a href="#l60.41"></a><span id="l60.41"> }</span>
<a href="#l60.42"></a><span id="l60.42"> </span>
<a href="#l60.43"></a><span id="l60.43"> // move the message to a diffent folder</span>
<a href="#l60.44"></a><span id="l60.44" class="difflineminus">-function test_moveMessageToTargetFolder()</span>
<a href="#l60.45"></a><span id="l60.45" class="difflineplus">+function* test_moveMessageToTargetFolder()</span>
<a href="#l60.46"></a><span id="l60.46"> {</span>
<a href="#l60.47"></a><span id="l60.47">   let observer = gAutoSyncManager.QueryInterface(Ci.nsIObserver);</span>
<a href="#l60.48"></a><span id="l60.48">   observer.observe(null, &quot;mail:appIdle&quot;, &quot;back&quot;);</span>
<a href="#l60.49"></a><span id="l60.49">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l60.50"></a><span id="l60.50">   do_check_neq(msgHdr, null);</span>
<a href="#l60.51"></a><span id="l60.51"> </span>
<a href="#l60.52"></a><span id="l60.52">   // Now move this message to the target folder.</span>
<a href="#l60.53"></a><span id="l60.53">   let messages = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l60.54"></a><span id="l60.54">                    .createInstance(Ci.nsIMutableArray);</span>
<a href="#l60.55"></a><span id="l60.55">   messages.appendElement(msgHdr, false);</span>
<a href="#l60.56"></a><span id="l60.56">   MailServices.copy.CopyMessages(IMAPPump.inbox, messages, gTargetFolder, true,</span>
<a href="#l60.57"></a><span id="l60.57">                                  asyncCopyListener, null, false);</span>
<a href="#l60.58"></a><span id="l60.58">   yield false;</span>
<a href="#l60.59"></a><span id="l60.59"> }</span>
<a href="#l60.60"></a><span id="l60.60"> </span>
<a href="#l60.61"></a><span id="l60.61" class="difflineminus">-function test_waitForTargetUpdate()</span>
<a href="#l60.62"></a><span id="l60.62" class="difflineplus">+function* test_waitForTargetUpdate()</span>
<a href="#l60.63"></a><span id="l60.63"> {</span>
<a href="#l60.64"></a><span id="l60.64">   // After the copy, now we expect to get notified of the gTargetFolder</span>
<a href="#l60.65"></a><span id="l60.65">   // getting updated, after we simulate going idle.</span>
<a href="#l60.66"></a><span id="l60.66">   gAutoSyncListener._waitingForUpdate = true;</span>
<a href="#l60.67"></a><span id="l60.67">   gAutoSyncListener._waitingForUpdateList.push(gTargetFolder);</span>
<a href="#l60.68"></a><span id="l60.68">   gAutoSyncManager.QueryInterface(Ci.nsIObserver).observe(null, &quot;mail:appIdle&quot;,</span>
<a href="#l60.69"></a><span id="l60.69">                                                           &quot;idle&quot;);</span>
<a href="#l60.70"></a><span id="l60.70">   // Need two yield here to get results of both onDownloadCompleted and onDiscoveryQProcessed</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapContentLength.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapContentLength.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -24,17 +24,17 @@ var gFile = do_get_file(&quot;../../../data/m</span>
<a href="#l61.4"></a><span id="l61.4"> var tests = [</span>
<a href="#l61.5"></a><span id="l61.5">   setup,</span>
<a href="#l61.6"></a><span id="l61.6">   addMessageToServer,</span>
<a href="#l61.7"></a><span id="l61.7">   verifyContentLength,</span>
<a href="#l61.8"></a><span id="l61.8">   teardown</span>
<a href="#l61.9"></a><span id="l61.9"> ];</span>
<a href="#l61.10"></a><span id="l61.10"> </span>
<a href="#l61.11"></a><span id="l61.11"> // Adds some messages directly to a mailbox (eg new mail)</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-function addMessageToServer() {</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+function* addMessageToServer() {</span>
<a href="#l61.14"></a><span id="l61.14">   let URI = Services.io.newFileURI(gFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l61.15"></a><span id="l61.15">   IMAPPump.mailbox.addMessage(new imapMessage(URI.spec, IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l61.16"></a><span id="l61.16"> </span>
<a href="#l61.17"></a><span id="l61.17">   IMAPPump.inbox.updateFolder(null);</span>
<a href="#l61.18"></a><span id="l61.18">   yield false;</span>
<a href="#l61.19"></a><span id="l61.19"> }</span>
<a href="#l61.20"></a><span id="l61.20"> </span>
<a href="#l61.21"></a><span id="l61.21"> var msgFolderListener = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapCopyTimeout.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapCopyTimeout.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -45,29 +45,29 @@ var tests = [</span>
<a href="#l62.4"></a><span id="l62.4">   loadImapMessage,</span>
<a href="#l62.5"></a><span id="l62.5">   moveMessageToTargetFolder,</span>
<a href="#l62.6"></a><span id="l62.6">   waitForOfflinePlayback,</span>
<a href="#l62.7"></a><span id="l62.7">   updateTargetFolder,</span>
<a href="#l62.8"></a><span id="l62.8">   endTest</span>
<a href="#l62.9"></a><span id="l62.9"> ]</span>
<a href="#l62.10"></a><span id="l62.10"> </span>
<a href="#l62.11"></a><span id="l62.11"> var gTargetFolder;</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-function createTargetFolder()</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+function* createTargetFolder()</span>
<a href="#l62.14"></a><span id="l62.14"> {</span>
<a href="#l62.15"></a><span id="l62.15">   IMAPPump.daemon.copySleep = 5000;</span>
<a href="#l62.16"></a><span id="l62.16">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;targetFolder&quot;, null);</span>
<a href="#l62.17"></a><span id="l62.17" class="difflineminus">-  yield false; </span>
<a href="#l62.18"></a><span id="l62.18" class="difflineplus">+  yield false;</span>
<a href="#l62.19"></a><span id="l62.19">   gTargetFolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;targetFolder&quot;);</span>
<a href="#l62.20"></a><span id="l62.20">   do_check_true(gTargetFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l62.21"></a><span id="l62.21">   gTargetFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l62.22"></a><span id="l62.22">   yield false;</span>
<a href="#l62.23"></a><span id="l62.23" class="difflineminus">-}  </span>
<a href="#l62.24"></a><span id="l62.24" class="difflineplus">+}</span>
<a href="#l62.25"></a><span id="l62.25"> </span>
<a href="#l62.26"></a><span id="l62.26"> // load and update a message in the imap fake server</span>
<a href="#l62.27"></a><span id="l62.27" class="difflineminus">-function loadImapMessage()</span>
<a href="#l62.28"></a><span id="l62.28" class="difflineplus">+function* loadImapMessage()</span>
<a href="#l62.29"></a><span id="l62.29"> {</span>
<a href="#l62.30"></a><span id="l62.30">   let messages = [];</span>
<a href="#l62.31"></a><span id="l62.31">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l62.32"></a><span id="l62.32">   messages = messages.concat(gMessageGenerator.makeMessage());</span>
<a href="#l62.33"></a><span id="l62.33"> </span>
<a href="#l62.34"></a><span id="l62.34">   let msgURI =</span>
<a href="#l62.35"></a><span id="l62.35">     Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l62.36"></a><span id="l62.36">                        btoa(messages[0].toMessageString()),</span>
<a href="#l62.37"></a><span id="l62.37" class="difflineat">@@ -80,41 +80,41 @@ function loadImapMessage()</span>
<a href="#l62.38"></a><span id="l62.38">   do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l62.39"></a><span id="l62.39">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l62.40"></a><span id="l62.40">   do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l62.41"></a><span id="l62.41"> </span>
<a href="#l62.42"></a><span id="l62.42">   yield true;</span>
<a href="#l62.43"></a><span id="l62.43"> }</span>
<a href="#l62.44"></a><span id="l62.44"> </span>
<a href="#l62.45"></a><span id="l62.45"> // move the message to a diffent folder</span>
<a href="#l62.46"></a><span id="l62.46" class="difflineminus">-function moveMessageToTargetFolder()</span>
<a href="#l62.47"></a><span id="l62.47" class="difflineplus">+function* moveMessageToTargetFolder()</span>
<a href="#l62.48"></a><span id="l62.48"> {</span>
<a href="#l62.49"></a><span id="l62.49">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l62.50"></a><span id="l62.50"> </span>
<a href="#l62.51"></a><span id="l62.51">   // Now move this message to the target folder.</span>
<a href="#l62.52"></a><span id="l62.52">   var messages = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l62.53"></a><span id="l62.53">                    .createInstance(Ci.nsIMutableArray);</span>
<a href="#l62.54"></a><span id="l62.54">   messages.appendElement(msgHdr, false);</span>
<a href="#l62.55"></a><span id="l62.55">   // This should cause the move to be done as an offline imap operation</span>
<a href="#l62.56"></a><span id="l62.56">   // that's played back immediately.</span>
<a href="#l62.57"></a><span id="l62.57">   MailServices.copy.CopyMessages(IMAPPump.inbox, messages, gTargetFolder, true,</span>
<a href="#l62.58"></a><span id="l62.58">                                  CopyListener, gDummyMsgWindow, true);</span>
<a href="#l62.59"></a><span id="l62.59">   yield false;</span>
<a href="#l62.60"></a><span id="l62.60"> }</span>
<a href="#l62.61"></a><span id="l62.61"> </span>
<a href="#l62.62"></a><span id="l62.62" class="difflineminus">-function waitForOfflinePlayback()</span>
<a href="#l62.63"></a><span id="l62.63" class="difflineplus">+function* waitForOfflinePlayback()</span>
<a href="#l62.64"></a><span id="l62.64"> {</span>
<a href="#l62.65"></a><span id="l62.65">   // just wait for the alert about timed out connection.</span>
<a href="#l62.66"></a><span id="l62.66">   yield false;</span>
<a href="#l62.67"></a><span id="l62.67">   // then, wait for a second so we don't get our next url aborted.</span>
<a href="#l62.68"></a><span id="l62.68">   do_timeout(1000, async_driver);</span>
<a href="#l62.69"></a><span id="l62.69">   yield false;</span>
<a href="#l62.70"></a><span id="l62.70"> }</span>
<a href="#l62.71"></a><span id="l62.71"> </span>
<a href="#l62.72"></a><span id="l62.72" class="difflineminus">-function updateTargetFolder()</span>
<a href="#l62.73"></a><span id="l62.73" class="difflineplus">+function* updateTargetFolder()</span>
<a href="#l62.74"></a><span id="l62.74"> {</span>
<a href="#l62.75"></a><span id="l62.75">   gTargetFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l62.76"></a><span id="l62.76">   yield false;</span>
<a href="#l62.77"></a><span id="l62.77"> }</span>
<a href="#l62.78"></a><span id="l62.78"> </span>
<a href="#l62.79"></a><span id="l62.79"> // Cleanup</span>
<a href="#l62.80"></a><span id="l62.80"> function endTest()</span>
<a href="#l62.81"></a><span id="l62.81"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFlagChange.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFlagChange.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -9,103 +9,103 @@ load(&quot;../../../resources/asyncTestUtils.</span>
<a href="#l63.4"></a><span id="l63.4"> load(&quot;../../../resources/messageGenerator.js&quot;);</span>
<a href="#l63.5"></a><span id="l63.5"> </span>
<a href="#l63.6"></a><span id="l63.6"> var gMessage;</span>
<a href="#l63.7"></a><span id="l63.7"> var gSecondFolder;</span>
<a href="#l63.8"></a><span id="l63.8"> var gSynthMessage;</span>
<a href="#l63.9"></a><span id="l63.9"> </span>
<a href="#l63.10"></a><span id="l63.10"> var tests = [</span>
<a href="#l63.11"></a><span id="l63.11">   setup,</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-  function switchAwayFromInbox() {</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+  function* switchAwayFromInbox() {</span>
<a href="#l63.14"></a><span id="l63.14">     let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l63.15"></a><span id="l63.15">     gSecondFolder =  rootFolder.getChildNamed(&quot;secondFolder&quot;)</span>
<a href="#l63.16"></a><span id="l63.16">                            .QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l63.17"></a><span id="l63.17"> </span>
<a href="#l63.18"></a><span id="l63.18">     // Selecting the second folder will close the cached connection</span>
<a href="#l63.19"></a><span id="l63.19">     // on the inbox because fake server only supports one connection at a time.</span>
<a href="#l63.20"></a><span id="l63.20">     //  Then, we can poke at the message on the imap server directly, which</span>
<a href="#l63.21"></a><span id="l63.21">     // simulates the user changing the message from a different machine,</span>
<a href="#l63.22"></a><span id="l63.22">     // and Thunderbird discovering the change when it does a flag sync </span>
<a href="#l63.23"></a><span id="l63.23">     // upon reselecting the Inbox.</span>
<a href="#l63.24"></a><span id="l63.24">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.25"></a><span id="l63.25">     yield false;</span>
<a href="#l63.26"></a><span id="l63.26">   },</span>
<a href="#l63.27"></a><span id="l63.27" class="difflineminus">-  function simulateForwardFlagSet() {</span>
<a href="#l63.28"></a><span id="l63.28" class="difflineplus">+  function* simulateForwardFlagSet() {</span>
<a href="#l63.29"></a><span id="l63.29">     gMessage.setFlag(&quot;$Forwarded&quot;);</span>
<a href="#l63.30"></a><span id="l63.30">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.31"></a><span id="l63.31">     yield false;</span>
<a href="#l63.32"></a><span id="l63.32">   },</span>
<a href="#l63.33"></a><span id="l63.33" class="difflineminus">-  function checkForwardedFlagSet() {</span>
<a href="#l63.34"></a><span id="l63.34" class="difflineplus">+  function* checkForwardedFlagSet() {</span>
<a href="#l63.35"></a><span id="l63.35">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l63.36"></a><span id="l63.36">     do_check_eq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Forwarded,</span>
<a href="#l63.37"></a><span id="l63.37">       Ci.nsMsgMessageFlags.Forwarded);</span>
<a href="#l63.38"></a><span id="l63.38">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.39"></a><span id="l63.39">     yield false;</span>
<a href="#l63.40"></a><span id="l63.40">   },</span>
<a href="#l63.41"></a><span id="l63.41" class="difflineminus">-  function clearForwardedFlag() {</span>
<a href="#l63.42"></a><span id="l63.42" class="difflineplus">+  function* clearForwardedFlag() {</span>
<a href="#l63.43"></a><span id="l63.43">     gMessage.clearFlag(&quot;$Forwarded&quot;);</span>
<a href="#l63.44"></a><span id="l63.44">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.45"></a><span id="l63.45">     yield false;</span>
<a href="#l63.46"></a><span id="l63.46">   },</span>
<a href="#l63.47"></a><span id="l63.47" class="difflineminus">-  function checkForwardedFlagCleared() {</span>
<a href="#l63.48"></a><span id="l63.48" class="difflineplus">+  function* checkForwardedFlagCleared() {</span>
<a href="#l63.49"></a><span id="l63.49">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l63.50"></a><span id="l63.50">     do_check_eq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Forwarded, 0);</span>
<a href="#l63.51"></a><span id="l63.51">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.52"></a><span id="l63.52">     yield false;</span>
<a href="#l63.53"></a><span id="l63.53">   },</span>
<a href="#l63.54"></a><span id="l63.54" class="difflineminus">-  function setSeenFlag() {</span>
<a href="#l63.55"></a><span id="l63.55" class="difflineplus">+  function* setSeenFlag() {</span>
<a href="#l63.56"></a><span id="l63.56">     gMessage.setFlag(&quot;\\Seen&quot;);</span>
<a href="#l63.57"></a><span id="l63.57">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.58"></a><span id="l63.58">     yield false;</span>
<a href="#l63.59"></a><span id="l63.59">   },</span>
<a href="#l63.60"></a><span id="l63.60" class="difflineminus">-  function checkSeenFlagSet() {</span>
<a href="#l63.61"></a><span id="l63.61" class="difflineplus">+  function* checkSeenFlagSet() {</span>
<a href="#l63.62"></a><span id="l63.62">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l63.63"></a><span id="l63.63">     do_check_eq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Read,</span>
<a href="#l63.64"></a><span id="l63.64">                 Ci.nsMsgMessageFlags.Read);</span>
<a href="#l63.65"></a><span id="l63.65">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.66"></a><span id="l63.66">     yield false;</span>
<a href="#l63.67"></a><span id="l63.67">   },</span>
<a href="#l63.68"></a><span id="l63.68" class="difflineminus">-  function simulateRepliedFlagSet() {</span>
<a href="#l63.69"></a><span id="l63.69" class="difflineplus">+  function* simulateRepliedFlagSet() {</span>
<a href="#l63.70"></a><span id="l63.70">     gMessage.setFlag(&quot;\\Answered&quot;);</span>
<a href="#l63.71"></a><span id="l63.71">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.72"></a><span id="l63.72">     yield false;</span>
<a href="#l63.73"></a><span id="l63.73">   },</span>
<a href="#l63.74"></a><span id="l63.74" class="difflineminus">-  function checkRepliedFlagSet() {</span>
<a href="#l63.75"></a><span id="l63.75" class="difflineplus">+  function* checkRepliedFlagSet() {</span>
<a href="#l63.76"></a><span id="l63.76">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l63.77"></a><span id="l63.77">     do_check_eq(msgHdr.flags &amp; Ci.nsMsgMessageFlags.Replied,</span>
<a href="#l63.78"></a><span id="l63.78">       Ci.nsMsgMessageFlags.Replied);</span>
<a href="#l63.79"></a><span id="l63.79">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.80"></a><span id="l63.80">     yield false;</span>
<a href="#l63.81"></a><span id="l63.81">   },</span>
<a href="#l63.82"></a><span id="l63.82" class="difflineminus">-  function simulateTagAdded() {</span>
<a href="#l63.83"></a><span id="l63.83" class="difflineplus">+  function* simulateTagAdded() {</span>
<a href="#l63.84"></a><span id="l63.84">     gMessage.setFlag(&quot;randomtag&quot;);</span>
<a href="#l63.85"></a><span id="l63.85">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.86"></a><span id="l63.86">     yield false;</span>
<a href="#l63.87"></a><span id="l63.87">   },</span>
<a href="#l63.88"></a><span id="l63.88" class="difflineminus">-  function checkTagSet() {</span>
<a href="#l63.89"></a><span id="l63.89" class="difflineplus">+  function* checkTagSet() {</span>
<a href="#l63.90"></a><span id="l63.90">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l63.91"></a><span id="l63.91">     let keywords = msgHdr.getStringProperty(&quot;keywords&quot;);</span>
<a href="#l63.92"></a><span id="l63.92">     do_check_true(keywords.includes(&quot;randomtag&quot;));</span>
<a href="#l63.93"></a><span id="l63.93">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.94"></a><span id="l63.94">     yield false;</span>
<a href="#l63.95"></a><span id="l63.95">   },</span>
<a href="#l63.96"></a><span id="l63.96" class="difflineminus">-  function clearTag() {</span>
<a href="#l63.97"></a><span id="l63.97" class="difflineplus">+  function* clearTag() {</span>
<a href="#l63.98"></a><span id="l63.98">     gMessage.clearFlag(&quot;randomtag&quot;);</span>
<a href="#l63.99"></a><span id="l63.99">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l63.100"></a><span id="l63.100">     yield false;</span>
<a href="#l63.101"></a><span id="l63.101">   },</span>
<a href="#l63.102"></a><span id="l63.102">   function checkTagCleared() {</span>
<a href="#l63.103"></a><span id="l63.103">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l63.104"></a><span id="l63.104">     let keywords = msgHdr.getStringProperty(&quot;keywords&quot;);</span>
<a href="#l63.105"></a><span id="l63.105">     do_check_false(keywords.includes(&quot;randomtag&quot;));</span>
<a href="#l63.106"></a><span id="l63.106">   },</span>
<a href="#l63.107"></a><span id="l63.107">   teardown</span>
<a href="#l63.108"></a><span id="l63.108"> ];</span>
<a href="#l63.109"></a><span id="l63.109"> </span>
<a href="#l63.110"></a><span id="l63.110" class="difflineminus">-function setup() {</span>
<a href="#l63.111"></a><span id="l63.111" class="difflineplus">+function* setup() {</span>
<a href="#l63.112"></a><span id="l63.112">   Services.prefs.setBoolPref(&quot;mail.server.default.autosync_offline_stores&quot;, false);</span>
<a href="#l63.113"></a><span id="l63.113"> </span>
<a href="#l63.114"></a><span id="l63.114">   setupIMAPPump();</span>
<a href="#l63.115"></a><span id="l63.115"> </span>
<a href="#l63.116"></a><span id="l63.116">   IMAPPump.daemon.createMailbox(&quot;secondFolder&quot;, {subscribed : true});</span>
<a href="#l63.117"></a><span id="l63.117"> </span>
<a href="#l63.118"></a><span id="l63.118">   // build up a diverse list of messages</span>
<a href="#l63.119"></a><span id="l63.119">   let messages = [];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFolderCopy.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFolderCopy.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -9,33 +9,33 @@ load(&quot;../../../resources/messageGenerato</span>
<a href="#l64.4"></a><span id="l64.4"> var gEmptyLocal1, gEmptyLocal2, gEmptyLocal3, gNotEmptyLocal4;</span>
<a href="#l64.5"></a><span id="l64.5"> </span>
<a href="#l64.6"></a><span id="l64.6"> Components.utils.import(&quot;resource:///modules/folderUtils.jsm&quot;);</span>
<a href="#l64.7"></a><span id="l64.7"> Components.utils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l64.8"></a><span id="l64.8"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l64.9"></a><span id="l64.9"> </span>
<a href="#l64.10"></a><span id="l64.10"> var tests = [</span>
<a href="#l64.11"></a><span id="l64.11">   setup,</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-  function copyFolder1() {</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+  function* copyFolder1() {</span>
<a href="#l64.14"></a><span id="l64.14">     dump(&quot;gEmpty1 &quot; + gEmptyLocal1.URI + &quot;\n&quot;);</span>
<a href="#l64.15"></a><span id="l64.15">     let folders = new Array;</span>
<a href="#l64.16"></a><span id="l64.16">     folders.push(gEmptyLocal1.QueryInterface(Ci.nsIMsgFolder));</span>
<a href="#l64.17"></a><span id="l64.17">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l64.18"></a><span id="l64.18">     MailServices.copy.CopyFolders(array, IMAPPump.inbox, false, CopyListener, null);</span>
<a href="#l64.19"></a><span id="l64.19">     yield false;</span>
<a href="#l64.20"></a><span id="l64.20">   },</span>
<a href="#l64.21"></a><span id="l64.21" class="difflineminus">-  function copyFolder2() {</span>
<a href="#l64.22"></a><span id="l64.22" class="difflineplus">+  function* copyFolder2() {</span>
<a href="#l64.23"></a><span id="l64.23">     dump(&quot;gEmpty2 &quot; + gEmptyLocal2.URI + &quot;\n&quot;);</span>
<a href="#l64.24"></a><span id="l64.24">     let folders = new Array;</span>
<a href="#l64.25"></a><span id="l64.25">     folders.push(gEmptyLocal2);</span>
<a href="#l64.26"></a><span id="l64.26">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l64.27"></a><span id="l64.27">     MailServices.copy.CopyFolders(array, IMAPPump.inbox, false, CopyListener, null);</span>
<a href="#l64.28"></a><span id="l64.28">     yield false;</span>
<a href="#l64.29"></a><span id="l64.29">   },</span>
<a href="#l64.30"></a><span id="l64.30" class="difflineminus">-  function copyFolder3() {</span>
<a href="#l64.31"></a><span id="l64.31" class="difflineplus">+  function* copyFolder3() {</span>
<a href="#l64.32"></a><span id="l64.32">     dump(&quot;gEmpty3 &quot; + gEmptyLocal3.URI + &quot;\n&quot;);</span>
<a href="#l64.33"></a><span id="l64.33">     let folders = new Array;</span>
<a href="#l64.34"></a><span id="l64.34">     folders.push(gEmptyLocal3);</span>
<a href="#l64.35"></a><span id="l64.35">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l64.36"></a><span id="l64.36">     MailServices.copy.CopyFolders(array, IMAPPump.inbox, false, CopyListener, null);</span>
<a href="#l64.37"></a><span id="l64.37">     yield false;</span>
<a href="#l64.38"></a><span id="l64.38">   },</span>
<a href="#l64.39"></a><span id="l64.39">   function verifyFolders() {</span>
<a href="#l64.40"></a><span id="l64.40" class="difflineat">@@ -44,26 +44,26 @@ var tests = [</span>
<a href="#l64.41"></a><span id="l64.41">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l64.42"></a><span id="l64.42">     dump(&quot;found folder2\n&quot;);</span>
<a href="#l64.43"></a><span id="l64.43">     let folder3 = IMAPPump.inbox.getChildNamed(&quot;empty 3&quot;);</span>
<a href="#l64.44"></a><span id="l64.44">     dump(&quot;found folder3\n&quot;);</span>
<a href="#l64.45"></a><span id="l64.45">     do_check_neq(folder1, null);</span>
<a href="#l64.46"></a><span id="l64.46">     do_check_neq(folder2, null);</span>
<a href="#l64.47"></a><span id="l64.47">     do_check_neq(folder3, null);</span>
<a href="#l64.48"></a><span id="l64.48">   },</span>
<a href="#l64.49"></a><span id="l64.49" class="difflineminus">-  function moveImapFolder1() {</span>
<a href="#l64.50"></a><span id="l64.50" class="difflineplus">+  function* moveImapFolder1() {</span>
<a href="#l64.51"></a><span id="l64.51">     let folders = new Array;</span>
<a href="#l64.52"></a><span id="l64.52">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l64.53"></a><span id="l64.53">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l64.54"></a><span id="l64.54">     folders.push(folder2.QueryInterface(Ci.nsIMsgFolder));</span>
<a href="#l64.55"></a><span id="l64.55">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l64.56"></a><span id="l64.56">     MailServices.copy.CopyFolders(array, folder1, true, CopyListener, null);</span>
<a href="#l64.57"></a><span id="l64.57">     yield false;</span>
<a href="#l64.58"></a><span id="l64.58">   },</span>
<a href="#l64.59"></a><span id="l64.59" class="difflineminus">-  function moveImapFolder2() {</span>
<a href="#l64.60"></a><span id="l64.60" class="difflineplus">+  function* moveImapFolder2() {</span>
<a href="#l64.61"></a><span id="l64.61">     let folders = new Array;</span>
<a href="#l64.62"></a><span id="l64.62">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l64.63"></a><span id="l64.63">     let folder3 = IMAPPump.inbox.getChildNamed(&quot;empty 3&quot;);</span>
<a href="#l64.64"></a><span id="l64.64">     folders.push(folder3.QueryInterface(Ci.nsIMsgFolder));</span>
<a href="#l64.65"></a><span id="l64.65">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l64.66"></a><span id="l64.66">     MailServices.copy.CopyFolders(array, folder1, true, CopyListener, null);</span>
<a href="#l64.67"></a><span id="l64.67">     yield false;</span>
<a href="#l64.68"></a><span id="l64.68">   },</span>
<a href="#l64.69"></a><span id="l64.69" class="difflineat">@@ -73,17 +73,17 @@ var tests = [</span>
<a href="#l64.70"></a><span id="l64.70">     let folder2 = folder1.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l64.71"></a><span id="l64.71">     dump(&quot;found folder2\n&quot;);</span>
<a href="#l64.72"></a><span id="l64.72">     let folder3 = folder1.getChildNamed(&quot;empty 3&quot;);</span>
<a href="#l64.73"></a><span id="l64.73">     dump(&quot;found folder3\n&quot;);</span>
<a href="#l64.74"></a><span id="l64.74">     do_check_neq(folder1, null);</span>
<a href="#l64.75"></a><span id="l64.75">     do_check_neq(folder2, null);</span>
<a href="#l64.76"></a><span id="l64.76">     do_check_neq(folder3, null);</span>
<a href="#l64.77"></a><span id="l64.77">   },</span>
<a href="#l64.78"></a><span id="l64.78" class="difflineminus">-  function testImapFolderCopyFailure() {</span>
<a href="#l64.79"></a><span id="l64.79" class="difflineplus">+  function* testImapFolderCopyFailure() {</span>
<a href="#l64.80"></a><span id="l64.80">     let folders = new Array;</span>
<a href="#l64.81"></a><span id="l64.81">     folders.push(gNotEmptyLocal4.QueryInterface(Ci.nsIMsgFolder));</span>
<a href="#l64.82"></a><span id="l64.82">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l64.83"></a><span id="l64.83">     IMAPPump.daemon.commandToFail = &quot;APPEND&quot;;</span>
<a href="#l64.84"></a><span id="l64.84">     // we expect NS_MSG_ERROR_IMAP_COMMAND_FAILED;</span>
<a href="#l64.85"></a><span id="l64.85">     CopyListener._expectedStatus = 0x80550021;</span>
<a href="#l64.86"></a><span id="l64.86">     MailServices.copy.CopyFolders(array, IMAPPump.inbox, false, CopyListener, null);</span>
<a href="#l64.87"></a><span id="l64.87"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapHdrChunking.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapHdrChunking.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -43,17 +43,17 @@ var gFolderListener = {</span>
<a href="#l65.4"></a><span id="l65.4"> var tests = [</span>
<a href="#l65.5"></a><span id="l65.5">   uploadImapMessages,</span>
<a href="#l65.6"></a><span id="l65.6">   testMessageFetched,</span>
<a href="#l65.7"></a><span id="l65.7">   testHdrsDownloaded,</span>
<a href="#l65.8"></a><span id="l65.8">   endTest</span>
<a href="#l65.9"></a><span id="l65.9"> ]</span>
<a href="#l65.10"></a><span id="l65.10"> </span>
<a href="#l65.11"></a><span id="l65.11"> // upload messages to the imap fake server Inbox</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-function uploadImapMessages()</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+function* uploadImapMessages()</span>
<a href="#l65.14"></a><span id="l65.14"> {</span>
<a href="#l65.15"></a><span id="l65.15">   // make 10 messges</span>
<a href="#l65.16"></a><span id="l65.16">   let messageGenerator = new MessageGenerator();</span>
<a href="#l65.17"></a><span id="l65.17">   let scenarioFactory = new MessageScenarioFactory(messageGenerator);</span>
<a href="#l65.18"></a><span id="l65.18"> </span>
<a href="#l65.19"></a><span id="l65.19">   // build up a list of messages</span>
<a href="#l65.20"></a><span id="l65.20">   let messages = [];</span>
<a href="#l65.21"></a><span id="l65.21">   messages = messages.concat(scenarioFactory.directReply(10));</span>
<a href="#l65.22"></a><span id="l65.22" class="difflineat">@@ -68,27 +68,27 @@ function uploadImapMessages()</span>
<a href="#l65.23"></a><span id="l65.23">                                      null, null);</span>
<a href="#l65.24"></a><span id="l65.24">     imapInbox.addMessage(new imapMessage(dataUri.spec, imapInbox.uidnext++, []));</span>
<a href="#l65.25"></a><span id="l65.25">   });</span>
<a href="#l65.26"></a><span id="l65.26">   // updateFolderWithListener with null for nsIMsgWindow makes biff notify.</span>
<a href="#l65.27"></a><span id="l65.27">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l65.28"></a><span id="l65.28">   yield false;</span>
<a href="#l65.29"></a><span id="l65.29"> }</span>
<a href="#l65.30"></a><span id="l65.30"> </span>
<a href="#l65.31"></a><span id="l65.31" class="difflineminus">-function testMessageFetched() {</span>
<a href="#l65.32"></a><span id="l65.32" class="difflineplus">+function* testMessageFetched() {</span>
<a href="#l65.33"></a><span id="l65.33">   // If we're really chunking, then the message fetch should have started before</span>
<a href="#l65.34"></a><span id="l65.34">   // we finished the updateFolder URL.</span>
<a href="#l65.35"></a><span id="l65.35">   do_check_true(gFolderListener._gotNewMailBiff);</span>
<a href="#l65.36"></a><span id="l65.36">   // Should have only downloaded first chunk of headers when message</span>
<a href="#l65.37"></a><span id="l65.37">   // has finished streaming.</span>
<a href="#l65.38"></a><span id="l65.38">   do_check_eq(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 3);</span>
<a href="#l65.39"></a><span id="l65.39">   yield false;</span>
<a href="#l65.40"></a><span id="l65.40"> }</span>
<a href="#l65.41"></a><span id="l65.41"> </span>
<a href="#l65.42"></a><span id="l65.42" class="difflineminus">-function testHdrsDownloaded() {</span>
<a href="#l65.43"></a><span id="l65.43" class="difflineplus">+function* testHdrsDownloaded() {</span>
<a href="#l65.44"></a><span id="l65.44">   // Make sure we got all 10 headers.</span>
<a href="#l65.45"></a><span id="l65.45">   do_check_eq(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 10);</span>
<a href="#l65.46"></a><span id="l65.46">   yield true;</span>
<a href="#l65.47"></a><span id="l65.47"> }</span>
<a href="#l65.48"></a><span id="l65.48"> </span>
<a href="#l65.49"></a><span id="l65.49"> // Cleanup</span>
<a href="#l65.50"></a><span id="l65.50"> function endTest() {</span>
<a href="#l65.51"></a><span id="l65.51">   teardownIMAPPump();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapHdrStreaming.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapHdrStreaming.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -83,27 +83,27 @@ function run_test() {</span>
<a href="#l66.4"></a><span id="l66.4"> </span>
<a href="#l66.5"></a><span id="l66.5"> var tests = [</span>
<a href="#l66.6"></a><span id="l66.6">   test_updateFolder,</span>
<a href="#l66.7"></a><span id="l66.7">   test_downloadForOffline,</span>
<a href="#l66.8"></a><span id="l66.8">   test_streamHeaders,</span>
<a href="#l66.9"></a><span id="l66.9">   endTest</span>
<a href="#l66.10"></a><span id="l66.10"> ]</span>
<a href="#l66.11"></a><span id="l66.11"> </span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-function test_updateFolder() {</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+function* test_updateFolder() {</span>
<a href="#l66.14"></a><span id="l66.14">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l66.15"></a><span id="l66.15">   yield false;</span>
<a href="#l66.16"></a><span id="l66.16"> }</span>
<a href="#l66.17"></a><span id="l66.17"> </span>
<a href="#l66.18"></a><span id="l66.18" class="difflineminus">-function test_downloadForOffline() {</span>
<a href="#l66.19"></a><span id="l66.19" class="difflineplus">+function* test_downloadForOffline() {</span>
<a href="#l66.20"></a><span id="l66.20">   IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l66.21"></a><span id="l66.21">   yield false;</span>
<a href="#l66.22"></a><span id="l66.22"> }</span>
<a href="#l66.23"></a><span id="l66.23"> </span>
<a href="#l66.24"></a><span id="l66.24" class="difflineminus">-function test_streamHeaders()</span>
<a href="#l66.25"></a><span id="l66.25" class="difflineplus">+function* test_streamHeaders()</span>
<a href="#l66.26"></a><span id="l66.26"> {</span>
<a href="#l66.27"></a><span id="l66.27">   let newMsgHdr = IMAPPump.inbox.GetMessageHeader(1);</span>
<a href="#l66.28"></a><span id="l66.28">   let msgURI = newMsgHdr.folder.getUriForMsg(newMsgHdr);</span>
<a href="#l66.29"></a><span id="l66.29">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l66.30"></a><span id="l66.30">   let msgServ = messenger.messageServiceFromURI(msgURI);</span>
<a href="#l66.31"></a><span id="l66.31">   msgServ.streamHeaders(msgURI, streamListener, asyncUrlListener,true);</span>
<a href="#l66.32"></a><span id="l66.32">   yield false;</span>
<a href="#l66.33"></a><span id="l66.33"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapHighWater.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapHighWater.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -63,17 +63,17 @@ function run_test()</span>
<a href="#l67.4"></a><span id="l67.4">   Services.prefs.setBoolPref(&quot;mail.biff.show_tray_icon&quot;, false);</span>
<a href="#l67.5"></a><span id="l67.5">   Services.prefs.setBoolPref(&quot;mail.biff.animate_dock_icon&quot;, false);</span>
<a href="#l67.6"></a><span id="l67.6">   Services.prefs.setBoolPref(&quot;mail.server.default.autosync_offline_stores&quot;, false);</span>
<a href="#l67.7"></a><span id="l67.7">   // Don't prompt about offline download when going offline</span>
<a href="#l67.8"></a><span id="l67.8">   Services.prefs.setIntPref(&quot;offline.download.download_messages&quot;, 2);</span>
<a href="#l67.9"></a><span id="l67.9">   actually_run_test();</span>
<a href="#l67.10"></a><span id="l67.10"> }</span>
<a href="#l67.11"></a><span id="l67.11"> </span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-function setupFolders() {</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+function* setupFolders() {</span>
<a href="#l67.14"></a><span id="l67.14">   // make 10 messges</span>
<a href="#l67.15"></a><span id="l67.15">   let messageGenerator = new MessageGenerator();</span>
<a href="#l67.16"></a><span id="l67.16">   let scenarioFactory = new MessageScenarioFactory(messageGenerator);</span>
<a href="#l67.17"></a><span id="l67.17"> </span>
<a href="#l67.18"></a><span id="l67.18">   // build up a list of messages</span>
<a href="#l67.19"></a><span id="l67.19">   let messages = [];</span>
<a href="#l67.20"></a><span id="l67.20">   messages = messages.concat(scenarioFactory.directReply(10));</span>
<a href="#l67.21"></a><span id="l67.21"> </span>
<a href="#l67.22"></a><span id="l67.22" class="difflineat">@@ -87,17 +87,17 @@ function setupFolders() {</span>
<a href="#l67.23"></a><span id="l67.23"> </span>
<a href="#l67.24"></a><span id="l67.24">   // Get the IMAP inbox...</span>
<a href="#l67.25"></a><span id="l67.25">   gRootFolder = gIMAPIncomingServer.rootFolder;</span>
<a href="#l67.26"></a><span id="l67.26">   gIMAPInbox = gRootFolder.getFolderWithFlags(Ci.nsMsgFolderFlags.Inbox)</span>
<a href="#l67.27"></a><span id="l67.27">                          .QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l67.28"></a><span id="l67.28">   yield true;</span>
<a href="#l67.29"></a><span id="l67.29"> }</span>
<a href="#l67.30"></a><span id="l67.30"> </span>
<a href="#l67.31"></a><span id="l67.31" class="difflineminus">-function doMoves() {</span>
<a href="#l67.32"></a><span id="l67.32" class="difflineplus">+function* doMoves() {</span>
<a href="#l67.33"></a><span id="l67.33">   // update folders to download headers.</span>
<a href="#l67.34"></a><span id="l67.34">   gIMAPInbox.updateFolderWithListener(null, UrlListener);</span>
<a href="#l67.35"></a><span id="l67.35">   yield false;</span>
<a href="#l67.36"></a><span id="l67.36">   gFolder1 = gRootFolder.getChildNamed(&quot;folder 1&quot;)</span>
<a href="#l67.37"></a><span id="l67.37">                .QueryInterface(Components.interfaces.nsIMsgImapMailFolder);</span>
<a href="#l67.38"></a><span id="l67.38">   gFolder1.updateFolderWithListener(null, UrlListener);</span>
<a href="#l67.39"></a><span id="l67.39">   yield false;</span>
<a href="#l67.40"></a><span id="l67.40">   // get five messages to move from Inbox to folder 1.</span>
<a href="#l67.41"></a><span id="l67.41" class="difflineat">@@ -180,17 +180,17 @@ var tests = [</span>
<a href="#l67.42"></a><span id="l67.42">   doMoves,</span>
<a href="#l67.43"></a><span id="l67.43">   endTest</span>
<a href="#l67.44"></a><span id="l67.44"> ]</span>
<a href="#l67.45"></a><span id="l67.45"> </span>
<a href="#l67.46"></a><span id="l67.46"> function actually_run_test() {</span>
<a href="#l67.47"></a><span id="l67.47">   async_run_tests(tests);</span>
<a href="#l67.48"></a><span id="l67.48"> }</span>
<a href="#l67.49"></a><span id="l67.49"> </span>
<a href="#l67.50"></a><span id="l67.50" class="difflineminus">-function endTest()</span>
<a href="#l67.51"></a><span id="l67.51" class="difflineplus">+function* endTest()</span>
<a href="#l67.52"></a><span id="l67.52"> {</span>
<a href="#l67.53"></a><span id="l67.53">   Services.io.offline = true;</span>
<a href="#l67.54"></a><span id="l67.54">   gServer.performTest(&quot;LOGOUT&quot;);</span>
<a href="#l67.55"></a><span id="l67.55"> //  gIMAPIncomingServer.closeCachedConnections();</span>
<a href="#l67.56"></a><span id="l67.56">   gServer.stop();</span>
<a href="#l67.57"></a><span id="l67.57">   let thread = gThreadManager.currentThread;</span>
<a href="#l67.58"></a><span id="l67.58">   while (thread.hasPendingEvents())</span>
<a href="#l67.59"></a><span id="l67.59">     thread.processNextEvent(true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapRename.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapRename.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -12,29 +12,29 @@ load(&quot;../../../resources/asyncTestUtils.</span>
<a href="#l68.4"></a><span id="l68.4"> </span>
<a href="#l68.5"></a><span id="l68.5"> setupIMAPPump();</span>
<a href="#l68.6"></a><span id="l68.6"> </span>
<a href="#l68.7"></a><span id="l68.7"> var tests = [</span>
<a href="#l68.8"></a><span id="l68.8">   setup,</span>
<a href="#l68.9"></a><span id="l68.9">   test_rename,</span>
<a href="#l68.10"></a><span id="l68.10"> ];</span>
<a href="#l68.11"></a><span id="l68.11"> </span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-function setup() {</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineplus">+function* setup() {</span>
<a href="#l68.14"></a><span id="l68.14">   Services.prefs.setBoolPref(&quot;mail.server.default.autosync_offline_stores&quot;, false);</span>
<a href="#l68.15"></a><span id="l68.15">   // Add folder listeners that will capture async events</span>
<a href="#l68.16"></a><span id="l68.16">   MailServices.mfn.addListener(mfnListener, MailServices.mfn.folderAdded);</span>
<a href="#l68.17"></a><span id="l68.17"> </span>
<a href="#l68.18"></a><span id="l68.18">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;folder 1&quot;, null);</span>
<a href="#l68.19"></a><span id="l68.19">   yield false;</span>
<a href="#l68.20"></a><span id="l68.20"> </span>
<a href="#l68.21"></a><span id="l68.21">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l68.22"></a><span id="l68.22">   yield false;</span>
<a href="#l68.23"></a><span id="l68.23"> }</span>
<a href="#l68.24"></a><span id="l68.24"> </span>
<a href="#l68.25"></a><span id="l68.25" class="difflineminus">-function test_rename() {</span>
<a href="#l68.26"></a><span id="l68.26" class="difflineplus">+function* test_rename() {</span>
<a href="#l68.27"></a><span id="l68.27">   let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l68.28"></a><span id="l68.28">   let targetFolder = rootFolder.getChildNamed(&quot;folder 1&quot;);</span>
<a href="#l68.29"></a><span id="l68.29"> </span>
<a href="#l68.30"></a><span id="l68.30">   targetFolder.rename(&quot;folder \u00e1&quot;, null);</span>
<a href="#l68.31"></a><span id="l68.31"> </span>
<a href="#l68.32"></a><span id="l68.32">   IMAPPump.server.performTest(&quot;RENAME&quot;);</span>
<a href="#l68.33"></a><span id="l68.33">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l68.34"></a><span id="l68.34">   yield false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapSearch.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapSearch.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -236,30 +236,30 @@ var searchTests =</span>
<a href="#l69.4"></a><span id="l69.4">     { testString: &quot;too much space&quot;,</span>
<a href="#l69.5"></a><span id="l69.5">       testAttribute: OtherHeader,</span>
<a href="#l69.6"></a><span id="l69.6">       op: Contains,</span>
<a href="#l69.7"></a><span id="l69.7">       customHeader: &quot;withspace&quot;,</span>
<a href="#l69.8"></a><span id="l69.8">       count: 1}</span>
<a href="#l69.9"></a><span id="l69.9"> ];</span>
<a href="#l69.10"></a><span id="l69.10"> </span>
<a href="#l69.11"></a><span id="l69.11"> // load and update a message in the imap fake server</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-function loadImapMessage()</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineplus">+function* loadImapMessage()</span>
<a href="#l69.14"></a><span id="l69.14"> {</span>
<a href="#l69.15"></a><span id="l69.15">   IMAPPump.mailbox.addMessage(new imapMessage(specForFileName(gMessage),</span>
<a href="#l69.16"></a><span id="l69.16">                           IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l69.17"></a><span id="l69.17">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l69.18"></a><span id="l69.18">   yield false;</span>
<a href="#l69.19"></a><span id="l69.19"> </span>
<a href="#l69.20"></a><span id="l69.20">   do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l69.21"></a><span id="l69.21">   yield true;</span>
<a href="#l69.22"></a><span id="l69.22"> }</span>
<a href="#l69.23"></a><span id="l69.23"> </span>
<a href="#l69.24"></a><span id="l69.24"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l69.25"></a><span id="l69.25"> var testObject;</span>
<a href="#l69.26"></a><span id="l69.26" class="difflineminus">-function testSearch()</span>
<a href="#l69.27"></a><span id="l69.27" class="difflineplus">+function* testSearch()</span>
<a href="#l69.28"></a><span id="l69.28"> {</span>
<a href="#l69.29"></a><span id="l69.29">   while (searchTests.length)</span>
<a href="#l69.30"></a><span id="l69.30">   {</span>
<a href="#l69.31"></a><span id="l69.31">     let test = searchTests.shift();</span>
<a href="#l69.32"></a><span id="l69.32">     if (test.dbHeader)</span>
<a href="#l69.33"></a><span id="l69.33">     {</span>
<a href="#l69.34"></a><span id="l69.34">       //  test of a custom db header</span>
<a href="#l69.35"></a><span id="l69.35">       dump(&quot;testing dbHeader &quot; + test.dbHeader + &quot;\n&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapStatusCloseDBs.js</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapStatusCloseDBs.js</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -7,17 +7,17 @@ load(&quot;../../../resources/asyncTestUtils.</span>
<a href="#l70.4"></a><span id="l70.4"> var gFolder1, gFolder2;</span>
<a href="#l70.5"></a><span id="l70.5"> </span>
<a href="#l70.6"></a><span id="l70.6"> var tests = [</span>
<a href="#l70.7"></a><span id="l70.7">   setup,</span>
<a href="#l70.8"></a><span id="l70.8">   check,</span>
<a href="#l70.9"></a><span id="l70.9">   teardown</span>
<a href="#l70.10"></a><span id="l70.10"> ];</span>
<a href="#l70.11"></a><span id="l70.11"> </span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-function setup() {</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+function* setup() {</span>
<a href="#l70.14"></a><span id="l70.14">   Services.prefs.setBoolPref(&quot;mail.check_all_imap_folders_for_new&quot;, true);</span>
<a href="#l70.15"></a><span id="l70.15"> </span>
<a href="#l70.16"></a><span id="l70.16">   setupIMAPPump();</span>
<a href="#l70.17"></a><span id="l70.17"> </span>
<a href="#l70.18"></a><span id="l70.18">   IMAPPump.daemon.createMailbox(&quot;folder 1&quot;, {subscribed : true});</span>
<a href="#l70.19"></a><span id="l70.19">   IMAPPump.daemon.createMailbox(&quot;folder 2&quot;, {subscribed : true});</span>
<a href="#l70.20"></a><span id="l70.20"> </span>
<a href="#l70.21"></a><span id="l70.21">   IMAPPump.server.performTest(&quot;SUBSCRIBE&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapStoreMsgOffline.js</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapStoreMsgOffline.js</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -106,53 +106,52 @@ function setup() {</span>
<a href="#l71.4"></a><span id="l71.4">                       ],</span>
<a href="#l71.5"></a><span id="l71.5">                         IMAPPump.daemon.getMailbox(&quot;INBOX&quot;), IMAPPump.inbox);</span>
<a href="#l71.6"></a><span id="l71.6"> }</span>
<a href="#l71.7"></a><span id="l71.7"> </span>
<a href="#l71.8"></a><span id="l71.8"> var gIMAPService;</span>
<a href="#l71.9"></a><span id="l71.9"> </span>
<a href="#l71.10"></a><span id="l71.10"> var tests = [</span>
<a href="#l71.11"></a><span id="l71.11">   setup,</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">-  function updateFolder() {</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineplus">+  function* updateFolder() {</span>
<a href="#l71.14"></a><span id="l71.14">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l71.15"></a><span id="l71.15">     yield false;</span>
<a href="#l71.16"></a><span id="l71.16">   },</span>
<a href="#l71.17"></a><span id="l71.17" class="difflineminus">-  function selectFirstMsg() {</span>
<a href="#l71.18"></a><span id="l71.18" class="difflineminus">-</span>
<a href="#l71.19"></a><span id="l71.19" class="difflineminus">-  // We postpone creating the imap service until after we've set the prefs</span>
<a href="#l71.20"></a><span id="l71.20" class="difflineminus">-  // that it reads on its startup.</span>
<a href="#l71.21"></a><span id="l71.21" class="difflineminus">-  gIMAPService = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span>
<a href="#l71.22"></a><span id="l71.22" class="difflineminus">-                       .getService(Ci.nsIMsgMessageService);</span>
<a href="#l71.23"></a><span id="l71.23" class="difflineplus">+  function* selectFirstMsg() {</span>
<a href="#l71.24"></a><span id="l71.24" class="difflineplus">+    // We postpone creating the imap service until after we've set the prefs</span>
<a href="#l71.25"></a><span id="l71.25" class="difflineplus">+    // that it reads on its startup.</span>
<a href="#l71.26"></a><span id="l71.26" class="difflineplus">+    gIMAPService = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span>
<a href="#l71.27"></a><span id="l71.27" class="difflineplus">+                     .getService(Ci.nsIMsgMessageService);</span>
<a href="#l71.28"></a><span id="l71.28"> </span>
<a href="#l71.29"></a><span id="l71.29">     let db = IMAPPump.inbox.msgDatabase;</span>
<a href="#l71.30"></a><span id="l71.30">     let msg1 = db.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l71.31"></a><span id="l71.31">     let url = new Object;</span>
<a href="#l71.32"></a><span id="l71.32">     gIMAPService.DisplayMessage(IMAPPump.inbox.getUriForMsg(msg1),</span>
<a href="#l71.33"></a><span id="l71.33">                                             streamListener,</span>
<a href="#l71.34"></a><span id="l71.34">                                             null,</span>
<a href="#l71.35"></a><span id="l71.35">                                             asyncUrlListener,</span>
<a href="#l71.36"></a><span id="l71.36">                                             null,</span>
<a href="#l71.37"></a><span id="l71.37">                                             url);</span>
<a href="#l71.38"></a><span id="l71.38">     yield false;</span>
<a href="#l71.39"></a><span id="l71.39">   },</span>
<a href="#l71.40"></a><span id="l71.40" class="difflineminus">-  function select2ndMsg() {</span>
<a href="#l71.41"></a><span id="l71.41" class="difflineplus">+  function* select2ndMsg() {</span>
<a href="#l71.42"></a><span id="l71.42">     let msg1 = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l71.43"></a><span id="l71.43">     do_check_neq(msg1.flags &amp; nsMsgMessageFlags.Offline, 0);</span>
<a href="#l71.44"></a><span id="l71.44">     let db = IMAPPump.inbox.msgDatabase;</span>
<a href="#l71.45"></a><span id="l71.45">     let msg2 = db.getMsgHdrForMessageID(gMsgId2);</span>
<a href="#l71.46"></a><span id="l71.46">     let url = new Object;</span>
<a href="#l71.47"></a><span id="l71.47">     gIMAPService.DisplayMessage(IMAPPump.inbox.getUriForMsg(msg2),</span>
<a href="#l71.48"></a><span id="l71.48">                                             streamListener,</span>
<a href="#l71.49"></a><span id="l71.49">                                             null,</span>
<a href="#l71.50"></a><span id="l71.50">                                             asyncUrlListener,</span>
<a href="#l71.51"></a><span id="l71.51">                                             null,</span>
<a href="#l71.52"></a><span id="l71.52">                                             url);</span>
<a href="#l71.53"></a><span id="l71.53">     yield false;</span>
<a href="#l71.54"></a><span id="l71.54">   },</span>
<a href="#l71.55"></a><span id="l71.55" class="difflineminus">-  function select3rdMsg() {</span>
<a href="#l71.56"></a><span id="l71.56" class="difflineplus">+  function* select3rdMsg() {</span>
<a href="#l71.57"></a><span id="l71.57">     let msg2 = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId2);</span>
<a href="#l71.58"></a><span id="l71.58">     do_check_neq(msg2.flags &amp; nsMsgMessageFlags.Offline, 0);</span>
<a href="#l71.59"></a><span id="l71.59">     let db = IMAPPump.inbox.msgDatabase;</span>
<a href="#l71.60"></a><span id="l71.60">     let msg3 = db.getMsgHdrForMessageID(gMsgId3);</span>
<a href="#l71.61"></a><span id="l71.61">     let url = new Object;</span>
<a href="#l71.62"></a><span id="l71.62">     gIMAPService.DisplayMessage(IMAPPump.inbox.getUriForMsg(msg3),</span>
<a href="#l71.63"></a><span id="l71.63">                                             streamListener,</span>
<a href="#l71.64"></a><span id="l71.64">                                             null,</span>
<a href="#l71.65"></a><span id="l71.65" class="difflineat">@@ -161,17 +160,17 @@ var tests = [</span>
<a href="#l71.66"></a><span id="l71.66">                                             url);</span>
<a href="#l71.67"></a><span id="l71.67">     yield false;</span>
<a href="#l71.68"></a><span id="l71.68">   },</span>
<a href="#l71.69"></a><span id="l71.69">   function verify3rdMsg() {</span>
<a href="#l71.70"></a><span id="l71.70">     let msg3 = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId3);</span>
<a href="#l71.71"></a><span id="l71.71">     // can't turn this on because our fake server doesn't support body structure.</span>
<a href="#l71.72"></a><span id="l71.72"> //    do_check_eq(msg3.flags &amp; nsMsgMessageFlags.Offline, 0);</span>
<a href="#l71.73"></a><span id="l71.73">   },</span>
<a href="#l71.74"></a><span id="l71.74" class="difflineminus">-  function addNewMsgs() {</span>
<a href="#l71.75"></a><span id="l71.75" class="difflineplus">+  function* addNewMsgs() {</span>
<a href="#l71.76"></a><span id="l71.76">     let mbox = IMAPPump.daemon.getMailbox(&quot;INBOX&quot;)</span>
<a href="#l71.77"></a><span id="l71.77">     // make a couple messges</span>
<a href="#l71.78"></a><span id="l71.78">     let messages = [];</span>
<a href="#l71.79"></a><span id="l71.79">     let bodyString = &quot;&quot;;</span>
<a href="#l71.80"></a><span id="l71.80">     for (let i = 0; i &lt; 100; i++)</span>
<a href="#l71.81"></a><span id="l71.81">       bodyString += &quot;1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890\r\n&quot;;</span>
<a href="#l71.82"></a><span id="l71.82"> </span>
<a href="#l71.83"></a><span id="l71.83">     let gMessageGenerator = new MessageGenerator();</span>
<a href="#l71.84"></a><span id="l71.84" class="difflineat">@@ -186,30 +185,30 @@ var tests = [</span>
<a href="#l71.85"></a><span id="l71.85">       let dataUri = Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l71.86"></a><span id="l71.86">                                        btoa(message.toMessageString()),</span>
<a href="#l71.87"></a><span id="l71.87">                                        null, null);</span>
<a href="#l71.88"></a><span id="l71.88">       mbox.addMessage(new imapMessage(dataUri.spec, mbox.uidnext++, []));</span>
<a href="#l71.89"></a><span id="l71.89">     });</span>
<a href="#l71.90"></a><span id="l71.90">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l71.91"></a><span id="l71.91">     yield false;</span>
<a href="#l71.92"></a><span id="l71.92">   },</span>
<a href="#l71.93"></a><span id="l71.93" class="difflineminus">-  function testQueuedOfflineDownload()</span>
<a href="#l71.94"></a><span id="l71.94" class="difflineplus">+  function* testQueuedOfflineDownload()</span>
<a href="#l71.95"></a><span id="l71.95">   {</span>
<a href="#l71.96"></a><span id="l71.96">     // Make sure that streaming the same message and then trying to download</span>
<a href="#l71.97"></a><span id="l71.97">     // it for offline use doesn't end up in it getting added to the offline </span>
<a href="#l71.98"></a><span id="l71.98">     // store twice.</span>
<a href="#l71.99"></a><span id="l71.99">     gImapInboxOfflineStoreSize = IMAPPump.inbox.filePath.fileSize + gFirstMsgSize;</span>
<a href="#l71.100"></a><span id="l71.100">     let newMsgHdr = IMAPPump.inbox.GetMessageHeader(gFirstNewMsg);</span>
<a href="#l71.101"></a><span id="l71.101">     let msgURI = newMsgHdr.folder.getUriForMsg(newMsgHdr);</span>
<a href="#l71.102"></a><span id="l71.102">     let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l71.103"></a><span id="l71.103">     let msgServ = messenger.messageServiceFromURI(msgURI);</span>
<a href="#l71.104"></a><span id="l71.104">     msgServ.streamMessage(msgURI, gStreamListener, null, null, false, &quot;&quot;, false);</span>
<a href="#l71.105"></a><span id="l71.105">     yield false;</span>
<a href="#l71.106"></a><span id="l71.106">   },</span>
<a href="#l71.107"></a><span id="l71.107" class="difflineminus">-  function firstStreamFinished()</span>
<a href="#l71.108"></a><span id="l71.108" class="difflineplus">+  function* firstStreamFinished()</span>
<a href="#l71.109"></a><span id="l71.109">   {</span>
<a href="#l71.110"></a><span id="l71.110">     // nsIMsgFolder.DownloadMessagesForOffline does not take a listener, so</span>
<a href="#l71.111"></a><span id="l71.111">     // we invoke nsIImapService.downloadMessagesForOffline directly with a </span>
<a href="#l71.112"></a><span id="l71.112">     // listener.</span>
<a href="#l71.113"></a><span id="l71.113">     MailServices.imap.downloadMessagesForOffline(gFirstNewMsg,</span>
<a href="#l71.114"></a><span id="l71.114">                                                  IMAPPump.inbox,</span>
<a href="#l71.115"></a><span id="l71.115">                                                  asyncUrlListener,</span>
<a href="#l71.116"></a><span id="l71.116">                                                  null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapUndo.js</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapUndo.js</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -61,44 +61,44 @@ alertListener.prototype = {</span>
<a href="#l72.4"></a><span id="l72.4">   onAlert: function (aMessage, aMsgWindow) {</span>
<a href="#l72.5"></a><span id="l72.5">     dump(&quot;got alert &quot; + aMessage + &quot;\n&quot;);</span>
<a href="#l72.6"></a><span id="l72.6">     do_throw ('TEST FAILED ' + aMessage);</span>
<a href="#l72.7"></a><span id="l72.7">   }</span>
<a href="#l72.8"></a><span id="l72.8"> };</span>
<a href="#l72.9"></a><span id="l72.9"> </span>
<a href="#l72.10"></a><span id="l72.10"> var tests = [</span>
<a href="#l72.11"></a><span id="l72.11">   setup,</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-  function updateFolder() {</span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+  function* updateFolder() {</span>
<a href="#l72.14"></a><span id="l72.14">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l72.15"></a><span id="l72.15">     yield false;</span>
<a href="#l72.16"></a><span id="l72.16">   },</span>
<a href="#l72.17"></a><span id="l72.17" class="difflineminus">-  function deleteMessage() {</span>
<a href="#l72.18"></a><span id="l72.18" class="difflineplus">+  function* deleteMessage() {</span>
<a href="#l72.19"></a><span id="l72.19">     let msgToDelete = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l72.20"></a><span id="l72.20">     gMessages.appendElement(msgToDelete, false);</span>
<a href="#l72.21"></a><span id="l72.21">     IMAPPump.inbox.deleteMessages(gMessages, gMsgWindow, false, true, asyncCopyListener, true);</span>
<a href="#l72.22"></a><span id="l72.22">     yield false;</span>
<a href="#l72.23"></a><span id="l72.23">   },</span>
<a href="#l72.24"></a><span id="l72.24" class="difflineminus">-  function expunge() {</span>
<a href="#l72.25"></a><span id="l72.25" class="difflineplus">+  function* expunge() {</span>
<a href="#l72.26"></a><span id="l72.26">     IMAPPump.inbox.expunge(asyncUrlListener, gMsgWindow);</span>
<a href="#l72.27"></a><span id="l72.27">     yield false;</span>
<a href="#l72.28"></a><span id="l72.28"> </span>
<a href="#l72.29"></a><span id="l72.29">     // Ensure that the message has been surely deleted.</span>
<a href="#l72.30"></a><span id="l72.30">     do_check_eq(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 3);</span>
<a href="#l72.31"></a><span id="l72.31">   },</span>
<a href="#l72.32"></a><span id="l72.32" class="difflineminus">-  function undoDelete() {</span>
<a href="#l72.33"></a><span id="l72.33" class="difflineplus">+  function* undoDelete() {</span>
<a href="#l72.34"></a><span id="l72.34">     gMsgWindow.transactionManager.undoTransaction();</span>
<a href="#l72.35"></a><span id="l72.35">     // after undo, we select the trash and then the inbox, so that we sync</span>
<a href="#l72.36"></a><span id="l72.36">     // up with the server, and clear out the effects of having done the</span>
<a href="#l72.37"></a><span id="l72.37">     // delete offline.</span>
<a href="#l72.38"></a><span id="l72.38">     let trash = gRootFolder.getChildNamed(&quot;Trash&quot;);</span>
<a href="#l72.39"></a><span id="l72.39">     trash.QueryInterface(Ci.nsIMsgImapMailFolder)</span>
<a href="#l72.40"></a><span id="l72.40">          .updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l72.41"></a><span id="l72.41">     yield false;</span>
<a href="#l72.42"></a><span id="l72.42">   },</span>
<a href="#l72.43"></a><span id="l72.43" class="difflineminus">-  function goBackToInbox() {</span>
<a href="#l72.44"></a><span id="l72.44" class="difflineplus">+  function* goBackToInbox() {</span>
<a href="#l72.45"></a><span id="l72.45">     IMAPPump.inbox.updateFolderWithListener(gMsgWindow, asyncUrlListener);</span>
<a href="#l72.46"></a><span id="l72.46">     yield false;</span>
<a href="#l72.47"></a><span id="l72.47">   },</span>
<a href="#l72.48"></a><span id="l72.48">   function verifyFolders() {</span>
<a href="#l72.49"></a><span id="l72.49">     let msgRestored = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l72.50"></a><span id="l72.50">     do_check_neq(msgRestored, null);</span>
<a href="#l72.51"></a><span id="l72.51">     do_check_eq(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 4);</span>
<a href="#l72.52"></a><span id="l72.52">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_largeOfflineStore.js</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_largeOfflineStore.js</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -50,17 +50,17 @@ function run_test() {</span>
<a href="#l73.4"></a><span id="l73.4"> </span>
<a href="#l73.5"></a><span id="l73.5">     teardown();</span>
<a href="#l73.6"></a><span id="l73.6">     return;</span>
<a href="#l73.7"></a><span id="l73.7">   }</span>
<a href="#l73.8"></a><span id="l73.8"> </span>
<a href="#l73.9"></a><span id="l73.9">   async_run_tests(tests);</span>
<a href="#l73.10"></a><span id="l73.10"> }</span>
<a href="#l73.11"></a><span id="l73.11"> </span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-function setup() {</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineplus">+function* setup() {</span>
<a href="#l73.14"></a><span id="l73.14">   // Create a couple test messages on the IMAP server.</span>
<a href="#l73.15"></a><span id="l73.15">   let messages = [];</span>
<a href="#l73.16"></a><span id="l73.16">   let messageGenerator = new MessageGenerator();</span>
<a href="#l73.17"></a><span id="l73.17">   let scenarioFactory = new MessageScenarioFactory(messageGenerator);</span>
<a href="#l73.18"></a><span id="l73.18"> </span>
<a href="#l73.19"></a><span id="l73.19">   messages = messages.concat(scenarioFactory.directReply(2));</span>
<a href="#l73.20"></a><span id="l73.20">   let dataUri = Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l73.21"></a><span id="l73.21">                                    btoa(messages[0].toMessageString()),</span>
<a href="#l73.22"></a><span id="l73.22" class="difflineat">@@ -91,17 +91,17 @@ function setup() {</span>
<a href="#l73.23"></a><span id="l73.23">   do_print(&quot;Offline store size (before 1st downloadAllForOffline()) = &quot; +</span>
<a href="#l73.24"></a><span id="l73.24">            gOfflineStoreSize);</span>
<a href="#l73.25"></a><span id="l73.25"> </span>
<a href="#l73.26"></a><span id="l73.26">   // Download for offline use, to append created messages to local IMAP inbox.</span>
<a href="#l73.27"></a><span id="l73.27">   IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l73.28"></a><span id="l73.28">   yield false;</span>
<a href="#l73.29"></a><span id="l73.29"> }</span>
<a href="#l73.30"></a><span id="l73.30"> </span>
<a href="#l73.31"></a><span id="l73.31" class="difflineminus">-function check_result() {</span>
<a href="#l73.32"></a><span id="l73.32" class="difflineplus">+function* check_result() {</span>
<a href="#l73.33"></a><span id="l73.33">   // Call downloadAllForOffline() a second time.</span>
<a href="#l73.34"></a><span id="l73.34">   IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l73.35"></a><span id="l73.35">   yield false;</span>
<a href="#l73.36"></a><span id="l73.36"> </span>
<a href="#l73.37"></a><span id="l73.37">   // Make sure offline store grew (i.e., we were not writing over data).</span>
<a href="#l73.38"></a><span id="l73.38">   let offlineStoreSize = IMAPPump.inbox.filePath.fileSize;</span>
<a href="#l73.39"></a><span id="l73.39">   do_print(&quot;Offline store size (after 2nd downloadAllForOffline()) = &quot; +</span>
<a href="#l73.40"></a><span id="l73.40">            offlineStoreSize + &quot;. (Msg hdr offsets should be close to it.)&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_listClosesDB.js</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_listClosesDB.js</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -9,17 +9,17 @@ var gSub3;</span>
<a href="#l74.4"></a><span id="l74.4"> </span>
<a href="#l74.5"></a><span id="l74.5"> var tests = [</span>
<a href="#l74.6"></a><span id="l74.6">   setup,</span>
<a href="#l74.7"></a><span id="l74.7">   updateInbox,</span>
<a href="#l74.8"></a><span id="l74.8">   checkCachedDBForFolder,</span>
<a href="#l74.9"></a><span id="l74.9">   teardown</span>
<a href="#l74.10"></a><span id="l74.10"> ];</span>
<a href="#l74.11"></a><span id="l74.11"> </span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-function setup() {</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineplus">+function* setup() {</span>
<a href="#l74.14"></a><span id="l74.14">   setupIMAPPump();</span>
<a href="#l74.15"></a><span id="l74.15"> </span>
<a href="#l74.16"></a><span id="l74.16">   IMAPPump.daemon.createMailbox(&quot;folder1&quot;, {subscribed : true});</span>
<a href="#l74.17"></a><span id="l74.17">   IMAPPump.daemon.createMailbox(&quot;folder1/sub1&quot;, &quot;&quot;, {subscribed : true});</span>
<a href="#l74.18"></a><span id="l74.18">   IMAPPump.daemon.createMailbox(&quot;folder1/sub1/sub2&quot;, &quot;&quot;, {subscribed : true});</span>
<a href="#l74.19"></a><span id="l74.19">   IMAPPump.daemon.createMailbox(&quot;folder1/sub1/sub2/sub3&quot;, &quot;&quot;, {subscribed : true});</span>
<a href="#l74.20"></a><span id="l74.20"> </span>
<a href="#l74.21"></a><span id="l74.21">   IMAPPump.incomingServer.usingSubscription = false;</span>
<a href="#l74.22"></a><span id="l74.22" class="difflineat">@@ -32,17 +32,17 @@ function setup() {</span>
<a href="#l74.23"></a><span id="l74.23">   rootFolder.addSubfolder(&quot;folder1/sub1/sub2&quot;);</span>
<a href="#l74.24"></a><span id="l74.24">   gSub3 = rootFolder.addSubfolder(&quot;folder1/sub1/sub2/sub3&quot;);</span>
<a href="#l74.25"></a><span id="l74.25">   IMAPPump.server.performTest(&quot;LIST&quot;);</span>
<a href="#l74.26"></a><span id="l74.26"> </span>
<a href="#l74.27"></a><span id="l74.27">   do_timeout(1000, async_driver);</span>
<a href="#l74.28"></a><span id="l74.28">   yield false;</span>
<a href="#l74.29"></a><span id="l74.29"> }</span>
<a href="#l74.30"></a><span id="l74.30"> </span>
<a href="#l74.31"></a><span id="l74.31" class="difflineminus">-function updateInbox() {</span>
<a href="#l74.32"></a><span id="l74.32" class="difflineplus">+function* updateInbox() {</span>
<a href="#l74.33"></a><span id="l74.33">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l74.34"></a><span id="l74.34">   yield false;</span>
<a href="#l74.35"></a><span id="l74.35"> }</span>
<a href="#l74.36"></a><span id="l74.36"> </span>
<a href="#l74.37"></a><span id="l74.37"> function checkCachedDBForFolder() {</span>
<a href="#l74.38"></a><span id="l74.38">   const gDbService = Cc[&quot;@mozilla.org/msgDatabase/msgDBService;1&quot;]</span>
<a href="#l74.39"></a><span id="l74.39">                        .getService(Ci.nsIMsgDBService);</span>
<a href="#l74.40"></a><span id="l74.40">   do_check_eq(gDbService.cachedDBForFolder(gSub3), null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_listSubscribed.js</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_listSubscribed.js</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -32,31 +32,31 @@ setupIMAPPump(&quot;Zimbra&quot;);</span>
<a href="#l75.4"></a><span id="l75.4"> var tests = [</span>
<a href="#l75.5"></a><span id="l75.5">   setupMailboxes,</span>
<a href="#l75.6"></a><span id="l75.6">   testListSubscribed,</span>
<a href="#l75.7"></a><span id="l75.7">   testZimbraServerVersions,</span>
<a href="#l75.8"></a><span id="l75.8">   endTest</span>
<a href="#l75.9"></a><span id="l75.9"> ]</span>
<a href="#l75.10"></a><span id="l75.10"> </span>
<a href="#l75.11"></a><span id="l75.11"> // setup the mailboxes that will be used for this test</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-function setupMailboxes()</span>
<a href="#l75.13"></a><span id="l75.13" class="difflineplus">+function* setupMailboxes()</span>
<a href="#l75.14"></a><span id="l75.14"> {</span>
<a href="#l75.15"></a><span id="l75.15">   IMAPPump.mailbox.subscribed = true;</span>
<a href="#l75.16"></a><span id="l75.16">   IMAPPump.daemon.createMailbox(&quot;folder1&quot;, {subscribed : true, flags : [&quot;\\Noselect&quot;]});</span>
<a href="#l75.17"></a><span id="l75.17">   IMAPPump.daemon.createMailbox(&quot;folder1/folder11&quot;, {subscribed : true, flags : [&quot;\\Noinferiors&quot;]});</span>
<a href="#l75.18"></a><span id="l75.18">   IMAPPump.daemon.createMailbox(&quot;folder2&quot;, {subscribed : true, nonExistent : true});</span>
<a href="#l75.19"></a><span id="l75.19">   IMAPPump.daemon.createMailbox(&quot;folder3&quot;, {});</span>
<a href="#l75.20"></a><span id="l75.20"> </span>
<a href="#l75.21"></a><span id="l75.21">   // select the inbox to force folder discovery, etc.</span>
<a href="#l75.22"></a><span id="l75.22">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l75.23"></a><span id="l75.23">   yield false;</span>
<a href="#l75.24"></a><span id="l75.24"> }</span>
<a href="#l75.25"></a><span id="l75.25"> </span>
<a href="#l75.26"></a><span id="l75.26"> // tests that LIST (SUBSCRIBED) returns the proper response</span>
<a href="#l75.27"></a><span id="l75.27" class="difflineminus">-function testListSubscribed()</span>
<a href="#l75.28"></a><span id="l75.28" class="difflineplus">+function* testListSubscribed()</span>
<a href="#l75.29"></a><span id="l75.29"> {</span>
<a href="#l75.30"></a><span id="l75.30">   // check that we have \Noselect and \Noinferiors flags - these would not have</span>
<a href="#l75.31"></a><span id="l75.31">   // been returned if we had used LSUB instead of LIST(SUBSCRIBED)</span>
<a href="#l75.32"></a><span id="l75.32">   let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l75.33"></a><span id="l75.33">   let folder1 = rootFolder.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l75.34"></a><span id="l75.34">   do_check_true(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span>
<a href="#l75.35"></a><span id="l75.35">   do_check_false(folder1.getFlag(nsMsgFolderFlags.ImapNoinferiors));</span>
<a href="#l75.36"></a><span id="l75.36"> </span>
<a href="#l75.37"></a><span id="l75.37" class="difflineat">@@ -75,17 +75,17 @@ function testListSubscribed()</span>
<a href="#l75.38"></a><span id="l75.38">     folder3 = rootFolder.getChildNamed(&quot;folder3&quot;);</span>
<a href="#l75.39"></a><span id="l75.39">   } catch (ex) {}</span>
<a href="#l75.40"></a><span id="l75.40">   //do_check_false(folder1.getFlag(nsMsgFolderFlags.Subscribed));</span>
<a href="#l75.41"></a><span id="l75.41">   do_check_null(folder3);</span>
<a href="#l75.42"></a><span id="l75.42"> </span>
<a href="#l75.43"></a><span id="l75.43">   yield true;</span>
<a href="#l75.44"></a><span id="l75.44"> }</span>
<a href="#l75.45"></a><span id="l75.45"> </span>
<a href="#l75.46"></a><span id="l75.46" class="difflineminus">-function testZimbraServerVersions() {</span>
<a href="#l75.47"></a><span id="l75.47" class="difflineplus">+function* testZimbraServerVersions() {</span>
<a href="#l75.48"></a><span id="l75.48">   // older versions of Zimbra can crash if we send LIST (SUBSCRIBED) so we want</span>
<a href="#l75.49"></a><span id="l75.49">   // to make sure that we are checking for versions</span>
<a href="#l75.50"></a><span id="l75.50"> </span>
<a href="#l75.51"></a><span id="l75.51">   let testValues = [ { version : '6.3.1_GA_2790', expectedResult : false },</span>
<a href="#l75.52"></a><span id="l75.52">                      { version : '7.2.2_GA_2790', expectedResult : false },</span>
<a href="#l75.53"></a><span id="l75.53">                      { version : '7.2.3_GA_2790', expectedResult : true },</span>
<a href="#l75.54"></a><span id="l75.54">                      { version : '8.0.2_GA_2790', expectedResult : false },</span>
<a href="#l75.55"></a><span id="l75.55">                      { version : '8.0.3_GA_2790', expectedResult : true },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_localToImapFilter.js</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_localToImapFilter.js</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -18,33 +18,33 @@ var gIMAPTrashFolder;</span>
<a href="#l76.4"></a><span id="l76.4"> var gEmptyLocal1, gEmptyLocal2;</span>
<a href="#l76.5"></a><span id="l76.5"> var gLastKey;</span>
<a href="#l76.6"></a><span id="l76.6"> var gMessages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l76.7"></a><span id="l76.7"> var gFiles = [&quot;../../../data/bugmail1&quot;,</span>
<a href="#l76.8"></a><span id="l76.8">                 &quot;../../../data/draft1&quot;];</span>
<a href="#l76.9"></a><span id="l76.9"> </span>
<a href="#l76.10"></a><span id="l76.10"> var tests = [</span>
<a href="#l76.11"></a><span id="l76.11">   setup,</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineminus">-  function copyFolder1() {</span>
<a href="#l76.13"></a><span id="l76.13" class="difflineplus">+  function* copyFolder1() {</span>
<a href="#l76.14"></a><span id="l76.14">     dump(&quot;gEmpty1 &quot; + gEmptyLocal1.URI + &quot;\n&quot;);</span>
<a href="#l76.15"></a><span id="l76.15">     let folders = new Array;</span>
<a href="#l76.16"></a><span id="l76.16">     folders.push(gEmptyLocal1.QueryInterface(Ci.nsIMsgFolder));</span>
<a href="#l76.17"></a><span id="l76.17">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l76.18"></a><span id="l76.18">     MailServices.copy.CopyFolders(array, IMAPPump.inbox, false, CopyListener, null);</span>
<a href="#l76.19"></a><span id="l76.19">     yield false;</span>
<a href="#l76.20"></a><span id="l76.20">   },</span>
<a href="#l76.21"></a><span id="l76.21" class="difflineminus">-  function copyFolder2() {</span>
<a href="#l76.22"></a><span id="l76.22" class="difflineplus">+  function* copyFolder2() {</span>
<a href="#l76.23"></a><span id="l76.23">     dump(&quot;gEmpty2 &quot; + gEmptyLocal2.URI + &quot;\n&quot;);</span>
<a href="#l76.24"></a><span id="l76.24">     let folders = new Array;</span>
<a href="#l76.25"></a><span id="l76.25">     folders.push(gEmptyLocal2);</span>
<a href="#l76.26"></a><span id="l76.26">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l76.27"></a><span id="l76.27">     MailServices.copy.CopyFolders(array, IMAPPump.inbox, false, CopyListener, null);</span>
<a href="#l76.28"></a><span id="l76.28">     yield false;</span>
<a href="#l76.29"></a><span id="l76.29">   },</span>
<a href="#l76.30"></a><span id="l76.30" class="difflineminus">-  function getLocalMessages() {</span>
<a href="#l76.31"></a><span id="l76.31" class="difflineplus">+  function* getLocalMessages() {</span>
<a href="#l76.32"></a><span id="l76.32">     // setup copy then move mail filters on the inbox</span>
<a href="#l76.33"></a><span id="l76.33">     let filterList = gPOP3Pump.fakeServer.getFilterList(null);</span>
<a href="#l76.34"></a><span id="l76.34">     let filter = filterList.createFilter(&quot;copyThenMoveAll&quot;);</span>
<a href="#l76.35"></a><span id="l76.35">     let searchTerm = filter.createTerm();</span>
<a href="#l76.36"></a><span id="l76.36">     searchTerm.matchAll = true;</span>
<a href="#l76.37"></a><span id="l76.37">     filter.appendTerm(searchTerm);</span>
<a href="#l76.38"></a><span id="l76.38">     let copyAction = filter.createAction();</span>
<a href="#l76.39"></a><span id="l76.39">     copyAction.type = Ci.nsMsgFilterAction.CopyToFolder;</span>
<a href="#l76.40"></a><span id="l76.40" class="difflineat">@@ -57,22 +57,22 @@ var tests = [</span>
<a href="#l76.41"></a><span id="l76.41">     filter.enabled = true;</span>
<a href="#l76.42"></a><span id="l76.42">     filterList.insertFilterAt(0, filter);</span>
<a href="#l76.43"></a><span id="l76.43"> </span>
<a href="#l76.44"></a><span id="l76.44">     gPOP3Pump.files = gFiles;</span>
<a href="#l76.45"></a><span id="l76.45">     gPOP3Pump.onDone = async_driver;</span>
<a href="#l76.46"></a><span id="l76.46">     gPOP3Pump.run();</span>
<a href="#l76.47"></a><span id="l76.47">     yield false;</span>
<a href="#l76.48"></a><span id="l76.48">   },</span>
<a href="#l76.49"></a><span id="l76.49" class="difflineminus">-  function update1() {</span>
<a href="#l76.50"></a><span id="l76.50" class="difflineplus">+  function* update1() {</span>
<a href="#l76.51"></a><span id="l76.51">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;).QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l76.52"></a><span id="l76.52">     folder1.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l76.53"></a><span id="l76.53">     yield false;</span>
<a href="#l76.54"></a><span id="l76.54">   },</span>
<a href="#l76.55"></a><span id="l76.55" class="difflineminus">-  function update2() {</span>
<a href="#l76.56"></a><span id="l76.56" class="difflineplus">+  function* update2() {</span>
<a href="#l76.57"></a><span id="l76.57">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;).QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l76.58"></a><span id="l76.58">     folder2.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l76.59"></a><span id="l76.59">     yield false;</span>
<a href="#l76.60"></a><span id="l76.60">   },</span>
<a href="#l76.61"></a><span id="l76.61">   function verifyFolders() {</span>
<a href="#l76.62"></a><span id="l76.62">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l76.63"></a><span id="l76.63">     listMessages(folder1);</span>
<a href="#l76.64"></a><span id="l76.64">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -34,29 +34,29 @@ var quarantineTests = [</span>
<a href="#l77.4"></a><span id="l77.4">   createSubfolder,</span>
<a href="#l77.5"></a><span id="l77.5">   getLocalMessages,</span>
<a href="#l77.6"></a><span id="l77.6">   updateSubfolderAndTest,</span>
<a href="#l77.7"></a><span id="l77.7">   get2Messages,</span>
<a href="#l77.8"></a><span id="l77.8">   updateSubfolderAndTest2,</span>
<a href="#l77.9"></a><span id="l77.9">   endTest</span>
<a href="#l77.10"></a><span id="l77.10"> ];</span>
<a href="#l77.11"></a><span id="l77.11"> </span>
<a href="#l77.12"></a><span id="l77.12" class="difflineminus">-function createSubfolder()</span>
<a href="#l77.13"></a><span id="l77.13" class="difflineplus">+function* createSubfolder()</span>
<a href="#l77.14"></a><span id="l77.14"> {</span>
<a href="#l77.15"></a><span id="l77.15">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;subfolder&quot;, null);</span>
<a href="#l77.16"></a><span id="l77.16">   dl('wait for folderAdded notification');</span>
<a href="#l77.17"></a><span id="l77.17">   yield false;</span>
<a href="#l77.18"></a><span id="l77.18">   gSubfolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;subfolder&quot;);</span>
<a href="#l77.19"></a><span id="l77.19">   do_check_true(gSubfolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l77.20"></a><span id="l77.20">   gSubfolder.updateFolderWithListener(null, urlListener);</span>
<a href="#l77.21"></a><span id="l77.21">   dl('wait for OnStopRunningURL');</span>
<a href="#l77.22"></a><span id="l77.22">   yield false;</span>
<a href="#l77.23"></a><span id="l77.23"> }</span>
<a href="#l77.24"></a><span id="l77.24"> </span>
<a href="#l77.25"></a><span id="l77.25" class="difflineminus">-function getLocalMessages() {</span>
<a href="#l77.26"></a><span id="l77.26" class="difflineplus">+function* getLocalMessages() {</span>
<a href="#l77.27"></a><span id="l77.27">   // setup copy then move mail filters on the inbox</span>
<a href="#l77.28"></a><span id="l77.28">   let filterList = gPOP3Pump.fakeServer.getFilterList(null);</span>
<a href="#l77.29"></a><span id="l77.29">   let filter = filterList.createFilter(&quot;copyThenMoveAll&quot;);</span>
<a href="#l77.30"></a><span id="l77.30">   let searchTerm = filter.createTerm();</span>
<a href="#l77.31"></a><span id="l77.31">   searchTerm.matchAll = true;</span>
<a href="#l77.32"></a><span id="l77.32">   filter.appendTerm(searchTerm);</span>
<a href="#l77.33"></a><span id="l77.33">   let copyAction = filter.createAction();</span>
<a href="#l77.34"></a><span id="l77.34">   copyAction.type = Ci.nsMsgFilterAction.CopyToFolder;</span>
<a href="#l77.35"></a><span id="l77.35" class="difflineat">@@ -81,17 +81,17 @@ function checkResult() {</span>
<a href="#l77.36"></a><span id="l77.36">   else if (gFinishedRunningURL == 0) {</span>
<a href="#l77.37"></a><span id="l77.37">     gSubfolder.updateFolderWithListener(null, urlListener);</span>
<a href="#l77.38"></a><span id="l77.38">     do_timeout(100, checkResult);</span>
<a href="#l77.39"></a><span id="l77.39">     return;</span>
<a href="#l77.40"></a><span id="l77.40">   }</span>
<a href="#l77.41"></a><span id="l77.41">   // Else just ignore it.</span>
<a href="#l77.42"></a><span id="l77.42"> }</span>
<a href="#l77.43"></a><span id="l77.43"> </span>
<a href="#l77.44"></a><span id="l77.44" class="difflineminus">-function updateSubfolderAndTest() {</span>
<a href="#l77.45"></a><span id="l77.45" class="difflineplus">+function* updateSubfolderAndTest() {</span>
<a href="#l77.46"></a><span id="l77.46">   // The previous function does an append, which may take a bit of time to</span>
<a href="#l77.47"></a><span id="l77.47">   // complete. Unfortunately updateFolderWithListener succeeds successfully</span>
<a href="#l77.48"></a><span id="l77.48">   // if there is a url running, but doesn't tell us that is the case. So we</span>
<a href="#l77.49"></a><span id="l77.49">   // have to run updateFolderWithListener several times to actually find out</span>
<a href="#l77.50"></a><span id="l77.50">   // when we are done.</span>
<a href="#l77.51"></a><span id="l77.51">   gFinishedRunningURL = 0;</span>
<a href="#l77.52"></a><span id="l77.52">   gSubfolder.updateFolderWithListener(null, urlListener);</span>
<a href="#l77.53"></a><span id="l77.53">   dl('wait for OnStopRunningURL');</span>
<a href="#l77.54"></a><span id="l77.54" class="difflineat">@@ -104,27 +104,27 @@ function updateSubfolderAndTest() {</span>
<a href="#l77.55"></a><span id="l77.55"> </span>
<a href="#l77.56"></a><span id="l77.56">   // test</span>
<a href="#l77.57"></a><span id="l77.57">   listMessages(gSubfolder);</span>
<a href="#l77.58"></a><span id="l77.58">   listMessages(localAccountUtils.inboxFolder);</span>
<a href="#l77.59"></a><span id="l77.59">   do_check_eq(folderCount(gSubfolder), 1);</span>
<a href="#l77.60"></a><span id="l77.60">   do_check_eq(folderCount(localAccountUtils.inboxFolder), 1);</span>
<a href="#l77.61"></a><span id="l77.61"> }</span>
<a href="#l77.62"></a><span id="l77.62"> </span>
<a href="#l77.63"></a><span id="l77.63" class="difflineminus">-function get2Messages()</span>
<a href="#l77.64"></a><span id="l77.64" class="difflineplus">+function* get2Messages()</span>
<a href="#l77.65"></a><span id="l77.65"> {</span>
<a href="#l77.66"></a><span id="l77.66">   gPOP3Pump.files = [&quot;../../../data/bugmail10&quot;,</span>
<a href="#l77.67"></a><span id="l77.67">                      &quot;../../../data/draft1&quot;];</span>
<a href="#l77.68"></a><span id="l77.68">   gPOP3Pump.onDone = function() {dump('POP3Pump done\n');async_driver();};</span>
<a href="#l77.69"></a><span id="l77.69">   gPOP3Pump.run();</span>
<a href="#l77.70"></a><span id="l77.70">   dl('waiting for POP3Pump done');</span>
<a href="#l77.71"></a><span id="l77.71">   yield false;</span>
<a href="#l77.72"></a><span id="l77.72"> }</span>
<a href="#l77.73"></a><span id="l77.73"> </span>
<a href="#l77.74"></a><span id="l77.74" class="difflineminus">-function updateSubfolderAndTest2() {</span>
<a href="#l77.75"></a><span id="l77.75" class="difflineplus">+function* updateSubfolderAndTest2() {</span>
<a href="#l77.76"></a><span id="l77.76">   // The previous function does an append, which may take a bit of time to</span>
<a href="#l77.77"></a><span id="l77.77">   // complete. Unfortunately updateFolderWithListener succeeds successfully</span>
<a href="#l77.78"></a><span id="l77.78">   // if there is a url running, but doesn't tell us that is the case. So we</span>
<a href="#l77.79"></a><span id="l77.79">   // have to run updateFolderWithListener several times to actually find out</span>
<a href="#l77.80"></a><span id="l77.80">   // when we are done.</span>
<a href="#l77.81"></a><span id="l77.81">   gFinishedRunningURL = 0;</span>
<a href="#l77.82"></a><span id="l77.82">   gSubfolder.updateFolderWithListener(null, urlListener);</span>
<a href="#l77.83"></a><span id="l77.83">   dl('wait for OnStopRunningURL');</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_lsub.js</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_lsub.js</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -24,31 +24,31 @@ setupIMAPPump();</span>
<a href="#l78.4"></a><span id="l78.4"> // Definition of tests</span>
<a href="#l78.5"></a><span id="l78.5"> var tests = [</span>
<a href="#l78.6"></a><span id="l78.6">   setupMailboxes,</span>
<a href="#l78.7"></a><span id="l78.7">   testLsub,</span>
<a href="#l78.8"></a><span id="l78.8">   endTest</span>
<a href="#l78.9"></a><span id="l78.9"> ]</span>
<a href="#l78.10"></a><span id="l78.10"> </span>
<a href="#l78.11"></a><span id="l78.11"> // setup the mailboxes that will be used for this test</span>
<a href="#l78.12"></a><span id="l78.12" class="difflineminus">-function setupMailboxes()</span>
<a href="#l78.13"></a><span id="l78.13" class="difflineplus">+function* setupMailboxes()</span>
<a href="#l78.14"></a><span id="l78.14"> {</span>
<a href="#l78.15"></a><span id="l78.15">   IMAPPump.mailbox.subscribed = true;</span>
<a href="#l78.16"></a><span id="l78.16">   IMAPPump.daemon.createMailbox(&quot;folder1&quot;, {subscribed : true, flags : [&quot;\\Noselect&quot;]});</span>
<a href="#l78.17"></a><span id="l78.17">   IMAPPump.daemon.createMailbox(&quot;folder1/folder11&quot;, {subscribed : true, flags : [&quot;\\Noinferiors&quot;]});</span>
<a href="#l78.18"></a><span id="l78.18">   IMAPPump.daemon.createMailbox(&quot;folder2&quot;, {subscribed : true, nonExistent : true});</span>
<a href="#l78.19"></a><span id="l78.19">   IMAPPump.daemon.createMailbox(&quot;folder3&quot;, {});</span>
<a href="#l78.20"></a><span id="l78.20"> </span>
<a href="#l78.21"></a><span id="l78.21">   // select the inbox to force folder discovery, etc.</span>
<a href="#l78.22"></a><span id="l78.22">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l78.23"></a><span id="l78.23">   yield false;</span>
<a href="#l78.24"></a><span id="l78.24"> }</span>
<a href="#l78.25"></a><span id="l78.25"> </span>
<a href="#l78.26"></a><span id="l78.26"> // tests that LSUB returns the proper response</span>
<a href="#l78.27"></a><span id="l78.27" class="difflineminus">-function testLsub()</span>
<a href="#l78.28"></a><span id="l78.28" class="difflineplus">+function* testLsub()</span>
<a href="#l78.29"></a><span id="l78.29"> {</span>
<a href="#l78.30"></a><span id="l78.30">   let nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l78.31"></a><span id="l78.31"> </span>
<a href="#l78.32"></a><span id="l78.32">   // check that we have \Noselect and \Noinferiors flags - these would not have</span>
<a href="#l78.33"></a><span id="l78.33">   // been returned if we had used LSUB instead of LIST(SUBSCRIBED)</span>
<a href="#l78.34"></a><span id="l78.34">   let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l78.35"></a><span id="l78.35">   let folder1 = rootFolder.getChildNamed(&quot;folder1&quot;);</span>
<a href="#l78.36"></a><span id="l78.36">   do_check_true(folder1.getFlag(nsMsgFolderFlags.ImapNoselect));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_mailboxes.js</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_mailboxes.js</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l79.4"></a><span id="l79.4"> /**</span>
<a href="#l79.5"></a><span id="l79.5">  * Tests basic mailbox handling of IMAP, like discovery, rename and empty folder.</span>
<a href="#l79.6"></a><span id="l79.6">  */</span>
<a href="#l79.7"></a><span id="l79.7"> </span>
<a href="#l79.8"></a><span id="l79.8"> load(&quot;../../../resources/logHelper.js&quot;);</span>
<a href="#l79.9"></a><span id="l79.9"> load(&quot;../../../resources/asyncTestUtils.js&quot;);</span>
<a href="#l79.10"></a><span id="l79.10"> load(&quot;../../../resources/messageGenerator.js&quot;);</span>
<a href="#l79.11"></a><span id="l79.11"> </span>
<a href="#l79.12"></a><span id="l79.12" class="difflineminus">-function setup() {</span>
<a href="#l79.13"></a><span id="l79.13" class="difflineplus">+function* setup() {</span>
<a href="#l79.14"></a><span id="l79.14">   setupIMAPPump();</span>
<a href="#l79.15"></a><span id="l79.15"> </span>
<a href="#l79.16"></a><span id="l79.16">   IMAPPump.daemon.createMailbox(&quot;I18N box\u00E1&quot;, {subscribed : true});</span>
<a href="#l79.17"></a><span id="l79.17">   IMAPPump.daemon.createMailbox(&quot;Unsubscribed box&quot;);</span>
<a href="#l79.18"></a><span id="l79.18">   // Create an all upper case trash folder name to make sure</span>
<a href="#l79.19"></a><span id="l79.19">   // we handle special folder names case-insensitively.</span>
<a href="#l79.20"></a><span id="l79.20">   IMAPPump.daemon.createMailbox(&quot;TRASH&quot;, {subscribed : true});</span>
<a href="#l79.21"></a><span id="l79.21"> </span>
<a href="#l79.22"></a><span id="l79.22" class="difflineat">@@ -19,17 +19,17 @@ function setup() {</span>
<a href="#l79.23"></a><span id="l79.23">   IMAPPump.server.performTest(&quot;LIST&quot;);</span>
<a href="#l79.24"></a><span id="l79.24"> </span>
<a href="#l79.25"></a><span id="l79.25">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l79.26"></a><span id="l79.26">   yield false;</span>
<a href="#l79.27"></a><span id="l79.27"> }</span>
<a href="#l79.28"></a><span id="l79.28"> </span>
<a href="#l79.29"></a><span id="l79.29"> var tests = [</span>
<a href="#l79.30"></a><span id="l79.30">   setup,</span>
<a href="#l79.31"></a><span id="l79.31" class="difflineminus">-  function checkDiscovery() {</span>
<a href="#l79.32"></a><span id="l79.32" class="difflineplus">+  function* checkDiscovery() {</span>
<a href="#l79.33"></a><span id="l79.33">     dump(&quot;in check discovery\n&quot;);</span>
<a href="#l79.34"></a><span id="l79.34">     let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l79.35"></a><span id="l79.35">     // Check that we've subscribed to the boxes returned by LSUB. We also get</span>
<a href="#l79.36"></a><span id="l79.36">     // checking of proper i18n in mailboxes for free here.</span>
<a href="#l79.37"></a><span id="l79.37">     do_check_true(rootFolder.containsChildNamed(&quot;Inbox&quot;));</span>
<a href="#l79.38"></a><span id="l79.38">     do_check_true(rootFolder.containsChildNamed(&quot;TRASH&quot;));</span>
<a href="#l79.39"></a><span id="l79.39">     // Make sure we haven't created an extra &quot;Trash&quot; folder.</span>
<a href="#l79.40"></a><span id="l79.40">     let trashes = rootFolder.getFoldersWithFlags(Ci.nsMsgFolderFlags.Trash);</span>
<a href="#l79.41"></a><span id="l79.41" class="difflineat">@@ -42,17 +42,17 @@ var tests = [</span>
<a href="#l79.42"></a><span id="l79.42">     let i18nChild = rootFolder.getChildNamed(&quot;I18N box\u00E1&quot;);</span>
<a href="#l79.43"></a><span id="l79.43"> </span>
<a href="#l79.44"></a><span id="l79.44">     MailServices.imap.renameLeaf(i18nChild,</span>
<a href="#l79.45"></a><span id="l79.45">                                  &quot;test \u00E4&quot;,</span>
<a href="#l79.46"></a><span id="l79.46">                                  asyncUrlListener,</span>
<a href="#l79.47"></a><span id="l79.47">                                  null);</span>
<a href="#l79.48"></a><span id="l79.48">     yield false;</span>
<a href="#l79.49"></a><span id="l79.49">   },</span>
<a href="#l79.50"></a><span id="l79.50" class="difflineminus">-  function checkRename() {</span>
<a href="#l79.51"></a><span id="l79.51" class="difflineplus">+  function* checkRename() {</span>
<a href="#l79.52"></a><span id="l79.52">     let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l79.53"></a><span id="l79.53">     do_check_true(rootFolder.containsChildNamed(&quot;test \u00E4&quot;));</span>
<a href="#l79.54"></a><span id="l79.54">     let newChild = rootFolder.getChildNamed(&quot;test \u00E4&quot;).</span>
<a href="#l79.55"></a><span id="l79.55">                    QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l79.56"></a><span id="l79.56">     newChild.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l79.57"></a><span id="l79.57">     yield false;</span>
<a href="#l79.58"></a><span id="l79.58">   },</span>
<a href="#l79.59"></a><span id="l79.59">   function checkEmptyFolder() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_offlineDraftDataloss.js</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_offlineDraftDataloss.js</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -27,43 +27,43 @@ var tests = [</span>
<a href="#l80.4"></a><span id="l80.4">   saveDraft,</span>
<a href="#l80.5"></a><span id="l80.5">   goOnline,</span>
<a href="#l80.6"></a><span id="l80.6">   checkResult,</span>
<a href="#l80.7"></a><span id="l80.7">   endTest</span>
<a href="#l80.8"></a><span id="l80.8"> ];</span>
<a href="#l80.9"></a><span id="l80.9"> </span>
<a href="#l80.10"></a><span id="l80.10"> var gDraftsFolder;</span>
<a href="#l80.11"></a><span id="l80.11"> </span>
<a href="#l80.12"></a><span id="l80.12" class="difflineminus">-function createDraftsFolder()</span>
<a href="#l80.13"></a><span id="l80.13" class="difflineplus">+function* createDraftsFolder()</span>
<a href="#l80.14"></a><span id="l80.14"> {</span>
<a href="#l80.15"></a><span id="l80.15">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;Drafts&quot;, null);</span>
<a href="#l80.16"></a><span id="l80.16">   yield false;</span>
<a href="#l80.17"></a><span id="l80.17">   gDraftsFolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;Drafts&quot;);</span>
<a href="#l80.18"></a><span id="l80.18">   do_check_true(gDraftsFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l80.19"></a><span id="l80.19">   gDraftsFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l80.20"></a><span id="l80.20">   yield false;</span>
<a href="#l80.21"></a><span id="l80.21"> }</span>
<a href="#l80.22"></a><span id="l80.22" class="difflineminus">-function goOffline()</span>
<a href="#l80.23"></a><span id="l80.23" class="difflineplus">+function* goOffline()</span>
<a href="#l80.24"></a><span id="l80.24"> {</span>
<a href="#l80.25"></a><span id="l80.25">   // Don't prompt about offline download when going offline</span>
<a href="#l80.26"></a><span id="l80.26">   Services.prefs.setIntPref(&quot;offline.download.download_messages&quot;, 2);</span>
<a href="#l80.27"></a><span id="l80.27"> </span>
<a href="#l80.28"></a><span id="l80.28">   IMAPPump.incomingServer.closeCachedConnections();</span>
<a href="#l80.29"></a><span id="l80.29">   let thread = gThreadManager.currentThread;</span>
<a href="#l80.30"></a><span id="l80.30">   while (thread.hasPendingEvents())</span>
<a href="#l80.31"></a><span id="l80.31">     thread.processNextEvent(true);</span>
<a href="#l80.32"></a><span id="l80.32"> </span>
<a href="#l80.33"></a><span id="l80.33">   do_timeout(2000, async_driver);</span>
<a href="#l80.34"></a><span id="l80.34">   yield false;</span>
<a href="#l80.35"></a><span id="l80.35"> </span>
<a href="#l80.36"></a><span id="l80.36">   IMAPPump.server.stop();</span>
<a href="#l80.37"></a><span id="l80.37">   Services.io.offline = true;</span>
<a href="#l80.38"></a><span id="l80.38"> }</span>
<a href="#l80.39"></a><span id="l80.39"> </span>
<a href="#l80.40"></a><span id="l80.40" class="difflineminus">-function saveDraft()</span>
<a href="#l80.41"></a><span id="l80.41" class="difflineplus">+function* saveDraft()</span>
<a href="#l80.42"></a><span id="l80.42"> {</span>
<a href="#l80.43"></a><span id="l80.43">   let msgCompose = Cc[&quot;@mozilla.org/messengercompose/compose;1&quot;]</span>
<a href="#l80.44"></a><span id="l80.44">                      .createInstance(Ci.nsIMsgCompose);</span>
<a href="#l80.45"></a><span id="l80.45">   let fields = Cc[&quot;@mozilla.org/messengercompose/composefields;1&quot;]</span>
<a href="#l80.46"></a><span id="l80.46">                  .createInstance(Ci.nsIMsgCompFields);</span>
<a href="#l80.47"></a><span id="l80.47">   let params = Cc[&quot;@mozilla.org/messengercompose/composeparams;1&quot;]</span>
<a href="#l80.48"></a><span id="l80.48">                  .createInstance(Ci.nsIMsgComposeParams);</span>
<a href="#l80.49"></a><span id="l80.49">   params.composeFields = fields;</span>
<a href="#l80.50"></a><span id="l80.50" class="difflineat">@@ -78,17 +78,17 @@ function saveDraft()</span>
<a href="#l80.51"></a><span id="l80.51">   progress.registerListener(progressListener);</span>
<a href="#l80.52"></a><span id="l80.52">   msgCompose.SendMsg(Ci.nsIMsgSend.nsMsgSaveAsDraft, identity, &quot;&quot;, null,</span>
<a href="#l80.53"></a><span id="l80.53">                      progress);</span>
<a href="#l80.54"></a><span id="l80.54">   yield false;</span>
<a href="#l80.55"></a><span id="l80.55">   // verify that message is not on the server yet</span>
<a href="#l80.56"></a><span id="l80.56">   do_check_eq(IMAPPump.daemon.getMailbox(&quot;Drafts&quot;)._messages.length, 0);</span>
<a href="#l80.57"></a><span id="l80.57"> }</span>
<a href="#l80.58"></a><span id="l80.58"> </span>
<a href="#l80.59"></a><span id="l80.59" class="difflineminus">-function goOnline()</span>
<a href="#l80.60"></a><span id="l80.60" class="difflineplus">+function* goOnline()</span>
<a href="#l80.61"></a><span id="l80.61"> {</span>
<a href="#l80.62"></a><span id="l80.62">   let offlineManager = Cc[&quot;@mozilla.org/messenger/offline-manager;1&quot;]</span>
<a href="#l80.63"></a><span id="l80.63">                        .getService(Ci.nsIMsgOfflineManager);</span>
<a href="#l80.64"></a><span id="l80.64">   IMAPPump.daemon.closing = false;</span>
<a href="#l80.65"></a><span id="l80.65">   Services.io.offline = false;</span>
<a href="#l80.66"></a><span id="l80.66"> </span>
<a href="#l80.67"></a><span id="l80.67">   IMAPPump.server.start();</span>
<a href="#l80.68"></a><span id="l80.68">   offlineManager.inProgress = true;</span>
<a href="#l80.69"></a><span id="l80.69" class="difflineat">@@ -98,24 +98,24 @@ function goOnline()</span>
<a href="#l80.70"></a><span id="l80.70">       do_timeout(250, waitForNotInProgress);</span>
<a href="#l80.71"></a><span id="l80.71">     else</span>
<a href="#l80.72"></a><span id="l80.72">       async_driver();</span>
<a href="#l80.73"></a><span id="l80.73">   }</span>
<a href="#l80.74"></a><span id="l80.74">   waitForNotInProgress();</span>
<a href="#l80.75"></a><span id="l80.75">   yield false;</span>
<a href="#l80.76"></a><span id="l80.76"> }</span>
<a href="#l80.77"></a><span id="l80.77"> </span>
<a href="#l80.78"></a><span id="l80.78" class="difflineminus">-function checkResult()</span>
<a href="#l80.79"></a><span id="l80.79" class="difflineplus">+function* checkResult()</span>
<a href="#l80.80"></a><span id="l80.80"> {</span>
<a href="#l80.81"></a><span id="l80.81">   // verify that message is now on the server</span>
<a href="#l80.82"></a><span id="l80.82">   do_check_eq(IMAPPump.daemon.getMailbox(&quot;Drafts&quot;)._messages.length, 1);</span>
<a href="#l80.83"></a><span id="l80.83">   yield true;</span>
<a href="#l80.84"></a><span id="l80.84"> }</span>
<a href="#l80.85"></a><span id="l80.85"> </span>
<a href="#l80.86"></a><span id="l80.86" class="difflineminus">-function endTest()</span>
<a href="#l80.87"></a><span id="l80.87" class="difflineplus">+function* endTest()</span>
<a href="#l80.88"></a><span id="l80.88"> {</span>
<a href="#l80.89"></a><span id="l80.89">   teardownIMAPPump();</span>
<a href="#l80.90"></a><span id="l80.90">   yield true;</span>
<a href="#l80.91"></a><span id="l80.91"> }</span>
<a href="#l80.92"></a><span id="l80.92"> </span>
<a href="#l80.93"></a><span id="l80.93"> function run_test()</span>
<a href="#l80.94"></a><span id="l80.94"> {</span>
<a href="#l80.95"></a><span id="l80.95">   Services.prefs.setBoolPref(&quot;mail.server.default.autosync_offline_stores&quot;, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_offlineStoreLocking.js</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_offlineStoreLocking.js</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -56,31 +56,31 @@ function checkOfflineStore(prevOfflineSt</span>
<a href="#l81.4"></a><span id="l81.4">   }</span>
<a href="#l81.5"></a><span id="l81.5">   // check that the offline store shrunk by at least 100 bytes.</span>
<a href="#l81.6"></a><span id="l81.6">   // (exact calculation might be fragile).</span>
<a href="#l81.7"></a><span id="l81.7">   do_check_true(prevOfflineStoreSize &gt; IMAPPump.inbox.filePath.fileSize + 100);</span>
<a href="#l81.8"></a><span id="l81.8"> }</span>
<a href="#l81.9"></a><span id="l81.9"> </span>
<a href="#l81.10"></a><span id="l81.10"> var tests = [</span>
<a href="#l81.11"></a><span id="l81.11">   setup,</span>
<a href="#l81.12"></a><span id="l81.12" class="difflineminus">-  function downloadForOffline() {</span>
<a href="#l81.13"></a><span id="l81.13" class="difflineplus">+  function* downloadForOffline() {</span>
<a href="#l81.14"></a><span id="l81.14">     // ...and download for offline use.</span>
<a href="#l81.15"></a><span id="l81.15">     dump(&quot;Downloading for offline use\n&quot;);</span>
<a href="#l81.16"></a><span id="l81.16">     IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l81.17"></a><span id="l81.17">     yield false;</span>
<a href="#l81.18"></a><span id="l81.18">   },</span>
<a href="#l81.19"></a><span id="l81.19" class="difflineminus">-  function deleteOneMsg() {</span>
<a href="#l81.20"></a><span id="l81.20" class="difflineplus">+  function* deleteOneMsg() {</span>
<a href="#l81.21"></a><span id="l81.21">     let enumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l81.22"></a><span id="l81.22">     let msgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l81.23"></a><span id="l81.23">     let array = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l81.24"></a><span id="l81.24">     array.appendElement(msgHdr, false);</span>
<a href="#l81.25"></a><span id="l81.25">     IMAPPump.inbox.deleteMessages(array, null, false, true, CopyListener, false);</span>
<a href="#l81.26"></a><span id="l81.26">     yield false;</span>
<a href="#l81.27"></a><span id="l81.27">   },</span>
<a href="#l81.28"></a><span id="l81.28" class="difflineminus">-  function compactOneFolder() {</span>
<a href="#l81.29"></a><span id="l81.29" class="difflineplus">+  function* compactOneFolder() {</span>
<a href="#l81.30"></a><span id="l81.30">     let enumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l81.31"></a><span id="l81.31">     let msgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l81.32"></a><span id="l81.32">     gStreamedHdr = msgHdr;</span>
<a href="#l81.33"></a><span id="l81.33">     // mark the message as not being offline, and then we'll make sure that</span>
<a href="#l81.34"></a><span id="l81.34">     // streaming the message while we're compacting doesn't result in the</span>
<a href="#l81.35"></a><span id="l81.35">     // message being marked for offline use.</span>
<a href="#l81.36"></a><span id="l81.36">     // Luckily, compaction compacts the offline store first, so it should</span>
<a href="#l81.37"></a><span id="l81.37">     // lock the offline store.</span>
<a href="#l81.38"></a><span id="l81.38" class="difflineat">@@ -98,32 +98,32 @@ var tests = [</span>
<a href="#l81.39"></a><span id="l81.39">     yield false;</span>
<a href="#l81.40"></a><span id="l81.40"> </span>
<a href="#l81.41"></a><span id="l81.41">     // Because we're streaming the message while compaction is going on,</span>
<a href="#l81.42"></a><span id="l81.42">     // we should not have stored it for offline use.</span>
<a href="#l81.43"></a><span id="l81.43">     do_check_false(gStreamedHdr.flags &amp; Ci.nsMsgMessageFlags.Offline);</span>
<a href="#l81.44"></a><span id="l81.44"> </span>
<a href="#l81.45"></a><span id="l81.45">     yield false;</span>
<a href="#l81.46"></a><span id="l81.46">   },</span>
<a href="#l81.47"></a><span id="l81.47" class="difflineminus">-  function deleteAnOtherMsg() {</span>
<a href="#l81.48"></a><span id="l81.48" class="difflineplus">+  function* deleteAnOtherMsg() {</span>
<a href="#l81.49"></a><span id="l81.49">     let enumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l81.50"></a><span id="l81.50">     let msgHdr = enumerator.getNext();</span>
<a href="#l81.51"></a><span id="l81.51">     let array = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l81.52"></a><span id="l81.52">     array.appendElement(msgHdr, false);</span>
<a href="#l81.53"></a><span id="l81.53">     IMAPPump.inbox.deleteMessages(array, null, false, true, CopyListener, false);</span>
<a href="#l81.54"></a><span id="l81.54">     yield false;</span>
<a href="#l81.55"></a><span id="l81.55">   },</span>
<a href="#l81.56"></a><span id="l81.56" class="difflineminus">-  function updateTrash() {</span>
<a href="#l81.57"></a><span id="l81.57" class="difflineplus">+  function* updateTrash() {</span>
<a href="#l81.58"></a><span id="l81.58">     gIMAPTrashFolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;Trash&quot;)</span>
<a href="#l81.59"></a><span id="l81.59">                          .QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l81.60"></a><span id="l81.60">     // hack to force uid validity to get initialized for trash.</span>
<a href="#l81.61"></a><span id="l81.61">     gIMAPTrashFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l81.62"></a><span id="l81.62">     yield false;</span>
<a href="#l81.63"></a><span id="l81.63">   },</span>
<a href="#l81.64"></a><span id="l81.64" class="difflineminus">-  function downloadTrashForOffline() {</span>
<a href="#l81.65"></a><span id="l81.65" class="difflineplus">+  function* downloadTrashForOffline() {</span>
<a href="#l81.66"></a><span id="l81.66">     // ...and download for offline use.</span>
<a href="#l81.67"></a><span id="l81.67">     dump(&quot;Downloading for offline use\n&quot;);</span>
<a href="#l81.68"></a><span id="l81.68">     gIMAPTrashFolder.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l81.69"></a><span id="l81.69">     yield false;</span>
<a href="#l81.70"></a><span id="l81.70">   },</span>
<a href="#l81.71"></a><span id="l81.71">   function testOfflineBodyCopy() {</span>
<a href="#l81.72"></a><span id="l81.72">     // In order to check that offline copy of messages doesn't try to copy</span>
<a href="#l81.73"></a><span id="l81.73">     // the body if the offline store is locked, we're going to go offline.</span>
<a href="#l81.74"></a><span id="l81.74" class="difflineat">@@ -136,17 +136,17 @@ var tests = [</span>
<a href="#l81.75"></a><span id="l81.75">     let msgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l81.76"></a><span id="l81.76">     gMovedMsgId = msgHdr.messageId;</span>
<a href="#l81.77"></a><span id="l81.77">     let array = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l81.78"></a><span id="l81.78">     array.appendElement(msgHdr, false);</span>
<a href="#l81.79"></a><span id="l81.79">     IMAPPump.inbox.compact(asyncUrlListener, gDummyMsgWindow);</span>
<a href="#l81.80"></a><span id="l81.80">     MailServices.copy.CopyMessages(gIMAPTrashFolder, array, IMAPPump.inbox, true,</span>
<a href="#l81.81"></a><span id="l81.81">                                    CopyListener, null, true);</span>
<a href="#l81.82"></a><span id="l81.82">   },</span>
<a href="#l81.83"></a><span id="l81.83" class="difflineminus">-  function verifyNoOfflineMsg() {</span>
<a href="#l81.84"></a><span id="l81.84" class="difflineplus">+  function* verifyNoOfflineMsg() {</span>
<a href="#l81.85"></a><span id="l81.85">     try {</span>
<a href="#l81.86"></a><span id="l81.86">     let movedMsg = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMovedMsgId);</span>
<a href="#l81.87"></a><span id="l81.87">     do_check_false(movedMsg.flags &amp; Ci.nsMsgMessageFlags.Offline);</span>
<a href="#l81.88"></a><span id="l81.88">     } catch (ex) {dump(ex);}</span>
<a href="#l81.89"></a><span id="l81.89">     yield false;</span>
<a href="#l81.90"></a><span id="l81.90">     yield false;</span>
<a href="#l81.91"></a><span id="l81.91">   },</span>
<a href="#l81.92"></a><span id="l81.92">   teardown</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l82.1"></a><span id="l82.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_partsOnDemand.js</span>
<a href="#l82.2"></a><span id="l82.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_partsOnDemand.js</span>
<a href="#l82.3"></a><span id="l82.3" class="difflineat">@@ -32,29 +32,29 @@ var tests = [</span>
<a href="#l82.4"></a><span id="l82.4">   startMime,</span>
<a href="#l82.5"></a><span id="l82.5">   testAllInlineMessage,</span>
<a href="#l82.6"></a><span id="l82.6">   updateCounts,</span>
<a href="#l82.7"></a><span id="l82.7">   testNotRead,</span>
<a href="#l82.8"></a><span id="l82.8">   endTest</span>
<a href="#l82.9"></a><span id="l82.9"> ]</span>
<a href="#l82.10"></a><span id="l82.10"> </span>
<a href="#l82.11"></a><span id="l82.11"> // make sure we are in the optimal conditions!</span>
<a href="#l82.12"></a><span id="l82.12" class="difflineminus">-function setPrefs() {</span>
<a href="#l82.13"></a><span id="l82.13" class="difflineplus">+function* setPrefs() {</span>
<a href="#l82.14"></a><span id="l82.14">   Services.prefs.setIntPref(&quot;mail.imap.mime_parts_on_demand_threshold&quot;, 20);</span>
<a href="#l82.15"></a><span id="l82.15">   Services.prefs.setBoolPref(&quot;mail.imap.mime_parts_on_demand&quot;, true);</span>
<a href="#l82.16"></a><span id="l82.16">   Services.prefs.setBoolPref(&quot;mail.server.server1.autosync_offline_stores&quot;, false);</span>
<a href="#l82.17"></a><span id="l82.17">   Services.prefs.setBoolPref(&quot;mail.server.server1.offline_download&quot;, false);</span>
<a href="#l82.18"></a><span id="l82.18">   Services.prefs.setBoolPref(&quot;mail.server.server1.download_on_biff&quot;, false);</span>
<a href="#l82.19"></a><span id="l82.19">   Services.prefs.setIntPref(&quot;browser.cache.disk.capacity&quot;, 0);</span>
<a href="#l82.20"></a><span id="l82.20"> </span>
<a href="#l82.21"></a><span id="l82.21">   yield true;</span>
<a href="#l82.22"></a><span id="l82.22"> }</span>
<a href="#l82.23"></a><span id="l82.23"> </span>
<a href="#l82.24"></a><span id="l82.24"> // load and update a message in the imap fake server</span>
<a href="#l82.25"></a><span id="l82.25" class="difflineminus">-function loadImapMessage()</span>
<a href="#l82.26"></a><span id="l82.26" class="difflineplus">+function* loadImapMessage()</span>
<a href="#l82.27"></a><span id="l82.27"> {</span>
<a href="#l82.28"></a><span id="l82.28">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l82.29"></a><span id="l82.29"> </span>
<a href="#l82.30"></a><span id="l82.30">   let file = do_get_file(&quot;../../../data/bodystructuretest1&quot;);</span>
<a href="#l82.31"></a><span id="l82.31">   let msgURI = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l82.32"></a><span id="l82.32"> </span>
<a href="#l82.33"></a><span id="l82.33">   let imapInbox = IMAPPump.daemon.getMailbox(&quot;INBOX&quot;);</span>
<a href="#l82.34"></a><span id="l82.34">   let message = new imapMessage(msgURI.spec, imapInbox.uidnext++, []);</span>
<a href="#l82.35"></a><span id="l82.35" class="difflineat">@@ -71,58 +71,58 @@ function loadImapMessage()</span>
<a href="#l82.36"></a><span id="l82.36"> </span>
<a href="#l82.37"></a><span id="l82.37">   do_check_eq(2, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l82.38"></a><span id="l82.38">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l82.39"></a><span id="l82.39">   do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l82.40"></a><span id="l82.40">   yield true;</span>
<a href="#l82.41"></a><span id="l82.41"> }</span>
<a href="#l82.42"></a><span id="l82.42"> </span>
<a href="#l82.43"></a><span id="l82.43"> // process the message through mime</span>
<a href="#l82.44"></a><span id="l82.44" class="difflineminus">-function startMime()</span>
<a href="#l82.45"></a><span id="l82.45" class="difflineplus">+function* startMime()</span>
<a href="#l82.46"></a><span id="l82.46"> {</span>
<a href="#l82.47"></a><span id="l82.47">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l82.48"></a><span id="l82.48"> </span>
<a href="#l82.49"></a><span id="l82.49">   mimeMsg.MsgHdrToMimeMessage(msgHdr, this, function (aMsgHdr, aMimeMessage) {</span>
<a href="#l82.50"></a><span id="l82.50">     let url = aMimeMessage.allUserAttachments[0].url;</span>
<a href="#l82.51"></a><span id="l82.51">     // A URL containing this string indicates that the attachment will be</span>
<a href="#l82.52"></a><span id="l82.52">     // downloaded on demand.</span>
<a href="#l82.53"></a><span id="l82.53">     do_check_true(url.includes(&quot;/;section=&quot;));</span>
<a href="#l82.54"></a><span id="l82.54">     async_driver();</span>
<a href="#l82.55"></a><span id="l82.55">   }, true /* allowDownload */, { partsOnDemand: true, examineEncryptedParts: true });</span>
<a href="#l82.56"></a><span id="l82.56">   yield false;</span>
<a href="#l82.57"></a><span id="l82.57"> }</span>
<a href="#l82.58"></a><span id="l82.58"> </span>
<a href="#l82.59"></a><span id="l82.59"> // test that we don't mark all inline messages as read.</span>
<a href="#l82.60"></a><span id="l82.60" class="difflineminus">-function testAllInlineMessage()</span>
<a href="#l82.61"></a><span id="l82.61" class="difflineplus">+function* testAllInlineMessage()</span>
<a href="#l82.62"></a><span id="l82.62"> {</span>
<a href="#l82.63"></a><span id="l82.63">   let enumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l82.64"></a><span id="l82.64"> </span>
<a href="#l82.65"></a><span id="l82.65">   if (enumerator.hasMoreElements())</span>
<a href="#l82.66"></a><span id="l82.66">   {</span>
<a href="#l82.67"></a><span id="l82.67">     gSecondMsg = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l82.68"></a><span id="l82.68">     mimeMsg.MsgHdrToMimeMessage(gSecondMsg, this, function (aMsgHdr, aMimeMessage) {</span>
<a href="#l82.69"></a><span id="l82.69">       async_driver();</span>
<a href="#l82.70"></a><span id="l82.70">     }, true /* allowDownload */, { partsOnDemand: true });</span>
<a href="#l82.71"></a><span id="l82.71">     yield false;</span>
<a href="#l82.72"></a><span id="l82.72">   }</span>
<a href="#l82.73"></a><span id="l82.73"> }</span>
<a href="#l82.74"></a><span id="l82.74"> </span>
<a href="#l82.75"></a><span id="l82.75" class="difflineminus">-function updateCounts()</span>
<a href="#l82.76"></a><span id="l82.76" class="difflineplus">+function* updateCounts()</span>
<a href="#l82.77"></a><span id="l82.77"> {</span>
<a href="#l82.78"></a><span id="l82.78">   // select the trash, then the inbox again, to force an update of the </span>
<a href="#l82.79"></a><span id="l82.79">   // read state of messages.</span>
<a href="#l82.80"></a><span id="l82.80">   let trash = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;Trash&quot;);</span>
<a href="#l82.81"></a><span id="l82.81">   do_check_true(trash instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l82.82"></a><span id="l82.82">   trash.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l82.83"></a><span id="l82.83">   yield false;</span>
<a href="#l82.84"></a><span id="l82.84">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l82.85"></a><span id="l82.85">   yield false;</span>
<a href="#l82.86"></a><span id="l82.86"> }</span>
<a href="#l82.87"></a><span id="l82.87"> </span>
<a href="#l82.88"></a><span id="l82.88" class="difflineminus">-function testNotRead()</span>
<a href="#l82.89"></a><span id="l82.89" class="difflineplus">+function* testNotRead()</span>
<a href="#l82.90"></a><span id="l82.90"> {</span>
<a href="#l82.91"></a><span id="l82.91">   do_check_eq(2, IMAPPump.inbox.getNumUnread(false));</span>
<a href="#l82.92"></a><span id="l82.92">   yield true;</span>
<a href="#l82.93"></a><span id="l82.93"> }</span>
<a href="#l82.94"></a><span id="l82.94"> </span>
<a href="#l82.95"></a><span id="l82.95"> // Cleanup</span>
<a href="#l82.96"></a><span id="l82.96"> function endTest()</span>
<a href="#l82.97"></a><span id="l82.97"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l83.1"></a><span id="l83.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_preserveDataOnMove.js</span>
<a href="#l83.2"></a><span id="l83.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_preserveDataOnMove.js</span>
<a href="#l83.3"></a><span id="l83.3" class="difflineat">@@ -23,47 +23,47 @@ var tests = [</span>
<a href="#l83.4"></a><span id="l83.4">   createSubfolder,</span>
<a href="#l83.5"></a><span id="l83.5">   loadImapMessage,</span>
<a href="#l83.6"></a><span id="l83.6">   moveMessageToSubfolder,</span>
<a href="#l83.7"></a><span id="l83.7">   testPropertyOnMove,</span>
<a href="#l83.8"></a><span id="l83.8">   endTest</span>
<a href="#l83.9"></a><span id="l83.9"> ]</span>
<a href="#l83.10"></a><span id="l83.10"> </span>
<a href="#l83.11"></a><span id="l83.11"> var gSubfolder;</span>
<a href="#l83.12"></a><span id="l83.12" class="difflineminus">-function createSubfolder()</span>
<a href="#l83.13"></a><span id="l83.13" class="difflineplus">+function* createSubfolder()</span>
<a href="#l83.14"></a><span id="l83.14"> {</span>
<a href="#l83.15"></a><span id="l83.15">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;Subfolder&quot;, null);</span>
<a href="#l83.16"></a><span id="l83.16">   dl('wait for folderAdded notification');</span>
<a href="#l83.17"></a><span id="l83.17" class="difflineminus">-  yield false; </span>
<a href="#l83.18"></a><span id="l83.18" class="difflineplus">+  yield false;</span>
<a href="#l83.19"></a><span id="l83.19">   gSubfolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;Subfolder&quot;);</span>
<a href="#l83.20"></a><span id="l83.20">   do_check_true(gSubfolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l83.21"></a><span id="l83.21">   gSubfolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l83.22"></a><span id="l83.22">   dl('wait for OnStopRunningURL');</span>
<a href="#l83.23"></a><span id="l83.23">   yield false;</span>
<a href="#l83.24"></a><span id="l83.24" class="difflineminus">-}  </span>
<a href="#l83.25"></a><span id="l83.25" class="difflineplus">+}</span>
<a href="#l83.26"></a><span id="l83.26"> </span>
<a href="#l83.27"></a><span id="l83.27"> // load and update a message in the imap fake server</span>
<a href="#l83.28"></a><span id="l83.28" class="difflineminus">-function loadImapMessage()</span>
<a href="#l83.29"></a><span id="l83.29" class="difflineplus">+function* loadImapMessage()</span>
<a href="#l83.30"></a><span id="l83.30"> {</span>
<a href="#l83.31"></a><span id="l83.31">   IMAPPump.mailbox.addMessage(new imapMessage(specForFileName(gMessage),</span>
<a href="#l83.32"></a><span id="l83.32">                           IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l83.33"></a><span id="l83.33">   IMAPPump.inbox.updateFolder(null);</span>
<a href="#l83.34"></a><span id="l83.34">   dl('wait for msgAdded notification');</span>
<a href="#l83.35"></a><span id="l83.35">   yield false;</span>
<a href="#l83.36"></a><span id="l83.36">   do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l83.37"></a><span id="l83.37">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l83.38"></a><span id="l83.38">   do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l83.39"></a><span id="l83.39"> </span>
<a href="#l83.40"></a><span id="l83.40">   // set an arbitrary property</span>
<a href="#l83.41"></a><span id="l83.41">   msgHdr.setStringProperty(&quot;testprop&quot;, &quot;somevalue&quot;);</span>
<a href="#l83.42"></a><span id="l83.42">   yield true;</span>
<a href="#l83.43"></a><span id="l83.43"> }</span>
<a href="#l83.44"></a><span id="l83.44"> </span>
<a href="#l83.45"></a><span id="l83.45"> // move the message to a subfolder</span>
<a href="#l83.46"></a><span id="l83.46" class="difflineminus">-function moveMessageToSubfolder()</span>
<a href="#l83.47"></a><span id="l83.47" class="difflineplus">+function* moveMessageToSubfolder()</span>
<a href="#l83.48"></a><span id="l83.48"> {</span>
<a href="#l83.49"></a><span id="l83.49">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l83.50"></a><span id="l83.50"> </span>
<a href="#l83.51"></a><span id="l83.51">   // Now move this message to the subfolder.</span>
<a href="#l83.52"></a><span id="l83.52">   var messages = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l83.53"></a><span id="l83.53">                    .createInstance(Ci.nsIMutableArray);</span>
<a href="#l83.54"></a><span id="l83.54">   messages.appendElement(msgHdr, false);</span>
<a href="#l83.55"></a><span id="l83.55">   /*</span>
<a href="#l83.56"></a><span id="l83.56" class="difflineat">@@ -77,17 +77,17 @@ function moveMessageToSubfolder()</span>
<a href="#l83.57"></a><span id="l83.57">   */</span>
<a href="#l83.58"></a><span id="l83.58"> </span>
<a href="#l83.59"></a><span id="l83.59">   MailServices.copy.CopyMessages(IMAPPump.inbox, messages, gSubfolder, true,</span>
<a href="#l83.60"></a><span id="l83.60">                                  asyncCopyListener, null, false);</span>
<a href="#l83.61"></a><span id="l83.61">   dl('wait for OnStopCopy');</span>
<a href="#l83.62"></a><span id="l83.62">   yield false;</span>
<a href="#l83.63"></a><span id="l83.63"> }</span>
<a href="#l83.64"></a><span id="l83.64"> </span>
<a href="#l83.65"></a><span id="l83.65" class="difflineminus">-function testPropertyOnMove()</span>
<a href="#l83.66"></a><span id="l83.66" class="difflineplus">+function* testPropertyOnMove()</span>
<a href="#l83.67"></a><span id="l83.67"> {</span>
<a href="#l83.68"></a><span id="l83.68">   gSubfolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l83.69"></a><span id="l83.69">   dl('wait for msgAdded');</span>
<a href="#l83.70"></a><span id="l83.70">   yield false; // wait for msgAdded notification</span>
<a href="#l83.71"></a><span id="l83.71">   dl('wait for OnStopRunningURL');</span>
<a href="#l83.72"></a><span id="l83.72">   yield false; // wait for OnStopRunningUrl</span>
<a href="#l83.73"></a><span id="l83.73">   let msgHdr = mailTestUtils.firstMsgHdr(gSubfolder);</span>
<a href="#l83.74"></a><span id="l83.74">   do_check_eq(msgHdr.getStringProperty(&quot;testprop&quot;), &quot;somevalue&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l84.1"></a><span id="l84.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_saveImapDraft.js</span>
<a href="#l84.2"></a><span id="l84.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_saveImapDraft.js</span>
<a href="#l84.3"></a><span id="l84.3" class="difflineat">@@ -24,29 +24,29 @@ var tests = [</span>
<a href="#l84.4"></a><span id="l84.4">   createDraftsFolder,</span>
<a href="#l84.5"></a><span id="l84.5">   saveDraft,</span>
<a href="#l84.6"></a><span id="l84.6">   updateDrafts,</span>
<a href="#l84.7"></a><span id="l84.7">   checkResult,</span>
<a href="#l84.8"></a><span id="l84.8">   endTest</span>
<a href="#l84.9"></a><span id="l84.9"> ];</span>
<a href="#l84.10"></a><span id="l84.10"> </span>
<a href="#l84.11"></a><span id="l84.11"> var gDraftsFolder;</span>
<a href="#l84.12"></a><span id="l84.12" class="difflineminus">-function createDraftsFolder()</span>
<a href="#l84.13"></a><span id="l84.13" class="difflineplus">+function* createDraftsFolder()</span>
<a href="#l84.14"></a><span id="l84.14"> {</span>
<a href="#l84.15"></a><span id="l84.15">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;Drafts&quot;, null);</span>
<a href="#l84.16"></a><span id="l84.16">   dl('wait for folderAdded');</span>
<a href="#l84.17"></a><span id="l84.17">   yield false;</span>
<a href="#l84.18"></a><span id="l84.18">   gDraftsFolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;Drafts&quot;);</span>
<a href="#l84.19"></a><span id="l84.19">   do_check_true(gDraftsFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l84.20"></a><span id="l84.20">   gDraftsFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l84.21"></a><span id="l84.21">   dl('wait for OnStopRunningURL');</span>
<a href="#l84.22"></a><span id="l84.22">   yield false;</span>
<a href="#l84.23"></a><span id="l84.23"> }</span>
<a href="#l84.24"></a><span id="l84.24"> </span>
<a href="#l84.25"></a><span id="l84.25" class="difflineminus">-function saveDraft()</span>
<a href="#l84.26"></a><span id="l84.26" class="difflineplus">+function* saveDraft()</span>
<a href="#l84.27"></a><span id="l84.27"> {</span>
<a href="#l84.28"></a><span id="l84.28">   var msgCompose = Cc[&quot;@mozilla.org/messengercompose/compose;1&quot;]</span>
<a href="#l84.29"></a><span id="l84.29">                      .createInstance(Ci.nsIMsgCompose);</span>
<a href="#l84.30"></a><span id="l84.30">   var fields = Cc[&quot;@mozilla.org/messengercompose/composefields;1&quot;]</span>
<a href="#l84.31"></a><span id="l84.31">                  .createInstance(Ci.nsIMsgCompFields);</span>
<a href="#l84.32"></a><span id="l84.32">   var params = Cc[&quot;@mozilla.org/messengercompose/composeparams;1&quot;]</span>
<a href="#l84.33"></a><span id="l84.33">                  .createInstance(Ci.nsIMsgComposeParams);</span>
<a href="#l84.34"></a><span id="l84.34">   params.composeFields = fields;</span>
<a href="#l84.35"></a><span id="l84.35" class="difflineat">@@ -59,32 +59,32 @@ function saveDraft()</span>
<a href="#l84.36"></a><span id="l84.36">   var progress = Cc[&quot;@mozilla.org/messenger/progress;1&quot;]</span>
<a href="#l84.37"></a><span id="l84.37">                    .createInstance(Ci.nsIMsgProgress);</span>
<a href="#l84.38"></a><span id="l84.38">   progress.registerListener(progressListener);</span>
<a href="#l84.39"></a><span id="l84.39">   msgCompose.SendMsg(Ci.nsIMsgSend.nsMsgSaveAsDraft, identity, &quot;&quot;, null,</span>
<a href="#l84.40"></a><span id="l84.40">                      progress);</span>
<a href="#l84.41"></a><span id="l84.41">   yield false;</span>
<a href="#l84.42"></a><span id="l84.42"> }</span>
<a href="#l84.43"></a><span id="l84.43"> </span>
<a href="#l84.44"></a><span id="l84.44" class="difflineminus">-function updateDrafts()</span>
<a href="#l84.45"></a><span id="l84.45" class="difflineplus">+function* updateDrafts()</span>
<a href="#l84.46"></a><span id="l84.46"> {</span>
<a href="#l84.47"></a><span id="l84.47">   dump(&quot;updating drafts\n&quot;);</span>
<a href="#l84.48"></a><span id="l84.48">   gDraftsFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l84.49"></a><span id="l84.49">   yield false;</span>
<a href="#l84.50"></a><span id="l84.50"> }</span>
<a href="#l84.51"></a><span id="l84.51"> </span>
<a href="#l84.52"></a><span id="l84.52" class="difflineminus">-function checkResult()</span>
<a href="#l84.53"></a><span id="l84.53" class="difflineplus">+function* checkResult()</span>
<a href="#l84.54"></a><span id="l84.54"> {</span>
<a href="#l84.55"></a><span id="l84.55">   dump(&quot;checking result\n&quot;);</span>
<a href="#l84.56"></a><span id="l84.56">   do_check_eq(gDraftsFolder.getTotalMessages(false), 1);</span>
<a href="#l84.57"></a><span id="l84.57">   do_check_eq(gDraftsFolder.getNumUnread(false), 1);</span>
<a href="#l84.58"></a><span id="l84.58">   yield true;</span>
<a href="#l84.59"></a><span id="l84.59"> }</span>
<a href="#l84.60"></a><span id="l84.60"> </span>
<a href="#l84.61"></a><span id="l84.61" class="difflineminus">-function endTest()</span>
<a href="#l84.62"></a><span id="l84.62" class="difflineplus">+function* endTest()</span>
<a href="#l84.63"></a><span id="l84.63"> {</span>
<a href="#l84.64"></a><span id="l84.64">   teardownIMAPPump();</span>
<a href="#l84.65"></a><span id="l84.65">   yield true;</span>
<a href="#l84.66"></a><span id="l84.66"> }</span>
<a href="#l84.67"></a><span id="l84.67"> </span>
<a href="#l84.68"></a><span id="l84.68"> function run_test()</span>
<a href="#l84.69"></a><span id="l84.69"> {</span>
<a href="#l84.70"></a><span id="l84.70">   Services.prefs.setBoolPref(&quot;mail.server.default.autosync_offline_stores&quot;, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l85.1"></a><span id="l85.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_saveTemplate.js</span>
<a href="#l85.2"></a><span id="l85.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_saveTemplate.js</span>
<a href="#l85.3"></a><span id="l85.3" class="difflineat">@@ -21,17 +21,17 @@ setupIMAPPump();</span>
<a href="#l85.4"></a><span id="l85.4"> </span>
<a href="#l85.5"></a><span id="l85.5"> var tests = [</span>
<a href="#l85.6"></a><span id="l85.6">   loadImapMessage,</span>
<a href="#l85.7"></a><span id="l85.7">   saveAsTemplate,</span>
<a href="#l85.8"></a><span id="l85.8">   endTest</span>
<a href="#l85.9"></a><span id="l85.9"> ]</span>
<a href="#l85.10"></a><span id="l85.10"> </span>
<a href="#l85.11"></a><span id="l85.11"> // load and update a message in the imap fake server</span>
<a href="#l85.12"></a><span id="l85.12" class="difflineminus">-function loadImapMessage()</span>
<a href="#l85.13"></a><span id="l85.13" class="difflineplus">+function* loadImapMessage()</span>
<a href="#l85.14"></a><span id="l85.14"> {</span>
<a href="#l85.15"></a><span id="l85.15">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l85.16"></a><span id="l85.16">   // create a synthetic message with attachment</span>
<a href="#l85.17"></a><span id="l85.17">   let smsg = gMessageGenerator.makeMessage();</span>
<a href="#l85.18"></a><span id="l85.18"> </span>
<a href="#l85.19"></a><span id="l85.19">   let msgURI =</span>
<a href="#l85.20"></a><span id="l85.20">     Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l85.21"></a><span id="l85.21">                         btoa(smsg.toMessageString()),</span>
<a href="#l85.22"></a><span id="l85.22" class="difflineat">@@ -41,17 +41,17 @@ function loadImapMessage()</span>
<a href="#l85.23"></a><span id="l85.23">   IMAPPump.mailbox.addMessage(message);</span>
<a href="#l85.24"></a><span id="l85.24">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l85.25"></a><span id="l85.25">   yield false;</span>
<a href="#l85.26"></a><span id="l85.26">   MailServices.mfn.addListener(mfnListener, MailServices.mfn.msgAdded);</span>
<a href="#l85.27"></a><span id="l85.27">   yield true;</span>
<a href="#l85.28"></a><span id="l85.28"> }</span>
<a href="#l85.29"></a><span id="l85.29"> </span>
<a href="#l85.30"></a><span id="l85.30"> // Cleanup</span>
<a href="#l85.31"></a><span id="l85.31" class="difflineminus">-function endTest()</span>
<a href="#l85.32"></a><span id="l85.32" class="difflineplus">+function* endTest()</span>
<a href="#l85.33"></a><span id="l85.33"> {</span>
<a href="#l85.34"></a><span id="l85.34">   teardownIMAPPump();</span>
<a href="#l85.35"></a><span id="l85.35">   yield true;</span>
<a href="#l85.36"></a><span id="l85.36"> }</span>
<a href="#l85.37"></a><span id="l85.37"> </span>
<a href="#l85.38"></a><span id="l85.38"> function saveAsUrlListener(aUri, aIdentity) {</span>
<a href="#l85.39"></a><span id="l85.39">   this.uri = aUri;</span>
<a href="#l85.40"></a><span id="l85.40">   this.identity = aIdentity;</span>
<a href="#l85.41"></a><span id="l85.41" class="difflineat">@@ -64,17 +64,17 @@ saveAsUrlListener.prototype = {</span>
<a href="#l85.42"></a><span id="l85.42">     let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;]</span>
<a href="#l85.43"></a><span id="l85.43">                       .createInstance(Ci.nsIMessenger);</span>
<a href="#l85.44"></a><span id="l85.44">     messenger.saveAs(this.uri, false, this.identity, null);</span>
<a href="#l85.45"></a><span id="l85.45">   }</span>
<a href="#l85.46"></a><span id="l85.46"> };</span>
<a href="#l85.47"></a><span id="l85.47"> </span>
<a href="#l85.48"></a><span id="l85.48"> // This is similar to the method in mailCommands.js, to test the way that</span>
<a href="#l85.49"></a><span id="l85.49"> // it creates a new templates folder before saving the message as a template.</span>
<a href="#l85.50"></a><span id="l85.50" class="difflineminus">-function saveAsTemplate() {</span>
<a href="#l85.51"></a><span id="l85.51" class="difflineplus">+function* saveAsTemplate() {</span>
<a href="#l85.52"></a><span id="l85.52">   let hdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l85.53"></a><span id="l85.53">   let uri = IMAPPump.inbox.getUriForMsg(hdr);</span>
<a href="#l85.54"></a><span id="l85.54">   const Ci = Components.interfaces;</span>
<a href="#l85.55"></a><span id="l85.55">   let identity = MailServices.accounts</span>
<a href="#l85.56"></a><span id="l85.56">                   .getFirstIdentityForServer(IMAPPump.incomingServer);</span>
<a href="#l85.57"></a><span id="l85.57">   identity.stationeryFolder = IMAPPump.incomingServer.rootFolder.URI + &quot;/Templates&quot;;</span>
<a href="#l85.58"></a><span id="l85.58">   let templates = MailUtils.getFolderForURI(identity.stationeryFolder, false);</span>
<a href="#l85.59"></a><span id="l85.59">   // Verify that Templates folder doesn't exist, and then create it.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l86.1"></a><span id="l86.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_starttlsFailure.js</span>
<a href="#l86.2"></a><span id="l86.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_starttlsFailure.js</span>
<a href="#l86.3"></a><span id="l86.3" class="difflineat">@@ -19,17 +19,17 @@ function alert(aDialogTitle, aText) {</span>
<a href="#l86.4"></a><span id="l86.4"> }</span>
<a href="#l86.5"></a><span id="l86.5"> </span>
<a href="#l86.6"></a><span id="l86.6"> var tests = [</span>
<a href="#l86.7"></a><span id="l86.7">   setup,</span>
<a href="#l86.8"></a><span id="l86.8">   check_alert,</span>
<a href="#l86.9"></a><span id="l86.9">   teardown</span>
<a href="#l86.10"></a><span id="l86.10"> ];</span>
<a href="#l86.11"></a><span id="l86.11"> </span>
<a href="#l86.12"></a><span id="l86.12" class="difflineminus">-function setup() {</span>
<a href="#l86.13"></a><span id="l86.13" class="difflineplus">+function* setup() {</span>
<a href="#l86.14"></a><span id="l86.14">   // set up IMAP fakeserver and incoming server</span>
<a href="#l86.15"></a><span id="l86.15">   IMAPPump.daemon = new imapDaemon();</span>
<a href="#l86.16"></a><span id="l86.16">   IMAPPump.server = makeServer(IMAPPump.daemon, &quot;&quot;, {dropOnStartTLS: true});</span>
<a href="#l86.17"></a><span id="l86.17">   IMAPPump.incomingServer = createLocalIMAPServer(IMAPPump.server.port);</span>
<a href="#l86.18"></a><span id="l86.18">   IMAPPump.incomingServer.socketType = Ci.nsMsgSocketType.alwaysSTARTTLS;</span>
<a href="#l86.19"></a><span id="l86.19"> </span>
<a href="#l86.20"></a><span id="l86.20">   // we need a local account for the IMAP server to have its sent messages in</span>
<a href="#l86.21"></a><span id="l86.21">   localAccountUtils.loadLocalMailAccount();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l87.1"></a><span id="l87.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js</span>
<a href="#l87.2"></a><span id="l87.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js</span>
<a href="#l87.3"></a><span id="l87.3" class="difflineat">@@ -36,40 +36,40 @@ var asyncCopyListener = {</span>
<a href="#l87.4"></a><span id="l87.4"> };</span>
<a href="#l87.5"></a><span id="l87.5"> </span>
<a href="#l87.6"></a><span id="l87.6"> var tests = [</span>
<a href="#l87.7"></a><span id="l87.7">   setup_messages,</span>
<a href="#l87.8"></a><span id="l87.8">   move_messages,</span>
<a href="#l87.9"></a><span id="l87.9">   check_messages</span>
<a href="#l87.10"></a><span id="l87.10"> ];</span>
<a href="#l87.11"></a><span id="l87.11"> </span>
<a href="#l87.12"></a><span id="l87.12" class="difflineminus">-function setup_messages() {</span>
<a href="#l87.13"></a><span id="l87.13" class="difflineplus">+function* setup_messages() {</span>
<a href="#l87.14"></a><span id="l87.14">   Services.prefs.setBoolPref(&quot;mail.server.default.autosync_offline_stores&quot;, false);</span>
<a href="#l87.15"></a><span id="l87.15"> </span>
<a href="#l87.16"></a><span id="l87.16">   let messageGenerator = new MessageGenerator();</span>
<a href="#l87.17"></a><span id="l87.17">   let messageString = messageGenerator.makeMessage().toMessageString();</span>
<a href="#l87.18"></a><span id="l87.18">   let dataUri = Services.io.newURI(&quot;data:text/plain;base64,&quot; + btoa(messageString),</span>
<a href="#l87.19"></a><span id="l87.19">                                    null, null);</span>
<a href="#l87.20"></a><span id="l87.20">   let imapMsg = new imapMessage(dataUri.spec, IMAPPump.mailbox.uidnext++, []);</span>
<a href="#l87.21"></a><span id="l87.21">   IMAPPump.mailbox.addMessage(imapMsg);</span>
<a href="#l87.22"></a><span id="l87.22"> </span>
<a href="#l87.23"></a><span id="l87.23">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l87.24"></a><span id="l87.24">   yield false;</span>
<a href="#l87.25"></a><span id="l87.25"> }</span>
<a href="#l87.26"></a><span id="l87.26"> </span>
<a href="#l87.27"></a><span id="l87.27" class="difflineminus">-function move_messages() {</span>
<a href="#l87.28"></a><span id="l87.28" class="difflineplus">+function* move_messages() {</span>
<a href="#l87.29"></a><span id="l87.29">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l87.30"></a><span id="l87.30">   let msg = IMAPPump.inbox.msgDatabase.GetMsgHdrForKey(IMAPPump.mailbox.uidnext - 1);</span>
<a href="#l87.31"></a><span id="l87.31">   messages.appendElement(msg, false);</span>
<a href="#l87.32"></a><span id="l87.32">   MailServices.copy.CopyMessages(IMAPPump.inbox, messages, localAccountUtils.inboxFolder,</span>
<a href="#l87.33"></a><span id="l87.33">                                  true, asyncCopyListener, null, false);</span>
<a href="#l87.34"></a><span id="l87.34">   yield false;</span>
<a href="#l87.35"></a><span id="l87.35"> }</span>
<a href="#l87.36"></a><span id="l87.36"> </span>
<a href="#l87.37"></a><span id="l87.37" class="difflineminus">-function check_messages() {</span>
<a href="#l87.38"></a><span id="l87.38" class="difflineplus">+function* check_messages() {</span>
<a href="#l87.39"></a><span id="l87.39">   do_check_eq(IMAPPump.inbox.getTotalMessages(false), 1);</span>
<a href="#l87.40"></a><span id="l87.40">   do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l87.41"></a><span id="l87.41">   yield true;</span>
<a href="#l87.42"></a><span id="l87.42"> }</span>
<a href="#l87.43"></a><span id="l87.43"> </span>
<a href="#l87.44"></a><span id="l87.44"> function run_test() {</span>
<a href="#l87.45"></a><span id="l87.45">   do_register_cleanup(function() {</span>
<a href="#l87.46"></a><span id="l87.46">     // IMAPPump.server.performTest() brings this test to a halt,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l88.1"></a><span id="l88.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_subfolderLocation.js</span>
<a href="#l88.2"></a><span id="l88.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_subfolderLocation.js</span>
<a href="#l88.3"></a><span id="l88.3" class="difflineat">@@ -1,84 +1,84 @@</span>
<a href="#l88.4"></a><span id="l88.4" class="difflineminus">-/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l88.5"></a><span id="l88.5" class="difflineminus">- * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l88.6"></a><span id="l88.6" class="difflineminus">-</span>
<a href="#l88.7"></a><span id="l88.7" class="difflineminus">-// Test proper location of new imap offline subfolders for maildir.</span>
<a href="#l88.8"></a><span id="l88.8" class="difflineminus">-</span>
<a href="#l88.9"></a><span id="l88.9" class="difflineminus">-var Cc = Components.classes;</span>
<a href="#l88.10"></a><span id="l88.10" class="difflineminus">-var Ci = Components.interfaces;</span>
<a href="#l88.11"></a><span id="l88.11" class="difflineminus">-var Cr = Components.results;</span>
<a href="#l88.12"></a><span id="l88.12" class="difflineminus">-var CC = Components.Constructor;</span>
<a href="#l88.13"></a><span id="l88.13" class="difflineminus">-var Cu = Components.utils;</span>
<a href="#l88.14"></a><span id="l88.14" class="difflineminus">-</span>
<a href="#l88.15"></a><span id="l88.15" class="difflineminus">-// async support</span>
<a href="#l88.16"></a><span id="l88.16" class="difflineminus">-load(&quot;../../../resources/logHelper.js&quot;);</span>
<a href="#l88.17"></a><span id="l88.17" class="difflineminus">-load(&quot;../../../resources/alertTestUtils.js&quot;);</span>
<a href="#l88.18"></a><span id="l88.18" class="difflineminus">-</span>
<a href="#l88.19"></a><span id="l88.19" class="difflineminus">-// Globals</span>
<a href="#l88.20"></a><span id="l88.20" class="difflineminus">-</span>
<a href="#l88.21"></a><span id="l88.21" class="difflineminus">-// Messages to load must have CRLF line endings, that is Windows style</span>
<a href="#l88.22"></a><span id="l88.22" class="difflineminus">-var gMessage = &quot;bugmail10&quot;; // message file used as the test message</span>
<a href="#l88.23"></a><span id="l88.23" class="difflineminus">-</span>
<a href="#l88.24"></a><span id="l88.24" class="difflineminus">-add_task(function () {</span>
<a href="#l88.25"></a><span id="l88.25" class="difflineminus">-  Services.prefs.setBoolPref(&quot;mail.server.server1.autosync_offline_stores&quot;, false);</span>
<a href="#l88.26"></a><span id="l88.26" class="difflineminus">-  setupIMAPPump();</span>
<a href="#l88.27"></a><span id="l88.27" class="difflineminus">-});</span>
<a href="#l88.28"></a><span id="l88.28" class="difflineminus">-</span>
<a href="#l88.29"></a><span id="l88.29" class="difflineminus">-// load and update a message in the imap fake server</span>
<a href="#l88.30"></a><span id="l88.30" class="difflineminus">-add_task(function* loadImapMessage() {</span>
<a href="#l88.31"></a><span id="l88.31" class="difflineminus">-  IMAPPump.mailbox.addMessage(new imapMessage(specForFileName(gMessage),</span>
<a href="#l88.32"></a><span id="l88.32" class="difflineminus">-                              IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l88.33"></a><span id="l88.33" class="difflineminus">-  let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l88.34"></a><span id="l88.34" class="difflineminus">-  IMAPPump.inbox.updateFolderWithListener(gDummyMsgWindow, promiseUrlListener);</span>
<a href="#l88.35"></a><span id="l88.35" class="difflineminus">-  yield promiseUrlListener.promise;</span>
<a href="#l88.36"></a><span id="l88.36" class="difflineminus">-</span>
<a href="#l88.37"></a><span id="l88.37" class="difflineminus">-  do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l88.38"></a><span id="l88.38" class="difflineminus">-  let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l88.39"></a><span id="l88.39" class="difflineminus">-  do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l88.40"></a><span id="l88.40" class="difflineminus">-});</span>
<a href="#l88.41"></a><span id="l88.41" class="difflineminus">-</span>
<a href="#l88.42"></a><span id="l88.42" class="difflineminus">-add_task(function* downloadOffline() {</span>
<a href="#l88.43"></a><span id="l88.43" class="difflineminus">-  // ...and download for offline use.</span>
<a href="#l88.44"></a><span id="l88.44" class="difflineminus">-  let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l88.45"></a><span id="l88.45" class="difflineminus">-  IMAPPump.inbox.downloadAllForOffline(promiseUrlListener, null);</span>
<a href="#l88.46"></a><span id="l88.46" class="difflineminus">-  yield promiseUrlListener.promise;</span>
<a href="#l88.47"></a><span id="l88.47" class="difflineminus">-});</span>
<a href="#l88.48"></a><span id="l88.48" class="difflineminus">-</span>
<a href="#l88.49"></a><span id="l88.49" class="difflineminus">-var folderName1 = &quot;sub1&quot;;</span>
<a href="#l88.50"></a><span id="l88.50" class="difflineminus">-var folderName2 = &quot;sub2&quot;;</span>
<a href="#l88.51"></a><span id="l88.51" class="difflineminus">-</span>
<a href="#l88.52"></a><span id="l88.52" class="difflineminus">-// use a folder method to add a subfolder</span>
<a href="#l88.53"></a><span id="l88.53" class="difflineminus">-add_task(function* addSubfolder() {</span>
<a href="#l88.54"></a><span id="l88.54" class="difflineminus">-  let promiseFolder1 = PromiseTestUtils.promiseFolderAdded(folderName1);</span>
<a href="#l88.55"></a><span id="l88.55" class="difflineminus">-  IMAPPump.inbox.createSubfolder(folderName1, null);</span>
<a href="#l88.56"></a><span id="l88.56" class="difflineminus">-  yield promiseFolder1;</span>
<a href="#l88.57"></a><span id="l88.57" class="difflineminus">-});</span>
<a href="#l88.58"></a><span id="l88.58" class="difflineminus">-</span>
<a href="#l88.59"></a><span id="l88.59" class="difflineminus">-// use a store method to add a subfolder</span>
<a href="#l88.60"></a><span id="l88.60" class="difflineminus">-add_task(function storeAddSubfolder() {</span>
<a href="#l88.61"></a><span id="l88.61" class="difflineminus">-  IMAPPump.incomingServer.msgStore.createFolder(IMAPPump.inbox, folderName2);</span>
<a href="#l88.62"></a><span id="l88.62" class="difflineminus">-});</span>
<a href="#l88.63"></a><span id="l88.63" class="difflineminus">-</span>
<a href="#l88.64"></a><span id="l88.64" class="difflineminus">-// test that folders created with store and folder have the same parent</span>
<a href="#l88.65"></a><span id="l88.65" class="difflineminus">-add_task(function testSubfolder() {</span>
<a href="#l88.66"></a><span id="l88.66" class="difflineminus">-  let subfolder1 = IMAPPump.inbox.getChildNamed(folderName1);</span>
<a href="#l88.67"></a><span id="l88.67" class="difflineminus">-  let subfolder2 = IMAPPump.inbox.getChildNamed(folderName2);</span>
<a href="#l88.68"></a><span id="l88.68" class="difflineminus">-  do_check_eq(subfolder1.filePath.parent.path, subfolder2.filePath.parent.path);</span>
<a href="#l88.69"></a><span id="l88.69" class="difflineminus">-});</span>
<a href="#l88.70"></a><span id="l88.70" class="difflineminus">-</span>
<a href="#l88.71"></a><span id="l88.71" class="difflineminus">-// Cleanup at end</span>
<a href="#l88.72"></a><span id="l88.72" class="difflineminus">-add_task(teardownIMAPPump);</span>
<a href="#l88.73"></a><span id="l88.73" class="difflineminus">-</span>
<a href="#l88.74"></a><span id="l88.74" class="difflineminus">-function run_test() {</span>
<a href="#l88.75"></a><span id="l88.75" class="difflineminus">-  run_next_test();</span>
<a href="#l88.76"></a><span id="l88.76" class="difflineminus">-}</span>
<a href="#l88.77"></a><span id="l88.77" class="difflineminus">-</span>
<a href="#l88.78"></a><span id="l88.78" class="difflineminus">-/*</span>
<a href="#l88.79"></a><span id="l88.79" class="difflineminus">- * helper functions</span>
<a href="#l88.80"></a><span id="l88.80" class="difflineminus">- */</span>
<a href="#l88.81"></a><span id="l88.81" class="difflineminus">-</span>
<a href="#l88.82"></a><span id="l88.82" class="difflineminus">-// given a test file, return the file uri spec</span>
<a href="#l88.83"></a><span id="l88.83" class="difflineminus">-function specForFileName(aFileName) {</span>
<a href="#l88.84"></a><span id="l88.84" class="difflineminus">-  let file = do_get_file(&quot;../../../data/&quot; + aFileName);</span>
<a href="#l88.85"></a><span id="l88.85" class="difflineminus">-  let msgfileuri = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l88.86"></a><span id="l88.86" class="difflineminus">-  return msgfileuri.spec;</span>
<a href="#l88.87"></a><span id="l88.87" class="difflineminus">-}</span>
<a href="#l88.88"></a><span id="l88.88" class="difflineplus">+/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l88.89"></a><span id="l88.89" class="difflineplus">+ * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l88.90"></a><span id="l88.90" class="difflineplus">+</span>
<a href="#l88.91"></a><span id="l88.91" class="difflineplus">+// Test proper location of new imap offline subfolders for maildir.</span>
<a href="#l88.92"></a><span id="l88.92" class="difflineplus">+</span>
<a href="#l88.93"></a><span id="l88.93" class="difflineplus">+var Cc = Components.classes;</span>
<a href="#l88.94"></a><span id="l88.94" class="difflineplus">+var Ci = Components.interfaces;</span>
<a href="#l88.95"></a><span id="l88.95" class="difflineplus">+var Cr = Components.results;</span>
<a href="#l88.96"></a><span id="l88.96" class="difflineplus">+var CC = Components.Constructor;</span>
<a href="#l88.97"></a><span id="l88.97" class="difflineplus">+var Cu = Components.utils;</span>
<a href="#l88.98"></a><span id="l88.98" class="difflineplus">+</span>
<a href="#l88.99"></a><span id="l88.99" class="difflineplus">+// async support</span>
<a href="#l88.100"></a><span id="l88.100" class="difflineplus">+load(&quot;../../../resources/logHelper.js&quot;);</span>
<a href="#l88.101"></a><span id="l88.101" class="difflineplus">+load(&quot;../../../resources/alertTestUtils.js&quot;);</span>
<a href="#l88.102"></a><span id="l88.102" class="difflineplus">+</span>
<a href="#l88.103"></a><span id="l88.103" class="difflineplus">+// Globals</span>
<a href="#l88.104"></a><span id="l88.104" class="difflineplus">+</span>
<a href="#l88.105"></a><span id="l88.105" class="difflineplus">+// Messages to load must have CRLF line endings, that is Windows style</span>
<a href="#l88.106"></a><span id="l88.106" class="difflineplus">+var gMessage = &quot;bugmail10&quot;; // message file used as the test message</span>
<a href="#l88.107"></a><span id="l88.107" class="difflineplus">+</span>
<a href="#l88.108"></a><span id="l88.108" class="difflineplus">+add_task(function () {</span>
<a href="#l88.109"></a><span id="l88.109" class="difflineplus">+  Services.prefs.setBoolPref(&quot;mail.server.server1.autosync_offline_stores&quot;, false);</span>
<a href="#l88.110"></a><span id="l88.110" class="difflineplus">+  setupIMAPPump();</span>
<a href="#l88.111"></a><span id="l88.111" class="difflineplus">+});</span>
<a href="#l88.112"></a><span id="l88.112" class="difflineplus">+</span>
<a href="#l88.113"></a><span id="l88.113" class="difflineplus">+// load and update a message in the imap fake server</span>
<a href="#l88.114"></a><span id="l88.114" class="difflineplus">+add_task(function* loadImapMessage() {</span>
<a href="#l88.115"></a><span id="l88.115" class="difflineplus">+  IMAPPump.mailbox.addMessage(new imapMessage(specForFileName(gMessage),</span>
<a href="#l88.116"></a><span id="l88.116" class="difflineplus">+                              IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l88.117"></a><span id="l88.117" class="difflineplus">+  let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l88.118"></a><span id="l88.118" class="difflineplus">+  IMAPPump.inbox.updateFolderWithListener(gDummyMsgWindow, promiseUrlListener);</span>
<a href="#l88.119"></a><span id="l88.119" class="difflineplus">+  yield promiseUrlListener.promise;</span>
<a href="#l88.120"></a><span id="l88.120" class="difflineplus">+</span>
<a href="#l88.121"></a><span id="l88.121" class="difflineplus">+  do_check_eq(1, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l88.122"></a><span id="l88.122" class="difflineplus">+  let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l88.123"></a><span id="l88.123" class="difflineplus">+  do_check_true(msgHdr instanceof Ci.nsIMsgDBHdr);</span>
<a href="#l88.124"></a><span id="l88.124" class="difflineplus">+});</span>
<a href="#l88.125"></a><span id="l88.125" class="difflineplus">+</span>
<a href="#l88.126"></a><span id="l88.126" class="difflineplus">+add_task(function* downloadOffline() {</span>
<a href="#l88.127"></a><span id="l88.127" class="difflineplus">+  // ...and download for offline use.</span>
<a href="#l88.128"></a><span id="l88.128" class="difflineplus">+  let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l88.129"></a><span id="l88.129" class="difflineplus">+  IMAPPump.inbox.downloadAllForOffline(promiseUrlListener, null);</span>
<a href="#l88.130"></a><span id="l88.130" class="difflineplus">+  yield promiseUrlListener.promise;</span>
<a href="#l88.131"></a><span id="l88.131" class="difflineplus">+});</span>
<a href="#l88.132"></a><span id="l88.132" class="difflineplus">+</span>
<a href="#l88.133"></a><span id="l88.133" class="difflineplus">+var folderName1 = &quot;sub1&quot;;</span>
<a href="#l88.134"></a><span id="l88.134" class="difflineplus">+var folderName2 = &quot;sub2&quot;;</span>
<a href="#l88.135"></a><span id="l88.135" class="difflineplus">+</span>
<a href="#l88.136"></a><span id="l88.136" class="difflineplus">+// use a folder method to add a subfolder</span>
<a href="#l88.137"></a><span id="l88.137" class="difflineplus">+add_task(function* addSubfolder() {</span>
<a href="#l88.138"></a><span id="l88.138" class="difflineplus">+  let promiseFolder1 = PromiseTestUtils.promiseFolderAdded(folderName1);</span>
<a href="#l88.139"></a><span id="l88.139" class="difflineplus">+  IMAPPump.inbox.createSubfolder(folderName1, null);</span>
<a href="#l88.140"></a><span id="l88.140" class="difflineplus">+  yield promiseFolder1;</span>
<a href="#l88.141"></a><span id="l88.141" class="difflineplus">+});</span>
<a href="#l88.142"></a><span id="l88.142" class="difflineplus">+</span>
<a href="#l88.143"></a><span id="l88.143" class="difflineplus">+// use a store method to add a subfolder</span>
<a href="#l88.144"></a><span id="l88.144" class="difflineplus">+add_task(function storeAddSubfolder() {</span>
<a href="#l88.145"></a><span id="l88.145" class="difflineplus">+  IMAPPump.incomingServer.msgStore.createFolder(IMAPPump.inbox, folderName2);</span>
<a href="#l88.146"></a><span id="l88.146" class="difflineplus">+});</span>
<a href="#l88.147"></a><span id="l88.147" class="difflineplus">+</span>
<a href="#l88.148"></a><span id="l88.148" class="difflineplus">+// test that folders created with store and folder have the same parent</span>
<a href="#l88.149"></a><span id="l88.149" class="difflineplus">+add_task(function testSubfolder() {</span>
<a href="#l88.150"></a><span id="l88.150" class="difflineplus">+  let subfolder1 = IMAPPump.inbox.getChildNamed(folderName1);</span>
<a href="#l88.151"></a><span id="l88.151" class="difflineplus">+  let subfolder2 = IMAPPump.inbox.getChildNamed(folderName2);</span>
<a href="#l88.152"></a><span id="l88.152" class="difflineplus">+  do_check_eq(subfolder1.filePath.parent.path, subfolder2.filePath.parent.path);</span>
<a href="#l88.153"></a><span id="l88.153" class="difflineplus">+});</span>
<a href="#l88.154"></a><span id="l88.154" class="difflineplus">+</span>
<a href="#l88.155"></a><span id="l88.155" class="difflineplus">+// Cleanup at end</span>
<a href="#l88.156"></a><span id="l88.156" class="difflineplus">+add_task(teardownIMAPPump);</span>
<a href="#l88.157"></a><span id="l88.157" class="difflineplus">+</span>
<a href="#l88.158"></a><span id="l88.158" class="difflineplus">+function run_test() {</span>
<a href="#l88.159"></a><span id="l88.159" class="difflineplus">+  run_next_test();</span>
<a href="#l88.160"></a><span id="l88.160" class="difflineplus">+}</span>
<a href="#l88.161"></a><span id="l88.161" class="difflineplus">+</span>
<a href="#l88.162"></a><span id="l88.162" class="difflineplus">+/*</span>
<a href="#l88.163"></a><span id="l88.163" class="difflineplus">+ * helper functions</span>
<a href="#l88.164"></a><span id="l88.164" class="difflineplus">+ */</span>
<a href="#l88.165"></a><span id="l88.165" class="difflineplus">+</span>
<a href="#l88.166"></a><span id="l88.166" class="difflineplus">+// given a test file, return the file uri spec</span>
<a href="#l88.167"></a><span id="l88.167" class="difflineplus">+function specForFileName(aFileName) {</span>
<a href="#l88.168"></a><span id="l88.168" class="difflineplus">+  let file = do_get_file(&quot;../../../data/&quot; + aFileName);</span>
<a href="#l88.169"></a><span id="l88.169" class="difflineplus">+  let msgfileuri = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l88.170"></a><span id="l88.170" class="difflineplus">+  return msgfileuri.spec;</span>
<a href="#l88.171"></a><span id="l88.171" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l89.1"></a><span id="l89.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_syncChanges.js</span>
<a href="#l89.2"></a><span id="l89.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_syncChanges.js</span>
<a href="#l89.3"></a><span id="l89.3" class="difflineat">@@ -10,45 +10,45 @@ load(&quot;../../../resources/asyncTestUtils.</span>
<a href="#l89.4"></a><span id="l89.4"> load(&quot;../../../resources/messageGenerator.js&quot;);</span>
<a href="#l89.5"></a><span id="l89.5"> </span>
<a href="#l89.6"></a><span id="l89.6"> var gMessage;</span>
<a href="#l89.7"></a><span id="l89.7"> var gSecondFolder;</span>
<a href="#l89.8"></a><span id="l89.8"> var gSynthMessage;</span>
<a href="#l89.9"></a><span id="l89.9"> </span>
<a href="#l89.10"></a><span id="l89.10"> var tests = [</span>
<a href="#l89.11"></a><span id="l89.11">   setup,</span>
<a href="#l89.12"></a><span id="l89.12" class="difflineminus">-  function switchAwayFromInbox() {</span>
<a href="#l89.13"></a><span id="l89.13" class="difflineplus">+  function* switchAwayFromInbox() {</span>
<a href="#l89.14"></a><span id="l89.14">     let rootFolder = IMAPPump.incomingServer.rootFolder;</span>
<a href="#l89.15"></a><span id="l89.15">     gSecondFolder =  rootFolder.getChildNamed(&quot;secondFolder&quot;)</span>
<a href="#l89.16"></a><span id="l89.16">                            .QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l89.17"></a><span id="l89.17"> </span>
<a href="#l89.18"></a><span id="l89.18">     // Selecting the second folder will close the cached connection</span>
<a href="#l89.19"></a><span id="l89.19">     // on the inbox because fake server only supports one connection at a time.</span>
<a href="#l89.20"></a><span id="l89.20">     //  Then, we can poke at the message on the imap server directly, which</span>
<a href="#l89.21"></a><span id="l89.21">     // simulates the user changing the message from a different machine,</span>
<a href="#l89.22"></a><span id="l89.22">     // and Thunderbird discovering the change when it does a flag sync </span>
<a href="#l89.23"></a><span id="l89.23">     // upon reselecting the Inbox.</span>
<a href="#l89.24"></a><span id="l89.24">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l89.25"></a><span id="l89.25">     yield false;</span>
<a href="#l89.26"></a><span id="l89.26">   },</span>
<a href="#l89.27"></a><span id="l89.27" class="difflineminus">-  function simulateMailboxEmptied() {</span>
<a href="#l89.28"></a><span id="l89.28" class="difflineplus">+  function* simulateMailboxEmptied() {</span>
<a href="#l89.29"></a><span id="l89.29">     gMessage.setFlag(&quot;\\Deleted&quot;);</span>
<a href="#l89.30"></a><span id="l89.30">     IMAPPump.inbox.expunge(asyncUrlListener, null);</span>
<a href="#l89.31"></a><span id="l89.31">     yield false;</span>
<a href="#l89.32"></a><span id="l89.32">     IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l89.33"></a><span id="l89.33">     yield false;</span>
<a href="#l89.34"></a><span id="l89.34">   },</span>
<a href="#l89.35"></a><span id="l89.35">   function checkMailboxEmpty() {</span>
<a href="#l89.36"></a><span id="l89.36">     let msgHdr = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gSynthMessage.messageId);</span>
<a href="#l89.37"></a><span id="l89.37">     do_check_eq(IMAPPump.inbox.getTotalMessages(false), 0);</span>
<a href="#l89.38"></a><span id="l89.38">   },</span>
<a href="#l89.39"></a><span id="l89.39">   teardown</span>
<a href="#l89.40"></a><span id="l89.40"> ];</span>
<a href="#l89.41"></a><span id="l89.41"> </span>
<a href="#l89.42"></a><span id="l89.42" class="difflineminus">-function setup() {</span>
<a href="#l89.43"></a><span id="l89.43" class="difflineplus">+function* setup() {</span>
<a href="#l89.44"></a><span id="l89.44">   /*</span>
<a href="#l89.45"></a><span id="l89.45">    * Set up an IMAP server.</span>
<a href="#l89.46"></a><span id="l89.46">    */</span>
<a href="#l89.47"></a><span id="l89.47">   setupIMAPPump();</span>
<a href="#l89.48"></a><span id="l89.48"> </span>
<a href="#l89.49"></a><span id="l89.49">   IMAPPump.daemon.createMailbox(&quot;secondFolder&quot;, {subscribed : true});</span>
<a href="#l89.50"></a><span id="l89.50"> </span>
<a href="#l89.51"></a><span id="l89.51">   let messages = [];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l90.1"></a><span id="l90.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_trustSpamAssassin.js</span>
<a href="#l90.2"></a><span id="l90.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_trustSpamAssassin.js</span>
<a href="#l90.3"></a><span id="l90.3" class="difflineat">@@ -31,56 +31,56 @@ var tests = [</span>
<a href="#l90.4"></a><span id="l90.4">   loadImapMessage,</span>
<a href="#l90.5"></a><span id="l90.5">   testMessageInJunk,</span>
<a href="#l90.6"></a><span id="l90.6">   markMessageAsGood,</span>
<a href="#l90.7"></a><span id="l90.7">   updateFoldersAndCheck,</span>
<a href="#l90.8"></a><span id="l90.8">   endTest,</span>
<a href="#l90.9"></a><span id="l90.9"> ]</span>
<a href="#l90.10"></a><span id="l90.10"> </span>
<a href="#l90.11"></a><span id="l90.11"> var gJunkFolder;</span>
<a href="#l90.12"></a><span id="l90.12" class="difflineminus">-function createJunkFolder()</span>
<a href="#l90.13"></a><span id="l90.13" class="difflineplus">+function* createJunkFolder()</span>
<a href="#l90.14"></a><span id="l90.14"> {</span>
<a href="#l90.15"></a><span id="l90.15">   IMAPPump.incomingServer.rootFolder.createSubfolder(&quot;Junk&quot;, null);</span>
<a href="#l90.16"></a><span id="l90.16">   dl('wait for folderAdded');</span>
<a href="#l90.17"></a><span id="l90.17">   yield false;</span>
<a href="#l90.18"></a><span id="l90.18">   gJunkFolder = IMAPPump.incomingServer.rootFolder.getChildNamed(&quot;Junk&quot;);</span>
<a href="#l90.19"></a><span id="l90.19">   do_check_true(gJunkFolder instanceof Ci.nsIMsgImapMailFolder);</span>
<a href="#l90.20"></a><span id="l90.20">   gJunkFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l90.21"></a><span id="l90.21">   dl('wait for OnStopRunningURL');</span>
<a href="#l90.22"></a><span id="l90.22">   yield false;</span>
<a href="#l90.23"></a><span id="l90.23"> }</span>
<a href="#l90.24"></a><span id="l90.24"> </span>
<a href="#l90.25"></a><span id="l90.25"> /*</span>
<a href="#l90.26"></a><span id="l90.26">  * Load and update a message in the imap fake server, should move</span>
<a href="#l90.27"></a><span id="l90.27">  *  SpamAssassin-marked junk message to junk folder</span>
<a href="#l90.28"></a><span id="l90.28">  */</span>
<a href="#l90.29"></a><span id="l90.29" class="difflineminus">-function loadImapMessage()</span>
<a href="#l90.30"></a><span id="l90.30" class="difflineplus">+function* loadImapMessage()</span>
<a href="#l90.31"></a><span id="l90.31"> {</span>
<a href="#l90.32"></a><span id="l90.32">   IMAPPump.mailbox.addMessage(new imapMessage(specForFileName(gMessage),</span>
<a href="#l90.33"></a><span id="l90.33">                           IMAPPump.mailbox.uidnext++, []));</span>
<a href="#l90.34"></a><span id="l90.34">   /*</span>
<a href="#l90.35"></a><span id="l90.35">    * The message matched the SpamAssassin header, so it moved</span>
<a href="#l90.36"></a><span id="l90.36">    *  to the junk folder</span>
<a href="#l90.37"></a><span id="l90.37">    */</span>
<a href="#l90.38"></a><span id="l90.38">   IMAPPump.inbox.updateFolder(null);</span>
<a href="#l90.39"></a><span id="l90.39">   dl('wait for msgsMoveCopyCompleted');</span>
<a href="#l90.40"></a><span id="l90.40">   yield false;</span>
<a href="#l90.41"></a><span id="l90.41">   gJunkFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l90.42"></a><span id="l90.42">   dl('wait for OnStopRunningURL');</span>
<a href="#l90.43"></a><span id="l90.43">   yield false;</span>
<a href="#l90.44"></a><span id="l90.44"> }</span>
<a href="#l90.45"></a><span id="l90.45"> </span>
<a href="#l90.46"></a><span id="l90.46" class="difflineminus">-function testMessageInJunk()</span>
<a href="#l90.47"></a><span id="l90.47" class="difflineplus">+function* testMessageInJunk()</span>
<a href="#l90.48"></a><span id="l90.48"> {</span>
<a href="#l90.49"></a><span id="l90.49">   do_check_eq(0, IMAPPump.inbox.getTotalMessages(false));</span>
<a href="#l90.50"></a><span id="l90.50">   do_check_eq(1, gJunkFolder.getTotalMessages(false));</span>
<a href="#l90.51"></a><span id="l90.51">   yield true;</span>
<a href="#l90.52"></a><span id="l90.52"> }</span>
<a href="#l90.53"></a><span id="l90.53"> </span>
<a href="#l90.54"></a><span id="l90.54" class="difflineminus">-function markMessageAsGood()</span>
<a href="#l90.55"></a><span id="l90.55" class="difflineplus">+function* markMessageAsGood()</span>
<a href="#l90.56"></a><span id="l90.56"> {</span>
<a href="#l90.57"></a><span id="l90.57">   /*</span>
<a href="#l90.58"></a><span id="l90.58">    * This is done in the application in nsMsgDBView, which is difficult</span>
<a href="#l90.59"></a><span id="l90.59">    *  to test in xpcshell tests. We aren't really trying to test that here</span>
<a href="#l90.60"></a><span id="l90.60">    *  though, since the point of this test is working with the server-based</span>
<a href="#l90.61"></a><span id="l90.61">    *  filters. So I will simply simulate the operations that would typically</span>
<a href="#l90.62"></a><span id="l90.62">    *  be done by a manual marking of the messages.</span>
<a href="#l90.63"></a><span id="l90.63">    */</span>
<a href="#l90.64"></a><span id="l90.64" class="difflineat">@@ -108,17 +108,17 @@ function markMessageAsGood()</span>
<a href="#l90.65"></a><span id="l90.65">   */</span>
<a href="#l90.66"></a><span id="l90.66"> </span>
<a href="#l90.67"></a><span id="l90.67">   MailServices.copy.CopyMessages(gJunkFolder, messages, IMAPPump.inbox, true,</span>
<a href="#l90.68"></a><span id="l90.68">                                  null, null, false);</span>
<a href="#l90.69"></a><span id="l90.69">   dl('wait for msgsMoveCopyCompleted');</span>
<a href="#l90.70"></a><span id="l90.70">   yield false;</span>
<a href="#l90.71"></a><span id="l90.71"> }</span>
<a href="#l90.72"></a><span id="l90.72"> </span>
<a href="#l90.73"></a><span id="l90.73" class="difflineminus">-function updateFoldersAndCheck()</span>
<a href="#l90.74"></a><span id="l90.74" class="difflineplus">+function* updateFoldersAndCheck()</span>
<a href="#l90.75"></a><span id="l90.75"> {</span>
<a href="#l90.76"></a><span id="l90.76">   IMAPPump.inbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l90.77"></a><span id="l90.77">   dl('wait for OnStopRunningURL');</span>
<a href="#l90.78"></a><span id="l90.78">   yield false;</span>
<a href="#l90.79"></a><span id="l90.79">   gJunkFolder.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l90.80"></a><span id="l90.80">   dl('wait for OnStopRunningURL');</span>
<a href="#l90.81"></a><span id="l90.81">   yield false;</span>
<a href="#l90.82"></a><span id="l90.82">   // bug 540385 causes this test to fail</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l91.1"></a><span id="l91.1" class="difflineminus">--- a/mailnews/local/test/unit/test_folderLoaded.js</span>
<a href="#l91.2"></a><span id="l91.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_folderLoaded.js</span>
<a href="#l91.3"></a><span id="l91.3" class="difflineat">@@ -17,17 +17,17 @@ load(&quot;../../../resources/asyncTestUtils.</span>
<a href="#l91.4"></a><span id="l91.4"> var testSubjects = [&quot;[Bug 397009] A filter will let me tag, but not untag&quot;,</span>
<a href="#l91.5"></a><span id="l91.5">                     &quot;Hello, did you receive my bugmail?&quot;];</span>
<a href="#l91.6"></a><span id="l91.6"> var gMsgFile1 = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l91.7"></a><span id="l91.7"> var gMsgFile2 = do_get_file(&quot;../../../data/draft1&quot;);</span>
<a href="#l91.8"></a><span id="l91.8"> </span>
<a href="#l91.9"></a><span id="l91.9"> var gTargetFolder = null;</span>
<a href="#l91.10"></a><span id="l91.10"> </span>
<a href="#l91.11"></a><span id="l91.11"> var tests = [</span>
<a href="#l91.12"></a><span id="l91.12" class="difflineminus">-  function setup()</span>
<a href="#l91.13"></a><span id="l91.13" class="difflineplus">+  function* setup()</span>
<a href="#l91.14"></a><span id="l91.14">   {</span>
<a href="#l91.15"></a><span id="l91.15">     do_timeout(5000, function() {</span>
<a href="#l91.16"></a><span id="l91.16">       // should be done by now</span>
<a href="#l91.17"></a><span id="l91.17">       do_check_true(false);</span>
<a href="#l91.18"></a><span id="l91.18">     });</span>
<a href="#l91.19"></a><span id="l91.19">  </span>
<a href="#l91.20"></a><span id="l91.20">     if (typeof localAccountUtils.inboxFolder == 'undefined')</span>
<a href="#l91.21"></a><span id="l91.21">       localAccountUtils.loadLocalMailAccount();</span>
<a href="#l91.22"></a><span id="l91.22" class="difflineat">@@ -39,17 +39,17 @@ var tests = [</span>
<a href="#l91.23"></a><span id="l91.23">     yield false;</span>
<a href="#l91.24"></a><span id="l91.24"> </span>
<a href="#l91.25"></a><span id="l91.25">     MailServices.copy.CopyFileMessage(gMsgFile2, gTargetFolder, null, false, 0,</span>
<a href="#l91.26"></a><span id="l91.26">                                       &quot;&quot;, asyncCopyListener, null);</span>
<a href="#l91.27"></a><span id="l91.27">     yield false;</span>
<a href="#l91.28"></a><span id="l91.28"> </span>
<a href="#l91.29"></a><span id="l91.29">   },</span>
<a href="#l91.30"></a><span id="l91.30"> </span>
<a href="#l91.31"></a><span id="l91.31" class="difflineminus">-  function firstUpdate()</span>
<a href="#l91.32"></a><span id="l91.32" class="difflineplus">+  function* firstUpdate()</span>
<a href="#l91.33"></a><span id="l91.33">   {</span>
<a href="#l91.34"></a><span id="l91.34">     // get message headers for the target folder</span>
<a href="#l91.35"></a><span id="l91.35">     let enumerator = gTargetFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l91.36"></a><span id="l91.36">     var msgCount = 0;</span>
<a href="#l91.37"></a><span id="l91.37">     while(enumerator.hasMoreElements())</span>
<a href="#l91.38"></a><span id="l91.38">     {</span>
<a href="#l91.39"></a><span id="l91.39">       msgCount++;</span>
<a href="#l91.40"></a><span id="l91.40">       let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l91.41"></a><span id="l91.41" class="difflineat">@@ -60,17 +60,17 @@ var tests = [</span>
<a href="#l91.42"></a><span id="l91.42">     // try an update</span>
<a href="#l91.43"></a><span id="l91.43">     mailTestUtils.updateFolderAndNotify(gTargetFolder, function () {</span>
<a href="#l91.44"></a><span id="l91.44">       dump(&quot;after FolderLoaded1\n&quot;);</span>
<a href="#l91.45"></a><span id="l91.45">       async_driver();</span>
<a href="#l91.46"></a><span id="l91.46">     });</span>
<a href="#l91.47"></a><span id="l91.47">     yield false;</span>
<a href="#l91.48"></a><span id="l91.48">   },</span>
<a href="#l91.49"></a><span id="l91.49"> </span>
<a href="#l91.50"></a><span id="l91.50" class="difflineminus">-  function secondUpdate()</span>
<a href="#l91.51"></a><span id="l91.51" class="difflineplus">+  function* secondUpdate()</span>
<a href="#l91.52"></a><span id="l91.52">   {</span>
<a href="#l91.53"></a><span id="l91.53">     // If the following executes, the test hangs in bug 787557.</span>
<a href="#l91.54"></a><span id="l91.54">     gTargetFolder.msgDatabase = null;</span>
<a href="#l91.55"></a><span id="l91.55">     // try an update</span>
<a href="#l91.56"></a><span id="l91.56">     mailTestUtils.updateFolderAndNotify(gTargetFolder, function () {</span>
<a href="#l91.57"></a><span id="l91.57">       dump(&quot;after FolderLoaded2\n&quot;);</span>
<a href="#l91.58"></a><span id="l91.58">       async_driver();</span>
<a href="#l91.59"></a><span id="l91.59">     });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l92.1"></a><span id="l92.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3PasswordFailure2.js</span>
<a href="#l92.2"></a><span id="l92.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3PasswordFailure2.js</span>
<a href="#l92.3"></a><span id="l92.3" class="difflineat">@@ -116,17 +116,17 @@ var tests = [</span>
<a href="#l92.4"></a><span id="l92.4">   endTest</span>
<a href="#l92.5"></a><span id="l92.5"> ]</span>
<a href="#l92.6"></a><span id="l92.6"> </span>
<a href="#l92.7"></a><span id="l92.7"> function actually_run_test() {</span>
<a href="#l92.8"></a><span id="l92.8">   daemon.setMessages([&quot;message1.eml&quot;]);</span>
<a href="#l92.9"></a><span id="l92.9">   async_run_tests(tests);</span>
<a href="#l92.10"></a><span id="l92.10"> }</span>
<a href="#l92.11"></a><span id="l92.11"> </span>
<a href="#l92.12"></a><span id="l92.12" class="difflineminus">-function getMail1() {</span>
<a href="#l92.13"></a><span id="l92.13" class="difflineplus">+function* getMail1() {</span>
<a href="#l92.14"></a><span id="l92.14">   dump(&quot;\nGet Mail 1\n&quot;);</span>
<a href="#l92.15"></a><span id="l92.15"> </span>
<a href="#l92.16"></a><span id="l92.16">   // Now get mail</span>
<a href="#l92.17"></a><span id="l92.17">   getPopMail();</span>
<a href="#l92.18"></a><span id="l92.18">   yield false;</span>
<a href="#l92.19"></a><span id="l92.19">   dump(&quot;\nGot Mail 1\n&quot;);</span>
<a href="#l92.20"></a><span id="l92.20"> </span>
<a href="#l92.21"></a><span id="l92.21">   do_check_eq(attempt, 2);</span>
<a href="#l92.22"></a><span id="l92.22" class="difflineat">@@ -139,26 +139,26 @@ function getMail1() {</span>
<a href="#l92.23"></a><span id="l92.23">   do_check_eq(count.value, 1);</span>
<a href="#l92.24"></a><span id="l92.24">   do_check_eq(logins[0].username, kUserName);</span>
<a href="#l92.25"></a><span id="l92.25">   do_check_eq(logins[0].password, kInvalidPassword);</span>
<a href="#l92.26"></a><span id="l92.26"> </span>
<a href="#l92.27"></a><span id="l92.27">   server.resetTest();</span>
<a href="#l92.28"></a><span id="l92.28">   yield true;</span>
<a href="#l92.29"></a><span id="l92.29"> }</span>
<a href="#l92.30"></a><span id="l92.30"> </span>
<a href="#l92.31"></a><span id="l92.31" class="difflineminus">-function getMail2() {</span>
<a href="#l92.32"></a><span id="l92.32" class="difflineplus">+function* getMail2() {</span>
<a href="#l92.33"></a><span id="l92.33">   dump(&quot;\nGet Mail 2\n&quot;);</span>
<a href="#l92.34"></a><span id="l92.34"> </span>
<a href="#l92.35"></a><span id="l92.35">   // Now get the mail</span>
<a href="#l92.36"></a><span id="l92.36">   getPopMail();</span>
<a href="#l92.37"></a><span id="l92.37">   yield false;</span>
<a href="#l92.38"></a><span id="l92.38">   dump(&quot;\nGot Mail 2\n&quot;);</span>
<a href="#l92.39"></a><span id="l92.39"> }</span>
<a href="#l92.40"></a><span id="l92.40"> </span>
<a href="#l92.41"></a><span id="l92.41" class="difflineminus">-function endTest() {</span>
<a href="#l92.42"></a><span id="l92.42" class="difflineplus">+function* endTest() {</span>
<a href="#l92.43"></a><span id="l92.43">   // Now check the new one has been saved.</span>
<a href="#l92.44"></a><span id="l92.44">   logins = Services.logins.findLogins(count, &quot;mailbox://localhost&quot;, null,</span>
<a href="#l92.45"></a><span id="l92.45">                                       &quot;mailbox://localhost&quot;);</span>
<a href="#l92.46"></a><span id="l92.46"> </span>
<a href="#l92.47"></a><span id="l92.47">   do_check_eq(count.value, 1);</span>
<a href="#l92.48"></a><span id="l92.48">   do_check_eq(logins[0].username, kUserName);</span>
<a href="#l92.49"></a><span id="l92.49">   do_check_eq(logins[0].password, kValidPassword);</span>
<a href="#l92.50"></a><span id="l92.50">   yield true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l93.1"></a><span id="l93.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3PasswordFailure3.js</span>
<a href="#l93.2"></a><span id="l93.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3PasswordFailure3.js</span>
<a href="#l93.3"></a><span id="l93.3" class="difflineat">@@ -118,17 +118,17 @@ var tests = [</span>
<a href="#l93.4"></a><span id="l93.4">   endTest</span>
<a href="#l93.5"></a><span id="l93.5"> ]</span>
<a href="#l93.6"></a><span id="l93.6"> </span>
<a href="#l93.7"></a><span id="l93.7"> function actually_run_test() {</span>
<a href="#l93.8"></a><span id="l93.8">   daemon.setMessages([&quot;message1.eml&quot;]);</span>
<a href="#l93.9"></a><span id="l93.9">   async_run_tests(tests);</span>
<a href="#l93.10"></a><span id="l93.10"> }</span>
<a href="#l93.11"></a><span id="l93.11"> </span>
<a href="#l93.12"></a><span id="l93.12" class="difflineminus">-function getMail1() {</span>
<a href="#l93.13"></a><span id="l93.13" class="difflineplus">+function* getMail1() {</span>
<a href="#l93.14"></a><span id="l93.14">   dump(&quot;\nGet Mail 1\n&quot;);</span>
<a href="#l93.15"></a><span id="l93.15"> </span>
<a href="#l93.16"></a><span id="l93.16">   // Now get mail</span>
<a href="#l93.17"></a><span id="l93.17">   getPopMail();</span>
<a href="#l93.18"></a><span id="l93.18">   yield false;</span>
<a href="#l93.19"></a><span id="l93.19">   dump(&quot;\nGot Mail 1\n&quot;);</span>
<a href="#l93.20"></a><span id="l93.20"> </span>
<a href="#l93.21"></a><span id="l93.21">   do_check_eq(attempt, 2);</span>
<a href="#l93.22"></a><span id="l93.22" class="difflineat">@@ -141,26 +141,26 @@ function getMail1() {</span>
<a href="#l93.23"></a><span id="l93.23">   do_check_eq(count.value, 1);</span>
<a href="#l93.24"></a><span id="l93.24">   do_check_eq(logins[0].username, kUserName);</span>
<a href="#l93.25"></a><span id="l93.25">   do_check_eq(logins[0].password, kInvalidPassword);</span>
<a href="#l93.26"></a><span id="l93.26"> </span>
<a href="#l93.27"></a><span id="l93.27">   server.resetTest();</span>
<a href="#l93.28"></a><span id="l93.28">   yield true;</span>
<a href="#l93.29"></a><span id="l93.29"> }</span>
<a href="#l93.30"></a><span id="l93.30"> </span>
<a href="#l93.31"></a><span id="l93.31" class="difflineminus">-function getMail2() {</span>
<a href="#l93.32"></a><span id="l93.32" class="difflineplus">+function* getMail2() {</span>
<a href="#l93.33"></a><span id="l93.33">   dump(&quot;\nGet Mail 2\n&quot;);</span>
<a href="#l93.34"></a><span id="l93.34"> </span>
<a href="#l93.35"></a><span id="l93.35">   // Now get the mail</span>
<a href="#l93.36"></a><span id="l93.36">   getPopMail();</span>
<a href="#l93.37"></a><span id="l93.37">   yield false;</span>
<a href="#l93.38"></a><span id="l93.38">   dump(&quot;\nGot Mail 2\n&quot;);</span>
<a href="#l93.39"></a><span id="l93.39"> }</span>
<a href="#l93.40"></a><span id="l93.40"> </span>
<a href="#l93.41"></a><span id="l93.41" class="difflineminus">-function endTest() {</span>
<a href="#l93.42"></a><span id="l93.42" class="difflineplus">+function* endTest() {</span>
<a href="#l93.43"></a><span id="l93.43">   // Now check the new one has been saved.</span>
<a href="#l93.44"></a><span id="l93.44">   logins = Services.logins.findLogins(count, &quot;mailbox://localhost&quot;, null,</span>
<a href="#l93.45"></a><span id="l93.45">                                       &quot;mailbox://localhost&quot;);</span>
<a href="#l93.46"></a><span id="l93.46"> </span>
<a href="#l93.47"></a><span id="l93.47">   do_check_eq(count.value, 1);</span>
<a href="#l93.48"></a><span id="l93.48">   do_check_eq(logins[0].username, kUserName);</span>
<a href="#l93.49"></a><span id="l93.49">   do_check_eq(logins[0].password, kValidPassword);</span>
<a href="#l93.50"></a><span id="l93.50">   yield true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l94.1"></a><span id="l94.1" class="difflineminus">--- a/mailnews/local/test/unit/test_streamHeaders.js</span>
<a href="#l94.2"></a><span id="l94.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_streamHeaders.js</span>
<a href="#l94.3"></a><span id="l94.3" class="difflineat">@@ -23,17 +23,17 @@ var tests = [loadMessages,</span>
<a href="#l94.4"></a><span id="l94.4">             ];</span>
<a href="#l94.5"></a><span id="l94.5"> </span>
<a href="#l94.6"></a><span id="l94.6"> function run_test()</span>
<a href="#l94.7"></a><span id="l94.7"> {</span>
<a href="#l94.8"></a><span id="l94.8">   async_run_tests(tests);</span>
<a href="#l94.9"></a><span id="l94.9"> }</span>
<a href="#l94.10"></a><span id="l94.10"> </span>
<a href="#l94.11"></a><span id="l94.11"> var gHdr;</span>
<a href="#l94.12"></a><span id="l94.12" class="difflineminus">-function loadMessages()</span>
<a href="#l94.13"></a><span id="l94.13" class="difflineplus">+function* loadMessages()</span>
<a href="#l94.14"></a><span id="l94.14"> {</span>
<a href="#l94.15"></a><span id="l94.15">   gPOP3Pump.files = [&quot;../../../data/draft1&quot;];</span>
<a href="#l94.16"></a><span id="l94.16">   gPOP3Pump.onDone = async_driver;</span>
<a href="#l94.17"></a><span id="l94.17">   gPOP3Pump.run();</span>
<a href="#l94.18"></a><span id="l94.18">   yield false;</span>
<a href="#l94.19"></a><span id="l94.19"> </span>
<a href="#l94.20"></a><span id="l94.20">   // get message headers for the inbox folder</span>
<a href="#l94.21"></a><span id="l94.21">   let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l94.22"></a><span id="l94.22" class="difflineat">@@ -43,17 +43,17 @@ function loadMessages()</span>
<a href="#l94.23"></a><span id="l94.23">     msgCount++;</span>
<a href="#l94.24"></a><span id="l94.24">     gHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l94.25"></a><span id="l94.25">     do_check_eq(gHdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l94.26"></a><span id="l94.26">   }</span>
<a href="#l94.27"></a><span id="l94.27">   do_check_eq(msgCount, 1);</span>
<a href="#l94.28"></a><span id="l94.28">   gPOP3Pump = null;</span>
<a href="#l94.29"></a><span id="l94.29"> }</span>
<a href="#l94.30"></a><span id="l94.30"> </span>
<a href="#l94.31"></a><span id="l94.31" class="difflineminus">-function goodStreaming()</span>
<a href="#l94.32"></a><span id="l94.32" class="difflineplus">+function* goodStreaming()</span>
<a href="#l94.33"></a><span id="l94.33"> {</span>
<a href="#l94.34"></a><span id="l94.34">   // try to stream the headers of the last message</span>
<a href="#l94.35"></a><span id="l94.35">   let uri = gHdr.folder.getUriForMsg(gHdr);</span>
<a href="#l94.36"></a><span id="l94.36">   let messageService = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger)</span>
<a href="#l94.37"></a><span id="l94.37">                                                      .messageServiceFromURI(uri);</span>
<a href="#l94.38"></a><span id="l94.38">   messageService.streamHeaders(uri, createStreamListener(</span>
<a href="#l94.39"></a><span id="l94.39">     function theString(k) {</span>
<a href="#l94.40"></a><span id="l94.40">       dump('the string:\n' + k + '\n');</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l95.1"></a><span id="l95.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_alternate_p7m_handling.js</span>
<a href="#l95.2"></a><span id="l95.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_alternate_p7m_handling.js</span>
<a href="#l95.3"></a><span id="l95.3" class="difflineat">@@ -24,17 +24,17 @@ var messages = [{</span>
<a href="#l95.4"></a><span id="l95.4">     format:'',</span>
<a href="#l95.5"></a><span id="l95.5">     encoding: &quot;base64&quot;</span>
<a href="#l95.6"></a><span id="l95.6">   }]</span>
<a href="#l95.7"></a><span id="l95.7"> }];</span>
<a href="#l95.8"></a><span id="l95.8"> </span>
<a href="#l95.9"></a><span id="l95.9"> var msgWindow = Cc[&quot;@mozilla.org/messenger/msgwindow;1&quot;]</span>
<a href="#l95.10"></a><span id="l95.10">                   .createInstance(Ci.nsIMsgWindow);</span>
<a href="#l95.11"></a><span id="l95.11"> </span>
<a href="#l95.12"></a><span id="l95.12" class="difflineminus">-function thunderbird_default(info) {</span>
<a href="#l95.13"></a><span id="l95.13" class="difflineplus">+function* thunderbird_default(info) {</span>
<a href="#l95.14"></a><span id="l95.14">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l95.15"></a><span id="l95.15">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l95.16"></a><span id="l95.16">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l95.17"></a><span id="l95.17"> </span>
<a href="#l95.18"></a><span id="l95.18">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l95.19"></a><span id="l95.19"> </span>
<a href="#l95.20"></a><span id="l95.20">   MsgHdrToMimeMessage(msgHdr, null, function (aMsgHdr, aMimeMsg) {</span>
<a href="#l95.21"></a><span id="l95.21">     try {</span>
<a href="#l95.22"></a><span id="l95.22" class="difflineat">@@ -44,17 +44,17 @@ function thunderbird_default(info) {</span>
<a href="#l95.23"></a><span id="l95.23">     } catch (err) {</span>
<a href="#l95.24"></a><span id="l95.24">       do_throw(err);</span>
<a href="#l95.25"></a><span id="l95.25">     }</span>
<a href="#l95.26"></a><span id="l95.26">   });</span>
<a href="#l95.27"></a><span id="l95.27"> </span>
<a href="#l95.28"></a><span id="l95.28">   yield false;</span>
<a href="#l95.29"></a><span id="l95.29"> }</span>
<a href="#l95.30"></a><span id="l95.30"> </span>
<a href="#l95.31"></a><span id="l95.31" class="difflineminus">-function set_preference_to_true(info) {</span>
<a href="#l95.32"></a><span id="l95.32" class="difflineplus">+function* set_preference_to_true(info) {</span>
<a href="#l95.33"></a><span id="l95.33">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l95.34"></a><span id="l95.34">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l95.35"></a><span id="l95.35">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l95.36"></a><span id="l95.36"> </span>
<a href="#l95.37"></a><span id="l95.37">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l95.38"></a><span id="l95.38"> </span>
<a href="#l95.39"></a><span id="l95.39">   Services.prefs.setBoolPref(&quot;mailnews.p7m_external&quot;, true);</span>
<a href="#l95.40"></a><span id="l95.40"> </span>
<a href="#l95.41"></a><span id="l95.41" class="difflineat">@@ -67,17 +67,17 @@ function set_preference_to_true(info) {</span>
<a href="#l95.42"></a><span id="l95.42">     } catch (err) {</span>
<a href="#l95.43"></a><span id="l95.43">       do_throw(err);</span>
<a href="#l95.44"></a><span id="l95.44">     }</span>
<a href="#l95.45"></a><span id="l95.45">   });</span>
<a href="#l95.46"></a><span id="l95.46"> </span>
<a href="#l95.47"></a><span id="l95.47">   yield false;</span>
<a href="#l95.48"></a><span id="l95.48"> }</span>
<a href="#l95.49"></a><span id="l95.49"> </span>
<a href="#l95.50"></a><span id="l95.50" class="difflineminus">-function set_preference_to_false(info) {</span>
<a href="#l95.51"></a><span id="l95.51" class="difflineplus">+function* set_preference_to_false(info) {</span>
<a href="#l95.52"></a><span id="l95.52">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l95.53"></a><span id="l95.53">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l95.54"></a><span id="l95.54">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l95.55"></a><span id="l95.55"> </span>
<a href="#l95.56"></a><span id="l95.56">   let msgHdr = synSet.getMsgHdr(0);</span>
<a href="#l95.57"></a><span id="l95.57"> </span>
<a href="#l95.58"></a><span id="l95.58">   Services.prefs.setBoolPref(&quot;mailnews.p7m_external&quot;, false);</span>
<a href="#l95.59"></a><span id="l95.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l96.1"></a><span id="l96.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_attachment_size.js</span>
<a href="#l96.2"></a><span id="l96.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_attachment_size.js</span>
<a href="#l96.3"></a><span id="l96.3" class="difflineat">@@ -237,17 +237,17 @@ var gMessageHeaderSink = {</span>
<a href="#l96.4"></a><span id="l96.4">   properties: null,</span>
<a href="#l96.5"></a><span id="l96.5">   resetProperties: function () {}</span>
<a href="#l96.6"></a><span id="l96.6"> };</span>
<a href="#l96.7"></a><span id="l96.7"> </span>
<a href="#l96.8"></a><span id="l96.8"> var msgWindow = Cc[&quot;@mozilla.org/messenger/msgwindow;1&quot;]</span>
<a href="#l96.9"></a><span id="l96.9">                   .createInstance(Ci.nsIMsgWindow);</span>
<a href="#l96.10"></a><span id="l96.10"> msgWindow.msgHeaderSink = gMessageHeaderSink;</span>
<a href="#l96.11"></a><span id="l96.11"> </span>
<a href="#l96.12"></a><span id="l96.12" class="difflineminus">-function test_message_attachments(info) {</span>
<a href="#l96.13"></a><span id="l96.13" class="difflineplus">+function* test_message_attachments(info) {</span>
<a href="#l96.14"></a><span id="l96.14">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l96.15"></a><span id="l96.15">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l96.16"></a><span id="l96.16">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l96.17"></a><span id="l96.17"> </span>
<a href="#l96.18"></a><span id="l96.18">   let msgURI = synSet.getMsgURI(0);</span>
<a href="#l96.19"></a><span id="l96.19">   let msgService = gMessenger.messageServiceFromURI(msgURI);</span>
<a href="#l96.20"></a><span id="l96.20"> </span>
<a href="#l96.21"></a><span id="l96.21">   gStreamListener.expectedSize = info.size;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l97.1"></a><span id="l97.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_badContentType.js</span>
<a href="#l97.2"></a><span id="l97.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_badContentType.js</span>
<a href="#l97.3"></a><span id="l97.3" class="difflineat">@@ -96,17 +96,17 @@ var gMessageHeaderSink = {</span>
<a href="#l97.4"></a><span id="l97.4">   properties: null,</span>
<a href="#l97.5"></a><span id="l97.5">   resetProperties: function () {}</span>
<a href="#l97.6"></a><span id="l97.6"> };</span>
<a href="#l97.7"></a><span id="l97.7"> </span>
<a href="#l97.8"></a><span id="l97.8"> var msgWindow = Cc[&quot;@mozilla.org/messenger/msgwindow;1&quot;]</span>
<a href="#l97.9"></a><span id="l97.9">                   .createInstance(Ci.nsIMsgWindow);</span>
<a href="#l97.10"></a><span id="l97.10"> msgWindow.msgHeaderSink = gMessageHeaderSink;</span>
<a href="#l97.11"></a><span id="l97.11"> </span>
<a href="#l97.12"></a><span id="l97.12" class="difflineminus">-function test_message_attachments(info) {</span>
<a href="#l97.13"></a><span id="l97.13" class="difflineplus">+function* test_message_attachments(info) {</span>
<a href="#l97.14"></a><span id="l97.14">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l97.15"></a><span id="l97.15">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l97.16"></a><span id="l97.16">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l97.17"></a><span id="l97.17"> </span>
<a href="#l97.18"></a><span id="l97.18">   let msgURI = synSet.getMsgURI(0);</span>
<a href="#l97.19"></a><span id="l97.19">   let msgService = gMessenger.messageServiceFromURI(msgURI);</span>
<a href="#l97.20"></a><span id="l97.20"> </span>
<a href="#l97.21"></a><span id="l97.21">   gStreamListener.expectedContentType = info.testContentType;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l98.1"></a><span id="l98.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_hidden_attachments.js</span>
<a href="#l98.2"></a><span id="l98.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_hidden_attachments.js</span>
<a href="#l98.3"></a><span id="l98.3" class="difflineat">@@ -152,17 +152,17 @@ var gMessageHeaderSink = {</span>
<a href="#l98.4"></a><span id="l98.4">   properties: null,</span>
<a href="#l98.5"></a><span id="l98.5">   resetProperties: function () {}</span>
<a href="#l98.6"></a><span id="l98.6"> };</span>
<a href="#l98.7"></a><span id="l98.7"> </span>
<a href="#l98.8"></a><span id="l98.8"> var msgWindow = Cc[&quot;@mozilla.org/messenger/msgwindow;1&quot;]</span>
<a href="#l98.9"></a><span id="l98.9">                   .createInstance(Ci.nsIMsgWindow);</span>
<a href="#l98.10"></a><span id="l98.10"> msgWindow.msgHeaderSink = gMessageHeaderSink;</span>
<a href="#l98.11"></a><span id="l98.11"> </span>
<a href="#l98.12"></a><span id="l98.12" class="difflineminus">-function test_message_attachments(info) {</span>
<a href="#l98.13"></a><span id="l98.13" class="difflineplus">+function* test_message_attachments(info) {</span>
<a href="#l98.14"></a><span id="l98.14">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l98.15"></a><span id="l98.15">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l98.16"></a><span id="l98.16">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l98.17"></a><span id="l98.17"> </span>
<a href="#l98.18"></a><span id="l98.18">   let msgURI = synSet.getMsgURI(0);</span>
<a href="#l98.19"></a><span id="l98.19">   let msgService = gMessenger.messageServiceFromURI(msgURI);</span>
<a href="#l98.20"></a><span id="l98.20"> </span>
<a href="#l98.21"></a><span id="l98.21">   gStreamListener.allAttachments = info.attachments || [];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l99.1"></a><span id="l99.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_message_attachment.js</span>
<a href="#l99.2"></a><span id="l99.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_message_attachment.js</span>
<a href="#l99.3"></a><span id="l99.3" class="difflineat">@@ -115,17 +115,17 @@ var gMessageHeaderSink = {</span>
<a href="#l99.4"></a><span id="l99.4">   properties: null,</span>
<a href="#l99.5"></a><span id="l99.5">   resetProperties: function () {}</span>
<a href="#l99.6"></a><span id="l99.6"> };</span>
<a href="#l99.7"></a><span id="l99.7"> </span>
<a href="#l99.8"></a><span id="l99.8"> var msgWindow = Cc[&quot;@mozilla.org/messenger/msgwindow;1&quot;]</span>
<a href="#l99.9"></a><span id="l99.9">                   .createInstance(Ci.nsIMsgWindow);</span>
<a href="#l99.10"></a><span id="l99.10"> msgWindow.msgHeaderSink = gMessageHeaderSink;</span>
<a href="#l99.11"></a><span id="l99.11"> </span>
<a href="#l99.12"></a><span id="l99.12" class="difflineminus">-function test_message_attachments(info) {</span>
<a href="#l99.13"></a><span id="l99.13" class="difflineplus">+function* test_message_attachments(info) {</span>
<a href="#l99.14"></a><span id="l99.14">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l99.15"></a><span id="l99.15">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l99.16"></a><span id="l99.16">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l99.17"></a><span id="l99.17"> </span>
<a href="#l99.18"></a><span id="l99.18">   let msgURI = synSet.getMsgURI(0);</span>
<a href="#l99.19"></a><span id="l99.19">   let msgService = gMessenger.messageServiceFromURI(msgURI);</span>
<a href="#l99.20"></a><span id="l99.20"> </span>
<a href="#l99.21"></a><span id="l99.21">   let streamURI = msgService.streamMessage(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l100.1"></a><span id="l100.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_rfc822_body.js</span>
<a href="#l100.2"></a><span id="l100.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_rfc822_body.js</span>
<a href="#l100.3"></a><span id="l100.3" class="difflineat">@@ -81,17 +81,17 @@ var gMessageHeaderSink = {</span>
<a href="#l100.4"></a><span id="l100.4">     this.attachmentCount = 0;</span>
<a href="#l100.5"></a><span id="l100.5">   },</span>
<a href="#l100.6"></a><span id="l100.6"> };</span>
<a href="#l100.7"></a><span id="l100.7"> </span>
<a href="#l100.8"></a><span id="l100.8"> var msgWindow = Cc[&quot;@mozilla.org/messenger/msgwindow;1&quot;]</span>
<a href="#l100.9"></a><span id="l100.9">                   .createInstance(Ci.nsIMsgWindow);</span>
<a href="#l100.10"></a><span id="l100.10"> msgWindow.msgHeaderSink = gMessageHeaderSink;</span>
<a href="#l100.11"></a><span id="l100.11"> </span>
<a href="#l100.12"></a><span id="l100.12" class="difflineminus">-function help_test_rfc822_body(info, inline) {</span>
<a href="#l100.13"></a><span id="l100.13" class="difflineplus">+function* help_test_rfc822_body(info, inline) {</span>
<a href="#l100.14"></a><span id="l100.14">   Services.prefs.setBoolPref(&quot;mail.inline_attachments&quot;, inline);</span>
<a href="#l100.15"></a><span id="l100.15">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l100.16"></a><span id="l100.16">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l100.17"></a><span id="l100.17">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l100.18"></a><span id="l100.18"> </span>
<a href="#l100.19"></a><span id="l100.19">   let msgURI = synSet.getMsgURI(0);</span>
<a href="#l100.20"></a><span id="l100.20">   let msgService = gMessenger.messageServiceFromURI(msgURI);</span>
<a href="#l100.21"></a><span id="l100.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l101.1"></a><span id="l101.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_text_attachment.js</span>
<a href="#l101.2"></a><span id="l101.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_text_attachment.js</span>
<a href="#l101.3"></a><span id="l101.3" class="difflineat">@@ -58,17 +58,17 @@ var gStreamListener = {</span>
<a href="#l101.4"></a><span id="l101.4">     }</span>
<a href="#l101.5"></a><span id="l101.5">     this._str += this._stream.read(aCount);</span>
<a href="#l101.6"></a><span id="l101.6">   },</span>
<a href="#l101.7"></a><span id="l101.7"> };</span>
<a href="#l101.8"></a><span id="l101.8"> </span>
<a href="#l101.9"></a><span id="l101.9"> var msgWindow = Cc[&quot;@mozilla.org/messenger/msgwindow;1&quot;]</span>
<a href="#l101.10"></a><span id="l101.10">                   .createInstance(Ci.nsIMsgWindow);</span>
<a href="#l101.11"></a><span id="l101.11"> </span>
<a href="#l101.12"></a><span id="l101.12" class="difflineminus">-function test_message_attachments(info) {</span>
<a href="#l101.13"></a><span id="l101.13" class="difflineplus">+function* test_message_attachments(info) {</span>
<a href="#l101.14"></a><span id="l101.14">   let synMsg = gMessageGenerator.makeMessage(info);</span>
<a href="#l101.15"></a><span id="l101.15">   let synSet = new SyntheticMessageSet([synMsg]);</span>
<a href="#l101.16"></a><span id="l101.16">   yield add_sets_to_folder(gInbox, [synSet]);</span>
<a href="#l101.17"></a><span id="l101.17"> </span>
<a href="#l101.18"></a><span id="l101.18">   let msgURI = synSet.getMsgURI(0);</span>
<a href="#l101.19"></a><span id="l101.19">   let msgService = gMessenger.messageServiceFromURI(msgURI);</span>
<a href="#l101.20"></a><span id="l101.20"> </span>
<a href="#l101.21"></a><span id="l101.21">   let streamURI = msgService.streamMessage(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l102.1"></a><span id="l102.1" class="difflineminus">--- a/mailnews/news/test/unit/test_bug695309.js</span>
<a href="#l102.2"></a><span id="l102.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_bug695309.js</span>
<a href="#l102.3"></a><span id="l102.3" class="difflineat">@@ -27,17 +27,17 @@ var killConnection = false;</span>
<a href="#l102.4"></a><span id="l102.4"> var highWater = 0;</span>
<a href="#l102.5"></a><span id="l102.5"> </span>
<a href="#l102.6"></a><span id="l102.6"> var tests = [</span>
<a href="#l102.7"></a><span id="l102.7">   test_newMsgs,</span>
<a href="#l102.8"></a><span id="l102.8">   trigger_bug,</span>
<a href="#l102.9"></a><span id="l102.9">   cleanUp</span>
<a href="#l102.10"></a><span id="l102.10"> ];</span>
<a href="#l102.11"></a><span id="l102.11"> </span>
<a href="#l102.12"></a><span id="l102.12" class="difflineminus">-function test_newMsgs() {</span>
<a href="#l102.13"></a><span id="l102.13" class="difflineplus">+function* test_newMsgs() {</span>
<a href="#l102.14"></a><span id="l102.14">   // Start by initializing the folder, and mark some messages as read.</span>
<a href="#l102.15"></a><span id="l102.15">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l102.16"></a><span id="l102.16">   do_check_eq(folder.getTotalMessages(false), 0);</span>
<a href="#l102.17"></a><span id="l102.17">   folder.getNewMessages(null, asyncUrlListener);</span>
<a href="#l102.18"></a><span id="l102.18">   // Do another folder to use up both connections</span>
<a href="#l102.19"></a><span id="l102.19">   localserver.rootFolder.getChildNamed(&quot;test.subscribe.simple&quot;)</span>
<a href="#l102.20"></a><span id="l102.20">                         .getNewMessages(null, asyncUrlListener);</span>
<a href="#l102.21"></a><span id="l102.21">   // Two things to listen for -- yield twice</span>
<a href="#l102.22"></a><span id="l102.22" class="difflineat">@@ -45,17 +45,17 @@ function test_newMsgs() {</span>
<a href="#l102.23"></a><span id="l102.23">   yield false;</span>
<a href="#l102.24"></a><span id="l102.24">   folder.QueryInterface(Ci.nsIMsgNewsFolder)</span>
<a href="#l102.25"></a><span id="l102.25">         .setReadSetFromStr(&quot;1-3&quot;);</span>
<a href="#l102.26"></a><span id="l102.26">   do_check_eq(folder.getTotalMessages(false) - folder.getNumUnread(false), 3);</span>
<a href="#l102.27"></a><span id="l102.27">   highWater = folder.getTotalMessages(false);</span>
<a href="#l102.28"></a><span id="l102.28">   do_check_eq(folder.msgDatabase.dBFolderInfo.highWater, highWater);</span>
<a href="#l102.29"></a><span id="l102.29"> }</span>
<a href="#l102.30"></a><span id="l102.30"> </span>
<a href="#l102.31"></a><span id="l102.31" class="difflineminus">-function trigger_bug() {</span>
<a href="#l102.32"></a><span id="l102.32" class="difflineplus">+function* trigger_bug() {</span>
<a href="#l102.33"></a><span id="l102.33">   // Kill the connection and start it up again.</span>
<a href="#l102.34"></a><span id="l102.34">   dump(&quot;Stopping server!\n&quot;);</span>
<a href="#l102.35"></a><span id="l102.35">   server.stop();</span>
<a href="#l102.36"></a><span id="l102.36">   server.start();</span>
<a href="#l102.37"></a><span id="l102.37"> </span>
<a href="#l102.38"></a><span id="l102.38">   // Get new messages for all folders. Once we've seen one folder, trigger a</span>
<a href="#l102.39"></a><span id="l102.39">   // load of the folder in question. This second load should, if the bug is</span>
<a href="#l102.40"></a><span id="l102.40">   // present, be overwritten with one from the load queue that causes the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l103.1"></a><span id="l103.1" class="difflineminus">--- a/mailnews/news/test/unit/test_internalUris.js</span>
<a href="#l103.2"></a><span id="l103.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_internalUris.js</span>
<a href="#l103.3"></a><span id="l103.3" class="difflineat">@@ -33,31 +33,31 @@ var tests = [</span>
<a href="#l103.4"></a><span id="l103.4">   test_fetchMessage,</span>
<a href="#l103.5"></a><span id="l103.5">   test_search,</span>
<a href="#l103.6"></a><span id="l103.6">   test_grouplist,</span>
<a href="#l103.7"></a><span id="l103.7">   test_postMessage,</span>
<a href="#l103.8"></a><span id="l103.8">   test_escapedName,</span>
<a href="#l103.9"></a><span id="l103.9">   cleanUp</span>
<a href="#l103.10"></a><span id="l103.10"> ];</span>
<a href="#l103.11"></a><span id="l103.11"> </span>
<a href="#l103.12"></a><span id="l103.12" class="difflineminus">-function test_newMsgs() {</span>
<a href="#l103.13"></a><span id="l103.13" class="difflineplus">+function* test_newMsgs() {</span>
<a href="#l103.14"></a><span id="l103.14">   // This tests nsMsgNewsFolder::GetNewsMessages via getNewMessages</span>
<a href="#l103.15"></a><span id="l103.15">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l103.16"></a><span id="l103.16">   do_check_eq(folder.getTotalMessages(false), 0);</span>
<a href="#l103.17"></a><span id="l103.17">   folder.getNewMessages(null, asyncUrlListener);</span>
<a href="#l103.18"></a><span id="l103.18">   yield false;</span>
<a href="#l103.19"></a><span id="l103.19">   do_check_eq(folder.getTotalMessages(false), 8);</span>
<a href="#l103.20"></a><span id="l103.20">   yield true;</span>
<a href="#l103.21"></a><span id="l103.21"> }</span>
<a href="#l103.22"></a><span id="l103.22"> </span>
<a href="#l103.23"></a><span id="l103.23"> // Prompts for cancel</span>
<a href="#l103.24"></a><span id="l103.24"> function alert(title, text) {}</span>
<a href="#l103.25"></a><span id="l103.25"> function confirmEx(title, text, flags) {  return 0; }</span>
<a href="#l103.26"></a><span id="l103.26"> </span>
<a href="#l103.27"></a><span id="l103.27" class="difflineminus">-function test_cancel() {</span>
<a href="#l103.28"></a><span id="l103.28" class="difflineplus">+function* test_cancel() {</span>
<a href="#l103.29"></a><span id="l103.29">   // This tests nsMsgNewsFolder::CancelMessage</span>
<a href="#l103.30"></a><span id="l103.30">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l103.31"></a><span id="l103.31">   let db = folder.msgDatabase;</span>
<a href="#l103.32"></a><span id="l103.32">   let hdr = db.GetMsgHdrForKey(4);</span>
<a href="#l103.33"></a><span id="l103.33"> </span>
<a href="#l103.34"></a><span id="l103.34">   let atomService = Cc['@mozilla.org/atom-service;1']</span>
<a href="#l103.35"></a><span id="l103.35">                       .getService(Ci.nsIAtomService);</span>
<a href="#l103.36"></a><span id="l103.36">   let kDeleteAtom = atomService.getAtom(&quot;DeleteOrMoveMsgCompleted&quot;);</span>
<a href="#l103.37"></a><span id="l103.37" class="difflineat">@@ -72,17 +72,17 @@ function test_cancel() {</span>
<a href="#l103.38"></a><span id="l103.38">   folder.QueryInterface(Ci.nsIMsgNewsFolder)</span>
<a href="#l103.39"></a><span id="l103.39">         .cancelMessage(hdr, dummyMsgWindow);</span>
<a href="#l103.40"></a><span id="l103.40">   yield false;</span>
<a href="#l103.41"></a><span id="l103.41"> </span>
<a href="#l103.42"></a><span id="l103.42">   do_check_eq(folder.getTotalMessages(false), 7);</span>
<a href="#l103.43"></a><span id="l103.43">   yield true;</span>
<a href="#l103.44"></a><span id="l103.44"> }</span>
<a href="#l103.45"></a><span id="l103.45"> </span>
<a href="#l103.46"></a><span id="l103.46" class="difflineminus">-function test_fetchMessage() {</span>
<a href="#l103.47"></a><span id="l103.47" class="difflineplus">+function* test_fetchMessage() {</span>
<a href="#l103.48"></a><span id="l103.48">   // Tests nsNntpService::CreateMessageIDURL via FetchMessage</span>
<a href="#l103.49"></a><span id="l103.49">   var statuscode = -1;</span>
<a href="#l103.50"></a><span id="l103.50">   let streamlistener = {</span>
<a href="#l103.51"></a><span id="l103.51">     onDataAvailable: function() {},</span>
<a href="#l103.52"></a><span id="l103.52">     onStartRequest: function() {</span>
<a href="#l103.53"></a><span id="l103.53">     },</span>
<a href="#l103.54"></a><span id="l103.54">     onStopRequest: function (aRequest, aContext, aStatus) {</span>
<a href="#l103.55"></a><span id="l103.55">       statuscode = aStatus;</span>
<a href="#l103.56"></a><span id="l103.56" class="difflineat">@@ -92,17 +92,17 @@ function test_fetchMessage() {</span>
<a href="#l103.57"></a><span id="l103.57">   };</span>
<a href="#l103.58"></a><span id="l103.58">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l103.59"></a><span id="l103.59">   MailServices.nntp.fetchMessage(folder, 2, null, streamlistener, asyncUrlListener);</span>
<a href="#l103.60"></a><span id="l103.60">   yield false;</span>
<a href="#l103.61"></a><span id="l103.61">   do_check_eq(statuscode, Components.results.NS_OK);</span>
<a href="#l103.62"></a><span id="l103.62">   yield true;</span>
<a href="#l103.63"></a><span id="l103.63"> }</span>
<a href="#l103.64"></a><span id="l103.64"> </span>
<a href="#l103.65"></a><span id="l103.65" class="difflineminus">-function test_search() {</span>
<a href="#l103.66"></a><span id="l103.66" class="difflineplus">+function* test_search() {</span>
<a href="#l103.67"></a><span id="l103.67">   // This tests nsNntpService::Search</span>
<a href="#l103.68"></a><span id="l103.68">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l103.69"></a><span id="l103.69">   var searchSession = Cc[&quot;@mozilla.org/messenger/searchSession;1&quot;]</span>
<a href="#l103.70"></a><span id="l103.70">                         .createInstance(Ci.nsIMsgSearchSession);</span>
<a href="#l103.71"></a><span id="l103.71">   searchSession.addScopeTerm(Ci.nsMsgSearchScope.news, folder);</span>
<a href="#l103.72"></a><span id="l103.72"> </span>
<a href="#l103.73"></a><span id="l103.73">   let searchTerm = searchSession.createTerm();</span>
<a href="#l103.74"></a><span id="l103.74">   searchTerm.attrib = Ci.nsMsgSearchAttrib.Subject;</span>
<a href="#l103.75"></a><span id="l103.75" class="difflineat">@@ -126,17 +126,17 @@ function test_search() {</span>
<a href="#l103.76"></a><span id="l103.76"> </span>
<a href="#l103.77"></a><span id="l103.77">   searchSession.search(null);</span>
<a href="#l103.78"></a><span id="l103.78">   yield false;</span>
<a href="#l103.79"></a><span id="l103.79"> </span>
<a href="#l103.80"></a><span id="l103.80">   do_check_eq(hitCount, 1);</span>
<a href="#l103.81"></a><span id="l103.81">   yield true;</span>
<a href="#l103.82"></a><span id="l103.82"> }</span>
<a href="#l103.83"></a><span id="l103.83"> </span>
<a href="#l103.84"></a><span id="l103.84" class="difflineminus">-function test_grouplist() {</span>
<a href="#l103.85"></a><span id="l103.85" class="difflineplus">+function* test_grouplist() {</span>
<a href="#l103.86"></a><span id="l103.86">   // This tests nsNntpService::GetListOfGroupsOnServer</span>
<a href="#l103.87"></a><span id="l103.87">   let subserver = localserver.QueryInterface(Ci.nsISubscribableServer);</span>
<a href="#l103.88"></a><span id="l103.88">   let subscribeListener = {</span>
<a href="#l103.89"></a><span id="l103.89">     OnDonePopulating: function () { async_driver(); }</span>
<a href="#l103.90"></a><span id="l103.90">   };</span>
<a href="#l103.91"></a><span id="l103.91">   subserver.subscribeListener = subscribeListener;</span>
<a href="#l103.92"></a><span id="l103.92"> </span>
<a href="#l103.93"></a><span id="l103.93">   function enumGroups(rootUri) {</span>
<a href="#l103.94"></a><span id="l103.94" class="difflineat">@@ -158,17 +158,17 @@ function test_grouplist() {</span>
<a href="#l103.95"></a><span id="l103.95">   yield false;</span>
<a href="#l103.96"></a><span id="l103.96"> </span>
<a href="#l103.97"></a><span id="l103.97">   let groups = enumGroups(&quot;&quot;);</span>
<a href="#l103.98"></a><span id="l103.98">   for (let group in daemon._groups)</span>
<a href="#l103.99"></a><span id="l103.99">     do_check_true(groups.indexOf(group) &gt;= 0);</span>
<a href="#l103.100"></a><span id="l103.100">   yield true;</span>
<a href="#l103.101"></a><span id="l103.101"> }</span>
<a href="#l103.102"></a><span id="l103.102"> </span>
<a href="#l103.103"></a><span id="l103.103" class="difflineminus">-function test_postMessage() {</span>
<a href="#l103.104"></a><span id="l103.104" class="difflineplus">+function* test_postMessage() {</span>
<a href="#l103.105"></a><span id="l103.105">   // This tests nsNntpService::SetUpNntpUrlForPosting via PostMessage</span>
<a href="#l103.106"></a><span id="l103.106">   MailServices.nntp.postMessage(do_get_file(&quot;postings/post2.eml&quot;), &quot;misc.test&quot;,</span>
<a href="#l103.107"></a><span id="l103.107">     localserver.key, asyncUrlListener, null);</span>
<a href="#l103.108"></a><span id="l103.108">   yield false;</span>
<a href="#l103.109"></a><span id="l103.109">   do_check_eq(daemon.getGroup(&quot;misc.test&quot;).keys.length, 1);</span>
<a href="#l103.110"></a><span id="l103.110">   yield true;</span>
<a href="#l103.111"></a><span id="l103.111"> }</span>
<a href="#l103.112"></a><span id="l103.112"> </span>
<a href="#l103.113"></a><span id="l103.113" class="difflineat">@@ -176,17 +176,17 @@ function test_postMessage() {</span>
<a href="#l103.114"></a><span id="l103.114"> function test_forwardInline() {</span>
<a href="#l103.115"></a><span id="l103.115">   // This tests mime_parse_stream_complete via forwarding inline</span>
<a href="#l103.116"></a><span id="l103.116">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l103.117"></a><span id="l103.117">   let hdr = folder.msgDatabase.GetMsgHdrForKey(1);</span>
<a href="#l103.118"></a><span id="l103.118">   MailServices.compose.forwardMessage(&quot;a@b.invalid&quot;, hdr, null,</span>
<a href="#l103.119"></a><span id="l103.119">     localserver, Ci.nsIMsgComposeService.kForwardInline);</span>
<a href="#l103.120"></a><span id="l103.120"> }</span>
<a href="#l103.121"></a><span id="l103.121"> </span>
<a href="#l103.122"></a><span id="l103.122" class="difflineminus">-function test_escapedName() {</span>
<a href="#l103.123"></a><span id="l103.123" class="difflineplus">+function* test_escapedName() {</span>
<a href="#l103.124"></a><span id="l103.124">   // This does a few tests to make sure our internal URIs work for newsgroups</span>
<a href="#l103.125"></a><span id="l103.125">   // with names that need escaping</span>
<a href="#l103.126"></a><span id="l103.126">   let evilName = &quot;test.malformed&amp;name&quot;;</span>
<a href="#l103.127"></a><span id="l103.127">   daemon.addGroup(evilName);</span>
<a href="#l103.128"></a><span id="l103.128">   daemon.addArticle(make_article(do_get_file(&quot;postings/bug670935.eml&quot;)));</span>
<a href="#l103.129"></a><span id="l103.129">   localserver.subscribeToNewsgroup(evilName);</span>
<a href="#l103.130"></a><span id="l103.130"> </span>
<a href="#l103.131"></a><span id="l103.131">   // Can we access it?</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l104.1"></a><span id="l104.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpPasswordFailure.js</span>
<a href="#l104.2"></a><span id="l104.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpPasswordFailure.js</span>
<a href="#l104.3"></a><span id="l104.3" class="difflineat">@@ -112,17 +112,17 @@ var urlListener =</span>
<a href="#l104.4"></a><span id="l104.4"> </span>
<a href="#l104.5"></a><span id="l104.5"> // Definition of tests</span>
<a href="#l104.6"></a><span id="l104.6"> var tests = [</span>
<a href="#l104.7"></a><span id="l104.7">   getMail1,</span>
<a href="#l104.8"></a><span id="l104.8">   getMail2,</span>
<a href="#l104.9"></a><span id="l104.9">   endTest</span>
<a href="#l104.10"></a><span id="l104.10"> ]</span>
<a href="#l104.11"></a><span id="l104.11"> </span>
<a href="#l104.12"></a><span id="l104.12" class="difflineminus">-function getMail1() {</span>
<a href="#l104.13"></a><span id="l104.13" class="difflineplus">+function* getMail1() {</span>
<a href="#l104.14"></a><span id="l104.14">   dump(&quot;\nGet Mail 1\n&quot;);</span>
<a href="#l104.15"></a><span id="l104.15"> </span>
<a href="#l104.16"></a><span id="l104.16">   // Now get mail</span>
<a href="#l104.17"></a><span id="l104.17">   getMail();</span>
<a href="#l104.18"></a><span id="l104.18">   yield false;</span>
<a href="#l104.19"></a><span id="l104.19">   dump(&quot;\nGot Mail 1\n&quot;);</span>
<a href="#l104.20"></a><span id="l104.20"> </span>
<a href="#l104.21"></a><span id="l104.21">   do_check_eq(attempt, 2);</span>
<a href="#l104.22"></a><span id="l104.22" class="difflineat">@@ -135,26 +135,26 @@ function getMail1() {</span>
<a href="#l104.23"></a><span id="l104.23">   do_check_eq(count.value, 1);</span>
<a href="#l104.24"></a><span id="l104.24">   do_check_eq(logins[0].username, kUserName);</span>
<a href="#l104.25"></a><span id="l104.25">   do_check_eq(logins[0].password, kInvalidPassword);</span>
<a href="#l104.26"></a><span id="l104.26"> </span>
<a href="#l104.27"></a><span id="l104.27">   server.resetTest();</span>
<a href="#l104.28"></a><span id="l104.28">   yield true;</span>
<a href="#l104.29"></a><span id="l104.29"> }</span>
<a href="#l104.30"></a><span id="l104.30"> </span>
<a href="#l104.31"></a><span id="l104.31" class="difflineminus">-function getMail2() {</span>
<a href="#l104.32"></a><span id="l104.32" class="difflineplus">+function* getMail2() {</span>
<a href="#l104.33"></a><span id="l104.33">   dump(&quot;\nGet Mail 2\n&quot;);</span>
<a href="#l104.34"></a><span id="l104.34"> </span>
<a href="#l104.35"></a><span id="l104.35">   // Now get the mail</span>
<a href="#l104.36"></a><span id="l104.36">   getMail();</span>
<a href="#l104.37"></a><span id="l104.37">   yield false;</span>
<a href="#l104.38"></a><span id="l104.38">   dump(&quot;\nGot Mail 2\n&quot;);</span>
<a href="#l104.39"></a><span id="l104.39"> }</span>
<a href="#l104.40"></a><span id="l104.40"> </span>
<a href="#l104.41"></a><span id="l104.41" class="difflineminus">-function endTest() {</span>
<a href="#l104.42"></a><span id="l104.42" class="difflineplus">+function* endTest() {</span>
<a href="#l104.43"></a><span id="l104.43">   // Now check the new one has been saved.</span>
<a href="#l104.44"></a><span id="l104.44">   logins = Services.logins.findLogins(count, &quot;news://localhost&quot;, null,</span>
<a href="#l104.45"></a><span id="l104.45">                                       &quot;news://localhost&quot;);</span>
<a href="#l104.46"></a><span id="l104.46"> </span>
<a href="#l104.47"></a><span id="l104.47">   do_check_eq(count.value, 1);</span>
<a href="#l104.48"></a><span id="l104.48">   do_check_eq(logins[0].username, kUserName);</span>
<a href="#l104.49"></a><span id="l104.49">   do_check_eq(logins[0].password, kValidPassword);</span>
<a href="#l104.50"></a><span id="l104.50">   yield true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l105.1"></a><span id="l105.1" class="difflineminus">--- a/mailnews/test/resources/asyncTestUtils.js</span>
<a href="#l105.2"></a><span id="l105.2" class="difflineplus">+++ b/mailnews/test/resources/asyncTestUtils.js</span>
<a href="#l105.3"></a><span id="l105.3" class="difflineat">@@ -148,24 +148,31 @@ function async_driver(val) {</span>
<a href="#l105.4"></a><span id="l105.4"> var asyncExpectedEarlyAbort = &quot;REAP!&quot;;</span>
<a href="#l105.5"></a><span id="l105.5"> </span>
<a href="#l105.6"></a><span id="l105.6"> // the real driver!</span>
<a href="#l105.7"></a><span id="l105.7"> function _async_driver() {</span>
<a href="#l105.8"></a><span id="l105.8">   let curGenerator;</span>
<a href="#l105.9"></a><span id="l105.9">   while (asyncGeneratorStack.length) {</span>
<a href="#l105.10"></a><span id="l105.10">     curGenerator = asyncGeneratorStack[asyncGeneratorStack.length-1][0];</span>
<a href="#l105.11"></a><span id="l105.11">     try {</span>
<a href="#l105.12"></a><span id="l105.12" class="difflineminus">-      while (curGenerator.send(asyncGeneratorSendValue)) {</span>
<a href="#l105.13"></a><span id="l105.13" class="difflineplus">+      let nextItem = true;</span>
<a href="#l105.14"></a><span id="l105.14" class="difflineplus">+      while (nextItem) {</span>
<a href="#l105.15"></a><span id="l105.15" class="difflineplus">+        nextItem = curGenerator.next(asyncGeneratorSendValue);</span>
<a href="#l105.16"></a><span id="l105.16" class="difflineplus">+        if (!nextItem.value || nextItem.done)</span>
<a href="#l105.17"></a><span id="l105.17" class="difflineplus">+          break;</span>
<a href="#l105.18"></a><span id="l105.18">         asyncGeneratorSendValue = undefined;</span>
<a href="#l105.19"></a><span id="l105.19">       }</span>
<a href="#l105.20"></a><span id="l105.20">       asyncGeneratorSendValue = undefined;</span>
<a href="#l105.21"></a><span id="l105.21" class="difflineminus">-      return false;</span>
<a href="#l105.22"></a><span id="l105.22" class="difflineplus">+      if (nextItem.done)</span>
<a href="#l105.23"></a><span id="l105.23" class="difflineplus">+        asyncGeneratorStack.pop();</span>
<a href="#l105.24"></a><span id="l105.24" class="difflineplus">+      else</span>
<a href="#l105.25"></a><span id="l105.25" class="difflineplus">+        return false;</span>
<a href="#l105.26"></a><span id="l105.26">     }</span>
<a href="#l105.27"></a><span id="l105.27">     catch (ex) {</span>
<a href="#l105.28"></a><span id="l105.28" class="difflineminus">-      if (ex != StopIteration &amp;&amp; ex != asyncExpectedEarlyAbort) {</span>
<a href="#l105.29"></a><span id="l105.29" class="difflineplus">+      if (ex != asyncExpectedEarlyAbort) {</span>
<a href="#l105.30"></a><span id="l105.30">         let asyncStack = [];</span>
<a href="#l105.31"></a><span id="l105.31">         dump(&quot;*******************************************\n&quot;);</span>
<a href="#l105.32"></a><span id="l105.32">         dump(&quot;Generator explosion!\n&quot;);</span>
<a href="#l105.33"></a><span id="l105.33">         dump(&quot;Unhappiness at: &quot; + ex.fileName + &quot;:&quot; + ex.lineNumber + &quot;\n&quot;);</span>
<a href="#l105.34"></a><span id="l105.34">         dump(&quot;Because: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l105.35"></a><span id="l105.35">         dump(&quot;Stack:\n  &quot; + ex.stack.replace(/\n/g, &quot;\n  &quot;) + &quot;\n&quot;);</span>
<a href="#l105.36"></a><span id="l105.36">         dump(&quot;**** Async Generator Stack source functions:\n&quot;);</span>
<a href="#l105.37"></a><span id="l105.37">         for (let i = asyncGeneratorStack.length - 1; i &gt;= 0; i--) {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

