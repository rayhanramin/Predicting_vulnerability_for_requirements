<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 8061:cf80c93a7d8d84bceef945a77a2a6afade45a62d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ cf80c93a7d8d84bceef945a77a2a6afade45a62d" />
<meta property="og:url" content="/comm-central/rev/cf80c93a7d8d84bceef945a77a2a6afade45a62d" />
<meta property="og:description" content="centralize search handling of input stream in preparation for pluggable store work r=rkent, sr=neil, bug 668700" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / cf80c93a7d8d84bceef945a77a2a6afade45a62d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/cf80c93a7d8d84bceef945a77a2a6afade45a62d">shortlog</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/cf80c93a7d8d84bceef945a77a2a6afade45a62d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d">files</a> |
changeset |
<a href="/comm-central/raw-rev/cf80c93a7d8d84bceef945a77a2a6afade45a62d">raw</a>  | <a href="/comm-central/archive/cf80c93a7d8d84bceef945a77a2a6afade45a62d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
centralize search handling of input stream in preparation for pluggable store work r=rkent, sr=neil, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=668700">bug 668700</a>
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#97;&#118;&#105;&#100;&#32;&#66;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#32;&#60;&#98;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#64;&#110;&#118;&#101;&#110;&#116;&#117;&#114;&#101;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 05 Jul 2011 14:57:07 -0700</td></tr>

<tr>
 <td>changeset 8061</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/cf80c93a7d8d84bceef945a77a2a6afade45a62d">cf80c93a7d8d84bceef945a77a2a6afade45a62d</a></td>
</tr>



<tr>
<td>parent 8060</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7f1d82e037238e0a8375695ccc26b541bb737287">7f1d82e037238e0a8375695ccc26b541bb737287</a>
</td>
</tr>

<tr>
<td>child 8062</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7e3a06ce86c8c465b39fbdba4860942c6fb308d8">7e3a06ce86c8c465b39fbdba4860942c6fb308d8</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=cf80c93a7d8d84bceef945a77a2a6afade45a62d">6201</a></td></tr>
<tr><td>push user</td><td>bienvenu@nventure.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 05 Jul 2011 21:56:30 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@cf80c93a7d8d [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=cf80c93a7d8d84bceef945a77a2a6afade45a62d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=cf80c93a7d8d84bceef945a77a2a6afade45a62d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=cf80c93a7d8d84bceef945a77a2a6afade45a62d&newProject=comm-central&newRevision=cf80c93a7d8d84bceef945a77a2a6afade45a62d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=cf80c93a7d8d84bceef945a77a2a6afade45a62d&newProject=comm-central&newRevision=cf80c93a7d8d84bceef945a77a2a6afade45a62d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=cf80c93a7d8d84bceef945a77a2a6afade45a62d&newProject=comm-central&newRevision=cf80c93a7d8d84bceef945a77a2a6afade45a62d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28rkent%29&revcount=50">rkent</a>, <a href="/comm-central/log?rev=reviewer%28neil%29&revcount=50">neil</a>, <a href="/comm-central/log?rev=reviewer%28bug%29&revcount=50">bug</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=668700">668700</a></td></tr>




</table></div>

<div class="page_body description">centralize search handling of input stream in preparation for pluggable store work r=rkent, sr=neil, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=668700">bug 668700</a></div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgFilterList.idl">mailnews/base/search/public/nsIMsgFilterList.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgFilterList.idl">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgFilterList.idl">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgFilterList.idl">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgFilterList.idl">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgFilterList.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">mailnews/base/search/public/nsIMsgSearchScopeTerm.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchTerm.idl">mailnews/base/search/public/nsIMsgSearchTerm.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchTerm.idl">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchTerm.idl">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchTerm.idl">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchTerm.idl">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsIMsgSearchTerm.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgBodyHandler.h">mailnews/base/search/public/nsMsgBodyHandler.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgBodyHandler.h">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgBodyHandler.h">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgBodyHandler.h">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgBodyHandler.h">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgBodyHandler.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgSearchScopeTerm.h">mailnews/base/search/public/nsMsgSearchScopeTerm.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgSearchScopeTerm.h">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgSearchScopeTerm.h">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgSearchScopeTerm.h">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgSearchScopeTerm.h">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/public/nsMsgSearchScopeTerm.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgBodyHandler.cpp">mailnews/base/search/src/nsMsgBodyHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgBodyHandler.cpp">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgBodyHandler.cpp">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgBodyHandler.cpp">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgBodyHandler.cpp">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgBodyHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgFilterList.cpp">mailnews/base/search/src/nsMsgFilterList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgFilterList.cpp">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgFilterList.cpp">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgFilterList.cpp">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgFilterList.cpp">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgFilterList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgLocalSearch.cpp">mailnews/base/search/src/nsMsgLocalSearch.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgLocalSearch.cpp">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgLocalSearch.cpp">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgLocalSearch.cpp">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgLocalSearch.cpp">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgLocalSearch.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchAdapter.cpp">mailnews/base/search/src/nsMsgSearchAdapter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchAdapter.cpp">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchAdapter.cpp">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchAdapter.cpp">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchAdapter.cpp">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchAdapter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/news/src/nsNNTPNewsgroupList.cpp">mailnews/news/src/nsNNTPNewsgroupList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/news/src/nsNNTPNewsgroupList.cpp">file</a> |
<a href="/comm-central/annotate/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/news/src/nsNNTPNewsgroupList.cpp">annotate</a> |
<a href="/comm-central/diff/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/news/src/nsNNTPNewsgroupList.cpp">diff</a> |
<a href="/comm-central/comparison/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/news/src/nsNNTPNewsgroupList.cpp">comparison</a> |
<a href="/comm-central/log/cf80c93a7d8d84bceef945a77a2a6afade45a62d/mailnews/news/src/nsNNTPNewsgroupList.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgFilterList.idl</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgFilterList.idl</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -48,17 +48,17 @@ interface nsIOutputStream;</span>
<a href="#l1.4"></a><span id="l1.4"> // The Msg Filter List is an interface designed to make accessing filter lists</span>
<a href="#l1.5"></a><span id="l1.5"> // easier. Clients typically open a filter list and either enumerate the filters,</span>
<a href="#l1.6"></a><span id="l1.6"> // or add new filters, or change the order around...</span>
<a href="#l1.7"></a><span id="l1.7"> //</span>
<a href="#l1.8"></a><span id="l1.8"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> typedef long nsMsgFilterFileAttribValue;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-[scriptable, uuid(BC32C05E-4E4E-4F08-BF01-157A0CE71874)]</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+[scriptable, uuid(84d29635-e6c6-41ca-8b9f-82c9976dad58)]</span>
<a href="#l1.14"></a><span id="l1.14"> interface nsIMsgFilterList : nsISupports {</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16">     const nsMsgFilterFileAttribValue attribNone = 0;</span>
<a href="#l1.17"></a><span id="l1.17">     const nsMsgFilterFileAttribValue attribVersion = 1;</span>
<a href="#l1.18"></a><span id="l1.18">     const nsMsgFilterFileAttribValue attribLogging = 2;</span>
<a href="#l1.19"></a><span id="l1.19">     const nsMsgFilterFileAttribValue attribName = 3;</span>
<a href="#l1.20"></a><span id="l1.20">     const nsMsgFilterFileAttribValue attribEnabled = 4; </span>
<a href="#l1.21"></a><span id="l1.21">     const nsMsgFilterFileAttribValue attribDescription = 5; </span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -108,18 +108,17 @@ interface nsIMsgFilterList : nsISupports</span>
<a href="#l1.23"></a><span id="l1.23">     void applyFiltersToHdr(in nsMsgFilterTypeType filterType,</span>
<a href="#l1.24"></a><span id="l1.24">                            in nsIMsgDBHdr msgHdr,</span>
<a href="#l1.25"></a><span id="l1.25">                            in nsIMsgFolder folder,</span>
<a href="#l1.26"></a><span id="l1.26">                            in nsIMsgDatabase db,</span>
<a href="#l1.27"></a><span id="l1.27">                            in string headers,</span>
<a href="#l1.28"></a><span id="l1.28">                            //[array, size_is(headerSize)] in string headers,</span>
<a href="#l1.29"></a><span id="l1.29">                            in unsigned long headerSize,</span>
<a href="#l1.30"></a><span id="l1.30">                            in nsIMsgFilterHitNotify listener,</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-                           in nsIMsgWindow msgWindow,</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-                           in nsILocalFile aMessageFile);</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+                           in nsIMsgWindow msgWindow);</span>
<a href="#l1.34"></a><span id="l1.34"> </span>
<a href="#l1.35"></a><span id="l1.35">     // IO routines, used by filter object filing code.</span>
<a href="#l1.36"></a><span id="l1.36">     void writeIntAttr(in nsMsgFilterFileAttribValue attrib, in long value, in nsIOutputStream stream);</span>
<a href="#l1.37"></a><span id="l1.37">     void writeStrAttr(in nsMsgFilterFileAttribValue attrib, in string value, in nsIOutputStream stream);</span>
<a href="#l1.38"></a><span id="l1.38">     void writeWstrAttr(in nsMsgFilterFileAttribValue attrib, in wstring value, in nsIOutputStream stream);</span>
<a href="#l1.39"></a><span id="l1.39">     void writeBoolAttr(in nsMsgFilterFileAttribValue attrib, in boolean value, in nsIOutputStream stream);</span>
<a href="#l1.40"></a><span id="l1.40">     boolean matchOrChangeFilterTarget(in ACString oldUri, in ACString newUri, in boolean caseInsensitive);</span>
<a href="#l1.41"></a><span id="l1.41">  </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -35,18 +35,19 @@</span>
<a href="#l2.4"></a><span id="l2.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l2.5"></a><span id="l2.5">  *</span>
<a href="#l2.6"></a><span id="l2.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;nsIMsgSearchSession.idl&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> interface nsILocalFile;</span>
<a href="#l2.11"></a><span id="l2.11"> interface nsIMsgFolder;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+interface nsIMsgDBHdr;</span>
<a href="#l2.13"></a><span id="l2.13"> interface nsILineInputStream;</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-[scriptable, uuid(10f5c44f-5a11-44e0-9b6b-4db81ba97963)]</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+[scriptable, uuid(934672c3-9b8f-488a-935d-87b4023fa0be)]</span>
<a href="#l2.17"></a><span id="l2.17"> interface nsIMsgSearchScopeTerm : nsISupports {</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-  readonly attribute nsILocalFile mailFile;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-  attribute nsIInputStream inputStream;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+  nsIInputStream getInputStream(in nsIMsgDBHdr aHdr);</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+  void closeInputStream();</span>
<a href="#l2.22"></a><span id="l2.22">   readonly attribute nsIMsgFolder folder;</span>
<a href="#l2.23"></a><span id="l2.23">   readonly attribute nsIMsgSearchSession searchSession;</span>
<a href="#l2.24"></a><span id="l2.24"> };</span>
<a href="#l2.25"></a><span id="l2.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgSearchTerm.idl</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgSearchTerm.idl</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -39,17 +39,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;nsMsgSearchCore.idl&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsIMsgSearchValue.idl&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> interface nsIMsgDBHdr;</span>
<a href="#l3.9"></a><span id="l3.9"> interface nsIMsgDatabase;</span>
<a href="#l3.10"></a><span id="l3.10"> interface nsIMsgSearchScopeTerm;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-[scriptable, uuid(bb0e5261-c7da-44de-83b9-a39064ad707f)]</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+[scriptable, uuid(dfd25cbe-2e86-4ff0-b78e-494bc65d344e)]</span>
<a href="#l3.14"></a><span id="l3.14"> interface nsIMsgSearchTerm : nsISupports {</span>
<a href="#l3.15"></a><span id="l3.15">     attribute nsMsgSearchAttribValue attrib;</span>
<a href="#l3.16"></a><span id="l3.16">     attribute nsMsgSearchOpValue op;</span>
<a href="#l3.17"></a><span id="l3.17">     attribute nsIMsgSearchValue value;</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">     attribute boolean booleanAnd;</span>
<a href="#l3.20"></a><span id="l3.20">     attribute ACString arbitraryHeader;</span>
<a href="#l3.21"></a><span id="l3.21">     /**</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -106,28 +106,26 @@ interface nsIMsgSearchTerm : nsISupports</span>
<a href="#l3.23"></a><span id="l3.23">                       in nsIMsgDBHdr aMsg,</span>
<a href="#l3.24"></a><span id="l3.24">                       in nsIMsgDatabase aDb);</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">     /**</span>
<a href="#l3.27"></a><span id="l3.27">      * Test if the arbitrary header specified by this search term</span>
<a href="#l3.28"></a><span id="l3.28">      * matches the corresponding header in the passed in message.</span>
<a href="#l3.29"></a><span id="l3.29">      *</span>
<a href="#l3.30"></a><span id="l3.30">      * @param aScopeTerm scope of search</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-     * @param aOffset offset of message in message store</span>
<a href="#l3.32"></a><span id="l3.32">      * @param aLength length of message</span>
<a href="#l3.33"></a><span id="l3.33">      * @param aCharset The charset to apply to un-labeled non-UTF-8 data.</span>
<a href="#l3.34"></a><span id="l3.34">      * @param aCharsetOverride If true, aCharset is used instead of any</span>
<a href="#l3.35"></a><span id="l3.35">      *                         charset labeling other than UTF-8.</span>
<a href="#l3.36"></a><span id="l3.36">      *</span>
<a href="#l3.37"></a><span id="l3.37">      * N.B. This is noscript because headers is a null-separated list of</span>
<a href="#l3.38"></a><span id="l3.38">      * strings, which is not scriptable.</span>
<a href="#l3.39"></a><span id="l3.39">      */</span>
<a href="#l3.40"></a><span id="l3.40">     [noscript]</span>
<a href="#l3.41"></a><span id="l3.41">     boolean matchArbitraryHeader(in nsIMsgSearchScopeTerm aScopeTerm,</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-                                 in unsigned long long aOffset,</span>
<a href="#l3.43"></a><span id="l3.43">                                  in unsigned long aLength,</span>
<a href="#l3.44"></a><span id="l3.44">                                  in string aCharset,</span>
<a href="#l3.45"></a><span id="l3.45">                                  in boolean aCharsetOverride,</span>
<a href="#l3.46"></a><span id="l3.46">                                  in nsIMsgDBHdr aMsg,</span>
<a href="#l3.47"></a><span id="l3.47">                                  in nsIMsgDatabase aDb,</span>
<a href="#l3.48"></a><span id="l3.48">                                  //[array, size_is(headerLength)] in string headers,</span>
<a href="#l3.49"></a><span id="l3.49">                                  in string aHeaders,</span>
<a href="#l3.50"></a><span id="l3.50">                                  in unsigned long aHeaderLength,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgBodyHandler.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgBodyHandler.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,32 +1,33 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> #ifndef __nsMsgBodyHandler_h</span>
<a href="#l4.6"></a><span id="l4.6"> #define __nsMsgBodyHandler_h</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> #include &quot;nsIMsgSearchScopeTerm.h&quot;</span>
<a href="#l4.9"></a><span id="l4.9"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+#include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+</span>
<a href="#l4.12"></a><span id="l4.12"> //---------------------------------------------------------------------------</span>
<a href="#l4.13"></a><span id="l4.13"> // nsMsgBodyHandler: used to retrieve lines from POP and IMAP offline messages.</span>
<a href="#l4.14"></a><span id="l4.14"> // This is a helper class used by nsMsgSearchTerm::MatchBody</span>
<a href="#l4.15"></a><span id="l4.15"> //---------------------------------------------------------------------------</span>
<a href="#l4.16"></a><span id="l4.16"> class nsMsgBodyHandler</span>
<a href="#l4.17"></a><span id="l4.17"> {</span>
<a href="#l4.18"></a><span id="l4.18"> public:</span>
<a href="#l4.19"></a><span id="l4.19">   nsMsgBodyHandler (nsIMsgSearchScopeTerm *,</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-    PRUint32 offset,</span>
<a href="#l4.21"></a><span id="l4.21">     PRUint32 length,</span>
<a href="#l4.22"></a><span id="l4.22">     nsIMsgDBHdr * msg,</span>
<a href="#l4.23"></a><span id="l4.23">     nsIMsgDatabase * db);</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">   // we can also create a body handler when doing arbitrary header</span>
<a href="#l4.26"></a><span id="l4.26">   // filtering...we need the list of headers and the header size as well</span>
<a href="#l4.27"></a><span id="l4.27">   // if we are doing filtering...if ForFilters is false, headers and</span>
<a href="#l4.28"></a><span id="l4.28">   // headersSize is ignored!!!</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-  nsMsgBodyHandler (nsIMsgSearchScopeTerm *, PRUint64 offset,</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+  nsMsgBodyHandler (nsIMsgSearchScopeTerm *,</span>
<a href="#l4.31"></a><span id="l4.31">     PRUint32 length, nsIMsgDBHdr * msg, nsIMsgDatabase * db,</span>
<a href="#l4.32"></a><span id="l4.32">     const char * headers /* NULL terminated list of headers */,</span>
<a href="#l4.33"></a><span id="l4.33">     PRUint32 headersSize, PRBool ForFilters);</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35">   virtual ~nsMsgBodyHandler();</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37">   // returns next message line in buf</span>
<a href="#l4.38"></a><span id="l4.38">   PRInt32 GetNextLine(nsCString &amp;buf);</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineat">@@ -51,22 +52,17 @@ protected:</span>
<a href="#l4.40"></a><span id="l4.40">   void OpenLocalFolder();</span>
<a href="#l4.41"></a><span id="l4.41"> </span>
<a href="#l4.42"></a><span id="l4.42">   // goes through the mail folder</span>
<a href="#l4.43"></a><span id="l4.43">   PRInt32 GetNextLocalLine(nsCString &amp;buf);</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45">   nsIMsgSearchScopeTerm *m_scope;</span>
<a href="#l4.46"></a><span id="l4.46">   nsCOMPtr &lt;nsILineInputStream&gt; m_fileLineStream;</span>
<a href="#l4.47"></a><span id="l4.47">   nsCOMPtr &lt;nsILocalFile&gt; m_localFile;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-  // local file state</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-  //  XP_File  *m_localFile;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-  // need a file stream here, I bet</span>
<a href="#l4.51"></a><span id="l4.51"> </span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-  // current offset into the mail folder file.</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-  PRUint64 m_localFileOffset;</span>
<a href="#l4.54"></a><span id="l4.54">   /**</span>
<a href="#l4.55"></a><span id="l4.55">    * The number of lines in the message.  If |m_lineCountInBodyLines| then this</span>
<a href="#l4.56"></a><span id="l4.56">    * is the number of body lines, otherwise this is the entire number of lines</span>
<a href="#l4.57"></a><span id="l4.57">    * in the message.  This is important so we know when to stop reading the file</span>
<a href="#l4.58"></a><span id="l4.58">    * without accidentally reading part of the next message.</span>
<a href="#l4.59"></a><span id="l4.59">    */</span>
<a href="#l4.60"></a><span id="l4.60">   PRUint32 m_numLocalLines;</span>
<a href="#l4.61"></a><span id="l4.61">   /**</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineat">@@ -78,18 +74,18 @@ protected:</span>
<a href="#l4.63"></a><span id="l4.63">    * message is a local message, the number of lines will be the number of body</span>
<a href="#l4.64"></a><span id="l4.64">    * lines.</span>
<a href="#l4.65"></a><span id="l4.65">    */</span>
<a href="#l4.66"></a><span id="l4.66">   PRBool m_lineCountInBodyLines;</span>
<a href="#l4.67"></a><span id="l4.67"> </span>
<a href="#l4.68"></a><span id="l4.68">   // Offline IMAP related methods &amp; state</span>
<a href="#l4.69"></a><span id="l4.69"> </span>
<a href="#l4.70"></a><span id="l4.70"> </span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-  nsIMsgDBHdr * m_msgHdr;</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-  nsIMsgDatabase * m_db;</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+  nsCOMPtr&lt;nsIMsgDBHdr&gt; m_msgHdr;</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineplus">+  nsCOMPtr&lt;nsIMsgDatabase&gt; m_db;</span>
<a href="#l4.75"></a><span id="l4.75"> </span>
<a href="#l4.76"></a><span id="l4.76">   // Transformations</span>
<a href="#l4.77"></a><span id="l4.77">   // With the exception of m_isMultipart, these all apply to the various parts</span>
<a href="#l4.78"></a><span id="l4.78">   PRBool m_stripHeaders;   // PR_TRUE if we're supposed to strip of message headers</span>
<a href="#l4.79"></a><span id="l4.79">   PRBool m_stripHtml;      // PR_TRUE if we're supposed to strip off HTML tags</span>
<a href="#l4.80"></a><span id="l4.80">   PRBool m_pastHeaders;  // PR_TRUE if we've already skipped over the headers</span>
<a href="#l4.81"></a><span id="l4.81">   PRBool m_partIsHtml;     // PR_TRUE if the Content-type header claims text/html</span>
<a href="#l4.82"></a><span id="l4.82">   PRBool m_base64part;     // PR_TRUE if the current part is in base64</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgSearchScopeTerm.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgSearchScopeTerm.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -63,15 +63,14 @@ public:</span>
<a href="#l5.4"></a><span id="l5.4">   </span>
<a href="#l5.5"></a><span id="l5.5">   char *GetStatusBarName ();</span>
<a href="#l5.6"></a><span id="l5.6">   </span>
<a href="#l5.7"></a><span id="l5.7">   nsMsgSearchScopeValue m_attribute;</span>
<a href="#l5.8"></a><span id="l5.8">   char *m_name;</span>
<a href="#l5.9"></a><span id="l5.9">   nsCOMPtr &lt;nsIMsgFolder&gt; m_folder;</span>
<a href="#l5.10"></a><span id="l5.10">   nsCOMPtr &lt;nsIMsgSearchAdapter&gt; m_adapter;</span>
<a href="#l5.11"></a><span id="l5.11">   nsCOMPtr &lt;nsIInputStream&gt; m_inputStream; // for message bodies</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; m_localFile; // if set, input stream comes from this</span>
<a href="#l5.13"></a><span id="l5.13">   nsWeakPtr m_searchSession;</span>
<a href="#l5.14"></a><span id="l5.14">   PRBool m_searchServer;</span>
<a href="#l5.15"></a><span id="l5.15">   </span>
<a href="#l5.16"></a><span id="l5.16"> };</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -43,20 +43,21 @@</span>
<a href="#l6.4"></a><span id="l6.4"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l6.5"></a><span id="l6.5"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l6.6"></a><span id="l6.6"> #include &quot;nsISeekableStream.h&quot;</span>
<a href="#l6.7"></a><span id="l6.7"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l6.8"></a><span id="l6.8"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;plbase64.h&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> #include &quot;prmem.h&quot;</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-nsMsgBodyHandler::nsMsgBodyHandler (nsIMsgSearchScopeTerm * scope, PRUint32 offset, PRUint32 numLines, nsIMsgDBHdr* msg, nsIMsgDatabase * db)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+nsMsgBodyHandler::nsMsgBodyHandler (nsIMsgSearchScopeTerm * scope,</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+                                    PRUint32 numLines,</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+                                    nsIMsgDBHdr* msg, nsIMsgDatabase * db)</span>
<a href="#l6.16"></a><span id="l6.16"> {</span>
<a href="#l6.17"></a><span id="l6.17">   m_scope = scope;</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-  m_localFileOffset = offset;</span>
<a href="#l6.19"></a><span id="l6.19">   m_numLocalLines = numLines;</span>
<a href="#l6.20"></a><span id="l6.20">   PRUint32 flags;</span>
<a href="#l6.21"></a><span id="l6.21">   m_lineCountInBodyLines = NS_SUCCEEDED(msg-&gt;GetFlags(&amp;flags)) ?</span>
<a href="#l6.22"></a><span id="l6.22">     !(flags &amp; nsMsgMessageFlags::Offline) : PR_TRUE;</span>
<a href="#l6.23"></a><span id="l6.23">   // account for added x-mozilla-status lines, and envelope line.</span>
<a href="#l6.24"></a><span id="l6.24">   if (!m_lineCountInBodyLines)</span>
<a href="#l6.25"></a><span id="l6.25">     m_numLocalLines += 3;</span>
<a href="#l6.26"></a><span id="l6.26">   m_msgHdr = msg;</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineat">@@ -68,23 +69,22 @@ nsMsgBodyHandler::nsMsgBodyHandler (nsIM</span>
<a href="#l6.28"></a><span id="l6.28">   m_headersSize = 0;</span>
<a href="#l6.29"></a><span id="l6.29">   m_Filtering = PR_FALSE; // make sure we set this before we call initialize...</span>
<a href="#l6.30"></a><span id="l6.30">   </span>
<a href="#l6.31"></a><span id="l6.31">   Initialize();  // common initialization stuff</span>
<a href="#l6.32"></a><span id="l6.32">   OpenLocalFolder();      </span>
<a href="#l6.33"></a><span id="l6.33"> }</span>
<a href="#l6.34"></a><span id="l6.34"> </span>
<a href="#l6.35"></a><span id="l6.35"> nsMsgBodyHandler::nsMsgBodyHandler(nsIMsgSearchScopeTerm * scope,</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-                                   PRUint64 offset, PRUint32 numLines,</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+                                   PRUint32 numLines,</span>
<a href="#l6.38"></a><span id="l6.38">                                    nsIMsgDBHdr* msg, nsIMsgDatabase* db,</span>
<a href="#l6.39"></a><span id="l6.39">                                    const char * headers, PRUint32 headersSize,</span>
<a href="#l6.40"></a><span id="l6.40">                                    PRBool Filtering)</span>
<a href="#l6.41"></a><span id="l6.41"> {</span>
<a href="#l6.42"></a><span id="l6.42">   m_scope = scope;</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-  m_localFileOffset = offset;</span>
<a href="#l6.44"></a><span id="l6.44">   m_numLocalLines = numLines;</span>
<a href="#l6.45"></a><span id="l6.45">   PRUint32 flags;</span>
<a href="#l6.46"></a><span id="l6.46">   m_lineCountInBodyLines = NS_SUCCEEDED(msg-&gt;GetFlags(&amp;flags)) ?</span>
<a href="#l6.47"></a><span id="l6.47">     !(flags &amp; nsMsgMessageFlags::Offline) : PR_TRUE;</span>
<a href="#l6.48"></a><span id="l6.48">   // account for added x-mozilla-status lines, and envelope line.</span>
<a href="#l6.49"></a><span id="l6.49">   if (!m_lineCountInBodyLines)</span>
<a href="#l6.50"></a><span id="l6.50">     m_numLocalLines += 3;</span>
<a href="#l6.51"></a><span id="l6.51">   m_msgHdr = msg;</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineat">@@ -160,22 +160,17 @@ PRInt32 nsMsgBodyHandler::GetNextLine (n</span>
<a href="#l6.53"></a><span id="l6.53">   }</span>
<a href="#l6.54"></a><span id="l6.54"> </span>
<a href="#l6.55"></a><span id="l6.55">   return outLength;</span>
<a href="#l6.56"></a><span id="l6.56"> }</span>
<a href="#l6.57"></a><span id="l6.57"> </span>
<a href="#l6.58"></a><span id="l6.58"> void nsMsgBodyHandler::OpenLocalFolder()</span>
<a href="#l6.59"></a><span id="l6.59"> {</span>
<a href="#l6.60"></a><span id="l6.60">   nsCOMPtr &lt;nsIInputStream&gt; inputStream;</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-  nsresult rv = m_scope-&gt;GetInputStream(getter_AddRefs(inputStream));</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-  {</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-    nsCOMPtr &lt;nsISeekableStream&gt; seekableStream = do_QueryInterface(inputStream);</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-    seekableStream-&gt;Seek(nsISeekableStream::NS_SEEK_SET, m_localFileOffset);</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-  }</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+  nsresult rv = m_scope-&gt;GetInputStream(m_msgHdr, getter_AddRefs(inputStream));</span>
<a href="#l6.68"></a><span id="l6.68">   m_fileLineStream = do_QueryInterface(inputStream);</span>
<a href="#l6.69"></a><span id="l6.69"> }</span>
<a href="#l6.70"></a><span id="l6.70"> </span>
<a href="#l6.71"></a><span id="l6.71"> PRInt32 nsMsgBodyHandler::GetNextFilterLine(nsCString &amp;buf)</span>
<a href="#l6.72"></a><span id="l6.72"> {</span>
<a href="#l6.73"></a><span id="l6.73">   // m_nextHdr always points to the next header in the list....the list is NULL terminated...</span>
<a href="#l6.74"></a><span id="l6.74">   PRUint32 numBytesCopied = 0;</span>
<a href="#l6.75"></a><span id="l6.75">   if (m_headersSize &gt; 0)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -313,29 +313,26 @@ nsMsgFilterList::GetLogStream(nsIOutputS</span>
<a href="#l7.4"></a><span id="l7.4"> NS_IMETHODIMP</span>
<a href="#l7.5"></a><span id="l7.5"> nsMsgFilterList::ApplyFiltersToHdr(nsMsgFilterTypeType filterType,</span>
<a href="#l7.6"></a><span id="l7.6">                                    nsIMsgDBHdr *msgHdr,</span>
<a href="#l7.7"></a><span id="l7.7">                                    nsIMsgFolder *folder,</span>
<a href="#l7.8"></a><span id="l7.8">                                    nsIMsgDatabase *db,</span>
<a href="#l7.9"></a><span id="l7.9">                                    const char*headers,</span>
<a href="#l7.10"></a><span id="l7.10">                                    PRUint32 headersSize,</span>
<a href="#l7.11"></a><span id="l7.11">                                    nsIMsgFilterHitNotify *listener,</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-                                   nsIMsgWindow *msgWindow,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-                                   nsILocalFile *aMessageFile)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+                                   nsIMsgWindow *msgWindow)</span>
<a href="#l7.15"></a><span id="l7.15"> {</span>
<a href="#l7.16"></a><span id="l7.16">   nsCOMPtr &lt;nsIMsgFilter&gt;  filter;</span>
<a href="#l7.17"></a><span id="l7.17">   PRUint32    filterCount = 0;</span>
<a href="#l7.18"></a><span id="l7.18">   nsresult    rv = GetFilterCount(&amp;filterCount);</span>
<a href="#l7.19"></a><span id="l7.19">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">   nsMsgSearchScopeTerm* scope = new nsMsgSearchScopeTerm(nsnull, nsMsgSearchScope::offlineMail, folder);</span>
<a href="#l7.22"></a><span id="l7.22">   scope-&gt;AddRef();</span>
<a href="#l7.23"></a><span id="l7.23">   if (!scope) return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-  if (aMessageFile)</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-    scope-&gt;m_localFile = aMessageFile;</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27">   for (PRUint32 filterIndex = 0; filterIndex &lt; filterCount; filterIndex++)</span>
<a href="#l7.28"></a><span id="l7.28">   {</span>
<a href="#l7.29"></a><span id="l7.29">     if (NS_SUCCEEDED(GetFilterAt(filterIndex, getter_AddRefs(filter))))</span>
<a href="#l7.30"></a><span id="l7.30">     {</span>
<a href="#l7.31"></a><span id="l7.31">       PRBool isEnabled;</span>
<a href="#l7.32"></a><span id="l7.32">       nsMsgFilterTypeType curFilterType;</span>
<a href="#l7.33"></a><span id="l7.33"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -663,24 +663,27 @@ nsresult nsMsgSearchOfflineMail::Process</span>
<a href="#l8.4"></a><span id="l8.4">           // for the temporary return receipts filters, we use a custom header for Content-Type</span>
<a href="#l8.5"></a><span id="l8.5">           // but unlike the other custom headers, this one doesn't show up in the search / filter</span>
<a href="#l8.6"></a><span id="l8.6">           // UI.  we set the attrib to be nsMsgSearchAttrib::OtherHeader, where as for user</span>
<a href="#l8.7"></a><span id="l8.7">           // defined custom headers start at nsMsgSearchAttrib::OtherHeader + 1</span>
<a href="#l8.8"></a><span id="l8.8">           // Not sure if there is a better way to do this yet.  Maybe reserve the last</span>
<a href="#l8.9"></a><span id="l8.9">           // custom header for ::Content-Type?  But if we do, make sure that change</span>
<a href="#l8.10"></a><span id="l8.10">           // doesn't cause nsMsgFilter::GetTerm() to change, and start making us</span>
<a href="#l8.11"></a><span id="l8.11">           // ask IMAP servers for the Content-Type header on all messages.</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-          if ( attrib &gt;= nsMsgSearchAttrib::OtherHeader &amp;&amp; attrib &lt; nsMsgSearchAttrib::kNumMsgSearchAttributes)</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+          if (attrib &gt;= nsMsgSearchAttrib::OtherHeader &amp;&amp;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+              attrib &lt; nsMsgSearchAttrib::kNumMsgSearchAttributes)</span>
<a href="#l8.15"></a><span id="l8.15">           {</span>
<a href="#l8.16"></a><span id="l8.16">             PRUint32 lineCount;</span>
<a href="#l8.17"></a><span id="l8.17">             msgToMatch-&gt;GetLineCount(&amp;lineCount);</span>
<a href="#l8.18"></a><span id="l8.18">             PRUint64 messageOffset;</span>
<a href="#l8.19"></a><span id="l8.19">             msgToMatch-&gt;GetMessageOffset(&amp;messageOffset);</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-            err = aTerm-&gt;MatchArbitraryHeader (scope, messageOffset, lineCount,charset, charsetOverride,</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-                                                msgToMatch, db, headers, headerSize, Filtering, &amp;result);</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+            err = aTerm-&gt;MatchArbitraryHeader(scope, lineCount,charset,</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+                                              charsetOverride, msgToMatch, db,</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+                                              headers, headerSize, Filtering,</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+                                              &amp;result);</span>
<a href="#l8.26"></a><span id="l8.26">           }</span>
<a href="#l8.27"></a><span id="l8.27">           else</span>
<a href="#l8.28"></a><span id="l8.28">             err = NS_ERROR_INVALID_ARG; // ### was SearchError_InvalidAttribute</span>
<a href="#l8.29"></a><span id="l8.29">     }</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31">     *pResult = result;</span>
<a href="#l8.32"></a><span id="l8.32">     return NS_OK;</span>
<a href="#l8.33"></a><span id="l8.33"> }</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineat">@@ -797,17 +800,17 @@ void nsMsgSearchOfflineMail::CleanUpScop</span>
<a href="#l8.35"></a><span id="l8.35">   if (m_db)</span>
<a href="#l8.36"></a><span id="l8.36">   {</span>
<a href="#l8.37"></a><span id="l8.37">     m_listContext = nsnull;</span>
<a href="#l8.38"></a><span id="l8.38">     m_db-&gt;Close(PR_FALSE);</span>
<a href="#l8.39"></a><span id="l8.39">   }</span>
<a href="#l8.40"></a><span id="l8.40">   m_db = nsnull;</span>
<a href="#l8.41"></a><span id="l8.41"> </span>
<a href="#l8.42"></a><span id="l8.42">   if (m_scope)</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-    m_scope-&gt;SetInputStream(nsnull);</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+    m_scope-&gt;CloseInputStream();</span>
<a href="#l8.45"></a><span id="l8.45"> }</span>
<a href="#l8.46"></a><span id="l8.46"> </span>
<a href="#l8.47"></a><span id="l8.47"> NS_IMETHODIMP nsMsgSearchOfflineMail::AddResultElement (nsIMsgDBHdr *pHeaders)</span>
<a href="#l8.48"></a><span id="l8.48"> {</span>
<a href="#l8.49"></a><span id="l8.49">     nsresult err = NS_OK;</span>
<a href="#l8.50"></a><span id="l8.50"> </span>
<a href="#l8.51"></a><span id="l8.51">     nsCOMPtr&lt;nsIMsgSearchSession&gt; searchSession;</span>
<a href="#l8.52"></a><span id="l8.52">     m_scope-&gt;GetSearchSession(getter_AddRefs(searchSession));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -122,17 +122,17 @@ nsMsgSearchAdapter::nsMsgSearchAdapter(n</span>
<a href="#l9.4"></a><span id="l9.4"> nsMsgSearchAdapter::~nsMsgSearchAdapter()</span>
<a href="#l9.5"></a><span id="l9.5"> {</span>
<a href="#l9.6"></a><span id="l9.6"> }</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8"> NS_IMETHODIMP nsMsgSearchAdapter::ClearScope()</span>
<a href="#l9.9"></a><span id="l9.9"> {</span>
<a href="#l9.10"></a><span id="l9.10">   if (m_scope)</span>
<a href="#l9.11"></a><span id="l9.11">   {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    m_scope-&gt;SetInputStream(nsnull);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    m_scope-&gt;CloseInputStream();</span>
<a href="#l9.14"></a><span id="l9.14">     m_scope = nsnull;</span>
<a href="#l9.15"></a><span id="l9.15">   }</span>
<a href="#l9.16"></a><span id="l9.16">   return NS_OK;</span>
<a href="#l9.17"></a><span id="l9.17"> }</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19"> NS_IMETHODIMP nsMsgSearchAdapter::ValidateTerms ()</span>
<a href="#l9.20"></a><span id="l9.20"> {</span>
<a href="#l9.21"></a><span id="l9.21">   // all this used to do is check if the object had been deleted - we can skip that.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -58,16 +58,17 @@</span>
<a href="#l10.4"></a><span id="l10.4"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l10.5"></a><span id="l10.5"> #include &quot;nsIMimeConverter.h&quot;</span>
<a href="#l10.6"></a><span id="l10.6"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l10.7"></a><span id="l10.7"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l10.8"></a><span id="l10.8"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> #include &quot;nsIMsgFilterPlugin.h&quot;</span>
<a href="#l10.10"></a><span id="l10.10"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+#include &quot;nsISeekableStream.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14"> #include &quot;nsIFileStreams.h&quot;</span>
<a href="#l10.15"></a><span id="l10.15"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l10.16"></a><span id="l10.16"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l10.17"></a><span id="l10.17"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l10.18"></a><span id="l10.18"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l10.19"></a><span id="l10.19"> #include &quot;nsMemory.h&quot;</span>
<a href="#l10.20"></a><span id="l10.20"> #include &lt;ctype.h&gt;</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -755,17 +756,16 @@ nsresult nsMsgSearchTerm::DeStreamNew (c</span>
<a href="#l10.22"></a><span id="l10.22">   }</span>
<a href="#l10.23"></a><span id="l10.23">   return NS_OK;</span>
<a href="#l10.24"></a><span id="l10.24"> }</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26"> </span>
<a href="#l10.27"></a><span id="l10.27"> // Looks in the MessageDB for the user specified arbitrary header, if it finds the header, it then looks for a match against</span>
<a href="#l10.28"></a><span id="l10.28"> // the value for the header.</span>
<a href="#l10.29"></a><span id="l10.29"> nsresult nsMsgSearchTerm::MatchArbitraryHeader (nsIMsgSearchScopeTerm *scope,</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-                                                PRUint64 offset,</span>
<a href="#l10.31"></a><span id="l10.31">                                                 PRUint32 length /* in lines*/,</span>
<a href="#l10.32"></a><span id="l10.32">                                                 const char *charset,</span>
<a href="#l10.33"></a><span id="l10.33">                                                 PRBool charsetOverride,</span>
<a href="#l10.34"></a><span id="l10.34">                                                 nsIMsgDBHdr *msg,</span>
<a href="#l10.35"></a><span id="l10.35">                                                 nsIMsgDatabase* db,</span>
<a href="#l10.36"></a><span id="l10.36">                                                 const char * headers,</span>
<a href="#l10.37"></a><span id="l10.37">                                                 PRUint32 headersSize,</span>
<a href="#l10.38"></a><span id="l10.38">                                                 PRBool ForFiltering,</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineat">@@ -782,17 +782,19 @@ nsresult nsMsgSearchTerm::MatchArbitrary</span>
<a href="#l10.40"></a><span id="l10.40">   PRBool result = !matchExpected;</span>
<a href="#l10.41"></a><span id="l10.41"> </span>
<a href="#l10.42"></a><span id="l10.42">   nsCString dbHdrValue;</span>
<a href="#l10.43"></a><span id="l10.43">   msg-&gt;GetStringProperty(m_arbitraryHeader.get(), getter_Copies(dbHdrValue));</span>
<a href="#l10.44"></a><span id="l10.44">   if (!dbHdrValue.IsEmpty())</span>
<a href="#l10.45"></a><span id="l10.45">     // match value with the other info.</span>
<a href="#l10.46"></a><span id="l10.46">     return MatchRfc2047String(dbHdrValue.get(), charset, charsetOverride, pResult);</span>
<a href="#l10.47"></a><span id="l10.47"> </span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-  nsMsgBodyHandler * bodyHandler = new nsMsgBodyHandler (scope, offset,length, msg, db, headers, headersSize, ForFiltering);</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+  nsMsgBodyHandler * bodyHandler =</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+    new nsMsgBodyHandler (scope, length, msg, db, headers, headersSize,</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+                          ForFiltering);</span>
<a href="#l10.52"></a><span id="l10.52">   if (!bodyHandler)</span>
<a href="#l10.53"></a><span id="l10.53">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l10.54"></a><span id="l10.54"> </span>
<a href="#l10.55"></a><span id="l10.55">   bodyHandler-&gt;SetStripHeaders (PR_FALSE);</span>
<a href="#l10.56"></a><span id="l10.56"> </span>
<a href="#l10.57"></a><span id="l10.57">   nsCString headerFullValue; // contains matched header value accumulated over multiple lines.</span>
<a href="#l10.58"></a><span id="l10.58">   nsCAutoString buf;</span>
<a href="#l10.59"></a><span id="l10.59">   nsCAutoString curMsgHeader;</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineat">@@ -939,17 +941,17 @@ nsresult nsMsgSearchTerm::MatchBody (nsI</span>
<a href="#l10.61"></a><span id="l10.61">   PRBool result = PR_FALSE;</span>
<a href="#l10.62"></a><span id="l10.62">   *pResult = PR_FALSE;</span>
<a href="#l10.63"></a><span id="l10.63"> </span>
<a href="#l10.64"></a><span id="l10.64">   // Small hack so we don't look all through a message when someone has</span>
<a href="#l10.65"></a><span id="l10.65">   // specified &quot;BODY IS foo&quot;. ### Since length is in lines, this is not quite right.</span>
<a href="#l10.66"></a><span id="l10.66">   if ((length &gt; 0) &amp;&amp; (m_operator == nsMsgSearchOp::Is || m_operator == nsMsgSearchOp::Isnt))</span>
<a href="#l10.67"></a><span id="l10.67">     length = PL_strlen (m_value.string);</span>
<a href="#l10.68"></a><span id="l10.68"> </span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-  nsMsgBodyHandler * bodyHan  = new nsMsgBodyHandler (scope, offset, length, msg, db);</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+  nsMsgBodyHandler * bodyHan  = new nsMsgBodyHandler (scope, length, msg, db);</span>
<a href="#l10.71"></a><span id="l10.71">   if (!bodyHan)</span>
<a href="#l10.72"></a><span id="l10.72">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l10.73"></a><span id="l10.73"> </span>
<a href="#l10.74"></a><span id="l10.74">   nsCAutoString buf;</span>
<a href="#l10.75"></a><span id="l10.75">   PRBool endOfFile = PR_FALSE;  // if retValue == 0, we've hit the end of the file</span>
<a href="#l10.76"></a><span id="l10.76">   uint32 lines = 0;</span>
<a href="#l10.77"></a><span id="l10.77"> </span>
<a href="#l10.78"></a><span id="l10.78">   // Change the sense of the loop so we don't bail out prematurely</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineat">@@ -1878,59 +1880,54 @@ NS_IMETHODIMP</span>
<a href="#l10.80"></a><span id="l10.80"> nsMsgSearchScopeTerm::GetSearchSession(nsIMsgSearchSession** aResult)</span>
<a href="#l10.81"></a><span id="l10.81"> {</span>
<a href="#l10.82"></a><span id="l10.82">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l10.83"></a><span id="l10.83">     nsCOMPtr&lt;nsIMsgSearchSession&gt; searchSession = do_QueryReferent (m_searchSession);</span>
<a href="#l10.84"></a><span id="l10.84">     NS_IF_ADDREF(*aResult = searchSession);</span>
<a href="#l10.85"></a><span id="l10.85">     return NS_OK;</span>
<a href="#l10.86"></a><span id="l10.86"> }</span>
<a href="#l10.87"></a><span id="l10.87"> </span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-NS_IMETHODIMP nsMsgSearchScopeTerm::GetMailFile(nsILocalFile **aLocalFile)</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineminus">-{</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineminus">-  NS_ENSURE_ARG_POINTER(aLocalFile);</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineminus">-  if (!m_localFile)</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineminus">-  {</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineminus">-    if (!m_folder)</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineminus">-     return NS_ERROR_NULL_POINTER;</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineminus">-</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineminus">-    m_folder-&gt;GetFilePath(getter_AddRefs(m_localFile));</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineminus">-  }</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineminus">-  if (m_localFile)</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineminus">-  {</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineminus">-    NS_ADDREF(*aLocalFile = m_localFile);</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineminus">-    return NS_OK;</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineminus">-  }</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineminus">-  return NS_ERROR_FAILURE;</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-}</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineminus">-</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-NS_IMETHODIMP nsMsgSearchScopeTerm::GetInputStream(nsIInputStream **aInputStream)</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+nsMsgSearchScopeTerm::GetInputStream(nsIMsgDBHdr *aMsgHdr,</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+                                     nsIInputStream **aInputStream)</span>
<a href="#l10.110"></a><span id="l10.110"> {</span>
<a href="#l10.111"></a><span id="l10.111">   NS_ENSURE_ARG_POINTER(aInputStream);</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aMsgHdr);</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+  NS_ENSURE_TRUE(m_folder, NS_ERROR_NULL_POINTER);</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+  nsresult rv;</span>
<a href="#l10.116"></a><span id="l10.116">   if (!m_inputStream)</span>
<a href="#l10.117"></a><span id="l10.117">   {</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineminus">-     nsCOMPtr &lt;nsILocalFile&gt; localFile;</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineminus">-     rv = GetMailFile(getter_AddRefs(localFile));</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineminus">-     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineminus">-     nsCOMPtr&lt;nsIFileInputStream&gt; fileStream = do_CreateInstance(NS_LOCALFILEINPUTSTREAM_CONTRACTID, &amp;rv);</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineminus">-     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineplus">+    nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineplus">+    rv = m_folder-&gt;GetFilePath(getter_AddRefs(localFile));</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineplus">+    nsCOMPtr&lt;nsIFileInputStream&gt; fileStream = do_CreateInstance(NS_LOCALFILEINPUTSTREAM_CONTRACTID, &amp;rv);</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.128"></a><span id="l10.128"> </span>
<a href="#l10.129"></a><span id="l10.129" class="difflineminus">-     rv = fileStream-&gt;Init(localFile,  PR_RDONLY, 0664, PR_FALSE);  //just have to read the messages</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineminus">-     m_inputStream = do_QueryInterface(fileStream);</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineminus">-</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineplus">+    rv = fileStream-&gt;Init(localFile,  PR_RDONLY, 0664, PR_FALSE);  //just have to read the messages</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineplus">+    m_inputStream = do_QueryInterface(fileStream);</span>
<a href="#l10.134"></a><span id="l10.134">   }</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineplus">+  PRUint64 offset;</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineplus">+  aMsgHdr-&gt;GetMessageOffset(&amp;offset);</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineplus">+  nsCOMPtr&lt;nsISeekableStream&gt; seekableStream(do_QueryInterface(m_inputStream));</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineplus">+  if (seekableStream)</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineplus">+    rv = seekableStream-&gt;Seek(PR_SEEK_SET, offset);</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineplus">+  NS_WARN_IF_FALSE(!seekableStream &amp;&amp; offset,</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineplus">+                   &quot;non-zero offset w/ non-seekable stream&quot;);</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.143"></a><span id="l10.143">   NS_IF_ADDREF(*aInputStream = m_inputStream);</span>
<a href="#l10.144"></a><span id="l10.144">   return rv;</span>
<a href="#l10.145"></a><span id="l10.145"> }</span>
<a href="#l10.146"></a><span id="l10.146"> </span>
<a href="#l10.147"></a><span id="l10.147" class="difflineminus">-NS_IMETHODIMP nsMsgSearchScopeTerm::SetInputStream(nsIInputStream *aInputStream)</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineplus">+NS_IMETHODIMP nsMsgSearchScopeTerm::CloseInputStream()</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineplus">+{</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineplus">+  if (m_inputStream)</span>
<a href="#l10.151"></a><span id="l10.151"> {</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineminus">-  if (!aInputStream &amp;&amp; m_inputStream)</span>
<a href="#l10.153"></a><span id="l10.153">     m_inputStream-&gt;Close();</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineminus">-  m_inputStream = aInputStream;</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineplus">+    m_inputStream = nsnull;</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineplus">+  }</span>
<a href="#l10.157"></a><span id="l10.157">   return NS_OK;</span>
<a href="#l10.158"></a><span id="l10.158"> }</span>
<a href="#l10.159"></a><span id="l10.159"> </span>
<a href="#l10.160"></a><span id="l10.160"> nsresult nsMsgSearchScopeTerm::TimeSlice (PRBool *aDone)</span>
<a href="#l10.161"></a><span id="l10.161"> {</span>
<a href="#l10.162"></a><span id="l10.162">   return m_adapter-&gt;Search(aDone);</span>
<a href="#l10.163"></a><span id="l10.163"> }</span>
<a href="#l10.164"></a><span id="l10.164"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -3163,18 +3163,19 @@ nsresult nsImapMailFolder::NormalEndHead</span>
<a href="#l11.4"></a><span id="l11.4">       rv = m_msgParser-&gt;GetAllHeaders(&amp;headers, &amp;headersSize);</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6">       if (NS_SUCCEEDED(rv) &amp;&amp; headers &amp;&amp; !m_msgMovedByFilter &amp;&amp;</span>
<a href="#l11.7"></a><span id="l11.7">           !m_filterListRequiresBody)</span>
<a href="#l11.8"></a><span id="l11.8">       {</span>
<a href="#l11.9"></a><span id="l11.9">         if (m_filterList)</span>
<a href="#l11.10"></a><span id="l11.10">         {</span>
<a href="#l11.11"></a><span id="l11.11">           GetMoveCoalescer();  // not sure why we're doing this here.</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-          m_filterList-&gt;ApplyFiltersToHdr(nsMsgFilterType::InboxRule, newMsgHdr, this, mDatabase,</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-                                          headers, headersSize, this, msgWindow, nsnull);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+          m_filterList-&gt;ApplyFiltersToHdr(nsMsgFilterType::InboxRule, newMsgHdr,</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+                                          this, mDatabase, headers, headersSize,</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+                                          this, msgWindow);</span>
<a href="#l11.17"></a><span id="l11.17">           NotifyFolderEvent(mFiltersAppliedAtom);</span>
<a href="#l11.18"></a><span id="l11.18">         }</span>
<a href="#l11.19"></a><span id="l11.19">       }</span>
<a href="#l11.20"></a><span id="l11.20">     }</span>
<a href="#l11.21"></a><span id="l11.21">   }</span>
<a href="#l11.22"></a><span id="l11.22">   // here we need to tweak flags from uid state..</span>
<a href="#l11.23"></a><span id="l11.23">   if (mDatabase &amp;&amp; (!m_msgMovedByFilter || ShowDeletedMessages()))</span>
<a href="#l11.24"></a><span id="l11.24">   {</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineat">@@ -4660,17 +4661,17 @@ nsImapMailFolder::NormalEndMsgWriteStrea</span>
<a href="#l11.26"></a><span id="l11.26">         nsresult rv;</span>
<a href="#l11.27"></a><span id="l11.27">         nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgUrl;</span>
<a href="#l11.28"></a><span id="l11.28">         msgUrl = do_QueryInterface(imapUrl, &amp;rv);</span>
<a href="#l11.29"></a><span id="l11.29">         if (msgUrl &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l11.30"></a><span id="l11.30">           msgUrl-&gt;GetMsgWindow(getter_AddRefs(msgWindow));</span>
<a href="#l11.31"></a><span id="l11.31">       }</span>
<a href="#l11.32"></a><span id="l11.32">       m_filterList-&gt;ApplyFiltersToHdr(nsMsgFilterType::InboxRule, newMsgHdr,</span>
<a href="#l11.33"></a><span id="l11.33">                                       this, mDatabase, nsnull, nsnull, this,</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-                                      msgWindow, nsnull);</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+                                      msgWindow);</span>
<a href="#l11.36"></a><span id="l11.36">       NotifyFolderEvent(mFiltersAppliedAtom);</span>
<a href="#l11.37"></a><span id="l11.37">     }</span>
<a href="#l11.38"></a><span id="l11.38">     // Process filter plugins and other items normally done at the end of</span>
<a href="#l11.39"></a><span id="l11.39">     // HeaderFetchCompleted.</span>
<a href="#l11.40"></a><span id="l11.40">     PRBool pendingMoves = m_moveCoalescer &amp;&amp; m_moveCoalescer-&gt;HasPendingMoves();</span>
<a href="#l11.41"></a><span id="l11.41">     PlaybackCoalescedOperations();</span>
<a href="#l11.42"></a><span id="l11.42"> </span>
<a href="#l11.43"></a><span id="l11.43">     PRBool filtersRun;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1951,21 +1951,21 @@ void nsParseNewMailState::ApplyFilters(P</span>
<a href="#l12.4"></a><span id="l12.4">                                           getter_AddRefs(downloadFolder));</span>
<a href="#l12.5"></a><span id="l12.5">       if (downloadFolder)</span>
<a href="#l12.6"></a><span id="l12.6">         downloadFolder-&gt;GetURI(m_inboxUri);</span>
<a href="#l12.7"></a><span id="l12.7">       char * headers = m_headers.GetBuffer();</span>
<a href="#l12.8"></a><span id="l12.8">       PRUint32 headersSize = m_headers.GetBufferPos();</span>
<a href="#l12.9"></a><span id="l12.9">       nsresult matchTermStatus;</span>
<a href="#l12.10"></a><span id="l12.10">       if (m_filterList)</span>
<a href="#l12.11"></a><span id="l12.11">         matchTermStatus = m_filterList-&gt;ApplyFiltersToHdr(nsMsgFilterType::InboxRule,</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-                    msgHdr, downloadFolder, m_mailDB, headers, headersSize, this, msgWindow, m_inboxFile);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+                    msgHdr, downloadFolder, m_mailDB, headers, headersSize, this, msgWindow);</span>
<a href="#l12.14"></a><span id="l12.14">       if (!m_msgMovedByFilter &amp;&amp; m_deferredToServerFilterList)</span>
<a href="#l12.15"></a><span id="l12.15">       {</span>
<a href="#l12.16"></a><span id="l12.16">         matchTermStatus = m_deferredToServerFilterList-&gt;ApplyFiltersToHdr(nsMsgFilterType::InboxRule,</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-                    msgHdr, downloadFolder, m_mailDB, headers, headersSize, this, msgWindow, m_inboxFile);</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+                    msgHdr, downloadFolder, m_mailDB, headers, headersSize, this, msgWindow);</span>
<a href="#l12.19"></a><span id="l12.19">       }</span>
<a href="#l12.20"></a><span id="l12.20">     }</span>
<a href="#l12.21"></a><span id="l12.21">   }</span>
<a href="#l12.22"></a><span id="l12.22">   if (pMoved)</span>
<a href="#l12.23"></a><span id="l12.23">     *pMoved = m_msgMovedByFilter;</span>
<a href="#l12.24"></a><span id="l12.24"> }</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26"> NS_IMETHODIMP nsParseNewMailState::ApplyFilterHit(nsIMsgFilter *filter, nsIMsgWindow *msgWindow, PRBool *applyMore)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1207,23 +1207,23 @@ nsNNTPNewsgroupList::CallFilters()</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5">     // The per-newsgroup filters should go first. If something stops filter</span>
<a href="#l13.6"></a><span id="l13.6">     // execution, then users should be able to override the global filters in</span>
<a href="#l13.7"></a><span id="l13.7">     // the per-newsgroup filters.</span>
<a href="#l13.8"></a><span id="l13.8">     if (filterCount)</span>
<a href="#l13.9"></a><span id="l13.9">     {</span>
<a href="#l13.10"></a><span id="l13.10">       rv = m_filterList-&gt;ApplyFiltersToHdr(nsMsgFilterType::NewsRule,</span>
<a href="#l13.11"></a><span id="l13.11">           m_newMsgHdr, folder, m_newsDB, fullHeaders.get(),</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-          fullHeaders.Length(), this, m_msgWindow, nsnull);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+          fullHeaders.Length(), this, m_msgWindow);</span>
<a href="#l13.14"></a><span id="l13.14">     }</span>
<a href="#l13.15"></a><span id="l13.15">     if (serverFilterCount)</span>
<a href="#l13.16"></a><span id="l13.16">     {</span>
<a href="#l13.17"></a><span id="l13.17">       rv = m_serverFilterList-&gt;ApplyFiltersToHdr(nsMsgFilterType::NewsRule,</span>
<a href="#l13.18"></a><span id="l13.18">           m_newMsgHdr, folder, m_newsDB, fullHeaders.get(),</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-          fullHeaders.Length(), this, m_msgWindow, nsnull);</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+          fullHeaders.Length(), this, m_msgWindow);</span>
<a href="#l13.21"></a><span id="l13.21">     }</span>
<a href="#l13.22"></a><span id="l13.22"> </span>
<a href="#l13.23"></a><span id="l13.23">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l13.24"></a><span id="l13.24"> </span>
<a href="#l13.25"></a><span id="l13.25">     if (m_addHdrToDB)</span>
<a href="#l13.26"></a><span id="l13.26">     {</span>
<a href="#l13.27"></a><span id="l13.27">       m_newsDB-&gt;AddNewHdrToDB(m_newMsgHdr, PR_TRUE);</span>
<a href="#l13.28"></a><span id="l13.28">       if (notifier)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

