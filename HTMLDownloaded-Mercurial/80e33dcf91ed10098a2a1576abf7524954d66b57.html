<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 5005:80e33dcf91ed10098a2a1576abf7524954d66b57</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 80e33dcf91ed10098a2a1576abf7524954d66b57" />
<meta property="og:url" content="/comm-central/rev/80e33dcf91ed10098a2a1576abf7524954d66b57" />
<meta property="og:description" content="Bug 526733 - &quot;Can't install application/x-xpinstall types by clicking on links in content tabs&quot;. some minor test fixes by asuth. r=asuth, ui-r=clarkbw." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 80e33dcf91ed10098a2a1576abf7524954d66b57 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/80e33dcf91ed10098a2a1576abf7524954d66b57">shortlog</a> |
<a href="/comm-central/log/80e33dcf91ed10098a2a1576abf7524954d66b57">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/80e33dcf91ed10098a2a1576abf7524954d66b57">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/80e33dcf91ed10098a2a1576abf7524954d66b57">files</a> |
changeset |
<a href="/comm-central/raw-rev/80e33dcf91ed10098a2a1576abf7524954d66b57">raw</a>  | <a href="/comm-central/archive/80e33dcf91ed10098a2a1576abf7524954d66b57.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=526733">Bug 526733</a> - &quot;Can't install application/x-xpinstall types by clicking on links in content tabs&quot;. some minor test fixes by asuth. r=asuth, ui-r=clarkbw.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#109;&#97;&#114;&#107;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 19 Feb 2010 04:42:00 -0800</td></tr>

<tr>
 <td>changeset 5005</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/80e33dcf91ed10098a2a1576abf7524954d66b57">80e33dcf91ed10098a2a1576abf7524954d66b57</a></td>
</tr>



<tr>
<td>parent 5004</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/91ec97a51e5fdd0017f448a4b5b2cd0eb4d0e142">91ec97a51e5fdd0017f448a4b5b2cd0eb4d0e142</a>
</td>
</tr>

<tr>
<td>child 5006</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/542db8f9ca0ad807ca3cd57c0777da0137c85751">542db8f9ca0ad807ca3cd57c0777da0137c85751</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=80e33dcf91ed10098a2a1576abf7524954d66b57">3894</a></td></tr>
<tr><td>push user</td><td>bugmail@asutherland.org</td></tr>
<tr><td>push date</td><td class="date age">Wed, 24 Feb 2010 07:30:19 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@80e33dcf91ed [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=80e33dcf91ed10098a2a1576abf7524954d66b57">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=80e33dcf91ed10098a2a1576abf7524954d66b57&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=80e33dcf91ed10098a2a1576abf7524954d66b57&newProject=comm-central&newRevision=80e33dcf91ed10098a2a1576abf7524954d66b57&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=80e33dcf91ed10098a2a1576abf7524954d66b57&newProject=comm-central&newRevision=80e33dcf91ed10098a2a1576abf7524954d66b57&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=80e33dcf91ed10098a2a1576abf7524954d66b57&newProject=comm-central&newRevision=80e33dcf91ed10098a2a1576abf7524954d66b57&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28asuth%29&revcount=50">asuth</a>, <a href="/comm-central/log?rev=reviewer%28clarkbw%29&revcount=50">clarkbw</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=526733">526733</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=526733">Bug 526733</a> - &quot;Can't install application/x-xpinstall types by clicking on links in content tabs&quot;. some minor test fixes by asuth. r=asuth, ui-r=clarkbw.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/base/content/specialTabs.js">mail/base/content/specialTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/base/content/specialTabs.js">file</a> |
<a href="/comm-central/annotate/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/base/content/specialTabs.js">annotate</a> |
<a href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/base/content/specialTabs.js">diff</a> |
<a href="/comm-central/comparison/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/base/content/specialTabs.js">comparison</a> |
<a href="/comm-central/log/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/base/content/specialTabs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/locales/en-US/chrome/messenger/messenger.properties">mail/locales/en-US/chrome/messenger/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/locales/en-US/chrome/messenger/messenger.properties">file</a> |
<a href="/comm-central/annotate/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/locales/en-US/chrome/messenger/messenger.properties">annotate</a> |
<a href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/locales/en-US/chrome/messenger/messenger.properties">diff</a> |
<a href="/comm-central/comparison/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/locales/en-US/chrome/messenger/messenger.properties">comparison</a> |
<a href="/comm-central/log/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/locales/en-US/chrome/messenger/messenger.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.html">mail/test/mozmill/content-tabs/html/installxpi.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.html">file</a> |
<a href="/comm-central/annotate/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.html">annotate</a> |
<a href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.html">diff</a> |
<a href="/comm-central/comparison/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.html">comparison</a> |
<a href="/comm-central/log/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.xpi">mail/test/mozmill/content-tabs/html/installxpi.xpi</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.xpi">file</a> |
<a href="/comm-central/annotate/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.xpi">annotate</a> |
<a href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.xpi">diff</a> |
<a href="/comm-central/comparison/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.xpi">comparison</a> |
<a href="/comm-central/log/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/html/installxpi.xpi">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/test-install-xpi.js">mail/test/mozmill/content-tabs/test-install-xpi.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/test-install-xpi.js">file</a> |
<a href="/comm-central/annotate/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/test-install-xpi.js">annotate</a> |
<a href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/test-install-xpi.js">diff</a> |
<a href="/comm-central/comparison/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/test-install-xpi.js">comparison</a> |
<a href="/comm-central/log/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/content-tabs/test-install-xpi.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/shared-modules/test-window-helpers.js">mail/test/mozmill/shared-modules/test-window-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/shared-modules/test-window-helpers.js">file</a> |
<a href="/comm-central/annotate/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/shared-modules/test-window-helpers.js">annotate</a> |
<a href="/comm-central/diff/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/shared-modules/test-window-helpers.js">diff</a> |
<a href="/comm-central/comparison/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/shared-modules/test-window-helpers.js">comparison</a> |
<a href="/comm-central/log/80e33dcf91ed10098a2a1576abf7524954d66b57/mail/test/mozmill/shared-modules/test-window-helpers.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/specialTabs.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/specialTabs.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -140,16 +140,22 @@ var specialTabs = {</span>
<a href="#l1.4"></a><span id="l1.4">     delete this._protocolSvc;</span>
<a href="#l1.5"></a><span id="l1.5">     return this._protocolSvc =</span>
<a href="#l1.6"></a><span id="l1.6">       Components.classes[&quot;@mozilla.org/uriloader/external-protocol-service;1&quot;]</span>
<a href="#l1.7"></a><span id="l1.7">                 .getService(Components.interfaces.nsIExternalProtocolService);</span>
<a href="#l1.8"></a><span id="l1.8">   },</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">   // This will open any special tabs if necessary on startup.</span>
<a href="#l1.11"></a><span id="l1.11">   openSpecialTabsOnStartup: function() {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    window.addEventListener(&quot;unload&quot;, specialTabs.onunload, false);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+    Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+              .getService(Components.interfaces.nsIObserverService)</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+              .addObserver(specialTabs, &quot;mail-startup-done&quot;, false);</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+</span>
<a href="#l1.18"></a><span id="l1.18">     let tabmail = document.getElementById('tabmail');</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">     var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l1.21"></a><span id="l1.21">                           .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23">     tabmail.registerTabType(this.contentTabType);</span>
<a href="#l1.24"></a><span id="l1.24">     tabmail.registerTabType(this.chromeTabType);</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26" class="difflineat">@@ -806,10 +812,97 @@ var specialTabs = {</span>
<a href="#l1.27"></a><span id="l1.27">       }</span>
<a href="#l1.28"></a><span id="l1.28">       }</span>
<a href="#l1.29"></a><span id="l1.29">       // Save the function we'll use as listener so we can remove it later.</span>
<a href="#l1.30"></a><span id="l1.30">       aTab.closeListener = onDOMWindowClose;</span>
<a href="#l1.31"></a><span id="l1.31">       // Add the listener.</span>
<a href="#l1.32"></a><span id="l1.32">       aTab.browser.addEventListener(&quot;DOMWindowClose&quot;,</span>
<a href="#l1.33"></a><span id="l1.33">                                     aTab.closeListener, true);</span>
<a href="#l1.34"></a><span id="l1.34">     }</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+  },</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+  observe: function (aSubject, aTopic, aData) {</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+    if (aTopic != &quot;mail-startup-done&quot;)</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+      return;</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+    Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+      .getService(Components.interfaces.nsIObserverService)</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+      .addObserver(this.xpInstallObserver, &quot;xpinstall-install-blocked&quot;, false);</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+  },</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+  onunload: function () {</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+    Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+      .getService(Components.interfaces.nsIObserverService)</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+      .removeObserver(this.xpInstallObserver, &quot;xpinstall-install-blocked&quot;);</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+  },</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+  xpInstallObserver: {</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+    get _prefService() {</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+      delete this._prefService;</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+      return this._prefService =</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+        Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+                  .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+    },</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+    observe: function (aSubject, aTopic, aData) {</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+      let brandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+      let messengerBundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+      switch (aTopic) {</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+      case &quot;xpinstall-install-blocked&quot;:</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+        let installInfo =</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+          aSubject.QueryInterface(Components.interfaces.nsIXPIInstallInfo);</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+        let win = installInfo.originatingWindow;</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+        let notificationBox = getNotificationBox(win.top);</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+        if (notificationBox) {</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+          let host = installInfo.originatingURI.host;</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+          let brandShortName = brandBundle.getString(&quot;brandShortName&quot;);</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+          let notificationName, messageString, buttons;</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+          if (!this._prefService.getBoolPref(&quot;xpinstall.enabled&quot;)) {</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+            notificationName = &quot;xpinstall-disabled&quot;;</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+            if (this._prefService.prefIsLocked(&quot;xpinstall.enabled&quot;)) {</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+              messageString = messengerBundle.getString(&quot;xpinstallDisabledMessageLocked&quot;);</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+              buttons = [];</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+            }</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+            else {</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+              messageString = messengerBundle.getString(&quot;xpinstallDisabledMessage&quot;);</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+              buttons = [{</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+                label: messengerBundle.getString(&quot;xpinstallDisabledButton&quot;),</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+                accessKey: messengerBundle.getString(&quot;xpinstallDisabledButton.accesskey&quot;),</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+                popup: null,</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+                callback: function editPrefs() {</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+                  specialTabs.xpInstallObserver</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+                             ._prefService.setBoolPref(&quot;xpinstall.enabled&quot;, true);</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+                  return false;</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+                }</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+              }];</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineplus">+            }</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+          }</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+          else {</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+            notificationName = &quot;xpinstall&quot;;</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+            messageString = messengerBundle.getFormattedString(&quot;xpinstallPromptWarning&quot;,</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+                                                               [brandShortName, host]);</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+            buttons = [{</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+              label: messengerBundle.getString(&quot;xpinstallPromptAllowButton&quot;),</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+              accessKey: messengerBundle.getString(&quot;xpinstallPromptAllowButton.accesskey&quot;),</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+              popup: null,</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+              callback: function() {</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+                var mgr = Components.classes[&quot;@mozilla.org/xpinstall/install-manager;1&quot;]</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+                  .createInstance(Components.interfaces.nsIXPInstallManager);</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineplus">+                mgr.initManagerWithInstallInfo(installInfo);</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+                return false;</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+              }</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineplus">+            }];</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineplus">+          }</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineplus">+</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineplus">+          if (!notificationBox.getNotificationWithValue(notificationName)) {</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+            const priority = notificationBox.PRIORITY_WARNING_MEDIUM;</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineplus">+            const iconURL = &quot;chrome://mozapps/skin/update/update.png&quot;;</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineplus">+            notificationBox.appendNotification(messageString, notificationName,</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineplus">+                                               iconURL, priority, buttons);</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+          }</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+        }</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+        break;</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+      }</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineplus">+    }</span>
<a href="#l1.122"></a><span id="l1.122">   }</span>
<a href="#l1.123"></a><span id="l1.123"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -506,16 +506,33 @@ headerccFieldYou=You</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> # LOCALIZATION NOTE (headerbccFieldYou): second person prepositional object</span>
<a href="#l2.6"></a><span id="l2.6"> # pronoun used in the &quot;bcc&quot; header of the message header pane.</span>
<a href="#l2.7"></a><span id="l2.7"> headerbccFieldYou=You</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> # Shown when content tabs are being loaded.</span>
<a href="#l2.10"></a><span id="l2.10"> loadingTab=Loadingâ€¦</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+# LOCALIZATION NOTE (xpinstallPromptWarning):</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+# %1$S is replaced by brandShortName, %2$S is replaced by the host name of the</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+# site.</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+xpinstallPromptWarning=%1$S prevented this site (%2$S) from asking you to install software on your computer.</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+xpinstallPromptAllowButton=Allow</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+# LOCALIZATION NOTE (xpinstallPromptAllowButton.accesskey):</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+# Accessibility Note:</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+# Be sure you do not choose an accesskey that is used elsewhere in the active</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+# context (e.g. main menu bar, submenu of the warning popup button).</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+# See http://www.mozilla.org/access/keyboard/accesskey for details</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+xpinstallPromptAllowButton.accesskey=A</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+xpinstallDisabledMessageLocked=Software installation has been disabled by your system administrator.</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+xpinstallDisabledMessage=Software installation is currently disabled. Click Enable and try again.</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+xpinstallDisabledButton=Enable</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+xpinstallDisabledButton.accesskey=n</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+</span>
<a href="#l2.29"></a><span id="l2.29"> applyToCollapsedMsgsTitle=Confirm Delete of Messages in Collapsed Thread(s)</span>
<a href="#l2.30"></a><span id="l2.30"> applyToCollapsedMsgs=Warning - this will delete messages in collapsed thread(s)</span>
<a href="#l2.31"></a><span id="l2.31"> applyToCollapsedAlwaysAskCheckbox=Always ask me before deleting messages in collapsed threads</span>
<a href="#l2.32"></a><span id="l2.32"> applyNowButton=Apply</span>
<a href="#l2.33"></a><span id="l2.33"> </span>
<a href="#l2.34"></a><span id="l2.34"> mailServerLoginFailedTitle=Login Failed</span>
<a href="#l2.35"></a><span id="l2.35"> # LOCALIZATION NOTE (mailServerLoginFailedTitle): Insert &quot;%S&quot; in your</span>
<a href="#l2.36"></a><span id="l2.36"> # translation where you wish to display the hostname of the server to which</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/html/installxpi.html</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,10 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+&lt;html&gt;</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+  &lt;head&gt;</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+    &lt;title&gt;Test xpi installation&lt;/title&gt; </span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+  &lt;/head&gt;</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+  &lt;body bgcolor=&quot;#FFFFFF&quot;&gt;</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+    &lt;h1&gt;Test xpi installation&lt;/h1&gt;</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+    &lt;a id=&quot;installlink&quot; href=&quot;installxpi.xpi&quot;&gt;Install this xpi&lt;/a&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  &lt;/body&gt;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">new file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..259ff35a621b7de8d2e571442e291fc02f25ff64</span>
<a href="#l4.3"></a><span id="l4.3">GIT binary patch
literal 680
zc$^FHW@h1H00HL}el`q9fS*B&gt;AvvQcKQ~n`H!&amp;|WEw#8LG=!6Z`D{vsHwcGTurPdM
z6k!MenjivH&amp;%s~?G@&lt;UE^5rH*1_noF1_o}R37L7tC5bsXdPON|VBH6RIv*hEE)9&lt;L
zZ#EFAeI6e2EiEW2;e|qv&gt;*g764rWX{`s3EcO{SNcmQG&amp;zasO$n6A9&lt;`eVx~T@AB&lt;q
zoA;hL$Q~@J|Kv)UY|eS1(_Pa)vtLlyH0xIM+S42hcdeUytDI}AW1d7CNA-!%3l&gt;SP
zv0JKEt+9GyZsTF2Lmi!sVIuK1=Q|BQ7|1EB@x7XOSEgLxXmQxmuIalnStgWjyc}G;
zJmtzOB|UB5PcmFemB+O1zU=wN&lt;+LH?z4bZ?R_?PdtO`DU7Q%wdJ+n9J@66*#Dp|u9
zF^OZEPM^((Uwar&lt;_hn9C+`e}!i}kw1lIrXOmt1mZ?9)CyXSs{C%$G3xZvrn(|Gi~r
zJeRkTKhogigBgz)+F1M_SbWgryKb`h&lt;=OM|9csl7KJ~sm|9OJ*+o^iqC-xnVee&gt;Y;
z;uj$@&amp;m6&gt;?CC;{LOZ2@vxx(Y$`4&gt;S)JM=&lt;6d0dg+p&amp;n$ETC@9CgHLs?Oxy9N$9Oi$
zuCkQB5|h7^W%XOXpk&gt;!$0w;)andJML^q-w^`LjhjXY!Rl6Oa624e(}U5@*Jh26*A@
zC5&lt;2wBSo-6QbcG40|Ue)TxkJf5+m3oCm@NEGFTxg17Zp*8%QM+5KaKmOduWrMZo;G</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">new file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- /dev/null</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/test-install-xpi.js</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -0,0 +1,172 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+ *</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+ *</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+ * License.</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+ *</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+ * The Original Code is mozilla.org code.</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+ *</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+ * Mozilla Messaging.</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+ *</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+ *   Mark Banner &lt;mark@standard8.plus.com&gt;</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+ *</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+ *</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+var MODULE_NAME = 'test-content-tab';</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+var MODULE_REQUIRES = ['window-helpers'];</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+var controller = {};</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+Components.utils.import('resource://mozmill/modules/controller.js', controller);</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+var elib = {};</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+Cu.import('resource://mozmill/modules/elementslib.js', elib);</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+var mozmill = {};</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+Components.utils.import('resource://mozmill/modules/mozmill.js', mozmill);</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+var elementslib = {};</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+Components.utils.import('resource://mozmill/modules/elementslib.js', elementslib);</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+var windowHelper;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+var mc;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+// RELATIVE_ROOT messes with the collector, so we have to bring the path back</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+// so we get the right path for the resources.</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+var url = collector.addHttpResource('../content-tabs/html', 'content-tabs');</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+var siteRegExp = new RegExp(&quot;^&quot; + url);</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+var installPageUrl = url + &quot;installxpi.html&quot;;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+const ALERT_TIMEOUT = 10000;</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+let AlertWatcher = {</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+  planForAlert: function(aController) {</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+    this.alerted = false;</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+    aController.window.document.addEventListener(&quot;AlertActive&quot;,</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+                                                 this.alertActive, false);</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+  },</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+  waitForAlert: function(aController) {</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+    if (!this.alerted) {</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+      aController.waitForEval(&quot;subject.alerted&quot;, ALERT_TIMEOUT, 100, this);</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+    }</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+    aController.window.document.removeEventListener(&quot;AlertActive&quot;,</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+                                                    this.alertActive, false);</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+  },</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+  alerted: false,</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+  alertActive: function() {</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+    AlertWatcher.alerted = true;</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+  }</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+};</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+var setupModule = function (module) {</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+  windowHelper = collector.getModule('window-helpers');</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+  mc = windowHelper.wait_for_existing_window(&quot;mail:3pane&quot;);</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+  windowHelper.installInto(module);</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+  windowHelper.augment_controller(mc);</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+};</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+function close_xpinstall_dialog(xpidlg) {</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+ xpidlg.window.document.documentElement.cancelDialog();</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+}</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+function click_notification_box_action_in_current_tab() {</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineplus">+  let notificationBox =</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineplus">+    mc.tabmail.selectedTab.panel.getElementsByTagName(&quot;notificationbox&quot;)[0];</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineplus">+  // click the stupid button</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+dump(&quot;@@\n@@\n@@\n@@\nnotification box: &quot; + notificationBox + &quot;\n&quot;);</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineplus">+  let actionButton = notificationBox.currentNotification.getElementsByTagName(&quot;button&quot;)[0];</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineplus">+  dump(&quot;@@\nactionbutton: &quot; + actionButton + &quot;\n&quot;);</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineplus">+//    mc.aid(notificationBox.currentNotification,</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineplus">+//                            {&quot;tagName&quot;: &quot;button&quot;});</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineplus">+  mc.click(new elib.Elem(actionButton));</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+}</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineplus">+function install_xpi() {</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+  // make the animation only take one frame</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+  let notificationBox =</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+    mc.tabmail.selectedTab.panel.getElementsByTagName(&quot;notificationbox&quot;)[0];</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+  notificationBox.slideSteps = 1;</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+  // Clicking the link will bring up a notification box...</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineplus">+  AlertWatcher.planForAlert(mc);</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineplus">+  mc.click(new elib.Elem(mc.tabmail.getBrowserForSelectedTab().contentDocument</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+                           .getElementById(&quot;installlink&quot;)));</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineplus">+  AlertWatcher.waitForAlert(mc);</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineplus">+</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineplus">+  // sleep so the one frame happens.</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineplus">+  mc.sleep(55);</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineplus">+</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineplus">+  // which we want to click on!</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineplus">+  plan_for_modal_dialog(&quot;xpinstallConfirm&quot;, close_xpinstall_dialog);</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineplus">+  click_notification_box_action_in_current_tab();</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineplus">+  wait_for_modal_dialog(&quot;xpinstallConfirm&quot;);</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineplus">+}</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineplus">+</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineplus">+function test_install_xpi_basic() {</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineplus">+</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineplus">+  // We have to do this using the tabmail API as we need to pass the scope</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineplus">+  // for allowing browsing so that clicking on the link works.</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineplus">+  mc.tabmail.openTab(&quot;contentTab&quot;,</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineplus">+                     { contentPage: installPageUrl,</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineplus">+                       clickHandler: &quot;specialTabs.siteClickHandler(event, siteRegExp);&quot; });</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineplus">+</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineplus">+</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineplus">+  mc.waitForEval(&quot;subject.childNodes.length == &quot; + (preCount + 1), 1000, 100,</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineplus">+                 mc.tabmail.tabContainer);</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineplus">+</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+  if (mc.tabmail.tabContainer.childNodes.length != preCount + 1)</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+    throw new Error(&quot;The content tab didn't open&quot;);</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineplus">+  mc.waitForEval(&quot;subject.busy == false&quot;, 3000, 100,</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineplus">+                 mc.tabmail.selectedTab);</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineplus">+</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineplus">+  // Check that window.content is set up correctly wrt content-primary and</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineplus">+  // content-targetable.</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineplus">+  if (mc.window.content.location != installPageUrl)</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineplus">+    throw new Error(&quot;window.content is not set to the url loaded, incorrect type=\&quot;...\&quot;?&quot;);</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineplus">+</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineplus">+  install_xpi();</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineplus">+}</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineplus">+</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineplus">+function test_xpinstall_disabled() {</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineplus">+  let prefBranch = Cc[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineplus">+                     .getService(Ci.nsIPrefBranch);</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineplus">+</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineplus">+  prefBranch.setBoolPref(&quot;xpinstall.enabled&quot;, false);</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineplus">+</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineplus">+  // Try installation again - this time we'll get an install has been disabled</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineplus">+  // message.</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineplus">+  AlertWatcher.planForAlert(mc);</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineplus">+  mc.click(new elib.Elem(mc.tabmail.getBrowserForSelectedTab().contentDocument</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineplus">+                           .getElementById(&quot;installlink&quot;)));</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineplus">+  AlertWatcher.waitForAlert(mc);</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineplus">+</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineplus">+  // tell it to enable installation!</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineplus">+  click_notification_box_action_in_current_tab();</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineplus">+</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineplus">+  // XXX can we check the element has gone away?</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineplus">+</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineplus">+  install_xpi();</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -244,33 +244,35 @@ dump(&quot; xul window: &quot; + xulWindow + &quot;\n&quot;)</span>
<a href="#l6.4"></a><span id="l6.4"> dump(&quot; dom window: &quot; + domWindow + &quot;\n&quot;);</span>
<a href="#l6.5"></a><span id="l6.5">       let troller = new controller.MozMillController(domWindow);</span>
<a href="#l6.6"></a><span id="l6.6">       augment_controller(troller, this.waitingForOpen);</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> dump(&quot; cleanup!\n&quot;);</span>
<a href="#l6.9"></a><span id="l6.9">       delete this.waitingList[this.waitingForOpen];</span>
<a href="#l6.10"></a><span id="l6.10">       this._timer.cancel();</span>
<a href="#l6.11"></a><span id="l6.11"> dump(&quot;canceled!\n&quot;);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+      // now we are waiting for it to close...</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+      this.waitingForClose = this.waitingForOpen;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+      this.waitingForOpen = null;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+</span>
<a href="#l6.17"></a><span id="l6.17">       try {</span>
<a href="#l6.18"></a><span id="l6.18">         dump(&quot;::: calling\n&quot;);</span>
<a href="#l6.19"></a><span id="l6.19">         try {</span>
<a href="#l6.20"></a><span id="l6.20">           let runner = new frame.Runner(collector);</span>
<a href="#l6.21"></a><span id="l6.21">           runner.wrapper(this.subTestFunc, troller);</span>
<a href="#l6.22"></a><span id="l6.22">         }</span>
<a href="#l6.23"></a><span id="l6.23">         catch (ex) {</span>
<a href="#l6.24"></a><span id="l6.24">           dump(&quot;problem running: &quot; + ex.fileName + &quot;:&quot; + ex.lineNumber + &quot;: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l6.25"></a><span id="l6.25">         }</span>
<a href="#l6.26"></a><span id="l6.26">         dump(&quot;::: called\n&quot;);</span>
<a href="#l6.27"></a><span id="l6.27">       }</span>
<a href="#l6.28"></a><span id="l6.28">       finally {</span>
<a href="#l6.29"></a><span id="l6.29">         this.subTestFunc = null;</span>
<a href="#l6.30"></a><span id="l6.30">       }</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-      // now we are waiting for it to close...</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-      this.waitingForClose = this.waitingForOpen;</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-      this.waitingForOpen = null;</span>
<a href="#l6.34"></a><span id="l6.34"> </span>
<a href="#l6.35"></a><span id="l6.35">       // if the test failed, make sure we force the window closed...</span>
<a href="#l6.36"></a><span id="l6.36">       // except I'm not sure how to easily figure that out...</span>
<a href="#l6.37"></a><span id="l6.37">       // so just close it no matter what.</span>
<a href="#l6.38"></a><span id="l6.38">       troller.window.close();</span>
<a href="#l6.39"></a><span id="l6.39">     }</span>
<a href="#l6.40"></a><span id="l6.40">     // notify is only used for modal dialogs, which are never the first window,</span>
<a href="#l6.41"></a><span id="l6.41">     //  so we can always just use this set of timeouts/intervals.</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineat">@@ -287,24 +289,25 @@ dump(&quot;canceled!\n&quot;);</span>
<a href="#l6.43"></a><span id="l6.43">    *  reality, all we do is potentially soak up the event loop a little to</span>
<a href="#l6.44"></a><span id="l6.44">    */</span>
<a href="#l6.45"></a><span id="l6.45">   waitForModalDialog: function WindowWatcher_waitForModalDialog(aWindowType) {</span>
<a href="#l6.46"></a><span id="l6.46">     // did the window already come and go?</span>
<a href="#l6.47"></a><span id="l6.47">     if (this.subTestFunc == null)</span>
<a href="#l6.48"></a><span id="l6.48">       return;</span>
<a href="#l6.49"></a><span id="l6.49">     // spin the event loop until we the window has come and gone.</span>
<a href="#l6.50"></a><span id="l6.50">     controller.waitForEval(</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-      'subject.waitingForOpen == null &amp;&amp; subject.waitingForClose == null',</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+      'subject.waitingForOpen == null &amp;&amp; subject.monitorizeClose()',</span>
<a href="#l6.53"></a><span id="l6.53">       WINDOW_OPEN_TIMEOUT_MS, WINDOW_OPEN_CHECK_INTERVAL_MS, this);</span>
<a href="#l6.54"></a><span id="l6.54">     this.waitingForClose = null;</span>
<a href="#l6.55"></a><span id="l6.55">   },</span>
<a href="#l6.56"></a><span id="l6.56"> </span>
<a href="#l6.57"></a><span id="l6.57">   planForWindowClose: function WindowWatcher_planForWindowClose(aXULWindow) {</span>
<a href="#l6.58"></a><span id="l6.58">     let windowType =</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-      aXULWindow.document.documentElement.getAttribute(&quot;windowtype&quot;);</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+      aXULWindow.document.documentElement.getAttribute(&quot;windowtype&quot;) ||</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+      aXULWindow.document.documentElement.getAttribute(&quot;id&quot;);</span>
<a href="#l6.62"></a><span id="l6.62">     this.waitingList[windowType] = aXULWindow;</span>
<a href="#l6.63"></a><span id="l6.63">     this.waitingForClose = windowType;</span>
<a href="#l6.64"></a><span id="l6.64">   },</span>
<a href="#l6.65"></a><span id="l6.65"> </span>
<a href="#l6.66"></a><span id="l6.66">   /**</span>
<a href="#l6.67"></a><span id="l6.67">    * The current windowType we are waiting to close.  Same deal as</span>
<a href="#l6.68"></a><span id="l6.68">    *  waitingForOpen, this makes the eval less crazy.</span>
<a href="#l6.69"></a><span id="l6.69">    */</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineat">@@ -405,17 +408,18 @@ dump(&quot;### not busy\n&quot;);</span>
<a href="#l6.71"></a><span id="l6.71"> dump(&quot;### has contentViewer\n&quot;);</span>
<a href="#l6.72"></a><span id="l6.72">     // now we're cooking! let's get the document...</span>
<a href="#l6.73"></a><span id="l6.73">     let outerDoc = docshell.contentViewer.DOMDocument;</span>
<a href="#l6.74"></a><span id="l6.74">     // and make sure it's not blank.  that's also an intermediate state.</span>
<a href="#l6.75"></a><span id="l6.75">     if (outerDoc.location.href == &quot;about:blank&quot;)</span>
<a href="#l6.76"></a><span id="l6.76">       return false;</span>
<a href="#l6.77"></a><span id="l6.77"> dump(&quot;has href: &quot; + outerDoc.location.href + &quot;\n&quot;);</span>
<a href="#l6.78"></a><span id="l6.78">     // finally, we can now have a windowtype!</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-    let windowType = outerDoc.documentElement.getAttribute(&quot;windowtype&quot;);</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+    let windowType = outerDoc.documentElement.getAttribute(&quot;windowtype&quot;) ||</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+                     outerDoc.documentElement.getAttribute(&quot;id&quot;);</span>
<a href="#l6.82"></a><span id="l6.82"> dump(&quot;has windowtype: &quot; + windowType + &quot;\n&quot;);</span>
<a href="#l6.83"></a><span id="l6.83"> dump(&quot;this: &quot; + this + &quot;\n&quot;);</span>
<a href="#l6.84"></a><span id="l6.84"> dump(&quot;waitingList: &quot; + this.waitingList + &quot;\n&quot;);</span>
<a href="#l6.85"></a><span id="l6.85">     // stash the window if we were watching for it</span>
<a href="#l6.86"></a><span id="l6.86">     if (windowType in this.waitingList) {</span>
<a href="#l6.87"></a><span id="l6.87">       dump(&quot;It's there! setting...\n&quot;);</span>
<a href="#l6.88"></a><span id="l6.88">       this.waitingList[windowType] = aXULWindow;</span>
<a href="#l6.89"></a><span id="l6.89">     }</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineat">@@ -430,17 +434,18 @@ dump(&quot;waitingList: &quot; + this.waitingList </span>
<a href="#l6.91"></a><span id="l6.91">    * Closing windows have the advantage of having to already have been loaded,</span>
<a href="#l6.92"></a><span id="l6.92">    *  so things like their windowtype are immediately available.</span>
<a href="#l6.93"></a><span id="l6.93">    */</span>
<a href="#l6.94"></a><span id="l6.94">   onCloseWindow: function WindowWatcher_onCloseWindow(aXULWindow) {</span>
<a href="#l6.95"></a><span id="l6.95">     dump(&quot;!!! CLOSE EVENT: &quot; + aXULWindow + &quot;\n&quot;);</span>
<a href="#l6.96"></a><span id="l6.96">     let domWindow = aXULWindow.docShell.QueryInterface(Ci.nsIInterfaceRequestor)</span>
<a href="#l6.97"></a><span id="l6.97">                                        .getInterface(Ci.nsIDOMWindowInternal);</span>
<a href="#l6.98"></a><span id="l6.98">     let windowType =</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineminus">-      domWindow.document.documentElement.getAttribute(&quot;windowtype&quot;);</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineplus">+      domWindow.document.documentElement.getAttribute(&quot;windowtype&quot;) ||</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineplus">+      domWindow.document.documentElement.getAttribute(&quot;id&quot;);</span>
<a href="#l6.102"></a><span id="l6.102">     // XXX because of how we dance with things, equivalence is not gonna</span>
<a href="#l6.103"></a><span id="l6.103">     //  happen for us.  This is most pragmatic.</span>
<a href="#l6.104"></a><span id="l6.104">     if (this.waitingList[windowType] !== null)</span>
<a href="#l6.105"></a><span id="l6.105">       this.waitingList[windowType] = null;</span>
<a href="#l6.106"></a><span id="l6.106">     dump(&quot;close end proc\n&quot;);</span>
<a href="#l6.107"></a><span id="l6.107">   },</span>
<a href="#l6.108"></a><span id="l6.108"> };</span>
<a href="#l6.109"></a><span id="l6.109"> </span>
<a href="#l6.110"></a><span id="l6.110" class="difflineat">@@ -498,17 +503,19 @@ function wait_for_new_window(aWindowType</span>
<a href="#l6.111"></a><span id="l6.111"> </span>
<a href="#l6.112"></a><span id="l6.112"> /**</span>
<a href="#l6.113"></a><span id="l6.113">  * Plan for the imminent display of a modal dialog.  Modal dialogs spin their</span>
<a href="#l6.114"></a><span id="l6.114">  *  own event loop which means that either that control flow will not return</span>
<a href="#l6.115"></a><span id="l6.115">  *  to the caller until the modal dialog finishes running.  This means that</span>
<a href="#l6.116"></a><span id="l6.116">  *  you need to provide a sub-test function to be run inside the modal dialog</span>
<a href="#l6.117"></a><span id="l6.117">  *  (and it should not start with &quot;test&quot; or mozmill will also try and run it.)</span>
<a href="#l6.118"></a><span id="l6.118">  *</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineminus">- * @param aWindowType The window type that you expect the modal dialog to have.</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineplus">+ * @param aWindowType The window type that you expect the modal dialog to have</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineplus">+ *                    or the id of the window if there is no window type</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineplus">+ *                    available.</span>
<a href="#l6.123"></a><span id="l6.123">  * @param aSubTestFunction The sub-test function that will be run once the modal</span>
<a href="#l6.124"></a><span id="l6.124">  *     dialog appears and is loaded.  This function should take one argument,</span>
<a href="#l6.125"></a><span id="l6.125">  *     a MozmillController against the modal dialog.</span>
<a href="#l6.126"></a><span id="l6.126">  */</span>
<a href="#l6.127"></a><span id="l6.127"> function plan_for_modal_dialog(aWindowType, aSubTestFunction) {</span>
<a href="#l6.128"></a><span id="l6.128">   WindowWatcher.ensureInited();</span>
<a href="#l6.129"></a><span id="l6.129">   WindowWatcher.planForModalDialog(aWindowType, aSubTestFunction);</span>
<a href="#l6.130"></a><span id="l6.130"> }</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineat">@@ -600,21 +607,24 @@ var AugmentEverybodyWith = {</span>
<a href="#l6.132"></a><span id="l6.132">      * Examples:</span>
<a href="#l6.133"></a><span id="l6.133">      *  // by class of the node</span>
<a href="#l6.134"></a><span id="l6.134">      *  a(&quot;searchVal0&quot;, {class: &quot;search-value-textbox&quot;});</span>
<a href="#l6.135"></a><span id="l6.135">      *  // when the thing is vaguely deck-like</span>
<a href="#l6.136"></a><span id="l6.136">      *  a(&quot;searchVal0&quot;, {crazyDeck: 0});</span>
<a href="#l6.137"></a><span id="l6.137">      *  // when you want the first descendent with the given tagName</span>
<a href="#l6.138"></a><span id="l6.138">      *  a(&quot;threadTree&quot;, {tagName: &quot;treechildren&quot;})</span>
<a href="#l6.139"></a><span id="l6.139">      *</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineplus">+     * @param aId The element id or the actual element.</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineplus">+     *</span>
<a href="#l6.142"></a><span id="l6.142">      * @return the anonymous element determined by the query found in the</span>
<a href="#l6.143"></a><span id="l6.143">      *  anonymous sub-tree of the element with the given id.</span>
<a href="#l6.144"></a><span id="l6.144">      */</span>
<a href="#l6.145"></a><span id="l6.145">     a: function _get_anon_element_by_id_and_query(aId, aQuery) {</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineminus">-      let realElem = this.window.document.getElementById(aId);</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineplus">+      let realElem = (typeof(aId) == &quot;string&quot;) ?</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineplus">+                       this.window.document.getElementById(aId) : aId;</span>
<a href="#l6.149"></a><span id="l6.149">       if (aQuery[&quot;class&quot;]) {</span>
<a href="#l6.150"></a><span id="l6.150">         return this.window.document.getAnonymousElementByAttribute(</span>
<a href="#l6.151"></a><span id="l6.151">           realElem, &quot;class&quot;, aQuery[&quot;class&quot;]);</span>
<a href="#l6.152"></a><span id="l6.152">       }</span>
<a href="#l6.153"></a><span id="l6.153">       else if(aQuery.crazyDeck != null) {</span>
<a href="#l6.154"></a><span id="l6.154">         let anonNodes = this.window.document.getAnonymousNodes(realElem);</span>
<a href="#l6.155"></a><span id="l6.155">         let index;</span>
<a href="#l6.156"></a><span id="l6.156">         if (realElem.hasAttribute(&quot;selectedIndex&quot;))</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

