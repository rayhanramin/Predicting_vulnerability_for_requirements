<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 6457:098388acf16b06ff5fa8d31a95f49365e8b9466f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 098388acf16b06ff5fa8d31a95f49365e8b9466f" />
<meta property="og:url" content="/comm-central/rev/098388acf16b06ff5fa8d31a95f49365e8b9466f" />
<meta property="og:description" content="bug 410613 - SeaMonkey should support &quot;OpenSearch&quot;, r=Mnyromyr sr=Neil" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 098388acf16b06ff5fa8d31a95f49365e8b9466f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/098388acf16b06ff5fa8d31a95f49365e8b9466f">shortlog</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/098388acf16b06ff5fa8d31a95f49365e8b9466f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f">files</a> |
changeset |
<a href="/comm-central/raw-rev/098388acf16b06ff5fa8d31a95f49365e8b9466f">raw</a>  | <a href="/comm-central/archive/098388acf16b06ff5fa8d31a95f49365e8b9466f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=410613">bug 410613</a> - SeaMonkey should support &quot;OpenSearch&quot;, r=Mnyromyr sr=Neil
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#111;&#98;&#101;&#114;&#116;&#32;&#75;&#97;&#105;&#115;&#101;&#114;&#32;&#60;&#107;&#97;&#105;&#114;&#111;&#64;&#107;&#97;&#105;&#114;&#111;&#46;&#97;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 30 Sep 2010 11:57:09 +0200</td></tr>

<tr>
 <td>changeset 6457</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/098388acf16b06ff5fa8d31a95f49365e8b9466f">098388acf16b06ff5fa8d31a95f49365e8b9466f</a></td>
</tr>



<tr>
<td>parent 6456</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9021466c11d896096a6d83d0cbefcfe9e12c9b00">9021466c11d896096a6d83d0cbefcfe9e12c9b00</a>
</td>
</tr>

<tr>
<td>child 6458</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/addb24b470d63d75c53ad362bfea2669e0fd81f1">addb24b470d63d75c53ad362bfea2669e0fd81f1</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=098388acf16b06ff5fa8d31a95f49365e8b9466f">4987</a></td></tr>
<tr><td>push user</td><td>kairo@kairo.at</td></tr>
<tr><td>push date</td><td class="date age">Thu, 30 Sep 2010 09:57:37 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@098388acf16b [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=098388acf16b06ff5fa8d31a95f49365e8b9466f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=098388acf16b06ff5fa8d31a95f49365e8b9466f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=098388acf16b06ff5fa8d31a95f49365e8b9466f&newProject=comm-central&newRevision=098388acf16b06ff5fa8d31a95f49365e8b9466f&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=098388acf16b06ff5fa8d31a95f49365e8b9466f&newProject=comm-central&newRevision=098388acf16b06ff5fa8d31a95f49365e8b9466f&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=098388acf16b06ff5fa8d31a95f49365e8b9466f&newProject=comm-central&newRevision=098388acf16b06ff5fa8d31a95f49365e8b9466f&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Mnyromyr%29&revcount=50">Mnyromyr</a>, <a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=410613">410613</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=410613">bug 410613</a> - SeaMonkey should support &quot;OpenSearch&quot;, r=Mnyromyr sr=Neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/Makefile.in">suite/browser/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/Makefile.in">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/Makefile.in">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/Makefile.in">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/Makefile.in">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/browser-prefs.js">suite/browser/browser-prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/browser-prefs.js">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/browser-prefs.js">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/browser-prefs.js">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/browser-prefs.js">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/browser-prefs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/jar.mn">suite/browser/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/jar.mn">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/jar.mn">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/jar.mn">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/jar.mn">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.js">suite/browser/navigator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.js">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.js">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.js">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.js">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.xul">suite/browser/navigator.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.xul">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.xul">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.xul">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.xul">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigator.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigatorDD.js">suite/browser/navigatorDD.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigatorDD.js">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigatorDD.js">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigatorDD.js">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigatorDD.js">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/navigatorDD.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/public/Makefile.in">suite/browser/public/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/public/Makefile.in">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/public/Makefile.in">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/public/Makefile.in">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/public/Makefile.in">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/public/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/public/nsISearchService.idl">suite/browser/public/nsISearchService.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/public/nsISearchService.idl">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/public/nsISearchService.idl">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/public/nsISearchService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/searchconfig.properties">suite/browser/searchconfig.properties</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/searchconfig.properties">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/searchconfig.properties">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/searchconfig.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/Makefile.in">suite/browser/src/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/Makefile.in">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/Makefile.in">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/Makefile.in">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/Makefile.in">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsInternetSearchService.cpp">suite/browser/src/nsInternetSearchService.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsInternetSearchService.cpp">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsInternetSearchService.cpp">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsInternetSearchService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsInternetSearchService.h">suite/browser/src/nsInternetSearchService.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsInternetSearchService.h">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsInternetSearchService.h">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsInternetSearchService.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsLocalSearchService.cpp">suite/browser/src/nsLocalSearchService.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsLocalSearchService.cpp">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsLocalSearchService.cpp">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsLocalSearchService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsLocalSearchService.h">suite/browser/src/nsLocalSearchService.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsLocalSearchService.h">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsLocalSearchService.h">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/src/nsLocalSearchService.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/urlbarBindings.xml">suite/browser/urlbarBindings.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/urlbarBindings.xml">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/urlbarBindings.xml">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/urlbarBindings.xml">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/urlbarBindings.xml">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/browser/urlbarBindings.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/build/nsSuiteModule.cpp">suite/build/nsSuiteModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/build/nsSuiteModule.cpp">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/build/nsSuiteModule.cpp">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/build/nsSuiteModule.cpp">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/build/nsSuiteModule.cpp">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/build/nsSuiteModule.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/contentAreaContextOverlay.xul">suite/common/contentAreaContextOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/contentAreaContextOverlay.xul">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/contentAreaContextOverlay.xul">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/contentAreaContextOverlay.xul">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/contentAreaContextOverlay.xul">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/contentAreaContextOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/jar.mn">suite/common/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/jar.mn">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/jar.mn">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/jar.mn">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/jar.mn">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/nsContextMenu.js">suite/common/nsContextMenu.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/nsContextMenu.js">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/nsContextMenu.js">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/nsContextMenu.js">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/nsContextMenu.js">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/nsContextMenu.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.js">suite/common/pref/pref-search.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.js">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.js">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.js">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.js">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.xul">suite/common/pref/pref-search.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.xul">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.xul">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.xul">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.xul">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/pref/pref-search.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/internetresults.js">suite/common/search/internetresults.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/internetresults.js">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/internetresults.js">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/internetresults.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/internetresults.xul">suite/common/search/internetresults.xul</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/internetresults.xul">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/internetresults.xul">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/internetresults.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-editor.js">suite/common/search/search-editor.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-editor.js">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-editor.js">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-editor.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-editor.xul">suite/common/search/search-editor.xul</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-editor.xul">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-editor.xul">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-editor.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.js">suite/common/search/search-panel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.js">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.js">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.js">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.js">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.xul">suite/common/search/search-panel.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.xul">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.xul">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.xul">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.xul">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/search-panel.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/shared.js">suite/common/search/shared.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/shared.js">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/shared.js">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/search/shared.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/SuiteCommon.manifest">suite/common/src/SuiteCommon.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/SuiteCommon.manifest">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/SuiteCommon.manifest">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/SuiteCommon.manifest">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/SuiteCommon.manifest">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/SuiteCommon.manifest">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/nsSidebar.js">suite/common/src/nsSidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/nsSidebar.js">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/nsSidebar.js">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/nsSidebar.js">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/nsSidebar.js">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/common/src/nsSidebar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/confvars.sh">suite/confvars.sh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/confvars.sh">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/confvars.sh">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/confvars.sh">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/confvars.sh">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/confvars.sh">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/package-manifest.in">suite/installer/package-manifest.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/package-manifest.in">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/package-manifest.in">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/package-manifest.in">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/package-manifest.in">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/package-manifest.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/removed-files.in">suite/installer/removed-files.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/removed-files.in">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/removed-files.in">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/removed-files.in">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/removed-files.in">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/installer/removed-files.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/Makefile.in">suite/locales/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/Makefile.in">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/Makefile.in">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/Makefile.in">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/Makefile.in">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/browser/region.properties">suite/locales/en-US/chrome/browser/region.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/browser/region.properties">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/browser/region.properties">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/browser/region.properties">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/browser/region.properties">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/browser/region.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/contentAreaCommands.properties">suite/locales/en-US/chrome/common/contentAreaCommands.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/contentAreaCommands.properties">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/contentAreaCommands.properties">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/contentAreaCommands.properties">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/contentAreaCommands.properties">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/contentAreaCommands.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/pref/pref-search.dtd">suite/locales/en-US/chrome/common/pref/pref-search.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/pref/pref-search.dtd">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/pref/pref-search.dtd">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/pref/pref-search.dtd">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/pref/pref-search.dtd">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/pref/pref-search.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/region.properties">suite/locales/en-US/chrome/common/region.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/region.properties">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/region.properties">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/region.properties">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/region.properties">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/region.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/default.htm">suite/locales/en-US/chrome/common/search/default.htm</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/default.htm">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/default.htm">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/default.htm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/internetresults.dtd">suite/locales/en-US/chrome/common/search/internetresults.dtd</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/internetresults.dtd">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/internetresults.dtd">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/internetresults.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-editor.dtd">suite/locales/en-US/chrome/common/search/search-editor.dtd</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-editor.dtd">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-editor.dtd">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-editor.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-editor.properties">suite/locales/en-US/chrome/common/search/search-editor.properties</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-editor.properties">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-editor.properties">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-editor.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-panel.dtd">suite/locales/en-US/chrome/common/search/search-panel.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-panel.dtd">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-panel.dtd">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-panel.dtd">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-panel.dtd">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-panel.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-panel.properties">suite/locales/en-US/chrome/common/search/search-panel.properties</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-panel.properties">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-panel.properties">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-panel.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-rdf.dtd">suite/locales/en-US/chrome/common/search/search-rdf.dtd</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-rdf.dtd">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-rdf.dtd">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/search/search-rdf.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/sidebar/sidebar.properties">suite/locales/en-US/chrome/common/sidebar/sidebar.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/sidebar/sidebar.properties">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/sidebar/sidebar.properties">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/sidebar/sidebar.properties">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/sidebar/sidebar.properties">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/chrome/common/sidebar/sidebar.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/creativecommons.xml">suite/locales/en-US/searchplugins/creativecommons.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/creativecommons.xml">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/creativecommons.xml">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/creativecommons.xml">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/creativecommons.xml">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/creativecommons.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/dmoz.png">suite/locales/en-US/searchplugins/dmoz.png</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/dmoz.png">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/dmoz.png">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/dmoz.png">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/dmoz.src">suite/locales/en-US/searchplugins/dmoz.src</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/dmoz.src">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/dmoz.src">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/dmoz.src">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.png">suite/locales/en-US/searchplugins/google.png</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.png">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.png">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.png">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.src">suite/locales/en-US/searchplugins/google.src</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.src">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.src">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.src">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.xml">suite/locales/en-US/searchplugins/google.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.xml">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.xml">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.xml">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.xml">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/google.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/jeeves.png">suite/locales/en-US/searchplugins/jeeves.png</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/jeeves.png">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/jeeves.png">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/jeeves.png">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/jeeves.src">suite/locales/en-US/searchplugins/jeeves.src</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/jeeves.src">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/jeeves.src">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/jeeves.src">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/list.txt">suite/locales/en-US/searchplugins/list.txt</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/list.txt">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/list.txt">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/list.txt">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/list.txt">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/list.txt">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/wikipedia.xml">suite/locales/en-US/searchplugins/wikipedia.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/wikipedia.xml">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/wikipedia.xml">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/wikipedia.xml">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/wikipedia.xml">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/wikipedia.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/yahoo.xml">suite/locales/en-US/searchplugins/yahoo.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/yahoo.xml">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/yahoo.xml">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/yahoo.xml">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/yahoo.xml">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/en-US/searchplugins/yahoo.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/generic/profile/search.rdf.in">suite/locales/generic/profile/search.rdf.in</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/generic/profile/search.rdf.in">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/generic/profile/search.rdf.in">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/generic/profile/search.rdf.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/jar.mn">suite/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.js">suite/mailnews/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.xul">suite/mailnews/mailWindowOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.xul">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.xul">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.xul">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.xul">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/mailnews/mailWindowOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/category.gif">suite/themes/classic/communicator/search/category.gif</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/category.gif">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/category.gif">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/category.gif">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/internetresults.css">suite/themes/classic/communicator/search/internetresults.css</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/internetresults.css">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/internetresults.css">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/internetresults.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/result.gif">suite/themes/classic/communicator/search/result.gif</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/result.gif">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/result.gif">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/result.gif">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/search-editor.css">suite/themes/classic/communicator/search/search-editor.css</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/search-editor.css">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/search-editor.css">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/search-editor.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/search.css">suite/themes/classic/communicator/search/search.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/search.css">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/search.css">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/search.css">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/search.css">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/communicator/search/search.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/jar.mn">suite/themes/classic/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/jar.mn">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/jar.mn">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/jar.mn">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/jar.mn">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/classic/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/category.gif">suite/themes/modern/communicator/search/category.gif</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/category.gif">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/category.gif">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/category.gif">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/internetresults.css">suite/themes/modern/communicator/search/internetresults.css</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/internetresults.css">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/internetresults.css">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/internetresults.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/result.gif">suite/themes/modern/communicator/search/result.gif</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/result.gif">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/result.gif">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/result.gif">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/search-editor.css">suite/themes/modern/communicator/search/search-editor.css</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/search-editor.css">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/search-editor.css">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/search-editor.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/search.css">suite/themes/modern/communicator/search/search.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/search.css">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/search.css">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/search.css">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/search.css">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/communicator/search/search.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/jar.mn">suite/themes/modern/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/jar.mn">file</a> |
<a href="/comm-central/annotate/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/jar.mn">annotate</a> |
<a href="/comm-central/diff/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/jar.mn">diff</a> |
<a href="/comm-central/comparison/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/jar.mn">comparison</a> |
<a href="/comm-central/log/098388acf16b06ff5fa8d31a95f49365e8b9466f/suite/themes/modern/jar.mn">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/browser/Makefile.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/browser/Makefile.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -37,17 +37,19 @@</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> DEPTH		= ../..</span>
<a href="#l1.6"></a><span id="l1.6"> topsrcdir	= @top_srcdir@</span>
<a href="#l1.7"></a><span id="l1.7"> srcdir		= @srcdir@</span>
<a href="#l1.8"></a><span id="l1.8"> VPATH		= @srcdir@</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l1.13"></a><span id="l1.13"> PARALLEL_DIRS = public src</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+endif</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> ifdef ENABLE_TESTS</span>
<a href="#l1.17"></a><span id="l1.17"> PARALLEL_DIRS += test</span>
<a href="#l1.18"></a><span id="l1.18"> endif</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> EXTRA_COMPONENTS = \</span>
<a href="#l1.21"></a><span id="l1.21"> 	SuiteBrowser.manifest \</span>
<a href="#l1.22"></a><span id="l1.22"> 	nsAboutRights.js \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/browser/browser-prefs.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/browser/browser-prefs.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -101,25 +101,50 @@ pref(&quot;browser.download.progress.closeWhe</span>
<a href="#l2.4"></a><span id="l2.4"> // the Content-Disposition filename) before giving up and falling back to</span>
<a href="#l2.5"></a><span id="l2.5"> // picking a filename without that info in hand so that the user sees some</span>
<a href="#l2.6"></a><span id="l2.6"> // feedback from their action.</span>
<a href="#l2.7"></a><span id="l2.7"> pref(&quot;browser.download.saveLinkAsFilenameTimeout&quot;, 1000);</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> // Use the findbar instead of the dialog box</span>
<a href="#l2.10"></a><span id="l2.10"> pref(&quot;browser.findbar.enabled&quot;, true);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-// various default search settings</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-pref(&quot;browser.search.defaulturl&quot;, &quot;chrome://navigator-region/locale/region.properties&quot;);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-pref(&quot;browser.search.opensidebarsearchpanel&quot;, true);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-pref(&quot;browser.search.opentabforcontextsearch&quot;, false);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-pref(&quot;browser.search.last_search_category&quot;, &quot;NC:SearchCategory?category=urn:search:category:1&quot;);</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-pref(&quot;browser.search.mode&quot;, 0);</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-// basic search popup constraint: minimum sherlock plugin version displayed</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-// (note: must be a string representation of a float or it'll default to 0.0)</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-pref(&quot;browser.search.basic.min_ver&quot;, &quot;0.0&quot;);</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+// search engines URL</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+pref(&quot;browser.search.searchEnginesURL&quot;, &quot;https://addons.mozilla.org/%LOCALE%/%APP%/search-engines/&quot;);</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+// pointer to the default engine name</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+pref(&quot;browser.search.defaultenginename&quot;, &quot;chrome://communicator-region/locale/region.properties&quot;);</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+// Disable logging for the search service by default.</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+pref(&quot;browser.search.log&quot;, false);</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+// Ordering of Search Engines in the Engine list.</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+pref(&quot;browser.search.order.1&quot;, &quot;chrome://communicator-region/locale/region.properties&quot;);</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+pref(&quot;browser.search.order.2&quot;, &quot;chrome://communicator-region/locale/region.properties&quot;);</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+// Search (side)bar results always open in a new tab.</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+pref(&quot;browser.search.openintab&quot;, false);</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+// Invoking a search reveals the sidebar panel.</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+pref(&quot;browser.search.opensidebarsearchpanel&quot;, false);</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+// Send ping to the server to update.</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+pref(&quot;browser.search.update&quot;, true);</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+// Disable logging for the search service update system by default.</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+pref(&quot;browser.search.update.log&quot;, false);</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+// Check whether we need to perform engine updates every 6 hours</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+pref(&quot;browser.search.update.interval&quot;, 21600);</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+// Smart Browsing prefs</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+pref(&quot;keyword.enabled&quot;, true);</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+// Override the default keyword.URL. Empty value means</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+// &quot;use the search service's default engine&quot;</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+pref(&quot;keyword.URL&quot;, &quot;&quot;);</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+</span>
<a href="#l2.55"></a><span id="l2.55"> pref(&quot;browser.urlbar.autocomplete.enabled&quot;, true);</span>
<a href="#l2.56"></a><span id="l2.56"> pref(&quot;browser.urlbar.clickSelectsAll&quot;, true);</span>
<a href="#l2.57"></a><span id="l2.57"> // when clickSelectsAll=true, does it also apply when the click is past end of text?</span>
<a href="#l2.58"></a><span id="l2.58"> pref(&quot;browser.urlbar.clickAtEndSelects&quot;, true);</span>
<a href="#l2.59"></a><span id="l2.59"> </span>
<a href="#l2.60"></a><span id="l2.60"> pref(&quot;browser.urlbar.autoFill&quot;, false);</span>
<a href="#l2.61"></a><span id="l2.61"> pref(&quot;browser.urlbar.showPopup&quot;, true);</span>
<a href="#l2.62"></a><span id="l2.62"> pref(&quot;browser.urlbar.showSearch&quot;, true);</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineat">@@ -150,19 +175,16 @@ pref(&quot;browser.urlbar.search.timeout&quot;, 10</span>
<a href="#l2.64"></a><span id="l2.64"> pref(&quot;browser.urlbar.restrict.history&quot;, &quot;^&quot;);</span>
<a href="#l2.65"></a><span id="l2.65"> pref(&quot;browser.urlbar.restrict.bookmark&quot;, &quot;*&quot;);</span>
<a href="#l2.66"></a><span id="l2.66"> pref(&quot;browser.urlbar.restrict.tag&quot;, &quot;+&quot;);</span>
<a href="#l2.67"></a><span id="l2.67"> pref(&quot;browser.urlbar.restrict.openpage&quot;, &quot;%&quot;);</span>
<a href="#l2.68"></a><span id="l2.68"> pref(&quot;browser.urlbar.restrict.typed&quot;, &quot;~&quot;);</span>
<a href="#l2.69"></a><span id="l2.69"> pref(&quot;browser.urlbar.match.title&quot;, &quot;#&quot;);</span>
<a href="#l2.70"></a><span id="l2.70"> pref(&quot;browser.urlbar.match.url&quot;, &quot;@&quot;);</span>
<a href="#l2.71"></a><span id="l2.71"> </span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-pref(&quot;browser.search.param.Google.1.custom&quot;, &quot;chrome://navigator/content/searchconfig.properties&quot;);</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-pref(&quot;browser.search.param.Google.1.default&quot;, &quot;chrome://navigator/content/searchconfig.properties&quot;);</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-</span>
<a href="#l2.75"></a><span id="l2.75"> // Whether or not microsummary and generator updates are enabled.</span>
<a href="#l2.76"></a><span id="l2.76"> pref(&quot;browser.microsummary.enabled&quot;, true);</span>
<a href="#l2.77"></a><span id="l2.77"> pref(&quot;browser.microsummary.updateGenerators&quot;, true);</span>
<a href="#l2.78"></a><span id="l2.78"> </span>
<a href="#l2.79"></a><span id="l2.79"> pref(&quot;browser.history.grouping&quot;, &quot;day&quot;);</span>
<a href="#l2.80"></a><span id="l2.80"> pref(&quot;browser.sessionhistory.max_entries&quot;, 50);</span>
<a href="#l2.81"></a><span id="l2.81"> </span>
<a href="#l2.82"></a><span id="l2.82"> // Whether history is enabled or not.</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineat">@@ -274,24 +296,16 @@ pref(&quot;browser.link.open_newwindow&quot;, 3);</span>
<a href="#l2.84"></a><span id="l2.84"> // 0: no restrictions - divert everything</span>
<a href="#l2.85"></a><span id="l2.85"> // 1: don't divert window.open at all</span>
<a href="#l2.86"></a><span id="l2.86"> // 2: don't divert window.open with features</span>
<a href="#l2.87"></a><span id="l2.87"> pref(&quot;browser.link.open_newwindow.restriction&quot;, 2);</span>
<a href="#l2.88"></a><span id="l2.88"> </span>
<a href="#l2.89"></a><span id="l2.89"> // Translation service</span>
<a href="#l2.90"></a><span id="l2.90"> pref(&quot;browser.translation.service&quot;, &quot;chrome://navigator-region/locale/region.properties&quot;);</span>
<a href="#l2.91"></a><span id="l2.91"> pref(&quot;browser.translation.serviceDomain&quot;, &quot;chrome://navigator-region/locale/region.properties&quot;);</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-  </span>
<a href="#l2.93"></a><span id="l2.93" class="difflineminus">-// Smart Browsing prefs</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineminus">-pref(&quot;browser.related.provider&quot;, &quot;http://www-rl.netscape.com/wtgn?&quot;);</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineminus">-pref(&quot;browser.related.disabledForDomains&quot;, &quot;&quot;);</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineminus">-pref(&quot;keyword.enabled&quot;, true);</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineminus">-</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineminus">-//Internet Search</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineminus">-pref(&quot;browser.search.defaultenginename&quot;, &quot;chrome://communicator-region/locale/region.properties&quot;);</span>
<a href="#l2.100"></a><span id="l2.100"> </span>
<a href="#l2.101"></a><span id="l2.101"> // 0 goes back</span>
<a href="#l2.102"></a><span id="l2.102"> // 1 act like pgup</span>
<a href="#l2.103"></a><span id="l2.103"> // 2 and other values, nothing</span>
<a href="#l2.104"></a><span id="l2.104"> pref(&quot;browser.backspace_action&quot;, 0);</span>
<a href="#l2.105"></a><span id="l2.105"> </span>
<a href="#l2.106"></a><span id="l2.106"> // Controls behavior of the &quot;Add Exception&quot; dialog launched from SSL error pages:</span>
<a href="#l2.107"></a><span id="l2.107"> // 0 - don't pre-populate anything.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/browser/jar.mn</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/browser/jar.mn</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -14,17 +14,16 @@ comm.jar:</span>
<a href="#l3.4"></a><span id="l3.4">    content/navigator/metadata.xul</span>
<a href="#l3.5"></a><span id="l3.5">    content/navigator/navigator.css</span>
<a href="#l3.6"></a><span id="l3.6">    content/navigator/navigator.js</span>
<a href="#l3.7"></a><span id="l3.7">    content/navigator/navigator.xul</span>
<a href="#l3.8"></a><span id="l3.8">    content/navigator/navigatorDD.js</span>
<a href="#l3.9"></a><span id="l3.9">    content/navigator/navigatorOverlay.xul</span>
<a href="#l3.10"></a><span id="l3.10">    content/navigator/nsBrowserContentListener.js</span>
<a href="#l3.11"></a><span id="l3.11">    content/navigator/nsBrowserStatusHandler.js</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-   content/navigator/searchconfig.properties</span>
<a href="#l3.13"></a><span id="l3.13">    content/navigator/sessionHistoryUI.js</span>
<a href="#l3.14"></a><span id="l3.14">    content/navigator/tabbrowser.xml</span>
<a href="#l3.15"></a><span id="l3.15">    content/navigator/urlbarBindings.xml</span>
<a href="#l3.16"></a><span id="l3.16"> #ifdef XP_MACOSX</span>
<a href="#l3.17"></a><span id="l3.17">    content/navigator/platformNavigationBindings.xul                 (mac/platformNavigationBindings.xul)</span>
<a href="#l3.18"></a><span id="l3.18">    content/navigator/platformMailOverlay.xul                        (mac/platformMailOverlay.xul)</span>
<a href="#l3.19"></a><span id="l3.19"> #else</span>
<a href="#l3.20"></a><span id="l3.20"> #ifdef XP_WIN32</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/browser/navigator.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/browser/navigator.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -51,17 +51,16 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l4.4"></a><span id="l4.4"> });</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> const REMOTESERVICE_CONTRACTID = &quot;@mozilla.org/toolkit/remote-service;1&quot;;</span>
<a href="#l4.7"></a><span id="l4.7"> const XUL_NAMESPACE = &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;;</span>
<a href="#l4.8"></a><span id="l4.8"> var gURLBar = null;</span>
<a href="#l4.9"></a><span id="l4.9"> var gProxyButton = null;</span>
<a href="#l4.10"></a><span id="l4.10"> var gProxyFavIcon = null;</span>
<a href="#l4.11"></a><span id="l4.11"> var gProxyDeck = null;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-var gSearchService = null;</span>
<a href="#l4.13"></a><span id="l4.13"> var gNavigatorBundle;</span>
<a href="#l4.14"></a><span id="l4.14"> var gBrandBundle;</span>
<a href="#l4.15"></a><span id="l4.15"> var gNavigatorRegionBundle;</span>
<a href="#l4.16"></a><span id="l4.16"> var gLastValidURLStr = &quot;&quot;;</span>
<a href="#l4.17"></a><span id="l4.17"> var gLastValidURL = null;</span>
<a href="#l4.18"></a><span id="l4.18"> var gClickSelectsAll = false;</span>
<a href="#l4.19"></a><span id="l4.19"> var gClickAtEndSelects = false;</span>
<a href="#l4.20"></a><span id="l4.20"> var gIgnoreFocus = false;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -199,17 +198,16 @@ function removePopupPermListener(observe</span>
<a href="#l4.22"></a><span id="l4.22"> * We can avoid adding multiple load event listeners and save some time by adding</span>
<a href="#l4.23"></a><span id="l4.23"> * one listener that calls all real handlers.</span>
<a href="#l4.24"></a><span id="l4.24"> */</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26"> function pageShowEventHandlers(event)</span>
<a href="#l4.27"></a><span id="l4.27"> {</span>
<a href="#l4.28"></a><span id="l4.28">   // Filter out events that are not about the document load we are interested in</span>
<a href="#l4.29"></a><span id="l4.29">   if (event.originalTarget == content.document) {</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-    UpdateInternetSearchResults(event);</span>
<a href="#l4.31"></a><span id="l4.31">     checkForDirectoryListing();</span>
<a href="#l4.32"></a><span id="l4.32">     postURLToNativeWidget();</span>
<a href="#l4.33"></a><span id="l4.33">   }</span>
<a href="#l4.34"></a><span id="l4.34"> }</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36"> /**</span>
<a href="#l4.37"></a><span id="l4.37">  * Determine whether or not the content area is displaying a page with frames,</span>
<a href="#l4.38"></a><span id="l4.38">  * and if so, toggle the display of the 'save frame as' menu item.</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineat">@@ -243,29 +241,16 @@ function updateHomeButtonTooltip()</span>
<a href="#l4.40"></a><span id="l4.40"> </span>
<a href="#l4.41"></a><span id="l4.41">   for (var i in homePage) {</span>
<a href="#l4.42"></a><span id="l4.42">     var label = document.createElementNS(XUL_NAMESPACE, &quot;label&quot;);</span>
<a href="#l4.43"></a><span id="l4.43">     label.setAttribute(&quot;value&quot;, homePage[i]);</span>
<a href="#l4.44"></a><span id="l4.44">     tooltip.appendChild(label);</span>
<a href="#l4.45"></a><span id="l4.45">   }</span>
<a href="#l4.46"></a><span id="l4.46"> }</span>
<a href="#l4.47"></a><span id="l4.47"> </span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-function UpdateInternetSearchResults(event)</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-{</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-  var url = getWebNavigation().currentURI.spec;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-  if (url &amp;&amp; isSearchPanelOpen())</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-  {</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-    if (!gSearchService)</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-      gSearchService = Components.classes[&quot;@mozilla.org/rdf/datasource;1?name=internetsearch&quot;]</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-                                 .getService(Components.interfaces.nsIInternetSearchService);</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-    gSearchService.FindInternetSearchResults(url);</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-  }</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-}</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-</span>
<a href="#l4.61"></a><span id="l4.61"> function getBrowser()</span>
<a href="#l4.62"></a><span id="l4.62"> {</span>
<a href="#l4.63"></a><span id="l4.63">   if (!gBrowser)</span>
<a href="#l4.64"></a><span id="l4.64">     gBrowser = document.getElementById(&quot;content&quot;);</span>
<a href="#l4.65"></a><span id="l4.65">   return gBrowser;</span>
<a href="#l4.66"></a><span id="l4.66"> }</span>
<a href="#l4.67"></a><span id="l4.67"> </span>
<a href="#l4.68"></a><span id="l4.68"> function getHomePage()</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineat">@@ -388,17 +373,17 @@ function HandleAppCommandEvent(aEvent)</span>
<a href="#l4.70"></a><span id="l4.70">       break;</span>
<a href="#l4.71"></a><span id="l4.71">     case &quot;Reload&quot;:</span>
<a href="#l4.72"></a><span id="l4.72">       BrowserReloadSkipCache();</span>
<a href="#l4.73"></a><span id="l4.73">       break;</span>
<a href="#l4.74"></a><span id="l4.74">     case &quot;Stop&quot;:</span>
<a href="#l4.75"></a><span id="l4.75">       BrowserStop();</span>
<a href="#l4.76"></a><span id="l4.76">       break;</span>
<a href="#l4.77"></a><span id="l4.77">     case &quot;Search&quot;:</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-      BrowserSearchInternet();</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+      BrowserSearch.webSearch();</span>
<a href="#l4.80"></a><span id="l4.80">       break;</span>
<a href="#l4.81"></a><span id="l4.81">     case &quot;Bookmarks&quot;:</span>
<a href="#l4.82"></a><span id="l4.82">       toBookmarksManager();</span>
<a href="#l4.83"></a><span id="l4.83">       break;</span>
<a href="#l4.84"></a><span id="l4.84">     case &quot;Home&quot;:</span>
<a href="#l4.85"></a><span id="l4.85">       BrowserHome(null);</span>
<a href="#l4.86"></a><span id="l4.86">       break;</span>
<a href="#l4.87"></a><span id="l4.87">     default:</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineat">@@ -955,250 +940,202 @@ var gBookmarkAllTabsHandler = {</span>
<a href="#l4.89"></a><span id="l4.89">   },</span>
<a href="#l4.90"></a><span id="l4.90"> </span>
<a href="#l4.91"></a><span id="l4.91">   // nsIDOMEventListener</span>
<a href="#l4.92"></a><span id="l4.92">   handleEvent: function(aEvent) {</span>
<a href="#l4.93"></a><span id="l4.93">     this._updateCommandState(aEvent.type == &quot;TabClose&quot;);</span>
<a href="#l4.94"></a><span id="l4.94">   }</span>
<a href="#l4.95"></a><span id="l4.95"> };</span>
<a href="#l4.96"></a><span id="l4.96"> </span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">-function readRDFString(aDS,aRes,aProp)</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-{</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineminus">-  var n = aDS.GetTarget(aRes, aProp, true);</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-  return n ? n.QueryInterface(Components.interfaces.nsIRDFLiteral).Value : &quot;&quot;;</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-}</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+const BrowserSearch = {</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineplus">+  addEngine: function(engine, targetDoc) {</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineplus">+    Services.console.logStringMessage(&quot;BrowserSearch.addEngine will be implemented in bug 401417.&quot;);</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineplus">+  },</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineplus">+</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+  /**</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+   * Update the browser UI to show whether or not additional engines are</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+   * available when a page is loaded or the user switches tabs to a page that</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+   * has search engines.</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineplus">+   */</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineplus">+  updateSearchButton: function() {</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+    Services.console.logStringMessage(&quot;BrowserSearch.updateSearchButton will be implemented in bug 401417.&quot;);</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineplus">+  },</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineplus">+</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineplus">+  /**</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineplus">+   * Gives focus to the search bar, if it is present on the toolbar, or to the</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineplus">+   * search sidebar, if it is open, or loads the default engine's search form</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineplus">+   * otherwise. For Mac, opens a new window or focuses an existing window, if</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+   * necessary.</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineplus">+   */</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineplus">+  webSearch: function BrowserSearch_webSearch() {</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineplus">+    if (/Mac/.test(navigator.platform)) {</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineplus">+      if (window.location.href != getBrowserURL()) {</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineplus">+        var win = getTopWin();</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineplus">+        if (win) {</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+          // If there's an open browser window, it should handle this command</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineplus">+          win.focus();</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineplus">+          win.BrowserSearch.webSearch();</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+        } else {</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineplus">+          // If there are no open browser windows, open a new one</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineplus">+</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineplus">+          // This needs to be in a timeout so that we don't end up refocused</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineplus">+          // in the url bar</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineplus">+          function webSearchCallback() {</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+            setTimeout(BrowserSearch.webSearch, 0);</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineplus">+          }</span>
<a href="#l4.138"></a><span id="l4.138"> </span>
<a href="#l4.139"></a><span id="l4.139" class="difflineminus">-function ensureDefaultEnginePrefs(aRDF,aDS) </span>
<a href="#l4.140"></a><span id="l4.140" class="difflineminus">-{</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineminus">-  var defaultName = Services.prefs.getComplexValue(&quot;browser.search.defaultenginename&quot;,</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineminus">-                                                   nsIPrefLocalizedString).data;</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineminus">-  var kNC_Root = aRDF.GetResource(&quot;NC:SearchEngineRoot&quot;);</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineminus">-  var kNC_child = aRDF.GetResource(&quot;http://home.netscape.com/NC-rdf#child&quot;);</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-  var kNC_Name = aRDF.GetResource(&quot;http://home.netscape.com/NC-rdf#Name&quot;);</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineplus">+          win = window.openDialog(getBrowserURL(), &quot;_blank&quot;,</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineplus">+                                  &quot;chrome,all,dialog=no&quot;, &quot;about:blank&quot;);</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineplus">+          win.addEventListener(&quot;load&quot;, webSearchCallback, false);</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineplus">+        }</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineplus">+        return;</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineplus">+      }</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineplus">+    }</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineplus">+</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineplus">+    if (isElementVisible(this.searchBar)) {</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineplus">+      searchBar.select();</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineplus">+      searchBar.focus();</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineplus">+    } else if (isElementVisible(this.searchSidebar)) {</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineplus">+      searchSidebar.focus();</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineplus">+    } else {</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineplus">+      loadURI(Services.search.defaultEngine.searchForm);</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineplus">+    }</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineplus">+  },</span>
<a href="#l4.163"></a><span id="l4.163"> </span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-  var arcs = aDS.GetTargets(kNC_Root, kNC_child, true);</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-  while (arcs.hasMoreElements()) {</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineminus">-    var engineRes = arcs.getNext().QueryInterface(Components.interfaces.nsIRDFResource);</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineminus">-    var name = readRDFString(aDS, engineRes, kNC_Name);</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineminus">-    if (name == defaultName)</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineminus">-      mPrefs.setCharPref(&quot;browser.search.defaultengine&quot;, engineRes.Value);</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineminus">-  }</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineminus">-}</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineplus">+  /**</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineplus">+   * Loads a search results page, given a set of search terms. Uses the current</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineplus">+   * engine if the search bar is visible, or the default engine otherwise.</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineplus">+   *</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineplus">+   * @param searchText</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineplus">+   *        The search terms to use for the search.</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineplus">+   *</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineplus">+   * @param useNewTab</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineplus">+   *        Boolean indicating whether or not the search should load in a new</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineplus">+   *        tab.</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineplus">+   */</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineplus">+  loadSearch: function BrowserSearch_search(searchText, useNewTab) {</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineplus">+    var engine;</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineplus">+</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineplus">+    // If the search bar is visible, use the current engine, otherwise, fall</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineplus">+    // back to the default engine.</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineplus">+    if ((this.searchBar &amp;&amp; isElementVisible(this.searchBar)) ||</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineplus">+        (this.searchSidebar &amp;&amp; isElementVisible(this.searchSidebar)))</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineplus">+      engine = Services.search.currentEngine;</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineplus">+    else</span>
<a href="#l4.192"></a><span id="l4.192" class="difflineplus">+      engine = Services.search.defaultEngine;</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineplus">+</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineplus">+    var submission = engine.getSubmission(searchText); // HTML response</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineplus">+</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineplus">+    // getSubmission can return null if the engine doesn't have a URL</span>
<a href="#l4.197"></a><span id="l4.197" class="difflineplus">+    // with a text/html response type.  This is unlikely (since</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineplus">+    // SearchService._addEngineToStore() should fail for such an engine),</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineplus">+    // but let's be on the safe side.</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineplus">+    if (!submission)</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineplus">+      return;</span>
<a href="#l4.202"></a><span id="l4.202"> </span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-function ensureSearchPref()</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-{</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineminus">-  var rdf = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;]</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineminus">-                      .getService(Components.interfaces.nsIRDFService);</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineminus">-  var ds = rdf.GetDataSource(&quot;rdf:internetsearch&quot;);</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineminus">-  var kNC_Name = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#Name&quot;);</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineminus">-  var defaultEngine;</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineminus">-  try {</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineminus">-    defaultEngine = Services.prefs.getCharPref(&quot;browser.search.defaultengine&quot;);</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineminus">-  } catch(ex) {</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineminus">-    ensureDefaultEnginePrefs(rdf, ds);</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineminus">-    defaultEngine = Services.prefs.getCharPref(&quot;browser.search.defaultengine&quot;);</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineplus">+    if (useNewTab) {</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineplus">+      gBrowser.loadOneTab(submission.uri.spec,</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineplus">+                          { postData: submission.postData,</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineplus">+                            relatedToCurrent: true,</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineplus">+                            inBackground: false });</span>
<a href="#l4.220"></a><span id="l4.220" class="difflineplus">+    } else</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineplus">+      loadURI(submission.uri.spec, null, submission.postData, false);</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineplus">+</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineplus">+    // should we try and open up the sidebar to show the &quot;Search Results&quot; panel?</span>
<a href="#l4.224"></a><span id="l4.224" class="difflineplus">+    var autoOpenSidebar = false;</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineplus">+    try {</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineplus">+      autoOpenSidebar = Services.prefs.getBoolPref(&quot;browser.search.opensidebarsearchpanel&quot;);</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineplus">+    } catch (e) {}</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineplus">+    if (autoOpenSidebar)</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineplus">+      this.revealSidebar();</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineplus">+  },</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineplus">+</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineplus">+  /**</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineplus">+   * Returns the search bar element if it is present in the toolbar, null otherwise.</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineplus">+   */</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineplus">+  get searchBar() {</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineplus">+    return document.getElementById(&quot;searchbar&quot;);</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineplus">+  },</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineplus">+</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineplus">+  /**</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineplus">+   * Returns the search sidebar element if it is present in the toolbar, null otherwise.</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineplus">+   */</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineplus">+  get searchSidebar() {</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineplus">+    return document.getElementById(&quot;urn:sidebar:panel:search&quot;);</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineplus">+  },</span>
<a href="#l4.245"></a><span id="l4.245" class="difflineplus">+</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineplus">+  /**</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineplus">+   * Reveal the search sidebar panel.</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineplus">+   */</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineplus">+  revealSidebar: function BrowserSearch_revealSidebar() {</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineplus">+    // first lets check if the search panel will be shown at all</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineplus">+    // by checking the sidebar datasource to see if there is an entry</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineplus">+    // for the search panel, and if it is excluded for navigator or not</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineplus">+</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineplus">+    var searchPanelExists = false;</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineplus">+</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineplus">+    var myPanel = document.getElementById(&quot;urn:sidebar:panel:search&quot;);</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineplus">+    if (myPanel) {</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineplus">+      var panel = sidebarObj.panels.get_panel_from_header_node(myPanel);</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineplus">+      searchPanelExists = !panel.is_excluded();</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineplus">+</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineplus">+    } else if (sidebarObj.never_built) {</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineplus">+      // XXXsearch: in theory, this should work when the sidebar isn't loaded,</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineplus">+      //            in practice, it fails as sidebarObj.datasource_uri isn't defined</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineplus">+      try {</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineplus">+        var datasource = RDF.GetDataSourceBlocking(sidebarObj.datasource_uri);</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineplus">+        var aboutValue = RDF.GetResource(&quot;urn:sidebar:panel:search&quot;);</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineplus">+</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineplus">+        // check if the panel is even in the list by checking for its content</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineplus">+        var contentProp = RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#content&quot;);</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineplus">+        var content = datasource.GetTarget(aboutValue, contentProp, true);</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineplus">+</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineplus">+        if (content instanceof Components.interfaces.nsIRDFLiteral) {</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineplus">+          // the search panel entry exists, now check if it is excluded</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineplus">+          // for navigator</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineplus">+          var excludeProp = RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#exclude&quot;);</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineplus">+          var exclude = datasource.GetTarget(aboutValue, excludeProp, true);</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineplus">+</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineplus">+          if (exclude instanceof Components.interfaces.nsIRDFLiteral) {</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineplus">+            searchPanelExists = (exclude.Value.indexOf(&quot;navigator:browser&quot;) &lt; 0);</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineplus">+          } else {</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineplus">+            // panel exists and no exclude set</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineplus">+            searchPanelExists = true;</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineplus">+          }</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineplus">+        }</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineplus">+      } catch (e) {</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineplus">+        searchPanelExists = false;</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineplus">+      }</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineplus">+    }</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineplus">+</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineplus">+    if (searchPanelExists) {</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineplus">+      // make sure the sidebar is open, else SidebarSelectPanel() will fail</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineplus">+      if (sidebar_is_hidden())</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineplus">+        SidebarShowHide();</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineplus">+</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineplus">+      if (sidebar_is_collapsed())</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineplus">+        SidebarExpandCollapse();</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineplus">+</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineplus">+      var searchPanel = document.getElementById(&quot;urn:sidebar:panel:search&quot;);</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineplus">+      if (searchPanel)</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineplus">+        SidebarSelectPanel(searchPanel, true, true); // lives in sidebarOverlay.js</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineplus">+    }</span>
<a href="#l4.302"></a><span id="l4.302">   }</span>
<a href="#l4.303"></a><span id="l4.303"> }</span>
<a href="#l4.304"></a><span id="l4.304"> </span>
<a href="#l4.305"></a><span id="l4.305" class="difflineminus">-function getSearchUrl(attr)</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineminus">-{</span>
<a href="#l4.307"></a><span id="l4.307" class="difflineminus">-  var rdf = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;]</span>
<a href="#l4.308"></a><span id="l4.308" class="difflineminus">-                      .getService(Components.interfaces.nsIRDFService);</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineminus">-  var ds = rdf.GetDataSource(&quot;rdf:internetsearch&quot;);</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineminus">-  var kNC_Root = rdf.GetResource(&quot;NC:SearchEngineRoot&quot;);</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineminus">-  var defaultEngine = Services.prefs.getCharPref(&quot;browser.search.defaultengine&quot;);</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineminus">-  var engineRes = rdf.GetResource(defaultEngine);</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineminus">-  var prop = &quot;http://home.netscape.com/NC-rdf#&quot; + attr;</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineminus">-  var kNC_attr = rdf.GetResource(prop);</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineminus">-  var searchURL = readRDFString(ds, engineRes, kNC_attr);</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineminus">-  return searchURL;</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineminus">-}</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineminus">-</span>
<a href="#l4.319"></a><span id="l4.319"> function QualifySearchTerm()</span>
<a href="#l4.320"></a><span id="l4.320"> {</span>
<a href="#l4.321"></a><span id="l4.321">   // If the text in the URL bar is the same as the currently loaded</span>
<a href="#l4.322"></a><span id="l4.322">   // page's URL then treat this as an empty search term.  This way</span>
<a href="#l4.323"></a><span id="l4.323">   // the user is taken to the search page where s/he can enter a term.</span>
<a href="#l4.324"></a><span id="l4.324">   if (gBrowser.userTypedValue !== null)</span>
<a href="#l4.325"></a><span id="l4.325">     return gURLBar.value;</span>
<a href="#l4.326"></a><span id="l4.326">   return &quot;&quot;;</span>
<a href="#l4.327"></a><span id="l4.327"> }</span>
<a href="#l4.328"></a><span id="l4.328"> </span>
<a href="#l4.329"></a><span id="l4.329" class="difflineminus">-function OpenSearch(tabName, searchStr, newWindowOrTabFlag, reverseBackgroundPref)</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineminus">-{</span>
<a href="#l4.331"></a><span id="l4.331" class="difflineminus">-  //This function needs to be split up someday.</span>
<a href="#l4.332"></a><span id="l4.332" class="difflineminus">-</span>
<a href="#l4.333"></a><span id="l4.333" class="difflineminus">-  var autoOpenSearchPanel = false;</span>
<a href="#l4.334"></a><span id="l4.334" class="difflineminus">-  var defaultSearchURL = null;</span>
<a href="#l4.335"></a><span id="l4.335" class="difflineminus">-  var fallbackDefaultSearchURL = gNavigatorRegionBundle.getString(&quot;fallbackDefaultSearchURL&quot;);</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineminus">-  ensureSearchPref()</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineminus">-  //Check to see if search string contains &quot;://&quot; or &quot;ftp.&quot; or white space.</span>
<a href="#l4.338"></a><span id="l4.338" class="difflineminus">-  //If it does treat as url and match for pattern</span>
<a href="#l4.339"></a><span id="l4.339" class="difflineminus">-</span>
<a href="#l4.340"></a><span id="l4.340" class="difflineminus">-  var urlmatch= /(:\/\/|^ftp\.)[^ \S]+$/ </span>
<a href="#l4.341"></a><span id="l4.341" class="difflineminus">-  var forceAsURL = urlmatch.test(searchStr);</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineminus">-</span>
<a href="#l4.343"></a><span id="l4.343" class="difflineminus">-  try {</span>
<a href="#l4.344"></a><span id="l4.344" class="difflineminus">-    autoOpenSearchPanel = Services.prefs.getBoolPref(&quot;browser.search.opensidebarsearchpanel&quot;);</span>
<a href="#l4.345"></a><span id="l4.345" class="difflineminus">-    defaultSearchURL = Services.prefs.getComplexValue(&quot;browser.search.defaulturl&quot;,</span>
<a href="#l4.346"></a><span id="l4.346" class="difflineminus">-                                                      nsIPrefLocalizedString).data;</span>
<a href="#l4.347"></a><span id="l4.347" class="difflineminus">-  } catch (ex) {</span>
<a href="#l4.348"></a><span id="l4.348" class="difflineminus">-  }</span>
<a href="#l4.349"></a><span id="l4.349" class="difflineminus">-</span>
<a href="#l4.350"></a><span id="l4.350" class="difflineminus">-  // Fallback to a default url (one that we can get sidebar search results for)</span>
<a href="#l4.351"></a><span id="l4.351" class="difflineminus">-  if (!defaultSearchURL)</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineminus">-    defaultSearchURL = fallbackDefaultSearchURL;</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineminus">-</span>
<a href="#l4.354"></a><span id="l4.354" class="difflineminus">-  if (!searchStr) {</span>
<a href="#l4.355"></a><span id="l4.355" class="difflineminus">-    BrowserSearchInternet();</span>
<a href="#l4.356"></a><span id="l4.356" class="difflineminus">-  } else {</span>
<a href="#l4.357"></a><span id="l4.357" class="difflineminus">-</span>
<a href="#l4.358"></a><span id="l4.358" class="difflineminus">-    //Check to see if location bar field is a url</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineminus">-    //If it is a url go to URL.  A Url is &quot;://&quot; or &quot;.&quot; as commented above</span>
<a href="#l4.360"></a><span id="l4.360" class="difflineminus">-    //Otherwise search on entry</span>
<a href="#l4.361"></a><span id="l4.361" class="difflineminus">-    if (forceAsURL) {</span>
<a href="#l4.362"></a><span id="l4.362" class="difflineminus">-       BrowserLoadURL()</span>
<a href="#l4.363"></a><span id="l4.363" class="difflineminus">-    } else {</span>
<a href="#l4.364"></a><span id="l4.364" class="difflineminus">-      if (searchStr) {</span>
<a href="#l4.365"></a><span id="l4.365" class="difflineminus">-        var escapedSearchStr = encodeURIComponent(searchStr);</span>
<a href="#l4.366"></a><span id="l4.366" class="difflineminus">-        defaultSearchURL += escapedSearchStr;</span>
<a href="#l4.367"></a><span id="l4.367" class="difflineminus">-        var searchDS = Components.classes[&quot;@mozilla.org/rdf/datasource;1?name=internetsearch&quot;]</span>
<a href="#l4.368"></a><span id="l4.368" class="difflineminus">-                                 .getService(Components.interfaces.nsIInternetSearchService);</span>
<a href="#l4.369"></a><span id="l4.369" class="difflineminus">-</span>
<a href="#l4.370"></a><span id="l4.370" class="difflineminus">-        searchDS.RememberLastSearchText(escapedSearchStr);</span>
<a href="#l4.371"></a><span id="l4.371" class="difflineminus">-        try {</span>
<a href="#l4.372"></a><span id="l4.372" class="difflineminus">-          var searchEngineURI = Services.prefs.getCharPref(&quot;browser.search.defaultengine&quot;);</span>
<a href="#l4.373"></a><span id="l4.373" class="difflineminus">-          if (searchEngineURI) {</span>
<a href="#l4.374"></a><span id="l4.374" class="difflineminus">-            var searchURL = getSearchUrl(&quot;actionButton&quot;);</span>
<a href="#l4.375"></a><span id="l4.375" class="difflineminus">-            if (searchURL) {</span>
<a href="#l4.376"></a><span id="l4.376" class="difflineminus">-              defaultSearchURL = searchURL + escapedSearchStr; </span>
<a href="#l4.377"></a><span id="l4.377" class="difflineminus">-            } else {</span>
<a href="#l4.378"></a><span id="l4.378" class="difflineminus">-              searchURL = searchDS.GetInternetSearchURL(searchEngineURI, escapedSearchStr, 0, 0, {value:0});</span>
<a href="#l4.379"></a><span id="l4.379" class="difflineminus">-              if (searchURL)</span>
<a href="#l4.380"></a><span id="l4.380" class="difflineminus">-                defaultSearchURL = searchURL;</span>
<a href="#l4.381"></a><span id="l4.381" class="difflineminus">-            }</span>
<a href="#l4.382"></a><span id="l4.382" class="difflineminus">-          }</span>
<a href="#l4.383"></a><span id="l4.383" class="difflineminus">-        } catch (ex) {</span>
<a href="#l4.384"></a><span id="l4.384" class="difflineminus">-        }</span>
<a href="#l4.385"></a><span id="l4.385" class="difflineminus">-</span>
<a href="#l4.386"></a><span id="l4.386" class="difflineminus">-        if (!newWindowOrTabFlag)</span>
<a href="#l4.387"></a><span id="l4.387" class="difflineminus">-          loadURI(defaultSearchURL);</span>
<a href="#l4.388"></a><span id="l4.388" class="difflineminus">-        else if (!Services.prefs.getBoolPref(&quot;browser.search.opentabforcontextsearch&quot;))</span>
<a href="#l4.389"></a><span id="l4.389" class="difflineminus">-          window.open(defaultSearchURL, &quot;_blank&quot;);</span>
<a href="#l4.390"></a><span id="l4.390" class="difflineminus">-        else {</span>
<a href="#l4.391"></a><span id="l4.391" class="difflineminus">-          var newTab = gBrowser.addTab(defaultSearchURL);</span>
<a href="#l4.392"></a><span id="l4.392" class="difflineminus">-          var loadInBackground = Services.prefs.getBoolPref(&quot;browser.tabs.loadInBackground&quot;);</span>
<a href="#l4.393"></a><span id="l4.393" class="difflineminus">-          if (reverseBackgroundPref)</span>
<a href="#l4.394"></a><span id="l4.394" class="difflineminus">-            loadInBackground = !loadInBackground;</span>
<a href="#l4.395"></a><span id="l4.395" class="difflineminus">-          if (!loadInBackground)</span>
<a href="#l4.396"></a><span id="l4.396" class="difflineminus">-            gBrowser.selectedTab = newTab;</span>
<a href="#l4.397"></a><span id="l4.397" class="difflineminus">-        }</span>
<a href="#l4.398"></a><span id="l4.398" class="difflineminus">-      }</span>
<a href="#l4.399"></a><span id="l4.399" class="difflineminus">-    }</span>
<a href="#l4.400"></a><span id="l4.400" class="difflineminus">-  }</span>
<a href="#l4.401"></a><span id="l4.401" class="difflineminus">-</span>
<a href="#l4.402"></a><span id="l4.402" class="difflineminus">-  // should we try and open up the sidebar to show the &quot;Search Results&quot; panel?</span>
<a href="#l4.403"></a><span id="l4.403" class="difflineminus">-  if (autoOpenSearchPanel)</span>
<a href="#l4.404"></a><span id="l4.404" class="difflineminus">-    RevealSearchPanel();</span>
<a href="#l4.405"></a><span id="l4.405" class="difflineminus">-}</span>
<a href="#l4.406"></a><span id="l4.406" class="difflineminus">-</span>
<a href="#l4.407"></a><span id="l4.407" class="difflineminus">-function RevealSearchPanel()</span>
<a href="#l4.408"></a><span id="l4.408" class="difflineminus">-{</span>
<a href="#l4.409"></a><span id="l4.409" class="difflineminus">-  // first lets check if the search panel will be shown at all</span>
<a href="#l4.410"></a><span id="l4.410" class="difflineminus">-  // by checking the sidebar datasource to see if there is an entry</span>
<a href="#l4.411"></a><span id="l4.411" class="difflineminus">-  // for the search panel, and if it is excluded for navigator or not</span>
<a href="#l4.412"></a><span id="l4.412" class="difflineminus">-  </span>
<a href="#l4.413"></a><span id="l4.413" class="difflineminus">-  var searchPanelExists = false;</span>
<a href="#l4.414"></a><span id="l4.414" class="difflineminus">-  </span>
<a href="#l4.415"></a><span id="l4.415" class="difflineminus">-  if (document.getElementById(&quot;urn:sidebar:panel:search&quot;)) {</span>
<a href="#l4.416"></a><span id="l4.416" class="difflineminus">-    var myPanel = document.getElementById(&quot;urn:sidebar:panel:search&quot;);</span>
<a href="#l4.417"></a><span id="l4.417" class="difflineminus">-    var panel = sidebarObj.panels.get_panel_from_header_node(myPanel);</span>
<a href="#l4.418"></a><span id="l4.418" class="difflineminus">-</span>
<a href="#l4.419"></a><span id="l4.419" class="difflineminus">-    searchPanelExists = !panel.is_excluded();</span>
<a href="#l4.420"></a><span id="l4.420" class="difflineminus">-  } else if (sidebarObj.never_built) {</span>
<a href="#l4.421"></a><span id="l4.421" class="difflineminus">-</span>
<a href="#l4.422"></a><span id="l4.422" class="difflineminus">-    try{</span>
<a href="#l4.423"></a><span id="l4.423" class="difflineminus">-      var datasource = RDF.GetDataSourceBlocking(sidebarObj.datasource_uri);</span>
<a href="#l4.424"></a><span id="l4.424" class="difflineminus">-      var aboutValue = RDF.GetResource(&quot;urn:sidebar:panel:search&quot;);</span>
<a href="#l4.425"></a><span id="l4.425" class="difflineminus">-</span>
<a href="#l4.426"></a><span id="l4.426" class="difflineminus">-      // check if the panel is even in the list by checking for its content</span>
<a href="#l4.427"></a><span id="l4.427" class="difflineminus">-      var contentProp = RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#content&quot;);</span>
<a href="#l4.428"></a><span id="l4.428" class="difflineminus">-      var content = datasource.GetTarget(aboutValue, contentProp, true);</span>
<a href="#l4.429"></a><span id="l4.429" class="difflineminus">-     </span>
<a href="#l4.430"></a><span id="l4.430" class="difflineminus">-      if (content instanceof Components.interfaces.nsIRDFLiteral){</span>
<a href="#l4.431"></a><span id="l4.431" class="difflineminus">-        // the search panel entry exists, now check if it is excluded</span>
<a href="#l4.432"></a><span id="l4.432" class="difflineminus">-        // for navigator</span>
<a href="#l4.433"></a><span id="l4.433" class="difflineminus">-        var excludeProp = RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#exclude&quot;);</span>
<a href="#l4.434"></a><span id="l4.434" class="difflineminus">-        var exclude = datasource.GetTarget(aboutValue, excludeProp, true);</span>
<a href="#l4.435"></a><span id="l4.435" class="difflineminus">-</span>
<a href="#l4.436"></a><span id="l4.436" class="difflineminus">-        if (exclude instanceof Components.interfaces.nsIRDFLiteral) {</span>
<a href="#l4.437"></a><span id="l4.437" class="difflineminus">-          searchPanelExists = (exclude.Value.indexOf(&quot;navigator:browser&quot;) &lt; 0);</span>
<a href="#l4.438"></a><span id="l4.438" class="difflineminus">-        } else {</span>
<a href="#l4.439"></a><span id="l4.439" class="difflineminus">-          // panel exists and no exclude set</span>
<a href="#l4.440"></a><span id="l4.440" class="difflineminus">-          searchPanelExists = true;</span>
<a href="#l4.441"></a><span id="l4.441" class="difflineminus">-        }</span>
<a href="#l4.442"></a><span id="l4.442" class="difflineminus">-      }</span>
<a href="#l4.443"></a><span id="l4.443" class="difflineminus">-    } catch(e){</span>
<a href="#l4.444"></a><span id="l4.444" class="difflineminus">-      searchPanelExists = false;</span>
<a href="#l4.445"></a><span id="l4.445" class="difflineminus">-    }</span>
<a href="#l4.446"></a><span id="l4.446" class="difflineminus">-  }</span>
<a href="#l4.447"></a><span id="l4.447" class="difflineminus">-</span>
<a href="#l4.448"></a><span id="l4.448" class="difflineminus">-  if (searchPanelExists) {</span>
<a href="#l4.449"></a><span id="l4.449" class="difflineminus">-    // make sure the sidebar is open, else SidebarSelectPanel() will fail</span>
<a href="#l4.450"></a><span id="l4.450" class="difflineminus">-    if (sidebar_is_hidden())</span>
<a href="#l4.451"></a><span id="l4.451" class="difflineminus">-      SidebarShowHide();</span>
<a href="#l4.452"></a><span id="l4.452" class="difflineminus">-  </span>
<a href="#l4.453"></a><span id="l4.453" class="difflineminus">-    if (sidebar_is_collapsed())</span>
<a href="#l4.454"></a><span id="l4.454" class="difflineminus">-      SidebarExpandCollapse();</span>
<a href="#l4.455"></a><span id="l4.455" class="difflineminus">-</span>
<a href="#l4.456"></a><span id="l4.456" class="difflineminus">-    var searchPanel = document.getElementById(&quot;urn:sidebar:panel:search&quot;);</span>
<a href="#l4.457"></a><span id="l4.457" class="difflineminus">-    if (searchPanel)</span>
<a href="#l4.458"></a><span id="l4.458" class="difflineminus">-      SidebarSelectPanel(searchPanel, true, true); // lives in sidebarOverlay.js      </span>
<a href="#l4.459"></a><span id="l4.459" class="difflineminus">-  }</span>
<a href="#l4.460"></a><span id="l4.460" class="difflineminus">-}</span>
<a href="#l4.461"></a><span id="l4.461" class="difflineminus">-</span>
<a href="#l4.462"></a><span id="l4.462" class="difflineminus">-function isSearchPanelOpen()</span>
<a href="#l4.463"></a><span id="l4.463" class="difflineminus">-{</span>
<a href="#l4.464"></a><span id="l4.464" class="difflineminus">-  return ( !sidebar_is_hidden()    &amp;&amp; </span>
<a href="#l4.465"></a><span id="l4.465" class="difflineminus">-           !sidebar_is_collapsed() &amp;&amp; </span>
<a href="#l4.466"></a><span id="l4.466" class="difflineminus">-           SidebarGetLastSelectedPanel() == &quot;urn:sidebar:panel:search&quot;</span>
<a href="#l4.467"></a><span id="l4.467" class="difflineminus">-         );</span>
<a href="#l4.468"></a><span id="l4.468" class="difflineminus">-}</span>
<a href="#l4.469"></a><span id="l4.469" class="difflineminus">-</span>
<a href="#l4.470"></a><span id="l4.470" class="difflineminus">-function BrowserSearchInternet()</span>
<a href="#l4.471"></a><span id="l4.471" class="difflineminus">-{</span>
<a href="#l4.472"></a><span id="l4.472" class="difflineminus">-  try {</span>
<a href="#l4.473"></a><span id="l4.473" class="difflineminus">-    var searchEngineURI = Services.prefs.getCharPref(&quot;browser.search.defaultengine&quot;);</span>
<a href="#l4.474"></a><span id="l4.474" class="difflineminus">-    if (searchEngineURI) {</span>
<a href="#l4.475"></a><span id="l4.475" class="difflineminus">-      var searchRoot = getSearchUrl(&quot;searchForm&quot;);</span>
<a href="#l4.476"></a><span id="l4.476" class="difflineminus">-      if (searchRoot) {</span>
<a href="#l4.477"></a><span id="l4.477" class="difflineminus">-        openTopWin(searchRoot);</span>
<a href="#l4.478"></a><span id="l4.478" class="difflineminus">-        return;</span>
<a href="#l4.479"></a><span id="l4.479" class="difflineminus">-      } else {</span>
<a href="#l4.480"></a><span id="l4.480" class="difflineminus">-        // Get a search URL and guess that the front page of the site has a search form.</span>
<a href="#l4.481"></a><span id="l4.481" class="difflineminus">-        var searchDS = Components.classes[&quot;@mozilla.org/rdf/datasource;1?name=internetsearch&quot;]</span>
<a href="#l4.482"></a><span id="l4.482" class="difflineminus">-                                 .getService(Components.interfaces.nsIInternetSearchService);</span>
<a href="#l4.483"></a><span id="l4.483" class="difflineminus">-        var searchURL = searchDS.GetInternetSearchURL(searchEngineURI, &quot;ABC&quot;, 0, 0, {value:0});</span>
<a href="#l4.484"></a><span id="l4.484" class="difflineminus">-        if (searchURL) {</span>
<a href="#l4.485"></a><span id="l4.485" class="difflineminus">-          searchRoot = searchURL.match(/^[^:]+:\/\/[^?/]+/i);</span>
<a href="#l4.486"></a><span id="l4.486" class="difflineminus">-          if (searchRoot) {</span>
<a href="#l4.487"></a><span id="l4.487" class="difflineminus">-            openTopWin(searchRoot + &quot;/&quot;);</span>
<a href="#l4.488"></a><span id="l4.488" class="difflineminus">-            return;</span>
<a href="#l4.489"></a><span id="l4.489" class="difflineminus">-          }</span>
<a href="#l4.490"></a><span id="l4.490" class="difflineminus">-        }</span>
<a href="#l4.491"></a><span id="l4.491" class="difflineminus">-      }</span>
<a href="#l4.492"></a><span id="l4.492" class="difflineminus">-    }</span>
<a href="#l4.493"></a><span id="l4.493" class="difflineminus">-  } catch (ex) {</span>
<a href="#l4.494"></a><span id="l4.494" class="difflineminus">-  }</span>
<a href="#l4.495"></a><span id="l4.495" class="difflineminus">-</span>
<a href="#l4.496"></a><span id="l4.496" class="difflineminus">-  // Fallback if the stuff above fails: use the hard-coded search engine</span>
<a href="#l4.497"></a><span id="l4.497" class="difflineminus">-  openTopWin(gNavigatorRegionBundle.getString(&quot;otherSearchURL&quot;));</span>
<a href="#l4.498"></a><span id="l4.498" class="difflineminus">-}</span>
<a href="#l4.499"></a><span id="l4.499" class="difflineminus">-</span>
<a href="#l4.500"></a><span id="l4.500" class="difflineminus">-</span>
<a href="#l4.501"></a><span id="l4.501"> //Note: BrowserNewEditorWindow() was moved to globalOverlay.xul and renamed to NewEditorWindow()</span>
<a href="#l4.502"></a><span id="l4.502"> </span>
<a href="#l4.503"></a><span id="l4.503"> function BrowserOpenWindow()</span>
<a href="#l4.504"></a><span id="l4.504"> {</span>
<a href="#l4.505"></a><span id="l4.505">   //opens a window where users can select a web location to open</span>
<a href="#l4.506"></a><span id="l4.506">   var params = { browser: window, action: null, url: &quot;&quot; };</span>
<a href="#l4.507"></a><span id="l4.507">   openDialog(&quot;chrome://communicator/content/openLocation.xul&quot;, &quot;_blank&quot;, &quot;chrome,modal,titlebar&quot;, params);</span>
<a href="#l4.508"></a><span id="l4.508">   var postData = { };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/browser/navigator.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/browser/navigator.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -350,17 +350,17 @@</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">       &lt;toolbaritem id=&quot;search-button-container&quot;</span>
<a href="#l5.6"></a><span id="l5.6">                    class=&quot;nav-bar-class&quot;</span>
<a href="#l5.7"></a><span id="l5.7">                    title=&quot;&amp;searchButton.label;&quot;&gt;</span>
<a href="#l5.8"></a><span id="l5.8">         &lt;button id=&quot;search-button&quot;</span>
<a href="#l5.9"></a><span id="l5.9">                 class=&quot;button-toolbar chromeclass-location&quot;</span>
<a href="#l5.10"></a><span id="l5.10">                 label=&quot;&amp;searchButton.label;&quot;</span>
<a href="#l5.11"></a><span id="l5.11">                 tooltiptext=&quot;&amp;searchButton.tooltip;&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-                oncommand=&quot;OpenSearch('internet', QualifySearchTerm());&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+                oncommand=&quot;BrowserSearch.loadSearch(QualifySearchTerm());&quot;</span>
<a href="#l5.14"></a><span id="l5.14">                 ondragover=&quot;nsDragAndDrop.dragOver(event, searchButtonObserver);&quot;</span>
<a href="#l5.15"></a><span id="l5.15">                 ondragdrop=&quot;nsDragAndDrop.drop(event, searchButtonObserver);&quot;</span>
<a href="#l5.16"></a><span id="l5.16">                 ondragexit=&quot;nsDragAndDrop.dragExit(event, searchButtonObserver);&quot;/&gt;</span>
<a href="#l5.17"></a><span id="l5.17">       &lt;/toolbaritem&gt;</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19">       &lt;toolbarbutton id=&quot;print-button&quot; type=&quot;menu-button&quot;</span>
<a href="#l5.20"></a><span id="l5.20">                      class=&quot;toolbarbutton-1 chromeclass-toolbar-additional&quot;</span>
<a href="#l5.21"></a><span id="l5.21">                      label=&quot;&amp;printButton.label;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/browser/navigatorDD.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/browser/navigatorDD.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -199,17 +199,17 @@ var searchButtonObserver = {</span>
<a href="#l6.4"></a><span id="l6.4">     {</span>
<a href="#l6.5"></a><span id="l6.5">       aEvent.target.removeAttribute(&quot;dragover&quot;);</span>
<a href="#l6.6"></a><span id="l6.6">     },</span>
<a href="#l6.7"></a><span id="l6.7">   onDrop: function (aEvent, aXferData, aDragSession)</span>
<a href="#l6.8"></a><span id="l6.8">     {</span>
<a href="#l6.9"></a><span id="l6.9">       var xferData = aXferData.data.split(&quot;\n&quot;);</span>
<a href="#l6.10"></a><span id="l6.10">       var uri = xferData[1] ? xferData[1] : xferData[0];</span>
<a href="#l6.11"></a><span id="l6.11">       if (uri)</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        OpenSearch('internet', uri);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+        BrowserSearch.loadSearch(uri);</span>
<a href="#l6.14"></a><span id="l6.14">     },</span>
<a href="#l6.15"></a><span id="l6.15">   getSupportedFlavours: function ()</span>
<a href="#l6.16"></a><span id="l6.16">     {</span>
<a href="#l6.17"></a><span id="l6.17">       var flavourSet = new FlavourSet();</span>
<a href="#l6.18"></a><span id="l6.18">       flavourSet.appendFlavour(&quot;application/x-moz-file&quot;, &quot;nsIFile&quot;);</span>
<a href="#l6.19"></a><span id="l6.19">       flavourSet.appendFlavour(&quot;text/x-moz-url&quot;);</span>
<a href="#l6.20"></a><span id="l6.20">       flavourSet.appendFlavour(&quot;text/unicode&quot;);</span>
<a href="#l6.21"></a><span id="l6.21">       return flavourSet;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/browser/public/Makefile.in</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/browser/public/Makefile.in</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -40,18 +40,14 @@ topsrcdir	= @top_srcdir@</span>
<a href="#l7.4"></a><span id="l7.4"> srcdir		= @srcdir@</span>
<a href="#l7.5"></a><span id="l7.5"> VPATH		= @srcdir@</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> MODULE		= suitebrowser</span>
<a href="#l7.10"></a><span id="l7.10"> XPIDL_MODULE	= suitebrowser</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-XPIDLSRCS = \</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-	nsISearchService.idl \</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-	$(NULL)</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-</span>
<a href="#l7.16"></a><span id="l7.16"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l7.17"></a><span id="l7.17"> XPIDLSRCS += nsIUrlWidget.idl</span>
<a href="#l7.18"></a><span id="l7.18"> endif</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> include $(topsrcdir)/config/rules.mk</span>
<a href="#l7.21"></a><span id="l7.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">deleted file mode 100755</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- a/suite/browser/public/nsISearchService.idl</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ /dev/null</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -1,129 +0,0 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineminus">- *</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">- *</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">- * License.</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">- *</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">- *</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">- *</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">- *   Robert John Churchill      &lt;rjc@netscape.com&gt;</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">- *</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">- *</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-/*</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-  The Browser Search service</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-*/</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-#include &quot;nsISupports.idl&quot;</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-#include &quot;nsIRDFDataSource.idl&quot;</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-interface  nsIUnicodeDecoder;</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-[scriptable, uuid(1222e6f0-a5e3-11d2-8b7c-00805f8a7db6)]</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-interface nsILocalSearchService : nsISupports</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-{</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineminus">-};</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineminus">-</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-[scriptable, uuid(a0d28a88-702e-49bd-bee2-929562688ae1)]</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-interface nsIInternetSearchService : nsISupports</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-{</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineminus">-  // constants set in the whichButtons out param of GetInternetSearchURL() </span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-  const unsigned short kHaveNext = 1;</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-  const unsigned short kHavePrev = 2;</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-  wstring   GetInternetSearchURL(in string searchEngineURI, in wstring searchStr, in short direction, in unsigned short pageNumber, out unsigned short whichButtons);</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-  void      RememberLastSearchText(in wstring escapedSearchStr);</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-  boolean      FindInternetSearchResults(in string url);</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-  void      Stop();</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-  void      ClearResults(in boolean flushLastSearchRef);</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-  void      ClearResultSearchSites();</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-  nsIRDFDataSource  GetCategoryDataSource();</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineminus">-  void      AddSearchEngine(in string engineURL, in string iconURL,</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-                         in wstring suggestedTitle, in wstring suggestedCategory);</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineminus">-};</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">-</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-[noscript, uuid(7b171610-80ca-4d33-b16c-4186cd7b7e73)]</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineminus">-interface nsIInternetSearchContext : nsISupports</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-{</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-  const unsigned long WEB_SEARCH_CONTEXT      = 1;</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineminus">-  // The download of the .src file for a *new* engine.</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-  const unsigned long ENGINE_DOWNLOAD_NEW_CONTEXT = 2;</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">-</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">-  // The download of the icon file for a new engine.</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">-  const unsigned long ICON_DOWNLOAD_NEW_CONTEXT = 3;</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineminus">-</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineminus">-  // The head request to see if we need to update the engine.</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineminus">-  const unsigned long ENGINE_UPDATE_HEAD_CONTEXT = 4;</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineminus">-</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineminus">-  // The download of the .src file for an engine update.</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineminus">-  const unsigned long ENGINE_DOWNLOAD_UPDATE_CONTEXT = 5;</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineminus">-</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineminus">-  // The download of the icon file for an engine update.</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineminus">-  const unsigned long ICON_DOWNLOAD_UPDATE_CONTEXT = 6;</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineminus">-</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineminus">-  // attributes</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineminus">-  readonly attribute unsigned long ContextType;</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineminus">-</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineminus">-  // methods</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineminus">-  nsIUnicodeDecoder  GetUnicodeDecoder();</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineminus">-  nsIRDFResource    GetParent();</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineminus">-  nsIRDFResource    GetEngine();</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineminus">-  void      GetHintConst([shared] out wstring buffer);</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-  void      AppendBytes(in string buffer, in long numBytes);</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineminus">-  void      AppendUnicodeBytes(in wstring buffer, in long numUniBytes);</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineminus">-  long      GetBufferLength();</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineminus">-  void      GetBufferConst([shared] out wstring buffer);</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineminus">-  void      Truncate();</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineminus">-};</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineminus">-</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineminus">-%{C++</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineminus">-</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineminus">-#define NS_IINTERNETSEARCHDATASOURCECALLBACK_IID \</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineminus">-{ 0x88774583, 0x1edd, 0x11d3, { 0x98, 0x20, 0xbf, 0x1b, 0xe7, 0x7e, 0x61, 0xc4 } }</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineminus">-</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-#define NS_IINTERNETSEARCHDATAOURCE_IID \</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineminus">-{ 0x6bd1d803, 0x1c67, 0x11d3, { 0x98, 0x20, 0xed, 0x1b, 0x35, 0x7e, 0xb3, 0xc4 } }</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineminus">-</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineminus">-#define NS_ILOCALSEARCHDATASOURCE_IID \</span>
<a href="#l8.121"></a><span id="l8.121" class="difflineminus">-{ 0x1222e6f0, 0xa5e3, 0x11d2, { 0x8b, 0x7c, 0x00, 0x80, 0x5f, 0x8a, 0x7d, 0xb6 } }</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineminus">-</span>
<a href="#l8.123"></a><span id="l8.123" class="difflineminus">-#define NS_LOCALSEARCH_SERVICE_CONTRACTID \</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineminus">-    &quot;@mozilla.org/browser/localsearch-service;1&quot;</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineminus">-#define NS_LOCALSEARCH_DATASOURCE_CONTRACTID \</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineminus">-    &quot;@mozilla.org/rdf/datasource;1?name=localsearch&quot;</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineminus">-</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineminus">-#define NS_INTERNETSEARCH_SERVICE_CONTRACTID \</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineminus">-    &quot;@mozilla.org/browser/internetsearch-service;1&quot;</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineminus">-#define NS_INTERNETSEARCH_DATASOURCE_CONTRACTID \</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineminus">-    &quot;@mozilla.org/rdf/datasource;1?name=internetsearch&quot;</span>
<a href="#l8.132"></a><span id="l8.132" class="difflineminus">-</span>
<a href="#l8.133"></a><span id="l8.133" class="difflineminus">-%}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">deleted file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- a/suite/browser/searchconfig.properties</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ /dev/null</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -1,5 +0,0 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineminus">-# Do NOT localize or otherwise change these values</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineminus">-browser.search.param.Google.1.custom=client=mozilla</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineminus">-browser.search.param.Google.1.default=client=mozilla</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineminus">-browser.search.param.Google.release=rls=%S:%S:unofficial</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/browser/src/Makefile.in</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/browser/src/Makefile.in</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -41,22 +41,16 @@ srcdir		= @srcdir@</span>
<a href="#l10.4"></a><span id="l10.4"> VPATH		= @srcdir@</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> MODULE		= suitebrowser</span>
<a href="#l10.9"></a><span id="l10.9"> LIBRARY_NAME	= suitebrowser_s</span>
<a href="#l10.10"></a><span id="l10.10"> META_COMPONENT  = suite</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-CPPSRCS = \</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-	nsInternetSearchService.cpp \</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-	nsLocalSearchService.cpp \</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-	$(NULL)</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-</span>
<a href="#l10.18"></a><span id="l10.18"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l10.19"></a><span id="l10.19"> CPPSRCS += nsUrlWidget.cpp</span>
<a href="#l10.20"></a><span id="l10.20"> endif</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22"> FORCE_STATIC_LIB = 1</span>
<a href="#l10.23"></a><span id="l10.23"> FORCE_USE_PIC=1</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25"> include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">deleted file mode 100755</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- a/suite/browser/src/nsInternetSearchService.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ /dev/null</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -1,6121 +0,0 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineminus">- *</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">- *</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">- * License.</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">- *</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">- *</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineminus">- *</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">- *   Robert John Churchill      &lt;rjc@netscape.com&gt;</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineminus">- *</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineminus">- *</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">-</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-/*</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineminus">-  Implementation for an internet search RDF data store.</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">- */</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineminus">-</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-#include &quot;nsInternetSearchService.h&quot;</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineminus">-</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-#include &quot;nscore.h&quot;</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-#include &quot;nsIEnumerator.h&quot;</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-#include &quot;nsIRDFObserver.h&quot;</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-#include &quot;nsIRDFContainer.h&quot;</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-#include &quot;nsIRDFContainerUtils.h&quot;</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineminus">-#include &quot;nsIServiceManager.h&quot;</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineminus">-#include &quot;nsVoidArray.h&quot;  // XXX introduces dependency on raptorbase</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-#include &quot;plhash.h&quot;</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-#include &quot;plstr.h&quot;</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineminus">-#include &quot;prmem.h&quot;</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineminus">-#include &quot;prprf.h&quot;</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-#include &quot;prio.h&quot;</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineminus">-#include &quot;prlog.h&quot;</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineminus">-#include &quot;prdtoa.h&quot;</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineminus">-#include &quot;rdf.h&quot;</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineminus">-#include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-#include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineminus">-#include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-#include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineminus">-#include &quot;nsCOMArray.h&quot;</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineminus">-#include &quot;nsCRTGlue.h&quot;</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineminus">-#include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineminus">-#include &quot;nsIRDFRemoteDataSource.h&quot;</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineminus">-#include &quot;nsICharsetConverterManager.h&quot;</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineminus">-#include &quot;nsICharsetAlias.h&quot;</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineminus">-#include &quot;nsITextToSubURI.h&quot;</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineminus">-#include &quot;nsNetUtil.h&quot;</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineminus">-#include &quot;nsINetUtil.h&quot;</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineminus">-#include &quot;nsIChannel.h&quot;</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineminus">-#include &quot;nsIFileChannel.h&quot;</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineminus">-#include &quot;nsIHttpChannel.h&quot;</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineminus">-#include &quot;nsIUploadChannel.h&quot;</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineminus">-#include &quot;nsIInputStream.h&quot;</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineminus">-#include &quot;nsIStringBundle.h&quot;</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineminus">-#include &quot;nsIObserverService.h&quot;</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineminus">-#include &quot;nsIURL.h&quot;</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineminus">-#include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineminus">-#include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineminus">-#include &quot;nsIPrefBranch2.h&quot;</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineminus">-#include &quot;nsIPrefService.h&quot;</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineminus">-</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineminus">-#ifdef  XP_WIN</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineminus">-#include &quot;windef.h&quot;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineminus">-#include &quot;winbase.h&quot;</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineminus">-#endif</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineminus">-</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineminus">-#ifdef  DEBUG</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineminus">-// #define  DEBUG_SEARCH_OUTPUT 1</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineminus">-// #define  DEBUG_SEARCH_UPDATES  1</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineminus">-#endif</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineminus">-</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineminus">-#define MAX_SEARCH_RESULTS_ALLOWED  100</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineminus">-</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineminus">-#define POSTHEADER_PREFIX &quot;Content-type: application/x-www-form-urlencoded\r\nContent-Length: &quot;</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineminus">-#define POSTHEADER_SUFFIX &quot;\r\n\r\n&quot;</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineminus">-#define SEARCH_PROPERTIES &quot;chrome://communicator/locale/search/search-panel.properties&quot;</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineminus">-#define SEARCHCONFIG_PROPERTIES &quot;chrome://branding/content/searchconfig.properties&quot;</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineminus">-#define INTL_PROPERTIES &quot;chrome://global/locale/intl.properties&quot;</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineminus">-</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineminus">-static NS_DEFINE_CID(kTextToSubURICID, NS_TEXTTOSUBURI_CID);</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineminus">-</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineminus">-static const char kURINC_SearchEngineRoot[]                   = &quot;NC:SearchEngineRoot&quot;;</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineminus">-static const char kURINC_SearchResultsSitesRoot[]             = &quot;NC:SearchResultsSitesRoot&quot;;</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineminus">-static const char kURINC_LastSearchRoot[]                     = &quot;NC:LastSearchRoot&quot;;</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineminus">-static const char kURINC_SearchCategoryRoot[]                 = &quot;NC:SearchCategoryRoot&quot;;</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineminus">-static const char kURINC_SearchCategoryPrefix[]               = &quot;NC:SearchCategory?category=&quot;;</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineminus">-static const char kURINC_SearchCategoryEnginePrefix[]         = &quot;NC:SearchCategory?engine=&quot;;</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineminus">-static const char kURINC_SearchCategoryEngineBasenamePrefix[] = &quot;NC:SearchCategory?engine=urn:search:engine:&quot;;</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineminus">- </span>
<a href="#l11.119"></a><span id="l11.119" class="difflineminus">-static const char kURINC_FilterSearchURLsRoot[]       = &quot;NC:FilterSearchURLsRoot&quot;;</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineminus">-static const char kURINC_FilterSearchSitesRoot[]      = &quot;NC:FilterSearchSitesRoot&quot;;</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineminus">-static const char kSearchCommand[]                    = &quot;http://home.netscape.com/NC-rdf#command?&quot;;</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineminus">-</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineminus">-// helper routines to ease the transition to frozen linkage strings (nsStringAPI.h)</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineminus">-</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineminus">-/// @see nsReadableUtils.h</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineminus">-PRBool RFindInReadable(const nsAString&amp; aPattern,</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineminus">-                       const PRUnichar **start,</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineminus">-                       const PRUnichar **end,</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineminus">-                       nsAString::ComparatorFunc c = nsAString::DefaultComparator)</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineminus">-{</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineminus">-  NS_PRECONDITION(start, &quot;invalid pointer&quot;);</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineminus">-  NS_PRECONDITION(end, &quot;invalid pointer&quot;);</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineminus">-  NS_PRECONDITION(end &gt;= start, &quot;searching in negative length string&quot;);</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineminus">-  if (!start || !end || !(end &gt;= start))</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineminus">-  {</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineminus">-    // bad input</span>
<a href="#l11.137"></a><span id="l11.137" class="difflineminus">-    return PR_FALSE;</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineminus">-  }</span>
<a href="#l11.139"></a><span id="l11.139" class="difflineminus">-  </span>
<a href="#l11.140"></a><span id="l11.140" class="difflineminus">-  if (aPattern.IsEmpty())</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineminus">-  {</span>
<a href="#l11.142"></a><span id="l11.142" class="difflineminus">-    NS_WARNING(&quot;searching for empty pattern&quot;);</span>
<a href="#l11.143"></a><span id="l11.143" class="difflineminus">-    *start = *end;</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineminus">-    return PR_TRUE;</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineminus">-  }</span>
<a href="#l11.146"></a><span id="l11.146" class="difflineminus">-</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineminus">-  // dumb algorithm - just check from back to front.</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineminus">-  const PRUnichar *current;</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineminus">-  PRUint32 len = aPattern.Length();</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineminus">-  for (current = *end - len; current &gt;= *start; --current)</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineminus">-  {</span>
<a href="#l11.152"></a><span id="l11.152" class="difflineminus">-    if (!c(current, aPattern.BeginReading(), len))</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineminus">-    {</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineminus">-      *start = current;</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineminus">-      *end = current + len;</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineminus">-      return PR_TRUE;</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineminus">-    }</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineminus">-  }</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineminus">-  // nothing found</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineminus">-  return PR_FALSE;</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineminus">-}</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineminus">-</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineminus">-</span>
<a href="#l11.164"></a><span id="l11.164" class="difflineminus">-</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineminus">-/// @see nsString::FindCharInSet</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineminus">-PRInt32 nsString_FindCharInSet(const nsAString&amp; aString, const char *aPattern, PRInt32 aOffset = 0)</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineminus">-{</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineminus">-  const PRUnichar *begin, *end;</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineminus">-  aString.BeginReading(&amp;begin, &amp;end);</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineminus">-  for (const PRUnichar *current = begin + aOffset; current &lt; end; ++current)</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineminus">-  {</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineminus">-    for (const char *pattern = aPattern; *pattern; ++pattern)</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineminus">-    {</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineminus">-      if (NS_UNLIKELY(*current == PRUnichar(*pattern)))</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineminus">-      {</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineminus">-        return current - begin;</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineminus">-      }</span>
<a href="#l11.178"></a><span id="l11.178" class="difflineminus">-    }</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineminus">-  }</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineminus">-  return -1;</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineminus">-}</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineminus">-</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineminus">-</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineminus">-</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineminus">-class InternetSearchContext : public nsIInternetSearchContext</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineminus">-{</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineminus">-public:</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineminus">-      InternetSearchContext(PRUint32 contextType, nsIRDFResource *aParent, nsIRDFResource *aEngine,</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineminus">-        nsIUnicodeDecoder *aUnicodeDecoder, const PRUnichar *hint);</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineminus">-  virtual   ~InternetSearchContext(void);</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineminus">-  NS_METHOD Init();</span>
<a href="#l11.192"></a><span id="l11.192" class="difflineminus">-</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineminus">-  NS_DECL_ISUPPORTS</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineminus">-  NS_DECL_NSIINTERNETSEARCHCONTEXT</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineminus">-</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineminus">-private:</span>
<a href="#l11.197"></a><span id="l11.197" class="difflineminus">-  PRUint32      mContextType;</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  mParent;</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  mEngine;</span>
<a href="#l11.200"></a><span id="l11.200" class="difflineminus">-  nsCOMPtr&lt;nsIUnicodeDecoder&gt; mUnicodeDecoder;</span>
<a href="#l11.201"></a><span id="l11.201" class="difflineminus">-  nsString      mBuffer;</span>
<a href="#l11.202"></a><span id="l11.202" class="difflineminus">-  nsString      mHint;</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineminus">-};</span>
<a href="#l11.204"></a><span id="l11.204" class="difflineminus">-</span>
<a href="#l11.205"></a><span id="l11.205" class="difflineminus">-</span>
<a href="#l11.206"></a><span id="l11.206" class="difflineminus">-</span>
<a href="#l11.207"></a><span id="l11.207" class="difflineminus">-InternetSearchContext::~InternetSearchContext(void)</span>
<a href="#l11.208"></a><span id="l11.208" class="difflineminus">-{</span>
<a href="#l11.209"></a><span id="l11.209" class="difflineminus">-}</span>
<a href="#l11.210"></a><span id="l11.210" class="difflineminus">-</span>
<a href="#l11.211"></a><span id="l11.211" class="difflineminus">-</span>
<a href="#l11.212"></a><span id="l11.212" class="difflineminus">-</span>
<a href="#l11.213"></a><span id="l11.213" class="difflineminus">-InternetSearchContext::InternetSearchContext(PRUint32 contextType, nsIRDFResource *aParent, nsIRDFResource *aEngine,</span>
<a href="#l11.214"></a><span id="l11.214" class="difflineminus">-        nsIUnicodeDecoder *aUnicodeDecoder, const PRUnichar *hint)</span>
<a href="#l11.215"></a><span id="l11.215" class="difflineminus">-  : mContextType(contextType), mParent(aParent), mEngine(aEngine), mUnicodeDecoder(aUnicodeDecoder), mHint(hint)</span>
<a href="#l11.216"></a><span id="l11.216" class="difflineminus">-{</span>
<a href="#l11.217"></a><span id="l11.217" class="difflineminus">-}</span>
<a href="#l11.218"></a><span id="l11.218" class="difflineminus">-</span>
<a href="#l11.219"></a><span id="l11.219" class="difflineminus">-</span>
<a href="#l11.220"></a><span id="l11.220" class="difflineminus">-</span>
<a href="#l11.221"></a><span id="l11.221" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.222"></a><span id="l11.222" class="difflineminus">-InternetSearchContext::Init()</span>
<a href="#l11.223"></a><span id="l11.223" class="difflineminus">-{</span>
<a href="#l11.224"></a><span id="l11.224" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.225"></a><span id="l11.225" class="difflineminus">-}</span>
<a href="#l11.226"></a><span id="l11.226" class="difflineminus">-</span>
<a href="#l11.227"></a><span id="l11.227" class="difflineminus">-</span>
<a href="#l11.228"></a><span id="l11.228" class="difflineminus">-</span>
<a href="#l11.229"></a><span id="l11.229" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.230"></a><span id="l11.230" class="difflineminus">-InternetSearchContext::GetContextType(PRUint32 *aContextType)</span>
<a href="#l11.231"></a><span id="l11.231" class="difflineminus">-{</span>
<a href="#l11.232"></a><span id="l11.232" class="difflineminus">-  *aContextType = mContextType;</span>
<a href="#l11.233"></a><span id="l11.233" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.234"></a><span id="l11.234" class="difflineminus">-}</span>
<a href="#l11.235"></a><span id="l11.235" class="difflineminus">-</span>
<a href="#l11.236"></a><span id="l11.236" class="difflineminus">-</span>
<a href="#l11.237"></a><span id="l11.237" class="difflineminus">-</span>
<a href="#l11.238"></a><span id="l11.238" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.239"></a><span id="l11.239" class="difflineminus">-InternetSearchContext::GetUnicodeDecoder(nsIUnicodeDecoder **decoder)</span>
<a href="#l11.240"></a><span id="l11.240" class="difflineminus">-{</span>
<a href="#l11.241"></a><span id="l11.241" class="difflineminus">-  *decoder = mUnicodeDecoder;</span>
<a href="#l11.242"></a><span id="l11.242" class="difflineminus">-  NS_IF_ADDREF(*decoder);</span>
<a href="#l11.243"></a><span id="l11.243" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.244"></a><span id="l11.244" class="difflineminus">-}</span>
<a href="#l11.245"></a><span id="l11.245" class="difflineminus">-</span>
<a href="#l11.246"></a><span id="l11.246" class="difflineminus">-</span>
<a href="#l11.247"></a><span id="l11.247" class="difflineminus">-</span>
<a href="#l11.248"></a><span id="l11.248" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.249"></a><span id="l11.249" class="difflineminus">-InternetSearchContext::GetEngine(nsIRDFResource **node)</span>
<a href="#l11.250"></a><span id="l11.250" class="difflineminus">-{</span>
<a href="#l11.251"></a><span id="l11.251" class="difflineminus">-  *node = mEngine;</span>
<a href="#l11.252"></a><span id="l11.252" class="difflineminus">-  NS_IF_ADDREF(*node);</span>
<a href="#l11.253"></a><span id="l11.253" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.254"></a><span id="l11.254" class="difflineminus">-}</span>
<a href="#l11.255"></a><span id="l11.255" class="difflineminus">-</span>
<a href="#l11.256"></a><span id="l11.256" class="difflineminus">-</span>
<a href="#l11.257"></a><span id="l11.257" class="difflineminus">-</span>
<a href="#l11.258"></a><span id="l11.258" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.259"></a><span id="l11.259" class="difflineminus">-InternetSearchContext::GetHintConst(const PRUnichar **hint)</span>
<a href="#l11.260"></a><span id="l11.260" class="difflineminus">-{</span>
<a href="#l11.261"></a><span id="l11.261" class="difflineminus">-  *hint = mHint.get();</span>
<a href="#l11.262"></a><span id="l11.262" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.263"></a><span id="l11.263" class="difflineminus">-}</span>
<a href="#l11.264"></a><span id="l11.264" class="difflineminus">-</span>
<a href="#l11.265"></a><span id="l11.265" class="difflineminus">-</span>
<a href="#l11.266"></a><span id="l11.266" class="difflineminus">-</span>
<a href="#l11.267"></a><span id="l11.267" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.268"></a><span id="l11.268" class="difflineminus">-InternetSearchContext::GetParent(nsIRDFResource **node)</span>
<a href="#l11.269"></a><span id="l11.269" class="difflineminus">-{</span>
<a href="#l11.270"></a><span id="l11.270" class="difflineminus">-  *node = mParent;</span>
<a href="#l11.271"></a><span id="l11.271" class="difflineminus">-  NS_IF_ADDREF(*node);</span>
<a href="#l11.272"></a><span id="l11.272" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.273"></a><span id="l11.273" class="difflineminus">-}</span>
<a href="#l11.274"></a><span id="l11.274" class="difflineminus">-</span>
<a href="#l11.275"></a><span id="l11.275" class="difflineminus">-</span>
<a href="#l11.276"></a><span id="l11.276" class="difflineminus">-</span>
<a href="#l11.277"></a><span id="l11.277" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.278"></a><span id="l11.278" class="difflineminus">-InternetSearchContext::AppendBytes(const char *buffer, PRInt32 numBytes)</span>
<a href="#l11.279"></a><span id="l11.279" class="difflineminus">-{</span>
<a href="#l11.280"></a><span id="l11.280" class="difflineminus">-  mBuffer.Append(NS_ConvertASCIItoUTF16(Substring(buffer, buffer + numBytes)));</span>
<a href="#l11.281"></a><span id="l11.281" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.282"></a><span id="l11.282" class="difflineminus">-}</span>
<a href="#l11.283"></a><span id="l11.283" class="difflineminus">-</span>
<a href="#l11.284"></a><span id="l11.284" class="difflineminus">-</span>
<a href="#l11.285"></a><span id="l11.285" class="difflineminus">-</span>
<a href="#l11.286"></a><span id="l11.286" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.287"></a><span id="l11.287" class="difflineminus">-InternetSearchContext::AppendUnicodeBytes(const PRUnichar *buffer, PRInt32 numUniBytes)</span>
<a href="#l11.288"></a><span id="l11.288" class="difflineminus">-{</span>
<a href="#l11.289"></a><span id="l11.289" class="difflineminus">-  mBuffer.Append(buffer, numUniBytes);</span>
<a href="#l11.290"></a><span id="l11.290" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.291"></a><span id="l11.291" class="difflineminus">-}</span>
<a href="#l11.292"></a><span id="l11.292" class="difflineminus">-</span>
<a href="#l11.293"></a><span id="l11.293" class="difflineminus">-</span>
<a href="#l11.294"></a><span id="l11.294" class="difflineminus">-</span>
<a href="#l11.295"></a><span id="l11.295" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.296"></a><span id="l11.296" class="difflineminus">-InternetSearchContext::GetBufferConst(const PRUnichar **buffer)</span>
<a href="#l11.297"></a><span id="l11.297" class="difflineminus">-{</span>
<a href="#l11.298"></a><span id="l11.298" class="difflineminus">-  *buffer = mBuffer.get();</span>
<a href="#l11.299"></a><span id="l11.299" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.300"></a><span id="l11.300" class="difflineminus">-}</span>
<a href="#l11.301"></a><span id="l11.301" class="difflineminus">-</span>
<a href="#l11.302"></a><span id="l11.302" class="difflineminus">-</span>
<a href="#l11.303"></a><span id="l11.303" class="difflineminus">-</span>
<a href="#l11.304"></a><span id="l11.304" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.305"></a><span id="l11.305" class="difflineminus">-InternetSearchContext::GetBufferLength(PRInt32 *bufferLen)</span>
<a href="#l11.306"></a><span id="l11.306" class="difflineminus">-{</span>
<a href="#l11.307"></a><span id="l11.307" class="difflineminus">-  *bufferLen = mBuffer.Length();</span>
<a href="#l11.308"></a><span id="l11.308" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.309"></a><span id="l11.309" class="difflineminus">-}</span>
<a href="#l11.310"></a><span id="l11.310" class="difflineminus">-</span>
<a href="#l11.311"></a><span id="l11.311" class="difflineminus">-</span>
<a href="#l11.312"></a><span id="l11.312" class="difflineminus">-</span>
<a href="#l11.313"></a><span id="l11.313" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.314"></a><span id="l11.314" class="difflineminus">-InternetSearchContext::Truncate()</span>
<a href="#l11.315"></a><span id="l11.315" class="difflineminus">-{</span>
<a href="#l11.316"></a><span id="l11.316" class="difflineminus">-  mBuffer.Truncate();</span>
<a href="#l11.317"></a><span id="l11.317" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.318"></a><span id="l11.318" class="difflineminus">-}</span>
<a href="#l11.319"></a><span id="l11.319" class="difflineminus">-</span>
<a href="#l11.320"></a><span id="l11.320" class="difflineminus">-</span>
<a href="#l11.321"></a><span id="l11.321" class="difflineminus">-</span>
<a href="#l11.322"></a><span id="l11.322" class="difflineminus">-NS_IMPL_THREADSAFE_ISUPPORTS1(InternetSearchContext, nsIInternetSearchContext)</span>
<a href="#l11.323"></a><span id="l11.323" class="difflineminus">-</span>
<a href="#l11.324"></a><span id="l11.324" class="difflineminus">-</span>
<a href="#l11.325"></a><span id="l11.325" class="difflineminus">-</span>
<a href="#l11.326"></a><span id="l11.326" class="difflineminus">-nsresult</span>
<a href="#l11.327"></a><span id="l11.327" class="difflineminus">-NS_NewInternetSearchContext(PRUint32 contextType, nsIRDFResource *aParent, nsIRDFResource *aEngine,</span>
<a href="#l11.328"></a><span id="l11.328" class="difflineminus">-          nsIUnicodeDecoder *aUnicodeDecoder, const PRUnichar *hint, nsIInternetSearchContext **aResult)</span>
<a href="#l11.329"></a><span id="l11.329" class="difflineminus">-{</span>
<a href="#l11.330"></a><span id="l11.330" class="difflineminus">-   InternetSearchContext *result =</span>
<a href="#l11.331"></a><span id="l11.331" class="difflineminus">-     new InternetSearchContext(contextType, aParent, aEngine, aUnicodeDecoder, hint);</span>
<a href="#l11.332"></a><span id="l11.332" class="difflineminus">-</span>
<a href="#l11.333"></a><span id="l11.333" class="difflineminus">-   if (! result)</span>
<a href="#l11.334"></a><span id="l11.334" class="difflineminus">-     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l11.335"></a><span id="l11.335" class="difflineminus">-</span>
<a href="#l11.336"></a><span id="l11.336" class="difflineminus">-   nsresult rv = result-&gt;Init();</span>
<a href="#l11.337"></a><span id="l11.337" class="difflineminus">-   if (NS_FAILED(rv)) {</span>
<a href="#l11.338"></a><span id="l11.338" class="difflineminus">-     delete result;</span>
<a href="#l11.339"></a><span id="l11.339" class="difflineminus">-     return rv;</span>
<a href="#l11.340"></a><span id="l11.340" class="difflineminus">-   }</span>
<a href="#l11.341"></a><span id="l11.341" class="difflineminus">-</span>
<a href="#l11.342"></a><span id="l11.342" class="difflineminus">-   NS_ADDREF(result);</span>
<a href="#l11.343"></a><span id="l11.343" class="difflineminus">-   *aResult = result;</span>
<a href="#l11.344"></a><span id="l11.344" class="difflineminus">-   return NS_OK;</span>
<a href="#l11.345"></a><span id="l11.345" class="difflineminus">-}</span>
<a href="#l11.346"></a><span id="l11.346" class="difflineminus">-</span>
<a href="#l11.347"></a><span id="l11.347" class="difflineminus">-</span>
<a href="#l11.348"></a><span id="l11.348" class="difflineminus">-</span>
<a href="#l11.349"></a><span id="l11.349" class="difflineminus">-</span>
<a href="#l11.350"></a><span id="l11.350" class="difflineminus">-</span>
<a href="#l11.351"></a><span id="l11.351" class="difflineminus">-static const char   kEngineProtocol[] = &quot;engine://&quot;;</span>
<a href="#l11.352"></a><span id="l11.352" class="difflineminus">-static const char   kSearchProtocol[] = &quot;internetsearch:&quot;;</span>
<a href="#l11.353"></a><span id="l11.353" class="difflineminus">-</span>
<a href="#l11.354"></a><span id="l11.354" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.355"></a><span id="l11.355" class="difflineminus">-#define SEARCH_UPDATE_TIMEOUT 10000   // fire every 10 seconds</span>
<a href="#l11.356"></a><span id="l11.356" class="difflineminus">-#else</span>
<a href="#l11.357"></a><span id="l11.357" class="difflineminus">-#define SEARCH_UPDATE_TIMEOUT 60000   // fire every 60 seconds</span>
<a href="#l11.358"></a><span id="l11.358" class="difflineminus">-#endif</span>
<a href="#l11.359"></a><span id="l11.359" class="difflineminus">-</span>
<a href="#l11.360"></a><span id="l11.360" class="difflineminus">-</span>
<a href="#l11.361"></a><span id="l11.361" class="difflineminus">-InternetSearchDataSource::InternetSearchDataSource(void) :</span>
<a href="#l11.362"></a><span id="l11.362" class="difflineminus">-  mBrowserSearchMode(0),</span>
<a href="#l11.363"></a><span id="l11.363" class="difflineminus">-  mEngineListBuilt(PR_FALSE),</span>
<a href="#l11.364"></a><span id="l11.364" class="difflineminus">-  mRDFService(do_GetService(NS_RDF_CONTRACTID &quot;/rdf-service;1&quot;)),</span>
<a href="#l11.365"></a><span id="l11.365" class="difflineminus">-  mRDFC(do_GetService(NS_RDF_CONTRACTID &quot;/container-utils;1&quot;)),</span>
<a href="#l11.366"></a><span id="l11.366" class="difflineminus">-  busySchedule(PR_FALSE)</span>
<a href="#l11.367"></a><span id="l11.367" class="difflineminus">-{</span>
<a href="#l11.368"></a><span id="l11.368" class="difflineminus">-  NS_ASSERTION(mRDFService, &quot;No RDF Service&quot;);</span>
<a href="#l11.369"></a><span id="l11.369" class="difflineminus">-  NS_ASSERTION(mRDFC, &quot;No RDF Container Utils&quot;);</span>
<a href="#l11.370"></a><span id="l11.370" class="difflineminus">-  </span>
<a href="#l11.371"></a><span id="l11.371" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(kURINC_SearchEngineRoot),</span>
<a href="#l11.372"></a><span id="l11.372" class="difflineminus">-                           getter_AddRefs(mNC_SearchEngineRoot));</span>
<a href="#l11.373"></a><span id="l11.373" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(kURINC_LastSearchRoot),</span>
<a href="#l11.374"></a><span id="l11.374" class="difflineminus">-                           getter_AddRefs(mNC_LastSearchRoot));</span>
<a href="#l11.375"></a><span id="l11.375" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(kURINC_SearchResultsSitesRoot),</span>
<a href="#l11.376"></a><span id="l11.376" class="difflineminus">-                           getter_AddRefs(mNC_SearchResultsSitesRoot));</span>
<a href="#l11.377"></a><span id="l11.377" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(kURINC_FilterSearchURLsRoot),</span>
<a href="#l11.378"></a><span id="l11.378" class="difflineminus">-                           getter_AddRefs(mNC_FilterSearchURLsRoot));</span>
<a href="#l11.379"></a><span id="l11.379" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(kURINC_FilterSearchSitesRoot),</span>
<a href="#l11.380"></a><span id="l11.380" class="difflineminus">-                           getter_AddRefs(mNC_FilterSearchSitesRoot));</span>
<a href="#l11.381"></a><span id="l11.381" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(kURINC_SearchCategoryRoot),</span>
<a href="#l11.382"></a><span id="l11.382" class="difflineminus">-                           getter_AddRefs(mNC_SearchCategoryRoot));</span>
<a href="#l11.383"></a><span id="l11.383" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;SearchMode&quot;),</span>
<a href="#l11.384"></a><span id="l11.384" class="difflineminus">-                           getter_AddRefs(mNC_LastSearchMode));</span>
<a href="#l11.385"></a><span id="l11.385" class="difflineminus">- </span>
<a href="#l11.386"></a><span id="l11.386" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;searchtype&quot;),</span>
<a href="#l11.387"></a><span id="l11.387" class="difflineminus">-                           getter_AddRefs(mNC_SearchType));</span>
<a href="#l11.388"></a><span id="l11.388" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;SearchResult&quot;),</span>
<a href="#l11.389"></a><span id="l11.389" class="difflineminus">-                           getter_AddRefs(mNC_SearchResult));</span>
<a href="#l11.390"></a><span id="l11.390" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;ref&quot;),</span>
<a href="#l11.391"></a><span id="l11.391" class="difflineminus">-                           getter_AddRefs(mNC_Ref));</span>
<a href="#l11.392"></a><span id="l11.392" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;child&quot;),</span>
<a href="#l11.393"></a><span id="l11.393" class="difflineminus">-                           getter_AddRefs(mNC_Child));</span>
<a href="#l11.394"></a><span id="l11.394" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;title&quot;),</span>
<a href="#l11.395"></a><span id="l11.395" class="difflineminus">-                           getter_AddRefs(mNC_Title));</span>
<a href="#l11.396"></a><span id="l11.396" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;data&quot;),</span>
<a href="#l11.397"></a><span id="l11.397" class="difflineminus">-                           getter_AddRefs(mNC_Data));</span>
<a href="#l11.398"></a><span id="l11.398" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Name&quot;),</span>
<a href="#l11.399"></a><span id="l11.399" class="difflineminus">-                           getter_AddRefs(mNC_Name));</span>
<a href="#l11.400"></a><span id="l11.400" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Description&quot;),</span>
<a href="#l11.401"></a><span id="l11.401" class="difflineminus">-                           getter_AddRefs(mNC_Description));</span>
<a href="#l11.402"></a><span id="l11.402" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Version&quot;),</span>
<a href="#l11.403"></a><span id="l11.403" class="difflineminus">-                           getter_AddRefs(mNC_Version));</span>
<a href="#l11.404"></a><span id="l11.404" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;actionButton&quot;),</span>
<a href="#l11.405"></a><span id="l11.405" class="difflineminus">-                           getter_AddRefs(mNC_actionButton));</span>
<a href="#l11.406"></a><span id="l11.406" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;actionBar&quot;),</span>
<a href="#l11.407"></a><span id="l11.407" class="difflineminus">-                           getter_AddRefs(mNC_actionBar));</span>
<a href="#l11.408"></a><span id="l11.408" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;searchForm&quot;),</span>
<a href="#l11.409"></a><span id="l11.409" class="difflineminus">-                           getter_AddRefs(mNC_searchForm));</span>
<a href="#l11.410"></a><span id="l11.410" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;LastText&quot;),</span>
<a href="#l11.411"></a><span id="l11.411" class="difflineminus">-                           getter_AddRefs(mNC_LastText));</span>
<a href="#l11.412"></a><span id="l11.412" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;URL&quot;),</span>
<a href="#l11.413"></a><span id="l11.413" class="difflineminus">-                           getter_AddRefs(mNC_URL));</span>
<a href="#l11.414"></a><span id="l11.414" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(RDF_NAMESPACE_URI &quot;instanceOf&quot;),</span>
<a href="#l11.415"></a><span id="l11.415" class="difflineminus">-                           getter_AddRefs(mRDF_InstanceOf));</span>
<a href="#l11.416"></a><span id="l11.416" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(RDF_NAMESPACE_URI &quot;type&quot;),</span>
<a href="#l11.417"></a><span id="l11.417" class="difflineminus">-                           getter_AddRefs(mRDF_type));</span>
<a href="#l11.418"></a><span id="l11.418" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;loading&quot;),</span>
<a href="#l11.419"></a><span id="l11.419" class="difflineminus">-                           getter_AddRefs(mNC_loading));</span>
<a href="#l11.420"></a><span id="l11.420" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;HTML&quot;),</span>
<a href="#l11.421"></a><span id="l11.421" class="difflineminus">-                           getter_AddRefs(mNC_HTML));</span>
<a href="#l11.422"></a><span id="l11.422" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Icon&quot;),</span>
<a href="#l11.423"></a><span id="l11.423" class="difflineminus">-                           getter_AddRefs(mNC_Icon));</span>
<a href="#l11.424"></a><span id="l11.424" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;StatusIcon&quot;),</span>
<a href="#l11.425"></a><span id="l11.425" class="difflineminus">-                           getter_AddRefs(mNC_StatusIcon));</span>
<a href="#l11.426"></a><span id="l11.426" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Banner&quot;),</span>
<a href="#l11.427"></a><span id="l11.427" class="difflineminus">-                           getter_AddRefs(mNC_Banner));</span>
<a href="#l11.428"></a><span id="l11.428" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Site&quot;),</span>
<a href="#l11.429"></a><span id="l11.429" class="difflineminus">-                           getter_AddRefs(mNC_Site));</span>
<a href="#l11.430"></a><span id="l11.430" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Relevance&quot;),</span>
<a href="#l11.431"></a><span id="l11.431" class="difflineminus">-                           getter_AddRefs(mNC_Relevance));</span>
<a href="#l11.432"></a><span id="l11.432" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Relevance?sort=true&quot;),</span>
<a href="#l11.433"></a><span id="l11.433" class="difflineminus">-                           getter_AddRefs(mNC_RelevanceSort));</span>
<a href="#l11.434"></a><span id="l11.434" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Date&quot;),</span>
<a href="#l11.435"></a><span id="l11.435" class="difflineminus">-                           getter_AddRefs(mNC_Date));</span>
<a href="#l11.436"></a><span id="l11.436" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;PageRank&quot;),</span>
<a href="#l11.437"></a><span id="l11.437" class="difflineminus">-                           getter_AddRefs(mNC_PageRank));</span>
<a href="#l11.438"></a><span id="l11.438" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Engine&quot;),</span>
<a href="#l11.439"></a><span id="l11.439" class="difflineminus">-                           getter_AddRefs(mNC_Engine));</span>
<a href="#l11.440"></a><span id="l11.440" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Price&quot;),</span>
<a href="#l11.441"></a><span id="l11.441" class="difflineminus">-                           getter_AddRefs(mNC_Price));</span>
<a href="#l11.442"></a><span id="l11.442" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Price?sort=true&quot;),</span>
<a href="#l11.443"></a><span id="l11.443" class="difflineminus">-                           getter_AddRefs(mNC_PriceSort));</span>
<a href="#l11.444"></a><span id="l11.444" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Availability&quot;),</span>
<a href="#l11.445"></a><span id="l11.445" class="difflineminus">-                           getter_AddRefs(mNC_Availability));</span>
<a href="#l11.446"></a><span id="l11.446" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;BookmarkSeparator&quot;),</span>
<a href="#l11.447"></a><span id="l11.447" class="difflineminus">-                           getter_AddRefs(mNC_BookmarkSeparator));</span>
<a href="#l11.448"></a><span id="l11.448" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Update&quot;),</span>
<a href="#l11.449"></a><span id="l11.449" class="difflineminus">-                           getter_AddRefs(mNC_Update));</span>
<a href="#l11.450"></a><span id="l11.450" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;UpdateIcon&quot;),</span>
<a href="#l11.451"></a><span id="l11.451" class="difflineminus">-                           getter_AddRefs(mNC_UpdateIcon));</span>
<a href="#l11.452"></a><span id="l11.452" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;UpdateCheckDays&quot;),</span>
<a href="#l11.453"></a><span id="l11.453" class="difflineminus">-                           getter_AddRefs(mNC_UpdateCheckDays));</span>
<a href="#l11.454"></a><span id="l11.454" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(WEB_NAMESPACE_URI &quot;LastPingDate&quot;),</span>
<a href="#l11.455"></a><span id="l11.455" class="difflineminus">-                           getter_AddRefs(mWEB_LastPingDate));</span>
<a href="#l11.456"></a><span id="l11.456" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(WEB_NAMESPACE_URI &quot;LastPingModDate&quot;),</span>
<a href="#l11.457"></a><span id="l11.457" class="difflineminus">-                           getter_AddRefs(mWEB_LastPingModDate));</span>
<a href="#l11.458"></a><span id="l11.458" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(WEB_NAMESPACE_URI &quot;LastPingContentLen&quot;),</span>
<a href="#l11.459"></a><span id="l11.459" class="difflineminus">-                           getter_AddRefs(mWEB_LastPingContentLen));</span>
<a href="#l11.460"></a><span id="l11.460" class="difflineminus">- </span>
<a href="#l11.461"></a><span id="l11.461" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;command?cmd=addtobookmarks&quot;),</span>
<a href="#l11.462"></a><span id="l11.462" class="difflineminus">-                           getter_AddRefs(mNC_SearchCommand_AddToBookmarks));</span>
<a href="#l11.463"></a><span id="l11.463" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;command?cmd=addquerytobookmarks&quot;),</span>
<a href="#l11.464"></a><span id="l11.464" class="difflineminus">-                           getter_AddRefs(mNC_SearchCommand_AddQueryToBookmarks));</span>
<a href="#l11.465"></a><span id="l11.465" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;command?cmd=filterresult&quot;),</span>
<a href="#l11.466"></a><span id="l11.466" class="difflineminus">-                           getter_AddRefs(mNC_SearchCommand_FilterResult));</span>
<a href="#l11.467"></a><span id="l11.467" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;command?cmd=filtersite&quot;),</span>
<a href="#l11.468"></a><span id="l11.468" class="difflineminus">-                           getter_AddRefs(mNC_SearchCommand_FilterSite));</span>
<a href="#l11.469"></a><span id="l11.469" class="difflineminus">-  mRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;command?cmd=clearfilters&quot;),</span>
<a href="#l11.470"></a><span id="l11.470" class="difflineminus">-                           getter_AddRefs(mNC_SearchCommand_ClearFilters));</span>
<a href="#l11.471"></a><span id="l11.471" class="difflineminus">- </span>
<a href="#l11.472"></a><span id="l11.472" class="difflineminus">-  mRDFService-&gt;GetLiteral(NS_LITERAL_STRING(&quot;true&quot;).get(),</span>
<a href="#l11.473"></a><span id="l11.473" class="difflineminus">-                          getter_AddRefs(mTrueLiteral));</span>
<a href="#l11.474"></a><span id="l11.474" class="difflineminus">-</span>
<a href="#l11.475"></a><span id="l11.475" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch2&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l11.476"></a><span id="l11.476" class="difflineminus">-  if (prefs) {</span>
<a href="#l11.477"></a><span id="l11.477" class="difflineminus">-    prefs-&gt;AddObserver(&quot;browser.search.mode&quot;, this, PR_FALSE);</span>
<a href="#l11.478"></a><span id="l11.478" class="difflineminus">-    prefs-&gt;GetIntPref(&quot;browser.search.mode&quot;, &amp;mBrowserSearchMode);</span>
<a href="#l11.479"></a><span id="l11.479" class="difflineminus">-  }</span>
<a href="#l11.480"></a><span id="l11.480" class="difflineminus">-}</span>
<a href="#l11.481"></a><span id="l11.481" class="difflineminus">-</span>
<a href="#l11.482"></a><span id="l11.482" class="difflineminus">-</span>
<a href="#l11.483"></a><span id="l11.483" class="difflineminus">-</span>
<a href="#l11.484"></a><span id="l11.484" class="difflineminus">-InternetSearchDataSource::~InternetSearchDataSource (void)</span>
<a href="#l11.485"></a><span id="l11.485" class="difflineminus">-{</span>
<a href="#l11.486"></a><span id="l11.486" class="difflineminus">-  if (mTimer) {</span>
<a href="#l11.487"></a><span id="l11.487" class="difflineminus">-    // be sure to cancel the timer, as it holds a</span>
<a href="#l11.488"></a><span id="l11.488" class="difflineminus">-    // weak reference back to InternetSearchDataSource</span>
<a href="#l11.489"></a><span id="l11.489" class="difflineminus">-    mTimer-&gt;Cancel();</span>
<a href="#l11.490"></a><span id="l11.490" class="difflineminus">-  }</span>
<a href="#l11.491"></a><span id="l11.491" class="difflineminus">-</span>
<a href="#l11.492"></a><span id="l11.492" class="difflineminus">-  if (mRDFService)</span>
<a href="#l11.493"></a><span id="l11.493" class="difflineminus">-    mRDFService-&gt;UnregisterDataSource(this);</span>
<a href="#l11.494"></a><span id="l11.494" class="difflineminus">-}</span>
<a href="#l11.495"></a><span id="l11.495" class="difflineminus">-</span>
<a href="#l11.496"></a><span id="l11.496" class="difflineminus">-</span>
<a href="#l11.497"></a><span id="l11.497" class="difflineminus">-</span>
<a href="#l11.498"></a><span id="l11.498" class="difflineminus">-nsresult</span>
<a href="#l11.499"></a><span id="l11.499" class="difflineminus">-InternetSearchDataSource::GetSearchEngineToPing(nsIRDFResource **theEngine, nsCString &amp;updateURL)</span>
<a href="#l11.500"></a><span id="l11.500" class="difflineminus">-{</span>
<a href="#l11.501"></a><span id="l11.501" class="difflineminus">-  nsresult  rv = NS_OK;</span>
<a href="#l11.502"></a><span id="l11.502" class="difflineminus">-</span>
<a href="#l11.503"></a><span id="l11.503" class="difflineminus">-  *theEngine = nsnull;</span>
<a href="#l11.504"></a><span id="l11.504" class="difflineminus">-  updateURL.Truncate();</span>
<a href="#l11.505"></a><span id="l11.505" class="difflineminus">-</span>
<a href="#l11.506"></a><span id="l11.506" class="difflineminus">-  if (!mUpdateArray)  return(NS_OK);</span>
<a href="#l11.507"></a><span id="l11.507" class="difflineminus">-</span>
<a href="#l11.508"></a><span id="l11.508" class="difflineminus">-  PRUint32  numEngines = 0;</span>
<a href="#l11.509"></a><span id="l11.509" class="difflineminus">-  if (NS_FAILED(rv = mUpdateArray-&gt;Count(&amp;numEngines))) return(rv);</span>
<a href="#l11.510"></a><span id="l11.510" class="difflineminus">-  if (numEngines &lt; 1) return(NS_OK);</span>
<a href="#l11.511"></a><span id="l11.511" class="difflineminus">-</span>
<a href="#l11.512"></a><span id="l11.512" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; aRes (do_QueryElementAt(mUpdateArray, 0));</span>
<a href="#l11.513"></a><span id="l11.513" class="difflineminus">-</span>
<a href="#l11.514"></a><span id="l11.514" class="difflineminus">-  // note: important to remove element from array</span>
<a href="#l11.515"></a><span id="l11.515" class="difflineminus">-  mUpdateArray-&gt;RemoveElementAt(0);</span>
<a href="#l11.516"></a><span id="l11.516" class="difflineminus">-</span>
<a href="#l11.517"></a><span id="l11.517" class="difflineminus">-  if (aRes)</span>
<a href="#l11.518"></a><span id="l11.518" class="difflineminus">-  {</span>
<a href="#l11.519"></a><span id="l11.519" class="difflineminus">-    if (isSearchCategoryEngineURI(aRes))</span>
<a href="#l11.520"></a><span id="l11.520" class="difflineminus">-    {</span>
<a href="#l11.521"></a><span id="l11.521" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt;  trueEngine;</span>
<a href="#l11.522"></a><span id="l11.522" class="difflineminus">-      rv = resolveSearchCategoryEngineURI(aRes, getter_AddRefs(trueEngine));</span>
<a href="#l11.523"></a><span id="l11.523" class="difflineminus">-      if (NS_FAILED(rv) || (rv == NS_RDF_NO_VALUE)) return(rv);</span>
<a href="#l11.524"></a><span id="l11.524" class="difflineminus">-      if (!trueEngine)  return(NS_RDF_NO_VALUE);</span>
<a href="#l11.525"></a><span id="l11.525" class="difflineminus">-</span>
<a href="#l11.526"></a><span id="l11.526" class="difflineminus">-      aRes = trueEngine;</span>
<a href="#l11.527"></a><span id="l11.527" class="difflineminus">-    }</span>
<a href="#l11.528"></a><span id="l11.528" class="difflineminus">-</span>
<a href="#l11.529"></a><span id="l11.529" class="difflineminus">-    if (!aRes)  return(NS_OK);</span>
<a href="#l11.530"></a><span id="l11.530" class="difflineminus">-</span>
<a href="#l11.531"></a><span id="l11.531" class="difflineminus">-    *theEngine = aRes.get();</span>
<a href="#l11.532"></a><span id="l11.532" class="difflineminus">-    NS_ADDREF(*theEngine);</span>
<a href="#l11.533"></a><span id="l11.533" class="difflineminus">-</span>
<a href="#l11.534"></a><span id="l11.534" class="difflineminus">-    // get update URL</span>
<a href="#l11.535"></a><span id="l11.535" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt;  aNode;</span>
<a href="#l11.536"></a><span id="l11.536" class="difflineminus">-    if (NS_SUCCEEDED(rv = mInner-&gt;GetTarget(aRes, mNC_Update, PR_TRUE, getter_AddRefs(aNode)))</span>
<a href="#l11.537"></a><span id="l11.537" class="difflineminus">-      &amp;&amp; (rv != NS_RDF_NO_VALUE))</span>
<a href="#l11.538"></a><span id="l11.538" class="difflineminus">-    {</span>
<a href="#l11.539"></a><span id="l11.539" class="difflineminus">-      nsCOMPtr&lt;nsIRDFLiteral&gt; aLiteral (do_QueryInterface(aNode));</span>
<a href="#l11.540"></a><span id="l11.540" class="difflineminus">-      if (aLiteral)</span>
<a href="#l11.541"></a><span id="l11.541" class="difflineminus">-      {</span>
<a href="#l11.542"></a><span id="l11.542" class="difflineminus">-        const PRUnichar *updateUni = nsnull;</span>
<a href="#l11.543"></a><span id="l11.543" class="difflineminus">-        aLiteral-&gt;GetValueConst(&amp;updateUni);</span>
<a href="#l11.544"></a><span id="l11.544" class="difflineminus">-        if (updateUni)</span>
<a href="#l11.545"></a><span id="l11.545" class="difflineminus">-        {</span>
<a href="#l11.546"></a><span id="l11.546" class="difflineminus">-          CopyUTF16toUTF8(nsDependentString(updateUni), updateURL);</span>
<a href="#l11.547"></a><span id="l11.547" class="difflineminus">-        }</span>
<a href="#l11.548"></a><span id="l11.548" class="difflineminus">-      }</span>
<a href="#l11.549"></a><span id="l11.549" class="difflineminus">-    }</span>
<a href="#l11.550"></a><span id="l11.550" class="difflineminus">-  }</span>
<a href="#l11.551"></a><span id="l11.551" class="difflineminus">-  return(rv);</span>
<a href="#l11.552"></a><span id="l11.552" class="difflineminus">-}</span>
<a href="#l11.553"></a><span id="l11.553" class="difflineminus">-</span>
<a href="#l11.554"></a><span id="l11.554" class="difflineminus">-</span>
<a href="#l11.555"></a><span id="l11.555" class="difflineminus">-</span>
<a href="#l11.556"></a><span id="l11.556" class="difflineminus">-void</span>
<a href="#l11.557"></a><span id="l11.557" class="difflineminus">-InternetSearchDataSource::FireTimer(nsITimer* aTimer, void* aClosure)</span>
<a href="#l11.558"></a><span id="l11.558" class="difflineminus">-{</span>
<a href="#l11.559"></a><span id="l11.559" class="difflineminus">-  InternetSearchDataSource *search = static_cast&lt;InternetSearchDataSource *&gt;(aClosure);</span>
<a href="#l11.560"></a><span id="l11.560" class="difflineminus">-  if (!search)  return;</span>
<a href="#l11.561"></a><span id="l11.561" class="difflineminus">-</span>
<a href="#l11.562"></a><span id="l11.562" class="difflineminus">-  if (!search-&gt;busySchedule)</span>
<a href="#l11.563"></a><span id="l11.563" class="difflineminus">-  {</span>
<a href="#l11.564"></a><span id="l11.564" class="difflineminus">-    nsresult      rv;</span>
<a href="#l11.565"></a><span id="l11.565" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt;  searchURI;</span>
<a href="#l11.566"></a><span id="l11.566" class="difflineminus">-    nsCAutoString     updateURL;</span>
<a href="#l11.567"></a><span id="l11.567" class="difflineminus">-    if (NS_FAILED(rv = search-&gt;GetSearchEngineToPing(getter_AddRefs(searchURI), updateURL)))</span>
<a href="#l11.568"></a><span id="l11.568" class="difflineminus">-      return;</span>
<a href="#l11.569"></a><span id="l11.569" class="difflineminus">-    if (!searchURI)     return;</span>
<a href="#l11.570"></a><span id="l11.570" class="difflineminus">-    if (updateURL.IsEmpty())  return;</span>
<a href="#l11.571"></a><span id="l11.571" class="difflineminus">-</span>
<a href="#l11.572"></a><span id="l11.572" class="difflineminus">-    search-&gt;busyResource = searchURI;</span>
<a href="#l11.573"></a><span id="l11.573" class="difflineminus">-</span>
<a href="#l11.574"></a><span id="l11.574" class="difflineminus">-    nsCOMPtr&lt;nsIInternetSearchContext&gt;  engineContext;</span>
<a href="#l11.575"></a><span id="l11.575" class="difflineminus">-    if (NS_FAILED(rv = NS_NewInternetSearchContext(nsIInternetSearchContext::ENGINE_UPDATE_HEAD_CONTEXT,</span>
<a href="#l11.576"></a><span id="l11.576" class="difflineminus">-      nsnull, searchURI, nsnull, nsnull, getter_AddRefs(engineContext))))</span>
<a href="#l11.577"></a><span id="l11.577" class="difflineminus">-      return;</span>
<a href="#l11.578"></a><span id="l11.578" class="difflineminus">-    if (!engineContext) return;</span>
<a href="#l11.579"></a><span id="l11.579" class="difflineminus">-</span>
<a href="#l11.580"></a><span id="l11.580" class="difflineminus">-    nsCOMPtr&lt;nsIURI&gt;  uri;</span>
<a href="#l11.581"></a><span id="l11.581" class="difflineminus">-    if (NS_FAILED(rv = NS_NewURI(getter_AddRefs(uri), updateURL.get())))  return;</span>
<a href="#l11.582"></a><span id="l11.582" class="difflineminus">-</span>
<a href="#l11.583"></a><span id="l11.583" class="difflineminus">-    nsCOMPtr&lt;nsIChannel&gt;  channel;</span>
<a href="#l11.584"></a><span id="l11.584" class="difflineminus">-    if (NS_FAILED(rv = NS_NewChannel(getter_AddRefs(channel), uri, nsnull)))  return;</span>
<a href="#l11.585"></a><span id="l11.585" class="difflineminus">-</span>
<a href="#l11.586"></a><span id="l11.586" class="difflineminus">-    channel-&gt;SetLoadFlags(nsIRequest::VALIDATE_ALWAYS);</span>
<a href="#l11.587"></a><span id="l11.587" class="difflineminus">-</span>
<a href="#l11.588"></a><span id="l11.588" class="difflineminus">-    nsCOMPtr&lt;nsIHttpChannel&gt; httpChannel (do_QueryInterface(channel));</span>
<a href="#l11.589"></a><span id="l11.589" class="difflineminus">-    if (!httpChannel) return;</span>
<a href="#l11.590"></a><span id="l11.590" class="difflineminus">-</span>
<a href="#l11.591"></a><span id="l11.591" class="difflineminus">-    // rjc says: just check &quot;HEAD&quot; info for whether a search file has changed</span>
<a href="#l11.592"></a><span id="l11.592" class="difflineminus">-        httpChannel-&gt;SetRequestMethod(NS_LITERAL_CSTRING(&quot;HEAD&quot;));</span>
<a href="#l11.593"></a><span id="l11.593" class="difflineminus">-    if (NS_SUCCEEDED(rv = channel-&gt;AsyncOpen(search, engineContext)))</span>
<a href="#l11.594"></a><span id="l11.594" class="difflineminus">-    {</span>
<a href="#l11.595"></a><span id="l11.595" class="difflineminus">-      search-&gt;busySchedule = PR_TRUE;</span>
<a href="#l11.596"></a><span id="l11.596" class="difflineminus">-</span>
<a href="#l11.597"></a><span id="l11.597" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.598"></a><span id="l11.598" class="difflineminus">-      printf(&quot;    InternetSearchDataSource::FireTimer - Pinging '%s'\n&quot;, (char *)updateURL.get());</span>
<a href="#l11.599"></a><span id="l11.599" class="difflineminus">-#endif</span>
<a href="#l11.600"></a><span id="l11.600" class="difflineminus">-    }</span>
<a href="#l11.601"></a><span id="l11.601" class="difflineminus">-  }</span>
<a href="#l11.602"></a><span id="l11.602" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.603"></a><span id="l11.603" class="difflineminus">-else</span>
<a href="#l11.604"></a><span id="l11.604" class="difflineminus">-  {</span>
<a href="#l11.605"></a><span id="l11.605" class="difflineminus">-  printf(&quot;    InternetSearchDataSource::FireTimer - busy pinging.\n&quot;);</span>
<a href="#l11.606"></a><span id="l11.606" class="difflineminus">-  }</span>
<a href="#l11.607"></a><span id="l11.607" class="difflineminus">-#endif</span>
<a href="#l11.608"></a><span id="l11.608" class="difflineminus">-}</span>
<a href="#l11.609"></a><span id="l11.609" class="difflineminus">-</span>
<a href="#l11.610"></a><span id="l11.610" class="difflineminus">-</span>
<a href="#l11.611"></a><span id="l11.611" class="difflineminus">-</span>
<a href="#l11.612"></a><span id="l11.612" class="difflineminus">-PRBool</span>
<a href="#l11.613"></a><span id="l11.613" class="difflineminus">-InternetSearchDataSource::isEngineURI(nsIRDFResource *r)</span>
<a href="#l11.614"></a><span id="l11.614" class="difflineminus">-{</span>
<a href="#l11.615"></a><span id="l11.615" class="difflineminus">-  PRBool    isEngineURIFlag = PR_FALSE;</span>
<a href="#l11.616"></a><span id="l11.616" class="difflineminus">-  const char  *uri = nsnull;</span>
<a href="#l11.617"></a><span id="l11.617" class="difflineminus">-  </span>
<a href="#l11.618"></a><span id="l11.618" class="difflineminus">-  r-&gt;GetValueConst(&amp;uri);</span>
<a href="#l11.619"></a><span id="l11.619" class="difflineminus">-  if ((uri) &amp;&amp; (!strncmp(uri, kEngineProtocol, sizeof(kEngineProtocol) - 1)))</span>
<a href="#l11.620"></a><span id="l11.620" class="difflineminus">-  {</span>
<a href="#l11.621"></a><span id="l11.621" class="difflineminus">-    isEngineURIFlag = PR_TRUE;</span>
<a href="#l11.622"></a><span id="l11.622" class="difflineminus">-  }</span>
<a href="#l11.623"></a><span id="l11.623" class="difflineminus">-  return(isEngineURIFlag);</span>
<a href="#l11.624"></a><span id="l11.624" class="difflineminus">-}</span>
<a href="#l11.625"></a><span id="l11.625" class="difflineminus">-</span>
<a href="#l11.626"></a><span id="l11.626" class="difflineminus">-</span>
<a href="#l11.627"></a><span id="l11.627" class="difflineminus">-</span>
<a href="#l11.628"></a><span id="l11.628" class="difflineminus">-PRBool</span>
<a href="#l11.629"></a><span id="l11.629" class="difflineminus">-InternetSearchDataSource::isSearchURI(nsIRDFResource *r)</span>
<a href="#l11.630"></a><span id="l11.630" class="difflineminus">-{</span>
<a href="#l11.631"></a><span id="l11.631" class="difflineminus">-  PRBool    isSearchURIFlag = PR_FALSE;</span>
<a href="#l11.632"></a><span id="l11.632" class="difflineminus">-  const char  *uri = nsnull;</span>
<a href="#l11.633"></a><span id="l11.633" class="difflineminus">-  </span>
<a href="#l11.634"></a><span id="l11.634" class="difflineminus">-  r-&gt;GetValueConst(&amp;uri);</span>
<a href="#l11.635"></a><span id="l11.635" class="difflineminus">-  if ((uri) &amp;&amp; (!strncmp(uri, kSearchProtocol, sizeof(kSearchProtocol) - 1)))</span>
<a href="#l11.636"></a><span id="l11.636" class="difflineminus">-  {</span>
<a href="#l11.637"></a><span id="l11.637" class="difflineminus">-    isSearchURIFlag = PR_TRUE;</span>
<a href="#l11.638"></a><span id="l11.638" class="difflineminus">-  }</span>
<a href="#l11.639"></a><span id="l11.639" class="difflineminus">-  return(isSearchURIFlag);</span>
<a href="#l11.640"></a><span id="l11.640" class="difflineminus">-}</span>
<a href="#l11.641"></a><span id="l11.641" class="difflineminus">-</span>
<a href="#l11.642"></a><span id="l11.642" class="difflineminus">-</span>
<a href="#l11.643"></a><span id="l11.643" class="difflineminus">-</span>
<a href="#l11.644"></a><span id="l11.644" class="difflineminus">-PRBool</span>
<a href="#l11.645"></a><span id="l11.645" class="difflineminus">-InternetSearchDataSource::isSearchCategoryURI(nsIRDFResource *r)</span>
<a href="#l11.646"></a><span id="l11.646" class="difflineminus">-{</span>
<a href="#l11.647"></a><span id="l11.647" class="difflineminus">-  PRBool    isSearchCategoryURIFlag = PR_FALSE;</span>
<a href="#l11.648"></a><span id="l11.648" class="difflineminus">-  const char  *uri = nsnull;</span>
<a href="#l11.649"></a><span id="l11.649" class="difflineminus">-  </span>
<a href="#l11.650"></a><span id="l11.650" class="difflineminus">-  r-&gt;GetValueConst(&amp;uri);</span>
<a href="#l11.651"></a><span id="l11.651" class="difflineminus">-  if ((uri) &amp;&amp; (!strncmp(uri, kURINC_SearchCategoryPrefix, sizeof(kURINC_SearchCategoryPrefix) - 1)))</span>
<a href="#l11.652"></a><span id="l11.652" class="difflineminus">-  {</span>
<a href="#l11.653"></a><span id="l11.653" class="difflineminus">-    isSearchCategoryURIFlag = PR_TRUE;</span>
<a href="#l11.654"></a><span id="l11.654" class="difflineminus">-  }</span>
<a href="#l11.655"></a><span id="l11.655" class="difflineminus">-  return(isSearchCategoryURIFlag);</span>
<a href="#l11.656"></a><span id="l11.656" class="difflineminus">-}</span>
<a href="#l11.657"></a><span id="l11.657" class="difflineminus">-</span>
<a href="#l11.658"></a><span id="l11.658" class="difflineminus">-</span>
<a href="#l11.659"></a><span id="l11.659" class="difflineminus">-</span>
<a href="#l11.660"></a><span id="l11.660" class="difflineminus">-PRBool</span>
<a href="#l11.661"></a><span id="l11.661" class="difflineminus">-InternetSearchDataSource::isSearchCategoryEngineURI(nsIRDFResource *r)</span>
<a href="#l11.662"></a><span id="l11.662" class="difflineminus">-{</span>
<a href="#l11.663"></a><span id="l11.663" class="difflineminus">-  PRBool    isSearchCategoryEngineURIFlag = PR_FALSE;</span>
<a href="#l11.664"></a><span id="l11.664" class="difflineminus">-  const char  *uri = nsnull;</span>
<a href="#l11.665"></a><span id="l11.665" class="difflineminus">-  </span>
<a href="#l11.666"></a><span id="l11.666" class="difflineminus">-  r-&gt;GetValueConst(&amp;uri);</span>
<a href="#l11.667"></a><span id="l11.667" class="difflineminus">-  if ((uri) &amp;&amp; (!strncmp(uri, kURINC_SearchCategoryEnginePrefix, sizeof(kURINC_SearchCategoryEnginePrefix) - 1)))</span>
<a href="#l11.668"></a><span id="l11.668" class="difflineminus">-  {</span>
<a href="#l11.669"></a><span id="l11.669" class="difflineminus">-    isSearchCategoryEngineURIFlag = PR_TRUE;</span>
<a href="#l11.670"></a><span id="l11.670" class="difflineminus">-  }</span>
<a href="#l11.671"></a><span id="l11.671" class="difflineminus">-  return(isSearchCategoryEngineURIFlag);</span>
<a href="#l11.672"></a><span id="l11.672" class="difflineminus">-}</span>
<a href="#l11.673"></a><span id="l11.673" class="difflineminus">-</span>
<a href="#l11.674"></a><span id="l11.674" class="difflineminus">-</span>
<a href="#l11.675"></a><span id="l11.675" class="difflineminus">-</span>
<a href="#l11.676"></a><span id="l11.676" class="difflineminus">-PRBool</span>
<a href="#l11.677"></a><span id="l11.677" class="difflineminus">-InternetSearchDataSource::isSearchCommand(nsIRDFResource *r)</span>
<a href="#l11.678"></a><span id="l11.678" class="difflineminus">-{</span>
<a href="#l11.679"></a><span id="l11.679" class="difflineminus">-  PRBool    isSearchCommandFlag = PR_FALSE;</span>
<a href="#l11.680"></a><span id="l11.680" class="difflineminus">-  const char  *uri = nsnull;</span>
<a href="#l11.681"></a><span id="l11.681" class="difflineminus">-  </span>
<a href="#l11.682"></a><span id="l11.682" class="difflineminus">-  if (NS_SUCCEEDED(r-&gt;GetValueConst( &amp;uri )) &amp;&amp; (uri))</span>
<a href="#l11.683"></a><span id="l11.683" class="difflineminus">-  {</span>
<a href="#l11.684"></a><span id="l11.684" class="difflineminus">-    if (!strncmp(uri, kSearchCommand, sizeof(kSearchCommand) - 1))</span>
<a href="#l11.685"></a><span id="l11.685" class="difflineminus">-    {</span>
<a href="#l11.686"></a><span id="l11.686" class="difflineminus">-      isSearchCommandFlag = PR_TRUE;</span>
<a href="#l11.687"></a><span id="l11.687" class="difflineminus">-    }</span>
<a href="#l11.688"></a><span id="l11.688" class="difflineminus">-  }</span>
<a href="#l11.689"></a><span id="l11.689" class="difflineminus">-  return(isSearchCommandFlag);</span>
<a href="#l11.690"></a><span id="l11.690" class="difflineminus">-}</span>
<a href="#l11.691"></a><span id="l11.691" class="difflineminus">-</span>
<a href="#l11.692"></a><span id="l11.692" class="difflineminus">-</span>
<a href="#l11.693"></a><span id="l11.693" class="difflineminus">-</span>
<a href="#l11.694"></a><span id="l11.694" class="difflineminus">-nsresult</span>
<a href="#l11.695"></a><span id="l11.695" class="difflineminus">-InternetSearchDataSource::resolveSearchCategoryEngineURI(nsIRDFResource *engine, nsIRDFResource **trueEngine)</span>
<a href="#l11.696"></a><span id="l11.696" class="difflineminus">-{</span>
<a href="#l11.697"></a><span id="l11.697" class="difflineminus">-  *trueEngine = nsnull;</span>
<a href="#l11.698"></a><span id="l11.698" class="difflineminus">-</span>
<a href="#l11.699"></a><span id="l11.699" class="difflineminus">-  if ((!categoryDataSource) || (!mInner)) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.700"></a><span id="l11.700" class="difflineminus">-</span>
<a href="#l11.701"></a><span id="l11.701" class="difflineminus">-  nsresult  rv;</span>
<a href="#l11.702"></a><span id="l11.702" class="difflineminus">-  const char  *uriUni = nsnull;</span>
<a href="#l11.703"></a><span id="l11.703" class="difflineminus">-  if (NS_FAILED(rv = engine-&gt;GetValueConst(&amp;uriUni))) return(rv);</span>
<a href="#l11.704"></a><span id="l11.704" class="difflineminus">-  if (!uriUni)  return(NS_ERROR_NULL_POINTER);</span>
<a href="#l11.705"></a><span id="l11.705" class="difflineminus">-</span>
<a href="#l11.706"></a><span id="l11.706" class="difflineminus">-  NS_ConvertUTF8toUTF16 uri(uriUni);</span>
<a href="#l11.707"></a><span id="l11.707" class="difflineminus">-  if (uri.Find(kURINC_SearchCategoryEngineBasenamePrefix) !=0)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.708"></a><span id="l11.708" class="difflineminus">-</span>
<a href="#l11.709"></a><span id="l11.709" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; basenameLiteral;</span>
<a href="#l11.710"></a><span id="l11.710" class="difflineminus">-  if (NS_FAILED(rv = mRDFService-&gt;GetLiteral(uri.get(),</span>
<a href="#l11.711"></a><span id="l11.711" class="difflineminus">-      getter_AddRefs(basenameLiteral))))  return(rv);</span>
<a href="#l11.712"></a><span id="l11.712" class="difflineminus">-</span>
<a href="#l11.713"></a><span id="l11.713" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  catSrc;</span>
<a href="#l11.714"></a><span id="l11.714" class="difflineminus">-  rv = mInner-&gt;GetSource(mNC_URL, basenameLiteral, PR_TRUE, getter_AddRefs(catSrc));</span>
<a href="#l11.715"></a><span id="l11.715" class="difflineminus">-  if (NS_FAILED(rv) || (rv == NS_RDF_NO_VALUE)) return(rv);</span>
<a href="#l11.716"></a><span id="l11.716" class="difflineminus">-  if (!catSrc)    return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.717"></a><span id="l11.717" class="difflineminus">-</span>
<a href="#l11.718"></a><span id="l11.718" class="difflineminus">-  *trueEngine = catSrc;</span>
<a href="#l11.719"></a><span id="l11.719" class="difflineminus">-  NS_IF_ADDREF(*trueEngine);</span>
<a href="#l11.720"></a><span id="l11.720" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.721"></a><span id="l11.721" class="difflineminus">-}</span>
<a href="#l11.722"></a><span id="l11.722" class="difflineminus">-</span>
<a href="#l11.723"></a><span id="l11.723" class="difflineminus">-</span>
<a href="#l11.724"></a><span id="l11.724" class="difflineminus">-</span>
<a href="#l11.725"></a><span id="l11.725" class="difflineminus">-////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.726"></a><span id="l11.726" class="difflineminus">-</span>
<a href="#l11.727"></a><span id="l11.727" class="difflineminus">-NS_IMPL_CYCLE_COLLECTION_CLASS(InternetSearchDataSource)</span>
<a href="#l11.728"></a><span id="l11.728" class="difflineminus">-</span>
<a href="#l11.729"></a><span id="l11.729" class="difflineminus">-NS_IMPL_CYCLE_COLLECTION_UNLINK_BEGIN(InternetSearchDataSource)</span>
<a href="#l11.730"></a><span id="l11.730" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mRDFService)</span>
<a href="#l11.731"></a><span id="l11.731" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mRDFC)</span>
<a href="#l11.732"></a><span id="l11.732" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mInner)</span>
<a href="#l11.733"></a><span id="l11.733" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mLocalstore)</span>
<a href="#l11.734"></a><span id="l11.734" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mTimer)</span>
<a href="#l11.735"></a><span id="l11.735" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mBackgroundLoadGroup)</span>
<a href="#l11.736"></a><span id="l11.736" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mLoadGroup)</span>
<a href="#l11.737"></a><span id="l11.737" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(categoryDataSource)</span>
<a href="#l11.738"></a><span id="l11.738" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(busyResource)</span>
<a href="#l11.739"></a><span id="l11.739" class="difflineminus">-NS_IMPL_CYCLE_COLLECTION_UNLINK_END</span>
<a href="#l11.740"></a><span id="l11.740" class="difflineminus">-</span>
<a href="#l11.741"></a><span id="l11.741" class="difflineminus">-NS_IMPL_CYCLE_COLLECTION_TRAVERSE_BEGIN(InternetSearchDataSource)</span>
<a href="#l11.742"></a><span id="l11.742" class="difflineminus">-  // Skip all the RDF resources?</span>
<a href="#l11.743"></a><span id="l11.743" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mRDFService)</span>
<a href="#l11.744"></a><span id="l11.744" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mRDFC)</span>
<a href="#l11.745"></a><span id="l11.745" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mInner)</span>
<a href="#l11.746"></a><span id="l11.746" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mLocalstore)</span>
<a href="#l11.747"></a><span id="l11.747" class="difflineminus">-  // Skip mUpdateArray?  Or not?  Hard to tell...</span>
<a href="#l11.748"></a><span id="l11.748" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mTimer)</span>
<a href="#l11.749"></a><span id="l11.749" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mBackgroundLoadGroup)</span>
<a href="#l11.750"></a><span id="l11.750" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mLoadGroup)</span>
<a href="#l11.751"></a><span id="l11.751" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(categoryDataSource)</span>
<a href="#l11.752"></a><span id="l11.752" class="difflineminus">-  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(busyResource)</span>
<a href="#l11.753"></a><span id="l11.753" class="difflineminus">-NS_IMPL_CYCLE_COLLECTION_TRAVERSE_END</span>
<a href="#l11.754"></a><span id="l11.754" class="difflineminus">-</span>
<a href="#l11.755"></a><span id="l11.755" class="difflineminus">-NS_IMPL_CYCLE_COLLECTING_ADDREF_AMBIGUOUS(InternetSearchDataSource,</span>
<a href="#l11.756"></a><span id="l11.756" class="difflineminus">-                                          nsIInternetSearchService)</span>
<a href="#l11.757"></a><span id="l11.757" class="difflineminus">-NS_IMPL_CYCLE_COLLECTING_RELEASE_AMBIGUOUS(InternetSearchDataSource,</span>
<a href="#l11.758"></a><span id="l11.758" class="difflineminus">-                                           nsIInternetSearchService)</span>
<a href="#l11.759"></a><span id="l11.759" class="difflineminus">-</span>
<a href="#l11.760"></a><span id="l11.760" class="difflineminus">-NS_INTERFACE_MAP_BEGIN(InternetSearchDataSource)</span>
<a href="#l11.761"></a><span id="l11.761" class="difflineminus">-   NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIInternetSearchService)</span>
<a href="#l11.762"></a><span id="l11.762" class="difflineminus">-   NS_INTERFACE_MAP_ENTRY(nsIRequestObserver)</span>
<a href="#l11.763"></a><span id="l11.763" class="difflineminus">-   NS_INTERFACE_MAP_ENTRY(nsIStreamListener)</span>
<a href="#l11.764"></a><span id="l11.764" class="difflineminus">-   NS_INTERFACE_MAP_ENTRY(nsIInternetSearchService)</span>
<a href="#l11.765"></a><span id="l11.765" class="difflineminus">-   NS_INTERFACE_MAP_ENTRY(nsIRDFDataSource)</span>
<a href="#l11.766"></a><span id="l11.766" class="difflineminus">-   NS_INTERFACE_MAP_ENTRY(nsIObserver)</span>
<a href="#l11.767"></a><span id="l11.767" class="difflineminus">-   NS_INTERFACE_MAP_ENTRY(nsISupportsWeakReference)</span>
<a href="#l11.768"></a><span id="l11.768" class="difflineminus">-   NS_INTERFACE_MAP_ENTRIES_CYCLE_COLLECTION(InternetSearchDataSource)</span>
<a href="#l11.769"></a><span id="l11.769" class="difflineminus">-NS_INTERFACE_MAP_END</span>
<a href="#l11.770"></a><span id="l11.770" class="difflineminus">-</span>
<a href="#l11.771"></a><span id="l11.771" class="difflineminus">-</span>
<a href="#l11.772"></a><span id="l11.772" class="difflineminus">-NS_METHOD</span>
<a href="#l11.773"></a><span id="l11.773" class="difflineminus">-InternetSearchDataSource::Init()</span>
<a href="#l11.774"></a><span id="l11.774" class="difflineminus">-{</span>
<a href="#l11.775"></a><span id="l11.775" class="difflineminus">-  nsresult rv;</span>
<a href="#l11.776"></a><span id="l11.776" class="difflineminus">-</span>
<a href="#l11.777"></a><span id="l11.777" class="difflineminus">-  mInner = do_CreateInstance(NS_RDF_DATASOURCE_CONTRACTID_PREFIX &quot;in-memory-datasource&quot;);</span>
<a href="#l11.778"></a><span id="l11.778" class="difflineminus">-  NS_ENSURE_TRUE(mRDFService &amp;&amp; mInner, NS_ERROR_FAILURE);</span>
<a href="#l11.779"></a><span id="l11.779" class="difflineminus">-</span>
<a href="#l11.780"></a><span id="l11.780" class="difflineminus">-  // get localstore, as we'll be using it</span>
<a href="#l11.781"></a><span id="l11.781" class="difflineminus">-  rv = mRDFService-&gt;GetDataSource(&quot;rdf:local-store&quot;,</span>
<a href="#l11.782"></a><span id="l11.782" class="difflineminus">-                                  getter_AddRefs(mLocalstore));</span>
<a href="#l11.783"></a><span id="l11.783" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.784"></a><span id="l11.784" class="difflineminus">-</span>
<a href="#l11.785"></a><span id="l11.785" class="difflineminus">-  mUpdateArray = do_CreateInstance(NS_SUPPORTSARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l11.786"></a><span id="l11.786" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.787"></a><span id="l11.787" class="difflineminus">-</span>
<a href="#l11.788"></a><span id="l11.788" class="difflineminus">-  // register this as a named data source with the service manager</span>
<a href="#l11.789"></a><span id="l11.789" class="difflineminus">-  rv = mRDFService-&gt;RegisterDataSource(this, PR_FALSE);</span>
<a href="#l11.790"></a><span id="l11.790" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.791"></a><span id="l11.791" class="difflineminus">-</span>
<a href="#l11.792"></a><span id="l11.792" class="difflineminus">-  rv = NS_NewLoadGroup(getter_AddRefs(mLoadGroup), nsnull);</span>
<a href="#l11.793"></a><span id="l11.793" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.794"></a><span id="l11.794" class="difflineminus">-</span>
<a href="#l11.795"></a><span id="l11.795" class="difflineminus">-  busySchedule = PR_FALSE;</span>
<a href="#l11.796"></a><span id="l11.796" class="difflineminus">-  mTimer = do_CreateInstance(&quot;@mozilla.org/timer;1&quot;, &amp;rv);</span>
<a href="#l11.797"></a><span id="l11.797" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.798"></a><span id="l11.798" class="difflineminus">-</span>
<a href="#l11.799"></a><span id="l11.799" class="difflineminus">-  mTimer-&gt;InitWithFuncCallback(InternetSearchDataSource::FireTimer, this,</span>
<a href="#l11.800"></a><span id="l11.800" class="difflineminus">-                               SEARCH_UPDATE_TIMEOUT,</span>
<a href="#l11.801"></a><span id="l11.801" class="difflineminus">-                               nsITimer::TYPE_REPEATING_SLACK);</span>
<a href="#l11.802"></a><span id="l11.802" class="difflineminus">-  // Note: don't addref &quot;this&quot; as we'll cancel the timer in the</span>
<a href="#l11.803"></a><span id="l11.803" class="difflineminus">-  //       InternetSearchDataSource destructor</span>
<a href="#l11.804"></a><span id="l11.804" class="difflineminus">-</span>
<a href="#l11.805"></a><span id="l11.805" class="difflineminus">-  mEngineListBuilt = PR_FALSE;</span>
<a href="#l11.806"></a><span id="l11.806" class="difflineminus">-</span>
<a href="#l11.807"></a><span id="l11.807" class="difflineminus">-  // Register as a profile change observer</span>
<a href="#l11.808"></a><span id="l11.808" class="difflineminus">-  nsCOMPtr&lt;nsIObserverService&gt; observerService = </span>
<a href="#l11.809"></a><span id="l11.809" class="difflineminus">-           do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l11.810"></a><span id="l11.810" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.811"></a><span id="l11.811" class="difflineminus">-</span>
<a href="#l11.812"></a><span id="l11.812" class="difflineminus">-  observerService-&gt;AddObserver(this, &quot;profile-before-change&quot;, PR_TRUE);</span>
<a href="#l11.813"></a><span id="l11.813" class="difflineminus">-  observerService-&gt;AddObserver(this, &quot;profile-do-change&quot;, PR_TRUE);</span>
<a href="#l11.814"></a><span id="l11.814" class="difflineminus">-</span>
<a href="#l11.815"></a><span id="l11.815" class="difflineminus">-  return NS_OK;</span>
<a href="#l11.816"></a><span id="l11.816" class="difflineminus">-}</span>
<a href="#l11.817"></a><span id="l11.817" class="difflineminus">-</span>
<a href="#l11.818"></a><span id="l11.818" class="difflineminus">-void</span>
<a href="#l11.819"></a><span id="l11.819" class="difflineminus">-InternetSearchDataSource::DeferredInit()</span>
<a href="#l11.820"></a><span id="l11.820" class="difflineminus">-{</span>
<a href="#l11.821"></a><span id="l11.821" class="difflineminus">-  if (mEngineListBuilt)</span>
<a href="#l11.822"></a><span id="l11.822" class="difflineminus">-    return;</span>
<a href="#l11.823"></a><span id="l11.823" class="difflineminus">-</span>
<a href="#l11.824"></a><span id="l11.824" class="difflineminus">-  nsresult rv;</span>
<a href="#l11.825"></a><span id="l11.825" class="difflineminus">-</span>
<a href="#l11.826"></a><span id="l11.826" class="difflineminus">-  nsCOMPtr&lt;nsIProperties&gt; dirSvc</span>
<a href="#l11.827"></a><span id="l11.827" class="difflineminus">-    (do_GetService(NS_DIRECTORY_SERVICE_CONTRACTID));</span>
<a href="#l11.828"></a><span id="l11.828" class="difflineminus">-  if (!dirSvc)</span>
<a href="#l11.829"></a><span id="l11.829" class="difflineminus">-    return;</span>
<a href="#l11.830"></a><span id="l11.830" class="difflineminus">-</span>
<a href="#l11.831"></a><span id="l11.831" class="difflineminus">-  mEngineListBuilt = PR_TRUE;</span>
<a href="#l11.832"></a><span id="l11.832" class="difflineminus">-</span>
<a href="#l11.833"></a><span id="l11.833" class="difflineminus">-  // get available search engines</span>
<a href="#l11.834"></a><span id="l11.834" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; dirlist;</span>
<a href="#l11.835"></a><span id="l11.835" class="difflineminus">-  rv = dirSvc-&gt;Get(NS_APP_SEARCH_DIR_LIST,</span>
<a href="#l11.836"></a><span id="l11.836" class="difflineminus">-                   NS_GET_IID(nsISimpleEnumerator), getter_AddRefs(dirlist));</span>
<a href="#l11.837"></a><span id="l11.837" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l11.838"></a><span id="l11.838" class="difflineminus">-  {</span>
<a href="#l11.839"></a><span id="l11.839" class="difflineminus">-    PRBool more;</span>
<a href="#l11.840"></a><span id="l11.840" class="difflineminus">-    while (NS_SUCCEEDED(dirlist-&gt;HasMoreElements(&amp;more)) &amp;&amp; more) {</span>
<a href="#l11.841"></a><span id="l11.841" class="difflineminus">-      nsCOMPtr&lt;nsISupports&gt; suppfile;</span>
<a href="#l11.842"></a><span id="l11.842" class="difflineminus">-      nsCOMPtr&lt;nsIFile&gt; dir;</span>
<a href="#l11.843"></a><span id="l11.843" class="difflineminus">-      dirlist-&gt;GetNext(getter_AddRefs(suppfile));</span>
<a href="#l11.844"></a><span id="l11.844" class="difflineminus">-      dir = do_QueryInterface(suppfile);</span>
<a href="#l11.845"></a><span id="l11.845" class="difflineminus">-      if (dir)</span>
<a href="#l11.846"></a><span id="l11.846" class="difflineminus">-      {</span>
<a href="#l11.847"></a><span id="l11.847" class="difflineminus">-        GetSearchEngineList(dir, PR_FALSE);</span>
<a href="#l11.848"></a><span id="l11.848" class="difflineminus">-      }</span>
<a href="#l11.849"></a><span id="l11.849" class="difflineminus">-    }</span>
<a href="#l11.850"></a><span id="l11.850" class="difflineminus">-  }</span>
<a href="#l11.851"></a><span id="l11.851" class="difflineminus">-</span>
<a href="#l11.852"></a><span id="l11.852" class="difflineminus">-  // read in category list</span>
<a href="#l11.853"></a><span id="l11.853" class="difflineminus">-  GetCategoryList();</span>
<a href="#l11.854"></a><span id="l11.854" class="difflineminus">-}</span>
<a href="#l11.855"></a><span id="l11.855" class="difflineminus">-</span>
<a href="#l11.856"></a><span id="l11.856" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.857"></a><span id="l11.857" class="difflineminus">-InternetSearchDataSource::GetURI(char **uri)</span>
<a href="#l11.858"></a><span id="l11.858" class="difflineminus">-{</span>
<a href="#l11.859"></a><span id="l11.859" class="difflineminus">-  NS_PRECONDITION(uri != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.860"></a><span id="l11.860" class="difflineminus">-  if (! uri)</span>
<a href="#l11.861"></a><span id="l11.861" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.862"></a><span id="l11.862" class="difflineminus">-</span>
<a href="#l11.863"></a><span id="l11.863" class="difflineminus">-  if ((*uri = ToNewCString(NS_LITERAL_CSTRING(&quot;rdf:internetsearch&quot;))) == nsnull)</span>
<a href="#l11.864"></a><span id="l11.864" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l11.865"></a><span id="l11.865" class="difflineminus">-</span>
<a href="#l11.866"></a><span id="l11.866" class="difflineminus">-  return NS_OK;</span>
<a href="#l11.867"></a><span id="l11.867" class="difflineminus">-}</span>
<a href="#l11.868"></a><span id="l11.868" class="difflineminus">-</span>
<a href="#l11.869"></a><span id="l11.869" class="difflineminus">-</span>
<a href="#l11.870"></a><span id="l11.870" class="difflineminus">-</span>
<a href="#l11.871"></a><span id="l11.871" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.872"></a><span id="l11.872" class="difflineminus">-InternetSearchDataSource::GetSource(nsIRDFResource* property,</span>
<a href="#l11.873"></a><span id="l11.873" class="difflineminus">-                                nsIRDFNode* target,</span>
<a href="#l11.874"></a><span id="l11.874" class="difflineminus">-                                PRBool tv,</span>
<a href="#l11.875"></a><span id="l11.875" class="difflineminus">-                                nsIRDFResource** source /* out */)</span>
<a href="#l11.876"></a><span id="l11.876" class="difflineminus">-{</span>
<a href="#l11.877"></a><span id="l11.877" class="difflineminus">-  NS_PRECONDITION(property != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.878"></a><span id="l11.878" class="difflineminus">-  if (! property)</span>
<a href="#l11.879"></a><span id="l11.879" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.880"></a><span id="l11.880" class="difflineminus">-</span>
<a href="#l11.881"></a><span id="l11.881" class="difflineminus">-  NS_PRECONDITION(target != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.882"></a><span id="l11.882" class="difflineminus">-  if (! target)</span>
<a href="#l11.883"></a><span id="l11.883" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.884"></a><span id="l11.884" class="difflineminus">-</span>
<a href="#l11.885"></a><span id="l11.885" class="difflineminus">-  NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.886"></a><span id="l11.886" class="difflineminus">-  if (! source)</span>
<a href="#l11.887"></a><span id="l11.887" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.888"></a><span id="l11.888" class="difflineminus">-</span>
<a href="#l11.889"></a><span id="l11.889" class="difflineminus">-  *source = nsnull;</span>
<a href="#l11.890"></a><span id="l11.890" class="difflineminus">-  return NS_RDF_NO_VALUE;</span>
<a href="#l11.891"></a><span id="l11.891" class="difflineminus">-}</span>
<a href="#l11.892"></a><span id="l11.892" class="difflineminus">-</span>
<a href="#l11.893"></a><span id="l11.893" class="difflineminus">-</span>
<a href="#l11.894"></a><span id="l11.894" class="difflineminus">-</span>
<a href="#l11.895"></a><span id="l11.895" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.896"></a><span id="l11.896" class="difflineminus">-InternetSearchDataSource::GetSources(nsIRDFResource *property,</span>
<a href="#l11.897"></a><span id="l11.897" class="difflineminus">-                                 nsIRDFNode *target,</span>
<a href="#l11.898"></a><span id="l11.898" class="difflineminus">-                                 PRBool tv,</span>
<a href="#l11.899"></a><span id="l11.899" class="difflineminus">-                                 nsISimpleEnumerator **sources /* out */)</span>
<a href="#l11.900"></a><span id="l11.900" class="difflineminus">-{</span>
<a href="#l11.901"></a><span id="l11.901" class="difflineminus">-  nsresult  rv = NS_RDF_NO_VALUE;</span>
<a href="#l11.902"></a><span id="l11.902" class="difflineminus">-</span>
<a href="#l11.903"></a><span id="l11.903" class="difflineminus">-  if (mInner)</span>
<a href="#l11.904"></a><span id="l11.904" class="difflineminus">-  {</span>
<a href="#l11.905"></a><span id="l11.905" class="difflineminus">-    rv = mInner-&gt;GetSources(property, target, tv, sources);</span>
<a href="#l11.906"></a><span id="l11.906" class="difflineminus">-  }</span>
<a href="#l11.907"></a><span id="l11.907" class="difflineminus">-  else</span>
<a href="#l11.908"></a><span id="l11.908" class="difflineminus">-  {</span>
<a href="#l11.909"></a><span id="l11.909" class="difflineminus">-    rv = NS_NewEmptyEnumerator(sources);</span>
<a href="#l11.910"></a><span id="l11.910" class="difflineminus">-  }</span>
<a href="#l11.911"></a><span id="l11.911" class="difflineminus">-  return(rv);</span>
<a href="#l11.912"></a><span id="l11.912" class="difflineminus">-}</span>
<a href="#l11.913"></a><span id="l11.913" class="difflineminus">-</span>
<a href="#l11.914"></a><span id="l11.914" class="difflineminus">-</span>
<a href="#l11.915"></a><span id="l11.915" class="difflineminus">-</span>
<a href="#l11.916"></a><span id="l11.916" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.917"></a><span id="l11.917" class="difflineminus">-InternetSearchDataSource::GetTarget(nsIRDFResource *source,</span>
<a href="#l11.918"></a><span id="l11.918" class="difflineminus">-                                nsIRDFResource *property,</span>
<a href="#l11.919"></a><span id="l11.919" class="difflineminus">-                                PRBool tv,</span>
<a href="#l11.920"></a><span id="l11.920" class="difflineminus">-                                nsIRDFNode **target /* out */)</span>
<a href="#l11.921"></a><span id="l11.921" class="difflineminus">-{</span>
<a href="#l11.922"></a><span id="l11.922" class="difflineminus">-  NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.923"></a><span id="l11.923" class="difflineminus">-  if (! source)</span>
<a href="#l11.924"></a><span id="l11.924" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.925"></a><span id="l11.925" class="difflineminus">-</span>
<a href="#l11.926"></a><span id="l11.926" class="difflineminus">-  NS_PRECONDITION(property != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.927"></a><span id="l11.927" class="difflineminus">-  if (! property)</span>
<a href="#l11.928"></a><span id="l11.928" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.929"></a><span id="l11.929" class="difflineminus">-</span>
<a href="#l11.930"></a><span id="l11.930" class="difflineminus">-  NS_PRECONDITION(target != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.931"></a><span id="l11.931" class="difflineminus">-  if (! target)</span>
<a href="#l11.932"></a><span id="l11.932" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.933"></a><span id="l11.933" class="difflineminus">-</span>
<a href="#l11.934"></a><span id="l11.934" class="difflineminus">-  *target = nsnull;</span>
<a href="#l11.935"></a><span id="l11.935" class="difflineminus">-</span>
<a href="#l11.936"></a><span id="l11.936" class="difflineminus">-  nsresult    rv = NS_RDF_NO_VALUE;</span>
<a href="#l11.937"></a><span id="l11.937" class="difflineminus">-</span>
<a href="#l11.938"></a><span id="l11.938" class="difflineminus">-  // we only have positive assertions in the internet search data source.</span>
<a href="#l11.939"></a><span id="l11.939" class="difflineminus">-  if (! tv)</span>
<a href="#l11.940"></a><span id="l11.940" class="difflineminus">-    return(rv);</span>
<a href="#l11.941"></a><span id="l11.941" class="difflineminus">-</span>
<a href="#l11.942"></a><span id="l11.942" class="difflineminus">-  if ((isSearchCategoryURI(source)) &amp;&amp; (categoryDataSource))</span>
<a href="#l11.943"></a><span id="l11.943" class="difflineminus">-  {</span>
<a href="#l11.944"></a><span id="l11.944" class="difflineminus">-    rv = categoryDataSource-&gt;GetTarget(source, property, tv, target);</span>
<a href="#l11.945"></a><span id="l11.945" class="difflineminus">-    return(rv);</span>
<a href="#l11.946"></a><span id="l11.946" class="difflineminus">-  }</span>
<a href="#l11.947"></a><span id="l11.947" class="difflineminus">-</span>
<a href="#l11.948"></a><span id="l11.948" class="difflineminus">-  if (isSearchCategoryEngineURI(source))</span>
<a href="#l11.949"></a><span id="l11.949" class="difflineminus">-  {</span>
<a href="#l11.950"></a><span id="l11.950" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt;  trueEngine;</span>
<a href="#l11.951"></a><span id="l11.951" class="difflineminus">-    rv = resolveSearchCategoryEngineURI(source, getter_AddRefs(trueEngine));</span>
<a href="#l11.952"></a><span id="l11.952" class="difflineminus">-    if (NS_FAILED(rv) || (rv == NS_RDF_NO_VALUE)) return(rv);</span>
<a href="#l11.953"></a><span id="l11.953" class="difflineminus">-    if (!trueEngine)  return(NS_RDF_NO_VALUE);</span>
<a href="#l11.954"></a><span id="l11.954" class="difflineminus">-</span>
<a href="#l11.955"></a><span id="l11.955" class="difflineminus">-    source = trueEngine;</span>
<a href="#l11.956"></a><span id="l11.956" class="difflineminus">-  }</span>
<a href="#l11.957"></a><span id="l11.957" class="difflineminus">-</span>
<a href="#l11.958"></a><span id="l11.958" class="difflineminus">-  if (isSearchURI(source) &amp;&amp; (property == mNC_Child))</span>
<a href="#l11.959"></a><span id="l11.959" class="difflineminus">-  {</span>
<a href="#l11.960"></a><span id="l11.960" class="difflineminus">-    // fake out the generic builder (i.e. return anything in this case)</span>
<a href="#l11.961"></a><span id="l11.961" class="difflineminus">-    // so that search containers never appear to be empty</span>
<a href="#l11.962"></a><span id="l11.962" class="difflineminus">-    *target = source;</span>
<a href="#l11.963"></a><span id="l11.963" class="difflineminus">-    NS_ADDREF(source);</span>
<a href="#l11.964"></a><span id="l11.964" class="difflineminus">-    return(NS_OK);</span>
<a href="#l11.965"></a><span id="l11.965" class="difflineminus">-  }</span>
<a href="#l11.966"></a><span id="l11.966" class="difflineminus">-</span>
<a href="#l11.967"></a><span id="l11.967" class="difflineminus">-  if (isSearchCommand(source) &amp;&amp; (property == mNC_Name))</span>
<a href="#l11.968"></a><span id="l11.968" class="difflineminus">-  {</span>
<a href="#l11.969"></a><span id="l11.969" class="difflineminus">-    nsresult rv;</span>
<a href="#l11.970"></a><span id="l11.970" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt;</span>
<a href="#l11.971"></a><span id="l11.971" class="difflineminus">-    stringService(do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv));</span>
<a href="#l11.972"></a><span id="l11.972" class="difflineminus">-</span>
<a href="#l11.973"></a><span id="l11.973" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; stringService) {</span>
<a href="#l11.974"></a><span id="l11.974" class="difflineminus">-</span>
<a href="#l11.975"></a><span id="l11.975" class="difflineminus">-      nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l11.976"></a><span id="l11.976" class="difflineminus">-      rv = stringService-&gt;CreateBundle(SEARCH_PROPERTIES, getter_AddRefs(bundle));</span>
<a href="#l11.977"></a><span id="l11.977" class="difflineminus">-      if (NS_SUCCEEDED(rv) &amp;&amp; bundle) {</span>
<a href="#l11.978"></a><span id="l11.978" class="difflineminus">-</span>
<a href="#l11.979"></a><span id="l11.979" class="difflineminus">-        nsString valUni;</span>
<a href="#l11.980"></a><span id="l11.980" class="difflineminus">-        nsAutoString name;</span>
<a href="#l11.981"></a><span id="l11.981" class="difflineminus">-</span>
<a href="#l11.982"></a><span id="l11.982" class="difflineminus">-        if (source == mNC_SearchCommand_AddToBookmarks)</span>
<a href="#l11.983"></a><span id="l11.983" class="difflineminus">-          name.AssignLiteral(&quot;addtobookmarks&quot;);</span>
<a href="#l11.984"></a><span id="l11.984" class="difflineminus">-        else if (source == mNC_SearchCommand_AddQueryToBookmarks)</span>
<a href="#l11.985"></a><span id="l11.985" class="difflineminus">-          name.AssignLiteral(&quot;addquerytobookmarks&quot;);</span>
<a href="#l11.986"></a><span id="l11.986" class="difflineminus">-        else if (source == mNC_SearchCommand_FilterResult)</span>
<a href="#l11.987"></a><span id="l11.987" class="difflineminus">-          name.AssignLiteral(&quot;excludeurl&quot;);</span>
<a href="#l11.988"></a><span id="l11.988" class="difflineminus">-        else if (source == mNC_SearchCommand_FilterSite)</span>
<a href="#l11.989"></a><span id="l11.989" class="difflineminus">-          name.AssignLiteral(&quot;excludedomain&quot;);</span>
<a href="#l11.990"></a><span id="l11.990" class="difflineminus">-        else if (source == mNC_SearchCommand_ClearFilters)</span>
<a href="#l11.991"></a><span id="l11.991" class="difflineminus">-          name.AssignLiteral(&quot;clearfilters&quot;);</span>
<a href="#l11.992"></a><span id="l11.992" class="difflineminus">-</span>
<a href="#l11.993"></a><span id="l11.993" class="difflineminus">-        rv = bundle-&gt;GetStringFromName(name.get(), getter_Copies(valUni));</span>
<a href="#l11.994"></a><span id="l11.994" class="difflineminus">-        if (NS_SUCCEEDED(rv) &amp;&amp; !valUni.IsEmpty()) {</span>
<a href="#l11.995"></a><span id="l11.995" class="difflineminus">-          *target = nsnull;</span>
<a href="#l11.996"></a><span id="l11.996" class="difflineminus">-          nsCOMPtr&lt;nsIRDFLiteral&gt; literal;</span>
<a href="#l11.997"></a><span id="l11.997" class="difflineminus">-          if (NS_FAILED(rv = mRDFService-&gt;GetLiteral(valUni.get(), getter_AddRefs(literal))))</span>
<a href="#l11.998"></a><span id="l11.998" class="difflineminus">-            return rv;</span>
<a href="#l11.999"></a><span id="l11.999" class="difflineminus">-          *target = literal;</span>
<a href="#l11.1000"></a><span id="l11.1000" class="difflineminus">-          NS_IF_ADDREF(*target);</span>
<a href="#l11.1001"></a><span id="l11.1001" class="difflineminus">-          return rv;</span>
<a href="#l11.1002"></a><span id="l11.1002" class="difflineminus">-        }</span>
<a href="#l11.1003"></a><span id="l11.1003" class="difflineminus">-      }</span>
<a href="#l11.1004"></a><span id="l11.1004" class="difflineminus">-    }</span>
<a href="#l11.1005"></a><span id="l11.1005" class="difflineminus">-  }</span>
<a href="#l11.1006"></a><span id="l11.1006" class="difflineminus">-</span>
<a href="#l11.1007"></a><span id="l11.1007" class="difflineminus">-  if (isEngineURI(source))</span>
<a href="#l11.1008"></a><span id="l11.1008" class="difflineminus">-  {</span>
<a href="#l11.1009"></a><span id="l11.1009" class="difflineminus">-    // if we're asking for info on a search engine, (deferred) load it if needed</span>
<a href="#l11.1010"></a><span id="l11.1010" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; dataLit;</span>
<a href="#l11.1011"></a><span id="l11.1011" class="difflineminus">-    FindData(source, getter_AddRefs(dataLit));</span>
<a href="#l11.1012"></a><span id="l11.1012" class="difflineminus">-  }</span>
<a href="#l11.1013"></a><span id="l11.1013" class="difflineminus">-</span>
<a href="#l11.1014"></a><span id="l11.1014" class="difflineminus">-  if (mInner)</span>
<a href="#l11.1015"></a><span id="l11.1015" class="difflineminus">-  {</span>
<a href="#l11.1016"></a><span id="l11.1016" class="difflineminus">-    rv = mInner-&gt;GetTarget(source, property, tv, target);</span>
<a href="#l11.1017"></a><span id="l11.1017" class="difflineminus">-  }</span>
<a href="#l11.1018"></a><span id="l11.1018" class="difflineminus">-</span>
<a href="#l11.1019"></a><span id="l11.1019" class="difflineminus">-  return(rv);</span>
<a href="#l11.1020"></a><span id="l11.1020" class="difflineminus">-}</span>
<a href="#l11.1021"></a><span id="l11.1021" class="difflineminus">-</span>
<a href="#l11.1022"></a><span id="l11.1022" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1023"></a><span id="l11.1023" class="difflineminus">-InternetSearchDataSource::GetTargets(nsIRDFResource *source,</span>
<a href="#l11.1024"></a><span id="l11.1024" class="difflineminus">-                           nsIRDFResource *property,</span>
<a href="#l11.1025"></a><span id="l11.1025" class="difflineminus">-                           PRBool tv,</span>
<a href="#l11.1026"></a><span id="l11.1026" class="difflineminus">-                           nsISimpleEnumerator **targets /* out */)</span>
<a href="#l11.1027"></a><span id="l11.1027" class="difflineminus">-{</span>
<a href="#l11.1028"></a><span id="l11.1028" class="difflineminus">-  NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.1029"></a><span id="l11.1029" class="difflineminus">-  if (! source)</span>
<a href="#l11.1030"></a><span id="l11.1030" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.1031"></a><span id="l11.1031" class="difflineminus">-</span>
<a href="#l11.1032"></a><span id="l11.1032" class="difflineminus">-  NS_PRECONDITION(property != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.1033"></a><span id="l11.1033" class="difflineminus">-  if (! property)</span>
<a href="#l11.1034"></a><span id="l11.1034" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.1035"></a><span id="l11.1035" class="difflineminus">-</span>
<a href="#l11.1036"></a><span id="l11.1036" class="difflineminus">-  NS_PRECONDITION(targets != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.1037"></a><span id="l11.1037" class="difflineminus">-  if (! targets)</span>
<a href="#l11.1038"></a><span id="l11.1038" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.1039"></a><span id="l11.1039" class="difflineminus">-</span>
<a href="#l11.1040"></a><span id="l11.1040" class="difflineminus">-  nsresult rv = NS_RDF_NO_VALUE;</span>
<a href="#l11.1041"></a><span id="l11.1041" class="difflineminus">-</span>
<a href="#l11.1042"></a><span id="l11.1042" class="difflineminus">-  // we only have positive assertions in the internet search data source.</span>
<a href="#l11.1043"></a><span id="l11.1043" class="difflineminus">-  if (! tv)</span>
<a href="#l11.1044"></a><span id="l11.1044" class="difflineminus">-    return(rv);</span>
<a href="#l11.1045"></a><span id="l11.1045" class="difflineminus">-</span>
<a href="#l11.1046"></a><span id="l11.1046" class="difflineminus">-  if ((isSearchCategoryURI(source)) &amp;&amp; (categoryDataSource))</span>
<a href="#l11.1047"></a><span id="l11.1047" class="difflineminus">-  {</span>
<a href="#l11.1048"></a><span id="l11.1048" class="difflineminus">-    rv = categoryDataSource-&gt;GetTargets(source, property, tv, targets);</span>
<a href="#l11.1049"></a><span id="l11.1049" class="difflineminus">-    return(rv);</span>
<a href="#l11.1050"></a><span id="l11.1050" class="difflineminus">-  }</span>
<a href="#l11.1051"></a><span id="l11.1051" class="difflineminus">-</span>
<a href="#l11.1052"></a><span id="l11.1052" class="difflineminus">-  if (isSearchCategoryEngineURI(source))</span>
<a href="#l11.1053"></a><span id="l11.1053" class="difflineminus">-  {</span>
<a href="#l11.1054"></a><span id="l11.1054" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt;  trueEngine;</span>
<a href="#l11.1055"></a><span id="l11.1055" class="difflineminus">-    rv = resolveSearchCategoryEngineURI(source, getter_AddRefs(trueEngine));</span>
<a href="#l11.1056"></a><span id="l11.1056" class="difflineminus">-    if (NS_FAILED(rv) || (rv == NS_RDF_NO_VALUE)) return(rv);</span>
<a href="#l11.1057"></a><span id="l11.1057" class="difflineminus">-    if (!trueEngine)  return(NS_RDF_NO_VALUE);</span>
<a href="#l11.1058"></a><span id="l11.1058" class="difflineminus">-</span>
<a href="#l11.1059"></a><span id="l11.1059" class="difflineminus">-    source = trueEngine;</span>
<a href="#l11.1060"></a><span id="l11.1060" class="difflineminus">-  }</span>
<a href="#l11.1061"></a><span id="l11.1061" class="difflineminus">-</span>
<a href="#l11.1062"></a><span id="l11.1062" class="difflineminus">-  if (mInner)</span>
<a href="#l11.1063"></a><span id="l11.1063" class="difflineminus">-  { </span>
<a href="#l11.1064"></a><span id="l11.1064" class="difflineminus">-    // defer search engine discovery until needed; small startup time improvement</span>
<a href="#l11.1065"></a><span id="l11.1065" class="difflineminus">-    if ((source == mNC_SearchEngineRoot || isSearchURI(source)) &amp;&amp;</span>
<a href="#l11.1066"></a><span id="l11.1066" class="difflineminus">-        property == mNC_Child &amp;&amp; !mEngineListBuilt)</span>
<a href="#l11.1067"></a><span id="l11.1067" class="difflineminus">-    {</span>
<a href="#l11.1068"></a><span id="l11.1068" class="difflineminus">-      DeferredInit();</span>
<a href="#l11.1069"></a><span id="l11.1069" class="difflineminus">-    }</span>
<a href="#l11.1070"></a><span id="l11.1070" class="difflineminus">-</span>
<a href="#l11.1071"></a><span id="l11.1071" class="difflineminus">-    rv = mInner-&gt;GetTargets(source, property, tv, targets);</span>
<a href="#l11.1072"></a><span id="l11.1072" class="difflineminus">-  }</span>
<a href="#l11.1073"></a><span id="l11.1073" class="difflineminus">-  if (isSearchURI(source))</span>
<a href="#l11.1074"></a><span id="l11.1074" class="difflineminus">-  {</span>
<a href="#l11.1075"></a><span id="l11.1075" class="difflineminus">-    if (property == mNC_Child)</span>
<a href="#l11.1076"></a><span id="l11.1076" class="difflineminus">-    {</span>
<a href="#l11.1077"></a><span id="l11.1077" class="difflineminus">-      PRBool    doNetworkRequest = PR_TRUE;</span>
<a href="#l11.1078"></a><span id="l11.1078" class="difflineminus">-      if (NS_SUCCEEDED(rv) &amp;&amp; (targets))</span>
<a href="#l11.1079"></a><span id="l11.1079" class="difflineminus">-      {</span>
<a href="#l11.1080"></a><span id="l11.1080" class="difflineminus">-        // check and see if we already have data for the search in question;</span>
<a href="#l11.1081"></a><span id="l11.1081" class="difflineminus">-        // if we do, BeginSearchRequest() won't bother doing the search again,</span>
<a href="#l11.1082"></a><span id="l11.1082" class="difflineminus">-        // otherwise it will kickstart it</span>
<a href="#l11.1083"></a><span id="l11.1083" class="difflineminus">-        PRBool    hasResults = PR_FALSE;</span>
<a href="#l11.1084"></a><span id="l11.1084" class="difflineminus">-        if (NS_SUCCEEDED((*targets)-&gt;HasMoreElements(&amp;hasResults)) &amp;&amp;</span>
<a href="#l11.1085"></a><span id="l11.1085" class="difflineminus">-            hasResults)</span>
<a href="#l11.1086"></a><span id="l11.1086" class="difflineminus">-        {</span>
<a href="#l11.1087"></a><span id="l11.1087" class="difflineminus">-          doNetworkRequest = PR_FALSE;</span>
<a href="#l11.1088"></a><span id="l11.1088" class="difflineminus">-        }</span>
<a href="#l11.1089"></a><span id="l11.1089" class="difflineminus">-      }</span>
<a href="#l11.1090"></a><span id="l11.1090" class="difflineminus">-      BeginSearchRequest(source, doNetworkRequest);</span>
<a href="#l11.1091"></a><span id="l11.1091" class="difflineminus">-    }</span>
<a href="#l11.1092"></a><span id="l11.1092" class="difflineminus">-  }</span>
<a href="#l11.1093"></a><span id="l11.1093" class="difflineminus">-  return(rv);</span>
<a href="#l11.1094"></a><span id="l11.1094" class="difflineminus">-}</span>
<a href="#l11.1095"></a><span id="l11.1095" class="difflineminus">-</span>
<a href="#l11.1096"></a><span id="l11.1096" class="difflineminus">-</span>
<a href="#l11.1097"></a><span id="l11.1097" class="difflineminus">-</span>
<a href="#l11.1098"></a><span id="l11.1098" class="difflineminus">-nsresult</span>
<a href="#l11.1099"></a><span id="l11.1099" class="difflineminus">-InternetSearchDataSource::GetCategoryList()</span>
<a href="#l11.1100"></a><span id="l11.1100" class="difflineminus">-{</span>
<a href="#l11.1101"></a><span id="l11.1101" class="difflineminus">-  nsresult rv;</span>
<a href="#l11.1102"></a><span id="l11.1102" class="difflineminus">-</span>
<a href="#l11.1103"></a><span id="l11.1103" class="difflineminus">-  categoryDataSource =</span>
<a href="#l11.1104"></a><span id="l11.1104" class="difflineminus">-    do_CreateInstance(NS_RDF_DATASOURCE_CONTRACTID_PREFIX &quot;xml-datasource&quot;);</span>
<a href="#l11.1105"></a><span id="l11.1105" class="difflineminus">-  NS_ENSURE_TRUE(categoryDataSource, NS_ERROR_FAILURE);</span>
<a href="#l11.1106"></a><span id="l11.1106" class="difflineminus">-</span>
<a href="#l11.1107"></a><span id="l11.1107" class="difflineminus">-  nsCOMPtr&lt;nsIRDFRemoteDataSource&gt; remoteCategoryDataSource (do_QueryInterface(categoryDataSource));</span>
<a href="#l11.1108"></a><span id="l11.1108" class="difflineminus">-  if (!remoteCategoryDataSource)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1109"></a><span id="l11.1109" class="difflineminus">-</span>
<a href="#l11.1110"></a><span id="l11.1110" class="difflineminus">-  // get search.rdf</span>
<a href="#l11.1111"></a><span id="l11.1111" class="difflineminus">-    </span>
<a href="#l11.1112"></a><span id="l11.1112" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; searchFile;</span>
<a href="#l11.1113"></a><span id="l11.1113" class="difflineminus">-  nsCAutoString searchFileURLSpec;</span>
<a href="#l11.1114"></a><span id="l11.1114" class="difflineminus">-</span>
<a href="#l11.1115"></a><span id="l11.1115" class="difflineminus">-  rv = NS_GetSpecialDirectory(NS_APP_SEARCH_50_FILE, getter_AddRefs(searchFile));</span>
<a href="#l11.1116"></a><span id="l11.1116" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.1117"></a><span id="l11.1117" class="difflineminus">-  NS_GetURLSpecFromFile(searchFile, searchFileURLSpec);</span>
<a href="#l11.1118"></a><span id="l11.1118" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.1119"></a><span id="l11.1119" class="difflineminus">-  rv = remoteCategoryDataSource-&gt;Init(searchFileURLSpec.get());</span>
<a href="#l11.1120"></a><span id="l11.1120" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.1121"></a><span id="l11.1121" class="difflineminus">-    </span>
<a href="#l11.1122"></a><span id="l11.1122" class="difflineminus">-  // synchronous read</span>
<a href="#l11.1123"></a><span id="l11.1123" class="difflineminus">-  rv = remoteCategoryDataSource-&gt;Refresh(PR_TRUE);</span>
<a href="#l11.1124"></a><span id="l11.1124" class="difflineminus">-  if (NS_FAILED(rv))  return(rv);</span>
<a href="#l11.1125"></a><span id="l11.1125" class="difflineminus">-</span>
<a href="#l11.1126"></a><span id="l11.1126" class="difflineminus">-  // ensure that all search engine references actually exist; if not, forget about them</span>
<a href="#l11.1127"></a><span id="l11.1127" class="difflineminus">-</span>
<a href="#l11.1128"></a><span id="l11.1128" class="difflineminus">-  PRBool        isDirtyFlag = PR_FALSE;</span>
<a href="#l11.1129"></a><span id="l11.1129" class="difflineminus">-  nsCOMPtr&lt;nsIRDFContainer&gt;   categoryRoot;</span>
<a href="#l11.1130"></a><span id="l11.1130" class="difflineminus">-  rv = mRDFC-&gt;MakeSeq(categoryDataSource, mNC_SearchCategoryRoot, getter_AddRefs(categoryRoot));</span>
<a href="#l11.1131"></a><span id="l11.1131" class="difflineminus">-  if (NS_FAILED(rv))  return(rv);</span>
<a href="#l11.1132"></a><span id="l11.1132" class="difflineminus">-  if (!categoryRoot)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1133"></a><span id="l11.1133" class="difflineminus">-</span>
<a href="#l11.1134"></a><span id="l11.1134" class="difflineminus">-  rv = categoryRoot-&gt;Init(categoryDataSource, mNC_SearchCategoryRoot);</span>
<a href="#l11.1135"></a><span id="l11.1135" class="difflineminus">-  if (NS_FAILED(rv))  return(rv);</span>
<a href="#l11.1136"></a><span id="l11.1136" class="difflineminus">-</span>
<a href="#l11.1137"></a><span id="l11.1137" class="difflineminus">-  PRInt32   numCategories = 0;</span>
<a href="#l11.1138"></a><span id="l11.1138" class="difflineminus">-  rv = categoryRoot-&gt;GetCount(&amp;numCategories);</span>
<a href="#l11.1139"></a><span id="l11.1139" class="difflineminus">-  if (NS_FAILED(rv))  return(rv);</span>
<a href="#l11.1140"></a><span id="l11.1140" class="difflineminus">-</span>
<a href="#l11.1141"></a><span id="l11.1141" class="difflineminus">-  // Note: one-based</span>
<a href="#l11.1142"></a><span id="l11.1142" class="difflineminus">-  for (PRInt32 catLoop=1; catLoop &lt;= numCategories; catLoop++)</span>
<a href="#l11.1143"></a><span id="l11.1143" class="difflineminus">-  {</span>
<a href="#l11.1144"></a><span id="l11.1144" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt;  aCategoryOrdinal;</span>
<a href="#l11.1145"></a><span id="l11.1145" class="difflineminus">-    rv = mRDFC-&gt;IndexToOrdinalResource(catLoop,</span>
<a href="#l11.1146"></a><span id="l11.1146" class="difflineminus">-      getter_AddRefs(aCategoryOrdinal));</span>
<a href="#l11.1147"></a><span id="l11.1147" class="difflineminus">-    if (NS_FAILED(rv))  break;</span>
<a href="#l11.1148"></a><span id="l11.1148" class="difflineminus">-    if (!aCategoryOrdinal)  break;</span>
<a href="#l11.1149"></a><span id="l11.1149" class="difflineminus">-</span>
<a href="#l11.1150"></a><span id="l11.1150" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt;    aCategoryNode;</span>
<a href="#l11.1151"></a><span id="l11.1151" class="difflineminus">-    rv = categoryDataSource-&gt;GetTarget(mNC_SearchCategoryRoot, aCategoryOrdinal,</span>
<a href="#l11.1152"></a><span id="l11.1152" class="difflineminus">-      PR_TRUE, getter_AddRefs(aCategoryNode));</span>
<a href="#l11.1153"></a><span id="l11.1153" class="difflineminus">-    if (NS_FAILED(rv))  break;</span>
<a href="#l11.1154"></a><span id="l11.1154" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt; aCategoryRes (do_QueryInterface(aCategoryNode));</span>
<a href="#l11.1155"></a><span id="l11.1155" class="difflineminus">-    if (!aCategoryRes)  break;</span>
<a href="#l11.1156"></a><span id="l11.1156" class="difflineminus">-    const char      *catResURI = nsnull;</span>
<a href="#l11.1157"></a><span id="l11.1157" class="difflineminus">-    aCategoryRes-&gt;GetValueConst(&amp;catResURI);</span>
<a href="#l11.1158"></a><span id="l11.1158" class="difflineminus">-    if (!catResURI)   break;</span>
<a href="#l11.1159"></a><span id="l11.1159" class="difflineminus">-    nsCAutoString    categoryStr;</span>
<a href="#l11.1160"></a><span id="l11.1160" class="difflineminus">-    categoryStr.AssignLiteral(kURINC_SearchCategoryPrefix);</span>
<a href="#l11.1161"></a><span id="l11.1161" class="difflineminus">-    categoryStr.Append(catResURI);</span>
<a href="#l11.1162"></a><span id="l11.1162" class="difflineminus">-</span>
<a href="#l11.1163"></a><span id="l11.1163" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt;  searchCategoryRes;</span>
<a href="#l11.1164"></a><span id="l11.1164" class="difflineminus">-    rv = mRDFService-&gt;GetResource(categoryStr, getter_AddRefs(searchCategoryRes));</span>
<a href="#l11.1165"></a><span id="l11.1165" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l11.1166"></a><span id="l11.1166" class="difflineminus">-      break; </span>
<a href="#l11.1167"></a><span id="l11.1167" class="difflineminus">-</span>
<a href="#l11.1168"></a><span id="l11.1168" class="difflineminus">-    nsCOMPtr&lt;nsIRDFContainer&gt; categoryContainer;</span>
<a href="#l11.1169"></a><span id="l11.1169" class="difflineminus">-    rv = mRDFC-&gt;MakeSeq(categoryDataSource, searchCategoryRes,</span>
<a href="#l11.1170"></a><span id="l11.1170" class="difflineminus">-      getter_AddRefs(categoryContainer));</span>
<a href="#l11.1171"></a><span id="l11.1171" class="difflineminus">-    if (NS_FAILED(rv))  continue;</span>
<a href="#l11.1172"></a><span id="l11.1172" class="difflineminus">-</span>
<a href="#l11.1173"></a><span id="l11.1173" class="difflineminus">-    rv = categoryContainer-&gt;Init(categoryDataSource, searchCategoryRes);</span>
<a href="#l11.1174"></a><span id="l11.1174" class="difflineminus">-    if (NS_FAILED(rv))  return(rv);</span>
<a href="#l11.1175"></a><span id="l11.1175" class="difflineminus">-</span>
<a href="#l11.1176"></a><span id="l11.1176" class="difflineminus">-    PRInt32   numEngines = 0;</span>
<a href="#l11.1177"></a><span id="l11.1177" class="difflineminus">-    rv = categoryContainer-&gt;GetCount(&amp;numEngines);</span>
<a href="#l11.1178"></a><span id="l11.1178" class="difflineminus">-    if (NS_FAILED(rv))  break;</span>
<a href="#l11.1179"></a><span id="l11.1179" class="difflineminus">-</span>
<a href="#l11.1180"></a><span id="l11.1180" class="difflineminus">-    // Note: one-based, and loop backwards as we might be removing entries</span>
<a href="#l11.1181"></a><span id="l11.1181" class="difflineminus">-    for (PRInt32 engineLoop=numEngines; engineLoop &gt;= 1; engineLoop--)</span>
<a href="#l11.1182"></a><span id="l11.1182" class="difflineminus">-    {</span>
<a href="#l11.1183"></a><span id="l11.1183" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt;  aEngineOrdinal;</span>
<a href="#l11.1184"></a><span id="l11.1184" class="difflineminus">-      rv = mRDFC-&gt;IndexToOrdinalResource(engineLoop,</span>
<a href="#l11.1185"></a><span id="l11.1185" class="difflineminus">-        getter_AddRefs(aEngineOrdinal));</span>
<a href="#l11.1186"></a><span id="l11.1186" class="difflineminus">-      if (NS_FAILED(rv))  break;</span>
<a href="#l11.1187"></a><span id="l11.1187" class="difflineminus">-      if (!aEngineOrdinal)  break;</span>
<a href="#l11.1188"></a><span id="l11.1188" class="difflineminus">-</span>
<a href="#l11.1189"></a><span id="l11.1189" class="difflineminus">-      nsCOMPtr&lt;nsIRDFNode&gt;    aEngineNode;</span>
<a href="#l11.1190"></a><span id="l11.1190" class="difflineminus">-      rv = categoryDataSource-&gt;GetTarget(searchCategoryRes, aEngineOrdinal,</span>
<a href="#l11.1191"></a><span id="l11.1191" class="difflineminus">-        PR_TRUE, getter_AddRefs(aEngineNode));</span>
<a href="#l11.1192"></a><span id="l11.1192" class="difflineminus">-      if (NS_FAILED(rv))  break;</span>
<a href="#l11.1193"></a><span id="l11.1193" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt; aEngineRes (do_QueryInterface(aEngineNode));</span>
<a href="#l11.1194"></a><span id="l11.1194" class="difflineminus">-      if (!aEngineRes)  break;</span>
<a href="#l11.1195"></a><span id="l11.1195" class="difflineminus">-</span>
<a href="#l11.1196"></a><span id="l11.1196" class="difflineminus">-      if (isSearchCategoryEngineURI(aEngineRes))</span>
<a href="#l11.1197"></a><span id="l11.1197" class="difflineminus">-      {</span>
<a href="#l11.1198"></a><span id="l11.1198" class="difflineminus">-        nsCOMPtr&lt;nsIRDFResource&gt;  trueEngine;</span>
<a href="#l11.1199"></a><span id="l11.1199" class="difflineminus">-        rv = resolveSearchCategoryEngineURI(aEngineRes,</span>
<a href="#l11.1200"></a><span id="l11.1200" class="difflineminus">-          getter_AddRefs(trueEngine));</span>
<a href="#l11.1201"></a><span id="l11.1201" class="difflineminus">-        if (NS_FAILED(rv) || (!trueEngine))</span>
<a href="#l11.1202"></a><span id="l11.1202" class="difflineminus">-        {</span>
<a href="#l11.1203"></a><span id="l11.1203" class="difflineminus">-          // unable to resolve, so forget about this engine reference</span>
<a href="#l11.1204"></a><span id="l11.1204" class="difflineminus">-#ifdef  DEBUG</span>
<a href="#l11.1205"></a><span id="l11.1205" class="difflineminus">-          const char    *catEngineURI = nsnull;</span>
<a href="#l11.1206"></a><span id="l11.1206" class="difflineminus">-          aEngineRes-&gt;GetValueConst(&amp;catEngineURI);</span>
<a href="#l11.1207"></a><span id="l11.1207" class="difflineminus">-          if (catEngineURI)</span>
<a href="#l11.1208"></a><span id="l11.1208" class="difflineminus">-          {</span>
<a href="#l11.1209"></a><span id="l11.1209" class="difflineminus">-            printf(&quot;**** Stale search engine reference to '%s'\n&quot;,</span>
<a href="#l11.1210"></a><span id="l11.1210" class="difflineminus">-              catEngineURI);</span>
<a href="#l11.1211"></a><span id="l11.1211" class="difflineminus">-          }</span>
<a href="#l11.1212"></a><span id="l11.1212" class="difflineminus">-#endif</span>
<a href="#l11.1213"></a><span id="l11.1213" class="difflineminus">-          nsCOMPtr&lt;nsIRDFNode&gt;  staleCatEngine;</span>
<a href="#l11.1214"></a><span id="l11.1214" class="difflineminus">-          rv = categoryContainer-&gt;RemoveElementAt(engineLoop, PR_TRUE,</span>
<a href="#l11.1215"></a><span id="l11.1215" class="difflineminus">-            getter_AddRefs(staleCatEngine));</span>
<a href="#l11.1216"></a><span id="l11.1216" class="difflineminus">-          isDirtyFlag = PR_TRUE;</span>
<a href="#l11.1217"></a><span id="l11.1217" class="difflineminus">-        }</span>
<a href="#l11.1218"></a><span id="l11.1218" class="difflineminus">-      }</span>
<a href="#l11.1219"></a><span id="l11.1219" class="difflineminus">-    }</span>
<a href="#l11.1220"></a><span id="l11.1220" class="difflineminus">-  }</span>
<a href="#l11.1221"></a><span id="l11.1221" class="difflineminus">-</span>
<a href="#l11.1222"></a><span id="l11.1222" class="difflineminus">-  if (isDirtyFlag)</span>
<a href="#l11.1223"></a><span id="l11.1223" class="difflineminus">-  {</span>
<a href="#l11.1224"></a><span id="l11.1224" class="difflineminus">-    if (remoteCategoryDataSource)</span>
<a href="#l11.1225"></a><span id="l11.1225" class="difflineminus">-    {</span>
<a href="#l11.1226"></a><span id="l11.1226" class="difflineminus">-      remoteCategoryDataSource-&gt;Flush();</span>
<a href="#l11.1227"></a><span id="l11.1227" class="difflineminus">-    }</span>
<a href="#l11.1228"></a><span id="l11.1228" class="difflineminus">-  }</span>
<a href="#l11.1229"></a><span id="l11.1229" class="difflineminus">-</span>
<a href="#l11.1230"></a><span id="l11.1230" class="difflineminus">-  return(rv);</span>
<a href="#l11.1231"></a><span id="l11.1231" class="difflineminus">-}</span>
<a href="#l11.1232"></a><span id="l11.1232" class="difflineminus">-</span>
<a href="#l11.1233"></a><span id="l11.1233" class="difflineminus">-</span>
<a href="#l11.1234"></a><span id="l11.1234" class="difflineminus">-</span>
<a href="#l11.1235"></a><span id="l11.1235" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1236"></a><span id="l11.1236" class="difflineminus">-InternetSearchDataSource::Assert(nsIRDFResource *source,</span>
<a href="#l11.1237"></a><span id="l11.1237" class="difflineminus">-                       nsIRDFResource *property,</span>
<a href="#l11.1238"></a><span id="l11.1238" class="difflineminus">-                       nsIRDFNode *target,</span>
<a href="#l11.1239"></a><span id="l11.1239" class="difflineminus">-                       PRBool tv)</span>
<a href="#l11.1240"></a><span id="l11.1240" class="difflineminus">-{</span>
<a href="#l11.1241"></a><span id="l11.1241" class="difflineminus">-  nsresult  rv = NS_RDF_ASSERTION_REJECTED;</span>
<a href="#l11.1242"></a><span id="l11.1242" class="difflineminus">-</span>
<a href="#l11.1243"></a><span id="l11.1243" class="difflineminus">-  // we only have positive assertions in the internet search data source.</span>
<a href="#l11.1244"></a><span id="l11.1244" class="difflineminus">-  if (! tv)</span>
<a href="#l11.1245"></a><span id="l11.1245" class="difflineminus">-    return(rv);</span>
<a href="#l11.1246"></a><span id="l11.1246" class="difflineminus">-</span>
<a href="#l11.1247"></a><span id="l11.1247" class="difflineminus">-  if (mInner)</span>
<a href="#l11.1248"></a><span id="l11.1248" class="difflineminus">-  {</span>
<a href="#l11.1249"></a><span id="l11.1249" class="difflineminus">-    rv = mInner-&gt;Assert(source, property, target, tv);</span>
<a href="#l11.1250"></a><span id="l11.1250" class="difflineminus">-  }</span>
<a href="#l11.1251"></a><span id="l11.1251" class="difflineminus">-  return(rv);</span>
<a href="#l11.1252"></a><span id="l11.1252" class="difflineminus">-}</span>
<a href="#l11.1253"></a><span id="l11.1253" class="difflineminus">-</span>
<a href="#l11.1254"></a><span id="l11.1254" class="difflineminus">-</span>
<a href="#l11.1255"></a><span id="l11.1255" class="difflineminus">-</span>
<a href="#l11.1256"></a><span id="l11.1256" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1257"></a><span id="l11.1257" class="difflineminus">-InternetSearchDataSource::Unassert(nsIRDFResource *source,</span>
<a href="#l11.1258"></a><span id="l11.1258" class="difflineminus">-                         nsIRDFResource *property,</span>
<a href="#l11.1259"></a><span id="l11.1259" class="difflineminus">-                         nsIRDFNode *target)</span>
<a href="#l11.1260"></a><span id="l11.1260" class="difflineminus">-{</span>
<a href="#l11.1261"></a><span id="l11.1261" class="difflineminus">-  nsresult  rv = NS_RDF_ASSERTION_REJECTED;</span>
<a href="#l11.1262"></a><span id="l11.1262" class="difflineminus">-</span>
<a href="#l11.1263"></a><span id="l11.1263" class="difflineminus">-  if (mInner)</span>
<a href="#l11.1264"></a><span id="l11.1264" class="difflineminus">-  {</span>
<a href="#l11.1265"></a><span id="l11.1265" class="difflineminus">-    rv = mInner-&gt;Unassert(source, property, target);</span>
<a href="#l11.1266"></a><span id="l11.1266" class="difflineminus">-  }</span>
<a href="#l11.1267"></a><span id="l11.1267" class="difflineminus">-  return(rv);</span>
<a href="#l11.1268"></a><span id="l11.1268" class="difflineminus">-}</span>
<a href="#l11.1269"></a><span id="l11.1269" class="difflineminus">-</span>
<a href="#l11.1270"></a><span id="l11.1270" class="difflineminus">-</span>
<a href="#l11.1271"></a><span id="l11.1271" class="difflineminus">-</span>
<a href="#l11.1272"></a><span id="l11.1272" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1273"></a><span id="l11.1273" class="difflineminus">-InternetSearchDataSource::Change(nsIRDFResource *source,</span>
<a href="#l11.1274"></a><span id="l11.1274" class="difflineminus">-      nsIRDFResource *property,</span>
<a href="#l11.1275"></a><span id="l11.1275" class="difflineminus">-      nsIRDFNode *oldTarget,</span>
<a href="#l11.1276"></a><span id="l11.1276" class="difflineminus">-      nsIRDFNode *newTarget)</span>
<a href="#l11.1277"></a><span id="l11.1277" class="difflineminus">-{</span>
<a href="#l11.1278"></a><span id="l11.1278" class="difflineminus">-  nsresult  rv = NS_RDF_ASSERTION_REJECTED;</span>
<a href="#l11.1279"></a><span id="l11.1279" class="difflineminus">-</span>
<a href="#l11.1280"></a><span id="l11.1280" class="difflineminus">-  if (mInner)</span>
<a href="#l11.1281"></a><span id="l11.1281" class="difflineminus">-  {</span>
<a href="#l11.1282"></a><span id="l11.1282" class="difflineminus">-    rv = mInner-&gt;Change(source, property, oldTarget, newTarget);</span>
<a href="#l11.1283"></a><span id="l11.1283" class="difflineminus">-  }</span>
<a href="#l11.1284"></a><span id="l11.1284" class="difflineminus">-  return(rv);</span>
<a href="#l11.1285"></a><span id="l11.1285" class="difflineminus">-}</span>
<a href="#l11.1286"></a><span id="l11.1286" class="difflineminus">-</span>
<a href="#l11.1287"></a><span id="l11.1287" class="difflineminus">-</span>
<a href="#l11.1288"></a><span id="l11.1288" class="difflineminus">-</span>
<a href="#l11.1289"></a><span id="l11.1289" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1290"></a><span id="l11.1290" class="difflineminus">-InternetSearchDataSource::Move(nsIRDFResource *oldSource,</span>
<a href="#l11.1291"></a><span id="l11.1291" class="difflineminus">-             nsIRDFResource *newSource,</span>
<a href="#l11.1292"></a><span id="l11.1292" class="difflineminus">-             nsIRDFResource *property,</span>
<a href="#l11.1293"></a><span id="l11.1293" class="difflineminus">-             nsIRDFNode *target)</span>
<a href="#l11.1294"></a><span id="l11.1294" class="difflineminus">-{</span>
<a href="#l11.1295"></a><span id="l11.1295" class="difflineminus">-  nsresult  rv = NS_RDF_ASSERTION_REJECTED;</span>
<a href="#l11.1296"></a><span id="l11.1296" class="difflineminus">-</span>
<a href="#l11.1297"></a><span id="l11.1297" class="difflineminus">-  if (mInner)</span>
<a href="#l11.1298"></a><span id="l11.1298" class="difflineminus">-  {</span>
<a href="#l11.1299"></a><span id="l11.1299" class="difflineminus">-    rv = mInner-&gt;Move(oldSource, newSource, property, target);</span>
<a href="#l11.1300"></a><span id="l11.1300" class="difflineminus">-  }</span>
<a href="#l11.1301"></a><span id="l11.1301" class="difflineminus">-  return(rv);</span>
<a href="#l11.1302"></a><span id="l11.1302" class="difflineminus">-}</span>
<a href="#l11.1303"></a><span id="l11.1303" class="difflineminus">-</span>
<a href="#l11.1304"></a><span id="l11.1304" class="difflineminus">-</span>
<a href="#l11.1305"></a><span id="l11.1305" class="difflineminus">-</span>
<a href="#l11.1306"></a><span id="l11.1306" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1307"></a><span id="l11.1307" class="difflineminus">-InternetSearchDataSource::HasAssertion(nsIRDFResource *source,</span>
<a href="#l11.1308"></a><span id="l11.1308" class="difflineminus">-                             nsIRDFResource *property,</span>
<a href="#l11.1309"></a><span id="l11.1309" class="difflineminus">-                             nsIRDFNode *target,</span>
<a href="#l11.1310"></a><span id="l11.1310" class="difflineminus">-                             PRBool tv,</span>
<a href="#l11.1311"></a><span id="l11.1311" class="difflineminus">-                             PRBool *hasAssertion /* out */)</span>
<a href="#l11.1312"></a><span id="l11.1312" class="difflineminus">-{</span>
<a href="#l11.1313"></a><span id="l11.1313" class="difflineminus">-  NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.1314"></a><span id="l11.1314" class="difflineminus">-  if (! source)</span>
<a href="#l11.1315"></a><span id="l11.1315" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.1316"></a><span id="l11.1316" class="difflineminus">-</span>
<a href="#l11.1317"></a><span id="l11.1317" class="difflineminus">-  NS_PRECONDITION(property != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.1318"></a><span id="l11.1318" class="difflineminus">-  if (! property)</span>
<a href="#l11.1319"></a><span id="l11.1319" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.1320"></a><span id="l11.1320" class="difflineminus">-</span>
<a href="#l11.1321"></a><span id="l11.1321" class="difflineminus">-  NS_PRECONDITION(target != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.1322"></a><span id="l11.1322" class="difflineminus">-  if (! target)</span>
<a href="#l11.1323"></a><span id="l11.1323" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.1324"></a><span id="l11.1324" class="difflineminus">-</span>
<a href="#l11.1325"></a><span id="l11.1325" class="difflineminus">-  NS_PRECONDITION(hasAssertion != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.1326"></a><span id="l11.1326" class="difflineminus">-  if (! hasAssertion)</span>
<a href="#l11.1327"></a><span id="l11.1327" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.1328"></a><span id="l11.1328" class="difflineminus">-</span>
<a href="#l11.1329"></a><span id="l11.1329" class="difflineminus">-  *hasAssertion = PR_FALSE;</span>
<a href="#l11.1330"></a><span id="l11.1330" class="difflineminus">-</span>
<a href="#l11.1331"></a><span id="l11.1331" class="difflineminus">-  // we only have positive assertions in the internet search data source.</span>
<a href="#l11.1332"></a><span id="l11.1332" class="difflineminus">-  if (! tv)</span>
<a href="#l11.1333"></a><span id="l11.1333" class="difflineminus">-  {</span>
<a href="#l11.1334"></a><span id="l11.1334" class="difflineminus">-    return NS_OK;</span>
<a href="#l11.1335"></a><span id="l11.1335" class="difflineminus">-        }</span>
<a href="#l11.1336"></a><span id="l11.1336" class="difflineminus">-        nsresult  rv = NS_RDF_NO_VALUE;</span>
<a href="#l11.1337"></a><span id="l11.1337" class="difflineminus">-        </span>
<a href="#l11.1338"></a><span id="l11.1338" class="difflineminus">-        if (mInner)</span>
<a href="#l11.1339"></a><span id="l11.1339" class="difflineminus">-        {</span>
<a href="#l11.1340"></a><span id="l11.1340" class="difflineminus">-    rv = mInner-&gt;HasAssertion(source, property, target, tv, hasAssertion);</span>
<a href="#l11.1341"></a><span id="l11.1341" class="difflineminus">-  }</span>
<a href="#l11.1342"></a><span id="l11.1342" class="difflineminus">-        return(rv);</span>
<a href="#l11.1343"></a><span id="l11.1343" class="difflineminus">-}</span>
<a href="#l11.1344"></a><span id="l11.1344" class="difflineminus">-</span>
<a href="#l11.1345"></a><span id="l11.1345" class="difflineminus">-NS_IMETHODIMP </span>
<a href="#l11.1346"></a><span id="l11.1346" class="difflineminus">-InternetSearchDataSource::HasArcIn(nsIRDFNode *aNode, nsIRDFResource *aArc, PRBool *result)</span>
<a href="#l11.1347"></a><span id="l11.1347" class="difflineminus">-{</span>
<a href="#l11.1348"></a><span id="l11.1348" class="difflineminus">-    if (mInner) {</span>
<a href="#l11.1349"></a><span id="l11.1349" class="difflineminus">-  return mInner-&gt;HasArcIn(aNode, aArc, result);</span>
<a href="#l11.1350"></a><span id="l11.1350" class="difflineminus">-    }</span>
<a href="#l11.1351"></a><span id="l11.1351" class="difflineminus">-    else {</span>
<a href="#l11.1352"></a><span id="l11.1352" class="difflineminus">-  *result = PR_FALSE;</span>
<a href="#l11.1353"></a><span id="l11.1353" class="difflineminus">-    }</span>
<a href="#l11.1354"></a><span id="l11.1354" class="difflineminus">-    return NS_OK;</span>
<a href="#l11.1355"></a><span id="l11.1355" class="difflineminus">-}</span>
<a href="#l11.1356"></a><span id="l11.1356" class="difflineminus">-</span>
<a href="#l11.1357"></a><span id="l11.1357" class="difflineminus">-NS_IMETHODIMP </span>
<a href="#l11.1358"></a><span id="l11.1358" class="difflineminus">-InternetSearchDataSource::HasArcOut(nsIRDFResource *source, nsIRDFResource *aArc, PRBool *result)</span>
<a href="#l11.1359"></a><span id="l11.1359" class="difflineminus">-{</span>
<a href="#l11.1360"></a><span id="l11.1360" class="difflineminus">-    NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.1361"></a><span id="l11.1361" class="difflineminus">-    if (! source)</span>
<a href="#l11.1362"></a><span id="l11.1362" class="difflineminus">-  return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.1363"></a><span id="l11.1363" class="difflineminus">-</span>
<a href="#l11.1364"></a><span id="l11.1364" class="difflineminus">-    nsresult rv;</span>
<a href="#l11.1365"></a><span id="l11.1365" class="difflineminus">-</span>
<a href="#l11.1366"></a><span id="l11.1366" class="difflineminus">-    if ((source == mNC_SearchEngineRoot) || (source == mNC_LastSearchRoot) || isSearchURI(source))</span>
<a href="#l11.1367"></a><span id="l11.1367" class="difflineminus">-    {</span>
<a href="#l11.1368"></a><span id="l11.1368" class="difflineminus">-  *result = (aArc == mNC_Child);</span>
<a href="#l11.1369"></a><span id="l11.1369" class="difflineminus">-  return NS_OK;</span>
<a href="#l11.1370"></a><span id="l11.1370" class="difflineminus">-    }</span>
<a href="#l11.1371"></a><span id="l11.1371" class="difflineminus">-</span>
<a href="#l11.1372"></a><span id="l11.1372" class="difflineminus">-    if ((isSearchCategoryURI(source)) &amp;&amp; (categoryDataSource))</span>
<a href="#l11.1373"></a><span id="l11.1373" class="difflineminus">-    {</span>
<a href="#l11.1374"></a><span id="l11.1374" class="difflineminus">-  const char  *uri = nsnull;</span>
<a href="#l11.1375"></a><span id="l11.1375" class="difflineminus">-  source-&gt;GetValueConst(&amp;uri);</span>
<a href="#l11.1376"></a><span id="l11.1376" class="difflineminus">-  if (!uri) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1377"></a><span id="l11.1377" class="difflineminus">-</span>
<a href="#l11.1378"></a><span id="l11.1378" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  category;</span>
<a href="#l11.1379"></a><span id="l11.1379" class="difflineminus">-  if (NS_FAILED(rv = mRDFService-&gt;GetResource(nsDependentCString(uri),</span>
<a href="#l11.1380"></a><span id="l11.1380" class="difflineminus">-                getter_AddRefs(category))))</span>
<a href="#l11.1381"></a><span id="l11.1381" class="difflineminus">-      return(rv);</span>
<a href="#l11.1382"></a><span id="l11.1382" class="difflineminus">-</span>
<a href="#l11.1383"></a><span id="l11.1383" class="difflineminus">-  return categoryDataSource-&gt;HasArcOut(source, aArc, result);</span>
<a href="#l11.1384"></a><span id="l11.1384" class="difflineminus">-    }</span>
<a href="#l11.1385"></a><span id="l11.1385" class="difflineminus">-</span>
<a href="#l11.1386"></a><span id="l11.1386" class="difflineminus">-    if (isSearchCategoryEngineURI(source))</span>
<a href="#l11.1387"></a><span id="l11.1387" class="difflineminus">-    {</span>
<a href="#l11.1388"></a><span id="l11.1388" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  trueEngine;</span>
<a href="#l11.1389"></a><span id="l11.1389" class="difflineminus">-  rv = resolveSearchCategoryEngineURI(source, getter_AddRefs(trueEngine));</span>
<a href="#l11.1390"></a><span id="l11.1390" class="difflineminus">-  if (NS_FAILED(rv) || (rv == NS_RDF_NO_VALUE)) return(rv);</span>
<a href="#l11.1391"></a><span id="l11.1391" class="difflineminus">-  if (!trueEngine) {</span>
<a href="#l11.1392"></a><span id="l11.1392" class="difflineminus">-      *result = PR_FALSE;</span>
<a href="#l11.1393"></a><span id="l11.1393" class="difflineminus">-      return NS_OK;</span>
<a href="#l11.1394"></a><span id="l11.1394" class="difflineminus">-  }</span>
<a href="#l11.1395"></a><span id="l11.1395" class="difflineminus">-  source = trueEngine;</span>
<a href="#l11.1396"></a><span id="l11.1396" class="difflineminus">-    }</span>
<a href="#l11.1397"></a><span id="l11.1397" class="difflineminus">-</span>
<a href="#l11.1398"></a><span id="l11.1398" class="difflineminus">-    if (isEngineURI(source))</span>
<a href="#l11.1399"></a><span id="l11.1399" class="difflineminus">-    {</span>
<a href="#l11.1400"></a><span id="l11.1400" class="difflineminus">-  // if we're asking for info on a search engine, (deferred) load it if needed</span>
<a href="#l11.1401"></a><span id="l11.1401" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; dataLit;</span>
<a href="#l11.1402"></a><span id="l11.1402" class="difflineminus">-  FindData(source, getter_AddRefs(dataLit));</span>
<a href="#l11.1403"></a><span id="l11.1403" class="difflineminus">-    }</span>
<a href="#l11.1404"></a><span id="l11.1404" class="difflineminus">-</span>
<a href="#l11.1405"></a><span id="l11.1405" class="difflineminus">-    if (mInner)</span>
<a href="#l11.1406"></a><span id="l11.1406" class="difflineminus">-    {</span>
<a href="#l11.1407"></a><span id="l11.1407" class="difflineminus">-  return mInner-&gt;HasArcOut(source, aArc, result);</span>
<a href="#l11.1408"></a><span id="l11.1408" class="difflineminus">-    }</span>
<a href="#l11.1409"></a><span id="l11.1409" class="difflineminus">-</span>
<a href="#l11.1410"></a><span id="l11.1410" class="difflineminus">-    *result = PR_FALSE;</span>
<a href="#l11.1411"></a><span id="l11.1411" class="difflineminus">-    return NS_OK;</span>
<a href="#l11.1412"></a><span id="l11.1412" class="difflineminus">-}</span>
<a href="#l11.1413"></a><span id="l11.1413" class="difflineminus">-</span>
<a href="#l11.1414"></a><span id="l11.1414" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1415"></a><span id="l11.1415" class="difflineminus">-InternetSearchDataSource::ArcLabelsIn(nsIRDFNode *node,</span>
<a href="#l11.1416"></a><span id="l11.1416" class="difflineminus">-                            nsISimpleEnumerator ** labels /* out */)</span>
<a href="#l11.1417"></a><span id="l11.1417" class="difflineminus">-{</span>
<a href="#l11.1418"></a><span id="l11.1418" class="difflineminus">-  nsresult  rv;</span>
<a href="#l11.1419"></a><span id="l11.1419" class="difflineminus">-</span>
<a href="#l11.1420"></a><span id="l11.1420" class="difflineminus">-  if (mInner)</span>
<a href="#l11.1421"></a><span id="l11.1421" class="difflineminus">-  {</span>
<a href="#l11.1422"></a><span id="l11.1422" class="difflineminus">-    rv = mInner-&gt;ArcLabelsIn(node, labels);</span>
<a href="#l11.1423"></a><span id="l11.1423" class="difflineminus">-    return(rv);</span>
<a href="#l11.1424"></a><span id="l11.1424" class="difflineminus">-  }</span>
<a href="#l11.1425"></a><span id="l11.1425" class="difflineminus">-  else</span>
<a href="#l11.1426"></a><span id="l11.1426" class="difflineminus">-  {</span>
<a href="#l11.1427"></a><span id="l11.1427" class="difflineminus">-    rv = NS_NewEmptyEnumerator(labels);</span>
<a href="#l11.1428"></a><span id="l11.1428" class="difflineminus">-  }</span>
<a href="#l11.1429"></a><span id="l11.1429" class="difflineminus">-  return(rv);</span>
<a href="#l11.1430"></a><span id="l11.1430" class="difflineminus">-}</span>
<a href="#l11.1431"></a><span id="l11.1431" class="difflineminus">-</span>
<a href="#l11.1432"></a><span id="l11.1432" class="difflineminus">-</span>
<a href="#l11.1433"></a><span id="l11.1433" class="difflineminus">-</span>
<a href="#l11.1434"></a><span id="l11.1434" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1435"></a><span id="l11.1435" class="difflineminus">-InternetSearchDataSource::ArcLabelsOut(nsIRDFResource *source,</span>
<a href="#l11.1436"></a><span id="l11.1436" class="difflineminus">-                             nsISimpleEnumerator **labels /* out */)</span>
<a href="#l11.1437"></a><span id="l11.1437" class="difflineminus">-{</span>
<a href="#l11.1438"></a><span id="l11.1438" class="difflineminus">-  NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.1439"></a><span id="l11.1439" class="difflineminus">-  if (! source)</span>
<a href="#l11.1440"></a><span id="l11.1440" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.1441"></a><span id="l11.1441" class="difflineminus">-</span>
<a href="#l11.1442"></a><span id="l11.1442" class="difflineminus">-  NS_PRECONDITION(labels != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.1443"></a><span id="l11.1443" class="difflineminus">-  if (! labels)</span>
<a href="#l11.1444"></a><span id="l11.1444" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l11.1445"></a><span id="l11.1445" class="difflineminus">-</span>
<a href="#l11.1446"></a><span id="l11.1446" class="difflineminus">-  nsresult rv;</span>
<a href="#l11.1447"></a><span id="l11.1447" class="difflineminus">-</span>
<a href="#l11.1448"></a><span id="l11.1448" class="difflineminus">-  if ((source == mNC_SearchEngineRoot) || (source == mNC_LastSearchRoot) || isSearchURI(source))</span>
<a href="#l11.1449"></a><span id="l11.1449" class="difflineminus">-  {</span>
<a href="#l11.1450"></a><span id="l11.1450" class="difflineminus">-            nsCOMPtr&lt;nsISupportsArray&gt; array(do_CreateInstance(NS_SUPPORTSARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l11.1451"></a><span id="l11.1451" class="difflineminus">-            if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.1452"></a><span id="l11.1452" class="difflineminus">-</span>
<a href="#l11.1453"></a><span id="l11.1453" class="difflineminus">-            array-&gt;AppendElement(mNC_Child);</span>
<a href="#l11.1454"></a><span id="l11.1454" class="difflineminus">-</span>
<a href="#l11.1455"></a><span id="l11.1455" class="difflineminus">-            return NS_NewArrayEnumerator(labels, array);</span>
<a href="#l11.1456"></a><span id="l11.1456" class="difflineminus">-  }</span>
<a href="#l11.1457"></a><span id="l11.1457" class="difflineminus">-</span>
<a href="#l11.1458"></a><span id="l11.1458" class="difflineminus">-  if ((isSearchCategoryURI(source)) &amp;&amp; (categoryDataSource))</span>
<a href="#l11.1459"></a><span id="l11.1459" class="difflineminus">-  {</span>
<a href="#l11.1460"></a><span id="l11.1460" class="difflineminus">-    const char  *uri = nsnull;</span>
<a href="#l11.1461"></a><span id="l11.1461" class="difflineminus">-    source-&gt;GetValueConst(&amp;uri);</span>
<a href="#l11.1462"></a><span id="l11.1462" class="difflineminus">-    if (!uri) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1463"></a><span id="l11.1463" class="difflineminus">-</span>
<a href="#l11.1464"></a><span id="l11.1464" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt;  category;</span>
<a href="#l11.1465"></a><span id="l11.1465" class="difflineminus">-    if (NS_FAILED(rv = mRDFService-&gt;GetResource(nsDependentCString(uri),</span>
<a href="#l11.1466"></a><span id="l11.1466" class="difflineminus">-      getter_AddRefs(category))))</span>
<a href="#l11.1467"></a><span id="l11.1467" class="difflineminus">-      return(rv);</span>
<a href="#l11.1468"></a><span id="l11.1468" class="difflineminus">-</span>
<a href="#l11.1469"></a><span id="l11.1469" class="difflineminus">-    rv = categoryDataSource-&gt;ArcLabelsOut(category, labels);</span>
<a href="#l11.1470"></a><span id="l11.1470" class="difflineminus">-    return(rv);</span>
<a href="#l11.1471"></a><span id="l11.1471" class="difflineminus">-  }</span>
<a href="#l11.1472"></a><span id="l11.1472" class="difflineminus">-</span>
<a href="#l11.1473"></a><span id="l11.1473" class="difflineminus">-  if (isSearchCategoryEngineURI(source))</span>
<a href="#l11.1474"></a><span id="l11.1474" class="difflineminus">-  {</span>
<a href="#l11.1475"></a><span id="l11.1475" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt;  trueEngine;</span>
<a href="#l11.1476"></a><span id="l11.1476" class="difflineminus">-    rv = resolveSearchCategoryEngineURI(source, getter_AddRefs(trueEngine));</span>
<a href="#l11.1477"></a><span id="l11.1477" class="difflineminus">-    if (NS_FAILED(rv) || (rv == NS_RDF_NO_VALUE)) return(rv);</span>
<a href="#l11.1478"></a><span id="l11.1478" class="difflineminus">-    if (!trueEngine)  return(NS_RDF_NO_VALUE);</span>
<a href="#l11.1479"></a><span id="l11.1479" class="difflineminus">-</span>
<a href="#l11.1480"></a><span id="l11.1480" class="difflineminus">-    source = trueEngine;</span>
<a href="#l11.1481"></a><span id="l11.1481" class="difflineminus">-  }</span>
<a href="#l11.1482"></a><span id="l11.1482" class="difflineminus">-</span>
<a href="#l11.1483"></a><span id="l11.1483" class="difflineminus">-  if (isEngineURI(source))</span>
<a href="#l11.1484"></a><span id="l11.1484" class="difflineminus">-  {</span>
<a href="#l11.1485"></a><span id="l11.1485" class="difflineminus">-    // if we're asking for info on a search engine, (deferred) load it if needed</span>
<a href="#l11.1486"></a><span id="l11.1486" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; dataLit;</span>
<a href="#l11.1487"></a><span id="l11.1487" class="difflineminus">-    FindData(source, getter_AddRefs(dataLit));</span>
<a href="#l11.1488"></a><span id="l11.1488" class="difflineminus">-  }</span>
<a href="#l11.1489"></a><span id="l11.1489" class="difflineminus">-</span>
<a href="#l11.1490"></a><span id="l11.1490" class="difflineminus">-  if (mInner)</span>
<a href="#l11.1491"></a><span id="l11.1491" class="difflineminus">-  {</span>
<a href="#l11.1492"></a><span id="l11.1492" class="difflineminus">-    rv = mInner-&gt;ArcLabelsOut(source, labels);</span>
<a href="#l11.1493"></a><span id="l11.1493" class="difflineminus">-    return(rv);</span>
<a href="#l11.1494"></a><span id="l11.1494" class="difflineminus">-  }</span>
<a href="#l11.1495"></a><span id="l11.1495" class="difflineminus">-</span>
<a href="#l11.1496"></a><span id="l11.1496" class="difflineminus">-  return NS_NewEmptyEnumerator(labels);</span>
<a href="#l11.1497"></a><span id="l11.1497" class="difflineminus">-}</span>
<a href="#l11.1498"></a><span id="l11.1498" class="difflineminus">-</span>
<a href="#l11.1499"></a><span id="l11.1499" class="difflineminus">-</span>
<a href="#l11.1500"></a><span id="l11.1500" class="difflineminus">-</span>
<a href="#l11.1501"></a><span id="l11.1501" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1502"></a><span id="l11.1502" class="difflineminus">-InternetSearchDataSource::GetAllResources(nsISimpleEnumerator** aCursor)</span>
<a href="#l11.1503"></a><span id="l11.1503" class="difflineminus">-{</span>
<a href="#l11.1504"></a><span id="l11.1504" class="difflineminus">-  nsresult  rv = NS_RDF_NO_VALUE;</span>
<a href="#l11.1505"></a><span id="l11.1505" class="difflineminus">-</span>
<a href="#l11.1506"></a><span id="l11.1506" class="difflineminus">-  if (mInner)</span>
<a href="#l11.1507"></a><span id="l11.1507" class="difflineminus">-  {</span>
<a href="#l11.1508"></a><span id="l11.1508" class="difflineminus">-    rv = mInner-&gt;GetAllResources(aCursor);</span>
<a href="#l11.1509"></a><span id="l11.1509" class="difflineminus">-  }</span>
<a href="#l11.1510"></a><span id="l11.1510" class="difflineminus">-  return(rv);</span>
<a href="#l11.1511"></a><span id="l11.1511" class="difflineminus">-}</span>
<a href="#l11.1512"></a><span id="l11.1512" class="difflineminus">-</span>
<a href="#l11.1513"></a><span id="l11.1513" class="difflineminus">-</span>
<a href="#l11.1514"></a><span id="l11.1514" class="difflineminus">-</span>
<a href="#l11.1515"></a><span id="l11.1515" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1516"></a><span id="l11.1516" class="difflineminus">-InternetSearchDataSource::AddObserver(nsIRDFObserver *aObserver)</span>
<a href="#l11.1517"></a><span id="l11.1517" class="difflineminus">-{</span>
<a href="#l11.1518"></a><span id="l11.1518" class="difflineminus">-  nsresult  rv = NS_OK;</span>
<a href="#l11.1519"></a><span id="l11.1519" class="difflineminus">-</span>
<a href="#l11.1520"></a><span id="l11.1520" class="difflineminus">-  if (mInner)</span>
<a href="#l11.1521"></a><span id="l11.1521" class="difflineminus">-  {</span>
<a href="#l11.1522"></a><span id="l11.1522" class="difflineminus">-    rv = mInner-&gt;AddObserver(aObserver);</span>
<a href="#l11.1523"></a><span id="l11.1523" class="difflineminus">-  }</span>
<a href="#l11.1524"></a><span id="l11.1524" class="difflineminus">-  return(rv);</span>
<a href="#l11.1525"></a><span id="l11.1525" class="difflineminus">-}</span>
<a href="#l11.1526"></a><span id="l11.1526" class="difflineminus">-</span>
<a href="#l11.1527"></a><span id="l11.1527" class="difflineminus">-</span>
<a href="#l11.1528"></a><span id="l11.1528" class="difflineminus">-</span>
<a href="#l11.1529"></a><span id="l11.1529" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1530"></a><span id="l11.1530" class="difflineminus">-InternetSearchDataSource::RemoveObserver(nsIRDFObserver *aObserver)</span>
<a href="#l11.1531"></a><span id="l11.1531" class="difflineminus">-{</span>
<a href="#l11.1532"></a><span id="l11.1532" class="difflineminus">-  nsresult  rv = NS_OK;</span>
<a href="#l11.1533"></a><span id="l11.1533" class="difflineminus">-</span>
<a href="#l11.1534"></a><span id="l11.1534" class="difflineminus">-  if (mInner)</span>
<a href="#l11.1535"></a><span id="l11.1535" class="difflineminus">-  {</span>
<a href="#l11.1536"></a><span id="l11.1536" class="difflineminus">-    rv = mInner-&gt;RemoveObserver(aObserver);</span>
<a href="#l11.1537"></a><span id="l11.1537" class="difflineminus">-  }</span>
<a href="#l11.1538"></a><span id="l11.1538" class="difflineminus">-  return(rv);</span>
<a href="#l11.1539"></a><span id="l11.1539" class="difflineminus">-}</span>
<a href="#l11.1540"></a><span id="l11.1540" class="difflineminus">-</span>
<a href="#l11.1541"></a><span id="l11.1541" class="difflineminus">-</span>
<a href="#l11.1542"></a><span id="l11.1542" class="difflineminus">-</span>
<a href="#l11.1543"></a><span id="l11.1543" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1544"></a><span id="l11.1544" class="difflineminus">-InternetSearchDataSource::GetAllCmds(nsIRDFResource* source,</span>
<a href="#l11.1545"></a><span id="l11.1545" class="difflineminus">-                                     nsISimpleEnumerator/*&lt;nsIRDFResource&gt;*/** commands)</span>
<a href="#l11.1546"></a><span id="l11.1546" class="difflineminus">-{</span>
<a href="#l11.1547"></a><span id="l11.1547" class="difflineminus">-  nsresult      rv;</span>
<a href="#l11.1548"></a><span id="l11.1548" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; cmdArray(do_CreateInstance(NS_SUPPORTSARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l11.1549"></a><span id="l11.1549" class="difflineminus">-  if (NS_FAILED(rv))  return(rv);</span>
<a href="#l11.1550"></a><span id="l11.1550" class="difflineminus">-</span>
<a href="#l11.1551"></a><span id="l11.1551" class="difflineminus">-  // check if we have any filters, enable command to clear them</span>
<a href="#l11.1552"></a><span id="l11.1552" class="difflineminus">-  PRBool        haveFilters = PR_FALSE;</span>
<a href="#l11.1553"></a><span id="l11.1553" class="difflineminus">-</span>
<a href="#l11.1554"></a><span id="l11.1554" class="difflineminus">-  if (mLocalstore)</span>
<a href="#l11.1555"></a><span id="l11.1555" class="difflineminus">-  {</span>
<a href="#l11.1556"></a><span id="l11.1556" class="difflineminus">-    nsCOMPtr&lt;nsISimpleEnumerator&gt; cursor;</span>
<a href="#l11.1557"></a><span id="l11.1557" class="difflineminus">-    PRBool        hasMore = PR_FALSE;</span>
<a href="#l11.1558"></a><span id="l11.1558" class="difflineminus">-</span>
<a href="#l11.1559"></a><span id="l11.1559" class="difflineminus">-    // check mNC_FilterSearchURLsRoot</span>
<a href="#l11.1560"></a><span id="l11.1560" class="difflineminus">-    if (NS_SUCCEEDED(rv = mLocalstore-&gt;GetTargets(mNC_FilterSearchURLsRoot, mNC_Child,</span>
<a href="#l11.1561"></a><span id="l11.1561" class="difflineminus">-      PR_TRUE, getter_AddRefs(cursor))))</span>
<a href="#l11.1562"></a><span id="l11.1562" class="difflineminus">-    {</span>
<a href="#l11.1563"></a><span id="l11.1563" class="difflineminus">-      if (NS_SUCCEEDED(cursor-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l11.1564"></a><span id="l11.1564" class="difflineminus">-      {</span>
<a href="#l11.1565"></a><span id="l11.1565" class="difflineminus">-        haveFilters = PR_TRUE;</span>
<a href="#l11.1566"></a><span id="l11.1566" class="difflineminus">-      }</span>
<a href="#l11.1567"></a><span id="l11.1567" class="difflineminus">-    }</span>
<a href="#l11.1568"></a><span id="l11.1568" class="difflineminus">-    if (!haveFilters)</span>
<a href="#l11.1569"></a><span id="l11.1569" class="difflineminus">-    {</span>
<a href="#l11.1570"></a><span id="l11.1570" class="difflineminus">-      // check mNC_FilterSearchSitesRoot</span>
<a href="#l11.1571"></a><span id="l11.1571" class="difflineminus">-      if (NS_SUCCEEDED(rv = mLocalstore-&gt;GetTargets(mNC_FilterSearchSitesRoot, mNC_Child,</span>
<a href="#l11.1572"></a><span id="l11.1572" class="difflineminus">-        PR_TRUE, getter_AddRefs(cursor))))</span>
<a href="#l11.1573"></a><span id="l11.1573" class="difflineminus">-      {</span>
<a href="#l11.1574"></a><span id="l11.1574" class="difflineminus">-        if (NS_SUCCEEDED(cursor-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l11.1575"></a><span id="l11.1575" class="difflineminus">-        {</span>
<a href="#l11.1576"></a><span id="l11.1576" class="difflineminus">-          haveFilters = PR_TRUE;</span>
<a href="#l11.1577"></a><span id="l11.1577" class="difflineminus">-        }</span>
<a href="#l11.1578"></a><span id="l11.1578" class="difflineminus">-      }</span>
<a href="#l11.1579"></a><span id="l11.1579" class="difflineminus">-    }</span>
<a href="#l11.1580"></a><span id="l11.1580" class="difflineminus">-  }</span>
<a href="#l11.1581"></a><span id="l11.1581" class="difflineminus">-</span>
<a href="#l11.1582"></a><span id="l11.1582" class="difflineminus">-  PRBool        isSearchResult = PR_FALSE;</span>
<a href="#l11.1583"></a><span id="l11.1583" class="difflineminus">-  rv = mInner-&gt;HasAssertion(source, mRDF_type, mNC_SearchResult, PR_TRUE,</span>
<a href="#l11.1584"></a><span id="l11.1584" class="difflineminus">-          &amp;isSearchResult);</span>
<a href="#l11.1585"></a><span id="l11.1585" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; isSearchResult)</span>
<a href="#l11.1586"></a><span id="l11.1586" class="difflineminus">-  {</span>
<a href="#l11.1587"></a><span id="l11.1587" class="difflineminus">-    cmdArray-&gt;AppendElement(mNC_SearchCommand_AddQueryToBookmarks);</span>
<a href="#l11.1588"></a><span id="l11.1588" class="difflineminus">-    cmdArray-&gt;AppendElement(mNC_BookmarkSeparator);</span>
<a href="#l11.1589"></a><span id="l11.1589" class="difflineminus">-</span>
<a href="#l11.1590"></a><span id="l11.1590" class="difflineminus">-    // if this is a search result, and it isn't filtered, enable command to be able to filter it</span>
<a href="#l11.1591"></a><span id="l11.1591" class="difflineminus">-    PRBool        isURLFiltered = PR_FALSE;</span>
<a href="#l11.1592"></a><span id="l11.1592" class="difflineminus">-    rv = mInner-&gt;HasAssertion(mNC_FilterSearchURLsRoot, mNC_Child, source,</span>
<a href="#l11.1593"></a><span id="l11.1593" class="difflineminus">-                              PR_TRUE, &amp;isURLFiltered);</span>
<a href="#l11.1594"></a><span id="l11.1594" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; !isURLFiltered)</span>
<a href="#l11.1595"></a><span id="l11.1595" class="difflineminus">-    {</span>
<a href="#l11.1596"></a><span id="l11.1596" class="difflineminus">-      cmdArray-&gt;AppendElement(mNC_SearchCommand_FilterResult);</span>
<a href="#l11.1597"></a><span id="l11.1597" class="difflineminus">-    }</span>
<a href="#l11.1598"></a><span id="l11.1598" class="difflineminus">-</span>
<a href="#l11.1599"></a><span id="l11.1599" class="difflineminus">-    // XXX (should check site) if this is a search result site, and the site isn't filtered,</span>
<a href="#l11.1600"></a><span id="l11.1600" class="difflineminus">-    //     enable command to filter it</span>
<a href="#l11.1601"></a><span id="l11.1601" class="difflineminus">-    cmdArray-&gt;AppendElement(mNC_SearchCommand_FilterSite);</span>
<a href="#l11.1602"></a><span id="l11.1602" class="difflineminus">-</span>
<a href="#l11.1603"></a><span id="l11.1603" class="difflineminus">-    if (haveFilters)</span>
<a href="#l11.1604"></a><span id="l11.1604" class="difflineminus">-    {</span>
<a href="#l11.1605"></a><span id="l11.1605" class="difflineminus">-      cmdArray-&gt;AppendElement(mNC_BookmarkSeparator);</span>
<a href="#l11.1606"></a><span id="l11.1606" class="difflineminus">-      cmdArray-&gt;AppendElement(mNC_SearchCommand_ClearFilters);</span>
<a href="#l11.1607"></a><span id="l11.1607" class="difflineminus">-    }</span>
<a href="#l11.1608"></a><span id="l11.1608" class="difflineminus">-  }</span>
<a href="#l11.1609"></a><span id="l11.1609" class="difflineminus">-  else if (isSearchURI(source) || (source == mNC_LastSearchRoot))</span>
<a href="#l11.1610"></a><span id="l11.1610" class="difflineminus">-  {</span>
<a href="#l11.1611"></a><span id="l11.1611" class="difflineminus">-    if (haveFilters)</span>
<a href="#l11.1612"></a><span id="l11.1612" class="difflineminus">-    {</span>
<a href="#l11.1613"></a><span id="l11.1613" class="difflineminus">-      cmdArray-&gt;AppendElement(mNC_SearchCommand_ClearFilters);</span>
<a href="#l11.1614"></a><span id="l11.1614" class="difflineminus">-    }</span>
<a href="#l11.1615"></a><span id="l11.1615" class="difflineminus">-  }</span>
<a href="#l11.1616"></a><span id="l11.1616" class="difflineminus">-</span>
<a href="#l11.1617"></a><span id="l11.1617" class="difflineminus">-  // always append a separator last (due to aggregation of commands from multiple datasources)</span>
<a href="#l11.1618"></a><span id="l11.1618" class="difflineminus">-  cmdArray-&gt;AppendElement(mNC_BookmarkSeparator);</span>
<a href="#l11.1619"></a><span id="l11.1619" class="difflineminus">-</span>
<a href="#l11.1620"></a><span id="l11.1620" class="difflineminus">-  return NS_NewArrayEnumerator(commands, cmdArray);</span>
<a href="#l11.1621"></a><span id="l11.1621" class="difflineminus">-}</span>
<a href="#l11.1622"></a><span id="l11.1622" class="difflineminus">-</span>
<a href="#l11.1623"></a><span id="l11.1623" class="difflineminus">-</span>
<a href="#l11.1624"></a><span id="l11.1624" class="difflineminus">-</span>
<a href="#l11.1625"></a><span id="l11.1625" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.1626"></a><span id="l11.1626" class="difflineminus">-InternetSearchDataSource::IsCommandEnabled(nsISupportsArray/*&lt;nsIRDFResource&gt;*/* aSources,</span>
<a href="#l11.1627"></a><span id="l11.1627" class="difflineminus">-                                       nsIRDFResource*   aCommand,</span>
<a href="#l11.1628"></a><span id="l11.1628" class="difflineminus">-                                       nsISupportsArray/*&lt;nsIRDFResource&gt;*/* aArguments,</span>
<a href="#l11.1629"></a><span id="l11.1629" class="difflineminus">-                                       PRBool* aResult)</span>
<a href="#l11.1630"></a><span id="l11.1630" class="difflineminus">-{</span>
<a href="#l11.1631"></a><span id="l11.1631" class="difflineminus">-  return(NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l11.1632"></a><span id="l11.1632" class="difflineminus">-}</span>
<a href="#l11.1633"></a><span id="l11.1633" class="difflineminus">-</span>
<a href="#l11.1634"></a><span id="l11.1634" class="difflineminus">-</span>
<a href="#l11.1635"></a><span id="l11.1635" class="difflineminus">-</span>
<a href="#l11.1636"></a><span id="l11.1636" class="difflineminus">-PRBool</span>
<a href="#l11.1637"></a><span id="l11.1637" class="difflineminus">-InternetSearchDataSource::getSearchURI(nsIRDFResource *src, nsAString &amp;_retval)</span>
<a href="#l11.1638"></a><span id="l11.1638" class="difflineminus">-{</span>
<a href="#l11.1639"></a><span id="l11.1639" class="difflineminus">-</span>
<a href="#l11.1640"></a><span id="l11.1640" class="difflineminus">-  if (src)</span>
<a href="#l11.1641"></a><span id="l11.1641" class="difflineminus">-  {</span>
<a href="#l11.1642"></a><span id="l11.1642" class="difflineminus">-    nsresult    rv;</span>
<a href="#l11.1643"></a><span id="l11.1643" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt;  srcNode;</span>
<a href="#l11.1644"></a><span id="l11.1644" class="difflineminus">-    if (NS_SUCCEEDED(rv = mInner-&gt;GetTarget(src, mNC_URL, PR_TRUE, getter_AddRefs(srcNode))))</span>
<a href="#l11.1645"></a><span id="l11.1645" class="difflineminus">-    {</span>
<a href="#l11.1646"></a><span id="l11.1646" class="difflineminus">-      nsCOMPtr&lt;nsIRDFLiteral&gt; urlLiteral (do_QueryInterface(srcNode));</span>
<a href="#l11.1647"></a><span id="l11.1647" class="difflineminus">-      if (urlLiteral)</span>
<a href="#l11.1648"></a><span id="l11.1648" class="difflineminus">-      {</span>
<a href="#l11.1649"></a><span id="l11.1649" class="difflineminus">-        const PRUnichar *uriUni = nsnull;</span>
<a href="#l11.1650"></a><span id="l11.1650" class="difflineminus">-        urlLiteral-&gt;GetValueConst(&amp;uriUni);</span>
<a href="#l11.1651"></a><span id="l11.1651" class="difflineminus">-        if (uriUni)</span>
<a href="#l11.1652"></a><span id="l11.1652" class="difflineminus">-        {</span>
<a href="#l11.1653"></a><span id="l11.1653" class="difflineminus">-          _retval.Assign(uriUni);</span>
<a href="#l11.1654"></a><span id="l11.1654" class="difflineminus">-          return PR_TRUE;</span>
<a href="#l11.1655"></a><span id="l11.1655" class="difflineminus">-        }</span>
<a href="#l11.1656"></a><span id="l11.1656" class="difflineminus">-      }</span>
<a href="#l11.1657"></a><span id="l11.1657" class="difflineminus">-    }</span>
<a href="#l11.1658"></a><span id="l11.1658" class="difflineminus">-  }</span>
<a href="#l11.1659"></a><span id="l11.1659" class="difflineminus">-  return PR_FALSE;</span>
<a href="#l11.1660"></a><span id="l11.1660" class="difflineminus">-}</span>
<a href="#l11.1661"></a><span id="l11.1661" class="difflineminus">-</span>
<a href="#l11.1662"></a><span id="l11.1662" class="difflineminus">-</span>
<a href="#l11.1663"></a><span id="l11.1663" class="difflineminus">-</span>
<a href="#l11.1664"></a><span id="l11.1664" class="difflineminus">-nsresult</span>
<a href="#l11.1665"></a><span id="l11.1665" class="difflineminus">-InternetSearchDataSource::addToBookmarks(nsIRDFResource *src)</span>
<a href="#l11.1666"></a><span id="l11.1666" class="difflineminus">-{</span>
<a href="#l11.1667"></a><span id="l11.1667" class="difflineminus">-  if (!src) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1668"></a><span id="l11.1668" class="difflineminus">-  if (!mInner)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1669"></a><span id="l11.1669" class="difflineminus">-</span>
<a href="#l11.1670"></a><span id="l11.1670" class="difflineminus">-  nsresult    rv;</span>
<a href="#l11.1671"></a><span id="l11.1671" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt;  nameNode;</span>
<a href="#l11.1672"></a><span id="l11.1672" class="difflineminus">-  // Note: nameLiteral needs to stay in scope for the life of &quot;name&quot;</span>
<a href="#l11.1673"></a><span id="l11.1673" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; nameLiteral;</span>
<a href="#l11.1674"></a><span id="l11.1674" class="difflineminus">-  const PRUnichar   *name = nsnull;</span>
<a href="#l11.1675"></a><span id="l11.1675" class="difflineminus">-  if (NS_SUCCEEDED(rv = mInner-&gt;GetTarget(src, mNC_Name, PR_TRUE, getter_AddRefs(nameNode))))</span>
<a href="#l11.1676"></a><span id="l11.1676" class="difflineminus">-  {</span>
<a href="#l11.1677"></a><span id="l11.1677" class="difflineminus">-    nameLiteral = do_QueryInterface(nameNode);</span>
<a href="#l11.1678"></a><span id="l11.1678" class="difflineminus">-    if (nameLiteral)</span>
<a href="#l11.1679"></a><span id="l11.1679" class="difflineminus">-    {</span>
<a href="#l11.1680"></a><span id="l11.1680" class="difflineminus">-      nameLiteral-&gt;GetValueConst(&amp;name);</span>
<a href="#l11.1681"></a><span id="l11.1681" class="difflineminus">-    }</span>
<a href="#l11.1682"></a><span id="l11.1682" class="difflineminus">-  }</span>
<a href="#l11.1683"></a><span id="l11.1683" class="difflineminus">-</span>
<a href="#l11.1684"></a><span id="l11.1684" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.1685"></a><span id="l11.1685" class="difflineminus">-}</span>
<a href="#l11.1686"></a><span id="l11.1686" class="difflineminus">-</span>
<a href="#l11.1687"></a><span id="l11.1687" class="difflineminus">-</span>
<a href="#l11.1688"></a><span id="l11.1688" class="difflineminus">-</span>
<a href="#l11.1689"></a><span id="l11.1689" class="difflineminus">-nsresult</span>
<a href="#l11.1690"></a><span id="l11.1690" class="difflineminus">-InternetSearchDataSource::addQueryToBookmarks(nsIRDFResource *src)</span>
<a href="#l11.1691"></a><span id="l11.1691" class="difflineminus">-{</span>
<a href="#l11.1692"></a><span id="l11.1692" class="difflineminus">-  if (!src) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1693"></a><span id="l11.1693" class="difflineminus">-  if (!mInner)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1694"></a><span id="l11.1694" class="difflineminus">-</span>
<a href="#l11.1695"></a><span id="l11.1695" class="difflineminus">-  nsresult rv;</span>
<a href="#l11.1696"></a><span id="l11.1696" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt;  refNode;</span>
<a href="#l11.1697"></a><span id="l11.1697" class="difflineminus">-  if (NS_FAILED(rv = mInner-&gt;GetTarget(mNC_LastSearchRoot, mNC_Ref, PR_TRUE,</span>
<a href="#l11.1698"></a><span id="l11.1698" class="difflineminus">-    getter_AddRefs(refNode))))</span>
<a href="#l11.1699"></a><span id="l11.1699" class="difflineminus">-    return(rv);</span>
<a href="#l11.1700"></a><span id="l11.1700" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; urlLiteral (do_QueryInterface(refNode));</span>
<a href="#l11.1701"></a><span id="l11.1701" class="difflineminus">-  if (!urlLiteral)</span>
<a href="#l11.1702"></a><span id="l11.1702" class="difflineminus">-    return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1703"></a><span id="l11.1703" class="difflineminus">-  const PRUnichar *uriUni = nsnull;</span>
<a href="#l11.1704"></a><span id="l11.1704" class="difflineminus">-  urlLiteral-&gt;GetValueConst(&amp;uriUni);</span>
<a href="#l11.1705"></a><span id="l11.1705" class="difflineminus">-</span>
<a href="#l11.1706"></a><span id="l11.1706" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt;  textNode;</span>
<a href="#l11.1707"></a><span id="l11.1707" class="difflineminus">-  if (NS_FAILED(rv = mInner-&gt;GetTarget(mNC_LastSearchRoot, mNC_LastText, PR_TRUE,</span>
<a href="#l11.1708"></a><span id="l11.1708" class="difflineminus">-    getter_AddRefs(textNode))))</span>
<a href="#l11.1709"></a><span id="l11.1709" class="difflineminus">-    return(rv);</span>
<a href="#l11.1710"></a><span id="l11.1710" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; textLiteral = do_QueryInterface(textNode);</span>
<a href="#l11.1711"></a><span id="l11.1711" class="difflineminus">-  nsString value;</span>
<a href="#l11.1712"></a><span id="l11.1712" class="difflineminus">-  if (textLiteral)</span>
<a href="#l11.1713"></a><span id="l11.1713" class="difflineminus">-  {</span>
<a href="#l11.1714"></a><span id="l11.1714" class="difflineminus">-    const PRUnichar *textUni = nsnull;</span>
<a href="#l11.1715"></a><span id="l11.1715" class="difflineminus">-    textLiteral-&gt;GetValueConst(&amp;textUni);</span>
<a href="#l11.1716"></a><span id="l11.1716" class="difflineminus">-    nsAutoString name;</span>
<a href="#l11.1717"></a><span id="l11.1717" class="difflineminus">-    name.Assign(textUni);</span>
<a href="#l11.1718"></a><span id="l11.1718" class="difflineminus">-    // replace pluses with spaces</span>
<a href="#l11.1719"></a><span id="l11.1719" class="difflineminus">-    PRInt32 offset = name.FindChar(PRUnichar('+'));</span>
<a href="#l11.1720"></a><span id="l11.1720" class="difflineminus">-    while (offset != -1) {</span>
<a href="#l11.1721"></a><span id="l11.1721" class="difflineminus">-      name.Replace(offset, 1, PRUnichar(' '));</span>
<a href="#l11.1722"></a><span id="l11.1722" class="difflineminus">-      offset = name.FindChar(PRUnichar('+'), offset + 1);</span>
<a href="#l11.1723"></a><span id="l11.1723" class="difflineminus">-    }</span>
<a href="#l11.1724"></a><span id="l11.1724" class="difflineminus">-</span>
<a href="#l11.1725"></a><span id="l11.1725" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt;</span>
<a href="#l11.1726"></a><span id="l11.1726" class="difflineminus">-    stringService(do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv));</span>
<a href="#l11.1727"></a><span id="l11.1727" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; stringService)</span>
<a href="#l11.1728"></a><span id="l11.1728" class="difflineminus">-    {</span>
<a href="#l11.1729"></a><span id="l11.1729" class="difflineminus">-      nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l11.1730"></a><span id="l11.1730" class="difflineminus">-      rv = stringService-&gt;CreateBundle(SEARCH_PROPERTIES, getter_AddRefs(bundle));</span>
<a href="#l11.1731"></a><span id="l11.1731" class="difflineminus">-      if (bundle)</span>
<a href="#l11.1732"></a><span id="l11.1732" class="difflineminus">-      {</span>
<a href="#l11.1733"></a><span id="l11.1733" class="difflineminus">-        const PRUnichar *strings[] = { name.get() };</span>
<a href="#l11.1734"></a><span id="l11.1734" class="difflineminus">-        rv = bundle-&gt;FormatStringFromName(NS_LITERAL_STRING(&quot;searchTitle&quot;).get(), strings, 1, </span>
<a href="#l11.1735"></a><span id="l11.1735" class="difflineminus">-          getter_Copies(value));</span>
<a href="#l11.1736"></a><span id="l11.1736" class="difflineminus">-      }</span>
<a href="#l11.1737"></a><span id="l11.1737" class="difflineminus">-    }</span>
<a href="#l11.1738"></a><span id="l11.1738" class="difflineminus">-  }</span>
<a href="#l11.1739"></a><span id="l11.1739" class="difflineminus">-</span>
<a href="#l11.1740"></a><span id="l11.1740" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.1741"></a><span id="l11.1741" class="difflineminus">-}</span>
<a href="#l11.1742"></a><span id="l11.1742" class="difflineminus">-</span>
<a href="#l11.1743"></a><span id="l11.1743" class="difflineminus">-</span>
<a href="#l11.1744"></a><span id="l11.1744" class="difflineminus">-</span>
<a href="#l11.1745"></a><span id="l11.1745" class="difflineminus">-nsresult</span>
<a href="#l11.1746"></a><span id="l11.1746" class="difflineminus">-InternetSearchDataSource::filterResult(nsIRDFResource *aResource)</span>
<a href="#l11.1747"></a><span id="l11.1747" class="difflineminus">-{</span>
<a href="#l11.1748"></a><span id="l11.1748" class="difflineminus">-  if (!aResource) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1749"></a><span id="l11.1749" class="difflineminus">-  if (!mInner)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1750"></a><span id="l11.1750" class="difflineminus">-</span>
<a href="#l11.1751"></a><span id="l11.1751" class="difflineminus">-  // remove all anonymous resources which have this as a #URL</span>
<a href="#l11.1752"></a><span id="l11.1752" class="difflineminus">-  nsAutoString url;</span>
<a href="#l11.1753"></a><span id="l11.1753" class="difflineminus">-  if (!getSearchURI(aResource, url))</span>
<a href="#l11.1754"></a><span id="l11.1754" class="difflineminus">-  {</span>
<a href="#l11.1755"></a><span id="l11.1755" class="difflineminus">-    return NS_ERROR_UNEXPECTED;</span>
<a href="#l11.1756"></a><span id="l11.1756" class="difflineminus">-  }</span>
<a href="#l11.1757"></a><span id="l11.1757" class="difflineminus">-</span>
<a href="#l11.1758"></a><span id="l11.1758" class="difflineminus">-  nsresult      rv;</span>
<a href="#l11.1759"></a><span id="l11.1759" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; urlLiteral;</span>
<a href="#l11.1760"></a><span id="l11.1760" class="difflineminus">-  if (NS_FAILED(rv = mRDFService-&gt;GetLiteral(url.get(), getter_AddRefs(urlLiteral)))</span>
<a href="#l11.1761"></a><span id="l11.1761" class="difflineminus">-    || (urlLiteral == nsnull))  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1762"></a><span id="l11.1762" class="difflineminus">-</span>
<a href="#l11.1763"></a><span id="l11.1763" class="difflineminus">-  // add aResource into a list of nodes to filter out</span>
<a href="#l11.1764"></a><span id="l11.1764" class="difflineminus">-  PRBool  alreadyFiltered = PR_FALSE;</span>
<a href="#l11.1765"></a><span id="l11.1765" class="difflineminus">-  rv = mLocalstore-&gt;HasAssertion(mNC_FilterSearchURLsRoot, mNC_Child,</span>
<a href="#l11.1766"></a><span id="l11.1766" class="difflineminus">-         urlLiteral, PR_TRUE, &amp;alreadyFiltered);</span>
<a href="#l11.1767"></a><span id="l11.1767" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; alreadyFiltered)</span>
<a href="#l11.1768"></a><span id="l11.1768" class="difflineminus">-  {</span>
<a href="#l11.1769"></a><span id="l11.1769" class="difflineminus">-    // already filtered, nothing to do</span>
<a href="#l11.1770"></a><span id="l11.1770" class="difflineminus">-    return(rv);</span>
<a href="#l11.1771"></a><span id="l11.1771" class="difflineminus">-  }</span>
<a href="#l11.1772"></a><span id="l11.1772" class="difflineminus">-</span>
<a href="#l11.1773"></a><span id="l11.1773" class="difflineminus">-  // filter this URL out</span>
<a href="#l11.1774"></a><span id="l11.1774" class="difflineminus">-  mLocalstore-&gt;Assert(mNC_FilterSearchURLsRoot, mNC_Child, urlLiteral, PR_TRUE);</span>
<a href="#l11.1775"></a><span id="l11.1775" class="difflineminus">-</span>
<a href="#l11.1776"></a><span id="l11.1776" class="difflineminus">-  // flush localstore</span>
<a href="#l11.1777"></a><span id="l11.1777" class="difflineminus">-  nsCOMPtr&lt;nsIRDFRemoteDataSource&gt; remoteLocalStore (do_QueryInterface(mLocalstore));</span>
<a href="#l11.1778"></a><span id="l11.1778" class="difflineminus">-  if (remoteLocalStore)</span>
<a href="#l11.1779"></a><span id="l11.1779" class="difflineminus">-  {</span>
<a href="#l11.1780"></a><span id="l11.1780" class="difflineminus">-    remoteLocalStore-&gt;Flush();</span>
<a href="#l11.1781"></a><span id="l11.1781" class="difflineminus">-  }</span>
<a href="#l11.1782"></a><span id="l11.1782" class="difflineminus">-</span>
<a href="#l11.1783"></a><span id="l11.1783" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; anonArcs;</span>
<a href="#l11.1784"></a><span id="l11.1784" class="difflineminus">-  if (NS_SUCCEEDED(rv = mInner-&gt;GetSources(mNC_URL, urlLiteral, PR_TRUE,</span>
<a href="#l11.1785"></a><span id="l11.1785" class="difflineminus">-    getter_AddRefs(anonArcs))))</span>
<a href="#l11.1786"></a><span id="l11.1786" class="difflineminus">-  {</span>
<a href="#l11.1787"></a><span id="l11.1787" class="difflineminus">-    PRBool      hasMoreAnonArcs = PR_TRUE;</span>
<a href="#l11.1788"></a><span id="l11.1788" class="difflineminus">-    while (hasMoreAnonArcs)</span>
<a href="#l11.1789"></a><span id="l11.1789" class="difflineminus">-    {</span>
<a href="#l11.1790"></a><span id="l11.1790" class="difflineminus">-      if (NS_FAILED(anonArcs-&gt;HasMoreElements(&amp;hasMoreAnonArcs)) ||</span>
<a href="#l11.1791"></a><span id="l11.1791" class="difflineminus">-          !hasMoreAnonArcs)</span>
<a href="#l11.1792"></a><span id="l11.1792" class="difflineminus">-        break;</span>
<a href="#l11.1793"></a><span id="l11.1793" class="difflineminus">-      nsCOMPtr&lt;nsISupports&gt; anonArc;</span>
<a href="#l11.1794"></a><span id="l11.1794" class="difflineminus">-      if (NS_FAILED(anonArcs-&gt;GetNext(getter_AddRefs(anonArc))))</span>
<a href="#l11.1795"></a><span id="l11.1795" class="difflineminus">-        break;</span>
<a href="#l11.1796"></a><span id="l11.1796" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt; anonChild (do_QueryInterface(anonArc));</span>
<a href="#l11.1797"></a><span id="l11.1797" class="difflineminus">-      if (!anonChild) continue;</span>
<a href="#l11.1798"></a><span id="l11.1798" class="difflineminus">-</span>
<a href="#l11.1799"></a><span id="l11.1799" class="difflineminus">-      PRBool  isSearchResult = PR_FALSE;</span>
<a href="#l11.1800"></a><span id="l11.1800" class="difflineminus">-      rv = mInner-&gt;HasAssertion(anonChild, mRDF_type, mNC_SearchResult,</span>
<a href="#l11.1801"></a><span id="l11.1801" class="difflineminus">-                                PR_TRUE, &amp;isSearchResult);</span>
<a href="#l11.1802"></a><span id="l11.1802" class="difflineminus">-      if (NS_FAILED(rv) || !isSearchResult)</span>
<a href="#l11.1803"></a><span id="l11.1803" class="difflineminus">-        continue;</span>
<a href="#l11.1804"></a><span id="l11.1804" class="difflineminus">-</span>
<a href="#l11.1805"></a><span id="l11.1805" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt;  anonParent;</span>
<a href="#l11.1806"></a><span id="l11.1806" class="difflineminus">-      if (NS_FAILED(rv = mInner-&gt;GetSource(mNC_Child, anonChild, PR_TRUE,</span>
<a href="#l11.1807"></a><span id="l11.1807" class="difflineminus">-        getter_AddRefs(anonParent)))) continue;</span>
<a href="#l11.1808"></a><span id="l11.1808" class="difflineminus">-      if (!anonParent)  continue;</span>
<a href="#l11.1809"></a><span id="l11.1809" class="difflineminus">-</span>
<a href="#l11.1810"></a><span id="l11.1810" class="difflineminus">-      mInner-&gt;Unassert(anonParent, mNC_Child, anonChild);</span>
<a href="#l11.1811"></a><span id="l11.1811" class="difflineminus">-    }</span>
<a href="#l11.1812"></a><span id="l11.1812" class="difflineminus">-  }</span>
<a href="#l11.1813"></a><span id="l11.1813" class="difflineminus">-</span>
<a href="#l11.1814"></a><span id="l11.1814" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.1815"></a><span id="l11.1815" class="difflineminus">-}</span>
<a href="#l11.1816"></a><span id="l11.1816" class="difflineminus">-</span>
<a href="#l11.1817"></a><span id="l11.1817" class="difflineminus">-</span>
<a href="#l11.1818"></a><span id="l11.1818" class="difflineminus">-</span>
<a href="#l11.1819"></a><span id="l11.1819" class="difflineminus">-nsresult</span>
<a href="#l11.1820"></a><span id="l11.1820" class="difflineminus">-InternetSearchDataSource::filterSite(nsIRDFResource *aResource)</span>
<a href="#l11.1821"></a><span id="l11.1821" class="difflineminus">-{</span>
<a href="#l11.1822"></a><span id="l11.1822" class="difflineminus">-  if (!aResource) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1823"></a><span id="l11.1823" class="difflineminus">-  if (!mInner)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1824"></a><span id="l11.1824" class="difflineminus">-</span>
<a href="#l11.1825"></a><span id="l11.1825" class="difflineminus">-  nsAutoString host;</span>
<a href="#l11.1826"></a><span id="l11.1826" class="difflineminus">-  if (!getSearchURI(aResource, host))</span>
<a href="#l11.1827"></a><span id="l11.1827" class="difflineminus">-  {</span>
<a href="#l11.1828"></a><span id="l11.1828" class="difflineminus">-    return NS_ERROR_UNEXPECTED;</span>
<a href="#l11.1829"></a><span id="l11.1829" class="difflineminus">-  }</span>
<a href="#l11.1830"></a><span id="l11.1830" class="difflineminus">-</span>
<a href="#l11.1831"></a><span id="l11.1831" class="difflineminus">-  // determine site (host name)</span>
<a href="#l11.1832"></a><span id="l11.1832" class="difflineminus">-  PRInt32   slashOffset1 = host.Find(&quot;://&quot;);</span>
<a href="#l11.1833"></a><span id="l11.1833" class="difflineminus">-  if (slashOffset1 &lt; 1)     return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1834"></a><span id="l11.1834" class="difflineminus">-  PRInt32   slashOffset2 = host.FindChar(PRUnichar('/'), slashOffset1 + 3);</span>
<a href="#l11.1835"></a><span id="l11.1835" class="difflineminus">-  if (slashOffset2 &lt;= slashOffset1) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1836"></a><span id="l11.1836" class="difflineminus">-  host.SetLength(slashOffset2 + 1);</span>
<a href="#l11.1837"></a><span id="l11.1837" class="difflineminus">-</span>
<a href="#l11.1838"></a><span id="l11.1838" class="difflineminus">-  nsresult      rv;</span>
<a href="#l11.1839"></a><span id="l11.1839" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; urlLiteral;</span>
<a href="#l11.1840"></a><span id="l11.1840" class="difflineminus">-  if (NS_FAILED(rv = mRDFService-&gt;GetLiteral(host.get(), getter_AddRefs(urlLiteral)))</span>
<a href="#l11.1841"></a><span id="l11.1841" class="difflineminus">-    || (urlLiteral == nsnull))  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1842"></a><span id="l11.1842" class="difflineminus">-</span>
<a href="#l11.1843"></a><span id="l11.1843" class="difflineminus">-  // add aResource into a list of nodes to filter out</span>
<a href="#l11.1844"></a><span id="l11.1844" class="difflineminus">-  PRBool  alreadyFiltered = PR_FALSE;</span>
<a href="#l11.1845"></a><span id="l11.1845" class="difflineminus">-  rv = mLocalstore-&gt;HasAssertion(mNC_FilterSearchSitesRoot, mNC_Child,</span>
<a href="#l11.1846"></a><span id="l11.1846" class="difflineminus">-         urlLiteral, PR_TRUE, &amp;alreadyFiltered);</span>
<a href="#l11.1847"></a><span id="l11.1847" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; alreadyFiltered)</span>
<a href="#l11.1848"></a><span id="l11.1848" class="difflineminus">-  {</span>
<a href="#l11.1849"></a><span id="l11.1849" class="difflineminus">-    // already filtered, nothing to do</span>
<a href="#l11.1850"></a><span id="l11.1850" class="difflineminus">-    return(rv);</span>
<a href="#l11.1851"></a><span id="l11.1851" class="difflineminus">-  }</span>
<a href="#l11.1852"></a><span id="l11.1852" class="difflineminus">-</span>
<a href="#l11.1853"></a><span id="l11.1853" class="difflineminus">-  // filter this site out</span>
<a href="#l11.1854"></a><span id="l11.1854" class="difflineminus">-  mLocalstore-&gt;Assert(mNC_FilterSearchSitesRoot, mNC_Child, urlLiteral, PR_TRUE);</span>
<a href="#l11.1855"></a><span id="l11.1855" class="difflineminus">-</span>
<a href="#l11.1856"></a><span id="l11.1856" class="difflineminus">-  // flush localstore</span>
<a href="#l11.1857"></a><span id="l11.1857" class="difflineminus">-  nsCOMPtr&lt;nsIRDFRemoteDataSource&gt; remoteLocalStore (do_QueryInterface(mLocalstore));</span>
<a href="#l11.1858"></a><span id="l11.1858" class="difflineminus">-  if (remoteLocalStore)</span>
<a href="#l11.1859"></a><span id="l11.1859" class="difflineminus">-  {</span>
<a href="#l11.1860"></a><span id="l11.1860" class="difflineminus">-    remoteLocalStore-&gt;Flush();</span>
<a href="#l11.1861"></a><span id="l11.1861" class="difflineminus">-  }</span>
<a href="#l11.1862"></a><span id="l11.1862" class="difflineminus">-</span>
<a href="#l11.1863"></a><span id="l11.1863" class="difflineminus">-  // remove all anonymous resources which have this as a site</span>
<a href="#l11.1864"></a><span id="l11.1864" class="difflineminus">-</span>
<a href="#l11.1865"></a><span id="l11.1865" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  aRes;</span>
<a href="#l11.1866"></a><span id="l11.1866" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; cursor;</span>
<a href="#l11.1867"></a><span id="l11.1867" class="difflineminus">-  PRBool        hasMore;</span>
<a href="#l11.1868"></a><span id="l11.1868" class="difflineminus">-</span>
<a href="#l11.1869"></a><span id="l11.1869" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; array(do_CreateInstance(NS_SUPPORTSARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l11.1870"></a><span id="l11.1870" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.1871"></a><span id="l11.1871" class="difflineminus">-</span>
<a href="#l11.1872"></a><span id="l11.1872" class="difflineminus">-  if (NS_FAILED(rv = GetAllResources(getter_AddRefs(cursor))))  return(rv);</span>
<a href="#l11.1873"></a><span id="l11.1873" class="difflineminus">-  if (!cursor)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1874"></a><span id="l11.1874" class="difflineminus">-</span>
<a href="#l11.1875"></a><span id="l11.1875" class="difflineminus">-  hasMore = PR_TRUE;</span>
<a href="#l11.1876"></a><span id="l11.1876" class="difflineminus">-  while (hasMore)</span>
<a href="#l11.1877"></a><span id="l11.1877" class="difflineminus">-  {</span>
<a href="#l11.1878"></a><span id="l11.1878" class="difflineminus">-    if (NS_FAILED(rv = cursor-&gt;HasMoreElements(&amp;hasMore)))  return(rv);</span>
<a href="#l11.1879"></a><span id="l11.1879" class="difflineminus">-    if (!hasMore)</span>
<a href="#l11.1880"></a><span id="l11.1880" class="difflineminus">-      break;</span>
<a href="#l11.1881"></a><span id="l11.1881" class="difflineminus">-    </span>
<a href="#l11.1882"></a><span id="l11.1882" class="difflineminus">-    nsCOMPtr&lt;nsISupports&gt; isupports;</span>
<a href="#l11.1883"></a><span id="l11.1883" class="difflineminus">-    if (NS_FAILED(rv = cursor-&gt;GetNext(getter_AddRefs(isupports))))</span>
<a href="#l11.1884"></a><span id="l11.1884" class="difflineminus">-        return(rv);</span>
<a href="#l11.1885"></a><span id="l11.1885" class="difflineminus">-    if (!isupports) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1886"></a><span id="l11.1886" class="difflineminus">-    aRes = do_QueryInterface(isupports);</span>
<a href="#l11.1887"></a><span id="l11.1887" class="difflineminus">-    if (!aRes)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1888"></a><span id="l11.1888" class="difflineminus">-</span>
<a href="#l11.1889"></a><span id="l11.1889" class="difflineminus">-    if ((aRes.get() == mNC_LastSearchRoot) || (isSearchURI(aRes)))</span>
<a href="#l11.1890"></a><span id="l11.1890" class="difflineminus">-    {</span>
<a href="#l11.1891"></a><span id="l11.1891" class="difflineminus">-      array-&gt;AppendElement(aRes);</span>
<a href="#l11.1892"></a><span id="l11.1892" class="difflineminus">-    }</span>
<a href="#l11.1893"></a><span id="l11.1893" class="difflineminus">-  }</span>
<a href="#l11.1894"></a><span id="l11.1894" class="difflineminus">-</span>
<a href="#l11.1895"></a><span id="l11.1895" class="difflineminus">-  PRUint32  count;</span>
<a href="#l11.1896"></a><span id="l11.1896" class="difflineminus">-  if (NS_FAILED(rv = array-&gt;Count(&amp;count))) return(rv);</span>
<a href="#l11.1897"></a><span id="l11.1897" class="difflineminus">-  for (PRUint32 loop=0; loop&lt;count; loop++)</span>
<a href="#l11.1898"></a><span id="l11.1898" class="difflineminus">-  {</span>
<a href="#l11.1899"></a><span id="l11.1899" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt; aSearchRoot (do_QueryElementAt(array, loop));</span>
<a href="#l11.1900"></a><span id="l11.1900" class="difflineminus">-    if (!aSearchRoot) break;</span>
<a href="#l11.1901"></a><span id="l11.1901" class="difflineminus">-</span>
<a href="#l11.1902"></a><span id="l11.1902" class="difflineminus">-    if (NS_SUCCEEDED(rv = mInner-&gt;GetTargets(aSearchRoot, mNC_Child,</span>
<a href="#l11.1903"></a><span id="l11.1903" class="difflineminus">-      PR_TRUE, getter_AddRefs(cursor))))</span>
<a href="#l11.1904"></a><span id="l11.1904" class="difflineminus">-    {</span>
<a href="#l11.1905"></a><span id="l11.1905" class="difflineminus">-      hasMore = PR_TRUE;</span>
<a href="#l11.1906"></a><span id="l11.1906" class="difflineminus">-      while (hasMore)</span>
<a href="#l11.1907"></a><span id="l11.1907" class="difflineminus">-      {</span>
<a href="#l11.1908"></a><span id="l11.1908" class="difflineminus">-        if (NS_FAILED(cursor-&gt;HasMoreElements(&amp;hasMore)) || !hasMore)</span>
<a href="#l11.1909"></a><span id="l11.1909" class="difflineminus">-          break;</span>
<a href="#l11.1910"></a><span id="l11.1910" class="difflineminus">-</span>
<a href="#l11.1911"></a><span id="l11.1911" class="difflineminus">-        nsCOMPtr&lt;nsISupports&gt;   arc;</span>
<a href="#l11.1912"></a><span id="l11.1912" class="difflineminus">-        if (NS_FAILED(cursor-&gt;GetNext(getter_AddRefs(arc))))</span>
<a href="#l11.1913"></a><span id="l11.1913" class="difflineminus">-          break;</span>
<a href="#l11.1914"></a><span id="l11.1914" class="difflineminus">-        aRes = do_QueryInterface(arc);</span>
<a href="#l11.1915"></a><span id="l11.1915" class="difflineminus">-        if (!aRes)  break;</span>
<a href="#l11.1916"></a><span id="l11.1916" class="difflineminus">-</span>
<a href="#l11.1917"></a><span id="l11.1917" class="difflineminus">-        nsAutoString site;</span>
<a href="#l11.1918"></a><span id="l11.1918" class="difflineminus">-        if (!getSearchURI(aRes, site))</span>
<a href="#l11.1919"></a><span id="l11.1919" class="difflineminus">-        {</span>
<a href="#l11.1920"></a><span id="l11.1920" class="difflineminus">-          return NS_ERROR_UNEXPECTED;</span>
<a href="#l11.1921"></a><span id="l11.1921" class="difflineminus">-        }</span>
<a href="#l11.1922"></a><span id="l11.1922" class="difflineminus">-</span>
<a href="#l11.1923"></a><span id="l11.1923" class="difflineminus">-        // determine site (host name)</span>
<a href="#l11.1924"></a><span id="l11.1924" class="difflineminus">-        slashOffset1 = site.Find(&quot;://&quot;);</span>
<a href="#l11.1925"></a><span id="l11.1925" class="difflineminus">-        if (slashOffset1 &lt; 1)     return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1926"></a><span id="l11.1926" class="difflineminus">-        slashOffset2 = site.FindChar(PRUnichar('/'), slashOffset1 + 3);</span>
<a href="#l11.1927"></a><span id="l11.1927" class="difflineminus">-        if (slashOffset2 &lt;= slashOffset1) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1928"></a><span id="l11.1928" class="difflineminus">-        site.SetLength(slashOffset2 + 1);</span>
<a href="#l11.1929"></a><span id="l11.1929" class="difflineminus">-</span>
<a href="#l11.1930"></a><span id="l11.1930" class="difflineminus">-        if (site.Equals(host, CaseInsensitiveCompare))</span>
<a href="#l11.1931"></a><span id="l11.1931" class="difflineminus">-        {</span>
<a href="#l11.1932"></a><span id="l11.1932" class="difflineminus">-          mInner-&gt;Unassert(aSearchRoot, mNC_Child, aRes);</span>
<a href="#l11.1933"></a><span id="l11.1933" class="difflineminus">-        }</span>
<a href="#l11.1934"></a><span id="l11.1934" class="difflineminus">-      }</span>
<a href="#l11.1935"></a><span id="l11.1935" class="difflineminus">-    }</span>
<a href="#l11.1936"></a><span id="l11.1936" class="difflineminus">-  }</span>
<a href="#l11.1937"></a><span id="l11.1937" class="difflineminus">-</span>
<a href="#l11.1938"></a><span id="l11.1938" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.1939"></a><span id="l11.1939" class="difflineminus">-}</span>
<a href="#l11.1940"></a><span id="l11.1940" class="difflineminus">-</span>
<a href="#l11.1941"></a><span id="l11.1941" class="difflineminus">-</span>
<a href="#l11.1942"></a><span id="l11.1942" class="difflineminus">-</span>
<a href="#l11.1943"></a><span id="l11.1943" class="difflineminus">-nsresult</span>
<a href="#l11.1944"></a><span id="l11.1944" class="difflineminus">-InternetSearchDataSource::clearFilters(void)</span>
<a href="#l11.1945"></a><span id="l11.1945" class="difflineminus">-{</span>
<a href="#l11.1946"></a><span id="l11.1946" class="difflineminus">-  if (!mInner)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.1947"></a><span id="l11.1947" class="difflineminus">-</span>
<a href="#l11.1948"></a><span id="l11.1948" class="difflineminus">-  nsresult      rv;</span>
<a href="#l11.1949"></a><span id="l11.1949" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; arcs;</span>
<a href="#l11.1950"></a><span id="l11.1950" class="difflineminus">-  PRBool        hasMore = PR_TRUE;</span>
<a href="#l11.1951"></a><span id="l11.1951" class="difflineminus">-  nsCOMPtr&lt;nsISupports&gt;   arc;</span>
<a href="#l11.1952"></a><span id="l11.1952" class="difflineminus">-</span>
<a href="#l11.1953"></a><span id="l11.1953" class="difflineminus">-  // remove all filtered URLs</span>
<a href="#l11.1954"></a><span id="l11.1954" class="difflineminus">-  if (NS_SUCCEEDED(rv = mLocalstore-&gt;GetTargets(mNC_FilterSearchURLsRoot, mNC_Child,</span>
<a href="#l11.1955"></a><span id="l11.1955" class="difflineminus">-    PR_TRUE, getter_AddRefs(arcs))))</span>
<a href="#l11.1956"></a><span id="l11.1956" class="difflineminus">-  {</span>
<a href="#l11.1957"></a><span id="l11.1957" class="difflineminus">-    hasMore = PR_TRUE;</span>
<a href="#l11.1958"></a><span id="l11.1958" class="difflineminus">-    while (hasMore)</span>
<a href="#l11.1959"></a><span id="l11.1959" class="difflineminus">-    {</span>
<a href="#l11.1960"></a><span id="l11.1960" class="difflineminus">-      if (NS_FAILED(arcs-&gt;HasMoreElements(&amp;hasMore)) || !hasMore)</span>
<a href="#l11.1961"></a><span id="l11.1961" class="difflineminus">-        break;</span>
<a href="#l11.1962"></a><span id="l11.1962" class="difflineminus">-      if (NS_FAILED(arcs-&gt;GetNext(getter_AddRefs(arc))))</span>
<a href="#l11.1963"></a><span id="l11.1963" class="difflineminus">-        break;</span>
<a href="#l11.1964"></a><span id="l11.1964" class="difflineminus">-</span>
<a href="#l11.1965"></a><span id="l11.1965" class="difflineminus">-      nsCOMPtr&lt;nsIRDFLiteral&gt; filterURL (do_QueryInterface(arc));</span>
<a href="#l11.1966"></a><span id="l11.1966" class="difflineminus">-      if (!filterURL) continue;</span>
<a href="#l11.1967"></a><span id="l11.1967" class="difflineminus">-      </span>
<a href="#l11.1968"></a><span id="l11.1968" class="difflineminus">-      mLocalstore-&gt;Unassert(mNC_FilterSearchURLsRoot, mNC_Child, filterURL);</span>
<a href="#l11.1969"></a><span id="l11.1969" class="difflineminus">-    }</span>
<a href="#l11.1970"></a><span id="l11.1970" class="difflineminus">-  }</span>
<a href="#l11.1971"></a><span id="l11.1971" class="difflineminus">-</span>
<a href="#l11.1972"></a><span id="l11.1972" class="difflineminus">-  // remove all filtered sites</span>
<a href="#l11.1973"></a><span id="l11.1973" class="difflineminus">-  if (NS_SUCCEEDED(rv = mLocalstore-&gt;GetTargets(mNC_FilterSearchSitesRoot, mNC_Child,</span>
<a href="#l11.1974"></a><span id="l11.1974" class="difflineminus">-    PR_TRUE, getter_AddRefs(arcs))))</span>
<a href="#l11.1975"></a><span id="l11.1975" class="difflineminus">-  {</span>
<a href="#l11.1976"></a><span id="l11.1976" class="difflineminus">-    hasMore = PR_TRUE;</span>
<a href="#l11.1977"></a><span id="l11.1977" class="difflineminus">-    while (hasMore)</span>
<a href="#l11.1978"></a><span id="l11.1978" class="difflineminus">-    {</span>
<a href="#l11.1979"></a><span id="l11.1979" class="difflineminus">-      if (NS_FAILED(arcs-&gt;HasMoreElements(&amp;hasMore)) || !hasMore)</span>
<a href="#l11.1980"></a><span id="l11.1980" class="difflineminus">-        break;</span>
<a href="#l11.1981"></a><span id="l11.1981" class="difflineminus">-      if (NS_FAILED(arcs-&gt;GetNext(getter_AddRefs(arc))))</span>
<a href="#l11.1982"></a><span id="l11.1982" class="difflineminus">-        break;</span>
<a href="#l11.1983"></a><span id="l11.1983" class="difflineminus">-</span>
<a href="#l11.1984"></a><span id="l11.1984" class="difflineminus">-      nsCOMPtr&lt;nsIRDFLiteral&gt; filterSiteLiteral (do_QueryInterface(arc));</span>
<a href="#l11.1985"></a><span id="l11.1985" class="difflineminus">-      if (!filterSiteLiteral) continue;</span>
<a href="#l11.1986"></a><span id="l11.1986" class="difflineminus">-      </span>
<a href="#l11.1987"></a><span id="l11.1987" class="difflineminus">-      mLocalstore-&gt;Unassert(mNC_FilterSearchSitesRoot, mNC_Child, filterSiteLiteral);</span>
<a href="#l11.1988"></a><span id="l11.1988" class="difflineminus">-    }</span>
<a href="#l11.1989"></a><span id="l11.1989" class="difflineminus">-  }</span>
<a href="#l11.1990"></a><span id="l11.1990" class="difflineminus">-</span>
<a href="#l11.1991"></a><span id="l11.1991" class="difflineminus">-  // flush localstore</span>
<a href="#l11.1992"></a><span id="l11.1992" class="difflineminus">-  nsCOMPtr&lt;nsIRDFRemoteDataSource&gt; remoteLocalStore (do_QueryInterface(mLocalstore));</span>
<a href="#l11.1993"></a><span id="l11.1993" class="difflineminus">-  if (remoteLocalStore)</span>
<a href="#l11.1994"></a><span id="l11.1994" class="difflineminus">-  {</span>
<a href="#l11.1995"></a><span id="l11.1995" class="difflineminus">-    remoteLocalStore-&gt;Flush();</span>
<a href="#l11.1996"></a><span id="l11.1996" class="difflineminus">-  }</span>
<a href="#l11.1997"></a><span id="l11.1997" class="difflineminus">-</span>
<a href="#l11.1998"></a><span id="l11.1998" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.1999"></a><span id="l11.1999" class="difflineminus">-}</span>
<a href="#l11.2000"></a><span id="l11.2000" class="difflineminus">-</span>
<a href="#l11.2001"></a><span id="l11.2001" class="difflineminus">-</span>
<a href="#l11.2002"></a><span id="l11.2002" class="difflineminus">-</span>
<a href="#l11.2003"></a><span id="l11.2003" class="difflineminus">-PRBool</span>
<a href="#l11.2004"></a><span id="l11.2004" class="difflineminus">-InternetSearchDataSource::isSearchResultFiltered(const nsString &amp;hrefStr)</span>
<a href="#l11.2005"></a><span id="l11.2005" class="difflineminus">-{</span>
<a href="#l11.2006"></a><span id="l11.2006" class="difflineminus">-  PRBool    filterStatus = PR_FALSE;</span>
<a href="#l11.2007"></a><span id="l11.2007" class="difflineminus">-  nsresult  rv;</span>
<a href="#l11.2008"></a><span id="l11.2008" class="difflineminus">-</span>
<a href="#l11.2009"></a><span id="l11.2009" class="difflineminus">-  const PRUnichar *hrefUni = hrefStr.get();</span>
<a href="#l11.2010"></a><span id="l11.2010" class="difflineminus">-  if (!hrefUni) return(filterStatus);</span>
<a href="#l11.2011"></a><span id="l11.2011" class="difflineminus">-</span>
<a href="#l11.2012"></a><span id="l11.2012" class="difflineminus">-  // check if this specific URL is to be filtered out</span>
<a href="#l11.2013"></a><span id="l11.2013" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; hrefLiteral;</span>
<a href="#l11.2014"></a><span id="l11.2014" class="difflineminus">-  if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(hrefUni, getter_AddRefs(hrefLiteral))))</span>
<a href="#l11.2015"></a><span id="l11.2015" class="difflineminus">-  {</span>
<a href="#l11.2016"></a><span id="l11.2016" class="difflineminus">-    if (NS_SUCCEEDED(rv = mLocalstore-&gt;HasAssertion(mNC_FilterSearchURLsRoot,</span>
<a href="#l11.2017"></a><span id="l11.2017" class="difflineminus">-      mNC_Child, hrefLiteral, PR_TRUE, &amp;filterStatus)))</span>
<a href="#l11.2018"></a><span id="l11.2018" class="difflineminus">-    {</span>
<a href="#l11.2019"></a><span id="l11.2019" class="difflineminus">-      if (filterStatus)</span>
<a href="#l11.2020"></a><span id="l11.2020" class="difflineminus">-      {</span>
<a href="#l11.2021"></a><span id="l11.2021" class="difflineminus">-        return(filterStatus);</span>
<a href="#l11.2022"></a><span id="l11.2022" class="difflineminus">-      }</span>
<a href="#l11.2023"></a><span id="l11.2023" class="difflineminus">-    }</span>
<a href="#l11.2024"></a><span id="l11.2024" class="difflineminus">-  }</span>
<a href="#l11.2025"></a><span id="l11.2025" class="difflineminus">-</span>
<a href="#l11.2026"></a><span id="l11.2026" class="difflineminus">-  // check if this specific Site is to be filtered out</span>
<a href="#l11.2027"></a><span id="l11.2027" class="difflineminus">-</span>
<a href="#l11.2028"></a><span id="l11.2028" class="difflineminus">-  // determine site (host name)</span>
<a href="#l11.2029"></a><span id="l11.2029" class="difflineminus">-  nsAutoString  host(hrefStr);</span>
<a href="#l11.2030"></a><span id="l11.2030" class="difflineminus">-  PRInt32   slashOffset1 = host.Find(&quot;://&quot;);</span>
<a href="#l11.2031"></a><span id="l11.2031" class="difflineminus">-  if (slashOffset1 &lt; 1)     return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2032"></a><span id="l11.2032" class="difflineminus">-  PRInt32   slashOffset2 = host.FindChar(PRUnichar('/'), slashOffset1 + 3);</span>
<a href="#l11.2033"></a><span id="l11.2033" class="difflineminus">-  if (slashOffset2 &lt;= slashOffset1) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2034"></a><span id="l11.2034" class="difflineminus">-  host.SetLength(slashOffset2 + 1);</span>
<a href="#l11.2035"></a><span id="l11.2035" class="difflineminus">-</span>
<a href="#l11.2036"></a><span id="l11.2036" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; urlLiteral;</span>
<a href="#l11.2037"></a><span id="l11.2037" class="difflineminus">-  if (NS_FAILED(rv = mRDFService-&gt;GetLiteral(host.get(), getter_AddRefs(urlLiteral)))</span>
<a href="#l11.2038"></a><span id="l11.2038" class="difflineminus">-    || (urlLiteral == nsnull))  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2039"></a><span id="l11.2039" class="difflineminus">-</span>
<a href="#l11.2040"></a><span id="l11.2040" class="difflineminus">-  rv = mLocalstore-&gt;HasAssertion(mNC_FilterSearchSitesRoot, mNC_Child, urlLiteral,</span>
<a href="#l11.2041"></a><span id="l11.2041" class="difflineminus">-    PR_TRUE, &amp;filterStatus);</span>
<a href="#l11.2042"></a><span id="l11.2042" class="difflineminus">-</span>
<a href="#l11.2043"></a><span id="l11.2043" class="difflineminus">-  return(filterStatus);</span>
<a href="#l11.2044"></a><span id="l11.2044" class="difflineminus">-}</span>
<a href="#l11.2045"></a><span id="l11.2045" class="difflineminus">-</span>
<a href="#l11.2046"></a><span id="l11.2046" class="difflineminus">-</span>
<a href="#l11.2047"></a><span id="l11.2047" class="difflineminus">-</span>
<a href="#l11.2048"></a><span id="l11.2048" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.2049"></a><span id="l11.2049" class="difflineminus">-InternetSearchDataSource::DoCommand(nsISupportsArray/*&lt;nsIRDFResource&gt;*/* aSources,</span>
<a href="#l11.2050"></a><span id="l11.2050" class="difflineminus">-                                nsIRDFResource*   aCommand,</span>
<a href="#l11.2051"></a><span id="l11.2051" class="difflineminus">-                                nsISupportsArray/*&lt;nsIRDFResource&gt;*/* aArguments)</span>
<a href="#l11.2052"></a><span id="l11.2052" class="difflineminus">-{</span>
<a href="#l11.2053"></a><span id="l11.2053" class="difflineminus">-  nsresult    rv = NS_OK;</span>
<a href="#l11.2054"></a><span id="l11.2054" class="difflineminus">-  PRInt32     loop;</span>
<a href="#l11.2055"></a><span id="l11.2055" class="difflineminus">-  PRUint32    numSources;</span>
<a href="#l11.2056"></a><span id="l11.2056" class="difflineminus">-  if (NS_FAILED(rv = aSources-&gt;Count(&amp;numSources))) return(rv);</span>
<a href="#l11.2057"></a><span id="l11.2057" class="difflineminus">-  if (numSources &lt; 1)</span>
<a href="#l11.2058"></a><span id="l11.2058" class="difflineminus">-  {</span>
<a href="#l11.2059"></a><span id="l11.2059" class="difflineminus">-    return(NS_ERROR_ILLEGAL_VALUE);</span>
<a href="#l11.2060"></a><span id="l11.2060" class="difflineminus">-  }</span>
<a href="#l11.2061"></a><span id="l11.2061" class="difflineminus">-</span>
<a href="#l11.2062"></a><span id="l11.2062" class="difflineminus">-  for (loop=((PRInt32)numSources)-1; loop&gt;=0; loop--)</span>
<a href="#l11.2063"></a><span id="l11.2063" class="difflineminus">-  {</span>
<a href="#l11.2064"></a><span id="l11.2064" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt; src (do_QueryElementAt(aSources, loop));</span>
<a href="#l11.2065"></a><span id="l11.2065" class="difflineminus">-    if (!src) return(NS_ERROR_NO_INTERFACE);</span>
<a href="#l11.2066"></a><span id="l11.2066" class="difflineminus">-</span>
<a href="#l11.2067"></a><span id="l11.2067" class="difflineminus">-    if (aCommand == mNC_SearchCommand_AddToBookmarks)</span>
<a href="#l11.2068"></a><span id="l11.2068" class="difflineminus">-    {</span>
<a href="#l11.2069"></a><span id="l11.2069" class="difflineminus">-      if (NS_FAILED(rv = addToBookmarks(src)))</span>
<a href="#l11.2070"></a><span id="l11.2070" class="difflineminus">-        return(rv);</span>
<a href="#l11.2071"></a><span id="l11.2071" class="difflineminus">-    }</span>
<a href="#l11.2072"></a><span id="l11.2072" class="difflineminus">-    else if (aCommand == mNC_SearchCommand_AddQueryToBookmarks)</span>
<a href="#l11.2073"></a><span id="l11.2073" class="difflineminus">-    {</span>
<a href="#l11.2074"></a><span id="l11.2074" class="difflineminus">-      if (NS_FAILED(rv = addQueryToBookmarks(src)))</span>
<a href="#l11.2075"></a><span id="l11.2075" class="difflineminus">-        return(rv);</span>
<a href="#l11.2076"></a><span id="l11.2076" class="difflineminus">-    }</span>
<a href="#l11.2077"></a><span id="l11.2077" class="difflineminus">-    else if (aCommand == mNC_SearchCommand_FilterResult)</span>
<a href="#l11.2078"></a><span id="l11.2078" class="difflineminus">-    {</span>
<a href="#l11.2079"></a><span id="l11.2079" class="difflineminus">-      if (NS_FAILED(rv = filterResult(src)))</span>
<a href="#l11.2080"></a><span id="l11.2080" class="difflineminus">-        return(rv);</span>
<a href="#l11.2081"></a><span id="l11.2081" class="difflineminus">-    }</span>
<a href="#l11.2082"></a><span id="l11.2082" class="difflineminus">-    else if (aCommand == mNC_SearchCommand_FilterSite)</span>
<a href="#l11.2083"></a><span id="l11.2083" class="difflineminus">-    {</span>
<a href="#l11.2084"></a><span id="l11.2084" class="difflineminus">-      if (NS_FAILED(rv = filterSite(src)))</span>
<a href="#l11.2085"></a><span id="l11.2085" class="difflineminus">-        return(rv);</span>
<a href="#l11.2086"></a><span id="l11.2086" class="difflineminus">-    }</span>
<a href="#l11.2087"></a><span id="l11.2087" class="difflineminus">-    else if (aCommand == mNC_SearchCommand_ClearFilters)</span>
<a href="#l11.2088"></a><span id="l11.2088" class="difflineminus">-    {</span>
<a href="#l11.2089"></a><span id="l11.2089" class="difflineminus">-      if (NS_FAILED(rv = clearFilters()))</span>
<a href="#l11.2090"></a><span id="l11.2090" class="difflineminus">-        return(rv);</span>
<a href="#l11.2091"></a><span id="l11.2091" class="difflineminus">-    }</span>
<a href="#l11.2092"></a><span id="l11.2092" class="difflineminus">-  }</span>
<a href="#l11.2093"></a><span id="l11.2093" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.2094"></a><span id="l11.2094" class="difflineminus">-}</span>
<a href="#l11.2095"></a><span id="l11.2095" class="difflineminus">-</span>
<a href="#l11.2096"></a><span id="l11.2096" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.2097"></a><span id="l11.2097" class="difflineminus">-InternetSearchDataSource::BeginUpdateBatch()</span>
<a href="#l11.2098"></a><span id="l11.2098" class="difflineminus">-{</span>
<a href="#l11.2099"></a><span id="l11.2099" class="difflineminus">-        return mInner-&gt;BeginUpdateBatch();</span>
<a href="#l11.2100"></a><span id="l11.2100" class="difflineminus">-}</span>
<a href="#l11.2101"></a><span id="l11.2101" class="difflineminus">-</span>
<a href="#l11.2102"></a><span id="l11.2102" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.2103"></a><span id="l11.2103" class="difflineminus">-InternetSearchDataSource::EndUpdateBatch()</span>
<a href="#l11.2104"></a><span id="l11.2104" class="difflineminus">-{</span>
<a href="#l11.2105"></a><span id="l11.2105" class="difflineminus">-        return mInner-&gt;EndUpdateBatch();</span>
<a href="#l11.2106"></a><span id="l11.2106" class="difflineminus">-}</span>
<a href="#l11.2107"></a><span id="l11.2107" class="difflineminus">-</span>
<a href="#l11.2108"></a><span id="l11.2108" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.2109"></a><span id="l11.2109" class="difflineminus">-InternetSearchDataSource::AddSearchEngine(const char *engineURL, const char *iconURL,</span>
<a href="#l11.2110"></a><span id="l11.2110" class="difflineminus">-            const PRUnichar *suggestedTitle, const PRUnichar *suggestedCategory)</span>
<a href="#l11.2111"></a><span id="l11.2111" class="difflineminus">-{</span>
<a href="#l11.2112"></a><span id="l11.2112" class="difflineminus">-        return AddSearchEngineInternal(engineURL, iconURL, suggestedTitle,</span>
<a href="#l11.2113"></a><span id="l11.2113" class="difflineminus">-                                       suggestedCategory, nsnull);</span>
<a href="#l11.2114"></a><span id="l11.2114" class="difflineminus">-}</span>
<a href="#l11.2115"></a><span id="l11.2115" class="difflineminus">-</span>
<a href="#l11.2116"></a><span id="l11.2116" class="difflineminus">-nsresult</span>
<a href="#l11.2117"></a><span id="l11.2117" class="difflineminus">-InternetSearchDataSource::AddSearchEngineInternal(const char *engineURL, const char *iconURL,</span>
<a href="#l11.2118"></a><span id="l11.2118" class="difflineminus">-                                                  const PRUnichar *suggestedTitle,</span>
<a href="#l11.2119"></a><span id="l11.2119" class="difflineminus">-                                                  const PRUnichar *suggestedCategory,</span>
<a href="#l11.2120"></a><span id="l11.2120" class="difflineminus">-                                                  nsIRDFResource *aOldEngineResource)</span>
<a href="#l11.2121"></a><span id="l11.2121" class="difflineminus">-{</span>
<a href="#l11.2122"></a><span id="l11.2122" class="difflineminus">-  NS_PRECONDITION(engineURL != nsnull, &quot;null ptr&quot;);</span>
<a href="#l11.2123"></a><span id="l11.2123" class="difflineminus">-  if (!engineURL) return(NS_ERROR_NULL_POINTER);</span>
<a href="#l11.2124"></a><span id="l11.2124" class="difflineminus">-  // Note: iconURL, suggestedTitle &amp; suggestedCategory</span>
<a href="#l11.2125"></a><span id="l11.2125" class="difflineminus">-  // can be null or empty strings, which is OK</span>
<a href="#l11.2126"></a><span id="l11.2126" class="difflineminus">-</span>
<a href="#l11.2127"></a><span id="l11.2127" class="difflineminus">-#ifdef  DEBUG_SEARCH_OUTPUT</span>
<a href="#l11.2128"></a><span id="l11.2128" class="difflineminus">-  printf(&quot;AddSearchEngine: engine='%s'\n&quot;, engineURL);</span>
<a href="#l11.2129"></a><span id="l11.2129" class="difflineminus">-#endif</span>
<a href="#l11.2130"></a><span id="l11.2130" class="difflineminus">-</span>
<a href="#l11.2131"></a><span id="l11.2131" class="difflineminus">-  nsresult  rv = NS_OK;</span>
<a href="#l11.2132"></a><span id="l11.2132" class="difflineminus">-</span>
<a href="#l11.2133"></a><span id="l11.2133" class="difflineminus">-  // mBackgroundLoadGroup is a dynamically created singleton</span>
<a href="#l11.2134"></a><span id="l11.2134" class="difflineminus">-  if (!mBackgroundLoadGroup)</span>
<a href="#l11.2135"></a><span id="l11.2135" class="difflineminus">-  {</span>
<a href="#l11.2136"></a><span id="l11.2136" class="difflineminus">-    if (NS_FAILED(rv = NS_NewLoadGroup(getter_AddRefs(mBackgroundLoadGroup), nsnull)))</span>
<a href="#l11.2137"></a><span id="l11.2137" class="difflineminus">-      return(rv);</span>
<a href="#l11.2138"></a><span id="l11.2138" class="difflineminus">-    if (!mBackgroundLoadGroup)</span>
<a href="#l11.2139"></a><span id="l11.2139" class="difflineminus">-      return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2140"></a><span id="l11.2140" class="difflineminus">-  }</span>
<a href="#l11.2141"></a><span id="l11.2141" class="difflineminus">-</span>
<a href="#l11.2142"></a><span id="l11.2142" class="difflineminus">-  // download engine</span>
<a href="#l11.2143"></a><span id="l11.2143" class="difflineminus">-  nsCOMPtr&lt;nsIInternetSearchContext&gt;  engineContext;</span>
<a href="#l11.2144"></a><span id="l11.2144" class="difflineminus">-  rv = NS_NewInternetSearchContext</span>
<a href="#l11.2145"></a><span id="l11.2145" class="difflineminus">-         (aOldEngineResource? nsIInternetSearchContext::ENGINE_DOWNLOAD_UPDATE_CONTEXT:</span>
<a href="#l11.2146"></a><span id="l11.2146" class="difflineminus">-                              nsIInternetSearchContext::ENGINE_DOWNLOAD_NEW_CONTEXT,</span>
<a href="#l11.2147"></a><span id="l11.2147" class="difflineminus">-          nsnull, aOldEngineResource, nsnull, suggestedCategory,</span>
<a href="#l11.2148"></a><span id="l11.2148" class="difflineminus">-          getter_AddRefs(engineContext));</span>
<a href="#l11.2149"></a><span id="l11.2149" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.2150"></a><span id="l11.2150" class="difflineminus">-</span>
<a href="#l11.2151"></a><span id="l11.2151" class="difflineminus">-  if (!engineContext) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2152"></a><span id="l11.2152" class="difflineminus">-</span>
<a href="#l11.2153"></a><span id="l11.2153" class="difflineminus">-  nsCOMPtr&lt;nsIURI&gt;  engineURI;</span>
<a href="#l11.2154"></a><span id="l11.2154" class="difflineminus">-  if (NS_FAILED(rv = NS_NewURI(getter_AddRefs(engineURI), engineURL)))</span>
<a href="#l11.2155"></a><span id="l11.2155" class="difflineminus">-    return(rv);</span>
<a href="#l11.2156"></a><span id="l11.2156" class="difflineminus">-</span>
<a href="#l11.2157"></a><span id="l11.2157" class="difflineminus">-  nsCOMPtr&lt;nsIChannel&gt;  engineChannel;</span>
<a href="#l11.2158"></a><span id="l11.2158" class="difflineminus">-  if (NS_FAILED(rv = NS_NewChannel(getter_AddRefs(engineChannel), engineURI, nsnull, mBackgroundLoadGroup)))</span>
<a href="#l11.2159"></a><span id="l11.2159" class="difflineminus">-    return(rv);</span>
<a href="#l11.2160"></a><span id="l11.2160" class="difflineminus">-    </span>
<a href="#l11.2161"></a><span id="l11.2161" class="difflineminus">-  if (NS_FAILED(rv = engineChannel-&gt;AsyncOpen(this, engineContext)))</span>
<a href="#l11.2162"></a><span id="l11.2162" class="difflineminus">-    return(rv);</span>
<a href="#l11.2163"></a><span id="l11.2163" class="difflineminus">-</span>
<a href="#l11.2164"></a><span id="l11.2164" class="difflineminus">-  // download icon</span>
<a href="#l11.2165"></a><span id="l11.2165" class="difflineminus">-  nsCOMPtr&lt;nsIInternetSearchContext&gt;  iconContext;</span>
<a href="#l11.2166"></a><span id="l11.2166" class="difflineminus">-  rv = NS_NewInternetSearchContext</span>
<a href="#l11.2167"></a><span id="l11.2167" class="difflineminus">-         (aOldEngineResource? nsIInternetSearchContext::ICON_DOWNLOAD_UPDATE_CONTEXT:</span>
<a href="#l11.2168"></a><span id="l11.2168" class="difflineminus">-                              nsIInternetSearchContext::ICON_DOWNLOAD_NEW_CONTEXT,</span>
<a href="#l11.2169"></a><span id="l11.2169" class="difflineminus">-          nsnull, aOldEngineResource, nsnull, suggestedCategory,</span>
<a href="#l11.2170"></a><span id="l11.2170" class="difflineminus">-          getter_AddRefs(iconContext));</span>
<a href="#l11.2171"></a><span id="l11.2171" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.2172"></a><span id="l11.2172" class="difflineminus">-</span>
<a href="#l11.2173"></a><span id="l11.2173" class="difflineminus">-  if (!iconContext) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2174"></a><span id="l11.2174" class="difflineminus">-</span>
<a href="#l11.2175"></a><span id="l11.2175" class="difflineminus">-  if (iconURL &amp;&amp; (*iconURL))</span>
<a href="#l11.2176"></a><span id="l11.2176" class="difflineminus">-  {</span>
<a href="#l11.2177"></a><span id="l11.2177" class="difflineminus">-    nsCOMPtr&lt;nsIURI&gt;  iconURI;</span>
<a href="#l11.2178"></a><span id="l11.2178" class="difflineminus">-    if (NS_FAILED(rv = NS_NewURI(getter_AddRefs(iconURI), iconURL)))</span>
<a href="#l11.2179"></a><span id="l11.2179" class="difflineminus">-      return(rv);</span>
<a href="#l11.2180"></a><span id="l11.2180" class="difflineminus">-</span>
<a href="#l11.2181"></a><span id="l11.2181" class="difflineminus">-    nsCOMPtr&lt;nsIChannel&gt;  iconChannel;</span>
<a href="#l11.2182"></a><span id="l11.2182" class="difflineminus">-    if (NS_FAILED(rv = NS_NewChannel(getter_AddRefs(iconChannel), iconURI, nsnull, mBackgroundLoadGroup)))</span>
<a href="#l11.2183"></a><span id="l11.2183" class="difflineminus">-      return(rv);</span>
<a href="#l11.2184"></a><span id="l11.2184" class="difflineminus">-    if (NS_FAILED(rv = iconChannel-&gt;AsyncOpen(this, iconContext)))</span>
<a href="#l11.2185"></a><span id="l11.2185" class="difflineminus">-      return(rv);</span>
<a href="#l11.2186"></a><span id="l11.2186" class="difflineminus">-  }</span>
<a href="#l11.2187"></a><span id="l11.2187" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.2188"></a><span id="l11.2188" class="difflineminus">-}</span>
<a href="#l11.2189"></a><span id="l11.2189" class="difflineminus">-</span>
<a href="#l11.2190"></a><span id="l11.2190" class="difflineminus">-</span>
<a href="#l11.2191"></a><span id="l11.2191" class="difflineminus">-</span>
<a href="#l11.2192"></a><span id="l11.2192" class="difflineminus">-nsresult</span>
<a href="#l11.2193"></a><span id="l11.2193" class="difflineminus">-InternetSearchDataSource::saveContents(nsIChannel* channel, nsIInternetSearchContext *context, PRUint32 contextType)</span>
<a href="#l11.2194"></a><span id="l11.2194" class="difflineminus">-{</span>
<a href="#l11.2195"></a><span id="l11.2195" class="difflineminus">-    NS_ASSERTION(contextType == nsIInternetSearchContext::ENGINE_DOWNLOAD_NEW_CONTEXT ||</span>
<a href="#l11.2196"></a><span id="l11.2196" class="difflineminus">-                 contextType == nsIInternetSearchContext::ICON_DOWNLOAD_NEW_CONTEXT ||</span>
<a href="#l11.2197"></a><span id="l11.2197" class="difflineminus">-                 contextType == nsIInternetSearchContext::ENGINE_DOWNLOAD_UPDATE_CONTEXT ||</span>
<a href="#l11.2198"></a><span id="l11.2198" class="difflineminus">-                 contextType == nsIInternetSearchContext::ICON_DOWNLOAD_UPDATE_CONTEXT,</span>
<a href="#l11.2199"></a><span id="l11.2199" class="difflineminus">-                 &quot;unexpected context&quot;);</span>
<a href="#l11.2200"></a><span id="l11.2200" class="difflineminus">-  nsresult  rv = NS_OK;</span>
<a href="#l11.2201"></a><span id="l11.2201" class="difflineminus">-</span>
<a href="#l11.2202"></a><span id="l11.2202" class="difflineminus">-  if (!channel) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2203"></a><span id="l11.2203" class="difflineminus">-  if (!context) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2204"></a><span id="l11.2204" class="difflineminus">-</span>
<a href="#l11.2205"></a><span id="l11.2205" class="difflineminus">-  // get real URI</span>
<a href="#l11.2206"></a><span id="l11.2206" class="difflineminus">-  nsCOMPtr&lt;nsIURI&gt;  channelURI;</span>
<a href="#l11.2207"></a><span id="l11.2207" class="difflineminus">-  if (NS_FAILED(rv = channel-&gt;GetURI(getter_AddRefs(channelURI))))</span>
<a href="#l11.2208"></a><span id="l11.2208" class="difflineminus">-    return(rv);</span>
<a href="#l11.2209"></a><span id="l11.2209" class="difflineminus">-  if (!channelURI)</span>
<a href="#l11.2210"></a><span id="l11.2210" class="difflineminus">-    return(NS_ERROR_NULL_POINTER);</span>
<a href="#l11.2211"></a><span id="l11.2211" class="difflineminus">-</span>
<a href="#l11.2212"></a><span id="l11.2212" class="difflineminus">-  nsCAutoString baseName;</span>
<a href="#l11.2213"></a><span id="l11.2213" class="difflineminus">-  if (NS_FAILED(rv = channelURI-&gt;GetSpec(baseName)))</span>
<a href="#l11.2214"></a><span id="l11.2214" class="difflineminus">-    return(rv);</span>
<a href="#l11.2215"></a><span id="l11.2215" class="difflineminus">-</span>
<a href="#l11.2216"></a><span id="l11.2216" class="difflineminus">-  PRInt32     slashOffset = baseName.RFindChar(PRUnichar('/'));</span>
<a href="#l11.2217"></a><span id="l11.2217" class="difflineminus">-  if (slashOffset &lt; 0)    return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2218"></a><span id="l11.2218" class="difflineminus">-  baseName.Cut(0, slashOffset+1);</span>
<a href="#l11.2219"></a><span id="l11.2219" class="difflineminus">-  if (baseName.IsEmpty()) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2220"></a><span id="l11.2220" class="difflineminus">-</span>
<a href="#l11.2221"></a><span id="l11.2221" class="difflineminus">-  // make sure that search engines are .src files</span>
<a href="#l11.2222"></a><span id="l11.2222" class="difflineminus">-  if (contextType == nsIInternetSearchContext::ENGINE_DOWNLOAD_NEW_CONTEXT ||</span>
<a href="#l11.2223"></a><span id="l11.2223" class="difflineminus">-    contextType == nsIInternetSearchContext::ENGINE_DOWNLOAD_UPDATE_CONTEXT)</span>
<a href="#l11.2224"></a><span id="l11.2224" class="difflineminus">-  {</span>
<a href="#l11.2225"></a><span id="l11.2225" class="difflineminus">-    if (!StringEndsWith(baseName, NS_LITERAL_CSTRING(&quot;.src&quot;), CaseInsensitiveCompare))</span>
<a href="#l11.2226"></a><span id="l11.2226" class="difflineminus">-    {</span>
<a href="#l11.2227"></a><span id="l11.2227" class="difflineminus">-      return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2228"></a><span id="l11.2228" class="difflineminus">-    }</span>
<a href="#l11.2229"></a><span id="l11.2229" class="difflineminus">-  }</span>
<a href="#l11.2230"></a><span id="l11.2230" class="difflineminus">-</span>
<a href="#l11.2231"></a><span id="l11.2231" class="difflineminus">-    nsCOMPtr&lt;nsIFile&gt; outFile;</span>
<a href="#l11.2232"></a><span id="l11.2232" class="difflineminus">-  // If the mode is &quot;UPDATE&quot;, the output dir is same as the original file</span>
<a href="#l11.2233"></a><span id="l11.2233" class="difflineminus">-  // location. Otherwise (&quot;NEW&quot; mode), located in NS_APP_USER_SEARCH_DIR.</span>
<a href="#l11.2234"></a><span id="l11.2234" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; oldResource;</span>
<a href="#l11.2235"></a><span id="l11.2235" class="difflineminus">-  rv = context-&gt;GetEngine(getter_AddRefs(oldResource));</span>
<a href="#l11.2236"></a><span id="l11.2236" class="difflineminus">-</span>
<a href="#l11.2237"></a><span id="l11.2237" class="difflineminus">-  if (oldResource) {</span>
<a href="#l11.2238"></a><span id="l11.2238" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; oldEngineFile;</span>
<a href="#l11.2239"></a><span id="l11.2239" class="difflineminus">-    rv = EngineFileFromResource(oldResource, getter_AddRefs(oldEngineFile));</span>
<a href="#l11.2240"></a><span id="l11.2240" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.2241"></a><span id="l11.2241" class="difflineminus">-</span>
<a href="#l11.2242"></a><span id="l11.2242" class="difflineminus">-    rv = oldEngineFile-&gt;GetParent(getter_AddRefs(outFile));</span>
<a href="#l11.2243"></a><span id="l11.2243" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.2244"></a><span id="l11.2244" class="difflineminus">-  }</span>
<a href="#l11.2245"></a><span id="l11.2245" class="difflineminus">-  else {</span>
<a href="#l11.2246"></a><span id="l11.2246" class="difflineminus">-    rv = NS_GetSpecialDirectory(NS_APP_USER_SEARCH_DIR, getter_AddRefs(outFile));</span>
<a href="#l11.2247"></a><span id="l11.2247" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l11.2248"></a><span id="l11.2248" class="difflineminus">-        return rv;</span>
<a href="#l11.2249"></a><span id="l11.2249" class="difflineminus">-  }</span>
<a href="#l11.2250"></a><span id="l11.2250" class="difflineminus">-</span>
<a href="#l11.2251"></a><span id="l11.2251" class="difflineminus">-    PRBool exists;</span>
<a href="#l11.2252"></a><span id="l11.2252" class="difflineminus">-    rv = outFile-&gt;Exists(&amp;exists);</span>
<a href="#l11.2253"></a><span id="l11.2253" class="difflineminus">-    if (NS_FAILED(rv)) return(rv);</span>
<a href="#l11.2254"></a><span id="l11.2254" class="difflineminus">-    if (!exists)</span>
<a href="#l11.2255"></a><span id="l11.2255" class="difflineminus">-    {</span>
<a href="#l11.2256"></a><span id="l11.2256" class="difflineminus">-        rv = outFile-&gt;Create(nsIFile::DIRECTORY_TYPE, 0755);</span>
<a href="#l11.2257"></a><span id="l11.2257" class="difflineminus">-        if (NS_FAILED(rv)) return(rv);</span>
<a href="#l11.2258"></a><span id="l11.2258" class="difflineminus">-    }</span>
<a href="#l11.2259"></a><span id="l11.2259" class="difflineminus">-</span>
<a href="#l11.2260"></a><span id="l11.2260" class="difflineminus">-  const PRUnichar *dataBuf = nsnull;</span>
<a href="#l11.2261"></a><span id="l11.2261" class="difflineminus">-  if (NS_FAILED(rv = context-&gt;GetBufferConst(&amp;dataBuf)))  return(rv);</span>
<a href="#l11.2262"></a><span id="l11.2262" class="difflineminus">-</span>
<a href="#l11.2263"></a><span id="l11.2263" class="difflineminus">-  // if no data, then nothing to do</span>
<a href="#l11.2264"></a><span id="l11.2264" class="difflineminus">-  // Note: do this before opening file, as it would be truncated</span>
<a href="#l11.2265"></a><span id="l11.2265" class="difflineminus">-  PRInt32   bufferLength = 0;</span>
<a href="#l11.2266"></a><span id="l11.2266" class="difflineminus">-  if (NS_FAILED(context-&gt;GetBufferLength(&amp;bufferLength))) return(rv);</span>
<a href="#l11.2267"></a><span id="l11.2267" class="difflineminus">-  if (bufferLength &lt; 1) return(NS_OK);</span>
<a href="#l11.2268"></a><span id="l11.2268" class="difflineminus">-  </span>
<a href="#l11.2269"></a><span id="l11.2269" class="difflineminus">-  rv = outFile-&gt;Append(NS_ConvertUTF8toUTF16(baseName));</span>
<a href="#l11.2270"></a><span id="l11.2270" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.2271"></a><span id="l11.2271" class="difflineminus">-  </span>
<a href="#l11.2272"></a><span id="l11.2272" class="difflineminus">-  // save data to file</span>
<a href="#l11.2273"></a><span id="l11.2273" class="difflineminus">-  // Note: write out one character at a time, as we might be dealing</span>
<a href="#l11.2274"></a><span id="l11.2274" class="difflineminus">-  //       with binary data (such as 0x00) [especially for images]</span>
<a href="#l11.2275"></a><span id="l11.2275" class="difflineminus">-    //</span>
<a href="#l11.2276"></a><span id="l11.2276" class="difflineminus">-    // XXX - It appears that this is done in order to discard the upper</span>
<a href="#l11.2277"></a><span id="l11.2277" class="difflineminus">-    // byte of each PRUnichar.  I hope that's OK!!</span>
<a href="#l11.2278"></a><span id="l11.2278" class="difflineminus">-    //</span>
<a href="#l11.2279"></a><span id="l11.2279" class="difflineminus">-    if (contextType == nsIInternetSearchContext::ENGINE_DOWNLOAD_UPDATE_CONTEXT ||</span>
<a href="#l11.2280"></a><span id="l11.2280" class="difflineminus">-        contextType == nsIInternetSearchContext::ICON_DOWNLOAD_UPDATE_CONTEXT) {</span>
<a href="#l11.2281"></a><span id="l11.2281" class="difflineminus">-        // This is an update operation that we triggered.  Remove the old one.</span>
<a href="#l11.2282"></a><span id="l11.2282" class="difflineminus">-        outFile-&gt;Remove(PR_FALSE);</span>
<a href="#l11.2283"></a><span id="l11.2283" class="difflineminus">-    } else {</span>
<a href="#l11.2284"></a><span id="l11.2284" class="difflineminus">-        PRBool exists;</span>
<a href="#l11.2285"></a><span id="l11.2285" class="difflineminus">-        rv = outFile-&gt;Exists(&amp;exists);</span>
<a href="#l11.2286"></a><span id="l11.2286" class="difflineminus">-        if (NS_FAILED(rv) || exists) {</span>
<a href="#l11.2287"></a><span id="l11.2287" class="difflineminus">-            // We already have a search plugin with this filename; don't</span>
<a href="#l11.2288"></a><span id="l11.2288" class="difflineminus">-            // replace it (bug 290038).</span>
<a href="#l11.2289"></a><span id="l11.2289" class="difflineminus">-            return NS_ERROR_UNEXPECTED;</span>
<a href="#l11.2290"></a><span id="l11.2290" class="difflineminus">-        }</span>
<a href="#l11.2291"></a><span id="l11.2291" class="difflineminus">-    }</span>
<a href="#l11.2292"></a><span id="l11.2292" class="difflineminus">-</span>
<a href="#l11.2293"></a><span id="l11.2293" class="difflineminus">-    nsCOMPtr&lt;nsIOutputStream&gt; outputStream, fileOutputStream;</span>
<a href="#l11.2294"></a><span id="l11.2294" class="difflineminus">-    rv = NS_NewLocalFileOutputStream(getter_AddRefs(fileOutputStream), outFile);</span>
<a href="#l11.2295"></a><span id="l11.2295" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.2296"></a><span id="l11.2296" class="difflineminus">-    rv = NS_NewBufferedOutputStream(getter_AddRefs(outputStream), fileOutputStream, 4096);</span>
<a href="#l11.2297"></a><span id="l11.2297" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.2298"></a><span id="l11.2298" class="difflineminus">-</span>
<a href="#l11.2299"></a><span id="l11.2299" class="difflineminus">-    PRUint32 bytesWritten;</span>
<a href="#l11.2300"></a><span id="l11.2300" class="difflineminus">-    for (PRInt32 loop=0; loop &lt; bufferLength; loop++)</span>
<a href="#l11.2301"></a><span id="l11.2301" class="difflineminus">-    {</span>
<a href="#l11.2302"></a><span id="l11.2302" class="difflineminus">-        const char b = (const char) dataBuf[loop];</span>
<a href="#l11.2303"></a><span id="l11.2303" class="difflineminus">-        outputStream-&gt;Write(&amp;b, 1, &amp;bytesWritten);</span>
<a href="#l11.2304"></a><span id="l11.2304" class="difflineminus">-    }</span>
<a href="#l11.2305"></a><span id="l11.2305" class="difflineminus">-    outputStream-&gt;Flush();    </span>
<a href="#l11.2306"></a><span id="l11.2306" class="difflineminus">-    outputStream-&gt;Close();</span>
<a href="#l11.2307"></a><span id="l11.2307" class="difflineminus">-</span>
<a href="#l11.2308"></a><span id="l11.2308" class="difflineminus">-    if (contextType == nsIInternetSearchContext::ENGINE_DOWNLOAD_NEW_CONTEXT ||</span>
<a href="#l11.2309"></a><span id="l11.2309" class="difflineminus">-        contextType == nsIInternetSearchContext::ENGINE_DOWNLOAD_UPDATE_CONTEXT)</span>
<a href="#l11.2310"></a><span id="l11.2310" class="difflineminus">-    {</span>
<a href="#l11.2311"></a><span id="l11.2311" class="difflineminus">-        // check suggested category hint</span>
<a href="#l11.2312"></a><span id="l11.2312" class="difflineminus">-        const PRUnichar *hintUni = nsnull;</span>
<a href="#l11.2313"></a><span id="l11.2313" class="difflineminus">-        rv = context-&gt;GetHintConst(&amp;hintUni);</span>
<a href="#l11.2314"></a><span id="l11.2314" class="difflineminus">-</span>
<a href="#l11.2315"></a><span id="l11.2315" class="difflineminus">-        // update graph with various required info</span>
<a href="#l11.2316"></a><span id="l11.2316" class="difflineminus">-        SaveEngineInfoIntoGraph(outFile, nsnull, hintUni, dataBuf, PR_FALSE);</span>
<a href="#l11.2317"></a><span id="l11.2317" class="difflineminus">-    }</span>
<a href="#l11.2318"></a><span id="l11.2318" class="difflineminus">-    else if (contextType == nsIInternetSearchContext::ICON_DOWNLOAD_NEW_CONTEXT ||</span>
<a href="#l11.2319"></a><span id="l11.2319" class="difflineminus">-             contextType == nsIInternetSearchContext::ICON_DOWNLOAD_UPDATE_CONTEXT)</span>
<a href="#l11.2320"></a><span id="l11.2320" class="difflineminus">-    {</span>
<a href="#l11.2321"></a><span id="l11.2321" class="difflineminus">-        // update graph with icon info</span>
<a href="#l11.2322"></a><span id="l11.2322" class="difflineminus">-        SaveEngineInfoIntoGraph(nsnull, outFile, nsnull, nsnull, PR_FALSE);</span>
<a href="#l11.2323"></a><span id="l11.2323" class="difflineminus">-    }</span>
<a href="#l11.2324"></a><span id="l11.2324" class="difflineminus">-</span>
<a href="#l11.2325"></a><span id="l11.2325" class="difflineminus">-  // after we're all done with the data buffer, get rid of it</span>
<a href="#l11.2326"></a><span id="l11.2326" class="difflineminus">-  context-&gt;Truncate();</span>
<a href="#l11.2327"></a><span id="l11.2327" class="difflineminus">-</span>
<a href="#l11.2328"></a><span id="l11.2328" class="difflineminus">-  return(rv);</span>
<a href="#l11.2329"></a><span id="l11.2329" class="difflineminus">-}</span>
<a href="#l11.2330"></a><span id="l11.2330" class="difflineminus">-</span>
<a href="#l11.2331"></a><span id="l11.2331" class="difflineminus">-</span>
<a href="#l11.2332"></a><span id="l11.2332" class="difflineminus">-</span>
<a href="#l11.2333"></a><span id="l11.2333" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.2334"></a><span id="l11.2334" class="difflineminus">-InternetSearchDataSource::GetInternetSearchURL(const char *searchEngineURI,</span>
<a href="#l11.2335"></a><span id="l11.2335" class="difflineminus">-  const PRUnichar *searchStr, PRInt16 direction, PRUint16 pageNumber, </span>
<a href="#l11.2336"></a><span id="l11.2336" class="difflineminus">-  PRUint16 *whichButtons, PRUnichar **resultURL)</span>
<a href="#l11.2337"></a><span id="l11.2337" class="difflineminus">-{</span>
<a href="#l11.2338"></a><span id="l11.2338" class="difflineminus">-  if (!resultURL) return(NS_ERROR_NULL_POINTER);</span>
<a href="#l11.2339"></a><span id="l11.2339" class="difflineminus">-  *resultURL = nsnull;</span>
<a href="#l11.2340"></a><span id="l11.2340" class="difflineminus">-</span>
<a href="#l11.2341"></a><span id="l11.2341" class="difflineminus">-  // if we haven't already, load in the engines</span>
<a href="#l11.2342"></a><span id="l11.2342" class="difflineminus">-  if (!mEngineListBuilt)</span>
<a href="#l11.2343"></a><span id="l11.2343" class="difflineminus">-    DeferredInit();</span>
<a href="#l11.2344"></a><span id="l11.2344" class="difflineminus">-</span>
<a href="#l11.2345"></a><span id="l11.2345" class="difflineminus">-  nsresult      rv;</span>
<a href="#l11.2346"></a><span id="l11.2346" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  engine;</span>
<a href="#l11.2347"></a><span id="l11.2347" class="difflineminus">-  rv = mRDFService-&gt;GetResource(nsDependentCString(searchEngineURI),</span>
<a href="#l11.2348"></a><span id="l11.2348" class="difflineminus">-                                getter_AddRefs(engine));</span>
<a href="#l11.2349"></a><span id="l11.2349" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.2350"></a><span id="l11.2350" class="difflineminus">-</span>
<a href="#l11.2351"></a><span id="l11.2351" class="difflineminus">-  validateEngine(engine);</span>
<a href="#l11.2352"></a><span id="l11.2352" class="difflineminus">-  </span>
<a href="#l11.2353"></a><span id="l11.2353" class="difflineminus">-  // if it's an engine from a search category, then get its &quot;#Name&quot;,</span>
<a href="#l11.2354"></a><span id="l11.2354" class="difflineminus">-  // and try to map from that back to the real engine reference</span>
<a href="#l11.2355"></a><span id="l11.2355" class="difflineminus">-  if (isSearchCategoryEngineURI(engine))</span>
<a href="#l11.2356"></a><span id="l11.2356" class="difflineminus">-  {</span>
<a href="#l11.2357"></a><span id="l11.2357" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt;  trueEngine;</span>
<a href="#l11.2358"></a><span id="l11.2358" class="difflineminus">-    rv = resolveSearchCategoryEngineURI(engine, getter_AddRefs(trueEngine));</span>
<a href="#l11.2359"></a><span id="l11.2359" class="difflineminus">-    if (NS_FAILED(rv) || (rv == NS_RDF_NO_VALUE)) return(rv);</span>
<a href="#l11.2360"></a><span id="l11.2360" class="difflineminus">-    if (!trueEngine)  return(NS_RDF_NO_VALUE);</span>
<a href="#l11.2361"></a><span id="l11.2361" class="difflineminus">-</span>
<a href="#l11.2362"></a><span id="l11.2362" class="difflineminus">-    engine = trueEngine;</span>
<a href="#l11.2363"></a><span id="l11.2363" class="difflineminus">-  }</span>
<a href="#l11.2364"></a><span id="l11.2364" class="difflineminus">-</span>
<a href="#l11.2365"></a><span id="l11.2365" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; dataLit;</span>
<a href="#l11.2366"></a><span id="l11.2366" class="difflineminus">-  rv = FindData(engine, getter_AddRefs(dataLit));</span>
<a href="#l11.2367"></a><span id="l11.2367" class="difflineminus">-  if (NS_FAILED(rv) ||</span>
<a href="#l11.2368"></a><span id="l11.2368" class="difflineminus">-      (rv == NS_RDF_NO_VALUE))  return(rv);</span>
<a href="#l11.2369"></a><span id="l11.2369" class="difflineminus">-  if (!dataLit) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2370"></a><span id="l11.2370" class="difflineminus">-</span>
<a href="#l11.2371"></a><span id="l11.2371" class="difflineminus">-  const PRUnichar *dataUni = nsnull;</span>
<a href="#l11.2372"></a><span id="l11.2372" class="difflineminus">-  dataLit-&gt;GetValueConst(&amp;dataUni);</span>
<a href="#l11.2373"></a><span id="l11.2373" class="difflineminus">-  if (!dataUni) return(NS_RDF_NO_VALUE);</span>
<a href="#l11.2374"></a><span id="l11.2374" class="difflineminus">-</span>
<a href="#l11.2375"></a><span id="l11.2375" class="difflineminus">-  nsAutoString   text(searchStr), encodingStr, queryEncodingStr;</span>
<a href="#l11.2376"></a><span id="l11.2376" class="difflineminus">-</span>
<a href="#l11.2377"></a><span id="l11.2377" class="difflineminus">-  // first look for &quot;search/queryCharset&quot;... if that isn't specified,</span>
<a href="#l11.2378"></a><span id="l11.2378" class="difflineminus">-  // then fall back to looking for &quot;search/queryEncoding&quot; (a decimal)</span>
<a href="#l11.2379"></a><span id="l11.2379" class="difflineminus">-  GetData(dataUni, &quot;search&quot;, 0, &quot;queryCharset&quot;, queryEncodingStr);</span>
<a href="#l11.2380"></a><span id="l11.2380" class="difflineminus">-       if (queryEncodingStr.IsEmpty())</span>
<a href="#l11.2381"></a><span id="l11.2381" class="difflineminus">-  {</span>
<a href="#l11.2382"></a><span id="l11.2382" class="difflineminus">-    GetData(dataUni, &quot;search&quot;, 0, &quot;queryEncoding&quot;, encodingStr);    // decimal string values</span>
<a href="#l11.2383"></a><span id="l11.2383" class="difflineminus">-    MapEncoding(encodingStr, queryEncodingStr);</span>
<a href="#l11.2384"></a><span id="l11.2384" class="difflineminus">-  }</span>
<a href="#l11.2385"></a><span id="l11.2385" class="difflineminus">-</span>
<a href="#l11.2386"></a><span id="l11.2386" class="difflineminus">-  if (!queryEncodingStr.IsEmpty())</span>
<a href="#l11.2387"></a><span id="l11.2387" class="difflineminus">-  {</span>
<a href="#l11.2388"></a><span id="l11.2388" class="difflineminus">-    // remember query charset string</span>
<a href="#l11.2389"></a><span id="l11.2389" class="difflineminus">-    mQueryEncodingStr = queryEncodingStr;</span>
<a href="#l11.2390"></a><span id="l11.2390" class="difflineminus">-    // convert from escaped-UTF_8, to unicode, and then to</span>
<a href="#l11.2391"></a><span id="l11.2391" class="difflineminus">-    // the escaped version of the charset indicated by the dataset in question</span>
<a href="#l11.2392"></a><span id="l11.2392" class="difflineminus">-</span>
<a href="#l11.2393"></a><span id="l11.2393" class="difflineminus">-    char  *utf8data = ToNewUTF8String(text);</span>
<a href="#l11.2394"></a><span id="l11.2394" class="difflineminus">-    if (utf8data)</span>
<a href="#l11.2395"></a><span id="l11.2395" class="difflineminus">-    {</span>
<a href="#l11.2396"></a><span id="l11.2396" class="difflineminus">-      nsCOMPtr&lt;nsITextToSubURI&gt; textToSubURI = </span>
<a href="#l11.2397"></a><span id="l11.2397" class="difflineminus">-               do_GetService(kTextToSubURICID, &amp;rv);</span>
<a href="#l11.2398"></a><span id="l11.2398" class="difflineminus">-      if (NS_SUCCEEDED(rv) &amp;&amp; (textToSubURI))</span>
<a href="#l11.2399"></a><span id="l11.2399" class="difflineminus">-      {</span>
<a href="#l11.2400"></a><span id="l11.2400" class="difflineminus">-        PRUnichar *uni = nsnull;</span>
<a href="#l11.2401"></a><span id="l11.2401" class="difflineminus">-        if (NS_SUCCEEDED(rv = textToSubURI-&gt;UnEscapeAndConvert(&quot;UTF-8&quot;, utf8data, &amp;uni)) &amp;&amp; (uni))</span>
<a href="#l11.2402"></a><span id="l11.2402" class="difflineminus">-        {</span>
<a href="#l11.2403"></a><span id="l11.2403" class="difflineminus">-          char    *charsetData = nsnull;</span>
<a href="#l11.2404"></a><span id="l11.2404" class="difflineminus">-          rv = textToSubURI-&gt;ConvertAndEscape(NS_LossyConvertUTF16toASCII(queryEncodingStr).get(),</span>
<a href="#l11.2405"></a><span id="l11.2405" class="difflineminus">-                                              uni,</span>
<a href="#l11.2406"></a><span id="l11.2406" class="difflineminus">-                                              &amp;charsetData);</span>
<a href="#l11.2407"></a><span id="l11.2407" class="difflineminus">-          if (NS_SUCCEEDED(rv) &amp;&amp; charsetData)</span>
<a href="#l11.2408"></a><span id="l11.2408" class="difflineminus">-          {</span>
<a href="#l11.2409"></a><span id="l11.2409" class="difflineminus">-            CopyASCIItoUTF16(nsDependentCString(charsetData), text);</span>
<a href="#l11.2410"></a><span id="l11.2410" class="difflineminus">-            NS_Free(charsetData);</span>
<a href="#l11.2411"></a><span id="l11.2411" class="difflineminus">-          }</span>
<a href="#l11.2412"></a><span id="l11.2412" class="difflineminus">-          NS_Free(uni);</span>
<a href="#l11.2413"></a><span id="l11.2413" class="difflineminus">-        }</span>
<a href="#l11.2414"></a><span id="l11.2414" class="difflineminus">-      }</span>
<a href="#l11.2415"></a><span id="l11.2415" class="difflineminus">-      NS_Free(utf8data);</span>
<a href="#l11.2416"></a><span id="l11.2416" class="difflineminus">-    }</span>
<a href="#l11.2417"></a><span id="l11.2417" class="difflineminus">-  }</span>
<a href="#l11.2418"></a><span id="l11.2418" class="difflineminus">-  </span>
<a href="#l11.2419"></a><span id="l11.2419" class="difflineminus">-  nsAutoString  action, input, method, userVar, name;</span>
<a href="#l11.2420"></a><span id="l11.2420" class="difflineminus">-  if (NS_FAILED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;action&quot;, action)))</span>
<a href="#l11.2421"></a><span id="l11.2421" class="difflineminus">-      return(rv);</span>
<a href="#l11.2422"></a><span id="l11.2422" class="difflineminus">-</span>
<a href="#l11.2423"></a><span id="l11.2423" class="difflineminus">-    // Search only supports the http protocol</span>
<a href="#l11.2424"></a><span id="l11.2424" class="difflineminus">-    if (!StringBeginsWith(action, NS_LITERAL_STRING(&quot;http:&quot;)) &amp;&amp;</span>
<a href="#l11.2425"></a><span id="l11.2425" class="difflineminus">-        !StringBeginsWith(action, NS_LITERAL_STRING(&quot;https:&quot;)))</span>
<a href="#l11.2426"></a><span id="l11.2426" class="difflineminus">-        return NS_ERROR_UNEXPECTED;</span>
<a href="#l11.2427"></a><span id="l11.2427" class="difflineminus">-</span>
<a href="#l11.2428"></a><span id="l11.2428" class="difflineminus">-  if (NS_FAILED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;method&quot;, method)))</span>
<a href="#l11.2429"></a><span id="l11.2429" class="difflineminus">-      return(rv);</span>
<a href="#l11.2430"></a><span id="l11.2430" class="difflineminus">-  if (NS_FAILED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;name&quot;, name)))</span>
<a href="#l11.2431"></a><span id="l11.2431" class="difflineminus">-      return(rv);</span>
<a href="#l11.2432"></a><span id="l11.2432" class="difflineminus">-  if (NS_FAILED(rv = GetInputs(dataUni, name, userVar, text, input, direction, pageNumber, whichButtons)))</span>
<a href="#l11.2433"></a><span id="l11.2433" class="difflineminus">-      return(rv);</span>
<a href="#l11.2434"></a><span id="l11.2434" class="difflineminus">-  // if the search string is null add a placeholder for the search string</span>
<a href="#l11.2435"></a><span id="l11.2435" class="difflineminus">-  if (!searchStr)</span>
<a href="#l11.2436"></a><span id="l11.2436" class="difflineminus">-  {</span>
<a href="#l11.2437"></a><span id="l11.2437" class="difflineminus">-    input.Append(input.IsEmpty() ? '?' : '&amp;');</span>
<a href="#l11.2438"></a><span id="l11.2438" class="difflineminus">-    input.Append(userVar);</span>
<a href="#l11.2439"></a><span id="l11.2439" class="difflineminus">-    input.Append('=');</span>
<a href="#l11.2440"></a><span id="l11.2440" class="difflineminus">-  }</span>
<a href="#l11.2441"></a><span id="l11.2441" class="difflineminus">-  if (input.IsEmpty())        return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2442"></a><span id="l11.2442" class="difflineminus">-</span>
<a href="#l11.2443"></a><span id="l11.2443" class="difflineminus">-  // we can only handle HTTP GET</span>
<a href="#l11.2444"></a><span id="l11.2444" class="difflineminus">-  if (!method.LowerCaseEqualsLiteral(&quot;get&quot;))  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2445"></a><span id="l11.2445" class="difflineminus">-  // HTTP Get method support</span>
<a href="#l11.2446"></a><span id="l11.2446" class="difflineminus">-  action += input;</span>
<a href="#l11.2447"></a><span id="l11.2447" class="difflineminus">-</span>
<a href="#l11.2448"></a><span id="l11.2448" class="difflineminus">-  // return a copy of the resulting search URL</span>
<a href="#l11.2449"></a><span id="l11.2449" class="difflineminus">-  *resultURL = ToNewUnicode(action);</span>
<a href="#l11.2450"></a><span id="l11.2450" class="difflineminus">-  if (!resultURL)</span>
<a href="#l11.2451"></a><span id="l11.2451" class="difflineminus">-      return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l11.2452"></a><span id="l11.2452" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.2453"></a><span id="l11.2453" class="difflineminus">-}</span>
<a href="#l11.2454"></a><span id="l11.2454" class="difflineminus">-</span>
<a href="#l11.2455"></a><span id="l11.2455" class="difflineminus">-</span>
<a href="#l11.2456"></a><span id="l11.2456" class="difflineminus">-</span>
<a href="#l11.2457"></a><span id="l11.2457" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.2458"></a><span id="l11.2458" class="difflineminus">-InternetSearchDataSource::RememberLastSearchText(const PRUnichar *escapedSearchStr)</span>
<a href="#l11.2459"></a><span id="l11.2459" class="difflineminus">-{</span>
<a href="#l11.2460"></a><span id="l11.2460" class="difflineminus">-  nsresult    rv;</span>
<a href="#l11.2461"></a><span id="l11.2461" class="difflineminus">-</span>
<a href="#l11.2462"></a><span id="l11.2462" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt;  textNode;</span>
<a href="#l11.2463"></a><span id="l11.2463" class="difflineminus">-  if (NS_SUCCEEDED(rv = mInner-&gt;GetTarget(mNC_LastSearchRoot, mNC_LastText, PR_TRUE,</span>
<a href="#l11.2464"></a><span id="l11.2464" class="difflineminus">-    getter_AddRefs(textNode))))</span>
<a href="#l11.2465"></a><span id="l11.2465" class="difflineminus">-  {</span>
<a href="#l11.2466"></a><span id="l11.2466" class="difflineminus">-    if (escapedSearchStr != nsnull)</span>
<a href="#l11.2467"></a><span id="l11.2467" class="difflineminus">-    {</span>
<a href="#l11.2468"></a><span id="l11.2468" class="difflineminus">-      nsresult    temprv;</span>
<a href="#l11.2469"></a><span id="l11.2469" class="difflineminus">-      nsCOMPtr&lt;nsIRDFLiteral&gt; textLiteral;</span>
<a href="#l11.2470"></a><span id="l11.2470" class="difflineminus">-      if (NS_SUCCEEDED(temprv = mRDFService-&gt;GetLiteral(escapedSearchStr, getter_AddRefs(textLiteral))))</span>
<a href="#l11.2471"></a><span id="l11.2471" class="difflineminus">-      {</span>
<a href="#l11.2472"></a><span id="l11.2472" class="difflineminus">-        if (rv != NS_RDF_NO_VALUE)</span>
<a href="#l11.2473"></a><span id="l11.2473" class="difflineminus">-        {</span>
<a href="#l11.2474"></a><span id="l11.2474" class="difflineminus">-          mInner-&gt;Change(mNC_LastSearchRoot, mNC_LastText, textNode, textLiteral);</span>
<a href="#l11.2475"></a><span id="l11.2475" class="difflineminus">-        }</span>
<a href="#l11.2476"></a><span id="l11.2476" class="difflineminus">-        else</span>
<a href="#l11.2477"></a><span id="l11.2477" class="difflineminus">-        {</span>
<a href="#l11.2478"></a><span id="l11.2478" class="difflineminus">-          mInner-&gt;Assert(mNC_LastSearchRoot, mNC_LastText, textLiteral, PR_TRUE);</span>
<a href="#l11.2479"></a><span id="l11.2479" class="difflineminus">-        }</span>
<a href="#l11.2480"></a><span id="l11.2480" class="difflineminus">-      }</span>
<a href="#l11.2481"></a><span id="l11.2481" class="difflineminus">-    }</span>
<a href="#l11.2482"></a><span id="l11.2482" class="difflineminus">-    else if (rv != NS_RDF_NO_VALUE)</span>
<a href="#l11.2483"></a><span id="l11.2483" class="difflineminus">-    {</span>
<a href="#l11.2484"></a><span id="l11.2484" class="difflineminus">-      rv = mInner-&gt;Unassert(mNC_LastSearchRoot, mNC_LastText, textNode);</span>
<a href="#l11.2485"></a><span id="l11.2485" class="difflineminus">-    }</span>
<a href="#l11.2486"></a><span id="l11.2486" class="difflineminus">-  }</span>
<a href="#l11.2487"></a><span id="l11.2487" class="difflineminus">-  return(rv);</span>
<a href="#l11.2488"></a><span id="l11.2488" class="difflineminus">-}</span>
<a href="#l11.2489"></a><span id="l11.2489" class="difflineminus">-</span>
<a href="#l11.2490"></a><span id="l11.2490" class="difflineminus">-</span>
<a href="#l11.2491"></a><span id="l11.2491" class="difflineminus">-</span>
<a href="#l11.2492"></a><span id="l11.2492" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.2493"></a><span id="l11.2493" class="difflineminus">-InternetSearchDataSource::FindInternetSearchResults(const char *url, PRBool *searchInProgress)</span>
<a href="#l11.2494"></a><span id="l11.2494" class="difflineminus">-{</span>
<a href="#l11.2495"></a><span id="l11.2495" class="difflineminus">-  *searchInProgress = PR_FALSE;</span>
<a href="#l11.2496"></a><span id="l11.2496" class="difflineminus">-</span>
<a href="#l11.2497"></a><span id="l11.2497" class="difflineminus">-  if (!mInner)  return(NS_OK);</span>
<a href="#l11.2498"></a><span id="l11.2498" class="difflineminus">-</span>
<a href="#l11.2499"></a><span id="l11.2499" class="difflineminus">-  // if the url doesn't look like a HTTP GET query, just return,</span>
<a href="#l11.2500"></a><span id="l11.2500" class="difflineminus">-  // otherwise strip off the query data</span>
<a href="#l11.2501"></a><span id="l11.2501" class="difflineminus">-  nsAutoString    shortURL;</span>
<a href="#l11.2502"></a><span id="l11.2502" class="difflineminus">-  CopyASCIItoUTF16(nsDependentCString(url), shortURL);</span>
<a href="#l11.2503"></a><span id="l11.2503" class="difflineminus">-  PRInt32     optionsOffset;</span>
<a href="#l11.2504"></a><span id="l11.2504" class="difflineminus">-  if ((optionsOffset = shortURL.FindChar(PRUnichar('?'))) &lt; 0)  return(NS_OK);</span>
<a href="#l11.2505"></a><span id="l11.2505" class="difflineminus">-  shortURL.SetLength(optionsOffset);</span>
<a href="#l11.2506"></a><span id="l11.2506" class="difflineminus">-</span>
<a href="#l11.2507"></a><span id="l11.2507" class="difflineminus">-  // if we haven't already, load in the engines</span>
<a href="#l11.2508"></a><span id="l11.2508" class="difflineminus">-  if (!mEngineListBuilt)</span>
<a href="#l11.2509"></a><span id="l11.2509" class="difflineminus">-    DeferredInit();</span>
<a href="#l11.2510"></a><span id="l11.2510" class="difflineminus">-</span>
<a href="#l11.2511"></a><span id="l11.2511" class="difflineminus">-  // look in available engines to see if any of them appear</span>
<a href="#l11.2512"></a><span id="l11.2512" class="difflineminus">-  // to match this url (minus the GET options)</span>
<a href="#l11.2513"></a><span id="l11.2513" class="difflineminus">-  PRBool        foundEngine = PR_FALSE;</span>
<a href="#l11.2514"></a><span id="l11.2514" class="difflineminus">-  nsresult      rv;</span>
<a href="#l11.2515"></a><span id="l11.2515" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  engine;</span>
<a href="#l11.2516"></a><span id="l11.2516" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; arcs;</span>
<a href="#l11.2517"></a><span id="l11.2517" class="difflineminus">-  nsAutoString      engineURI;</span>
<a href="#l11.2518"></a><span id="l11.2518" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt;   dataLit;</span>
<a href="#l11.2519"></a><span id="l11.2519" class="difflineminus">-  const PRUnichar     *dataUni = nsnull;</span>
<a href="#l11.2520"></a><span id="l11.2520" class="difflineminus">-</span>
<a href="#l11.2521"></a><span id="l11.2521" class="difflineminus">-  if (NS_SUCCEEDED(rv = mInner-&gt;GetTargets(mNC_SearchEngineRoot, mNC_Child,</span>
<a href="#l11.2522"></a><span id="l11.2522" class="difflineminus">-    PR_TRUE, getter_AddRefs(arcs))))</span>
<a href="#l11.2523"></a><span id="l11.2523" class="difflineminus">-  {</span>
<a href="#l11.2524"></a><span id="l11.2524" class="difflineminus">-    PRBool      hasMore = PR_TRUE;</span>
<a href="#l11.2525"></a><span id="l11.2525" class="difflineminus">-    while (hasMore)</span>
<a href="#l11.2526"></a><span id="l11.2526" class="difflineminus">-    {</span>
<a href="#l11.2527"></a><span id="l11.2527" class="difflineminus">-      if (NS_FAILED(arcs-&gt;HasMoreElements(&amp;hasMore)) || !hasMore)</span>
<a href="#l11.2528"></a><span id="l11.2528" class="difflineminus">-        break;</span>
<a href="#l11.2529"></a><span id="l11.2529" class="difflineminus">-      nsCOMPtr&lt;nsISupports&gt; arc;</span>
<a href="#l11.2530"></a><span id="l11.2530" class="difflineminus">-      if (NS_FAILED(arcs-&gt;GetNext(getter_AddRefs(arc))))</span>
<a href="#l11.2531"></a><span id="l11.2531" class="difflineminus">-        break;</span>
<a href="#l11.2532"></a><span id="l11.2532" class="difflineminus">-</span>
<a href="#l11.2533"></a><span id="l11.2533" class="difflineminus">-      engine = do_QueryInterface(arc);</span>
<a href="#l11.2534"></a><span id="l11.2534" class="difflineminus">-      if (!engine)  continue;</span>
<a href="#l11.2535"></a><span id="l11.2535" class="difflineminus">-</span>
<a href="#l11.2536"></a><span id="l11.2536" class="difflineminus">-      const char  *uri = nsnull;</span>
<a href="#l11.2537"></a><span id="l11.2537" class="difflineminus">-      engine-&gt;GetValueConst(&amp;uri);</span>
<a href="#l11.2538"></a><span id="l11.2538" class="difflineminus">-      if (uri)</span>
<a href="#l11.2539"></a><span id="l11.2539" class="difflineminus">-      {</span>
<a href="#l11.2540"></a><span id="l11.2540" class="difflineminus">-        CopyUTF8toUTF16(nsDependentCString(uri), engineURI);</span>
<a href="#l11.2541"></a><span id="l11.2541" class="difflineminus">-      }</span>
<a href="#l11.2542"></a><span id="l11.2542" class="difflineminus">-</span>
<a href="#l11.2543"></a><span id="l11.2543" class="difflineminus">-      if (NS_FAILED(rv = FindData(engine, getter_AddRefs(dataLit))) ||</span>
<a href="#l11.2544"></a><span id="l11.2544" class="difflineminus">-        (rv == NS_RDF_NO_VALUE))  continue;</span>
<a href="#l11.2545"></a><span id="l11.2545" class="difflineminus">-      if (!dataLit) continue;</span>
<a href="#l11.2546"></a><span id="l11.2546" class="difflineminus">-</span>
<a href="#l11.2547"></a><span id="l11.2547" class="difflineminus">-      dataLit-&gt;GetValueConst(&amp;dataUni);</span>
<a href="#l11.2548"></a><span id="l11.2548" class="difflineminus">-      if (!dataUni) continue;</span>
<a href="#l11.2549"></a><span id="l11.2549" class="difflineminus">-</span>
<a href="#l11.2550"></a><span id="l11.2550" class="difflineminus">-      nsAutoString    action;</span>
<a href="#l11.2551"></a><span id="l11.2551" class="difflineminus">-      if (NS_FAILED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;action&quot;, action)))  continue;</span>
<a href="#l11.2552"></a><span id="l11.2552" class="difflineminus">-      if (shortURL.Equals(action, CaseInsensitiveCompare))</span>
<a href="#l11.2553"></a><span id="l11.2553" class="difflineminus">-      {</span>
<a href="#l11.2554"></a><span id="l11.2554" class="difflineminus">-        foundEngine = PR_TRUE;</span>
<a href="#l11.2555"></a><span id="l11.2555" class="difflineminus">-        break;</span>
<a href="#l11.2556"></a><span id="l11.2556" class="difflineminus">-      }</span>
<a href="#l11.2557"></a><span id="l11.2557" class="difflineminus">-</span>
<a href="#l11.2558"></a><span id="l11.2558" class="difflineminus">-      // extension for engines which can have multiple &quot;actions&quot;</span>
<a href="#l11.2559"></a><span id="l11.2559" class="difflineminus">-      if (NS_FAILED(rv = GetData(dataUni, &quot;browser&quot;, 0, &quot;alsomatch&quot;, action)))  continue;</span>
<a href="#l11.2560"></a><span id="l11.2560" class="difflineminus">-      if (action.Find(shortURL, CaseInsensitiveCompare) &gt;= 0)</span>
<a href="#l11.2561"></a><span id="l11.2561" class="difflineminus">-      {</span>
<a href="#l11.2562"></a><span id="l11.2562" class="difflineminus">-        foundEngine = PR_TRUE;</span>
<a href="#l11.2563"></a><span id="l11.2563" class="difflineminus">-        break;</span>
<a href="#l11.2564"></a><span id="l11.2564" class="difflineminus">-      }</span>
<a href="#l11.2565"></a><span id="l11.2565" class="difflineminus">-    }</span>
<a href="#l11.2566"></a><span id="l11.2566" class="difflineminus">-  }</span>
<a href="#l11.2567"></a><span id="l11.2567" class="difflineminus">-  if (foundEngine)</span>
<a href="#l11.2568"></a><span id="l11.2568" class="difflineminus">-  {</span>
<a href="#l11.2569"></a><span id="l11.2569" class="difflineminus">-    nsAutoString  searchURL;</span>
<a href="#l11.2570"></a><span id="l11.2570" class="difflineminus">-    CopyASCIItoUTF16(nsDependentCString(url), searchURL);</span>
<a href="#l11.2571"></a><span id="l11.2571" class="difflineminus">-</span>
<a href="#l11.2572"></a><span id="l11.2572" class="difflineminus">-    // look for query option which is the string the user is searching for</span>
<a href="#l11.2573"></a><span id="l11.2573" class="difflineminus">-    nsAutoString  userVar, inputUnused, engineNameStr;</span>
<a href="#l11.2574"></a><span id="l11.2574" class="difflineminus">-    GetData(dataUni, &quot;search&quot;, 0, &quot;name&quot;, engineNameStr);</span>
<a href="#l11.2575"></a><span id="l11.2575" class="difflineminus">-</span>
<a href="#l11.2576"></a><span id="l11.2576" class="difflineminus">-    if (NS_FAILED(rv = GetInputs(dataUni, engineNameStr, userVar, EmptyString(), inputUnused, 0, 0, 0)))  return(rv);</span>
<a href="#l11.2577"></a><span id="l11.2577" class="difflineminus">-    if (userVar.IsEmpty())  return(NS_RDF_NO_VALUE);</span>
<a href="#l11.2578"></a><span id="l11.2578" class="difflineminus">-</span>
<a href="#l11.2579"></a><span id="l11.2579" class="difflineminus">-    nsAutoString  queryStr;</span>
<a href="#l11.2580"></a><span id="l11.2580" class="difflineminus">-    queryStr.Assign(PRUnichar('?'));</span>
<a href="#l11.2581"></a><span id="l11.2581" class="difflineminus">-    queryStr.Append(userVar);</span>
<a href="#l11.2582"></a><span id="l11.2582" class="difflineminus">-    queryStr.Append(PRUnichar('='));</span>
<a href="#l11.2583"></a><span id="l11.2583" class="difflineminus">-</span>
<a href="#l11.2584"></a><span id="l11.2584" class="difflineminus">-    PRInt32   queryOffset = searchURL.Find(queryStr, CaseInsensitiveCompare);</span>
<a href="#l11.2585"></a><span id="l11.2585" class="difflineminus">-    if (queryOffset &lt; 0)</span>
<a href="#l11.2586"></a><span id="l11.2586" class="difflineminus">-    {</span>
<a href="#l11.2587"></a><span id="l11.2587" class="difflineminus">-      queryStr.Replace(0, 1, PRUnichar('&amp;'));</span>
<a href="#l11.2588"></a><span id="l11.2588" class="difflineminus">-      queryOffset = searchURL.Find(queryStr, CaseInsensitiveCompare);</span>
<a href="#l11.2589"></a><span id="l11.2589" class="difflineminus">-    }</span>
<a href="#l11.2590"></a><span id="l11.2590" class="difflineminus">-</span>
<a href="#l11.2591"></a><span id="l11.2591" class="difflineminus">-    nsAutoString  searchText;</span>
<a href="#l11.2592"></a><span id="l11.2592" class="difflineminus">-    if (queryOffset &gt;= 0)</span>
<a href="#l11.2593"></a><span id="l11.2593" class="difflineminus">-    {</span>
<a href="#l11.2594"></a><span id="l11.2594" class="difflineminus">-      PRInt32   andOffset;</span>
<a href="#l11.2595"></a><span id="l11.2595" class="difflineminus">-      searchText = Substring(searchURL, queryOffset + queryStr.Length());</span>
<a href="#l11.2596"></a><span id="l11.2596" class="difflineminus">-</span>
<a href="#l11.2597"></a><span id="l11.2597" class="difflineminus">-      if ((andOffset = searchText.FindChar(PRUnichar('&amp;'))) &gt;= 0)</span>
<a href="#l11.2598"></a><span id="l11.2598" class="difflineminus">-      {</span>
<a href="#l11.2599"></a><span id="l11.2599" class="difflineminus">-        searchText.SetLength(andOffset);</span>
<a href="#l11.2600"></a><span id="l11.2600" class="difflineminus">-      }</span>
<a href="#l11.2601"></a><span id="l11.2601" class="difflineminus">-    }</span>
<a href="#l11.2602"></a><span id="l11.2602" class="difflineminus">-    if (!searchText.IsEmpty())</span>
<a href="#l11.2603"></a><span id="l11.2603" class="difflineminus">-    {</span>
<a href="#l11.2604"></a><span id="l11.2604" class="difflineminus">-      // apply charset conversion to the search text</span>
<a href="#l11.2605"></a><span id="l11.2605" class="difflineminus">-      if (!mQueryEncodingStr.IsEmpty())</span>
<a href="#l11.2606"></a><span id="l11.2606" class="difflineminus">-      {</span>
<a href="#l11.2607"></a><span id="l11.2607" class="difflineminus">-        nsCOMPtr&lt;nsITextToSubURI&gt; textToSubURI = do_GetService(NS_ITEXTTOSUBURI_CONTRACTID, &amp;rv);</span>
<a href="#l11.2608"></a><span id="l11.2608" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l11.2609"></a><span id="l11.2609" class="difflineminus">-        {</span>
<a href="#l11.2610"></a><span id="l11.2610" class="difflineminus">-          nsCAutoString escapedSearchText;</span>
<a href="#l11.2611"></a><span id="l11.2611" class="difflineminus">-          LossyCopyUTF16toASCII(searchText, escapedSearchText);</span>
<a href="#l11.2612"></a><span id="l11.2612" class="difflineminus">-</span>
<a href="#l11.2613"></a><span id="l11.2613" class="difflineminus">-          // encoding +'s so as to preserve distinction between + and %2B</span>
<a href="#l11.2614"></a><span id="l11.2614" class="difflineminus">-          PRInt32 offset = escapedSearchText.FindChar('%');</span>
<a href="#l11.2615"></a><span id="l11.2615" class="difflineminus">-          while (offset != -1) {</span>
<a href="#l11.2616"></a><span id="l11.2616" class="difflineminus">-            escapedSearchText.Replace(offset, 1, &quot;%25&quot;);</span>
<a href="#l11.2617"></a><span id="l11.2617" class="difflineminus">-            offset = escapedSearchText.FindChar('%', offset + 3);</span>
<a href="#l11.2618"></a><span id="l11.2618" class="difflineminus">-          }</span>
<a href="#l11.2619"></a><span id="l11.2619" class="difflineminus">-          offset = escapedSearchText.FindChar('+');</span>
<a href="#l11.2620"></a><span id="l11.2620" class="difflineminus">-          while (offset != -1) {</span>
<a href="#l11.2621"></a><span id="l11.2621" class="difflineminus">-            escapedSearchText.Replace(offset, 1, &quot;%2B&quot;);</span>
<a href="#l11.2622"></a><span id="l11.2622" class="difflineminus">-            offset = escapedSearchText.FindChar('+', offset + 3);</span>
<a href="#l11.2623"></a><span id="l11.2623" class="difflineminus">-          }</span>
<a href="#l11.2624"></a><span id="l11.2624" class="difflineminus">-</span>
<a href="#l11.2625"></a><span id="l11.2625" class="difflineminus">-          PRUnichar *uni = nsnull;</span>
<a href="#l11.2626"></a><span id="l11.2626" class="difflineminus">-          rv = textToSubURI-&gt;UnEscapeAndConvert(NS_LossyConvertUTF16toASCII(mQueryEncodingStr).get(),</span>
<a href="#l11.2627"></a><span id="l11.2627" class="difflineminus">-                                                escapedSearchText.get(), &amp;uni);</span>
<a href="#l11.2628"></a><span id="l11.2628" class="difflineminus">-          if (NS_SUCCEEDED(rv) &amp;&amp; uni)</span>
<a href="#l11.2629"></a><span id="l11.2629" class="difflineminus">-          {</span>
<a href="#l11.2630"></a><span id="l11.2630" class="difflineminus">-            char  *convertedSearchText = nsnull;</span>
<a href="#l11.2631"></a><span id="l11.2631" class="difflineminus">-            if (NS_SUCCEEDED(rv = textToSubURI-&gt;ConvertAndEscape(&quot;UTF-8&quot;, uni, &amp;convertedSearchText)))</span>
<a href="#l11.2632"></a><span id="l11.2632" class="difflineminus">-            {</span>
<a href="#l11.2633"></a><span id="l11.2633" class="difflineminus">-</span>
<a href="#l11.2634"></a><span id="l11.2634" class="difflineminus">-              // decoding +'s thereby preserving distinction between + and %2B</span>
<a href="#l11.2635"></a><span id="l11.2635" class="difflineminus">-              nsCAutoString unescapedSearchText(convertedSearchText);</span>
<a href="#l11.2636"></a><span id="l11.2636" class="difflineminus">-              offset = unescapedSearchText.Find(NS_LITERAL_CSTRING(&quot;%2B&quot;));</span>
<a href="#l11.2637"></a><span id="l11.2637" class="difflineminus">-              while (offset != -1) {</span>
<a href="#l11.2638"></a><span id="l11.2638" class="difflineminus">-                unescapedSearchText.Replace(offset, 3, '+');</span>
<a href="#l11.2639"></a><span id="l11.2639" class="difflineminus">-                offset = unescapedSearchText.Find(NS_LITERAL_CSTRING(&quot;%2B&quot;), offset + 1);</span>
<a href="#l11.2640"></a><span id="l11.2640" class="difflineminus">-              }</span>
<a href="#l11.2641"></a><span id="l11.2641" class="difflineminus">-              offset = unescapedSearchText.Find(NS_LITERAL_CSTRING(&quot;%25&quot;));</span>
<a href="#l11.2642"></a><span id="l11.2642" class="difflineminus">-              while (offset != -1) {</span>
<a href="#l11.2643"></a><span id="l11.2643" class="difflineminus">-                unescapedSearchText.Replace(offset, 3, '%');</span>
<a href="#l11.2644"></a><span id="l11.2644" class="difflineminus">-                offset = unescapedSearchText.Find(NS_LITERAL_CSTRING(&quot;%25&quot;), offset + 1);</span>
<a href="#l11.2645"></a><span id="l11.2645" class="difflineminus">-              }</span>
<a href="#l11.2646"></a><span id="l11.2646" class="difflineminus">-</span>
<a href="#l11.2647"></a><span id="l11.2647" class="difflineminus">-              CopyUTF8toUTF16(unescapedSearchText, searchText);</span>
<a href="#l11.2648"></a><span id="l11.2648" class="difflineminus">-</span>
<a href="#l11.2649"></a><span id="l11.2649" class="difflineminus">-              NS_Free(convertedSearchText);</span>
<a href="#l11.2650"></a><span id="l11.2650" class="difflineminus">-            }</span>
<a href="#l11.2651"></a><span id="l11.2651" class="difflineminus">-            NS_Free(uni);</span>
<a href="#l11.2652"></a><span id="l11.2652" class="difflineminus">-          }</span>
<a href="#l11.2653"></a><span id="l11.2653" class="difflineminus">-        }</span>
<a href="#l11.2654"></a><span id="l11.2654" class="difflineminus">-      }</span>
<a href="#l11.2655"></a><span id="l11.2655" class="difflineminus">-      // remember the text of the last search</span>
<a href="#l11.2656"></a><span id="l11.2656" class="difflineminus">-      RememberLastSearchText(searchText.get());</span>
<a href="#l11.2657"></a><span id="l11.2657" class="difflineminus">-</span>
<a href="#l11.2658"></a><span id="l11.2658" class="difflineminus">-      // construct the search query uri</span>
<a href="#l11.2659"></a><span id="l11.2659" class="difflineminus">-      engineURI.Insert(NS_LITERAL_STRING(&quot;internetsearch:engine=&quot;), 0);</span>
<a href="#l11.2660"></a><span id="l11.2660" class="difflineminus">-      engineURI.Append(NS_LITERAL_STRING(&quot;&amp;text=&quot;));</span>
<a href="#l11.2661"></a><span id="l11.2661" class="difflineminus">-      engineURI.Append(searchText);</span>
<a href="#l11.2662"></a><span id="l11.2662" class="difflineminus">-</span>
<a href="#l11.2663"></a><span id="l11.2663" class="difflineminus">-#ifdef  DEBUG_SEARCH_OUTPUT</span>
<a href="#l11.2664"></a><span id="l11.2664" class="difflineminus">-      printf(&quot;FindInternetSearchResults: search for: '%s'\n\n&quot;,</span>
<a href="#l11.2665"></a><span id="l11.2665" class="difflineminus">-        NS_ConvertUTF16toUTF8(searchText).get());</span>
<a href="#l11.2666"></a><span id="l11.2666" class="difflineminus">-#endif</span>
<a href="#l11.2667"></a><span id="l11.2667" class="difflineminus">-    }</span>
<a href="#l11.2668"></a><span id="l11.2668" class="difflineminus">-    else</span>
<a href="#l11.2669"></a><span id="l11.2669" class="difflineminus">-    {</span>
<a href="#l11.2670"></a><span id="l11.2670" class="difflineminus">-      // not able to determine engine URI, so just use the search URL</span>
<a href="#l11.2671"></a><span id="l11.2671" class="difflineminus">-      engineURI = searchURL;</span>
<a href="#l11.2672"></a><span id="l11.2672" class="difflineminus">-</span>
<a href="#l11.2673"></a><span id="l11.2673" class="difflineminus">-      // clear the text of the last search</span>
<a href="#l11.2674"></a><span id="l11.2674" class="difflineminus">-      RememberLastSearchText(nsnull);</span>
<a href="#l11.2675"></a><span id="l11.2675" class="difflineminus">-    }</span>
<a href="#l11.2676"></a><span id="l11.2676" class="difflineminus">-</span>
<a href="#l11.2677"></a><span id="l11.2677" class="difflineminus">-    // update &quot;#Ref&quot; on LastSearchRoot</span>
<a href="#l11.2678"></a><span id="l11.2678" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt;  oldNode;</span>
<a href="#l11.2679"></a><span id="l11.2679" class="difflineminus">-    if (NS_SUCCEEDED(rv = mInner-&gt;GetTarget(mNC_LastSearchRoot, mNC_Ref, PR_TRUE,</span>
<a href="#l11.2680"></a><span id="l11.2680" class="difflineminus">-      getter_AddRefs(oldNode))))</span>
<a href="#l11.2681"></a><span id="l11.2681" class="difflineminus">-    {</span>
<a href="#l11.2682"></a><span id="l11.2682" class="difflineminus">-      if (!engineURI.IsEmpty())</span>
<a href="#l11.2683"></a><span id="l11.2683" class="difflineminus">-      {</span>
<a href="#l11.2684"></a><span id="l11.2684" class="difflineminus">-        const PRUnichar *uriUni = engineURI.get();</span>
<a href="#l11.2685"></a><span id="l11.2685" class="difflineminus">-        nsCOMPtr&lt;nsIRDFLiteral&gt; uriLiteral;</span>
<a href="#l11.2686"></a><span id="l11.2686" class="difflineminus">-        nsresult    temprv;</span>
<a href="#l11.2687"></a><span id="l11.2687" class="difflineminus">-        if ((uriUni) &amp;&amp; (NS_SUCCEEDED(temprv = mRDFService-&gt;GetLiteral(uriUni,</span>
<a href="#l11.2688"></a><span id="l11.2688" class="difflineminus">-          getter_AddRefs(uriLiteral)))))</span>
<a href="#l11.2689"></a><span id="l11.2689" class="difflineminus">-        {</span>
<a href="#l11.2690"></a><span id="l11.2690" class="difflineminus">-          if (rv != NS_RDF_NO_VALUE)</span>
<a href="#l11.2691"></a><span id="l11.2691" class="difflineminus">-          {</span>
<a href="#l11.2692"></a><span id="l11.2692" class="difflineminus">-            rv = mInner-&gt;Change(mNC_LastSearchRoot, mNC_Ref, oldNode, uriLiteral);</span>
<a href="#l11.2693"></a><span id="l11.2693" class="difflineminus">-          }</span>
<a href="#l11.2694"></a><span id="l11.2694" class="difflineminus">-          else</span>
<a href="#l11.2695"></a><span id="l11.2695" class="difflineminus">-          {</span>
<a href="#l11.2696"></a><span id="l11.2696" class="difflineminus">-            rv = mInner-&gt;Assert(mNC_LastSearchRoot, mNC_Ref, uriLiteral, PR_TRUE);</span>
<a href="#l11.2697"></a><span id="l11.2697" class="difflineminus">-          }</span>
<a href="#l11.2698"></a><span id="l11.2698" class="difflineminus">-        }</span>
<a href="#l11.2699"></a><span id="l11.2699" class="difflineminus">-      }</span>
<a href="#l11.2700"></a><span id="l11.2700" class="difflineminus">-      else</span>
<a href="#l11.2701"></a><span id="l11.2701" class="difflineminus">-      {</span>
<a href="#l11.2702"></a><span id="l11.2702" class="difflineminus">-        rv = mInner-&gt;Unassert(mNC_LastSearchRoot, mNC_Ref, oldNode);</span>
<a href="#l11.2703"></a><span id="l11.2703" class="difflineminus">-      }</span>
<a href="#l11.2704"></a><span id="l11.2704" class="difflineminus">-    }</span>
<a href="#l11.2705"></a><span id="l11.2705" class="difflineminus">-</span>
<a href="#l11.2706"></a><span id="l11.2706" class="difflineminus">-    // forget about any previous search results</span>
<a href="#l11.2707"></a><span id="l11.2707" class="difflineminus">-    ClearResults(PR_FALSE);</span>
<a href="#l11.2708"></a><span id="l11.2708" class="difflineminus">-</span>
<a href="#l11.2709"></a><span id="l11.2709" class="difflineminus">-    // do the search</span>
<a href="#l11.2710"></a><span id="l11.2710" class="difflineminus">-    DoSearch(nsnull, engine, searchURL, EmptyString());</span>
<a href="#l11.2711"></a><span id="l11.2711" class="difflineminus">-</span>
<a href="#l11.2712"></a><span id="l11.2712" class="difflineminus">-    *searchInProgress = PR_TRUE;</span>
<a href="#l11.2713"></a><span id="l11.2713" class="difflineminus">-  }</span>
<a href="#l11.2714"></a><span id="l11.2714" class="difflineminus">-</span>
<a href="#l11.2715"></a><span id="l11.2715" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.2716"></a><span id="l11.2716" class="difflineminus">-}</span>
<a href="#l11.2717"></a><span id="l11.2717" class="difflineminus">-</span>
<a href="#l11.2718"></a><span id="l11.2718" class="difflineminus">-</span>
<a href="#l11.2719"></a><span id="l11.2719" class="difflineminus">-</span>
<a href="#l11.2720"></a><span id="l11.2720" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.2721"></a><span id="l11.2721" class="difflineminus">-InternetSearchDataSource::ClearResults(PRBool flushLastSearchRef)</span>
<a href="#l11.2722"></a><span id="l11.2722" class="difflineminus">-{</span>
<a href="#l11.2723"></a><span id="l11.2723" class="difflineminus">-  if (!mInner)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.2724"></a><span id="l11.2724" class="difflineminus">-</span>
<a href="#l11.2725"></a><span id="l11.2725" class="difflineminus">-  // forget any nodes under the last search root</span>
<a href="#l11.2726"></a><span id="l11.2726" class="difflineminus">-  nsresult      rv;</span>
<a href="#l11.2727"></a><span id="l11.2727" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; arcs;</span>
<a href="#l11.2728"></a><span id="l11.2728" class="difflineminus">-  if (NS_SUCCEEDED(rv = mInner-&gt;GetTargets(mNC_LastSearchRoot, mNC_Child, PR_TRUE, getter_AddRefs(arcs))))</span>
<a href="#l11.2729"></a><span id="l11.2729" class="difflineminus">-  {</span>
<a href="#l11.2730"></a><span id="l11.2730" class="difflineminus">-    PRBool      hasMore = PR_TRUE;</span>
<a href="#l11.2731"></a><span id="l11.2731" class="difflineminus">-    while (hasMore)</span>
<a href="#l11.2732"></a><span id="l11.2732" class="difflineminus">-    {</span>
<a href="#l11.2733"></a><span id="l11.2733" class="difflineminus">-      if (NS_FAILED(arcs-&gt;HasMoreElements(&amp;hasMore)) || !hasMore)</span>
<a href="#l11.2734"></a><span id="l11.2734" class="difflineminus">-        break;</span>
<a href="#l11.2735"></a><span id="l11.2735" class="difflineminus">-      nsCOMPtr&lt;nsISupports&gt; arc;</span>
<a href="#l11.2736"></a><span id="l11.2736" class="difflineminus">-      if (NS_FAILED(arcs-&gt;GetNext(getter_AddRefs(arc))))</span>
<a href="#l11.2737"></a><span id="l11.2737" class="difflineminus">-        break;</span>
<a href="#l11.2738"></a><span id="l11.2738" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt; child (do_QueryInterface(arc));</span>
<a href="#l11.2739"></a><span id="l11.2739" class="difflineminus">-      if (child)</span>
<a href="#l11.2740"></a><span id="l11.2740" class="difflineminus">-      {</span>
<a href="#l11.2741"></a><span id="l11.2741" class="difflineminus">-        mInner-&gt;Unassert(mNC_LastSearchRoot, mNC_Child, child);</span>
<a href="#l11.2742"></a><span id="l11.2742" class="difflineminus">-      }</span>
<a href="#l11.2743"></a><span id="l11.2743" class="difflineminus">-</span>
<a href="#l11.2744"></a><span id="l11.2744" class="difflineminus">-      // *after* (so that we won't thrash the XUL template builder) unasserting</span>
<a href="#l11.2745"></a><span id="l11.2745" class="difflineminus">-      // child node, determine if there are any other references to the child</span>
<a href="#l11.2746"></a><span id="l11.2746" class="difflineminus">-      // node in the graph</span>
<a href="#l11.2747"></a><span id="l11.2747" class="difflineminus">-</span>
<a href="#l11.2748"></a><span id="l11.2748" class="difflineminus">-      PRBool hasInArcs = PR_FALSE;</span>
<a href="#l11.2749"></a><span id="l11.2749" class="difflineminus">-      nsCOMPtr&lt;nsISimpleEnumerator&gt; inArcs;</span>
<a href="#l11.2750"></a><span id="l11.2750" class="difflineminus">-      if (NS_FAILED(mInner-&gt;ArcLabelsIn(child, getter_AddRefs(inArcs))) ||</span>
<a href="#l11.2751"></a><span id="l11.2751" class="difflineminus">-        (!inArcs))</span>
<a href="#l11.2752"></a><span id="l11.2752" class="difflineminus">-        continue;</span>
<a href="#l11.2753"></a><span id="l11.2753" class="difflineminus">-      if (NS_FAILED(inArcs-&gt;HasMoreElements(&amp;hasInArcs)) || hasInArcs)</span>
<a href="#l11.2754"></a><span id="l11.2754" class="difflineminus">-        continue;</span>
<a href="#l11.2755"></a><span id="l11.2755" class="difflineminus">-</span>
<a href="#l11.2756"></a><span id="l11.2756" class="difflineminus">-      // no other references, so also unassert any outgoing arcs</span>
<a href="#l11.2757"></a><span id="l11.2757" class="difflineminus">-</span>
<a href="#l11.2758"></a><span id="l11.2758" class="difflineminus">-      nsCOMPtr&lt;nsISimpleEnumerator&gt; outArcs;</span>
<a href="#l11.2759"></a><span id="l11.2759" class="difflineminus">-      if (NS_FAILED(mInner-&gt;ArcLabelsOut(child, getter_AddRefs(outArcs))) ||</span>
<a href="#l11.2760"></a><span id="l11.2760" class="difflineminus">-        (!outArcs))</span>
<a href="#l11.2761"></a><span id="l11.2761" class="difflineminus">-        continue;</span>
<a href="#l11.2762"></a><span id="l11.2762" class="difflineminus">-      PRBool  hasMoreOutArcs = PR_TRUE;</span>
<a href="#l11.2763"></a><span id="l11.2763" class="difflineminus">-      while (hasMoreOutArcs)</span>
<a href="#l11.2764"></a><span id="l11.2764" class="difflineminus">-      {</span>
<a href="#l11.2765"></a><span id="l11.2765" class="difflineminus">-        if (NS_FAILED(outArcs-&gt;HasMoreElements(&amp;hasMoreOutArcs)) ||</span>
<a href="#l11.2766"></a><span id="l11.2766" class="difflineminus">-            !hasMoreOutArcs)</span>
<a href="#l11.2767"></a><span id="l11.2767" class="difflineminus">-          break;</span>
<a href="#l11.2768"></a><span id="l11.2768" class="difflineminus">-        nsCOMPtr&lt;nsISupports&gt; outArc;</span>
<a href="#l11.2769"></a><span id="l11.2769" class="difflineminus">-        if (NS_FAILED(outArcs-&gt;GetNext(getter_AddRefs(outArc))))</span>
<a href="#l11.2770"></a><span id="l11.2770" class="difflineminus">-          break;</span>
<a href="#l11.2771"></a><span id="l11.2771" class="difflineminus">-        nsCOMPtr&lt;nsIRDFResource&gt; property (do_QueryInterface(outArc));</span>
<a href="#l11.2772"></a><span id="l11.2772" class="difflineminus">-        if (!property)</span>
<a href="#l11.2773"></a><span id="l11.2773" class="difflineminus">-          continue;</span>
<a href="#l11.2774"></a><span id="l11.2774" class="difflineminus">-        nsCOMPtr&lt;nsIRDFNode&gt; target;</span>
<a href="#l11.2775"></a><span id="l11.2775" class="difflineminus">-        if (NS_FAILED(mInner-&gt;GetTarget(child, property, PR_TRUE,</span>
<a href="#l11.2776"></a><span id="l11.2776" class="difflineminus">-          getter_AddRefs(target))) || (!target))</span>
<a href="#l11.2777"></a><span id="l11.2777" class="difflineminus">-          continue;</span>
<a href="#l11.2778"></a><span id="l11.2778" class="difflineminus">-        mInner-&gt;Unassert(child, property, target);</span>
<a href="#l11.2779"></a><span id="l11.2779" class="difflineminus">-      }</span>
<a href="#l11.2780"></a><span id="l11.2780" class="difflineminus">-    }</span>
<a href="#l11.2781"></a><span id="l11.2781" class="difflineminus">-  }</span>
<a href="#l11.2782"></a><span id="l11.2782" class="difflineminus">-</span>
<a href="#l11.2783"></a><span id="l11.2783" class="difflineminus">-  if (flushLastSearchRef)</span>
<a href="#l11.2784"></a><span id="l11.2784" class="difflineminus">-  {</span>
<a href="#l11.2785"></a><span id="l11.2785" class="difflineminus">-    // forget the last search query</span>
<a href="#l11.2786"></a><span id="l11.2786" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt;  lastTarget;</span>
<a href="#l11.2787"></a><span id="l11.2787" class="difflineminus">-    if (NS_SUCCEEDED(rv = mInner-&gt;GetTarget(mNC_LastSearchRoot, mNC_Ref,</span>
<a href="#l11.2788"></a><span id="l11.2788" class="difflineminus">-      PR_TRUE, getter_AddRefs(lastTarget))) &amp;&amp; (rv != NS_RDF_NO_VALUE))</span>
<a href="#l11.2789"></a><span id="l11.2789" class="difflineminus">-    {</span>
<a href="#l11.2790"></a><span id="l11.2790" class="difflineminus">-      nsCOMPtr&lt;nsIRDFLiteral&gt; lastLiteral (do_QueryInterface(lastTarget));</span>
<a href="#l11.2791"></a><span id="l11.2791" class="difflineminus">-      if (lastLiteral)</span>
<a href="#l11.2792"></a><span id="l11.2792" class="difflineminus">-      {</span>
<a href="#l11.2793"></a><span id="l11.2793" class="difflineminus">-        rv = mInner-&gt;Unassert(mNC_LastSearchRoot, mNC_Ref, lastLiteral);</span>
<a href="#l11.2794"></a><span id="l11.2794" class="difflineminus">-      }</span>
<a href="#l11.2795"></a><span id="l11.2795" class="difflineminus">-    }</span>
<a href="#l11.2796"></a><span id="l11.2796" class="difflineminus">-  }</span>
<a href="#l11.2797"></a><span id="l11.2797" class="difflineminus">-</span>
<a href="#l11.2798"></a><span id="l11.2798" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.2799"></a><span id="l11.2799" class="difflineminus">-}</span>
<a href="#l11.2800"></a><span id="l11.2800" class="difflineminus">-</span>
<a href="#l11.2801"></a><span id="l11.2801" class="difflineminus">-</span>
<a href="#l11.2802"></a><span id="l11.2802" class="difflineminus">-</span>
<a href="#l11.2803"></a><span id="l11.2803" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.2804"></a><span id="l11.2804" class="difflineminus">-InternetSearchDataSource::ClearResultSearchSites(void)</span>
<a href="#l11.2805"></a><span id="l11.2805" class="difflineminus">-{</span>
<a href="#l11.2806"></a><span id="l11.2806" class="difflineminus">-  // forget about any previous search sites</span>
<a href="#l11.2807"></a><span id="l11.2807" class="difflineminus">-</span>
<a href="#l11.2808"></a><span id="l11.2808" class="difflineminus">-  if (mInner)</span>
<a href="#l11.2809"></a><span id="l11.2809" class="difflineminus">-  {</span>
<a href="#l11.2810"></a><span id="l11.2810" class="difflineminus">-    nsresult      rv;</span>
<a href="#l11.2811"></a><span id="l11.2811" class="difflineminus">-    nsCOMPtr&lt;nsISimpleEnumerator&gt; arcs;</span>
<a href="#l11.2812"></a><span id="l11.2812" class="difflineminus">-    if (NS_SUCCEEDED(rv = mInner-&gt;GetTargets(mNC_SearchResultsSitesRoot, mNC_Child, PR_TRUE, getter_AddRefs(arcs))))</span>
<a href="#l11.2813"></a><span id="l11.2813" class="difflineminus">-    {</span>
<a href="#l11.2814"></a><span id="l11.2814" class="difflineminus">-      PRBool      hasMore = PR_TRUE;</span>
<a href="#l11.2815"></a><span id="l11.2815" class="difflineminus">-      while (hasMore)</span>
<a href="#l11.2816"></a><span id="l11.2816" class="difflineminus">-      {</span>
<a href="#l11.2817"></a><span id="l11.2817" class="difflineminus">-        if (NS_FAILED(arcs-&gt;HasMoreElements(&amp;hasMore)) || !hasMore)</span>
<a href="#l11.2818"></a><span id="l11.2818" class="difflineminus">-          break;</span>
<a href="#l11.2819"></a><span id="l11.2819" class="difflineminus">-        nsCOMPtr&lt;nsISupports&gt; arc;</span>
<a href="#l11.2820"></a><span id="l11.2820" class="difflineminus">-        if (NS_FAILED(arcs-&gt;GetNext(getter_AddRefs(arc))))</span>
<a href="#l11.2821"></a><span id="l11.2821" class="difflineminus">-          break;</span>
<a href="#l11.2822"></a><span id="l11.2822" class="difflineminus">-        nsCOMPtr&lt;nsIRDFResource&gt; child (do_QueryInterface(arc));</span>
<a href="#l11.2823"></a><span id="l11.2823" class="difflineminus">-        if (child)</span>
<a href="#l11.2824"></a><span id="l11.2824" class="difflineminus">-        {</span>
<a href="#l11.2825"></a><span id="l11.2825" class="difflineminus">-          mInner-&gt;Unassert(mNC_SearchResultsSitesRoot, mNC_Child, child);</span>
<a href="#l11.2826"></a><span id="l11.2826" class="difflineminus">-        }</span>
<a href="#l11.2827"></a><span id="l11.2827" class="difflineminus">-      }</span>
<a href="#l11.2828"></a><span id="l11.2828" class="difflineminus">-    }</span>
<a href="#l11.2829"></a><span id="l11.2829" class="difflineminus">-  }</span>
<a href="#l11.2830"></a><span id="l11.2830" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.2831"></a><span id="l11.2831" class="difflineminus">-}</span>
<a href="#l11.2832"></a><span id="l11.2832" class="difflineminus">-</span>
<a href="#l11.2833"></a><span id="l11.2833" class="difflineminus">-</span>
<a href="#l11.2834"></a><span id="l11.2834" class="difflineminus">-</span>
<a href="#l11.2835"></a><span id="l11.2835" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.2836"></a><span id="l11.2836" class="difflineminus">-InternetSearchDataSource::GetCategoryDataSource(nsIRDFDataSource **ds)</span>
<a href="#l11.2837"></a><span id="l11.2837" class="difflineminus">-{</span>
<a href="#l11.2838"></a><span id="l11.2838" class="difflineminus">-  nsresult  rv;</span>
<a href="#l11.2839"></a><span id="l11.2839" class="difflineminus">-</span>
<a href="#l11.2840"></a><span id="l11.2840" class="difflineminus">-  if (!categoryDataSource)</span>
<a href="#l11.2841"></a><span id="l11.2841" class="difflineminus">-  {</span>
<a href="#l11.2842"></a><span id="l11.2842" class="difflineminus">-    if (NS_FAILED(rv = GetCategoryList()))</span>
<a href="#l11.2843"></a><span id="l11.2843" class="difflineminus">-    {</span>
<a href="#l11.2844"></a><span id="l11.2844" class="difflineminus">-      *ds = nsnull;</span>
<a href="#l11.2845"></a><span id="l11.2845" class="difflineminus">-      return(rv);</span>
<a href="#l11.2846"></a><span id="l11.2846" class="difflineminus">-    }</span>
<a href="#l11.2847"></a><span id="l11.2847" class="difflineminus">-  }</span>
<a href="#l11.2848"></a><span id="l11.2848" class="difflineminus">-  if (categoryDataSource)</span>
<a href="#l11.2849"></a><span id="l11.2849" class="difflineminus">-  {</span>
<a href="#l11.2850"></a><span id="l11.2850" class="difflineminus">-    *ds = categoryDataSource.get();</span>
<a href="#l11.2851"></a><span id="l11.2851" class="difflineminus">-    NS_IF_ADDREF(*ds);</span>
<a href="#l11.2852"></a><span id="l11.2852" class="difflineminus">-    return(NS_OK);</span>
<a href="#l11.2853"></a><span id="l11.2853" class="difflineminus">-  }</span>
<a href="#l11.2854"></a><span id="l11.2854" class="difflineminus">-  *ds = nsnull;</span>
<a href="#l11.2855"></a><span id="l11.2855" class="difflineminus">-  return(NS_ERROR_FAILURE);</span>
<a href="#l11.2856"></a><span id="l11.2856" class="difflineminus">-}</span>
<a href="#l11.2857"></a><span id="l11.2857" class="difflineminus">-</span>
<a href="#l11.2858"></a><span id="l11.2858" class="difflineminus">-</span>
<a href="#l11.2859"></a><span id="l11.2859" class="difflineminus">-</span>
<a href="#l11.2860"></a><span id="l11.2860" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.2861"></a><span id="l11.2861" class="difflineminus">-InternetSearchDataSource::Stop()</span>
<a href="#l11.2862"></a><span id="l11.2862" class="difflineminus">-{</span>
<a href="#l11.2863"></a><span id="l11.2863" class="difflineminus">-  nsresult    rv;</span>
<a href="#l11.2864"></a><span id="l11.2864" class="difflineminus">-</span>
<a href="#l11.2865"></a><span id="l11.2865" class="difflineminus">-  // cancel any outstanding connections</span>
<a href="#l11.2866"></a><span id="l11.2866" class="difflineminus">-  if (mLoadGroup)</span>
<a href="#l11.2867"></a><span id="l11.2867" class="difflineminus">-  {</span>
<a href="#l11.2868"></a><span id="l11.2868" class="difflineminus">-    nsCOMPtr&lt;nsISimpleEnumerator&gt; requests;</span>
<a href="#l11.2869"></a><span id="l11.2869" class="difflineminus">-    if (NS_SUCCEEDED(rv = mLoadGroup-&gt;GetRequests(getter_AddRefs(requests))))</span>
<a href="#l11.2870"></a><span id="l11.2870" class="difflineminus">-    {</span>
<a href="#l11.2871"></a><span id="l11.2871" class="difflineminus">-      PRBool      more;</span>
<a href="#l11.2872"></a><span id="l11.2872" class="difflineminus">-      while (NS_SUCCEEDED(rv = requests-&gt;HasMoreElements(&amp;more)) &amp;&amp; more)</span>
<a href="#l11.2873"></a><span id="l11.2873" class="difflineminus">-      {</span>
<a href="#l11.2874"></a><span id="l11.2874" class="difflineminus">-        nsCOMPtr&lt;nsISupports&gt; isupports;</span>
<a href="#l11.2875"></a><span id="l11.2875" class="difflineminus">-        if (NS_FAILED(rv = requests-&gt;GetNext(getter_AddRefs(isupports))))</span>
<a href="#l11.2876"></a><span id="l11.2876" class="difflineminus">-          break;</span>
<a href="#l11.2877"></a><span id="l11.2877" class="difflineminus">-        nsCOMPtr&lt;nsIRequest&gt; request (do_QueryInterface(isupports));</span>
<a href="#l11.2878"></a><span id="l11.2878" class="difflineminus">-        if (!request) continue;</span>
<a href="#l11.2879"></a><span id="l11.2879" class="difflineminus">-        request-&gt;Cancel(NS_BINDING_ABORTED);</span>
<a href="#l11.2880"></a><span id="l11.2880" class="difflineminus">-      }</span>
<a href="#l11.2881"></a><span id="l11.2881" class="difflineminus">-    }</span>
<a href="#l11.2882"></a><span id="l11.2882" class="difflineminus">-    mLoadGroup-&gt;Cancel(NS_BINDING_ABORTED);</span>
<a href="#l11.2883"></a><span id="l11.2883" class="difflineminus">-  }</span>
<a href="#l11.2884"></a><span id="l11.2884" class="difflineminus">-</span>
<a href="#l11.2885"></a><span id="l11.2885" class="difflineminus">-  // remove any loading icons</span>
<a href="#l11.2886"></a><span id="l11.2886" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; arcs;</span>
<a href="#l11.2887"></a><span id="l11.2887" class="difflineminus">-  if (NS_SUCCEEDED(rv = mInner-&gt;GetSources(mNC_loading, mTrueLiteral, PR_TRUE,</span>
<a href="#l11.2888"></a><span id="l11.2888" class="difflineminus">-    getter_AddRefs(arcs))))</span>
<a href="#l11.2889"></a><span id="l11.2889" class="difflineminus">-  {</span>
<a href="#l11.2890"></a><span id="l11.2890" class="difflineminus">-    PRBool      hasMore = PR_TRUE;</span>
<a href="#l11.2891"></a><span id="l11.2891" class="difflineminus">-    while (hasMore)</span>
<a href="#l11.2892"></a><span id="l11.2892" class="difflineminus">-    {</span>
<a href="#l11.2893"></a><span id="l11.2893" class="difflineminus">-      if (NS_FAILED(arcs-&gt;HasMoreElements(&amp;hasMore)) || !hasMore)</span>
<a href="#l11.2894"></a><span id="l11.2894" class="difflineminus">-        break;</span>
<a href="#l11.2895"></a><span id="l11.2895" class="difflineminus">-      nsCOMPtr&lt;nsISupports&gt; arc;</span>
<a href="#l11.2896"></a><span id="l11.2896" class="difflineminus">-      if (NS_FAILED(arcs-&gt;GetNext(getter_AddRefs(arc))))</span>
<a href="#l11.2897"></a><span id="l11.2897" class="difflineminus">-        break;</span>
<a href="#l11.2898"></a><span id="l11.2898" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt; src (do_QueryInterface(arc));</span>
<a href="#l11.2899"></a><span id="l11.2899" class="difflineminus">-      if (src)</span>
<a href="#l11.2900"></a><span id="l11.2900" class="difflineminus">-      {</span>
<a href="#l11.2901"></a><span id="l11.2901" class="difflineminus">-        mInner-&gt;Unassert(src, mNC_loading, mTrueLiteral);</span>
<a href="#l11.2902"></a><span id="l11.2902" class="difflineminus">-      }</span>
<a href="#l11.2903"></a><span id="l11.2903" class="difflineminus">-    }</span>
<a href="#l11.2904"></a><span id="l11.2904" class="difflineminus">-  }</span>
<a href="#l11.2905"></a><span id="l11.2905" class="difflineminus">-</span>
<a href="#l11.2906"></a><span id="l11.2906" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.2907"></a><span id="l11.2907" class="difflineminus">-}</span>
<a href="#l11.2908"></a><span id="l11.2908" class="difflineminus">-</span>
<a href="#l11.2909"></a><span id="l11.2909" class="difflineminus">-</span>
<a href="#l11.2910"></a><span id="l11.2910" class="difflineminus">-</span>
<a href="#l11.2911"></a><span id="l11.2911" class="difflineminus">-nsresult</span>
<a href="#l11.2912"></a><span id="l11.2912" class="difflineminus">-InternetSearchDataSource::BeginSearchRequest(nsIRDFResource *source, PRBool doNetworkRequest)</span>
<a href="#l11.2913"></a><span id="l11.2913" class="difflineminus">-{</span>
<a href="#l11.2914"></a><span id="l11.2914" class="difflineminus">-        nsresult    rv = NS_OK;</span>
<a href="#l11.2915"></a><span id="l11.2915" class="difflineminus">-  const char    *sourceURI = nsnull;</span>
<a href="#l11.2916"></a><span id="l11.2916" class="difflineminus">-</span>
<a href="#l11.2917"></a><span id="l11.2917" class="difflineminus">-  if (NS_FAILED(rv = source-&gt;GetValueConst(&amp;sourceURI)))</span>
<a href="#l11.2918"></a><span id="l11.2918" class="difflineminus">-    return(rv);</span>
<a href="#l11.2919"></a><span id="l11.2919" class="difflineminus">-  nsAutoString    uri;</span>
<a href="#l11.2920"></a><span id="l11.2920" class="difflineminus">-  CopyUTF8toUTF16(nsDependentCString(sourceURI), uri);</span>
<a href="#l11.2921"></a><span id="l11.2921" class="difflineminus">-</span>
<a href="#l11.2922"></a><span id="l11.2922" class="difflineminus">-  if (uri.Find(&quot;internetsearch:&quot;) != 0)</span>
<a href="#l11.2923"></a><span id="l11.2923" class="difflineminus">-    return(NS_ERROR_FAILURE);</span>
<a href="#l11.2924"></a><span id="l11.2924" class="difflineminus">-</span>
<a href="#l11.2925"></a><span id="l11.2925" class="difflineminus">-  // forget about any previous search results</span>
<a href="#l11.2926"></a><span id="l11.2926" class="difflineminus">-  ClearResults(PR_TRUE);</span>
<a href="#l11.2927"></a><span id="l11.2927" class="difflineminus">-</span>
<a href="#l11.2928"></a><span id="l11.2928" class="difflineminus">-  // forget about any previous search sites</span>
<a href="#l11.2929"></a><span id="l11.2929" class="difflineminus">-  ClearResultSearchSites();</span>
<a href="#l11.2930"></a><span id="l11.2930" class="difflineminus">-</span>
<a href="#l11.2931"></a><span id="l11.2931" class="difflineminus">-  // remember the last search query</span>
<a href="#l11.2932"></a><span id="l11.2932" class="difflineminus">-  const PRUnichar *uriUni = uri.get();</span>
<a href="#l11.2933"></a><span id="l11.2933" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; uriLiteral;</span>
<a href="#l11.2934"></a><span id="l11.2934" class="difflineminus">-  if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(uriUni, getter_AddRefs(uriLiteral))))</span>
<a href="#l11.2935"></a><span id="l11.2935" class="difflineminus">-  {</span>
<a href="#l11.2936"></a><span id="l11.2936" class="difflineminus">-    rv = mInner-&gt;Assert(mNC_LastSearchRoot, mNC_Ref, uriLiteral, PR_TRUE);</span>
<a href="#l11.2937"></a><span id="l11.2937" class="difflineminus">-  }</span>
<a href="#l11.2938"></a><span id="l11.2938" class="difflineminus">-</span>
<a href="#l11.2939"></a><span id="l11.2939" class="difflineminus">-  uri.Cut(0, strlen(&quot;internetsearch:&quot;));</span>
<a href="#l11.2940"></a><span id="l11.2940" class="difflineminus">-</span>
<a href="#l11.2941"></a><span id="l11.2941" class="difflineminus">-  nsVoidArray *engineArray = new nsVoidArray;</span>
<a href="#l11.2942"></a><span id="l11.2942" class="difflineminus">-  if (!engineArray)</span>
<a href="#l11.2943"></a><span id="l11.2943" class="difflineminus">-    return(NS_ERROR_FAILURE);</span>
<a href="#l11.2944"></a><span id="l11.2944" class="difflineminus">-</span>
<a href="#l11.2945"></a><span id="l11.2945" class="difflineminus">-  nsAutoString  text;</span>
<a href="#l11.2946"></a><span id="l11.2946" class="difflineminus">-</span>
<a href="#l11.2947"></a><span id="l11.2947" class="difflineminus">-  // parse up attributes</span>
<a href="#l11.2948"></a><span id="l11.2948" class="difflineminus">-</span>
<a href="#l11.2949"></a><span id="l11.2949" class="difflineminus">-  while(!uri.IsEmpty())</span>
<a href="#l11.2950"></a><span id="l11.2950" class="difflineminus">-  {</span>
<a href="#l11.2951"></a><span id="l11.2951" class="difflineminus">-    nsAutoString  item;</span>
<a href="#l11.2952"></a><span id="l11.2952" class="difflineminus">-</span>
<a href="#l11.2953"></a><span id="l11.2953" class="difflineminus">-    PRInt32 andOffset = uri.Find(&quot;&amp;&quot;);</span>
<a href="#l11.2954"></a><span id="l11.2954" class="difflineminus">-    if (andOffset &gt;= 0)</span>
<a href="#l11.2955"></a><span id="l11.2955" class="difflineminus">-    {</span>
<a href="#l11.2956"></a><span id="l11.2956" class="difflineminus">-      item = StringHead(uri, andOffset);</span>
<a href="#l11.2957"></a><span id="l11.2957" class="difflineminus">-      uri.Cut(0, andOffset + 1);</span>
<a href="#l11.2958"></a><span id="l11.2958" class="difflineminus">-    }</span>
<a href="#l11.2959"></a><span id="l11.2959" class="difflineminus">-    else</span>
<a href="#l11.2960"></a><span id="l11.2960" class="difflineminus">-    {</span>
<a href="#l11.2961"></a><span id="l11.2961" class="difflineminus">-      item = uri;</span>
<a href="#l11.2962"></a><span id="l11.2962" class="difflineminus">-      uri.Truncate();</span>
<a href="#l11.2963"></a><span id="l11.2963" class="difflineminus">-    }</span>
<a href="#l11.2964"></a><span id="l11.2964" class="difflineminus">-</span>
<a href="#l11.2965"></a><span id="l11.2965" class="difflineminus">-    PRInt32 equalOffset = item.Find(&quot;=&quot;);</span>
<a href="#l11.2966"></a><span id="l11.2966" class="difflineminus">-    if (equalOffset &lt; 0)  break;</span>
<a href="#l11.2967"></a><span id="l11.2967" class="difflineminus">-    </span>
<a href="#l11.2968"></a><span id="l11.2968" class="difflineminus">-    nsAutoString  attrib(StringHead(item, equalOffset)), value(item);</span>
<a href="#l11.2969"></a><span id="l11.2969" class="difflineminus">-    value.Cut(0, equalOffset + 1);</span>
<a href="#l11.2970"></a><span id="l11.2970" class="difflineminus">-    </span>
<a href="#l11.2971"></a><span id="l11.2971" class="difflineminus">-    if (!attrib.IsEmpty() &amp;&amp; !value.IsEmpty())</span>
<a href="#l11.2972"></a><span id="l11.2972" class="difflineminus">-    {</span>
<a href="#l11.2973"></a><span id="l11.2973" class="difflineminus">-      if (attrib.LowerCaseEqualsLiteral(&quot;engine&quot;))</span>
<a href="#l11.2974"></a><span id="l11.2974" class="difflineminus">-      {</span>
<a href="#l11.2975"></a><span id="l11.2975" class="difflineminus">-        if ((value.Find(kEngineProtocol) == 0) ||</span>
<a href="#l11.2976"></a><span id="l11.2976" class="difflineminus">-          (value.Find(kURINC_SearchCategoryEnginePrefix) == 0))</span>
<a href="#l11.2977"></a><span id="l11.2977" class="difflineminus">-        {</span>
<a href="#l11.2978"></a><span id="l11.2978" class="difflineminus">-          char  *val = ToNewCString(NS_LossyConvertUTF16toASCII(value));</span>
<a href="#l11.2979"></a><span id="l11.2979" class="difflineminus">-          if (val)</span>
<a href="#l11.2980"></a><span id="l11.2980" class="difflineminus">-          {</span>
<a href="#l11.2981"></a><span id="l11.2981" class="difflineminus">-            engineArray-&gt;AppendElement(val);</span>
<a href="#l11.2982"></a><span id="l11.2982" class="difflineminus">-          }</span>
<a href="#l11.2983"></a><span id="l11.2983" class="difflineminus">-        }</span>
<a href="#l11.2984"></a><span id="l11.2984" class="difflineminus">-      }</span>
<a href="#l11.2985"></a><span id="l11.2985" class="difflineminus">-      else if (attrib.LowerCaseEqualsLiteral(&quot;text&quot;))</span>
<a href="#l11.2986"></a><span id="l11.2986" class="difflineminus">-      {</span>
<a href="#l11.2987"></a><span id="l11.2987" class="difflineminus">-        text = value;</span>
<a href="#l11.2988"></a><span id="l11.2988" class="difflineminus">-      }</span>
<a href="#l11.2989"></a><span id="l11.2989" class="difflineminus">-    }</span>
<a href="#l11.2990"></a><span id="l11.2990" class="difflineminus">-  }</span>
<a href="#l11.2991"></a><span id="l11.2991" class="difflineminus">-</span>
<a href="#l11.2992"></a><span id="l11.2992" class="difflineminus">-  mInner-&gt;Assert(source, mNC_loading, mTrueLiteral, PR_TRUE);</span>
<a href="#l11.2993"></a><span id="l11.2993" class="difflineminus">-</span>
<a href="#l11.2994"></a><span id="l11.2994" class="difflineminus">-  PRBool  requestInitiated = PR_FALSE;</span>
<a href="#l11.2995"></a><span id="l11.2995" class="difflineminus">-</span>
<a href="#l11.2996"></a><span id="l11.2996" class="difflineminus">-  // loop over specified search engines</span>
<a href="#l11.2997"></a><span id="l11.2997" class="difflineminus">-  while (engineArray-&gt;Count() &gt; 0)</span>
<a href="#l11.2998"></a><span id="l11.2998" class="difflineminus">-  {</span>
<a href="#l11.2999"></a><span id="l11.2999" class="difflineminus">-    char *baseFilename = (char *)(engineArray-&gt;ElementAt(0));</span>
<a href="#l11.3000"></a><span id="l11.3000" class="difflineminus">-    engineArray-&gt;RemoveElementAt(0);</span>
<a href="#l11.3001"></a><span id="l11.3001" class="difflineminus">-    if (!baseFilename)  continue;</span>
<a href="#l11.3002"></a><span id="l11.3002" class="difflineminus">-</span>
<a href="#l11.3003"></a><span id="l11.3003" class="difflineminus">-#ifdef  DEBUG_SEARCH_OUTPUT</span>
<a href="#l11.3004"></a><span id="l11.3004" class="difflineminus">-    printf(&quot;Search engine to query: '%s'\n&quot;, baseFilename);</span>
<a href="#l11.3005"></a><span id="l11.3005" class="difflineminus">-#endif</span>
<a href="#l11.3006"></a><span id="l11.3006" class="difflineminus">-</span>
<a href="#l11.3007"></a><span id="l11.3007" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt;  engine;</span>
<a href="#l11.3008"></a><span id="l11.3008" class="difflineminus">-    mRDFService-&gt;GetResource(nsDependentCString(baseFilename), getter_AddRefs(engine));</span>
<a href="#l11.3009"></a><span id="l11.3009" class="difflineminus">-    NS_Free(baseFilename);</span>
<a href="#l11.3010"></a><span id="l11.3010" class="difflineminus">-    baseFilename = nsnull;</span>
<a href="#l11.3011"></a><span id="l11.3011" class="difflineminus">-    if (!engine)  continue;</span>
<a href="#l11.3012"></a><span id="l11.3012" class="difflineminus">-</span>
<a href="#l11.3013"></a><span id="l11.3013" class="difflineminus">-    // if it's an engine from a search category, then get its &quot;#Name&quot;,</span>
<a href="#l11.3014"></a><span id="l11.3014" class="difflineminus">-    // and map from that back to the real engine reference; if an</span>
<a href="#l11.3015"></a><span id="l11.3015" class="difflineminus">-    // error occurs, finish processing the rest of the engines,</span>
<a href="#l11.3016"></a><span id="l11.3016" class="difflineminus">-    // don't just break/return out</span>
<a href="#l11.3017"></a><span id="l11.3017" class="difflineminus">-    if (isSearchCategoryEngineURI(engine))</span>
<a href="#l11.3018"></a><span id="l11.3018" class="difflineminus">-    {</span>
<a href="#l11.3019"></a><span id="l11.3019" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt;  trueEngine;</span>
<a href="#l11.3020"></a><span id="l11.3020" class="difflineminus">-      rv = resolveSearchCategoryEngineURI(engine, getter_AddRefs(trueEngine));</span>
<a href="#l11.3021"></a><span id="l11.3021" class="difflineminus">-      if (NS_FAILED(rv) || !trueEngine)</span>
<a href="#l11.3022"></a><span id="l11.3022" class="difflineminus">-        continue;</span>
<a href="#l11.3023"></a><span id="l11.3023" class="difflineminus">-      engine = trueEngine;</span>
<a href="#l11.3024"></a><span id="l11.3024" class="difflineminus">-    }</span>
<a href="#l11.3025"></a><span id="l11.3025" class="difflineminus">-</span>
<a href="#l11.3026"></a><span id="l11.3026" class="difflineminus">-    // mark this as a search site</span>
<a href="#l11.3027"></a><span id="l11.3027" class="difflineminus">-    if (mInner)</span>
<a href="#l11.3028"></a><span id="l11.3028" class="difflineminus">-    {</span>
<a href="#l11.3029"></a><span id="l11.3029" class="difflineminus">-      mInner-&gt;Assert(mNC_SearchResultsSitesRoot, mNC_Child, engine, PR_TRUE);</span>
<a href="#l11.3030"></a><span id="l11.3030" class="difflineminus">-    }</span>
<a href="#l11.3031"></a><span id="l11.3031" class="difflineminus">-</span>
<a href="#l11.3032"></a><span id="l11.3032" class="difflineminus">-    if (doNetworkRequest)</span>
<a href="#l11.3033"></a><span id="l11.3033" class="difflineminus">-    {</span>
<a href="#l11.3034"></a><span id="l11.3034" class="difflineminus">-      DoSearch(source, engine, EmptyString(), text);</span>
<a href="#l11.3035"></a><span id="l11.3035" class="difflineminus">-      requestInitiated = PR_TRUE;</span>
<a href="#l11.3036"></a><span id="l11.3036" class="difflineminus">-    }</span>
<a href="#l11.3037"></a><span id="l11.3037" class="difflineminus">-  }</span>
<a href="#l11.3038"></a><span id="l11.3038" class="difflineminus">-  </span>
<a href="#l11.3039"></a><span id="l11.3039" class="difflineminus">-  delete engineArray;</span>
<a href="#l11.3040"></a><span id="l11.3040" class="difflineminus">-  engineArray = nsnull;</span>
<a href="#l11.3041"></a><span id="l11.3041" class="difflineminus">-</span>
<a href="#l11.3042"></a><span id="l11.3042" class="difflineminus">-  if (!requestInitiated)</span>
<a href="#l11.3043"></a><span id="l11.3043" class="difflineminus">-  {</span>
<a href="#l11.3044"></a><span id="l11.3044" class="difflineminus">-    Stop();</span>
<a href="#l11.3045"></a><span id="l11.3045" class="difflineminus">-  }</span>
<a href="#l11.3046"></a><span id="l11.3046" class="difflineminus">-</span>
<a href="#l11.3047"></a><span id="l11.3047" class="difflineminus">-  return(rv);</span>
<a href="#l11.3048"></a><span id="l11.3048" class="difflineminus">-}</span>
<a href="#l11.3049"></a><span id="l11.3049" class="difflineminus">-</span>
<a href="#l11.3050"></a><span id="l11.3050" class="difflineminus">-</span>
<a href="#l11.3051"></a><span id="l11.3051" class="difflineminus">-</span>
<a href="#l11.3052"></a><span id="l11.3052" class="difflineminus">-nsresult</span>
<a href="#l11.3053"></a><span id="l11.3053" class="difflineminus">-InternetSearchDataSource::FindData(nsIRDFResource *engine, nsIRDFLiteral **dataLit)</span>
<a href="#l11.3054"></a><span id="l11.3054" class="difflineminus">-{</span>
<a href="#l11.3055"></a><span id="l11.3055" class="difflineminus">-  if (!engine)  return(NS_ERROR_NULL_POINTER);</span>
<a href="#l11.3056"></a><span id="l11.3056" class="difflineminus">-  if (!dataLit) return(NS_ERROR_NULL_POINTER);</span>
<a href="#l11.3057"></a><span id="l11.3057" class="difflineminus">-</span>
<a href="#l11.3058"></a><span id="l11.3058" class="difflineminus">-  *dataLit = nsnull;</span>
<a href="#l11.3059"></a><span id="l11.3059" class="difflineminus">-</span>
<a href="#l11.3060"></a><span id="l11.3060" class="difflineminus">-  if (!mInner)  return(NS_RDF_NO_VALUE);</span>
<a href="#l11.3061"></a><span id="l11.3061" class="difflineminus">-</span>
<a href="#l11.3062"></a><span id="l11.3062" class="difflineminus">-  nsresult    rv;</span>
<a href="#l11.3063"></a><span id="l11.3063" class="difflineminus">-</span>
<a href="#l11.3064"></a><span id="l11.3064" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt;  dataTarget = nsnull;</span>
<a href="#l11.3065"></a><span id="l11.3065" class="difflineminus">-  if (NS_SUCCEEDED((rv = mInner-&gt;GetTarget(engine, mNC_Data, PR_TRUE,</span>
<a href="#l11.3066"></a><span id="l11.3066" class="difflineminus">-    getter_AddRefs(dataTarget)))) &amp;&amp; (dataTarget))</span>
<a href="#l11.3067"></a><span id="l11.3067" class="difflineminus">-  {</span>
<a href="#l11.3068"></a><span id="l11.3068" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; aLiteral (do_QueryInterface(dataTarget));</span>
<a href="#l11.3069"></a><span id="l11.3069" class="difflineminus">-    if (!aLiteral)</span>
<a href="#l11.3070"></a><span id="l11.3070" class="difflineminus">-      return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.3071"></a><span id="l11.3071" class="difflineminus">-    *dataLit = aLiteral;</span>
<a href="#l11.3072"></a><span id="l11.3072" class="difflineminus">-    NS_IF_ADDREF(*dataLit);</span>
<a href="#l11.3073"></a><span id="l11.3073" class="difflineminus">-    return(NS_OK);</span>
<a href="#l11.3074"></a><span id="l11.3074" class="difflineminus">-  }</span>
<a href="#l11.3075"></a><span id="l11.3075" class="difflineminus">-</span>
<a href="#l11.3076"></a><span id="l11.3076" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; engineFile;</span>
<a href="#l11.3077"></a><span id="l11.3077" class="difflineminus">-        rv = EngineFileFromResource(engine, getter_AddRefs(engineFile));</span>
<a href="#l11.3078"></a><span id="l11.3078" class="difflineminus">-        if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.3079"></a><span id="l11.3079" class="difflineminus">-</span>
<a href="#l11.3080"></a><span id="l11.3080" class="difflineminus">-        nsString  data;</span>
<a href="#l11.3081"></a><span id="l11.3081" class="difflineminus">-        rv = ReadFileContents(engineFile, data);</span>
<a href="#l11.3082"></a><span id="l11.3082" class="difflineminus">-</span>
<a href="#l11.3083"></a><span id="l11.3083" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l11.3084"></a><span id="l11.3084" class="difflineminus">-  {</span>
<a href="#l11.3085"></a><span id="l11.3085" class="difflineminus">-    return(rv);</span>
<a href="#l11.3086"></a><span id="l11.3086" class="difflineminus">-  }</span>
<a href="#l11.3087"></a><span id="l11.3087" class="difflineminus">-</span>
<a href="#l11.3088"></a><span id="l11.3088" class="difflineminus">-  // save file contents</span>
<a href="#l11.3089"></a><span id="l11.3089" class="difflineminus">-  if (data.IsEmpty()) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.3090"></a><span id="l11.3090" class="difflineminus">-</span>
<a href="#l11.3091"></a><span id="l11.3091" class="difflineminus">-  rv = updateDataHintsInGraph(engine, data.get());</span>
<a href="#l11.3092"></a><span id="l11.3092" class="difflineminus">-</span>
<a href="#l11.3093"></a><span id="l11.3093" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; aLiteral;</span>
<a href="#l11.3094"></a><span id="l11.3094" class="difflineminus">-  if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(data.get(), getter_AddRefs(aLiteral))))</span>
<a href="#l11.3095"></a><span id="l11.3095" class="difflineminus">-  {</span>
<a href="#l11.3096"></a><span id="l11.3096" class="difflineminus">-    *dataLit = aLiteral;</span>
<a href="#l11.3097"></a><span id="l11.3097" class="difflineminus">-    NS_IF_ADDREF(*dataLit);</span>
<a href="#l11.3098"></a><span id="l11.3098" class="difflineminus">-  }</span>
<a href="#l11.3099"></a><span id="l11.3099" class="difflineminus">-  </span>
<a href="#l11.3100"></a><span id="l11.3100" class="difflineminus">-  return(rv);</span>
<a href="#l11.3101"></a><span id="l11.3101" class="difflineminus">-}</span>
<a href="#l11.3102"></a><span id="l11.3102" class="difflineminus">-</span>
<a href="#l11.3103"></a><span id="l11.3103" class="difflineminus">-nsresult</span>
<a href="#l11.3104"></a><span id="l11.3104" class="difflineminus">-InternetSearchDataSource::EngineFileFromResource(nsIRDFResource *aResource,</span>
<a href="#l11.3105"></a><span id="l11.3105" class="difflineminus">-                                                 nsILocalFile **aResult)</span>
<a href="#l11.3106"></a><span id="l11.3106" class="difflineminus">-{</span>
<a href="#l11.3107"></a><span id="l11.3107" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l11.3108"></a><span id="l11.3108" class="difflineminus">-</span>
<a href="#l11.3109"></a><span id="l11.3109" class="difflineminus">-  // get resource uri</span>
<a href="#l11.3110"></a><span id="l11.3110" class="difflineminus">-  const char *engineURI = nsnull;</span>
<a href="#l11.3111"></a><span id="l11.3111" class="difflineminus">-  rv = aResource-&gt;GetValueConst(&amp;engineURI);</span>
<a href="#l11.3112"></a><span id="l11.3112" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3113"></a><span id="l11.3113" class="difflineminus">-</span>
<a href="#l11.3114"></a><span id="l11.3114" class="difflineminus">-  // remove protocol from uri and get escaped file path</span>
<a href="#l11.3115"></a><span id="l11.3115" class="difflineminus">-  nsCAutoString nativePath;</span>
<a href="#l11.3116"></a><span id="l11.3116" class="difflineminus">-  nativePath.Assign(engineURI);</span>
<a href="#l11.3117"></a><span id="l11.3117" class="difflineminus">-</span>
<a href="#l11.3118"></a><span id="l11.3118" class="difflineminus">-  NS_ENSURE_TRUE(StringBeginsWith(nativePath,</span>
<a href="#l11.3119"></a><span id="l11.3119" class="difflineminus">-                                  NS_LITERAL_CSTRING(kEngineProtocol)),</span>
<a href="#l11.3120"></a><span id="l11.3120" class="difflineminus">-                 NS_ERROR_FAILURE);</span>
<a href="#l11.3121"></a><span id="l11.3121" class="difflineminus">-  nativePath.Cut(0, sizeof(kEngineProtocol) - 1);</span>
<a href="#l11.3122"></a><span id="l11.3122" class="difflineminus">-</span>
<a href="#l11.3123"></a><span id="l11.3123" class="difflineminus">-  // unescape it</span>
<a href="#l11.3124"></a><span id="l11.3124" class="difflineminus">-  nsCOMPtr&lt;nsINetUtil&gt; netUtil = do_GetService(NS_NETUTIL_CONTRACTID, &amp;rv);</span>
<a href="#l11.3125"></a><span id="l11.3125" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3126"></a><span id="l11.3126" class="difflineminus">-</span>
<a href="#l11.3127"></a><span id="l11.3127" class="difflineminus">-  nsCString nativePathSrc = nativePath;</span>
<a href="#l11.3128"></a><span id="l11.3128" class="difflineminus">-  rv = netUtil-&gt;UnescapeString(nativePathSrc, 0, nativePath);</span>
<a href="#l11.3129"></a><span id="l11.3129" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3130"></a><span id="l11.3130" class="difflineminus">-</span>
<a href="#l11.3131"></a><span id="l11.3131" class="difflineminus">-#ifdef DEBUG_SEARCH_OUTPUT</span>
<a href="#l11.3132"></a><span id="l11.3132" class="difflineminus">-  printf(&quot;InternetSearchDataSource::EngineFileFromResource\n&quot;</span>
<a href="#l11.3133"></a><span id="l11.3133" class="difflineminus">-         &quot;File Path: %s\n&quot;,</span>
<a href="#l11.3134"></a><span id="l11.3134" class="difflineminus">-         nativePath.get());</span>
<a href="#l11.3135"></a><span id="l11.3135" class="difflineminus">-#endif</span>
<a href="#l11.3136"></a><span id="l11.3136" class="difflineminus">-</span>
<a href="#l11.3137"></a><span id="l11.3137" class="difflineminus">-  rv = NS_NewNativeLocalFile(nativePath, PR_TRUE, aResult);</span>
<a href="#l11.3138"></a><span id="l11.3138" class="difflineminus">-</span>
<a href="#l11.3139"></a><span id="l11.3139" class="difflineminus">-  return rv;</span>
<a href="#l11.3140"></a><span id="l11.3140" class="difflineminus">-}</span>
<a href="#l11.3141"></a><span id="l11.3141" class="difflineminus">-</span>
<a href="#l11.3142"></a><span id="l11.3142" class="difflineminus">-nsresult</span>
<a href="#l11.3143"></a><span id="l11.3143" class="difflineminus">-InternetSearchDataSource::DecodeData(const char *aCharset, const PRUnichar *aInString, PRUnichar **aOutString)</span>
<a href="#l11.3144"></a><span id="l11.3144" class="difflineminus">-{</span>
<a href="#l11.3145"></a><span id="l11.3145" class="difflineminus">-  nsresult rv;</span>
<a href="#l11.3146"></a><span id="l11.3146" class="difflineminus">-    </span>
<a href="#l11.3147"></a><span id="l11.3147" class="difflineminus">-  nsCOMPtr &lt;nsICharsetConverterManager&gt; charsetConv = </span>
<a href="#l11.3148"></a><span id="l11.3148" class="difflineminus">-          do_GetService(NS_CHARSETCONVERTERMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l11.3149"></a><span id="l11.3149" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3150"></a><span id="l11.3150" class="difflineminus">-</span>
<a href="#l11.3151"></a><span id="l11.3151" class="difflineminus">-  nsCOMPtr&lt;nsIUnicodeDecoder&gt; unicodeDecoder;</span>
<a href="#l11.3152"></a><span id="l11.3152" class="difflineminus">-  rv = charsetConv-&gt;GetUnicodeDecoder(aCharset, getter_AddRefs(unicodeDecoder));</span>
<a href="#l11.3153"></a><span id="l11.3153" class="difflineminus">-</span>
<a href="#l11.3154"></a><span id="l11.3154" class="difflineminus">-  // Use the sherlock default charset in case of failure</span>
<a href="#l11.3155"></a><span id="l11.3155" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l11.3156"></a><span id="l11.3156" class="difflineminus">-    rv = charsetConv-&gt;GetUnicodeDecoderRaw(&quot;x-mac-roman&quot;, getter_AddRefs(unicodeDecoder));</span>
<a href="#l11.3157"></a><span id="l11.3157" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3158"></a><span id="l11.3158" class="difflineminus">-</span>
<a href="#l11.3159"></a><span id="l11.3159" class="difflineminus">-  // This fixes the corruption occured in InternetSearchDataSource::ReadFileContents()</span>
<a href="#l11.3160"></a><span id="l11.3160" class="difflineminus">-  // (eg. aValue contains &quot;0x0082 0x00a1&quot; for &quot;0x82 0xa1&quot; shift_jis double-byte char)</span>
<a href="#l11.3161"></a><span id="l11.3161" class="difflineminus">-  NS_LossyConvertUTF16toASCII value(aInString);</span>
<a href="#l11.3162"></a><span id="l11.3162" class="difflineminus">-</span>
<a href="#l11.3163"></a><span id="l11.3163" class="difflineminus">-  PRInt32 srcLength = value.Length();</span>
<a href="#l11.3164"></a><span id="l11.3164" class="difflineminus">-  PRInt32 outUnicodeLen;</span>
<a href="#l11.3165"></a><span id="l11.3165" class="difflineminus">-  rv = unicodeDecoder-&gt;GetMaxLength(value.get(), srcLength, &amp;outUnicodeLen);</span>
<a href="#l11.3166"></a><span id="l11.3166" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3167"></a><span id="l11.3167" class="difflineminus">-</span>
<a href="#l11.3168"></a><span id="l11.3168" class="difflineminus">-  *aOutString = reinterpret_cast&lt;PRUnichar*&gt;(nsMemory::Alloc((outUnicodeLen + 1) * sizeof(PRUnichar)));</span>
<a href="#l11.3169"></a><span id="l11.3169" class="difflineminus">-  NS_ENSURE_TRUE(*aOutString, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l11.3170"></a><span id="l11.3170" class="difflineminus">-</span>
<a href="#l11.3171"></a><span id="l11.3171" class="difflineminus">-  rv = unicodeDecoder-&gt;Convert(value.get(), &amp;srcLength, *aOutString, &amp;outUnicodeLen);</span>
<a href="#l11.3172"></a><span id="l11.3172" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3173"></a><span id="l11.3173" class="difflineminus">-  (*aOutString)[outUnicodeLen] = (PRUnichar)'\0';</span>
<a href="#l11.3174"></a><span id="l11.3174" class="difflineminus">-</span>
<a href="#l11.3175"></a><span id="l11.3175" class="difflineminus">-  return rv;</span>
<a href="#l11.3176"></a><span id="l11.3176" class="difflineminus">-}</span>
<a href="#l11.3177"></a><span id="l11.3177" class="difflineminus">-</span>
<a href="#l11.3178"></a><span id="l11.3178" class="difflineminus">-nsresult</span>
<a href="#l11.3179"></a><span id="l11.3179" class="difflineminus">-InternetSearchDataSource::updateDataHintsInGraph(nsIRDFResource *engine, const PRUnichar *dataUni)</span>
<a href="#l11.3180"></a><span id="l11.3180" class="difflineminus">-{</span>
<a href="#l11.3181"></a><span id="l11.3181" class="difflineminus">-  nsresult  rv = NS_OK;</span>
<a href="#l11.3182"></a><span id="l11.3182" class="difflineminus">-</span>
<a href="#l11.3183"></a><span id="l11.3183" class="difflineminus">-  // save/update search engine data</span>
<a href="#l11.3184"></a><span id="l11.3184" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; dataLiteral;</span>
<a href="#l11.3185"></a><span id="l11.3185" class="difflineminus">-  if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(dataUni, getter_AddRefs(dataLiteral))))</span>
<a href="#l11.3186"></a><span id="l11.3186" class="difflineminus">-  {</span>
<a href="#l11.3187"></a><span id="l11.3187" class="difflineminus">-    updateAtom(mInner, engine, mNC_Data, dataLiteral, nsnull);</span>
<a href="#l11.3188"></a><span id="l11.3188" class="difflineminus">-  }</span>
<a href="#l11.3189"></a><span id="l11.3189" class="difflineminus">-</span>
<a href="#l11.3190"></a><span id="l11.3190" class="difflineminus">-  // save/update name of search engine (as specified in file)</span>
<a href="#l11.3191"></a><span id="l11.3191" class="difflineminus">-  nsAutoString scriptCodeValue;</span>
<a href="#l11.3192"></a><span id="l11.3192" class="difflineminus">-  const char * charsetName = MapScriptCodeToCharsetName(0);</span>
<a href="#l11.3193"></a><span id="l11.3193" class="difflineminus">-  nsString decodedValue;</span>
<a href="#l11.3194"></a><span id="l11.3194" class="difflineminus">-</span>
<a href="#l11.3195"></a><span id="l11.3195" class="difflineminus">-  if (NS_SUCCEEDED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;sourceTextEncoding&quot;, scriptCodeValue)) &amp;&amp; </span>
<a href="#l11.3196"></a><span id="l11.3196" class="difflineminus">-    !scriptCodeValue.IsEmpty())</span>
<a href="#l11.3197"></a><span id="l11.3197" class="difflineminus">-  {</span>
<a href="#l11.3198"></a><span id="l11.3198" class="difflineminus">-    PRInt32 scriptCode = scriptCodeValue.ToInteger(&amp;rv);</span>
<a href="#l11.3199"></a><span id="l11.3199" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l11.3200"></a><span id="l11.3200" class="difflineminus">-      charsetName = MapScriptCodeToCharsetName(scriptCode);</span>
<a href="#l11.3201"></a><span id="l11.3201" class="difflineminus">-  }</span>
<a href="#l11.3202"></a><span id="l11.3202" class="difflineminus">-</span>
<a href="#l11.3203"></a><span id="l11.3203" class="difflineminus">-  nsAutoString  nameValue;</span>
<a href="#l11.3204"></a><span id="l11.3204" class="difflineminus">-  if (NS_SUCCEEDED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;name&quot;, nameValue)))</span>
<a href="#l11.3205"></a><span id="l11.3205" class="difflineminus">-  {</span>
<a href="#l11.3206"></a><span id="l11.3206" class="difflineminus">-    rv = DecodeData(charsetName, nameValue.get(), getter_Copies(decodedValue));</span>
<a href="#l11.3207"></a><span id="l11.3207" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; nameLiteral;</span>
<a href="#l11.3208"></a><span id="l11.3208" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp;</span>
<a href="#l11.3209"></a><span id="l11.3209" class="difflineminus">-        NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(decodedValue.get(),</span>
<a href="#l11.3210"></a><span id="l11.3210" class="difflineminus">-                                                  getter_AddRefs(nameLiteral))))</span>
<a href="#l11.3211"></a><span id="l11.3211" class="difflineminus">-    {</span>
<a href="#l11.3212"></a><span id="l11.3212" class="difflineminus">-      rv = updateAtom(mInner, engine, mNC_Name, nameLiteral, nsnull);</span>
<a href="#l11.3213"></a><span id="l11.3213" class="difflineminus">-    }</span>
<a href="#l11.3214"></a><span id="l11.3214" class="difflineminus">-  }</span>
<a href="#l11.3215"></a><span id="l11.3215" class="difflineminus">-</span>
<a href="#l11.3216"></a><span id="l11.3216" class="difflineminus">-  // save/update description of search engine (if specified)</span>
<a href="#l11.3217"></a><span id="l11.3217" class="difflineminus">-  nsAutoString  descValue;</span>
<a href="#l11.3218"></a><span id="l11.3218" class="difflineminus">-  if (NS_SUCCEEDED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;description&quot;, descValue)))</span>
<a href="#l11.3219"></a><span id="l11.3219" class="difflineminus">-  {</span>
<a href="#l11.3220"></a><span id="l11.3220" class="difflineminus">-    rv = DecodeData(charsetName, descValue.get(), getter_Copies(decodedValue));</span>
<a href="#l11.3221"></a><span id="l11.3221" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; descLiteral;</span>
<a href="#l11.3222"></a><span id="l11.3222" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp;</span>
<a href="#l11.3223"></a><span id="l11.3223" class="difflineminus">-        NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(decodedValue.get(),</span>
<a href="#l11.3224"></a><span id="l11.3224" class="difflineminus">-                                                  getter_AddRefs(descLiteral))))</span>
<a href="#l11.3225"></a><span id="l11.3225" class="difflineminus">-    {</span>
<a href="#l11.3226"></a><span id="l11.3226" class="difflineminus">-      rv = updateAtom(mInner, engine, mNC_Description, descLiteral, nsnull);</span>
<a href="#l11.3227"></a><span id="l11.3227" class="difflineminus">-    }</span>
<a href="#l11.3228"></a><span id="l11.3228" class="difflineminus">-  }</span>
<a href="#l11.3229"></a><span id="l11.3229" class="difflineminus">-</span>
<a href="#l11.3230"></a><span id="l11.3230" class="difflineminus">-  // save/update version of search engine (if specified)</span>
<a href="#l11.3231"></a><span id="l11.3231" class="difflineminus">-  nsAutoString  versionValue;</span>
<a href="#l11.3232"></a><span id="l11.3232" class="difflineminus">-  if (NS_SUCCEEDED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;version&quot;, versionValue)))</span>
<a href="#l11.3233"></a><span id="l11.3233" class="difflineminus">-  {</span>
<a href="#l11.3234"></a><span id="l11.3234" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; versionLiteral;</span>
<a href="#l11.3235"></a><span id="l11.3235" class="difflineminus">-    if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(versionValue.get(),</span>
<a href="#l11.3236"></a><span id="l11.3236" class="difflineminus">-        getter_AddRefs(versionLiteral))))</span>
<a href="#l11.3237"></a><span id="l11.3237" class="difflineminus">-    {</span>
<a href="#l11.3238"></a><span id="l11.3238" class="difflineminus">-      rv = updateAtom(mInner, engine, mNC_Version, versionLiteral, nsnull);</span>
<a href="#l11.3239"></a><span id="l11.3239" class="difflineminus">-    }</span>
<a href="#l11.3240"></a><span id="l11.3240" class="difflineminus">-  }</span>
<a href="#l11.3241"></a><span id="l11.3241" class="difflineminus">-</span>
<a href="#l11.3242"></a><span id="l11.3242" class="difflineminus">-  nsAutoString  buttonValue;</span>
<a href="#l11.3243"></a><span id="l11.3243" class="difflineminus">-  if (NS_SUCCEEDED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;actionButton&quot;, buttonValue)))</span>
<a href="#l11.3244"></a><span id="l11.3244" class="difflineminus">-  {</span>
<a href="#l11.3245"></a><span id="l11.3245" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; buttonLiteral;</span>
<a href="#l11.3246"></a><span id="l11.3246" class="difflineminus">-    if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(buttonValue.get(),</span>
<a href="#l11.3247"></a><span id="l11.3247" class="difflineminus">-        getter_AddRefs(buttonLiteral))))</span>
<a href="#l11.3248"></a><span id="l11.3248" class="difflineminus">-    {</span>
<a href="#l11.3249"></a><span id="l11.3249" class="difflineminus">-      rv = updateAtom(mInner, engine, mNC_actionButton, buttonLiteral, nsnull);</span>
<a href="#l11.3250"></a><span id="l11.3250" class="difflineminus">-    }</span>
<a href="#l11.3251"></a><span id="l11.3251" class="difflineminus">-  }</span>
<a href="#l11.3252"></a><span id="l11.3252" class="difflineminus">-</span>
<a href="#l11.3253"></a><span id="l11.3253" class="difflineminus">-  nsAutoString  barValue;</span>
<a href="#l11.3254"></a><span id="l11.3254" class="difflineminus">-  if (NS_SUCCEEDED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;actionBar&quot;, barValue)))</span>
<a href="#l11.3255"></a><span id="l11.3255" class="difflineminus">-  {</span>
<a href="#l11.3256"></a><span id="l11.3256" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; barLiteral;</span>
<a href="#l11.3257"></a><span id="l11.3257" class="difflineminus">-    if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(barValue.get(),</span>
<a href="#l11.3258"></a><span id="l11.3258" class="difflineminus">-        getter_AddRefs(barLiteral))))</span>
<a href="#l11.3259"></a><span id="l11.3259" class="difflineminus">-    {</span>
<a href="#l11.3260"></a><span id="l11.3260" class="difflineminus">-      rv = updateAtom(mInner, engine, mNC_actionBar, barLiteral, nsnull);</span>
<a href="#l11.3261"></a><span id="l11.3261" class="difflineminus">-    }</span>
<a href="#l11.3262"></a><span id="l11.3262" class="difflineminus">-  }</span>
<a href="#l11.3263"></a><span id="l11.3263" class="difflineminus">-</span>
<a href="#l11.3264"></a><span id="l11.3264" class="difflineminus">-  nsAutoString  searchFormValue;</span>
<a href="#l11.3265"></a><span id="l11.3265" class="difflineminus">-  if (NS_SUCCEEDED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;searchForm&quot;, searchFormValue)))</span>
<a href="#l11.3266"></a><span id="l11.3266" class="difflineminus">-  {</span>
<a href="#l11.3267"></a><span id="l11.3267" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; searchFormLiteral;</span>
<a href="#l11.3268"></a><span id="l11.3268" class="difflineminus">-    if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(searchFormValue.get(),</span>
<a href="#l11.3269"></a><span id="l11.3269" class="difflineminus">-        getter_AddRefs(searchFormLiteral))))</span>
<a href="#l11.3270"></a><span id="l11.3270" class="difflineminus">-    {</span>
<a href="#l11.3271"></a><span id="l11.3271" class="difflineminus">-      rv = updateAtom(mInner, engine, mNC_searchForm, searchFormLiteral, nsnull);</span>
<a href="#l11.3272"></a><span id="l11.3272" class="difflineminus">-    }</span>
<a href="#l11.3273"></a><span id="l11.3273" class="difflineminus">-  }</span>
<a href="#l11.3274"></a><span id="l11.3274" class="difflineminus">-</span>
<a href="#l11.3275"></a><span id="l11.3275" class="difflineminus">-</span>
<a href="#l11.3276"></a><span id="l11.3276" class="difflineminus">-  PRBool  updatePrivateFiles = PR_FALSE;</span>
<a href="#l11.3277"></a><span id="l11.3277" class="difflineminus">-</span>
<a href="#l11.3278"></a><span id="l11.3278" class="difflineminus">-  rv = mInner-&gt;HasAssertion(engine, mNC_SearchType, mNC_Engine, PR_TRUE,</span>
<a href="#l11.3279"></a><span id="l11.3279" class="difflineminus">-                            &amp;updatePrivateFiles);</span>
<a href="#l11.3280"></a><span id="l11.3280" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; updatePrivateFiles)</span>
<a href="#l11.3281"></a><span id="l11.3281" class="difflineminus">-  {</span>
<a href="#l11.3282"></a><span id="l11.3282" class="difflineminus">-    // rjc says: so here is our strategy. The spec says that the &quot;search&quot;|&quot;update&quot;</span>
<a href="#l11.3283"></a><span id="l11.3283" class="difflineminus">-    // attribute MUST refer to a binhex-ed file (i.e. ends with &quot;.src.hqx&quot;). We don't</span>
<a href="#l11.3284"></a><span id="l11.3284" class="difflineminus">-    // support binhex (due to being cross-platform minded folks) and, even if we did,</span>
<a href="#l11.3285"></a><span id="l11.3285" class="difflineminus">-    // its not enough info to figure out what the appropriate icon should be.</span>
<a href="#l11.3286"></a><span id="l11.3286" class="difflineminus">-    // The answer: we're add additional attributes in our private &lt;BROWSER&gt; section</span>
<a href="#l11.3287"></a><span id="l11.3287" class="difflineminus">-    // to re-define these values. If they aren't there, we'll fallback to the &lt;SEARCH&gt;</span>
<a href="#l11.3288"></a><span id="l11.3288" class="difflineminus">-    // section values and try and make logical choices:  for example, if we have an</span>
<a href="#l11.3289"></a><span id="l11.3289" class="difflineminus">-    // &quot;update&quot; URL which ends with &quot;.src.hqx&quot;, we'll strip off the &quot;.hqx&quot; part and</span>
<a href="#l11.3290"></a><span id="l11.3290" class="difflineminus">-    // check to see if it exists... which at least makes it possible for a web site</span>
<a href="#l11.3291"></a><span id="l11.3291" class="difflineminus">-    // to put up both a binhexed version and a straight text version of the search file.</span>
<a href="#l11.3292"></a><span id="l11.3292" class="difflineminus">-</span>
<a href="#l11.3293"></a><span id="l11.3293" class="difflineminus">-    // get update URL and # of days to check for updates</span>
<a href="#l11.3294"></a><span id="l11.3294" class="difflineminus">-    // Note: only check for updates on our private search files</span>
<a href="#l11.3295"></a><span id="l11.3295" class="difflineminus">-    nsAutoString  updateStr, updateIconStr, updateCheckDaysStr;</span>
<a href="#l11.3296"></a><span id="l11.3296" class="difflineminus">-</span>
<a href="#l11.3297"></a><span id="l11.3297" class="difflineminus">-    GetData(dataUni, &quot;browser&quot;, 0, &quot;update&quot;, updateStr);</span>
<a href="#l11.3298"></a><span id="l11.3298" class="difflineminus">-    if (updateStr.IsEmpty())</span>
<a href="#l11.3299"></a><span id="l11.3299" class="difflineminus">-    {</span>
<a href="#l11.3300"></a><span id="l11.3300" class="difflineminus">-      // fallback to trying &quot;search&quot;|&quot;updateCheckDays&quot;</span>
<a href="#l11.3301"></a><span id="l11.3301" class="difflineminus">-      GetData(dataUni, &quot;search&quot;, 0, &quot;update&quot;, updateStr);</span>
<a href="#l11.3302"></a><span id="l11.3302" class="difflineminus">-</span>
<a href="#l11.3303"></a><span id="l11.3303" class="difflineminus">-      // if we have a &quot;.hqx&quot; extension, strip it off</span>
<a href="#l11.3304"></a><span id="l11.3304" class="difflineminus">-      if (StringEndsWith(updateStr, NS_LITERAL_STRING(&quot;.hqx&quot;), CaseInsensitiveCompare))</span>
<a href="#l11.3305"></a><span id="l11.3305" class="difflineminus">-      {</span>
<a href="#l11.3306"></a><span id="l11.3306" class="difflineminus">-        updateStr.SetLength(updateStr.Length() - 4);</span>
<a href="#l11.3307"></a><span id="l11.3307" class="difflineminus">-      }</span>
<a href="#l11.3308"></a><span id="l11.3308" class="difflineminus">-</span>
<a href="#l11.3309"></a><span id="l11.3309" class="difflineminus">-      // now, either way, ensure that we have a &quot;.src&quot; file</span>
<a href="#l11.3310"></a><span id="l11.3310" class="difflineminus">-      if (!StringEndsWith(updateStr, NS_LITERAL_STRING(&quot;.src&quot;), CaseInsensitiveCompare))</span>
<a href="#l11.3311"></a><span id="l11.3311" class="difflineminus">-      {</span>
<a href="#l11.3312"></a><span id="l11.3312" class="difflineminus">-        // and if we don't, toss it</span>
<a href="#l11.3313"></a><span id="l11.3313" class="difflineminus">-        updateStr.Truncate();</span>
<a href="#l11.3314"></a><span id="l11.3314" class="difflineminus">-      }</span>
<a href="#l11.3315"></a><span id="l11.3315" class="difflineminus">-    }</span>
<a href="#l11.3316"></a><span id="l11.3316" class="difflineminus">-    else</span>
<a href="#l11.3317"></a><span id="l11.3317" class="difflineminus">-    {</span>
<a href="#l11.3318"></a><span id="l11.3318" class="difflineminus">-      // note: its OK if the &quot;updateIcon&quot; isn't specified</span>
<a href="#l11.3319"></a><span id="l11.3319" class="difflineminus">-      GetData(dataUni, &quot;browser&quot;, 0, &quot;updateIcon&quot;, updateIconStr);</span>
<a href="#l11.3320"></a><span id="l11.3320" class="difflineminus">-    }</span>
<a href="#l11.3321"></a><span id="l11.3321" class="difflineminus">-    if (!updateStr.IsEmpty())</span>
<a href="#l11.3322"></a><span id="l11.3322" class="difflineminus">-    {</span>
<a href="#l11.3323"></a><span id="l11.3323" class="difflineminus">-      GetData(dataUni, &quot;browser&quot;, 0, &quot;updateCheckDays&quot;, updateCheckDaysStr);</span>
<a href="#l11.3324"></a><span id="l11.3324" class="difflineminus">-      if (updateCheckDaysStr.IsEmpty())</span>
<a href="#l11.3325"></a><span id="l11.3325" class="difflineminus">-      {</span>
<a href="#l11.3326"></a><span id="l11.3326" class="difflineminus">-        // fallback to trying &quot;search&quot;|&quot;updateCheckDays&quot;</span>
<a href="#l11.3327"></a><span id="l11.3327" class="difflineminus">-        GetData(dataUni, &quot;search&quot;, 0, &quot;updateCheckDays&quot;, updateCheckDaysStr);</span>
<a href="#l11.3328"></a><span id="l11.3328" class="difflineminus">-      }</span>
<a href="#l11.3329"></a><span id="l11.3329" class="difflineminus">-    }</span>
<a href="#l11.3330"></a><span id="l11.3330" class="difflineminus">-</span>
<a href="#l11.3331"></a><span id="l11.3331" class="difflineminus">-    if (!updateStr.IsEmpty() &amp;&amp; !updateCheckDaysStr.IsEmpty())</span>
<a href="#l11.3332"></a><span id="l11.3332" class="difflineminus">-    {</span>
<a href="#l11.3333"></a><span id="l11.3333" class="difflineminus">-      nsCOMPtr&lt;nsIRDFLiteral&gt; updateLiteral;</span>
<a href="#l11.3334"></a><span id="l11.3334" class="difflineminus">-      if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(updateStr.get(),</span>
<a href="#l11.3335"></a><span id="l11.3335" class="difflineminus">-          getter_AddRefs(updateLiteral))))</span>
<a href="#l11.3336"></a><span id="l11.3336" class="difflineminus">-      {</span>
<a href="#l11.3337"></a><span id="l11.3337" class="difflineminus">-        rv = updateAtom(mInner, engine, mNC_Update, updateLiteral, nsnull);</span>
<a href="#l11.3338"></a><span id="l11.3338" class="difflineminus">-      }</span>
<a href="#l11.3339"></a><span id="l11.3339" class="difflineminus">-</span>
<a href="#l11.3340"></a><span id="l11.3340" class="difflineminus">-      PRInt32 updateDays = updateCheckDaysStr.ToInteger(&amp;rv);</span>
<a href="#l11.3341"></a><span id="l11.3341" class="difflineminus">-      if (NS_FAILED(rv) || (updateDays &lt; 1))</span>
<a href="#l11.3342"></a><span id="l11.3342" class="difflineminus">-      {</span>
<a href="#l11.3343"></a><span id="l11.3343" class="difflineminus">-        // default to something sane</span>
<a href="#l11.3344"></a><span id="l11.3344" class="difflineminus">-        updateDays = 3;</span>
<a href="#l11.3345"></a><span id="l11.3345" class="difflineminus">-      }</span>
<a href="#l11.3346"></a><span id="l11.3346" class="difflineminus">-</span>
<a href="#l11.3347"></a><span id="l11.3347" class="difflineminus">-      nsCOMPtr&lt;nsIRDFInt&gt; updateCheckDaysLiteral;</span>
<a href="#l11.3348"></a><span id="l11.3348" class="difflineminus">-      if (NS_SUCCEEDED(rv = mRDFService-&gt;GetIntLiteral(updateDays,</span>
<a href="#l11.3349"></a><span id="l11.3349" class="difflineminus">-          getter_AddRefs(updateCheckDaysLiteral))))</span>
<a href="#l11.3350"></a><span id="l11.3350" class="difflineminus">-      {</span>
<a href="#l11.3351"></a><span id="l11.3351" class="difflineminus">-        rv = updateAtom(mInner, engine, mNC_UpdateCheckDays, updateCheckDaysLiteral, nsnull);</span>
<a href="#l11.3352"></a><span id="l11.3352" class="difflineminus">-      }</span>
<a href="#l11.3353"></a><span id="l11.3353" class="difflineminus">-</span>
<a href="#l11.3354"></a><span id="l11.3354" class="difflineminus">-      if (!updateIconStr.IsEmpty())</span>
<a href="#l11.3355"></a><span id="l11.3355" class="difflineminus">-      {</span>
<a href="#l11.3356"></a><span id="l11.3356" class="difflineminus">-        nsCOMPtr&lt;nsIRDFLiteral&gt; updateIconLiteral;</span>
<a href="#l11.3357"></a><span id="l11.3357" class="difflineminus">-        if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(updateIconStr.get(),</span>
<a href="#l11.3358"></a><span id="l11.3358" class="difflineminus">-            getter_AddRefs(updateIconLiteral))))</span>
<a href="#l11.3359"></a><span id="l11.3359" class="difflineminus">-        {</span>
<a href="#l11.3360"></a><span id="l11.3360" class="difflineminus">-          rv = updateAtom(mInner, engine, mNC_UpdateIcon, updateIconLiteral, nsnull);</span>
<a href="#l11.3361"></a><span id="l11.3361" class="difflineminus">-        }</span>
<a href="#l11.3362"></a><span id="l11.3362" class="difflineminus">-      }</span>
<a href="#l11.3363"></a><span id="l11.3363" class="difflineminus">-    }</span>
<a href="#l11.3364"></a><span id="l11.3364" class="difflineminus">-  }</span>
<a href="#l11.3365"></a><span id="l11.3365" class="difflineminus">-</span>
<a href="#l11.3366"></a><span id="l11.3366" class="difflineminus">-  return(rv);</span>
<a href="#l11.3367"></a><span id="l11.3367" class="difflineminus">-}</span>
<a href="#l11.3368"></a><span id="l11.3368" class="difflineminus">-</span>
<a href="#l11.3369"></a><span id="l11.3369" class="difflineminus">-</span>
<a href="#l11.3370"></a><span id="l11.3370" class="difflineminus">-</span>
<a href="#l11.3371"></a><span id="l11.3371" class="difflineminus">-nsresult</span>
<a href="#l11.3372"></a><span id="l11.3372" class="difflineminus">-InternetSearchDataSource::updateAtom(nsIRDFDataSource *db, nsIRDFResource *src,</span>
<a href="#l11.3373"></a><span id="l11.3373" class="difflineminus">-      nsIRDFResource *prop, nsIRDFNode *newValue, PRBool *dirtyFlag)</span>
<a href="#l11.3374"></a><span id="l11.3374" class="difflineminus">-{</span>
<a href="#l11.3375"></a><span id="l11.3375" class="difflineminus">-  nsresult    rv;</span>
<a href="#l11.3376"></a><span id="l11.3376" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt;  oldValue;</span>
<a href="#l11.3377"></a><span id="l11.3377" class="difflineminus">-</span>
<a href="#l11.3378"></a><span id="l11.3378" class="difflineminus">-  if (dirtyFlag != nsnull)</span>
<a href="#l11.3379"></a><span id="l11.3379" class="difflineminus">-  {</span>
<a href="#l11.3380"></a><span id="l11.3380" class="difflineminus">-    *dirtyFlag = PR_FALSE;</span>
<a href="#l11.3381"></a><span id="l11.3381" class="difflineminus">-  }</span>
<a href="#l11.3382"></a><span id="l11.3382" class="difflineminus">-</span>
<a href="#l11.3383"></a><span id="l11.3383" class="difflineminus">-  if (NS_SUCCEEDED(rv = db-&gt;GetTarget(src, prop, PR_TRUE, getter_AddRefs(oldValue))) &amp;&amp;</span>
<a href="#l11.3384"></a><span id="l11.3384" class="difflineminus">-    (rv != NS_RDF_NO_VALUE))</span>
<a href="#l11.3385"></a><span id="l11.3385" class="difflineminus">-  {</span>
<a href="#l11.3386"></a><span id="l11.3386" class="difflineminus">-    rv = db-&gt;Change(src, prop, oldValue, newValue);</span>
<a href="#l11.3387"></a><span id="l11.3387" class="difflineminus">-</span>
<a href="#l11.3388"></a><span id="l11.3388" class="difflineminus">-    if ((oldValue.get() != newValue) &amp;&amp; (dirtyFlag != nsnull))</span>
<a href="#l11.3389"></a><span id="l11.3389" class="difflineminus">-    {</span>
<a href="#l11.3390"></a><span id="l11.3390" class="difflineminus">-      *dirtyFlag = PR_TRUE;</span>
<a href="#l11.3391"></a><span id="l11.3391" class="difflineminus">-    }</span>
<a href="#l11.3392"></a><span id="l11.3392" class="difflineminus">-  }</span>
<a href="#l11.3393"></a><span id="l11.3393" class="difflineminus">-  else</span>
<a href="#l11.3394"></a><span id="l11.3394" class="difflineminus">-  {</span>
<a href="#l11.3395"></a><span id="l11.3395" class="difflineminus">-    rv = db-&gt;Assert(src, prop, newValue, PR_TRUE);</span>
<a href="#l11.3396"></a><span id="l11.3396" class="difflineminus">-    if (dirtyFlag != nsnull)</span>
<a href="#l11.3397"></a><span id="l11.3397" class="difflineminus">-    {</span>
<a href="#l11.3398"></a><span id="l11.3398" class="difflineminus">-        *dirtyFlag = PR_TRUE;</span>
<a href="#l11.3399"></a><span id="l11.3399" class="difflineminus">-    }</span>
<a href="#l11.3400"></a><span id="l11.3400" class="difflineminus">-  }</span>
<a href="#l11.3401"></a><span id="l11.3401" class="difflineminus">-  return(rv);</span>
<a href="#l11.3402"></a><span id="l11.3402" class="difflineminus">-}</span>
<a href="#l11.3403"></a><span id="l11.3403" class="difflineminus">-</span>
<a href="#l11.3404"></a><span id="l11.3404" class="difflineminus">-</span>
<a href="#l11.3405"></a><span id="l11.3405" class="difflineminus">-</span>
<a href="#l11.3406"></a><span id="l11.3406" class="difflineminus">-struct  encodings</span>
<a href="#l11.3407"></a><span id="l11.3407" class="difflineminus">-{</span>
<a href="#l11.3408"></a><span id="l11.3408" class="difflineminus">-  const char  *numericEncoding;</span>
<a href="#l11.3409"></a><span id="l11.3409" class="difflineminus">-  const char  *stringEncoding;</span>
<a href="#l11.3410"></a><span id="l11.3410" class="difflineminus">-};</span>
<a href="#l11.3411"></a><span id="l11.3411" class="difflineminus">-</span>
<a href="#l11.3412"></a><span id="l11.3412" class="difflineminus">-</span>
<a href="#l11.3413"></a><span id="l11.3413" class="difflineminus">-</span>
<a href="#l11.3414"></a><span id="l11.3414" class="difflineminus">-nsresult</span>
<a href="#l11.3415"></a><span id="l11.3415" class="difflineminus">-InternetSearchDataSource::MapEncoding(const nsString &amp;numericEncoding, </span>
<a href="#l11.3416"></a><span id="l11.3416" class="difflineminus">-                                      nsString &amp;stringEncoding)</span>
<a href="#l11.3417"></a><span id="l11.3417" class="difflineminus">-{</span>
<a href="#l11.3418"></a><span id="l11.3418" class="difflineminus">-  // XXX we need to have a full table of numeric --&gt; string conversions</span>
<a href="#l11.3419"></a><span id="l11.3419" class="difflineminus">-</span>
<a href="#l11.3420"></a><span id="l11.3420" class="difflineminus">-  struct  encodings encodingList[] =</span>
<a href="#l11.3421"></a><span id="l11.3421" class="difflineminus">-  {</span>
<a href="#l11.3422"></a><span id="l11.3422" class="difflineminus">-    { &quot;0&quot;, &quot;x-mac-roman&quot;  },</span>
<a href="#l11.3423"></a><span id="l11.3423" class="difflineminus">-    { &quot;6&quot;, &quot;x-mac-greek&quot;  },</span>
<a href="#l11.3424"></a><span id="l11.3424" class="difflineminus">-    { &quot;35&quot;, &quot;x-mac-turkish&quot; },</span>
<a href="#l11.3425"></a><span id="l11.3425" class="difflineminus">-    { &quot;513&quot;, &quot;ISO-8859-1&quot; },</span>
<a href="#l11.3426"></a><span id="l11.3426" class="difflineminus">-    { &quot;514&quot;, &quot;ISO-8859-2&quot; },</span>
<a href="#l11.3427"></a><span id="l11.3427" class="difflineminus">-    { &quot;517&quot;, &quot;ISO-8859-5&quot; },</span>
<a href="#l11.3428"></a><span id="l11.3428" class="difflineminus">-    { &quot;518&quot;, &quot;ISO-8859-6&quot; },</span>
<a href="#l11.3429"></a><span id="l11.3429" class="difflineminus">-    { &quot;519&quot;, &quot;ISO-8859-7&quot; },</span>
<a href="#l11.3430"></a><span id="l11.3430" class="difflineminus">-    { &quot;520&quot;, &quot;ISO-8859-8&quot; },</span>
<a href="#l11.3431"></a><span id="l11.3431" class="difflineminus">-    { &quot;521&quot;, &quot;ISO-8859-9&quot; },</span>
<a href="#l11.3432"></a><span id="l11.3432" class="difflineminus">-    { &quot;1049&quot;, &quot;IBM864&quot;  },</span>
<a href="#l11.3433"></a><span id="l11.3433" class="difflineminus">-    { &quot;1280&quot;, &quot;windows-1252&quot;  },</span>
<a href="#l11.3434"></a><span id="l11.3434" class="difflineminus">-    { &quot;1281&quot;, &quot;windows-1250&quot;  },</span>
<a href="#l11.3435"></a><span id="l11.3435" class="difflineminus">-    { &quot;1282&quot;, &quot;windows-1251&quot;  },</span>
<a href="#l11.3436"></a><span id="l11.3436" class="difflineminus">-    { &quot;1283&quot;, &quot;windows-1253&quot;  },</span>
<a href="#l11.3437"></a><span id="l11.3437" class="difflineminus">-    { &quot;1284&quot;, &quot;windows-1254&quot;  },</span>
<a href="#l11.3438"></a><span id="l11.3438" class="difflineminus">-    { &quot;1285&quot;, &quot;windows-1255&quot;  },</span>
<a href="#l11.3439"></a><span id="l11.3439" class="difflineminus">-    { &quot;1286&quot;, &quot;windows-1256&quot;  },</span>
<a href="#l11.3440"></a><span id="l11.3440" class="difflineminus">-    { &quot;1536&quot;, &quot;us-ascii&quot;  },</span>
<a href="#l11.3441"></a><span id="l11.3441" class="difflineminus">-    { &quot;1584&quot;, &quot;GB2312&quot;  },</span>
<a href="#l11.3442"></a><span id="l11.3442" class="difflineminus">-    { &quot;1585&quot;, &quot;x-gbk&quot;   },</span>
<a href="#l11.3443"></a><span id="l11.3443" class="difflineminus">-    { &quot;1600&quot;, &quot;EUC-KR&quot;  },</span>
<a href="#l11.3444"></a><span id="l11.3444" class="difflineminus">-    { &quot;2080&quot;, &quot;ISO-2022-JP&quot; },</span>
<a href="#l11.3445"></a><span id="l11.3445" class="difflineminus">-    { &quot;2096&quot;, &quot;ISO-2022-CN&quot; },</span>
<a href="#l11.3446"></a><span id="l11.3446" class="difflineminus">-    { &quot;2112&quot;, &quot;ISO-2022-KR&quot; },</span>
<a href="#l11.3447"></a><span id="l11.3447" class="difflineminus">-    { &quot;2336&quot;, &quot;EUC-JP&quot;  },</span>
<a href="#l11.3448"></a><span id="l11.3448" class="difflineminus">-    { &quot;2352&quot;, &quot;GB2312&quot;  },</span>
<a href="#l11.3449"></a><span id="l11.3449" class="difflineminus">-    { &quot;2353&quot;, &quot;x-euc-tw&quot;  },</span>
<a href="#l11.3450"></a><span id="l11.3450" class="difflineminus">-    { &quot;2368&quot;, &quot;EUC-KR&quot;  },</span>
<a href="#l11.3451"></a><span id="l11.3451" class="difflineminus">-    { &quot;2561&quot;, &quot;Shift_JIS&quot; },</span>
<a href="#l11.3452"></a><span id="l11.3452" class="difflineminus">-    { &quot;2562&quot;, &quot;KOI8-R&quot;  },</span>
<a href="#l11.3453"></a><span id="l11.3453" class="difflineminus">-    { &quot;2563&quot;, &quot;Big5&quot;    },</span>
<a href="#l11.3454"></a><span id="l11.3454" class="difflineminus">-    { &quot;2565&quot;, &quot;HZ-GB-2312&quot;  },</span>
<a href="#l11.3455"></a><span id="l11.3455" class="difflineminus">-</span>
<a href="#l11.3456"></a><span id="l11.3456" class="difflineminus">-    { nsnull, nsnull    }</span>
<a href="#l11.3457"></a><span id="l11.3457" class="difflineminus">-  };</span>
<a href="#l11.3458"></a><span id="l11.3458" class="difflineminus">-</span>
<a href="#l11.3459"></a><span id="l11.3459" class="difflineminus">-  if (!numericEncoding.IsEmpty()) {</span>
<a href="#l11.3460"></a><span id="l11.3460" class="difflineminus">-    NS_LossyConvertUTF16toASCII numericEncodingASCII(numericEncoding);</span>
<a href="#l11.3461"></a><span id="l11.3461" class="difflineminus">-    for (PRUint32 i = 0; encodingList[i].numericEncoding != nsnull; i++)</span>
<a href="#l11.3462"></a><span id="l11.3462" class="difflineminus">-    {</span>
<a href="#l11.3463"></a><span id="l11.3463" class="difflineminus">-      if (numericEncodingASCII.Equals(encodingList[i].numericEncoding))</span>
<a href="#l11.3464"></a><span id="l11.3464" class="difflineminus">-      {</span>
<a href="#l11.3465"></a><span id="l11.3465" class="difflineminus">-        stringEncoding.Assign(NS_ConvertASCIItoUTF16(encodingList[i].stringEncoding));</span>
<a href="#l11.3466"></a><span id="l11.3466" class="difflineminus">-        return NS_OK;</span>
<a href="#l11.3467"></a><span id="l11.3467" class="difflineminus">-      }</span>
<a href="#l11.3468"></a><span id="l11.3468" class="difflineminus">-    }</span>
<a href="#l11.3469"></a><span id="l11.3469" class="difflineminus">-  }</span>
<a href="#l11.3470"></a><span id="l11.3470" class="difflineminus">-</span>
<a href="#l11.3471"></a><span id="l11.3471" class="difflineminus">-  // Still no encoding, fall back to default charset if possible</span>
<a href="#l11.3472"></a><span id="l11.3472" class="difflineminus">-  nsString defCharset;</span>
<a href="#l11.3473"></a><span id="l11.3473" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l11.3474"></a><span id="l11.3474" class="difflineminus">-  if (prefs) {</span>
<a href="#l11.3475"></a><span id="l11.3475" class="difflineminus">-    nsCOMPtr&lt;nsIPrefLocalizedString&gt; localizedStr;</span>
<a href="#l11.3476"></a><span id="l11.3476" class="difflineminus">-    nsresult rv = prefs-&gt;GetComplexValue(&quot;intl.charset.default&quot;,</span>
<a href="#l11.3477"></a><span id="l11.3477" class="difflineminus">-                                         NS_GET_IID(nsIPrefLocalizedString),</span>
<a href="#l11.3478"></a><span id="l11.3478" class="difflineminus">-                                         getter_AddRefs(localizedStr));</span>
<a href="#l11.3479"></a><span id="l11.3479" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l11.3480"></a><span id="l11.3480" class="difflineminus">-      localizedStr-&gt;GetData(getter_Copies(defCharset));</span>
<a href="#l11.3481"></a><span id="l11.3481" class="difflineminus">-  }</span>
<a href="#l11.3482"></a><span id="l11.3482" class="difflineminus">-</span>
<a href="#l11.3483"></a><span id="l11.3483" class="difflineminus">-  if (!defCharset.IsEmpty())</span>
<a href="#l11.3484"></a><span id="l11.3484" class="difflineminus">-    stringEncoding = defCharset;</span>
<a href="#l11.3485"></a><span id="l11.3485" class="difflineminus">-  else</span>
<a href="#l11.3486"></a><span id="l11.3486" class="difflineminus">-    // make &quot;ISO-8859-1&quot; as the default (not &quot;UTF-8&quot;)</span>
<a href="#l11.3487"></a><span id="l11.3487" class="difflineminus">-    stringEncoding.AssignLiteral(&quot;ISO-8859-1&quot;);</span>
<a href="#l11.3488"></a><span id="l11.3488" class="difflineminus">-</span>
<a href="#l11.3489"></a><span id="l11.3489" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.3490"></a><span id="l11.3490" class="difflineminus">-}</span>
<a href="#l11.3491"></a><span id="l11.3491" class="difflineminus">-</span>
<a href="#l11.3492"></a><span id="l11.3492" class="difflineminus">-</span>
<a href="#l11.3493"></a><span id="l11.3493" class="difflineminus">-</span>
<a href="#l11.3494"></a><span id="l11.3494" class="difflineminus">-const char * const</span>
<a href="#l11.3495"></a><span id="l11.3495" class="difflineminus">-InternetSearchDataSource::MapScriptCodeToCharsetName(PRUint32 aScriptCode)</span>
<a href="#l11.3496"></a><span id="l11.3496" class="difflineminus">-{</span>
<a href="#l11.3497"></a><span id="l11.3497" class="difflineminus">-  // Script codes listed here are taken from Inside Macintosh Text.</span>
<a href="#l11.3498"></a><span id="l11.3498" class="difflineminus">-  // Used TECGetTextEncodingInternetName to map script code to charset name.</span>
<a href="#l11.3499"></a><span id="l11.3499" class="difflineminus">-  // Some are edited to match with standard name (e.g. &quot;x-mac-japanese&quot; -&gt; &quot;Shift_JIS&quot;).</span>
<a href="#l11.3500"></a><span id="l11.3500" class="difflineminus">-  // In case no converter can be found for a charset name, </span>
<a href="#l11.3501"></a><span id="l11.3501" class="difflineminus">-  // the default sherlock charset &quot;x-mac-roman&quot; should be used.</span>
<a href="#l11.3502"></a><span id="l11.3502" class="difflineminus">-  // </span>
<a href="#l11.3503"></a><span id="l11.3503" class="difflineminus">-        static const char* const scriptList[] =</span>
<a href="#l11.3504"></a><span id="l11.3504" class="difflineminus">-  {</span>
<a href="#l11.3505"></a><span id="l11.3505" class="difflineminus">-    &quot;x-mac-roman&quot;,           // 0</span>
<a href="#l11.3506"></a><span id="l11.3506" class="difflineminus">-    &quot;Shift_JIS&quot;,             // 1</span>
<a href="#l11.3507"></a><span id="l11.3507" class="difflineminus">-    &quot;Big5&quot;,                  // 2</span>
<a href="#l11.3508"></a><span id="l11.3508" class="difflineminus">-    &quot;EUC-KR&quot;,                // 3</span>
<a href="#l11.3509"></a><span id="l11.3509" class="difflineminus">-    &quot;X-MAC-ARABIC&quot;,          // 4</span>
<a href="#l11.3510"></a><span id="l11.3510" class="difflineminus">-    &quot;X-MAC-HEBREW&quot;,          // 5</span>
<a href="#l11.3511"></a><span id="l11.3511" class="difflineminus">-    &quot;X-MAC-GREEK&quot;,           // 6</span>
<a href="#l11.3512"></a><span id="l11.3512" class="difflineminus">-    &quot;X-MAC-CYRILLIC&quot;,        // 7</span>
<a href="#l11.3513"></a><span id="l11.3513" class="difflineminus">-    &quot;X-MAC-DEVANAGARI&quot; ,     // 9</span>
<a href="#l11.3514"></a><span id="l11.3514" class="difflineminus">-    &quot;X-MAC-GURMUKHI&quot;,        // 10</span>
<a href="#l11.3515"></a><span id="l11.3515" class="difflineminus">-    &quot;X-MAC-GUJARATI&quot;,        // 11</span>
<a href="#l11.3516"></a><span id="l11.3516" class="difflineminus">-    &quot;X-MAC-ORIYA&quot;,           // 12</span>
<a href="#l11.3517"></a><span id="l11.3517" class="difflineminus">-    &quot;X-MAC-BENGALI&quot;,         // 13</span>
<a href="#l11.3518"></a><span id="l11.3518" class="difflineminus">-    &quot;X-MAC-TAMIL&quot;,           // 14</span>
<a href="#l11.3519"></a><span id="l11.3519" class="difflineminus">-    &quot;X-MAC-TELUGU&quot;,          // 15</span>
<a href="#l11.3520"></a><span id="l11.3520" class="difflineminus">-    &quot;X-MAC-KANNADA&quot;,         // 16</span>
<a href="#l11.3521"></a><span id="l11.3521" class="difflineminus">-    &quot;X-MAC-MALAYALAM&quot;,       // 17</span>
<a href="#l11.3522"></a><span id="l11.3522" class="difflineminus">-    &quot;X-MAC-SINHALESE&quot;,       // 18</span>
<a href="#l11.3523"></a><span id="l11.3523" class="difflineminus">-    &quot;X-MAC-BURMESE&quot;,         // 19</span>
<a href="#l11.3524"></a><span id="l11.3524" class="difflineminus">-    &quot;X-MAC-KHMER&quot;,           // 20</span>
<a href="#l11.3525"></a><span id="l11.3525" class="difflineminus">-    &quot;X-MAC-THAI&quot;,            // 21</span>
<a href="#l11.3526"></a><span id="l11.3526" class="difflineminus">-    &quot;X-MAC-LAOTIAN&quot;,         // 22</span>
<a href="#l11.3527"></a><span id="l11.3527" class="difflineminus">-    &quot;X-MAC-GEORGIAN&quot;,        // 23</span>
<a href="#l11.3528"></a><span id="l11.3528" class="difflineminus">-    &quot;X-MAC-ARMENIAN&quot;,        // 24</span>
<a href="#l11.3529"></a><span id="l11.3529" class="difflineminus">-    &quot;GB2312&quot;,                // 25</span>
<a href="#l11.3530"></a><span id="l11.3530" class="difflineminus">-    &quot;X-MAC-TIBETAN&quot;,         // 26</span>
<a href="#l11.3531"></a><span id="l11.3531" class="difflineminus">-    &quot;X-MAC-MONGOLIAN&quot;,       // 27</span>
<a href="#l11.3532"></a><span id="l11.3532" class="difflineminus">-    &quot;X-MAC-ETHIOPIC&quot;,        // 28</span>
<a href="#l11.3533"></a><span id="l11.3533" class="difflineminus">-    &quot;X-MAC-CENTRALEURROMAN&quot;, // 29</span>
<a href="#l11.3534"></a><span id="l11.3534" class="difflineminus">-    &quot;X-MAC-VIETNAMESE&quot;,      // 30</span>
<a href="#l11.3535"></a><span id="l11.3535" class="difflineminus">-    &quot;X-MAC-EXTARABIC&quot;,       // 31</span>
<a href="#l11.3536"></a><span id="l11.3536" class="difflineminus">-  };</span>
<a href="#l11.3537"></a><span id="l11.3537" class="difflineminus">-</span>
<a href="#l11.3538"></a><span id="l11.3538" class="difflineminus">-        if (aScriptCode &gt;= NS_ARRAY_LENGTH(scriptList))</span>
<a href="#l11.3539"></a><span id="l11.3539" class="difflineminus">-          aScriptCode = 0;</span>
<a href="#l11.3540"></a><span id="l11.3540" class="difflineminus">-</span>
<a href="#l11.3541"></a><span id="l11.3541" class="difflineminus">-  return scriptList[aScriptCode];</span>
<a href="#l11.3542"></a><span id="l11.3542" class="difflineminus">-}</span>
<a href="#l11.3543"></a><span id="l11.3543" class="difflineminus">-</span>
<a href="#l11.3544"></a><span id="l11.3544" class="difflineminus">-</span>
<a href="#l11.3545"></a><span id="l11.3545" class="difflineminus">-nsresult</span>
<a href="#l11.3546"></a><span id="l11.3546" class="difflineminus">-InternetSearchDataSource::validateEngine(nsIRDFResource *engine)</span>
<a href="#l11.3547"></a><span id="l11.3547" class="difflineminus">-{</span>
<a href="#l11.3548"></a><span id="l11.3548" class="difflineminus">-  nsresult  rv;</span>
<a href="#l11.3549"></a><span id="l11.3549" class="difflineminus">-</span>
<a href="#l11.3550"></a><span id="l11.3550" class="difflineminus">-  // confirm whether the user wants to update plugins.</span>
<a href="#l11.3551"></a><span id="l11.3551" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt;</span>
<a href="#l11.3552"></a><span id="l11.3552" class="difflineminus">-    prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l11.3553"></a><span id="l11.3553" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3554"></a><span id="l11.3554" class="difflineminus">-</span>
<a href="#l11.3555"></a><span id="l11.3555" class="difflineminus">-  PRBool userAllowed = PR_TRUE;</span>
<a href="#l11.3556"></a><span id="l11.3556" class="difflineminus">-  rv = prefBranch-&gt;GetBoolPref(&quot;browser.search.update&quot;, &amp;userAllowed);</span>
<a href="#l11.3557"></a><span id="l11.3557" class="difflineminus">-  // if the pref value is not set or wrong type, don't stop here.</span>
<a href="#l11.3558"></a><span id="l11.3558" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !userAllowed)</span>
<a href="#l11.3559"></a><span id="l11.3559" class="difflineminus">-    return NS_OK;</span>
<a href="#l11.3560"></a><span id="l11.3560" class="difflineminus">-</span>
<a href="#l11.3561"></a><span id="l11.3561" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.3562"></a><span id="l11.3562" class="difflineminus">-  const char  *engineURI = nsnull;</span>
<a href="#l11.3563"></a><span id="l11.3563" class="difflineminus">-  engine-&gt;GetValueConst(&amp;engineURI);</span>
<a href="#l11.3564"></a><span id="l11.3564" class="difflineminus">-#endif</span>
<a href="#l11.3565"></a><span id="l11.3565" class="difflineminus">-</span>
<a href="#l11.3566"></a><span id="l11.3566" class="difflineminus">-  // get the engines &quot;updateCheckDays&quot; value</span>
<a href="#l11.3567"></a><span id="l11.3567" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt;  updateCheckDaysNode;</span>
<a href="#l11.3568"></a><span id="l11.3568" class="difflineminus">-  rv = mInner-&gt;GetTarget(engine, mNC_UpdateCheckDays, PR_TRUE, getter_AddRefs(updateCheckDaysNode));</span>
<a href="#l11.3569"></a><span id="l11.3569" class="difflineminus">-  if (NS_FAILED(rv) || (rv == NS_RDF_NO_VALUE)) return(rv);</span>
<a href="#l11.3570"></a><span id="l11.3570" class="difflineminus">-  nsCOMPtr&lt;nsIRDFInt&gt; updateCheckDaysLiteral (do_QueryInterface(updateCheckDaysNode));</span>
<a href="#l11.3571"></a><span id="l11.3571" class="difflineminus">-  PRInt32   updateCheckDays;</span>
<a href="#l11.3572"></a><span id="l11.3572" class="difflineminus">-  updateCheckDaysLiteral-&gt;GetValue(&amp;updateCheckDays);</span>
<a href="#l11.3573"></a><span id="l11.3573" class="difflineminus">-  // convert updateCheckDays from days to seconds;</span>
<a href="#l11.3574"></a><span id="l11.3574" class="difflineminus">-</span>
<a href="#l11.3575"></a><span id="l11.3575" class="difflineminus">-#ifndef DEBUG_SEARCH_UPDATES</span>
<a href="#l11.3576"></a><span id="l11.3576" class="difflineminus">-  PRInt32   updateCheckSecs = updateCheckDays * (60 * 60 * 24);</span>
<a href="#l11.3577"></a><span id="l11.3577" class="difflineminus">-#else</span>
<a href="#l11.3578"></a><span id="l11.3578" class="difflineminus">-  // rjc note: for debugging, use as minutes instead days</span>
<a href="#l11.3579"></a><span id="l11.3579" class="difflineminus">-  PRInt32   updateCheckSecs = updateCheckDays * 60;</span>
<a href="#l11.3580"></a><span id="l11.3580" class="difflineminus">-#endif</span>
<a href="#l11.3581"></a><span id="l11.3581" class="difflineminus">-</span>
<a href="#l11.3582"></a><span id="l11.3582" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt;  aNode;</span>
<a href="#l11.3583"></a><span id="l11.3583" class="difflineminus">-  rv = mLocalstore-&gt;GetTarget(engine, mWEB_LastPingDate, PR_TRUE, getter_AddRefs(aNode));</span>
<a href="#l11.3584"></a><span id="l11.3584" class="difflineminus">-  if (NS_FAILED(rv))  return(rv);</span>
<a href="#l11.3585"></a><span id="l11.3585" class="difflineminus">-</span>
<a href="#l11.3586"></a><span id="l11.3586" class="difflineminus">-  // if aNode is a valid entry, we should check the durationSecs.</span>
<a href="#l11.3587"></a><span id="l11.3587" class="difflineminus">-  if (rv != NS_RDF_NO_VALUE) {</span>
<a href="#l11.3588"></a><span id="l11.3588" class="difflineminus">-    // get last validate date/time</span>
<a href="#l11.3589"></a><span id="l11.3589" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; lastCheckLiteral(do_QueryInterface(aNode));</span>
<a href="#l11.3590"></a><span id="l11.3590" class="difflineminus">-    if (!lastCheckLiteral)</span>
<a href="#l11.3591"></a><span id="l11.3591" class="difflineminus">-      return NS_ERROR_UNEXPECTED;</span>
<a href="#l11.3592"></a><span id="l11.3592" class="difflineminus">-</span>
<a href="#l11.3593"></a><span id="l11.3593" class="difflineminus">-    const PRUnichar *lastCheckUni = nsnull;</span>
<a href="#l11.3594"></a><span id="l11.3594" class="difflineminus">-    lastCheckLiteral-&gt;GetValueConst(&amp;lastCheckUni);</span>
<a href="#l11.3595"></a><span id="l11.3595" class="difflineminus">-    if (!lastCheckUni)</span>
<a href="#l11.3596"></a><span id="l11.3596" class="difflineminus">-      return NS_ERROR_UNEXPECTED;</span>
<a href="#l11.3597"></a><span id="l11.3597" class="difflineminus">-</span>
<a href="#l11.3598"></a><span id="l11.3598" class="difflineminus">-    PRInt32 lastCheckInt = 0;</span>
<a href="#l11.3599"></a><span id="l11.3599" class="difflineminus">-    lastCheckInt = nsDependentString(lastCheckUni).ToInteger(&amp;rv);</span>
<a href="#l11.3600"></a><span id="l11.3600" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3601"></a><span id="l11.3601" class="difflineminus">-</span>
<a href="#l11.3602"></a><span id="l11.3602" class="difflineminus">-    // get the current date/time [from microseconds (PRTime) to seconds]</span>
<a href="#l11.3603"></a><span id="l11.3603" class="difflineminus">-    PRTime now64 = PR_Now(), temp64, million;</span>
<a href="#l11.3604"></a><span id="l11.3604" class="difflineminus">-    LL_I2L(million, PR_USEC_PER_SEC);</span>
<a href="#l11.3605"></a><span id="l11.3605" class="difflineminus">-    LL_DIV(temp64, now64, million);</span>
<a href="#l11.3606"></a><span id="l11.3606" class="difflineminus">-    PRInt32 now32;</span>
<a href="#l11.3607"></a><span id="l11.3607" class="difflineminus">-    LL_L2I(now32, temp64);</span>
<a href="#l11.3608"></a><span id="l11.3608" class="difflineminus">-</span>
<a href="#l11.3609"></a><span id="l11.3609" class="difflineminus">-    // calculate duration since last validation</span>
<a href="#l11.3610"></a><span id="l11.3610" class="difflineminus">-    // just return if it's too early to check again</span>
<a href="#l11.3611"></a><span id="l11.3611" class="difflineminus">-    PRInt32 durationSecs = now32 - lastCheckInt;</span>
<a href="#l11.3612"></a><span id="l11.3612" class="difflineminus">-</span>
<a href="#l11.3613"></a><span id="l11.3613" class="difflineminus">-    if (durationSecs &lt; updateCheckSecs) {</span>
<a href="#l11.3614"></a><span id="l11.3614" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.3615"></a><span id="l11.3615" class="difflineminus">-      printf(&quot;    Search engine '%s' is valid for %d more seconds.\n&quot;,</span>
<a href="#l11.3616"></a><span id="l11.3616" class="difflineminus">-             engineURI, (updateCheckSecs-durationSecs));</span>
<a href="#l11.3617"></a><span id="l11.3617" class="difflineminus">-#endif</span>
<a href="#l11.3618"></a><span id="l11.3618" class="difflineminus">-      return NS_OK;</span>
<a href="#l11.3619"></a><span id="l11.3619" class="difflineminus">-    }</span>
<a href="#l11.3620"></a><span id="l11.3620" class="difflineminus">-  }</span>
<a href="#l11.3621"></a><span id="l11.3621" class="difflineminus">-</span>
<a href="#l11.3622"></a><span id="l11.3622" class="difflineminus">-  // search engine needs to be checked again, so add it into the to-be-validated array</span>
<a href="#l11.3623"></a><span id="l11.3623" class="difflineminus">-  PRInt32   elementIndex = mUpdateArray-&gt;IndexOf(engine);</span>
<a href="#l11.3624"></a><span id="l11.3624" class="difflineminus">-  if (elementIndex &lt; 0)</span>
<a href="#l11.3625"></a><span id="l11.3625" class="difflineminus">-  {</span>
<a href="#l11.3626"></a><span id="l11.3626" class="difflineminus">-    mUpdateArray-&gt;AppendElement(engine);</span>
<a href="#l11.3627"></a><span id="l11.3627" class="difflineminus">-</span>
<a href="#l11.3628"></a><span id="l11.3628" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.3629"></a><span id="l11.3629" class="difflineminus">-    printf(&quot;    Search engine '%s' is now queued to be validated&quot;</span>
<a href="#l11.3630"></a><span id="l11.3630" class="difflineminus">-           &quot; via HTTP HEAD method.\n&quot;,</span>
<a href="#l11.3631"></a><span id="l11.3631" class="difflineminus">-           engineURI);</span>
<a href="#l11.3632"></a><span id="l11.3632" class="difflineminus">-#endif</span>
<a href="#l11.3633"></a><span id="l11.3633" class="difflineminus">-  }</span>
<a href="#l11.3634"></a><span id="l11.3634" class="difflineminus">-  else</span>
<a href="#l11.3635"></a><span id="l11.3635" class="difflineminus">-  {</span>
<a href="#l11.3636"></a><span id="l11.3636" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.3637"></a><span id="l11.3637" class="difflineminus">-    printf(&quot;    Search engine '%s' is already in queue to be validated.\n&quot;,</span>
<a href="#l11.3638"></a><span id="l11.3638" class="difflineminus">-      engineURI);</span>
<a href="#l11.3639"></a><span id="l11.3639" class="difflineminus">-#endif</span>
<a href="#l11.3640"></a><span id="l11.3640" class="difflineminus">-  }</span>
<a href="#l11.3641"></a><span id="l11.3641" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.3642"></a><span id="l11.3642" class="difflineminus">-}</span>
<a href="#l11.3643"></a><span id="l11.3643" class="difflineminus">-</span>
<a href="#l11.3644"></a><span id="l11.3644" class="difflineminus">-</span>
<a href="#l11.3645"></a><span id="l11.3645" class="difflineminus">-</span>
<a href="#l11.3646"></a><span id="l11.3646" class="difflineminus">-nsresult</span>
<a href="#l11.3647"></a><span id="l11.3647" class="difflineminus">-InternetSearchDataSource::DoSearch(nsIRDFResource *source, nsIRDFResource *engine,</span>
<a href="#l11.3648"></a><span id="l11.3648" class="difflineminus">-        const nsString &amp;fullURL, const nsString &amp;text)</span>
<a href="#l11.3649"></a><span id="l11.3649" class="difflineminus">-{</span>
<a href="#l11.3650"></a><span id="l11.3650" class="difflineminus">-  nsresult  rv;</span>
<a href="#l11.3651"></a><span id="l11.3651" class="difflineminus">-  nsAutoString  textTemp(text);</span>
<a href="#l11.3652"></a><span id="l11.3652" class="difflineminus">-</span>
<a href="#l11.3653"></a><span id="l11.3653" class="difflineminus">-  if (!mInner)  return(NS_RDF_NO_VALUE);</span>
<a href="#l11.3654"></a><span id="l11.3654" class="difflineminus">-//  Note: source can be null</span>
<a href="#l11.3655"></a><span id="l11.3655" class="difflineminus">-//  if (!source)  return(NS_ERROR_NULL_POINTER);</span>
<a href="#l11.3656"></a><span id="l11.3656" class="difflineminus">-  if (!engine)  return(NS_ERROR_NULL_POINTER);</span>
<a href="#l11.3657"></a><span id="l11.3657" class="difflineminus">-</span>
<a href="#l11.3658"></a><span id="l11.3658" class="difflineminus">-  validateEngine(engine);</span>
<a href="#l11.3659"></a><span id="l11.3659" class="difflineminus">-</span>
<a href="#l11.3660"></a><span id="l11.3660" class="difflineminus">-  nsCOMPtr&lt;nsIUnicodeDecoder&gt; unicodeDecoder;</span>
<a href="#l11.3661"></a><span id="l11.3661" class="difflineminus">-  nsAutoString      action, methodStr, input, userVar;</span>
<a href="#l11.3662"></a><span id="l11.3662" class="difflineminus">-</span>
<a href="#l11.3663"></a><span id="l11.3663" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt;   dataLit;</span>
<a href="#l11.3664"></a><span id="l11.3664" class="difflineminus">-  if (NS_FAILED(rv = FindData(engine, getter_AddRefs(dataLit))) ||</span>
<a href="#l11.3665"></a><span id="l11.3665" class="difflineminus">-    (rv == NS_RDF_NO_VALUE))  return(rv);</span>
<a href="#l11.3666"></a><span id="l11.3666" class="difflineminus">-</span>
<a href="#l11.3667"></a><span id="l11.3667" class="difflineminus">-  const PRUnichar     *dataUni = nsnull;</span>
<a href="#l11.3668"></a><span id="l11.3668" class="difflineminus">-  dataLit-&gt;GetValueConst(&amp;dataUni);</span>
<a href="#l11.3669"></a><span id="l11.3669" class="difflineminus">-  if (!dataUni)     return(NS_RDF_NO_VALUE);</span>
<a href="#l11.3670"></a><span id="l11.3670" class="difflineminus">-</span>
<a href="#l11.3671"></a><span id="l11.3671" class="difflineminus">-  if (!fullURL.IsEmpty())</span>
<a href="#l11.3672"></a><span id="l11.3672" class="difflineminus">-  {</span>
<a href="#l11.3673"></a><span id="l11.3673" class="difflineminus">-    action.Assign(fullURL);</span>
<a href="#l11.3674"></a><span id="l11.3674" class="difflineminus">-    methodStr.AssignLiteral(&quot;get&quot;);</span>
<a href="#l11.3675"></a><span id="l11.3675" class="difflineminus">-  }</span>
<a href="#l11.3676"></a><span id="l11.3676" class="difflineminus">-  else</span>
<a href="#l11.3677"></a><span id="l11.3677" class="difflineminus">-  {</span>
<a href="#l11.3678"></a><span id="l11.3678" class="difflineminus">-    if (NS_FAILED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;action&quot;, action)))  return(rv);</span>
<a href="#l11.3679"></a><span id="l11.3679" class="difflineminus">-    if (NS_FAILED(rv = GetData(dataUni, &quot;search&quot;, 0, &quot;method&quot;, methodStr))) return(rv);</span>
<a href="#l11.3680"></a><span id="l11.3680" class="difflineminus">-  }</span>
<a href="#l11.3681"></a><span id="l11.3681" class="difflineminus">-</span>
<a href="#l11.3682"></a><span id="l11.3682" class="difflineminus">-  nsAutoString  encodingStr, resultEncodingStr;</span>
<a href="#l11.3683"></a><span id="l11.3683" class="difflineminus">-</span>
<a href="#l11.3684"></a><span id="l11.3684" class="difflineminus">-  // first look for &quot;interpret/charset&quot;... if that isn't specified,</span>
<a href="#l11.3685"></a><span id="l11.3685" class="difflineminus">-  // then fall back to looking for &quot;interpret/resultEncoding&quot; (a decimal)</span>
<a href="#l11.3686"></a><span id="l11.3686" class="difflineminus">-  GetData(dataUni, &quot;interpret&quot;, 0, &quot;charset&quot;, resultEncodingStr);</span>
<a href="#l11.3687"></a><span id="l11.3687" class="difflineminus">-  if (resultEncodingStr.IsEmpty())</span>
<a href="#l11.3688"></a><span id="l11.3688" class="difflineminus">-  {</span>
<a href="#l11.3689"></a><span id="l11.3689" class="difflineminus">-    GetData(dataUni, &quot;interpret&quot;, 0, &quot;resultEncoding&quot;, encodingStr);  // decimal string values</span>
<a href="#l11.3690"></a><span id="l11.3690" class="difflineminus">-    MapEncoding(encodingStr, resultEncodingStr);</span>
<a href="#l11.3691"></a><span id="l11.3691" class="difflineminus">-  }</span>
<a href="#l11.3692"></a><span id="l11.3692" class="difflineminus">-  // rjc note: ignore &quot;interpret/resultTranslationEncoding&quot; as well as</span>
<a href="#l11.3693"></a><span id="l11.3693" class="difflineminus">-  // &quot;interpret/resultTranslationFont&quot; since we always convert results to Unicode</span>
<a href="#l11.3694"></a><span id="l11.3694" class="difflineminus">-  if (!resultEncodingStr.IsEmpty())</span>
<a href="#l11.3695"></a><span id="l11.3695" class="difflineminus">-  {</span>
<a href="#l11.3696"></a><span id="l11.3696" class="difflineminus">-    nsCOMPtr &lt;nsICharsetConverterManager&gt; charsetConv = do_GetService(NS_CHARSETCONVERTERMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l11.3697"></a><span id="l11.3697" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l11.3698"></a><span id="l11.3698" class="difflineminus">-    {</span>
<a href="#l11.3699"></a><span id="l11.3699" class="difflineminus">-                  NS_LossyConvertUTF16toASCII charset(resultEncodingStr);</span>
<a href="#l11.3700"></a><span id="l11.3700" class="difflineminus">-                  rv = charsetConv-&gt;GetUnicodeDecoder(charset.get(),</span>
<a href="#l11.3701"></a><span id="l11.3701" class="difflineminus">-                                                      getter_AddRefs(unicodeDecoder));</span>
<a href="#l11.3702"></a><span id="l11.3702" class="difflineminus">-    }</span>
<a href="#l11.3703"></a><span id="l11.3703" class="difflineminus">-  }</span>
<a href="#l11.3704"></a><span id="l11.3704" class="difflineminus">-</span>
<a href="#l11.3705"></a><span id="l11.3705" class="difflineminus">-  // first look for &quot;search/queryCharset&quot;... if that isn't specified,</span>
<a href="#l11.3706"></a><span id="l11.3706" class="difflineminus">-  // then fall back to looking for &quot;search/queryEncoding&quot; (a decimal)</span>
<a href="#l11.3707"></a><span id="l11.3707" class="difflineminus">-  nsAutoString    queryEncodingStr;</span>
<a href="#l11.3708"></a><span id="l11.3708" class="difflineminus">-  GetData(dataUni, &quot;search&quot;, 0, &quot;queryCharset&quot;, queryEncodingStr);</span>
<a href="#l11.3709"></a><span id="l11.3709" class="difflineminus">-  if (queryEncodingStr.IsEmpty())</span>
<a href="#l11.3710"></a><span id="l11.3710" class="difflineminus">-  {</span>
<a href="#l11.3711"></a><span id="l11.3711" class="difflineminus">-    GetData(dataUni, &quot;search&quot;, 0, &quot;queryEncoding&quot;, encodingStr);    // decimal string values</span>
<a href="#l11.3712"></a><span id="l11.3712" class="difflineminus">-    MapEncoding(encodingStr, queryEncodingStr);</span>
<a href="#l11.3713"></a><span id="l11.3713" class="difflineminus">-  }</span>
<a href="#l11.3714"></a><span id="l11.3714" class="difflineminus">-  if (!queryEncodingStr.IsEmpty())</span>
<a href="#l11.3715"></a><span id="l11.3715" class="difflineminus">-  {</span>
<a href="#l11.3716"></a><span id="l11.3716" class="difflineminus">-    // convert from escaped-UTF_8, to unicode, and then to</span>
<a href="#l11.3717"></a><span id="l11.3717" class="difflineminus">-    // the charset indicated by the dataset in question</span>
<a href="#l11.3718"></a><span id="l11.3718" class="difflineminus">-</span>
<a href="#l11.3719"></a><span id="l11.3719" class="difflineminus">-    char  *utf8data = ToNewUTF8String(textTemp);</span>
<a href="#l11.3720"></a><span id="l11.3720" class="difflineminus">-    if (utf8data)</span>
<a href="#l11.3721"></a><span id="l11.3721" class="difflineminus">-    {</span>
<a href="#l11.3722"></a><span id="l11.3722" class="difflineminus">-      nsCOMPtr&lt;nsITextToSubURI&gt; textToSubURI = </span>
<a href="#l11.3723"></a><span id="l11.3723" class="difflineminus">-               do_GetService(kTextToSubURICID, &amp;rv);</span>
<a href="#l11.3724"></a><span id="l11.3724" class="difflineminus">-      if (NS_SUCCEEDED(rv) &amp;&amp; (textToSubURI))</span>
<a href="#l11.3725"></a><span id="l11.3725" class="difflineminus">-      {</span>
<a href="#l11.3726"></a><span id="l11.3726" class="difflineminus">-        PRUnichar *uni = nsnull;</span>
<a href="#l11.3727"></a><span id="l11.3727" class="difflineminus">-        if (NS_SUCCEEDED(rv = textToSubURI-&gt;UnEscapeAndConvert(&quot;UTF-8&quot;, utf8data, &amp;uni)) &amp;&amp; (uni))</span>
<a href="#l11.3728"></a><span id="l11.3728" class="difflineminus">-        {</span>
<a href="#l11.3729"></a><span id="l11.3729" class="difflineminus">-          char    *charsetData = nsnull;</span>
<a href="#l11.3730"></a><span id="l11.3730" class="difflineminus">-          rv = textToSubURI-&gt;ConvertAndEscape(NS_LossyConvertUTF16toASCII(queryEncodingStr).get(),</span>
<a href="#l11.3731"></a><span id="l11.3731" class="difflineminus">-                                              uni, &amp;charsetData);</span>
<a href="#l11.3732"></a><span id="l11.3732" class="difflineminus">-          if (NS_SUCCEEDED(rv) &amp;&amp; charsetData)</span>
<a href="#l11.3733"></a><span id="l11.3733" class="difflineminus">-          {</span>
<a href="#l11.3734"></a><span id="l11.3734" class="difflineminus">-            CopyASCIItoUTF16(nsDependentCString(charsetData), textTemp);</span>
<a href="#l11.3735"></a><span id="l11.3735" class="difflineminus">-            NS_Free(charsetData);</span>
<a href="#l11.3736"></a><span id="l11.3736" class="difflineminus">-          }</span>
<a href="#l11.3737"></a><span id="l11.3737" class="difflineminus">-          NS_Free(uni);</span>
<a href="#l11.3738"></a><span id="l11.3738" class="difflineminus">-        }</span>
<a href="#l11.3739"></a><span id="l11.3739" class="difflineminus">-      }</span>
<a href="#l11.3740"></a><span id="l11.3740" class="difflineminus">-      NS_Free(utf8data);</span>
<a href="#l11.3741"></a><span id="l11.3741" class="difflineminus">-    }</span>
<a href="#l11.3742"></a><span id="l11.3742" class="difflineminus">-  }</span>
<a href="#l11.3743"></a><span id="l11.3743" class="difflineminus">-</span>
<a href="#l11.3744"></a><span id="l11.3744" class="difflineminus">-  if (fullURL.IsEmpty() &amp;&amp; methodStr.LowerCaseEqualsLiteral(&quot;get&quot;))</span>
<a href="#l11.3745"></a><span id="l11.3745" class="difflineminus">-  {</span>
<a href="#l11.3746"></a><span id="l11.3746" class="difflineminus">-    nsAutoString engineNameStr;</span>
<a href="#l11.3747"></a><span id="l11.3747" class="difflineminus">-    GetData(dataUni, &quot;search&quot;, 0, &quot;name&quot;, engineNameStr);</span>
<a href="#l11.3748"></a><span id="l11.3748" class="difflineminus">-</span>
<a href="#l11.3749"></a><span id="l11.3749" class="difflineminus">-    if (NS_FAILED(rv = GetInputs(dataUni, engineNameStr, userVar, textTemp, input, 0, 0, 0)))  return(rv);</span>
<a href="#l11.3750"></a><span id="l11.3750" class="difflineminus">-    if (input.IsEmpty())        return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.3751"></a><span id="l11.3751" class="difflineminus">-</span>
<a href="#l11.3752"></a><span id="l11.3752" class="difflineminus">-    // HTTP Get method support</span>
<a href="#l11.3753"></a><span id="l11.3753" class="difflineminus">-    action += input;</span>
<a href="#l11.3754"></a><span id="l11.3754" class="difflineminus">-  }</span>
<a href="#l11.3755"></a><span id="l11.3755" class="difflineminus">-</span>
<a href="#l11.3756"></a><span id="l11.3756" class="difflineminus">-  nsCOMPtr&lt;nsIInternetSearchContext&gt;  context;</span>
<a href="#l11.3757"></a><span id="l11.3757" class="difflineminus">-  if (NS_FAILED(rv = NS_NewInternetSearchContext(nsIInternetSearchContext::WEB_SEARCH_CONTEXT,</span>
<a href="#l11.3758"></a><span id="l11.3758" class="difflineminus">-    source, engine, unicodeDecoder, nsnull, getter_AddRefs(context))))</span>
<a href="#l11.3759"></a><span id="l11.3759" class="difflineminus">-    return(rv);</span>
<a href="#l11.3760"></a><span id="l11.3760" class="difflineminus">-  if (!context) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.3761"></a><span id="l11.3761" class="difflineminus">-</span>
<a href="#l11.3762"></a><span id="l11.3762" class="difflineminus">-  nsCOMPtr&lt;nsIURI&gt;  url;</span>
<a href="#l11.3763"></a><span id="l11.3763" class="difflineminus">-  if (NS_SUCCEEDED(rv = NS_NewURI(getter_AddRefs(url), action)))</span>
<a href="#l11.3764"></a><span id="l11.3764" class="difflineminus">-  {</span>
<a href="#l11.3765"></a><span id="l11.3765" class="difflineminus">-    nsCOMPtr&lt;nsIChannel&gt;  channel;</span>
<a href="#l11.3766"></a><span id="l11.3766" class="difflineminus">-    if (NS_SUCCEEDED(rv = NS_NewChannel(getter_AddRefs(channel), url, nsnull, mLoadGroup)))</span>
<a href="#l11.3767"></a><span id="l11.3767" class="difflineminus">-    {</span>
<a href="#l11.3768"></a><span id="l11.3768" class="difflineminus">-</span>
<a href="#l11.3769"></a><span id="l11.3769" class="difflineminus">-      // send a &quot;MultiSearch&quot; header</span>
<a href="#l11.3770"></a><span id="l11.3770" class="difflineminus">-      nsCOMPtr&lt;nsIHttpChannel&gt; httpMultiChannel (do_QueryInterface(channel));</span>
<a href="#l11.3771"></a><span id="l11.3771" class="difflineminus">-      if (httpMultiChannel)</span>
<a href="#l11.3772"></a><span id="l11.3772" class="difflineminus">-      {</span>
<a href="#l11.3773"></a><span id="l11.3773" class="difflineminus">-                httpMultiChannel-&gt;SetRequestHeader(NS_LITERAL_CSTRING(&quot;MultiSearch&quot;),</span>
<a href="#l11.3774"></a><span id="l11.3774" class="difflineminus">-                                                   NS_LITERAL_CSTRING(&quot;true&quot;),</span>
<a href="#l11.3775"></a><span id="l11.3775" class="difflineminus">-                                                   PR_FALSE);</span>
<a href="#l11.3776"></a><span id="l11.3776" class="difflineminus">-      }</span>
<a href="#l11.3777"></a><span id="l11.3777" class="difflineminus">-</span>
<a href="#l11.3778"></a><span id="l11.3778" class="difflineminus">-      // get it just from the cache if we can (do not validate)</span>
<a href="#l11.3779"></a><span id="l11.3779" class="difflineminus">-      channel-&gt;SetLoadFlags(nsIRequest::LOAD_FROM_CACHE);</span>
<a href="#l11.3780"></a><span id="l11.3780" class="difflineminus">-</span>
<a href="#l11.3781"></a><span id="l11.3781" class="difflineminus">-      if (methodStr.LowerCaseEqualsLiteral(&quot;post&quot;))</span>
<a href="#l11.3782"></a><span id="l11.3782" class="difflineminus">-      {</span>
<a href="#l11.3783"></a><span id="l11.3783" class="difflineminus">-        nsCOMPtr&lt;nsIHttpChannel&gt; httpChannel (do_QueryInterface(channel));</span>
<a href="#l11.3784"></a><span id="l11.3784" class="difflineminus">-        if (httpChannel)</span>
<a href="#l11.3785"></a><span id="l11.3785" class="difflineminus">-        {</span>
<a href="#l11.3786"></a><span id="l11.3786" class="difflineminus">-            httpChannel-&gt;SetRequestMethod(NS_LITERAL_CSTRING(&quot;POST&quot;));</span>
<a href="#l11.3787"></a><span id="l11.3787" class="difflineminus">-            </span>
<a href="#l11.3788"></a><span id="l11.3788" class="difflineminus">-            // construct post data to send</span>
<a href="#l11.3789"></a><span id="l11.3789" class="difflineminus">-            nsCAutoString  postStr;</span>
<a href="#l11.3790"></a><span id="l11.3790" class="difflineminus">-            postStr.AssignLiteral(POSTHEADER_PREFIX);</span>
<a href="#l11.3791"></a><span id="l11.3791" class="difflineminus">-            postStr.AppendInt(input.Length(), 10);</span>
<a href="#l11.3792"></a><span id="l11.3792" class="difflineminus">-            postStr.AppendLiteral(POSTHEADER_SUFFIX);</span>
<a href="#l11.3793"></a><span id="l11.3793" class="difflineminus">-            postStr.Append(NS_LossyConvertUTF16toASCII(input));</span>
<a href="#l11.3794"></a><span id="l11.3794" class="difflineminus">-            </span>
<a href="#l11.3795"></a><span id="l11.3795" class="difflineminus">-            nsCOMPtr&lt;nsIInputStream&gt;  postDataStream;</span>
<a href="#l11.3796"></a><span id="l11.3796" class="difflineminus">-            if (NS_SUCCEEDED(rv = NS_NewPostDataStream(getter_AddRefs(postDataStream),</span>
<a href="#l11.3797"></a><span id="l11.3797" class="difflineminus">-                         PR_FALSE, postStr, 0)))</span>
<a href="#l11.3798"></a><span id="l11.3798" class="difflineminus">-            {</span>
<a href="#l11.3799"></a><span id="l11.3799" class="difflineminus">-          nsCOMPtr&lt;nsIUploadChannel&gt; uploadChannel(do_QueryInterface(httpChannel));</span>
<a href="#l11.3800"></a><span id="l11.3800" class="difflineminus">-          NS_ASSERTION(uploadChannel, &quot;http must support nsIUploadChannel&quot;);</span>
<a href="#l11.3801"></a><span id="l11.3801" class="difflineminus">-          uploadChannel-&gt;SetUploadStream(postDataStream, EmptyCString(), -1);</span>
<a href="#l11.3802"></a><span id="l11.3802" class="difflineminus">-            }</span>
<a href="#l11.3803"></a><span id="l11.3803" class="difflineminus">-        }</span>
<a href="#l11.3804"></a><span id="l11.3804" class="difflineminus">-      }</span>
<a href="#l11.3805"></a><span id="l11.3805" class="difflineminus">-      </span>
<a href="#l11.3806"></a><span id="l11.3806" class="difflineminus">-      nsCOMPtr&lt;nsIRequest&gt; request;</span>
<a href="#l11.3807"></a><span id="l11.3807" class="difflineminus">-      rv = channel-&gt;AsyncOpen(this, context);</span>
<a href="#l11.3808"></a><span id="l11.3808" class="difflineminus">-    }</span>
<a href="#l11.3809"></a><span id="l11.3809" class="difflineminus">-  }</span>
<a href="#l11.3810"></a><span id="l11.3810" class="difflineminus">-</span>
<a href="#l11.3811"></a><span id="l11.3811" class="difflineminus">-  // dispose of any last HTML results page</span>
<a href="#l11.3812"></a><span id="l11.3812" class="difflineminus">-  if (mInner)</span>
<a href="#l11.3813"></a><span id="l11.3813" class="difflineminus">-  {</span>
<a href="#l11.3814"></a><span id="l11.3814" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt;  htmlNode;</span>
<a href="#l11.3815"></a><span id="l11.3815" class="difflineminus">-    if (NS_SUCCEEDED(rv = mInner-&gt;GetTarget(engine, mNC_HTML, PR_TRUE, getter_AddRefs(htmlNode)))</span>
<a href="#l11.3816"></a><span id="l11.3816" class="difflineminus">-      &amp;&amp; (rv != NS_RDF_NO_VALUE))</span>
<a href="#l11.3817"></a><span id="l11.3817" class="difflineminus">-    {</span>
<a href="#l11.3818"></a><span id="l11.3818" class="difflineminus">-      rv = mInner-&gt;Unassert(engine, mNC_HTML, htmlNode);</span>
<a href="#l11.3819"></a><span id="l11.3819" class="difflineminus">-    }</span>
<a href="#l11.3820"></a><span id="l11.3820" class="difflineminus">-  }</span>
<a href="#l11.3821"></a><span id="l11.3821" class="difflineminus">-</span>
<a href="#l11.3822"></a><span id="l11.3822" class="difflineminus">-  // start &quot;loading&quot; animation for this search engine</span>
<a href="#l11.3823"></a><span id="l11.3823" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; (mInner))</span>
<a href="#l11.3824"></a><span id="l11.3824" class="difflineminus">-  {</span>
<a href="#l11.3825"></a><span id="l11.3825" class="difflineminus">-    // remove status icon so that loading icon style can be used</span>
<a href="#l11.3826"></a><span id="l11.3826" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt;    engineIconNode = nsnull;</span>
<a href="#l11.3827"></a><span id="l11.3827" class="difflineminus">-    mInner-&gt;GetTarget(engine, mNC_StatusIcon, PR_TRUE, getter_AddRefs(engineIconNode));</span>
<a href="#l11.3828"></a><span id="l11.3828" class="difflineminus">-    if (engineIconNode)</span>
<a href="#l11.3829"></a><span id="l11.3829" class="difflineminus">-    {</span>
<a href="#l11.3830"></a><span id="l11.3830" class="difflineminus">-      rv = mInner-&gt;Unassert(engine, mNC_StatusIcon, engineIconNode);</span>
<a href="#l11.3831"></a><span id="l11.3831" class="difflineminus">-    }</span>
<a href="#l11.3832"></a><span id="l11.3832" class="difflineminus">-</span>
<a href="#l11.3833"></a><span id="l11.3833" class="difflineminus">-    mInner-&gt;Assert(engine, mNC_loading, mTrueLiteral, PR_TRUE);</span>
<a href="#l11.3834"></a><span id="l11.3834" class="difflineminus">-  }</span>
<a href="#l11.3835"></a><span id="l11.3835" class="difflineminus">-</span>
<a href="#l11.3836"></a><span id="l11.3836" class="difflineminus">-  return(rv);</span>
<a href="#l11.3837"></a><span id="l11.3837" class="difflineminus">-}</span>
<a href="#l11.3838"></a><span id="l11.3838" class="difflineminus">-</span>
<a href="#l11.3839"></a><span id="l11.3839" class="difflineminus">-nsresult</span>
<a href="#l11.3840"></a><span id="l11.3840" class="difflineminus">-InternetSearchDataSource::SaveEngineInfoIntoGraph(nsIFile *file, nsIFile *icon,</span>
<a href="#l11.3841"></a><span id="l11.3841" class="difflineminus">-                                                  const PRUnichar *categoryHint,</span>
<a href="#l11.3842"></a><span id="l11.3842" class="difflineminus">-                                                  const PRUnichar *dataUni,</span>
<a href="#l11.3843"></a><span id="l11.3843" class="difflineminus">-                                                  PRBool isSystemSearchFile)</span>
<a href="#l11.3844"></a><span id="l11.3844" class="difflineminus">-{</span>
<a href="#l11.3845"></a><span id="l11.3845" class="difflineminus">-  nsresult      rv = NS_OK;</span>
<a href="#l11.3846"></a><span id="l11.3846" class="difflineminus">-</span>
<a href="#l11.3847"></a><span id="l11.3847" class="difflineminus">-  if (!file &amp;&amp; !icon) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.3848"></a><span id="l11.3848" class="difflineminus">-</span>
<a href="#l11.3849"></a><span id="l11.3849" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  searchRes;</span>
<a href="#l11.3850"></a><span id="l11.3850" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  categoryRes;</span>
<a href="#l11.3851"></a><span id="l11.3851" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt;   native;</span>
<a href="#l11.3852"></a><span id="l11.3852" class="difflineminus">-</span>
<a href="#l11.3853"></a><span id="l11.3853" class="difflineminus">-  if (icon != nsnull)</span>
<a href="#l11.3854"></a><span id="l11.3854" class="difflineminus">-  {</span>
<a href="#l11.3855"></a><span id="l11.3855" class="difflineminus">-    native = icon;</span>
<a href="#l11.3856"></a><span id="l11.3856" class="difflineminus">-  }</span>
<a href="#l11.3857"></a><span id="l11.3857" class="difflineminus">-</span>
<a href="#l11.3858"></a><span id="l11.3858" class="difflineminus">-  if (file != nsnull)</span>
<a href="#l11.3859"></a><span id="l11.3859" class="difflineminus">-  {</span>
<a href="#l11.3860"></a><span id="l11.3860" class="difflineminus">-    native = file;</span>
<a href="#l11.3861"></a><span id="l11.3861" class="difflineminus">-  }</span>
<a href="#l11.3862"></a><span id="l11.3862" class="difflineminus">-</span>
<a href="#l11.3863"></a><span id="l11.3863" class="difflineminus">-  PRBool exists;</span>
<a href="#l11.3864"></a><span id="l11.3864" class="difflineminus">-  rv = native-&gt;Exists(&amp;exists);</span>
<a href="#l11.3865"></a><span id="l11.3865" class="difflineminus">-  if (NS_FAILED(rv)) return(rv);</span>
<a href="#l11.3866"></a><span id="l11.3866" class="difflineminus">-  if (!exists) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.3867"></a><span id="l11.3867" class="difflineminus">-</span>
<a href="#l11.3868"></a><span id="l11.3868" class="difflineminus">-  nsAutoString basename;</span>
<a href="#l11.3869"></a><span id="l11.3869" class="difflineminus">-  rv = native-&gt;GetLeafName(basename);</span>
<a href="#l11.3870"></a><span id="l11.3870" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.3871"></a><span id="l11.3871" class="difflineminus">-</span>
<a href="#l11.3872"></a><span id="l11.3872" class="difflineminus">-  // ensure that the basename points to the search engine file</span>
<a href="#l11.3873"></a><span id="l11.3873" class="difflineminus">-  PRInt32   extensionOffset;</span>
<a href="#l11.3874"></a><span id="l11.3874" class="difflineminus">-  if ((extensionOffset = basename.RFindChar(PRUnichar('.'))) &gt; 0)</span>
<a href="#l11.3875"></a><span id="l11.3875" class="difflineminus">-  {</span>
<a href="#l11.3876"></a><span id="l11.3876" class="difflineminus">-    basename.SetLength(extensionOffset);</span>
<a href="#l11.3877"></a><span id="l11.3877" class="difflineminus">-    basename.AppendLiteral(&quot;.src&quot;);</span>
<a href="#l11.3878"></a><span id="l11.3878" class="difflineminus">-  }</span>
<a href="#l11.3879"></a><span id="l11.3879" class="difflineminus">-</span>
<a href="#l11.3880"></a><span id="l11.3880" class="difflineminus">-  nsCAutoString filePath;</span>
<a href="#l11.3881"></a><span id="l11.3881" class="difflineminus">-  rv = native-&gt;GetNativePath(filePath);</span>
<a href="#l11.3882"></a><span id="l11.3882" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.3883"></a><span id="l11.3883" class="difflineminus">-  </span>
<a href="#l11.3884"></a><span id="l11.3884" class="difflineminus">-  nsAutoString  searchURL;</span>
<a href="#l11.3885"></a><span id="l11.3885" class="difflineminus">-  searchURL.AssignLiteral(kEngineProtocol);</span>
<a href="#l11.3886"></a><span id="l11.3886" class="difflineminus">-</span>
<a href="#l11.3887"></a><span id="l11.3887" class="difflineminus">-  nsCOMPtr&lt;nsINetUtil&gt; netUtil = do_GetService(NS_NETUTIL_CONTRACTID, &amp;rv);</span>
<a href="#l11.3888"></a><span id="l11.3888" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3889"></a><span id="l11.3889" class="difflineminus">-</span>
<a href="#l11.3890"></a><span id="l11.3890" class="difflineminus">-  nsCString uriCescaped;</span>
<a href="#l11.3891"></a><span id="l11.3891" class="difflineminus">-  rv = netUtil-&gt;EscapeString(filePath,</span>
<a href="#l11.3892"></a><span id="l11.3892" class="difflineminus">-                             nsINetUtil::ESCAPE_URL_PATH,</span>
<a href="#l11.3893"></a><span id="l11.3893" class="difflineminus">-                             uriCescaped);</span>
<a href="#l11.3894"></a><span id="l11.3894" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3895"></a><span id="l11.3895" class="difflineminus">-</span>
<a href="#l11.3896"></a><span id="l11.3896" class="difflineminus">-  searchURL.Append(NS_ConvertASCIItoUTF16(uriCescaped));</span>
<a href="#l11.3897"></a><span id="l11.3897" class="difflineminus">-</span>
<a href="#l11.3898"></a><span id="l11.3898" class="difflineminus">-  if ((extensionOffset = searchURL.RFindChar(PRUnichar('.'))) &gt; 0)</span>
<a href="#l11.3899"></a><span id="l11.3899" class="difflineminus">-  {</span>
<a href="#l11.3900"></a><span id="l11.3900" class="difflineminus">-    searchURL.SetLength(extensionOffset);</span>
<a href="#l11.3901"></a><span id="l11.3901" class="difflineminus">-    searchURL.AppendLiteral(&quot;.src&quot;);</span>
<a href="#l11.3902"></a><span id="l11.3902" class="difflineminus">-  }</span>
<a href="#l11.3903"></a><span id="l11.3903" class="difflineminus">-</span>
<a href="#l11.3904"></a><span id="l11.3904" class="difflineminus">-  rv = mRDFService-&gt;GetUnicodeResource(searchURL,</span>
<a href="#l11.3905"></a><span id="l11.3905" class="difflineminus">-                                       getter_AddRefs(searchRes));</span>
<a href="#l11.3906"></a><span id="l11.3906" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3907"></a><span id="l11.3907" class="difflineminus">-</span>
<a href="#l11.3908"></a><span id="l11.3908" class="difflineminus">-  // save the basename reference</span>
<a href="#l11.3909"></a><span id="l11.3909" class="difflineminus">-  if (!basename.IsEmpty())</span>
<a href="#l11.3910"></a><span id="l11.3910" class="difflineminus">-  {</span>
<a href="#l11.3911"></a><span id="l11.3911" class="difflineminus">-    basename.Insert(NS_ConvertASCIItoUTF16(kURINC_SearchCategoryEngineBasenamePrefix), 0);</span>
<a href="#l11.3912"></a><span id="l11.3912" class="difflineminus">-</span>
<a href="#l11.3913"></a><span id="l11.3913" class="difflineminus">-    rv = mRDFService-&gt;GetUnicodeResource(basename,</span>
<a href="#l11.3914"></a><span id="l11.3914" class="difflineminus">-                                         getter_AddRefs(categoryRes));</span>
<a href="#l11.3915"></a><span id="l11.3915" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3916"></a><span id="l11.3916" class="difflineminus">-</span>
<a href="#l11.3917"></a><span id="l11.3917" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; searchLiteral;</span>
<a href="#l11.3918"></a><span id="l11.3918" class="difflineminus">-    rv = mRDFService-&gt;GetLiteral(basename.get(),</span>
<a href="#l11.3919"></a><span id="l11.3919" class="difflineminus">-                                 getter_AddRefs(searchLiteral));</span>
<a href="#l11.3920"></a><span id="l11.3920" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.3921"></a><span id="l11.3921" class="difflineminus">-</span>
<a href="#l11.3922"></a><span id="l11.3922" class="difflineminus">-    if (file)</span>
<a href="#l11.3923"></a><span id="l11.3923" class="difflineminus">-      updateAtom(mInner, searchRes, mNC_URL, searchLiteral, nsnull);</span>
<a href="#l11.3924"></a><span id="l11.3924" class="difflineminus">-  }</span>
<a href="#l11.3925"></a><span id="l11.3925" class="difflineminus">-</span>
<a href="#l11.3926"></a><span id="l11.3926" class="difflineminus">-  if (!searchRes)   return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.3927"></a><span id="l11.3927" class="difflineminus">-  if (!categoryRes) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.3928"></a><span id="l11.3928" class="difflineminus">-</span>
<a href="#l11.3929"></a><span id="l11.3929" class="difflineminus">-  nsAutoString  iconURL;</span>
<a href="#l11.3930"></a><span id="l11.3930" class="difflineminus">-  if (icon)</span>
<a href="#l11.3931"></a><span id="l11.3931" class="difflineminus">-  {</span>
<a href="#l11.3932"></a><span id="l11.3932" class="difflineminus">-    nsCAutoString iconFileURL;</span>
<a href="#l11.3933"></a><span id="l11.3933" class="difflineminus">-    if (NS_FAILED(rv = NS_GetURLSpecFromFile(icon, iconFileURL)))</span>
<a href="#l11.3934"></a><span id="l11.3934" class="difflineminus">-      return(rv);</span>
<a href="#l11.3935"></a><span id="l11.3935" class="difflineminus">-    CopyUTF8toUTF16(iconFileURL, iconURL);</span>
<a href="#l11.3936"></a><span id="l11.3936" class="difflineminus">-  }</span>
<a href="#l11.3937"></a><span id="l11.3937" class="difflineminus">-</span>
<a href="#l11.3938"></a><span id="l11.3938" class="difflineminus">-  // save icon url (if we have one)</span>
<a href="#l11.3939"></a><span id="l11.3939" class="difflineminus">-  if (iconURL.Length() &gt; 0)</span>
<a href="#l11.3940"></a><span id="l11.3940" class="difflineminus">-  {</span>
<a href="#l11.3941"></a><span id="l11.3941" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; iconLiteral;</span>
<a href="#l11.3942"></a><span id="l11.3942" class="difflineminus">-    if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(iconURL.get(),</span>
<a href="#l11.3943"></a><span id="l11.3943" class="difflineminus">-        getter_AddRefs(iconLiteral))))</span>
<a href="#l11.3944"></a><span id="l11.3944" class="difflineminus">-    {</span>
<a href="#l11.3945"></a><span id="l11.3945" class="difflineminus">-      updateAtom(mInner, searchRes, mNC_Icon, iconLiteral, nsnull);</span>
<a href="#l11.3946"></a><span id="l11.3946" class="difflineminus">-    }</span>
<a href="#l11.3947"></a><span id="l11.3947" class="difflineminus">-  }</span>
<a href="#l11.3948"></a><span id="l11.3948" class="difflineminus">-</span>
<a href="#l11.3949"></a><span id="l11.3949" class="difflineminus">-  if (!isSystemSearchFile)</span>
<a href="#l11.3950"></a><span id="l11.3950" class="difflineminus">-  {</span>
<a href="#l11.3951"></a><span id="l11.3951" class="difflineminus">-    // mark our private search files, so that we can distinguish</span>
<a href="#l11.3952"></a><span id="l11.3952" class="difflineminus">-    // between ours and any that are included with the OS</span>
<a href="#l11.3953"></a><span id="l11.3953" class="difflineminus">-    updateAtom(mInner, searchRes, mNC_SearchType, mNC_Engine, nsnull);</span>
<a href="#l11.3954"></a><span id="l11.3954" class="difflineminus">-  }</span>
<a href="#l11.3955"></a><span id="l11.3955" class="difflineminus">-</span>
<a href="#l11.3956"></a><span id="l11.3956" class="difflineminus">-  if (dataUni != nsnull)</span>
<a href="#l11.3957"></a><span id="l11.3957" class="difflineminus">-  {</span>
<a href="#l11.3958"></a><span id="l11.3958" class="difflineminus">-    updateDataHintsInGraph(searchRes, dataUni);</span>
<a href="#l11.3959"></a><span id="l11.3959" class="difflineminus">-</span>
<a href="#l11.3960"></a><span id="l11.3960" class="difflineminus">-    // finally, if we have a category hint, add this new engine into the category (if it exists)</span>
<a href="#l11.3961"></a><span id="l11.3961" class="difflineminus">-    if (categoryHint &amp;&amp; categoryDataSource)</span>
<a href="#l11.3962"></a><span id="l11.3962" class="difflineminus">-    {</span>
<a href="#l11.3963"></a><span id="l11.3963" class="difflineminus">-      nsCOMPtr&lt;nsIRDFLiteral&gt; catLiteral;</span>
<a href="#l11.3964"></a><span id="l11.3964" class="difflineminus">-      rv = mRDFService-&gt;GetLiteral(categoryHint, getter_AddRefs(catLiteral));</span>
<a href="#l11.3965"></a><span id="l11.3965" class="difflineminus">-</span>
<a href="#l11.3966"></a><span id="l11.3966" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt;  catSrc;</span>
<a href="#l11.3967"></a><span id="l11.3967" class="difflineminus">-      if (catLiteral)</span>
<a href="#l11.3968"></a><span id="l11.3968" class="difflineminus">-      {</span>
<a href="#l11.3969"></a><span id="l11.3969" class="difflineminus">-        rv = categoryDataSource-&gt;GetSource(mNC_Title, catLiteral,</span>
<a href="#l11.3970"></a><span id="l11.3970" class="difflineminus">-          PR_TRUE, getter_AddRefs(catSrc));</span>
<a href="#l11.3971"></a><span id="l11.3971" class="difflineminus">-      }</span>
<a href="#l11.3972"></a><span id="l11.3972" class="difflineminus">-</span>
<a href="#l11.3973"></a><span id="l11.3973" class="difflineminus">-      const char    *catURI = nsnull;</span>
<a href="#l11.3974"></a><span id="l11.3974" class="difflineminus">-      if (catSrc)         </span>
<a href="#l11.3975"></a><span id="l11.3975" class="difflineminus">-      {</span>
<a href="#l11.3976"></a><span id="l11.3976" class="difflineminus">-        rv = catSrc-&gt;GetValueConst(&amp;catURI);</span>
<a href="#l11.3977"></a><span id="l11.3977" class="difflineminus">-      }</span>
<a href="#l11.3978"></a><span id="l11.3978" class="difflineminus">-</span>
<a href="#l11.3979"></a><span id="l11.3979" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt;  catRes;</span>
<a href="#l11.3980"></a><span id="l11.3980" class="difflineminus">-      if (catURI)</span>
<a href="#l11.3981"></a><span id="l11.3981" class="difflineminus">-      {</span>
<a href="#l11.3982"></a><span id="l11.3982" class="difflineminus">-        nsCAutoString  catList;</span>
<a href="#l11.3983"></a><span id="l11.3983" class="difflineminus">-        catList.AssignLiteral(kURINC_SearchCategoryPrefix);</span>
<a href="#l11.3984"></a><span id="l11.3984" class="difflineminus">-        catList.Append(catURI);</span>
<a href="#l11.3985"></a><span id="l11.3985" class="difflineminus">-        mRDFService-&gt;GetResource(catList, getter_AddRefs(catRes));</span>
<a href="#l11.3986"></a><span id="l11.3986" class="difflineminus">-      }</span>
<a href="#l11.3987"></a><span id="l11.3987" class="difflineminus">-</span>
<a href="#l11.3988"></a><span id="l11.3988" class="difflineminus">-      nsCOMPtr&lt;nsIRDFContainer&gt; container;</span>
<a href="#l11.3989"></a><span id="l11.3989" class="difflineminus">-      if (catRes)</span>
<a href="#l11.3990"></a><span id="l11.3990" class="difflineminus">-        container = do_CreateInstance(NS_RDF_CONTRACTID &quot;/container;1&quot;);</span>
<a href="#l11.3991"></a><span id="l11.3991" class="difflineminus">-</span>
<a href="#l11.3992"></a><span id="l11.3992" class="difflineminus">-      if (container)</span>
<a href="#l11.3993"></a><span id="l11.3993" class="difflineminus">-      {</span>
<a href="#l11.3994"></a><span id="l11.3994" class="difflineminus">-        rv = container-&gt;Init(categoryDataSource, catRes);</span>
<a href="#l11.3995"></a><span id="l11.3995" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l11.3996"></a><span id="l11.3996" class="difflineminus">-          rv = mRDFC-&gt;MakeSeq(categoryDataSource, catRes, nsnull);</span>
<a href="#l11.3997"></a><span id="l11.3997" class="difflineminus">-</span>
<a href="#l11.3998"></a><span id="l11.3998" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l11.3999"></a><span id="l11.3999" class="difflineminus">-        {</span>
<a href="#l11.4000"></a><span id="l11.4000" class="difflineminus">-          PRInt32   searchIndex = -1;</span>
<a href="#l11.4001"></a><span id="l11.4001" class="difflineminus">-          if (NS_SUCCEEDED(rv = container-&gt;IndexOf(categoryRes, &amp;searchIndex))</span>
<a href="#l11.4002"></a><span id="l11.4002" class="difflineminus">-            &amp;&amp; (searchIndex &lt; 0))</span>
<a href="#l11.4003"></a><span id="l11.4003" class="difflineminus">-          {</span>
<a href="#l11.4004"></a><span id="l11.4004" class="difflineminus">-            rv = container-&gt;AppendElement(categoryRes);</span>
<a href="#l11.4005"></a><span id="l11.4005" class="difflineminus">-          }</span>
<a href="#l11.4006"></a><span id="l11.4006" class="difflineminus">-        }</span>
<a href="#l11.4007"></a><span id="l11.4007" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l11.4008"></a><span id="l11.4008" class="difflineminus">-        {</span>
<a href="#l11.4009"></a><span id="l11.4009" class="difflineminus">-          // flush categoryDataSource</span>
<a href="#l11.4010"></a><span id="l11.4010" class="difflineminus">-          nsCOMPtr&lt;nsIRDFRemoteDataSource&gt;  remoteCategoryStore;</span>
<a href="#l11.4011"></a><span id="l11.4011" class="difflineminus">-          remoteCategoryStore = do_QueryInterface(categoryDataSource);</span>
<a href="#l11.4012"></a><span id="l11.4012" class="difflineminus">-          if (remoteCategoryStore)</span>
<a href="#l11.4013"></a><span id="l11.4013" class="difflineminus">-          {</span>
<a href="#l11.4014"></a><span id="l11.4014" class="difflineminus">-            remoteCategoryStore-&gt;Flush();</span>
<a href="#l11.4015"></a><span id="l11.4015" class="difflineminus">-          }</span>
<a href="#l11.4016"></a><span id="l11.4016" class="difflineminus">-        }</span>
<a href="#l11.4017"></a><span id="l11.4017" class="difflineminus">-      }</span>
<a href="#l11.4018"></a><span id="l11.4018" class="difflineminus">-    }</span>
<a href="#l11.4019"></a><span id="l11.4019" class="difflineminus">-  }</span>
<a href="#l11.4020"></a><span id="l11.4020" class="difflineminus">-</span>
<a href="#l11.4021"></a><span id="l11.4021" class="difflineminus">-  // Note: add the child relationship last</span>
<a href="#l11.4022"></a><span id="l11.4022" class="difflineminus">-  PRBool  hasChildFlag = PR_FALSE;</span>
<a href="#l11.4023"></a><span id="l11.4023" class="difflineminus">-  rv = mInner-&gt;HasAssertion(mNC_SearchEngineRoot, mNC_Child, searchRes,</span>
<a href="#l11.4024"></a><span id="l11.4024" class="difflineminus">-                            PR_TRUE, &amp;hasChildFlag);</span>
<a href="#l11.4025"></a><span id="l11.4025" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !hasChildFlag)</span>
<a href="#l11.4026"></a><span id="l11.4026" class="difflineminus">-  {</span>
<a href="#l11.4027"></a><span id="l11.4027" class="difflineminus">-    mInner-&gt;Assert(mNC_SearchEngineRoot, mNC_Child, searchRes, PR_TRUE);</span>
<a href="#l11.4028"></a><span id="l11.4028" class="difflineminus">-  }</span>
<a href="#l11.4029"></a><span id="l11.4029" class="difflineminus">-</span>
<a href="#l11.4030"></a><span id="l11.4030" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.4031"></a><span id="l11.4031" class="difflineminus">-}</span>
<a href="#l11.4032"></a><span id="l11.4032" class="difflineminus">-</span>
<a href="#l11.4033"></a><span id="l11.4033" class="difflineminus">-nsresult</span>
<a href="#l11.4034"></a><span id="l11.4034" class="difflineminus">-InternetSearchDataSource::GetSearchEngineList(nsIFile *searchDir,</span>
<a href="#l11.4035"></a><span id="l11.4035" class="difflineminus">-              PRBool isSystemSearchFile)</span>
<a href="#l11.4036"></a><span id="l11.4036" class="difflineminus">-{</span>
<a href="#l11.4037"></a><span id="l11.4037" class="difflineminus">-        nsresult      rv = NS_OK;</span>
<a href="#l11.4038"></a><span id="l11.4038" class="difflineminus">-</span>
<a href="#l11.4039"></a><span id="l11.4039" class="difflineminus">-    if (!mInner)</span>
<a href="#l11.4040"></a><span id="l11.4040" class="difflineminus">-    {</span>
<a href="#l11.4041"></a><span id="l11.4041" class="difflineminus">-      return(NS_RDF_NO_VALUE);</span>
<a href="#l11.4042"></a><span id="l11.4042" class="difflineminus">-    }</span>
<a href="#l11.4043"></a><span id="l11.4043" class="difflineminus">-</span>
<a href="#l11.4044"></a><span id="l11.4044" class="difflineminus">-    PRBool hasMore = PR_FALSE;</span>
<a href="#l11.4045"></a><span id="l11.4045" class="difflineminus">-    nsCOMPtr&lt;nsISimpleEnumerator&gt; dirIterator;</span>
<a href="#l11.4046"></a><span id="l11.4046" class="difflineminus">-    rv = searchDir-&gt;GetDirectoryEntries(getter_AddRefs(dirIterator));</span>
<a href="#l11.4047"></a><span id="l11.4047" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.4048"></a><span id="l11.4048" class="difflineminus">-</span>
<a href="#l11.4049"></a><span id="l11.4049" class="difflineminus">-    nsCOMPtr&lt;nsIFile&gt; dirEntry;</span>
<a href="#l11.4050"></a><span id="l11.4050" class="difflineminus">-  while ((rv = dirIterator-&gt;HasMoreElements(&amp;hasMore)) == NS_OK &amp;&amp; hasMore)</span>
<a href="#l11.4051"></a><span id="l11.4051" class="difflineminus">-  {</span>
<a href="#l11.4052"></a><span id="l11.4052" class="difflineminus">-    rv = dirIterator-&gt;GetNext((nsISupports**)getter_AddRefs(dirEntry));</span>
<a href="#l11.4053"></a><span id="l11.4053" class="difflineminus">-        if (NS_FAILED(rv))</span>
<a href="#l11.4054"></a><span id="l11.4054" class="difflineminus">-          continue;</span>
<a href="#l11.4055"></a><span id="l11.4055" class="difflineminus">-</span>
<a href="#l11.4056"></a><span id="l11.4056" class="difflineminus">-        // Ignore hidden files/directories</span>
<a href="#l11.4057"></a><span id="l11.4057" class="difflineminus">-        PRBool isHidden;</span>
<a href="#l11.4058"></a><span id="l11.4058" class="difflineminus">-        rv = dirEntry-&gt;IsHidden(&amp;isHidden);</span>
<a href="#l11.4059"></a><span id="l11.4059" class="difflineminus">-        if (NS_FAILED(rv) || isHidden)</span>
<a href="#l11.4060"></a><span id="l11.4060" class="difflineminus">-          continue;</span>
<a href="#l11.4061"></a><span id="l11.4061" class="difflineminus">-</span>
<a href="#l11.4062"></a><span id="l11.4062" class="difflineminus">-        PRBool isDirectory;</span>
<a href="#l11.4063"></a><span id="l11.4063" class="difflineminus">-        rv = dirEntry-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l11.4064"></a><span id="l11.4064" class="difflineminus">-        if (NS_FAILED(rv))</span>
<a href="#l11.4065"></a><span id="l11.4065" class="difflineminus">-          continue;</span>
<a href="#l11.4066"></a><span id="l11.4066" class="difflineminus">-        if (isDirectory)</span>
<a href="#l11.4067"></a><span id="l11.4067" class="difflineminus">-        {</span>
<a href="#l11.4068"></a><span id="l11.4068" class="difflineminus">-          GetSearchEngineList(dirEntry, isSystemSearchFile);</span>
<a href="#l11.4069"></a><span id="l11.4069" class="difflineminus">-          continue;</span>
<a href="#l11.4070"></a><span id="l11.4070" class="difflineminus">-        }</span>
<a href="#l11.4071"></a><span id="l11.4071" class="difflineminus">-</span>
<a href="#l11.4072"></a><span id="l11.4072" class="difflineminus">-        // Skip over empty files</span>
<a href="#l11.4073"></a><span id="l11.4073" class="difflineminus">-        // Note: use GetFileSize even on Mac [instead of GetFileSizeWithResFork()]</span>
<a href="#l11.4074"></a><span id="l11.4074" class="difflineminus">-        // as we want the size of ONLY the data fork</span>
<a href="#l11.4075"></a><span id="l11.4075" class="difflineminus">-        PRInt64 fileSize;</span>
<a href="#l11.4076"></a><span id="l11.4076" class="difflineminus">-        rv = dirEntry-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l11.4077"></a><span id="l11.4077" class="difflineminus">-        if (NS_FAILED(rv) || (fileSize == 0))</span>
<a href="#l11.4078"></a><span id="l11.4078" class="difflineminus">-            continue;</span>
<a href="#l11.4079"></a><span id="l11.4079" class="difflineminus">-    </span>
<a href="#l11.4080"></a><span id="l11.4080" class="difflineminus">-        nsAutoString uri;</span>
<a href="#l11.4081"></a><span id="l11.4081" class="difflineminus">-        rv = dirEntry-&gt;GetPath(uri);</span>
<a href="#l11.4082"></a><span id="l11.4082" class="difflineminus">-        if (NS_FAILED(rv))</span>
<a href="#l11.4083"></a><span id="l11.4083" class="difflineminus">-        continue;</span>
<a href="#l11.4084"></a><span id="l11.4084" class="difflineminus">-</span>
<a href="#l11.4085"></a><span id="l11.4085" class="difflineminus">-    PRInt32   len = uri.Length();</span>
<a href="#l11.4086"></a><span id="l11.4086" class="difflineminus">-    if (len &lt; 5)</span>
<a href="#l11.4087"></a><span id="l11.4087" class="difflineminus">-    {</span>
<a href="#l11.4088"></a><span id="l11.4088" class="difflineminus">-      continue;</span>
<a href="#l11.4089"></a><span id="l11.4089" class="difflineminus">-    }</span>
<a href="#l11.4090"></a><span id="l11.4090" class="difflineminus">-</span>
<a href="#l11.4091"></a><span id="l11.4091" class="difflineminus">-    // check the extension (must be &quot;.src&quot;)</span>
<a href="#l11.4092"></a><span id="l11.4092" class="difflineminus">-    if (!StringEndsWith(uri, NS_LITERAL_STRING(&quot;.src&quot;), CaseInsensitiveCompare))</span>
<a href="#l11.4093"></a><span id="l11.4093" class="difflineminus">-    {</span>
<a href="#l11.4094"></a><span id="l11.4094" class="difflineminus">-      continue;</span>
<a href="#l11.4095"></a><span id="l11.4095" class="difflineminus">-    }</span>
<a href="#l11.4096"></a><span id="l11.4096" class="difflineminus">-</span>
<a href="#l11.4097"></a><span id="l11.4097" class="difflineminus">-    // check for various icons</span>
<a href="#l11.4098"></a><span id="l11.4098" class="difflineminus">-    PRBool    foundIconFlag = PR_FALSE;</span>
<a href="#l11.4099"></a><span id="l11.4099" class="difflineminus">-    nsAutoString  temp;</span>
<a href="#l11.4100"></a><span id="l11.4100" class="difflineminus">-    </span>
<a href="#l11.4101"></a><span id="l11.4101" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; iconFile, loopFile;</span>
<a href="#l11.4102"></a><span id="l11.4102" class="difflineminus">-</span>
<a href="#l11.4103"></a><span id="l11.4103" class="difflineminus">-                static const char *extensions[] = {</span>
<a href="#l11.4104"></a><span id="l11.4104" class="difflineminus">-                        &quot;.gif&quot;,</span>
<a href="#l11.4105"></a><span id="l11.4105" class="difflineminus">-                        &quot;.jpg&quot;,</span>
<a href="#l11.4106"></a><span id="l11.4106" class="difflineminus">-                        &quot;.jpeg&quot;,</span>
<a href="#l11.4107"></a><span id="l11.4107" class="difflineminus">-                        &quot;.png&quot;,</span>
<a href="#l11.4108"></a><span id="l11.4108" class="difflineminus">-                        nsnull,</span>
<a href="#l11.4109"></a><span id="l11.4109" class="difflineminus">-                };</span>
<a href="#l11.4110"></a><span id="l11.4110" class="difflineminus">-</span>
<a href="#l11.4111"></a><span id="l11.4111" class="difflineminus">-                for (int ext_count = 0; extensions[ext_count] != nsnull; ext_count++) {</span>
<a href="#l11.4112"></a><span id="l11.4112" class="difflineminus">-                        temp = Substring(uri, 0, uri.Length()-4);</span>
<a href="#l11.4113"></a><span id="l11.4113" class="difflineminus">-                        temp.Append(NS_ConvertASCIItoUTF16(extensions[ext_count]));</span>
<a href="#l11.4114"></a><span id="l11.4114" class="difflineminus">-                        rv = NS_NewLocalFile(temp, PR_TRUE, getter_AddRefs(loopFile));</span>
<a href="#l11.4115"></a><span id="l11.4115" class="difflineminus">-                        if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.4116"></a><span id="l11.4116" class="difflineminus">-                        rv = loopFile-&gt;Exists(&amp;foundIconFlag);</span>
<a href="#l11.4117"></a><span id="l11.4117" class="difflineminus">-                        if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.4118"></a><span id="l11.4118" class="difflineminus">-                        if (!foundIconFlag) continue;</span>
<a href="#l11.4119"></a><span id="l11.4119" class="difflineminus">-                        rv = loopFile-&gt;IsFile(&amp;foundIconFlag);</span>
<a href="#l11.4120"></a><span id="l11.4120" class="difflineminus">-                        if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.4121"></a><span id="l11.4121" class="difflineminus">-                        if (foundIconFlag) </span>
<a href="#l11.4122"></a><span id="l11.4122" class="difflineminus">-                        {</span>
<a href="#l11.4123"></a><span id="l11.4123" class="difflineminus">-                                iconFile = loopFile;</span>
<a href="#l11.4124"></a><span id="l11.4124" class="difflineminus">-                                break;</span>
<a href="#l11.4125"></a><span id="l11.4125" class="difflineminus">-                        } </span>
<a href="#l11.4126"></a><span id="l11.4126" class="difflineminus">-                }</span>
<a href="#l11.4127"></a><span id="l11.4127" class="difflineminus">-    </span>
<a href="#l11.4128"></a><span id="l11.4128" class="difflineminus">-    SaveEngineInfoIntoGraph(dirEntry, iconFile, nsnull, nsnull, isSystemSearchFile);</span>
<a href="#l11.4129"></a><span id="l11.4129" class="difflineminus">-  }</span>
<a href="#l11.4130"></a><span id="l11.4130" class="difflineminus">-</span>
<a href="#l11.4131"></a><span id="l11.4131" class="difflineminus">-  return(rv);</span>
<a href="#l11.4132"></a><span id="l11.4132" class="difflineminus">-}</span>
<a href="#l11.4133"></a><span id="l11.4133" class="difflineminus">-</span>
<a href="#l11.4134"></a><span id="l11.4134" class="difflineminus">-nsresult</span>
<a href="#l11.4135"></a><span id="l11.4135" class="difflineminus">-InternetSearchDataSource::ReadFileContents(nsILocalFile *localFile, nsString&amp; sourceContents)</span>
<a href="#l11.4136"></a><span id="l11.4136" class="difflineminus">-{</span>
<a href="#l11.4137"></a><span id="l11.4137" class="difflineminus">-  nsresult      rv = NS_ERROR_FAILURE;</span>
<a href="#l11.4138"></a><span id="l11.4138" class="difflineminus">-  PRInt64       contentsLen, total = 0;</span>
<a href="#l11.4139"></a><span id="l11.4139" class="difflineminus">-  char        *contents;</span>
<a href="#l11.4140"></a><span id="l11.4140" class="difflineminus">-</span>
<a href="#l11.4141"></a><span id="l11.4141" class="difflineminus">-        NS_ENSURE_ARG_POINTER(localFile);</span>
<a href="#l11.4142"></a><span id="l11.4142" class="difflineminus">-</span>
<a href="#l11.4143"></a><span id="l11.4143" class="difflineminus">-        sourceContents.Truncate();</span>
<a href="#l11.4144"></a><span id="l11.4144" class="difflineminus">-</span>
<a href="#l11.4145"></a><span id="l11.4145" class="difflineminus">-        rv = localFile-&gt;GetFileSize(&amp;contentsLen);</span>
<a href="#l11.4146"></a><span id="l11.4146" class="difflineminus">-        if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.4147"></a><span id="l11.4147" class="difflineminus">-        if (contentsLen &gt; 0)</span>
<a href="#l11.4148"></a><span id="l11.4148" class="difflineminus">-        {</span>
<a href="#l11.4149"></a><span id="l11.4149" class="difflineminus">-                contents = new char [contentsLen + 1];</span>
<a href="#l11.4150"></a><span id="l11.4150" class="difflineminus">-                if (contents)</span>
<a href="#l11.4151"></a><span id="l11.4151" class="difflineminus">-                {</span>
<a href="#l11.4152"></a><span id="l11.4152" class="difflineminus">-                        nsCOMPtr&lt;nsIInputStream&gt; inputStream;</span>
<a href="#l11.4153"></a><span id="l11.4153" class="difflineminus">-                        rv = NS_NewLocalFileInputStream(getter_AddRefs(inputStream), localFile);</span>
<a href="#l11.4154"></a><span id="l11.4154" class="difflineminus">-                        if (NS_FAILED(rv)) {</span>
<a href="#l11.4155"></a><span id="l11.4155" class="difflineminus">-                          delete [] contents;</span>
<a href="#l11.4156"></a><span id="l11.4156" class="difflineminus">-                          return rv;</span>
<a href="#l11.4157"></a><span id="l11.4157" class="difflineminus">-                        }</span>
<a href="#l11.4158"></a><span id="l11.4158" class="difflineminus">-                        PRUint32 howMany;</span>
<a href="#l11.4159"></a><span id="l11.4159" class="difflineminus">-                        while (total &lt; contentsLen) {</span>
<a href="#l11.4160"></a><span id="l11.4160" class="difflineminus">-                                rv = inputStream-&gt;Read(contents+total, </span>
<a href="#l11.4161"></a><span id="l11.4161" class="difflineminus">-                                                       PRUint32(contentsLen),</span>
<a href="#l11.4162"></a><span id="l11.4162" class="difflineminus">-                                                       &amp;howMany);</span>
<a href="#l11.4163"></a><span id="l11.4163" class="difflineminus">-                                if (NS_FAILED(rv)) {</span>
<a href="#l11.4164"></a><span id="l11.4164" class="difflineminus">-                                        delete [] contents;</span>
<a href="#l11.4165"></a><span id="l11.4165" class="difflineminus">-                                        return rv;</span>
<a href="#l11.4166"></a><span id="l11.4166" class="difflineminus">-                                }</span>
<a href="#l11.4167"></a><span id="l11.4167" class="difflineminus">-                                total += howMany;</span>
<a href="#l11.4168"></a><span id="l11.4168" class="difflineminus">-                        }</span>
<a href="#l11.4169"></a><span id="l11.4169" class="difflineminus">-                        if (total == contentsLen)</span>
<a href="#l11.4170"></a><span id="l11.4170" class="difflineminus">-            {</span>
<a href="#l11.4171"></a><span id="l11.4171" class="difflineminus">-        contents[contentsLen] = '\0';</span>
<a href="#l11.4172"></a><span id="l11.4172" class="difflineminus">-        CopyASCIItoUTF16(Substring(contents, contents + contentsLen), sourceContents);</span>
<a href="#l11.4173"></a><span id="l11.4173" class="difflineminus">-        rv = NS_OK;</span>
<a href="#l11.4174"></a><span id="l11.4174" class="difflineminus">-            }</span>
<a href="#l11.4175"></a><span id="l11.4175" class="difflineminus">-            delete [] contents;</span>
<a href="#l11.4176"></a><span id="l11.4176" class="difflineminus">-            contents = nsnull;</span>
<a href="#l11.4177"></a><span id="l11.4177" class="difflineminus">-    }</span>
<a href="#l11.4178"></a><span id="l11.4178" class="difflineminus">-  }</span>
<a href="#l11.4179"></a><span id="l11.4179" class="difflineminus">-  return(rv);</span>
<a href="#l11.4180"></a><span id="l11.4180" class="difflineminus">-}</span>
<a href="#l11.4181"></a><span id="l11.4181" class="difflineminus">-</span>
<a href="#l11.4182"></a><span id="l11.4182" class="difflineminus">-</span>
<a href="#l11.4183"></a><span id="l11.4183" class="difflineminus">-</span>
<a href="#l11.4184"></a><span id="l11.4184" class="difflineminus">-nsresult</span>
<a href="#l11.4185"></a><span id="l11.4185" class="difflineminus">-InternetSearchDataSource::GetNumInterpretSections(const PRUnichar *dataUni, PRUint32 &amp;numInterpretSections)</span>
<a href="#l11.4186"></a><span id="l11.4186" class="difflineminus">-{</span>
<a href="#l11.4187"></a><span id="l11.4187" class="difflineminus">-  numInterpretSections = 0;</span>
<a href="#l11.4188"></a><span id="l11.4188" class="difflineminus">-</span>
<a href="#l11.4189"></a><span id="l11.4189" class="difflineminus">-  nsString  buffer(dataUni);</span>
<a href="#l11.4190"></a><span id="l11.4190" class="difflineminus">-</span>
<a href="#l11.4191"></a><span id="l11.4191" class="difflineminus">-  NS_NAMED_LITERAL_STRING(section, &quot;&lt;interpret&quot;);</span>
<a href="#l11.4192"></a><span id="l11.4192" class="difflineminus">-  PRBool    inSection = PR_FALSE;</span>
<a href="#l11.4193"></a><span id="l11.4193" class="difflineminus">-</span>
<a href="#l11.4194"></a><span id="l11.4194" class="difflineminus">-  while(!buffer.IsEmpty())</span>
<a href="#l11.4195"></a><span id="l11.4195" class="difflineminus">-  {</span>
<a href="#l11.4196"></a><span id="l11.4196" class="difflineminus">-    PRInt32 eol = nsString_FindCharInSet(buffer, &quot;\r\n&quot;, 0);</span>
<a href="#l11.4197"></a><span id="l11.4197" class="difflineminus">-    if (eol &lt; 0)  break;</span>
<a href="#l11.4198"></a><span id="l11.4198" class="difflineminus">-    nsAutoString  line(StringHead(buffer, eol));</span>
<a href="#l11.4199"></a><span id="l11.4199" class="difflineminus">-    buffer.Cut(0, eol+1);</span>
<a href="#l11.4200"></a><span id="l11.4200" class="difflineminus">-    if (line.IsEmpty()) continue;   // skip empty lines</span>
<a href="#l11.4201"></a><span id="l11.4201" class="difflineminus">-    if (line[0] == PRUnichar('#'))  continue; // skip comments</span>
<a href="#l11.4202"></a><span id="l11.4202" class="difflineminus">-    line.Trim(&quot; \t&quot;);</span>
<a href="#l11.4203"></a><span id="l11.4203" class="difflineminus">-    if (!inSection)</span>
<a href="#l11.4204"></a><span id="l11.4204" class="difflineminus">-    {</span>
<a href="#l11.4205"></a><span id="l11.4205" class="difflineminus">-      PRInt32 sectionOffset = line.Find(section, CaseInsensitiveCompare);</span>
<a href="#l11.4206"></a><span id="l11.4206" class="difflineminus">-      if (sectionOffset &lt; 0)  continue;</span>
<a href="#l11.4207"></a><span id="l11.4207" class="difflineminus">-      line.Cut(0, sectionOffset + section.Length() + 1);</span>
<a href="#l11.4208"></a><span id="l11.4208" class="difflineminus">-      inSection = PR_TRUE;</span>
<a href="#l11.4209"></a><span id="l11.4209" class="difflineminus">-      ++numInterpretSections;     // increment # of sections</span>
<a href="#l11.4210"></a><span id="l11.4210" class="difflineminus">-    }</span>
<a href="#l11.4211"></a><span id="l11.4211" class="difflineminus">-    line.Trim(&quot; \t&quot;);</span>
<a href="#l11.4212"></a><span id="l11.4212" class="difflineminus">-    PRInt32 len = line.Length();</span>
<a href="#l11.4213"></a><span id="l11.4213" class="difflineminus">-    if (len &gt; 0)</span>
<a href="#l11.4214"></a><span id="l11.4214" class="difflineminus">-    {</span>
<a href="#l11.4215"></a><span id="l11.4215" class="difflineminus">-      if (line[len-1] == PRUnichar('&gt;'))</span>
<a href="#l11.4216"></a><span id="l11.4216" class="difflineminus">-      {</span>
<a href="#l11.4217"></a><span id="l11.4217" class="difflineminus">-        inSection = PR_FALSE;</span>
<a href="#l11.4218"></a><span id="l11.4218" class="difflineminus">-        line.SetLength(len-1);</span>
<a href="#l11.4219"></a><span id="l11.4219" class="difflineminus">-      }</span>
<a href="#l11.4220"></a><span id="l11.4220" class="difflineminus">-    }</span>
<a href="#l11.4221"></a><span id="l11.4221" class="difflineminus">-  }</span>
<a href="#l11.4222"></a><span id="l11.4222" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.4223"></a><span id="l11.4223" class="difflineminus">-}</span>
<a href="#l11.4224"></a><span id="l11.4224" class="difflineminus">-</span>
<a href="#l11.4225"></a><span id="l11.4225" class="difflineminus">-</span>
<a href="#l11.4226"></a><span id="l11.4226" class="difflineminus">-nsresult</span>
<a href="#l11.4227"></a><span id="l11.4227" class="difflineminus">-InternetSearchDataSource::GetData(const PRUnichar *dataUni, const char *sectionToFind, PRUint32 sectionNum,</span>
<a href="#l11.4228"></a><span id="l11.4228" class="difflineminus">-          const char *attribToFind, nsString &amp;value)</span>
<a href="#l11.4229"></a><span id="l11.4229" class="difflineminus">-{</span>
<a href="#l11.4230"></a><span id="l11.4230" class="difflineminus">-  nsString  buffer(dataUni);</span>
<a href="#l11.4231"></a><span id="l11.4231" class="difflineminus">-</span>
<a href="#l11.4232"></a><span id="l11.4232" class="difflineminus">-  nsresult  rv = NS_RDF_NO_VALUE;</span>
<a href="#l11.4233"></a><span id="l11.4233" class="difflineminus">-  PRBool    inSection = PR_FALSE;</span>
<a href="#l11.4234"></a><span id="l11.4234" class="difflineminus">-</span>
<a href="#l11.4235"></a><span id="l11.4235" class="difflineminus">-  nsAutoString  section;</span>
<a href="#l11.4236"></a><span id="l11.4236" class="difflineminus">-  section.Assign(PRUnichar('&lt;'));</span>
<a href="#l11.4237"></a><span id="l11.4237" class="difflineminus">-  section.Append(NS_ConvertASCIItoUTF16(sectionToFind));</span>
<a href="#l11.4238"></a><span id="l11.4238" class="difflineminus">-</span>
<a href="#l11.4239"></a><span id="l11.4239" class="difflineminus">-  while(!buffer.IsEmpty())</span>
<a href="#l11.4240"></a><span id="l11.4240" class="difflineminus">-  {</span>
<a href="#l11.4241"></a><span id="l11.4241" class="difflineminus">-    PRInt32 eol = nsString_FindCharInSet(buffer, &quot;\r\n&quot;, 0);</span>
<a href="#l11.4242"></a><span id="l11.4242" class="difflineminus">-    if (eol &lt; 0)  break;</span>
<a href="#l11.4243"></a><span id="l11.4243" class="difflineminus">-    nsAutoString  line(StringHead(buffer, eol));</span>
<a href="#l11.4244"></a><span id="l11.4244" class="difflineminus">-    buffer.Cut(0, eol+1);</span>
<a href="#l11.4245"></a><span id="l11.4245" class="difflineminus">-    if (line.IsEmpty()) continue;   // skip empty lines</span>
<a href="#l11.4246"></a><span id="l11.4246" class="difflineminus">-    if (line[0] == PRUnichar('#'))  continue; // skip comments</span>
<a href="#l11.4247"></a><span id="l11.4247" class="difflineminus">-    line.Trim(&quot; \t&quot;);</span>
<a href="#l11.4248"></a><span id="l11.4248" class="difflineminus">-    if (!inSection)</span>
<a href="#l11.4249"></a><span id="l11.4249" class="difflineminus">-    {</span>
<a href="#l11.4250"></a><span id="l11.4250" class="difflineminus">-      PRInt32 sectionOffset = line.Find(section, CaseInsensitiveCompare);</span>
<a href="#l11.4251"></a><span id="l11.4251" class="difflineminus">-      if (sectionOffset &lt; 0)  continue;</span>
<a href="#l11.4252"></a><span id="l11.4252" class="difflineminus">-      if (sectionNum &gt; 0)</span>
<a href="#l11.4253"></a><span id="l11.4253" class="difflineminus">-      {</span>
<a href="#l11.4254"></a><span id="l11.4254" class="difflineminus">-        --sectionNum;</span>
<a href="#l11.4255"></a><span id="l11.4255" class="difflineminus">-        continue;</span>
<a href="#l11.4256"></a><span id="l11.4256" class="difflineminus">-      }</span>
<a href="#l11.4257"></a><span id="l11.4257" class="difflineminus">-      line.Cut(0, sectionOffset + section.Length() + 1);</span>
<a href="#l11.4258"></a><span id="l11.4258" class="difflineminus">-      inSection = PR_TRUE;</span>
<a href="#l11.4259"></a><span id="l11.4259" class="difflineminus">-    }</span>
<a href="#l11.4260"></a><span id="l11.4260" class="difflineminus">-    line.Trim(&quot; \t&quot;);</span>
<a href="#l11.4261"></a><span id="l11.4261" class="difflineminus">-    PRInt32 len = line.Length();</span>
<a href="#l11.4262"></a><span id="l11.4262" class="difflineminus">-    if (len &gt; 0)</span>
<a href="#l11.4263"></a><span id="l11.4263" class="difflineminus">-    {</span>
<a href="#l11.4264"></a><span id="l11.4264" class="difflineminus">-      if (line[len-1] == PRUnichar('&gt;'))</span>
<a href="#l11.4265"></a><span id="l11.4265" class="difflineminus">-      {</span>
<a href="#l11.4266"></a><span id="l11.4266" class="difflineminus">-        inSection = PR_FALSE;</span>
<a href="#l11.4267"></a><span id="l11.4267" class="difflineminus">-        line.SetLength(len-1);</span>
<a href="#l11.4268"></a><span id="l11.4268" class="difflineminus">-      }</span>
<a href="#l11.4269"></a><span id="l11.4269" class="difflineminus">-    }</span>
<a href="#l11.4270"></a><span id="l11.4270" class="difflineminus">-    PRInt32 equal = line.FindChar(PRUnichar('='));</span>
<a href="#l11.4271"></a><span id="l11.4271" class="difflineminus">-    if (equal &lt; 0)  continue;     // skip lines with no equality</span>
<a href="#l11.4272"></a><span id="l11.4272" class="difflineminus">-    </span>
<a href="#l11.4273"></a><span id="l11.4273" class="difflineminus">-    nsAutoString  attrib(StringHead(line, equal /* - 1 */));</span>
<a href="#l11.4274"></a><span id="l11.4274" class="difflineminus">-    attrib.Trim(&quot; \t&quot;);</span>
<a href="#l11.4275"></a><span id="l11.4275" class="difflineminus">-    if (attrib.Equals(NS_ConvertASCIItoUTF16(attribToFind), CaseInsensitiveCompare))</span>
<a href="#l11.4276"></a><span id="l11.4276" class="difflineminus">-    {</span>
<a href="#l11.4277"></a><span id="l11.4277" class="difflineminus">-      line.Cut(0, equal+1);</span>
<a href="#l11.4278"></a><span id="l11.4278" class="difflineminus">-      line.Trim(&quot; \t&quot;);</span>
<a href="#l11.4279"></a><span id="l11.4279" class="difflineminus">-      value = line;</span>
<a href="#l11.4280"></a><span id="l11.4280" class="difflineminus">-</span>
<a href="#l11.4281"></a><span id="l11.4281" class="difflineminus">-      // strip of any enclosing quotes and trailing comments</span>
<a href="#l11.4282"></a><span id="l11.4282" class="difflineminus">-      if ((value[0] == PRUnichar('\&quot;')) || (value[0] == PRUnichar('\'')))</span>
<a href="#l11.4283"></a><span id="l11.4283" class="difflineminus">-      {</span>
<a href="#l11.4284"></a><span id="l11.4284" class="difflineminus">-        PRUnichar quoteChar = value[0];</span>
<a href="#l11.4285"></a><span id="l11.4285" class="difflineminus">-        value.Cut(0,1);</span>
<a href="#l11.4286"></a><span id="l11.4286" class="difflineminus">-        if (!value.IsEmpty())</span>
<a href="#l11.4287"></a><span id="l11.4287" class="difflineminus">-        {</span>
<a href="#l11.4288"></a><span id="l11.4288" class="difflineminus">-          PRInt32 quoteEnd = value.FindChar(quoteChar);</span>
<a href="#l11.4289"></a><span id="l11.4289" class="difflineminus">-          if (quoteEnd &gt;= 0)</span>
<a href="#l11.4290"></a><span id="l11.4290" class="difflineminus">-          {</span>
<a href="#l11.4291"></a><span id="l11.4291" class="difflineminus">-            value.SetLength(quoteEnd);</span>
<a href="#l11.4292"></a><span id="l11.4292" class="difflineminus">-          }</span>
<a href="#l11.4293"></a><span id="l11.4293" class="difflineminus">-        }</span>
<a href="#l11.4294"></a><span id="l11.4294" class="difflineminus">-      }</span>
<a href="#l11.4295"></a><span id="l11.4295" class="difflineminus">-      else</span>
<a href="#l11.4296"></a><span id="l11.4296" class="difflineminus">-      {</span>
<a href="#l11.4297"></a><span id="l11.4297" class="difflineminus">-        PRInt32 commentOffset = nsString_FindCharInSet(value, &quot;# \t&quot;, 0);</span>
<a href="#l11.4298"></a><span id="l11.4298" class="difflineminus">-        if (commentOffset &gt;= 0)</span>
<a href="#l11.4299"></a><span id="l11.4299" class="difflineminus">-        {</span>
<a href="#l11.4300"></a><span id="l11.4300" class="difflineminus">-          value.SetLength(commentOffset);</span>
<a href="#l11.4301"></a><span id="l11.4301" class="difflineminus">-        }</span>
<a href="#l11.4302"></a><span id="l11.4302" class="difflineminus">-        value.Trim(&quot; \t&quot;);</span>
<a href="#l11.4303"></a><span id="l11.4303" class="difflineminus">-      }</span>
<a href="#l11.4304"></a><span id="l11.4304" class="difflineminus">-      rv = NS_OK;</span>
<a href="#l11.4305"></a><span id="l11.4305" class="difflineminus">-      break;</span>
<a href="#l11.4306"></a><span id="l11.4306" class="difflineminus">-    }</span>
<a href="#l11.4307"></a><span id="l11.4307" class="difflineminus">-  }</span>
<a href="#l11.4308"></a><span id="l11.4308" class="difflineminus">-  return(rv);</span>
<a href="#l11.4309"></a><span id="l11.4309" class="difflineminus">-}</span>
<a href="#l11.4310"></a><span id="l11.4310" class="difflineminus">-</span>
<a href="#l11.4311"></a><span id="l11.4311" class="difflineminus">-</span>
<a href="#l11.4312"></a><span id="l11.4312" class="difflineminus">-</span>
<a href="#l11.4313"></a><span id="l11.4313" class="difflineminus">-nsresult</span>
<a href="#l11.4314"></a><span id="l11.4314" class="difflineminus">-InternetSearchDataSource::GetInputs(const PRUnichar *dataUni, nsString &amp;engineName, nsString &amp;userVar,</span>
<a href="#l11.4315"></a><span id="l11.4315" class="difflineminus">-  const nsString &amp;text, nsString &amp;input, PRInt16 direction, PRUint16 pageNumber,  PRUint16 *whichButtons)</span>
<a href="#l11.4316"></a><span id="l11.4316" class="difflineminus">-{</span>
<a href="#l11.4317"></a><span id="l11.4317" class="difflineminus">-  nsString  buffer(dataUni);</span>
<a href="#l11.4318"></a><span id="l11.4318" class="difflineminus">-</span>
<a href="#l11.4319"></a><span id="l11.4319" class="difflineminus">-  nsresult  rv = NS_OK;</span>
<a href="#l11.4320"></a><span id="l11.4320" class="difflineminus">-  PRBool    inSection = PR_FALSE;</span>
<a href="#l11.4321"></a><span id="l11.4321" class="difflineminus">-  PRBool    inDirInput; // directional input: &quot;inputnext&quot; or &quot;inputprev&quot;</span>
<a href="#l11.4322"></a><span id="l11.4322" class="difflineminus">-  PRBool    foundInput = PR_FALSE;</span>
<a href="#l11.4323"></a><span id="l11.4323" class="difflineminus">-</span>
<a href="#l11.4324"></a><span id="l11.4324" class="difflineminus">-  while(!buffer.IsEmpty())</span>
<a href="#l11.4325"></a><span id="l11.4325" class="difflineminus">-  {</span>
<a href="#l11.4326"></a><span id="l11.4326" class="difflineminus">-    PRInt32 eol = nsString_FindCharInSet(buffer, &quot;\r\n&quot;, 0);</span>
<a href="#l11.4327"></a><span id="l11.4327" class="difflineminus">-    if (eol &lt; 0)  break;</span>
<a href="#l11.4328"></a><span id="l11.4328" class="difflineminus">-    nsAutoString  line(StringHead(buffer, eol));</span>
<a href="#l11.4329"></a><span id="l11.4329" class="difflineminus">-    buffer.Cut(0, eol+1);</span>
<a href="#l11.4330"></a><span id="l11.4330" class="difflineminus">-    if (line.IsEmpty()) continue;   // skip empty lines</span>
<a href="#l11.4331"></a><span id="l11.4331" class="difflineminus">-    if (line[0] == PRUnichar('#'))  continue; // skip comments</span>
<a href="#l11.4332"></a><span id="l11.4332" class="difflineminus">-    line.Trim(&quot; \t&quot;);</span>
<a href="#l11.4333"></a><span id="l11.4333" class="difflineminus">-    if (!inSection)</span>
<a href="#l11.4334"></a><span id="l11.4334" class="difflineminus">-    {</span>
<a href="#l11.4335"></a><span id="l11.4335" class="difflineminus">-      if (line[0] != PRUnichar('&lt;'))  continue;</span>
<a href="#l11.4336"></a><span id="l11.4336" class="difflineminus">-      line.Cut(0, 1);</span>
<a href="#l11.4337"></a><span id="l11.4337" class="difflineminus">-      inSection = PR_TRUE;</span>
<a href="#l11.4338"></a><span id="l11.4338" class="difflineminus">-    }</span>
<a href="#l11.4339"></a><span id="l11.4339" class="difflineminus">-    PRInt32 len = line.Length();</span>
<a href="#l11.4340"></a><span id="l11.4340" class="difflineminus">-    if (len &gt; 0)</span>
<a href="#l11.4341"></a><span id="l11.4341" class="difflineminus">-    {</span>
<a href="#l11.4342"></a><span id="l11.4342" class="difflineminus">-      if (line[len-1] == PRUnichar('&gt;'))</span>
<a href="#l11.4343"></a><span id="l11.4343" class="difflineminus">-      {</span>
<a href="#l11.4344"></a><span id="l11.4344" class="difflineminus">-        inSection = PR_FALSE;</span>
<a href="#l11.4345"></a><span id="l11.4345" class="difflineminus">-        line.SetLength(len-1);</span>
<a href="#l11.4346"></a><span id="l11.4346" class="difflineminus">-      }</span>
<a href="#l11.4347"></a><span id="l11.4347" class="difflineminus">-    }</span>
<a href="#l11.4348"></a><span id="l11.4348" class="difflineminus">-    if (inSection)</span>
<a href="#l11.4349"></a><span id="l11.4349" class="difflineminus">-      continue;</span>
<a href="#l11.4350"></a><span id="l11.4350" class="difflineminus">-</span>
<a href="#l11.4351"></a><span id="l11.4351" class="difflineminus">-    // look for inputs</span>
<a href="#l11.4352"></a><span id="l11.4352" class="difflineminus">-    if (line.Find(&quot;input&quot;, PR_TRUE) == 0)</span>
<a href="#l11.4353"></a><span id="l11.4353" class="difflineminus">-    {</span>
<a href="#l11.4354"></a><span id="l11.4354" class="difflineminus">-      line.Cut(0, 5);</span>
<a href="#l11.4355"></a><span id="l11.4355" class="difflineminus">-</span>
<a href="#l11.4356"></a><span id="l11.4356" class="difflineminus">-      // look for &quot;inputnext&quot; or &quot;inputprev&quot;</span>
<a href="#l11.4357"></a><span id="l11.4357" class="difflineminus">-      inDirInput = PR_FALSE;</span>
<a href="#l11.4358"></a><span id="l11.4358" class="difflineminus">-</span>
<a href="#l11.4359"></a><span id="l11.4359" class="difflineminus">-      if (line.Find(&quot;next&quot;, PR_TRUE) == 0)</span>
<a href="#l11.4360"></a><span id="l11.4360" class="difflineminus">-      {</span>
<a href="#l11.4361"></a><span id="l11.4361" class="difflineminus">-        inDirInput = PR_TRUE;</span>
<a href="#l11.4362"></a><span id="l11.4362" class="difflineminus">-        if (whichButtons)</span>
<a href="#l11.4363"></a><span id="l11.4363" class="difflineminus">-          *whichButtons |= kHaveNext;</span>
<a href="#l11.4364"></a><span id="l11.4364" class="difflineminus">-      }</span>
<a href="#l11.4365"></a><span id="l11.4365" class="difflineminus">-</span>
<a href="#l11.4366"></a><span id="l11.4366" class="difflineminus">-      if (line.Find(&quot;prev&quot;, PR_TRUE) == 0)</span>
<a href="#l11.4367"></a><span id="l11.4367" class="difflineminus">-      {</span>
<a href="#l11.4368"></a><span id="l11.4368" class="difflineminus">-        inDirInput = PR_TRUE;</span>
<a href="#l11.4369"></a><span id="l11.4369" class="difflineminus">-        if (whichButtons)</span>
<a href="#l11.4370"></a><span id="l11.4370" class="difflineminus">-          *whichButtons |= kHavePrev;</span>
<a href="#l11.4371"></a><span id="l11.4371" class="difflineminus">-      }</span>
<a href="#l11.4372"></a><span id="l11.4372" class="difflineminus">-</span>
<a href="#l11.4373"></a><span id="l11.4373" class="difflineminus">-      if (inDirInput)</span>
<a href="#l11.4374"></a><span id="l11.4374" class="difflineminus">-        line.Cut(0, 4);</span>
<a href="#l11.4375"></a><span id="l11.4375" class="difflineminus">-      </span>
<a href="#l11.4376"></a><span id="l11.4376" class="difflineminus">-      line.Trim(&quot; \t&quot;);</span>
<a href="#l11.4377"></a><span id="l11.4377" class="difflineminus">-      </span>
<a href="#l11.4378"></a><span id="l11.4378" class="difflineminus">-      // first look for name attribute</span>
<a href="#l11.4379"></a><span id="l11.4379" class="difflineminus">-      nsAutoString  nameAttrib;</span>
<a href="#l11.4380"></a><span id="l11.4380" class="difflineminus">-</span>
<a href="#l11.4381"></a><span id="l11.4381" class="difflineminus">-      PRInt32 nameOffset = line.Find(&quot;name&quot;, PR_TRUE);</span>
<a href="#l11.4382"></a><span id="l11.4382" class="difflineminus">-      if (nameOffset &gt;= 0)</span>
<a href="#l11.4383"></a><span id="l11.4383" class="difflineminus">-      {</span>
<a href="#l11.4384"></a><span id="l11.4384" class="difflineminus">-        PRInt32 equal = line.FindChar(PRUnichar('='), nameOffset);</span>
<a href="#l11.4385"></a><span id="l11.4385" class="difflineminus">-        if (equal &gt;= 0)</span>
<a href="#l11.4386"></a><span id="l11.4386" class="difflineminus">-        {</span>
<a href="#l11.4387"></a><span id="l11.4387" class="difflineminus">-          PRInt32 startQuote = line.FindChar(PRUnichar('\&quot;'), equal + 1);</span>
<a href="#l11.4388"></a><span id="l11.4388" class="difflineminus">-          if (startQuote &gt;= 0)</span>
<a href="#l11.4389"></a><span id="l11.4389" class="difflineminus">-          {</span>
<a href="#l11.4390"></a><span id="l11.4390" class="difflineminus">-            PRInt32 endQuote = line.FindChar(PRUnichar('\&quot;'), startQuote + 1);</span>
<a href="#l11.4391"></a><span id="l11.4391" class="difflineminus">-            if (endQuote &gt; 0)</span>
<a href="#l11.4392"></a><span id="l11.4392" class="difflineminus">-            {</span>
<a href="#l11.4393"></a><span id="l11.4393" class="difflineminus">-              nameAttrib = Substring(line,</span>
<a href="#l11.4394"></a><span id="l11.4394" class="difflineminus">-                                     startQuote + 1,</span>
<a href="#l11.4395"></a><span id="l11.4395" class="difflineminus">-                                     endQuote - startQuote - 1);</span>
<a href="#l11.4396"></a><span id="l11.4396" class="difflineminus">-              line.Cut(0, endQuote + 1);</span>
<a href="#l11.4397"></a><span id="l11.4397" class="difflineminus">-            }</span>
<a href="#l11.4398"></a><span id="l11.4398" class="difflineminus">-          }</span>
<a href="#l11.4399"></a><span id="l11.4399" class="difflineminus">-          else</span>
<a href="#l11.4400"></a><span id="l11.4400" class="difflineminus">-          {</span>
<a href="#l11.4401"></a><span id="l11.4401" class="difflineminus">-            nameAttrib = line;</span>
<a href="#l11.4402"></a><span id="l11.4402" class="difflineminus">-            nameAttrib.Cut(0, equal+1);</span>
<a href="#l11.4403"></a><span id="l11.4403" class="difflineminus">-            nameAttrib.Trim(&quot; \t&quot;);</span>
<a href="#l11.4404"></a><span id="l11.4404" class="difflineminus">-            PRInt32 space = nsString_FindCharInSet(nameAttrib, &quot; \t&quot;, 0);</span>
<a href="#l11.4405"></a><span id="l11.4405" class="difflineminus">-            if (space &gt; 0)</span>
<a href="#l11.4406"></a><span id="l11.4406" class="difflineminus">-            {</span>
<a href="#l11.4407"></a><span id="l11.4407" class="difflineminus">-              nameAttrib.SetLength(space);</span>
<a href="#l11.4408"></a><span id="l11.4408" class="difflineminus">-              line.Cut(0, equal+1+space);</span>
<a href="#l11.4409"></a><span id="l11.4409" class="difflineminus">-            }</span>
<a href="#l11.4410"></a><span id="l11.4410" class="difflineminus">-            else</span>
<a href="#l11.4411"></a><span id="l11.4411" class="difflineminus">-            {</span>
<a href="#l11.4412"></a><span id="l11.4412" class="difflineminus">-              line.Truncate();</span>
<a href="#l11.4413"></a><span id="l11.4413" class="difflineminus">-            }</span>
<a href="#l11.4414"></a><span id="l11.4414" class="difflineminus">-          }</span>
<a href="#l11.4415"></a><span id="l11.4415" class="difflineminus">-        }</span>
<a href="#l11.4416"></a><span id="l11.4416" class="difflineminus">-      }</span>
<a href="#l11.4417"></a><span id="l11.4417" class="difflineminus">-      if (foundInput &amp;&amp; nameAttrib.IsEmpty()) </span>
<a href="#l11.4418"></a><span id="l11.4418" class="difflineminus">-        continue;</span>
<a href="#l11.4419"></a><span id="l11.4419" class="difflineminus">-</span>
<a href="#l11.4420"></a><span id="l11.4420" class="difflineminus">-      // first look for value attribute</span>
<a href="#l11.4421"></a><span id="l11.4421" class="difflineminus">-      nsAutoString  valueAttrib;</span>
<a href="#l11.4422"></a><span id="l11.4422" class="difflineminus">-</span>
<a href="#l11.4423"></a><span id="l11.4423" class="difflineminus">-      PRInt32  valueOffset;</span>
<a href="#l11.4424"></a><span id="l11.4424" class="difflineminus">-      if (!inDirInput)</span>
<a href="#l11.4425"></a><span id="l11.4425" class="difflineminus">-        valueOffset = line.Find(&quot;value&quot;, PR_TRUE);</span>
<a href="#l11.4426"></a><span id="l11.4426" class="difflineminus">-      else</span>
<a href="#l11.4427"></a><span id="l11.4427" class="difflineminus">-        valueOffset = line.Find(&quot;factor&quot;, PR_TRUE);</span>
<a href="#l11.4428"></a><span id="l11.4428" class="difflineminus">-      if (valueOffset &gt;= 0)</span>
<a href="#l11.4429"></a><span id="l11.4429" class="difflineminus">-      {</span>
<a href="#l11.4430"></a><span id="l11.4430" class="difflineminus">-        PRInt32 equal = line.FindChar(PRUnichar('='), valueOffset);</span>
<a href="#l11.4431"></a><span id="l11.4431" class="difflineminus">-        if (equal &gt;= 0)</span>
<a href="#l11.4432"></a><span id="l11.4432" class="difflineminus">-        {</span>
<a href="#l11.4433"></a><span id="l11.4433" class="difflineminus">-          PRInt32 startQuote = line.FindChar(PRUnichar('\&quot;'), equal + 1);</span>
<a href="#l11.4434"></a><span id="l11.4434" class="difflineminus">-          if (startQuote &gt;= 0)</span>
<a href="#l11.4435"></a><span id="l11.4435" class="difflineminus">-          {</span>
<a href="#l11.4436"></a><span id="l11.4436" class="difflineminus">-            PRInt32 endQuote = line.FindChar(PRUnichar('\&quot;'), startQuote + 1);</span>
<a href="#l11.4437"></a><span id="l11.4437" class="difflineminus">-            if (endQuote &gt;= 0)</span>
<a href="#l11.4438"></a><span id="l11.4438" class="difflineminus">-            {</span>
<a href="#l11.4439"></a><span id="l11.4439" class="difflineminus">-              valueAttrib = Substring(line,</span>
<a href="#l11.4440"></a><span id="l11.4440" class="difflineminus">-                                      startQuote + 1,</span>
<a href="#l11.4441"></a><span id="l11.4441" class="difflineminus">-                                      endQuote - startQuote - 1);</span>
<a href="#l11.4442"></a><span id="l11.4442" class="difflineminus">-            }</span>
<a href="#l11.4443"></a><span id="l11.4443" class="difflineminus">-          }</span>
<a href="#l11.4444"></a><span id="l11.4444" class="difflineminus">-          else</span>
<a href="#l11.4445"></a><span id="l11.4445" class="difflineminus">-          {</span>
<a href="#l11.4446"></a><span id="l11.4446" class="difflineminus">-            // if value attribute's &quot;value&quot; isn't quoted, get the first word... ?</span>
<a href="#l11.4447"></a><span id="l11.4447" class="difflineminus">-            valueAttrib = line;</span>
<a href="#l11.4448"></a><span id="l11.4448" class="difflineminus">-            valueAttrib.Cut(0, equal+1);</span>
<a href="#l11.4449"></a><span id="l11.4449" class="difflineminus">-            valueAttrib.Trim(&quot; \t&quot;);</span>
<a href="#l11.4450"></a><span id="l11.4450" class="difflineminus">-            PRInt32 space = nsString_FindCharInSet(valueAttrib, &quot; \t&gt;&quot;, 0);</span>
<a href="#l11.4451"></a><span id="l11.4451" class="difflineminus">-            if (space &gt; 0)</span>
<a href="#l11.4452"></a><span id="l11.4452" class="difflineminus">-            {</span>
<a href="#l11.4453"></a><span id="l11.4453" class="difflineminus">-              valueAttrib.SetLength(space);</span>
<a href="#l11.4454"></a><span id="l11.4454" class="difflineminus">-            }</span>
<a href="#l11.4455"></a><span id="l11.4455" class="difflineminus">-          }</span>
<a href="#l11.4456"></a><span id="l11.4456" class="difflineminus">-        }</span>
<a href="#l11.4457"></a><span id="l11.4457" class="difflineminus">-      }</span>
<a href="#l11.4458"></a><span id="l11.4458" class="difflineminus">-      else if (line.Find(&quot;user&quot;, PR_TRUE) &gt;= 0)</span>
<a href="#l11.4459"></a><span id="l11.4459" class="difflineminus">-      {</span>
<a href="#l11.4460"></a><span id="l11.4460" class="difflineminus">-        userVar = nameAttrib;</span>
<a href="#l11.4461"></a><span id="l11.4461" class="difflineminus">-        valueAttrib.Assign(text);</span>
<a href="#l11.4462"></a><span id="l11.4462" class="difflineminus">-      }</span>
<a href="#l11.4463"></a><span id="l11.4463" class="difflineminus">-      </span>
<a href="#l11.4464"></a><span id="l11.4464" class="difflineminus">-      // XXX should ignore if  mode=browser  is specified</span>
<a href="#l11.4465"></a><span id="l11.4465" class="difflineminus">-      // XXX need to do this better</span>
<a href="#l11.4466"></a><span id="l11.4466" class="difflineminus">-      if (line.Find(&quot;mode=browser&quot;, PR_TRUE) &gt;= 0)</span>
<a href="#l11.4467"></a><span id="l11.4467" class="difflineminus">-        continue;</span>
<a href="#l11.4468"></a><span id="l11.4468" class="difflineminus">-</span>
<a href="#l11.4469"></a><span id="l11.4469" class="difflineminus">-      if (!valueAttrib.IsEmpty())</span>
<a href="#l11.4470"></a><span id="l11.4470" class="difflineminus">-      {</span>
<a href="#l11.4471"></a><span id="l11.4471" class="difflineminus">-        // Here's how we construct the input string:</span>
<a href="#l11.4472"></a><span id="l11.4472" class="difflineminus">-        // &lt;input&gt; is first: Name Attr: Prefix      Data           Example:</span>
<a href="#l11.4473"></a><span id="l11.4473" class="difflineminus">-        // YES               EMPTY      None        &lt;value&gt;        ACTION&lt;value&gt;</span>
<a href="#l11.4474"></a><span id="l11.4474" class="difflineminus">-        // YES               NON-EMPTY  ?           &lt;name&gt;=&lt;value&gt; ACTION?&lt;name&gt;=&lt;value&gt;</span>
<a href="#l11.4475"></a><span id="l11.4475" class="difflineminus">-        // NO                EMPTY      ----------- &lt;ignored&gt; -------------</span>
<a href="#l11.4476"></a><span id="l11.4476" class="difflineminus">-        // NO                NON-EMPTY  &amp;           &lt;name&gt;=&lt;value&gt; ACTION?&lt;n1&gt;=&lt;v1&gt;&amp;&lt;n2&gt;=&lt;v2&gt;</span>
<a href="#l11.4477"></a><span id="l11.4477" class="difflineminus">-        if (!input.IsEmpty())</span>
<a href="#l11.4478"></a><span id="l11.4478" class="difflineminus">-          input.AppendLiteral(&quot;&amp;&quot;);</span>
<a href="#l11.4479"></a><span id="l11.4479" class="difflineminus">-        else if (!nameAttrib.IsEmpty()) </span>
<a href="#l11.4480"></a><span id="l11.4480" class="difflineminus">-          input.AppendLiteral(&quot;?&quot;);</span>
<a href="#l11.4481"></a><span id="l11.4481" class="difflineminus">-</span>
<a href="#l11.4482"></a><span id="l11.4482" class="difflineminus">-        if (!nameAttrib.IsEmpty()) </span>
<a href="#l11.4483"></a><span id="l11.4483" class="difflineminus">-        {</span>
<a href="#l11.4484"></a><span id="l11.4484" class="difflineminus">-          input += nameAttrib;</span>
<a href="#l11.4485"></a><span id="l11.4485" class="difflineminus">-          input.AppendLiteral(&quot;=&quot;);</span>
<a href="#l11.4486"></a><span id="l11.4486" class="difflineminus">-        }</span>
<a href="#l11.4487"></a><span id="l11.4487" class="difflineminus">-</span>
<a href="#l11.4488"></a><span id="l11.4488" class="difflineminus">-        // Indicate that we've already found an input, so we cannot have any </span>
<a href="#l11.4489"></a><span id="l11.4489" class="difflineminus">-        // inputs after this that do not have names. I could be more sophisticated</span>
<a href="#l11.4490"></a><span id="l11.4490" class="difflineminus">-        // than this but I don't care right now since I'm only doing this for one</span>
<a href="#l11.4491"></a><span id="l11.4491" class="difflineminus">-        // plugin. --ben</span>
<a href="#l11.4492"></a><span id="l11.4492" class="difflineminus">-        foundInput = PR_TRUE;</span>
<a href="#l11.4493"></a><span id="l11.4493" class="difflineminus">-</span>
<a href="#l11.4494"></a><span id="l11.4494" class="difflineminus">-        if (!inDirInput)</span>
<a href="#l11.4495"></a><span id="l11.4495" class="difflineminus">-          input += valueAttrib;</span>
<a href="#l11.4496"></a><span id="l11.4496" class="difflineminus">-        else</span>
<a href="#l11.4497"></a><span id="l11.4497" class="difflineminus">-          input.AppendInt( computeIndex(valueAttrib, pageNumber, direction) );</span>
<a href="#l11.4498"></a><span id="l11.4498" class="difflineminus">-      }</span>
<a href="#l11.4499"></a><span id="l11.4499" class="difflineminus">-    }</span>
<a href="#l11.4500"></a><span id="l11.4500" class="difflineminus">-  }</span>
<a href="#l11.4501"></a><span id="l11.4501" class="difflineminus">-</span>
<a href="#l11.4502"></a><span id="l11.4502" class="difflineminus">-  // Now add the default vs. non-default parameters, which come from </span>
<a href="#l11.4503"></a><span id="l11.4503" class="difflineminus">-  // preferences and are part of the pre-configuration.</span>
<a href="#l11.4504"></a><span id="l11.4504" class="difflineminus">-  nsCOMPtr&lt;nsIPrefService&gt; pserv(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l11.4505"></a><span id="l11.4505" class="difflineminus">-  if (pserv) </span>
<a href="#l11.4506"></a><span id="l11.4506" class="difflineminus">-  {</span>
<a href="#l11.4507"></a><span id="l11.4507" class="difflineminus">-    // If the pref &quot;browser.search.defaultenginename&quot; has a user value, that</span>
<a href="#l11.4508"></a><span id="l11.4508" class="difflineminus">-    // means the user has changed the engine in the list. This implies that</span>
<a href="#l11.4509"></a><span id="l11.4509" class="difflineminus">-    // the selected engine was _not_ configured as the default by the </span>
<a href="#l11.4510"></a><span id="l11.4510" class="difflineminus">-    // distributor, because if the value of the pref matched, prefHasUserValue</span>
<a href="#l11.4511"></a><span id="l11.4511" class="difflineminus">-    // would return false. </span>
<a href="#l11.4512"></a><span id="l11.4512" class="difflineminus">-    PRBool engineIsNotDefault = PR_FALSE;</span>
<a href="#l11.4513"></a><span id="l11.4513" class="difflineminus">-    nsCOMPtr&lt;nsIPrefBranch&gt; rootBranch(do_QueryInterface(pserv));</span>
<a href="#l11.4514"></a><span id="l11.4514" class="difflineminus">-    nsCOMPtr&lt;nsIPrefBranch&gt; defaultBranch;</span>
<a href="#l11.4515"></a><span id="l11.4515" class="difflineminus">-    pserv-&gt;GetDefaultBranch(&quot;&quot;, getter_AddRefs(defaultBranch));</span>
<a href="#l11.4516"></a><span id="l11.4516" class="difflineminus">-</span>
<a href="#l11.4517"></a><span id="l11.4517" class="difflineminus">-    if (defaultBranch) </span>
<a href="#l11.4518"></a><span id="l11.4518" class="difflineminus">-    {</span>
<a href="#l11.4519"></a><span id="l11.4519" class="difflineminus">-      nsString defaultEngineNameStr;</span>
<a href="#l11.4520"></a><span id="l11.4520" class="difflineminus">-      nsCOMPtr&lt;nsIPrefLocalizedString&gt; defaultEngineName;</span>
<a href="#l11.4521"></a><span id="l11.4521" class="difflineminus">-      rv = defaultBranch-&gt;GetComplexValue(&quot;browser.search.defaultenginename&quot;, </span>
<a href="#l11.4522"></a><span id="l11.4522" class="difflineminus">-                                          NS_GET_IID(nsIPrefLocalizedString),</span>
<a href="#l11.4523"></a><span id="l11.4523" class="difflineminus">-                                          getter_AddRefs(defaultEngineName));</span>
<a href="#l11.4524"></a><span id="l11.4524" class="difflineminus">-      if (NS_SUCCEEDED(rv)) {</span>
<a href="#l11.4525"></a><span id="l11.4525" class="difflineminus">-        defaultEngineName-&gt;GetData(getter_Copies(defaultEngineNameStr));</span>
<a href="#l11.4526"></a><span id="l11.4526" class="difflineminus">-</span>
<a href="#l11.4527"></a><span id="l11.4527" class="difflineminus">-        nsString selectedEngineNameStr;</span>
<a href="#l11.4528"></a><span id="l11.4528" class="difflineminus">-        nsCOMPtr&lt;nsIPrefLocalizedString&gt; selectedEngineName;</span>
<a href="#l11.4529"></a><span id="l11.4529" class="difflineminus">-        rv = rootBranch-&gt;GetComplexValue(&quot;browser.search.selectedEngine&quot;, </span>
<a href="#l11.4530"></a><span id="l11.4530" class="difflineminus">-                                         NS_GET_IID(nsIPrefLocalizedString),</span>
<a href="#l11.4531"></a><span id="l11.4531" class="difflineminus">-                                         getter_AddRefs(selectedEngineName));</span>
<a href="#l11.4532"></a><span id="l11.4532" class="difflineminus">-        if (NS_SUCCEEDED(rv) &amp;&amp; selectedEngineName) {</span>
<a href="#l11.4533"></a><span id="l11.4533" class="difflineminus">-          selectedEngineName-&gt;GetData(getter_Copies(selectedEngineNameStr));</span>
<a href="#l11.4534"></a><span id="l11.4534" class="difflineminus">-          engineIsNotDefault = !defaultEngineNameStr.Equals(selectedEngineNameStr);</span>
<a href="#l11.4535"></a><span id="l11.4535" class="difflineminus">-        }</span>
<a href="#l11.4536"></a><span id="l11.4536" class="difflineminus">-        else {</span>
<a href="#l11.4537"></a><span id="l11.4537" class="difflineminus">-          engineIsNotDefault = PR_FALSE; // The selected engine *is* the default</span>
<a href="#l11.4538"></a><span id="l11.4538" class="difflineminus">-                                         // since the user has not changed the</span>
<a href="#l11.4539"></a><span id="l11.4539" class="difflineminus">-                                         // selected item in the list causing</span>
<a href="#l11.4540"></a><span id="l11.4540" class="difflineminus">-                                         // the selectedEngine pref to be set.</span>
<a href="#l11.4541"></a><span id="l11.4541" class="difflineminus">-        }</span>
<a href="#l11.4542"></a><span id="l11.4542" class="difflineminus">-      }</span>
<a href="#l11.4543"></a><span id="l11.4543" class="difflineminus">-    }</span>
<a href="#l11.4544"></a><span id="l11.4544" class="difflineminus">-</span>
<a href="#l11.4545"></a><span id="l11.4545" class="difflineminus">-    PRInt32 i = 0;</span>
<a href="#l11.4546"></a><span id="l11.4546" class="difflineminus">-    char prefNameBuf[1096];</span>
<a href="#l11.4547"></a><span id="l11.4547" class="difflineminus">-    do</span>
<a href="#l11.4548"></a><span id="l11.4548" class="difflineminus">-    {</span>
<a href="#l11.4549"></a><span id="l11.4549" class="difflineminus">-      ++i;</span>
<a href="#l11.4550"></a><span id="l11.4550" class="difflineminus">-      sprintf(prefNameBuf, &quot;browser.search.param.%s.%d.&quot;, </span>
<a href="#l11.4551"></a><span id="l11.4551" class="difflineminus">-              NS_ConvertUTF16toUTF8(engineName).get(), i);</span>
<a href="#l11.4552"></a><span id="l11.4552" class="difflineminus">-</span>
<a href="#l11.4553"></a><span id="l11.4553" class="difflineminus">-      nsCOMPtr&lt;nsIPrefBranch&gt; pb;</span>
<a href="#l11.4554"></a><span id="l11.4554" class="difflineminus">-      rv = pserv-&gt;GetBranch(prefNameBuf, getter_AddRefs(pb));</span>
<a href="#l11.4555"></a><span id="l11.4555" class="difflineminus">-      if (NS_FAILED(rv)) </span>
<a href="#l11.4556"></a><span id="l11.4556" class="difflineminus">-        break;</span>
<a href="#l11.4557"></a><span id="l11.4557" class="difflineminus">-</span>
<a href="#l11.4558"></a><span id="l11.4558" class="difflineminus">-      nsCOMPtr&lt;nsIPrefLocalizedString&gt; parameter;</span>
<a href="#l11.4559"></a><span id="l11.4559" class="difflineminus">-      nsString parameterStr;</span>
<a href="#l11.4560"></a><span id="l11.4560" class="difflineminus">-      rv = pb-&gt;GetComplexValue(engineIsNotDefault ? &quot;custom&quot; : &quot;default&quot;, </span>
<a href="#l11.4561"></a><span id="l11.4561" class="difflineminus">-                               NS_GET_IID(nsIPrefLocalizedString), </span>
<a href="#l11.4562"></a><span id="l11.4562" class="difflineminus">-                               getter_AddRefs(parameter));</span>
<a href="#l11.4563"></a><span id="l11.4563" class="difflineminus">-      if (NS_FAILED(rv))</span>
<a href="#l11.4564"></a><span id="l11.4564" class="difflineminus">-        break;</span>
<a href="#l11.4565"></a><span id="l11.4565" class="difflineminus">-</span>
<a href="#l11.4566"></a><span id="l11.4566" class="difflineminus">-      parameter-&gt;GetData(getter_Copies(parameterStr));</span>
<a href="#l11.4567"></a><span id="l11.4567" class="difflineminus">-      </span>
<a href="#l11.4568"></a><span id="l11.4568" class="difflineminus">-      if (!parameterStr.IsEmpty()) </span>
<a href="#l11.4569"></a><span id="l11.4569" class="difflineminus">-      {</span>
<a href="#l11.4570"></a><span id="l11.4570" class="difflineminus">-        if (!input.IsEmpty())</span>
<a href="#l11.4571"></a><span id="l11.4571" class="difflineminus">-          input.Append(NS_LITERAL_STRING(&quot;&amp;&quot;));</span>
<a href="#l11.4572"></a><span id="l11.4572" class="difflineminus">-        input += parameterStr;</span>
<a href="#l11.4573"></a><span id="l11.4573" class="difflineminus">-      }</span>
<a href="#l11.4574"></a><span id="l11.4574" class="difflineminus">-    }</span>
<a href="#l11.4575"></a><span id="l11.4575" class="difflineminus">-    while (1);</span>
<a href="#l11.4576"></a><span id="l11.4576" class="difflineminus">-</span>
<a href="#l11.4577"></a><span id="l11.4577" class="difflineminus">-    // Now add the release identifier</span>
<a href="#l11.4578"></a><span id="l11.4578" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundleService&gt; stringService(do_GetService(NS_STRINGBUNDLE_CONTRACTID));</span>
<a href="#l11.4579"></a><span id="l11.4579" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l11.4580"></a><span id="l11.4580" class="difflineminus">-    rv = stringService-&gt;CreateBundle(SEARCHCONFIG_PROPERTIES, getter_AddRefs(bundle));</span>
<a href="#l11.4581"></a><span id="l11.4581" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundle&gt; intlBundle;</span>
<a href="#l11.4582"></a><span id="l11.4582" class="difflineminus">-    rv = stringService-&gt;CreateBundle(INTL_PROPERTIES, getter_AddRefs(intlBundle));</span>
<a href="#l11.4583"></a><span id="l11.4583" class="difflineminus">-</span>
<a href="#l11.4584"></a><span id="l11.4584" class="difflineminus">-    nsString langName;</span>
<a href="#l11.4585"></a><span id="l11.4585" class="difflineminus">-    intlBundle-&gt;GetStringFromName(NS_LITERAL_STRING(&quot;general.useragent.locale&quot;).get(), </span>
<a href="#l11.4586"></a><span id="l11.4586" class="difflineminus">-                                  getter_Copies(langName));</span>
<a href="#l11.4587"></a><span id="l11.4587" class="difflineminus">-</span>
<a href="#l11.4588"></a><span id="l11.4588" class="difflineminus">-    nsAutoString keyTemplate(NS_LITERAL_STRING(&quot;browser.search.param.&quot;));</span>
<a href="#l11.4589"></a><span id="l11.4589" class="difflineminus">-    keyTemplate += engineName;</span>
<a href="#l11.4590"></a><span id="l11.4590" class="difflineminus">-    keyTemplate.Append(NS_LITERAL_STRING(&quot;.release&quot;));</span>
<a href="#l11.4591"></a><span id="l11.4591" class="difflineminus">-</span>
<a href="#l11.4592"></a><span id="l11.4592" class="difflineminus">-    nsString releaseValue;</span>
<a href="#l11.4593"></a><span id="l11.4593" class="difflineminus">-    NS_NAMED_LITERAL_STRING(distributionID, MOZ_DISTRIBUTION_ID);</span>
<a href="#l11.4594"></a><span id="l11.4594" class="difflineminus">-    const PRUnichar* strings[] = { distributionID.get(), langName.get() };</span>
<a href="#l11.4595"></a><span id="l11.4595" class="difflineminus">-    bundle-&gt;FormatStringFromName(keyTemplate.get(), strings, 2, getter_Copies(releaseValue));</span>
<a href="#l11.4596"></a><span id="l11.4596" class="difflineminus">-</span>
<a href="#l11.4597"></a><span id="l11.4597" class="difflineminus">-    if (!releaseValue.IsEmpty()) </span>
<a href="#l11.4598"></a><span id="l11.4598" class="difflineminus">-    {</span>
<a href="#l11.4599"></a><span id="l11.4599" class="difflineminus">-      if (!input.IsEmpty())</span>
<a href="#l11.4600"></a><span id="l11.4600" class="difflineminus">-        input.Append(NS_LITERAL_STRING(&quot;&amp;&quot;));</span>
<a href="#l11.4601"></a><span id="l11.4601" class="difflineminus">-      input += releaseValue;</span>
<a href="#l11.4602"></a><span id="l11.4602" class="difflineminus">-    }</span>
<a href="#l11.4603"></a><span id="l11.4603" class="difflineminus">-</span>
<a href="#l11.4604"></a><span id="l11.4604" class="difflineminus">-    // Now add order parameters.</span>
<a href="#l11.4605"></a><span id="l11.4605" class="difflineminus">-    nsCOMPtr&lt;nsIPrefBranch&gt; pb;</span>
<a href="#l11.4606"></a><span id="l11.4606" class="difflineminus">-    rv = pserv-&gt;GetBranch(&quot;&quot;, getter_AddRefs(pb));</span>
<a href="#l11.4607"></a><span id="l11.4607" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.4608"></a><span id="l11.4608" class="difflineminus">-</span>
<a href="#l11.4609"></a><span id="l11.4609" class="difflineminus">-    i = 0;</span>
<a href="#l11.4610"></a><span id="l11.4610" class="difflineminus">-    do {</span>
<a href="#l11.4611"></a><span id="l11.4611" class="difflineminus">-      ++i;</span>
<a href="#l11.4612"></a><span id="l11.4612" class="difflineminus">-      sprintf(prefNameBuf, &quot;browser.search.order.%d&quot;, i);</span>
<a href="#l11.4613"></a><span id="l11.4613" class="difflineminus">-</span>
<a href="#l11.4614"></a><span id="l11.4614" class="difflineminus">-      nsCOMPtr&lt;nsIPrefLocalizedString&gt; orderEngineName;</span>
<a href="#l11.4615"></a><span id="l11.4615" class="difflineminus">-      rv = pb-&gt;GetComplexValue(prefNameBuf, </span>
<a href="#l11.4616"></a><span id="l11.4616" class="difflineminus">-                               NS_GET_IID(nsIPrefLocalizedString),</span>
<a href="#l11.4617"></a><span id="l11.4617" class="difflineminus">-                               getter_AddRefs(orderEngineName));</span>
<a href="#l11.4618"></a><span id="l11.4618" class="difflineminus">-      if (NS_FAILED(rv)) </span>
<a href="#l11.4619"></a><span id="l11.4619" class="difflineminus">-        break;</span>
<a href="#l11.4620"></a><span id="l11.4620" class="difflineminus">-</span>
<a href="#l11.4621"></a><span id="l11.4621" class="difflineminus">-      nsString orderEngineNameStr;</span>
<a href="#l11.4622"></a><span id="l11.4622" class="difflineminus">-      orderEngineName-&gt;GetData(getter_Copies(orderEngineNameStr));</span>
<a href="#l11.4623"></a><span id="l11.4623" class="difflineminus">-      if (orderEngineNameStr.Equals(engineName))</span>
<a href="#l11.4624"></a><span id="l11.4624" class="difflineminus">-        break;</span>
<a href="#l11.4625"></a><span id="l11.4625" class="difflineminus">-    }</span>
<a href="#l11.4626"></a><span id="l11.4626" class="difflineminus">-    while (PR_TRUE);</span>
<a href="#l11.4627"></a><span id="l11.4627" class="difflineminus">-</span>
<a href="#l11.4628"></a><span id="l11.4628" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l11.4629"></a><span id="l11.4629" class="difflineminus">-    {</span>
<a href="#l11.4630"></a><span id="l11.4630" class="difflineminus">-      sprintf(prefNameBuf, &quot;browser.search.order.%s.%d&quot;,</span>
<a href="#l11.4631"></a><span id="l11.4631" class="difflineminus">-              NS_ConvertUTF16toUTF8(engineName).get(), i);</span>
<a href="#l11.4632"></a><span id="l11.4632" class="difflineminus">-      </span>
<a href="#l11.4633"></a><span id="l11.4633" class="difflineminus">-      nsCOMPtr&lt;nsIPrefLocalizedString&gt; orderParam;</span>
<a href="#l11.4634"></a><span id="l11.4634" class="difflineminus">-      rv = rootBranch-&gt;GetComplexValue(prefNameBuf, </span>
<a href="#l11.4635"></a><span id="l11.4635" class="difflineminus">-                                       NS_GET_IID(nsIPrefLocalizedString),</span>
<a href="#l11.4636"></a><span id="l11.4636" class="difflineminus">-                                       getter_AddRefs(orderParam));</span>
<a href="#l11.4637"></a><span id="l11.4637" class="difflineminus">-      if (NS_FAILED(rv))</span>
<a href="#l11.4638"></a><span id="l11.4638" class="difflineminus">-      {</span>
<a href="#l11.4639"></a><span id="l11.4639" class="difflineminus">-        sprintf(prefNameBuf, &quot;browser.search.order.%s&quot;,</span>
<a href="#l11.4640"></a><span id="l11.4640" class="difflineminus">-                NS_ConvertUTF16toUTF8(engineName).get());</span>
<a href="#l11.4641"></a><span id="l11.4641" class="difflineminus">-        rv = rootBranch-&gt;GetComplexValue(prefNameBuf, </span>
<a href="#l11.4642"></a><span id="l11.4642" class="difflineminus">-                                         NS_GET_IID(nsIPrefLocalizedString),</span>
<a href="#l11.4643"></a><span id="l11.4643" class="difflineminus">-                                         getter_AddRefs(orderParam));</span>
<a href="#l11.4644"></a><span id="l11.4644" class="difflineminus">-      }</span>
<a href="#l11.4645"></a><span id="l11.4645" class="difflineminus">-    </span>
<a href="#l11.4646"></a><span id="l11.4646" class="difflineminus">-      if (NS_SUCCEEDED(rv)) </span>
<a href="#l11.4647"></a><span id="l11.4647" class="difflineminus">-      {</span>
<a href="#l11.4648"></a><span id="l11.4648" class="difflineminus">-        nsString orderParamStr;</span>
<a href="#l11.4649"></a><span id="l11.4649" class="difflineminus">-        orderParam-&gt;GetData(getter_Copies(orderParamStr));</span>
<a href="#l11.4650"></a><span id="l11.4650" class="difflineminus">-</span>
<a href="#l11.4651"></a><span id="l11.4651" class="difflineminus">-        if (!orderParamStr.IsEmpty())</span>
<a href="#l11.4652"></a><span id="l11.4652" class="difflineminus">-        {</span>
<a href="#l11.4653"></a><span id="l11.4653" class="difflineminus">-          if (!input.IsEmpty())</span>
<a href="#l11.4654"></a><span id="l11.4654" class="difflineminus">-            input.Append(NS_LITERAL_STRING(&quot;&amp;&quot;));</span>
<a href="#l11.4655"></a><span id="l11.4655" class="difflineminus">-          input += orderParamStr;</span>
<a href="#l11.4656"></a><span id="l11.4656" class="difflineminus">-        }</span>
<a href="#l11.4657"></a><span id="l11.4657" class="difflineminus">-      }</span>
<a href="#l11.4658"></a><span id="l11.4658" class="difflineminus">-    }</span>
<a href="#l11.4659"></a><span id="l11.4659" class="difflineminus">-</span>
<a href="#l11.4660"></a><span id="l11.4660" class="difflineminus">-    rv = NS_OK;</span>
<a href="#l11.4661"></a><span id="l11.4661" class="difflineminus">-  }</span>
<a href="#l11.4662"></a><span id="l11.4662" class="difflineminus">-</span>
<a href="#l11.4663"></a><span id="l11.4663" class="difflineminus">-  return(rv);</span>
<a href="#l11.4664"></a><span id="l11.4664" class="difflineminus">-}</span>
<a href="#l11.4665"></a><span id="l11.4665" class="difflineminus">-</span>
<a href="#l11.4666"></a><span id="l11.4666" class="difflineminus">-PRInt32</span>
<a href="#l11.4667"></a><span id="l11.4667" class="difflineminus">-InternetSearchDataSource::computeIndex(nsAutoString &amp;factor, </span>
<a href="#l11.4668"></a><span id="l11.4668" class="difflineminus">-                                       PRUint16 page, PRInt16 direction)</span>
<a href="#l11.4669"></a><span id="l11.4669" class="difflineminus">-{</span>
<a href="#l11.4670"></a><span id="l11.4670" class="difflineminus">-  // XXX get page</span>
<a href="#l11.4671"></a><span id="l11.4671" class="difflineminus">-  nsresult rv;</span>
<a href="#l11.4672"></a><span id="l11.4672" class="difflineminus">-  PRInt32 index = 0;</span>
<a href="#l11.4673"></a><span id="l11.4673" class="difflineminus">-  PRInt32 factorInt = factor.ToInteger(&amp;rv);</span>
<a href="#l11.4674"></a><span id="l11.4674" class="difflineminus">-  </span>
<a href="#l11.4675"></a><span id="l11.4675" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l11.4676"></a><span id="l11.4676" class="difflineminus">-  {</span>
<a href="#l11.4677"></a><span id="l11.4677" class="difflineminus">-    // if factor is garbled assume 10</span>
<a href="#l11.4678"></a><span id="l11.4678" class="difflineminus">-    if (factorInt &lt;= 0)</span>
<a href="#l11.4679"></a><span id="l11.4679" class="difflineminus">-      factorInt = 10;</span>
<a href="#l11.4680"></a><span id="l11.4680" class="difflineminus">-</span>
<a href="#l11.4681"></a><span id="l11.4681" class="difflineminus">-    if (direction &lt; 0)</span>
<a href="#l11.4682"></a><span id="l11.4682" class="difflineminus">-    {</span>
<a href="#l11.4683"></a><span id="l11.4683" class="difflineminus">-      // don't pass back a negative index!</span>
<a href="#l11.4684"></a><span id="l11.4684" class="difflineminus">-      if (0 &lt;= (page - 1))</span>
<a href="#l11.4685"></a><span id="l11.4685" class="difflineminus">-        --page;</span>
<a href="#l11.4686"></a><span id="l11.4686" class="difflineminus">-    }</span>
<a href="#l11.4687"></a><span id="l11.4687" class="difflineminus">-    index = factorInt * page;</span>
<a href="#l11.4688"></a><span id="l11.4688" class="difflineminus">-  }</span>
<a href="#l11.4689"></a><span id="l11.4689" class="difflineminus">-</span>
<a href="#l11.4690"></a><span id="l11.4690" class="difflineminus">-  return index;</span>
<a href="#l11.4691"></a><span id="l11.4691" class="difflineminus">-}</span>
<a href="#l11.4692"></a><span id="l11.4692" class="difflineminus">-</span>
<a href="#l11.4693"></a><span id="l11.4693" class="difflineminus">-</span>
<a href="#l11.4694"></a><span id="l11.4694" class="difflineminus">-</span>
<a href="#l11.4695"></a><span id="l11.4695" class="difflineminus">-nsresult</span>
<a href="#l11.4696"></a><span id="l11.4696" class="difflineminus">-InternetSearchDataSource::GetURL(nsIRDFResource *source, nsIRDFLiteral** aResult)</span>
<a href="#l11.4697"></a><span id="l11.4697" class="difflineminus">-{</span>
<a href="#l11.4698"></a><span id="l11.4698" class="difflineminus">-  const char *uri = nsnull;</span>
<a href="#l11.4699"></a><span id="l11.4699" class="difflineminus">-  nsresult rv = source-&gt;GetValueConst( &amp;uri );</span>
<a href="#l11.4700"></a><span id="l11.4700" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.4701"></a><span id="l11.4701" class="difflineminus">-  return mRDFService-&gt;GetLiteral(NS_ConvertUTF8toUTF16(uri).get(), aResult);</span>
<a href="#l11.4702"></a><span id="l11.4702" class="difflineminus">-}</span>
<a href="#l11.4703"></a><span id="l11.4703" class="difflineminus">-</span>
<a href="#l11.4704"></a><span id="l11.4704" class="difflineminus">-</span>
<a href="#l11.4705"></a><span id="l11.4705" class="difflineminus">-</span>
<a href="#l11.4706"></a><span id="l11.4706" class="difflineminus">-// stream observer methods</span>
<a href="#l11.4707"></a><span id="l11.4707" class="difflineminus">-</span>
<a href="#l11.4708"></a><span id="l11.4708" class="difflineminus">-</span>
<a href="#l11.4709"></a><span id="l11.4709" class="difflineminus">-</span>
<a href="#l11.4710"></a><span id="l11.4710" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.4711"></a><span id="l11.4711" class="difflineminus">-InternetSearchDataSource::OnStartRequest(nsIRequest *request, nsISupports *ctxt)</span>
<a href="#l11.4712"></a><span id="l11.4712" class="difflineminus">-{</span>
<a href="#l11.4713"></a><span id="l11.4713" class="difflineminus">-#ifdef  DEBUG_SEARCH_OUTPUT</span>
<a href="#l11.4714"></a><span id="l11.4714" class="difflineminus">-  printf(&quot;InternetSearchDataSourceCallback::OnStartRequest entered.\n&quot;);</span>
<a href="#l11.4715"></a><span id="l11.4715" class="difflineminus">-#endif</span>
<a href="#l11.4716"></a><span id="l11.4716" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.4717"></a><span id="l11.4717" class="difflineminus">-}</span>
<a href="#l11.4718"></a><span id="l11.4718" class="difflineminus">-</span>
<a href="#l11.4719"></a><span id="l11.4719" class="difflineminus">-</span>
<a href="#l11.4720"></a><span id="l11.4720" class="difflineminus">-</span>
<a href="#l11.4721"></a><span id="l11.4721" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.4722"></a><span id="l11.4722" class="difflineminus">-InternetSearchDataSource::OnDataAvailable(nsIRequest *request, nsISupports *ctxt,</span>
<a href="#l11.4723"></a><span id="l11.4723" class="difflineminus">-        nsIInputStream *aIStream, PRUint32 sourceOffset, PRUint32 aLength)</span>
<a href="#l11.4724"></a><span id="l11.4724" class="difflineminus">-{</span>
<a href="#l11.4725"></a><span id="l11.4725" class="difflineminus">-  if (!ctxt)  return(NS_ERROR_NO_INTERFACE);</span>
<a href="#l11.4726"></a><span id="l11.4726" class="difflineminus">-  nsCOMPtr&lt;nsIInternetSearchContext&gt; context (do_QueryInterface(ctxt));</span>
<a href="#l11.4727"></a><span id="l11.4727" class="difflineminus">-  if (!context) return(NS_ERROR_NO_INTERFACE);</span>
<a href="#l11.4728"></a><span id="l11.4728" class="difflineminus">-</span>
<a href="#l11.4729"></a><span id="l11.4729" class="difflineminus">-  nsresult  rv = NS_OK;</span>
<a href="#l11.4730"></a><span id="l11.4730" class="difflineminus">-</span>
<a href="#l11.4731"></a><span id="l11.4731" class="difflineminus">-  if (aLength &lt; 1)  return(rv);</span>
<a href="#l11.4732"></a><span id="l11.4732" class="difflineminus">-</span>
<a href="#l11.4733"></a><span id="l11.4733" class="difflineminus">-  PRUint32  count;</span>
<a href="#l11.4734"></a><span id="l11.4734" class="difflineminus">-  char    *buffer = new char[ aLength ];</span>
<a href="#l11.4735"></a><span id="l11.4735" class="difflineminus">-  if (!buffer)  return(NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l11.4736"></a><span id="l11.4736" class="difflineminus">-</span>
<a href="#l11.4737"></a><span id="l11.4737" class="difflineminus">-  if (NS_FAILED(rv = aIStream-&gt;Read(buffer, aLength, &amp;count)) || count == 0)</span>
<a href="#l11.4738"></a><span id="l11.4738" class="difflineminus">-  {</span>
<a href="#l11.4739"></a><span id="l11.4739" class="difflineminus">-#ifdef  DEBUG</span>
<a href="#l11.4740"></a><span id="l11.4740" class="difflineminus">-    printf(&quot;Search datasource read failure.\n&quot;);</span>
<a href="#l11.4741"></a><span id="l11.4741" class="difflineminus">-#endif</span>
<a href="#l11.4742"></a><span id="l11.4742" class="difflineminus">-    delete []buffer;</span>
<a href="#l11.4743"></a><span id="l11.4743" class="difflineminus">-    return(rv);</span>
<a href="#l11.4744"></a><span id="l11.4744" class="difflineminus">-  }</span>
<a href="#l11.4745"></a><span id="l11.4745" class="difflineminus">-  if (count != aLength)</span>
<a href="#l11.4746"></a><span id="l11.4746" class="difflineminus">-  {</span>
<a href="#l11.4747"></a><span id="l11.4747" class="difflineminus">-#ifdef  DEBUG</span>
<a href="#l11.4748"></a><span id="l11.4748" class="difflineminus">-    printf(&quot;Search datasource read # of bytes failure.\n&quot;);</span>
<a href="#l11.4749"></a><span id="l11.4749" class="difflineminus">-#endif</span>
<a href="#l11.4750"></a><span id="l11.4750" class="difflineminus">-    delete []buffer;</span>
<a href="#l11.4751"></a><span id="l11.4751" class="difflineminus">-    return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.4752"></a><span id="l11.4752" class="difflineminus">-  }</span>
<a href="#l11.4753"></a><span id="l11.4753" class="difflineminus">-</span>
<a href="#l11.4754"></a><span id="l11.4754" class="difflineminus">-  nsCOMPtr&lt;nsIUnicodeDecoder&gt; decoder;</span>
<a href="#l11.4755"></a><span id="l11.4755" class="difflineminus">-  context-&gt;GetUnicodeDecoder(getter_AddRefs(decoder));</span>
<a href="#l11.4756"></a><span id="l11.4756" class="difflineminus">-  if (decoder)</span>
<a href="#l11.4757"></a><span id="l11.4757" class="difflineminus">-  {</span>
<a href="#l11.4758"></a><span id="l11.4758" class="difflineminus">-    char      *aBuffer = buffer;</span>
<a href="#l11.4759"></a><span id="l11.4759" class="difflineminus">-    PRInt32     unicharBufLen = 0;</span>
<a href="#l11.4760"></a><span id="l11.4760" class="difflineminus">-    decoder-&gt;GetMaxLength(aBuffer, aLength, &amp;unicharBufLen);</span>
<a href="#l11.4761"></a><span id="l11.4761" class="difflineminus">-    PRUnichar   *unichars = new PRUnichar [ unicharBufLen+1 ];</span>
<a href="#l11.4762"></a><span id="l11.4762" class="difflineminus">-    do</span>
<a href="#l11.4763"></a><span id="l11.4763" class="difflineminus">-    {</span>
<a href="#l11.4764"></a><span id="l11.4764" class="difflineminus">-      PRInt32   srcLength = aLength;</span>
<a href="#l11.4765"></a><span id="l11.4765" class="difflineminus">-      PRInt32   unicharLength = unicharBufLen;</span>
<a href="#l11.4766"></a><span id="l11.4766" class="difflineminus">-      rv = decoder-&gt;Convert(aBuffer, &amp;srcLength, unichars, &amp;unicharLength);</span>
<a href="#l11.4767"></a><span id="l11.4767" class="difflineminus">-      unichars[unicharLength]=0;  //add this since the unicode converters can't be trusted to do so.</span>
<a href="#l11.4768"></a><span id="l11.4768" class="difflineminus">-</span>
<a href="#l11.4769"></a><span id="l11.4769" class="difflineminus">-      // Move the nsParser.cpp 00 -&gt; space hack to here so it won't break UCS2 file</span>
<a href="#l11.4770"></a><span id="l11.4770" class="difflineminus">-</span>
<a href="#l11.4771"></a><span id="l11.4771" class="difflineminus">-      // Hack Start</span>
<a href="#l11.4772"></a><span id="l11.4772" class="difflineminus">-      for(PRInt32 i=0;i &lt; unicharLength; i++)</span>
<a href="#l11.4773"></a><span id="l11.4773" class="difflineminus">-      {</span>
<a href="#l11.4774"></a><span id="l11.4774" class="difflineminus">-        if(0x0000 == unichars[i])</span>
<a href="#l11.4775"></a><span id="l11.4775" class="difflineminus">-        {</span>
<a href="#l11.4776"></a><span id="l11.4776" class="difflineminus">-          unichars[i] = PRUnichar(' ');</span>
<a href="#l11.4777"></a><span id="l11.4777" class="difflineminus">-        }</span>
<a href="#l11.4778"></a><span id="l11.4778" class="difflineminus">-      }</span>
<a href="#l11.4779"></a><span id="l11.4779" class="difflineminus">-      // Hack End</span>
<a href="#l11.4780"></a><span id="l11.4780" class="difflineminus">-</span>
<a href="#l11.4781"></a><span id="l11.4781" class="difflineminus">-      context-&gt;AppendUnicodeBytes(unichars, unicharLength);</span>
<a href="#l11.4782"></a><span id="l11.4782" class="difflineminus">-      // if we failed, we consume one byte by replace it with U+FFFD</span>
<a href="#l11.4783"></a><span id="l11.4783" class="difflineminus">-      // and try conversion again.</span>
<a href="#l11.4784"></a><span id="l11.4784" class="difflineminus">-      if(NS_FAILED(rv))</span>
<a href="#l11.4785"></a><span id="l11.4785" class="difflineminus">-      {</span>
<a href="#l11.4786"></a><span id="l11.4786" class="difflineminus">-        decoder-&gt;Reset();</span>
<a href="#l11.4787"></a><span id="l11.4787" class="difflineminus">-        unsigned char smallBuf[2];</span>
<a href="#l11.4788"></a><span id="l11.4788" class="difflineminus">-        smallBuf[0] = 0xFF;</span>
<a href="#l11.4789"></a><span id="l11.4789" class="difflineminus">-        smallBuf[1] = 0xFD;</span>
<a href="#l11.4790"></a><span id="l11.4790" class="difflineminus">-        context-&gt;AppendBytes( (const char *)&amp;smallBuf, 2L);</span>
<a href="#l11.4791"></a><span id="l11.4791" class="difflineminus">-        if(((PRUint32) (srcLength + 1)) &gt; aLength)</span>
<a href="#l11.4792"></a><span id="l11.4792" class="difflineminus">-          srcLength = aLength;</span>
<a href="#l11.4793"></a><span id="l11.4793" class="difflineminus">-        else </span>
<a href="#l11.4794"></a><span id="l11.4794" class="difflineminus">-          srcLength++;</span>
<a href="#l11.4795"></a><span id="l11.4795" class="difflineminus">-        aBuffer += srcLength;</span>
<a href="#l11.4796"></a><span id="l11.4796" class="difflineminus">-        aLength -= srcLength;</span>
<a href="#l11.4797"></a><span id="l11.4797" class="difflineminus">-      }</span>
<a href="#l11.4798"></a><span id="l11.4798" class="difflineminus">-    } while (NS_FAILED(rv) &amp;&amp; (aLength &gt; 0));</span>
<a href="#l11.4799"></a><span id="l11.4799" class="difflineminus">-    delete [] unichars;</span>
<a href="#l11.4800"></a><span id="l11.4800" class="difflineminus">-    unichars = nsnull;</span>
<a href="#l11.4801"></a><span id="l11.4801" class="difflineminus">-  }</span>
<a href="#l11.4802"></a><span id="l11.4802" class="difflineminus">-  else</span>
<a href="#l11.4803"></a><span id="l11.4803" class="difflineminus">-  {</span>
<a href="#l11.4804"></a><span id="l11.4804" class="difflineminus">-    context-&gt;AppendBytes(buffer, aLength);</span>
<a href="#l11.4805"></a><span id="l11.4805" class="difflineminus">-  }</span>
<a href="#l11.4806"></a><span id="l11.4806" class="difflineminus">-</span>
<a href="#l11.4807"></a><span id="l11.4807" class="difflineminus">-  delete [] buffer;</span>
<a href="#l11.4808"></a><span id="l11.4808" class="difflineminus">-  buffer = nsnull;</span>
<a href="#l11.4809"></a><span id="l11.4809" class="difflineminus">-  return(rv);</span>
<a href="#l11.4810"></a><span id="l11.4810" class="difflineminus">-}</span>
<a href="#l11.4811"></a><span id="l11.4811" class="difflineminus">-</span>
<a href="#l11.4812"></a><span id="l11.4812" class="difflineminus">-</span>
<a href="#l11.4813"></a><span id="l11.4813" class="difflineminus">-</span>
<a href="#l11.4814"></a><span id="l11.4814" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.4815"></a><span id="l11.4815" class="difflineminus">-InternetSearchDataSource::OnStopRequest(nsIRequest *request, nsISupports *ctxt,</span>
<a href="#l11.4816"></a><span id="l11.4816" class="difflineminus">-                                        nsresult status)</span>
<a href="#l11.4817"></a><span id="l11.4817" class="difflineminus">-{</span>
<a href="#l11.4818"></a><span id="l11.4818" class="difflineminus">-  if (!mInner)  return(NS_OK);</span>
<a href="#l11.4819"></a><span id="l11.4819" class="difflineminus">-</span>
<a href="#l11.4820"></a><span id="l11.4820" class="difflineminus">-  nsCOMPtr&lt;nsIChannel&gt; channel (do_QueryInterface(request));</span>
<a href="#l11.4821"></a><span id="l11.4821" class="difflineminus">-  nsCOMPtr&lt;nsIInternetSearchContext&gt; context (do_QueryInterface(ctxt));</span>
<a href="#l11.4822"></a><span id="l11.4822" class="difflineminus">-  if (!ctxt)  return(NS_ERROR_NO_INTERFACE);</span>
<a href="#l11.4823"></a><span id="l11.4823" class="difflineminus">-</span>
<a href="#l11.4824"></a><span id="l11.4824" class="difflineminus">-  nsresult  rv;</span>
<a href="#l11.4825"></a><span id="l11.4825" class="difflineminus">-  PRUint32  contextType = 0;</span>
<a href="#l11.4826"></a><span id="l11.4826" class="difflineminus">-  if (NS_FAILED(rv = context-&gt;GetContextType(&amp;contextType)))    return(rv);</span>
<a href="#l11.4827"></a><span id="l11.4827" class="difflineminus">-</span>
<a href="#l11.4828"></a><span id="l11.4828" class="difflineminus">-  if (contextType == nsIInternetSearchContext::WEB_SEARCH_CONTEXT)</span>
<a href="#l11.4829"></a><span id="l11.4829" class="difflineminus">-  {</span>
<a href="#l11.4830"></a><span id="l11.4830" class="difflineminus">-    // continue to process nsIInternetSearchContext::WEB_SEARCH_CONTEXT</span>
<a href="#l11.4831"></a><span id="l11.4831" class="difflineminus">-    rv = webSearchFinalize(channel, context);</span>
<a href="#l11.4832"></a><span id="l11.4832" class="difflineminus">-  }</span>
<a href="#l11.4833"></a><span id="l11.4833" class="difflineminus">-  else if (contextType == nsIInternetSearchContext::ENGINE_DOWNLOAD_NEW_CONTEXT ||</span>
<a href="#l11.4834"></a><span id="l11.4834" class="difflineminus">-           contextType == nsIInternetSearchContext::ICON_DOWNLOAD_NEW_CONTEXT ||</span>
<a href="#l11.4835"></a><span id="l11.4835" class="difflineminus">-           contextType == nsIInternetSearchContext::ENGINE_DOWNLOAD_UPDATE_CONTEXT ||</span>
<a href="#l11.4836"></a><span id="l11.4836" class="difflineminus">-           contextType == nsIInternetSearchContext::ICON_DOWNLOAD_UPDATE_CONTEXT)</span>
<a href="#l11.4837"></a><span id="l11.4837" class="difflineminus">-  {</span>
<a href="#l11.4838"></a><span id="l11.4838" class="difflineminus">-    nsCOMPtr&lt;nsIHttpChannel&gt; httpChannel (do_QueryInterface(channel));</span>
<a href="#l11.4839"></a><span id="l11.4839" class="difflineminus">-    if (!httpChannel) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.4840"></a><span id="l11.4840" class="difflineminus">-</span>
<a href="#l11.4841"></a><span id="l11.4841" class="difflineminus">-    // check HTTP status to ensure success</span>
<a href="#l11.4842"></a><span id="l11.4842" class="difflineminus">-    PRUint32  httpStatus = 0;</span>
<a href="#l11.4843"></a><span id="l11.4843" class="difflineminus">-    if (NS_SUCCEEDED(rv = httpChannel-&gt;GetResponseStatus(&amp;httpStatus)) &amp;&amp;</span>
<a href="#l11.4844"></a><span id="l11.4844" class="difflineminus">-      (httpStatus == 200))</span>
<a href="#l11.4845"></a><span id="l11.4845" class="difflineminus">-    {</span>
<a href="#l11.4846"></a><span id="l11.4846" class="difflineminus">-      rv = saveContents(channel, context, contextType);</span>
<a href="#l11.4847"></a><span id="l11.4847" class="difflineminus">-    }</span>
<a href="#l11.4848"></a><span id="l11.4848" class="difflineminus">-  }</span>
<a href="#l11.4849"></a><span id="l11.4849" class="difflineminus">-  else if (contextType == nsIInternetSearchContext::ENGINE_UPDATE_HEAD_CONTEXT)</span>
<a href="#l11.4850"></a><span id="l11.4850" class="difflineminus">-  {</span>
<a href="#l11.4851"></a><span id="l11.4851" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt;  theEngine;</span>
<a href="#l11.4852"></a><span id="l11.4852" class="difflineminus">-    if (NS_FAILED(rv = context-&gt;GetEngine(getter_AddRefs(theEngine))))  return(rv);</span>
<a href="#l11.4853"></a><span id="l11.4853" class="difflineminus">-    if (!theEngine) return(NS_ERROR_NO_INTERFACE);</span>
<a href="#l11.4854"></a><span id="l11.4854" class="difflineminus">-</span>
<a href="#l11.4855"></a><span id="l11.4855" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.4856"></a><span id="l11.4856" class="difflineminus">-    const char  *engineURI = nsnull;</span>
<a href="#l11.4857"></a><span id="l11.4857" class="difflineminus">-    theEngine-&gt;GetValueConst(&amp;engineURI);</span>
<a href="#l11.4858"></a><span id="l11.4858" class="difflineminus">-#endif</span>
<a href="#l11.4859"></a><span id="l11.4859" class="difflineminus">-</span>
<a href="#l11.4860"></a><span id="l11.4860" class="difflineminus">-    // free up &quot;busy&quot; info now &amp; mark as non-busy</span>
<a href="#l11.4861"></a><span id="l11.4861" class="difflineminus">-    busySchedule = PR_FALSE;</span>
<a href="#l11.4862"></a><span id="l11.4862" class="difflineminus">-    busyResource = nsnull;</span>
<a href="#l11.4863"></a><span id="l11.4863" class="difflineminus">-</span>
<a href="#l11.4864"></a><span id="l11.4864" class="difflineminus">-    // mark now as the last time we stat'ted the search engine</span>
<a href="#l11.4865"></a><span id="l11.4865" class="difflineminus">-    // regardless of HTTP status</span>
<a href="#l11.4866"></a><span id="l11.4866" class="difflineminus">-    rv = validateEngineNow(theEngine);</span>
<a href="#l11.4867"></a><span id="l11.4867" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.4868"></a><span id="l11.4868" class="difflineminus">-</span>
<a href="#l11.4869"></a><span id="l11.4869" class="difflineminus">-    // we only have HTTP &quot;HEAD&quot; information when doing updates</span>
<a href="#l11.4870"></a><span id="l11.4870" class="difflineminus">-    nsCOMPtr&lt;nsIHttpChannel&gt; httpChannel (do_QueryInterface(channel));</span>
<a href="#l11.4871"></a><span id="l11.4871" class="difflineminus">-    if (!httpChannel) return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.4872"></a><span id="l11.4872" class="difflineminus">-</span>
<a href="#l11.4873"></a><span id="l11.4873" class="difflineminus">-    // check HTTP status to ensure success</span>
<a href="#l11.4874"></a><span id="l11.4874" class="difflineminus">-    PRUint32  httpStatus = 0;</span>
<a href="#l11.4875"></a><span id="l11.4875" class="difflineminus">-    if (NS_FAILED(rv = httpChannel-&gt;GetResponseStatus(&amp;httpStatus)))</span>
<a href="#l11.4876"></a><span id="l11.4876" class="difflineminus">-      return(rv);</span>
<a href="#l11.4877"></a><span id="l11.4877" class="difflineminus">-    if (httpStatus != 200)  return(NS_ERROR_UNEXPECTED);</span>
<a href="#l11.4878"></a><span id="l11.4878" class="difflineminus">-</span>
<a href="#l11.4879"></a><span id="l11.4879" class="difflineminus">-    // get last-modified &amp; content-length info</span>
<a href="#l11.4880"></a><span id="l11.4880" class="difflineminus">-    nsCAutoString     lastModValue, contentLengthValue;</span>
<a href="#l11.4881"></a><span id="l11.4881" class="difflineminus">-</span>
<a href="#l11.4882"></a><span id="l11.4882" class="difflineminus">-        if (NS_FAILED(httpChannel-&gt;GetResponseHeader(NS_LITERAL_CSTRING(&quot;Last-Modified&quot;), lastModValue)))</span>
<a href="#l11.4883"></a><span id="l11.4883" class="difflineminus">-            lastModValue.Truncate();</span>
<a href="#l11.4884"></a><span id="l11.4884" class="difflineminus">-        if (NS_FAILED(httpChannel-&gt;GetResponseHeader(NS_LITERAL_CSTRING(&quot;Content-Length&quot;), contentLengthValue)))</span>
<a href="#l11.4885"></a><span id="l11.4885" class="difflineminus">-            contentLengthValue.Truncate();</span>
<a href="#l11.4886"></a><span id="l11.4886" class="difflineminus">-</span>
<a href="#l11.4887"></a><span id="l11.4887" class="difflineminus">-    // should we fetch the entire file?</span>
<a href="#l11.4888"></a><span id="l11.4888" class="difflineminus">-    PRBool    updateSearchEngineFile = PR_FALSE;</span>
<a href="#l11.4889"></a><span id="l11.4889" class="difflineminus">-</span>
<a href="#l11.4890"></a><span id="l11.4890" class="difflineminus">-    // save out new search engine state data into localstore</span>
<a href="#l11.4891"></a><span id="l11.4891" class="difflineminus">-    PRBool      tempDirty = PR_FALSE;</span>
<a href="#l11.4892"></a><span id="l11.4892" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; newValue;</span>
<a href="#l11.4893"></a><span id="l11.4893" class="difflineminus">-    if (!lastModValue.IsEmpty())</span>
<a href="#l11.4894"></a><span id="l11.4894" class="difflineminus">-    {</span>
<a href="#l11.4895"></a><span id="l11.4895" class="difflineminus">-      mRDFService-&gt;GetLiteral(NS_ConvertASCIItoUTF16(lastModValue).get(),</span>
<a href="#l11.4896"></a><span id="l11.4896" class="difflineminus">-        getter_AddRefs(newValue));</span>
<a href="#l11.4897"></a><span id="l11.4897" class="difflineminus">-      if (newValue)</span>
<a href="#l11.4898"></a><span id="l11.4898" class="difflineminus">-      {</span>
<a href="#l11.4899"></a><span id="l11.4899" class="difflineminus">-        updateAtom(mLocalstore, theEngine, mWEB_LastPingModDate, newValue,</span>
<a href="#l11.4900"></a><span id="l11.4900" class="difflineminus">-          &amp;tempDirty);</span>
<a href="#l11.4901"></a><span id="l11.4901" class="difflineminus">-        if (tempDirty)</span>
<a href="#l11.4902"></a><span id="l11.4902" class="difflineminus">-          updateSearchEngineFile = PR_TRUE;</span>
<a href="#l11.4903"></a><span id="l11.4903" class="difflineminus">-      }</span>
<a href="#l11.4904"></a><span id="l11.4904" class="difflineminus">-    }</span>
<a href="#l11.4905"></a><span id="l11.4905" class="difflineminus">-    if (!contentLengthValue.IsEmpty())</span>
<a href="#l11.4906"></a><span id="l11.4906" class="difflineminus">-    {</span>
<a href="#l11.4907"></a><span id="l11.4907" class="difflineminus">-      mRDFService-&gt;GetLiteral(NS_ConvertASCIItoUTF16(contentLengthValue).get(),</span>
<a href="#l11.4908"></a><span id="l11.4908" class="difflineminus">-        getter_AddRefs(newValue));</span>
<a href="#l11.4909"></a><span id="l11.4909" class="difflineminus">-      if (newValue)</span>
<a href="#l11.4910"></a><span id="l11.4910" class="difflineminus">-      {</span>
<a href="#l11.4911"></a><span id="l11.4911" class="difflineminus">-        updateAtom(mLocalstore, theEngine, mWEB_LastPingContentLen, newValue,</span>
<a href="#l11.4912"></a><span id="l11.4912" class="difflineminus">-          &amp;tempDirty);</span>
<a href="#l11.4913"></a><span id="l11.4913" class="difflineminus">-        if (tempDirty)</span>
<a href="#l11.4914"></a><span id="l11.4914" class="difflineminus">-        {</span>
<a href="#l11.4915"></a><span id="l11.4915" class="difflineminus">-          updateSearchEngineFile = PR_TRUE;</span>
<a href="#l11.4916"></a><span id="l11.4916" class="difflineminus">-        }</span>
<a href="#l11.4917"></a><span id="l11.4917" class="difflineminus">-        else</span>
<a href="#l11.4918"></a><span id="l11.4918" class="difflineminus">-        {</span>
<a href="#l11.4919"></a><span id="l11.4919" class="difflineminus">-          // worst case: compare local data size vs. remote content size</span>
<a href="#l11.4920"></a><span id="l11.4920" class="difflineminus">-          nsCOMPtr&lt;nsIRDFLiteral&gt; dataLit;</span>
<a href="#l11.4921"></a><span id="l11.4921" class="difflineminus">-          if (NS_SUCCEEDED(rv = FindData(theEngine, getter_AddRefs(dataLit))) &amp;&amp;</span>
<a href="#l11.4922"></a><span id="l11.4922" class="difflineminus">-            (rv != NS_RDF_NO_VALUE))</span>
<a href="#l11.4923"></a><span id="l11.4923" class="difflineminus">-          {</span>
<a href="#l11.4924"></a><span id="l11.4924" class="difflineminus">-            const PRUnichar *dataUni = nsnull;</span>
<a href="#l11.4925"></a><span id="l11.4925" class="difflineminus">-            dataLit-&gt;GetValueConst(&amp;dataUni);</span>
<a href="#l11.4926"></a><span id="l11.4926" class="difflineminus">-            nsAutoString  dataStr(dataUni);</span>
<a href="#l11.4927"></a><span id="l11.4927" class="difflineminus">-            PRInt32   dataLen=dataStr.Length();</span>
<a href="#l11.4928"></a><span id="l11.4928" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.4929"></a><span id="l11.4929" class="difflineminus">-            printf(&quot;    Search engine='%s' data length='%d'\n&quot;, engineURI, dataLen);</span>
<a href="#l11.4930"></a><span id="l11.4930" class="difflineminus">-#endif</span>
<a href="#l11.4931"></a><span id="l11.4931" class="difflineminus">-            PRInt32 contentLen = contentLengthValue.ToInteger(&amp;rv);</span>
<a href="#l11.4932"></a><span id="l11.4932" class="difflineminus">-            if (NS_SUCCEEDED(rv) &amp;&amp; (dataLen != contentLen))</span>
<a href="#l11.4933"></a><span id="l11.4933" class="difflineminus">-            {</span>
<a href="#l11.4934"></a><span id="l11.4934" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.4935"></a><span id="l11.4935" class="difflineminus">-              printf(&quot;    Search engine '%s' data length != remote content length, so update\n&quot;,</span>
<a href="#l11.4936"></a><span id="l11.4936" class="difflineminus">-                engineURI, dataLen);</span>
<a href="#l11.4937"></a><span id="l11.4937" class="difflineminus">-#endif</span>
<a href="#l11.4938"></a><span id="l11.4938" class="difflineminus">-              updateSearchEngineFile = PR_TRUE;</span>
<a href="#l11.4939"></a><span id="l11.4939" class="difflineminus">-            }</span>
<a href="#l11.4940"></a><span id="l11.4940" class="difflineminus">-          }</span>
<a href="#l11.4941"></a><span id="l11.4941" class="difflineminus">-        }</span>
<a href="#l11.4942"></a><span id="l11.4942" class="difflineminus">-      }</span>
<a href="#l11.4943"></a><span id="l11.4943" class="difflineminus">-    }</span>
<a href="#l11.4944"></a><span id="l11.4944" class="difflineminus">-</span>
<a href="#l11.4945"></a><span id="l11.4945" class="difflineminus">-    if (updateSearchEngineFile)</span>
<a href="#l11.4946"></a><span id="l11.4946" class="difflineminus">-    {</span>
<a href="#l11.4947"></a><span id="l11.4947" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.4948"></a><span id="l11.4948" class="difflineminus">-      printf(&quot;    Search engine='%s' needs updating, so fetching it\n&quot;, engineURI);</span>
<a href="#l11.4949"></a><span id="l11.4949" class="difflineminus">-#endif</span>
<a href="#l11.4950"></a><span id="l11.4950" class="difflineminus">-      // get update URL</span>
<a href="#l11.4951"></a><span id="l11.4951" class="difflineminus">-      nsCString   updateURL;</span>
<a href="#l11.4952"></a><span id="l11.4952" class="difflineminus">-      nsCOMPtr&lt;nsIRDFNode&gt;  aNode;</span>
<a href="#l11.4953"></a><span id="l11.4953" class="difflineminus">-      if (NS_SUCCEEDED(rv = mInner-&gt;GetTarget(theEngine, mNC_Update, PR_TRUE, getter_AddRefs(aNode)))</span>
<a href="#l11.4954"></a><span id="l11.4954" class="difflineminus">-        &amp;&amp; (rv != NS_RDF_NO_VALUE))</span>
<a href="#l11.4955"></a><span id="l11.4955" class="difflineminus">-      {</span>
<a href="#l11.4956"></a><span id="l11.4956" class="difflineminus">-        nsCOMPtr&lt;nsIRDFLiteral&gt; aLiteral (do_QueryInterface(aNode));</span>
<a href="#l11.4957"></a><span id="l11.4957" class="difflineminus">-        if (aLiteral)</span>
<a href="#l11.4958"></a><span id="l11.4958" class="difflineminus">-        {</span>
<a href="#l11.4959"></a><span id="l11.4959" class="difflineminus">-          const PRUnichar *updateUni = nsnull;</span>
<a href="#l11.4960"></a><span id="l11.4960" class="difflineminus">-          aLiteral-&gt;GetValueConst(&amp;updateUni);</span>
<a href="#l11.4961"></a><span id="l11.4961" class="difflineminus">-          if (updateUni)</span>
<a href="#l11.4962"></a><span id="l11.4962" class="difflineminus">-          {</span>
<a href="#l11.4963"></a><span id="l11.4963" class="difflineminus">-            CopyUTF16toUTF8(nsDependentString(updateUni), updateURL);</span>
<a href="#l11.4964"></a><span id="l11.4964" class="difflineminus">-          }</span>
<a href="#l11.4965"></a><span id="l11.4965" class="difflineminus">-        }</span>
<a href="#l11.4966"></a><span id="l11.4966" class="difflineminus">-      }</span>
<a href="#l11.4967"></a><span id="l11.4967" class="difflineminus">-</span>
<a href="#l11.4968"></a><span id="l11.4968" class="difflineminus">-      // get update icon</span>
<a href="#l11.4969"></a><span id="l11.4969" class="difflineminus">-      nsCString   updateIconURL;</span>
<a href="#l11.4970"></a><span id="l11.4970" class="difflineminus">-      if (NS_SUCCEEDED(rv = mInner-&gt;GetTarget(theEngine, mNC_UpdateIcon, PR_TRUE, getter_AddRefs(aNode)))</span>
<a href="#l11.4971"></a><span id="l11.4971" class="difflineminus">-        &amp;&amp; (rv != NS_RDF_NO_VALUE))</span>
<a href="#l11.4972"></a><span id="l11.4972" class="difflineminus">-      {</span>
<a href="#l11.4973"></a><span id="l11.4973" class="difflineminus">-        nsCOMPtr&lt;nsIRDFLiteral&gt; aIconLiteral (do_QueryInterface(aNode));</span>
<a href="#l11.4974"></a><span id="l11.4974" class="difflineminus">-        if (aIconLiteral)</span>
<a href="#l11.4975"></a><span id="l11.4975" class="difflineminus">-        {</span>
<a href="#l11.4976"></a><span id="l11.4976" class="difflineminus">-          const PRUnichar *updateIconUni = nsnull;</span>
<a href="#l11.4977"></a><span id="l11.4977" class="difflineminus">-          aIconLiteral-&gt;GetValueConst(&amp;updateIconUni);</span>
<a href="#l11.4978"></a><span id="l11.4978" class="difflineminus">-          if (updateIconUni)</span>
<a href="#l11.4979"></a><span id="l11.4979" class="difflineminus">-          {</span>
<a href="#l11.4980"></a><span id="l11.4980" class="difflineminus">-            CopyUTF16toUTF8(nsDependentString(updateIconUni), updateIconURL);</span>
<a href="#l11.4981"></a><span id="l11.4981" class="difflineminus">-          }</span>
<a href="#l11.4982"></a><span id="l11.4982" class="difflineminus">-        }</span>
<a href="#l11.4983"></a><span id="l11.4983" class="difflineminus">-      }</span>
<a href="#l11.4984"></a><span id="l11.4984" class="difflineminus">-</span>
<a href="#l11.4985"></a><span id="l11.4985" class="difflineminus">-      // download it!</span>
<a href="#l11.4986"></a><span id="l11.4986" class="difflineminus">-      AddSearchEngineInternal(updateURL.get(), updateIconURL.get(),</span>
<a href="#l11.4987"></a><span id="l11.4987" class="difflineminus">-                              nsnull, nsnull, theEngine);</span>
<a href="#l11.4988"></a><span id="l11.4988" class="difflineminus">-    }</span>
<a href="#l11.4989"></a><span id="l11.4989" class="difflineminus">-    else</span>
<a href="#l11.4990"></a><span id="l11.4990" class="difflineminus">-    {</span>
<a href="#l11.4991"></a><span id="l11.4991" class="difflineminus">-#ifdef  DEBUG_SEARCH_UPDATES</span>
<a href="#l11.4992"></a><span id="l11.4992" class="difflineminus">-      printf(&quot;    Search engine='%s' is current and requires no updating\n&quot;, engineURI);</span>
<a href="#l11.4993"></a><span id="l11.4993" class="difflineminus">-#endif</span>
<a href="#l11.4994"></a><span id="l11.4994" class="difflineminus">-    }</span>
<a href="#l11.4995"></a><span id="l11.4995" class="difflineminus">-  }</span>
<a href="#l11.4996"></a><span id="l11.4996" class="difflineminus">-  else</span>
<a href="#l11.4997"></a><span id="l11.4997" class="difflineminus">-  {</span>
<a href="#l11.4998"></a><span id="l11.4998" class="difflineminus">-    rv = NS_ERROR_UNEXPECTED;</span>
<a href="#l11.4999"></a><span id="l11.4999" class="difflineminus">-  }</span>
<a href="#l11.5000"></a><span id="l11.5000" class="difflineminus">-  return(rv);</span>
<a href="#l11.5001"></a><span id="l11.5001" class="difflineminus">-}</span>
<a href="#l11.5002"></a><span id="l11.5002" class="difflineminus">-</span>
<a href="#l11.5003"></a><span id="l11.5003" class="difflineminus">-</span>
<a href="#l11.5004"></a><span id="l11.5004" class="difflineminus">-</span>
<a href="#l11.5005"></a><span id="l11.5005" class="difflineminus">-nsresult</span>
<a href="#l11.5006"></a><span id="l11.5006" class="difflineminus">-InternetSearchDataSource::validateEngineNow(nsIRDFResource *engine)</span>
<a href="#l11.5007"></a><span id="l11.5007" class="difflineminus">-{</span>
<a href="#l11.5008"></a><span id="l11.5008" class="difflineminus">-  // get the current date/time [from microseconds (PRTime) to seconds]</span>
<a href="#l11.5009"></a><span id="l11.5009" class="difflineminus">-  // also, need to convert from 64 bites to 32 bites as we don't have an easy</span>
<a href="#l11.5010"></a><span id="l11.5010" class="difflineminus">-  // way to convert from 64 bit number to a string like we do for 32 bit numbers</span>
<a href="#l11.5011"></a><span id="l11.5011" class="difflineminus">-  PRTime    now64 = PR_Now(), temp64, million;</span>
<a href="#l11.5012"></a><span id="l11.5012" class="difflineminus">-  LL_I2L(million, PR_USEC_PER_SEC);</span>
<a href="#l11.5013"></a><span id="l11.5013" class="difflineminus">-  LL_DIV(temp64, now64, million);</span>
<a href="#l11.5014"></a><span id="l11.5014" class="difflineminus">-  PRInt32   now32;</span>
<a href="#l11.5015"></a><span id="l11.5015" class="difflineminus">-  LL_L2I(now32, temp64);</span>
<a href="#l11.5016"></a><span id="l11.5016" class="difflineminus">-</span>
<a href="#l11.5017"></a><span id="l11.5017" class="difflineminus">-  // validate this engine as of now (save as string</span>
<a href="#l11.5018"></a><span id="l11.5018" class="difflineminus">-  // literal as that's all RDF can currently serialize)</span>
<a href="#l11.5019"></a><span id="l11.5019" class="difflineminus">-  nsAutoString  nowStr;</span>
<a href="#l11.5020"></a><span id="l11.5020" class="difflineminus">-  nowStr.AppendInt(now32);</span>
<a href="#l11.5021"></a><span id="l11.5021" class="difflineminus">-</span>
<a href="#l11.5022"></a><span id="l11.5022" class="difflineminus">-  nsresult    rv;</span>
<a href="#l11.5023"></a><span id="l11.5023" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; nowLiteral;</span>
<a href="#l11.5024"></a><span id="l11.5024" class="difflineminus">-  if (NS_FAILED(rv = mRDFService-&gt;GetLiteral(nowStr.get(),</span>
<a href="#l11.5025"></a><span id="l11.5025" class="difflineminus">-      getter_AddRefs(nowLiteral)))) return(rv);</span>
<a href="#l11.5026"></a><span id="l11.5026" class="difflineminus">-  updateAtom(mLocalstore, engine, mWEB_LastPingDate, nowLiteral, nsnull);</span>
<a href="#l11.5027"></a><span id="l11.5027" class="difflineminus">-</span>
<a href="#l11.5028"></a><span id="l11.5028" class="difflineminus">-  // flush localstore</span>
<a href="#l11.5029"></a><span id="l11.5029" class="difflineminus">-  nsCOMPtr&lt;nsIRDFRemoteDataSource&gt; remoteLocalStore (do_QueryInterface(mLocalstore));</span>
<a href="#l11.5030"></a><span id="l11.5030" class="difflineminus">-  if (remoteLocalStore)</span>
<a href="#l11.5031"></a><span id="l11.5031" class="difflineminus">-  {</span>
<a href="#l11.5032"></a><span id="l11.5032" class="difflineminus">-    remoteLocalStore-&gt;Flush();</span>
<a href="#l11.5033"></a><span id="l11.5033" class="difflineminus">-  }</span>
<a href="#l11.5034"></a><span id="l11.5034" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.5035"></a><span id="l11.5035" class="difflineminus">-}</span>
<a href="#l11.5036"></a><span id="l11.5036" class="difflineminus">-</span>
<a href="#l11.5037"></a><span id="l11.5037" class="difflineminus">-</span>
<a href="#l11.5038"></a><span id="l11.5038" class="difflineminus">-</span>
<a href="#l11.5039"></a><span id="l11.5039" class="difflineminus">-nsresult</span>
<a href="#l11.5040"></a><span id="l11.5040" class="difflineminus">-InternetSearchDataSource::webSearchFinalize(nsIChannel* channel, nsIInternetSearchContext *context)</span>
<a href="#l11.5041"></a><span id="l11.5041" class="difflineminus">-{</span>
<a href="#l11.5042"></a><span id="l11.5042" class="difflineminus">-  nsresult      rv;</span>
<a href="#l11.5043"></a><span id="l11.5043" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  mParent;</span>
<a href="#l11.5044"></a><span id="l11.5044" class="difflineminus">-  if (NS_FAILED(rv = context-&gt;GetParent(getter_AddRefs(mParent))))  return(rv);</span>
<a href="#l11.5045"></a><span id="l11.5045" class="difflineminus">-//  Note: mParent can be null</span>
<a href="#l11.5046"></a><span id="l11.5046" class="difflineminus">-//  if (!mParent) return(NS_ERROR_NO_INTERFACE);</span>
<a href="#l11.5047"></a><span id="l11.5047" class="difflineminus">-</span>
<a href="#l11.5048"></a><span id="l11.5048" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  mEngine;</span>
<a href="#l11.5049"></a><span id="l11.5049" class="difflineminus">-  if (NS_FAILED(rv = context-&gt;GetEngine(getter_AddRefs(mEngine))))  return(rv);</span>
<a href="#l11.5050"></a><span id="l11.5050" class="difflineminus">-  if (!mEngine) return(NS_ERROR_NO_INTERFACE);</span>
<a href="#l11.5051"></a><span id="l11.5051" class="difflineminus">-</span>
<a href="#l11.5052"></a><span id="l11.5052" class="difflineminus">-  nsCOMPtr&lt;nsIURI&gt; aURL;</span>
<a href="#l11.5053"></a><span id="l11.5053" class="difflineminus">-  rv = channel-&gt;GetURI(getter_AddRefs(aURL));</span>
<a href="#l11.5054"></a><span id="l11.5054" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l11.5055"></a><span id="l11.5055" class="difflineminus">-</span>
<a href="#l11.5056"></a><span id="l11.5056" class="difflineminus">-  // copy the engine's icon reference (if it has one) onto the result node</span>
<a href="#l11.5057"></a><span id="l11.5057" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt;    engineIconStatusNode = nsnull;</span>
<a href="#l11.5058"></a><span id="l11.5058" class="difflineminus">-  mInner-&gt;GetTarget(mEngine, mNC_Icon, PR_TRUE, getter_AddRefs(engineIconStatusNode));</span>
<a href="#l11.5059"></a><span id="l11.5059" class="difflineminus">-  if (engineIconStatusNode)</span>
<a href="#l11.5060"></a><span id="l11.5060" class="difflineminus">-  {</span>
<a href="#l11.5061"></a><span id="l11.5061" class="difflineminus">-    rv = mInner-&gt;Assert(mEngine, mNC_StatusIcon, engineIconStatusNode, PR_TRUE);</span>
<a href="#l11.5062"></a><span id="l11.5062" class="difflineminus">-  }</span>
<a href="#l11.5063"></a><span id="l11.5063" class="difflineminus">-</span>
<a href="#l11.5064"></a><span id="l11.5064" class="difflineminus">-  const PRUnichar *uniBuf = nsnull;</span>
<a href="#l11.5065"></a><span id="l11.5065" class="difflineminus">-  if (NS_SUCCEEDED(rv = context-&gt;GetBufferConst(&amp;uniBuf)) &amp;&amp; (uniBuf))</span>
<a href="#l11.5066"></a><span id="l11.5066" class="difflineminus">-  {</span>
<a href="#l11.5067"></a><span id="l11.5067" class="difflineminus">-    if (mParent &amp;&amp; (mBrowserSearchMode&gt;0))</span>
<a href="#l11.5068"></a><span id="l11.5068" class="difflineminus">-    {</span>
<a href="#l11.5069"></a><span id="l11.5069" class="difflineminus">-      // save HTML result page for this engine</span>
<a href="#l11.5070"></a><span id="l11.5070" class="difflineminus">-      nsCOMPtr&lt;nsIRDFLiteral&gt; htmlLiteral;</span>
<a href="#l11.5071"></a><span id="l11.5071" class="difflineminus">-      if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(uniBuf, getter_AddRefs(htmlLiteral))))</span>
<a href="#l11.5072"></a><span id="l11.5072" class="difflineminus">-      {</span>
<a href="#l11.5073"></a><span id="l11.5073" class="difflineminus">-        rv = mInner-&gt;Assert(mEngine, mNC_HTML, htmlLiteral, PR_TRUE);</span>
<a href="#l11.5074"></a><span id="l11.5074" class="difflineminus">-      }</span>
<a href="#l11.5075"></a><span id="l11.5075" class="difflineminus">-    }</span>
<a href="#l11.5076"></a><span id="l11.5076" class="difflineminus">-</span>
<a href="#l11.5077"></a><span id="l11.5077" class="difflineminus">-    // parse up HTML results</span>
<a href="#l11.5078"></a><span id="l11.5078" class="difflineminus">-    PRInt32 uniBufLen = 0L;</span>
<a href="#l11.5079"></a><span id="l11.5079" class="difflineminus">-    if (NS_SUCCEEDED(rv = context-&gt;GetBufferLength(&amp;uniBufLen)))</span>
<a href="#l11.5080"></a><span id="l11.5080" class="difflineminus">-    {</span>
<a href="#l11.5081"></a><span id="l11.5081" class="difflineminus">-      rv = ParseHTML(aURL, mParent, mEngine, uniBuf, uniBufLen);</span>
<a href="#l11.5082"></a><span id="l11.5082" class="difflineminus">-    }</span>
<a href="#l11.5083"></a><span id="l11.5083" class="difflineminus">-  }</span>
<a href="#l11.5084"></a><span id="l11.5084" class="difflineminus">-  else</span>
<a href="#l11.5085"></a><span id="l11.5085" class="difflineminus">-  {</span>
<a href="#l11.5086"></a><span id="l11.5086" class="difflineminus">-#ifdef  DEBUG_SEARCH_OUTPUT</span>
<a href="#l11.5087"></a><span id="l11.5087" class="difflineminus">-    printf(&quot; *** InternetSearchDataSourceCallback::OnStopRequest:  no data.\n\n&quot;);</span>
<a href="#l11.5088"></a><span id="l11.5088" class="difflineminus">-#endif</span>
<a href="#l11.5089"></a><span id="l11.5089" class="difflineminus">-  }</span>
<a href="#l11.5090"></a><span id="l11.5090" class="difflineminus">-</span>
<a href="#l11.5091"></a><span id="l11.5091" class="difflineminus">-  // after we're all done with the html buffer, get rid of it</span>
<a href="#l11.5092"></a><span id="l11.5092" class="difflineminus">-  context-&gt;Truncate();</span>
<a href="#l11.5093"></a><span id="l11.5093" class="difflineminus">-</span>
<a href="#l11.5094"></a><span id="l11.5094" class="difflineminus">-  // (do this last) potentially remove the loading attribute</span>
<a href="#l11.5095"></a><span id="l11.5095" class="difflineminus">-  mInner-&gt;Unassert(mEngine, mNC_loading, mTrueLiteral);</span>
<a href="#l11.5096"></a><span id="l11.5096" class="difflineminus">-</span>
<a href="#l11.5097"></a><span id="l11.5097" class="difflineminus">-  if (mLoadGroup)</span>
<a href="#l11.5098"></a><span id="l11.5098" class="difflineminus">-  {</span>
<a href="#l11.5099"></a><span id="l11.5099" class="difflineminus">-    PRUint32  count = 0;</span>
<a href="#l11.5100"></a><span id="l11.5100" class="difflineminus">-    if (NS_SUCCEEDED(rv = mLoadGroup-&gt;GetActiveCount(&amp;count)))</span>
<a href="#l11.5101"></a><span id="l11.5101" class="difflineminus">-    {</span>
<a href="#l11.5102"></a><span id="l11.5102" class="difflineminus">-      // is this the last connection in the loadgroup?</span>
<a href="#l11.5103"></a><span id="l11.5103" class="difflineminus">-      if (count &lt;= 1)</span>
<a href="#l11.5104"></a><span id="l11.5104" class="difflineminus">-      {</span>
<a href="#l11.5105"></a><span id="l11.5105" class="difflineminus">-        Stop();</span>
<a href="#l11.5106"></a><span id="l11.5106" class="difflineminus">-      }</span>
<a href="#l11.5107"></a><span id="l11.5107" class="difflineminus">-    }</span>
<a href="#l11.5108"></a><span id="l11.5108" class="difflineminus">-  }</span>
<a href="#l11.5109"></a><span id="l11.5109" class="difflineminus">-</span>
<a href="#l11.5110"></a><span id="l11.5110" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.5111"></a><span id="l11.5111" class="difflineminus">-}</span>
<a href="#l11.5112"></a><span id="l11.5112" class="difflineminus">-</span>
<a href="#l11.5113"></a><span id="l11.5113" class="difflineminus">-</span>
<a href="#l11.5114"></a><span id="l11.5114" class="difflineminus">-</span>
<a href="#l11.5115"></a><span id="l11.5115" class="difflineminus">-nsresult</span>
<a href="#l11.5116"></a><span id="l11.5116" class="difflineminus">-InternetSearchDataSource::ParseHTML(nsIURI *aURL, nsIRDFResource *mParent,</span>
<a href="#l11.5117"></a><span id="l11.5117" class="difflineminus">-        nsIRDFResource *mEngine, const PRUnichar *htmlPage, PRInt32 htmlPageSize)</span>
<a href="#l11.5118"></a><span id="l11.5118" class="difflineminus">-{</span>
<a href="#l11.5119"></a><span id="l11.5119" class="difflineminus">-  // get data out of graph</span>
<a href="#l11.5120"></a><span id="l11.5120" class="difflineminus">-  nsresult  rv;</span>
<a href="#l11.5121"></a><span id="l11.5121" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt;  dataNode;</span>
<a href="#l11.5122"></a><span id="l11.5122" class="difflineminus">-  if (NS_FAILED(rv = mInner-&gt;GetTarget(mEngine, mNC_Data, PR_TRUE, getter_AddRefs(dataNode))))</span>
<a href="#l11.5123"></a><span id="l11.5123" class="difflineminus">-  {</span>
<a href="#l11.5124"></a><span id="l11.5124" class="difflineminus">-    return(rv);</span>
<a href="#l11.5125"></a><span id="l11.5125" class="difflineminus">-  }</span>
<a href="#l11.5126"></a><span id="l11.5126" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; dataLiteral (do_QueryInterface(dataNode));</span>
<a href="#l11.5127"></a><span id="l11.5127" class="difflineminus">-  if (!dataLiteral) return(NS_ERROR_NULL_POINTER);</span>
<a href="#l11.5128"></a><span id="l11.5128" class="difflineminus">-</span>
<a href="#l11.5129"></a><span id="l11.5129" class="difflineminus">-  const PRUnichar *dataUni = nsnull;</span>
<a href="#l11.5130"></a><span id="l11.5130" class="difflineminus">-  if (NS_FAILED(rv = dataLiteral-&gt;GetValueConst(&amp;dataUni)))</span>
<a href="#l11.5131"></a><span id="l11.5131" class="difflineminus">-    return(rv);</span>
<a href="#l11.5132"></a><span id="l11.5132" class="difflineminus">-  if (!dataUni) return(NS_ERROR_NULL_POINTER);</span>
<a href="#l11.5133"></a><span id="l11.5133" class="difflineminus">-</span>
<a href="#l11.5134"></a><span id="l11.5134" class="difflineminus">-  // get name of this engine once</span>
<a href="#l11.5135"></a><span id="l11.5135" class="difflineminus">-  nsAutoString  engineStr;</span>
<a href="#l11.5136"></a><span id="l11.5136" class="difflineminus">-  GetData(dataUni, &quot;search&quot;, 0, &quot;name&quot;, engineStr);</span>
<a href="#l11.5137"></a><span id="l11.5137" class="difflineminus">-</span>
<a href="#l11.5138"></a><span id="l11.5138" class="difflineminus">-  // pre-compute host (we might discard URLs that match this)</span>
<a href="#l11.5139"></a><span id="l11.5139" class="difflineminus">-  nsCAutoString hostName;</span>
<a href="#l11.5140"></a><span id="l11.5140" class="difflineminus">-  aURL-&gt;GetAsciiHost(hostName);</span>
<a href="#l11.5141"></a><span id="l11.5141" class="difflineminus">-</span>
<a href="#l11.5142"></a><span id="l11.5142" class="difflineminus">-  // pre-compute server path (we might discard URLs that match this)</span>
<a href="#l11.5143"></a><span id="l11.5143" class="difflineminus">-  nsAutoString  serverPathStr;</span>
<a href="#l11.5144"></a><span id="l11.5144" class="difflineminus">-  nsCAutoString serverPath;</span>
<a href="#l11.5145"></a><span id="l11.5145" class="difflineminus">-  aURL-&gt;GetPath(serverPath);</span>
<a href="#l11.5146"></a><span id="l11.5146" class="difflineminus">-  if (!serverPath.IsEmpty())</span>
<a href="#l11.5147"></a><span id="l11.5147" class="difflineminus">-  {</span>
<a href="#l11.5148"></a><span id="l11.5148" class="difflineminus">-    CopyUTF8toUTF16(serverPath, serverPathStr);</span>
<a href="#l11.5149"></a><span id="l11.5149" class="difflineminus">-    serverPath.Truncate();</span>
<a href="#l11.5150"></a><span id="l11.5150" class="difflineminus">-</span>
<a href="#l11.5151"></a><span id="l11.5151" class="difflineminus">-    PRInt32 serverOptionsOffset = serverPathStr.FindChar(PRUnichar('?'));</span>
<a href="#l11.5152"></a><span id="l11.5152" class="difflineminus">-    if (serverOptionsOffset &gt;= 0) serverPathStr.SetLength(serverOptionsOffset);</span>
<a href="#l11.5153"></a><span id="l11.5153" class="difflineminus">-  }</span>
<a href="#l11.5154"></a><span id="l11.5154" class="difflineminus">-</span>
<a href="#l11.5155"></a><span id="l11.5155" class="difflineminus">-  PRBool    hasPriceFlag = PR_FALSE, hasAvailabilityFlag = PR_FALSE, hasRelevanceFlag = PR_FALSE;</span>
<a href="#l11.5156"></a><span id="l11.5156" class="difflineminus">-  PRBool    hasDateFlag = PR_FALSE;</span>
<a href="#l11.5157"></a><span id="l11.5157" class="difflineminus">-  PRBool    skipLocalFlag = PR_FALSE, useAllHREFsFlag = PR_FALSE;</span>
<a href="#l11.5158"></a><span id="l11.5158" class="difflineminus">-  PRInt32   pageRank = 1;</span>
<a href="#l11.5159"></a><span id="l11.5159" class="difflineminus">-  PRUint32  numInterpretSections, numResults = 0;</span>
<a href="#l11.5160"></a><span id="l11.5160" class="difflineminus">-</span>
<a href="#l11.5161"></a><span id="l11.5161" class="difflineminus">-  GetNumInterpretSections(dataUni, numInterpretSections);</span>
<a href="#l11.5162"></a><span id="l11.5162" class="difflineminus">-  if (numInterpretSections &lt; 1)</span>
<a href="#l11.5163"></a><span id="l11.5163" class="difflineminus">-  {</span>
<a href="#l11.5164"></a><span id="l11.5164" class="difflineminus">-    // if no &lt;interpret&gt; sections, use all the HREFS on the page</span>
<a href="#l11.5165"></a><span id="l11.5165" class="difflineminus">-    numInterpretSections = 1;</span>
<a href="#l11.5166"></a><span id="l11.5166" class="difflineminus">-    useAllHREFsFlag = PR_TRUE;</span>
<a href="#l11.5167"></a><span id="l11.5167" class="difflineminus">-    skipLocalFlag = PR_TRUE;</span>
<a href="#l11.5168"></a><span id="l11.5168" class="difflineminus">-  }</span>
<a href="#l11.5169"></a><span id="l11.5169" class="difflineminus">-</span>
<a href="#l11.5170"></a><span id="l11.5170" class="difflineminus">-#ifdef  DEBUG</span>
<a href="#l11.5171"></a><span id="l11.5171" class="difflineminus">-  PRTime    now;</span>
<a href="#l11.5172"></a><span id="l11.5172" class="difflineminus">-  now = PR_Now();</span>
<a href="#l11.5173"></a><span id="l11.5173" class="difflineminus">-  printf(&quot;\nStart processing search results:   %u bytes \n&quot;, htmlPageSize); </span>
<a href="#l11.5174"></a><span id="l11.5174" class="difflineminus">-#endif</span>
<a href="#l11.5175"></a><span id="l11.5175" class="difflineminus">-</span>
<a href="#l11.5176"></a><span id="l11.5176" class="difflineminus">-  // need to handle multiple &lt;interpret&gt; sections, per spec</span>
<a href="#l11.5177"></a><span id="l11.5177" class="difflineminus">-  for (PRUint32 interpretSectionNum=0; interpretSectionNum &lt; numInterpretSections; interpretSectionNum++)</span>
<a href="#l11.5178"></a><span id="l11.5178" class="difflineminus">-  {</span>
<a href="#l11.5179"></a><span id="l11.5179" class="difflineminus">-    nsAutoString  resultListStartStr, resultListEndStr;</span>
<a href="#l11.5180"></a><span id="l11.5180" class="difflineminus">-    nsAutoString  resultItemStartStr, resultItemEndStr;</span>
<a href="#l11.5181"></a><span id="l11.5181" class="difflineminus">-    nsAutoString  relevanceStartStr, relevanceEndStr;</span>
<a href="#l11.5182"></a><span id="l11.5182" class="difflineminus">-    nsAutoString  bannerStartStr, bannerEndStr, skiplocalStr;</span>
<a href="#l11.5183"></a><span id="l11.5183" class="difflineminus">-    nsAutoString  priceStartStr, priceEndStr, availStartStr, availEndStr;</span>
<a href="#l11.5184"></a><span id="l11.5184" class="difflineminus">-    nsAutoString  dateStartStr, dateEndStr;</span>
<a href="#l11.5185"></a><span id="l11.5185" class="difflineminus">-    nsAutoString  nameStartStr, nameEndStr;</span>
<a href="#l11.5186"></a><span id="l11.5186" class="difflineminus">-    nsAutoString  emailStartStr, emailEndStr;</span>
<a href="#l11.5187"></a><span id="l11.5187" class="difflineminus">-    nsAutoString  browserResultTypeStr;</span>
<a href="#l11.5188"></a><span id="l11.5188" class="difflineminus">-    browserResultTypeStr.AssignLiteral(&quot;result&quot;);   // default to &quot;result&quot;</span>
<a href="#l11.5189"></a><span id="l11.5189" class="difflineminus">-</span>
<a href="#l11.5190"></a><span id="l11.5190" class="difflineminus">-    // use a nsDependentString so that &quot;htmlPage&quot; data isn't copied</span>
<a href="#l11.5191"></a><span id="l11.5191" class="difflineminus">-    nsDependentString  htmlResults(htmlPage, htmlPageSize);</span>
<a href="#l11.5192"></a><span id="l11.5192" class="difflineminus">-    PRUint32           startIndex = 0L, stopIndex = htmlPageSize;</span>
<a href="#l11.5193"></a><span id="l11.5193" class="difflineminus">-</span>
<a href="#l11.5194"></a><span id="l11.5194" class="difflineminus">-    if (!useAllHREFsFlag)</span>
<a href="#l11.5195"></a><span id="l11.5195" class="difflineminus">-    {</span>
<a href="#l11.5196"></a><span id="l11.5196" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;resultListStart&quot;, resultListStartStr);</span>
<a href="#l11.5197"></a><span id="l11.5197" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;resultListEnd&quot;, resultListEndStr);</span>
<a href="#l11.5198"></a><span id="l11.5198" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;resultItemStart&quot;, resultItemStartStr);</span>
<a href="#l11.5199"></a><span id="l11.5199" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;resultItemEnd&quot;, resultItemEndStr);</span>
<a href="#l11.5200"></a><span id="l11.5200" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;relevanceStart&quot;, relevanceStartStr);</span>
<a href="#l11.5201"></a><span id="l11.5201" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;relevanceEnd&quot;, relevanceEndStr);</span>
<a href="#l11.5202"></a><span id="l11.5202" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;bannerStart&quot;, bannerStartStr);</span>
<a href="#l11.5203"></a><span id="l11.5203" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;bannerEnd&quot;, bannerEndStr);</span>
<a href="#l11.5204"></a><span id="l11.5204" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;skiplocal&quot;, skiplocalStr);</span>
<a href="#l11.5205"></a><span id="l11.5205" class="difflineminus">-      skipLocalFlag = (skiplocalStr.LowerCaseEqualsLiteral(&quot;true&quot;)) ? PR_TRUE : PR_FALSE;</span>
<a href="#l11.5206"></a><span id="l11.5206" class="difflineminus">-</span>
<a href="#l11.5207"></a><span id="l11.5207" class="difflineminus">-      // shopping channel support</span>
<a href="#l11.5208"></a><span id="l11.5208" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;priceStart&quot;, priceStartStr);</span>
<a href="#l11.5209"></a><span id="l11.5209" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;priceEnd&quot;, priceEndStr);</span>
<a href="#l11.5210"></a><span id="l11.5210" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;availStart&quot;, availStartStr);</span>
<a href="#l11.5211"></a><span id="l11.5211" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;availEnd&quot;, availEndStr);</span>
<a href="#l11.5212"></a><span id="l11.5212" class="difflineminus">-</span>
<a href="#l11.5213"></a><span id="l11.5213" class="difflineminus">-      // news channel support</span>
<a href="#l11.5214"></a><span id="l11.5214" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;dateStart&quot;, dateStartStr);</span>
<a href="#l11.5215"></a><span id="l11.5215" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;dateEnd&quot;, dateEndStr);</span>
<a href="#l11.5216"></a><span id="l11.5216" class="difflineminus">-</span>
<a href="#l11.5217"></a><span id="l11.5217" class="difflineminus">-      // people channel support</span>
<a href="#l11.5218"></a><span id="l11.5218" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;nameStart&quot;, nameStartStr);</span>
<a href="#l11.5219"></a><span id="l11.5219" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;nameEnd&quot;, nameEndStr);</span>
<a href="#l11.5220"></a><span id="l11.5220" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;emailStart&quot;, emailStartStr);</span>
<a href="#l11.5221"></a><span id="l11.5221" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;emailEnd&quot;, emailEndStr);</span>
<a href="#l11.5222"></a><span id="l11.5222" class="difflineminus">-</span>
<a href="#l11.5223"></a><span id="l11.5223" class="difflineminus">-      // special browser support</span>
<a href="#l11.5224"></a><span id="l11.5224" class="difflineminus">-      GetData(dataUni, &quot;interpret&quot;, interpretSectionNum, &quot;browserResultType&quot;, browserResultTypeStr);</span>
<a href="#l11.5225"></a><span id="l11.5225" class="difflineminus">-      if (browserResultTypeStr.IsEmpty())</span>
<a href="#l11.5226"></a><span id="l11.5226" class="difflineminus">-      {</span>
<a href="#l11.5227"></a><span id="l11.5227" class="difflineminus">-        browserResultTypeStr.AssignLiteral(&quot;result&quot;); // default to &quot;result&quot;</span>
<a href="#l11.5228"></a><span id="l11.5228" class="difflineminus">-      }</span>
<a href="#l11.5229"></a><span id="l11.5229" class="difflineminus">-    }</span>
<a href="#l11.5230"></a><span id="l11.5230" class="difflineminus">-</span>
<a href="#l11.5231"></a><span id="l11.5231" class="difflineminus">-    // look for banner</span>
<a href="#l11.5232"></a><span id="l11.5232" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; bannerLiteral;</span>
<a href="#l11.5233"></a><span id="l11.5233" class="difflineminus">-    if ((!bannerStartStr.IsEmpty()) &amp;&amp; (!bannerEndStr.IsEmpty()))</span>
<a href="#l11.5234"></a><span id="l11.5234" class="difflineminus">-    {</span>
<a href="#l11.5235"></a><span id="l11.5235" class="difflineminus">-      PRInt32 bannerStart = htmlResults.Find(bannerStartStr, CaseInsensitiveCompare);</span>
<a href="#l11.5236"></a><span id="l11.5236" class="difflineminus">-      if (bannerStart &gt;= 0)</span>
<a href="#l11.5237"></a><span id="l11.5237" class="difflineminus">-      {</span>
<a href="#l11.5238"></a><span id="l11.5238" class="difflineminus">-        startIndex = bannerStart;</span>
<a href="#l11.5239"></a><span id="l11.5239" class="difflineminus">-</span>
<a href="#l11.5240"></a><span id="l11.5240" class="difflineminus">-        PRInt32 bannerEnd = htmlResults.Find(bannerEndStr, bannerStart + bannerStartStr.Length(), CaseInsensitiveCompare);</span>
<a href="#l11.5241"></a><span id="l11.5241" class="difflineminus">-        if (bannerEnd &gt; bannerStart)</span>
<a href="#l11.5242"></a><span id="l11.5242" class="difflineminus">-        {</span>
<a href="#l11.5243"></a><span id="l11.5243" class="difflineminus">-          stopIndex = bannerEnd - 1;</span>
<a href="#l11.5244"></a><span id="l11.5244" class="difflineminus">-</span>
<a href="#l11.5245"></a><span id="l11.5245" class="difflineminus">-          nsAutoString  htmlBanner;</span>
<a href="#l11.5246"></a><span id="l11.5246" class="difflineminus">-          htmlBanner = Substring(htmlResults, bannerStart, bannerEnd - bannerStart - 1);</span>
<a href="#l11.5247"></a><span id="l11.5247" class="difflineminus">-          if (!htmlBanner.IsEmpty())</span>
<a href="#l11.5248"></a><span id="l11.5248" class="difflineminus">-          {</span>
<a href="#l11.5249"></a><span id="l11.5249" class="difflineminus">-            const PRUnichar *bannerUni = htmlBanner.get();</span>
<a href="#l11.5250"></a><span id="l11.5250" class="difflineminus">-            if (bannerUni)</span>
<a href="#l11.5251"></a><span id="l11.5251" class="difflineminus">-            {</span>
<a href="#l11.5252"></a><span id="l11.5252" class="difflineminus">-              mRDFService-&gt;GetLiteral(bannerUni, getter_AddRefs(bannerLiteral));</span>
<a href="#l11.5253"></a><span id="l11.5253" class="difflineminus">-            }</span>
<a href="#l11.5254"></a><span id="l11.5254" class="difflineminus">-          }</span>
<a href="#l11.5255"></a><span id="l11.5255" class="difflineminus">-        }</span>
<a href="#l11.5256"></a><span id="l11.5256" class="difflineminus">-      }</span>
<a href="#l11.5257"></a><span id="l11.5257" class="difflineminus">-    }</span>
<a href="#l11.5258"></a><span id="l11.5258" class="difflineminus">-</span>
<a href="#l11.5259"></a><span id="l11.5259" class="difflineminus">-    if (!resultListStartStr.IsEmpty())</span>
<a href="#l11.5260"></a><span id="l11.5260" class="difflineminus">-    {</span>
<a href="#l11.5261"></a><span id="l11.5261" class="difflineminus">-      PRInt32 resultListStart = htmlResults.Find(resultListStartStr, CaseInsensitiveCompare);</span>
<a href="#l11.5262"></a><span id="l11.5262" class="difflineminus">-      if (resultListStart &gt;= 0)</span>
<a href="#l11.5263"></a><span id="l11.5263" class="difflineminus">-      {</span>
<a href="#l11.5264"></a><span id="l11.5264" class="difflineminus">-        startIndex = resultListStart + resultListStartStr.Length();</span>
<a href="#l11.5265"></a><span id="l11.5265" class="difflineminus">-      }</span>
<a href="#l11.5266"></a><span id="l11.5266" class="difflineminus">-      else if (!useAllHREFsFlag)</span>
<a href="#l11.5267"></a><span id="l11.5267" class="difflineminus">-      {</span>
<a href="#l11.5268"></a><span id="l11.5268" class="difflineminus">-        // if we have multiple &lt;INTERPRET&gt; sections but can't find the startIndex</span>
<a href="#l11.5269"></a><span id="l11.5269" class="difflineminus">-        // of a result list block, just continue on with the the next block</span>
<a href="#l11.5270"></a><span id="l11.5270" class="difflineminus">-        continue;</span>
<a href="#l11.5271"></a><span id="l11.5271" class="difflineminus">-      }</span>
<a href="#l11.5272"></a><span id="l11.5272" class="difflineminus">-    }</span>
<a href="#l11.5273"></a><span id="l11.5273" class="difflineminus">-    if (!resultListEndStr.IsEmpty())</span>
<a href="#l11.5274"></a><span id="l11.5274" class="difflineminus">-    {</span>
<a href="#l11.5275"></a><span id="l11.5275" class="difflineminus">-      // rjc note: use RFind to find the LAST</span>
<a href="#l11.5276"></a><span id="l11.5276" class="difflineminus">-      // occurrence of resultListEndStr</span>
<a href="#l11.5277"></a><span id="l11.5277" class="difflineminus">-</span>
<a href="#l11.5278"></a><span id="l11.5278" class="difflineminus">-      const PRUnichar *originalStart, *start, *end;</span>
<a href="#l11.5279"></a><span id="l11.5279" class="difflineminus">-      htmlResults.BeginReading(&amp;start, &amp;end);</span>
<a href="#l11.5280"></a><span id="l11.5280" class="difflineminus">-      originalStart = start;</span>
<a href="#l11.5281"></a><span id="l11.5281" class="difflineminus">-      </span>
<a href="#l11.5282"></a><span id="l11.5282" class="difflineminus">-      if (RFindInReadable(resultListEndStr, &amp;start, &amp;end))</span>
<a href="#l11.5283"></a><span id="l11.5283" class="difflineminus">-        stopIndex = start - originalStart;</span>
<a href="#l11.5284"></a><span id="l11.5284" class="difflineminus">-    }</span>
<a href="#l11.5285"></a><span id="l11.5285" class="difflineminus">-</span>
<a href="#l11.5286"></a><span id="l11.5286" class="difflineminus">-    PRBool  trimItemStart = PR_TRUE;</span>
<a href="#l11.5287"></a><span id="l11.5287" class="difflineminus">-    PRBool  trimItemEnd = PR_FALSE;   // rjc note: testing shows we should NEVER trim end???</span>
<a href="#l11.5288"></a><span id="l11.5288" class="difflineminus">-</span>
<a href="#l11.5289"></a><span id="l11.5289" class="difflineminus">-    // if resultItemStartStr is not specified, try making it just be &quot;HREF=&quot;</span>
<a href="#l11.5290"></a><span id="l11.5290" class="difflineminus">-    if (resultItemStartStr.IsEmpty())</span>
<a href="#l11.5291"></a><span id="l11.5291" class="difflineminus">-    {</span>
<a href="#l11.5292"></a><span id="l11.5292" class="difflineminus">-      resultItemStartStr.AssignLiteral(&quot;HREF=&quot;);</span>
<a href="#l11.5293"></a><span id="l11.5293" class="difflineminus">-      trimItemStart = PR_FALSE;</span>
<a href="#l11.5294"></a><span id="l11.5294" class="difflineminus">-    }</span>
<a href="#l11.5295"></a><span id="l11.5295" class="difflineminus">-</span>
<a href="#l11.5296"></a><span id="l11.5296" class="difflineminus">-    // if resultItemEndStr is not specified, try making it the same as resultItemStartStr</span>
<a href="#l11.5297"></a><span id="l11.5297" class="difflineminus">-    if (resultItemEndStr.IsEmpty())</span>
<a href="#l11.5298"></a><span id="l11.5298" class="difflineminus">-    {</span>
<a href="#l11.5299"></a><span id="l11.5299" class="difflineminus">-      resultItemEndStr = resultItemStartStr;</span>
<a href="#l11.5300"></a><span id="l11.5300" class="difflineminus">-      trimItemEnd = PR_TRUE;</span>
<a href="#l11.5301"></a><span id="l11.5301" class="difflineminus">-    }</span>
<a href="#l11.5302"></a><span id="l11.5302" class="difflineminus">-</span>
<a href="#l11.5303"></a><span id="l11.5303" class="difflineminus">-    while(startIndex &lt; stopIndex)</span>
<a href="#l11.5304"></a><span id="l11.5304" class="difflineminus">-    {</span>
<a href="#l11.5305"></a><span id="l11.5305" class="difflineminus">-      PRInt32 resultItemStart;</span>
<a href="#l11.5306"></a><span id="l11.5306" class="difflineminus">-      resultItemStart = htmlResults.Find(resultItemStartStr, startIndex, CaseInsensitiveCompare);</span>
<a href="#l11.5307"></a><span id="l11.5307" class="difflineminus">-      if (resultItemStart &lt; 0)  break;</span>
<a href="#l11.5308"></a><span id="l11.5308" class="difflineminus">-</span>
<a href="#l11.5309"></a><span id="l11.5309" class="difflineminus">-      PRInt32 resultItemEnd;</span>
<a href="#l11.5310"></a><span id="l11.5310" class="difflineminus">-      if (trimItemStart)</span>
<a href="#l11.5311"></a><span id="l11.5311" class="difflineminus">-      {</span>
<a href="#l11.5312"></a><span id="l11.5312" class="difflineminus">-        resultItemStart += resultItemStartStr.Length();</span>
<a href="#l11.5313"></a><span id="l11.5313" class="difflineminus">-        resultItemEnd = htmlResults.Find(resultItemEndStr, resultItemStart, CaseInsensitiveCompare);</span>
<a href="#l11.5314"></a><span id="l11.5314" class="difflineminus">-      }</span>
<a href="#l11.5315"></a><span id="l11.5315" class="difflineminus">-      else</span>
<a href="#l11.5316"></a><span id="l11.5316" class="difflineminus">-      {</span>
<a href="#l11.5317"></a><span id="l11.5317" class="difflineminus">-        resultItemEnd = htmlResults.Find(resultItemEndStr, resultItemStart + resultItemStartStr.Length(), CaseInsensitiveCompare);</span>
<a href="#l11.5318"></a><span id="l11.5318" class="difflineminus">-      }</span>
<a href="#l11.5319"></a><span id="l11.5319" class="difflineminus">-</span>
<a href="#l11.5320"></a><span id="l11.5320" class="difflineminus">-      if (resultItemEnd &lt; 0)</span>
<a href="#l11.5321"></a><span id="l11.5321" class="difflineminus">-      {</span>
<a href="#l11.5322"></a><span id="l11.5322" class="difflineminus">-        resultItemEnd = stopIndex;</span>
<a href="#l11.5323"></a><span id="l11.5323" class="difflineminus">-      }</span>
<a href="#l11.5324"></a><span id="l11.5324" class="difflineminus">-      else if (!trimItemEnd &amp;&amp; resultItemEnd &gt;= 0)</span>
<a href="#l11.5325"></a><span id="l11.5325" class="difflineminus">-      {</span>
<a href="#l11.5326"></a><span id="l11.5326" class="difflineminus">-        resultItemEnd += resultItemEndStr.Length();</span>
<a href="#l11.5327"></a><span id="l11.5327" class="difflineminus">-      }</span>
<a href="#l11.5328"></a><span id="l11.5328" class="difflineminus">-</span>
<a href="#l11.5329"></a><span id="l11.5329" class="difflineminus">-      // forced to use an nsAutoString (which copies)</span>
<a href="#l11.5330"></a><span id="l11.5330" class="difflineminus">-      // as CBufDescriptor doesn't guarantee null terminator</span>
<a href="#l11.5331"></a><span id="l11.5331" class="difflineminus">-      if (resultItemEnd - resultItemStart - 1 &lt;= 0)    break;</span>
<a href="#l11.5332"></a><span id="l11.5332" class="difflineminus">-      nsAutoString resultItem(&amp;htmlPage[resultItemStart],</span>
<a href="#l11.5333"></a><span id="l11.5333" class="difflineminus">-        resultItemEnd - resultItemStart - 1);</span>
<a href="#l11.5334"></a><span id="l11.5334" class="difflineminus">-</span>
<a href="#l11.5335"></a><span id="l11.5335" class="difflineminus">-      if (resultItem.IsEmpty()) break;</span>
<a href="#l11.5336"></a><span id="l11.5336" class="difflineminus">-</span>
<a href="#l11.5337"></a><span id="l11.5337" class="difflineminus">-      // advance startIndex here so that, from this point onward, &quot;continue&quot; can be used</span>
<a href="#l11.5338"></a><span id="l11.5338" class="difflineminus">-      startIndex = resultItemEnd;</span>
<a href="#l11.5339"></a><span id="l11.5339" class="difflineminus">-</span>
<a href="#l11.5340"></a><span id="l11.5340" class="difflineminus">-#ifdef  DEBUG_SEARCH_OUTPUT</span>
<a href="#l11.5341"></a><span id="l11.5341" class="difflineminus">-      printf(&quot;\n----- Search result: '%s'\n\n&quot;, NS_ConvertUTF16toUTF8(resultItem).get());</span>
<a href="#l11.5342"></a><span id="l11.5342" class="difflineminus">-#endif</span>
<a href="#l11.5343"></a><span id="l11.5343" class="difflineminus">-</span>
<a href="#l11.5344"></a><span id="l11.5344" class="difflineminus">-      // look for href</span>
<a href="#l11.5345"></a><span id="l11.5345" class="difflineminus">-      PRInt32 hrefOffset = resultItem.Find(&quot;HREF=&quot;, PR_TRUE);</span>
<a href="#l11.5346"></a><span id="l11.5346" class="difflineminus">-      if (hrefOffset &lt; 0)</span>
<a href="#l11.5347"></a><span id="l11.5347" class="difflineminus">-      {</span>
<a href="#l11.5348"></a><span id="l11.5348" class="difflineminus">-#ifdef  DEBUG_SEARCH_OUTPUT</span>
<a href="#l11.5349"></a><span id="l11.5349" class="difflineminus">-        printf(&quot;\n***** Unable to find HREF!\n\n&quot;);</span>
<a href="#l11.5350"></a><span id="l11.5350" class="difflineminus">-#endif</span>
<a href="#l11.5351"></a><span id="l11.5351" class="difflineminus">-        continue;</span>
<a href="#l11.5352"></a><span id="l11.5352" class="difflineminus">-      }</span>
<a href="#l11.5353"></a><span id="l11.5353" class="difflineminus">-</span>
<a href="#l11.5354"></a><span id="l11.5354" class="difflineminus">-      nsAutoString  hrefStr;</span>
<a href="#l11.5355"></a><span id="l11.5355" class="difflineminus">-      PRInt32   quoteStartOffset = nsString_FindCharInSet(resultItem, &quot;\&quot;\'&gt;&quot;, hrefOffset);</span>
<a href="#l11.5356"></a><span id="l11.5356" class="difflineminus">-      PRInt32   quoteEndOffset;</span>
<a href="#l11.5357"></a><span id="l11.5357" class="difflineminus">-      if (quoteStartOffset &lt; hrefOffset)</span>
<a href="#l11.5358"></a><span id="l11.5358" class="difflineminus">-      {</span>
<a href="#l11.5359"></a><span id="l11.5359" class="difflineminus">-        // handle case where HREF isn't quoted</span>
<a href="#l11.5360"></a><span id="l11.5360" class="difflineminus">-        quoteStartOffset = hrefOffset + strlen(&quot;HREF=&quot;);</span>
<a href="#l11.5361"></a><span id="l11.5361" class="difflineminus">-        quoteEndOffset = resultItem.FindChar('&gt;', quoteStartOffset);</span>
<a href="#l11.5362"></a><span id="l11.5362" class="difflineminus">-        if (quoteEndOffset &lt; quoteStartOffset)  continue;</span>
<a href="#l11.5363"></a><span id="l11.5363" class="difflineminus">-      }</span>
<a href="#l11.5364"></a><span id="l11.5364" class="difflineminus">-      else</span>
<a href="#l11.5365"></a><span id="l11.5365" class="difflineminus">-      {</span>
<a href="#l11.5366"></a><span id="l11.5366" class="difflineminus">-        if (resultItem[quoteStartOffset] == PRUnichar('&gt;'))</span>
<a href="#l11.5367"></a><span id="l11.5367" class="difflineminus">-        {</span>
<a href="#l11.5368"></a><span id="l11.5368" class="difflineminus">-          // handle case where HREF isn't quoted</span>
<a href="#l11.5369"></a><span id="l11.5369" class="difflineminus">-          quoteEndOffset = quoteStartOffset;</span>
<a href="#l11.5370"></a><span id="l11.5370" class="difflineminus">-          quoteStartOffset = hrefOffset + strlen(&quot;HREF=&quot;) -1;</span>
<a href="#l11.5371"></a><span id="l11.5371" class="difflineminus">-        }</span>
<a href="#l11.5372"></a><span id="l11.5372" class="difflineminus">-        else</span>
<a href="#l11.5373"></a><span id="l11.5373" class="difflineminus">-        {</span>
<a href="#l11.5374"></a><span id="l11.5374" class="difflineminus">-          quoteEndOffset = nsString_FindCharInSet(resultItem, &quot;\&quot;\'&quot;, quoteStartOffset + 1);</span>
<a href="#l11.5375"></a><span id="l11.5375" class="difflineminus">-          if (quoteEndOffset &lt; hrefOffset)  continue;</span>
<a href="#l11.5376"></a><span id="l11.5376" class="difflineminus">-        }</span>
<a href="#l11.5377"></a><span id="l11.5377" class="difflineminus">-      }</span>
<a href="#l11.5378"></a><span id="l11.5378" class="difflineminus">-      hrefStr = Substring(resultItem, quoteStartOffset + 1, quoteEndOffset - quoteStartOffset - 1);</span>
<a href="#l11.5379"></a><span id="l11.5379" class="difflineminus">-</span>
<a href="#l11.5380"></a><span id="l11.5380" class="difflineminus">-      ConvertEntities(hrefStr, PR_FALSE, PR_TRUE, PR_FALSE);</span>
<a href="#l11.5381"></a><span id="l11.5381" class="difflineminus">-</span>
<a href="#l11.5382"></a><span id="l11.5382" class="difflineminus">-      if (hrefStr.IsEmpty())  continue;</span>
<a href="#l11.5383"></a><span id="l11.5383" class="difflineminus">-</span>
<a href="#l11.5384"></a><span id="l11.5384" class="difflineminus">-      nsAutoString absURIStr;</span>
<a href="#l11.5385"></a><span id="l11.5385" class="difflineminus">-</span>
<a href="#l11.5386"></a><span id="l11.5386" class="difflineminus">-      if (NS_SUCCEEDED(rv = NS_MakeAbsoluteURI(absURIStr, hrefStr, aURL)))</span>
<a href="#l11.5387"></a><span id="l11.5387" class="difflineminus">-      {</span>
<a href="#l11.5388"></a><span id="l11.5388" class="difflineminus">-        hrefStr.Assign(absURIStr);</span>
<a href="#l11.5389"></a><span id="l11.5389" class="difflineminus">-</span>
<a href="#l11.5390"></a><span id="l11.5390" class="difflineminus">-        nsCOMPtr&lt;nsIURI&gt;  absURI;</span>
<a href="#l11.5391"></a><span id="l11.5391" class="difflineminus">-        rv = NS_NewURI(getter_AddRefs(absURI), absURIStr);</span>
<a href="#l11.5392"></a><span id="l11.5392" class="difflineminus">-</span>
<a href="#l11.5393"></a><span id="l11.5393" class="difflineminus">-        if (absURI &amp;&amp; skipLocalFlag)</span>
<a href="#l11.5394"></a><span id="l11.5394" class="difflineminus">-        {</span>
<a href="#l11.5395"></a><span id="l11.5395" class="difflineminus">-          nsCAutoString absPath;</span>
<a href="#l11.5396"></a><span id="l11.5396" class="difflineminus">-          absURI-&gt;GetPath(absPath);</span>
<a href="#l11.5397"></a><span id="l11.5397" class="difflineminus">-          if (!absPath.IsEmpty())</span>
<a href="#l11.5398"></a><span id="l11.5398" class="difflineminus">-          {</span>
<a href="#l11.5399"></a><span id="l11.5399" class="difflineminus">-                        NS_ConvertUTF8toUTF16 absPathStr(absPath);</span>
<a href="#l11.5400"></a><span id="l11.5400" class="difflineminus">-            PRInt32 pathOptionsOffset = absPathStr.FindChar(PRUnichar('?'));</span>
<a href="#l11.5401"></a><span id="l11.5401" class="difflineminus">-            if (pathOptionsOffset &gt;= 0)</span>
<a href="#l11.5402"></a><span id="l11.5402" class="difflineminus">-              absPathStr.SetLength(pathOptionsOffset);</span>
<a href="#l11.5403"></a><span id="l11.5403" class="difflineminus">-            PRBool  pathsMatchFlag = serverPathStr.Equals(absPathStr, CaseInsensitiveCompare);</span>
<a href="#l11.5404"></a><span id="l11.5404" class="difflineminus">-            if (pathsMatchFlag)</span>
<a href="#l11.5405"></a><span id="l11.5405" class="difflineminus">-              continue;</span>
<a href="#l11.5406"></a><span id="l11.5406" class="difflineminus">-          }</span>
<a href="#l11.5407"></a><span id="l11.5407" class="difflineminus">-</span>
<a href="#l11.5408"></a><span id="l11.5408" class="difflineminus">-          if (!hostName.IsEmpty())</span>
<a href="#l11.5409"></a><span id="l11.5409" class="difflineminus">-          {</span>
<a href="#l11.5410"></a><span id="l11.5410" class="difflineminus">-            nsCAutoString absHost;</span>
<a href="#l11.5411"></a><span id="l11.5411" class="difflineminus">-            absURI-&gt;GetAsciiHost(absHost);</span>
<a href="#l11.5412"></a><span id="l11.5412" class="difflineminus">-            if (!absHost.IsEmpty())</span>
<a href="#l11.5413"></a><span id="l11.5413" class="difflineminus">-            {</span>
<a href="#l11.5414"></a><span id="l11.5414" class="difflineminus">-              PRBool  hostsMatchFlag = hostName.Equals(absHost, CaseInsensitiveCompare);</span>
<a href="#l11.5415"></a><span id="l11.5415" class="difflineminus">-              if (hostsMatchFlag)</span>
<a href="#l11.5416"></a><span id="l11.5416" class="difflineminus">-                continue;</span>
<a href="#l11.5417"></a><span id="l11.5417" class="difflineminus">-            }</span>
<a href="#l11.5418"></a><span id="l11.5418" class="difflineminus">-          }</span>
<a href="#l11.5419"></a><span id="l11.5419" class="difflineminus">-        }</span>
<a href="#l11.5420"></a><span id="l11.5420" class="difflineminus">-      }</span>
<a href="#l11.5421"></a><span id="l11.5421" class="difflineminus">-</span>
<a href="#l11.5422"></a><span id="l11.5422" class="difflineminus">-      // if this result is to be filtered out, notice it now</span>
<a href="#l11.5423"></a><span id="l11.5423" class="difflineminus">-      if (isSearchResultFiltered(hrefStr))</span>
<a href="#l11.5424"></a><span id="l11.5424" class="difflineminus">-        continue;</span>
<a href="#l11.5425"></a><span id="l11.5425" class="difflineminus">-</span>
<a href="#l11.5426"></a><span id="l11.5426" class="difflineminus">-      nsAutoString  site(hrefStr);</span>
<a href="#l11.5427"></a><span id="l11.5427" class="difflineminus">-</span>
<a href="#l11.5428"></a><span id="l11.5428" class="difflineminus">-#ifdef  DEBUG_SEARCH_OUTPUT</span>
<a href="#l11.5429"></a><span id="l11.5429" class="difflineminus">-      printf(&quot;HREF: '%s'\n&quot;, NS_ConvertUTF16toUTF8(hrefStr).get());</span>
<a href="#l11.5430"></a><span id="l11.5430" class="difflineminus">-#endif</span>
<a href="#l11.5431"></a><span id="l11.5431" class="difflineminus">-</span>
<a href="#l11.5432"></a><span id="l11.5432" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt;  res;</span>
<a href="#l11.5433"></a><span id="l11.5433" class="difflineminus">-</span>
<a href="#l11.5434"></a><span id="l11.5434" class="difflineminus">-      // save HREF attribute as URL</span>
<a href="#l11.5435"></a><span id="l11.5435" class="difflineminus">-      if (NS_SUCCEEDED(rv = mRDFService-&gt;GetAnonymousResource(getter_AddRefs(res))))</span>
<a href="#l11.5436"></a><span id="l11.5436" class="difflineminus">-      {</span>
<a href="#l11.5437"></a><span id="l11.5437" class="difflineminus">-        const PRUnichar *hrefUni = hrefStr.get();</span>
<a href="#l11.5438"></a><span id="l11.5438" class="difflineminus">-        if (hrefUni)</span>
<a href="#l11.5439"></a><span id="l11.5439" class="difflineminus">-        {</span>
<a href="#l11.5440"></a><span id="l11.5440" class="difflineminus">-          nsCOMPtr&lt;nsIRDFLiteral&gt; hrefLiteral;</span>
<a href="#l11.5441"></a><span id="l11.5441" class="difflineminus">-          if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(hrefUni, getter_AddRefs(hrefLiteral))))</span>
<a href="#l11.5442"></a><span id="l11.5442" class="difflineminus">-          {</span>
<a href="#l11.5443"></a><span id="l11.5443" class="difflineminus">-            mInner-&gt;Assert(res, mNC_URL, hrefLiteral, PR_TRUE);</span>
<a href="#l11.5444"></a><span id="l11.5444" class="difflineminus">-          }</span>
<a href="#l11.5445"></a><span id="l11.5445" class="difflineminus">-        }</span>
<a href="#l11.5446"></a><span id="l11.5446" class="difflineminus">-      }</span>
<a href="#l11.5447"></a><span id="l11.5447" class="difflineminus">-</span>
<a href="#l11.5448"></a><span id="l11.5448" class="difflineminus">-      if (NS_FAILED(rv))  continue;</span>
<a href="#l11.5449"></a><span id="l11.5449" class="difflineminus">-      </span>
<a href="#l11.5450"></a><span id="l11.5450" class="difflineminus">-      // set HTML response chunk</span>
<a href="#l11.5451"></a><span id="l11.5451" class="difflineminus">-      const PRUnichar *htmlResponseUni = resultItem.get();</span>
<a href="#l11.5452"></a><span id="l11.5452" class="difflineminus">-      if (htmlResponseUni &amp;&amp; (mBrowserSearchMode &gt; 0))</span>
<a href="#l11.5453"></a><span id="l11.5453" class="difflineminus">-      {</span>
<a href="#l11.5454"></a><span id="l11.5454" class="difflineminus">-        nsCOMPtr&lt;nsIRDFLiteral&gt; htmlResponseLiteral;</span>
<a href="#l11.5455"></a><span id="l11.5455" class="difflineminus">-        if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(htmlResponseUni, getter_AddRefs(htmlResponseLiteral))))</span>
<a href="#l11.5456"></a><span id="l11.5456" class="difflineminus">-        {</span>
<a href="#l11.5457"></a><span id="l11.5457" class="difflineminus">-          if (htmlResponseLiteral)</span>
<a href="#l11.5458"></a><span id="l11.5458" class="difflineminus">-          {</span>
<a href="#l11.5459"></a><span id="l11.5459" class="difflineminus">-            mInner-&gt;Assert(res, mNC_HTML, htmlResponseLiteral, PR_TRUE);</span>
<a href="#l11.5460"></a><span id="l11.5460" class="difflineminus">-          }</span>
<a href="#l11.5461"></a><span id="l11.5461" class="difflineminus">-        }</span>
<a href="#l11.5462"></a><span id="l11.5462" class="difflineminus">-      }</span>
<a href="#l11.5463"></a><span id="l11.5463" class="difflineminus">-      </span>
<a href="#l11.5464"></a><span id="l11.5464" class="difflineminus">-      // set banner (if we have one)</span>
<a href="#l11.5465"></a><span id="l11.5465" class="difflineminus">-      if (bannerLiteral)</span>
<a href="#l11.5466"></a><span id="l11.5466" class="difflineminus">-      {</span>
<a href="#l11.5467"></a><span id="l11.5467" class="difflineminus">-        mInner-&gt;Assert(res, mNC_Banner, bannerLiteral, PR_TRUE);</span>
<a href="#l11.5468"></a><span id="l11.5468" class="difflineminus">-      }</span>
<a href="#l11.5469"></a><span id="l11.5469" class="difflineminus">-</span>
<a href="#l11.5470"></a><span id="l11.5470" class="difflineminus">-      // look for Site (if it isn't already set)</span>
<a href="#l11.5471"></a><span id="l11.5471" class="difflineminus">-      nsCOMPtr&lt;nsIRDFNode&gt;    oldSiteRes = nsnull;</span>
<a href="#l11.5472"></a><span id="l11.5472" class="difflineminus">-      mInner-&gt;GetTarget(res, mNC_Site, PR_TRUE, getter_AddRefs(oldSiteRes));</span>
<a href="#l11.5473"></a><span id="l11.5473" class="difflineminus">-      if (!oldSiteRes)</span>
<a href="#l11.5474"></a><span id="l11.5474" class="difflineminus">-      {</span>
<a href="#l11.5475"></a><span id="l11.5475" class="difflineminus">-        PRInt32 protocolOffset = site.FindChar(':', 0);</span>
<a href="#l11.5476"></a><span id="l11.5476" class="difflineminus">-        if (protocolOffset &gt;= 0)</span>
<a href="#l11.5477"></a><span id="l11.5477" class="difflineminus">-        {</span>
<a href="#l11.5478"></a><span id="l11.5478" class="difflineminus">-          site.Cut(0, protocolOffset+1);</span>
<a href="#l11.5479"></a><span id="l11.5479" class="difflineminus">-          while (site[0] == PRUnichar('/'))</span>
<a href="#l11.5480"></a><span id="l11.5480" class="difflineminus">-          {</span>
<a href="#l11.5481"></a><span id="l11.5481" class="difflineminus">-            site.Cut(0, 1);</span>
<a href="#l11.5482"></a><span id="l11.5482" class="difflineminus">-          }</span>
<a href="#l11.5483"></a><span id="l11.5483" class="difflineminus">-          PRInt32 slashOffset = site.FindChar('/', 0);</span>
<a href="#l11.5484"></a><span id="l11.5484" class="difflineminus">-          if (slashOffset &gt;= 0)</span>
<a href="#l11.5485"></a><span id="l11.5485" class="difflineminus">-          {</span>
<a href="#l11.5486"></a><span id="l11.5486" class="difflineminus">-            site.SetLength(slashOffset);</span>
<a href="#l11.5487"></a><span id="l11.5487" class="difflineminus">-          }</span>
<a href="#l11.5488"></a><span id="l11.5488" class="difflineminus">-          if (!site.IsEmpty())</span>
<a href="#l11.5489"></a><span id="l11.5489" class="difflineminus">-          {</span>
<a href="#l11.5490"></a><span id="l11.5490" class="difflineminus">-            const PRUnichar *siteUni = site.get();</span>
<a href="#l11.5491"></a><span id="l11.5491" class="difflineminus">-            if (siteUni)</span>
<a href="#l11.5492"></a><span id="l11.5492" class="difflineminus">-            {</span>
<a href="#l11.5493"></a><span id="l11.5493" class="difflineminus">-              nsCOMPtr&lt;nsIRDFLiteral&gt; siteLiteral;</span>
<a href="#l11.5494"></a><span id="l11.5494" class="difflineminus">-              if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(siteUni, getter_AddRefs(siteLiteral))))</span>
<a href="#l11.5495"></a><span id="l11.5495" class="difflineminus">-              {</span>
<a href="#l11.5496"></a><span id="l11.5496" class="difflineminus">-                if (siteLiteral)</span>
<a href="#l11.5497"></a><span id="l11.5497" class="difflineminus">-                {</span>
<a href="#l11.5498"></a><span id="l11.5498" class="difflineminus">-                  mInner-&gt;Assert(res, mNC_Site, siteLiteral, PR_TRUE);</span>
<a href="#l11.5499"></a><span id="l11.5499" class="difflineminus">-                }</span>
<a href="#l11.5500"></a><span id="l11.5500" class="difflineminus">-              }</span>
<a href="#l11.5501"></a><span id="l11.5501" class="difflineminus">-            }</span>
<a href="#l11.5502"></a><span id="l11.5502" class="difflineminus">-          }</span>
<a href="#l11.5503"></a><span id="l11.5503" class="difflineminus">-        }</span>
<a href="#l11.5504"></a><span id="l11.5504" class="difflineminus">-      }</span>
<a href="#l11.5505"></a><span id="l11.5505" class="difflineminus">-</span>
<a href="#l11.5506"></a><span id="l11.5506" class="difflineminus">-      // look for name</span>
<a href="#l11.5507"></a><span id="l11.5507" class="difflineminus">-      nsAutoString  nameStr;</span>
<a href="#l11.5508"></a><span id="l11.5508" class="difflineminus">-</span>
<a href="#l11.5509"></a><span id="l11.5509" class="difflineminus">-      if ((!nameStartStr.IsEmpty()) &amp;&amp; (!nameEndStr.IsEmpty()))</span>
<a href="#l11.5510"></a><span id="l11.5510" class="difflineminus">-      {</span>
<a href="#l11.5511"></a><span id="l11.5511" class="difflineminus">-        PRInt32   nameStart;</span>
<a href="#l11.5512"></a><span id="l11.5512" class="difflineminus">-        if ((nameStart = resultItem.Find(nameStartStr, CaseInsensitiveCompare)) &gt;= 0)</span>
<a href="#l11.5513"></a><span id="l11.5513" class="difflineminus">-        {</span>
<a href="#l11.5514"></a><span id="l11.5514" class="difflineminus">-          nameStart += nameStartStr.Length();</span>
<a href="#l11.5515"></a><span id="l11.5515" class="difflineminus">-          PRInt32 nameEnd = resultItem.Find(nameEndStr, nameStart, CaseInsensitiveCompare);</span>
<a href="#l11.5516"></a><span id="l11.5516" class="difflineminus">-          if (nameEnd &gt; nameStart)</span>
<a href="#l11.5517"></a><span id="l11.5517" class="difflineminus">-          {</span>
<a href="#l11.5518"></a><span id="l11.5518" class="difflineminus">-            nameStr = Substring(resultItem, nameStart, nameEnd - nameStart);</span>
<a href="#l11.5519"></a><span id="l11.5519" class="difflineminus">-          }</span>
<a href="#l11.5520"></a><span id="l11.5520" class="difflineminus">-        }</span>
<a href="#l11.5521"></a><span id="l11.5521" class="difflineminus">-      }</span>
<a href="#l11.5522"></a><span id="l11.5522" class="difflineminus">-</span>
<a href="#l11.5523"></a><span id="l11.5523" class="difflineminus">-      if (nameStr.IsEmpty())</span>
<a href="#l11.5524"></a><span id="l11.5524" class="difflineminus">-      {</span>
<a href="#l11.5525"></a><span id="l11.5525" class="difflineminus">-        PRInt32 anchorEnd = resultItem.FindChar('&gt;', quoteEndOffset);</span>
<a href="#l11.5526"></a><span id="l11.5526" class="difflineminus">-        if (anchorEnd &lt; quoteEndOffset)</span>
<a href="#l11.5527"></a><span id="l11.5527" class="difflineminus">-        {</span>
<a href="#l11.5528"></a><span id="l11.5528" class="difflineminus">-#ifdef  DEBUG_SEARCH_OUTPUT</span>
<a href="#l11.5529"></a><span id="l11.5529" class="difflineminus">-          printf(&quot;\n\nSearch: Unable to find ending &gt; when computing name.\n\n&quot;);</span>
<a href="#l11.5530"></a><span id="l11.5530" class="difflineminus">-#endif</span>
<a href="#l11.5531"></a><span id="l11.5531" class="difflineminus">-          continue;</span>
<a href="#l11.5532"></a><span id="l11.5532" class="difflineminus">-        }</span>
<a href="#l11.5533"></a><span id="l11.5533" class="difflineminus">-        PRInt32 anchorStop = resultItem.Find(&quot;&lt;/A&gt;&quot;, PR_TRUE, quoteEndOffset);</span>
<a href="#l11.5534"></a><span id="l11.5534" class="difflineminus">-        if (anchorStop &lt; anchorEnd)</span>
<a href="#l11.5535"></a><span id="l11.5535" class="difflineminus">-        {</span>
<a href="#l11.5536"></a><span id="l11.5536" class="difflineminus">-#ifdef  DEBUG_SEARCH_OUTPUT</span>
<a href="#l11.5537"></a><span id="l11.5537" class="difflineminus">-          printf(&quot;\n\nSearch: Unable to find &lt;/A&gt; tag to compute name.\n\n&quot;);</span>
<a href="#l11.5538"></a><span id="l11.5538" class="difflineminus">-#endif</span>
<a href="#l11.5539"></a><span id="l11.5539" class="difflineminus">-          continue;</span>
<a href="#l11.5540"></a><span id="l11.5540" class="difflineminus">-        }</span>
<a href="#l11.5541"></a><span id="l11.5541" class="difflineminus">-        nameStr = Substring(resultItem, anchorEnd + 1, anchorStop - anchorEnd - 1);</span>
<a href="#l11.5542"></a><span id="l11.5542" class="difflineminus">-      }</span>
<a href="#l11.5543"></a><span id="l11.5543" class="difflineminus">-</span>
<a href="#l11.5544"></a><span id="l11.5544" class="difflineminus">-      ConvertEntities(nameStr);</span>
<a href="#l11.5545"></a><span id="l11.5545" class="difflineminus">-</span>
<a href="#l11.5546"></a><span id="l11.5546" class="difflineminus">-      // look for Name (if it isn't already set)</span>
<a href="#l11.5547"></a><span id="l11.5547" class="difflineminus">-      nsCOMPtr&lt;nsIRDFNode&gt;    oldNameRes = nsnull;</span>
<a href="#l11.5548"></a><span id="l11.5548" class="difflineminus">-      if (!oldNameRes)</span>
<a href="#l11.5549"></a><span id="l11.5549" class="difflineminus">-      {</span>
<a href="#l11.5550"></a><span id="l11.5550" class="difflineminus">-        if (!nameStr.IsEmpty())</span>
<a href="#l11.5551"></a><span id="l11.5551" class="difflineminus">-        {</span>
<a href="#l11.5552"></a><span id="l11.5552" class="difflineminus">-          const PRUnichar *nameUni = nameStr.get();</span>
<a href="#l11.5553"></a><span id="l11.5553" class="difflineminus">-          if (nameUni)</span>
<a href="#l11.5554"></a><span id="l11.5554" class="difflineminus">-          {</span>
<a href="#l11.5555"></a><span id="l11.5555" class="difflineminus">-            nsCOMPtr&lt;nsIRDFLiteral&gt; nameLiteral;</span>
<a href="#l11.5556"></a><span id="l11.5556" class="difflineminus">-            if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(nameUni, getter_AddRefs(nameLiteral))))</span>
<a href="#l11.5557"></a><span id="l11.5557" class="difflineminus">-            {</span>
<a href="#l11.5558"></a><span id="l11.5558" class="difflineminus">-              if (nameLiteral)</span>
<a href="#l11.5559"></a><span id="l11.5559" class="difflineminus">-              {</span>
<a href="#l11.5560"></a><span id="l11.5560" class="difflineminus">-                mInner-&gt;Assert(res, mNC_Name, nameLiteral, PR_TRUE);</span>
<a href="#l11.5561"></a><span id="l11.5561" class="difflineminus">-              }</span>
<a href="#l11.5562"></a><span id="l11.5562" class="difflineminus">-            }</span>
<a href="#l11.5563"></a><span id="l11.5563" class="difflineminus">-          }</span>
<a href="#l11.5564"></a><span id="l11.5564" class="difflineminus">-        }</span>
<a href="#l11.5565"></a><span id="l11.5565" class="difflineminus">-      }</span>
<a href="#l11.5566"></a><span id="l11.5566" class="difflineminus">-</span>
<a href="#l11.5567"></a><span id="l11.5567" class="difflineminus">-      // look for date</span>
<a href="#l11.5568"></a><span id="l11.5568" class="difflineminus">-      if (!dateStartStr.IsEmpty())</span>
<a href="#l11.5569"></a><span id="l11.5569" class="difflineminus">-      {</span>
<a href="#l11.5570"></a><span id="l11.5570" class="difflineminus">-        nsAutoString  dateItem;</span>
<a href="#l11.5571"></a><span id="l11.5571" class="difflineminus">-        PRInt32   dateStart = resultItem.Find(dateStartStr, CaseInsensitiveCompare);</span>
<a href="#l11.5572"></a><span id="l11.5572" class="difflineminus">-        if (dateStart &gt;= 0)</span>
<a href="#l11.5573"></a><span id="l11.5573" class="difflineminus">-        {</span>
<a href="#l11.5574"></a><span id="l11.5574" class="difflineminus">-          dateStart += dateStartStr.Length();</span>
<a href="#l11.5575"></a><span id="l11.5575" class="difflineminus">-          PRInt32 dateEnd = resultItem.Find(dateEndStr, dateStart, CaseInsensitiveCompare);</span>
<a href="#l11.5576"></a><span id="l11.5576" class="difflineminus">-          if (dateEnd &gt; dateStart)</span>
<a href="#l11.5577"></a><span id="l11.5577" class="difflineminus">-          {</span>
<a href="#l11.5578"></a><span id="l11.5578" class="difflineminus">-            dateItem = Substring(resultItem, dateStart, dateEnd - dateStart);</span>
<a href="#l11.5579"></a><span id="l11.5579" class="difflineminus">-          }</span>
<a href="#l11.5580"></a><span id="l11.5580" class="difflineminus">-        }</span>
<a href="#l11.5581"></a><span id="l11.5581" class="difflineminus">-        </span>
<a href="#l11.5582"></a><span id="l11.5582" class="difflineminus">-        // strip out any html tags</span>
<a href="#l11.5583"></a><span id="l11.5583" class="difflineminus">-        PRInt32   ltOffset, gtOffset;</span>
<a href="#l11.5584"></a><span id="l11.5584" class="difflineminus">-        while ((ltOffset = dateItem.FindChar(PRUnichar('&lt;'))) &gt;= 0)</span>
<a href="#l11.5585"></a><span id="l11.5585" class="difflineminus">-        {</span>
<a href="#l11.5586"></a><span id="l11.5586" class="difflineminus">-          if ((gtOffset = dateItem.FindChar(PRUnichar('&gt;'), ltOffset)) &lt;= ltOffset)</span>
<a href="#l11.5587"></a><span id="l11.5587" class="difflineminus">-            break;</span>
<a href="#l11.5588"></a><span id="l11.5588" class="difflineminus">-          dateItem.Cut(ltOffset, gtOffset - ltOffset + 1);</span>
<a href="#l11.5589"></a><span id="l11.5589" class="difflineminus">-        }</span>
<a href="#l11.5590"></a><span id="l11.5590" class="difflineminus">-</span>
<a href="#l11.5591"></a><span id="l11.5591" class="difflineminus">-        // strip out whitespace and any CR/LFs</span>
<a href="#l11.5592"></a><span id="l11.5592" class="difflineminus">-        dateItem.Trim(&quot;\n\r\t &quot;);</span>
<a href="#l11.5593"></a><span id="l11.5593" class="difflineminus">-</span>
<a href="#l11.5594"></a><span id="l11.5594" class="difflineminus">-        if (!dateItem.IsEmpty())</span>
<a href="#l11.5595"></a><span id="l11.5595" class="difflineminus">-        {</span>
<a href="#l11.5596"></a><span id="l11.5596" class="difflineminus">-          const PRUnichar   *dateUni = dateItem.get();</span>
<a href="#l11.5597"></a><span id="l11.5597" class="difflineminus">-          nsCOMPtr&lt;nsIRDFLiteral&gt; dateLiteral;</span>
<a href="#l11.5598"></a><span id="l11.5598" class="difflineminus">-          if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(dateUni, getter_AddRefs(dateLiteral))))</span>
<a href="#l11.5599"></a><span id="l11.5599" class="difflineminus">-          {</span>
<a href="#l11.5600"></a><span id="l11.5600" class="difflineminus">-            if (dateLiteral)</span>
<a href="#l11.5601"></a><span id="l11.5601" class="difflineminus">-            {</span>
<a href="#l11.5602"></a><span id="l11.5602" class="difflineminus">-              mInner-&gt;Assert(res, mNC_Date, dateLiteral, PR_TRUE);</span>
<a href="#l11.5603"></a><span id="l11.5603" class="difflineminus">-              hasDateFlag = PR_TRUE;</span>
<a href="#l11.5604"></a><span id="l11.5604" class="difflineminus">-            }</span>
<a href="#l11.5605"></a><span id="l11.5605" class="difflineminus">-          }</span>
<a href="#l11.5606"></a><span id="l11.5606" class="difflineminus">-        }</span>
<a href="#l11.5607"></a><span id="l11.5607" class="difflineminus">-      }</span>
<a href="#l11.5608"></a><span id="l11.5608" class="difflineminus">-</span>
<a href="#l11.5609"></a><span id="l11.5609" class="difflineminus">-      // look for price</span>
<a href="#l11.5610"></a><span id="l11.5610" class="difflineminus">-      if (!priceStartStr.IsEmpty())</span>
<a href="#l11.5611"></a><span id="l11.5611" class="difflineminus">-      {</span>
<a href="#l11.5612"></a><span id="l11.5612" class="difflineminus">-        nsAutoString  priceItem;</span>
<a href="#l11.5613"></a><span id="l11.5613" class="difflineminus">-        PRInt32   priceStart = resultItem.Find(priceStartStr, CaseInsensitiveCompare);</span>
<a href="#l11.5614"></a><span id="l11.5614" class="difflineminus">-        if (priceStart &gt;= 0)</span>
<a href="#l11.5615"></a><span id="l11.5615" class="difflineminus">-        {</span>
<a href="#l11.5616"></a><span id="l11.5616" class="difflineminus">-          priceStart += priceStartStr.Length();</span>
<a href="#l11.5617"></a><span id="l11.5617" class="difflineminus">-          PRInt32 priceEnd = resultItem.Find(priceEndStr, priceStart, CaseInsensitiveCompare);</span>
<a href="#l11.5618"></a><span id="l11.5618" class="difflineminus">-          if (priceEnd &gt; priceStart)</span>
<a href="#l11.5619"></a><span id="l11.5619" class="difflineminus">-          {</span>
<a href="#l11.5620"></a><span id="l11.5620" class="difflineminus">-            priceItem = Substring(resultItem, priceStart, priceEnd - priceStart);</span>
<a href="#l11.5621"></a><span id="l11.5621" class="difflineminus">-            ConvertEntities(priceItem);</span>
<a href="#l11.5622"></a><span id="l11.5622" class="difflineminus">-          }</span>
<a href="#l11.5623"></a><span id="l11.5623" class="difflineminus">-        }</span>
<a href="#l11.5624"></a><span id="l11.5624" class="difflineminus">-        if (!priceItem.IsEmpty())</span>
<a href="#l11.5625"></a><span id="l11.5625" class="difflineminus">-        {</span>
<a href="#l11.5626"></a><span id="l11.5626" class="difflineminus">-          const PRUnichar   *priceUni = priceItem.get();</span>
<a href="#l11.5627"></a><span id="l11.5627" class="difflineminus">-          nsCOMPtr&lt;nsIRDFLiteral&gt; priceLiteral;</span>
<a href="#l11.5628"></a><span id="l11.5628" class="difflineminus">-          if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(priceUni, getter_AddRefs(priceLiteral))))</span>
<a href="#l11.5629"></a><span id="l11.5629" class="difflineminus">-          {</span>
<a href="#l11.5630"></a><span id="l11.5630" class="difflineminus">-            if (priceLiteral)</span>
<a href="#l11.5631"></a><span id="l11.5631" class="difflineminus">-            {</span>
<a href="#l11.5632"></a><span id="l11.5632" class="difflineminus">-              mInner-&gt;Assert(res, mNC_Price, priceLiteral, PR_TRUE);</span>
<a href="#l11.5633"></a><span id="l11.5633" class="difflineminus">-              hasPriceFlag = PR_TRUE;</span>
<a href="#l11.5634"></a><span id="l11.5634" class="difflineminus">-            }</span>
<a href="#l11.5635"></a><span id="l11.5635" class="difflineminus">-          }</span>
<a href="#l11.5636"></a><span id="l11.5636" class="difflineminus">-</span>
<a href="#l11.5637"></a><span id="l11.5637" class="difflineminus">-          PRInt32 priceCharStartOffset = nsString_FindCharInSet(priceItem, &quot;1234567890&quot;);</span>
<a href="#l11.5638"></a><span id="l11.5638" class="difflineminus">-          if (priceCharStartOffset &gt;= 0)</span>
<a href="#l11.5639"></a><span id="l11.5639" class="difflineminus">-          {</span>
<a href="#l11.5640"></a><span id="l11.5640" class="difflineminus">-            priceItem.Cut(0, priceCharStartOffset);</span>
<a href="#l11.5641"></a><span id="l11.5641" class="difflineminus">-            nsCString priceItemC = NS_LossyConvertUTF16toASCII(priceItem);</span>
<a href="#l11.5642"></a><span id="l11.5642" class="difflineminus">-            float val = (float)PR_strtod(priceItemC.BeginReading(), nsnull);</span>
<a href="#l11.5643"></a><span id="l11.5643" class="difflineminus">-            if (priceItem.FindChar(PRUnichar('.')) &gt;= 0)  val *= 100;</span>
<a href="#l11.5644"></a><span id="l11.5644" class="difflineminus">-</span>
<a href="#l11.5645"></a><span id="l11.5645" class="difflineminus">-            nsCOMPtr&lt;nsIRDFInt&gt; priceSortLiteral;</span>
<a href="#l11.5646"></a><span id="l11.5646" class="difflineminus">-            if (NS_SUCCEEDED(rv = mRDFService-&gt;GetIntLiteral((PRInt32)val, getter_AddRefs(priceSortLiteral))))</span>
<a href="#l11.5647"></a><span id="l11.5647" class="difflineminus">-            {</span>
<a href="#l11.5648"></a><span id="l11.5648" class="difflineminus">-              if (priceSortLiteral)</span>
<a href="#l11.5649"></a><span id="l11.5649" class="difflineminus">-              {</span>
<a href="#l11.5650"></a><span id="l11.5650" class="difflineminus">-                mInner-&gt;Assert(res, mNC_PriceSort, priceSortLiteral, PR_TRUE);</span>
<a href="#l11.5651"></a><span id="l11.5651" class="difflineminus">-              }</span>
<a href="#l11.5652"></a><span id="l11.5652" class="difflineminus">-            }</span>
<a href="#l11.5653"></a><span id="l11.5653" class="difflineminus">-          }</span>
<a href="#l11.5654"></a><span id="l11.5654" class="difflineminus">-        }</span>
<a href="#l11.5655"></a><span id="l11.5655" class="difflineminus">-        // look for availability (if we looked for price)</span>
<a href="#l11.5656"></a><span id="l11.5656" class="difflineminus">-        if (!availStartStr.IsEmpty())</span>
<a href="#l11.5657"></a><span id="l11.5657" class="difflineminus">-        {</span>
<a href="#l11.5658"></a><span id="l11.5658" class="difflineminus">-          nsAutoString  availItem;</span>
<a href="#l11.5659"></a><span id="l11.5659" class="difflineminus">-          PRInt32   availStart = resultItem.Find(availStartStr, CaseInsensitiveCompare);</span>
<a href="#l11.5660"></a><span id="l11.5660" class="difflineminus">-          if (availStart &gt;= 0)</span>
<a href="#l11.5661"></a><span id="l11.5661" class="difflineminus">-          {</span>
<a href="#l11.5662"></a><span id="l11.5662" class="difflineminus">-            availStart += availStartStr.Length();</span>
<a href="#l11.5663"></a><span id="l11.5663" class="difflineminus">-            PRInt32 availEnd = resultItem.Find(availEndStr, availStart, CaseInsensitiveCompare);</span>
<a href="#l11.5664"></a><span id="l11.5664" class="difflineminus">-            if (availEnd &gt; availStart)</span>
<a href="#l11.5665"></a><span id="l11.5665" class="difflineminus">-            {</span>
<a href="#l11.5666"></a><span id="l11.5666" class="difflineminus">-              availItem = Substring(resultItem, availStart, availEnd - availStart);</span>
<a href="#l11.5667"></a><span id="l11.5667" class="difflineminus">-              ConvertEntities(availItem);</span>
<a href="#l11.5668"></a><span id="l11.5668" class="difflineminus">-            }</span>
<a href="#l11.5669"></a><span id="l11.5669" class="difflineminus">-          }</span>
<a href="#l11.5670"></a><span id="l11.5670" class="difflineminus">-          if (!availItem.IsEmpty())</span>
<a href="#l11.5671"></a><span id="l11.5671" class="difflineminus">-          {</span>
<a href="#l11.5672"></a><span id="l11.5672" class="difflineminus">-            const PRUnichar   *availUni = availItem.get();</span>
<a href="#l11.5673"></a><span id="l11.5673" class="difflineminus">-            nsCOMPtr&lt;nsIRDFLiteral&gt; availLiteral;</span>
<a href="#l11.5674"></a><span id="l11.5674" class="difflineminus">-            if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(availUni, getter_AddRefs(availLiteral))))</span>
<a href="#l11.5675"></a><span id="l11.5675" class="difflineminus">-            {</span>
<a href="#l11.5676"></a><span id="l11.5676" class="difflineminus">-              if (availLiteral)</span>
<a href="#l11.5677"></a><span id="l11.5677" class="difflineminus">-              {</span>
<a href="#l11.5678"></a><span id="l11.5678" class="difflineminus">-                mInner-&gt;Assert(res, mNC_Availability, availLiteral, PR_TRUE);</span>
<a href="#l11.5679"></a><span id="l11.5679" class="difflineminus">-                hasAvailabilityFlag = PR_TRUE;</span>
<a href="#l11.5680"></a><span id="l11.5680" class="difflineminus">-              }</span>
<a href="#l11.5681"></a><span id="l11.5681" class="difflineminus">-            }</span>
<a href="#l11.5682"></a><span id="l11.5682" class="difflineminus">-          }</span>
<a href="#l11.5683"></a><span id="l11.5683" class="difflineminus">-        }</span>
<a href="#l11.5684"></a><span id="l11.5684" class="difflineminus">-      }</span>
<a href="#l11.5685"></a><span id="l11.5685" class="difflineminus">-</span>
<a href="#l11.5686"></a><span id="l11.5686" class="difflineminus">-      // look for relevance</span>
<a href="#l11.5687"></a><span id="l11.5687" class="difflineminus">-      nsAutoString  relItem;</span>
<a href="#l11.5688"></a><span id="l11.5688" class="difflineminus">-      PRInt32   relStart = resultItem.Find(relevanceStartStr, CaseInsensitiveCompare);</span>
<a href="#l11.5689"></a><span id="l11.5689" class="difflineminus">-      if (relStart &gt;= 0)</span>
<a href="#l11.5690"></a><span id="l11.5690" class="difflineminus">-      {</span>
<a href="#l11.5691"></a><span id="l11.5691" class="difflineminus">-        relStart += relevanceStartStr.Length();</span>
<a href="#l11.5692"></a><span id="l11.5692" class="difflineminus">-        PRInt32 relEnd = resultItem.Find(relevanceEndStr, CaseInsensitiveCompare);</span>
<a href="#l11.5693"></a><span id="l11.5693" class="difflineminus">-        if (relEnd &gt; relStart)</span>
<a href="#l11.5694"></a><span id="l11.5694" class="difflineminus">-        {</span>
<a href="#l11.5695"></a><span id="l11.5695" class="difflineminus">-          relItem = Substring(resultItem, relStart, relEnd - relStart);</span>
<a href="#l11.5696"></a><span id="l11.5696" class="difflineminus">-        }</span>
<a href="#l11.5697"></a><span id="l11.5697" class="difflineminus">-      }</span>
<a href="#l11.5698"></a><span id="l11.5698" class="difflineminus">-</span>
<a href="#l11.5699"></a><span id="l11.5699" class="difflineminus">-      // look for Relevance (if it isn't already set)</span>
<a href="#l11.5700"></a><span id="l11.5700" class="difflineminus">-      nsCOMPtr&lt;nsIRDFNode&gt;    oldRelRes = nsnull;</span>
<a href="#l11.5701"></a><span id="l11.5701" class="difflineminus">-      if (!oldRelRes)</span>
<a href="#l11.5702"></a><span id="l11.5702" class="difflineminus">-      {</span>
<a href="#l11.5703"></a><span id="l11.5703" class="difflineminus">-        if (!relItem.IsEmpty())</span>
<a href="#l11.5704"></a><span id="l11.5704" class="difflineminus">-        {</span>
<a href="#l11.5705"></a><span id="l11.5705" class="difflineminus">-          // save real relevance</span>
<a href="#l11.5706"></a><span id="l11.5706" class="difflineminus">-          const PRUnichar *relUni = relItem.get();</span>
<a href="#l11.5707"></a><span id="l11.5707" class="difflineminus">-          if (relUni)</span>
<a href="#l11.5708"></a><span id="l11.5708" class="difflineminus">-          {</span>
<a href="#l11.5709"></a><span id="l11.5709" class="difflineminus">-            nsAutoString  relStr(relUni);</span>
<a href="#l11.5710"></a><span id="l11.5710" class="difflineminus">-            // take out any characters that aren't numeric or &quot;%&quot;</span>
<a href="#l11.5711"></a><span id="l11.5711" class="difflineminus">-            PRInt32 len = relStr.Length();</span>
<a href="#l11.5712"></a><span id="l11.5712" class="difflineminus">-            for (PRInt32 x=len-1; x&gt;=0; x--)</span>
<a href="#l11.5713"></a><span id="l11.5713" class="difflineminus">-            {</span>
<a href="#l11.5714"></a><span id="l11.5714" class="difflineminus">-              PRUnichar ch;</span>
<a href="#l11.5715"></a><span id="l11.5715" class="difflineminus">-              ch = relStr.CharAt(x);</span>
<a href="#l11.5716"></a><span id="l11.5716" class="difflineminus">-              if ((ch != PRUnichar('%')) &amp;&amp;</span>
<a href="#l11.5717"></a><span id="l11.5717" class="difflineminus">-                ((ch &lt; PRUnichar('0')) || (ch &gt; PRUnichar('9'))))</span>
<a href="#l11.5718"></a><span id="l11.5718" class="difflineminus">-              {</span>
<a href="#l11.5719"></a><span id="l11.5719" class="difflineminus">-                relStr.Cut(x, 1);</span>
<a href="#l11.5720"></a><span id="l11.5720" class="difflineminus">-              }</span>
<a href="#l11.5721"></a><span id="l11.5721" class="difflineminus">-            }</span>
<a href="#l11.5722"></a><span id="l11.5722" class="difflineminus">-            // make sure it ends with a &quot;%&quot;</span>
<a href="#l11.5723"></a><span id="l11.5723" class="difflineminus">-            len = relStr.Length();</span>
<a href="#l11.5724"></a><span id="l11.5724" class="difflineminus">-            if (len &gt; 0)</span>
<a href="#l11.5725"></a><span id="l11.5725" class="difflineminus">-            {</span>
<a href="#l11.5726"></a><span id="l11.5726" class="difflineminus">-              PRUnichar ch;</span>
<a href="#l11.5727"></a><span id="l11.5727" class="difflineminus">-              ch = relStr.CharAt(len - 1);</span>
<a href="#l11.5728"></a><span id="l11.5728" class="difflineminus">-              if (ch != PRUnichar('%'))</span>
<a href="#l11.5729"></a><span id="l11.5729" class="difflineminus">-              {</span>
<a href="#l11.5730"></a><span id="l11.5730" class="difflineminus">-                relStr += PRUnichar('%');</span>
<a href="#l11.5731"></a><span id="l11.5731" class="difflineminus">-              }</span>
<a href="#l11.5732"></a><span id="l11.5732" class="difflineminus">-              relItem = relStr;</span>
<a href="#l11.5733"></a><span id="l11.5733" class="difflineminus">-              hasRelevanceFlag = PR_TRUE;</span>
<a href="#l11.5734"></a><span id="l11.5734" class="difflineminus">-            }</span>
<a href="#l11.5735"></a><span id="l11.5735" class="difflineminus">-            else</span>
<a href="#l11.5736"></a><span id="l11.5736" class="difflineminus">-            {</span>
<a href="#l11.5737"></a><span id="l11.5737" class="difflineminus">-              relItem.Truncate();</span>
<a href="#l11.5738"></a><span id="l11.5738" class="difflineminus">-            }</span>
<a href="#l11.5739"></a><span id="l11.5739" class="difflineminus">-          }</span>
<a href="#l11.5740"></a><span id="l11.5740" class="difflineminus">-        }</span>
<a href="#l11.5741"></a><span id="l11.5741" class="difflineminus">-        if (relItem.IsEmpty())</span>
<a href="#l11.5742"></a><span id="l11.5742" class="difflineminus">-        {</span>
<a href="#l11.5743"></a><span id="l11.5743" class="difflineminus">-          relItem.AssignLiteral(&quot;-&quot;);</span>
<a href="#l11.5744"></a><span id="l11.5744" class="difflineminus">-        }</span>
<a href="#l11.5745"></a><span id="l11.5745" class="difflineminus">-</span>
<a href="#l11.5746"></a><span id="l11.5746" class="difflineminus">-        const PRUnichar *relItemUni = relItem.get();</span>
<a href="#l11.5747"></a><span id="l11.5747" class="difflineminus">-        nsCOMPtr&lt;nsIRDFLiteral&gt; relLiteral;</span>
<a href="#l11.5748"></a><span id="l11.5748" class="difflineminus">-        if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(relItemUni, getter_AddRefs(relLiteral))))</span>
<a href="#l11.5749"></a><span id="l11.5749" class="difflineminus">-        {</span>
<a href="#l11.5750"></a><span id="l11.5750" class="difflineminus">-          if (relLiteral)</span>
<a href="#l11.5751"></a><span id="l11.5751" class="difflineminus">-          {</span>
<a href="#l11.5752"></a><span id="l11.5752" class="difflineminus">-            mInner-&gt;Assert(res, mNC_Relevance, relLiteral, PR_TRUE);</span>
<a href="#l11.5753"></a><span id="l11.5753" class="difflineminus">-          }</span>
<a href="#l11.5754"></a><span id="l11.5754" class="difflineminus">-        }</span>
<a href="#l11.5755"></a><span id="l11.5755" class="difflineminus">-</span>
<a href="#l11.5756"></a><span id="l11.5756" class="difflineminus">-        if ((!relItem.IsEmpty()) &amp;&amp; (!relItem.EqualsLiteral(&quot;-&quot;)))</span>
<a href="#l11.5757"></a><span id="l11.5757" class="difflineminus">-        {</span>
<a href="#l11.5758"></a><span id="l11.5758" class="difflineminus">-          // If its a percentage, remove &quot;%&quot;</span>
<a href="#l11.5759"></a><span id="l11.5759" class="difflineminus">-          if (relItem[relItem.Length()-1] == PRUnichar('%'))</span>
<a href="#l11.5760"></a><span id="l11.5760" class="difflineminus">-          {</span>
<a href="#l11.5761"></a><span id="l11.5761" class="difflineminus">-            relItem.Cut(relItem.Length()-1, 1);</span>
<a href="#l11.5762"></a><span id="l11.5762" class="difflineminus">-          }</span>
<a href="#l11.5763"></a><span id="l11.5763" class="difflineminus">-</span>
<a href="#l11.5764"></a><span id="l11.5764" class="difflineminus">-          // left-pad with &quot;0&quot;s and set special sorting value</span>
<a href="#l11.5765"></a><span id="l11.5765" class="difflineminus">-          nsAutoString  zero;</span>
<a href="#l11.5766"></a><span id="l11.5766" class="difflineminus">-          zero.AssignLiteral(&quot;000&quot;);</span>
<a href="#l11.5767"></a><span id="l11.5767" class="difflineminus">-          if (relItem.Length() &lt; 3)</span>
<a href="#l11.5768"></a><span id="l11.5768" class="difflineminus">-          {</span>
<a href="#l11.5769"></a><span id="l11.5769" class="difflineminus">-            relItem.Insert(zero.get(), 0, zero.Length() - relItem.Length()); </span>
<a href="#l11.5770"></a><span id="l11.5770" class="difflineminus">-          }</span>
<a href="#l11.5771"></a><span id="l11.5771" class="difflineminus">-        }</span>
<a href="#l11.5772"></a><span id="l11.5772" class="difflineminus">-        else</span>
<a href="#l11.5773"></a><span id="l11.5773" class="difflineminus">-        {</span>
<a href="#l11.5774"></a><span id="l11.5774" class="difflineminus">-          relItem.AssignLiteral(&quot;000&quot;);</span>
<a href="#l11.5775"></a><span id="l11.5775" class="difflineminus">-        }</span>
<a href="#l11.5776"></a><span id="l11.5776" class="difflineminus">-</span>
<a href="#l11.5777"></a><span id="l11.5777" class="difflineminus">-        const PRUnichar *relSortUni = relItem.get();</span>
<a href="#l11.5778"></a><span id="l11.5778" class="difflineminus">-        if (relSortUni)</span>
<a href="#l11.5779"></a><span id="l11.5779" class="difflineminus">-        {</span>
<a href="#l11.5780"></a><span id="l11.5780" class="difflineminus">-          nsCOMPtr&lt;nsIRDFLiteral&gt; relSortLiteral;</span>
<a href="#l11.5781"></a><span id="l11.5781" class="difflineminus">-          if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(relSortUni, getter_AddRefs(relSortLiteral))))</span>
<a href="#l11.5782"></a><span id="l11.5782" class="difflineminus">-          {</span>
<a href="#l11.5783"></a><span id="l11.5783" class="difflineminus">-            if (relSortLiteral)</span>
<a href="#l11.5784"></a><span id="l11.5784" class="difflineminus">-            {</span>
<a href="#l11.5785"></a><span id="l11.5785" class="difflineminus">-              mInner-&gt;Assert(res, mNC_RelevanceSort, relSortLiteral, PR_TRUE);</span>
<a href="#l11.5786"></a><span id="l11.5786" class="difflineminus">-            }</span>
<a href="#l11.5787"></a><span id="l11.5787" class="difflineminus">-          }</span>
<a href="#l11.5788"></a><span id="l11.5788" class="difflineminus">-        }</span>
<a href="#l11.5789"></a><span id="l11.5789" class="difflineminus">-      }</span>
<a href="#l11.5790"></a><span id="l11.5790" class="difflineminus">-</span>
<a href="#l11.5791"></a><span id="l11.5791" class="difflineminus">-      // set reference to engine this came from (if it isn't already set)</span>
<a href="#l11.5792"></a><span id="l11.5792" class="difflineminus">-      nsCOMPtr&lt;nsIRDFNode&gt;    oldEngineRes = nsnull;</span>
<a href="#l11.5793"></a><span id="l11.5793" class="difflineminus">-      if (!oldEngineRes)</span>
<a href="#l11.5794"></a><span id="l11.5794" class="difflineminus">-      {</span>
<a href="#l11.5795"></a><span id="l11.5795" class="difflineminus">-        if (!engineStr.IsEmpty())</span>
<a href="#l11.5796"></a><span id="l11.5796" class="difflineminus">-        {</span>
<a href="#l11.5797"></a><span id="l11.5797" class="difflineminus">-          const PRUnichar   *engineUni = engineStr.get();</span>
<a href="#l11.5798"></a><span id="l11.5798" class="difflineminus">-          nsCOMPtr&lt;nsIRDFLiteral&gt; engineLiteral;</span>
<a href="#l11.5799"></a><span id="l11.5799" class="difflineminus">-          if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(engineUni, getter_AddRefs(engineLiteral))))</span>
<a href="#l11.5800"></a><span id="l11.5800" class="difflineminus">-          {</span>
<a href="#l11.5801"></a><span id="l11.5801" class="difflineminus">-            if (engineLiteral)</span>
<a href="#l11.5802"></a><span id="l11.5802" class="difflineminus">-            {</span>
<a href="#l11.5803"></a><span id="l11.5803" class="difflineminus">-              mInner-&gt;Assert(res, mNC_Engine, engineLiteral, PR_TRUE);</span>
<a href="#l11.5804"></a><span id="l11.5804" class="difflineminus">-            }</span>
<a href="#l11.5805"></a><span id="l11.5805" class="difflineminus">-          }</span>
<a href="#l11.5806"></a><span id="l11.5806" class="difflineminus">-        }</span>
<a href="#l11.5807"></a><span id="l11.5807" class="difflineminus">-      }</span>
<a href="#l11.5808"></a><span id="l11.5808" class="difflineminus">-</span>
<a href="#l11.5809"></a><span id="l11.5809" class="difflineminus">-      // copy the engine's icon reference (if it has one) onto the result node</span>
<a href="#l11.5810"></a><span id="l11.5810" class="difflineminus">-      nsCOMPtr&lt;nsIRDFNode&gt;    engineIconNode = nsnull;</span>
<a href="#l11.5811"></a><span id="l11.5811" class="difflineminus">-      mInner-&gt;GetTarget(mEngine, mNC_Icon, PR_TRUE, getter_AddRefs(engineIconNode));</span>
<a href="#l11.5812"></a><span id="l11.5812" class="difflineminus">-</span>
<a href="#l11.5813"></a><span id="l11.5813" class="difflineminus">-      // if no branding icon, use some default icons</span>
<a href="#l11.5814"></a><span id="l11.5814" class="difflineminus">-      nsAutoString  iconChromeDefault;</span>
<a href="#l11.5815"></a><span id="l11.5815" class="difflineminus">-</span>
<a href="#l11.5816"></a><span id="l11.5816" class="difflineminus">-      if (browserResultTypeStr.LowerCaseEqualsLiteral(&quot;category&quot;))</span>
<a href="#l11.5817"></a><span id="l11.5817" class="difflineminus">-        iconChromeDefault.AssignLiteral(&quot;chrome://communicator/skin/search/category.gif&quot;);</span>
<a href="#l11.5818"></a><span id="l11.5818" class="difflineminus">-      else if ((browserResultTypeStr.LowerCaseEqualsLiteral(&quot;result&quot;)) &amp;&amp; (!engineIconNode))</span>
<a href="#l11.5819"></a><span id="l11.5819" class="difflineminus">-        iconChromeDefault.AssignLiteral(&quot;chrome://communicator/skin/search/result.gif&quot;);</span>
<a href="#l11.5820"></a><span id="l11.5820" class="difflineminus">-</span>
<a href="#l11.5821"></a><span id="l11.5821" class="difflineminus">-      if (!iconChromeDefault.IsEmpty())</span>
<a href="#l11.5822"></a><span id="l11.5822" class="difflineminus">-      {</span>
<a href="#l11.5823"></a><span id="l11.5823" class="difflineminus">-        const PRUnichar   *iconUni = iconChromeDefault.get();</span>
<a href="#l11.5824"></a><span id="l11.5824" class="difflineminus">-        nsCOMPtr&lt;nsIRDFLiteral&gt; iconLiteral;</span>
<a href="#l11.5825"></a><span id="l11.5825" class="difflineminus">-        if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(iconUni, getter_AddRefs(iconLiteral))))</span>
<a href="#l11.5826"></a><span id="l11.5826" class="difflineminus">-        {</span>
<a href="#l11.5827"></a><span id="l11.5827" class="difflineminus">-          if (iconLiteral)</span>
<a href="#l11.5828"></a><span id="l11.5828" class="difflineminus">-          {</span>
<a href="#l11.5829"></a><span id="l11.5829" class="difflineminus">-            mInner-&gt;Assert(res, mNC_Icon, iconLiteral, PR_TRUE);</span>
<a href="#l11.5830"></a><span id="l11.5830" class="difflineminus">-          }</span>
<a href="#l11.5831"></a><span id="l11.5831" class="difflineminus">-        }</span>
<a href="#l11.5832"></a><span id="l11.5832" class="difflineminus">-      }</span>
<a href="#l11.5833"></a><span id="l11.5833" class="difflineminus">-      else if (engineIconNode)</span>
<a href="#l11.5834"></a><span id="l11.5834" class="difflineminus">-      {</span>
<a href="#l11.5835"></a><span id="l11.5835" class="difflineminus">-        rv = mInner-&gt;Assert(res, mNC_Icon, engineIconNode, PR_TRUE);</span>
<a href="#l11.5836"></a><span id="l11.5836" class="difflineminus">-      }</span>
<a href="#l11.5837"></a><span id="l11.5837" class="difflineminus">-</span>
<a href="#l11.5838"></a><span id="l11.5838" class="difflineminus">-      // set result page rank</span>
<a href="#l11.5839"></a><span id="l11.5839" class="difflineminus">-      nsCOMPtr&lt;nsIRDFInt&gt; pageRankLiteral;</span>
<a href="#l11.5840"></a><span id="l11.5840" class="difflineminus">-      if (NS_SUCCEEDED(rv = mRDFService-&gt;GetIntLiteral(pageRank++, getter_AddRefs(pageRankLiteral))))</span>
<a href="#l11.5841"></a><span id="l11.5841" class="difflineminus">-      {</span>
<a href="#l11.5842"></a><span id="l11.5842" class="difflineminus">-        rv = mInner-&gt;Assert(res, mNC_PageRank, pageRankLiteral, PR_TRUE);</span>
<a href="#l11.5843"></a><span id="l11.5843" class="difflineminus">-      }</span>
<a href="#l11.5844"></a><span id="l11.5844" class="difflineminus">-</span>
<a href="#l11.5845"></a><span id="l11.5845" class="difflineminus">-      // set the result type</span>
<a href="#l11.5846"></a><span id="l11.5846" class="difflineminus">-      if (!browserResultTypeStr.IsEmpty())</span>
<a href="#l11.5847"></a><span id="l11.5847" class="difflineminus">-      {</span>
<a href="#l11.5848"></a><span id="l11.5848" class="difflineminus">-        const PRUnichar   *resultTypeUni = browserResultTypeStr.get();</span>
<a href="#l11.5849"></a><span id="l11.5849" class="difflineminus">-        nsCOMPtr&lt;nsIRDFLiteral&gt; resultTypeLiteral;</span>
<a href="#l11.5850"></a><span id="l11.5850" class="difflineminus">-        if (NS_SUCCEEDED(rv = mRDFService-&gt;GetLiteral(resultTypeUni, getter_AddRefs(resultTypeLiteral))))</span>
<a href="#l11.5851"></a><span id="l11.5851" class="difflineminus">-        {</span>
<a href="#l11.5852"></a><span id="l11.5852" class="difflineminus">-          if (resultTypeLiteral)</span>
<a href="#l11.5853"></a><span id="l11.5853" class="difflineminus">-          {</span>
<a href="#l11.5854"></a><span id="l11.5854" class="difflineminus">-            mInner-&gt;Assert(res, mNC_SearchType, resultTypeLiteral, PR_TRUE);</span>
<a href="#l11.5855"></a><span id="l11.5855" class="difflineminus">-          }</span>
<a href="#l11.5856"></a><span id="l11.5856" class="difflineminus">-        }</span>
<a href="#l11.5857"></a><span id="l11.5857" class="difflineminus">-      }</span>
<a href="#l11.5858"></a><span id="l11.5858" class="difflineminus">-</span>
<a href="#l11.5859"></a><span id="l11.5859" class="difflineminus">-      // set the node type</span>
<a href="#l11.5860"></a><span id="l11.5860" class="difflineminus">-      rv = mInner-&gt;Assert(res, mRDF_type, mNC_SearchResult, PR_TRUE);</span>
<a href="#l11.5861"></a><span id="l11.5861" class="difflineminus">-</span>
<a href="#l11.5862"></a><span id="l11.5862" class="difflineminus">-      // Note: always add in parent-child relationship last!  (if it isn't already set)</span>
<a href="#l11.5863"></a><span id="l11.5863" class="difflineminus">-#ifdef  OLDWAY</span>
<a href="#l11.5864"></a><span id="l11.5864" class="difflineminus">-      PRBool    parentHasChildFlag = PR_FALSE;</span>
<a href="#l11.5865"></a><span id="l11.5865" class="difflineminus">-      if (mParent)</span>
<a href="#l11.5866"></a><span id="l11.5866" class="difflineminus">-      {</span>
<a href="#l11.5867"></a><span id="l11.5867" class="difflineminus">-        mInner-&gt;HasAssertion(mParent, mNC_Child, res, PR_TRUE, &amp;parentHasChildFlag);</span>
<a href="#l11.5868"></a><span id="l11.5868" class="difflineminus">-      }</span>
<a href="#l11.5869"></a><span id="l11.5869" class="difflineminus">-      if (!parentHasChildFlag)</span>
<a href="#l11.5870"></a><span id="l11.5870" class="difflineminus">-#endif</span>
<a href="#l11.5871"></a><span id="l11.5871" class="difflineminus">-      {</span>
<a href="#l11.5872"></a><span id="l11.5872" class="difflineminus">-        if (mParent)</span>
<a href="#l11.5873"></a><span id="l11.5873" class="difflineminus">-        {</span>
<a href="#l11.5874"></a><span id="l11.5874" class="difflineminus">-          rv = mInner-&gt;Assert(mParent, mNC_Child, res, PR_TRUE);</span>
<a href="#l11.5875"></a><span id="l11.5875" class="difflineminus">-        }</span>
<a href="#l11.5876"></a><span id="l11.5876" class="difflineminus">-      }</span>
<a href="#l11.5877"></a><span id="l11.5877" class="difflineminus">-</span>
<a href="#l11.5878"></a><span id="l11.5878" class="difflineminus">-      // Persist this under mNC_LastSearchRoot</span>
<a href="#l11.5879"></a><span id="l11.5879" class="difflineminus">-      if (mInner)</span>
<a href="#l11.5880"></a><span id="l11.5880" class="difflineminus">-      {</span>
<a href="#l11.5881"></a><span id="l11.5881" class="difflineminus">-        rv = mInner-&gt;Assert(mNC_LastSearchRoot, mNC_Child, res, PR_TRUE);</span>
<a href="#l11.5882"></a><span id="l11.5882" class="difflineminus">-      }</span>
<a href="#l11.5883"></a><span id="l11.5883" class="difflineminus">-</span>
<a href="#l11.5884"></a><span id="l11.5884" class="difflineminus">-      ++numResults;</span>
<a href="#l11.5885"></a><span id="l11.5885" class="difflineminus">-</span>
<a href="#l11.5886"></a><span id="l11.5886" class="difflineminus">-      // place a cap on the # of results we can process</span>
<a href="#l11.5887"></a><span id="l11.5887" class="difflineminus">-      if (numResults &gt;= MAX_SEARCH_RESULTS_ALLOWED)</span>
<a href="#l11.5888"></a><span id="l11.5888" class="difflineminus">-        break;</span>
<a href="#l11.5889"></a><span id="l11.5889" class="difflineminus">-</span>
<a href="#l11.5890"></a><span id="l11.5890" class="difflineminus">-    }</span>
<a href="#l11.5891"></a><span id="l11.5891" class="difflineminus">-  }</span>
<a href="#l11.5892"></a><span id="l11.5892" class="difflineminus">-</span>
<a href="#l11.5893"></a><span id="l11.5893" class="difflineminus">-  // set hints so that the appropriate columns can be displayed</span>
<a href="#l11.5894"></a><span id="l11.5894" class="difflineminus">-  if (mParent)</span>
<a href="#l11.5895"></a><span id="l11.5895" class="difflineminus">-  {</span>
<a href="#l11.5896"></a><span id="l11.5896" class="difflineminus">-    if (hasPriceFlag)</span>
<a href="#l11.5897"></a><span id="l11.5897" class="difflineminus">-      SetHint(mParent, mNC_Price);</span>
<a href="#l11.5898"></a><span id="l11.5898" class="difflineminus">-    if (hasAvailabilityFlag)</span>
<a href="#l11.5899"></a><span id="l11.5899" class="difflineminus">-      SetHint(mParent, mNC_Availability);</span>
<a href="#l11.5900"></a><span id="l11.5900" class="difflineminus">-    if (hasRelevanceFlag)</span>
<a href="#l11.5901"></a><span id="l11.5901" class="difflineminus">-      SetHint(mParent, mNC_Relevance);</span>
<a href="#l11.5902"></a><span id="l11.5902" class="difflineminus">-    if (hasDateFlag)</span>
<a href="#l11.5903"></a><span id="l11.5903" class="difflineminus">-      SetHint(mParent, mNC_Date);</span>
<a href="#l11.5904"></a><span id="l11.5904" class="difflineminus">-  }</span>
<a href="#l11.5905"></a><span id="l11.5905" class="difflineminus">-</span>
<a href="#l11.5906"></a><span id="l11.5906" class="difflineminus">-#ifdef  DEBUG</span>
<a href="#l11.5907"></a><span id="l11.5907" class="difflineminus">-  PRTime    now2;</span>
<a href="#l11.5908"></a><span id="l11.5908" class="difflineminus">-  now2 = PR_Now();</span>
<a href="#l11.5909"></a><span id="l11.5909" class="difflineminus">-  PRUint64  loadTime64;</span>
<a href="#l11.5910"></a><span id="l11.5910" class="difflineminus">-  LL_SUB(loadTime64, now2, now);</span>
<a href="#l11.5911"></a><span id="l11.5911" class="difflineminus">-  PRUint32  loadTime32;</span>
<a href="#l11.5912"></a><span id="l11.5912" class="difflineminus">-  LL_L2UI(loadTime32, loadTime64);</span>
<a href="#l11.5913"></a><span id="l11.5913" class="difflineminus">-  printf(&quot;Finished processing search results  (%u microseconds)\n&quot;, loadTime32);</span>
<a href="#l11.5914"></a><span id="l11.5914" class="difflineminus">-#endif</span>
<a href="#l11.5915"></a><span id="l11.5915" class="difflineminus">-</span>
<a href="#l11.5916"></a><span id="l11.5916" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.5917"></a><span id="l11.5917" class="difflineminus">-}</span>
<a href="#l11.5918"></a><span id="l11.5918" class="difflineminus">-</span>
<a href="#l11.5919"></a><span id="l11.5919" class="difflineminus">-</span>
<a href="#l11.5920"></a><span id="l11.5920" class="difflineminus">-</span>
<a href="#l11.5921"></a><span id="l11.5921" class="difflineminus">-nsresult</span>
<a href="#l11.5922"></a><span id="l11.5922" class="difflineminus">-InternetSearchDataSource::SetHint(nsIRDFResource *mParent, nsIRDFResource *hintRes)</span>
<a href="#l11.5923"></a><span id="l11.5923" class="difflineminus">-{</span>
<a href="#l11.5924"></a><span id="l11.5924" class="difflineminus">-  if (!mInner)  return(NS_OK);</span>
<a href="#l11.5925"></a><span id="l11.5925" class="difflineminus">-</span>
<a href="#l11.5926"></a><span id="l11.5926" class="difflineminus">-  nsresult  rv;</span>
<a href="#l11.5927"></a><span id="l11.5927" class="difflineminus">-  PRBool    hasAssertionFlag = PR_FALSE;</span>
<a href="#l11.5928"></a><span id="l11.5928" class="difflineminus">-  rv = mInner-&gt;HasAssertion(mParent, hintRes, mTrueLiteral, PR_TRUE,</span>
<a href="#l11.5929"></a><span id="l11.5929" class="difflineminus">-                            &amp;hasAssertionFlag);</span>
<a href="#l11.5930"></a><span id="l11.5930" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; !hasAssertionFlag)</span>
<a href="#l11.5931"></a><span id="l11.5931" class="difflineminus">-  {</span>
<a href="#l11.5932"></a><span id="l11.5932" class="difflineminus">-    rv = mInner-&gt;Assert(mParent, hintRes, mTrueLiteral, PR_TRUE);</span>
<a href="#l11.5933"></a><span id="l11.5933" class="difflineminus">-  }</span>
<a href="#l11.5934"></a><span id="l11.5934" class="difflineminus">-  return(rv);</span>
<a href="#l11.5935"></a><span id="l11.5935" class="difflineminus">-}</span>
<a href="#l11.5936"></a><span id="l11.5936" class="difflineminus">-</span>
<a href="#l11.5937"></a><span id="l11.5937" class="difflineminus">-</span>
<a href="#l11.5938"></a><span id="l11.5938" class="difflineminus">-</span>
<a href="#l11.5939"></a><span id="l11.5939" class="difflineminus">-nsresult</span>
<a href="#l11.5940"></a><span id="l11.5940" class="difflineminus">-InternetSearchDataSource::ConvertEntities(nsString &amp;nameStr, PRBool removeHTMLFlag,</span>
<a href="#l11.5941"></a><span id="l11.5941" class="difflineminus">-          PRBool removeCRLFsFlag, PRBool trimWhiteSpaceFlag)</span>
<a href="#l11.5942"></a><span id="l11.5942" class="difflineminus">-{</span>
<a href="#l11.5943"></a><span id="l11.5943" class="difflineminus">-  PRInt32 startOffset = 0, ampOffset, semiOffset, offset;</span>
<a href="#l11.5944"></a><span id="l11.5944" class="difflineminus">-</span>
<a href="#l11.5945"></a><span id="l11.5945" class="difflineminus">-  // do this before converting entities</span>
<a href="#l11.5946"></a><span id="l11.5946" class="difflineminus">-  if (removeHTMLFlag)</span>
<a href="#l11.5947"></a><span id="l11.5947" class="difflineminus">-  {</span>
<a href="#l11.5948"></a><span id="l11.5948" class="difflineminus">-    // munge out anything inside of HTML &quot;&lt;&quot; / &quot;&gt;&quot; tags</span>
<a href="#l11.5949"></a><span id="l11.5949" class="difflineminus">-    while ((offset = nameStr.FindChar(PRUnichar('&lt;'), 0)) &gt;= 0)</span>
<a href="#l11.5950"></a><span id="l11.5950" class="difflineminus">-    {</span>
<a href="#l11.5951"></a><span id="l11.5951" class="difflineminus">-      PRInt32 offsetEnd = nameStr.FindChar(PRUnichar('&gt;'), offset+1);</span>
<a href="#l11.5952"></a><span id="l11.5952" class="difflineminus">-      if (offsetEnd &lt;= offset)  break;</span>
<a href="#l11.5953"></a><span id="l11.5953" class="difflineminus">-      nameStr.Cut(offset, offsetEnd - offset + 1);</span>
<a href="#l11.5954"></a><span id="l11.5954" class="difflineminus">-    }</span>
<a href="#l11.5955"></a><span id="l11.5955" class="difflineminus">-  }</span>
<a href="#l11.5956"></a><span id="l11.5956" class="difflineminus">-  while ((ampOffset = nameStr.FindChar(PRUnichar('&amp;'), startOffset)) &gt;= 0)</span>
<a href="#l11.5957"></a><span id="l11.5957" class="difflineminus">-  {</span>
<a href="#l11.5958"></a><span id="l11.5958" class="difflineminus">-    if ((semiOffset = nameStr.FindChar(PRUnichar(';'), ampOffset+1)) &lt;= ampOffset)</span>
<a href="#l11.5959"></a><span id="l11.5959" class="difflineminus">-      break;</span>
<a href="#l11.5960"></a><span id="l11.5960" class="difflineminus">-</span>
<a href="#l11.5961"></a><span id="l11.5961" class="difflineminus">-    nsAutoString  entityStr(Substring(nameStr, ampOffset, semiOffset - ampOffset + 1));</span>
<a href="#l11.5962"></a><span id="l11.5962" class="difflineminus">-    nameStr.Cut(ampOffset, semiOffset-ampOffset+1);</span>
<a href="#l11.5963"></a><span id="l11.5963" class="difflineminus">-</span>
<a href="#l11.5964"></a><span id="l11.5964" class="difflineminus">-    PRUnichar entityChar = 0;</span>
<a href="#l11.5965"></a><span id="l11.5965" class="difflineminus">-    if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;quot;&quot;)) entityChar = PRUnichar('\&quot;');</span>
<a href="#l11.5966"></a><span id="l11.5966" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;amp;&quot;)) entityChar = PRUnichar('&amp;');</span>
<a href="#l11.5967"></a><span id="l11.5967" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;nbsp;&quot;))  entityChar = PRUnichar(' ');</span>
<a href="#l11.5968"></a><span id="l11.5968" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;lt;&quot;))    entityChar = PRUnichar('&lt;');</span>
<a href="#l11.5969"></a><span id="l11.5969" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;gt;&quot;))    entityChar = PRUnichar('&gt;');</span>
<a href="#l11.5970"></a><span id="l11.5970" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;iexcl;&quot;)) entityChar = PRUnichar(161);</span>
<a href="#l11.5971"></a><span id="l11.5971" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;cent;&quot;))  entityChar = PRUnichar(162);</span>
<a href="#l11.5972"></a><span id="l11.5972" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;pound;&quot;)) entityChar = PRUnichar(163);</span>
<a href="#l11.5973"></a><span id="l11.5973" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;curren;&quot;))  entityChar = PRUnichar(164);</span>
<a href="#l11.5974"></a><span id="l11.5974" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;yen;&quot;)) entityChar = PRUnichar(165);</span>
<a href="#l11.5975"></a><span id="l11.5975" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;brvbar;&quot;))  entityChar = PRUnichar(166);</span>
<a href="#l11.5976"></a><span id="l11.5976" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;sect;&quot;))  entityChar = PRUnichar(167);</span>
<a href="#l11.5977"></a><span id="l11.5977" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;uml;&quot;)) entityChar = PRUnichar(168);</span>
<a href="#l11.5978"></a><span id="l11.5978" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;copy;&quot;))  entityChar = PRUnichar(169);</span>
<a href="#l11.5979"></a><span id="l11.5979" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ordf;&quot;))  entityChar = PRUnichar(170);</span>
<a href="#l11.5980"></a><span id="l11.5980" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;laquo;&quot;)) entityChar = PRUnichar(171);</span>
<a href="#l11.5981"></a><span id="l11.5981" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;not;&quot;)) entityChar = PRUnichar(172);</span>
<a href="#l11.5982"></a><span id="l11.5982" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;shy;&quot;)) entityChar = PRUnichar(173);</span>
<a href="#l11.5983"></a><span id="l11.5983" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;reg;&quot;)) entityChar = PRUnichar(174);</span>
<a href="#l11.5984"></a><span id="l11.5984" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;macr;&quot;))  entityChar = PRUnichar(175);</span>
<a href="#l11.5985"></a><span id="l11.5985" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;deg;&quot;)) entityChar = PRUnichar(176);</span>
<a href="#l11.5986"></a><span id="l11.5986" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;plusmn;&quot;))  entityChar = PRUnichar(177);</span>
<a href="#l11.5987"></a><span id="l11.5987" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;sup2;&quot;))  entityChar = PRUnichar(178);</span>
<a href="#l11.5988"></a><span id="l11.5988" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;sup3;&quot;))  entityChar = PRUnichar(179);</span>
<a href="#l11.5989"></a><span id="l11.5989" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;acute;&quot;)) entityChar = PRUnichar(180);</span>
<a href="#l11.5990"></a><span id="l11.5990" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;micro;&quot;)) entityChar = PRUnichar(181);</span>
<a href="#l11.5991"></a><span id="l11.5991" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;para;&quot;))  entityChar = PRUnichar(182);</span>
<a href="#l11.5992"></a><span id="l11.5992" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;middot;&quot;))  entityChar = PRUnichar(183);</span>
<a href="#l11.5993"></a><span id="l11.5993" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;cedil;&quot;)) entityChar = PRUnichar(184);</span>
<a href="#l11.5994"></a><span id="l11.5994" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;sup1;&quot;))  entityChar = PRUnichar(185);</span>
<a href="#l11.5995"></a><span id="l11.5995" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ordm;&quot;))  entityChar = PRUnichar(186);</span>
<a href="#l11.5996"></a><span id="l11.5996" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;raquo;&quot;)) entityChar = PRUnichar(187);</span>
<a href="#l11.5997"></a><span id="l11.5997" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;frac14;&quot;))  entityChar = PRUnichar(188);</span>
<a href="#l11.5998"></a><span id="l11.5998" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;frac12;&quot;))  entityChar = PRUnichar(189);</span>
<a href="#l11.5999"></a><span id="l11.5999" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;frac34;&quot;))  entityChar = PRUnichar(190);</span>
<a href="#l11.6000"></a><span id="l11.6000" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;iquest;&quot;))  entityChar = PRUnichar(191);</span>
<a href="#l11.6001"></a><span id="l11.6001" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;agrave;&quot;))  entityChar = PRUnichar(192);</span>
<a href="#l11.6002"></a><span id="l11.6002" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;aacute;&quot;))  entityChar = PRUnichar(193);</span>
<a href="#l11.6003"></a><span id="l11.6003" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;acirc;&quot;)) entityChar = PRUnichar(194);</span>
<a href="#l11.6004"></a><span id="l11.6004" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;atilde;&quot;))  entityChar = PRUnichar(195);</span>
<a href="#l11.6005"></a><span id="l11.6005" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;auml;&quot;))  entityChar = PRUnichar(196);</span>
<a href="#l11.6006"></a><span id="l11.6006" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;aring;&quot;)) entityChar = PRUnichar(197);</span>
<a href="#l11.6007"></a><span id="l11.6007" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;aelig;&quot;)) entityChar = PRUnichar(198);</span>
<a href="#l11.6008"></a><span id="l11.6008" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ccedil;&quot;))  entityChar = PRUnichar(199);</span>
<a href="#l11.6009"></a><span id="l11.6009" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;egrave;&quot;))  entityChar = PRUnichar(200);</span>
<a href="#l11.6010"></a><span id="l11.6010" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;eacute;&quot;))  entityChar = PRUnichar(201);</span>
<a href="#l11.6011"></a><span id="l11.6011" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ecirc;&quot;)) entityChar = PRUnichar(202);</span>
<a href="#l11.6012"></a><span id="l11.6012" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;euml;&quot;))  entityChar = PRUnichar(203);</span>
<a href="#l11.6013"></a><span id="l11.6013" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;igrave;&quot;))  entityChar = PRUnichar(204);</span>
<a href="#l11.6014"></a><span id="l11.6014" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;iacute;&quot;))  entityChar = PRUnichar(205);</span>
<a href="#l11.6015"></a><span id="l11.6015" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;icirc;&quot;)) entityChar = PRUnichar(206);</span>
<a href="#l11.6016"></a><span id="l11.6016" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;iuml;&quot;))  entityChar = PRUnichar(207);</span>
<a href="#l11.6017"></a><span id="l11.6017" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;eth;&quot;)) entityChar = PRUnichar(208);</span>
<a href="#l11.6018"></a><span id="l11.6018" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ntilde;&quot;))  entityChar = PRUnichar(209);</span>
<a href="#l11.6019"></a><span id="l11.6019" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ograve;&quot;))  entityChar = PRUnichar(210);</span>
<a href="#l11.6020"></a><span id="l11.6020" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;oacute;&quot;))  entityChar = PRUnichar(211);</span>
<a href="#l11.6021"></a><span id="l11.6021" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ocirc;&quot;)) entityChar = PRUnichar(212);</span>
<a href="#l11.6022"></a><span id="l11.6022" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;otilde;&quot;))  entityChar = PRUnichar(213);</span>
<a href="#l11.6023"></a><span id="l11.6023" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ouml;&quot;))  entityChar = PRUnichar(214);</span>
<a href="#l11.6024"></a><span id="l11.6024" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;times;&quot;)) entityChar = PRUnichar(215);</span>
<a href="#l11.6025"></a><span id="l11.6025" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;oslash;&quot;))  entityChar = PRUnichar(216);</span>
<a href="#l11.6026"></a><span id="l11.6026" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ugrave;&quot;))  entityChar = PRUnichar(217);</span>
<a href="#l11.6027"></a><span id="l11.6027" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;uacute;&quot;))  entityChar = PRUnichar(218);</span>
<a href="#l11.6028"></a><span id="l11.6028" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ucirc;&quot;)) entityChar = PRUnichar(219);</span>
<a href="#l11.6029"></a><span id="l11.6029" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;uuml;&quot;))  entityChar = PRUnichar(220);</span>
<a href="#l11.6030"></a><span id="l11.6030" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;yacute;&quot;))  entityChar = PRUnichar(221);</span>
<a href="#l11.6031"></a><span id="l11.6031" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;thorn;&quot;)) entityChar = PRUnichar(222);</span>
<a href="#l11.6032"></a><span id="l11.6032" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;szlig;&quot;)) entityChar = PRUnichar(223);</span>
<a href="#l11.6033"></a><span id="l11.6033" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;agrave;&quot;))  entityChar = PRUnichar(224);</span>
<a href="#l11.6034"></a><span id="l11.6034" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;aacute;&quot;))  entityChar = PRUnichar(225);</span>
<a href="#l11.6035"></a><span id="l11.6035" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;acirc;&quot;)) entityChar = PRUnichar(226);</span>
<a href="#l11.6036"></a><span id="l11.6036" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;atilde;&quot;))  entityChar = PRUnichar(227);</span>
<a href="#l11.6037"></a><span id="l11.6037" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;auml;&quot;))  entityChar = PRUnichar(228);</span>
<a href="#l11.6038"></a><span id="l11.6038" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;aring;&quot;)) entityChar = PRUnichar(229);</span>
<a href="#l11.6039"></a><span id="l11.6039" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;aelig;&quot;)) entityChar = PRUnichar(230);</span>
<a href="#l11.6040"></a><span id="l11.6040" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ccedil;&quot;))  entityChar = PRUnichar(231);</span>
<a href="#l11.6041"></a><span id="l11.6041" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;egrave;&quot;))  entityChar = PRUnichar(232);</span>
<a href="#l11.6042"></a><span id="l11.6042" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;eacute;&quot;))  entityChar = PRUnichar(233);</span>
<a href="#l11.6043"></a><span id="l11.6043" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ecirc;&quot;)) entityChar = PRUnichar(234);</span>
<a href="#l11.6044"></a><span id="l11.6044" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;euml;&quot;))  entityChar = PRUnichar(235);</span>
<a href="#l11.6045"></a><span id="l11.6045" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;igrave;&quot;))  entityChar = PRUnichar(236);</span>
<a href="#l11.6046"></a><span id="l11.6046" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;iacute;&quot;))  entityChar = PRUnichar(237);</span>
<a href="#l11.6047"></a><span id="l11.6047" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;icirc;&quot;)) entityChar = PRUnichar(238);</span>
<a href="#l11.6048"></a><span id="l11.6048" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;iuml;&quot;))  entityChar = PRUnichar(239);</span>
<a href="#l11.6049"></a><span id="l11.6049" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;eth;&quot;)) entityChar = PRUnichar(240);</span>
<a href="#l11.6050"></a><span id="l11.6050" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ntilde;&quot;))  entityChar = PRUnichar(241);</span>
<a href="#l11.6051"></a><span id="l11.6051" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ograve;&quot;))  entityChar = PRUnichar(242);</span>
<a href="#l11.6052"></a><span id="l11.6052" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;oacute;&quot;))  entityChar = PRUnichar(243);</span>
<a href="#l11.6053"></a><span id="l11.6053" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ocirc;&quot;)) entityChar = PRUnichar(244);</span>
<a href="#l11.6054"></a><span id="l11.6054" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;otilde;&quot;))  entityChar = PRUnichar(245);</span>
<a href="#l11.6055"></a><span id="l11.6055" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ouml;&quot;))  entityChar = PRUnichar(246);</span>
<a href="#l11.6056"></a><span id="l11.6056" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;divide;&quot;))  entityChar = PRUnichar(247);</span>
<a href="#l11.6057"></a><span id="l11.6057" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;oslash;&quot;))  entityChar = PRUnichar(248);</span>
<a href="#l11.6058"></a><span id="l11.6058" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ugrave;&quot;))  entityChar = PRUnichar(249);</span>
<a href="#l11.6059"></a><span id="l11.6059" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;uacute;&quot;))  entityChar = PRUnichar(250);</span>
<a href="#l11.6060"></a><span id="l11.6060" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;ucirc;&quot;)) entityChar = PRUnichar(251);</span>
<a href="#l11.6061"></a><span id="l11.6061" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;uuml;&quot;))  entityChar = PRUnichar(252);</span>
<a href="#l11.6062"></a><span id="l11.6062" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;yacute;&quot;))  entityChar = PRUnichar(253);</span>
<a href="#l11.6063"></a><span id="l11.6063" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;thorn;&quot;)) entityChar = PRUnichar(254);</span>
<a href="#l11.6064"></a><span id="l11.6064" class="difflineminus">-    else if (entityStr.LowerCaseEqualsLiteral(&quot;&amp;yuml;&quot;))  entityChar = PRUnichar(255);</span>
<a href="#l11.6065"></a><span id="l11.6065" class="difflineminus">-</span>
<a href="#l11.6066"></a><span id="l11.6066" class="difflineminus">-    startOffset = ampOffset;</span>
<a href="#l11.6067"></a><span id="l11.6067" class="difflineminus">-    if (entityChar != 0)</span>
<a href="#l11.6068"></a><span id="l11.6068" class="difflineminus">-    {</span>
<a href="#l11.6069"></a><span id="l11.6069" class="difflineminus">-      nameStr.Insert(entityChar, ampOffset);</span>
<a href="#l11.6070"></a><span id="l11.6070" class="difflineminus">-      ++startOffset;</span>
<a href="#l11.6071"></a><span id="l11.6071" class="difflineminus">-    }</span>
<a href="#l11.6072"></a><span id="l11.6072" class="difflineminus">-  }</span>
<a href="#l11.6073"></a><span id="l11.6073" class="difflineminus">-</span>
<a href="#l11.6074"></a><span id="l11.6074" class="difflineminus">-  if (removeCRLFsFlag)</span>
<a href="#l11.6075"></a><span id="l11.6075" class="difflineminus">-  {</span>
<a href="#l11.6076"></a><span id="l11.6076" class="difflineminus">-    nameStr.StripChars(&quot;\n\r&quot;);</span>
<a href="#l11.6077"></a><span id="l11.6077" class="difflineminus">-  }</span>
<a href="#l11.6078"></a><span id="l11.6078" class="difflineminus">-</span>
<a href="#l11.6079"></a><span id="l11.6079" class="difflineminus">-  if (trimWhiteSpaceFlag)</span>
<a href="#l11.6080"></a><span id="l11.6080" class="difflineminus">-  {</span>
<a href="#l11.6081"></a><span id="l11.6081" class="difflineminus">-    // trim name</span>
<a href="#l11.6082"></a><span id="l11.6082" class="difflineminus">-    nameStr.Trim(&quot; \t&quot;);</span>
<a href="#l11.6083"></a><span id="l11.6083" class="difflineminus">-  }</span>
<a href="#l11.6084"></a><span id="l11.6084" class="difflineminus">-</span>
<a href="#l11.6085"></a><span id="l11.6085" class="difflineminus">-  return(NS_OK);</span>
<a href="#l11.6086"></a><span id="l11.6086" class="difflineminus">-}</span>
<a href="#l11.6087"></a><span id="l11.6087" class="difflineminus">-</span>
<a href="#l11.6088"></a><span id="l11.6088" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l11.6089"></a><span id="l11.6089" class="difflineminus">-InternetSearchDataSource::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *someData)</span>
<a href="#l11.6090"></a><span id="l11.6090" class="difflineminus">-{</span>
<a href="#l11.6091"></a><span id="l11.6091" class="difflineminus">-    nsresult rv = NS_OK;</span>
<a href="#l11.6092"></a><span id="l11.6092" class="difflineminus">-</span>
<a href="#l11.6093"></a><span id="l11.6093" class="difflineminus">-    if (!strcmp(aTopic, &quot;profile-before-change&quot;))</span>
<a href="#l11.6094"></a><span id="l11.6094" class="difflineminus">-    {</span>
<a href="#l11.6095"></a><span id="l11.6095" class="difflineminus">-        // The profile is about to change.</span>
<a href="#l11.6096"></a><span id="l11.6096" class="difflineminus">-        categoryDataSource = nsnull;</span>
<a href="#l11.6097"></a><span id="l11.6097" class="difflineminus">-</span>
<a href="#l11.6098"></a><span id="l11.6098" class="difflineminus">-        if (someData &amp;&amp; NS_LITERAL_STRING(&quot;shutdown-cleanse&quot;).Equals(someData))</span>
<a href="#l11.6099"></a><span id="l11.6099" class="difflineminus">-        {</span>
<a href="#l11.6100"></a><span id="l11.6100" class="difflineminus">-            // Delete search.rdf</span>
<a href="#l11.6101"></a><span id="l11.6101" class="difflineminus">-            nsCOMPtr&lt;nsIFile&gt; searchFile;</span>
<a href="#l11.6102"></a><span id="l11.6102" class="difflineminus">-            rv = NS_GetSpecialDirectory(NS_APP_SEARCH_50_FILE, getter_AddRefs(searchFile));</span>
<a href="#l11.6103"></a><span id="l11.6103" class="difflineminus">-            if (NS_SUCCEEDED(rv))</span>
<a href="#l11.6104"></a><span id="l11.6104" class="difflineminus">-                rv = searchFile-&gt;Remove(PR_FALSE);</span>
<a href="#l11.6105"></a><span id="l11.6105" class="difflineminus">-        }</span>
<a href="#l11.6106"></a><span id="l11.6106" class="difflineminus">-    }</span>
<a href="#l11.6107"></a><span id="l11.6107" class="difflineminus">-    else if (!strcmp(aTopic, &quot;profile-do-change&quot;))</span>
<a href="#l11.6108"></a><span id="l11.6108" class="difflineminus">-    {</span>
<a href="#l11.6109"></a><span id="l11.6109" class="difflineminus">-        // The profile has aleady changed.</span>
<a href="#l11.6110"></a><span id="l11.6110" class="difflineminus">-        if (!categoryDataSource)</span>
<a href="#l11.6111"></a><span id="l11.6111" class="difflineminus">-          GetCategoryList();</span>
<a href="#l11.6112"></a><span id="l11.6112" class="difflineminus">-    }</span>
<a href="#l11.6113"></a><span id="l11.6113" class="difflineminus">-    else if (!strcmp(aTopic, NS_PREFBRANCH_PREFCHANGE_TOPIC_ID))</span>
<a href="#l11.6114"></a><span id="l11.6114" class="difflineminus">-    {</span>
<a href="#l11.6115"></a><span id="l11.6115" class="difflineminus">-        nsCOMPtr&lt;nsIPrefBranch&gt; prefs = do_QueryInterface(aSubject);</span>
<a href="#l11.6116"></a><span id="l11.6116" class="difflineminus">-        if (prefs)</span>
<a href="#l11.6117"></a><span id="l11.6117" class="difflineminus">-        {</span>
<a href="#l11.6118"></a><span id="l11.6118" class="difflineminus">-            prefs-&gt;GetIntPref(&quot;browser.search.mode&quot;, &amp;mBrowserSearchMode);</span>
<a href="#l11.6119"></a><span id="l11.6119" class="difflineminus">-            Assert(mNC_LastSearchRoot, mNC_LastSearchMode, mTrueLiteral, PR_TRUE);</span>
<a href="#l11.6120"></a><span id="l11.6120" class="difflineminus">-        }</span>
<a href="#l11.6121"></a><span id="l11.6121" class="difflineminus">-    }</span>
<a href="#l11.6122"></a><span id="l11.6122" class="difflineminus">-</span>
<a href="#l11.6123"></a><span id="l11.6123" class="difflineminus">-    return rv;</span>
<a href="#l11.6124"></a><span id="l11.6124" class="difflineminus">-}</span>
<a href="#l11.6125"></a><span id="l11.6125" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">deleted file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- a/suite/browser/src/nsInternetSearchService.h</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ /dev/null</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -1,203 +0,0 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineminus">- *</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">- *</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">- * License.</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">- *</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">- *</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">- *</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">- *</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">- *</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">- </span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-#ifndef nsinternetsearchdatasource__h____</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-#define nsinternetsearchdatasource__h____</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-#include &quot;nsStringAPI.h&quot;</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-#include &quot;nsISearchService.h&quot;</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-#include &quot;nsIRDFDataSource.h&quot;</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-#include &quot;nsIStreamListener.h&quot;</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-#include &quot;nsIObserver.h&quot;</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-#include &quot;nsWeakReference.h&quot;</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-#include &quot;nsIRDFService.h&quot;</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-#include &quot;nsIRDFContainerUtils.h&quot;</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-#include &quot;nsITimer.h&quot;</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-#include &quot;nsIChannel.h&quot;</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineminus">-#include &quot;nsILoadGroup.h&quot;</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">-#include &quot;nsCycleCollectionParticipant.h&quot;</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineminus">-</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-class InternetSearchDataSource : public nsIInternetSearchService,</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineminus">-                                 public nsIRDFDataSource,</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineminus">-                                 public nsIStreamListener,</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineminus">-                                 public nsIObserver,</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineminus">-                                 public nsSupportsWeakReference</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-{</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-private:</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-  PRInt32 mBrowserSearchMode;</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-  PRBool  mEngineListBuilt;</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-  // pseudo-constants</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_SearchResult;</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_SearchEngineRoot;</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_LastSearchRoot;</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_LastSearchMode;</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_SearchCategoryRoot;</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_SearchResultsSitesRoot;</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_FilterSearchURLsRoot;</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_FilterSearchSitesRoot;</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_SearchType;</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Ref;</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Child;</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Title;</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Data;</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Name;</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Description;</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Version;</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_actionButton;</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_actionBar;</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_searchForm;</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_LastText;</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_URL;</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mRDF_InstanceOf;</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mRDF_type;</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_loading;</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_HTML;</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Icon;</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_StatusIcon;</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Banner;</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Site;</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Relevance;</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Date;</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_RelevanceSort;</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_PageRank;</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Engine;</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Price;</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_PriceSort;</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Availability;</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_BookmarkSeparator;</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_Update;</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_UpdateIcon;</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_UpdateCheckDays;</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mWEB_LastPingDate;</span>
<a href="#l12.112"></a><span id="l12.112" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mWEB_LastPingModDate;</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mWEB_LastPingContentLen;</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineminus">-</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_SearchCommand_AddToBookmarks;</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_SearchCommand_AddQueryToBookmarks;</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_SearchCommand_FilterResult;</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_SearchCommand_FilterSite;</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; mNC_SearchCommand_ClearFilters;</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineminus">-</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt;  mTrueLiteral;</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineminus">-</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineminus">-protected:</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineminus">-  nsCOMPtr&lt;nsIRDFService&gt;     mRDFService;</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineminus">-  nsCOMPtr&lt;nsIRDFContainerUtils&gt; mRDFC;</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineminus">-  nsCOMPtr&lt;nsIRDFDataSource&gt;  mInner;</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineminus">-  nsCOMPtr&lt;nsIRDFDataSource&gt;  mLocalstore;</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt;  mUpdateArray;</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineminus">-  nsCOMPtr&lt;nsITimer&gt;          mTimer;</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineminus">-  nsCOMPtr&lt;nsILoadGroup&gt;      mBackgroundLoadGroup;</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineminus">-  nsCOMPtr&lt;nsILoadGroup&gt;      mLoadGroup;</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineminus">-  nsCOMPtr&lt;nsIRDFDataSource&gt;  categoryDataSource;</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineminus">-  PRBool                      busySchedule;</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;    busyResource;</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineminus">-  nsString                    mQueryEncodingStr;</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineminus">-</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineminus">-  // helper methods</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineminus">-  nsresult  GetSearchEngineToPing(nsIRDFResource **theResource, nsCString &amp;updateURL);</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineminus">-  PRBool    isEngineURI(nsIRDFResource* aResource);</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineminus">-  PRBool    isSearchURI(nsIRDFResource* aResource);</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineminus">-  PRBool    isSearchCategoryURI(nsIRDFResource* aResource);</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineminus">-  PRBool    isSearchCategoryEngineURI(nsIRDFResource* aResource);</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineminus">-  PRBool    isSearchCommand(nsIRDFResource* aResource);</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineminus">-  nsresult  resolveSearchCategoryEngineURI(nsIRDFResource *source, nsIRDFResource **trueEngine);</span>
<a href="#l12.145"></a><span id="l12.145" class="difflineminus">-  nsresult  BeginSearchRequest(nsIRDFResource *source, PRBool doNetworkRequest);</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineminus">-  nsresult  FindData(nsIRDFResource *engine, nsIRDFLiteral **data);</span>
<a href="#l12.147"></a><span id="l12.147" class="difflineminus">-  nsresult  EngineFileFromResource(nsIRDFResource *aEngineResource,</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineminus">-                                   nsILocalFile **aResult);</span>
<a href="#l12.149"></a><span id="l12.149" class="difflineminus">-  nsresult  updateDataHintsInGraph(nsIRDFResource *engine, const PRUnichar *data);</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineminus">-  nsresult  updateAtom(nsIRDFDataSource *db, nsIRDFResource *src, nsIRDFResource *prop, nsIRDFNode *newValue, PRBool *dirtyFlag);</span>
<a href="#l12.151"></a><span id="l12.151" class="difflineminus">-  nsresult  validateEngine(nsIRDFResource *engine);</span>
<a href="#l12.152"></a><span id="l12.152" class="difflineminus">-  nsresult  DoSearch(nsIRDFResource *source, nsIRDFResource *engine, const nsString &amp;fullURL, const nsString &amp;text);</span>
<a href="#l12.153"></a><span id="l12.153" class="difflineminus">-  nsresult  MapEncoding(const nsString &amp;numericEncoding, </span>
<a href="#l12.154"></a><span id="l12.154" class="difflineminus">-                        nsString &amp;stringEncoding);</span>
<a href="#l12.155"></a><span id="l12.155" class="difflineminus">-  const char * const MapScriptCodeToCharsetName(PRUint32 aScriptCode);</span>
<a href="#l12.156"></a><span id="l12.156" class="difflineminus">-  nsresult  SaveEngineInfoIntoGraph(nsIFile *file, nsIFile *icon, const PRUnichar *hint, const PRUnichar *data, PRBool isSystemSearchFile);</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineminus">-  nsresult  GetSearchEngineList(nsIFile *spec, PRBool isSystemSearchFile);</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineminus">-  nsresult  GetCategoryList();</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineminus">-  nsresult  ReadFileContents(nsILocalFile *baseFilename, nsString &amp; sourceContents);</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineminus">-  nsresult  DecodeData(const char *aCharset, const PRUnichar *aInString, PRUnichar **aOutString);</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineminus">-  nsresult  GetData(const PRUnichar *data, const char *sectionToFind, PRUint32 sectionNum, const char *attribToFind, nsString &amp;value);</span>
<a href="#l12.162"></a><span id="l12.162" class="difflineminus">-  nsresult  GetNumInterpretSections(const PRUnichar *data, PRUint32 &amp;numInterpretSections);</span>
<a href="#l12.163"></a><span id="l12.163" class="difflineminus">-  nsresult  GetInputs(const PRUnichar *data, nsString &amp;engineName, nsString &amp;userVar, const nsString &amp;text, nsString &amp;input, PRInt16 direction, PRUint16 pageNumber, PRUint16 *whichButtons);</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineminus">-  PRInt32   computeIndex(nsAutoString &amp;factor, PRUint16 page, PRInt16 direction);</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineminus">-  nsresult  GetURL(nsIRDFResource *source, nsIRDFLiteral** aResult);</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineminus">-  nsresult  validateEngineNow(nsIRDFResource *engine);</span>
<a href="#l12.167"></a><span id="l12.167" class="difflineminus">-  nsresult  webSearchFinalize(nsIChannel *channel, nsIInternetSearchContext *context);</span>
<a href="#l12.168"></a><span id="l12.168" class="difflineminus">-  nsresult  ParseHTML(nsIURI *aURL, nsIRDFResource *mParent, nsIRDFResource *engine, const PRUnichar *htmlPage, PRInt32 htmlPageSize);</span>
<a href="#l12.169"></a><span id="l12.169" class="difflineminus">-  nsresult  SetHint(nsIRDFResource *mParent, nsIRDFResource *hintRes);</span>
<a href="#l12.170"></a><span id="l12.170" class="difflineminus">-  nsresult  ConvertEntities(nsString &amp;str, PRBool removeHTMLFlag = PR_TRUE, PRBool removeCRLFsFlag = PR_TRUE, PRBool trimWhiteSpaceFlag = PR_TRUE);</span>
<a href="#l12.171"></a><span id="l12.171" class="difflineminus">-  nsresult  saveContents(nsIChannel* channel, nsIInternetSearchContext *context, PRUint32 contextType);</span>
<a href="#l12.172"></a><span id="l12.172" class="difflineminus">-  PRBool    getSearchURI(nsIRDFResource *src, nsAString &amp;_retval);  // returns true on success</span>
<a href="#l12.173"></a><span id="l12.173" class="difflineminus">-  nsresult  addToBookmarks(nsIRDFResource *src);</span>
<a href="#l12.174"></a><span id="l12.174" class="difflineminus">-  nsresult  addQueryToBookmarks(nsIRDFResource *src);</span>
<a href="#l12.175"></a><span id="l12.175" class="difflineminus">-  nsresult  filterResult(nsIRDFResource *src);</span>
<a href="#l12.176"></a><span id="l12.176" class="difflineminus">-  nsresult  filterSite(nsIRDFResource *src);</span>
<a href="#l12.177"></a><span id="l12.177" class="difflineminus">-  nsresult  clearFilters(void);</span>
<a href="#l12.178"></a><span id="l12.178" class="difflineminus">-  PRBool    isSearchResultFiltered(const nsString &amp;href);</span>
<a href="#l12.179"></a><span id="l12.179" class="difflineminus">-</span>
<a href="#l12.180"></a><span id="l12.180" class="difflineminus">-static  void    FireTimer(nsITimer* aTimer, void* aClosure);</span>
<a href="#l12.181"></a><span id="l12.181" class="difflineminus">-</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineminus">-  // Just like AddSearchEngine, but with an extra parameter to include the</span>
<a href="#l12.183"></a><span id="l12.183" class="difflineminus">-  // nsIRDFResource of an existing engines.  If this is a new search engine</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineminus">-  // aOldEngineResource should be null.</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineminus">-  nsresult AddSearchEngineInternal(const char *engineURL,</span>
<a href="#l12.186"></a><span id="l12.186" class="difflineminus">-                                   const char *iconURL,</span>
<a href="#l12.187"></a><span id="l12.187" class="difflineminus">-                                   const PRUnichar *suggestedTitle,</span>
<a href="#l12.188"></a><span id="l12.188" class="difflineminus">-                                   const PRUnichar *suggestedCategory,</span>
<a href="#l12.189"></a><span id="l12.189" class="difflineminus">-                                   nsIRDFResource *aOldEngineResource);</span>
<a href="#l12.190"></a><span id="l12.190" class="difflineminus">-</span>
<a href="#l12.191"></a><span id="l12.191" class="difflineminus">-public:</span>
<a href="#l12.192"></a><span id="l12.192" class="difflineminus">-  NS_DECL_CYCLE_COLLECTING_ISUPPORTS</span>
<a href="#l12.193"></a><span id="l12.193" class="difflineminus">-  NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS(InternetSearchDataSource,</span>
<a href="#l12.194"></a><span id="l12.194" class="difflineminus">-                                           nsIInternetSearchService)</span>
<a href="#l12.195"></a><span id="l12.195" class="difflineminus">-  NS_DECL_NSIINTERNETSEARCHSERVICE</span>
<a href="#l12.196"></a><span id="l12.196" class="difflineminus">-  NS_DECL_NSIREQUESTOBSERVER</span>
<a href="#l12.197"></a><span id="l12.197" class="difflineminus">-  NS_DECL_NSISTREAMLISTENER</span>
<a href="#l12.198"></a><span id="l12.198" class="difflineminus">-  NS_DECL_NSIRDFDATASOURCE</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineminus">-  NS_DECL_NSIOBSERVER</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineminus">-</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineminus">-  InternetSearchDataSource(void);</span>
<a href="#l12.202"></a><span id="l12.202" class="difflineminus">-  virtual    ~InternetSearchDataSource(void);</span>
<a href="#l12.203"></a><span id="l12.203" class="difflineminus">-  NS_METHOD  Init();</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineminus">-  void DeferredInit();</span>
<a href="#l12.205"></a><span id="l12.205" class="difflineminus">-};</span>
<a href="#l12.206"></a><span id="l12.206" class="difflineminus">-</span>
<a href="#l12.207"></a><span id="l12.207" class="difflineminus">-#endif // nsinternetsearchdatasource__h____</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">deleted file mode 100755</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- a/suite/browser/src/nsLocalSearchService.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ /dev/null</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -1,950 +0,0 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 8; c-file-style: &quot;stroustrup&quot; -*- */</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineminus">- *</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">- *</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">- * License.</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">- *</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">- *</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">- *</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineminus">- *   Robert John Churchill      &lt;rjc@netscape.com&gt;</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">- *   Pierre Phaneuf             &lt;pp@ludusdesign.com&gt;</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">- *</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">- *</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-/*</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-  Implementation for a find RDF data store.</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">- */</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-#include &quot;nsLocalSearchService.h&quot;</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-#include &quot;nscore.h&quot;</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-#include &quot;nsIServiceManager.h&quot;</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineminus">-#include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-#include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineminus">-#include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineminus">-#include &quot;plhash.h&quot;</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-#include &quot;plstr.h&quot;</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineminus">-#include &quot;prmem.h&quot;</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineminus">-#include &quot;prprf.h&quot;</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-#include &quot;prio.h&quot;</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-#include &quot;prlog.h&quot;</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-#include &quot;nsITextToSubURI.h&quot;</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineminus">-#include &quot;nsIRDFObserver.h&quot;</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineminus">-#include &quot;nsRDFCID.h&quot;</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineminus">-#include &quot;rdf.h&quot;</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-#include &quot;nsCRTGlue.h&quot;</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-static NS_DEFINE_CID(kRDFServiceCID,               NS_RDFSERVICE_CID);</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-static NS_DEFINE_CID(kTextToSubURICID,             NS_TEXTTOSUBURI_CID);</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineminus">-</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineminus">-static	nsIRDFService		*gRDFService = nsnull;</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineminus">-static	LocalSearchDataSource		*gLocalSearchDataSource = nsnull;</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineminus">-static const char	kFindProtocol[] = &quot;find:&quot;;</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineminus">-</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineminus">-static PRBool</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineminus">-isFindURI(nsIRDFResource *r)</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineminus">-{</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineminus">-	PRBool		isFindURIFlag = PR_FALSE;</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineminus">-	const char	*uri = nsnull;</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineminus">-	</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineminus">-	r-&gt;GetValueConst(&amp;uri);</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineminus">-	if ((uri) &amp;&amp; (!strncmp(uri, kFindProtocol, sizeof(kFindProtocol) - 1)))</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineminus">-	{</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineminus">-		isFindURIFlag = PR_TRUE;</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineminus">-	}</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineminus">-	return(isFindURIFlag);</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineminus">-}</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-PRInt32              LocalSearchDataSource::gRefCnt;</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineminus">-nsIRDFResource		*LocalSearchDataSource::kNC_Child;</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineminus">-nsIRDFResource		*LocalSearchDataSource::kNC_Name;</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineminus">-nsIRDFResource		*LocalSearchDataSource::kNC_URL;</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineminus">-nsIRDFResource		*LocalSearchDataSource::kNC_FindObject;</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineminus">-nsIRDFResource		*LocalSearchDataSource::kNC_pulse;</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineminus">-nsIRDFResource		*LocalSearchDataSource::kRDF_InstanceOf;</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineminus">-nsIRDFResource		*LocalSearchDataSource::kRDF_type;</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineminus">-</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineminus">-LocalSearchDataSource::LocalSearchDataSource(void)</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineminus">-{</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineminus">-	if (gRefCnt++ == 0)</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineminus">-	{</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineminus">-		nsresult rv = CallGetService(kRDFServiceCID, &amp;gRDFService);</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineminus">-</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineminus">-		PR_ASSERT(NS_SUCCEEDED(rv));</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineminus">-</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineminus">-		gRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;child&quot;),</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineminus">-                             &amp;kNC_Child);</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineminus">-		gRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;Name&quot;),</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineminus">-                             &amp;kNC_Name);</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineminus">-		gRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;URL&quot;),</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineminus">-                             &amp;kNC_URL);</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineminus">-		gRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;FindObject&quot;),</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineminus">-                             &amp;kNC_FindObject);</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineminus">-		gRDFService-&gt;GetResource(NS_LITERAL_CSTRING(NC_NAMESPACE_URI &quot;pulse&quot;),</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineminus">-                             &amp;kNC_pulse);</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineminus">-</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineminus">-		gRDFService-&gt;GetResource(NS_LITERAL_CSTRING(RDF_NAMESPACE_URI &quot;instanceOf&quot;),</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineminus">-                             &amp;kRDF_InstanceOf);</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineminus">-		gRDFService-&gt;GetResource(NS_LITERAL_CSTRING(RDF_NAMESPACE_URI &quot;type&quot;),</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineminus">-                             &amp;kRDF_type);</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineminus">-</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineminus">-		gLocalSearchDataSource = this;</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineminus">-	}</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineminus">-}</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineminus">-</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineminus">-</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineminus">-</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineminus">-LocalSearchDataSource::~LocalSearchDataSource (void)</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineminus">-{</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineminus">-	if (--gRefCnt == 0)</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineminus">-	{</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineminus">-		NS_RELEASE(kNC_Child);</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineminus">-		NS_RELEASE(kNC_Name);</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineminus">-		NS_RELEASE(kNC_URL);</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineminus">-		NS_RELEASE(kNC_FindObject);</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineminus">-		NS_RELEASE(kNC_pulse);</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineminus">-		NS_RELEASE(kRDF_InstanceOf);</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineminus">-		NS_RELEASE(kRDF_type);</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineminus">-</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineminus">-		gLocalSearchDataSource = nsnull;</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineminus">-		NS_RELEASE(gRDFService);</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineminus">-	}</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineminus">-}</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineminus">-</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineminus">-</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineminus">-</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineminus">-nsresult</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineminus">-LocalSearchDataSource::Init()</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineminus">-{</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineminus">-	nsresult	rv = NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineminus">-</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineminus">-	// register this as a named data source with the service manager</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineminus">-	if (NS_FAILED(rv = gRDFService-&gt;RegisterDataSource(this, PR_FALSE)))</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineminus">-		return(rv);</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineminus">-</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineminus">-	return(rv);</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineminus">-}</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineminus">-</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineminus">-</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineminus">-</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineminus">-NS_IMPL_ISUPPORTS1(LocalSearchDataSource, nsIRDFDataSource)</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineminus">-</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineminus">-</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineminus">-</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineminus">-LocalSearchDataSource::GetURI(char **uri)</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineminus">-{</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineminus">-	NS_PRECONDITION(uri != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.170"></a><span id="l13.170" class="difflineminus">-	if (! uri)</span>
<a href="#l13.171"></a><span id="l13.171" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.172"></a><span id="l13.172" class="difflineminus">-</span>
<a href="#l13.173"></a><span id="l13.173" class="difflineminus">-	*uri = ToNewCString(NS_LITERAL_CSTRING(&quot;rdf:localsearch&quot;));</span>
<a href="#l13.174"></a><span id="l13.174" class="difflineminus">-	if (! *uri)</span>
<a href="#l13.175"></a><span id="l13.175" class="difflineminus">-		return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineminus">-</span>
<a href="#l13.177"></a><span id="l13.177" class="difflineminus">-	return NS_OK;</span>
<a href="#l13.178"></a><span id="l13.178" class="difflineminus">-}</span>
<a href="#l13.179"></a><span id="l13.179" class="difflineminus">-</span>
<a href="#l13.180"></a><span id="l13.180" class="difflineminus">-</span>
<a href="#l13.181"></a><span id="l13.181" class="difflineminus">-</span>
<a href="#l13.182"></a><span id="l13.182" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineminus">-LocalSearchDataSource::GetSource(nsIRDFResource* property,</span>
<a href="#l13.184"></a><span id="l13.184" class="difflineminus">-                          nsIRDFNode* target,</span>
<a href="#l13.185"></a><span id="l13.185" class="difflineminus">-                          PRBool tv,</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineminus">-                          nsIRDFResource** source /* out */)</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineminus">-{</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineminus">-	NS_PRECONDITION(property != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineminus">-	if (! property)</span>
<a href="#l13.190"></a><span id="l13.190" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.191"></a><span id="l13.191" class="difflineminus">-</span>
<a href="#l13.192"></a><span id="l13.192" class="difflineminus">-	NS_PRECONDITION(target != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.193"></a><span id="l13.193" class="difflineminus">-	if (! target)</span>
<a href="#l13.194"></a><span id="l13.194" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.195"></a><span id="l13.195" class="difflineminus">-</span>
<a href="#l13.196"></a><span id="l13.196" class="difflineminus">-	NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.197"></a><span id="l13.197" class="difflineminus">-	if (! source)</span>
<a href="#l13.198"></a><span id="l13.198" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.199"></a><span id="l13.199" class="difflineminus">-</span>
<a href="#l13.200"></a><span id="l13.200" class="difflineminus">-	*source = nsnull;</span>
<a href="#l13.201"></a><span id="l13.201" class="difflineminus">-	return NS_RDF_NO_VALUE;</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineminus">-}</span>
<a href="#l13.203"></a><span id="l13.203" class="difflineminus">-</span>
<a href="#l13.204"></a><span id="l13.204" class="difflineminus">-</span>
<a href="#l13.205"></a><span id="l13.205" class="difflineminus">-</span>
<a href="#l13.206"></a><span id="l13.206" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.207"></a><span id="l13.207" class="difflineminus">-LocalSearchDataSource::GetSources(nsIRDFResource *property,</span>
<a href="#l13.208"></a><span id="l13.208" class="difflineminus">-                           nsIRDFNode *target,</span>
<a href="#l13.209"></a><span id="l13.209" class="difflineminus">-			   PRBool tv,</span>
<a href="#l13.210"></a><span id="l13.210" class="difflineminus">-                           nsISimpleEnumerator **sources /* out */)</span>
<a href="#l13.211"></a><span id="l13.211" class="difflineminus">-{</span>
<a href="#l13.212"></a><span id="l13.212" class="difflineminus">-	NS_NOTYETIMPLEMENTED(&quot;write me&quot;);</span>
<a href="#l13.213"></a><span id="l13.213" class="difflineminus">-	return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.214"></a><span id="l13.214" class="difflineminus">-}</span>
<a href="#l13.215"></a><span id="l13.215" class="difflineminus">-</span>
<a href="#l13.216"></a><span id="l13.216" class="difflineminus">-</span>
<a href="#l13.217"></a><span id="l13.217" class="difflineminus">-</span>
<a href="#l13.218"></a><span id="l13.218" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.219"></a><span id="l13.219" class="difflineminus">-LocalSearchDataSource::GetTarget(nsIRDFResource *source,</span>
<a href="#l13.220"></a><span id="l13.220" class="difflineminus">-                          nsIRDFResource *property,</span>
<a href="#l13.221"></a><span id="l13.221" class="difflineminus">-                          PRBool tv,</span>
<a href="#l13.222"></a><span id="l13.222" class="difflineminus">-                          nsIRDFNode **target /* out */)</span>
<a href="#l13.223"></a><span id="l13.223" class="difflineminus">-{</span>
<a href="#l13.224"></a><span id="l13.224" class="difflineminus">-	NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.225"></a><span id="l13.225" class="difflineminus">-	if (! source)</span>
<a href="#l13.226"></a><span id="l13.226" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.227"></a><span id="l13.227" class="difflineminus">-</span>
<a href="#l13.228"></a><span id="l13.228" class="difflineminus">-	NS_PRECONDITION(property != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.229"></a><span id="l13.229" class="difflineminus">-	if (! property)</span>
<a href="#l13.230"></a><span id="l13.230" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.231"></a><span id="l13.231" class="difflineminus">-</span>
<a href="#l13.232"></a><span id="l13.232" class="difflineminus">-	NS_PRECONDITION(target != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.233"></a><span id="l13.233" class="difflineminus">-	if (! target)</span>
<a href="#l13.234"></a><span id="l13.234" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.235"></a><span id="l13.235" class="difflineminus">-</span>
<a href="#l13.236"></a><span id="l13.236" class="difflineminus">-	nsresult		rv = NS_RDF_NO_VALUE;</span>
<a href="#l13.237"></a><span id="l13.237" class="difflineminus">-</span>
<a href="#l13.238"></a><span id="l13.238" class="difflineminus">-	// we only have positive assertions in the find data source.</span>
<a href="#l13.239"></a><span id="l13.239" class="difflineminus">-	if (! tv)</span>
<a href="#l13.240"></a><span id="l13.240" class="difflineminus">-		return rv;</span>
<a href="#l13.241"></a><span id="l13.241" class="difflineminus">-</span>
<a href="#l13.242"></a><span id="l13.242" class="difflineminus">-	if (isFindURI(source))</span>
<a href="#l13.243"></a><span id="l13.243" class="difflineminus">-	{</span>
<a href="#l13.244"></a><span id="l13.244" class="difflineminus">-		if (property == kNC_Name)</span>
<a href="#l13.245"></a><span id="l13.245" class="difflineminus">-		{</span>
<a href="#l13.246"></a><span id="l13.246" class="difflineminus">-//			rv = GetName(source, &amp;array);</span>
<a href="#l13.247"></a><span id="l13.247" class="difflineminus">-		}</span>
<a href="#l13.248"></a><span id="l13.248" class="difflineminus">-		else if (property == kNC_URL)</span>
<a href="#l13.249"></a><span id="l13.249" class="difflineminus">-		{</span>
<a href="#l13.250"></a><span id="l13.250" class="difflineminus">-			// note: lie and say there is no URL</span>
<a href="#l13.251"></a><span id="l13.251" class="difflineminus">-//			rv = GetURL(source, &amp;array);</span>
<a href="#l13.252"></a><span id="l13.252" class="difflineminus">-			nsAutoString	url;</span>
<a href="#l13.253"></a><span id="l13.253" class="difflineminus">-			nsIRDFLiteral	*literal;</span>
<a href="#l13.254"></a><span id="l13.254" class="difflineminus">-			rv = gRDFService-&gt;GetLiteral(url.get(), &amp;literal);</span>
<a href="#l13.255"></a><span id="l13.255" class="difflineminus">-			*target = literal;</span>
<a href="#l13.256"></a><span id="l13.256" class="difflineminus">-			return rv;</span>
<a href="#l13.257"></a><span id="l13.257" class="difflineminus">-		}</span>
<a href="#l13.258"></a><span id="l13.258" class="difflineminus">-		else if (property == kRDF_type)</span>
<a href="#l13.259"></a><span id="l13.259" class="difflineminus">-		{</span>
<a href="#l13.260"></a><span id="l13.260" class="difflineminus">-			const char	*uri = nsnull;</span>
<a href="#l13.261"></a><span id="l13.261" class="difflineminus">-			rv = kNC_FindObject-&gt;GetValueConst(&amp;uri);</span>
<a href="#l13.262"></a><span id="l13.262" class="difflineminus">-			if (NS_FAILED(rv)) return rv;</span>
<a href="#l13.263"></a><span id="l13.263" class="difflineminus">-</span>
<a href="#l13.264"></a><span id="l13.264" class="difflineminus">-			NS_ConvertUTF8toUTF16 url(uri);</span>
<a href="#l13.265"></a><span id="l13.265" class="difflineminus">-			nsIRDFLiteral	*literal;</span>
<a href="#l13.266"></a><span id="l13.266" class="difflineminus">-			rv = gRDFService-&gt;GetLiteral(url.get(), &amp;literal);</span>
<a href="#l13.267"></a><span id="l13.267" class="difflineminus">-</span>
<a href="#l13.268"></a><span id="l13.268" class="difflineminus">-			*target = literal;</span>
<a href="#l13.269"></a><span id="l13.269" class="difflineminus">-			return rv;</span>
<a href="#l13.270"></a><span id="l13.270" class="difflineminus">-		}</span>
<a href="#l13.271"></a><span id="l13.271" class="difflineminus">-		else if (property == kNC_pulse)</span>
<a href="#l13.272"></a><span id="l13.272" class="difflineminus">-		{</span>
<a href="#l13.273"></a><span id="l13.273" class="difflineminus">-			nsAutoString	pulse(NS_LITERAL_STRING(&quot;15&quot;));</span>
<a href="#l13.274"></a><span id="l13.274" class="difflineminus">-			nsIRDFLiteral	*pulseLiteral;</span>
<a href="#l13.275"></a><span id="l13.275" class="difflineminus">-			rv = gRDFService-&gt;GetLiteral(pulse.get(), &amp;pulseLiteral);</span>
<a href="#l13.276"></a><span id="l13.276" class="difflineminus">-			if (NS_FAILED(rv)) return rv;</span>
<a href="#l13.277"></a><span id="l13.277" class="difflineminus">-</span>
<a href="#l13.278"></a><span id="l13.278" class="difflineminus">-			*target = pulseLiteral;</span>
<a href="#l13.279"></a><span id="l13.279" class="difflineminus">-			return NS_OK;</span>
<a href="#l13.280"></a><span id="l13.280" class="difflineminus">-		}</span>
<a href="#l13.281"></a><span id="l13.281" class="difflineminus">-		else if (property == kNC_Child)</span>
<a href="#l13.282"></a><span id="l13.282" class="difflineminus">-		{</span>
<a href="#l13.283"></a><span id="l13.283" class="difflineminus">-			// fake out the generic builder (i.e. return anything in this case)</span>
<a href="#l13.284"></a><span id="l13.284" class="difflineminus">-			// so that search containers never appear to be empty</span>
<a href="#l13.285"></a><span id="l13.285" class="difflineminus">-			*target = source;</span>
<a href="#l13.286"></a><span id="l13.286" class="difflineminus">-			NS_ADDREF(*target);</span>
<a href="#l13.287"></a><span id="l13.287" class="difflineminus">-			return(NS_OK);</span>
<a href="#l13.288"></a><span id="l13.288" class="difflineminus">-		}</span>
<a href="#l13.289"></a><span id="l13.289" class="difflineminus">-	}</span>
<a href="#l13.290"></a><span id="l13.290" class="difflineminus">-	return NS_RDF_NO_VALUE;</span>
<a href="#l13.291"></a><span id="l13.291" class="difflineminus">-}</span>
<a href="#l13.292"></a><span id="l13.292" class="difflineminus">-</span>
<a href="#l13.293"></a><span id="l13.293" class="difflineminus">-</span>
<a href="#l13.294"></a><span id="l13.294" class="difflineminus">-</span>
<a href="#l13.295"></a><span id="l13.295" class="difflineminus">-NS_METHOD</span>
<a href="#l13.296"></a><span id="l13.296" class="difflineminus">-LocalSearchDataSource::parseResourceIntoFindTokens(nsIRDFResource *u, findTokenPtr tokens)</span>
<a href="#l13.297"></a><span id="l13.297" class="difflineminus">-{</span>
<a href="#l13.298"></a><span id="l13.298" class="difflineminus">-	const char		*uri = nsnull;</span>
<a href="#l13.299"></a><span id="l13.299" class="difflineminus">-	char			*id, *token, *value, *newstr;</span>
<a href="#l13.300"></a><span id="l13.300" class="difflineminus">-	int			loop;</span>
<a href="#l13.301"></a><span id="l13.301" class="difflineminus">-	nsresult		rv;</span>
<a href="#l13.302"></a><span id="l13.302" class="difflineminus">-</span>
<a href="#l13.303"></a><span id="l13.303" class="difflineminus">-	if (NS_FAILED(rv = u-&gt;GetValueConst(&amp;uri)))	return(rv);</span>
<a href="#l13.304"></a><span id="l13.304" class="difflineminus">-</span>
<a href="#l13.305"></a><span id="l13.305" class="difflineminus">-#ifdef	DEBUG</span>
<a href="#l13.306"></a><span id="l13.306" class="difflineminus">-	printf(&quot;Find: %s\n&quot;, (const char*) uri);</span>
<a href="#l13.307"></a><span id="l13.307" class="difflineminus">-#endif</span>
<a href="#l13.308"></a><span id="l13.308" class="difflineminus">-</span>
<a href="#l13.309"></a><span id="l13.309" class="difflineminus">-	if (!(id = PL_strdup(uri + sizeof(kFindProtocol) - 1)))</span>
<a href="#l13.310"></a><span id="l13.310" class="difflineminus">-		return(NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l13.311"></a><span id="l13.311" class="difflineminus">-</span>
<a href="#l13.312"></a><span id="l13.312" class="difflineminus">-	/* parse ID, build up token list */</span>
<a href="#l13.313"></a><span id="l13.313" class="difflineminus">-	newstr = id;</span>
<a href="#l13.314"></a><span id="l13.314" class="difflineminus">-	if ((token = NS_strtok(&quot;&amp;&quot;, &amp;newstr)) != NULL)</span>
<a href="#l13.315"></a><span id="l13.315" class="difflineminus">-	{</span>
<a href="#l13.316"></a><span id="l13.316" class="difflineminus">-		while (token != NULL)</span>
<a href="#l13.317"></a><span id="l13.317" class="difflineminus">-		{</span>
<a href="#l13.318"></a><span id="l13.318" class="difflineminus">-			if ((value = strstr(token, &quot;=&quot;)) != NULL)</span>
<a href="#l13.319"></a><span id="l13.319" class="difflineminus">-			{</span>
<a href="#l13.320"></a><span id="l13.320" class="difflineminus">-				*value++ = '\0';</span>
<a href="#l13.321"></a><span id="l13.321" class="difflineminus">-			}</span>
<a href="#l13.322"></a><span id="l13.322" class="difflineminus">-			for (loop=0; tokens[loop].token != NULL; loop++)</span>
<a href="#l13.323"></a><span id="l13.323" class="difflineminus">-			{</span>
<a href="#l13.324"></a><span id="l13.324" class="difflineminus">-				if (!strcmp(token, tokens[loop].token))</span>
<a href="#l13.325"></a><span id="l13.325" class="difflineminus">-				{</span>
<a href="#l13.326"></a><span id="l13.326" class="difflineminus">-				    if (!strcmp(token, &quot;text&quot;))</span>
<a href="#l13.327"></a><span id="l13.327" class="difflineminus">-				    {</span>
<a href="#l13.328"></a><span id="l13.328" class="difflineminus">-            			nsCOMPtr&lt;nsITextToSubURI&gt; textToSubURI = </span>
<a href="#l13.329"></a><span id="l13.329" class="difflineminus">-            			         do_GetService(kTextToSubURICID, &amp;rv);</span>
<a href="#l13.330"></a><span id="l13.330" class="difflineminus">-            			if (NS_SUCCEEDED(rv) &amp;&amp; (textToSubURI))</span>
<a href="#l13.331"></a><span id="l13.331" class="difflineminus">-            			{</span>
<a href="#l13.332"></a><span id="l13.332" class="difflineminus">-            				PRUnichar	*uni = nsnull;</span>
<a href="#l13.333"></a><span id="l13.333" class="difflineminus">-            				if (NS_SUCCEEDED(rv = textToSubURI-&gt;UnEscapeAndConvert(&quot;UTF-8&quot;, value, &amp;uni)) &amp;&amp; (uni))</span>
<a href="#l13.334"></a><span id="l13.334" class="difflineminus">-            				{</span>
<a href="#l13.335"></a><span id="l13.335" class="difflineminus">-    					        tokens[loop].value.Adopt(uni);</span>
<a href="#l13.336"></a><span id="l13.336" class="difflineminus">-    					    }</span>
<a href="#l13.337"></a><span id="l13.337" class="difflineminus">-    					}</span>
<a href="#l13.338"></a><span id="l13.338" class="difflineminus">-				    }</span>
<a href="#l13.339"></a><span id="l13.339" class="difflineminus">-				    else</span>
<a href="#l13.340"></a><span id="l13.340" class="difflineminus">-				    {</span>
<a href="#l13.341"></a><span id="l13.341" class="difflineminus">-				        CopyASCIItoUTF16(nsDependentCString(value), tokens[loop].value);</span>
<a href="#l13.342"></a><span id="l13.342" class="difflineminus">-    			    }</span>
<a href="#l13.343"></a><span id="l13.343" class="difflineminus">-					break;</span>
<a href="#l13.344"></a><span id="l13.344" class="difflineminus">-				}</span>
<a href="#l13.345"></a><span id="l13.345" class="difflineminus">-			}</span>
<a href="#l13.346"></a><span id="l13.346" class="difflineminus">-			token = NS_strtok(&quot;&amp;&quot;, &amp;newstr);</span>
<a href="#l13.347"></a><span id="l13.347" class="difflineminus">-		}</span>
<a href="#l13.348"></a><span id="l13.348" class="difflineminus">-	}</span>
<a href="#l13.349"></a><span id="l13.349" class="difflineminus">-	PL_strfree(id);</span>
<a href="#l13.350"></a><span id="l13.350" class="difflineminus">-	return(NS_OK);</span>
<a href="#l13.351"></a><span id="l13.351" class="difflineminus">-}</span>
<a href="#l13.352"></a><span id="l13.352" class="difflineminus">-</span>
<a href="#l13.353"></a><span id="l13.353" class="difflineminus">-</span>
<a href="#l13.354"></a><span id="l13.354" class="difflineminus">-</span>
<a href="#l13.355"></a><span id="l13.355" class="difflineminus">-PRBool</span>
<a href="#l13.356"></a><span id="l13.356" class="difflineminus">-LocalSearchDataSource::doMatch(nsIRDFLiteral *literal,</span>
<a href="#l13.357"></a><span id="l13.357" class="difflineminus">-                               const nsAString &amp;matchMethod,</span>
<a href="#l13.358"></a><span id="l13.358" class="difflineminus">-                               const nsString &amp;matchText)</span>
<a href="#l13.359"></a><span id="l13.359" class="difflineminus">-{</span>
<a href="#l13.360"></a><span id="l13.360" class="difflineminus">-	PRBool		found = PR_FALSE;</span>
<a href="#l13.361"></a><span id="l13.361" class="difflineminus">-</span>
<a href="#l13.362"></a><span id="l13.362" class="difflineminus">-	if ((nsnull == literal) ||</span>
<a href="#l13.363"></a><span id="l13.363" class="difflineminus">-            matchMethod.IsEmpty() ||</span>
<a href="#l13.364"></a><span id="l13.364" class="difflineminus">-            matchText.IsEmpty())</span>
<a href="#l13.365"></a><span id="l13.365" class="difflineminus">-		return(found);</span>
<a href="#l13.366"></a><span id="l13.366" class="difflineminus">-</span>
<a href="#l13.367"></a><span id="l13.367" class="difflineminus">-	const	PRUnichar	*str = nsnull;</span>
<a href="#l13.368"></a><span id="l13.368" class="difflineminus">-	literal-&gt;GetValueConst( &amp;str );</span>
<a href="#l13.369"></a><span id="l13.369" class="difflineminus">-	if (! str)	return(found);</span>
<a href="#l13.370"></a><span id="l13.370" class="difflineminus">-	nsAutoString	value(str);</span>
<a href="#l13.371"></a><span id="l13.371" class="difflineminus">-</span>
<a href="#l13.372"></a><span id="l13.372" class="difflineminus">-        if (matchMethod.EqualsLiteral(&quot;contains&quot;))</span>
<a href="#l13.373"></a><span id="l13.373" class="difflineminus">-	{</span>
<a href="#l13.374"></a><span id="l13.374" class="difflineminus">-            if (-1 != value.Find(matchText, CaseInsensitiveCompare))</span>
<a href="#l13.375"></a><span id="l13.375" class="difflineminus">-                found = PR_TRUE;</span>
<a href="#l13.376"></a><span id="l13.376" class="difflineminus">-	}</span>
<a href="#l13.377"></a><span id="l13.377" class="difflineminus">-        else if (matchMethod.EqualsLiteral(&quot;startswith&quot;))</span>
<a href="#l13.378"></a><span id="l13.378" class="difflineminus">-	{</span>
<a href="#l13.379"></a><span id="l13.379" class="difflineminus">-            if (StringBeginsWith(value, matchText, CaseInsensitiveCompare))</span>
<a href="#l13.380"></a><span id="l13.380" class="difflineminus">-                found = PR_TRUE;</span>
<a href="#l13.381"></a><span id="l13.381" class="difflineminus">-	}</span>
<a href="#l13.382"></a><span id="l13.382" class="difflineminus">-        else if (matchMethod.EqualsLiteral(&quot;endswith&quot;))</span>
<a href="#l13.383"></a><span id="l13.383" class="difflineminus">-	{</span>
<a href="#l13.384"></a><span id="l13.384" class="difflineminus">-            if (StringEndsWith(value, matchText, CaseInsensitiveCompare))</span>
<a href="#l13.385"></a><span id="l13.385" class="difflineminus">-                found = PR_TRUE;</span>
<a href="#l13.386"></a><span id="l13.386" class="difflineminus">-	}</span>
<a href="#l13.387"></a><span id="l13.387" class="difflineminus">-        else if (matchMethod.EqualsLiteral(&quot;is&quot;))</span>
<a href="#l13.388"></a><span id="l13.388" class="difflineminus">-	{</span>
<a href="#l13.389"></a><span id="l13.389" class="difflineminus">-            if (value.Equals(matchText, CaseInsensitiveCompare))</span>
<a href="#l13.390"></a><span id="l13.390" class="difflineminus">-                found = PR_TRUE;</span>
<a href="#l13.391"></a><span id="l13.391" class="difflineminus">-	}</span>
<a href="#l13.392"></a><span id="l13.392" class="difflineminus">-        else if (matchMethod.EqualsLiteral(&quot;isnot&quot;))</span>
<a href="#l13.393"></a><span id="l13.393" class="difflineminus">-	{</span>
<a href="#l13.394"></a><span id="l13.394" class="difflineminus">-            if (!value.Equals(matchText, CaseInsensitiveCompare))</span>
<a href="#l13.395"></a><span id="l13.395" class="difflineminus">-                found = PR_TRUE;</span>
<a href="#l13.396"></a><span id="l13.396" class="difflineminus">-	}</span>
<a href="#l13.397"></a><span id="l13.397" class="difflineminus">-        else if (matchMethod.EqualsLiteral(&quot;doesntcontain&quot;))</span>
<a href="#l13.398"></a><span id="l13.398" class="difflineminus">-	{</span>
<a href="#l13.399"></a><span id="l13.399" class="difflineminus">-            if (-1 == value.Find(matchText, CaseInsensitiveCompare))</span>
<a href="#l13.400"></a><span id="l13.400" class="difflineminus">-                found = PR_TRUE;</span>
<a href="#l13.401"></a><span id="l13.401" class="difflineminus">-	}</span>
<a href="#l13.402"></a><span id="l13.402" class="difflineminus">-        return(found);</span>
<a href="#l13.403"></a><span id="l13.403" class="difflineminus">-}</span>
<a href="#l13.404"></a><span id="l13.404" class="difflineminus">-</span>
<a href="#l13.405"></a><span id="l13.405" class="difflineminus">-PRBool</span>
<a href="#l13.406"></a><span id="l13.406" class="difflineminus">-LocalSearchDataSource::doDateMatch(nsIRDFDate *aDate,</span>
<a href="#l13.407"></a><span id="l13.407" class="difflineminus">-                                   const nsAString&amp; matchMethod,</span>
<a href="#l13.408"></a><span id="l13.408" class="difflineminus">-                                   const nsAString&amp; matchText)</span>
<a href="#l13.409"></a><span id="l13.409" class="difflineminus">-{</span>
<a href="#l13.410"></a><span id="l13.410" class="difflineminus">-    PRBool found = PR_FALSE;</span>
<a href="#l13.411"></a><span id="l13.411" class="difflineminus">-    </span>
<a href="#l13.412"></a><span id="l13.412" class="difflineminus">-    if (matchMethod.EqualsLiteral(&quot;isbefore&quot;) ||</span>
<a href="#l13.413"></a><span id="l13.413" class="difflineminus">-        matchMethod.EqualsLiteral(&quot;isafter&quot;))</span>
<a href="#l13.414"></a><span id="l13.414" class="difflineminus">-    {</span>
<a href="#l13.415"></a><span id="l13.415" class="difflineminus">-        PRInt64 matchDate;</span>
<a href="#l13.416"></a><span id="l13.416" class="difflineminus">-        nsresult rv = parseDate(matchText, &amp;matchDate);</span>
<a href="#l13.417"></a><span id="l13.417" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l13.418"></a><span id="l13.418" class="difflineminus">-            found = dateMatches(aDate, matchMethod, matchDate);</span>
<a href="#l13.419"></a><span id="l13.419" class="difflineminus">-    }</span>
<a href="#l13.420"></a><span id="l13.420" class="difflineminus">-</span>
<a href="#l13.421"></a><span id="l13.421" class="difflineminus">-    return found;</span>
<a href="#l13.422"></a><span id="l13.422" class="difflineminus">-}</span>
<a href="#l13.423"></a><span id="l13.423" class="difflineminus">-</span>
<a href="#l13.424"></a><span id="l13.424" class="difflineminus">-PRBool</span>
<a href="#l13.425"></a><span id="l13.425" class="difflineminus">-LocalSearchDataSource::doIntMatch(nsIRDFInt *aInt,</span>
<a href="#l13.426"></a><span id="l13.426" class="difflineminus">-                                  const nsAString&amp; matchMethod,</span>
<a href="#l13.427"></a><span id="l13.427" class="difflineminus">-                                  const nsString&amp; matchText)</span>
<a href="#l13.428"></a><span id="l13.428" class="difflineminus">-{</span>
<a href="#l13.429"></a><span id="l13.429" class="difflineminus">-    nsresult rv;</span>
<a href="#l13.430"></a><span id="l13.430" class="difflineminus">-    PRBool found = PR_FALSE;</span>
<a href="#l13.431"></a><span id="l13.431" class="difflineminus">-    </span>
<a href="#l13.432"></a><span id="l13.432" class="difflineminus">-    PRInt32 val;</span>
<a href="#l13.433"></a><span id="l13.433" class="difflineminus">-    rv = aInt-&gt;GetValue(&amp;val);</span>
<a href="#l13.434"></a><span id="l13.434" class="difflineminus">-    if (NS_FAILED(rv)) return PR_FALSE;</span>
<a href="#l13.435"></a><span id="l13.435" class="difflineminus">-    </span>
<a href="#l13.436"></a><span id="l13.436" class="difflineminus">-    PRInt32 matchVal = matchText.ToInteger(&amp;rv);</span>
<a href="#l13.437"></a><span id="l13.437" class="difflineminus">-    if (NS_FAILED(rv)) return PR_FALSE;</span>
<a href="#l13.438"></a><span id="l13.438" class="difflineminus">-    </span>
<a href="#l13.439"></a><span id="l13.439" class="difflineminus">-    if (matchMethod.EqualsLiteral(&quot;is&quot;))</span>
<a href="#l13.440"></a><span id="l13.440" class="difflineminus">-        found = (val == matchVal);</span>
<a href="#l13.441"></a><span id="l13.441" class="difflineminus">-    else if (matchMethod.EqualsLiteral(&quot;isgreater&quot;))</span>
<a href="#l13.442"></a><span id="l13.442" class="difflineminus">-        found = (val &gt; matchVal);</span>
<a href="#l13.443"></a><span id="l13.443" class="difflineminus">-    else if (matchMethod.EqualsLiteral(&quot;isless&quot;))</span>
<a href="#l13.444"></a><span id="l13.444" class="difflineminus">-        found = (val &lt; matchVal);</span>
<a href="#l13.445"></a><span id="l13.445" class="difflineminus">-</span>
<a href="#l13.446"></a><span id="l13.446" class="difflineminus">-    return found;</span>
<a href="#l13.447"></a><span id="l13.447" class="difflineminus">-}</span>
<a href="#l13.448"></a><span id="l13.448" class="difflineminus">-</span>
<a href="#l13.449"></a><span id="l13.449" class="difflineminus">-NS_METHOD</span>
<a href="#l13.450"></a><span id="l13.450" class="difflineminus">-LocalSearchDataSource::parseDate(const nsAString&amp; aDate,</span>
<a href="#l13.451"></a><span id="l13.451" class="difflineminus">-                                 PRInt64 *aResult)</span>
<a href="#l13.452"></a><span id="l13.452" class="difflineminus">-{</span>
<a href="#l13.453"></a><span id="l13.453" class="difflineminus">-    // date is in the form of msec since epoch, but use NSPR to</span>
<a href="#l13.454"></a><span id="l13.454" class="difflineminus">-    // parse the time</span>
<a href="#l13.455"></a><span id="l13.455" class="difflineminus">-    PRTime *outTime = static_cast&lt;PRTime*&gt;(aResult);</span>
<a href="#l13.456"></a><span id="l13.456" class="difflineminus">-    PRStatus err;</span>
<a href="#l13.457"></a><span id="l13.457" class="difflineminus">-    err = PR_ParseTimeString(NS_ConvertUTF16toUTF8(aDate).get(),</span>
<a href="#l13.458"></a><span id="l13.458" class="difflineminus">-                             PR_FALSE, // PR_FALSE == use current timezone</span>
<a href="#l13.459"></a><span id="l13.459" class="difflineminus">-                             outTime);</span>
<a href="#l13.460"></a><span id="l13.460" class="difflineminus">-    NS_ENSURE_TRUE(err == 0, NS_ERROR_FAILURE);</span>
<a href="#l13.461"></a><span id="l13.461" class="difflineminus">-    </span>
<a href="#l13.462"></a><span id="l13.462" class="difflineminus">-    return NS_OK;</span>
<a href="#l13.463"></a><span id="l13.463" class="difflineminus">-}</span>
<a href="#l13.464"></a><span id="l13.464" class="difflineminus">-</span>
<a href="#l13.465"></a><span id="l13.465" class="difflineminus">-</span>
<a href="#l13.466"></a><span id="l13.466" class="difflineminus">-PRBool</span>
<a href="#l13.467"></a><span id="l13.467" class="difflineminus">-LocalSearchDataSource::dateMatches(nsIRDFDate *aDate,</span>
<a href="#l13.468"></a><span id="l13.468" class="difflineminus">-                                   const nsAString&amp; method,</span>
<a href="#l13.469"></a><span id="l13.469" class="difflineminus">-                                   const PRInt64&amp; matchDate)</span>
<a href="#l13.470"></a><span id="l13.470" class="difflineminus">-{</span>
<a href="#l13.471"></a><span id="l13.471" class="difflineminus">-    PRInt64 date;</span>
<a href="#l13.472"></a><span id="l13.472" class="difflineminus">-    aDate-&gt;GetValue(&amp;date);</span>
<a href="#l13.473"></a><span id="l13.473" class="difflineminus">-    PRBool matches = PR_FALSE;</span>
<a href="#l13.474"></a><span id="l13.474" class="difflineminus">-    </span>
<a href="#l13.475"></a><span id="l13.475" class="difflineminus">-    if (method.EqualsLiteral(&quot;isbefore&quot;))</span>
<a href="#l13.476"></a><span id="l13.476" class="difflineminus">-        matches = LL_CMP(date, &lt;, matchDate);</span>
<a href="#l13.477"></a><span id="l13.477" class="difflineminus">-    </span>
<a href="#l13.478"></a><span id="l13.478" class="difflineminus">-    else if (method.EqualsLiteral(&quot;isafter&quot;))</span>
<a href="#l13.479"></a><span id="l13.479" class="difflineminus">-        matches = LL_CMP(date, &gt;, matchDate);</span>
<a href="#l13.480"></a><span id="l13.480" class="difflineminus">-</span>
<a href="#l13.481"></a><span id="l13.481" class="difflineminus">-    else if (method.EqualsLiteral(&quot;is&quot;))</span>
<a href="#l13.482"></a><span id="l13.482" class="difflineminus">-        matches = LL_EQ(date, matchDate);</span>
<a href="#l13.483"></a><span id="l13.483" class="difflineminus">-</span>
<a href="#l13.484"></a><span id="l13.484" class="difflineminus">-    return matches;</span>
<a href="#l13.485"></a><span id="l13.485" class="difflineminus">-}</span>
<a href="#l13.486"></a><span id="l13.486" class="difflineminus">-</span>
<a href="#l13.487"></a><span id="l13.487" class="difflineminus">-</span>
<a href="#l13.488"></a><span id="l13.488" class="difflineminus">-NS_METHOD</span>
<a href="#l13.489"></a><span id="l13.489" class="difflineminus">-LocalSearchDataSource::parseFindURL(nsIRDFResource *u, nsIMutableArray *array)</span>
<a href="#l13.490"></a><span id="l13.490" class="difflineminus">-{</span>
<a href="#l13.491"></a><span id="l13.491" class="difflineminus">-  findTokenStruct		tokens[5];</span>
<a href="#l13.492"></a><span id="l13.492" class="difflineminus">-  nsresult rv;</span>
<a href="#l13.493"></a><span id="l13.493" class="difflineminus">-</span>
<a href="#l13.494"></a><span id="l13.494" class="difflineminus">-  // build up a token list</span>
<a href="#l13.495"></a><span id="l13.495" class="difflineminus">-  tokens[0].token = &quot;datasource&quot;;</span>
<a href="#l13.496"></a><span id="l13.496" class="difflineminus">-  tokens[1].token = &quot;match&quot;;</span>
<a href="#l13.497"></a><span id="l13.497" class="difflineminus">-  tokens[2].token = &quot;method&quot;;</span>
<a href="#l13.498"></a><span id="l13.498" class="difflineminus">-  tokens[3].token = &quot;text&quot;;</span>
<a href="#l13.499"></a><span id="l13.499" class="difflineminus">-  tokens[4].token = NULL;</span>
<a href="#l13.500"></a><span id="l13.500" class="difflineminus">-</span>
<a href="#l13.501"></a><span id="l13.501" class="difflineminus">-  // parse find URI, get parameters, search in appropriate</span>
<a href="#l13.502"></a><span id="l13.502" class="difflineminus">-  // datasource(s), return results</span>
<a href="#l13.503"></a><span id="l13.503" class="difflineminus">-  rv = parseResourceIntoFindTokens(u, tokens);</span>
<a href="#l13.504"></a><span id="l13.504" class="difflineminus">-  if (NS_FAILED(rv)) </span>
<a href="#l13.505"></a><span id="l13.505" class="difflineminus">-    return rv;</span>
<a href="#l13.506"></a><span id="l13.506" class="difflineminus">-</span>
<a href="#l13.507"></a><span id="l13.507" class="difflineminus">-  nsCAutoString dsName;</span>
<a href="#l13.508"></a><span id="l13.508" class="difflineminus">-  dsName.Assign(NS_LossyConvertUTF16toASCII(tokens[0].value));</span>
<a href="#l13.509"></a><span id="l13.509" class="difflineminus">-</span>
<a href="#l13.510"></a><span id="l13.510" class="difflineminus">-  nsCOMPtr&lt;nsIRDFDataSource&gt; datasource;</span>
<a href="#l13.511"></a><span id="l13.511" class="difflineminus">-  rv = gRDFService-&gt;GetDataSource(dsName.get(), getter_AddRefs(datasource));</span>
<a href="#l13.512"></a><span id="l13.512" class="difflineminus">-  if (NS_FAILED(rv)) </span>
<a href="#l13.513"></a><span id="l13.513" class="difflineminus">-    return rv;</span>
<a href="#l13.514"></a><span id="l13.514" class="difflineminus">-</span>
<a href="#l13.515"></a><span id="l13.515" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; cursor;</span>
<a href="#l13.516"></a><span id="l13.516" class="difflineminus">-  rv = datasource-&gt;GetAllResources(getter_AddRefs(cursor));</span>
<a href="#l13.517"></a><span id="l13.517" class="difflineminus">-  if (NS_FAILED(rv)) </span>
<a href="#l13.518"></a><span id="l13.518" class="difflineminus">-    return rv;</span>
<a href="#l13.519"></a><span id="l13.519" class="difflineminus">-        </span>
<a href="#l13.520"></a><span id="l13.520" class="difflineminus">-  while (PR_TRUE) {</span>
<a href="#l13.521"></a><span id="l13.521" class="difflineminus">-    PRBool hasMore;</span>
<a href="#l13.522"></a><span id="l13.522" class="difflineminus">-    rv = cursor-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l13.523"></a><span id="l13.523" class="difflineminus">-    if (NS_FAILED(rv)) </span>
<a href="#l13.524"></a><span id="l13.524" class="difflineminus">-      break;</span>
<a href="#l13.525"></a><span id="l13.525" class="difflineminus">-</span>
<a href="#l13.526"></a><span id="l13.526" class="difflineminus">-    if (!hasMore) </span>
<a href="#l13.527"></a><span id="l13.527" class="difflineminus">-      break;</span>
<a href="#l13.528"></a><span id="l13.528" class="difflineminus">-</span>
<a href="#l13.529"></a><span id="l13.529" class="difflineminus">-    nsCOMPtr&lt;nsISupports&gt; isupports;</span>
<a href="#l13.530"></a><span id="l13.530" class="difflineminus">-    rv = cursor-&gt;GetNext(getter_AddRefs(isupports));</span>
<a href="#l13.531"></a><span id="l13.531" class="difflineminus">-    if (NS_FAILED(rv)) </span>
<a href="#l13.532"></a><span id="l13.532" class="difflineminus">-      continue;</span>
<a href="#l13.533"></a><span id="l13.533" class="difflineminus">-</span>
<a href="#l13.534"></a><span id="l13.534" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt; source(do_QueryInterface(isupports));</span>
<a href="#l13.535"></a><span id="l13.535" class="difflineminus">-    if (!source) </span>
<a href="#l13.536"></a><span id="l13.536" class="difflineminus">-      continue;</span>
<a href="#l13.537"></a><span id="l13.537" class="difflineminus">-</span>
<a href="#l13.538"></a><span id="l13.538" class="difflineminus">-    const char	*uri = nsnull;</span>
<a href="#l13.539"></a><span id="l13.539" class="difflineminus">-    source-&gt;GetValueConst(&amp;uri);</span>
<a href="#l13.540"></a><span id="l13.540" class="difflineminus">-</span>
<a href="#l13.541"></a><span id="l13.541" class="difflineminus">-    if (!uri) </span>
<a href="#l13.542"></a><span id="l13.542" class="difflineminus">-      continue;</span>
<a href="#l13.543"></a><span id="l13.543" class="difflineminus">-            </span>
<a href="#l13.544"></a><span id="l13.544" class="difflineminus">-    // never match against a &quot;find:&quot; URI</span>
<a href="#l13.545"></a><span id="l13.545" class="difflineminus">-    if (PL_strncmp(uri, kFindProtocol, sizeof(kFindProtocol)-1) == 0)</span>
<a href="#l13.546"></a><span id="l13.546" class="difflineminus">-      continue;</span>
<a href="#l13.547"></a><span id="l13.547" class="difflineminus">-</span>
<a href="#l13.548"></a><span id="l13.548" class="difflineminus">-    // never match against a container. Searching for folders just isn't</span>
<a href="#l13.549"></a><span id="l13.549" class="difflineminus">-    // much of a utility, and this fixes an infinite recursion crash. (65063)</span>
<a href="#l13.550"></a><span id="l13.550" class="difflineminus">-    PRBool isContainer = PR_FALSE;</span>
<a href="#l13.551"></a><span id="l13.551" class="difflineminus">-</span>
<a href="#l13.552"></a><span id="l13.552" class="difflineminus">-    // Check to see if this source is an RDF container</span>
<a href="#l13.553"></a><span id="l13.553" class="difflineminus">-    nsCOMPtr&lt;nsIRDFContainerUtils&gt; cUtils(do_GetService(&quot;@mozilla.org/rdf/container-utils;1&quot;));</span>
<a href="#l13.554"></a><span id="l13.554" class="difflineminus">-    if (cUtils)</span>
<a href="#l13.555"></a><span id="l13.555" class="difflineminus">-      cUtils-&gt;IsContainer(datasource, source, &amp;isContainer);</span>
<a href="#l13.556"></a><span id="l13.556" class="difflineminus">-    // Check to see if this source is a pseudo-container</span>
<a href="#l13.557"></a><span id="l13.557" class="difflineminus">-    if (!isContainer)</span>
<a href="#l13.558"></a><span id="l13.558" class="difflineminus">-      datasource-&gt;HasArcOut(source, kNC_Child, &amp;isContainer);</span>
<a href="#l13.559"></a><span id="l13.559" class="difflineminus">-</span>
<a href="#l13.560"></a><span id="l13.560" class="difflineminus">-    if (isContainer) </span>
<a href="#l13.561"></a><span id="l13.561" class="difflineminus">-      continue;</span>
<a href="#l13.562"></a><span id="l13.562" class="difflineminus">-</span>
<a href="#l13.563"></a><span id="l13.563" class="difflineminus">-    // Check to see if this source has a parent</span>
<a href="#l13.564"></a><span id="l13.564" class="difflineminus">-    if (!nodeHasParent(datasource, source, cUtils))</span>
<a href="#l13.565"></a><span id="l13.565" class="difflineminus">-      continue;</span>
<a href="#l13.566"></a><span id="l13.566" class="difflineminus">-</span>
<a href="#l13.567"></a><span id="l13.567" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt; property;</span>
<a href="#l13.568"></a><span id="l13.568" class="difflineminus">-    rv = gRDFService-&gt;GetUnicodeResource(tokens[1].value,</span>
<a href="#l13.569"></a><span id="l13.569" class="difflineminus">-    getter_AddRefs(property));</span>
<a href="#l13.570"></a><span id="l13.570" class="difflineminus">-</span>
<a href="#l13.571"></a><span id="l13.571" class="difflineminus">-    if (NS_FAILED(rv) || (rv == NS_RDF_NO_VALUE) || !property)</span>
<a href="#l13.572"></a><span id="l13.572" class="difflineminus">-      continue;</span>
<a href="#l13.573"></a><span id="l13.573" class="difflineminus">-</span>
<a href="#l13.574"></a><span id="l13.574" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt;    value;</span>
<a href="#l13.575"></a><span id="l13.575" class="difflineminus">-    rv = datasource-&gt;GetTarget(source, property,</span>
<a href="#l13.576"></a><span id="l13.576" class="difflineminus">-    PR_TRUE, getter_AddRefs(value));</span>
<a href="#l13.577"></a><span id="l13.577" class="difflineminus">-    if (NS_FAILED(rv) || (rv == NS_RDF_NO_VALUE) || !value)</span>
<a href="#l13.578"></a><span id="l13.578" class="difflineminus">-      continue;</span>
<a href="#l13.579"></a><span id="l13.579" class="difflineminus">-</span>
<a href="#l13.580"></a><span id="l13.580" class="difflineminus">-    PRBool found = PR_FALSE;</span>
<a href="#l13.581"></a><span id="l13.581" class="difflineminus">-    found = matchNode(value, tokens[2].value, tokens[3].value);</span>
<a href="#l13.582"></a><span id="l13.582" class="difflineminus">-</span>
<a href="#l13.583"></a><span id="l13.583" class="difflineminus">-    if (found)</span>
<a href="#l13.584"></a><span id="l13.584" class="difflineminus">-      array-&gt;AppendElement(source, PR_FALSE);</span>
<a href="#l13.585"></a><span id="l13.585" class="difflineminus">-   }</span>
<a href="#l13.586"></a><span id="l13.586" class="difflineminus">-</span>
<a href="#l13.587"></a><span id="l13.587" class="difflineminus">-  if (rv == NS_RDF_CURSOR_EMPTY)</span>
<a href="#l13.588"></a><span id="l13.588" class="difflineminus">-    rv = NS_OK;</span>
<a href="#l13.589"></a><span id="l13.589" class="difflineminus">-</span>
<a href="#l13.590"></a><span id="l13.590" class="difflineminus">-  return rv;</span>
<a href="#l13.591"></a><span id="l13.591" class="difflineminus">-}</span>
<a href="#l13.592"></a><span id="l13.592" class="difflineminus">-</span>
<a href="#l13.593"></a><span id="l13.593" class="difflineminus">-PRBool</span>
<a href="#l13.594"></a><span id="l13.594" class="difflineminus">-LocalSearchDataSource::nodeHasParent(nsIRDFDataSource *aDataSource,</span>
<a href="#l13.595"></a><span id="l13.595" class="difflineminus">-                                     nsIRDFNode *aNode,</span>
<a href="#l13.596"></a><span id="l13.596" class="difflineminus">-                                     nsIRDFContainerUtils *aUtils)</span>
<a href="#l13.597"></a><span id="l13.597" class="difflineminus">-{</span>
<a href="#l13.598"></a><span id="l13.598" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; cursor;</span>
<a href="#l13.599"></a><span id="l13.599" class="difflineminus">-  if (NS_FAILED(aDataSource-&gt;ArcLabelsIn(aNode, getter_AddRefs(cursor))))</span>
<a href="#l13.600"></a><span id="l13.600" class="difflineminus">-    return PR_FALSE;</span>
<a href="#l13.601"></a><span id="l13.601" class="difflineminus">-</span>
<a href="#l13.602"></a><span id="l13.602" class="difflineminus">-  PRBool hasMore;</span>
<a href="#l13.603"></a><span id="l13.603" class="difflineminus">-  while (NS_SUCCEEDED(cursor-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l13.604"></a><span id="l13.604" class="difflineminus">-    nsCOMPtr&lt;nsISupports&gt; isupports;</span>
<a href="#l13.605"></a><span id="l13.605" class="difflineminus">-    if (NS_FAILED(cursor-&gt;GetNext(getter_AddRefs(isupports))))</span>
<a href="#l13.606"></a><span id="l13.606" class="difflineminus">-      break;</span>
<a href="#l13.607"></a><span id="l13.607" class="difflineminus">-</span>
<a href="#l13.608"></a><span id="l13.608" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt; arc(do_QueryInterface(isupports));</span>
<a href="#l13.609"></a><span id="l13.609" class="difflineminus">-    if (!arc)</span>
<a href="#l13.610"></a><span id="l13.610" class="difflineminus">-      continue;</span>
<a href="#l13.611"></a><span id="l13.611" class="difflineminus">-</span>
<a href="#l13.612"></a><span id="l13.612" class="difflineminus">-    PRBool result;</span>
<a href="#l13.613"></a><span id="l13.613" class="difflineminus">-    if (NS_SUCCEEDED(aUtils-&gt;IsOrdinalProperty(arc, &amp;result)) &amp;&amp; result)</span>
<a href="#l13.614"></a><span id="l13.614" class="difflineminus">-      return PR_TRUE;</span>
<a href="#l13.615"></a><span id="l13.615" class="difflineminus">-  }</span>
<a href="#l13.616"></a><span id="l13.616" class="difflineminus">-  return PR_FALSE;</span>
<a href="#l13.617"></a><span id="l13.617" class="difflineminus">-}</span>
<a href="#l13.618"></a><span id="l13.618" class="difflineminus">-</span>
<a href="#l13.619"></a><span id="l13.619" class="difflineminus">-// could speed up date/integer matching signifigantly by caching the</span>
<a href="#l13.620"></a><span id="l13.620" class="difflineminus">-// last successful match data type (i.e. string, date, int) and trying</span>
<a href="#l13.621"></a><span id="l13.621" class="difflineminus">-// to QI against that first</span>
<a href="#l13.622"></a><span id="l13.622" class="difflineminus">-PRBool</span>
<a href="#l13.623"></a><span id="l13.623" class="difflineminus">-LocalSearchDataSource::matchNode(nsIRDFNode *aValue,</span>
<a href="#l13.624"></a><span id="l13.624" class="difflineminus">-                                 const nsAString&amp; matchMethod,</span>
<a href="#l13.625"></a><span id="l13.625" class="difflineminus">-                                 const nsString&amp; matchText)</span>
<a href="#l13.626"></a><span id="l13.626" class="difflineminus">-{</span>
<a href="#l13.627"></a><span id="l13.627" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; literal(do_QueryInterface(aValue));</span>
<a href="#l13.628"></a><span id="l13.628" class="difflineminus">-    if (literal)</span>
<a href="#l13.629"></a><span id="l13.629" class="difflineminus">-        return doMatch(literal, matchMethod, matchText);</span>
<a href="#l13.630"></a><span id="l13.630" class="difflineminus">-</span>
<a href="#l13.631"></a><span id="l13.631" class="difflineminus">-    nsCOMPtr&lt;nsIRDFDate&gt; dateLiteral(do_QueryInterface(aValue));</span>
<a href="#l13.632"></a><span id="l13.632" class="difflineminus">-    if (dateLiteral)</span>
<a href="#l13.633"></a><span id="l13.633" class="difflineminus">-        return doDateMatch(dateLiteral, matchMethod, matchText);</span>
<a href="#l13.634"></a><span id="l13.634" class="difflineminus">-    </span>
<a href="#l13.635"></a><span id="l13.635" class="difflineminus">-    nsCOMPtr&lt;nsIRDFInt&gt; intLiteral(do_QueryInterface(aValue));</span>
<a href="#l13.636"></a><span id="l13.636" class="difflineminus">-    if (intLiteral)</span>
<a href="#l13.637"></a><span id="l13.637" class="difflineminus">-        return doIntMatch(intLiteral, matchMethod, matchText);</span>
<a href="#l13.638"></a><span id="l13.638" class="difflineminus">-</span>
<a href="#l13.639"></a><span id="l13.639" class="difflineminus">-    return PR_FALSE;</span>
<a href="#l13.640"></a><span id="l13.640" class="difflineminus">-}</span>
<a href="#l13.641"></a><span id="l13.641" class="difflineminus">-</span>
<a href="#l13.642"></a><span id="l13.642" class="difflineminus">-NS_METHOD</span>
<a href="#l13.643"></a><span id="l13.643" class="difflineminus">-LocalSearchDataSource::getFindResults(nsIRDFResource *source, nsISimpleEnumerator** aResult)</span>
<a href="#l13.644"></a><span id="l13.644" class="difflineminus">-{</span>
<a href="#l13.645"></a><span id="l13.645" class="difflineminus">-	nsresult			rv;</span>
<a href="#l13.646"></a><span id="l13.646" class="difflineminus">-	nsCOMPtr&lt;nsIMutableArray&gt;	nameArray;</span>
<a href="#l13.647"></a><span id="l13.647" class="difflineminus">-	nameArray = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l13.648"></a><span id="l13.648" class="difflineminus">-	if (NS_FAILED(rv)) return rv;</span>
<a href="#l13.649"></a><span id="l13.649" class="difflineminus">-</span>
<a href="#l13.650"></a><span id="l13.650" class="difflineminus">-	rv = parseFindURL(source, nameArray);</span>
<a href="#l13.651"></a><span id="l13.651" class="difflineminus">-	if (NS_FAILED(rv)) return rv;</span>
<a href="#l13.652"></a><span id="l13.652" class="difflineminus">-</span>
<a href="#l13.653"></a><span id="l13.653" class="difflineminus">-        return NS_NewArrayEnumerator(aResult, nameArray);</span>
<a href="#l13.654"></a><span id="l13.654" class="difflineminus">-}</span>
<a href="#l13.655"></a><span id="l13.655" class="difflineminus">-</span>
<a href="#l13.656"></a><span id="l13.656" class="difflineminus">-</span>
<a href="#l13.657"></a><span id="l13.657" class="difflineminus">-</span>
<a href="#l13.658"></a><span id="l13.658" class="difflineminus">-NS_METHOD</span>
<a href="#l13.659"></a><span id="l13.659" class="difflineminus">-LocalSearchDataSource::getFindName(nsIRDFResource *source, nsIRDFLiteral** aResult)</span>
<a href="#l13.660"></a><span id="l13.660" class="difflineminus">-{</span>
<a href="#l13.661"></a><span id="l13.661" class="difflineminus">-	// XXX construct find URI human-readable name</span>
<a href="#l13.662"></a><span id="l13.662" class="difflineminus">-	*aResult = nsnull;</span>
<a href="#l13.663"></a><span id="l13.663" class="difflineminus">-	return(NS_OK);</span>
<a href="#l13.664"></a><span id="l13.664" class="difflineminus">-}</span>
<a href="#l13.665"></a><span id="l13.665" class="difflineminus">-</span>
<a href="#l13.666"></a><span id="l13.666" class="difflineminus">-</span>
<a href="#l13.667"></a><span id="l13.667" class="difflineminus">-</span>
<a href="#l13.668"></a><span id="l13.668" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.669"></a><span id="l13.669" class="difflineminus">-LocalSearchDataSource::GetTargets(nsIRDFResource *source,</span>
<a href="#l13.670"></a><span id="l13.670" class="difflineminus">-                           nsIRDFResource *property,</span>
<a href="#l13.671"></a><span id="l13.671" class="difflineminus">-                           PRBool tv,</span>
<a href="#l13.672"></a><span id="l13.672" class="difflineminus">-                           nsISimpleEnumerator **targets /* out */)</span>
<a href="#l13.673"></a><span id="l13.673" class="difflineminus">-{</span>
<a href="#l13.674"></a><span id="l13.674" class="difflineminus">-	NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.675"></a><span id="l13.675" class="difflineminus">-	if (! source)</span>
<a href="#l13.676"></a><span id="l13.676" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.677"></a><span id="l13.677" class="difflineminus">-</span>
<a href="#l13.678"></a><span id="l13.678" class="difflineminus">-	NS_PRECONDITION(property != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.679"></a><span id="l13.679" class="difflineminus">-	if (! property)</span>
<a href="#l13.680"></a><span id="l13.680" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.681"></a><span id="l13.681" class="difflineminus">-</span>
<a href="#l13.682"></a><span id="l13.682" class="difflineminus">-	NS_PRECONDITION(targets != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.683"></a><span id="l13.683" class="difflineminus">-	if (! targets)</span>
<a href="#l13.684"></a><span id="l13.684" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.685"></a><span id="l13.685" class="difflineminus">-</span>
<a href="#l13.686"></a><span id="l13.686" class="difflineminus">-	nsresult		rv = NS_ERROR_FAILURE;</span>
<a href="#l13.687"></a><span id="l13.687" class="difflineminus">-</span>
<a href="#l13.688"></a><span id="l13.688" class="difflineminus">-	// we only have positive assertions in the find data source.</span>
<a href="#l13.689"></a><span id="l13.689" class="difflineminus">-	if (! tv)</span>
<a href="#l13.690"></a><span id="l13.690" class="difflineminus">-		return rv;</span>
<a href="#l13.691"></a><span id="l13.691" class="difflineminus">-</span>
<a href="#l13.692"></a><span id="l13.692" class="difflineminus">-	if (isFindURI(source))</span>
<a href="#l13.693"></a><span id="l13.693" class="difflineminus">-	{</span>
<a href="#l13.694"></a><span id="l13.694" class="difflineminus">-		if (property == kNC_Child)</span>
<a href="#l13.695"></a><span id="l13.695" class="difflineminus">-		{</span>
<a href="#l13.696"></a><span id="l13.696" class="difflineminus">-			return getFindResults(source, targets);</span>
<a href="#l13.697"></a><span id="l13.697" class="difflineminus">-		}</span>
<a href="#l13.698"></a><span id="l13.698" class="difflineminus">-		else if (property == kNC_Name)</span>
<a href="#l13.699"></a><span id="l13.699" class="difflineminus">-		{</span>
<a href="#l13.700"></a><span id="l13.700" class="difflineminus">-			nsCOMPtr&lt;nsIRDFLiteral&gt;	name;</span>
<a href="#l13.701"></a><span id="l13.701" class="difflineminus">-			rv = getFindName(source, getter_AddRefs(name));</span>
<a href="#l13.702"></a><span id="l13.702" class="difflineminus">-			if (NS_FAILED(rv)) return rv;</span>
<a href="#l13.703"></a><span id="l13.703" class="difflineminus">-</span>
<a href="#l13.704"></a><span id="l13.704" class="difflineminus">-                        return NS_NewSingletonEnumerator(targets, name);</span>
<a href="#l13.705"></a><span id="l13.705" class="difflineminus">-		}</span>
<a href="#l13.706"></a><span id="l13.706" class="difflineminus">-		else if (property == kRDF_type)</span>
<a href="#l13.707"></a><span id="l13.707" class="difflineminus">-		{</span>
<a href="#l13.708"></a><span id="l13.708" class="difflineminus">-			const	char	*uri = nsnull;</span>
<a href="#l13.709"></a><span id="l13.709" class="difflineminus">-			rv = kNC_FindObject-&gt;GetValueConst( &amp;uri );</span>
<a href="#l13.710"></a><span id="l13.710" class="difflineminus">-			if (NS_FAILED(rv)) return rv;</span>
<a href="#l13.711"></a><span id="l13.711" class="difflineminus">-</span>
<a href="#l13.712"></a><span id="l13.712" class="difflineminus">-			nsCOMPtr&lt;nsIRDFLiteral&gt; literal;</span>
<a href="#l13.713"></a><span id="l13.713" class="difflineminus">-			rv = gRDFService-&gt;GetLiteral(NS_ConvertUTF8toUTF16(uri).get(),</span>
<a href="#l13.714"></a><span id="l13.714" class="difflineminus">-                                                     getter_AddRefs(literal));</span>
<a href="#l13.715"></a><span id="l13.715" class="difflineminus">-			if (NS_FAILED(rv)) return rv;</span>
<a href="#l13.716"></a><span id="l13.716" class="difflineminus">-</span>
<a href="#l13.717"></a><span id="l13.717" class="difflineminus">-                        return NS_NewSingletonEnumerator(targets, literal);</span>
<a href="#l13.718"></a><span id="l13.718" class="difflineminus">-		}</span>
<a href="#l13.719"></a><span id="l13.719" class="difflineminus">-		else if (property == kNC_pulse)</span>
<a href="#l13.720"></a><span id="l13.720" class="difflineminus">-		{</span>
<a href="#l13.721"></a><span id="l13.721" class="difflineminus">-			nsAutoString	pulse(NS_LITERAL_STRING(&quot;15&quot;));</span>
<a href="#l13.722"></a><span id="l13.722" class="difflineminus">-</span>
<a href="#l13.723"></a><span id="l13.723" class="difflineminus">-			nsCOMPtr&lt;nsIRDFLiteral&gt; pulseLiteral;</span>
<a href="#l13.724"></a><span id="l13.724" class="difflineminus">-			rv = gRDFService-&gt;GetLiteral(pulse.get(),</span>
<a href="#l13.725"></a><span id="l13.725" class="difflineminus">-                                                     getter_AddRefs(pulseLiteral));</span>
<a href="#l13.726"></a><span id="l13.726" class="difflineminus">-			if (NS_FAILED(rv)) return rv;</span>
<a href="#l13.727"></a><span id="l13.727" class="difflineminus">-</span>
<a href="#l13.728"></a><span id="l13.728" class="difflineminus">-                        return NS_NewSingletonEnumerator(targets, pulseLiteral);</span>
<a href="#l13.729"></a><span id="l13.729" class="difflineminus">-		}</span>
<a href="#l13.730"></a><span id="l13.730" class="difflineminus">-	}</span>
<a href="#l13.731"></a><span id="l13.731" class="difflineminus">-</span>
<a href="#l13.732"></a><span id="l13.732" class="difflineminus">-	return NS_NewEmptyEnumerator(targets);</span>
<a href="#l13.733"></a><span id="l13.733" class="difflineminus">-}</span>
<a href="#l13.734"></a><span id="l13.734" class="difflineminus">-</span>
<a href="#l13.735"></a><span id="l13.735" class="difflineminus">-</span>
<a href="#l13.736"></a><span id="l13.736" class="difflineminus">-</span>
<a href="#l13.737"></a><span id="l13.737" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.738"></a><span id="l13.738" class="difflineminus">-LocalSearchDataSource::Assert(nsIRDFResource *source,</span>
<a href="#l13.739"></a><span id="l13.739" class="difflineminus">-                       nsIRDFResource *property,</span>
<a href="#l13.740"></a><span id="l13.740" class="difflineminus">-                       nsIRDFNode *target,</span>
<a href="#l13.741"></a><span id="l13.741" class="difflineminus">-                       PRBool tv)</span>
<a href="#l13.742"></a><span id="l13.742" class="difflineminus">-{</span>
<a href="#l13.743"></a><span id="l13.743" class="difflineminus">-	return NS_RDF_ASSERTION_REJECTED;</span>
<a href="#l13.744"></a><span id="l13.744" class="difflineminus">-}</span>
<a href="#l13.745"></a><span id="l13.745" class="difflineminus">-</span>
<a href="#l13.746"></a><span id="l13.746" class="difflineminus">-</span>
<a href="#l13.747"></a><span id="l13.747" class="difflineminus">-</span>
<a href="#l13.748"></a><span id="l13.748" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.749"></a><span id="l13.749" class="difflineminus">-LocalSearchDataSource::Unassert(nsIRDFResource *source,</span>
<a href="#l13.750"></a><span id="l13.750" class="difflineminus">-                         nsIRDFResource *property,</span>
<a href="#l13.751"></a><span id="l13.751" class="difflineminus">-                         nsIRDFNode *target)</span>
<a href="#l13.752"></a><span id="l13.752" class="difflineminus">-{</span>
<a href="#l13.753"></a><span id="l13.753" class="difflineminus">-	return NS_RDF_ASSERTION_REJECTED;</span>
<a href="#l13.754"></a><span id="l13.754" class="difflineminus">-}</span>
<a href="#l13.755"></a><span id="l13.755" class="difflineminus">-</span>
<a href="#l13.756"></a><span id="l13.756" class="difflineminus">-</span>
<a href="#l13.757"></a><span id="l13.757" class="difflineminus">-</span>
<a href="#l13.758"></a><span id="l13.758" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.759"></a><span id="l13.759" class="difflineminus">-LocalSearchDataSource::Change(nsIRDFResource* aSource,</span>
<a href="#l13.760"></a><span id="l13.760" class="difflineminus">-                       nsIRDFResource* aProperty,</span>
<a href="#l13.761"></a><span id="l13.761" class="difflineminus">-                       nsIRDFNode* aOldTarget,</span>
<a href="#l13.762"></a><span id="l13.762" class="difflineminus">-                       nsIRDFNode* aNewTarget)</span>
<a href="#l13.763"></a><span id="l13.763" class="difflineminus">-{</span>
<a href="#l13.764"></a><span id="l13.764" class="difflineminus">-	return NS_RDF_ASSERTION_REJECTED;</span>
<a href="#l13.765"></a><span id="l13.765" class="difflineminus">-}</span>
<a href="#l13.766"></a><span id="l13.766" class="difflineminus">-</span>
<a href="#l13.767"></a><span id="l13.767" class="difflineminus">-</span>
<a href="#l13.768"></a><span id="l13.768" class="difflineminus">-</span>
<a href="#l13.769"></a><span id="l13.769" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.770"></a><span id="l13.770" class="difflineminus">-LocalSearchDataSource::Move(nsIRDFResource* aOldSource,</span>
<a href="#l13.771"></a><span id="l13.771" class="difflineminus">-                     nsIRDFResource* aNewSource,</span>
<a href="#l13.772"></a><span id="l13.772" class="difflineminus">-                     nsIRDFResource* aProperty,</span>
<a href="#l13.773"></a><span id="l13.773" class="difflineminus">-                     nsIRDFNode* aTarget)</span>
<a href="#l13.774"></a><span id="l13.774" class="difflineminus">-{</span>
<a href="#l13.775"></a><span id="l13.775" class="difflineminus">-	return NS_RDF_ASSERTION_REJECTED;</span>
<a href="#l13.776"></a><span id="l13.776" class="difflineminus">-}</span>
<a href="#l13.777"></a><span id="l13.777" class="difflineminus">-</span>
<a href="#l13.778"></a><span id="l13.778" class="difflineminus">-</span>
<a href="#l13.779"></a><span id="l13.779" class="difflineminus">-</span>
<a href="#l13.780"></a><span id="l13.780" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.781"></a><span id="l13.781" class="difflineminus">-LocalSearchDataSource::HasAssertion(nsIRDFResource *source,</span>
<a href="#l13.782"></a><span id="l13.782" class="difflineminus">-                             nsIRDFResource *property,</span>
<a href="#l13.783"></a><span id="l13.783" class="difflineminus">-                             nsIRDFNode *target,</span>
<a href="#l13.784"></a><span id="l13.784" class="difflineminus">-                             PRBool tv,</span>
<a href="#l13.785"></a><span id="l13.785" class="difflineminus">-                             PRBool *hasAssertion /* out */)</span>
<a href="#l13.786"></a><span id="l13.786" class="difflineminus">-{</span>
<a href="#l13.787"></a><span id="l13.787" class="difflineminus">-	NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.788"></a><span id="l13.788" class="difflineminus">-	if (! source)</span>
<a href="#l13.789"></a><span id="l13.789" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.790"></a><span id="l13.790" class="difflineminus">-</span>
<a href="#l13.791"></a><span id="l13.791" class="difflineminus">-	NS_PRECONDITION(property != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.792"></a><span id="l13.792" class="difflineminus">-	if (! property)</span>
<a href="#l13.793"></a><span id="l13.793" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.794"></a><span id="l13.794" class="difflineminus">-</span>
<a href="#l13.795"></a><span id="l13.795" class="difflineminus">-	NS_PRECONDITION(target != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.796"></a><span id="l13.796" class="difflineminus">-	if (! target)</span>
<a href="#l13.797"></a><span id="l13.797" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.798"></a><span id="l13.798" class="difflineminus">-</span>
<a href="#l13.799"></a><span id="l13.799" class="difflineminus">-	NS_PRECONDITION(hasAssertion != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.800"></a><span id="l13.800" class="difflineminus">-	if (! hasAssertion)</span>
<a href="#l13.801"></a><span id="l13.801" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.802"></a><span id="l13.802" class="difflineminus">-</span>
<a href="#l13.803"></a><span id="l13.803" class="difflineminus">-	nsresult		rv = NS_OK;</span>
<a href="#l13.804"></a><span id="l13.804" class="difflineminus">-</span>
<a href="#l13.805"></a><span id="l13.805" class="difflineminus">-	*hasAssertion = PR_FALSE;</span>
<a href="#l13.806"></a><span id="l13.806" class="difflineminus">-</span>
<a href="#l13.807"></a><span id="l13.807" class="difflineminus">-	// we only have positive assertions in the find data source.</span>
<a href="#l13.808"></a><span id="l13.808" class="difflineminus">-	if (! tv)</span>
<a href="#l13.809"></a><span id="l13.809" class="difflineminus">-		return rv;</span>
<a href="#l13.810"></a><span id="l13.810" class="difflineminus">-</span>
<a href="#l13.811"></a><span id="l13.811" class="difflineminus">-	if (isFindURI(source))</span>
<a href="#l13.812"></a><span id="l13.812" class="difflineminus">-	{</span>
<a href="#l13.813"></a><span id="l13.813" class="difflineminus">-		if (property == kRDF_type)</span>
<a href="#l13.814"></a><span id="l13.814" class="difflineminus">-		{</span>
<a href="#l13.815"></a><span id="l13.815" class="difflineminus">-			if ((nsIRDFResource *)target == kRDF_type)</span>
<a href="#l13.816"></a><span id="l13.816" class="difflineminus">-			{</span>
<a href="#l13.817"></a><span id="l13.817" class="difflineminus">-				*hasAssertion = PR_TRUE;</span>
<a href="#l13.818"></a><span id="l13.818" class="difflineminus">-			}</span>
<a href="#l13.819"></a><span id="l13.819" class="difflineminus">-		}</span>
<a href="#l13.820"></a><span id="l13.820" class="difflineminus">-	}</span>
<a href="#l13.821"></a><span id="l13.821" class="difflineminus">-	return (rv);</span>
<a href="#l13.822"></a><span id="l13.822" class="difflineminus">-}</span>
<a href="#l13.823"></a><span id="l13.823" class="difflineminus">-</span>
<a href="#l13.824"></a><span id="l13.824" class="difflineminus">-NS_IMETHODIMP </span>
<a href="#l13.825"></a><span id="l13.825" class="difflineminus">-LocalSearchDataSource::HasArcIn(nsIRDFNode *aNode, nsIRDFResource *aArc, PRBool *result)</span>
<a href="#l13.826"></a><span id="l13.826" class="difflineminus">-{</span>
<a href="#l13.827"></a><span id="l13.827" class="difflineminus">-    *result = PR_FALSE;</span>
<a href="#l13.828"></a><span id="l13.828" class="difflineminus">-    return NS_OK;</span>
<a href="#l13.829"></a><span id="l13.829" class="difflineminus">-}</span>
<a href="#l13.830"></a><span id="l13.830" class="difflineminus">-</span>
<a href="#l13.831"></a><span id="l13.831" class="difflineminus">-NS_IMETHODIMP </span>
<a href="#l13.832"></a><span id="l13.832" class="difflineminus">-LocalSearchDataSource::HasArcOut(nsIRDFResource *source, nsIRDFResource *aArc, PRBool *result)</span>
<a href="#l13.833"></a><span id="l13.833" class="difflineminus">-{</span>
<a href="#l13.834"></a><span id="l13.834" class="difflineminus">-    NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.835"></a><span id="l13.835" class="difflineminus">-    if (! source)</span>
<a href="#l13.836"></a><span id="l13.836" class="difflineminus">-        return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.837"></a><span id="l13.837" class="difflineminus">-</span>
<a href="#l13.838"></a><span id="l13.838" class="difflineminus">-    if ((aArc == kNC_Child ||</span>
<a href="#l13.839"></a><span id="l13.839" class="difflineminus">-         aArc == kNC_pulse)) {</span>
<a href="#l13.840"></a><span id="l13.840" class="difflineminus">-        *result = isFindURI(source);</span>
<a href="#l13.841"></a><span id="l13.841" class="difflineminus">-    }</span>
<a href="#l13.842"></a><span id="l13.842" class="difflineminus">-    else {</span>
<a href="#l13.843"></a><span id="l13.843" class="difflineminus">-        *result = PR_FALSE;</span>
<a href="#l13.844"></a><span id="l13.844" class="difflineminus">-    }</span>
<a href="#l13.845"></a><span id="l13.845" class="difflineminus">-    return NS_OK;</span>
<a href="#l13.846"></a><span id="l13.846" class="difflineminus">-}</span>
<a href="#l13.847"></a><span id="l13.847" class="difflineminus">-</span>
<a href="#l13.848"></a><span id="l13.848" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.849"></a><span id="l13.849" class="difflineminus">-LocalSearchDataSource::ArcLabelsIn(nsIRDFNode *node,</span>
<a href="#l13.850"></a><span id="l13.850" class="difflineminus">-                            nsISimpleEnumerator ** labels /* out */)</span>
<a href="#l13.851"></a><span id="l13.851" class="difflineminus">-{</span>
<a href="#l13.852"></a><span id="l13.852" class="difflineminus">-	NS_NOTYETIMPLEMENTED(&quot;write me&quot;);</span>
<a href="#l13.853"></a><span id="l13.853" class="difflineminus">-	return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.854"></a><span id="l13.854" class="difflineminus">-}</span>
<a href="#l13.855"></a><span id="l13.855" class="difflineminus">-</span>
<a href="#l13.856"></a><span id="l13.856" class="difflineminus">-</span>
<a href="#l13.857"></a><span id="l13.857" class="difflineminus">-</span>
<a href="#l13.858"></a><span id="l13.858" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.859"></a><span id="l13.859" class="difflineminus">-LocalSearchDataSource::ArcLabelsOut(nsIRDFResource *source,</span>
<a href="#l13.860"></a><span id="l13.860" class="difflineminus">-                             nsISimpleEnumerator **labels /* out */)</span>
<a href="#l13.861"></a><span id="l13.861" class="difflineminus">-{</span>
<a href="#l13.862"></a><span id="l13.862" class="difflineminus">-	NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.863"></a><span id="l13.863" class="difflineminus">-	if (! source)</span>
<a href="#l13.864"></a><span id="l13.864" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.865"></a><span id="l13.865" class="difflineminus">-</span>
<a href="#l13.866"></a><span id="l13.866" class="difflineminus">-	NS_PRECONDITION(labels != nsnull, &quot;null ptr&quot;);</span>
<a href="#l13.867"></a><span id="l13.867" class="difflineminus">-	if (! labels)</span>
<a href="#l13.868"></a><span id="l13.868" class="difflineminus">-		return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.869"></a><span id="l13.869" class="difflineminus">-</span>
<a href="#l13.870"></a><span id="l13.870" class="difflineminus">-	nsresult		rv;</span>
<a href="#l13.871"></a><span id="l13.871" class="difflineminus">-</span>
<a href="#l13.872"></a><span id="l13.872" class="difflineminus">-	if (isFindURI(source))</span>
<a href="#l13.873"></a><span id="l13.873" class="difflineminus">-	{</span>
<a href="#l13.874"></a><span id="l13.874" class="difflineminus">-		nsCOMPtr&lt;nsIMutableArray&gt; array;</span>
<a href="#l13.875"></a><span id="l13.875" class="difflineminus">-		array = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l13.876"></a><span id="l13.876" class="difflineminus">-		if (NS_FAILED(rv)) return rv;</span>
<a href="#l13.877"></a><span id="l13.877" class="difflineminus">-</span>
<a href="#l13.878"></a><span id="l13.878" class="difflineminus">-		array-&gt;AppendElement(kNC_Child, PR_FALSE);</span>
<a href="#l13.879"></a><span id="l13.879" class="difflineminus">-		array-&gt;AppendElement(kNC_pulse, PR_FALSE);</span>
<a href="#l13.880"></a><span id="l13.880" class="difflineminus">-</span>
<a href="#l13.881"></a><span id="l13.881" class="difflineminus">-                return NS_NewArrayEnumerator(labels, array);</span>
<a href="#l13.882"></a><span id="l13.882" class="difflineminus">-	}</span>
<a href="#l13.883"></a><span id="l13.883" class="difflineminus">-	return(NS_NewEmptyEnumerator(labels));</span>
<a href="#l13.884"></a><span id="l13.884" class="difflineminus">-}</span>
<a href="#l13.885"></a><span id="l13.885" class="difflineminus">-</span>
<a href="#l13.886"></a><span id="l13.886" class="difflineminus">-</span>
<a href="#l13.887"></a><span id="l13.887" class="difflineminus">-</span>
<a href="#l13.888"></a><span id="l13.888" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.889"></a><span id="l13.889" class="difflineminus">-LocalSearchDataSource::GetAllResources(nsISimpleEnumerator** aCursor)</span>
<a href="#l13.890"></a><span id="l13.890" class="difflineminus">-{</span>
<a href="#l13.891"></a><span id="l13.891" class="difflineminus">-	NS_NOTYETIMPLEMENTED(&quot;sorry!&quot;);</span>
<a href="#l13.892"></a><span id="l13.892" class="difflineminus">-	return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.893"></a><span id="l13.893" class="difflineminus">-}</span>
<a href="#l13.894"></a><span id="l13.894" class="difflineminus">-</span>
<a href="#l13.895"></a><span id="l13.895" class="difflineminus">-</span>
<a href="#l13.896"></a><span id="l13.896" class="difflineminus">-</span>
<a href="#l13.897"></a><span id="l13.897" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.898"></a><span id="l13.898" class="difflineminus">-LocalSearchDataSource::AddObserver(nsIRDFObserver *n)</span>
<a href="#l13.899"></a><span id="l13.899" class="difflineminus">-{</span>
<a href="#l13.900"></a><span id="l13.900" class="difflineminus">-	return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.901"></a><span id="l13.901" class="difflineminus">-}</span>
<a href="#l13.902"></a><span id="l13.902" class="difflineminus">-</span>
<a href="#l13.903"></a><span id="l13.903" class="difflineminus">-</span>
<a href="#l13.904"></a><span id="l13.904" class="difflineminus">-</span>
<a href="#l13.905"></a><span id="l13.905" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.906"></a><span id="l13.906" class="difflineminus">-LocalSearchDataSource::RemoveObserver(nsIRDFObserver *n)</span>
<a href="#l13.907"></a><span id="l13.907" class="difflineminus">-{</span>
<a href="#l13.908"></a><span id="l13.908" class="difflineminus">-	return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.909"></a><span id="l13.909" class="difflineminus">-}</span>
<a href="#l13.910"></a><span id="l13.910" class="difflineminus">-</span>
<a href="#l13.911"></a><span id="l13.911" class="difflineminus">-</span>
<a href="#l13.912"></a><span id="l13.912" class="difflineminus">-</span>
<a href="#l13.913"></a><span id="l13.913" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.914"></a><span id="l13.914" class="difflineminus">-LocalSearchDataSource::GetAllCmds(nsIRDFResource* source, nsISimpleEnumerator/*&lt;nsIRDFResource&gt;*/** commands)</span>
<a href="#l13.915"></a><span id="l13.915" class="difflineminus">-{</span>
<a href="#l13.916"></a><span id="l13.916" class="difflineminus">-	return(NS_NewEmptyEnumerator(commands));</span>
<a href="#l13.917"></a><span id="l13.917" class="difflineminus">-}</span>
<a href="#l13.918"></a><span id="l13.918" class="difflineminus">-</span>
<a href="#l13.919"></a><span id="l13.919" class="difflineminus">-</span>
<a href="#l13.920"></a><span id="l13.920" class="difflineminus">-</span>
<a href="#l13.921"></a><span id="l13.921" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.922"></a><span id="l13.922" class="difflineminus">-LocalSearchDataSource::IsCommandEnabled(nsISupportsArray/*&lt;nsIRDFResource&gt;*/* aSources,</span>
<a href="#l13.923"></a><span id="l13.923" class="difflineminus">-				nsIRDFResource*   aCommand,</span>
<a href="#l13.924"></a><span id="l13.924" class="difflineminus">-				nsISupportsArray/*&lt;nsIRDFResource&gt;*/* aArguments,</span>
<a href="#l13.925"></a><span id="l13.925" class="difflineminus">-                                PRBool* aResult)</span>
<a href="#l13.926"></a><span id="l13.926" class="difflineminus">-{</span>
<a href="#l13.927"></a><span id="l13.927" class="difflineminus">-	return(NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l13.928"></a><span id="l13.928" class="difflineminus">-}</span>
<a href="#l13.929"></a><span id="l13.929" class="difflineminus">-</span>
<a href="#l13.930"></a><span id="l13.930" class="difflineminus">-</span>
<a href="#l13.931"></a><span id="l13.931" class="difflineminus">-</span>
<a href="#l13.932"></a><span id="l13.932" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.933"></a><span id="l13.933" class="difflineminus">-LocalSearchDataSource::DoCommand(nsISupportsArray/*&lt;nsIRDFResource&gt;*/* aSources,</span>
<a href="#l13.934"></a><span id="l13.934" class="difflineminus">-				nsIRDFResource*   aCommand,</span>
<a href="#l13.935"></a><span id="l13.935" class="difflineminus">-				nsISupportsArray/*&lt;nsIRDFResource&gt;*/* aArguments)</span>
<a href="#l13.936"></a><span id="l13.936" class="difflineminus">-{</span>
<a href="#l13.937"></a><span id="l13.937" class="difflineminus">-	return(NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l13.938"></a><span id="l13.938" class="difflineminus">-}</span>
<a href="#l13.939"></a><span id="l13.939" class="difflineminus">-</span>
<a href="#l13.940"></a><span id="l13.940" class="difflineminus">-</span>
<a href="#l13.941"></a><span id="l13.941" class="difflineminus">-</span>
<a href="#l13.942"></a><span id="l13.942" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.943"></a><span id="l13.943" class="difflineminus">-LocalSearchDataSource::BeginUpdateBatch()</span>
<a href="#l13.944"></a><span id="l13.944" class="difflineminus">-{</span>
<a href="#l13.945"></a><span id="l13.945" class="difflineminus">-	return NS_OK;</span>
<a href="#l13.946"></a><span id="l13.946" class="difflineminus">-}</span>
<a href="#l13.947"></a><span id="l13.947" class="difflineminus">-</span>
<a href="#l13.948"></a><span id="l13.948" class="difflineminus">-</span>
<a href="#l13.949"></a><span id="l13.949" class="difflineminus">-</span>
<a href="#l13.950"></a><span id="l13.950" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l13.951"></a><span id="l13.951" class="difflineminus">-LocalSearchDataSource::EndUpdateBatch()</span>
<a href="#l13.952"></a><span id="l13.952" class="difflineminus">-{</span>
<a href="#l13.953"></a><span id="l13.953" class="difflineminus">-	return NS_OK;</span>
<a href="#l13.954"></a><span id="l13.954" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">deleted file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- a/suite/browser/src/nsLocalSearchService.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ /dev/null</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -1,113 +0,0 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineminus">- *</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">- *</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">- * License.</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">- *</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">- *</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">- *</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">- *</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">- *</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-#ifndef localsearchdb___h_____</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-#define localsearchdb___h_____</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-#include &quot;nsIRDFDataSource.h&quot;</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-#include &quot;nsStringAPI.h&quot;</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-#include &quot;nsIRDFNode.h&quot;</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-#include &quot;nsIRDFService.h&quot;</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-#include &quot;nsIRDFContainerUtils.h&quot;</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-#include &quot;nsISearchService.h&quot;</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-typedef	struct	_findTokenStruct</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-{</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-	const char		*token;</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-	nsString	    value;</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-} findTokenStruct, *findTokenPtr;</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">-</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineminus">-</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">-class LocalSearchDataSource : public nsIRDFDataSource</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-{</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineminus">-private:</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineminus">-	static PRInt32		gRefCnt;</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineminus">-</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">-    // pseudo-constants</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineminus">-	static nsIRDFResource	*kNC_Child;</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineminus">-	static nsIRDFResource	*kNC_Name;</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-	static nsIRDFResource	*kNC_URL;</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineminus">-	static nsIRDFResource	*kNC_FindObject;</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineminus">-	static nsIRDFResource	*kNC_pulse;</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineminus">-	static nsIRDFResource	*kRDF_InstanceOf;</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineminus">-	static nsIRDFResource	*kRDF_type;</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineminus">-</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineminus">-protected:</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineminus">-</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineminus">-	NS_METHOD	getFindResults(nsIRDFResource *source, nsISimpleEnumerator** aResult);</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineminus">-	NS_METHOD	getFindName(nsIRDFResource *source, nsIRDFLiteral** aResult);</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineminus">-	NS_METHOD	parseResourceIntoFindTokens(nsIRDFResource *u, findTokenPtr tokens);</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-    PRBool nodeHasParent(nsIRDFDataSource *aDataSource,</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineminus">-                         nsIRDFNode *aNode,</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineminus">-                         nsIRDFContainerUtils *aUtils);</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-    // matching functions, based on type</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-	PRBool doMatch(nsIRDFLiteral  *literal,</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineminus">-                   const nsAString&amp; matchMethod,</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-                   const nsString&amp; matchText);</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-    PRBool matchNode(nsIRDFNode *aNode,</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-                     const nsAString&amp; matchMethod,</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-                     const nsString&amp; matchText);</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineminus">-    </span>
<a href="#l14.92"></a><span id="l14.92" class="difflineminus">-	PRBool doDateMatch(nsIRDFDate *literal,</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineminus">-                       const nsAString&amp; matchMethod,</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineminus">-                       const nsAString&amp; matchText);</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineminus">-	PRBool doIntMatch (nsIRDFInt  *literal,</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineminus">-                       const nsAString&amp; matchMethod,</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-                       const nsString&amp; matchText);</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineminus">-</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineminus">-    PRBool dateMatches(nsIRDFDate *literal,</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-                       const nsAString&amp; method,</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-                       const PRInt64&amp; matchDate);</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-    </span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-    NS_METHOD   parseDate(const nsAString&amp; aDate, PRInt64* aResult);</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-    </span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-	NS_METHOD	parseFindURL(nsIRDFResource *u, nsIMutableArray *array);</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-public:</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-	LocalSearchDataSource(void);</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineminus">-	virtual		~LocalSearchDataSource(void);</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineminus">-	nsresult	Init();</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineminus">-	NS_DECL_ISUPPORTS</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineminus">-	NS_DECL_NSILOCALSEARCHSERVICE</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineminus">-    NS_DECL_NSIRDFDATASOURCE</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineminus">-};</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineminus">-</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineminus">-#endif // localsearchdb___h_____</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/browser/urlbarBindings.xml</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/browser/urlbarBindings.xml</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -178,139 +178,66 @@</span>
<a href="#l15.4"></a><span id="l15.4">       &lt;field name=&quot;mInputTimeout&quot;&gt;&lt;![CDATA[</span>
<a href="#l15.5"></a><span id="l15.5">         (function(me) {</span>
<a href="#l15.6"></a><span id="l15.6">           me.resultsPopup.mSearchBox.searchValue = me.value;</span>
<a href="#l15.7"></a><span id="l15.7">           me.mSearchInputTO = 0;</span>
<a href="#l15.8"></a><span id="l15.8">         });</span>
<a href="#l15.9"></a><span id="l15.9">       ]]&gt;&lt;/field&gt;</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11">       &lt;field name=&quot;mEnginesReady&quot;&gt;false&lt;/field&gt;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-      </span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+</span>
<a href="#l15.14"></a><span id="l15.14">       &lt;property name=&quot;overrideValue&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l15.15"></a><span id="l15.15">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l15.16"></a><span id="l15.16">           if (this.mSearchBox.selectedIndex != -1) {</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-            // save the value.  RevealSearchPanel can close the popup</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-            var returnValue = this.mSearchBox.overrideValue;</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">-            try {</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">-              if (pref.getBoolPref(&quot;browser.search.opensidebarsearchpanel&quot;))</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-                RevealSearchPanel();</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-            } catch (ex) {</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-            }</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">-            return returnValue;</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+            return this.mSearchBox.overrideValue;</span>
<a href="#l15.26"></a><span id="l15.26">           }</span>
<a href="#l15.27"></a><span id="l15.27">           return null;</span>
<a href="#l15.28"></a><span id="l15.28">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l15.29"></a><span id="l15.29">       &lt;/property&gt;</span>
<a href="#l15.30"></a><span id="l15.30"> </span>
<a href="#l15.31"></a><span id="l15.31">       &lt;method name=&quot;updatePref&quot;&gt;</span>
<a href="#l15.32"></a><span id="l15.32">         &lt;parameter name=&quot;aPref&quot;/&gt;</span>
<a href="#l15.33"></a><span id="l15.33">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.34"></a><span id="l15.34">           if (aPref == &quot;browser.urlbar.showSearch&quot;)</span>
<a href="#l15.35"></a><span id="l15.35">             this.showSearch = this.mPrefs.getBoolPref(&quot;browser.urlbar.showSearch&quot;);</span>
<a href="#l15.36"></a><span id="l15.36">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.37"></a><span id="l15.37">       &lt;/method&gt;</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-      </span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+</span>
<a href="#l15.40"></a><span id="l15.40">       &lt;method name=&quot;addEngine&quot;&gt;</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">-        &lt;parameter name=&quot;aEngineId&quot;/&gt;</span>
<a href="#l15.42"></a><span id="l15.42">         &lt;parameter name=&quot;aName&quot;/&gt;</span>
<a href="#l15.43"></a><span id="l15.43">         &lt;parameter name=&quot;aIcon&quot;/&gt;</span>
<a href="#l15.44"></a><span id="l15.44">         &lt;parameter name=&quot;aSearchBarUrl&quot;/&gt;</span>
<a href="#l15.45"></a><span id="l15.45">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.46"></a><span id="l15.46">           var box = document.createElement(&quot;box&quot;);</span>
<a href="#l15.47"></a><span id="l15.47">           box.setAttribute(&quot;class&quot;, &quot;autocomplete-search-engine&quot;);</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">-          box.setAttribute(&quot;searchEngine&quot;, aEngineId);</span>
<a href="#l15.49"></a><span id="l15.49">           box.setAttribute(&quot;name&quot;, aName);</span>
<a href="#l15.50"></a><span id="l15.50">           box.setAttribute(&quot;icon&quot;, aIcon);</span>
<a href="#l15.51"></a><span id="l15.51">           box.setAttribute(&quot;searchBarUrl&quot;, aSearchBarUrl);</span>
<a href="#l15.52"></a><span id="l15.52">           box.setAttribute(&quot;engineIndex&quot;, this.childNodes.length);</span>
<a href="#l15.53"></a><span id="l15.53">           this.mSearchBox.appendChild(box);</span>
<a href="#l15.54"></a><span id="l15.54">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.55"></a><span id="l15.55">       &lt;/method&gt;</span>
<a href="#l15.56"></a><span id="l15.56"> </span>
<a href="#l15.57"></a><span id="l15.57">       &lt;method name=&quot;clearEngines&quot;&gt;</span>
<a href="#l15.58"></a><span id="l15.58">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.59"></a><span id="l15.59">           while (this.mSearchBox.hasChildNodes())</span>
<a href="#l15.60"></a><span id="l15.60">             this.mSearchBox.removeChild(this.mSearchBox.lastChild);</span>
<a href="#l15.61"></a><span id="l15.61">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.62"></a><span id="l15.62">       &lt;/method&gt;</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-   </span>
<a href="#l15.64"></a><span id="l15.64" class="difflineplus">+</span>
<a href="#l15.65"></a><span id="l15.65">       &lt;method name=&quot;updateEngines&quot;&gt;</span>
<a href="#l15.66"></a><span id="l15.66">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-          var rdf = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;]</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-                      .getService(Components.interfaces.nsIRDFService);</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-          try {</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-            var ds = rdf.GetDataSource(&quot;rdf:internetsearch&quot;);</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-          } catch (ex) {</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-            // sometimes bad profiles cause this error, which horks the hold urlbar</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-            return;</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineminus">-          }</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineminus">-                              </span>
<a href="#l15.76"></a><span id="l15.76" class="difflineminus">-          const kNC_Name = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#Name&quot;);</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-          const kNC_Icon = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#Icon&quot;);</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineminus">-          const kNC_searchBarUrl = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#actionBar&quot;);</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineminus">-        </span>
<a href="#l15.80"></a><span id="l15.80" class="difflineminus">-          var defaultEngine = null;</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineminus">-          try {</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineminus">-            defaultEngine = this.mPrefs.getComplexValue(&quot;browser.search.defaultengine&quot;,</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineminus">-                                                        Components.interfaces.nsISupportsString).data;</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineminus">-          } catch(ex) {</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineminus">-            // this will re-invoke updateEngines via the pref observer if the pref changes</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineminus">-            this.ensureDefaultEnginePrefs(rdf, ds);</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-            return;</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-          }</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-          </span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+          var defaultEngine = Services.search.defaultEngine;</span>
<a href="#l15.91"></a><span id="l15.91">           if (defaultEngine) {</span>
<a href="#l15.92"></a><span id="l15.92">             this.clearEngines();</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineminus">-            </span>
<a href="#l15.94"></a><span id="l15.94" class="difflineminus">-            if (ds) {</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineminus">-              var res = rdf.GetResource(defaultEngine);</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineminus">-              try {</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineminus">-                var searchBarUrl = this.readRDFString(ds, res, kNC_searchBarUrl);</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineminus">-              } catch(ex) {</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineminus">-                searchBarUrl = null;</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineminus">-              }</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-              if (searchBarUrl == null) {</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineminus">-                // this will re-invoke updateEngines via the pref observer if the pref changes</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineminus">-                this.ensureDefaultEnginePrefs(rdf, ds);</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-                return;</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineminus">-              }</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineminus">-              this.addEngine(res.Value, </span>
<a href="#l15.107"></a><span id="l15.107" class="difflineminus">-                            this.readRDFString(ds, res, kNC_Name),</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineminus">-                            this.readRDFString(ds, res, kNC_Icon),</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineminus">-                            searchBarUrl);</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineminus">-            }</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineplus">+            this.addEngine(defaultEngine.name, defaultEngine.iconURI,</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineplus">+                           defaultEngine.searchForm);</span>
<a href="#l15.113"></a><span id="l15.113">           }</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineminus">-          </span>
<a href="#l15.115"></a><span id="l15.115" class="difflineminus">-          this.mEnginesReady = true;</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l15.118"></a><span id="l15.118"> </span>
<a href="#l15.119"></a><span id="l15.119" class="difflineminus">-      &lt;method name=&quot;ensureDefaultEnginePrefs&quot;&gt;</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineminus">-        &lt;parameter name=&quot;aRDF&quot;/&gt;</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineminus">-        &lt;parameter name=&quot;aDS&quot;/&gt;</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineminus">-          var defaultName = this.mPrefs.getComplexValue(&quot;browser.search.defaultenginename&quot;,</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineminus">-                                                        Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineminus">-          const kNC_Root = aRDF.GetResource(&quot;NC:SearchEngineRoot&quot;);</span>
<a href="#l15.126"></a><span id="l15.126" class="difflineminus">-          const kNC_child = aRDF.GetResource(&quot;http://home.netscape.com/NC-rdf#child&quot;);</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineminus">-          const kNC_Name = aRDF.GetResource(&quot;http://home.netscape.com/NC-rdf#Name&quot;);</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineminus">-          </span>
<a href="#l15.129"></a><span id="l15.129" class="difflineminus">-          var arcs = aDS.GetTargets(kNC_Root, kNC_child, true);</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineminus">-          while (arcs.hasMoreElements()) {</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineminus">-            var engineRes = arcs.getNext().QueryInterface(Components.interfaces.nsIRDFResource);</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineminus">-            var name = this.readRDFString(aDS, engineRes, kNC_Name);</span>
<a href="#l15.133"></a><span id="l15.133" class="difflineminus">-            if (name == defaultName) {</span>
<a href="#l15.134"></a><span id="l15.134" class="difflineminus">-              var str = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l15.135"></a><span id="l15.135" class="difflineminus">-                                  .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l15.136"></a><span id="l15.136" class="difflineminus">-              str.data = engineRes.Value;</span>
<a href="#l15.137"></a><span id="l15.137" class="difflineminus">-              this.mPrefs.setComplexValue(&quot;browser.search.defaultengine&quot;,</span>
<a href="#l15.138"></a><span id="l15.138" class="difflineminus">-                                          Components.interfaces.nsISupportsString,</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineminus">-                                          str);</span>
<a href="#l15.140"></a><span id="l15.140" class="difflineminus">-            }</span>
<a href="#l15.141"></a><span id="l15.141" class="difflineminus">-          }</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineplus">+          this.mEnginesReady = true;</span>
<a href="#l15.143"></a><span id="l15.143">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.144"></a><span id="l15.144">       &lt;/method&gt;</span>
<a href="#l15.145"></a><span id="l15.145"> </span>
<a href="#l15.146"></a><span id="l15.146">       &lt;method name=&quot;readRDFString&quot;&gt;</span>
<a href="#l15.147"></a><span id="l15.147">         &lt;parameter name=&quot;aDS&quot;/&gt;</span>
<a href="#l15.148"></a><span id="l15.148">         &lt;parameter name=&quot;aRes&quot;/&gt;</span>
<a href="#l15.149"></a><span id="l15.149">         &lt;parameter name=&quot;aProp&quot;/&gt;</span>
<a href="#l15.150"></a><span id="l15.150">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.151"></a><span id="l15.151" class="difflineat">@@ -440,28 +367,34 @@</span>
<a href="#l15.152"></a><span id="l15.152">           return this.selectedIndex = this.parentNode.getNextIndex(aReverse, aPage, this.selectedIndex, this.childNodes.length - 1);</span>
<a href="#l15.153"></a><span id="l15.153">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.154"></a><span id="l15.154">       &lt;/method&gt;</span>
<a href="#l15.155"></a><span id="l15.155"> </span>
<a href="#l15.156"></a><span id="l15.156">       &lt;property name=&quot;overrideValue&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l15.157"></a><span id="l15.157">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l15.158"></a><span id="l15.158">           var item = this.activeChild;</span>
<a href="#l15.159"></a><span id="l15.159">           if (item) {</span>
<a href="#l15.160"></a><span id="l15.160" class="difflineminus">-            const ISEARCH_CONTRACTID = &quot;@mozilla.org/rdf/datasource;1?name=internetsearch&quot;;</span>
<a href="#l15.161"></a><span id="l15.161" class="difflineminus">-            const nsIInternetSearchService = Components.interfaces.nsIInternetSearchService;           </span>
<a href="#l15.162"></a><span id="l15.162" class="difflineminus">-            var searchService = Components.classes[ISEARCH_CONTRACTID].getService(nsIInternetSearchService);</span>
<a href="#l15.163"></a><span id="l15.163" class="difflineminus">-            var searchEng = item.getAttribute(&quot;searchEngine&quot;);</span>
<a href="#l15.164"></a><span id="l15.164" class="difflineminus">-            var searchEngUrl = item.getAttribute(&quot;searchBarUrl&quot;);</span>
<a href="#l15.165"></a><span id="l15.165" class="difflineminus">-            var escapedSearch = encodeURIComponent(this.mSearchValue)</span>
<a href="#l15.166"></a><span id="l15.166" class="difflineminus">-            if (searchEngUrl) {</span>
<a href="#l15.167"></a><span id="l15.167" class="difflineminus">-                searchEngUrl += escapedSearch;</span>
<a href="#l15.168"></a><span id="l15.168" class="difflineminus">-                return searchEngUrl;</span>
<a href="#l15.169"></a><span id="l15.169" class="difflineminus">-            } else {</span>
<a href="#l15.170"></a><span id="l15.170" class="difflineminus">-              return searchService.GetInternetSearchURL(item.getAttribute(&quot;searchEngine&quot;),escapedSearch, 0, 0, {value:0});</span>
<a href="#l15.171"></a><span id="l15.171" class="difflineminus">-            }</span>
<a href="#l15.172"></a><span id="l15.172" class="difflineplus">+            // XXXsearch: using default engine for now, this ignores the following values:</span>
<a href="#l15.173"></a><span id="l15.173" class="difflineplus">+            //            item.getAttribute(&quot;searchEngine&quot;) and item.getAttribute(&quot;searchBarUrl&quot;)</span>
<a href="#l15.174"></a><span id="l15.174" class="difflineplus">+            var engine = Services.search.defaultEngine;</span>
<a href="#l15.175"></a><span id="l15.175" class="difflineplus">+</span>
<a href="#l15.176"></a><span id="l15.176" class="difflineplus">+            var submission = engine.getSubmission(this.mSearchValue); // HTML response</span>
<a href="#l15.177"></a><span id="l15.177" class="difflineplus">+</span>
<a href="#l15.178"></a><span id="l15.178" class="difflineplus">+            // getSubmission can return null if the engine doesn't have a URL</span>
<a href="#l15.179"></a><span id="l15.179" class="difflineplus">+            // with a text/html response type.  This is unlikely (since</span>
<a href="#l15.180"></a><span id="l15.180" class="difflineplus">+            // SearchService._addEngineToStore() should fail for such an engine),</span>
<a href="#l15.181"></a><span id="l15.181" class="difflineplus">+            // but let's be on the safe side.</span>
<a href="#l15.182"></a><span id="l15.182" class="difflineplus">+            if (!submission)</span>
<a href="#l15.183"></a><span id="l15.183" class="difflineplus">+              return null;</span>
<a href="#l15.184"></a><span id="l15.184" class="difflineplus">+</span>
<a href="#l15.185"></a><span id="l15.185" class="difflineplus">+            // XXXsearch: the submission object may have postData but .overrideValue can't deal with that</span>
<a href="#l15.186"></a><span id="l15.186" class="difflineplus">+            //            see http://mxr.mozilla.org/comm-central/source/mozilla/netwerk/base/public/nsIBrowserSearchService.idl#47</span>
<a href="#l15.187"></a><span id="l15.187" class="difflineplus">+            //            we need to figure out what to do with that case here</span>
<a href="#l15.188"></a><span id="l15.188" class="difflineplus">+</span>
<a href="#l15.189"></a><span id="l15.189" class="difflineplus">+            return submission.uri.spec;</span>
<a href="#l15.190"></a><span id="l15.190">           }</span>
<a href="#l15.191"></a><span id="l15.191">           return null;</span>
<a href="#l15.192"></a><span id="l15.192">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l15.193"></a><span id="l15.193">       &lt;/property&gt;</span>
<a href="#l15.194"></a><span id="l15.194"> </span>
<a href="#l15.195"></a><span id="l15.195">     &lt;/implementation&gt;</span>
<a href="#l15.196"></a><span id="l15.196"> </span>
<a href="#l15.197"></a><span id="l15.197">     &lt;handlers&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/build/nsSuiteModule.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/build/nsSuiteModule.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -36,18 +36,16 @@</span>
<a href="#l16.4"></a><span id="l16.4">  *</span>
<a href="#l16.5"></a><span id="l16.5">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7"> #include &quot;mozilla/ModuleUtils.h&quot;</span>
<a href="#l16.8"></a><span id="l16.8"> #include &quot;nsSuiteDirectoryProvider.h&quot;</span>
<a href="#l16.9"></a><span id="l16.9"> #include &quot;nsProfileMigrator.h&quot;</span>
<a href="#l16.10"></a><span id="l16.10"> #include &quot;nsSeamonkeyProfileMigrator.h&quot;</span>
<a href="#l16.11"></a><span id="l16.11"> #include &quot;nsThunderbirdProfileMigrator.h&quot;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-#include &quot;nsInternetSearchService.h&quot;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-#include &quot;nsLocalSearchService.h&quot;</span>
<a href="#l16.14"></a><span id="l16.14"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l16.15"></a><span id="l16.15"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l16.16"></a><span id="l16.16"> #include &quot;nsFeedSniffer.h&quot;</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18"> #if defined(XP_WIN)</span>
<a href="#l16.19"></a><span id="l16.19"> #include &quot;nsUrlWidget.h&quot;</span>
<a href="#l16.20"></a><span id="l16.20"> #if !defined(BUILD_STATIC_SHELL)</span>
<a href="#l16.21"></a><span id="l16.21"> #include &quot;nsWindowsShellService.h&quot;</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -69,36 +67,32 @@ NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsWi</span>
<a href="#l16.23"></a><span id="l16.23"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMacShellService)</span>
<a href="#l16.24"></a><span id="l16.24"> #elif defined(MOZ_WIDGET_GTK2) &amp;&amp; !defined(BUILD_STATIC_SHELL)</span>
<a href="#l16.25"></a><span id="l16.25"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsGNOMEShellService, Init)</span>
<a href="#l16.26"></a><span id="l16.26"> #endif</span>
<a href="#l16.27"></a><span id="l16.27"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsSuiteDirectoryProvider)</span>
<a href="#l16.28"></a><span id="l16.28"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsProfileMigrator)</span>
<a href="#l16.29"></a><span id="l16.29"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsSeamonkeyProfileMigrator)</span>
<a href="#l16.30"></a><span id="l16.30"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsThunderbirdProfileMigrator)</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(LocalSearchDataSource, Init)</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(InternetSearchDataSource, Init)</span>
<a href="#l16.33"></a><span id="l16.33"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsFeedSniffer)</span>
<a href="#l16.34"></a><span id="l16.34"> </span>
<a href="#l16.35"></a><span id="l16.35"> #if defined(XP_WIN)</span>
<a href="#l16.36"></a><span id="l16.36"> NS_DEFINE_NAMED_CID(NS_IURLWIDGET_CID);</span>
<a href="#l16.37"></a><span id="l16.37"> #endif</span>
<a href="#l16.38"></a><span id="l16.38"> #if defined(NS_SUITEWININTEGRATION_CID)</span>
<a href="#l16.39"></a><span id="l16.39"> NS_DEFINE_NAMED_CID(NS_SUITEWININTEGRATION_CID);</span>
<a href="#l16.40"></a><span id="l16.40"> #elif defined(NS_SUITEMACINTEGRATION_CID)</span>
<a href="#l16.41"></a><span id="l16.41"> NS_DEFINE_NAMED_CID(NS_SUITEMACINTEGRATION_CID);</span>
<a href="#l16.42"></a><span id="l16.42"> #elif defined(NS_SUITEGNOMEINTEGRATION_CID)</span>
<a href="#l16.43"></a><span id="l16.43"> NS_DEFINE_NAMED_CID(NS_SUITEGNOMEINTEGRATION_CID);</span>
<a href="#l16.44"></a><span id="l16.44"> #endif</span>
<a href="#l16.45"></a><span id="l16.45"> NS_DEFINE_NAMED_CID(NS_SUITEDIRECTORYPROVIDER_CID);</span>
<a href="#l16.46"></a><span id="l16.46"> NS_DEFINE_NAMED_CID(NS_SUITEPROFILEMIGRATOR_CID);</span>
<a href="#l16.47"></a><span id="l16.47"> NS_DEFINE_NAMED_CID(NS_SEAMONKEYPROFILEMIGRATOR_CID);</span>
<a href="#l16.48"></a><span id="l16.48"> NS_DEFINE_NAMED_CID(NS_THUNDERBIRDPROFILEMIGRATOR_CID);</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_RDFFINDDATASOURCE_CID);</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_RDFSEARCHDATASOURCE_CID);</span>
<a href="#l16.51"></a><span id="l16.51"> NS_DEFINE_NAMED_CID(NS_FEEDSNIFFER_CID);</span>
<a href="#l16.52"></a><span id="l16.52"> </span>
<a href="#l16.53"></a><span id="l16.53"> /////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.54"></a><span id="l16.54"> </span>
<a href="#l16.55"></a><span id="l16.55"> static const mozilla::Module::CIDEntry kSuiteCIDs[] = {</span>
<a href="#l16.56"></a><span id="l16.56"> #if defined(XP_WIN)</span>
<a href="#l16.57"></a><span id="l16.57">   { &amp;kNS_IURLWIDGET_CID, false, NULL, nsUrlWidgetConstructor },</span>
<a href="#l16.58"></a><span id="l16.58"> #endif</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineat">@@ -108,18 +102,16 @@ static const mozilla::Module::CIDEntry k</span>
<a href="#l16.60"></a><span id="l16.60">   { &amp;kNS_SUITEMACINTEGRATION_CID, false, NULL, nsMacShellServiceConstructor },</span>
<a href="#l16.61"></a><span id="l16.61"> #elif defined(NS_SUITEGNOMEINTEGRATION_CID)</span>
<a href="#l16.62"></a><span id="l16.62">   { &amp;kNS_SUITEGNOMEINTEGRATION_CID, false, NULL, nsGNOMEShellServiceConstructor },</span>
<a href="#l16.63"></a><span id="l16.63"> #endif</span>
<a href="#l16.64"></a><span id="l16.64">   { &amp;kNS_SUITEDIRECTORYPROVIDER_CID, false, NULL, nsSuiteDirectoryProviderConstructor },</span>
<a href="#l16.65"></a><span id="l16.65">   { &amp;kNS_SUITEPROFILEMIGRATOR_CID, false, NULL, nsProfileMigratorConstructor },</span>
<a href="#l16.66"></a><span id="l16.66">   { &amp;kNS_SEAMONKEYPROFILEMIGRATOR_CID, false, NULL, nsSeamonkeyProfileMigratorConstructor },</span>
<a href="#l16.67"></a><span id="l16.67">   { &amp;kNS_THUNDERBIRDPROFILEMIGRATOR_CID, false, NULL, nsThunderbirdProfileMigratorConstructor },</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineminus">-  { &amp;kNS_RDFFINDDATASOURCE_CID, false, NULL, LocalSearchDataSourceConstructor },</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineminus">-  { &amp;kNS_RDFSEARCHDATASOURCE_CID, false, NULL, InternetSearchDataSourceConstructor },</span>
<a href="#l16.70"></a><span id="l16.70">   { &amp;kNS_FEEDSNIFFER_CID, false, NULL, nsFeedSnifferConstructor },</span>
<a href="#l16.71"></a><span id="l16.71">   { NULL }</span>
<a href="#l16.72"></a><span id="l16.72"> };</span>
<a href="#l16.73"></a><span id="l16.73"> </span>
<a href="#l16.74"></a><span id="l16.74"> static const mozilla::Module::ContractIDEntry kSuiteContracts[] = {</span>
<a href="#l16.75"></a><span id="l16.75"> #if defined(XP_WIN)</span>
<a href="#l16.76"></a><span id="l16.76">   { NS_IURLWIDGET_CONTRACTID, &amp;kNS_IURLWIDGET_CID },</span>
<a href="#l16.77"></a><span id="l16.77"> #endif</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineat">@@ -130,20 +122,16 @@ static const mozilla::Module::ContractID</span>
<a href="#l16.79"></a><span id="l16.79">   { NS_SUITEFEEDSERVICE_CONTRACTID, &amp;kNS_SUITEMACINTEGRATION_CID },</span>
<a href="#l16.80"></a><span id="l16.80"> #elif defined(NS_SUITEGNOMEINTEGRATION_CID)</span>
<a href="#l16.81"></a><span id="l16.81">   { NS_SUITEFEEDSERVICE_CONTRACTID, &amp;kNS_SUITEGNOMEINTEGRATION_CID },</span>
<a href="#l16.82"></a><span id="l16.82"> #endif</span>
<a href="#l16.83"></a><span id="l16.83">   { NS_SUITEDIRECTORYPROVIDER_CONTRACTID, &amp;kNS_SUITEDIRECTORYPROVIDER_CID },</span>
<a href="#l16.84"></a><span id="l16.84">   { NS_PROFILEMIGRATOR_CONTRACTID, &amp;kNS_SUITEPROFILEMIGRATOR_CID },</span>
<a href="#l16.85"></a><span id="l16.85">   { NS_SUITEPROFILEMIGRATOR_CONTRACTID_PREFIX &quot;seamonkey&quot;, &amp;kNS_SEAMONKEYPROFILEMIGRATOR_CID },</span>
<a href="#l16.86"></a><span id="l16.86">   { NS_SUITEPROFILEMIGRATOR_CONTRACTID_PREFIX &quot;thunderbird&quot;, &amp;kNS_THUNDERBIRDPROFILEMIGRATOR_CID },</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineminus">-  { NS_LOCALSEARCH_SERVICE_CONTRACTID, &amp;kNS_RDFFINDDATASOURCE_CID },</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineminus">-  { NS_LOCALSEARCH_DATASOURCE_CONTRACTID, &amp;kNS_RDFFINDDATASOURCE_CID },</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineminus">-  { NS_INTERNETSEARCH_SERVICE_CONTRACTID, &amp;kNS_RDFSEARCHDATASOURCE_CID },</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineminus">-  { NS_INTERNETSEARCH_DATASOURCE_CONTRACTID, &amp;kNS_RDFSEARCHDATASOURCE_CID },</span>
<a href="#l16.91"></a><span id="l16.91">   { NS_FEEDSNIFFER_CONTRACTID, &amp;kNS_FEEDSNIFFER_CID },</span>
<a href="#l16.92"></a><span id="l16.92">   { NULL }</span>
<a href="#l16.93"></a><span id="l16.93"> };</span>
<a href="#l16.94"></a><span id="l16.94"> </span>
<a href="#l16.95"></a><span id="l16.95"> static const mozilla::Module::CategoryEntry kSuiteCategories[] = {</span>
<a href="#l16.96"></a><span id="l16.96">   { XPCOM_DIRECTORY_PROVIDER_CATEGORY, &quot;suite-directory-provider&quot;, NS_SUITEDIRECTORYPROVIDER_CONTRACTID },</span>
<a href="#l16.97"></a><span id="l16.97">   { NS_CONTENT_SNIFFER_CATEGORY, &quot;Feed Sniffer&quot;, NS_FEEDSNIFFER_CONTRACTID },</span>
<a href="#l16.98"></a><span id="l16.98">   { NULL }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/suite/common/contentAreaContextOverlay.xul</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/suite/common/contentAreaContextOverlay.xul</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -254,17 +254,17 @@</span>
<a href="#l17.4"></a><span id="l17.4">                 command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l17.5"></a><span id="l17.5">       &lt;menuseparator id=&quot;context-sep-paste&quot;/&gt;</span>
<a href="#l17.6"></a><span id="l17.6">       &lt;menuitem id=&quot;context-selectall&quot;</span>
<a href="#l17.7"></a><span id="l17.7">                 label=&quot;&amp;selectAllCmd.label;&quot;</span>
<a href="#l17.8"></a><span id="l17.8">                 accesskey=&quot;&amp;selectAllCmd.accesskey;&quot;</span>
<a href="#l17.9"></a><span id="l17.9">                 command=&quot;cmd_selectAll&quot;/&gt;</span>
<a href="#l17.10"></a><span id="l17.10">       &lt;menuseparator id=&quot;context-sep-selectall&quot;/&gt;</span>
<a href="#l17.11"></a><span id="l17.11">       &lt;menuitem id=&quot;context-searchselect&quot;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-                oncommand=&quot;OpenSearch('internet', gContextMenu.searchSelected(), true, event.shiftKey);&quot;/&gt;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+                oncommand=&quot;BrowserSearch.loadSearch(gContextMenu.searchSelected(), true);&quot;/&gt;</span>
<a href="#l17.14"></a><span id="l17.14">       &lt;menuseparator id=&quot;frame-sep&quot;/&gt;</span>
<a href="#l17.15"></a><span id="l17.15">       &lt;menu id=&quot;frame&quot; label=&quot;&amp;thisFrameMenu.label;&quot; accesskey=&quot;&amp;thisFrameMenu.accesskey;&quot;&gt;</span>
<a href="#l17.16"></a><span id="l17.16">         &lt;menupopup id=&quot;frame_popup&quot;&gt;</span>
<a href="#l17.17"></a><span id="l17.17">           &lt;menuitem id=&quot;context-showonlythisframe&quot;</span>
<a href="#l17.18"></a><span id="l17.18">                     label=&quot;&amp;showOnlyThisFrameCmd.label;&quot;</span>
<a href="#l17.19"></a><span id="l17.19">                     accesskey=&quot;&amp;showOnlyThisFrameCmd.accesskey;&quot;</span>
<a href="#l17.20"></a><span id="l17.20">                     oncommand=&quot;gContextMenu.showOnlyThisFrame();&quot;/&gt;</span>
<a href="#l17.21"></a><span id="l17.21">           &lt;menuitem id=&quot;context-openframe&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/suite/common/jar.mn</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/suite/common/jar.mn</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -227,23 +227,18 @@ comm.jar:</span>
<a href="#l18.4"></a><span id="l18.4">    content/communicator/pref/pref-search.xul                        (pref/pref-search.xul)</span>
<a href="#l18.5"></a><span id="l18.5">    content/communicator/pref/pref-security.js                       (pref/pref-security.js)</span>
<a href="#l18.6"></a><span id="l18.6">    content/communicator/pref/pref-security.xul                      (pref/pref-security.xul)</span>
<a href="#l18.7"></a><span id="l18.7">    content/communicator/pref/pref-smartupdate.js                    (pref/pref-smartupdate.js)</span>
<a href="#l18.8"></a><span id="l18.8">    content/communicator/pref/pref-smartupdate.xul                   (pref/pref-smartupdate.xul)</span>
<a href="#l18.9"></a><span id="l18.9">    content/communicator/pref/pref-tabs.xul                          (pref/pref-tabs.xul)</span>
<a href="#l18.10"></a><span id="l18.10">    content/communicator/profile/profileSelection.js                 (profile/profileSelection.js)</span>
<a href="#l18.11"></a><span id="l18.11">    content/communicator/profile/profileSelection.xul                (profile/profileSelection.xul)</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-   content/communicator/search/internetresults.js                   (search/internetresults.js)</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-   content/communicator/search/internetresults.xul                  (search/internetresults.xul)</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-   content/communicator/search/search-editor.js                     (search/search-editor.js)</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-   content/communicator/search/search-editor.xul                    (search/search-editor.xul)</span>
<a href="#l18.16"></a><span id="l18.16">    content/communicator/search/search-panel.js                      (search/search-panel.js)</span>
<a href="#l18.17"></a><span id="l18.17">    content/communicator/search/search-panel.xul                     (search/search-panel.xul)</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-   content/communicator/search/shared.js                            (search/shared.js)</span>
<a href="#l18.19"></a><span id="l18.19">    content/communicator/sidebar/customize-panel.js                  (sidebar/customize-panel.js)</span>
<a href="#l18.20"></a><span id="l18.20">    content/communicator/sidebar/customize-panel.xul                 (sidebar/customize-panel.xul)</span>
<a href="#l18.21"></a><span id="l18.21">    content/communicator/sidebar/customize.js                        (sidebar/customize.js)</span>
<a href="#l18.22"></a><span id="l18.22">    content/communicator/sidebar/customize.xul                       (sidebar/customize.xul)</span>
<a href="#l18.23"></a><span id="l18.23">    content/communicator/sidebar/local-panels.rdf                    (sidebar/local-panels.rdf)</span>
<a href="#l18.24"></a><span id="l18.24">    content/communicator/sidebar/PageNotFound.xul                    (sidebar/PageNotFound.xul)</span>
<a href="#l18.25"></a><span id="l18.25">    content/communicator/sidebar/preview.js                          (sidebar/preview.js)</span>
<a href="#l18.26"></a><span id="l18.26">    content/communicator/sidebar/preview.xul                         (sidebar/preview.xul)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/common/nsContextMenu.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/common/nsContextMenu.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -607,17 +607,17 @@ nsContextMenu.prototype = {</span>
<a href="#l19.4"></a><span id="l19.4">               (elem instanceof HTMLModElement &amp;&amp; (elem.cite || elem.dateTime)) ||</span>
<a href="#l19.5"></a><span id="l19.5">               (elem instanceof HTMLElement &amp;&amp; (elem.title || elem.lang)) ||</span>
<a href="#l19.6"></a><span id="l19.6">               elem.getAttributeNS(XMLNS, &quot;lang&quot;)) {</span>
<a href="#l19.7"></a><span id="l19.7">             dump(&quot;On metadata item.\n&quot;);</span>
<a href="#l19.8"></a><span id="l19.8">             this.onMetaDataItem = true;</span>
<a href="#l19.9"></a><span id="l19.9">           }</span>
<a href="#l19.10"></a><span id="l19.10">         }</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-        // Background image?  Don't bother if we've already found a </span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+        // Background image?  Don't bother if we've already found a</span>
<a href="#l19.14"></a><span id="l19.14">         // background image further down the hierarchy.  Otherwise,</span>
<a href="#l19.15"></a><span id="l19.15">         // we look for the computed background-image style.</span>
<a href="#l19.16"></a><span id="l19.16">         if (!this.hasBGImage) {</span>
<a href="#l19.17"></a><span id="l19.17">           var bgImgUrl = this.getComputedURL(elem, &quot;background-image&quot;);</span>
<a href="#l19.18"></a><span id="l19.18">           if (bgImgUrl) {</span>
<a href="#l19.19"></a><span id="l19.19">             this.hasBGImage = true;</span>
<a href="#l19.20"></a><span id="l19.20">             this.bgImageURL = this.makeURLAbsolute(elem.baseURI, bgImgUrl);</span>
<a href="#l19.21"></a><span id="l19.21">           }</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -1200,23 +1200,31 @@ nsContextMenu.prototype = {</span>
<a href="#l19.23"></a><span id="l19.23">   isTextSelection: function() {</span>
<a href="#l19.24"></a><span id="l19.24">     var searchSelectText = this.searchSelected(16);</span>
<a href="#l19.25"></a><span id="l19.25">     if (!searchSelectText)</span>
<a href="#l19.26"></a><span id="l19.26">       return false;</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">     if (searchSelectText.length &gt; 15)</span>
<a href="#l19.29"></a><span id="l19.29">       searchSelectText = searchSelectText.substr(0, 15) + this.ellipsis;</span>
<a href="#l19.30"></a><span id="l19.30"> </span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-    // Format &quot;Search for &lt;selection&gt;&quot; string to show in menu.</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+    // Use the current engine if it's a browser window and the search bar is</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+    // visible, the default engine otherwise.</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineplus">+    var engineName = &quot;&quot;;</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+    if (window.BrowserSearch &amp;&amp; BrowserSearch.searchBar &amp;&amp; isElementVisible(BrowserSearch.searchBar))</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+      engineName = Services.search.currentEngine.name;</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+    else</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineplus">+      engineName = Services.search.defaultEngine.name;</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineplus">+    // format &quot;Search &lt;engine&gt; for &lt;selection&gt;&quot; string to show in menu</span>
<a href="#l19.41"></a><span id="l19.41">     const bundle = document.getElementById(&quot;contentAreaCommandsBundle&quot;);</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-    searchSelectText = bundle.getFormattedString(&quot;searchText&quot;,</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineminus">-                                                 [searchSelectText]);</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineminus">-    this.setItemAttr(&quot;context-searchselect&quot;, &quot;label&quot;, searchSelectText);</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineplus">+    var menuLabel = bundle.getFormattedString(&quot;contextMenuSearchText&quot;,</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineplus">+                                              [engineName, searchSelectText]);</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineplus">+    this.setItemAttr(&quot;context-searchselect&quot;, &quot;label&quot;, menuLabel);</span>
<a href="#l19.48"></a><span id="l19.48">     this.setItemAttr(&quot;context-searchselect&quot;, &quot;accesskey&quot;,</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineminus">-                     bundle.getString(&quot;searchText.accesskey&quot;));</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+                     bundle.getString(&quot;contextMenuSearchText.accesskey&quot;));</span>
<a href="#l19.51"></a><span id="l19.51"> </span>
<a href="#l19.52"></a><span id="l19.52">     return true;</span>
<a href="#l19.53"></a><span id="l19.53">   },</span>
<a href="#l19.54"></a><span id="l19.54"> </span>
<a href="#l19.55"></a><span id="l19.55">   searchSelected: function(aCharlen) {</span>
<a href="#l19.56"></a><span id="l19.56">     var focusedWindow = document.commandDispatcher.focusedWindow;</span>
<a href="#l19.57"></a><span id="l19.57">     var searchStr = focusedWindow.getSelection();</span>
<a href="#l19.58"></a><span id="l19.58">     searchStr = searchStr.toString();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/suite/common/pref/pref-search.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/suite/common/pref/pref-search.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -11,63 +11,46 @@</span>
<a href="#l20.4"></a><span id="l20.4">  * for the specific language governing rights and limitations under the</span>
<a href="#l20.5"></a><span id="l20.5">  * License.</span>
<a href="#l20.6"></a><span id="l20.6">  *</span>
<a href="#l20.7"></a><span id="l20.7">  * The Original Code is Mozilla Communicator client code, released</span>
<a href="#l20.8"></a><span id="l20.8">  * March 31, 1998.</span>
<a href="#l20.9"></a><span id="l20.9">  *</span>
<a href="#l20.10"></a><span id="l20.10">  * The Initial Developer of the Original Code is</span>
<a href="#l20.11"></a><span id="l20.11">  * Netscape Communications Corporation.</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998-1999</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 1998-2010</span>
<a href="#l20.14"></a><span id="l20.14">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l20.15"></a><span id="l20.15">  *</span>
<a href="#l20.16"></a><span id="l20.16">  * Contributor(s):</span>
<a href="#l20.17"></a><span id="l20.17">  *   Robert John Churchill &lt;rjc@netscape.com&gt;</span>
<a href="#l20.18"></a><span id="l20.18">  *   Mark Olson &lt;maolson@earthlink.net&gt;</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+ *   Robert Kaiser &lt;kairo@kairo.at&gt;</span>
<a href="#l20.20"></a><span id="l20.20">  *</span>
<a href="#l20.21"></a><span id="l20.21">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l20.22"></a><span id="l20.22">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l20.23"></a><span id="l20.23">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l20.24"></a><span id="l20.24">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l20.25"></a><span id="l20.25">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l20.26"></a><span id="l20.26">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l20.27"></a><span id="l20.27">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l20.28"></a><span id="l20.28">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l20.29"></a><span id="l20.29">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l20.30"></a><span id="l20.30">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l20.31"></a><span id="l20.31">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l20.32"></a><span id="l20.32">  *</span>
<a href="#l20.33"></a><span id="l20.33">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l20.34"></a><span id="l20.34"> </span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-function Startup()</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-{</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-  var engineList = document.getElementById(&quot;engineList&quot;);</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineminus">-  // Need to set ref attribute once overlay has loaded</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-  engineList.setAttribute(&quot;ref&quot;, &quot;NC:SearchEngineRoot&quot;);</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">-  // Due to a bug in the internet search service, the first time</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineminus">-  // ref is set only one menuitem is built, so force a rebuild</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineminus">-  engineList.builder.rebuild();</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineminus">-</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-  // Since the menulist starts off empty it has no selected item</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineminus">-  // so try and set it to the preference value.</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineminus">-  var pref = document.getElementById(engineList.getAttribute(&quot;preference&quot;));</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineminus">-  engineList.value = pref.value;</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l20.49"></a><span id="l20.49"> </span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-  // nothing is selected</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineminus">-  if (!engineList.selectedItem)</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineminus">-  {</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-    var name = document.getElementById(&quot;browser.search.defaultenginename&quot;).value;</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineminus">-    var selectedItem = engineList.getElementsByAttribute(&quot;label&quot;, name).item(0);</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineminus">- </span>
<a href="#l20.56"></a><span id="l20.56" class="difflineminus">-    if (selectedItem)</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineminus">-    {</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineminus">-      // select a locale-dependent predefined search engine</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineminus">-      // in absence of a user default</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineminus">-      engineList.selectedItem = selectedItem;</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineminus">-    }</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineminus">-    else</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineminus">-    {</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineminus">-      // select the first listed search engine</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineminus">-      engineList.selectedIndex = 0;</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineminus">-    }</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineminus">-    pref.value = engineList.value;</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineplus">+function Startup() {</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineplus">+  var menulist = document.getElementById(&quot;engineList&quot;);</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineplus">+  var engines = Services.search.getVisibleEngines();</span>
<a href="#l20.71"></a><span id="l20.71" class="difflineplus">+  for (let i = 0; i &lt; engines.length; i++) {</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineplus">+    let name = engines[i].name;</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineplus">+    let menuitem = menulist.appendItem(name, name);</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineplus">+    menuitem.setAttribute(&quot;class&quot;, &quot;menuitem-iconic&quot;);</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineplus">+    if (engines[i].iconURI)</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineplus">+      menuitem.setAttribute(&quot;image&quot;, engines[i].iconURI.spec);</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineplus">+    menulist.menupopup.appendChild(menuitem);</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineplus">+    menuitem.engine = engines[i];</span>
<a href="#l20.79"></a><span id="l20.79">   }</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineplus">+  menulist.value = Services.search.defaultEngine.name;</span>
<a href="#l20.81"></a><span id="l20.81"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/suite/common/pref/pref-search.xul</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/suite/common/pref/pref-search.xul</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,116 +1,85 @@</span>
<a href="#l21.4"></a><span id="l21.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l21.5"></a><span id="l21.5"> &lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineminus">- Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineminus">-</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineminus">- The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineminus">- 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineminus">- the License. You may obtain a copy of the License at</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineminus">- http://www.mozilla.org/MPL/</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">- Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">- WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">- for the specific language governing rights and limitations under the</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">- License.</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">-</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineminus">- The Original Code is Mozilla Communicator client code, released</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineminus">- March 31, 1998.</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+   -</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineplus">+   -</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+   - License.</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+   -</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+   - The Original Code is Mozilla Communicator client code, released</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+   - March 31, 1998.</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+   -</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+   - The Initial Developer of the Original Code is</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+   - Netscape Communications Corporation.</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 1998-2010</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+   -</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+   - Contributor(s):</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+   -   Robert John Churchill &lt;rjc@netscape.com&gt;</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineplus">+   -   Robert Kaiser &lt;kairo@kairo.at&gt;</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineplus">+   -</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineplus">+   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+   -</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l21.57"></a><span id="l21.57"> </span>
<a href="#l21.58"></a><span id="l21.58" class="difflineminus">- The Initial Developer of the Original Code is</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineminus">- Netscape Communications Corporation.</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">- Portions created by the Initial Developer are Copyright (C) 1998-1999</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineminus">- the Initial Developer. All Rights Reserved.</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineminus">-</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineminus">- Contributor(s):</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineminus">-   Robert John Churchill (rjc@netscape.com)</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineminus">-</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineminus">- Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineminus">- either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineminus">- or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineminus">- in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineminus">- of those above. If you wish to allow use of your version of this file only</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineminus">- under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineminus">- use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineminus">- decision by deleting the provisions above and replace them with the notice</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineminus">- and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineminus">- the provisions above, a recipient may use your version of this file under</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineminus">- the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineminus">-</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineminus">- ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l21.79"></a><span id="l21.79"> &lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l21.80"></a><span id="l21.80"> </span>
<a href="#l21.81"></a><span id="l21.81"> &lt;!DOCTYPE overlay SYSTEM &quot;chrome://communicator/locale/pref/pref-search.dtd&quot;&gt;</span>
<a href="#l21.82"></a><span id="l21.82"> &lt;overlay xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l21.83"></a><span id="l21.83">   &lt;prefpane id=&quot;search_pane&quot;</span>
<a href="#l21.84"></a><span id="l21.84">             label=&quot;&amp;pref.search.title;&quot;</span>
<a href="#l21.85"></a><span id="l21.85">             script=&quot;chrome://communicator/content/pref/pref-search.js&quot;&gt;</span>
<a href="#l21.86"></a><span id="l21.86"> </span>
<a href="#l21.87"></a><span id="l21.87">     &lt;preferences id=&quot;search_preferences&quot;&gt;</span>
<a href="#l21.88"></a><span id="l21.88">       &lt;preference id=&quot;browser.search.defaultenginename&quot;</span>
<a href="#l21.89"></a><span id="l21.89">                   name=&quot;browser.search.defaultenginename&quot;</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineminus">-                  type=&quot;wstring&quot;/&gt;</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineminus">-      &lt;preference id=&quot;browser.search.defaultengine&quot;</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineminus">-                  name=&quot;browser.search.defaultengine&quot;</span>
<a href="#l21.93"></a><span id="l21.93">                   type=&quot;string&quot;/&gt;</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineplus">+      &lt;preference id=&quot;browser.search.openintab&quot;</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineplus">+                  name=&quot;browser.search.openintab&quot;</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineplus">+                  type=&quot;bool&quot;/&gt;</span>
<a href="#l21.97"></a><span id="l21.97">       &lt;preference id=&quot;browser.search.opensidebarsearchpanel&quot;</span>
<a href="#l21.98"></a><span id="l21.98">                   name=&quot;browser.search.opensidebarsearchpanel&quot;</span>
<a href="#l21.99"></a><span id="l21.99">                   type=&quot;bool&quot;/&gt;</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineminus">-      &lt;preference id=&quot;browser.search.opentabforcontextsearch&quot;</span>
<a href="#l21.101"></a><span id="l21.101" class="difflineminus">-                  name=&quot;browser.search.opentabforcontextsearch&quot;</span>
<a href="#l21.102"></a><span id="l21.102" class="difflineminus">-                  type=&quot;bool&quot;/&gt;</span>
<a href="#l21.103"></a><span id="l21.103" class="difflineminus">-      &lt;preference id=&quot;browser.search.mode&quot;</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineminus">-                  name=&quot;browser.search.mode&quot;</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineminus">-                  type=&quot;int&quot;/&gt;</span>
<a href="#l21.106"></a><span id="l21.106">     &lt;/preferences&gt;</span>
<a href="#l21.107"></a><span id="l21.107"> </span>
<a href="#l21.108"></a><span id="l21.108">     &lt;groupbox&gt;</span>
<a href="#l21.109"></a><span id="l21.109">       &lt;caption label=&quot;&amp;legendHeader;&quot;/&gt;</span>
<a href="#l21.110"></a><span id="l21.110"> </span>
<a href="#l21.111"></a><span id="l21.111">       &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l21.112"></a><span id="l21.112">         &lt;label value=&quot;&amp;defaultSearchEngine.label;&quot;</span>
<a href="#l21.113"></a><span id="l21.113">                accesskey=&quot;&amp;defaultSearchEngine.accesskey;&quot;</span>
<a href="#l21.114"></a><span id="l21.114">                control=&quot;engineList&quot;/&gt;</span>
<a href="#l21.115"></a><span id="l21.115">         &lt;menulist id=&quot;engineList&quot;</span>
<a href="#l21.116"></a><span id="l21.116" class="difflineminus">-                  ref=&quot;&quot;</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineminus">-                  datasources=&quot;rdf:internetsearch&quot;</span>
<a href="#l21.118"></a><span id="l21.118" class="difflineminus">-                  sortResource=&quot;http://home.netscape.com/NC-rdf#Name&quot;</span>
<a href="#l21.119"></a><span id="l21.119" class="difflineminus">-                  sortDirection=&quot;ascending&quot;</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineminus">-                  preference=&quot;browser.search.defaultengine&quot;&gt;</span>
<a href="#l21.121"></a><span id="l21.121" class="difflineminus">-          &lt;template&gt;</span>
<a href="#l21.122"></a><span id="l21.122" class="difflineminus">-            &lt;menupopup&gt;</span>
<a href="#l21.123"></a><span id="l21.123" class="difflineminus">-              &lt;menuitem class=&quot;menuitem-iconic&quot;</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineminus">-                        value=&quot;...&quot;</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineminus">-                        uri=&quot;...&quot;</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineminus">-                        image=&quot;rdf:http://home.netscape.com/NC-rdf#Icon&quot;</span>
<a href="#l21.127"></a><span id="l21.127" class="difflineminus">-                        label=&quot;rdf:http://home.netscape.com/NC-rdf#Name&quot;/&gt;</span>
<a href="#l21.128"></a><span id="l21.128" class="difflineminus">-            &lt;/menupopup&gt;</span>
<a href="#l21.129"></a><span id="l21.129" class="difflineminus">-          &lt;/template&gt;</span>
<a href="#l21.130"></a><span id="l21.130" class="difflineminus">-        &lt;/menulist&gt;</span>
<a href="#l21.131"></a><span id="l21.131" class="difflineplus">+                  preference=&quot;browser.search.defaultenginename&quot;/&gt;</span>
<a href="#l21.132"></a><span id="l21.132">       &lt;/hbox&gt;</span>
<a href="#l21.133"></a><span id="l21.133">     &lt;/groupbox&gt;</span>
<a href="#l21.134"></a><span id="l21.134"> </span>
<a href="#l21.135"></a><span id="l21.135">     &lt;groupbox&gt;</span>
<a href="#l21.136"></a><span id="l21.136">       &lt;caption label=&quot;&amp;searchResults.label;&quot;/&gt;</span>
<a href="#l21.137"></a><span id="l21.137" class="difflineplus">+      &lt;checkbox id=&quot;openSearchTab&quot;</span>
<a href="#l21.138"></a><span id="l21.138" class="difflineplus">+                label=&quot;&amp;openInTab.label;&quot;</span>
<a href="#l21.139"></a><span id="l21.139" class="difflineplus">+                accesskey=&quot;&amp;openInTab.accesskey;&quot;</span>
<a href="#l21.140"></a><span id="l21.140" class="difflineplus">+                preference=&quot;browser.search.openintab&quot;/&gt;</span>
<a href="#l21.141"></a><span id="l21.141">       &lt;checkbox id=&quot;openSidebarPanel&quot;</span>
<a href="#l21.142"></a><span id="l21.142">                 label=&quot;&amp;openSidebarSearchPanel.label;&quot;</span>
<a href="#l21.143"></a><span id="l21.143">                 accesskey=&quot;&amp;openSidebarSearchPanel.accesskey;&quot;</span>
<a href="#l21.144"></a><span id="l21.144">                 preference=&quot;browser.search.opensidebarsearchpanel&quot;/&gt;</span>
<a href="#l21.145"></a><span id="l21.145" class="difflineminus">-      &lt;checkbox id=&quot;openContextSearchTab&quot;</span>
<a href="#l21.146"></a><span id="l21.146" class="difflineminus">-                label=&quot;&amp;openContextSearchTab.label;&quot;</span>
<a href="#l21.147"></a><span id="l21.147" class="difflineminus">-                accesskey=&quot;&amp;openContextSearchTab.accesskey;&quot;</span>
<a href="#l21.148"></a><span id="l21.148" class="difflineminus">-                preference=&quot;browser.search.opentabforcontextsearch&quot;/&gt;</span>
<a href="#l21.149"></a><span id="l21.149" class="difflineminus">-    &lt;/groupbox&gt;</span>
<a href="#l21.150"></a><span id="l21.150" class="difflineminus">-</span>
<a href="#l21.151"></a><span id="l21.151" class="difflineminus">-    &lt;groupbox&gt;</span>
<a href="#l21.152"></a><span id="l21.152" class="difflineminus">-      &lt;caption label=&quot;&amp;sidebarSearchTabPref.label;&quot;/&gt;</span>
<a href="#l21.153"></a><span id="l21.153" class="difflineminus">-      &lt;radiogroup id=&quot;sidebarSearchMode&quot;</span>
<a href="#l21.154"></a><span id="l21.154" class="difflineminus">-                  preference=&quot;browser.search.mode&quot;&gt;</span>
<a href="#l21.155"></a><span id="l21.155" class="difflineminus">-        &lt;radio value=&quot;0&quot;</span>
<a href="#l21.156"></a><span id="l21.156" class="difflineminus">-               label=&quot;&amp;searchModeBasic.label;&quot;</span>
<a href="#l21.157"></a><span id="l21.157" class="difflineminus">-               accesskey=&quot;&amp;searchModeBasic.accesskey;&quot;/&gt;</span>
<a href="#l21.158"></a><span id="l21.158" class="difflineminus">-        &lt;radio value=&quot;1&quot;</span>
<a href="#l21.159"></a><span id="l21.159" class="difflineminus">-               label=&quot;&amp;searchModeAdvanced.label;&quot;</span>
<a href="#l21.160"></a><span id="l21.160" class="difflineminus">-               accesskey=&quot;&amp;searchModeAdvanced.accesskey;&quot;/&gt;</span>
<a href="#l21.161"></a><span id="l21.161" class="difflineminus">-      &lt;/radiogroup&gt;</span>
<a href="#l21.162"></a><span id="l21.162">     &lt;/groupbox&gt;</span>
<a href="#l21.163"></a><span id="l21.163">   &lt;/prefpane&gt;</span>
<a href="#l21.164"></a><span id="l21.164"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">deleted file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- a/suite/common/search/internetresults.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ /dev/null</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -1,266 +0,0 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineminus">- *</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l22.10"></a><span id="l22.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">- *</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">- * License.</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">- *</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">- *</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">- * The Initial Developer of the Original Code is Robert John Churchill.</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1999</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineminus">- *</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineminus">- * Contributor(s): </span>
<a href="#l22.25"></a><span id="l22.25" class="difflineminus">- *    Robert John Churchill   &lt;rjc@netscape.com&gt; (Original Author)</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineminus">- *    Ben Goodger             &lt;ben@netscape.com&gt;</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineminus">- *    Daniel Matejka          &lt;danm@netscape.com&gt;</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineminus">- *    Eric Pollmann           &lt;pollmann@netscape.com&gt;</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineminus">- *    Ray Whitmer             &lt;rayw@netscape.com&gt;</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineminus">- *    Peter Annema            &lt;disttsc@bart.nl&gt;</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">- *    Blake Ross              &lt;blakeross@telocity.com&gt;</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">- *    Joe Hewitt              &lt;hewitt@netscape.com&gt;</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineminus">- *    Jan Varga               &lt;varga@utcruk.sk&gt;</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineminus">- *    Karsten Duesterloh      &lt;kd-moz@tprac.de&gt;</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineminus">- *</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineminus">- *</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineminus">-</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineminus">-function searchResultsOpenURL(event)</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineminus">-{</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineminus">-  var tree = document.getElementById(&quot;resultsList&quot;);</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineminus">-  var node = tree.contentView.getItemAtIndex(tree.currentIndex);</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineminus">-  </span>
<a href="#l22.55"></a><span id="l22.55" class="difflineminus">-  var url = node.id;</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineminus">-  var rdf = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;].getService();</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineminus">-  if (rdf)   rdf = rdf.QueryInterface(Components.interfaces.nsIRDFService);</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineminus">-  if (rdf)</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineminus">-  {</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineminus">-    var ds = rdf.GetDataSource(&quot;rdf:internetsearch&quot;);</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineminus">-    if (ds)</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineminus">-    {</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineminus">-      var src = rdf.GetResource(url, true);</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineminus">-      var prop = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#URL&quot;, true);</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineminus">-      var target = ds.GetTarget(src, prop, true);</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineminus">-      if (target) target = target.QueryInterface(Components.interfaces.nsIRDFLiteral);</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineminus">-      if (target) target = target.Value;</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineminus">-      if (target) url = target;</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineminus">-    }</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineminus">-  }</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineminus">-</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineminus">-  // Ignore &quot;NC:&quot; urls.</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineminus">-  if (url.substring(0, 3) == &quot;NC:&quot;)</span>
<a href="#l22.74"></a><span id="l22.74" class="difflineminus">-    return false;</span>
<a href="#l22.75"></a><span id="l22.75" class="difflineminus">-</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineminus">-  if (&quot;loadURI&quot; in top)</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineminus">-    top.loadURI(url);</span>
<a href="#l22.78"></a><span id="l22.78" class="difflineminus">-  else</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineminus">-    top.content.location.href = url;</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineminus">-</span>
<a href="#l22.81"></a><span id="l22.81" class="difflineminus">-  return true;</span>
<a href="#l22.82"></a><span id="l22.82" class="difflineminus">-}</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineminus">-</span>
<a href="#l22.84"></a><span id="l22.84" class="difflineminus">-</span>
<a href="#l22.85"></a><span id="l22.85" class="difflineminus">-// Workaround for bug 196057 (double onload event): accept only the first onload event</span>
<a href="#l22.86"></a><span id="l22.86" class="difflineminus">-// ( This workaround will fix bug 147068 (duplicate search results).</span>
<a href="#l22.87"></a><span id="l22.87" class="difflineminus">-//   Without this fix, xpfe\components\search\src\nsInternetSearchService.cpp will</span>
<a href="#l22.88"></a><span id="l22.88" class="difflineminus">-//   crash when removing the same tree node twice. )</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineminus">-// If bug 196057 should be fixed eventually, this workaround does no harm -</span>
<a href="#l22.90"></a><span id="l22.90" class="difflineminus">-// nevertheless it should be removed then</span>
<a href="#l22.91"></a><span id="l22.91" class="difflineminus">-var gbProcessOnloadEvent = true;</span>
<a href="#l22.92"></a><span id="l22.92" class="difflineminus">-</span>
<a href="#l22.93"></a><span id="l22.93" class="difflineminus">-function onLoadInternetResults()</span>
<a href="#l22.94"></a><span id="l22.94" class="difflineminus">-{</span>
<a href="#l22.95"></a><span id="l22.95" class="difflineminus">-  if (gbProcessOnloadEvent)</span>
<a href="#l22.96"></a><span id="l22.96" class="difflineminus">-  { // forbid other onload events</span>
<a href="#l22.97"></a><span id="l22.97" class="difflineminus">-    gbProcessOnloadEvent = false;</span>
<a href="#l22.98"></a><span id="l22.98" class="difflineminus">-</span>
<a href="#l22.99"></a><span id="l22.99" class="difflineminus">-    // clear any previous results on load</span>
<a href="#l22.100"></a><span id="l22.100" class="difflineminus">-    var iSearch = Components.classes[&quot;@mozilla.org/rdf/datasource;1?name=internetsearch&quot;]</span>
<a href="#l22.101"></a><span id="l22.101" class="difflineminus">-                            .getService(Components.interfaces.nsIInternetSearchService);</span>
<a href="#l22.102"></a><span id="l22.102" class="difflineminus">-    iSearch.ClearResultSearchSites();</span>
<a href="#l22.103"></a><span id="l22.103" class="difflineminus">-</span>
<a href="#l22.104"></a><span id="l22.104" class="difflineminus">-    // the search URI is passed in as a parameter, so get it and then root the results list</span>
<a href="#l22.105"></a><span id="l22.105" class="difflineminus">-    var searchURI = top.content.location.href;</span>
<a href="#l22.106"></a><span id="l22.106" class="difflineminus">-    if (searchURI) {</span>
<a href="#l22.107"></a><span id="l22.107" class="difflineminus">-      const lastSearchURIPref = &quot;browser.search.lastMultipleSearchURI&quot;;</span>
<a href="#l22.108"></a><span id="l22.108" class="difflineminus">-      var offset = searchURI.indexOf(&quot;?&quot;);</span>
<a href="#l22.109"></a><span id="l22.109" class="difflineminus">-      if (offset &gt; 0) {</span>
<a href="#l22.110"></a><span id="l22.110" class="difflineminus">-        nsPreferences.setUnicharPref(lastSearchURIPref, searchURI); // evil</span>
<a href="#l22.111"></a><span id="l22.111" class="difflineminus">-        searchURI = searchURI.substr(offset+1);</span>
<a href="#l22.112"></a><span id="l22.112" class="difflineminus">-        loadResultsList(searchURI);</span>
<a href="#l22.113"></a><span id="l22.113" class="difflineminus">-      }</span>
<a href="#l22.114"></a><span id="l22.114" class="difflineminus">-      else {</span>
<a href="#l22.115"></a><span id="l22.115" class="difflineminus">-        searchURI = nsPreferences.copyUnicharPref(lastSearchURIPref, &quot;&quot;);</span>
<a href="#l22.116"></a><span id="l22.116" class="difflineminus">-        offset = searchURI.indexOf(&quot;?&quot;);</span>
<a href="#l22.117"></a><span id="l22.117" class="difflineminus">-        if (offset &gt; 0) {</span>
<a href="#l22.118"></a><span id="l22.118" class="difflineminus">-          nsPreferences.setUnicharPref(lastSearchURIPref, searchURI); // evil</span>
<a href="#l22.119"></a><span id="l22.119" class="difflineminus">-          searchURI = searchURI.substr(offset+1);</span>
<a href="#l22.120"></a><span id="l22.120" class="difflineminus">-          loadResultsList(searchURI);</span>
<a href="#l22.121"></a><span id="l22.121" class="difflineminus">-        }</span>
<a href="#l22.122"></a><span id="l22.122" class="difflineminus">-      }</span>
<a href="#l22.123"></a><span id="l22.123" class="difflineminus">-    }</span>
<a href="#l22.124"></a><span id="l22.124" class="difflineminus">-  }</span>
<a href="#l22.125"></a><span id="l22.125" class="difflineminus">-  return true;</span>
<a href="#l22.126"></a><span id="l22.126" class="difflineminus">-}</span>
<a href="#l22.127"></a><span id="l22.127" class="difflineminus">-</span>
<a href="#l22.128"></a><span id="l22.128" class="difflineminus">-function loadResultsList( aSearchURL )</span>
<a href="#l22.129"></a><span id="l22.129" class="difflineminus">-{</span>
<a href="#l22.130"></a><span id="l22.130" class="difflineminus">-  var resultsTree = document.getElementById( &quot;resultsList&quot; );</span>
<a href="#l22.131"></a><span id="l22.131" class="difflineminus">-  if (!resultsTree) return false;</span>
<a href="#l22.132"></a><span id="l22.132" class="difflineminus">-  resultsTree.setAttribute(&quot;ref&quot;, decodeURI(aSearchURL));</span>
<a href="#l22.133"></a><span id="l22.133" class="difflineminus">-  return true;</span>
<a href="#l22.134"></a><span id="l22.134" class="difflineminus">-}</span>
<a href="#l22.135"></a><span id="l22.135" class="difflineminus">-</span>
<a href="#l22.136"></a><span id="l22.136" class="difflineminus">-</span>
<a href="#l22.137"></a><span id="l22.137" class="difflineminus">-</span>
<a href="#l22.138"></a><span id="l22.138" class="difflineminus">-function doEngineClick( event, aNode )</span>
<a href="#l22.139"></a><span id="l22.139" class="difflineminus">-{</span>
<a href="#l22.140"></a><span id="l22.140" class="difflineminus">-  event.target.checked = true;</span>
<a href="#l22.141"></a><span id="l22.141" class="difflineminus">-</span>
<a href="#l22.142"></a><span id="l22.142" class="difflineminus">-  var html = null;</span>
<a href="#l22.143"></a><span id="l22.143" class="difflineminus">-</span>
<a href="#l22.144"></a><span id="l22.144" class="difflineminus">-  var resultsTree = document.getElementById(&quot;resultsList&quot;);</span>
<a href="#l22.145"></a><span id="l22.145" class="difflineminus">-  var contentArea = document.getElementById(&quot;resultsContent&quot;);</span>
<a href="#l22.146"></a><span id="l22.146" class="difflineminus">-  var splitter = document.getElementById(&quot;results-splitter&quot;);</span>
<a href="#l22.147"></a><span id="l22.147" class="difflineminus">-  var engineURI = aNode.id;</span>
<a href="#l22.148"></a><span id="l22.148" class="difflineminus">-  if (engineURI == &quot;allEngines&quot;) {</span>
<a href="#l22.149"></a><span id="l22.149" class="difflineminus">-    resultsTree.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l22.150"></a><span id="l22.150" class="difflineminus">-    splitter.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l22.151"></a><span id="l22.151" class="difflineminus">-  }</span>
<a href="#l22.152"></a><span id="l22.152" class="difflineminus">-  else</span>
<a href="#l22.153"></a><span id="l22.153" class="difflineminus">-  {</span>
<a href="#l22.154"></a><span id="l22.154" class="difflineminus">-    resultsTree.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l22.155"></a><span id="l22.155" class="difflineminus">-    splitter.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l22.156"></a><span id="l22.156" class="difflineminus">-    try</span>
<a href="#l22.157"></a><span id="l22.157" class="difflineminus">-    {</span>
<a href="#l22.158"></a><span id="l22.158" class="difflineminus">-      var rdf = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;].getService();</span>
<a href="#l22.159"></a><span id="l22.159" class="difflineminus">-      if (rdf)   rdf = rdf.QueryInterface(Components.interfaces.nsIRDFService);</span>
<a href="#l22.160"></a><span id="l22.160" class="difflineminus">-      if (rdf)</span>
<a href="#l22.161"></a><span id="l22.161" class="difflineminus">-      {</span>
<a href="#l22.162"></a><span id="l22.162" class="difflineminus">-        var internetSearchStore = rdf.GetDataSource(&quot;rdf:internetsearch&quot;);</span>
<a href="#l22.163"></a><span id="l22.163" class="difflineminus">-        if (internetSearchStore)</span>
<a href="#l22.164"></a><span id="l22.164" class="difflineminus">-        {</span>
<a href="#l22.165"></a><span id="l22.165" class="difflineminus">-          var src = rdf.GetResource(engineURI, true);</span>
<a href="#l22.166"></a><span id="l22.166" class="difflineminus">-          var htmlProperty = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#HTML&quot;, true);</span>
<a href="#l22.167"></a><span id="l22.167" class="difflineminus">-          html = internetSearchStore.GetTarget(src, htmlProperty, true);</span>
<a href="#l22.168"></a><span id="l22.168" class="difflineminus">-          if ( html ) html = html.QueryInterface(Components.interfaces.nsIRDFLiteral);</span>
<a href="#l22.169"></a><span id="l22.169" class="difflineminus">-          if ( html ) html = html.Value;</span>
<a href="#l22.170"></a><span id="l22.170" class="difflineminus">-        }</span>
<a href="#l22.171"></a><span id="l22.171" class="difflineminus">-      }</span>
<a href="#l22.172"></a><span id="l22.172" class="difflineminus">-    }</span>
<a href="#l22.173"></a><span id="l22.173" class="difflineminus">-    catch(ex)</span>
<a href="#l22.174"></a><span id="l22.174" class="difflineminus">-    {</span>
<a href="#l22.175"></a><span id="l22.175" class="difflineminus">-    }</span>
<a href="#l22.176"></a><span id="l22.176" class="difflineminus">-  }</span>
<a href="#l22.177"></a><span id="l22.177" class="difflineminus">-</span>
<a href="#l22.178"></a><span id="l22.178" class="difflineminus">-  if ( html )</span>
<a href="#l22.179"></a><span id="l22.179" class="difflineminus">-  {</span>
<a href="#l22.180"></a><span id="l22.180" class="difflineminus">-    var doc = frames[0].document;</span>
<a href="#l22.181"></a><span id="l22.181" class="difflineminus">-    if (doc)</span>
<a href="#l22.182"></a><span id="l22.182" class="difflineminus">-    {</span>
<a href="#l22.183"></a><span id="l22.183" class="difflineminus">-        doc.open(&quot;text/html&quot;, &quot;replace&quot;);</span>
<a href="#l22.184"></a><span id="l22.184" class="difflineminus">-        doc.writeln( html );</span>
<a href="#l22.185"></a><span id="l22.185" class="difflineminus">-        doc.close();</span>
<a href="#l22.186"></a><span id="l22.186" class="difflineminus">-    }</span>
<a href="#l22.187"></a><span id="l22.187" class="difflineminus">-  }</span>
<a href="#l22.188"></a><span id="l22.188" class="difflineminus">-  else</span>
<a href="#l22.189"></a><span id="l22.189" class="difflineminus">-    frames[0].document.location.href = </span>
<a href="#l22.190"></a><span id="l22.190" class="difflineminus">-      &quot;chrome://communicator/locale/search/default.htm&quot;;</span>
<a href="#l22.191"></a><span id="l22.191" class="difflineminus">-}</span>
<a href="#l22.192"></a><span id="l22.192" class="difflineminus">-</span>
<a href="#l22.193"></a><span id="l22.193" class="difflineminus">-</span>
<a href="#l22.194"></a><span id="l22.194" class="difflineminus">-</span>
<a href="#l22.195"></a><span id="l22.195" class="difflineminus">-function doResultClick(node)</span>
<a href="#l22.196"></a><span id="l22.196" class="difflineminus">-{</span>
<a href="#l22.197"></a><span id="l22.197" class="difflineminus">-  var theID = node.id;</span>
<a href="#l22.198"></a><span id="l22.198" class="difflineminus">-  if (!theID) return(false);</span>
<a href="#l22.199"></a><span id="l22.199" class="difflineminus">-</span>
<a href="#l22.200"></a><span id="l22.200" class="difflineminus">-  try</span>
<a href="#l22.201"></a><span id="l22.201" class="difflineminus">-  {</span>
<a href="#l22.202"></a><span id="l22.202" class="difflineminus">-    var rdf = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;].getService();</span>
<a href="#l22.203"></a><span id="l22.203" class="difflineminus">-    if (rdf)   rdf = rdf.QueryInterface(Components.interfaces.nsIRDFService);</span>
<a href="#l22.204"></a><span id="l22.204" class="difflineminus">-    if (rdf)</span>
<a href="#l22.205"></a><span id="l22.205" class="difflineminus">-    {</span>
<a href="#l22.206"></a><span id="l22.206" class="difflineminus">-      var internetSearchStore = rdf.GetDataSource(&quot;rdf:internetsearch&quot;);</span>
<a href="#l22.207"></a><span id="l22.207" class="difflineminus">-      if (internetSearchStore)</span>
<a href="#l22.208"></a><span id="l22.208" class="difflineminus">-      {</span>
<a href="#l22.209"></a><span id="l22.209" class="difflineminus">-        var src = rdf.GetResource(theID, true);</span>
<a href="#l22.210"></a><span id="l22.210" class="difflineminus">-        var urlProperty = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#URL&quot;, true);</span>
<a href="#l22.211"></a><span id="l22.211" class="difflineminus">-        var bannerProperty = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#Banner&quot;, true);</span>
<a href="#l22.212"></a><span id="l22.212" class="difflineminus">-        var htmlProperty = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#HTML&quot;, true);</span>
<a href="#l22.213"></a><span id="l22.213" class="difflineminus">-</span>
<a href="#l22.214"></a><span id="l22.214" class="difflineminus">-        var url = internetSearchStore.GetTarget(src, urlProperty, true);</span>
<a href="#l22.215"></a><span id="l22.215" class="difflineminus">-        if (url)  url = url.QueryInterface(Components.interfaces.nsIRDFLiteral);</span>
<a href="#l22.216"></a><span id="l22.216" class="difflineminus">-        if (url)  url = url.Value;</span>
<a href="#l22.217"></a><span id="l22.217" class="difflineminus">-        if (url)</span>
<a href="#l22.218"></a><span id="l22.218" class="difflineminus">-        {</span>
<a href="#l22.219"></a><span id="l22.219" class="difflineminus">-          var statusNode = document.getElementById(&quot;status-button&quot;);</span>
<a href="#l22.220"></a><span id="l22.220" class="difflineminus">-          if (statusNode)</span>
<a href="#l22.221"></a><span id="l22.221" class="difflineminus">-          {</span>
<a href="#l22.222"></a><span id="l22.222" class="difflineminus">-            statusNode.label = url;</span>
<a href="#l22.223"></a><span id="l22.223" class="difflineminus">-          }</span>
<a href="#l22.224"></a><span id="l22.224" class="difflineminus">-        }</span>
<a href="#l22.225"></a><span id="l22.225" class="difflineminus">-</span>
<a href="#l22.226"></a><span id="l22.226" class="difflineminus">-        var banner = internetSearchStore.GetTarget(src, bannerProperty, true);</span>
<a href="#l22.227"></a><span id="l22.227" class="difflineminus">-        if (banner) banner = banner.QueryInterface(Components.interfaces.nsIRDFLiteral);</span>
<a href="#l22.228"></a><span id="l22.228" class="difflineminus">-        if (banner) banner = banner.Value;</span>
<a href="#l22.229"></a><span id="l22.229" class="difflineminus">-</span>
<a href="#l22.230"></a><span id="l22.230" class="difflineminus">-        var target = internetSearchStore.GetTarget(src, htmlProperty, true);</span>
<a href="#l22.231"></a><span id="l22.231" class="difflineminus">-        if (target) target = target.QueryInterface(Components.interfaces.nsIRDFLiteral);</span>
<a href="#l22.232"></a><span id="l22.232" class="difflineminus">-        if (target) target = target.Value;</span>
<a href="#l22.233"></a><span id="l22.233" class="difflineminus">-        if (target)</span>
<a href="#l22.234"></a><span id="l22.234" class="difflineminus">-        {</span>
<a href="#l22.235"></a><span id="l22.235" class="difflineminus">-          var text = &quot;&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Search&lt;/TITLE&gt;&lt;BASE TARGET='_top'&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;FONT POINT-SIZE='9'&gt;&quot;;</span>
<a href="#l22.236"></a><span id="l22.236" class="difflineminus">-</span>
<a href="#l22.237"></a><span id="l22.237" class="difflineminus">-          if (banner)</span>
<a href="#l22.238"></a><span id="l22.238" class="difflineminus">-            text += banner + &quot;&lt;/A&gt;&lt;BR&gt;&quot;; // add a &lt;/A&gt; and a &lt;BR&gt; just in case</span>
<a href="#l22.239"></a><span id="l22.239" class="difflineminus">-          text += target;</span>
<a href="#l22.240"></a><span id="l22.240" class="difflineminus">-          text += &quot;&lt;/FONT&gt;&lt;/BODY&gt;&lt;/HTML&gt;&quot;</span>
<a href="#l22.241"></a><span id="l22.241" class="difflineminus">-</span>
<a href="#l22.242"></a><span id="l22.242" class="difflineminus">-          var doc = frames[0].document;</span>
<a href="#l22.243"></a><span id="l22.243" class="difflineminus">-          doc.open(&quot;text/html&quot;, &quot;replace&quot;);</span>
<a href="#l22.244"></a><span id="l22.244" class="difflineminus">-          doc.writeln(text);</span>
<a href="#l22.245"></a><span id="l22.245" class="difflineminus">-          doc.close();</span>
<a href="#l22.246"></a><span id="l22.246" class="difflineminus">-        }</span>
<a href="#l22.247"></a><span id="l22.247" class="difflineminus">-      }</span>
<a href="#l22.248"></a><span id="l22.248" class="difflineminus">-    }</span>
<a href="#l22.249"></a><span id="l22.249" class="difflineminus">-  }</span>
<a href="#l22.250"></a><span id="l22.250" class="difflineminus">-  catch(ex)</span>
<a href="#l22.251"></a><span id="l22.251" class="difflineminus">-  {</span>
<a href="#l22.252"></a><span id="l22.252" class="difflineminus">-  }</span>
<a href="#l22.253"></a><span id="l22.253" class="difflineminus">-  return(true);</span>
<a href="#l22.254"></a><span id="l22.254" class="difflineminus">-}</span>
<a href="#l22.255"></a><span id="l22.255" class="difflineminus">-</span>
<a href="#l22.256"></a><span id="l22.256" class="difflineminus">-function listSelect(event)</span>
<a href="#l22.257"></a><span id="l22.257" class="difflineminus">-{</span>
<a href="#l22.258"></a><span id="l22.258" class="difflineminus">-  var tree = document.getElementById(&quot;resultsList&quot;);</span>
<a href="#l22.259"></a><span id="l22.259" class="difflineminus">-  if (tree.view.selection.count != 1)</span>
<a href="#l22.260"></a><span id="l22.260" class="difflineminus">-    return false;</span>
<a href="#l22.261"></a><span id="l22.261" class="difflineminus">-  var selection = tree.contentView.getItemAtIndex(tree.currentIndex);</span>
<a href="#l22.262"></a><span id="l22.262" class="difflineminus">-  return doResultClick(selection);</span>
<a href="#l22.263"></a><span id="l22.263" class="difflineminus">-}</span>
<a href="#l22.264"></a><span id="l22.264" class="difflineminus">-</span>
<a href="#l22.265"></a><span id="l22.265" class="difflineminus">-function listClick(event)</span>
<a href="#l22.266"></a><span id="l22.266" class="difflineminus">-{ // left double click opens URL</span>
<a href="#l22.267"></a><span id="l22.267" class="difflineminus">-  if (event.detail == 2 &amp;&amp; event.button == 0)</span>
<a href="#l22.268"></a><span id="l22.268" class="difflineminus">-    searchResultsOpenURL(event);</span>
<a href="#l22.269"></a><span id="l22.269" class="difflineminus">-  return true; // always allow further click processing</span>
<a href="#l22.270"></a><span id="l22.270" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">deleted file mode 100644</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineminus">--- a/suite/common/search/internetresults.xul</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineplus">+++ /dev/null</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineat">@@ -1,124 +0,0 @@</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l23.6"></a><span id="l23.6" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/search/search.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l23.8"></a><span id="l23.8" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/search/internetresults.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l23.9"></a><span id="l23.9" class="difflineminus">-</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineminus">-&lt;!DOCTYPE page SYSTEM &quot;chrome://communicator/locale/search/internetresults.dtd&quot;&gt;</span>
<a href="#l23.11"></a><span id="l23.11" class="difflineminus">-</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-&lt;page onload=&quot;onLoadInternetResults();&quot;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-      xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-      xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-      title=&quot;&amp;internetresults.title;&quot;</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineminus">-      context=&quot;disallowcontext&quot;&gt;</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineminus">-</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineminus">-  &lt;popupset&gt;</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineminus">-    &lt;menupopup id=&quot;disallowcontext&quot; onpopupshowing=&quot;return false;&quot;/&gt;</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineminus">-  &lt;/popupset&gt;</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineminus">-</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/nsUserSettings.js&quot;/&gt;</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/search/internetresults.js&quot;/&gt;</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/search/shared.js&quot;/&gt;</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineminus">-</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineminus">-  &lt;hbox id=&quot;multi-results-header&quot;&gt; </span>
<a href="#l23.27"></a><span id="l23.27" class="difflineminus">-    &lt;label value=&quot;&amp;results.header.label;&quot;/&gt;</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineminus">-  &lt;/hbox&gt;</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineminus">-</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineminus">-  &lt;hbox align=&quot;center&quot; style=&quot;min-width: 1px;&quot;&gt;</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-    &lt;label value=&quot;&amp;viewbyprovider.label;&quot;/&gt;</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineminus">-    &lt;menulist id=&quot;engineTabs&quot; ref=&quot;NC:SearchResultsSitesRoot&quot;</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineminus">-              datasources=&quot;rdf:internetsearch&quot; oncommand=&quot;switchTab(1);&quot;&gt;</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineminus">-      &lt;template&gt;</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineminus">-        &lt;menupopup&gt;</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineminus">-          &lt;menuitem id=&quot;chooseCat&quot; uri=&quot;...&quot; oncommand=&quot;doEngineClick(event, this);&quot;</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineminus">-                    src=&quot;rdf:http://home.netscape.com/NC-rdf#Icon&quot;</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineminus">-                    value=&quot;rdf:http://home.netscape.com/NC-rdf#category&quot;</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineminus">-                    label=&quot;rdf:http://home.netscape.com/NC-rdf#Name&quot;/&gt;</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineminus">-        &lt;/menupopup&gt;</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineminus">-      &lt;/template&gt;</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineminus">-      &lt;menupopup id=&quot;categoryPopup&quot;&gt;</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineminus">-        &lt;menuitem id=&quot;allEngines&quot; value=&quot;NC:SearchEngineRoot&quot; label=&quot;&amp;allresults.title.label;&quot;</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineminus">-                  oncommand=&quot;doEngineClick(event, this);&quot;/&gt;</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineminus">-        &lt;menuseparator/&gt;</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineminus">-      &lt;/menupopup&gt;</span>
<a href="#l23.47"></a><span id="l23.47" class="difflineminus">-    &lt;/menulist&gt;</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineminus">-  &lt;/hbox&gt;</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineminus">-</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineminus">-  &lt;menupopup id=&quot;contextual&quot; onpopupshowing=&quot;return fillContextMenu('contextual', 'resultsList');&quot;/&gt;</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineminus">-  </span>
<a href="#l23.52"></a><span id="l23.52" class="difflineminus">-  &lt;tree id=&quot;resultsList&quot; flex=&quot;1&quot; class=&quot;plain&quot;</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineminus">-           datasources=&quot;rdf:internetsearch&quot; context=&quot;contextual&quot;</span>
<a href="#l23.54"></a><span id="l23.54" class="difflineminus">-           onselect=&quot;return listSelect(event);&quot;</span>
<a href="#l23.55"></a><span id="l23.55" class="difflineminus">-           onclick =&quot;return listClick (event);&quot;&gt;</span>
<a href="#l23.56"></a><span id="l23.56" class="difflineminus">-</span>
<a href="#l23.57"></a><span id="l23.57" class="difflineminus">-    &lt;treecols onclick=&quot;doSort(event.target.id, 'http://home.netscape.com/NC-rdf#PageRank');&quot;&gt;</span>
<a href="#l23.58"></a><span id="l23.58" class="difflineminus">-      &lt;treecol id=&quot;NameColumn&quot; primary=&quot;true&quot; label=&quot;&amp;name.column.label;&quot;</span>
<a href="#l23.59"></a><span id="l23.59" class="difflineminus">-               resource=&quot;http://home.netscape.com/NC-rdf#Name&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l23.60"></a><span id="l23.60" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l23.61"></a><span id="l23.61" class="difflineminus">-      &lt;treecol id=&quot;PageRankColumn&quot; label=&quot;&amp;pagerank.column.label;&quot;</span>
<a href="#l23.62"></a><span id="l23.62" class="difflineminus">-               resource=&quot;http://home.netscape.com/NC-rdf#PageRank&quot;</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineminus">-               resource2=&quot;http://home.netscape.com/NC-rdf#Name&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l23.65"></a><span id="l23.65" class="difflineminus">-      &lt;treecol id=&quot;RelevanceColumn&quot; label=&quot;&amp;relevance.column.label;&quot;</span>
<a href="#l23.66"></a><span id="l23.66" class="difflineminus">-               resource=&quot;http://home.netscape.com/NC-rdf#Relevance&quot;</span>
<a href="#l23.67"></a><span id="l23.67" class="difflineminus">-               resource2=&quot;http://home.netscape.com/NC-rdf#Name&quot;</span>
<a href="#l23.68"></a><span id="l23.68" class="difflineminus">-               hidden=&quot;true&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l23.69"></a><span id="l23.69" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l23.70"></a><span id="l23.70" class="difflineminus">-      &lt;treecol id=&quot;PriceColumn&quot; label=&quot;&amp;price.column.label;&quot;</span>
<a href="#l23.71"></a><span id="l23.71" class="difflineminus">-               resource=&quot;http://home.netscape.com/NC-rdf#Price&quot;</span>
<a href="#l23.72"></a><span id="l23.72" class="difflineminus">-               resource2=&quot;http://home.netscape.com/NC-rdf#Availability&quot;</span>
<a href="#l23.73"></a><span id="l23.73" class="difflineminus">-               hidden=&quot;true&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l23.75"></a><span id="l23.75" class="difflineminus">-      &lt;treecol id=&quot;AvailabilityColumn&quot; label=&quot;&amp;availability.column.label;&quot;</span>
<a href="#l23.76"></a><span id="l23.76" class="difflineminus">-               resource=&quot;http://home.netscape.com/NC-rdf#Availability&quot;</span>
<a href="#l23.77"></a><span id="l23.77" class="difflineminus">-               resource2=&quot;http://home.netscape.com/NC-rdf#Price&quot;</span>
<a href="#l23.78"></a><span id="l23.78" class="difflineminus">-               hidden=&quot;true&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l23.79"></a><span id="l23.79" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l23.80"></a><span id="l23.80" class="difflineminus">-      &lt;treecol id=&quot;DateColumn&quot; label=&quot;&amp;date.column.label;&quot;</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineminus">-               resource=&quot;http://home.netscape.com/NC-rdf#Date&quot;</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineminus">-               resource2=&quot;http://home.netscape.com/NC-rdf#Name&quot;</span>
<a href="#l23.83"></a><span id="l23.83" class="difflineminus">-               hidden=&quot;true&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l23.84"></a><span id="l23.84" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l23.85"></a><span id="l23.85" class="difflineminus">-      &lt;treecol id=&quot;SiteColumn&quot; label=&quot;&amp;site.column.label;&quot;</span>
<a href="#l23.86"></a><span id="l23.86" class="difflineminus">-               resource=&quot;http://home.netscape.com/NC-rdf#Site&quot;</span>
<a href="#l23.87"></a><span id="l23.87" class="difflineminus">-               resource2=&quot;http://home.netscape.com/NC-rdf#Name&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l23.88"></a><span id="l23.88" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l23.89"></a><span id="l23.89" class="difflineminus">-      &lt;treecol id=&quot;EngineColumn&quot; label=&quot;&amp;engine.column.label;&quot;</span>
<a href="#l23.90"></a><span id="l23.90" class="difflineminus">-               resource=&quot;http://home.netscape.com/NC-rdf#Engine&quot;</span>
<a href="#l23.91"></a><span id="l23.91" class="difflineminus">-               resource2=&quot;http://home.netscape.com/NC-rdf#Name&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineminus">-    &lt;/treecols&gt;</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineminus">-</span>
<a href="#l23.94"></a><span id="l23.94" class="difflineminus">-    &lt;template&gt;</span>
<a href="#l23.95"></a><span id="l23.95" class="difflineminus">-      &lt;rule rdf:type=&quot;http://home.netscape.com/NC-rdf#BookmarkSeparator&quot;&gt;</span>
<a href="#l23.96"></a><span id="l23.96" class="difflineminus">-        &lt;treeseparator uri=&quot;...&quot;/&gt;</span>
<a href="#l23.97"></a><span id="l23.97" class="difflineminus">-      &lt;/rule&gt;</span>
<a href="#l23.98"></a><span id="l23.98" class="difflineminus">-      </span>
<a href="#l23.99"></a><span id="l23.99" class="difflineminus">-      &lt;rule&gt;</span>
<a href="#l23.100"></a><span id="l23.100" class="difflineminus">-        &lt;treechildren&gt;</span>
<a href="#l23.101"></a><span id="l23.101" class="difflineminus">-          &lt;treeitem uri=&quot;...&quot;&gt;</span>
<a href="#l23.102"></a><span id="l23.102" class="difflineminus">-            &lt;treerow&gt;</span>
<a href="#l23.103"></a><span id="l23.103" class="difflineminus">-              &lt;treecell src=&quot;rdf:http://home.netscape.com/NC-rdf#Icon&quot; </span>
<a href="#l23.104"></a><span id="l23.104" class="difflineminus">-                        label=&quot;rdf:http://home.netscape.com/NC-rdf#Name&quot; /&gt;</span>
<a href="#l23.105"></a><span id="l23.105" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#PageRank&quot;/&gt;</span>
<a href="#l23.106"></a><span id="l23.106" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#Relevance&quot;/&gt;</span>
<a href="#l23.107"></a><span id="l23.107" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#Price&quot;/&gt;</span>
<a href="#l23.108"></a><span id="l23.108" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#Availability&quot;/&gt;</span>
<a href="#l23.109"></a><span id="l23.109" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#Date&quot;/&gt;</span>
<a href="#l23.110"></a><span id="l23.110" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#Site&quot;/&gt;</span>
<a href="#l23.111"></a><span id="l23.111" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#Engine&quot;/&gt;</span>
<a href="#l23.112"></a><span id="l23.112" class="difflineminus">-            &lt;/treerow&gt;</span>
<a href="#l23.113"></a><span id="l23.113" class="difflineminus">-          &lt;/treeitem&gt;</span>
<a href="#l23.114"></a><span id="l23.114" class="difflineminus">-        &lt;/treechildren&gt;</span>
<a href="#l23.115"></a><span id="l23.115" class="difflineminus">-      &lt;/rule&gt;</span>
<a href="#l23.116"></a><span id="l23.116" class="difflineminus">-    &lt;/template&gt;</span>
<a href="#l23.117"></a><span id="l23.117" class="difflineminus">-</span>
<a href="#l23.118"></a><span id="l23.118" class="difflineminus">-  &lt;/tree&gt;</span>
<a href="#l23.119"></a><span id="l23.119" class="difflineminus">-</span>
<a href="#l23.120"></a><span id="l23.120" class="difflineminus">-  &lt;splitter id=&quot;results-splitter&quot; persist=&quot;state&quot; collapse=&quot;after&quot;&gt;</span>
<a href="#l23.121"></a><span id="l23.121" class="difflineminus">-    &lt;grippy/&gt;</span>
<a href="#l23.122"></a><span id="l23.122" class="difflineminus">-  &lt;/splitter&gt;</span>
<a href="#l23.123"></a><span id="l23.123" class="difflineminus">-  </span>
<a href="#l23.124"></a><span id="l23.124" class="difflineminus">-  &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l23.125"></a><span id="l23.125" class="difflineminus">-    &lt;iframe id=&quot;resultsContent&quot; flex=&quot;1&quot; src=&quot;chrome://communicator/locale/search/default.htm&quot;/&gt;</span>
<a href="#l23.126"></a><span id="l23.126" class="difflineminus">-  &lt;/hbox&gt;</span>
<a href="#l23.127"></a><span id="l23.127" class="difflineminus">-  </span>
<a href="#l23.128"></a><span id="l23.128" class="difflineminus">-&lt;/page&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">deleted file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- a/suite/common/search/search-editor.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ /dev/null</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -1,634 +0,0 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineminus">-/* -*- Mode: Java; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineminus">- *</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">- *</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">- * License.</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">- *</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineminus">- *</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineminus">- *</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">- *   Robert John Churchill    &lt;rjc@netscape.com&gt;</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">- *   Blake Ross &lt;BlakeR1234@aol.com&gt;</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">- *</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">- *</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineminus">-</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineminus">-</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineminus">-// global(s)</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineminus">-var gSearchBundle;</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineminus">-var promptService;</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineminus">-var pref = null;</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-var RDF = null;</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineminus">-var RDFC = null;</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineminus">-var RDFCUtils = null;</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-var catDS = null;</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineminus">-var internetSearchDS = null;</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineminus">-</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineminus">-try</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineminus">-{</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineminus">-  pref = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineminus">-                   .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineminus">-</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineminus">-  RDF = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;].getService(Components.interfaces.nsIRDFService);</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineminus">-</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineminus">-  RDFC = Components.classes[&quot;@mozilla.org/rdf/container;1&quot;].createInstance(Components.interfaces.nsIRDFContainer);</span>
<a href="#l24.64"></a><span id="l24.64" class="difflineminus">-</span>
<a href="#l24.65"></a><span id="l24.65" class="difflineminus">-  RDFCUtils = Components.classes[&quot;@mozilla.org/rdf/container-utils;1&quot;].getService(Components.interfaces.nsIRDFContainerUtils);</span>
<a href="#l24.66"></a><span id="l24.66" class="difflineminus">-}</span>
<a href="#l24.67"></a><span id="l24.67" class="difflineminus">-catch(e)</span>
<a href="#l24.68"></a><span id="l24.68" class="difflineminus">-{</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineminus">-  pref = null;</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineminus">-  RDF = null;</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineminus">-  RDFC = null;</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineminus">-  RDFCUtils = null;</span>
<a href="#l24.73"></a><span id="l24.73" class="difflineminus">-}</span>
<a href="#l24.74"></a><span id="l24.74" class="difflineminus">-</span>
<a href="#l24.75"></a><span id="l24.75" class="difflineminus">-</span>
<a href="#l24.76"></a><span id="l24.76" class="difflineminus">-</span>
<a href="#l24.77"></a><span id="l24.77" class="difflineminus">-function debug(msg)</span>
<a href="#l24.78"></a><span id="l24.78" class="difflineminus">-{</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineminus">-  // uncomment for noise</span>
<a href="#l24.80"></a><span id="l24.80" class="difflineminus">-  // dump(msg+&quot;\n&quot;);</span>
<a href="#l24.81"></a><span id="l24.81" class="difflineminus">-}</span>
<a href="#l24.82"></a><span id="l24.82" class="difflineminus">-</span>
<a href="#l24.83"></a><span id="l24.83" class="difflineminus">-</span>
<a href="#l24.84"></a><span id="l24.84" class="difflineminus">-</span>
<a href="#l24.85"></a><span id="l24.85" class="difflineminus">-function doLoad()</span>
<a href="#l24.86"></a><span id="l24.86" class="difflineminus">-{</span>
<a href="#l24.87"></a><span id="l24.87" class="difflineminus">-  gSearchBundle = document.getElementById(&quot;searchBundle&quot;);</span>
<a href="#l24.88"></a><span id="l24.88" class="difflineminus">-  promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l24.89"></a><span id="l24.89" class="difflineminus">-                            .getService(Components.interfaces.nsIPromptService);</span>
<a href="#l24.90"></a><span id="l24.90" class="difflineminus">-</span>
<a href="#l24.91"></a><span id="l24.91" class="difflineminus">-  var categoryList = document.getElementById(&quot;categoryList&quot;);</span>
<a href="#l24.92"></a><span id="l24.92" class="difflineminus">-  // adjust category popup</span>
<a href="#l24.93"></a><span id="l24.93" class="difflineminus">-  var internetSearch = Components.classes[&quot;@mozilla.org/rdf/datasource;1?name=internetsearch&quot;].getService();</span>
<a href="#l24.94"></a><span id="l24.94" class="difflineminus">-  if (internetSearch) internetSearch = internetSearch.QueryInterface(Components.interfaces.nsIInternetSearchService);</span>
<a href="#l24.95"></a><span id="l24.95" class="difflineminus">-  if (internetSearch)</span>
<a href="#l24.96"></a><span id="l24.96" class="difflineminus">-  {</span>
<a href="#l24.97"></a><span id="l24.97" class="difflineminus">-    internetSearchDS = internetSearch.QueryInterface(Components.interfaces.nsIRDFDataSource);</span>
<a href="#l24.98"></a><span id="l24.98" class="difflineminus">-</span>
<a href="#l24.99"></a><span id="l24.99" class="difflineminus">-    catDS = internetSearch.GetCategoryDataSource();</span>
<a href="#l24.100"></a><span id="l24.100" class="difflineminus">-    if (catDS)  catDS = catDS.QueryInterface(Components.interfaces.nsIRDFDataSource);</span>
<a href="#l24.101"></a><span id="l24.101" class="difflineminus">-    if (catDS)</span>
<a href="#l24.102"></a><span id="l24.102" class="difflineminus">-    {</span>
<a href="#l24.103"></a><span id="l24.103" class="difflineminus">-      if (categoryList)</span>
<a href="#l24.104"></a><span id="l24.104" class="difflineminus">-      {</span>
<a href="#l24.105"></a><span id="l24.105" class="difflineminus">-        categoryList.database.AddDataSource(catDS);</span>
<a href="#l24.106"></a><span id="l24.106" class="difflineminus">-        categoryList.builder.rebuild();</span>
<a href="#l24.107"></a><span id="l24.107" class="difflineminus">-      }</span>
<a href="#l24.108"></a><span id="l24.108" class="difflineminus">-      var engineList = document.getElementById(&quot;engineList&quot;);</span>
<a href="#l24.109"></a><span id="l24.109" class="difflineminus">-      if (engineList)</span>
<a href="#l24.110"></a><span id="l24.110" class="difflineminus">-      {</span>
<a href="#l24.111"></a><span id="l24.111" class="difflineminus">-        engineList.database.AddDataSource(catDS);</span>
<a href="#l24.112"></a><span id="l24.112" class="difflineminus">-        engineList.builder.rebuild();</span>
<a href="#l24.113"></a><span id="l24.113" class="difflineminus">-      }</span>
<a href="#l24.114"></a><span id="l24.114" class="difflineminus">-    }</span>
<a href="#l24.115"></a><span id="l24.115" class="difflineminus">-  }</span>
<a href="#l24.116"></a><span id="l24.116" class="difflineminus">-</span>
<a href="#l24.117"></a><span id="l24.117" class="difflineminus">-  // try and determine last category name used</span>
<a href="#l24.118"></a><span id="l24.118" class="difflineminus">-  var lastCategoryName = &quot;&quot;;</span>
<a href="#l24.119"></a><span id="l24.119" class="difflineminus">-  try</span>
<a href="#l24.120"></a><span id="l24.120" class="difflineminus">-  {</span>
<a href="#l24.121"></a><span id="l24.121" class="difflineminus">-    var pref = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l24.122"></a><span id="l24.122" class="difflineminus">-                         .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l24.123"></a><span id="l24.123" class="difflineminus">-    lastCategoryName = pref.getCharPref( &quot;browser.search.last_search_category&quot; );</span>
<a href="#l24.124"></a><span id="l24.124" class="difflineminus">-</span>
<a href="#l24.125"></a><span id="l24.125" class="difflineminus">-    if (lastCategoryName != &quot;&quot;)</span>
<a href="#l24.126"></a><span id="l24.126" class="difflineminus">-    {</span>
<a href="#l24.127"></a><span id="l24.127" class="difflineminus">-      // strip off the prefix if necessary</span>
<a href="#l24.128"></a><span id="l24.128" class="difflineminus">-      var prefix=&quot;NC:SearchCategory?category=&quot;;</span>
<a href="#l24.129"></a><span id="l24.129" class="difflineminus">-      if (lastCategoryName.indexOf(prefix) == 0)</span>
<a href="#l24.130"></a><span id="l24.130" class="difflineminus">-      {</span>
<a href="#l24.131"></a><span id="l24.131" class="difflineminus">-        lastCategoryName = lastCategoryName.substr(prefix.length);</span>
<a href="#l24.132"></a><span id="l24.132" class="difflineminus">-      }</span>
<a href="#l24.133"></a><span id="l24.133" class="difflineminus">-    }</span>
<a href="#l24.134"></a><span id="l24.134" class="difflineminus">-</span>
<a href="#l24.135"></a><span id="l24.135" class="difflineminus">-  }</span>
<a href="#l24.136"></a><span id="l24.136" class="difflineminus">-  catch( e )</span>
<a href="#l24.137"></a><span id="l24.137" class="difflineminus">-  {</span>
<a href="#l24.138"></a><span id="l24.138" class="difflineminus">-    debug(&quot;Exception in SearchPanelStartup\n&quot;);</span>
<a href="#l24.139"></a><span id="l24.139" class="difflineminus">-    lastCategoryName = &quot;&quot;;</span>
<a href="#l24.140"></a><span id="l24.140" class="difflineminus">-  }</span>
<a href="#l24.141"></a><span id="l24.141" class="difflineminus">-  debug(&quot;\nSearchPanelStartup: lastCategoryName = '&quot; + lastCategoryName + &quot;'\n&quot;);</span>
<a href="#l24.142"></a><span id="l24.142" class="difflineminus">-</span>
<a href="#l24.143"></a><span id="l24.143" class="difflineminus">-  // select the appropriate category</span>
<a href="#l24.144"></a><span id="l24.144" class="difflineminus">-  var categoryPopup = document.getElementById( &quot;categoryPopup&quot; );</span>
<a href="#l24.145"></a><span id="l24.145" class="difflineminus">-  if( categoryList &amp;&amp; categoryPopup )</span>
<a href="#l24.146"></a><span id="l24.146" class="difflineminus">-  {</span>
<a href="#l24.147"></a><span id="l24.147" class="difflineminus">-    var found = false;</span>
<a href="#l24.148"></a><span id="l24.148" class="difflineminus">-    for( var i = 0; i &lt; categoryPopup.childNodes.length; i++ )</span>
<a href="#l24.149"></a><span id="l24.149" class="difflineminus">-    {</span>
<a href="#l24.150"></a><span id="l24.150" class="difflineminus">-      if( ( lastCategoryName == &quot;&quot; &amp;&amp; categoryPopup.childNodes[i].getAttribute(&quot;value&quot;) == &quot;NC:SearchEngineRoot&quot; ) ||</span>
<a href="#l24.151"></a><span id="l24.151" class="difflineminus">-          ( categoryPopup.childNodes[i].getAttribute(&quot;id&quot;) == lastCategoryName ) )</span>
<a href="#l24.152"></a><span id="l24.152" class="difflineminus">-      {</span>
<a href="#l24.153"></a><span id="l24.153" class="difflineminus">-        categoryList.selectedItem = categoryPopup.childNodes[i];</span>
<a href="#l24.154"></a><span id="l24.154" class="difflineminus">-        found = true;</span>
<a href="#l24.155"></a><span id="l24.155" class="difflineminus">-        break;</span>
<a href="#l24.156"></a><span id="l24.156" class="difflineminus">-      }</span>
<a href="#l24.157"></a><span id="l24.157" class="difflineminus">-    }</span>
<a href="#l24.158"></a><span id="l24.158" class="difflineminus">-    if (categoryPopup.childNodes.length &gt; 0)</span>
<a href="#l24.159"></a><span id="l24.159" class="difflineminus">-    {</span>
<a href="#l24.160"></a><span id="l24.160" class="difflineminus">-      if (found == false)</span>
<a href="#l24.161"></a><span id="l24.161" class="difflineminus">-      {</span>
<a href="#l24.162"></a><span id="l24.162" class="difflineminus">-        categoryList.selectedItem = categoryPopup.childNodes[0];</span>
<a href="#l24.163"></a><span id="l24.163" class="difflineminus">-      }</span>
<a href="#l24.164"></a><span id="l24.164" class="difflineminus">-      chooseCategory(categoryList.selectedItem);</span>
<a href="#l24.165"></a><span id="l24.165" class="difflineminus">-    }</span>
<a href="#l24.166"></a><span id="l24.166" class="difflineminus">-  }</span>
<a href="#l24.167"></a><span id="l24.167" class="difflineminus">-</span>
<a href="#l24.168"></a><span id="l24.168" class="difflineminus">-}</span>
<a href="#l24.169"></a><span id="l24.169" class="difflineminus">-</span>
<a href="#l24.170"></a><span id="l24.170" class="difflineminus">-</span>
<a href="#l24.171"></a><span id="l24.171" class="difflineminus">-</span>
<a href="#l24.172"></a><span id="l24.172" class="difflineminus">-function Commit()</span>
<a href="#l24.173"></a><span id="l24.173" class="difflineminus">-{</span>
<a href="#l24.174"></a><span id="l24.174" class="difflineminus">-  // flush</span>
<a href="#l24.175"></a><span id="l24.175" class="difflineminus">-  if (catDS)</span>
<a href="#l24.176"></a><span id="l24.176" class="difflineminus">-  {</span>
<a href="#l24.177"></a><span id="l24.177" class="difflineminus">-    var flushableDS = catDS.QueryInterface(Components.interfaces.nsIRDFRemoteDataSource);</span>
<a href="#l24.178"></a><span id="l24.178" class="difflineminus">-    if (flushableDS)</span>
<a href="#l24.179"></a><span id="l24.179" class="difflineminus">-    {</span>
<a href="#l24.180"></a><span id="l24.180" class="difflineminus">-      flushableDS.Flush();</span>
<a href="#l24.181"></a><span id="l24.181" class="difflineminus">-    }</span>
<a href="#l24.182"></a><span id="l24.182" class="difflineminus">-  }</span>
<a href="#l24.183"></a><span id="l24.183" class="difflineminus">-</span>
<a href="#l24.184"></a><span id="l24.184" class="difflineminus">-  return true;</span>
<a href="#l24.185"></a><span id="l24.185" class="difflineminus">-}</span>
<a href="#l24.186"></a><span id="l24.186" class="difflineminus">-</span>
<a href="#l24.187"></a><span id="l24.187" class="difflineminus">-</span>
<a href="#l24.188"></a><span id="l24.188" class="difflineminus">-</span>
<a href="#l24.189"></a><span id="l24.189" class="difflineminus">-function doUnload()</span>
<a href="#l24.190"></a><span id="l24.190" class="difflineminus">-{</span>
<a href="#l24.191"></a><span id="l24.191" class="difflineminus">-    // Get the current window position/size.</span>
<a href="#l24.192"></a><span id="l24.192" class="difflineminus">-    var x = window.screenX;</span>
<a href="#l24.193"></a><span id="l24.193" class="difflineminus">-    var y = window.screenY;</span>
<a href="#l24.194"></a><span id="l24.194" class="difflineminus">-    var h = window.outerHeight;</span>
<a href="#l24.195"></a><span id="l24.195" class="difflineminus">-    var w = window.outerWidth;</span>
<a href="#l24.196"></a><span id="l24.196" class="difflineminus">-</span>
<a href="#l24.197"></a><span id="l24.197" class="difflineminus">-    // Store these into the window attributes (for persistence).</span>
<a href="#l24.198"></a><span id="l24.198" class="difflineminus">-    var win = document.getElementById( &quot;search-editor-window&quot; );</span>
<a href="#l24.199"></a><span id="l24.199" class="difflineminus">-    win.setAttribute( &quot;x&quot;, x );</span>
<a href="#l24.200"></a><span id="l24.200" class="difflineminus">-    win.setAttribute( &quot;y&quot;, y );</span>
<a href="#l24.201"></a><span id="l24.201" class="difflineminus">-    win.setAttribute( &quot;height&quot;, h );</span>
<a href="#l24.202"></a><span id="l24.202" class="difflineminus">-    win.setAttribute( &quot;width&quot;, w );</span>
<a href="#l24.203"></a><span id="l24.203" class="difflineminus">-}</span>
<a href="#l24.204"></a><span id="l24.204" class="difflineminus">-</span>
<a href="#l24.205"></a><span id="l24.205" class="difflineminus">-</span>
<a href="#l24.206"></a><span id="l24.206" class="difflineminus">-</span>
<a href="#l24.207"></a><span id="l24.207" class="difflineminus">-/* Note: doSort() does NOT support natural order sorting, unless naturalOrderResource is valid,</span>
<a href="#l24.208"></a><span id="l24.208" class="difflineminus">-         in which case we sort ascending on naturalOrderResource</span>
<a href="#l24.209"></a><span id="l24.209" class="difflineminus">- */</span>
<a href="#l24.210"></a><span id="l24.210" class="difflineminus">-function doSort(sortColName, naturalOrderResource)</span>
<a href="#l24.211"></a><span id="l24.211" class="difflineminus">-{</span>
<a href="#l24.212"></a><span id="l24.212" class="difflineminus">-  var node = document.getElementById(sortColName);</span>
<a href="#l24.213"></a><span id="l24.213" class="difflineminus">-  // determine column resource to sort on</span>
<a href="#l24.214"></a><span id="l24.214" class="difflineminus">-  var sortResource = node.getAttribute('resource');</span>
<a href="#l24.215"></a><span id="l24.215" class="difflineminus">-  if (!sortResource) return(false);</span>
<a href="#l24.216"></a><span id="l24.216" class="difflineminus">-</span>
<a href="#l24.217"></a><span id="l24.217" class="difflineminus">-  var sortDirection=&quot;ascending&quot;;</span>
<a href="#l24.218"></a><span id="l24.218" class="difflineminus">-  var isSortActive = node.getAttribute('sortActive');</span>
<a href="#l24.219"></a><span id="l24.219" class="difflineminus">-  if (isSortActive == &quot;true&quot;)</span>
<a href="#l24.220"></a><span id="l24.220" class="difflineminus">-  {</span>
<a href="#l24.221"></a><span id="l24.221" class="difflineminus">-    sortDirection = &quot;ascending&quot;;</span>
<a href="#l24.222"></a><span id="l24.222" class="difflineminus">-</span>
<a href="#l24.223"></a><span id="l24.223" class="difflineminus">-    var currentDirection = node.getAttribute('sortDirection');</span>
<a href="#l24.224"></a><span id="l24.224" class="difflineminus">-    if (currentDirection == &quot;ascending&quot;)</span>
<a href="#l24.225"></a><span id="l24.225" class="difflineminus">-    {</span>
<a href="#l24.226"></a><span id="l24.226" class="difflineminus">-      if (sortResource != naturalOrderResource)</span>
<a href="#l24.227"></a><span id="l24.227" class="difflineminus">-      {</span>
<a href="#l24.228"></a><span id="l24.228" class="difflineminus">-        sortDirection = &quot;descending&quot;;</span>
<a href="#l24.229"></a><span id="l24.229" class="difflineminus">-      }</span>
<a href="#l24.230"></a><span id="l24.230" class="difflineminus">-    }</span>
<a href="#l24.231"></a><span id="l24.231" class="difflineminus">-    else if (currentDirection == &quot;descending&quot;)</span>
<a href="#l24.232"></a><span id="l24.232" class="difflineminus">-    {</span>
<a href="#l24.233"></a><span id="l24.233" class="difflineminus">-      if (naturalOrderResource != null &amp;&amp; naturalOrderResource != &quot;&quot;)</span>
<a href="#l24.234"></a><span id="l24.234" class="difflineminus">-      {</span>
<a href="#l24.235"></a><span id="l24.235" class="difflineminus">-        sortResource = naturalOrderResource;</span>
<a href="#l24.236"></a><span id="l24.236" class="difflineminus">-      }</span>
<a href="#l24.237"></a><span id="l24.237" class="difflineminus">-    }</span>
<a href="#l24.238"></a><span id="l24.238" class="difflineminus">-  }</span>
<a href="#l24.239"></a><span id="l24.239" class="difflineminus">-</span>
<a href="#l24.240"></a><span id="l24.240" class="difflineminus">-  var isupports = Components.classes[&quot;@mozilla.org/xul/xul-sort-service;1&quot;].getService();</span>
<a href="#l24.241"></a><span id="l24.241" class="difflineminus">-  if (!isupports)    return(false);</span>
<a href="#l24.242"></a><span id="l24.242" class="difflineminus">-  var xulSortService = isupports.QueryInterface(Components.interfaces.nsIXULSortService);</span>
<a href="#l24.243"></a><span id="l24.243" class="difflineminus">-  if (!xulSortService)    return(false);</span>
<a href="#l24.244"></a><span id="l24.244" class="difflineminus">-  try</span>
<a href="#l24.245"></a><span id="l24.245" class="difflineminus">-  {</span>
<a href="#l24.246"></a><span id="l24.246" class="difflineminus">-    xulSortService.sort(node, sortResource, sortDirection);</span>
<a href="#l24.247"></a><span id="l24.247" class="difflineminus">-  }</span>
<a href="#l24.248"></a><span id="l24.248" class="difflineminus">-  catch(ex)</span>
<a href="#l24.249"></a><span id="l24.249" class="difflineminus">-  {</span>
<a href="#l24.250"></a><span id="l24.250" class="difflineminus">-    debug(&quot;Exception calling xulSortService.sort()&quot;);</span>
<a href="#l24.251"></a><span id="l24.251" class="difflineminus">-  }</span>
<a href="#l24.252"></a><span id="l24.252" class="difflineminus">-  return(true);</span>
<a href="#l24.253"></a><span id="l24.253" class="difflineminus">-}</span>
<a href="#l24.254"></a><span id="l24.254" class="difflineminus">-</span>
<a href="#l24.255"></a><span id="l24.255" class="difflineminus">-</span>
<a href="#l24.256"></a><span id="l24.256" class="difflineminus">-</span>
<a href="#l24.257"></a><span id="l24.257" class="difflineminus">-function chooseCategory( aNode )</span>
<a href="#l24.258"></a><span id="l24.258" class="difflineminus">-{</span>
<a href="#l24.259"></a><span id="l24.259" class="difflineminus">-  var category = &quot;NC:SearchCategory?category=&quot; + aNode.getAttribute(&quot;id&quot;);</span>
<a href="#l24.260"></a><span id="l24.260" class="difflineminus">-  debug(&quot;chooseCategory: '&quot; + category + &quot;'\n&quot;);</span>
<a href="#l24.261"></a><span id="l24.261" class="difflineminus">-</span>
<a href="#l24.262"></a><span id="l24.262" class="difflineminus">-  var treeNode = document.getElementById(&quot;engineList&quot;);</span>
<a href="#l24.263"></a><span id="l24.263" class="difflineminus">-  if (treeNode)</span>
<a href="#l24.264"></a><span id="l24.264" class="difflineminus">-  {</span>
<a href="#l24.265"></a><span id="l24.265" class="difflineminus">-    dump(&quot;*** Set search engine list to category=&quot; + category + &quot;\n&quot;);</span>
<a href="#l24.266"></a><span id="l24.266" class="difflineminus">-    treeNode.setAttribute( &quot;ref&quot;, category );</span>
<a href="#l24.267"></a><span id="l24.267" class="difflineminus">-    treeNode.builder.rebuild();</span>
<a href="#l24.268"></a><span id="l24.268" class="difflineminus">-  }</span>
<a href="#l24.269"></a><span id="l24.269" class="difflineminus">-  return(true);</span>
<a href="#l24.270"></a><span id="l24.270" class="difflineminus">-}</span>
<a href="#l24.271"></a><span id="l24.271" class="difflineminus">-</span>
<a href="#l24.272"></a><span id="l24.272" class="difflineminus">-</span>
<a href="#l24.273"></a><span id="l24.273" class="difflineminus">-</span>
<a href="#l24.274"></a><span id="l24.274" class="difflineminus">-function AddEngine()</span>
<a href="#l24.275"></a><span id="l24.275" class="difflineminus">-{</span>
<a href="#l24.276"></a><span id="l24.276" class="difflineminus">-  var allenginesList = document.getElementById(&quot;allengines&quot;);</span>
<a href="#l24.277"></a><span id="l24.277" class="difflineminus">-  if (!allenginesList)  return(false);</span>
<a href="#l24.278"></a><span id="l24.278" class="difflineminus">-  var select_list = allenginesList.selectedItems;</span>
<a href="#l24.279"></a><span id="l24.279" class="difflineminus">-  if (!select_list) return(false)</span>
<a href="#l24.280"></a><span id="l24.280" class="difflineminus">-  if (select_list.length &lt; 1) return(false);</span>
<a href="#l24.281"></a><span id="l24.281" class="difflineminus">-</span>
<a href="#l24.282"></a><span id="l24.282" class="difflineminus">-  // make sure we have at least one category to add engine into</span>
<a href="#l24.283"></a><span id="l24.283" class="difflineminus">-  var categoryPopup = document.getElementById( &quot;categoryPopup&quot; );</span>
<a href="#l24.284"></a><span id="l24.284" class="difflineminus">-  if (!categoryPopup) return(false);</span>
<a href="#l24.285"></a><span id="l24.285" class="difflineminus">-  if (categoryPopup.childNodes.length &lt; 1)</span>
<a href="#l24.286"></a><span id="l24.286" class="difflineminus">-  {</span>
<a href="#l24.287"></a><span id="l24.287" class="difflineminus">-    if (NewCategory() == false) return(false);</span>
<a href="#l24.288"></a><span id="l24.288" class="difflineminus">-  }</span>
<a href="#l24.289"></a><span id="l24.289" class="difflineminus">-</span>
<a href="#l24.290"></a><span id="l24.290" class="difflineminus">-  var engineList = document.getElementById(&quot;engineList&quot;);</span>
<a href="#l24.291"></a><span id="l24.291" class="difflineminus">-  if (!engineList)  return(false);</span>
<a href="#l24.292"></a><span id="l24.292" class="difflineminus">-</span>
<a href="#l24.293"></a><span id="l24.293" class="difflineminus">-  var ref = engineList.getAttribute(&quot;ref&quot;);</span>
<a href="#l24.294"></a><span id="l24.294" class="difflineminus">-  if ((!ref) || (ref == &quot;&quot;))  return(false);</span>
<a href="#l24.295"></a><span id="l24.295" class="difflineminus">-</span>
<a href="#l24.296"></a><span id="l24.296" class="difflineminus">-  var categoryRes = RDF.GetResource(ref);</span>
<a href="#l24.297"></a><span id="l24.297" class="difflineminus">-  if (!categoryRes) return(false);</span>
<a href="#l24.298"></a><span id="l24.298" class="difflineminus">-</span>
<a href="#l24.299"></a><span id="l24.299" class="difflineminus">-  RDFCUtils.MakeSeq(catDS, categoryRes);</span>
<a href="#l24.300"></a><span id="l24.300" class="difflineminus">-</span>
<a href="#l24.301"></a><span id="l24.301" class="difflineminus">-  RDFC.Init(catDS, categoryRes);</span>
<a href="#l24.302"></a><span id="l24.302" class="difflineminus">-</span>
<a href="#l24.303"></a><span id="l24.303" class="difflineminus">-  var urlRes = RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#URL&quot;);</span>
<a href="#l24.304"></a><span id="l24.304" class="difflineminus">-  if (!urlRes)  return(false);</span>
<a href="#l24.305"></a><span id="l24.305" class="difflineminus">-  var typeRes = RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#searchtype&quot;);</span>
<a href="#l24.306"></a><span id="l24.306" class="difflineminus">-  if (!typeRes) return(false);</span>
<a href="#l24.307"></a><span id="l24.307" class="difflineminus">-  var engineRes = RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#Engine&quot;);</span>
<a href="#l24.308"></a><span id="l24.308" class="difflineminus">-  if (!engineRes) return(false);</span>
<a href="#l24.309"></a><span id="l24.309" class="difflineminus">-</span>
<a href="#l24.310"></a><span id="l24.310" class="difflineminus">-  for (var x = 0; x &lt; select_list.length; x++)</span>
<a href="#l24.311"></a><span id="l24.311" class="difflineminus">-  {</span>
<a href="#l24.312"></a><span id="l24.312" class="difflineminus">-    var id = select_list[x].getAttribute(&quot;id&quot;);</span>
<a href="#l24.313"></a><span id="l24.313" class="difflineminus">-    if ((!id) || (id == &quot;&quot;))  return(false);</span>
<a href="#l24.314"></a><span id="l24.314" class="difflineminus">-    var idRes = RDF.GetResource(id);</span>
<a href="#l24.315"></a><span id="l24.315" class="difflineminus">-    if (!idRes) return(false);</span>
<a href="#l24.316"></a><span id="l24.316" class="difflineminus">-</span>
<a href="#l24.317"></a><span id="l24.317" class="difflineminus">-    // try and find/use alias to search engine</span>
<a href="#l24.318"></a><span id="l24.318" class="difflineminus">-    var privateEngineFlag = internetSearchDS.HasAssertion(idRes, typeRes, engineRes, true);</span>
<a href="#l24.319"></a><span id="l24.319" class="difflineminus">-    if (privateEngineFlag == true)</span>
<a href="#l24.320"></a><span id="l24.320" class="difflineminus">-    {</span>
<a href="#l24.321"></a><span id="l24.321" class="difflineminus">-      var node = internetSearchDS.GetTarget(idRes, urlRes, true);</span>
<a href="#l24.322"></a><span id="l24.322" class="difflineminus">-      if (node) node = node.QueryInterface(Components.interfaces.nsIRDFLiteral);</span>
<a href="#l24.323"></a><span id="l24.323" class="difflineminus">-      if (node)</span>
<a href="#l24.324"></a><span id="l24.324" class="difflineminus">-      {</span>
<a href="#l24.325"></a><span id="l24.325" class="difflineminus">-        if (node.Value)</span>
<a href="#l24.326"></a><span id="l24.326" class="difflineminus">-        {</span>
<a href="#l24.327"></a><span id="l24.327" class="difflineminus">-          id = node.Value;</span>
<a href="#l24.328"></a><span id="l24.328" class="difflineminus">-          idRes = RDF.GetResource(id);</span>
<a href="#l24.329"></a><span id="l24.329" class="difflineminus">-          if (!idRes) return(false);</span>
<a href="#l24.330"></a><span id="l24.330" class="difflineminus">-        }</span>
<a href="#l24.331"></a><span id="l24.331" class="difflineminus">-      }</span>
<a href="#l24.332"></a><span id="l24.332" class="difflineminus">-    }</span>
<a href="#l24.333"></a><span id="l24.333" class="difflineminus">-</span>
<a href="#l24.334"></a><span id="l24.334" class="difflineminus">-    var nodeIndex = RDFC.IndexOf(idRes);</span>
<a href="#l24.335"></a><span id="l24.335" class="difflineminus">-    if (nodeIndex &lt; 1)</span>
<a href="#l24.336"></a><span id="l24.336" class="difflineminus">-    {</span>
<a href="#l24.337"></a><span id="l24.337" class="difflineminus">-      RDFC.AppendElement(idRes);</span>
<a href="#l24.338"></a><span id="l24.338" class="difflineminus">-    }</span>
<a href="#l24.339"></a><span id="l24.339" class="difflineminus">-  }</span>
<a href="#l24.340"></a><span id="l24.340" class="difflineminus">-</span>
<a href="#l24.341"></a><span id="l24.341" class="difflineminus">-  return(true);</span>
<a href="#l24.342"></a><span id="l24.342" class="difflineminus">-}</span>
<a href="#l24.343"></a><span id="l24.343" class="difflineminus">-</span>
<a href="#l24.344"></a><span id="l24.344" class="difflineminus">-</span>
<a href="#l24.345"></a><span id="l24.345" class="difflineminus">-</span>
<a href="#l24.346"></a><span id="l24.346" class="difflineminus">-function RemoveEngine()</span>
<a href="#l24.347"></a><span id="l24.347" class="difflineminus">-{</span>
<a href="#l24.348"></a><span id="l24.348" class="difflineminus">-  var engineList = document.getElementById(&quot;engineList&quot;);</span>
<a href="#l24.349"></a><span id="l24.349" class="difflineminus">-  if (!engineList)  return(false);</span>
<a href="#l24.350"></a><span id="l24.350" class="difflineminus">-  var select_list = engineList.selectedItems;</span>
<a href="#l24.351"></a><span id="l24.351" class="difflineminus">-  if (!select_list) return(false)</span>
<a href="#l24.352"></a><span id="l24.352" class="difflineminus">-  if (select_list.length &lt; 1) return(false);</span>
<a href="#l24.353"></a><span id="l24.353" class="difflineminus">-</span>
<a href="#l24.354"></a><span id="l24.354" class="difflineminus">-  var ref = engineList.getAttribute(&quot;ref&quot;);</span>
<a href="#l24.355"></a><span id="l24.355" class="difflineminus">-  if ((!ref) || (ref == &quot;&quot;))  return(false);</span>
<a href="#l24.356"></a><span id="l24.356" class="difflineminus">-  var categoryRes = RDF.GetResource(ref);</span>
<a href="#l24.357"></a><span id="l24.357" class="difflineminus">-  if (!categoryRes) return(false);</span>
<a href="#l24.358"></a><span id="l24.358" class="difflineminus">-</span>
<a href="#l24.359"></a><span id="l24.359" class="difflineminus">-  RDFC.Init(catDS, categoryRes);</span>
<a href="#l24.360"></a><span id="l24.360" class="difflineminus">-</span>
<a href="#l24.361"></a><span id="l24.361" class="difflineminus">-  // Note: walk backwards to make deletion easier</span>
<a href="#l24.362"></a><span id="l24.362" class="difflineminus">-  for (var x = select_list.length - 1; x &gt;= 0; x--)</span>
<a href="#l24.363"></a><span id="l24.363" class="difflineminus">-  {</span>
<a href="#l24.364"></a><span id="l24.364" class="difflineminus">-    var id = select_list[x].getAttribute(&quot;id&quot;);</span>
<a href="#l24.365"></a><span id="l24.365" class="difflineminus">-    if ((!id) || (id == &quot;&quot;))  return(false);</span>
<a href="#l24.366"></a><span id="l24.366" class="difflineminus">-    var idRes = RDF.GetResource(id);</span>
<a href="#l24.367"></a><span id="l24.367" class="difflineminus">-    if (!idRes) return(false);</span>
<a href="#l24.368"></a><span id="l24.368" class="difflineminus">-</span>
<a href="#l24.369"></a><span id="l24.369" class="difflineminus">-    var nodeIndex = RDFC.IndexOf(idRes);</span>
<a href="#l24.370"></a><span id="l24.370" class="difflineminus">-    if (nodeIndex &gt; 0)</span>
<a href="#l24.371"></a><span id="l24.371" class="difflineminus">-    {</span>
<a href="#l24.372"></a><span id="l24.372" class="difflineminus">-      RDFC.RemoveElementAt(nodeIndex, true, idRes);</span>
<a href="#l24.373"></a><span id="l24.373" class="difflineminus">-    }</span>
<a href="#l24.374"></a><span id="l24.374" class="difflineminus">-  }</span>
<a href="#l24.375"></a><span id="l24.375" class="difflineminus">-</span>
<a href="#l24.376"></a><span id="l24.376" class="difflineminus">-  return(true);</span>
<a href="#l24.377"></a><span id="l24.377" class="difflineminus">-}</span>
<a href="#l24.378"></a><span id="l24.378" class="difflineminus">-</span>
<a href="#l24.379"></a><span id="l24.379" class="difflineminus">-</span>
<a href="#l24.380"></a><span id="l24.380" class="difflineminus">-</span>
<a href="#l24.381"></a><span id="l24.381" class="difflineminus">-function MoveUp()</span>
<a href="#l24.382"></a><span id="l24.382" class="difflineminus">-{</span>
<a href="#l24.383"></a><span id="l24.383" class="difflineminus">-  return  MoveDelta(-1);</span>
<a href="#l24.384"></a><span id="l24.384" class="difflineminus">-}</span>
<a href="#l24.385"></a><span id="l24.385" class="difflineminus">-</span>
<a href="#l24.386"></a><span id="l24.386" class="difflineminus">-</span>
<a href="#l24.387"></a><span id="l24.387" class="difflineminus">-</span>
<a href="#l24.388"></a><span id="l24.388" class="difflineminus">-function MoveDown()</span>
<a href="#l24.389"></a><span id="l24.389" class="difflineminus">-{</span>
<a href="#l24.390"></a><span id="l24.390" class="difflineminus">-  return  MoveDelta(1);</span>
<a href="#l24.391"></a><span id="l24.391" class="difflineminus">-}</span>
<a href="#l24.392"></a><span id="l24.392" class="difflineminus">-</span>
<a href="#l24.393"></a><span id="l24.393" class="difflineminus">-</span>
<a href="#l24.394"></a><span id="l24.394" class="difflineminus">-</span>
<a href="#l24.395"></a><span id="l24.395" class="difflineminus">-function MoveDelta(delta)</span>
<a href="#l24.396"></a><span id="l24.396" class="difflineminus">-{</span>
<a href="#l24.397"></a><span id="l24.397" class="difflineminus">-  var engineList = document.getElementById(&quot;engineList&quot;);</span>
<a href="#l24.398"></a><span id="l24.398" class="difflineminus">-  if (!engineList)  return(false);</span>
<a href="#l24.399"></a><span id="l24.399" class="difflineminus">-  var select_list = engineList.selectedItems;</span>
<a href="#l24.400"></a><span id="l24.400" class="difflineminus">-  if (!select_list) return(false)</span>
<a href="#l24.401"></a><span id="l24.401" class="difflineminus">-  if (select_list.length != 1)  return(false);</span>
<a href="#l24.402"></a><span id="l24.402" class="difflineminus">-</span>
<a href="#l24.403"></a><span id="l24.403" class="difflineminus">-  var ref = engineList.getAttribute(&quot;ref&quot;);</span>
<a href="#l24.404"></a><span id="l24.404" class="difflineminus">-  if (!ref) return(false);</span>
<a href="#l24.405"></a><span id="l24.405" class="difflineminus">-  var categoryRes = RDF.GetResource(ref);</span>
<a href="#l24.406"></a><span id="l24.406" class="difflineminus">-  if (!categoryRes) return(false);</span>
<a href="#l24.407"></a><span id="l24.407" class="difflineminus">-</span>
<a href="#l24.408"></a><span id="l24.408" class="difflineminus">-  var id = select_list[0].id;</span>
<a href="#l24.409"></a><span id="l24.409" class="difflineminus">-  if (!id)  return(false);</span>
<a href="#l24.410"></a><span id="l24.410" class="difflineminus">-  var idRes = RDF.GetResource(id);</span>
<a href="#l24.411"></a><span id="l24.411" class="difflineminus">-  if (!idRes) return(false);</span>
<a href="#l24.412"></a><span id="l24.412" class="difflineminus">-</span>
<a href="#l24.413"></a><span id="l24.413" class="difflineminus">-  RDFC.Init(catDS, categoryRes);</span>
<a href="#l24.414"></a><span id="l24.414" class="difflineminus">-</span>
<a href="#l24.415"></a><span id="l24.415" class="difflineminus">-  var nodeIndex = RDFC.IndexOf(idRes);</span>
<a href="#l24.416"></a><span id="l24.416" class="difflineminus">-  if (nodeIndex &lt; 1)  return(false);    // how did that happen?</span>
<a href="#l24.417"></a><span id="l24.417" class="difflineminus">-</span>
<a href="#l24.418"></a><span id="l24.418" class="difflineminus">-  var numItems = RDFC.GetCount();</span>
<a href="#l24.419"></a><span id="l24.419" class="difflineminus">-</span>
<a href="#l24.420"></a><span id="l24.420" class="difflineminus">-  var newPos = -1;</span>
<a href="#l24.421"></a><span id="l24.421" class="difflineminus">-  if (((delta == -1) &amp;&amp; (nodeIndex &gt; 1)) ||</span>
<a href="#l24.422"></a><span id="l24.422" class="difflineminus">-    ((delta == 1) &amp;&amp; (nodeIndex &lt; numItems)))</span>
<a href="#l24.423"></a><span id="l24.423" class="difflineminus">-  {</span>
<a href="#l24.424"></a><span id="l24.424" class="difflineminus">-    newPos = nodeIndex + delta;</span>
<a href="#l24.425"></a><span id="l24.425" class="difflineminus">-    RDFC.RemoveElementAt(nodeIndex, true, idRes);</span>
<a href="#l24.426"></a><span id="l24.426" class="difflineminus">-  }</span>
<a href="#l24.427"></a><span id="l24.427" class="difflineminus">-  if (newPos &gt; 0)</span>
<a href="#l24.428"></a><span id="l24.428" class="difflineminus">-  {</span>
<a href="#l24.429"></a><span id="l24.429" class="difflineminus">-    RDFC.InsertElementAt(idRes, newPos, true);</span>
<a href="#l24.430"></a><span id="l24.430" class="difflineminus">-  }</span>
<a href="#l24.431"></a><span id="l24.431" class="difflineminus">-</span>
<a href="#l24.432"></a><span id="l24.432" class="difflineminus">-  selectItems(engineList, ref, id);</span>
<a href="#l24.433"></a><span id="l24.433" class="difflineminus">-</span>
<a href="#l24.434"></a><span id="l24.434" class="difflineminus">-  return(true);</span>
<a href="#l24.435"></a><span id="l24.435" class="difflineminus">-}</span>
<a href="#l24.436"></a><span id="l24.436" class="difflineminus">-</span>
<a href="#l24.437"></a><span id="l24.437" class="difflineminus">-function doMoveDirectionEnabling()</span>
<a href="#l24.438"></a><span id="l24.438" class="difflineminus">-{</span>
<a href="#l24.439"></a><span id="l24.439" class="difflineminus">-  var engineList = document.getElementById(&quot;engineList&quot;)</span>
<a href="#l24.440"></a><span id="l24.440" class="difflineminus">-  var selectedItems = engineList.selectedItems;</span>
<a href="#l24.441"></a><span id="l24.441" class="difflineminus">-  var nodeIndex = -1;</span>
<a href="#l24.442"></a><span id="l24.442" class="difflineminus">-  if (selectedItems &amp;&amp; selectedItems.length == 1) {</span>
<a href="#l24.443"></a><span id="l24.443" class="difflineminus">-    var ref = engineList.getAttribute(&quot;ref&quot;);</span>
<a href="#l24.444"></a><span id="l24.444" class="difflineminus">-    var categoryResource = RDF.GetResource(ref);</span>
<a href="#l24.445"></a><span id="l24.445" class="difflineminus">-    var elementResource = RDF.GetResource(selectedItems[0].id);</span>
<a href="#l24.446"></a><span id="l24.446" class="difflineminus">-    RDFC.Init(catDS, categoryResource);</span>
<a href="#l24.447"></a><span id="l24.447" class="difflineminus">-    nodeIndex = RDFC.IndexOf(elementResource);</span>
<a href="#l24.448"></a><span id="l24.448" class="difflineminus">-  }</span>
<a href="#l24.449"></a><span id="l24.449" class="difflineminus">-  </span>
<a href="#l24.450"></a><span id="l24.450" class="difflineminus">-  var moveUpButton = document.getElementById(&quot;up&quot;);</span>
<a href="#l24.451"></a><span id="l24.451" class="difflineminus">-  var moveDownButton = document.getElementById(&quot;down&quot;);</span>
<a href="#l24.452"></a><span id="l24.452" class="difflineminus">-</span>
<a href="#l24.453"></a><span id="l24.453" class="difflineminus">-  if (nodeIndex &lt;= 1)</span>
<a href="#l24.454"></a><span id="l24.454" class="difflineminus">-    moveUpButton.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l24.455"></a><span id="l24.455" class="difflineminus">-  else</span>
<a href="#l24.456"></a><span id="l24.456" class="difflineminus">-    moveUpButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l24.457"></a><span id="l24.457" class="difflineminus">-  </span>
<a href="#l24.458"></a><span id="l24.458" class="difflineminus">-  if (nodeIndex &lt; 0 || nodeIndex &gt;= RDFC.GetCount())</span>
<a href="#l24.459"></a><span id="l24.459" class="difflineminus">-    moveDownButton.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l24.460"></a><span id="l24.460" class="difflineminus">-  else</span>
<a href="#l24.461"></a><span id="l24.461" class="difflineminus">-    moveDownButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l24.462"></a><span id="l24.462" class="difflineminus">-}</span>
<a href="#l24.463"></a><span id="l24.463" class="difflineminus">-</span>
<a href="#l24.464"></a><span id="l24.464" class="difflineminus">-</span>
<a href="#l24.465"></a><span id="l24.465" class="difflineminus">-function NewCategory()</span>
<a href="#l24.466"></a><span id="l24.466" class="difflineminus">-{</span>
<a href="#l24.467"></a><span id="l24.467" class="difflineminus">-  const promptStr = gSearchBundle.getString(&quot;NewCategoryPrompt&quot;);</span>
<a href="#l24.468"></a><span id="l24.468" class="difflineminus">-  const newTitle = gSearchBundle.getString(&quot;NewCategoryTitle&quot;);</span>
<a href="#l24.469"></a><span id="l24.469" class="difflineminus">-  var result = {value:null};</span>
<a href="#l24.470"></a><span id="l24.470" class="difflineminus">-  var confirmed = promptService.prompt(window, newTitle, promptStr, result, null, {value:0});</span>
<a href="#l24.471"></a><span id="l24.471" class="difflineminus">-  if (!confirmed || (!result.value) || result.value == &quot;&quot;)      return(false);</span>
<a href="#l24.472"></a><span id="l24.472" class="difflineminus">-</span>
<a href="#l24.473"></a><span id="l24.473" class="difflineminus">-  var newName = RDF.GetLiteral(result.value);</span>
<a href="#l24.474"></a><span id="l24.474" class="difflineminus">-  if (!newName) return(false);</span>
<a href="#l24.475"></a><span id="l24.475" class="difflineminus">-</span>
<a href="#l24.476"></a><span id="l24.476" class="difflineminus">-  var categoryRes = RDF.GetResource(&quot;NC:SearchCategoryRoot&quot;);</span>
<a href="#l24.477"></a><span id="l24.477" class="difflineminus">-  if (!categoryRes) return(false);</span>
<a href="#l24.478"></a><span id="l24.478" class="difflineminus">-</span>
<a href="#l24.479"></a><span id="l24.479" class="difflineminus">-  RDFC.Init(catDS, categoryRes);</span>
<a href="#l24.480"></a><span id="l24.480" class="difflineminus">-</span>
<a href="#l24.481"></a><span id="l24.481" class="difflineminus">-  var randomID = Math.random();</span>
<a href="#l24.482"></a><span id="l24.482" class="difflineminus">-  var categoryID = &quot;NC:SearchCategory?category=urn:search:category:&quot; + randomID.toString();</span>
<a href="#l24.483"></a><span id="l24.483" class="difflineminus">-  var currentCatRes = RDF.GetResource(categoryID);</span>
<a href="#l24.484"></a><span id="l24.484" class="difflineminus">-  if (!currentCatRes) return(false);</span>
<a href="#l24.485"></a><span id="l24.485" class="difflineminus">-</span>
<a href="#l24.486"></a><span id="l24.486" class="difflineminus">-  var titleRes = RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#title&quot;);</span>
<a href="#l24.487"></a><span id="l24.487" class="difflineminus">-  if (!titleRes)  return(false);</span>
<a href="#l24.488"></a><span id="l24.488" class="difflineminus">-</span>
<a href="#l24.489"></a><span id="l24.489" class="difflineminus">-  // set the category's name</span>
<a href="#l24.490"></a><span id="l24.490" class="difflineminus">-  catDS.Assert(currentCatRes, titleRes, newName, true);</span>
<a href="#l24.491"></a><span id="l24.491" class="difflineminus">-</span>
<a href="#l24.492"></a><span id="l24.492" class="difflineminus">-  // and insert the category</span>
<a href="#l24.493"></a><span id="l24.493" class="difflineminus">-  RDFC.AppendElement(currentCatRes);</span>
<a href="#l24.494"></a><span id="l24.494" class="difflineminus">-</span>
<a href="#l24.495"></a><span id="l24.495" class="difflineminus">-  RDFCUtils.MakeSeq(catDS, currentCatRes);</span>
<a href="#l24.496"></a><span id="l24.496" class="difflineminus">-</span>
<a href="#l24.497"></a><span id="l24.497" class="difflineminus">-  // try and select the new category</span>
<a href="#l24.498"></a><span id="l24.498" class="difflineminus">-  var categoryList = document.getElementById( &quot;categoryList&quot; );</span>
<a href="#l24.499"></a><span id="l24.499" class="difflineminus">-  var select_list = categoryList.getElementsByAttribute(&quot;id&quot;, categoryID);</span>
<a href="#l24.500"></a><span id="l24.500" class="difflineminus">-  if (select_list &amp;&amp; select_list.item(0))</span>
<a href="#l24.501"></a><span id="l24.501" class="difflineminus">-  {</span>
<a href="#l24.502"></a><span id="l24.502" class="difflineminus">-    categoryList.selectedItem = select_list[0];</span>
<a href="#l24.503"></a><span id="l24.503" class="difflineminus">-    chooseCategory(categoryList.selectedItem);</span>
<a href="#l24.504"></a><span id="l24.504" class="difflineminus">-  }</span>
<a href="#l24.505"></a><span id="l24.505" class="difflineminus">-  return(true);</span>
<a href="#l24.506"></a><span id="l24.506" class="difflineminus">-}</span>
<a href="#l24.507"></a><span id="l24.507" class="difflineminus">-</span>
<a href="#l24.508"></a><span id="l24.508" class="difflineminus">-</span>
<a href="#l24.509"></a><span id="l24.509" class="difflineminus">-</span>
<a href="#l24.510"></a><span id="l24.510" class="difflineminus">-function RenameCategory()</span>
<a href="#l24.511"></a><span id="l24.511" class="difflineminus">-{</span>
<a href="#l24.512"></a><span id="l24.512" class="difflineminus">-  // make sure we have at least one category</span>
<a href="#l24.513"></a><span id="l24.513" class="difflineminus">-  var categoryPopup = document.getElementById( &quot;categoryPopup&quot; );</span>
<a href="#l24.514"></a><span id="l24.514" class="difflineminus">-  if (!categoryPopup) return(false);</span>
<a href="#l24.515"></a><span id="l24.515" class="difflineminus">-  if (categoryPopup.childNodes.length &lt; 1)  return(false);</span>
<a href="#l24.516"></a><span id="l24.516" class="difflineminus">-</span>
<a href="#l24.517"></a><span id="l24.517" class="difflineminus">-  var categoryList = document.getElementById( &quot;categoryList&quot; );</span>
<a href="#l24.518"></a><span id="l24.518" class="difflineminus">-  var currentName = categoryList.selectedItem.getAttribute(&quot;label&quot;);</span>
<a href="#l24.519"></a><span id="l24.519" class="difflineminus">-  const promptStr = gSearchBundle.getString(&quot;RenameCategoryPrompt&quot;);</span>
<a href="#l24.520"></a><span id="l24.520" class="difflineminus">-  const renameTitle = gSearchBundle.getString(&quot;RenameCategoryTitle&quot;);</span>
<a href="#l24.521"></a><span id="l24.521" class="difflineminus">-  var result = {value:currentName};</span>
<a href="#l24.522"></a><span id="l24.522" class="difflineminus">-  var confirmed = promptService.prompt(window,renameTitle,promptStr,result,null,{value:0});</span>
<a href="#l24.523"></a><span id="l24.523" class="difflineminus">-  if (!confirmed || (!result.value) || (result.value == &quot;&quot;) || result.value == currentName)     return(false);</span>
<a href="#l24.524"></a><span id="l24.524" class="difflineminus">-</span>
<a href="#l24.525"></a><span id="l24.525" class="difflineminus">-  var currentCatID = categoryList.selectedItem.getAttribute(&quot;id&quot;);</span>
<a href="#l24.526"></a><span id="l24.526" class="difflineminus">-  var currentCatRes = RDF.GetResource(currentCatID);</span>
<a href="#l24.527"></a><span id="l24.527" class="difflineminus">-  if (!currentCatRes) return(false);</span>
<a href="#l24.528"></a><span id="l24.528" class="difflineminus">-</span>
<a href="#l24.529"></a><span id="l24.529" class="difflineminus">-  var titleRes = RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#title&quot;);</span>
<a href="#l24.530"></a><span id="l24.530" class="difflineminus">-  if (!titleRes)  return(false);</span>
<a href="#l24.531"></a><span id="l24.531" class="difflineminus">-</span>
<a href="#l24.532"></a><span id="l24.532" class="difflineminus">-  var newName = RDF.GetLiteral(result.value);</span>
<a href="#l24.533"></a><span id="l24.533" class="difflineminus">-  if (!newName) return(false);</span>
<a href="#l24.534"></a><span id="l24.534" class="difflineminus">-</span>
<a href="#l24.535"></a><span id="l24.535" class="difflineminus">-  var oldName = catDS.GetTarget(currentCatRes, titleRes, true);</span>
<a href="#l24.536"></a><span id="l24.536" class="difflineminus">-  if (oldName)  oldName = oldName.QueryInterface(Components.interfaces.nsIRDFLiteral);</span>
<a href="#l24.537"></a><span id="l24.537" class="difflineminus">-  if (oldName)</span>
<a href="#l24.538"></a><span id="l24.538" class="difflineminus">-  {</span>
<a href="#l24.539"></a><span id="l24.539" class="difflineminus">-    catDS.Change(currentCatRes, titleRes, oldName, newName);</span>
<a href="#l24.540"></a><span id="l24.540" class="difflineminus">-  }</span>
<a href="#l24.541"></a><span id="l24.541" class="difflineminus">-  else</span>
<a href="#l24.542"></a><span id="l24.542" class="difflineminus">-  {</span>
<a href="#l24.543"></a><span id="l24.543" class="difflineminus">-    catDS.Assert(currentCatRes, titleRes, newName, true);</span>
<a href="#l24.544"></a><span id="l24.544" class="difflineminus">-  }</span>
<a href="#l24.545"></a><span id="l24.545" class="difflineminus">-</span>
<a href="#l24.546"></a><span id="l24.546" class="difflineminus">-  // force popup to update</span>
<a href="#l24.547"></a><span id="l24.547" class="difflineminus">-  chooseCategory(categoryList.selectedItem);</span>
<a href="#l24.548"></a><span id="l24.548" class="difflineminus">-</span>
<a href="#l24.549"></a><span id="l24.549" class="difflineminus">-  return(true);</span>
<a href="#l24.550"></a><span id="l24.550" class="difflineminus">-}</span>
<a href="#l24.551"></a><span id="l24.551" class="difflineminus">-</span>
<a href="#l24.552"></a><span id="l24.552" class="difflineminus">-</span>
<a href="#l24.553"></a><span id="l24.553" class="difflineminus">-</span>
<a href="#l24.554"></a><span id="l24.554" class="difflineminus">-function RemoveCategory()</span>
<a href="#l24.555"></a><span id="l24.555" class="difflineminus">-{</span>
<a href="#l24.556"></a><span id="l24.556" class="difflineminus">-  // make sure we have at least one category</span>
<a href="#l24.557"></a><span id="l24.557" class="difflineminus">-  var categoryPopup = document.getElementById( &quot;categoryPopup&quot; );</span>
<a href="#l24.558"></a><span id="l24.558" class="difflineminus">-  if (!categoryPopup) return(false);</span>
<a href="#l24.559"></a><span id="l24.559" class="difflineminus">-  if (categoryPopup.childNodes.length &lt; 1)  return(false);</span>
<a href="#l24.560"></a><span id="l24.560" class="difflineminus">-</span>
<a href="#l24.561"></a><span id="l24.561" class="difflineminus">-  const titleStr = gSearchBundle.getString(&quot;RemoveCategoryTitle&quot;);</span>
<a href="#l24.562"></a><span id="l24.562" class="difflineminus">-  const promptStr = gSearchBundle.getString(&quot;RemoveCategoryPrompt&quot;);</span>
<a href="#l24.563"></a><span id="l24.563" class="difflineminus">-  const yesStr = gSearchBundle.getString(&quot;RemoveCategoryYes&quot;);</span>
<a href="#l24.564"></a><span id="l24.564" class="difflineminus">-  var flags = ((promptService.BUTTON_TITLE_IS_STRING * promptService.BUTTON_POS_0) +</span>
<a href="#l24.565"></a><span id="l24.565" class="difflineminus">-               (promptService.BUTTON_TITLE_CANCEL * promptService.BUTTON_POS_1) + </span>
<a href="#l24.566"></a><span id="l24.566" class="difflineminus">-               promptService.BUTTON_POS_1_DEFAULT);</span>
<a href="#l24.567"></a><span id="l24.567" class="difflineminus">-  if (promptService.confirmEx(window, titleStr, promptStr, flags, yesStr, null, null, null, {value:0}) == 1)</span>
<a href="#l24.568"></a><span id="l24.568" class="difflineminus">-    return false;</span>
<a href="#l24.569"></a><span id="l24.569" class="difflineminus">-</span>
<a href="#l24.570"></a><span id="l24.570" class="difflineminus">-  var categoryRes = RDF.GetResource(&quot;NC:SearchCategoryRoot&quot;);</span>
<a href="#l24.571"></a><span id="l24.571" class="difflineminus">-  if (!categoryRes) return(false);</span>
<a href="#l24.572"></a><span id="l24.572" class="difflineminus">-</span>
<a href="#l24.573"></a><span id="l24.573" class="difflineminus">-  var categoryList = document.getElementById( &quot;categoryList&quot; );</span>
<a href="#l24.574"></a><span id="l24.574" class="difflineminus">-  if (!categoryList)  return(false);</span>
<a href="#l24.575"></a><span id="l24.575" class="difflineminus">-</span>
<a href="#l24.576"></a><span id="l24.576" class="difflineminus">-  var idNum = categoryList.selectedIndex;</span>
<a href="#l24.577"></a><span id="l24.577" class="difflineminus">-</span>
<a href="#l24.578"></a><span id="l24.578" class="difflineminus">-  var id = categoryList.selectedItem.getAttribute(&quot;id&quot;);</span>
<a href="#l24.579"></a><span id="l24.579" class="difflineminus">-  if ((!id) || (id == &quot;&quot;))  return(false);</span>
<a href="#l24.580"></a><span id="l24.580" class="difflineminus">-</span>
<a href="#l24.581"></a><span id="l24.581" class="difflineminus">-  var idRes = RDF.GetResource(id);</span>
<a href="#l24.582"></a><span id="l24.582" class="difflineminus">-  if (!idRes) return(false);</span>
<a href="#l24.583"></a><span id="l24.583" class="difflineminus">-</span>
<a href="#l24.584"></a><span id="l24.584" class="difflineminus">-  RDFC.Init(catDS, categoryRes);</span>
<a href="#l24.585"></a><span id="l24.585" class="difflineminus">-</span>
<a href="#l24.586"></a><span id="l24.586" class="difflineminus">-  var nodeIndex = RDFC.IndexOf(idRes);</span>
<a href="#l24.587"></a><span id="l24.587" class="difflineminus">-  if (nodeIndex &lt; 1)  return(false);    // how did that happen?</span>
<a href="#l24.588"></a><span id="l24.588" class="difflineminus">-</span>
<a href="#l24.589"></a><span id="l24.589" class="difflineminus">-  RDFC.RemoveElementAt(nodeIndex, true, idRes);</span>
<a href="#l24.590"></a><span id="l24.590" class="difflineminus">-</span>
<a href="#l24.591"></a><span id="l24.591" class="difflineminus">-  // try and select another category</span>
<a href="#l24.592"></a><span id="l24.592" class="difflineminus">-  if (idNum &gt; 0)  --idNum;</span>
<a href="#l24.593"></a><span id="l24.593" class="difflineminus">-  else    idNum = 0;</span>
<a href="#l24.594"></a><span id="l24.594" class="difflineminus">-</span>
<a href="#l24.595"></a><span id="l24.595" class="difflineminus">-  if (categoryPopup.childNodes.length &gt; 0)</span>
<a href="#l24.596"></a><span id="l24.596" class="difflineminus">-  {</span>
<a href="#l24.597"></a><span id="l24.597" class="difflineminus">-    categoryList.selectedItem = categoryPopup.childNodes[idNum];</span>
<a href="#l24.598"></a><span id="l24.598" class="difflineminus">-    chooseCategory(categoryList.selectedItem);</span>
<a href="#l24.599"></a><span id="l24.599" class="difflineminus">-  }</span>
<a href="#l24.600"></a><span id="l24.600" class="difflineminus">-  else</span>
<a href="#l24.601"></a><span id="l24.601" class="difflineminus">-  {</span>
<a href="#l24.602"></a><span id="l24.602" class="difflineminus">-    // last category was deleted, so empty out engine list</span>
<a href="#l24.603"></a><span id="l24.603" class="difflineminus">-    var treeNode = document.getElementById(&quot;engineList&quot;);</span>
<a href="#l24.604"></a><span id="l24.604" class="difflineminus">-    if (treeNode)</span>
<a href="#l24.605"></a><span id="l24.605" class="difflineminus">-    {</span>
<a href="#l24.606"></a><span id="l24.606" class="difflineminus">-      treeNode.setAttribute( &quot;ref&quot;, &quot;&quot; );</span>
<a href="#l24.607"></a><span id="l24.607" class="difflineminus">-    }</span>
<a href="#l24.608"></a><span id="l24.608" class="difflineminus">-  }</span>
<a href="#l24.609"></a><span id="l24.609" class="difflineminus">-  return(true);</span>
<a href="#l24.610"></a><span id="l24.610" class="difflineminus">-}</span>
<a href="#l24.611"></a><span id="l24.611" class="difflineminus">-</span>
<a href="#l24.612"></a><span id="l24.612" class="difflineminus">-</span>
<a href="#l24.613"></a><span id="l24.613" class="difflineminus">-</span>
<a href="#l24.614"></a><span id="l24.614" class="difflineminus">-function selectItems(listbox, containerID, targetID)</span>
<a href="#l24.615"></a><span id="l24.615" class="difflineminus">-{</span>
<a href="#l24.616"></a><span id="l24.616" class="difflineminus">-  var select_list = listbox.getElementsByAttribute(&quot;id&quot;, targetID);</span>
<a href="#l24.617"></a><span id="l24.617" class="difflineminus">-  for (var x=0; x&lt;select_list.length; x++)</span>
<a href="#l24.618"></a><span id="l24.618" class="difflineminus">-  {</span>
<a href="#l24.619"></a><span id="l24.619" class="difflineminus">-    var node = select_list[x];</span>
<a href="#l24.620"></a><span id="l24.620" class="difflineminus">-    if (!node)  continue;</span>
<a href="#l24.621"></a><span id="l24.621" class="difflineminus">-</span>
<a href="#l24.622"></a><span id="l24.622" class="difflineminus">-    var parent = node.parentNode;</span>
<a href="#l24.623"></a><span id="l24.623" class="difflineminus">-    if (!parent)  continue;</span>
<a href="#l24.624"></a><span id="l24.624" class="difflineminus">-</span>
<a href="#l24.625"></a><span id="l24.625" class="difflineminus">-    var id = parent.getAttribute(&quot;ref&quot;);</span>
<a href="#l24.626"></a><span id="l24.626" class="difflineminus">-    if (!id || id==&quot;&quot;)</span>
<a href="#l24.627"></a><span id="l24.627" class="difflineminus">-    {</span>
<a href="#l24.628"></a><span id="l24.628" class="difflineminus">-      id = parent.getAttribute(&quot;id&quot;);</span>
<a href="#l24.629"></a><span id="l24.629" class="difflineminus">-    }</span>
<a href="#l24.630"></a><span id="l24.630" class="difflineminus">-    if (!id || id==&quot;&quot;)  continue;</span>
<a href="#l24.631"></a><span id="l24.631" class="difflineminus">-</span>
<a href="#l24.632"></a><span id="l24.632" class="difflineminus">-    if (id == containerID)</span>
<a href="#l24.633"></a><span id="l24.633" class="difflineminus">-    {</span>
<a href="#l24.634"></a><span id="l24.634" class="difflineminus">-      listbox.selectItem(node);</span>
<a href="#l24.635"></a><span id="l24.635" class="difflineminus">-      break;</span>
<a href="#l24.636"></a><span id="l24.636" class="difflineminus">-    }</span>
<a href="#l24.637"></a><span id="l24.637" class="difflineminus">-  }</span>
<a href="#l24.638"></a><span id="l24.638" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1">deleted file mode 100644</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineminus">--- a/suite/common/search/search-editor.xul</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineplus">+++ /dev/null</span>
<a href="#l25.4"></a><span id="l25.4" class="difflineat">@@ -1,152 +0,0 @@</span>
<a href="#l25.5"></a><span id="l25.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt; &lt;!-- -*- Mode: SGML; indent-tabs-mode: nil; -*- --&gt;</span>
<a href="#l25.6"></a><span id="l25.6" class="difflineminus">-&lt;!--</span>
<a href="#l25.7"></a><span id="l25.7" class="difflineminus">-</span>
<a href="#l25.8"></a><span id="l25.8" class="difflineminus">- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l25.9"></a><span id="l25.9" class="difflineminus">- Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l25.10"></a><span id="l25.10" class="difflineminus">-</span>
<a href="#l25.11"></a><span id="l25.11" class="difflineminus">- The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">- 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">- the License. You may obtain a copy of the License at</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">- http://www.mozilla.org/MPL/</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineminus">- Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineminus">- WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineminus">- for the specific language governing rights and limitations under the</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineminus">- License.</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineminus">-</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineminus">- The Original Code is mozilla.org code.</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineminus">-</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineminus">- The Initial Developer of the Original Code is</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineminus">- Netscape Communications Corporation.</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineminus">- Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineminus">- the Initial Developer. All Rights Reserved.</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineminus">-</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineminus">- Contributor(s):</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineminus">-</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineminus">- Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">- either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">- or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineminus">- in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineminus">- of those above. If you wish to allow use of your version of this file only</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineminus">- under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineminus">- use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineminus">- decision by deleting the provisions above and replace them with the notice</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineminus">- and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineminus">- the provisions above, a recipient may use your version of this file under</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineminus">- the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineminus">-</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineminus">- ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineminus">-</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/search/search.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/search/search-editor.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineminus">-</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineminus">-&lt;!DOCTYPE dialog SYSTEM &quot;chrome://communicator/locale/search/search-editor.dtd&quot;&gt;</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineminus">-</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineminus">-&lt;dialog title=&quot;&amp;window.title.label;&quot; id=&quot;search-editor-window&quot;</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineminus">-        xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l25.52"></a><span id="l25.52" class="difflineminus">-        xmlns:web=&quot;http://home.netscape.com/WEB-rdf#&quot;</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineminus">-        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineminus">-        width=&quot;540&quot; height=&quot;340&quot; x=&quot;20&quot; y=&quot;20&quot; persist=&quot;width height x y&quot;</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineminus">-        windowtype=&quot;internetsearch:editor&quot;</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineminus">-        onload=&quot;doLoad()&quot; onunload=&quot;doUnload()&quot;</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineminus">-        buttons=&quot;accept&quot;</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineminus">-        ondialogaccept=&quot;return Commit();&quot;&gt;</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineminus">-</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/search/search-editor.js&quot;/&gt;</span>
<a href="#l25.61"></a><span id="l25.61" class="difflineminus">-</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineminus">-  &lt;stringbundle id=&quot;searchBundle&quot;</span>
<a href="#l25.63"></a><span id="l25.63" class="difflineminus">-                src=&quot;chrome://communicator/locale/search/search-editor.properties&quot;/&gt;</span>
<a href="#l25.64"></a><span id="l25.64" class="difflineminus">-</span>
<a href="#l25.65"></a><span id="l25.65" class="difflineminus">-  &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l25.66"></a><span id="l25.66" class="difflineminus">-  </span>
<a href="#l25.67"></a><span id="l25.67" class="difflineminus">-    &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineminus">-      &lt;listbox id=&quot;allengines&quot; seltype=&quot;multiple&quot; flex=&quot;1&quot;</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineminus">-               datasources=&quot;rdf:internetsearch&quot; ref=&quot;NC:SearchEngineRoot&quot;&gt;</span>
<a href="#l25.70"></a><span id="l25.70" class="difflineminus">-        &lt;listhead&gt;</span>
<a href="#l25.71"></a><span id="l25.71" class="difflineminus">-          &lt;listheader id=&quot;NameColumn&quot; sortable=&quot;true&quot;</span>
<a href="#l25.72"></a><span id="l25.72" class="difflineminus">-                      label=&quot;&amp;allengines.label;&quot; flex=&quot;1&quot;</span>
<a href="#l25.73"></a><span id="l25.73" class="difflineminus">-                      resource=&quot;http://home.netscape.com/NC-rdf#Name&quot;</span>
<a href="#l25.74"></a><span id="l25.74" class="difflineminus">-                      sortActive=&quot;true&quot; sortDirection=&quot;ascending&quot;</span>
<a href="#l25.75"></a><span id="l25.75" class="difflineminus">-                      onclick=&quot;return doSort('NameColumn', null);&quot; /&gt;</span>
<a href="#l25.76"></a><span id="l25.76" class="difflineminus">-        &lt;/listhead&gt;</span>
<a href="#l25.77"></a><span id="l25.77" class="difflineminus">-</span>
<a href="#l25.78"></a><span id="l25.78" class="difflineminus">-        &lt;template&gt;</span>
<a href="#l25.79"></a><span id="l25.79" class="difflineminus">-          &lt;listitem uri=&quot;...&quot; class=&quot;listitem-iconic&quot; </span>
<a href="#l25.80"></a><span id="l25.80" class="difflineminus">-                    loading=&quot;rdf:http://home.netscape.com/NC-rdf#loading&quot;</span>
<a href="#l25.81"></a><span id="l25.81" class="difflineminus">-                    image=&quot;rdf:http://home.netscape.com/NC-rdf#Icon&quot;</span>
<a href="#l25.82"></a><span id="l25.82" class="difflineminus">-                    label=&quot;rdf:http://home.netscape.com/NC-rdf#Name&quot;/&gt;</span>
<a href="#l25.83"></a><span id="l25.83" class="difflineminus">-        &lt;/template&gt;</span>
<a href="#l25.84"></a><span id="l25.84" class="difflineminus">-    </span>
<a href="#l25.85"></a><span id="l25.85" class="difflineminus">-      &lt;/listbox&gt;</span>
<a href="#l25.86"></a><span id="l25.86" class="difflineminus">-      </span>
<a href="#l25.87"></a><span id="l25.87" class="difflineminus">-      &lt;hbox&gt;</span>
<a href="#l25.88"></a><span id="l25.88" class="difflineminus">-        &lt;button id=&quot;add-button&quot; oncommand=&quot;return AddEngine()&quot;</span>
<a href="#l25.89"></a><span id="l25.89" class="difflineminus">-                label=&quot;&amp;add.label;&quot; accesskey=&quot;&amp;add.accesskey;&quot;/&gt;</span>
<a href="#l25.90"></a><span id="l25.90" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l25.91"></a><span id="l25.91" class="difflineminus">-    &lt;/vbox&gt;</span>
<a href="#l25.92"></a><span id="l25.92" class="difflineminus">-    </span>
<a href="#l25.93"></a><span id="l25.93" class="difflineminus">-    &lt;separator class=&quot;groove&quot; orient=&quot;vertical&quot; style=&quot;width: 0px;&quot;/&gt;</span>
<a href="#l25.94"></a><span id="l25.94" class="difflineminus">-        </span>
<a href="#l25.95"></a><span id="l25.95" class="difflineminus">-    &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l25.96"></a><span id="l25.96" class="difflineminus">-      &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l25.97"></a><span id="l25.97" class="difflineminus">-        &lt;label value=&quot;&amp;category.label;&quot; accesskey=&quot;&amp;category.accesskey;&quot; control=&quot;categoryList&quot;/&gt;</span>
<a href="#l25.98"></a><span id="l25.98" class="difflineminus">-        &lt;menulist id=&quot;categoryList&quot; ref=&quot;NC:SearchCategoryRoot&quot; datasources=&quot;rdf:null&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l25.99"></a><span id="l25.99" class="difflineminus">-          &lt;template&gt;</span>
<a href="#l25.100"></a><span id="l25.100" class="difflineminus">-            &lt;menupopup&gt;</span>
<a href="#l25.101"></a><span id="l25.101" class="difflineminus">-              &lt;menuitem uri=&quot;rdf:*&quot; oncommand=&quot;return chooseCategory(this);&quot;</span>
<a href="#l25.102"></a><span id="l25.102" class="difflineminus">-                        value=&quot;rdf:http://home.netscape.com/NC-rdf#category&quot;</span>
<a href="#l25.103"></a><span id="l25.103" class="difflineminus">-                        label=&quot;rdf:http://home.netscape.com/NC-rdf#title&quot;/&gt;</span>
<a href="#l25.104"></a><span id="l25.104" class="difflineminus">-            &lt;/menupopup&gt;</span>
<a href="#l25.105"></a><span id="l25.105" class="difflineminus">-          &lt;/template&gt;</span>
<a href="#l25.106"></a><span id="l25.106" class="difflineminus">-          &lt;menupopup id=&quot;categoryPopup&quot;/&gt;</span>
<a href="#l25.107"></a><span id="l25.107" class="difflineminus">-        &lt;/menulist&gt;</span>
<a href="#l25.108"></a><span id="l25.108" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l25.109"></a><span id="l25.109" class="difflineminus">-      </span>
<a href="#l25.110"></a><span id="l25.110" class="difflineminus">-      &lt;hbox&gt;</span>
<a href="#l25.111"></a><span id="l25.111" class="difflineminus">-        &lt;button id=&quot;new-category-button&quot; oncommand=&quot;NewCategory()&quot;</span>
<a href="#l25.112"></a><span id="l25.112" class="difflineminus">-                label=&quot;&amp;new.category.label;&quot; accesskey=&quot;&amp;new.category.accesskey;&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l25.113"></a><span id="l25.113" class="difflineminus">-        &lt;button id=&quot;rename-category-button&quot; oncommand=&quot;RenameCategory()&quot;</span>
<a href="#l25.114"></a><span id="l25.114" class="difflineminus">-                label=&quot;&amp;rename.category.label;&quot; accesskey=&quot;&amp;rename.category.accesskey;&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l25.115"></a><span id="l25.115" class="difflineminus">-        &lt;button id=&quot;remove-category.buttom&quot; oncommand=&quot;RemoveCategory()&quot;</span>
<a href="#l25.116"></a><span id="l25.116" class="difflineminus">-                label=&quot;&amp;remove.category.label;&quot; accesskey=&quot;&amp;remove.category.accesskey;&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l25.117"></a><span id="l25.117" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l25.118"></a><span id="l25.118" class="difflineminus">-      </span>
<a href="#l25.119"></a><span id="l25.119" class="difflineminus">-      &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l25.120"></a><span id="l25.120" class="difflineminus">-</span>
<a href="#l25.121"></a><span id="l25.121" class="difflineminus">-      &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l25.122"></a><span id="l25.122" class="difflineminus">-        &lt;listbox id=&quot;engineList&quot; seltype=&quot;multiple&quot; flex=&quot;1&quot;</span>
<a href="#l25.123"></a><span id="l25.123" class="difflineminus">-                 style=&quot;height: 0px;&quot;</span>
<a href="#l25.124"></a><span id="l25.124" class="difflineminus">-                 datasources=&quot;rdf:internetsearch&quot;</span>
<a href="#l25.125"></a><span id="l25.125" class="difflineminus">-                 onselect=&quot;doMoveDirectionEnabling()&quot;&gt;</span>
<a href="#l25.126"></a><span id="l25.126" class="difflineminus">-          &lt;listhead&gt;</span>
<a href="#l25.127"></a><span id="l25.127" class="difflineminus">-            &lt;listheader id=&quot;EngineColumn&quot; sortable=&quot;true&quot;</span>
<a href="#l25.128"></a><span id="l25.128" class="difflineminus">-                        label=&quot;&amp;engine.column.label;&quot; flex=&quot;1&quot;</span>
<a href="#l25.129"></a><span id="l25.129" class="difflineminus">-                        onclick=&quot;return doSort('EngineColumn', null);&quot;</span>
<a href="#l25.130"></a><span id="l25.130" class="difflineminus">-                        resource=&quot;http://home.netscape.com/NC-rdf#Name&quot;/&gt;</span>
<a href="#l25.131"></a><span id="l25.131" class="difflineminus">-          &lt;/listhead&gt;</span>
<a href="#l25.132"></a><span id="l25.132" class="difflineminus">-</span>
<a href="#l25.133"></a><span id="l25.133" class="difflineminus">-          &lt;template&gt;</span>
<a href="#l25.134"></a><span id="l25.134" class="difflineminus">-            &lt;listitem uri=&quot;...&quot; class=&quot;listitem-iconic&quot;</span>
<a href="#l25.135"></a><span id="l25.135" class="difflineminus">-                      image=&quot;rdf:http://home.netscape.com/NC-rdf#Icon&quot;</span>
<a href="#l25.136"></a><span id="l25.136" class="difflineminus">-                      label=&quot;rdf:http://home.netscape.com/NC-rdf#Name&quot;/&gt;</span>
<a href="#l25.137"></a><span id="l25.137" class="difflineminus">-          &lt;/template&gt;</span>
<a href="#l25.138"></a><span id="l25.138" class="difflineminus">-          </span>
<a href="#l25.139"></a><span id="l25.139" class="difflineminus">-        &lt;/listbox&gt;</span>
<a href="#l25.140"></a><span id="l25.140" class="difflineminus">-</span>
<a href="#l25.141"></a><span id="l25.141" class="difflineminus">-        &lt;vbox&gt;</span>
<a href="#l25.142"></a><span id="l25.142" class="difflineminus">-          &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l25.143"></a><span id="l25.143" class="difflineminus">-          &lt;button class=&quot;up&quot; oncommand=&quot;MoveUp();&quot; id=&quot;up&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l25.144"></a><span id="l25.144" class="difflineminus">-          &lt;button class=&quot;down&quot; oncommand=&quot;MoveDown();&quot; id=&quot;down&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l25.145"></a><span id="l25.145" class="difflineminus">-          &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l25.146"></a><span id="l25.146" class="difflineminus">-        &lt;/vbox&gt;</span>
<a href="#l25.147"></a><span id="l25.147" class="difflineminus">-      &lt;/hbox&gt;          </span>
<a href="#l25.148"></a><span id="l25.148" class="difflineminus">-      &lt;hbox&gt;</span>
<a href="#l25.149"></a><span id="l25.149" class="difflineminus">-        &lt;button id=&quot;remove-button&quot; oncommand=&quot;return RemoveEngine()&quot;</span>
<a href="#l25.150"></a><span id="l25.150" class="difflineminus">-                label=&quot;&amp;remove.label;&quot; accesskey=&quot;&amp;remove.accesskey;&quot;/&gt;</span>
<a href="#l25.151"></a><span id="l25.151" class="difflineminus">-      &lt;/hbox&gt;    </span>
<a href="#l25.152"></a><span id="l25.152" class="difflineminus">-      </span>
<a href="#l25.153"></a><span id="l25.153" class="difflineminus">-    &lt;/vbox&gt;</span>
<a href="#l25.154"></a><span id="l25.154" class="difflineminus">-  </span>
<a href="#l25.155"></a><span id="l25.155" class="difflineminus">-  &lt;/hbox&gt;</span>
<a href="#l25.156"></a><span id="l25.156" class="difflineminus">-&lt;/dialog&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/suite/common/search/search-panel.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/suite/common/search/search-panel.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -1,1146 +1,93 @@</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineminus">-/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l26.5"></a><span id="l26.5"> /* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l26.6"></a><span id="l26.6">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l26.7"></a><span id="l26.7">  *</span>
<a href="#l26.8"></a><span id="l26.8">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l26.9"></a><span id="l26.9">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l26.10"></a><span id="l26.10">  * the License. You may obtain a copy of the License at</span>
<a href="#l26.11"></a><span id="l26.11">  * http://www.mozilla.org/MPL/</span>
<a href="#l26.12"></a><span id="l26.12">  *</span>
<a href="#l26.13"></a><span id="l26.13">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l26.14"></a><span id="l26.14">  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l26.15"></a><span id="l26.15">  * for the specific language governing rights and limitations under the</span>
<a href="#l26.16"></a><span id="l26.16">  * License.</span>
<a href="#l26.17"></a><span id="l26.17">  *</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+ * The Original Code is SeaMonkey search panel.</span>
<a href="#l26.20"></a><span id="l26.20">  *</span>
<a href="#l26.21"></a><span id="l26.21">  * The Initial Developer of the Original Code is</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineplus">+ * the Mozilla Foundation.</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2010</span>
<a href="#l26.26"></a><span id="l26.26">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l26.27"></a><span id="l26.27">  *</span>
<a href="#l26.28"></a><span id="l26.28">  * Contributor(s):</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineminus">- *   Robert John Churchill   &lt;rjc@netscape.com&gt; (Original Author)</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">- *   Peter Annema            &lt;disttsc@bart.nl&gt;</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">- *   Blake Ross              &lt;blakeross@telocity.com&gt;</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">- *   Ben Goodger             &lt;ben@netscape.com&gt;</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">- *   Rob Ginda               &lt;rginda@netscape.com&gt;</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineminus">- *   Steve Lamm              &lt;slamm@netscape.com&gt;</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">- *   Samir Gehani            &lt;sgehani@netscape.com&gt;</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+ *   Robert Kaiser &lt;kairo@kairo.at&gt;</span>
<a href="#l26.37"></a><span id="l26.37">  *</span>
<a href="#l26.38"></a><span id="l26.38">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l26.39"></a><span id="l26.39">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l26.40"></a><span id="l26.40">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l26.41"></a><span id="l26.41">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l26.42"></a><span id="l26.42">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l26.43"></a><span id="l26.43">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l26.44"></a><span id="l26.44">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l26.45"></a><span id="l26.45">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l26.46"></a><span id="l26.46">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l26.47"></a><span id="l26.47">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l26.48"></a><span id="l26.48">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l26.49"></a><span id="l26.49">  *</span>
<a href="#l26.50"></a><span id="l26.50">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l26.51"></a><span id="l26.51"> </span>
<a href="#l26.52"></a><span id="l26.52" class="difflineminus">-const ISEARCH_CONTRACTID       = &quot;@mozilla.org/rdf/datasource;1?name=internetsearch&quot;;</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineminus">-const RDFSERVICE_CONTRACTID    = &quot;@mozilla.org/rdf/rdf-service;1&quot;;</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineminus">-const BMARKS_CONTRACTID        = &quot;@mozilla.org/browser/bookmarks-service;1&quot;;</span>
<a href="#l26.55"></a><span id="l26.55" class="difflineminus">-</span>
<a href="#l26.56"></a><span id="l26.56" class="difflineminus">-const nsIRDFService            = Components.interfaces.nsIRDFService;</span>
<a href="#l26.57"></a><span id="l26.57" class="difflineminus">-const nsIRDFLiteral            = Components.interfaces.nsIRDFLiteral;</span>
<a href="#l26.58"></a><span id="l26.58" class="difflineminus">-const nsIRDFDataSource         = Components.interfaces.nsIRDFDataSource;</span>
<a href="#l26.59"></a><span id="l26.59" class="difflineminus">-const nsIRDFRemoteDataSource   = Components.interfaces.nsIRDFRemoteDataSource;</span>
<a href="#l26.60"></a><span id="l26.60" class="difflineminus">-const nsIInternetSearchService = Components.interfaces.nsIInternetSearchService;</span>
<a href="#l26.61"></a><span id="l26.61" class="difflineminus">-</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineminus">-const DEBUG = false;</span>
<a href="#l26.63"></a><span id="l26.63" class="difflineminus">-</span>
<a href="#l26.64"></a><span id="l26.64" class="difflineminus">-var debug;</span>
<a href="#l26.65"></a><span id="l26.65" class="difflineminus">-if (!DEBUG)</span>
<a href="#l26.66"></a><span id="l26.66" class="difflineminus">-{</span>
<a href="#l26.67"></a><span id="l26.67" class="difflineminus">-  debug = function(msg) {};</span>
<a href="#l26.68"></a><span id="l26.68" class="difflineminus">-}</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineminus">-else</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineminus">-{</span>
<a href="#l26.71"></a><span id="l26.71" class="difflineminus">-  debug = function(msg)</span>
<a href="#l26.72"></a><span id="l26.72" class="difflineminus">-  {</span>
<a href="#l26.73"></a><span id="l26.73" class="difflineminus">-    dump(&quot;\t ^^^ search-panel.js: &quot; + msg + &quot;\n&quot;);</span>
<a href="#l26.74"></a><span id="l26.74" class="difflineminus">-  };</span>
<a href="#l26.75"></a><span id="l26.75" class="difflineminus">-}</span>
<a href="#l26.76"></a><span id="l26.76" class="difflineminus">-</span>
<a href="#l26.77"></a><span id="l26.77" class="difflineminus">-var rootNode;</span>
<a href="#l26.78"></a><span id="l26.78" class="difflineminus">-var textArc;</span>
<a href="#l26.79"></a><span id="l26.79" class="difflineminus">-var modeArc;</span>
<a href="#l26.80"></a><span id="l26.80" class="difflineminus">-var searchBundle;</span>
<a href="#l26.81"></a><span id="l26.81" class="difflineminus">-var regionalBundle;</span>
<a href="#l26.82"></a><span id="l26.82" class="difflineminus">-var gSearchButtonText = null;</span>
<a href="#l26.83"></a><span id="l26.83" class="difflineminus">-var gStopButtonText = null;</span>
<a href="#l26.84"></a><span id="l26.84" class="difflineminus">-</span>
<a href="#l26.85"></a><span id="l26.85" class="difflineminus">-var sidebarInitiatedSearch = false;</span>
<a href="#l26.86"></a><span id="l26.86" class="difflineminus">-</span>
<a href="#l26.87"></a><span id="l26.87" class="difflineminus">-var RDF_observer =</span>
<a href="#l26.88"></a><span id="l26.88" class="difflineminus">-{</span>
<a href="#l26.89"></a><span id="l26.89" class="difflineminus">-  onAssert : function(ds, src, prop, target)</span>
<a href="#l26.90"></a><span id="l26.90" class="difflineminus">-  {</span>
<a href="#l26.91"></a><span id="l26.91" class="difflineminus">-    if (src == rootNode) {</span>
<a href="#l26.92"></a><span id="l26.92" class="difflineminus">-      if (prop == textArc)</span>
<a href="#l26.93"></a><span id="l26.93" class="difflineminus">-        rememberSearchText(target);</span>
<a href="#l26.94"></a><span id="l26.94" class="difflineminus">-      else if (prop == modeArc)</span>
<a href="#l26.95"></a><span id="l26.95" class="difflineminus">-        updateSearchMode();</span>
<a href="#l26.96"></a><span id="l26.96" class="difflineminus">-    }</span>
<a href="#l26.97"></a><span id="l26.97" class="difflineminus">-  },</span>
<a href="#l26.98"></a><span id="l26.98" class="difflineminus">-</span>
<a href="#l26.99"></a><span id="l26.99" class="difflineminus">-  onUnassert : function(ds, src, prop, target)</span>
<a href="#l26.100"></a><span id="l26.100" class="difflineminus">-  {</span>
<a href="#l26.101"></a><span id="l26.101" class="difflineminus">-  },</span>
<a href="#l26.102"></a><span id="l26.102" class="difflineminus">-</span>
<a href="#l26.103"></a><span id="l26.103" class="difflineminus">-  onChange : function(ds, src, prop, old_target, new_target)</span>
<a href="#l26.104"></a><span id="l26.104" class="difflineminus">-  {</span>
<a href="#l26.105"></a><span id="l26.105" class="difflineminus">-    if (src == rootNode) {</span>
<a href="#l26.106"></a><span id="l26.106" class="difflineminus">-      if (prop == textArc)</span>
<a href="#l26.107"></a><span id="l26.107" class="difflineminus">-        rememberSearchText(new_target);</span>
<a href="#l26.108"></a><span id="l26.108" class="difflineminus">-      else if (prop == modeArc)</span>
<a href="#l26.109"></a><span id="l26.109" class="difflineminus">-        updateSearchMode();</span>
<a href="#l26.110"></a><span id="l26.110" class="difflineminus">-    }</span>
<a href="#l26.111"></a><span id="l26.111" class="difflineminus">-  },</span>
<a href="#l26.112"></a><span id="l26.112" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l26.113"></a><span id="l26.113"> </span>
<a href="#l26.114"></a><span id="l26.114" class="difflineminus">-  onMove : function(ds, old_src, new_src, prop, target)</span>
<a href="#l26.115"></a><span id="l26.115" class="difflineminus">-  {</span>
<a href="#l26.116"></a><span id="l26.116" class="difflineminus">-  },</span>
<a href="#l26.117"></a><span id="l26.117" class="difflineminus">-</span>
<a href="#l26.118"></a><span id="l26.118" class="difflineminus">-  onBeginUpdateBatch : function(ds)</span>
<a href="#l26.119"></a><span id="l26.119" class="difflineminus">-  {</span>
<a href="#l26.120"></a><span id="l26.120" class="difflineminus">-  },</span>
<a href="#l26.121"></a><span id="l26.121" class="difflineminus">-</span>
<a href="#l26.122"></a><span id="l26.122" class="difflineminus">-  onEndUpdateBatch   : function(ds)</span>
<a href="#l26.123"></a><span id="l26.123" class="difflineminus">-  {</span>
<a href="#l26.124"></a><span id="l26.124" class="difflineminus">-  }</span>
<a href="#l26.125"></a><span id="l26.125" class="difflineminus">-}</span>
<a href="#l26.126"></a><span id="l26.126" class="difflineminus">-</span>
<a href="#l26.127"></a><span id="l26.127" class="difflineminus">-function rememberSearchText(target)</span>
<a href="#l26.128"></a><span id="l26.128" class="difflineminus">-{</span>
<a href="#l26.129"></a><span id="l26.129" class="difflineminus">-  if (sidebarInitiatedSearch) {</span>
<a href="#l26.130"></a><span id="l26.130" class="difflineminus">-    // this avoids updating the sidebar textbox twice</span>
<a href="#l26.131"></a><span id="l26.131" class="difflineminus">-    return;</span>
<a href="#l26.132"></a><span id="l26.132" class="difflineminus">-  }</span>
<a href="#l26.133"></a><span id="l26.133" class="difflineminus">-  if (target) {</span>
<a href="#l26.134"></a><span id="l26.134" class="difflineminus">-    target = target.QueryInterface(nsIRDFLiteral).Value;</span>
<a href="#l26.135"></a><span id="l26.135" class="difflineminus">-    if (target) {</span>
<a href="#l26.136"></a><span id="l26.136" class="difflineminus">-      // convert plusses (+) back to spaces</span>
<a href="#l26.137"></a><span id="l26.137" class="difflineminus">-      target = target.replace(/\+/g, &quot; &quot;);</span>
<a href="#l26.138"></a><span id="l26.138" class="difflineminus">-      var textNode = document.getElementById(&quot;sidebar-search-text&quot;);</span>
<a href="#l26.139"></a><span id="l26.139" class="difflineminus">-</span>
<a href="#l26.140"></a><span id="l26.140" class="difflineminus">-      if (target != textNode.value) {</span>
<a href="#l26.141"></a><span id="l26.141" class="difflineminus">-        // category is unknown, therefore use &quot;All Engines&quot;</span>
<a href="#l26.142"></a><span id="l26.142" class="difflineminus">-        var categoryPopup = document.getElementById( &quot;categoryPopup&quot; );</span>
<a href="#l26.143"></a><span id="l26.143" class="difflineminus">-        var categoryList = document.getElementById( &quot;categoryList&quot; );</span>
<a href="#l26.144"></a><span id="l26.144" class="difflineminus">-        if (categoryPopup &amp;&amp; categoryList) {</span>
<a href="#l26.145"></a><span id="l26.145" class="difflineminus">-          categoryList.selectedItem = categoryPopup.childNodes[0];</span>
<a href="#l26.146"></a><span id="l26.146" class="difflineminus">-        }</span>
<a href="#l26.147"></a><span id="l26.147" class="difflineminus">-      }</span>
<a href="#l26.148"></a><span id="l26.148" class="difflineminus">-</span>
<a href="#l26.149"></a><span id="l26.149" class="difflineminus">-      textNode.value = decodeURIComponent(target);</span>
<a href="#l26.150"></a><span id="l26.150" class="difflineminus">-      doEnabling();</span>
<a href="#l26.151"></a><span id="l26.151" class="difflineminus">-    }</span>
<a href="#l26.152"></a><span id="l26.152" class="difflineminus">-  }</span>
<a href="#l26.153"></a><span id="l26.153" class="difflineminus">-  // show the results tab</span>
<a href="#l26.154"></a><span id="l26.154" class="difflineminus">-  switchTab(0);</span>
<a href="#l26.155"></a><span id="l26.155" class="difflineminus">-}</span>
<a href="#l26.156"></a><span id="l26.156" class="difflineminus">-</span>
<a href="#l26.157"></a><span id="l26.157" class="difflineminus">-function getIndexToSelect(haveDefault, defaultEngine, enginePopup)</span>
<a href="#l26.158"></a><span id="l26.158" class="difflineminus">-{</span>
<a href="#l26.159"></a><span id="l26.159" class="difflineminus">-  if (haveDefault)</span>
<a href="#l26.160"></a><span id="l26.160" class="difflineminus">-  {</span>
<a href="#l26.161"></a><span id="l26.161" class="difflineminus">-    // iterate over constrained engine list for a default engine match</span>
<a href="#l26.162"></a><span id="l26.162" class="difflineminus">-    for (var i = 0; i &lt; enginePopup.childNodes.length; ++i)</span>
<a href="#l26.163"></a><span id="l26.163" class="difflineminus">-    {</span>
<a href="#l26.164"></a><span id="l26.164" class="difflineminus">-      if (enginePopup.childNodes[i].id == defaultEngine)</span>
<a href="#l26.165"></a><span id="l26.165" class="difflineminus">-      {</span>
<a href="#l26.166"></a><span id="l26.166" class="difflineminus">-        // found match with default engine!</span>
<a href="#l26.167"></a><span id="l26.167" class="difflineminus">-        return i;</span>
<a href="#l26.168"></a><span id="l26.168" class="difflineminus">-      }</span>
<a href="#l26.169"></a><span id="l26.169" class="difflineminus">-    }</span>
<a href="#l26.170"></a><span id="l26.170" class="difflineminus">-  }</span>
<a href="#l26.171"></a><span id="l26.171" class="difflineminus">-</span>
<a href="#l26.172"></a><span id="l26.172" class="difflineminus">-  return 0; // default to first engine at index '0'</span>
<a href="#l26.173"></a><span id="l26.173" class="difflineminus">-}</span>
<a href="#l26.174"></a><span id="l26.174" class="difflineplus">+const kXULNS = &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;;</span>
<a href="#l26.175"></a><span id="l26.175" class="difflineplus">+const SEARCH_ENGINE_TOPIC = &quot;browser-search-engine-modified&quot;;</span>
<a href="#l26.176"></a><span id="l26.176" class="difflineplus">+var menulist, textbox;</span>
<a href="#l26.177"></a><span id="l26.177"> </span>
<a href="#l26.178"></a><span id="l26.178" class="difflineminus">-function getMinVer()</span>
<a href="#l26.179"></a><span id="l26.179" class="difflineminus">-{</span>
<a href="#l26.180"></a><span id="l26.180" class="difflineminus">-  var minVerStr = nsPreferences.</span>
<a href="#l26.181"></a><span id="l26.181" class="difflineminus">-    copyUnicharPref(&quot;browser.search.basic.min_ver&quot;);</span>
<a href="#l26.182"></a><span id="l26.182" class="difflineminus">-  var minVer = parseFloat(minVerStr);</span>
<a href="#l26.183"></a><span id="l26.183" class="difflineminus">-  if (isNaN(minVer))</span>
<a href="#l26.184"></a><span id="l26.184" class="difflineminus">-    minVer = 0; // no pref or not a number so default to min ver 0.0</span>
<a href="#l26.185"></a><span id="l26.185" class="difflineminus">-</span>
<a href="#l26.186"></a><span id="l26.186" class="difflineminus">-  debug(&quot;Float value of minVer = &quot; + minVer);</span>
<a href="#l26.187"></a><span id="l26.187" class="difflineminus">-  return minVer;</span>
<a href="#l26.188"></a><span id="l26.188" class="difflineminus">-}</span>
<a href="#l26.189"></a><span id="l26.189" class="difflineminus">-</span>
<a href="#l26.190"></a><span id="l26.190" class="difflineminus">-/** </span>
<a href="#l26.191"></a><span id="l26.191" class="difflineminus">- * Constrain the list of engines to only those that</span>
<a href="#l26.192"></a><span id="l26.192" class="difflineminus">- * contain ver &gt;= browser.search.basic.min_ver pref </span>
<a href="#l26.193"></a><span id="l26.193" class="difflineminus">- * value to be displayed in the basic popup list of </span>
<a href="#l26.194"></a><span id="l26.194" class="difflineminus">- * engines.</span>
<a href="#l26.195"></a><span id="l26.195" class="difflineminus">- */</span>
<a href="#l26.196"></a><span id="l26.196" class="difflineminus">-function constrainBasicList()</span>
<a href="#l26.197"></a><span id="l26.197" class="difflineminus">-{</span>
<a href="#l26.198"></a><span id="l26.198" class="difflineminus">-  debug(&quot;constrainBasicList&quot;);</span>
<a href="#l26.199"></a><span id="l26.199" class="difflineminus">-</span>
<a href="#l26.200"></a><span id="l26.200" class="difflineminus">-  var basicEngineMenu = document.getElementById(&quot;basicEngineMenu&quot;);</span>
<a href="#l26.201"></a><span id="l26.201" class="difflineminus">-  if (!basicEngineMenu)</span>
<a href="#l26.202"></a><span id="l26.202" class="difflineminus">-  {</span>
<a href="#l26.203"></a><span id="l26.203" class="difflineminus">-    debug(&quot;Ack!  basicEngineList is empty!&quot;);</span>
<a href="#l26.204"></a><span id="l26.204" class="difflineminus">-    return;</span>
<a href="#l26.205"></a><span id="l26.205" class="difflineminus">-  }</span>
<a href="#l26.206"></a><span id="l26.206" class="difflineminus">-</span>
<a href="#l26.207"></a><span id="l26.207" class="difflineminus">-  var basicEngines = basicEngineMenu.childNodes[1];</span>
<a href="#l26.208"></a><span id="l26.208" class="difflineminus">-  var len = basicEngines.childNodes.length;</span>
<a href="#l26.209"></a><span id="l26.209" class="difflineminus">-  var currDesc;</span>
<a href="#l26.210"></a><span id="l26.210" class="difflineminus">-  var currVer;</span>
<a href="#l26.211"></a><span id="l26.211" class="difflineminus">-  var haveDefault = false;</span>
<a href="#l26.212"></a><span id="l26.212" class="difflineminus">-</span>
<a href="#l26.213"></a><span id="l26.213" class="difflineminus">-  debug(&quot;Found &quot; + len + &quot; sherlock plugins.&quot;);</span>
<a href="#l26.214"></a><span id="l26.214" class="difflineminus">-  var defaultEngine = nsPreferences.</span>
<a href="#l26.215"></a><span id="l26.215" class="difflineminus">-    copyUnicharPref(&quot;browser.search.defaultengine&quot;);</span>
<a href="#l26.216"></a><span id="l26.216" class="difflineminus">-</span>
<a href="#l26.217"></a><span id="l26.217" class="difflineminus">-  // we constrain the basic list to all engines with ver &gt;= minVer</span>
<a href="#l26.218"></a><span id="l26.218" class="difflineminus">-  var minVer = getMinVer();</span>
<a href="#l26.219"></a><span id="l26.219" class="difflineminus">-</span>
<a href="#l26.220"></a><span id="l26.220" class="difflineminus">-  for (var i = 0; i &lt; len; ++i)</span>
<a href="#l26.221"></a><span id="l26.221" class="difflineminus">-  {</span>
<a href="#l26.222"></a><span id="l26.222" class="difflineminus">-    currDesc = basicEngines.childNodes[i].getAttribute(&quot;desc&quot;);</span>
<a href="#l26.223"></a><span id="l26.223" class="difflineminus">-    debug(&quot;Engine[&quot; + i + &quot;] = &quot; + currDesc);</span>
<a href="#l26.224"></a><span id="l26.224" class="difflineplus">+function Startup() {</span>
<a href="#l26.225"></a><span id="l26.225" class="difflineplus">+  menulist = document.getElementById(&quot;sidebar-search-engines&quot;);</span>
<a href="#l26.226"></a><span id="l26.226" class="difflineplus">+  textbox = document.getElementById(&quot;sidebar-search-text&quot;);</span>
<a href="#l26.227"></a><span id="l26.227"> </span>
<a href="#l26.228"></a><span id="l26.228" class="difflineminus">-    // make sure we leave the default engine (check if we already have </span>
<a href="#l26.229"></a><span id="l26.229" class="difflineminus">-    // the default to avoid duplicates)</span>
<a href="#l26.230"></a><span id="l26.230" class="difflineminus">-    if (basicEngines.childNodes[i].id == defaultEngine &amp;&amp; !haveDefault)</span>
<a href="#l26.231"></a><span id="l26.231" class="difflineminus">-    {</span>
<a href="#l26.232"></a><span id="l26.232" class="difflineminus">-      haveDefault = true;</span>
<a href="#l26.233"></a><span id="l26.233" class="difflineminus">-    }</span>
<a href="#l26.234"></a><span id="l26.234" class="difflineminus">-    else</span>
<a href="#l26.235"></a><span id="l26.235" class="difflineminus">-    {</span>
<a href="#l26.236"></a><span id="l26.236" class="difflineminus">-      // remove if not a basic engine</span>
<a href="#l26.237"></a><span id="l26.237" class="difflineminus">-      currVer = basicEngines.childNodes[i].getAttribute(&quot;ver&quot;);</span>
<a href="#l26.238"></a><span id="l26.238" class="difflineminus">-      if (!currVer || isNaN(parseFloat(currVer)))</span>
<a href="#l26.239"></a><span id="l26.239" class="difflineminus">-      {</span>
<a href="#l26.240"></a><span id="l26.240" class="difflineminus">-        // missing version attr or not a number: default to ver 1.0</span>
<a href="#l26.241"></a><span id="l26.241" class="difflineminus">-        currVer = 1;</span>
<a href="#l26.242"></a><span id="l26.242" class="difflineminus">-      }</span>
<a href="#l26.243"></a><span id="l26.243" class="difflineminus">-      debug(&quot;Version of &quot; + (currDesc ? currDesc : &quot;&lt;unknown&gt;&quot;) + </span>
<a href="#l26.244"></a><span id="l26.244" class="difflineminus">-            &quot; is: &quot; + currVer);</span>
<a href="#l26.245"></a><span id="l26.245" class="difflineminus">-</span>
<a href="#l26.246"></a><span id="l26.246" class="difflineminus">-      if (parseFloat(currVer) &lt; minVer)</span>
<a href="#l26.247"></a><span id="l26.247" class="difflineminus">-      {</span>
<a href="#l26.248"></a><span id="l26.248" class="difflineminus">-        try</span>
<a href="#l26.249"></a><span id="l26.249" class="difflineminus">-        {</span>
<a href="#l26.250"></a><span id="l26.250" class="difflineminus">-          basicEngines.removeChild(basicEngines.childNodes[i]);</span>
<a href="#l26.251"></a><span id="l26.251" class="difflineminus">-          --i;</span>
<a href="#l26.252"></a><span id="l26.252" class="difflineminus">-          --len;</span>
<a href="#l26.253"></a><span id="l26.253" class="difflineminus">-        }</span>
<a href="#l26.254"></a><span id="l26.254" class="difflineminus">-        catch (ex)</span>
<a href="#l26.255"></a><span id="l26.255" class="difflineminus">-        {</span>
<a href="#l26.256"></a><span id="l26.256" class="difflineminus">-          debug(&quot;Exception: Couldn't remove &quot; + currDesc +</span>
<a href="#l26.257"></a><span id="l26.257" class="difflineminus">-                &quot; from engine list!&quot;);</span>
<a href="#l26.258"></a><span id="l26.258" class="difflineminus">-        }</span>
<a href="#l26.259"></a><span id="l26.259" class="difflineminus">-      }</span>
<a href="#l26.260"></a><span id="l26.260" class="difflineminus">-    }</span>
<a href="#l26.261"></a><span id="l26.261" class="difflineminus">-  }</span>
<a href="#l26.262"></a><span id="l26.262" class="difflineminus">-</span>
<a href="#l26.263"></a><span id="l26.263" class="difflineminus">-  // mark selected engine</span>
<a href="#l26.264"></a><span id="l26.264" class="difflineminus">-  var selected = getIndexToSelect(haveDefault, defaultEngine, basicEngines);</span>
<a href="#l26.265"></a><span id="l26.265" class="difflineminus">-  basicEngineMenu.selectedItem = basicEngines.childNodes[selected];</span>
<a href="#l26.266"></a><span id="l26.266" class="difflineminus">-}</span>
<a href="#l26.267"></a><span id="l26.267" class="difflineminus">-</span>
<a href="#l26.268"></a><span id="l26.268" class="difflineminus">-function updateSearchMode()</span>
<a href="#l26.269"></a><span id="l26.269" class="difflineminus">-{</span>
<a href="#l26.270"></a><span id="l26.270" class="difflineminus">-  debug(&quot;updateSearchMode&quot;);</span>
<a href="#l26.271"></a><span id="l26.271" class="difflineminus">-</span>
<a href="#l26.272"></a><span id="l26.272" class="difflineminus">-  var searchMode = nsPreferences.getIntPref(&quot;browser.search.mode&quot;);</span>
<a href="#l26.273"></a><span id="l26.273" class="difflineminus">-  var categoryBox = document.getElementById(&quot;categoryBox&quot;);</span>
<a href="#l26.274"></a><span id="l26.274" class="difflineminus">-  var basicBox = document.getElementById(&quot;basicBox&quot;);</span>
<a href="#l26.275"></a><span id="l26.275" class="difflineminus">-</span>
<a href="#l26.276"></a><span id="l26.276" class="difflineminus">-  debug(&quot;search mode is &quot; + searchMode);</span>
<a href="#l26.277"></a><span id="l26.277" class="difflineminus">-  if (searchMode == 0)</span>
<a href="#l26.278"></a><span id="l26.278" class="difflineminus">-  {</span>
<a href="#l26.279"></a><span id="l26.279" class="difflineminus">-    categoryBox.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l26.280"></a><span id="l26.280" class="difflineminus">-    basicBox.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l26.281"></a><span id="l26.281" class="difflineminus">-    switchTab(0);</span>
<a href="#l26.282"></a><span id="l26.282" class="difflineminus">-</span>
<a href="#l26.283"></a><span id="l26.283" class="difflineminus">-    constrainBasicList();</span>
<a href="#l26.284"></a><span id="l26.284" class="difflineminus">-  }</span>
<a href="#l26.285"></a><span id="l26.285" class="difflineminus">-  else</span>
<a href="#l26.286"></a><span id="l26.286" class="difflineminus">-  {</span>
<a href="#l26.287"></a><span id="l26.287" class="difflineminus">-    categoryBox.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l26.288"></a><span id="l26.288" class="difflineminus">-    basicBox.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l26.289"></a><span id="l26.289" class="difflineminus">-    switchTab(1);</span>
<a href="#l26.290"></a><span id="l26.290" class="difflineminus">-  }</span>
<a href="#l26.291"></a><span id="l26.291" class="difflineminus">-</span>
<a href="#l26.292"></a><span id="l26.292" class="difflineminus">-  return searchMode;</span>
<a href="#l26.293"></a><span id="l26.293" class="difflineminus">-}</span>
<a href="#l26.294"></a><span id="l26.294" class="difflineminus">-</span>
<a href="#l26.295"></a><span id="l26.295" class="difflineminus">-function readRDFString(aDS,aRes,aProp) {</span>
<a href="#l26.296"></a><span id="l26.296" class="difflineminus">-  var n = aDS.GetTarget(aRes, aProp, true);</span>
<a href="#l26.297"></a><span id="l26.297" class="difflineminus">-  if (n)</span>
<a href="#l26.298"></a><span id="l26.298" class="difflineminus">-    return n.QueryInterface(Components.interfaces.nsIRDFLiteral).Value;</span>
<a href="#l26.299"></a><span id="l26.299" class="difflineminus">-  return null;</span>
<a href="#l26.300"></a><span id="l26.300" class="difflineminus">-}</span>
<a href="#l26.301"></a><span id="l26.301" class="difflineminus">-</span>
<a href="#l26.302"></a><span id="l26.302" class="difflineplus">+  // Make sure the popup is empty.</span>
<a href="#l26.303"></a><span id="l26.303" class="difflineplus">+  menulist.removeAllItems();</span>
<a href="#l26.304"></a><span id="l26.304"> </span>
<a href="#l26.305"></a><span id="l26.305" class="difflineminus">-function ensureDefaultEnginePrefs(aRDF,aDS) </span>
<a href="#l26.306"></a><span id="l26.306" class="difflineminus">-{</span>
<a href="#l26.307"></a><span id="l26.307" class="difflineminus">-  var prefbranch = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l26.308"></a><span id="l26.308" class="difflineminus">-                             .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l26.309"></a><span id="l26.309" class="difflineminus">-  var defaultName = prefbranch.getComplexValue(&quot;browser.search.defaultenginename&quot;,</span>
<a href="#l26.310"></a><span id="l26.310" class="difflineminus">-                                               Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l26.311"></a><span id="l26.311" class="difflineminus">-  var kNC_Root = aRDF.GetResource(&quot;NC:SearchEngineRoot&quot;);</span>
<a href="#l26.312"></a><span id="l26.312" class="difflineminus">-  var kNC_child = aRDF.GetResource(&quot;http://home.netscape.com/NC-rdf#child&quot;);</span>
<a href="#l26.313"></a><span id="l26.313" class="difflineminus">-  var kNC_Name = aRDF.GetResource(&quot;http://home.netscape.com/NC-rdf#Name&quot;);</span>
<a href="#l26.314"></a><span id="l26.314" class="difflineminus">-          </span>
<a href="#l26.315"></a><span id="l26.315" class="difflineminus">-  var arcs = aDS.GetTargets(kNC_Root, kNC_child, true);</span>
<a href="#l26.316"></a><span id="l26.316" class="difflineminus">-  while (arcs.hasMoreElements()) {</span>
<a href="#l26.317"></a><span id="l26.317" class="difflineminus">-    var engineRes = arcs.getNext().QueryInterface(Components.interfaces.nsIRDFResource);</span>
<a href="#l26.318"></a><span id="l26.318" class="difflineminus">-    var name = readRDFString(aDS, engineRes, kNC_Name);</span>
<a href="#l26.319"></a><span id="l26.319" class="difflineminus">-    if (name == defaultName)</span>
<a href="#l26.320"></a><span id="l26.320" class="difflineminus">-      prefbranch.setCharPref(&quot;browser.search.defaultengine&quot;, engineRes.Value);</span>
<a href="#l26.321"></a><span id="l26.321" class="difflineminus">-  }</span>
<a href="#l26.322"></a><span id="l26.322" class="difflineminus">-}</span>
<a href="#l26.323"></a><span id="l26.323" class="difflineminus">-</span>
<a href="#l26.324"></a><span id="l26.324" class="difflineminus">-function AskChangeDefaultEngine(aSelectedEngine)</span>
<a href="#l26.325"></a><span id="l26.325" class="difflineminus">-{</span>
<a href="#l26.326"></a><span id="l26.326" class="difflineminus">-  const kDontAskAgainPref  = &quot;browser.search.set_default.dont_ask_again&quot;;</span>
<a href="#l26.327"></a><span id="l26.327" class="difflineminus">-  const kDefaultEnginePref = &quot;browser.search.defaultengine&quot;;</span>
<a href="#l26.328"></a><span id="l26.328" class="difflineminus">-</span>
<a href="#l26.329"></a><span id="l26.329" class="difflineminus">-  // don't prompt user if selection is same as old default engine</span>
<a href="#l26.330"></a><span id="l26.330" class="difflineminus">-  var oldDefault = nsPreferences.copyUnicharPref(kDefaultEnginePref);</span>
<a href="#l26.331"></a><span id="l26.331" class="difflineminus">-  if (aSelectedEngine.getAttribute(&quot;value&quot;) == oldDefault)</span>
<a href="#l26.332"></a><span id="l26.332" class="difflineminus">-    return;</span>
<a href="#l26.333"></a><span id="l26.333" class="difflineminus">-</span>
<a href="#l26.334"></a><span id="l26.334" class="difflineminus">-  // check &quot;don't ask again&quot; pref</span>
<a href="#l26.335"></a><span id="l26.335" class="difflineminus">-  var dontAskAgain = nsPreferences.getBoolPref(kDontAskAgainPref, false);</span>
<a href="#l26.336"></a><span id="l26.336" class="difflineminus">-  var change = false; // should we change the default engine?</span>
<a href="#l26.337"></a><span id="l26.337" class="difflineminus">-</span>
<a href="#l26.338"></a><span id="l26.338" class="difflineminus">-  // if &quot;don't ask again&quot; pref was set</span>
<a href="#l26.339"></a><span id="l26.339" class="difflineminus">-  if (dontAskAgain)</span>
<a href="#l26.340"></a><span id="l26.340" class="difflineminus">-  {</span>
<a href="#l26.341"></a><span id="l26.341" class="difflineminus">-    change = true;</span>
<a href="#l26.342"></a><span id="l26.342" class="difflineminus">-  }</span>
<a href="#l26.343"></a><span id="l26.343" class="difflineminus">-  else</span>
<a href="#l26.344"></a><span id="l26.344" class="difflineminus">-  {</span>
<a href="#l26.345"></a><span id="l26.345" class="difflineminus">-    // prompt user if we should change their default engine</span>
<a href="#l26.346"></a><span id="l26.346" class="difflineminus">-    var promptSvc = Components.</span>
<a href="#l26.347"></a><span id="l26.347" class="difflineminus">-                      classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;].</span>
<a href="#l26.348"></a><span id="l26.348" class="difflineminus">-                      getService(Components.interfaces.nsIPromptService);</span>
<a href="#l26.349"></a><span id="l26.349" class="difflineminus">-    if (!promptSvc)</span>
<a href="#l26.350"></a><span id="l26.350" class="difflineminus">-      return;</span>
<a href="#l26.351"></a><span id="l26.351" class="difflineminus">-    var title = searchBundle.getString(&quot;changeEngineTitle&quot;); </span>
<a href="#l26.352"></a><span id="l26.352" class="difflineminus">-    var dontAskAgainMsg = searchBundle.getString(&quot;dontAskAgainMsg&quot;); </span>
<a href="#l26.353"></a><span id="l26.353" class="difflineminus">-    var engineName = aSelectedEngine.getAttribute(&quot;label&quot;);</span>
<a href="#l26.354"></a><span id="l26.354" class="difflineminus">-    if (!engineName || engineName == &quot;&quot;)</span>
<a href="#l26.355"></a><span id="l26.355" class="difflineminus">-      engineName = searchBundle.getString(&quot;thisEngine&quot;);</span>
<a href="#l26.356"></a><span id="l26.356" class="difflineminus">-    var changeEngineMsg = searchBundle.stringBundle.formatStringFromName(</span>
<a href="#l26.357"></a><span id="l26.357" class="difflineminus">-                          &quot;changeEngineMsg&quot;, [engineName], 1); </span>
<a href="#l26.358"></a><span id="l26.358" class="difflineminus">-</span>
<a href="#l26.359"></a><span id="l26.359" class="difflineminus">-    var checkbox = {value:0};</span>
<a href="#l26.360"></a><span id="l26.360" class="difflineminus">-    var choice = promptSvc.confirmEx(window, title, changeEngineMsg, </span>
<a href="#l26.361"></a><span id="l26.361" class="difflineminus">-                   promptSvc.STD_YES_NO_BUTTONS,</span>
<a href="#l26.362"></a><span id="l26.362" class="difflineminus">-                   null, null, null, dontAskAgainMsg, checkbox);</span>
<a href="#l26.363"></a><span id="l26.363" class="difflineminus">-    if (choice == 0)</span>
<a href="#l26.364"></a><span id="l26.364" class="difflineminus">-      change = true;</span>
<a href="#l26.365"></a><span id="l26.365" class="difflineminus">-</span>
<a href="#l26.366"></a><span id="l26.366" class="difflineminus">-    // store &quot;don't ask again&quot; pref from checkbox value (if changed)</span>
<a href="#l26.367"></a><span id="l26.367" class="difflineminus">-    debug(&quot;dontAskAgain: &quot; + dontAskAgain);</span>
<a href="#l26.368"></a><span id="l26.368" class="difflineminus">-    debug(&quot;checkbox.value: &quot; + checkbox.value);</span>
<a href="#l26.369"></a><span id="l26.369" class="difflineminus">-    if (checkbox.value != dontAskAgain)</span>
<a href="#l26.370"></a><span id="l26.370" class="difflineminus">-      nsPreferences.setBoolPref(kDontAskAgainPref, checkbox.value);</span>
<a href="#l26.371"></a><span id="l26.371" class="difflineplus">+  var engines = Services.search.getVisibleEngines();</span>
<a href="#l26.372"></a><span id="l26.372" class="difflineplus">+  for (let i = 0; i &lt; engines.length; i++) {</span>
<a href="#l26.373"></a><span id="l26.373" class="difflineplus">+    let name = engines[i].name;</span>
<a href="#l26.374"></a><span id="l26.374" class="difflineplus">+    let menuitem = menulist.appendItem(name, name);</span>
<a href="#l26.375"></a><span id="l26.375" class="difflineplus">+    menuitem.setAttribute(&quot;class&quot;, &quot;menuitem-iconic&quot;);</span>
<a href="#l26.376"></a><span id="l26.376" class="difflineplus">+    if (engines[i].iconURI)</span>
<a href="#l26.377"></a><span id="l26.377" class="difflineplus">+      menuitem.setAttribute(&quot;image&quot;, engines[i].iconURI.spec);</span>
<a href="#l26.378"></a><span id="l26.378" class="difflineplus">+    menulist.menupopup.appendChild(menuitem);</span>
<a href="#l26.379"></a><span id="l26.379" class="difflineplus">+    menuitem.engine = engines[i];</span>
<a href="#l26.380"></a><span id="l26.380">   }</span>
<a href="#l26.381"></a><span id="l26.381" class="difflineminus">-</span>
<a href="#l26.382"></a><span id="l26.382" class="difflineminus">-  // if confirmed true, i.e., change default engine, then set pref</span>
<a href="#l26.383"></a><span id="l26.383" class="difflineminus">-  if (change)</span>
<a href="#l26.384"></a><span id="l26.384" class="difflineminus">-    nsPreferences.setUnicharPref(kDefaultEnginePref, aSelectedEngine.value);</span>
<a href="#l26.385"></a><span id="l26.385" class="difflineminus">-</span>
<a href="#l26.386"></a><span id="l26.386" class="difflineminus">-  disableNavButtons();</span>
<a href="#l26.387"></a><span id="l26.387" class="difflineminus">-}</span>
<a href="#l26.388"></a><span id="l26.388" class="difflineminus">-</span>
<a href="#l26.389"></a><span id="l26.389" class="difflineminus">-function disableNavButtons()</span>
<a href="#l26.390"></a><span id="l26.390" class="difflineminus">-{</span>
<a href="#l26.391"></a><span id="l26.391" class="difflineminus">-  var nextButton = document.getElementById(&quot;next-results&quot;);</span>
<a href="#l26.392"></a><span id="l26.392" class="difflineminus">-  var prevButton = document.getElementById(&quot;prev-results&quot;);</span>
<a href="#l26.393"></a><span id="l26.393" class="difflineminus">-  if (nextButton &amp;&amp; nextButton.getAttribute(&quot;disabled&quot;) != &quot;true&quot;)</span>
<a href="#l26.394"></a><span id="l26.394" class="difflineminus">-    nextButton.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l26.395"></a><span id="l26.395" class="difflineminus">-  if (prevButton &amp;&amp; prevButton.getAttribute(&quot;disabled&quot;) != &quot;true&quot;)</span>
<a href="#l26.396"></a><span id="l26.396" class="difflineminus">-    prevButton.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l26.397"></a><span id="l26.397" class="difflineminus">-}</span>
<a href="#l26.398"></a><span id="l26.398" class="difflineminus">-</span>
<a href="#l26.399"></a><span id="l26.399" class="difflineminus">-function ensureSearchPref()</span>
<a href="#l26.400"></a><span id="l26.400" class="difflineminus">-{</span>
<a href="#l26.401"></a><span id="l26.401" class="difflineminus">-  var rdf = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;]</span>
<a href="#l26.402"></a><span id="l26.402" class="difflineminus">-                      .getService(Components.interfaces.nsIRDFService);</span>
<a href="#l26.403"></a><span id="l26.403" class="difflineminus">-  var prefbranch = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l26.404"></a><span id="l26.404" class="difflineminus">-                             .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l26.405"></a><span id="l26.405" class="difflineminus">-  var ds = rdf.GetDataSource(&quot;rdf:internetsearch&quot;);</span>
<a href="#l26.406"></a><span id="l26.406" class="difflineminus">-  var kNC_Name = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#Name&quot;);</span>
<a href="#l26.407"></a><span id="l26.407" class="difflineminus">-  var defaultEngine;</span>
<a href="#l26.408"></a><span id="l26.408" class="difflineminus">-</span>
<a href="#l26.409"></a><span id="l26.409" class="difflineminus">-  try {</span>
<a href="#l26.410"></a><span id="l26.410" class="difflineminus">-    defaultEngine = prefbranch.getCharPref(&quot;browser.search.defaultengine&quot;);</span>
<a href="#l26.411"></a><span id="l26.411" class="difflineminus">-  } catch(ex) {</span>
<a href="#l26.412"></a><span id="l26.412" class="difflineminus">-    ensureDefaultEnginePrefs(rdf, ds);</span>
<a href="#l26.413"></a><span id="l26.413" class="difflineminus">-    defaultEngine = prefbranch.getCharPref(&quot;browser.search.defaultengine&quot;);</span>
<a href="#l26.414"></a><span id="l26.414" class="difflineminus">-  }</span>
<a href="#l26.415"></a><span id="l26.415" class="difflineminus">-}</span>
<a href="#l26.416"></a><span id="l26.416" class="difflineminus">-</span>
<a href="#l26.417"></a><span id="l26.417" class="difflineminus">-// Initialize the Search panel:</span>
<a href="#l26.418"></a><span id="l26.418" class="difflineminus">-// 1) init the category list</span>
<a href="#l26.419"></a><span id="l26.419" class="difflineminus">-// 2) load the search engines associated with this category</span>
<a href="#l26.420"></a><span id="l26.420" class="difflineminus">-// 3) initialize the checked state of said engines</span>
<a href="#l26.421"></a><span id="l26.421" class="difflineminus">-function SearchPanelStartup()</span>
<a href="#l26.422"></a><span id="l26.422" class="difflineminus">-{</span>
<a href="#l26.423"></a><span id="l26.423" class="difflineminus">-  searchBundle = document.getElementById(&quot;searchBundle&quot;);</span>
<a href="#l26.424"></a><span id="l26.424" class="difflineminus">-</span>
<a href="#l26.425"></a><span id="l26.425" class="difflineminus">-  var rdf  = Components.classes[RDFSERVICE_CONTRACTID].getService(nsIRDFService);</span>
<a href="#l26.426"></a><span id="l26.426" class="difflineminus">-  rootNode = rdf.GetResource(&quot;NC:LastSearchRoot&quot;, true);</span>
<a href="#l26.427"></a><span id="l26.427" class="difflineminus">-  textArc  = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#LastText&quot;, true);</span>
<a href="#l26.428"></a><span id="l26.428" class="difflineminus">-  modeArc  = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#SearchMode&quot;, true);</span>
<a href="#l26.429"></a><span id="l26.429" class="difflineminus">-  </span>
<a href="#l26.430"></a><span id="l26.430" class="difflineminus">-  ensureSearchPref()</span>
<a href="#l26.431"></a><span id="l26.431" class="difflineminus">-  </span>
<a href="#l26.432"></a><span id="l26.432" class="difflineminus">-  var resultList = document.getElementById(&quot;resultList&quot;);</span>
<a href="#l26.433"></a><span id="l26.433" class="difflineminus">-  resultList.database.AddObserver(RDF_observer);</span>
<a href="#l26.434"></a><span id="l26.434" class="difflineminus">-</span>
<a href="#l26.435"></a><span id="l26.435" class="difflineminus">-  var categoryList = document.getElementById(&quot;categoryList&quot;);</span>
<a href="#l26.436"></a><span id="l26.436" class="difflineminus">-  var internetSearch = Components.classes[ISEARCH_CONTRACTID].getService(nsIInternetSearchService);</span>
<a href="#l26.437"></a><span id="l26.437" class="difflineminus">-  var catDS = internetSearch.GetCategoryDataSource();</span>
<a href="#l26.438"></a><span id="l26.438" class="difflineminus">-  if (catDS) {</span>
<a href="#l26.439"></a><span id="l26.439" class="difflineminus">-    catDS = catDS.QueryInterface(nsIRDFDataSource);</span>
<a href="#l26.440"></a><span id="l26.440" class="difflineminus">-    categoryList.database.AddDataSource(catDS);</span>
<a href="#l26.441"></a><span id="l26.441" class="difflineminus">-    categoryList.builder.rebuild();</span>
<a href="#l26.442"></a><span id="l26.442" class="difflineminus">-    var engineList = document.getElementById(&quot;searchengines&quot;);</span>
<a href="#l26.443"></a><span id="l26.443" class="difflineminus">-    engineList.database.AddDataSource(catDS);</span>
<a href="#l26.444"></a><span id="l26.444" class="difflineminus">-    engineList.builder.rebuild();</span>
<a href="#l26.445"></a><span id="l26.445" class="difflineminus">-    engineList.addEventListener(&quot;CheckboxStateChange&quot;, saveEngine, false);</span>
<a href="#l26.446"></a><span id="l26.446" class="difflineminus">-  }</span>
<a href="#l26.447"></a><span id="l26.447" class="difflineplus">+  menulist.value = Services.search.currentEngine.name;</span>
<a href="#l26.448"></a><span id="l26.448"> </span>
<a href="#l26.449"></a><span id="l26.449" class="difflineminus">-  // try and determine last category name used</span>
<a href="#l26.450"></a><span id="l26.450" class="difflineminus">-  var lastCategoryName = nsPreferences.copyUnicharPref(&quot;browser.search.last_search_category&quot;, &quot;&quot;);</span>
<a href="#l26.451"></a><span id="l26.451" class="difflineminus">-  if (lastCategoryName) {</span>
<a href="#l26.452"></a><span id="l26.452" class="difflineminus">-    // strip off the prefix if necessary</span>
<a href="#l26.453"></a><span id="l26.453" class="difflineminus">-    var prefix = &quot;NC:SearchCategory?category=&quot;;</span>
<a href="#l26.454"></a><span id="l26.454" class="difflineminus">-    if (lastCategoryName.indexOf(prefix) == 0)</span>
<a href="#l26.455"></a><span id="l26.455" class="difflineminus">-      lastCategoryName = lastCategoryName.substr(prefix.length);</span>
<a href="#l26.456"></a><span id="l26.456" class="difflineminus">-  }</span>
<a href="#l26.457"></a><span id="l26.457" class="difflineminus">-</span>
<a href="#l26.458"></a><span id="l26.458" class="difflineminus">-  // select the appropriate category</span>
<a href="#l26.459"></a><span id="l26.459" class="difflineminus">-  var categoryPopup = document.getElementById(&quot;categoryPopup&quot;);</span>
<a href="#l26.460"></a><span id="l26.460" class="difflineminus">-  var found = false;</span>
<a href="#l26.461"></a><span id="l26.461" class="difflineminus">-  for (var i = 0; i &lt; categoryPopup.childNodes.length; ++i) {</span>
<a href="#l26.462"></a><span id="l26.462" class="difflineminus">-    if (lastCategoryName == &quot;&quot; &amp;&amp;</span>
<a href="#l26.463"></a><span id="l26.463" class="difflineminus">-        categoryPopup.childNodes[i].getAttribute(&quot;value&quot;) == &quot;NC:SearchEngineRoot&quot; ||</span>
<a href="#l26.464"></a><span id="l26.464" class="difflineminus">-        categoryPopup.childNodes[i].getAttribute(&quot;id&quot;) == lastCategoryName)</span>
<a href="#l26.465"></a><span id="l26.465" class="difflineminus">-    {</span>
<a href="#l26.466"></a><span id="l26.466" class="difflineminus">-      categoryList.selectedItem = categoryPopup.childNodes[i];</span>
<a href="#l26.467"></a><span id="l26.467" class="difflineminus">-      found = true;</span>
<a href="#l26.468"></a><span id="l26.468" class="difflineminus">-      break;</span>
<a href="#l26.469"></a><span id="l26.469" class="difflineminus">-    }</span>
<a href="#l26.470"></a><span id="l26.470" class="difflineminus">-  }</span>
<a href="#l26.471"></a><span id="l26.471" class="difflineminus">-  if (!found)</span>
<a href="#l26.472"></a><span id="l26.472" class="difflineminus">-    categoryList.selectedItem = categoryPopup.childNodes[0];</span>
<a href="#l26.473"></a><span id="l26.473" class="difflineminus">-</span>
<a href="#l26.474"></a><span id="l26.474" class="difflineminus">-  if (!lastCategoryName)</span>
<a href="#l26.475"></a><span id="l26.475" class="difflineminus">-    lastCategoryName = &quot;NC:SearchEngineRoot&quot;;</span>
<a href="#l26.476"></a><span id="l26.476" class="difflineminus">-  else if (lastCategoryName != &quot;NC:SearchEngineRoot&quot;)</span>
<a href="#l26.477"></a><span id="l26.477" class="difflineminus">-    lastCategoryName = &quot;NC:SearchCategory?category=&quot; + lastCategoryName;</span>
<a href="#l26.478"></a><span id="l26.478" class="difflineminus">-</span>
<a href="#l26.479"></a><span id="l26.479" class="difflineminus">-  var treeNode = document.getElementById(&quot;searchengines&quot;);</span>
<a href="#l26.480"></a><span id="l26.480" class="difflineminus">-  treeNode.setAttribute(&quot;ref&quot;, lastCategoryName);</span>
<a href="#l26.481"></a><span id="l26.481" class="difflineminus">-</span>
<a href="#l26.482"></a><span id="l26.482" class="difflineminus">-  loadEngines(lastCategoryName);</span>
<a href="#l26.483"></a><span id="l26.483" class="difflineminus">-</span>
<a href="#l26.484"></a><span id="l26.484" class="difflineminus">-  // if we have search results, show them, otherwise show engines</span>
<a href="#l26.485"></a><span id="l26.485" class="difflineminus">-  if (updateSearchMode() != 0)</span>
<a href="#l26.486"></a><span id="l26.486" class="difflineminus">-  {</span>
<a href="#l26.487"></a><span id="l26.487" class="difflineminus">-    if (haveSearchResults())</span>
<a href="#l26.488"></a><span id="l26.488" class="difflineminus">-      switchTab(0);</span>
<a href="#l26.489"></a><span id="l26.489" class="difflineminus">-    else</span>
<a href="#l26.490"></a><span id="l26.490" class="difflineminus">-      switchTab(1);</span>
<a href="#l26.491"></a><span id="l26.491" class="difflineminus">-  }</span>
<a href="#l26.492"></a><span id="l26.492" class="difflineminus">-}</span>
<a href="#l26.493"></a><span id="l26.493" class="difflineminus">-</span>
<a href="#l26.494"></a><span id="l26.494" class="difflineminus">-function haveSearchResults()</span>
<a href="#l26.495"></a><span id="l26.495" class="difflineminus">-{</span>
<a href="#l26.496"></a><span id="l26.496" class="difflineminus">-  var ds = document.getElementById(&quot;resultList&quot;).database;</span>
<a href="#l26.497"></a><span id="l26.497" class="difflineminus">-  if (!ds)</span>
<a href="#l26.498"></a><span id="l26.498" class="difflineminus">-    return false;</span>
<a href="#l26.499"></a><span id="l26.499" class="difflineminus">-</span>
<a href="#l26.500"></a><span id="l26.500" class="difflineminus">-  var rdf = Components.classes[RDFSERVICE_CONTRACTID].getService(nsIRDFService);</span>
<a href="#l26.501"></a><span id="l26.501" class="difflineminus">-  var source = rdf.GetResource(&quot;NC:LastSearchRoot&quot;, true);</span>
<a href="#l26.502"></a><span id="l26.502" class="difflineminus">-  var childProperty = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#LastText&quot;, true);</span>
<a href="#l26.503"></a><span id="l26.503" class="difflineminus">-  var target = ds.GetTarget(source, childProperty, true);</span>
<a href="#l26.504"></a><span id="l26.504" class="difflineminus">-  if (target) {</span>
<a href="#l26.505"></a><span id="l26.505" class="difflineminus">-    target = target.QueryInterface(nsIRDFLiteral).Value;</span>
<a href="#l26.506"></a><span id="l26.506" class="difflineminus">-    if (target) {</span>
<a href="#l26.507"></a><span id="l26.507" class="difflineminus">-      // convert plusses (+) back to spaces</span>
<a href="#l26.508"></a><span id="l26.508" class="difflineminus">-      target = target.replace(/\+/g, &quot; &quot;);</span>
<a href="#l26.509"></a><span id="l26.509" class="difflineminus">-      var textNode = document.getElementById(&quot;sidebar-search-text&quot;);</span>
<a href="#l26.510"></a><span id="l26.510" class="difflineminus">-      textNode.value = decodeURI(target);</span>
<a href="#l26.511"></a><span id="l26.511" class="difflineminus">-      return true;</span>
<a href="#l26.512"></a><span id="l26.512" class="difflineminus">-    }</span>
<a href="#l26.513"></a><span id="l26.513" class="difflineminus">-  }</span>
<a href="#l26.514"></a><span id="l26.514" class="difflineminus">-  return false;</span>
<a href="#l26.515"></a><span id="l26.515" class="difflineminus">-}</span>
<a href="#l26.516"></a><span id="l26.516" class="difflineminus">-</span>
<a href="#l26.517"></a><span id="l26.517" class="difflineminus">-function getNumEngines()</span>
<a href="#l26.518"></a><span id="l26.518" class="difflineminus">-{</span>
<a href="#l26.519"></a><span id="l26.519" class="difflineminus">-  var listbox = document.getElementById(&quot;searchengines&quot;);</span>
<a href="#l26.520"></a><span id="l26.520" class="difflineminus">-  return listbox.getElementsByTagName(&quot;listitem&quot;).length;</span>
<a href="#l26.521"></a><span id="l26.521" class="difflineminus">-}</span>
<a href="#l26.522"></a><span id="l26.522" class="difflineminus">-</span>
<a href="#l26.523"></a><span id="l26.523" class="difflineminus">-function chooseCategory(aNode)</span>
<a href="#l26.524"></a><span id="l26.524" class="difflineminus">-{</span>
<a href="#l26.525"></a><span id="l26.525" class="difflineminus">-  var category = !aNode.id ? &quot;NC:SearchEngineRoot&quot; :</span>
<a href="#l26.526"></a><span id="l26.526" class="difflineminus">-                             &quot;NC:SearchCategory?category=&quot; + aNode.getAttribute(&quot;id&quot;);</span>
<a href="#l26.527"></a><span id="l26.527" class="difflineminus">-  nsPreferences.setUnicharPref(&quot;browser.search.last_search_category&quot;, category);</span>
<a href="#l26.528"></a><span id="l26.528" class="difflineminus">-</span>
<a href="#l26.529"></a><span id="l26.529" class="difflineminus">-  var treeNode = document.getElementById(&quot;searchengines&quot;);</span>
<a href="#l26.530"></a><span id="l26.530" class="difflineminus">-  treeNode.setAttribute(&quot;ref&quot;, category);</span>
<a href="#l26.531"></a><span id="l26.531" class="difflineminus">-</span>
<a href="#l26.532"></a><span id="l26.532" class="difflineminus">-  loadEngines(category);</span>
<a href="#l26.533"></a><span id="l26.533" class="difflineminus">-}</span>
<a href="#l26.534"></a><span id="l26.534" class="difflineminus">-</span>
<a href="#l26.535"></a><span id="l26.535" class="difflineminus">-function saveEngine(event)</span>
<a href="#l26.536"></a><span id="l26.536" class="difflineminus">-{</span>
<a href="#l26.537"></a><span id="l26.537" class="difflineminus">-  var rdf = Components.classes[RDFSERVICE_CONTRACTID].getService(nsIRDFService);</span>
<a href="#l26.538"></a><span id="l26.538" class="difflineminus">-  var localStore = rdf.GetDataSource(&quot;rdf:local-store&quot;);</span>
<a href="#l26.539"></a><span id="l26.539" class="difflineminus">-  if (!localStore)</span>
<a href="#l26.540"></a><span id="l26.540" class="difflineminus">-    return;</span>
<a href="#l26.541"></a><span id="l26.541" class="difflineminus">-</span>
<a href="#l26.542"></a><span id="l26.542" class="difflineminus">-  var checkedProperty = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#checked&quot;, true);</span>
<a href="#l26.543"></a><span id="l26.543" class="difflineminus">-  var engines = event.currentTarget;</span>
<a href="#l26.544"></a><span id="l26.544" class="difflineminus">-  var categorySRC = rdf.GetResource(engines.ref, true);</span>
<a href="#l26.545"></a><span id="l26.545" class="difflineminus">-</span>
<a href="#l26.546"></a><span id="l26.546" class="difflineminus">-  var itemNode = event.target;</span>
<a href="#l26.547"></a><span id="l26.547" class="difflineminus">-  var engineSRC = rdf.GetResource(itemNode.id, true);</span>
<a href="#l26.548"></a><span id="l26.548" class="difflineminus">-</span>
<a href="#l26.549"></a><span id="l26.549" class="difflineminus">-  if (itemNode.checked)</span>
<a href="#l26.550"></a><span id="l26.550" class="difflineminus">-    localStore.Assert(categorySRC, checkedProperty, engineSRC, true);</span>
<a href="#l26.551"></a><span id="l26.551" class="difflineminus">-  else</span>
<a href="#l26.552"></a><span id="l26.552" class="difflineminus">-    localStore.Unassert(categorySRC, checkedProperty, engineSRC, true);</span>
<a href="#l26.553"></a><span id="l26.553" class="difflineminus">-</span>
<a href="#l26.554"></a><span id="l26.554" class="difflineminus">-  // save changes; flush out the localstore</span>
<a href="#l26.555"></a><span id="l26.555" class="difflineminus">-  try {</span>
<a href="#l26.556"></a><span id="l26.556" class="difflineminus">-    var flushableStore = localStore.QueryInterface(nsIRDFRemoteDataSource);</span>
<a href="#l26.557"></a><span id="l26.557" class="difflineminus">-    flushableStore.Flush();</span>
<a href="#l26.558"></a><span id="l26.558" class="difflineminus">-  }</span>
<a href="#l26.559"></a><span id="l26.559" class="difflineminus">-  catch (ex) {}</span>
<a href="#l26.560"></a><span id="l26.560" class="difflineminus">-}</span>
<a href="#l26.561"></a><span id="l26.561" class="difflineminus">-</span>
<a href="#l26.562"></a><span id="l26.562" class="difflineminus">-// initialize the appropriate engine list, and the checked state of the engines</span>
<a href="#l26.563"></a><span id="l26.563" class="difflineminus">-function loadEngines(aCategory)</span>
<a href="#l26.564"></a><span id="l26.564" class="difflineminus">-{</span>
<a href="#l26.565"></a><span id="l26.565" class="difflineminus">-  var rdf = Components.classes[RDFSERVICE_CONTRACTID].getService(nsIRDFService);</span>
<a href="#l26.566"></a><span id="l26.566" class="difflineminus">-  var localStore = rdf.GetDataSource(&quot;rdf:local-store&quot;);</span>
<a href="#l26.567"></a><span id="l26.567" class="difflineminus">-  if (localStore) {</span>
<a href="#l26.568"></a><span id="l26.568" class="difflineminus">-    var engineBox = document.getElementById(&quot;searchengines&quot;);</span>
<a href="#l26.569"></a><span id="l26.569" class="difflineminus">-    var numEngines = engineBox.childNodes.length;</span>
<a href="#l26.570"></a><span id="l26.570" class="difflineminus">-    var checkedProperty = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#checked&quot;, true);</span>
<a href="#l26.571"></a><span id="l26.571" class="difflineminus">-    var categorySRC = rdf.GetResource(aCategory, true);</span>
<a href="#l26.572"></a><span id="l26.572" class="difflineminus">-    for (var x = 0; x &lt; numEngines; ++x) {</span>
<a href="#l26.573"></a><span id="l26.573" class="difflineminus">-      var listitemNode = engineBox.childNodes[x];</span>
<a href="#l26.574"></a><span id="l26.574" class="difflineminus">-      if (listitemNode.localName == &quot;listitem&quot;) {</span>
<a href="#l26.575"></a><span id="l26.575" class="difflineminus">-        var engineURI = listitemNode.getAttribute(&quot;id&quot;);</span>
<a href="#l26.576"></a><span id="l26.576" class="difflineminus">-        var engineSRC = rdf.GetResource(engineURI, true);</span>
<a href="#l26.577"></a><span id="l26.577" class="difflineminus">-  </span>
<a href="#l26.578"></a><span id="l26.578" class="difflineminus">-        var hasAssertion = localStore.HasAssertion(categorySRC, checkedProperty, engineSRC, true);</span>
<a href="#l26.579"></a><span id="l26.579" class="difflineminus">-        if (hasAssertion)</span>
<a href="#l26.580"></a><span id="l26.580" class="difflineminus">-          listitemNode.checked = true;</span>
<a href="#l26.581"></a><span id="l26.581" class="difflineminus">-      }</span>
<a href="#l26.582"></a><span id="l26.582" class="difflineminus">-    }</span>
<a href="#l26.583"></a><span id="l26.583" class="difflineminus">-  }</span>
<a href="#l26.584"></a><span id="l26.584" class="difflineminus">-}</span>
<a href="#l26.585"></a><span id="l26.585" class="difflineminus">-</span>
<a href="#l26.586"></a><span id="l26.586" class="difflineminus">-function SearchPanelShutdown()</span>
<a href="#l26.587"></a><span id="l26.587" class="difflineminus">-{</span>
<a href="#l26.588"></a><span id="l26.588" class="difflineminus">-  var tree = document.getElementById(&quot;resultList&quot;);</span>
<a href="#l26.589"></a><span id="l26.589" class="difflineminus">-  tree.database.RemoveObserver(RDF_observer);</span>
<a href="#l26.590"></a><span id="l26.590" class="difflineplus">+  Services.obs.addObserver(engineObserver, SEARCH_ENGINE_TOPIC, false);</span>
<a href="#l26.591"></a><span id="l26.591"> }</span>
<a href="#l26.592"></a><span id="l26.592"> </span>
<a href="#l26.593"></a><span id="l26.593" class="difflineminus">-function doStop()</span>
<a href="#l26.594"></a><span id="l26.594" class="difflineminus">-{</span>
<a href="#l26.595"></a><span id="l26.595" class="difflineminus">-  if (!gSearchButtonText)</span>
<a href="#l26.596"></a><span id="l26.596" class="difflineminus">-    gSearchButtonText = searchBundle.getString(&quot;searchButtonText&quot;);</span>
<a href="#l26.597"></a><span id="l26.597" class="difflineminus">-</span>
<a href="#l26.598"></a><span id="l26.598" class="difflineminus">-  var searchButtonNode = document.getElementById(&quot;searchButton&quot;);</span>
<a href="#l26.599"></a><span id="l26.599" class="difflineminus">-  searchButtonNode.removeAttribute(&quot;stop&quot;);</span>
<a href="#l26.600"></a><span id="l26.600" class="difflineminus">-  searchButtonNode.setAttribute(&quot;label&quot;, gSearchButtonText);</span>
<a href="#l26.601"></a><span id="l26.601" class="difflineminus">-</span>
<a href="#l26.602"></a><span id="l26.602" class="difflineminus">-  // should stop button press also stop the load of the page in the browser? I think so.</span>
<a href="#l26.603"></a><span id="l26.603" class="difflineminus">-  var progressNode = parent.document.getElementById(&quot;statusbar-icon&quot;);</span>
<a href="#l26.604"></a><span id="l26.604" class="difflineminus">-  if (progressNode)</span>
<a href="#l26.605"></a><span id="l26.605" class="difflineminus">-    progressNode.setAttribute(&quot;mode&quot;, &quot;normal&quot;);</span>
<a href="#l26.606"></a><span id="l26.606" class="difflineminus">-</span>
<a href="#l26.607"></a><span id="l26.607" class="difflineminus">-  // stop any network connections</span>
<a href="#l26.608"></a><span id="l26.608" class="difflineminus">-  var internetSearchService = Components.classes[ISEARCH_CONTRACTID].getService(nsIInternetSearchService);</span>
<a href="#l26.609"></a><span id="l26.609" class="difflineminus">-  internetSearchService.Stop();</span>
<a href="#l26.610"></a><span id="l26.610" class="difflineminus">-</span>
<a href="#l26.611"></a><span id="l26.611" class="difflineminus">-  // show appropriate column(s)</span>
<a href="#l26.612"></a><span id="l26.612" class="difflineminus">-  var navWindow = getNavigatorWindow(false);</span>
<a href="#l26.613"></a><span id="l26.613" class="difflineminus">-  var resultsList = navWindow ? navWindow.content.document.getElementById(&quot;resultsList&quot;) : null;</span>
<a href="#l26.614"></a><span id="l26.614" class="difflineminus">-  if (!resultsList)</span>
<a href="#l26.615"></a><span id="l26.615" class="difflineminus">-    return;</span>
<a href="#l26.616"></a><span id="l26.616" class="difflineminus">-</span>
<a href="#l26.617"></a><span id="l26.617" class="difflineminus">-  var searchURL = resultsList.getAttribute(&quot;ref&quot;);</span>
<a href="#l26.618"></a><span id="l26.618" class="difflineminus">-  if (!searchURL)</span>
<a href="#l26.619"></a><span id="l26.619" class="difflineminus">-    return;</span>
<a href="#l26.620"></a><span id="l26.620" class="difflineminus">-</span>
<a href="#l26.621"></a><span id="l26.621" class="difflineminus">-  var internetSearch = internetSearchService.QueryInterface(nsIRDFDataSource);</span>
<a href="#l26.622"></a><span id="l26.622" class="difflineminus">-</span>
<a href="#l26.623"></a><span id="l26.623" class="difflineminus">-  // get various services</span>
<a href="#l26.624"></a><span id="l26.624" class="difflineminus">-  var rdf = Components.classes[RDFSERVICE_CONTRACTID].getService(nsIRDFService);</span>
<a href="#l26.625"></a><span id="l26.625" class="difflineminus">-</span>
<a href="#l26.626"></a><span id="l26.626" class="difflineminus">-  var searchResource       = rdf.GetResource(searchURL, true);</span>
<a href="#l26.627"></a><span id="l26.627" class="difflineminus">-  var priceProperty        = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#Price&quot;, true);</span>
<a href="#l26.628"></a><span id="l26.628" class="difflineminus">-  var availabilityProperty = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#Availability&quot;, true);</span>
<a href="#l26.629"></a><span id="l26.629" class="difflineminus">-  var relevanceProperty    = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#Relevance&quot;, true);</span>
<a href="#l26.630"></a><span id="l26.630" class="difflineminus">-  var dateProperty         = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#Date&quot;, true);</span>
<a href="#l26.631"></a><span id="l26.631" class="difflineminus">-  var trueProperty         = rdf.GetLiteral(&quot;true&quot;);</span>
<a href="#l26.632"></a><span id="l26.632" class="difflineminus">-  var hasPriceFlag         = internetSearch.HasAssertion(searchResource, priceProperty, trueProperty, true);</span>
<a href="#l26.633"></a><span id="l26.633" class="difflineminus">-  var hasAvailabilityFlag  = internetSearch.HasAssertion(searchResource, availabilityProperty, trueProperty, true);</span>
<a href="#l26.634"></a><span id="l26.634" class="difflineminus">-  var hasRelevanceFlag     = internetSearch.HasAssertion(searchResource, relevanceProperty, trueProperty, true);</span>
<a href="#l26.635"></a><span id="l26.635" class="difflineminus">-  var hasDateFlag          = internetSearch.HasAssertion(searchResource, dateProperty, trueProperty, true);</span>
<a href="#l26.636"></a><span id="l26.636" class="difflineminus">-  var colNode;</span>
<a href="#l26.637"></a><span id="l26.637" class="difflineminus">-  var sortSetFlag = false;</span>
<a href="#l26.638"></a><span id="l26.638" class="difflineminus">-</span>
<a href="#l26.639"></a><span id="l26.639" class="difflineminus">-  if (hasPriceFlag) {</span>
<a href="#l26.640"></a><span id="l26.640" class="difflineminus">-    colNode = navWindow.content.document.getElementById(&quot;PriceColumn&quot;);</span>
<a href="#l26.641"></a><span id="l26.641" class="difflineminus">-    if (colNode) {</span>
<a href="#l26.642"></a><span id="l26.642" class="difflineminus">-      colNode.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l26.643"></a><span id="l26.643" class="difflineminus">-      if (!sortSetFlag) {</span>
<a href="#l26.644"></a><span id="l26.644" class="difflineminus">-        top.content.setInitialSort(colNode, &quot;ascending&quot;);</span>
<a href="#l26.645"></a><span id="l26.645" class="difflineminus">-        sortSetFlag = true;</span>
<a href="#l26.646"></a><span id="l26.646" class="difflineminus">-      }</span>
<a href="#l26.647"></a><span id="l26.647" class="difflineminus">-    }</span>
<a href="#l26.648"></a><span id="l26.648" class="difflineminus">-  }</span>
<a href="#l26.649"></a><span id="l26.649" class="difflineminus">-</span>
<a href="#l26.650"></a><span id="l26.650" class="difflineminus">-  if (hasAvailabilityFlag) {</span>
<a href="#l26.651"></a><span id="l26.651" class="difflineminus">-    colNode = navWindow.content.document.getElementById(&quot;AvailabilityColumn&quot;);</span>
<a href="#l26.652"></a><span id="l26.652" class="difflineminus">-    if (colNode)</span>
<a href="#l26.653"></a><span id="l26.653" class="difflineminus">-      colNode.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l26.654"></a><span id="l26.654" class="difflineminus">-  }</span>
<a href="#l26.655"></a><span id="l26.655" class="difflineminus">-</span>
<a href="#l26.656"></a><span id="l26.656" class="difflineminus">-  if (hasDateFlag) {</span>
<a href="#l26.657"></a><span id="l26.657" class="difflineminus">-    colNode = navWindow.content.document.getElementById(&quot;DateColumn&quot;);</span>
<a href="#l26.658"></a><span id="l26.658" class="difflineminus">-    if (colNode)</span>
<a href="#l26.659"></a><span id="l26.659" class="difflineminus">-      colNode.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l26.660"></a><span id="l26.660" class="difflineminus">-  }</span>
<a href="#l26.661"></a><span id="l26.661" class="difflineminus">-</span>
<a href="#l26.662"></a><span id="l26.662" class="difflineminus">-  if (hasRelevanceFlag) {</span>
<a href="#l26.663"></a><span id="l26.663" class="difflineminus">-    colNode = navWindow.content.document.getElementById(&quot;RelevanceColumn&quot;);</span>
<a href="#l26.664"></a><span id="l26.664" class="difflineminus">-    if (colNode) {</span>
<a href="#l26.665"></a><span id="l26.665" class="difflineminus">-      colNode.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l26.666"></a><span id="l26.666" class="difflineminus">-      if (!sortSetFlag) {</span>
<a href="#l26.667"></a><span id="l26.667" class="difflineminus">-        navWindow.content.setInitialSort(colNode, &quot;descending&quot;);</span>
<a href="#l26.668"></a><span id="l26.668" class="difflineminus">-        sortSetFlag = true;</span>
<a href="#l26.669"></a><span id="l26.669" class="difflineminus">-      }</span>
<a href="#l26.670"></a><span id="l26.670" class="difflineminus">-    }</span>
<a href="#l26.671"></a><span id="l26.671" class="difflineminus">-  }</span>
<a href="#l26.672"></a><span id="l26.672" class="difflineminus">-</span>
<a href="#l26.673"></a><span id="l26.673" class="difflineminus">-  if (!sortSetFlag) {</span>
<a href="#l26.674"></a><span id="l26.674" class="difflineminus">-    colNode = navWindow.content.document.getElementById(&quot;PageRankColumn&quot;);</span>
<a href="#l26.675"></a><span id="l26.675" class="difflineminus">-    if (colNode)</span>
<a href="#l26.676"></a><span id="l26.676" class="difflineminus">-      navWindow.content.setInitialSort(colNode, &quot;ascending&quot;);</span>
<a href="#l26.677"></a><span id="l26.677" class="difflineminus">-  }</span>
<a href="#l26.678"></a><span id="l26.678" class="difflineminus">-</span>
<a href="#l26.679"></a><span id="l26.679" class="difflineminus">-  switchTab(0);</span>
<a href="#l26.680"></a><span id="l26.680" class="difflineminus">-}</span>
<a href="#l26.681"></a><span id="l26.681" class="difflineminus">-</span>
<a href="#l26.682"></a><span id="l26.682" class="difflineminus">-function doSearch()</span>
<a href="#l26.683"></a><span id="l26.683" class="difflineminus">-{</span>
<a href="#l26.684"></a><span id="l26.684" class="difflineminus">-  var navWindow = getNavigatorWindow(true);</span>
<a href="#l26.685"></a><span id="l26.685" class="difflineminus">-  if (navWindow.content)</span>
<a href="#l26.686"></a><span id="l26.686" class="difflineminus">-    onNavWindowLoad();</span>
<a href="#l26.687"></a><span id="l26.687" class="difflineminus">-  else</span>
<a href="#l26.688"></a><span id="l26.688" class="difflineminus">-    navWindow.addEventListener(&quot;load&quot;, onNavWindowLoad, false);</span>
<a href="#l26.689"></a><span id="l26.689" class="difflineplus">+function Shutdown() {</span>
<a href="#l26.690"></a><span id="l26.690" class="difflineplus">+  Services.obs.removeObserver(engineObserver, SEARCH_ENGINE_TOPIC, false);</span>
<a href="#l26.691"></a><span id="l26.691"> }</span>
<a href="#l26.692"></a><span id="l26.692"> </span>
<a href="#l26.693"></a><span id="l26.693" class="difflineminus">-function onNavWindowLoad() {</span>
<a href="#l26.694"></a><span id="l26.694" class="difflineminus">-  var navWindow = getNavigatorWindow(true);</span>
<a href="#l26.695"></a><span id="l26.695" class="difflineminus">-</span>
<a href="#l26.696"></a><span id="l26.696" class="difflineminus">-  // hide various columns</span>
<a href="#l26.697"></a><span id="l26.697" class="difflineminus">-  if (navWindow &amp;&amp; &quot;content&quot; in navWindow &amp;&amp; &quot;isMozillaSearchWindow&quot; in navWindow.content) {</span>
<a href="#l26.698"></a><span id="l26.698" class="difflineminus">-    colNode = navWindow.content.document.getElementById(&quot;RelevanceColumn&quot;);</span>
<a href="#l26.699"></a><span id="l26.699" class="difflineminus">-    if (colNode)</span>
<a href="#l26.700"></a><span id="l26.700" class="difflineminus">-      colNode.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l26.701"></a><span id="l26.701" class="difflineminus">-</span>
<a href="#l26.702"></a><span id="l26.702" class="difflineminus">-    colNode = navWindow.content.document.getElementById(&quot;PriceColumn&quot;);</span>
<a href="#l26.703"></a><span id="l26.703" class="difflineminus">-    if (colNode)</span>
<a href="#l26.704"></a><span id="l26.704" class="difflineminus">-      colNode.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l26.705"></a><span id="l26.705" class="difflineminus">-</span>
<a href="#l26.706"></a><span id="l26.706" class="difflineminus">-    colNode = navWindow.content.document.getElementById(&quot;AvailabilityColumn&quot;);</span>
<a href="#l26.707"></a><span id="l26.707" class="difflineminus">-    if (colNode)</span>
<a href="#l26.708"></a><span id="l26.708" class="difflineminus">-      colNode.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l26.709"></a><span id="l26.709" class="difflineminus">-  }</span>
<a href="#l26.710"></a><span id="l26.710" class="difflineminus">-</span>
<a href="#l26.711"></a><span id="l26.711" class="difflineminus">-  // get user text to find</span>
<a href="#l26.712"></a><span id="l26.712" class="difflineminus">-  var textNode = document.getElementById(&quot;sidebar-search-text&quot;);</span>
<a href="#l26.713"></a><span id="l26.713" class="difflineminus">-</span>
<a href="#l26.714"></a><span id="l26.714" class="difflineminus">-  if (!textNode.value) {</span>
<a href="#l26.715"></a><span id="l26.715" class="difflineminus">-    alert(searchBundle.getString(&quot;enterstringandlocation&quot;));</span>
<a href="#l26.716"></a><span id="l26.716" class="difflineminus">-    return;</span>
<a href="#l26.717"></a><span id="l26.717" class="difflineminus">-  }</span>
<a href="#l26.718"></a><span id="l26.718" class="difflineminus">-</span>
<a href="#l26.719"></a><span id="l26.719" class="difflineminus">-  var searchMode = nsPreferences.getIntPref(&quot;browser.search.mode&quot;, 0);</span>
<a href="#l26.720"></a><span id="l26.720" class="difflineminus">-  var engineURIs = [];</span>
<a href="#l26.721"></a><span id="l26.721" class="difflineminus">-  if (searchMode &gt; 0) {</span>
<a href="#l26.722"></a><span id="l26.722" class="difflineminus">-    var foundEngine = false;</span>
<a href="#l26.723"></a><span id="l26.723" class="difflineminus">-    var itemNode;</span>
<a href="#l26.724"></a><span id="l26.724" class="difflineminus">-    var engineBox = document.getElementById(&quot;searchengines&quot;);</span>
<a href="#l26.725"></a><span id="l26.725" class="difflineminus">-</span>
<a href="#l26.726"></a><span id="l26.726" class="difflineminus">-    // in advanced search mode, get selected search engines</span>
<a href="#l26.727"></a><span id="l26.727" class="difflineminus">-    // (for the current search category)</span>
<a href="#l26.728"></a><span id="l26.728" class="difflineminus">-    for (var x = 0; x &lt; engineBox.childNodes.length; ++x) {</span>
<a href="#l26.729"></a><span id="l26.729" class="difflineminus">-      itemNode = engineBox.childNodes[x];</span>
<a href="#l26.730"></a><span id="l26.730" class="difflineminus">-</span>
<a href="#l26.731"></a><span id="l26.731" class="difflineminus">-      if (itemNode.localName == &quot;listitem&quot; &amp;&amp; itemNode.checked) {</span>
<a href="#l26.732"></a><span id="l26.732" class="difflineminus">-        var engineURI = itemNode.id;</span>
<a href="#l26.733"></a><span id="l26.733" class="difflineminus">-</span>
<a href="#l26.734"></a><span id="l26.734" class="difflineminus">-        if (engineURI) {</span>
<a href="#l26.735"></a><span id="l26.735" class="difflineminus">-          engineURIs[engineURIs.length] = engineURI;</span>
<a href="#l26.736"></a><span id="l26.736" class="difflineminus">-          foundEngine = true;</span>
<a href="#l26.737"></a><span id="l26.737" class="difflineminus">-        }</span>
<a href="#l26.738"></a><span id="l26.738" class="difflineminus">-      }</span>
<a href="#l26.739"></a><span id="l26.739" class="difflineminus">-    }</span>
<a href="#l26.740"></a><span id="l26.740" class="difflineminus">-</span>
<a href="#l26.741"></a><span id="l26.741" class="difflineminus">-    if (!foundEngine) {</span>
<a href="#l26.742"></a><span id="l26.742" class="difflineminus">-      if (getNumEngines() == 1) {</span>
<a href="#l26.743"></a><span id="l26.743" class="difflineminus">-        // only one engine in this category, check it</span>
<a href="#l26.744"></a><span id="l26.744" class="difflineminus">-        itemNode = engineBox.firstChild;</span>
<a href="#l26.745"></a><span id="l26.745" class="difflineminus">-        engineURIs[engineURIs.length] = itemNode.id;</span>
<a href="#l26.746"></a><span id="l26.746" class="difflineminus">-      }</span>
<a href="#l26.747"></a><span id="l26.747" class="difflineminus">-      else {</span>
<a href="#l26.748"></a><span id="l26.748" class="difflineminus">-        for (var i = 0; i &lt; engineBox.childNodes.length; ++i) {</span>
<a href="#l26.749"></a><span id="l26.749" class="difflineminus">-          itemNode = engineBox.childNodes[i];</span>
<a href="#l26.750"></a><span id="l26.750" class="difflineminus">-          var theID = itemNode.id;</span>
<a href="#l26.751"></a><span id="l26.751" class="difflineminus">-          if (theID.indexOf(&quot;google.src&quot;) != -1) {</span>
<a href="#l26.752"></a><span id="l26.752" class="difflineminus">-            engineURIs[engineURIs.length] = theID;</span>
<a href="#l26.753"></a><span id="l26.753" class="difflineminus">-            foundEngine = true;</span>
<a href="#l26.754"></a><span id="l26.754" class="difflineminus">-            break;</span>
<a href="#l26.755"></a><span id="l26.755" class="difflineminus">-          }</span>
<a href="#l26.756"></a><span id="l26.756" class="difflineminus">-        }</span>
<a href="#l26.757"></a><span id="l26.757" class="difflineminus">-</span>
<a href="#l26.758"></a><span id="l26.758" class="difflineminus">-        if (!foundEngine) {</span>
<a href="#l26.759"></a><span id="l26.759" class="difflineminus">-          alert(searchBundle.getString(&quot;enterstringandlocation&quot;));</span>
<a href="#l26.760"></a><span id="l26.760" class="difflineminus">-          return;</span>
<a href="#l26.761"></a><span id="l26.761" class="difflineminus">-        }</span>
<a href="#l26.762"></a><span id="l26.762" class="difflineminus">-      }</span>
<a href="#l26.763"></a><span id="l26.763" class="difflineminus">-    }</span>
<a href="#l26.764"></a><span id="l26.764" class="difflineminus">-  }</span>
<a href="#l26.765"></a><span id="l26.765" class="difflineminus">-  else</span>
<a href="#l26.766"></a><span id="l26.766" class="difflineminus">-  {</span>
<a href="#l26.767"></a><span id="l26.767" class="difflineminus">-    var basicEngines = document.getElementById(&quot;basicEngineMenu&quot;);</span>
<a href="#l26.768"></a><span id="l26.768" class="difflineminus">-    engineURIs[0] = basicEngines.selectedItem.id;</span>
<a href="#l26.769"></a><span id="l26.769" class="difflineminus">-    debug(&quot;basic mode URI = &quot; + engineURIs[0]);</span>
<a href="#l26.770"></a><span id="l26.770" class="difflineminus">-  }</span>
<a href="#l26.771"></a><span id="l26.771" class="difflineminus">-</span>
<a href="#l26.772"></a><span id="l26.772" class="difflineminus">-  if (!gStopButtonText)</span>
<a href="#l26.773"></a><span id="l26.773" class="difflineminus">-    gStopButtonText = searchBundle.getString(&quot;stopButtonText&quot;);</span>
<a href="#l26.774"></a><span id="l26.774" class="difflineminus">-</span>
<a href="#l26.775"></a><span id="l26.775" class="difflineminus">-  var searchButtonNode = document.getElementById(&quot;searchButton&quot;);</span>
<a href="#l26.776"></a><span id="l26.776" class="difflineminus">-  searchButtonNode.setAttribute(&quot;stop&quot;, &quot;true&quot;);</span>
<a href="#l26.777"></a><span id="l26.777" class="difflineminus">-  searchButtonNode.setAttribute(&quot;label&quot;, gStopButtonText);</span>
<a href="#l26.778"></a><span id="l26.778" class="difflineminus">-</span>
<a href="#l26.779"></a><span id="l26.779" class="difflineminus">-  var progressNode = top.document.getElementById(&quot;statusbar-icon&quot;);</span>
<a href="#l26.780"></a><span id="l26.780" class="difflineminus">-  if (progressNode)</span>
<a href="#l26.781"></a><span id="l26.781" class="difflineminus">-    progressNode.setAttribute(&quot;mode&quot;, &quot;undetermined&quot;);</span>
<a href="#l26.782"></a><span id="l26.782" class="difflineminus">-</span>
<a href="#l26.783"></a><span id="l26.783" class="difflineminus">-  // run the search</span>
<a href="#l26.784"></a><span id="l26.784" class="difflineminus">-  OpenSearch(textNode.value, engineURIs);</span>
<a href="#l26.785"></a><span id="l26.785" class="difflineminus">-  switchTab(0);</span>
<a href="#l26.786"></a><span id="l26.786" class="difflineminus">-}</span>
<a href="#l26.787"></a><span id="l26.787" class="difflineminus">-</span>
<a href="#l26.788"></a><span id="l26.788" class="difflineminus">-function checkSearchProgress()</span>
<a href="#l26.789"></a><span id="l26.789" class="difflineminus">-{</span>
<a href="#l26.790"></a><span id="l26.790" class="difflineminus">-  var activeSearchFlag = false;</span>
<a href="#l26.791"></a><span id="l26.791" class="difflineminus">-  var navWindow = getNavigatorWindow(false);</span>
<a href="#l26.792"></a><span id="l26.792" class="difflineminus">-</span>
<a href="#l26.793"></a><span id="l26.793" class="difflineminus">-  if (navWindow) {</span>
<a href="#l26.794"></a><span id="l26.794" class="difflineminus">-    var resultsList = navWindow.content.document.getElementById(&quot;resultsList&quot;);</span>
<a href="#l26.795"></a><span id="l26.795" class="difflineminus">-    if (resultsList) {</span>
<a href="#l26.796"></a><span id="l26.796" class="difflineminus">-      var treeref = resultsList.getAttribute(&quot;ref&quot;);</span>
<a href="#l26.797"></a><span id="l26.797" class="difflineminus">-      var ds = resultsList.database;</span>
<a href="#l26.798"></a><span id="l26.798" class="difflineminus">-      if (ds &amp;&amp; treeref) {</span>
<a href="#l26.799"></a><span id="l26.799" class="difflineminus">-        try {</span>
<a href="#l26.800"></a><span id="l26.800" class="difflineminus">-          var rdf = Components.classes[RDFSERVICE_CONTRACTID].getService(nsIRDFService);</span>
<a href="#l26.801"></a><span id="l26.801" class="difflineminus">-          var source = rdf.GetResource(treeref, true);</span>
<a href="#l26.802"></a><span id="l26.802" class="difflineminus">-          var loadingProperty = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#loading&quot;, true);</span>
<a href="#l26.803"></a><span id="l26.803" class="difflineminus">-          var target = ds.GetTarget(source, loadingProperty, true);</span>
<a href="#l26.804"></a><span id="l26.804" class="difflineminus">-          if (target)</span>
<a href="#l26.805"></a><span id="l26.805" class="difflineminus">-            target = target.QueryInterface(nsIRDFLiteral).Value;</span>
<a href="#l26.806"></a><span id="l26.806" class="difflineminus">-          activeSearchFlag = target == &quot;true&quot; ? true : false;</span>
<a href="#l26.807"></a><span id="l26.807" class="difflineminus">-        }</span>
<a href="#l26.808"></a><span id="l26.808" class="difflineminus">-        catch (ex) {</span>
<a href="#l26.809"></a><span id="l26.809" class="difflineminus">-          activeSearchFlag = false;</span>
<a href="#l26.810"></a><span id="l26.810" class="difflineminus">-        }</span>
<a href="#l26.811"></a><span id="l26.811" class="difflineminus">-      }</span>
<a href="#l26.812"></a><span id="l26.812" class="difflineminus">-    }</span>
<a href="#l26.813"></a><span id="l26.813" class="difflineminus">-  }</span>
<a href="#l26.814"></a><span id="l26.814" class="difflineminus">-</span>
<a href="#l26.815"></a><span id="l26.815" class="difflineminus">-  if (activeSearchFlag)</span>
<a href="#l26.816"></a><span id="l26.816" class="difflineminus">-    setTimeout(checkSearchProgress, 1000);</span>
<a href="#l26.817"></a><span id="l26.817" class="difflineminus">-  else</span>
<a href="#l26.818"></a><span id="l26.818" class="difflineminus">-    doStop();</span>
<a href="#l26.819"></a><span id="l26.819" class="difflineminus">-</span>
<a href="#l26.820"></a><span id="l26.820" class="difflineminus">-  return activeSearchFlag;</span>
<a href="#l26.821"></a><span id="l26.821" class="difflineminus">-}</span>
<a href="#l26.822"></a><span id="l26.822" class="difflineminus">-</span>
<a href="#l26.823"></a><span id="l26.823" class="difflineminus">-function sidebarOpenURL(listitem)</span>
<a href="#l26.824"></a><span id="l26.824" class="difflineminus">-{</span>
<a href="#l26.825"></a><span id="l26.825" class="difflineminus">-  var id = listitem.id;</span>
<a href="#l26.826"></a><span id="l26.826" class="difflineminus">-  if (!id)</span>
<a href="#l26.827"></a><span id="l26.827" class="difflineminus">-    return;</span>
<a href="#l26.828"></a><span id="l26.828" class="difflineminus">-</span>
<a href="#l26.829"></a><span id="l26.829" class="difflineminus">-  // rjc: add support for anonymous resources; if the node has</span>
<a href="#l26.830"></a><span id="l26.830" class="difflineminus">-  // a &quot;#URL&quot; property, use it, otherwise default to using the id</span>
<a href="#l26.831"></a><span id="l26.831" class="difflineminus">-  try {</span>
<a href="#l26.832"></a><span id="l26.832" class="difflineminus">-    var ds = document.getElementById(&quot;resultList&quot;).database;</span>
<a href="#l26.833"></a><span id="l26.833" class="difflineminus">-    if (ds) {</span>
<a href="#l26.834"></a><span id="l26.834" class="difflineminus">-      var rdf = Components.classes[RDFSERVICE_CONTRACTID].getService(nsIRDFService);</span>
<a href="#l26.835"></a><span id="l26.835" class="difflineminus">-      var src = rdf.GetResource(id, true);</span>
<a href="#l26.836"></a><span id="l26.836" class="difflineminus">-      var prop = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#URL&quot;, true);</span>
<a href="#l26.837"></a><span id="l26.837" class="difflineminus">-      var target = ds.GetTarget(src, prop, true);</span>
<a href="#l26.838"></a><span id="l26.838" class="difflineminus">-      if (target) {</span>
<a href="#l26.839"></a><span id="l26.839" class="difflineminus">-        target = target.QueryInterface(nsIRDFLiteral).Value;</span>
<a href="#l26.840"></a><span id="l26.840" class="difflineminus">-        if (target)</span>
<a href="#l26.841"></a><span id="l26.841" class="difflineminus">-          id = target;</span>
<a href="#l26.842"></a><span id="l26.842" class="difflineminus">-      }</span>
<a href="#l26.843"></a><span id="l26.843" class="difflineminus">-    }</span>
<a href="#l26.844"></a><span id="l26.844" class="difflineminus">-  } catch (ex) {</span>
<a href="#l26.845"></a><span id="l26.845" class="difflineminus">-  }</span>
<a href="#l26.846"></a><span id="l26.846" class="difflineminus">-</span>
<a href="#l26.847"></a><span id="l26.847" class="difflineminus">-  // mark result as visited</span>
<a href="#l26.848"></a><span id="l26.848" class="difflineminus">-  listitem.setAttribute(&quot;visited&quot;, &quot;true&quot;);</span>
<a href="#l26.849"></a><span id="l26.849" class="difflineminus">-  </span>
<a href="#l26.850"></a><span id="l26.850" class="difflineminus">-  loadURLInContent(id);</span>
<a href="#l26.851"></a><span id="l26.851" class="difflineplus">+function SelectEngine() {</span>
<a href="#l26.852"></a><span id="l26.852" class="difflineplus">+  if (menulist.selectedItem)</span>
<a href="#l26.853"></a><span id="l26.853" class="difflineplus">+    Services.search.currentEngine = menulist.selectedItem.engine;</span>
<a href="#l26.854"></a><span id="l26.854"> }</span>
<a href="#l26.855"></a><span id="l26.855"> </span>
<a href="#l26.856"></a><span id="l26.856" class="difflineminus">-function OpenSearch(aSearchStr, engineURIs)</span>
<a href="#l26.857"></a><span id="l26.857" class="difflineminus">-{</span>
<a href="#l26.858"></a><span id="l26.858" class="difflineminus">-  gPageNumber = 0;</span>
<a href="#l26.859"></a><span id="l26.859" class="difflineminus">-</span>
<a href="#l26.860"></a><span id="l26.860" class="difflineminus">-  var searchEngineURI = nsPreferences.copyUnicharPref(&quot;browser.search.defaultengine&quot;, null);</span>
<a href="#l26.861"></a><span id="l26.861" class="difflineminus">-  var defaultSearchURL = nsPreferences.getLocalizedUnicharPref(&quot;browser.search.defaulturl&quot;, null);</span>
<a href="#l26.862"></a><span id="l26.862" class="difflineminus">-</span>
<a href="#l26.863"></a><span id="l26.863" class="difflineminus">-  if (!defaultSearchURL) {</span>
<a href="#l26.864"></a><span id="l26.864" class="difflineminus">-    regionalBundle = document.getElementById(&quot;regionalBundle&quot;);</span>
<a href="#l26.865"></a><span id="l26.865" class="difflineminus">-    defaultSearchURL = regionalBundle.getString(&quot;defaultSearchURL&quot;);</span>
<a href="#l26.866"></a><span id="l26.866" class="difflineminus">-  }</span>
<a href="#l26.867"></a><span id="l26.867" class="difflineminus">-</span>
<a href="#l26.868"></a><span id="l26.868" class="difflineminus">-  var searchDS = Components.classes[ISEARCH_CONTRACTID].getService(nsIInternetSearchService);</span>
<a href="#l26.869"></a><span id="l26.869" class="difflineminus">-</span>
<a href="#l26.870"></a><span id="l26.870" class="difflineminus">-  var escapedSearchStr = encodeURIComponent(aSearchStr);</span>
<a href="#l26.871"></a><span id="l26.871" class="difflineminus">-  sidebarInitiatedSearch = true;</span>
<a href="#l26.872"></a><span id="l26.872" class="difflineminus">-  searchDS.RememberLastSearchText(escapedSearchStr);</span>
<a href="#l26.873"></a><span id="l26.873" class="difflineminus">-  sidebarInitiatedSearch = false;</span>
<a href="#l26.874"></a><span id="l26.874" class="difflineminus">-</span>
<a href="#l26.875"></a><span id="l26.875" class="difflineminus">-  var gURL;</span>
<a href="#l26.876"></a><span id="l26.876" class="difflineminus">-  try {</span>
<a href="#l26.877"></a><span id="l26.877" class="difflineminus">-    if (!engineURIs || engineURIs.length &lt;= 1) {</span>
<a href="#l26.878"></a><span id="l26.878" class="difflineminus">-      // not called from sidebar or only one engine selected</span>
<a href="#l26.879"></a><span id="l26.879" class="difflineminus">-      if (engineURIs &amp;&amp; engineURIs.length == 1) {</span>
<a href="#l26.880"></a><span id="l26.880" class="difflineminus">-        searchEngineURI = engineURIs[0];</span>
<a href="#l26.881"></a><span id="l26.881" class="difflineminus">-        gURL = &quot;internetsearch:engine=&quot; + searchEngineURI + &quot;&amp;text=&quot; + escapedSearchStr;</span>
<a href="#l26.882"></a><span id="l26.882" class="difflineminus">-      }</span>
<a href="#l26.883"></a><span id="l26.883" class="difflineminus">-</span>
<a href="#l26.884"></a><span id="l26.884" class="difflineminus">-      if (!searchEngineURI)</span>
<a href="#l26.885"></a><span id="l26.885" class="difflineminus">-        searchEngineURI = regionalBundle.getString(&quot;defaultSearchURL&quot;);</span>
<a href="#l26.886"></a><span id="l26.886" class="difflineminus">-</span>
<a href="#l26.887"></a><span id="l26.887" class="difflineminus">-      // look up the correct search URL format for the given engine</span>
<a href="#l26.888"></a><span id="l26.888" class="difflineminus">-      try {</span>
<a href="#l26.889"></a><span id="l26.889" class="difflineminus">-        var whichButtons = new Object;</span>
<a href="#l26.890"></a><span id="l26.890" class="difflineminus">-        whichButtons.value = 0;</span>
<a href="#l26.891"></a><span id="l26.891" class="difflineminus">-        var searchURL = searchDS.GetInternetSearchURL(searchEngineURI, escapedSearchStr, 0, 0, whichButtons);</span>
<a href="#l26.892"></a><span id="l26.892" class="difflineminus">-        doNavButtonEnabling(whichButtons.value, searchDS, 0);</span>
<a href="#l26.893"></a><span id="l26.893" class="difflineminus">-      }</span>
<a href="#l26.894"></a><span id="l26.894" class="difflineminus">-      catch (ex) {</span>
<a href="#l26.895"></a><span id="l26.895" class="difflineminus">-        debug(&quot;Exception when calling GetInternetSearchURL: &quot; + ex);</span>
<a href="#l26.896"></a><span id="l26.896" class="difflineminus">-        searchURL = &quot;&quot;;</span>
<a href="#l26.897"></a><span id="l26.897" class="difflineminus">-      }</span>
<a href="#l26.898"></a><span id="l26.898" class="difflineminus">-</span>
<a href="#l26.899"></a><span id="l26.899" class="difflineminus">-      defaultSearchURL = searchURL ? searchURL : defaultSearchURL + escapedSearchStr;</span>
<a href="#l26.900"></a><span id="l26.900" class="difflineminus">-      if (!searchURL)</span>
<a href="#l26.901"></a><span id="l26.901" class="difflineminus">-        gURL = &quot;&quot;;</span>
<a href="#l26.902"></a><span id="l26.902" class="difflineplus">+function doSearch() {</span>
<a href="#l26.903"></a><span id="l26.903" class="difflineplus">+  var textValue = textbox.value;</span>
<a href="#l26.904"></a><span id="l26.904"> </span>
<a href="#l26.905"></a><span id="l26.905" class="difflineminus">-      // load the results page of selected or default engine in the content area</span>
<a href="#l26.906"></a><span id="l26.906" class="difflineminus">-      if (defaultSearchURL)</span>
<a href="#l26.907"></a><span id="l26.907" class="difflineminus">-        loadURLInContent(defaultSearchURL);</span>
<a href="#l26.908"></a><span id="l26.908" class="difflineminus">-    }</span>
<a href="#l26.909"></a><span id="l26.909" class="difflineminus">-    else {</span>
<a href="#l26.910"></a><span id="l26.910" class="difflineminus">-      // multiple providers</span>
<a href="#l26.911"></a><span id="l26.911" class="difflineminus">-      searchURL = &quot;&quot;;</span>
<a href="#l26.912"></a><span id="l26.912" class="difflineminus">-      for (var i = 0; i &lt; engineURIs.length; ++i) {</span>
<a href="#l26.913"></a><span id="l26.913" class="difflineminus">-        searchURL += !searchURL ? &quot;internetsearch:&quot; : &quot;&amp;&quot;;</span>
<a href="#l26.914"></a><span id="l26.914" class="difflineminus">-        searchURL += &quot;engine=&quot; + engineURIs[i];</span>
<a href="#l26.915"></a><span id="l26.915" class="difflineminus">-      }</span>
<a href="#l26.916"></a><span id="l26.916" class="difflineminus">-      searchURL += (&quot;&amp;text=&quot; + escapedSearchStr);</span>
<a href="#l26.917"></a><span id="l26.917" class="difflineminus">-      gURL = searchURL;</span>
<a href="#l26.918"></a><span id="l26.918" class="difflineminus">-      loadURLInContent(encodeURI(&quot;chrome://communicator/content/search/internetresults.xul?&quot; + searchURL));</span>
<a href="#l26.919"></a><span id="l26.919" class="difflineminus">-    }</span>
<a href="#l26.920"></a><span id="l26.920" class="difflineminus">-  }</span>
<a href="#l26.921"></a><span id="l26.921" class="difflineminus">-  catch (ex) {</span>
<a href="#l26.922"></a><span id="l26.922" class="difflineminus">-    debug(&quot;Exception: &quot; + ex);</span>
<a href="#l26.923"></a><span id="l26.923" class="difflineminus">-  }</span>
<a href="#l26.924"></a><span id="l26.924" class="difflineminus">-</span>
<a href="#l26.925"></a><span id="l26.925" class="difflineminus">-  setTimeout(checkSearchProgress, 1000);</span>
<a href="#l26.926"></a><span id="l26.926" class="difflineminus">-}</span>
<a href="#l26.927"></a><span id="l26.927" class="difflineminus">-</span>
<a href="#l26.928"></a><span id="l26.928" class="difflineminus">-function saveSearch()</span>
<a href="#l26.929"></a><span id="l26.929" class="difflineminus">-{</span>
<a href="#l26.930"></a><span id="l26.930" class="difflineminus">-  var ds = document.getElementById(&quot;resultList&quot;).database;</span>
<a href="#l26.931"></a><span id="l26.931" class="difflineminus">-  if (!ds)</span>
<a href="#l26.932"></a><span id="l26.932" class="difflineminus">-    return;</span>
<a href="#l26.933"></a><span id="l26.933" class="difflineminus">-</span>
<a href="#l26.934"></a><span id="l26.934" class="difflineminus">-  var lastSearchURI = &quot;&quot;;</span>
<a href="#l26.935"></a><span id="l26.935" class="difflineminus">-  var lastSearchText = &quot;&quot;;</span>
<a href="#l26.936"></a><span id="l26.936" class="difflineplus">+  var where = Services.prefs.getBoolPref(&quot;browser.search.openintab&quot;) ? &quot;tab&quot; : &quot;current&quot;;</span>
<a href="#l26.937"></a><span id="l26.937"> </span>
<a href="#l26.938"></a><span id="l26.938" class="difflineminus">-  var rdf = Components.classes[RDFSERVICE_CONTRACTID].getService(nsIRDFService);</span>
<a href="#l26.939"></a><span id="l26.939" class="difflineminus">-  // look for last search URI</span>
<a href="#l26.940"></a><span id="l26.940" class="difflineminus">-  var source = rdf.GetResource(&quot;NC:LastSearchRoot&quot;, true);</span>
<a href="#l26.941"></a><span id="l26.941" class="difflineminus">-  var childProperty = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#ref&quot;, true);</span>
<a href="#l26.942"></a><span id="l26.942" class="difflineminus">-  var target = ds.GetTarget(source, childProperty, true);</span>
<a href="#l26.943"></a><span id="l26.943" class="difflineminus">-  if (target) {</span>
<a href="#l26.944"></a><span id="l26.944" class="difflineminus">-    target = target.QueryInterface(nsIRDFLiteral).Value;</span>
<a href="#l26.945"></a><span id="l26.945" class="difflineminus">-    if (target)</span>
<a href="#l26.946"></a><span id="l26.946" class="difflineminus">-      lastSearchURI = target;</span>
<a href="#l26.947"></a><span id="l26.947" class="difflineminus">-  }</span>
<a href="#l26.948"></a><span id="l26.948" class="difflineminus">-</span>
<a href="#l26.949"></a><span id="l26.949" class="difflineminus">-  // look for last search text</span>
<a href="#l26.950"></a><span id="l26.950" class="difflineminus">-  childProperty = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#LastText&quot;, true);</span>
<a href="#l26.951"></a><span id="l26.951" class="difflineminus">-  target = ds.GetTarget(source, childProperty, true);</span>
<a href="#l26.952"></a><span id="l26.952" class="difflineminus">-  if (target) {</span>
<a href="#l26.953"></a><span id="l26.953" class="difflineminus">-    target = target.QueryInterface(nsIRDFLiteral).Value;</span>
<a href="#l26.954"></a><span id="l26.954" class="difflineminus">-    if (target) {</span>
<a href="#l26.955"></a><span id="l26.955" class="difflineminus">-      // convert plusses (+) back to spaces</span>
<a href="#l26.956"></a><span id="l26.956" class="difflineminus">-      target = target.replace(/\+/g, &quot; &quot;);</span>
<a href="#l26.957"></a><span id="l26.957" class="difflineminus">-      lastSearchText = decodeURIComponent(target);</span>
<a href="#l26.958"></a><span id="l26.958" class="difflineminus">-    }</span>
<a href="#l26.959"></a><span id="l26.959" class="difflineminus">-  }</span>
<a href="#l26.960"></a><span id="l26.960" class="difflineminus">-</span>
<a href="#l26.961"></a><span id="l26.961" class="difflineminus">-  if (!lastSearchURI)</span>
<a href="#l26.962"></a><span id="l26.962" class="difflineminus">-    return;</span>
<a href="#l26.963"></a><span id="l26.963" class="difflineminus">-</span>
<a href="#l26.964"></a><span id="l26.964" class="difflineminus">-  // rjc says: if lastSearchText is empty/null, that's still OK, synthesize the text</span>
<a href="#l26.965"></a><span id="l26.965" class="difflineminus">-  if (!lastSearchText) {</span>
<a href="#l26.966"></a><span id="l26.966" class="difflineminus">-    lastSearchText = lastSearchURI;</span>
<a href="#l26.967"></a><span id="l26.967" class="difflineminus">-    var siteOffset = lastSearchText.indexOf(&quot;://&quot;);</span>
<a href="#l26.968"></a><span id="l26.968" class="difflineminus">-    if (siteOffset &gt; 0) {</span>
<a href="#l26.969"></a><span id="l26.969" class="difflineminus">-      siteOffset += 3;</span>
<a href="#l26.970"></a><span id="l26.970" class="difflineminus">-      var endOffset = lastSearchText.indexOf(&quot;/&quot;, siteOffset);</span>
<a href="#l26.971"></a><span id="l26.971" class="difflineminus">-      if (endOffset &gt; 0)</span>
<a href="#l26.972"></a><span id="l26.972" class="difflineminus">-        lastSearchText = lastSearchText.substr(0, endOffset+1);</span>
<a href="#l26.973"></a><span id="l26.973" class="difflineminus">-    }</span>
<a href="#l26.974"></a><span id="l26.974" class="difflineminus">-  }</span>
<a href="#l26.975"></a><span id="l26.975" class="difflineminus">-</span>
<a href="#l26.976"></a><span id="l26.976" class="difflineminus">-  var searchTitle = searchBundle.stringBundle.formatStringFromName(</span>
<a href="#l26.977"></a><span id="l26.977" class="difflineminus">-                      &quot;searchTitle&quot;, [lastSearchText], 1);</span>
<a href="#l26.978"></a><span id="l26.978" class="difflineminus">-</span>
<a href="#l26.979"></a><span id="l26.979" class="difflineminus">-  // XXXplaces: add lastSearchURI to bookmarks with searchTitle</span>
<a href="#l26.980"></a><span id="l26.980" class="difflineplus">+  var submission = Services.search.currentEngine.getSubmission(textValue);</span>
<a href="#l26.981"></a><span id="l26.981" class="difflineplus">+  openUILinkIn(submission.uri.spec, where, null, submission.postData);</span>
<a href="#l26.982"></a><span id="l26.982"> }</span>
<a href="#l26.983"></a><span id="l26.983"> </span>
<a href="#l26.984"></a><span id="l26.984" class="difflineminus">-var gPageNumber = 0;</span>
<a href="#l26.985"></a><span id="l26.985" class="difflineminus">-/**</span>
<a href="#l26.986"></a><span id="l26.986" class="difflineminus">- * showMoreResults</span>
<a href="#l26.987"></a><span id="l26.987" class="difflineminus">- *</span>
<a href="#l26.988"></a><span id="l26.988" class="difflineminus">- * Run a query to show the next/previous page of search results for the</span>
<a href="#l26.989"></a><span id="l26.989" class="difflineminus">- * current search term.</span>
<a href="#l26.990"></a><span id="l26.990" class="difflineminus">- * </span>
<a href="#l26.991"></a><span id="l26.991" class="difflineminus">- * @param direction : -1 =&gt; previous</span>
<a href="#l26.992"></a><span id="l26.992" class="difflineminus">- *                     1 =&gt; next</span>
<a href="#l26.993"></a><span id="l26.993" class="difflineminus">- */</span>
<a href="#l26.994"></a><span id="l26.994" class="difflineminus">-function showMoreResults(direction)</span>
<a href="#l26.995"></a><span id="l26.995" class="difflineminus">-{</span>
<a href="#l26.996"></a><span id="l26.996" class="difflineminus">-  // XXX check if we are in basic search mode</span>
<a href="#l26.997"></a><span id="l26.997" class="difflineminus">-</span>
<a href="#l26.998"></a><span id="l26.998" class="difflineminus">-  // get search engine</span>
<a href="#l26.999"></a><span id="l26.999" class="difflineminus">-  var engine = document.getElementById(&quot;basicEngineMenu&quot;).selectedItem;</span>
<a href="#l26.1000"></a><span id="l26.1000" class="difflineminus">-  var engineURI = engine.id;</span>
<a href="#l26.1001"></a><span id="l26.1001" class="difflineminus">-</span>
<a href="#l26.1002"></a><span id="l26.1002" class="difflineminus">-  // get search term</span>
<a href="#l26.1003"></a><span id="l26.1003" class="difflineminus">-  var searchTerm = document.getElementById(&quot;sidebar-search-text&quot;).value;</span>
<a href="#l26.1004"></a><span id="l26.1004" class="difflineminus">-  searchTerm = encodeURIComponent(searchTerm);</span>
<a href="#l26.1005"></a><span id="l26.1005" class="difflineminus">-</span>
<a href="#l26.1006"></a><span id="l26.1006" class="difflineminus">-  // change page number</span>
<a href="#l26.1007"></a><span id="l26.1007" class="difflineminus">-  if (direction &gt; 0)</span>
<a href="#l26.1008"></a><span id="l26.1008" class="difflineminus">-    ++gPageNumber;</span>
<a href="#l26.1009"></a><span id="l26.1009" class="difflineminus">-  else</span>
<a href="#l26.1010"></a><span id="l26.1010" class="difflineminus">-    --gPageNumber;</span>
<a href="#l26.1011"></a><span id="l26.1011" class="difflineminus">-</span>
<a href="#l26.1012"></a><span id="l26.1012" class="difflineminus">-  // get qualified URL</span>
<a href="#l26.1013"></a><span id="l26.1013" class="difflineminus">-  var searchService = Components.classes[ISEARCH_CONTRACTID].</span>
<a href="#l26.1014"></a><span id="l26.1014" class="difflineminus">-                        getService(nsIInternetSearchService);</span>
<a href="#l26.1015"></a><span id="l26.1015" class="difflineminus">-  var whichButtons = new Object;</span>
<a href="#l26.1016"></a><span id="l26.1016" class="difflineminus">-  whichButtons.value = 0;</span>
<a href="#l26.1017"></a><span id="l26.1017" class="difflineminus">-  var searchURL = searchService.GetInternetSearchURL(engineURI, searchTerm, </span>
<a href="#l26.1018"></a><span id="l26.1018" class="difflineminus">-                    direction, gPageNumber, whichButtons);</span>
<a href="#l26.1019"></a><span id="l26.1019" class="difflineminus">-</span>
<a href="#l26.1020"></a><span id="l26.1020" class="difflineminus">-  doNavButtonEnabling(whichButtons.value, searchService, gPageNumber);</span>
<a href="#l26.1021"></a><span id="l26.1021" class="difflineminus">-</span>
<a href="#l26.1022"></a><span id="l26.1022" class="difflineminus">-  // load URL in navigator</span>
<a href="#l26.1023"></a><span id="l26.1023" class="difflineminus">-  loadURLInContent(searchURL);</span>
<a href="#l26.1024"></a><span id="l26.1024" class="difflineminus">-}</span>
<a href="#l26.1025"></a><span id="l26.1025" class="difflineminus">-</span>
<a href="#l26.1026"></a><span id="l26.1026" class="difflineminus">-function doNavButtonEnabling(whichButtons, searchService, pageNumber)</span>
<a href="#l26.1027"></a><span id="l26.1027" class="difflineminus">-{</span>
<a href="#l26.1028"></a><span id="l26.1028" class="difflineminus">-  var nextButton = document.getElementById(&quot;next-results&quot;);</span>
<a href="#l26.1029"></a><span id="l26.1029" class="difflineminus">-  var nextDisabled = nextButton.getAttribute(&quot;disabled&quot;);</span>
<a href="#l26.1030"></a><span id="l26.1030" class="difflineminus">-  var prevButton = document.getElementById(&quot;prev-results&quot;);</span>
<a href="#l26.1031"></a><span id="l26.1031" class="difflineminus">-  var prevDisabled = prevButton.getAttribute(&quot;disabled&quot;);</span>
<a href="#l26.1032"></a><span id="l26.1032" class="difflineminus">-</span>
<a href="#l26.1033"></a><span id="l26.1033" class="difflineminus">-  if (whichButtons &amp; searchService.kHaveNext)</span>
<a href="#l26.1034"></a><span id="l26.1034" class="difflineminus">-  {</span>
<a href="#l26.1035"></a><span id="l26.1035" class="difflineminus">-    if (nextDisabled)</span>
<a href="#l26.1036"></a><span id="l26.1036" class="difflineminus">-      nextButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l26.1037"></a><span id="l26.1037" class="difflineminus">-  }</span>
<a href="#l26.1038"></a><span id="l26.1038" class="difflineminus">-  else </span>
<a href="#l26.1039"></a><span id="l26.1039" class="difflineminus">-  {</span>
<a href="#l26.1040"></a><span id="l26.1040" class="difflineminus">-    if (!nextDisabled)</span>
<a href="#l26.1041"></a><span id="l26.1041" class="difflineminus">-      nextButton.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l26.1042"></a><span id="l26.1042" class="difflineminus">-  }</span>
<a href="#l26.1043"></a><span id="l26.1043" class="difflineminus">-  </span>
<a href="#l26.1044"></a><span id="l26.1044" class="difflineminus">-  if ((pageNumber &gt; 0) &amp;&amp; (whichButtons &amp; searchService.kHavePrev))</span>
<a href="#l26.1045"></a><span id="l26.1045" class="difflineminus">-  {</span>
<a href="#l26.1046"></a><span id="l26.1046" class="difflineminus">-    if (prevDisabled)</span>
<a href="#l26.1047"></a><span id="l26.1047" class="difflineminus">-      prevButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l26.1048"></a><span id="l26.1048" class="difflineminus">-  }</span>
<a href="#l26.1049"></a><span id="l26.1049" class="difflineminus">-  else </span>
<a href="#l26.1050"></a><span id="l26.1050" class="difflineminus">-  {</span>
<a href="#l26.1051"></a><span id="l26.1051" class="difflineminus">-    if (!prevDisabled)</span>
<a href="#l26.1052"></a><span id="l26.1052" class="difflineminus">-      prevButton.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l26.1053"></a><span id="l26.1053" class="difflineplus">+var engineObserver = {</span>
<a href="#l26.1054"></a><span id="l26.1054" class="difflineplus">+  observe: function(aEngine, aTopic, aVerb) {</span>
<a href="#l26.1055"></a><span id="l26.1055" class="difflineplus">+    if (aTopic == SEARCH_ENGINE_TOPIC) {</span>
<a href="#l26.1056"></a><span id="l26.1056" class="difflineplus">+      if (aVerb == &quot;engine-current&quot;)</span>
<a href="#l26.1057"></a><span id="l26.1057" class="difflineplus">+        return;</span>
<a href="#l26.1058"></a><span id="l26.1058" class="difflineplus">+      // Right now, always just rebuild the list after any modification.</span>
<a href="#l26.1059"></a><span id="l26.1059" class="difflineplus">+      LoadEngineList();</span>
<a href="#l26.1060"></a><span id="l26.1060" class="difflineplus">+    }</span>
<a href="#l26.1061"></a><span id="l26.1061">   }</span>
<a href="#l26.1062"></a><span id="l26.1062" class="difflineminus">-}</span>
<a href="#l26.1063"></a><span id="l26.1063" class="difflineminus">-</span>
<a href="#l26.1064"></a><span id="l26.1064" class="difflineminus">-function doCustomize()</span>
<a href="#l26.1065"></a><span id="l26.1065" class="difflineminus">-{</span>
<a href="#l26.1066"></a><span id="l26.1066" class="difflineminus">-  //Switching from Edit Categories back to All Engines then launching customize window</span>
<a href="#l26.1067"></a><span id="l26.1067" class="difflineminus">-  var category = document.getElementById(&quot;categoryList&quot;);</span>
<a href="#l26.1068"></a><span id="l26.1068" class="difflineminus">-  category.selectedIndex = 0;</span>
<a href="#l26.1069"></a><span id="l26.1069" class="difflineminus">-  window.openDialog(&quot;chrome://communicator/content/search/search-editor.xul&quot;, &quot;internetsearch:editor&quot;, &quot;centerscreen,chrome,resizable&quot;);</span>
<a href="#l26.1070"></a><span id="l26.1070" class="difflineminus">-}</span>
<a href="#l26.1071"></a><span id="l26.1071" class="difflineminus">-</span>
<a href="#l26.1072"></a><span id="l26.1072" class="difflineminus">-function loadURLInContent(url)</span>
<a href="#l26.1073"></a><span id="l26.1073" class="difflineminus">-{</span>
<a href="#l26.1074"></a><span id="l26.1074" class="difflineminus">-  var navigatorWindow = getNavigatorWindow(true);</span>
<a href="#l26.1075"></a><span id="l26.1075" class="difflineminus">-  navigatorWindow.loadURI(url);</span>
<a href="#l26.1076"></a><span id="l26.1076" class="difflineminus">-}</span>
<a href="#l26.1077"></a><span id="l26.1077" class="difflineminus">-</span>
<a href="#l26.1078"></a><span id="l26.1078" class="difflineminus">-function search_getBrowserURL()</span>
<a href="#l26.1079"></a><span id="l26.1079" class="difflineminus">-{</span>
<a href="#l26.1080"></a><span id="l26.1080" class="difflineminus">-  return nsPreferences.copyUnicharPref(&quot;browser.chromeURL&quot;, &quot;chrome://navigator/content/navigator.xul&quot;);</span>
<a href="#l26.1081"></a><span id="l26.1081" class="difflineminus">-}</span>
<a href="#l26.1082"></a><span id="l26.1082" class="difflineminus">-</span>
<a href="#l26.1083"></a><span id="l26.1083" class="difflineminus">-function doEnabling()</span>
<a href="#l26.1084"></a><span id="l26.1084" class="difflineminus">-{</span>
<a href="#l26.1085"></a><span id="l26.1085" class="difflineminus">-  var searchButton = document.getElementById(&quot;searchButton&quot;);</span>
<a href="#l26.1086"></a><span id="l26.1086" class="difflineminus">-  var sidebarSearchText = document.getElementById(&quot;sidebar-search-text&quot;);</span>
<a href="#l26.1087"></a><span id="l26.1087" class="difflineminus">-  searchButton.disabled = !sidebarSearchText.value;</span>
<a href="#l26.1088"></a><span id="l26.1088" class="difflineminus">-}</span>
<a href="#l26.1089"></a><span id="l26.1089" class="difflineminus">-</span>
<a href="#l26.1090"></a><span id="l26.1090" class="difflineminus">-//Step up the dom until getting the desired node.</span>
<a href="#l26.1091"></a><span id="l26.1091" class="difflineminus">-function getItemNode(aNode,nodeName)</span>
<a href="#l26.1092"></a><span id="l26.1092" class="difflineminus">-{</span>
<a href="#l26.1093"></a><span id="l26.1093" class="difflineminus">-  var node = aNode;</span>
<a href="#l26.1094"></a><span id="l26.1094" class="difflineminus">-  while (node.localName != nodeName) {</span>
<a href="#l26.1095"></a><span id="l26.1095" class="difflineminus">-    node = node.parentNode;</span>
<a href="#l26.1096"></a><span id="l26.1096" class="difflineminus">-  }</span>
<a href="#l26.1097"></a><span id="l26.1097" class="difflineminus">-  return node ? node : null;</span>
<a href="#l26.1098"></a><span id="l26.1098" class="difflineminus">-}</span>
<a href="#l26.1099"></a><span id="l26.1099" class="difflineminus">-</span>
<a href="#l26.1100"></a><span id="l26.1100" class="difflineminus">-function getArcValueForID(aArc, aID)</span>
<a href="#l26.1101"></a><span id="l26.1101" class="difflineminus">-{</span>
<a href="#l26.1102"></a><span id="l26.1102" class="difflineminus">-  var val = null;</span>
<a href="#l26.1103"></a><span id="l26.1103" class="difflineminus">-</span>
<a href="#l26.1104"></a><span id="l26.1104" class="difflineminus">-  try</span>
<a href="#l26.1105"></a><span id="l26.1105" class="difflineminus">-  {</span>
<a href="#l26.1106"></a><span id="l26.1106" class="difflineminus">-    var ds = document.getElementById(&quot;resultList&quot;).database;</span>
<a href="#l26.1107"></a><span id="l26.1107" class="difflineminus">-    if (ds)</span>
<a href="#l26.1108"></a><span id="l26.1108" class="difflineminus">-    {</span>
<a href="#l26.1109"></a><span id="l26.1109" class="difflineminus">-      var rdf = Components.classes[RDFSERVICE_CONTRACTID].</span>
<a href="#l26.1110"></a><span id="l26.1110" class="difflineminus">-                  getService(nsIRDFService);</span>
<a href="#l26.1111"></a><span id="l26.1111" class="difflineminus">-      var src = rdf.GetResource(aID, true);</span>
<a href="#l26.1112"></a><span id="l26.1112" class="difflineminus">-      var prop = rdf.GetResource(</span>
<a href="#l26.1113"></a><span id="l26.1113" class="difflineminus">-                  &quot;http://home.netscape.com/NC-rdf#&quot;+aArc, true);</span>
<a href="#l26.1114"></a><span id="l26.1114" class="difflineminus">-      val = ds.GetTarget(src, prop, true);        </span>
<a href="#l26.1115"></a><span id="l26.1115" class="difflineminus">-      if (val)</span>
<a href="#l26.1116"></a><span id="l26.1116" class="difflineminus">-        val = val.QueryInterface(nsIRDFLiteral).Value;</span>
<a href="#l26.1117"></a><span id="l26.1117" class="difflineminus">-    }</span>
<a href="#l26.1118"></a><span id="l26.1118" class="difflineminus">-  } </span>
<a href="#l26.1119"></a><span id="l26.1119" class="difflineminus">-  catch (ex)</span>
<a href="#l26.1120"></a><span id="l26.1120" class="difflineminus">-  {</span>
<a href="#l26.1121"></a><span id="l26.1121" class="difflineminus">-    dump(&quot;Exception: no value for &quot; + aArc + &quot;!\t&quot; + ex + &quot;\n&quot;);</span>
<a href="#l26.1122"></a><span id="l26.1122" class="difflineminus">-    val = null;</span>
<a href="#l26.1123"></a><span id="l26.1123" class="difflineminus">-  }</span>
<a href="#l26.1124"></a><span id="l26.1124" class="difflineminus">-</span>
<a href="#l26.1125"></a><span id="l26.1125" class="difflineminus">-  return val;</span>
<a href="#l26.1126"></a><span id="l26.1126" class="difflineminus">-}</span>
<a href="#l26.1127"></a><span id="l26.1127" class="difflineminus">-</span>
<a href="#l26.1128"></a><span id="l26.1128" class="difflineminus">-//Fill in tooltip in the search results panel</span>
<a href="#l26.1129"></a><span id="l26.1129" class="difflineminus">-function FillInDescTooltip(tipElement)</span>
<a href="#l26.1130"></a><span id="l26.1130" class="difflineminus">-{</span>
<a href="#l26.1131"></a><span id="l26.1131" class="difflineminus">-  var retValue = false;</span>
<a href="#l26.1132"></a><span id="l26.1132" class="difflineminus">- </span>
<a href="#l26.1133"></a><span id="l26.1133" class="difflineminus">-  //Get the Name of the listitem for first item in the tooltip</span>
<a href="#l26.1134"></a><span id="l26.1134" class="difflineminus">-  var nodeLabel = tipElement.getAttribute(&quot;label&quot;);</span>
<a href="#l26.1135"></a><span id="l26.1135" class="difflineminus">-  var nodeID = tipElement.id;</span>
<a href="#l26.1136"></a><span id="l26.1136" class="difflineminus">- </span>
<a href="#l26.1137"></a><span id="l26.1137" class="difflineminus">-  //Query RDF to get URL of listitem</span>
<a href="#l26.1138"></a><span id="l26.1138" class="difflineminus">-  if (nodeID)</span>
<a href="#l26.1139"></a><span id="l26.1139" class="difflineminus">-    var url = getArcValueForID(&quot;URL&quot;, nodeID);</span>
<a href="#l26.1140"></a><span id="l26.1140" class="difflineminus">-</span>
<a href="#l26.1141"></a><span id="l26.1141" class="difflineminus">-  //Fill in the the text nodes</span>
<a href="#l26.1142"></a><span id="l26.1142" class="difflineminus">-  //collapse them if there is not a node</span>
<a href="#l26.1143"></a><span id="l26.1143" class="difflineminus">-  if (nodeLabel || url) {</span>
<a href="#l26.1144"></a><span id="l26.1144" class="difflineminus">-    var tooltipTitle = document.getElementById(&quot;titleText&quot;);</span>
<a href="#l26.1145"></a><span id="l26.1145" class="difflineminus">-    var tooltipUrl = document.getElementById(&quot;urlText&quot;); </span>
<a href="#l26.1146"></a><span id="l26.1146" class="difflineminus">-    if (nodeLabel) {</span>
<a href="#l26.1147"></a><span id="l26.1147" class="difflineminus">-      if (tooltipTitle.getAttribute(&quot;hidden&quot;) == &quot;true&quot;)</span>
<a href="#l26.1148"></a><span id="l26.1148" class="difflineminus">-        tooltipTitle.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l26.1149"></a><span id="l26.1149" class="difflineminus">-      tooltipTitle.setAttribute(&quot;value&quot;,nodeLabel);</span>
<a href="#l26.1150"></a><span id="l26.1150" class="difflineminus">-    } </span>
<a href="#l26.1151"></a><span id="l26.1151" class="difflineminus">-    else  {</span>
<a href="#l26.1152"></a><span id="l26.1152" class="difflineminus">-      tooltipTitle.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l26.1153"></a><span id="l26.1153" class="difflineminus">-    }</span>
<a href="#l26.1154"></a><span id="l26.1154" class="difflineminus">-    if (url) {</span>
<a href="#l26.1155"></a><span id="l26.1155" class="difflineminus">-      if (tooltipUrl.getAttribute(&quot;hidden&quot;) == &quot;true&quot;)</span>
<a href="#l26.1156"></a><span id="l26.1156" class="difflineminus">-        tooltipUrl.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l26.1157"></a><span id="l26.1157" class="difflineminus">-      if (url.length &gt; 100)</span>
<a href="#l26.1158"></a><span id="l26.1158" class="difflineminus">-        url = url.substr(0,100) + &quot;...&quot;;</span>
<a href="#l26.1159"></a><span id="l26.1159" class="difflineminus">-      tooltipUrl.setAttribute(&quot;value&quot;,url);</span>
<a href="#l26.1160"></a><span id="l26.1160" class="difflineminus">-    }</span>
<a href="#l26.1161"></a><span id="l26.1161" class="difflineminus">-    else {</span>
<a href="#l26.1162"></a><span id="l26.1162" class="difflineminus">-      tooltipUrl.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l26.1163"></a><span id="l26.1163" class="difflineminus">-    }</span>
<a href="#l26.1164"></a><span id="l26.1164" class="difflineminus">-    retValue = true;</span>
<a href="#l26.1165"></a><span id="l26.1165" class="difflineminus">-  }</span>
<a href="#l26.1166"></a><span id="l26.1166" class="difflineminus">-  return retValue;</span>
<a href="#l26.1167"></a><span id="l26.1167" class="difflineminus">-}</span>
<a href="#l26.1168"></a><span id="l26.1168" class="difflineminus">-</span>
<a href="#l26.1169"></a><span id="l26.1169" class="difflineminus">-var nsResultDNDObserver = </span>
<a href="#l26.1170"></a><span id="l26.1170" class="difflineminus">-{</span>
<a href="#l26.1171"></a><span id="l26.1171" class="difflineminus">-  onDragStart: function(aEvent, aXferData, aDragAction)</span>
<a href="#l26.1172"></a><span id="l26.1172" class="difflineminus">-  {</span>
<a href="#l26.1173"></a><span id="l26.1173" class="difflineminus">-    var node = getItemNode(aEvent.target, &quot;listitem&quot;);</span>
<a href="#l26.1174"></a><span id="l26.1174" class="difflineminus">-    var URL = getArcValueForID(&quot;URL&quot;, node.id);</span>
<a href="#l26.1175"></a><span id="l26.1175" class="difflineminus">-    var title = getArcValueForID(&quot;Name&quot;, node.id);</span>
<a href="#l26.1176"></a><span id="l26.1176" class="difflineminus">-    var htmlString = &quot;&lt;a href=\&quot;&quot; + URL + &quot;\&quot;&gt;&quot; + title + &quot;&lt;/a&gt;&quot;;</span>
<a href="#l26.1177"></a><span id="l26.1177" class="difflineminus">-    var urlString = URL + &quot;\n&quot; + title;</span>
<a href="#l26.1178"></a><span id="l26.1178" class="difflineminus">-</span>
<a href="#l26.1179"></a><span id="l26.1179" class="difflineminus">-    aXferData.data = new TransferData();</span>
<a href="#l26.1180"></a><span id="l26.1180" class="difflineminus">-    aXferData.data.addDataForFlavour(&quot;text/x-moz-url&quot;, URL);</span>
<a href="#l26.1181"></a><span id="l26.1181" class="difflineminus">-    aXferData.data.addDataForFlavour(&quot;text/unicode&quot;, urlString);</span>
<a href="#l26.1182"></a><span id="l26.1182" class="difflineminus">-    aXferData.data.addDataForFlavour(&quot;text/html&quot;, htmlString); </span>
<a href="#l26.1183"></a><span id="l26.1183" class="difflineminus">-  }</span>
<a href="#l26.1184"></a><span id="l26.1184" class="difflineminus">-};</span>
<a href="#l26.1185"></a><span id="l26.1185" class="difflineminus">-</span>
<a href="#l26.1186"></a><span id="l26.1186" class="difflineminus">-function HandleResultDragGesture(aEvent)</span>
<a href="#l26.1187"></a><span id="l26.1187" class="difflineminus">-{</span>
<a href="#l26.1188"></a><span id="l26.1188" class="difflineminus">-  nsDragAndDrop.startDrag(aEvent, nsResultDNDObserver);</span>
<a href="#l26.1189"></a><span id="l26.1189" class="difflineminus">-  return true;  </span>
<a href="#l26.1190"></a><span id="l26.1190" class="difflineminus">-}</span>
<a href="#l26.1191"></a><span id="l26.1191" class="difflineminus">-</span>
<a href="#l26.1192"></a><span id="l26.1192" class="difflineplus">+}</span>
<a href="#l26.1193"></a><span id="l26.1193">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/suite/common/search/search-panel.xul</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/suite/common/search/search-panel.xul</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1,197 +1,62 @@</span>
<a href="#l27.4"></a><span id="l27.4" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt; &lt;!-- -*- Mode: SGML; indent-tabs-mode: nil; -*- --&gt;</span>
<a href="#l27.5"></a><span id="l27.5" class="difflineminus">-&lt;!--</span>
<a href="#l27.6"></a><span id="l27.6" class="difflineminus">-</span>
<a href="#l27.7"></a><span id="l27.7" class="difflineminus">- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l27.8"></a><span id="l27.8" class="difflineminus">- Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l27.9"></a><span id="l27.9" class="difflineminus">-</span>
<a href="#l27.10"></a><span id="l27.10" class="difflineminus">- The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l27.11"></a><span id="l27.11" class="difflineminus">- 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">- the License. You may obtain a copy of the License at</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">- http://www.mozilla.org/MPL/</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">-</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineminus">- Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineminus">- WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineminus">- for the specific language governing rights and limitations under the</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineminus">- License.</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineminus">-</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineminus">- The Original Code is mozilla.org code.</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineminus">-</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineminus">- The Initial Developer of the Original Code is</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineminus">- Netscape Communications Corporation.</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineminus">- Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineminus">- the Initial Developer. All Rights Reserved.</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineminus">-</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineminus">- Contributor(s):</span>
<a href="#l27.28"></a><span id="l27.28" class="difflineminus">-   Blake Ross &lt;blakeross@telocity.com&gt;</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineminus">-</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineminus">- Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">- either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineminus">- or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineminus">- in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineminus">- of those above. If you wish to allow use of your version of this file only</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineminus">- under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineminus">- use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineminus">- decision by deleting the provisions above and replace them with the notice</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineminus">- and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineminus">- the provisions above, a recipient may use your version of this file under</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineminus">- the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineminus">-</span>
<a href="#l27.42"></a><span id="l27.42" class="difflineminus">- ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l27.46"></a><span id="l27.46" class="difflineplus">+   -</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l27.49"></a><span id="l27.49" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineplus">+   -</span>
<a href="#l27.52"></a><span id="l27.52" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l27.55"></a><span id="l27.55" class="difflineplus">+   - License.</span>
<a href="#l27.56"></a><span id="l27.56" class="difflineplus">+   -</span>
<a href="#l27.57"></a><span id="l27.57" class="difflineplus">+   - The Original Code is SeaMonkey search panel.</span>
<a href="#l27.58"></a><span id="l27.58" class="difflineplus">+   -</span>
<a href="#l27.59"></a><span id="l27.59" class="difflineplus">+   - The Initial Developer of the Original Code is</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineplus">+   - the Mozilla Foundation.</span>
<a href="#l27.61"></a><span id="l27.61" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 2010</span>
<a href="#l27.62"></a><span id="l27.62" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l27.63"></a><span id="l27.63" class="difflineplus">+   -</span>
<a href="#l27.64"></a><span id="l27.64" class="difflineplus">+   - Contributor(s):</span>
<a href="#l27.65"></a><span id="l27.65" class="difflineplus">+   -   Robert Kaiser &lt;kairo@kairo.at&gt;</span>
<a href="#l27.66"></a><span id="l27.66" class="difflineplus">+   -</span>
<a href="#l27.67"></a><span id="l27.67" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l27.68"></a><span id="l27.68" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l27.69"></a><span id="l27.69" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l27.70"></a><span id="l27.70" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l27.71"></a><span id="l27.71" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l27.72"></a><span id="l27.72" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l27.73"></a><span id="l27.73" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l27.74"></a><span id="l27.74" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l27.75"></a><span id="l27.75" class="difflineplus">+   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l27.76"></a><span id="l27.76" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l27.77"></a><span id="l27.77" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l27.78"></a><span id="l27.78" class="difflineplus">+   -</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l27.80"></a><span id="l27.80"> </span>
<a href="#l27.81"></a><span id="l27.81"> &lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l27.82"></a><span id="l27.82"> &lt;?xml-stylesheet href=&quot;chrome://communicator/skin/search/search.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l27.83"></a><span id="l27.83"> </span>
<a href="#l27.84"></a><span id="l27.84" class="difflineminus">-&lt;!DOCTYPE window SYSTEM &quot;chrome://communicator/locale/search/search-panel.dtd&quot; &gt;</span>
<a href="#l27.85"></a><span id="l27.85" class="difflineminus">-&lt;window id=&quot;searchPanel&quot;</span>
<a href="#l27.86"></a><span id="l27.86" class="difflineminus">-      xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l27.87"></a><span id="l27.87" class="difflineplus">+&lt;!DOCTYPE page SYSTEM &quot;chrome://communicator/locale/search/search-panel.dtd&quot; &gt;</span>
<a href="#l27.88"></a><span id="l27.88" class="difflineplus">+&lt;page id=&quot;searchPanel&quot;</span>
<a href="#l27.89"></a><span id="l27.89">       xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l27.90"></a><span id="l27.90" class="difflineminus">-      orient=&quot;vertical&quot; onload=&quot;SearchPanelStartup();&quot;</span>
<a href="#l27.91"></a><span id="l27.91" class="difflineminus">-      onunload=&quot;SearchPanelShutdown();&quot; elementtofocus=&quot;sidebar-search-text&quot;&gt;</span>
<a href="#l27.92"></a><span id="l27.92" class="difflineplus">+      onload=&quot;Startup();&quot;</span>
<a href="#l27.93"></a><span id="l27.93" class="difflineplus">+      onunload=&quot;Shutdown();&quot;</span>
<a href="#l27.94"></a><span id="l27.94" class="difflineplus">+      elementtofocus=&quot;sidebar-search-text&quot;&gt;</span>
<a href="#l27.95"></a><span id="l27.95"> </span>
<a href="#l27.96"></a><span id="l27.96" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/nsUserSettings.js&quot;/&gt;</span>
<a href="#l27.97"></a><span id="l27.97" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/nsDragAndDrop.js&quot;/&gt;</span>
<a href="#l27.98"></a><span id="l27.98">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/search/search-panel.js&quot;/&gt;</span>
<a href="#l27.99"></a><span id="l27.99" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/search/shared.js&quot;/&gt;</span>
<a href="#l27.100"></a><span id="l27.100" class="difflineminus">-</span>
<a href="#l27.101"></a><span id="l27.101" class="difflineminus">-  &lt;stringbundle id=&quot;searchBundle&quot; src=&quot;chrome://communicator/locale/search/search-panel.properties&quot;/&gt;</span>
<a href="#l27.102"></a><span id="l27.102" class="difflineminus">-  &lt;stringbundle id=&quot;regionalBundle&quot; src=&quot;chrome://communicator-region/locale/region.properties&quot;/&gt;</span>
<a href="#l27.103"></a><span id="l27.103" class="difflineminus">-  </span>
<a href="#l27.104"></a><span id="l27.104" class="difflineminus">-  &lt;popupset&gt;</span>
<a href="#l27.105"></a><span id="l27.105" class="difflineminus">-    &lt;menupopup id=&quot;contextual&quot; onpopupshowing=&quot;return fillContextMenu('contextual', 'resultList');&quot;&gt;</span>
<a href="#l27.106"></a><span id="l27.106" class="difflineminus">-      &lt;menu/&gt;</span>
<a href="#l27.107"></a><span id="l27.107" class="difflineminus">-    &lt;/menupopup&gt;</span>
<a href="#l27.108"></a><span id="l27.108" class="difflineminus">-  &lt;/popupset&gt;</span>
<a href="#l27.109"></a><span id="l27.109" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/utilityOverlay.js&quot;/&gt;</span>
<a href="#l27.110"></a><span id="l27.110"> </span>
<a href="#l27.111"></a><span id="l27.111" class="difflineminus">-  &lt;popupset id=&quot;descTooltipSet&quot;&gt;</span>
<a href="#l27.112"></a><span id="l27.112" class="difflineminus">-    &lt;tooltip id=&quot;descTooltip&quot; noautohide=&quot;true&quot; onpopupshowing=&quot;return FillInDescTooltip(document.tooltipNode)&quot;&gt;</span>
<a href="#l27.113"></a><span id="l27.113" class="difflineminus">-      &lt;vbox id=&quot;tipTextBox&quot; flex=&quot;1&quot;&gt;  </span>
<a href="#l27.114"></a><span id="l27.114" class="difflineminus">-        &lt;label id=&quot;titleText&quot; /&gt;</span>
<a href="#l27.115"></a><span id="l27.115" class="difflineminus">-        &lt;label id=&quot;urlText&quot; /&gt;</span>
<a href="#l27.116"></a><span id="l27.116" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l27.117"></a><span id="l27.117" class="difflineminus">-    &lt;/tooltip&gt;</span>
<a href="#l27.118"></a><span id="l27.118" class="difflineminus">-  &lt;/popupset&gt;</span>
<a href="#l27.119"></a><span id="l27.119" class="difflineminus">- </span>
<a href="#l27.120"></a><span id="l27.120" class="difflineminus">-  &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l27.121"></a><span id="l27.121" class="difflineminus">-    &lt;vbox class=&quot;box-padded outset-top-bottom&quot;&gt;</span>
<a href="#l27.122"></a><span id="l27.122" class="difflineminus">-      &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l27.123"></a><span id="l27.123" class="difflineminus">-        &lt;textbox id=&quot;sidebar-search-text&quot; flex=&quot;1&quot;</span>
<a href="#l27.124"></a><span id="l27.124" class="difflineminus">-                   onkeypress=&quot;if (event.keyCode == 13) doSearch();&quot;</span>
<a href="#l27.125"></a><span id="l27.125" class="difflineminus">-                   oninput=&quot;doEnabling();&quot; /&gt;</span>
<a href="#l27.126"></a><span id="l27.126" class="difflineminus">-        &lt;button id=&quot;searchButton&quot; label=&quot;&amp;search.button.label;&quot;</span>
<a href="#l27.127"></a><span id="l27.127" class="difflineminus">-                disabled=&quot;true&quot; oncommand=&quot;doSearch();&quot;/&gt;</span>
<a href="#l27.128"></a><span id="l27.128" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l27.129"></a><span id="l27.129" class="difflineminus">-      &lt;vbox align=&quot;start&quot;&gt;</span>
<a href="#l27.130"></a><span id="l27.130" class="difflineminus">-        &lt;vbox id=&quot;basicBox&quot;&gt;</span>
<a href="#l27.131"></a><span id="l27.131" class="difflineminus">-          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l27.132"></a><span id="l27.132" class="difflineminus">-            &lt;label value=&quot;&amp;using.label;&quot; control=&quot;basicEngineMenu&quot;/&gt;</span>
<a href="#l27.133"></a><span id="l27.133" class="difflineminus">-            &lt;menulist id=&quot;basicEngineMenu&quot;</span>
<a href="#l27.134"></a><span id="l27.134" class="difflineminus">-                      ref=&quot;NC:SearchEngineRoot&quot;</span>
<a href="#l27.135"></a><span id="l27.135" class="difflineminus">-                      datasources=&quot;rdf:internetsearch&quot;</span>
<a href="#l27.136"></a><span id="l27.136" class="difflineminus">-                      sortResource=&quot;http://home.netscape.com/NC-rdf#Name&quot;</span>
<a href="#l27.137"></a><span id="l27.137" class="difflineminus">-                      sortDirection=&quot;ascending&quot;&gt;</span>
<a href="#l27.138"></a><span id="l27.138" class="difflineminus">-              &lt;template&gt;</span>
<a href="#l27.139"></a><span id="l27.139" class="difflineminus">-                &lt;menupopup id=&quot;basicPopup&quot;</span>
<a href="#l27.140"></a><span id="l27.140" class="difflineminus">-                           oncommand=&quot;if (event.originalTarget.localName == 'menuitem') AskChangeDefaultEngine(event.target);&quot;&gt;</span>
<a href="#l27.141"></a><span id="l27.141" class="difflineminus">-                  &lt;menuitem value=&quot;...&quot; uri=&quot;...&quot;</span>
<a href="#l27.142"></a><span id="l27.142" class="difflineminus">-                    desc=&quot;rdf:http://home.netscape.com/NC-rdf#Description&quot;</span>
<a href="#l27.143"></a><span id="l27.143" class="difflineminus">-                    ver=&quot;rdf:http://home.netscape.com/NC-rdf#Version&quot;</span>
<a href="#l27.144"></a><span id="l27.144" class="difflineminus">-                    src=&quot;rdf:http://home.netscape.com/NC-rdf#Icon&quot;</span>
<a href="#l27.145"></a><span id="l27.145" class="difflineminus">-                    label=&quot;rdf:http://home.netscape.com/NC-rdf#Name&quot;/&gt;</span>
<a href="#l27.146"></a><span id="l27.146" class="difflineminus">-                &lt;/menupopup&gt;</span>
<a href="#l27.147"></a><span id="l27.147" class="difflineminus">-              &lt;/template&gt;</span>
<a href="#l27.148"></a><span id="l27.148" class="difflineminus">-            &lt;/menulist&gt;</span>
<a href="#l27.149"></a><span id="l27.149" class="difflineminus">-          &lt;/hbox&gt;</span>
<a href="#l27.150"></a><span id="l27.150" class="difflineminus">-        &lt;/vbox&gt;</span>
<a href="#l27.151"></a><span id="l27.151" class="difflineminus">-        &lt;vbox id=&quot;categoryBox&quot; align=&quot;start&quot;&gt;</span>
<a href="#l27.152"></a><span id="l27.152" class="difflineminus">-          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l27.153"></a><span id="l27.153" class="difflineminus">-            &lt;label value=&quot;&amp;within.label;&quot; control=&quot;categoryList&quot;/&gt;</span>
<a href="#l27.154"></a><span id="l27.154" class="difflineminus">-            &lt;menulist id=&quot;categoryList&quot; ref=&quot;NC:SearchCategoryRoot&quot;</span>
<a href="#l27.155"></a><span id="l27.155" class="difflineminus">-                      datasources=&quot;rdf:null&quot; oncommand=&quot;switchTab(1);&quot; &gt;</span>
<a href="#l27.156"></a><span id="l27.156" class="difflineminus">-              &lt;template&gt;</span>
<a href="#l27.157"></a><span id="l27.157" class="difflineminus">-                &lt;menupopup&gt;</span>
<a href="#l27.158"></a><span id="l27.158" class="difflineminus">-                  &lt;menuitem id=&quot;chooseCat&quot; uri=&quot;rdf:*&quot; oncommand=&quot;chooseCategory(this);&quot; </span>
<a href="#l27.159"></a><span id="l27.159" class="difflineminus">-                            value=&quot;rdf:http://home.netscape.com/NC-rdf#category&quot;</span>
<a href="#l27.160"></a><span id="l27.160" class="difflineminus">-                            label=&quot;rdf:http://home.netscape.com/NC-rdf#title&quot;/&gt;</span>
<a href="#l27.161"></a><span id="l27.161" class="difflineminus">-                &lt;/menupopup&gt;</span>
<a href="#l27.162"></a><span id="l27.162" class="difflineminus">-              &lt;/template&gt;</span>
<a href="#l27.163"></a><span id="l27.163" class="difflineminus">-        </span>
<a href="#l27.164"></a><span id="l27.164" class="difflineminus">-              &lt;menupopup id=&quot;categoryPopup&quot;&gt;</span>
<a href="#l27.165"></a><span id="l27.165" class="difflineminus">-                &lt;menuitem value=&quot;NC:SearchEngineRoot&quot; label=&quot;&amp;allengines.label;&quot;</span>
<a href="#l27.166"></a><span id="l27.166" class="difflineminus">-                          oncommand=&quot;chooseCategory(this);&quot;/&gt;</span>
<a href="#l27.167"></a><span id="l27.167" class="difflineminus">-                &lt;menuseparator /&gt;</span>
<a href="#l27.168"></a><span id="l27.168" class="difflineminus">-                &lt;menuitem label=&quot;&amp;customize.menuitem.label;&quot; value=&quot;NC:SearchEngineRoot&quot;</span>
<a href="#l27.169"></a><span id="l27.169" class="difflineminus">-                          oncommand=&quot;chooseCategory(this); doCustomize();&quot;/&gt;</span>
<a href="#l27.170"></a><span id="l27.170" class="difflineminus">-                &lt;menuseparator /&gt;</span>
<a href="#l27.171"></a><span id="l27.171" class="difflineminus">-              &lt;/menupopup&gt;</span>
<a href="#l27.172"></a><span id="l27.172" class="difflineminus">-            &lt;/menulist&gt;</span>
<a href="#l27.173"></a><span id="l27.173" class="difflineminus">-          &lt;/hbox&gt;</span>
<a href="#l27.174"></a><span id="l27.174" class="difflineminus">-          &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l27.175"></a><span id="l27.175" class="difflineminus">-          &lt;description flex=&quot;1&quot;&gt;&amp;choose.label;&lt;/description&gt;</span>
<a href="#l27.176"></a><span id="l27.176" class="difflineminus">-        &lt;/vbox&gt;</span>
<a href="#l27.177"></a><span id="l27.177" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l27.178"></a><span id="l27.178" class="difflineminus">-    &lt;/vbox&gt;</span>
<a href="#l27.179"></a><span id="l27.179" class="difflineminus">-    &lt;deck class=&quot;outset-right&quot; id=&quot;advancedDeck&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l27.180"></a><span id="l27.180" class="difflineminus">-      &lt;vbox class=&quot;searchpanel-outerbox&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l27.181"></a><span id="l27.181" class="difflineplus">+    &lt;menulist id=&quot;sidebar-search-engines&quot;</span>
<a href="#l27.182"></a><span id="l27.182" class="difflineplus">+              oncommand=&quot;SelectEngine(this);&quot;/&gt;</span>
<a href="#l27.183"></a><span id="l27.183"> </span>
<a href="#l27.184"></a><span id="l27.184" class="difflineminus">-        &lt;listbox id=&quot;resultList&quot; ref=&quot;NC:LastSearchRoot&quot; class=&quot;plain&quot;</span>
<a href="#l27.185"></a><span id="l27.185" class="difflineminus">-              resource=&quot;http://home.netscape.com/NC-rdf#PageRank&quot;</span>
<a href="#l27.186"></a><span id="l27.186" class="difflineminus">-              resource2=&quot;http://home.netscape.com/NC-rdf#Name&quot;</span>
<a href="#l27.187"></a><span id="l27.187" class="difflineminus">-              flex=&quot;1&quot; datasources=&quot;rdf:internetsearch&quot;</span>
<a href="#l27.188"></a><span id="l27.188" class="difflineminus">-              onclick=&quot;if (event.button == 0 &amp;amp;&amp;amp; event.target.localName == 'listitem') sidebarOpenURL(event.target);&quot;</span>
<a href="#l27.189"></a><span id="l27.189" class="difflineminus">-              ondraggesture=&quot;if (event.target.localName == 'listitem') HandleResultDragGesture(event);&quot;</span>
<a href="#l27.190"></a><span id="l27.190" class="difflineminus">-              style=&quot;-moz-user-focus:ignore !important;&quot;&gt;</span>
<a href="#l27.191"></a><span id="l27.191" class="difflineminus">-</span>
<a href="#l27.192"></a><span id="l27.192" class="difflineminus">-          &lt;listhead&gt;</span>
<a href="#l27.193"></a><span id="l27.193" class="difflineminus">-            &lt;listheader id=&quot;SortNameColumn&quot; label=&quot;&amp;results.label;&quot; </span>
<a href="#l27.194"></a><span id="l27.194" class="difflineminus">-                        sortable=&quot;true&quot; resource=&quot;http://home.netscape.com/NC-rdf#Name&quot;</span>
<a href="#l27.195"></a><span id="l27.195" class="difflineminus">-                        onclick=&quot;return doSort('SortNameColumn', 'http://home.netscape.com/NC-rdf#PageRank');&quot; /&gt;</span>
<a href="#l27.196"></a><span id="l27.196" class="difflineminus">-          &lt;/listhead&gt;</span>
<a href="#l27.197"></a><span id="l27.197" class="difflineminus">-</span>
<a href="#l27.198"></a><span id="l27.198" class="difflineminus">-          &lt;template&gt;</span>
<a href="#l27.199"></a><span id="l27.199" class="difflineminus">-            &lt;rule&gt;</span>
<a href="#l27.200"></a><span id="l27.200" class="difflineminus">-              &lt;listitem uri=&quot;...&quot; class=&quot;listitem-iconic searchresult-item text-link&quot;</span>
<a href="#l27.201"></a><span id="l27.201" class="difflineminus">-                        context=&quot;contextual&quot; flexlabel=&quot;0&quot;                    </span>
<a href="#l27.202"></a><span id="l27.202" class="difflineminus">-                        loading=&quot;rdf:http://home.netscape.com/NC-rdf#loading&quot;</span>
<a href="#l27.203"></a><span id="l27.203" class="difflineminus">-                        searchtype=&quot;rdf:http://home.netscape.com/NC-rdf#SearchType&quot;</span>
<a href="#l27.204"></a><span id="l27.204" class="difflineminus">-                        image=&quot;rdf:http://home.netscape.com/NC-rdf#Icon&quot;</span>
<a href="#l27.205"></a><span id="l27.205" class="difflineminus">-                        label=&quot;rdf:http://home.netscape.com/NC-rdf#Name&quot;</span>
<a href="#l27.206"></a><span id="l27.206" class="difflineminus">-                        tooltip=&quot;descTooltip&quot;/&gt;</span>
<a href="#l27.207"></a><span id="l27.207" class="difflineminus">-            &lt;/rule&gt;</span>
<a href="#l27.208"></a><span id="l27.208" class="difflineminus">-          &lt;/template&gt;</span>
<a href="#l27.209"></a><span id="l27.209" class="difflineminus">-        &lt;/listbox&gt;</span>
<a href="#l27.210"></a><span id="l27.210" class="difflineminus">-      </span>
<a href="#l27.211"></a><span id="l27.211" class="difflineminus">-        &lt;hbox&gt;</span>
<a href="#l27.212"></a><span id="l27.212" class="difflineminus">-          &lt;button id=&quot;prev-results&quot; label=&quot;&amp;previous.button.label;&quot; </span>
<a href="#l27.213"></a><span id="l27.213" class="difflineminus">-                  tooltiptext=&quot;&amp;previous.button.tooltip;&quot;</span>
<a href="#l27.214"></a><span id="l27.214" class="difflineminus">-                  oncommand=&quot;return showMoreResults(-1);&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.215"></a><span id="l27.215" class="difflineminus">-          &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l27.216"></a><span id="l27.216" class="difflineminus">-          &lt;button id=&quot;next-results&quot; label=&quot;&amp;next.button.label;&quot;</span>
<a href="#l27.217"></a><span id="l27.217" class="difflineminus">-                  tooltiptext=&quot;&amp;next.button.tooltip;&quot;</span>
<a href="#l27.218"></a><span id="l27.218" class="difflineminus">-                  oncommand=&quot;return showMoreResults(1);&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l27.219"></a><span id="l27.219" class="difflineminus">-        &lt;/hbox&gt;</span>
<a href="#l27.220"></a><span id="l27.220" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l27.221"></a><span id="l27.221" class="difflineminus">-    </span>
<a href="#l27.222"></a><span id="l27.222" class="difflineminus">-      &lt;vbox class=&quot;searchpanel-outerbox&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l27.223"></a><span id="l27.223" class="difflineminus">-</span>
<a href="#l27.224"></a><span id="l27.224" class="difflineminus">-        &lt;listbox id=&quot;searchengines&quot; flex=&quot;1&quot; class=&quot;plain&quot;</span>
<a href="#l27.225"></a><span id="l27.225" class="difflineminus">-                 datasources=&quot;rdf:internetsearch&quot;&gt;</span>
<a href="#l27.226"></a><span id="l27.226" class="difflineminus">-          &lt;listhead&gt;</span>
<a href="#l27.227"></a><span id="l27.227" class="difflineminus">-            &lt;listheader id=&quot;EngineColumn&quot; label=&quot;&amp;engine.column.label;&quot;</span>
<a href="#l27.228"></a><span id="l27.228" class="difflineminus">-                        sortable=&quot;true&quot; resource=&quot;http://home.netscape.com/NC-rdf#Name&quot;</span>
<a href="#l27.229"></a><span id="l27.229" class="difflineminus">-                        onclick=&quot;return doSort('EngineColumn', null);&quot;/&gt;</span>
<a href="#l27.230"></a><span id="l27.230" class="difflineminus">-          &lt;/listhead&gt;</span>
<a href="#l27.231"></a><span id="l27.231" class="difflineminus">-</span>
<a href="#l27.232"></a><span id="l27.232" class="difflineminus">-          &lt;template&gt;</span>
<a href="#l27.233"></a><span id="l27.233" class="difflineminus">-            &lt;rule&gt;</span>
<a href="#l27.234"></a><span id="l27.234" class="difflineminus">-              &lt;listitem uri=&quot;...&quot; type=&quot;checkbox&quot; class=&quot;listitem-iconic&quot;</span>
<a href="#l27.235"></a><span id="l27.235" class="difflineminus">-                        loading=&quot;rdf:http://home.netscape.com/NC-rdf#loading&quot;</span>
<a href="#l27.236"></a><span id="l27.236" class="difflineminus">-                        image=&quot;rdf:http://home.netscape.com/NC-rdf#Icon&quot;</span>
<a href="#l27.237"></a><span id="l27.237" class="difflineminus">-                        label=&quot;rdf:http://home.netscape.com/NC-rdf#Name&quot;/&gt;</span>
<a href="#l27.238"></a><span id="l27.238" class="difflineminus">-            &lt;/rule&gt;</span>
<a href="#l27.239"></a><span id="l27.239" class="difflineminus">-          &lt;/template&gt;</span>
<a href="#l27.240"></a><span id="l27.240" class="difflineminus">-        </span>
<a href="#l27.241"></a><span id="l27.241" class="difflineminus">-        &lt;/listbox&gt; </span>
<a href="#l27.242"></a><span id="l27.242" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l27.243"></a><span id="l27.243" class="difflineminus">-    &lt;/deck&gt;</span>
<a href="#l27.244"></a><span id="l27.244" class="difflineminus">-  &lt;/vbox&gt;</span>
<a href="#l27.245"></a><span id="l27.245" class="difflineminus">-&lt;/window&gt;</span>
<a href="#l27.246"></a><span id="l27.246" class="difflineplus">+    &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l27.247"></a><span id="l27.247" class="difflineplus">+      &lt;textbox id=&quot;sidebar-search-text&quot; flex=&quot;1&quot;</span>
<a href="#l27.248"></a><span id="l27.248" class="difflineplus">+               onkeypress=&quot;if (event.keyCode == event.DOM_VK_RETURN) doSearch();&quot;</span>
<a href="#l27.249"></a><span id="l27.249" class="difflineplus">+               placeholder=&quot;&amp;search.placeholder;&quot;/&gt;</span>
<a href="#l27.250"></a><span id="l27.250" class="difflineplus">+      &lt;button id=&quot;searchButton&quot; label=&quot;&amp;search.button.label;&quot;</span>
<a href="#l27.251"></a><span id="l27.251" class="difflineplus">+              oncommand=&quot;doSearch();&quot;/&gt;</span>
<a href="#l27.252"></a><span id="l27.252" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l27.253"></a><span id="l27.253" class="difflineplus">+&lt;/page&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1">deleted file mode 100644</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineminus">--- a/suite/common/search/shared.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineplus">+++ /dev/null</span>
<a href="#l28.4"></a><span id="l28.4" class="difflineat">@@ -1,448 +0,0 @@</span>
<a href="#l28.5"></a><span id="l28.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l28.6"></a><span id="l28.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l28.7"></a><span id="l28.7" class="difflineminus">- *</span>
<a href="#l28.8"></a><span id="l28.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l28.9"></a><span id="l28.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l28.10"></a><span id="l28.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l28.11"></a><span id="l28.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">- *</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineminus">- * License.</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">- *</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineminus">- *</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineminus">- * The Initial Developer of the Original Code is Robert John Churchill.</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineminus">- *</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineminus">- * Contributor(s): </span>
<a href="#l28.25"></a><span id="l28.25" class="difflineminus">- *    Robert John Churchill   &lt;rjc@netscape.com&gt; (Original Author)</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">- *    Karsten Duesterloh      &lt;kd-moz@tprac.de&gt;</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineminus">- *</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineminus">- * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineminus">- * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineminus">- *</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineminus">-</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineminus">-function fillContextMenu(name, treeName)</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineminus">-{</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineminus">-    if (!name)    return(false);</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineminus">-    var popupNode = document.getElementById(name);</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineminus">-    if (!popupNode)    return(false);</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineminus">-    // remove the menu node (which tosses all of its kids);</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineminus">-    // do this in case any old command nodes are hanging around</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineminus">-    while (popupNode.hasChildNodes())</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineminus">-    {</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineminus">-      popupNode.removeChild(popupNode.lastChild);</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineminus">-    }</span>
<a href="#l28.53"></a><span id="l28.53" class="difflineminus">-</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineminus">-    var treeNode = document.getElementById(treeName);</span>
<a href="#l28.55"></a><span id="l28.55" class="difflineminus">-    if (!treeNode)    return(false);</span>
<a href="#l28.56"></a><span id="l28.56" class="difflineminus">-    var db = treeNode.database;</span>
<a href="#l28.57"></a><span id="l28.57" class="difflineminus">-    if (!db)    return(false);</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">-</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineminus">-    var compositeDB = db.QueryInterface(Components.interfaces.nsIRDFDataSource);</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineminus">-    if (!compositeDB)    return(false);</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineminus">-</span>
<a href="#l28.62"></a><span id="l28.62" class="difflineminus">-    var isupports = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;].getService();</span>
<a href="#l28.63"></a><span id="l28.63" class="difflineminus">-    if (!isupports)    return(false);</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineminus">-    var rdf = isupports.QueryInterface(Components.interfaces.nsIRDFService);</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineminus">-    if (!rdf)    return(false);</span>
<a href="#l28.66"></a><span id="l28.66" class="difflineminus">-</span>
<a href="#l28.67"></a><span id="l28.67" class="difflineminus">-    var target_item = document.popupNode.parentNode.parentNode;</span>
<a href="#l28.68"></a><span id="l28.68" class="difflineminus">-    if (target_item &amp;&amp; target_item.nodeName == &quot;treeitem&quot;)</span>
<a href="#l28.69"></a><span id="l28.69" class="difflineminus">-    {</span>
<a href="#l28.70"></a><span id="l28.70" class="difflineminus">-      if (target_item.getAttribute('selected') != 'true') {</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineminus">-        treeNode.selectItem(target_item);</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineminus">-      }</span>
<a href="#l28.73"></a><span id="l28.73" class="difflineminus">-    }</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineminus">-</span>
<a href="#l28.75"></a><span id="l28.75" class="difflineminus">-    var select_list = treeNode.selectedItems;</span>
<a href="#l28.76"></a><span id="l28.76" class="difflineminus">-</span>
<a href="#l28.77"></a><span id="l28.77" class="difflineminus">-    var separatorResource = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#BookmarkSeparator&quot;);</span>
<a href="#l28.78"></a><span id="l28.78" class="difflineminus">-    if (!separatorResource) return(false);</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineminus">-</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineminus">-    // perform intersection of commands over selected nodes</span>
<a href="#l28.81"></a><span id="l28.81" class="difflineminus">-    var cmdArray = new Array();</span>
<a href="#l28.82"></a><span id="l28.82" class="difflineminus">-    var selectLength = select_list.length;</span>
<a href="#l28.83"></a><span id="l28.83" class="difflineminus">-    if (selectLength == 0)  selectLength = 1;</span>
<a href="#l28.84"></a><span id="l28.84" class="difflineminus">-    for (var nodeIndex=0; nodeIndex &lt; selectLength; nodeIndex++)</span>
<a href="#l28.85"></a><span id="l28.85" class="difflineminus">-    {</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineminus">-      var id = null;</span>
<a href="#l28.87"></a><span id="l28.87" class="difflineminus">-</span>
<a href="#l28.88"></a><span id="l28.88" class="difflineminus">-  // if nothing is selected, get commands for the &quot;ref&quot; of the tree root</span>
<a href="#l28.89"></a><span id="l28.89" class="difflineminus">-      if (select_list.length == 0)</span>
<a href="#l28.90"></a><span id="l28.90" class="difflineminus">-      {</span>
<a href="#l28.91"></a><span id="l28.91" class="difflineminus">-    id = treeNode.getAttribute(&quot;ref&quot;);</span>
<a href="#l28.92"></a><span id="l28.92" class="difflineminus">-          if (!id)    break;</span>
<a href="#l28.93"></a><span id="l28.93" class="difflineminus">-      }</span>
<a href="#l28.94"></a><span id="l28.94" class="difflineminus">-      else</span>
<a href="#l28.95"></a><span id="l28.95" class="difflineminus">-      {</span>
<a href="#l28.96"></a><span id="l28.96" class="difflineminus">-          var node = select_list[nodeIndex];</span>
<a href="#l28.97"></a><span id="l28.97" class="difflineminus">-          if (!node)    break;</span>
<a href="#l28.98"></a><span id="l28.98" class="difflineminus">-          id = node.getAttribute(&quot;id&quot;);</span>
<a href="#l28.99"></a><span id="l28.99" class="difflineminus">-          if (!id)    break;</span>
<a href="#l28.100"></a><span id="l28.100" class="difflineminus">-  }</span>
<a href="#l28.101"></a><span id="l28.101" class="difflineminus">-</span>
<a href="#l28.102"></a><span id="l28.102" class="difflineminus">-        var rdfNode = rdf.GetResource(id);</span>
<a href="#l28.103"></a><span id="l28.103" class="difflineminus">-        if (!rdfNode)    break;</span>
<a href="#l28.104"></a><span id="l28.104" class="difflineminus">-        var cmdEnum = db.GetAllCmds(rdfNode);</span>
<a href="#l28.105"></a><span id="l28.105" class="difflineminus">-        if (!cmdEnum)    break;</span>
<a href="#l28.106"></a><span id="l28.106" class="difflineminus">-</span>
<a href="#l28.107"></a><span id="l28.107" class="difflineminus">-        var nextCmdArray = new Array();</span>
<a href="#l28.108"></a><span id="l28.108" class="difflineminus">-        while (cmdEnum.hasMoreElements())</span>
<a href="#l28.109"></a><span id="l28.109" class="difflineminus">-        {</span>
<a href="#l28.110"></a><span id="l28.110" class="difflineminus">-            var cmd = cmdEnum.getNext();</span>
<a href="#l28.111"></a><span id="l28.111" class="difflineminus">-            if (!cmd)    break;</span>
<a href="#l28.112"></a><span id="l28.112" class="difflineminus">-            if (nodeIndex == 0)</span>
<a href="#l28.113"></a><span id="l28.113" class="difflineminus">-            {</span>
<a href="#l28.114"></a><span id="l28.114" class="difflineminus">-                cmdArray[cmdArray.length] = cmd;</span>
<a href="#l28.115"></a><span id="l28.115" class="difflineminus">-            }</span>
<a href="#l28.116"></a><span id="l28.116" class="difflineminus">-            else</span>
<a href="#l28.117"></a><span id="l28.117" class="difflineminus">-            {</span>
<a href="#l28.118"></a><span id="l28.118" class="difflineminus">-                nextCmdArray[cmdArray.length] = cmd;</span>
<a href="#l28.119"></a><span id="l28.119" class="difflineminus">-            }</span>
<a href="#l28.120"></a><span id="l28.120" class="difflineminus">-        }</span>
<a href="#l28.121"></a><span id="l28.121" class="difflineminus">-        if (nodeIndex &gt; 0)</span>
<a href="#l28.122"></a><span id="l28.122" class="difflineminus">-        {</span>
<a href="#l28.123"></a><span id="l28.123" class="difflineminus">-            // perform command intersection calculation</span>
<a href="#l28.124"></a><span id="l28.124" class="difflineminus">-            for (var cmdIndex = 0; cmdIndex &lt; cmdArray.length; cmdIndex++)</span>
<a href="#l28.125"></a><span id="l28.125" class="difflineminus">-            {</span>
<a href="#l28.126"></a><span id="l28.126" class="difflineminus">-                var    cmdFound = false;</span>
<a href="#l28.127"></a><span id="l28.127" class="difflineminus">-                for (var nextCmdIndex = 0; nextCmdIndex &lt; nextCmdArray.length; nextCmdIndex++)</span>
<a href="#l28.128"></a><span id="l28.128" class="difflineminus">-                {</span>
<a href="#l28.129"></a><span id="l28.129" class="difflineminus">-                    if (nextCmdArray[nextCmdIndex] == cmdArray[cmdIndex])</span>
<a href="#l28.130"></a><span id="l28.130" class="difflineminus">-                    {</span>
<a href="#l28.131"></a><span id="l28.131" class="difflineminus">-                        cmdFound = true;</span>
<a href="#l28.132"></a><span id="l28.132" class="difflineminus">-                        break;</span>
<a href="#l28.133"></a><span id="l28.133" class="difflineminus">-                    }</span>
<a href="#l28.134"></a><span id="l28.134" class="difflineminus">-                }</span>
<a href="#l28.135"></a><span id="l28.135" class="difflineminus">-                if ((cmdFound == false) &amp;&amp; (cmdArray[cmdIndex]))</span>
<a href="#l28.136"></a><span id="l28.136" class="difflineminus">-                {</span>
<a href="#l28.137"></a><span id="l28.137" class="difflineminus">-      var cmdResource = cmdArray[cmdIndex].QueryInterface(Components.interfaces.nsIRDFResource);</span>
<a href="#l28.138"></a><span id="l28.138" class="difflineminus">-                  if ((cmdResource) &amp;&amp; (cmdResource != separatorResource))</span>
<a href="#l28.139"></a><span id="l28.139" class="difflineminus">-                  {</span>
<a href="#l28.140"></a><span id="l28.140" class="difflineminus">-        cmdArray[cmdIndex] = null;</span>
<a href="#l28.141"></a><span id="l28.141" class="difflineminus">-      }</span>
<a href="#l28.142"></a><span id="l28.142" class="difflineminus">-                }</span>
<a href="#l28.143"></a><span id="l28.143" class="difflineminus">-            }</span>
<a href="#l28.144"></a><span id="l28.144" class="difflineminus">-        }</span>
<a href="#l28.145"></a><span id="l28.145" class="difflineminus">-    }</span>
<a href="#l28.146"></a><span id="l28.146" class="difflineminus">-</span>
<a href="#l28.147"></a><span id="l28.147" class="difflineminus">-    // need a resource to ask RDF for each command's name</span>
<a href="#l28.148"></a><span id="l28.148" class="difflineminus">-    var rdfNameResource = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#Name&quot;);</span>
<a href="#l28.149"></a><span id="l28.149" class="difflineminus">-    if (!rdfNameResource)        return(false);</span>
<a href="#l28.150"></a><span id="l28.150" class="difflineminus">-</span>
<a href="#l28.151"></a><span id="l28.151" class="difflineminus">-    // build up menu items</span>
<a href="#l28.152"></a><span id="l28.152" class="difflineminus">-    if (cmdArray.length &lt; 1)    return(false);</span>
<a href="#l28.153"></a><span id="l28.153" class="difflineminus">-</span>
<a href="#l28.154"></a><span id="l28.154" class="difflineminus">-    var lastWasSep = false;</span>
<a href="#l28.155"></a><span id="l28.155" class="difflineminus">-</span>
<a href="#l28.156"></a><span id="l28.156" class="difflineminus">-    for (var cmdIndex = 0; cmdIndex &lt; cmdArray.length; cmdIndex++)</span>
<a href="#l28.157"></a><span id="l28.157" class="difflineminus">-    {</span>
<a href="#l28.158"></a><span id="l28.158" class="difflineminus">-        var cmd = cmdArray[cmdIndex];</span>
<a href="#l28.159"></a><span id="l28.159" class="difflineminus">-        if (!cmd)        continue;</span>
<a href="#l28.160"></a><span id="l28.160" class="difflineminus">-        var cmdResource = cmd.QueryInterface(Components.interfaces.nsIRDFResource);</span>
<a href="#l28.161"></a><span id="l28.161" class="difflineminus">-        if (!cmdResource)    break;</span>
<a href="#l28.162"></a><span id="l28.162" class="difflineminus">-</span>
<a href="#l28.163"></a><span id="l28.163" class="difflineminus">-  // handle separators</span>
<a href="#l28.164"></a><span id="l28.164" class="difflineminus">-  if (cmdResource == separatorResource)</span>
<a href="#l28.165"></a><span id="l28.165" class="difflineminus">-  {</span>
<a href="#l28.166"></a><span id="l28.166" class="difflineminus">-    if (lastWasSep != true)</span>
<a href="#l28.167"></a><span id="l28.167" class="difflineminus">-    {</span>
<a href="#l28.168"></a><span id="l28.168" class="difflineminus">-      lastWasSep = true;</span>
<a href="#l28.169"></a><span id="l28.169" class="difflineminus">-            var menuItem = document.createElement(&quot;menuseparator&quot;);</span>
<a href="#l28.170"></a><span id="l28.170" class="difflineminus">-            popupNode.appendChild(menuItem);</span>
<a href="#l28.171"></a><span id="l28.171" class="difflineminus">-    }</span>
<a href="#l28.172"></a><span id="l28.172" class="difflineminus">-    continue;</span>
<a href="#l28.173"></a><span id="l28.173" class="difflineminus">-  }</span>
<a href="#l28.174"></a><span id="l28.174" class="difflineminus">-</span>
<a href="#l28.175"></a><span id="l28.175" class="difflineminus">-  lastWasSep = false;</span>
<a href="#l28.176"></a><span id="l28.176" class="difflineminus">-</span>
<a href="#l28.177"></a><span id="l28.177" class="difflineminus">-        var cmdNameNode = compositeDB.GetTarget(cmdResource, rdfNameResource, true);</span>
<a href="#l28.178"></a><span id="l28.178" class="difflineminus">-        if (!cmdNameNode)    break;</span>
<a href="#l28.179"></a><span id="l28.179" class="difflineminus">-        cmdNameLiteral = cmdNameNode.QueryInterface(Components.interfaces.nsIRDFLiteral);</span>
<a href="#l28.180"></a><span id="l28.180" class="difflineminus">-        if (!cmdNameLiteral)    break;</span>
<a href="#l28.181"></a><span id="l28.181" class="difflineminus">-        cmdName = cmdNameLiteral.Value;</span>
<a href="#l28.182"></a><span id="l28.182" class="difflineminus">-        if (!cmdName)        break;</span>
<a href="#l28.183"></a><span id="l28.183" class="difflineminus">-</span>
<a href="#l28.184"></a><span id="l28.184" class="difflineminus">-        var menuItem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l28.185"></a><span id="l28.185" class="difflineminus">-        menuItem.setAttribute(&quot;label&quot;, cmdName);</span>
<a href="#l28.186"></a><span id="l28.186" class="difflineminus">-        popupNode.appendChild(menuItem);</span>
<a href="#l28.187"></a><span id="l28.187" class="difflineminus">-        // work around bug # 26402 by setting &quot;oncommand&quot; attribute AFTER appending menuitem</span>
<a href="#l28.188"></a><span id="l28.188" class="difflineminus">-        menuItem.setAttribute(&quot;oncommand&quot;, &quot;return doContextCmd('&quot; + cmdResource.Value + &quot;', '&quot; + treeName + &quot;');&quot;);</span>
<a href="#l28.189"></a><span id="l28.189" class="difflineminus">-    }</span>
<a href="#l28.190"></a><span id="l28.190" class="difflineminus">-</span>
<a href="#l28.191"></a><span id="l28.191" class="difflineminus">-  // strip off leading/trailing menuseparators</span>
<a href="#l28.192"></a><span id="l28.192" class="difflineminus">-  while (popupNode.hasChildNodes())</span>
<a href="#l28.193"></a><span id="l28.193" class="difflineminus">-  {</span>
<a href="#l28.194"></a><span id="l28.194" class="difflineminus">-    if (popupNode.firstChild.tagName != &quot;menuseparator&quot;)</span>
<a href="#l28.195"></a><span id="l28.195" class="difflineminus">-      break;</span>
<a href="#l28.196"></a><span id="l28.196" class="difflineminus">-    popupNode.removeChild(popupNode.firstChild);</span>
<a href="#l28.197"></a><span id="l28.197" class="difflineminus">-  }</span>
<a href="#l28.198"></a><span id="l28.198" class="difflineminus">-  while (popupNode.hasChildNodes())</span>
<a href="#l28.199"></a><span id="l28.199" class="difflineminus">-  {</span>
<a href="#l28.200"></a><span id="l28.200" class="difflineminus">-    if (popupNode.lastChild.tagName != &quot;menuseparator&quot;)</span>
<a href="#l28.201"></a><span id="l28.201" class="difflineminus">-      break;</span>
<a href="#l28.202"></a><span id="l28.202" class="difflineminus">-    popupNode.removeChild(popupNode.lastChild);</span>
<a href="#l28.203"></a><span id="l28.203" class="difflineminus">-  }</span>
<a href="#l28.204"></a><span id="l28.204" class="difflineminus">-</span>
<a href="#l28.205"></a><span id="l28.205" class="difflineminus">-  var   searchMode = 0;</span>
<a href="#l28.206"></a><span id="l28.206" class="difflineminus">-  if (pref) searchMode = pref.getIntPref(&quot;browser.search.mode&quot;);</span>
<a href="#l28.207"></a><span id="l28.207" class="difflineminus">-  if (pref &amp;&amp; bundle)</span>
<a href="#l28.208"></a><span id="l28.208" class="difflineminus">-  {</span>
<a href="#l28.209"></a><span id="l28.209" class="difflineminus">-    // then add a menu separator (if necessary)</span>
<a href="#l28.210"></a><span id="l28.210" class="difflineminus">-    if (popupNode.hasChildNodes())</span>
<a href="#l28.211"></a><span id="l28.211" class="difflineminus">-    {</span>
<a href="#l28.212"></a><span id="l28.212" class="difflineminus">-      if (popupNode.lastChild.tagName != &quot;menuseparator&quot;)</span>
<a href="#l28.213"></a><span id="l28.213" class="difflineminus">-      {</span>
<a href="#l28.214"></a><span id="l28.214" class="difflineminus">-          var menuSep = document.createElement(&quot;menuseparator&quot;);</span>
<a href="#l28.215"></a><span id="l28.215" class="difflineminus">-          popupNode.appendChild(menuSep);</span>
<a href="#l28.216"></a><span id="l28.216" class="difflineminus">-      }</span>
<a href="#l28.217"></a><span id="l28.217" class="difflineminus">-    }</span>
<a href="#l28.218"></a><span id="l28.218" class="difflineminus">-    // And then add a &quot;Search Mode&quot; menu item</span>
<a href="#l28.219"></a><span id="l28.219" class="difflineminus">-    var propMenuName = (searchMode == 0) ? bundle.GetStringFromName(&quot;enableAdvanced&quot;) : bundle.GetStringFromName(&quot;disableAdvanced&quot;);</span>
<a href="#l28.220"></a><span id="l28.220" class="difflineminus">-    var menuItem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l28.221"></a><span id="l28.221" class="difflineminus">-    menuItem.setAttribute(&quot;label&quot;, propMenuName);</span>
<a href="#l28.222"></a><span id="l28.222" class="difflineminus">-    popupNode.appendChild(menuItem);</span>
<a href="#l28.223"></a><span id="l28.223" class="difflineminus">-    // Work around bug # 26402 by setting &quot;oncommand&quot; attribute</span>
<a href="#l28.224"></a><span id="l28.224" class="difflineminus">-    // AFTER appending menuitem</span>
<a href="#l28.225"></a><span id="l28.225" class="difflineminus">-    menuItem.setAttribute(&quot;oncommand&quot;, &quot;return setSearchMode();&quot;);</span>
<a href="#l28.226"></a><span id="l28.226" class="difflineminus">-  }</span>
<a href="#l28.227"></a><span id="l28.227" class="difflineminus">-</span>
<a href="#l28.228"></a><span id="l28.228" class="difflineminus">-    return(true);</span>
<a href="#l28.229"></a><span id="l28.229" class="difflineminus">-}</span>
<a href="#l28.230"></a><span id="l28.230" class="difflineminus">-</span>
<a href="#l28.231"></a><span id="l28.231" class="difflineminus">-</span>
<a href="#l28.232"></a><span id="l28.232" class="difflineminus">-</span>
<a href="#l28.233"></a><span id="l28.233" class="difflineminus">-function setSearchMode()</span>
<a href="#l28.234"></a><span id="l28.234" class="difflineminus">-{</span>
<a href="#l28.235"></a><span id="l28.235" class="difflineminus">-  var   searchMode = 0;</span>
<a href="#l28.236"></a><span id="l28.236" class="difflineminus">-  if (pref) searchMode = pref.getIntPref(&quot;browser.search.mode&quot;);</span>
<a href="#l28.237"></a><span id="l28.237" class="difflineminus">-  if (searchMode == 0)  searchMode = 1;</span>
<a href="#l28.238"></a><span id="l28.238" class="difflineminus">-  else      searchMode = 0;</span>
<a href="#l28.239"></a><span id="l28.239" class="difflineminus">-  if (pref) pref.setIntPref(&quot;browser.search.mode&quot;, searchMode);</span>
<a href="#l28.240"></a><span id="l28.240" class="difflineminus">-  return(true);</span>
<a href="#l28.241"></a><span id="l28.241" class="difflineminus">-}</span>
<a href="#l28.242"></a><span id="l28.242" class="difflineminus">-</span>
<a href="#l28.243"></a><span id="l28.243" class="difflineminus">-</span>
<a href="#l28.244"></a><span id="l28.244" class="difflineminus">-</span>
<a href="#l28.245"></a><span id="l28.245" class="difflineminus">-function doContextCmd(cmdName, treeName)</span>
<a href="#l28.246"></a><span id="l28.246" class="difflineminus">-{</span>
<a href="#l28.247"></a><span id="l28.247" class="difflineminus">-  var treeNode = document.getElementById(treeName);</span>
<a href="#l28.248"></a><span id="l28.248" class="difflineminus">-  if (!treeNode)    return(false);</span>
<a href="#l28.249"></a><span id="l28.249" class="difflineminus">-  var db = treeNode.database;</span>
<a href="#l28.250"></a><span id="l28.250" class="difflineminus">-  if (!db)    return(false);</span>
<a href="#l28.251"></a><span id="l28.251" class="difflineminus">-</span>
<a href="#l28.252"></a><span id="l28.252" class="difflineminus">-  var compositeDB = db.QueryInterface(Components.interfaces.nsIRDFDataSource);</span>
<a href="#l28.253"></a><span id="l28.253" class="difflineminus">-  if (!compositeDB)    return(false);</span>
<a href="#l28.254"></a><span id="l28.254" class="difflineminus">-</span>
<a href="#l28.255"></a><span id="l28.255" class="difflineminus">-  var isupports = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;].getService();</span>
<a href="#l28.256"></a><span id="l28.256" class="difflineminus">-  if (!isupports)    return(false);</span>
<a href="#l28.257"></a><span id="l28.257" class="difflineminus">-  var rdf = isupports.QueryInterface(Components.interfaces.nsIRDFService);</span>
<a href="#l28.258"></a><span id="l28.258" class="difflineminus">-  if (!rdf)    return(false);</span>
<a href="#l28.259"></a><span id="l28.259" class="difflineminus">-</span>
<a href="#l28.260"></a><span id="l28.260" class="difflineminus">-  // need a resource for the command</span>
<a href="#l28.261"></a><span id="l28.261" class="difflineminus">-  var cmdResource = rdf.GetResource(cmdName);</span>
<a href="#l28.262"></a><span id="l28.262" class="difflineminus">-  if (!cmdResource)        return(false);</span>
<a href="#l28.263"></a><span id="l28.263" class="difflineminus">-  cmdResource = cmdResource.QueryInterface(Components.interfaces.nsIRDFResource);</span>
<a href="#l28.264"></a><span id="l28.264" class="difflineminus">-  if (!cmdResource)        return(false);</span>
<a href="#l28.265"></a><span id="l28.265" class="difflineminus">-</span>
<a href="#l28.266"></a><span id="l28.266" class="difflineminus">-  // set up selection nsISupportsArray</span>
<a href="#l28.267"></a><span id="l28.267" class="difflineminus">-  var selectionInstance = Components.classes[&quot;@mozilla.org/supports-array;1&quot;].createInstance();</span>
<a href="#l28.268"></a><span id="l28.268" class="difflineminus">-  var selectionArray = selectionInstance.QueryInterface(Components.interfaces.nsISupportsArray);</span>
<a href="#l28.269"></a><span id="l28.269" class="difflineminus">-</span>
<a href="#l28.270"></a><span id="l28.270" class="difflineminus">-  // set up arguments nsISupportsArray</span>
<a href="#l28.271"></a><span id="l28.271" class="difflineminus">-  var argumentsInstance = Components.classes[&quot;@mozilla.org/supports-array;1&quot;].createInstance();</span>
<a href="#l28.272"></a><span id="l28.272" class="difflineminus">-  var argumentsArray = argumentsInstance.QueryInterface(Components.interfaces.nsISupportsArray);</span>
<a href="#l28.273"></a><span id="l28.273" class="difflineminus">-</span>
<a href="#l28.274"></a><span id="l28.274" class="difflineminus">-  // get argument (parent)</span>
<a href="#l28.275"></a><span id="l28.275" class="difflineminus">-  var parentArc = rdf.GetResource(&quot;http://home.netscape.com/NC-rdf#parent&quot;);</span>
<a href="#l28.276"></a><span id="l28.276" class="difflineminus">-  if (!parentArc)        return(false);</span>
<a href="#l28.277"></a><span id="l28.277" class="difflineminus">-</span>
<a href="#l28.278"></a><span id="l28.278" class="difflineminus">-  var select_list = treeNode.selectedItems;</span>
<a href="#l28.279"></a><span id="l28.279" class="difflineminus">-  if (select_list.length &lt; 1)</span>
<a href="#l28.280"></a><span id="l28.280" class="difflineminus">-  {</span>
<a href="#l28.281"></a><span id="l28.281" class="difflineminus">-    // if nothing is selected, default to using the &quot;ref&quot; on the root of the tree</span>
<a href="#l28.282"></a><span id="l28.282" class="difflineminus">-    var uri = treeNode.getAttribute(&quot;ref&quot;);</span>
<a href="#l28.283"></a><span id="l28.283" class="difflineminus">-    if (!uri || uri==&quot;&quot;)    return(false);</span>
<a href="#l28.284"></a><span id="l28.284" class="difflineminus">-    var rdfNode = rdf.GetResource(uri);</span>
<a href="#l28.285"></a><span id="l28.285" class="difflineminus">-    // add node into selection array</span>
<a href="#l28.286"></a><span id="l28.286" class="difflineminus">-    if (rdfNode)</span>
<a href="#l28.287"></a><span id="l28.287" class="difflineminus">-    {</span>
<a href="#l28.288"></a><span id="l28.288" class="difflineminus">-      selectionArray.AppendElement(rdfNode);</span>
<a href="#l28.289"></a><span id="l28.289" class="difflineminus">-    }</span>
<a href="#l28.290"></a><span id="l28.290" class="difflineminus">-  }</span>
<a href="#l28.291"></a><span id="l28.291" class="difflineminus">-  else for (var nodeIndex=0; nodeIndex&lt;select_list.length; nodeIndex++)</span>
<a href="#l28.292"></a><span id="l28.292" class="difflineminus">-  {</span>
<a href="#l28.293"></a><span id="l28.293" class="difflineminus">-    var node = select_list[nodeIndex];</span>
<a href="#l28.294"></a><span id="l28.294" class="difflineminus">-    if (!node)    break;</span>
<a href="#l28.295"></a><span id="l28.295" class="difflineminus">-    var uri = node.getAttribute(&quot;ref&quot;);</span>
<a href="#l28.296"></a><span id="l28.296" class="difflineminus">-    if ((uri) || (uri == &quot;&quot;))</span>
<a href="#l28.297"></a><span id="l28.297" class="difflineminus">-    {</span>
<a href="#l28.298"></a><span id="l28.298" class="difflineminus">-      uri = node.getAttribute(&quot;id&quot;);</span>
<a href="#l28.299"></a><span id="l28.299" class="difflineminus">-    }</span>
<a href="#l28.300"></a><span id="l28.300" class="difflineminus">-    if (!uri)    return(false);</span>
<a href="#l28.301"></a><span id="l28.301" class="difflineminus">-</span>
<a href="#l28.302"></a><span id="l28.302" class="difflineminus">-    var rdfNode = rdf.GetResource(uri);</span>
<a href="#l28.303"></a><span id="l28.303" class="difflineminus">-    if (!rdfNode)    break;</span>
<a href="#l28.304"></a><span id="l28.304" class="difflineminus">-</span>
<a href="#l28.305"></a><span id="l28.305" class="difflineminus">-    // add node into selection array</span>
<a href="#l28.306"></a><span id="l28.306" class="difflineminus">-    selectionArray.AppendElement(rdfNode);</span>
<a href="#l28.307"></a><span id="l28.307" class="difflineminus">-</span>
<a href="#l28.308"></a><span id="l28.308" class="difflineminus">-    // get the parent's URI</span>
<a href="#l28.309"></a><span id="l28.309" class="difflineminus">-    var parentURI=&quot;&quot;;</span>
<a href="#l28.310"></a><span id="l28.310" class="difflineminus">-    var theParent = node;</span>
<a href="#l28.311"></a><span id="l28.311" class="difflineminus">-    while (theParent)</span>
<a href="#l28.312"></a><span id="l28.312" class="difflineminus">-    {</span>
<a href="#l28.313"></a><span id="l28.313" class="difflineminus">-      theParent = theParent.parentNode;</span>
<a href="#l28.314"></a><span id="l28.314" class="difflineminus">-</span>
<a href="#l28.315"></a><span id="l28.315" class="difflineminus">-      parentURI = theParent.getAttribute(&quot;ref&quot;);</span>
<a href="#l28.316"></a><span id="l28.316" class="difflineminus">-      if ((!parentURI) || (parentURI == &quot;&quot;))</span>
<a href="#l28.317"></a><span id="l28.317" class="difflineminus">-      {</span>
<a href="#l28.318"></a><span id="l28.318" class="difflineminus">-        parentURI = theParent.getAttribute(&quot;id&quot;);</span>
<a href="#l28.319"></a><span id="l28.319" class="difflineminus">-      }</span>
<a href="#l28.320"></a><span id="l28.320" class="difflineminus">-      if (parentURI != &quot;&quot;)  break;</span>
<a href="#l28.321"></a><span id="l28.321" class="difflineminus">-    }</span>
<a href="#l28.322"></a><span id="l28.322" class="difflineminus">-    if (parentURI == &quot;&quot;)    return(false);</span>
<a href="#l28.323"></a><span id="l28.323" class="difflineminus">-</span>
<a href="#l28.324"></a><span id="l28.324" class="difflineminus">-    var parentNode = rdf.GetResource(parentURI, true);</span>
<a href="#l28.325"></a><span id="l28.325" class="difflineminus">-    if (!parentNode)  return(false);</span>
<a href="#l28.326"></a><span id="l28.326" class="difflineminus">-</span>
<a href="#l28.327"></a><span id="l28.327" class="difflineminus">-    // add parent arc and node into arguments array</span>
<a href="#l28.328"></a><span id="l28.328" class="difflineminus">-    argumentsArray.AppendElement(parentArc);</span>
<a href="#l28.329"></a><span id="l28.329" class="difflineminus">-    argumentsArray.AppendElement(parentNode);</span>
<a href="#l28.330"></a><span id="l28.330" class="difflineminus">-  }</span>
<a href="#l28.331"></a><span id="l28.331" class="difflineminus">-</span>
<a href="#l28.332"></a><span id="l28.332" class="difflineminus">-  // do the command</span>
<a href="#l28.333"></a><span id="l28.333" class="difflineminus">-  compositeDB.DoCommand( selectionArray, cmdResource, argumentsArray );</span>
<a href="#l28.334"></a><span id="l28.334" class="difflineminus">-  return(true);</span>
<a href="#l28.335"></a><span id="l28.335" class="difflineminus">-}</span>
<a href="#l28.336"></a><span id="l28.336" class="difflineminus">-</span>
<a href="#l28.337"></a><span id="l28.337" class="difflineminus">-</span>
<a href="#l28.338"></a><span id="l28.338" class="difflineminus">-</span>
<a href="#l28.339"></a><span id="l28.339" class="difflineminus">-/* Note: doSort() does NOT support natural order sorting, unless naturalOrderResource is valid,</span>
<a href="#l28.340"></a><span id="l28.340" class="difflineminus">-         in which case we sort ascending on naturalOrderResource</span>
<a href="#l28.341"></a><span id="l28.341" class="difflineminus">- */</span>
<a href="#l28.342"></a><span id="l28.342" class="difflineminus">-function doSort(sortColName, naturalOrderResource)</span>
<a href="#l28.343"></a><span id="l28.343" class="difflineminus">-{</span>
<a href="#l28.344"></a><span id="l28.344" class="difflineminus">-  var node = document.getElementById(sortColName);</span>
<a href="#l28.345"></a><span id="l28.345" class="difflineminus">-  // determine column resource to sort on</span>
<a href="#l28.346"></a><span id="l28.346" class="difflineminus">-  var sortResource = node.getAttribute('resource');</span>
<a href="#l28.347"></a><span id="l28.347" class="difflineminus">-  if (!sortResource) return(false);</span>
<a href="#l28.348"></a><span id="l28.348" class="difflineminus">-</span>
<a href="#l28.349"></a><span id="l28.349" class="difflineminus">-  var sortDirection=&quot;ascending&quot;;</span>
<a href="#l28.350"></a><span id="l28.350" class="difflineminus">-  var isSortActive = node.getAttribute('sortActive');</span>
<a href="#l28.351"></a><span id="l28.351" class="difflineminus">-  if (isSortActive == &quot;true&quot;)</span>
<a href="#l28.352"></a><span id="l28.352" class="difflineminus">-  {</span>
<a href="#l28.353"></a><span id="l28.353" class="difflineminus">-    sortDirection = &quot;ascending&quot;;</span>
<a href="#l28.354"></a><span id="l28.354" class="difflineminus">-</span>
<a href="#l28.355"></a><span id="l28.355" class="difflineminus">-    var currentDirection = node.getAttribute('sortDirection');</span>
<a href="#l28.356"></a><span id="l28.356" class="difflineminus">-    if (currentDirection == &quot;ascending&quot;)</span>
<a href="#l28.357"></a><span id="l28.357" class="difflineminus">-    {</span>
<a href="#l28.358"></a><span id="l28.358" class="difflineminus">-      if (sortResource != naturalOrderResource)</span>
<a href="#l28.359"></a><span id="l28.359" class="difflineminus">-      {</span>
<a href="#l28.360"></a><span id="l28.360" class="difflineminus">-        sortDirection = &quot;descending&quot;;</span>
<a href="#l28.361"></a><span id="l28.361" class="difflineminus">-      }</span>
<a href="#l28.362"></a><span id="l28.362" class="difflineminus">-    }</span>
<a href="#l28.363"></a><span id="l28.363" class="difflineminus">-    else if (currentDirection == &quot;descending&quot;)</span>
<a href="#l28.364"></a><span id="l28.364" class="difflineminus">-    {</span>
<a href="#l28.365"></a><span id="l28.365" class="difflineminus">-      if (naturalOrderResource != null &amp;&amp; naturalOrderResource != &quot;&quot;)</span>
<a href="#l28.366"></a><span id="l28.366" class="difflineminus">-      {</span>
<a href="#l28.367"></a><span id="l28.367" class="difflineminus">-        sortResource = naturalOrderResource;</span>
<a href="#l28.368"></a><span id="l28.368" class="difflineminus">-      }</span>
<a href="#l28.369"></a><span id="l28.369" class="difflineminus">-    }</span>
<a href="#l28.370"></a><span id="l28.370" class="difflineminus">-  }</span>
<a href="#l28.371"></a><span id="l28.371" class="difflineminus">-</span>
<a href="#l28.372"></a><span id="l28.372" class="difflineminus">-  var isupports = Components.classes[&quot;@mozilla.org/xul/xul-sort-service;1&quot;].getService();</span>
<a href="#l28.373"></a><span id="l28.373" class="difflineminus">-  if (!isupports)    return(false);</span>
<a href="#l28.374"></a><span id="l28.374" class="difflineminus">-  var xulSortService = isupports.QueryInterface(Components.interfaces.nsIXULSortService);</span>
<a href="#l28.375"></a><span id="l28.375" class="difflineminus">-  if (!xulSortService)    return(false);</span>
<a href="#l28.376"></a><span id="l28.376" class="difflineminus">-  try</span>
<a href="#l28.377"></a><span id="l28.377" class="difflineminus">-  {</span>
<a href="#l28.378"></a><span id="l28.378" class="difflineminus">-    xulSortService.sort(node, sortResource, sortDirection);</span>
<a href="#l28.379"></a><span id="l28.379" class="difflineminus">-  }</span>
<a href="#l28.380"></a><span id="l28.380" class="difflineminus">-  catch(ex)</span>
<a href="#l28.381"></a><span id="l28.381" class="difflineminus">-  {</span>
<a href="#l28.382"></a><span id="l28.382" class="difflineminus">-    debug(&quot;Exception calling xulSortService.sort()&quot;);</span>
<a href="#l28.383"></a><span id="l28.383" class="difflineminus">-  }</span>
<a href="#l28.384"></a><span id="l28.384" class="difflineminus">-  return(true);</span>
<a href="#l28.385"></a><span id="l28.385" class="difflineminus">-}</span>
<a href="#l28.386"></a><span id="l28.386" class="difflineminus">-</span>
<a href="#l28.387"></a><span id="l28.387" class="difflineminus">-</span>
<a href="#l28.388"></a><span id="l28.388" class="difflineminus">-</span>
<a href="#l28.389"></a><span id="l28.389" class="difflineminus">-function setInitialSort(node, sortDirection)</span>
<a href="#l28.390"></a><span id="l28.390" class="difflineminus">-{</span>
<a href="#l28.391"></a><span id="l28.391" class="difflineminus">-  // determine column resource to sort on</span>
<a href="#l28.392"></a><span id="l28.392" class="difflineminus">-  var sortResource = node.getAttribute('resource');</span>
<a href="#l28.393"></a><span id="l28.393" class="difflineminus">-  if (!sortResource) return(false);</span>
<a href="#l28.394"></a><span id="l28.394" class="difflineminus">-</span>
<a href="#l28.395"></a><span id="l28.395" class="difflineminus">-  try</span>
<a href="#l28.396"></a><span id="l28.396" class="difflineminus">-  {</span>
<a href="#l28.397"></a><span id="l28.397" class="difflineminus">-    var isupports = Components.classes[&quot;@mozilla.org/xul/xul-sort-service;1&quot;].getService();</span>
<a href="#l28.398"></a><span id="l28.398" class="difflineminus">-    if (!isupports)    return(false);</span>
<a href="#l28.399"></a><span id="l28.399" class="difflineminus">-    var xulSortService = isupports.QueryInterface(Components.interfaces.nsIXULSortService);</span>
<a href="#l28.400"></a><span id="l28.400" class="difflineminus">-    if (!xulSortService)    return(false);</span>
<a href="#l28.401"></a><span id="l28.401" class="difflineminus">-    xulSortService.sort(node, sortResource, sortDirection);</span>
<a href="#l28.402"></a><span id="l28.402" class="difflineminus">-  }</span>
<a href="#l28.403"></a><span id="l28.403" class="difflineminus">-  catch(ex)</span>
<a href="#l28.404"></a><span id="l28.404" class="difflineminus">-  {</span>
<a href="#l28.405"></a><span id="l28.405" class="difflineminus">-  }</span>
<a href="#l28.406"></a><span id="l28.406" class="difflineminus">-  return(true);</span>
<a href="#l28.407"></a><span id="l28.407" class="difflineminus">-}</span>
<a href="#l28.408"></a><span id="l28.408" class="difflineminus">-</span>
<a href="#l28.409"></a><span id="l28.409" class="difflineminus">-</span>
<a href="#l28.410"></a><span id="l28.410" class="difflineminus">-function switchTab(aPageIndex)</span>
<a href="#l28.411"></a><span id="l28.411" class="difflineminus">-{</span>
<a href="#l28.412"></a><span id="l28.412" class="difflineminus">-  var deck = document.getElementById(&quot;advancedDeck&quot;);</span>
<a href="#l28.413"></a><span id="l28.413" class="difflineminus">-  if (!deck)</span>
<a href="#l28.414"></a><span id="l28.414" class="difflineminus">-  { // get the search-panel deck the hard way </span>
<a href="#l28.415"></a><span id="l28.415" class="difflineminus">-    // otherwise the switchTab call from internetresults.xul would fail</span>
<a href="#l28.416"></a><span id="l28.416" class="difflineminus">-    var oSearchPanel = getNavigatorWindow(false).sidebarObj.panels.get_panel_from_id(&quot;urn:sidebar:panel:search&quot;);</span>
<a href="#l28.417"></a><span id="l28.417" class="difflineminus">-    if (!oSearchPanel)</span>
<a href="#l28.418"></a><span id="l28.418" class="difflineminus">-      return;</span>
<a href="#l28.419"></a><span id="l28.419" class="difflineminus">-    deck = oSearchPanel.get_iframe().contentDocument.getElementById(&quot;advancedDeck&quot;)</span>
<a href="#l28.420"></a><span id="l28.420" class="difflineminus">-  }</span>
<a href="#l28.421"></a><span id="l28.421" class="difflineminus">-  deck.setAttribute(&quot;selectedIndex&quot;, aPageIndex);</span>
<a href="#l28.422"></a><span id="l28.422" class="difflineminus">-}</span>
<a href="#l28.423"></a><span id="l28.423" class="difflineminus">-</span>
<a href="#l28.424"></a><span id="l28.424" class="difflineminus">-</span>
<a href="#l28.425"></a><span id="l28.425" class="difflineminus">-// retrieves the most recent navigator window</span>
<a href="#l28.426"></a><span id="l28.426" class="difflineminus">-function getNavigatorWindow(aOpenFlag)</span>
<a href="#l28.427"></a><span id="l28.427" class="difflineminus">-{</span>
<a href="#l28.428"></a><span id="l28.428" class="difflineminus">-  var navigatorWindow;</span>
<a href="#l28.429"></a><span id="l28.429" class="difflineminus">-</span>
<a href="#l28.430"></a><span id="l28.430" class="difflineminus">-  // if this is a browser window, just use it</span>
<a href="#l28.431"></a><span id="l28.431" class="difflineminus">-  if (&quot;document&quot; in top) {</span>
<a href="#l28.432"></a><span id="l28.432" class="difflineminus">-    var possibleNavigator = top.document.getElementById(&quot;main-window&quot;);</span>
<a href="#l28.433"></a><span id="l28.433" class="difflineminus">-    if (possibleNavigator &amp;&amp;</span>
<a href="#l28.434"></a><span id="l28.434" class="difflineminus">-        possibleNavigator.getAttribute(&quot;windowtype&quot;) == &quot;navigator:browser&quot;)</span>
<a href="#l28.435"></a><span id="l28.435" class="difflineminus">-      navigatorWindow = top;</span>
<a href="#l28.436"></a><span id="l28.436" class="difflineminus">-  }</span>
<a href="#l28.437"></a><span id="l28.437" class="difflineminus">-</span>
<a href="#l28.438"></a><span id="l28.438" class="difflineminus">-  // if not, get the most recently used browser window</span>
<a href="#l28.439"></a><span id="l28.439" class="difflineminus">-  if (!navigatorWindow) {</span>
<a href="#l28.440"></a><span id="l28.440" class="difflineminus">-    var wm = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l28.441"></a><span id="l28.441" class="difflineminus">-                       .getService(Components.interfaces.nsIWindowMediator);</span>
<a href="#l28.442"></a><span id="l28.442" class="difflineminus">-    navigatorWindow = wm.getMostRecentWindow(&quot;navigator:browser&quot;);</span>
<a href="#l28.443"></a><span id="l28.443" class="difflineminus">-  }</span>
<a href="#l28.444"></a><span id="l28.444" class="difflineminus">-</span>
<a href="#l28.445"></a><span id="l28.445" class="difflineminus">-  // if no browser window available and it's ok to open a new one, do so</span>
<a href="#l28.446"></a><span id="l28.446" class="difflineminus">-  if (!navigatorWindow &amp;&amp; aOpenFlag) {</span>
<a href="#l28.447"></a><span id="l28.447" class="difflineminus">-    var navigatorChromeURL = search_getBrowserURL();</span>
<a href="#l28.448"></a><span id="l28.448" class="difflineminus">-    navigatorWindow = openDialog(navigatorChromeURL, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;);</span>
<a href="#l28.449"></a><span id="l28.449" class="difflineminus">-  }</span>
<a href="#l28.450"></a><span id="l28.450" class="difflineminus">-  return navigatorWindow;</span>
<a href="#l28.451"></a><span id="l28.451" class="difflineminus">-}</span>
<a href="#l28.452"></a><span id="l28.452" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/suite/common/src/SuiteCommon.manifest</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/suite/common/src/SuiteCommon.manifest</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -16,8 +16,9 @@ contract @mozilla.org/suite/sessionstore</span>
<a href="#l29.4"></a><span id="l29.4"> component {bbbbe845-5a1b-40ee-813c-f84b8faaa07c} nsSuiteGlue.js</span>
<a href="#l29.5"></a><span id="l29.5"> contract @mozilla.org/suite/suiteglue;1 {bbbbe845-5a1b-40ee-813c-f84b8faaa07c}</span>
<a href="#l29.6"></a><span id="l29.6"> category app-startup nsSuiteGlue service,@mozilla.org/suite/suiteglue;1</span>
<a href="#l29.7"></a><span id="l29.7"> component {9d4c845d-3f09-402a-b66d-50f291d7d50f} nsSuiteGlue.js</span>
<a href="#l29.8"></a><span id="l29.8"> contract @mozilla.org/content-permission/prompt;1 {9d4c845d-3f09-402a-b66d-50f291d7d50f}</span>
<a href="#l29.9"></a><span id="l29.9"> component {22117140-9c6e-11d3-aaf1-00805f8a4905} nsSidebar.js</span>
<a href="#l29.10"></a><span id="l29.10"> contract @mozilla.org/sidebar;1 {22117140-9c6e-11d3-aaf1-00805f8a4905}</span>
<a href="#l29.11"></a><span id="l29.11"> category JavaScript-global-property sidebar @mozilla.org/sidebar;1</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+category JavaScript-global-property external @mozilla.org/sidebar;1</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/suite/common/src/nsSidebar.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/suite/common/src/nsSidebar.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -54,43 +54,41 @@</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5"> const DEBUG = false; /* set to false to suppress debug messages */</span>
<a href="#l30.6"></a><span id="l30.6"> const PANELS_RDF_FILE  = &quot;UPnls&quot;; /* directory services property to find panels.rdf */</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8"> const SIDEBAR_CID      = Components.ID(&quot;{22117140-9c6e-11d3-aaf1-00805f8a4905}&quot;);</span>
<a href="#l30.9"></a><span id="l30.9"> const CONTAINER_CONTRACTID = &quot;@mozilla.org/rdf/container;1&quot;;</span>
<a href="#l30.10"></a><span id="l30.10"> const DIR_SERV_CONTRACTID  = &quot;@mozilla.org/file/directory_service;1&quot;</span>
<a href="#l30.11"></a><span id="l30.11"> const NETSEARCH_CONTRACTID = &quot;@mozilla.org/rdf/datasource;1?name=internetsearch&quot;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-const IO_SERV_CONTRACTID   = &quot;@mozilla.org/network/io-service;1&quot;;</span>
<a href="#l30.13"></a><span id="l30.13"> const nsISupports      = Components.interfaces.nsISupports;</span>
<a href="#l30.14"></a><span id="l30.14"> const nsISidebar       = Components.interfaces.nsISidebar;</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+const nsISidebarExternal = Components.interfaces.nsISidebarExternal;</span>
<a href="#l30.16"></a><span id="l30.16"> const nsIRDFContainer  = Components.interfaces.nsIRDFContainer;</span>
<a href="#l30.17"></a><span id="l30.17"> const nsIProperties    = Components.interfaces.nsIProperties;</span>
<a href="#l30.18"></a><span id="l30.18"> const nsIFileURL       = Components.interfaces.nsIFileURL;</span>
<a href="#l30.19"></a><span id="l30.19"> const nsIRDFRemoteDataSource = Components.interfaces.nsIRDFRemoteDataSource;</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineminus">-const nsIInternetSearchService = Components.interfaces.nsIInternetSearchService;</span>
<a href="#l30.21"></a><span id="l30.21"> const nsIClassInfo = Components.interfaces.nsIClassInfo;</span>
<a href="#l30.22"></a><span id="l30.22"> </span>
<a href="#l30.23"></a><span id="l30.23" class="difflineplus">+// File extension for Sherlock search plugin description files</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineplus">+const SHERLOCK_FILE_EXT_REGEXP = /\.src$/i;</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineplus">+</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l30.27"></a><span id="l30.27"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l30.28"></a><span id="l30.28"> </span>
<a href="#l30.29"></a><span id="l30.29"> function nsSidebar()</span>
<a href="#l30.30"></a><span id="l30.30"> {</span>
<a href="#l30.31"></a><span id="l30.31">     const RDF_CONTRACTID = &quot;@mozilla.org/rdf/rdf-service;1&quot;;</span>
<a href="#l30.32"></a><span id="l30.32">     const nsIRDFService = Components.interfaces.nsIRDFService;</span>
<a href="#l30.33"></a><span id="l30.33"> </span>
<a href="#l30.34"></a><span id="l30.34">     this.rdf = Components.classes[RDF_CONTRACTID].getService(nsIRDFService);</span>
<a href="#l30.35"></a><span id="l30.35">     this.datasource_uri = getSidebarDatasourceURI(PANELS_RDF_FILE);</span>
<a href="#l30.36"></a><span id="l30.36">     debug('datasource_uri is ' + this.datasource_uri);</span>
<a href="#l30.37"></a><span id="l30.37">     this.resource = 'urn:sidebar:current-panel-list';</span>
<a href="#l30.38"></a><span id="l30.38">     this.datasource = this.rdf.GetDataSource(this.datasource_uri);</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineminus">-</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineminus">-    const PROMPTSERVICE_CONTRACTID = &quot;@mozilla.org/embedcomp/prompt-service;1&quot;;</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineminus">-    const nsIPromptService = Components.interfaces.nsIPromptService;</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineminus">-    this.promptService =</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineminus">-        Components.classes[PROMPTSERVICE_CONTRACTID].getService(nsIPromptService);</span>
<a href="#l30.44"></a><span id="l30.44"> }</span>
<a href="#l30.45"></a><span id="l30.45"> </span>
<a href="#l30.46"></a><span id="l30.46"> nsSidebar.prototype.nc = &quot;http://home.netscape.com/NC-rdf#&quot;;</span>
<a href="#l30.47"></a><span id="l30.47"> </span>
<a href="#l30.48"></a><span id="l30.48"> nsSidebar.prototype.isPanel =</span>
<a href="#l30.49"></a><span id="l30.49"> function (aContentURL)</span>
<a href="#l30.50"></a><span id="l30.50"> {</span>
<a href="#l30.51"></a><span id="l30.51">     var container =</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineat">@@ -151,39 +149,39 @@ function (aTitle, aContentURL, aCustomiz</span>
<a href="#l30.53"></a><span id="l30.53">     /* Create a resource for the new panel and add it to the list */</span>
<a href="#l30.54"></a><span id="l30.54">     var panel_resource =</span>
<a href="#l30.55"></a><span id="l30.55">         this.rdf.GetResource(&quot;urn:sidebar:3rdparty-panel:&quot; + aContentURL);</span>
<a href="#l30.56"></a><span id="l30.56">     var panel_index = container.IndexOf(panel_resource);</span>
<a href="#l30.57"></a><span id="l30.57">     var stringBundle, brandStringBundle, titleMessage, dialogMessage;</span>
<a href="#l30.58"></a><span id="l30.58">     if (panel_index != -1)</span>
<a href="#l30.59"></a><span id="l30.59">     {</span>
<a href="#l30.60"></a><span id="l30.60">         try {</span>
<a href="#l30.61"></a><span id="l30.61" class="difflineminus">-            stringBundle = srGetStrBundle(&quot;chrome://communicator/locale/sidebar/sidebar.properties&quot;);</span>
<a href="#l30.62"></a><span id="l30.62" class="difflineminus">-            brandStringBundle = srGetStrBundle(&quot;chrome://branding/locale/brand.properties&quot;);</span>
<a href="#l30.63"></a><span id="l30.63" class="difflineplus">+            stringBundle = Services.strings.createBundle(&quot;chrome://communicator/locale/sidebar/sidebar.properties&quot;);</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineplus">+            brandStringBundle = Services.strings.createBundle(&quot;chrome://branding/locale/brand.properties&quot;);</span>
<a href="#l30.65"></a><span id="l30.65">             if (stringBundle) {</span>
<a href="#l30.66"></a><span id="l30.66">                 sidebarName = brandStringBundle.GetStringFromName(&quot;sidebarName&quot;);</span>
<a href="#l30.67"></a><span id="l30.67">                 titleMessage = stringBundle.GetStringFromName(&quot;dupePanelAlertTitle&quot;);</span>
<a href="#l30.68"></a><span id="l30.68">                 dialogMessage = stringBundle.GetStringFromName(&quot;dupePanelAlertMessage&quot;);</span>
<a href="#l30.69"></a><span id="l30.69">                 dialogMessage = dialogMessage.replace(/%url%/, aContentURL);</span>
<a href="#l30.70"></a><span id="l30.70">                 dialogMessage = dialogMessage.replace(/%name%/, sidebarName);</span>
<a href="#l30.71"></a><span id="l30.71">             }</span>
<a href="#l30.72"></a><span id="l30.72">         }</span>
<a href="#l30.73"></a><span id="l30.73">         catch (e) {</span>
<a href="#l30.74"></a><span id="l30.74">             titleMessage = &quot;Sidebar&quot;;</span>
<a href="#l30.75"></a><span id="l30.75">             dialogMessage = aContentURL + &quot; already exists in Sidebar.  No string bundle&quot;;</span>
<a href="#l30.76"></a><span id="l30.76">         }</span>
<a href="#l30.77"></a><span id="l30.77"> </span>
<a href="#l30.78"></a><span id="l30.78" class="difflineminus">-        this.promptService.alert(null, titleMessage, dialogMessage);</span>
<a href="#l30.79"></a><span id="l30.79" class="difflineplus">+        Services.prompt.alert(null, titleMessage, dialogMessage);</span>
<a href="#l30.80"></a><span id="l30.80"> </span>
<a href="#l30.81"></a><span id="l30.81">         return;</span>
<a href="#l30.82"></a><span id="l30.82">     }</span>
<a href="#l30.83"></a><span id="l30.83"> </span>
<a href="#l30.84"></a><span id="l30.84">     try {</span>
<a href="#l30.85"></a><span id="l30.85" class="difflineminus">-        stringBundle = srGetStrBundle(&quot;chrome://communicator/locale/sidebar/sidebar.properties&quot;);</span>
<a href="#l30.86"></a><span id="l30.86" class="difflineminus">-        brandStringBundle = srGetStrBundle(&quot;chrome://branding/locale/brand.properties&quot;);</span>
<a href="#l30.87"></a><span id="l30.87" class="difflineplus">+        stringBundle = Services.strings.createBundle(&quot;chrome://communicator/locale/sidebar/sidebar.properties&quot;);</span>
<a href="#l30.88"></a><span id="l30.88" class="difflineplus">+        brandStringBundle = Services.strings.createBundle(&quot;chrome://branding/locale/brand.properties&quot;);</span>
<a href="#l30.89"></a><span id="l30.89">         if (stringBundle) {</span>
<a href="#l30.90"></a><span id="l30.90">             sidebarName = brandStringBundle.GetStringFromName(&quot;sidebarName&quot;);</span>
<a href="#l30.91"></a><span id="l30.91">             titleMessage = stringBundle.GetStringFromName(&quot;addPanelConfirmTitle&quot;);</span>
<a href="#l30.92"></a><span id="l30.92">             dialogMessage = stringBundle.GetStringFromName(&quot;addPanelConfirmMessage&quot;);</span>
<a href="#l30.93"></a><span id="l30.93">             if (aPersist)</span>
<a href="#l30.94"></a><span id="l30.94">             {</span>
<a href="#l30.95"></a><span id="l30.95">                 var warning = stringBundle.GetStringFromName(&quot;persistentPanelWarning&quot;);</span>
<a href="#l30.96"></a><span id="l30.96">                 dialogMessage += &quot;\n&quot; + warning;</span>
<a href="#l30.97"></a><span id="l30.97" class="difflineat">@@ -194,17 +192,17 @@ function (aTitle, aContentURL, aCustomiz</span>
<a href="#l30.98"></a><span id="l30.98">             dialogMessage = dialogMessage.replace(/%name%/g, sidebarName);</span>
<a href="#l30.99"></a><span id="l30.99">         }</span>
<a href="#l30.100"></a><span id="l30.100">     }</span>
<a href="#l30.101"></a><span id="l30.101">     catch (e) {</span>
<a href="#l30.102"></a><span id="l30.102">         titleMessage = &quot;Add Tab to Sidebar&quot;;</span>
<a href="#l30.103"></a><span id="l30.103">         dialogMessage = &quot;No string bundle.  Add the Tab '&quot; + aTitle + &quot;' to Sidebar?\n\n&quot; + &quot;Source: &quot; + aContentURL;</span>
<a href="#l30.104"></a><span id="l30.104">     }</span>
<a href="#l30.105"></a><span id="l30.105"> </span>
<a href="#l30.106"></a><span id="l30.106" class="difflineminus">-    var rv = this.promptService.confirm(null, titleMessage, dialogMessage);</span>
<a href="#l30.107"></a><span id="l30.107" class="difflineplus">+    var rv = Services.prompt.confirm(null, titleMessage, dialogMessage);</span>
<a href="#l30.108"></a><span id="l30.108"> </span>
<a href="#l30.109"></a><span id="l30.109">     if (!rv)</span>
<a href="#l30.110"></a><span id="l30.110">         return;</span>
<a href="#l30.111"></a><span id="l30.111"> </span>
<a href="#l30.112"></a><span id="l30.112">     /* Now make some sidebar-ish assertions about it... */</span>
<a href="#l30.113"></a><span id="l30.113">     this.datasource.Assert(panel_resource,</span>
<a href="#l30.114"></a><span id="l30.114">                            this.rdf.GetResource(this.nc + &quot;title&quot;),</span>
<a href="#l30.115"></a><span id="l30.115">                            this.rdf.GetLiteral(aTitle),</span>
<a href="#l30.116"></a><span id="l30.116" class="difflineat">@@ -235,97 +233,130 @@ function (aTitle, aContentURL, aCustomiz</span>
<a href="#l30.117"></a><span id="l30.117">     this.datasource.Unassert(this.rdf.GetResource(this.resource),</span>
<a href="#l30.118"></a><span id="l30.118">                              this.rdf.GetResource(this.nc + &quot;refresh&quot;),</span>
<a href="#l30.119"></a><span id="l30.119">                              this.rdf.GetLiteral(&quot;true&quot;));</span>
<a href="#l30.120"></a><span id="l30.120"> </span>
<a href="#l30.121"></a><span id="l30.121">     /* Write the modified panels out. */</span>
<a href="#l30.122"></a><span id="l30.122">     this.datasource.QueryInterface(nsIRDFRemoteDataSource).Flush();</span>
<a href="#l30.123"></a><span id="l30.123"> }</span>
<a href="#l30.124"></a><span id="l30.124"> </span>
<a href="#l30.125"></a><span id="l30.125" class="difflineminus">-/* decorate prototype to provide ``class'' methods and property accessors */</span>
<a href="#l30.126"></a><span id="l30.126" class="difflineplus">+nsSidebar.prototype.validateSearchEngine =</span>
<a href="#l30.127"></a><span id="l30.127" class="difflineplus">+function (engineURL, iconURL)</span>
<a href="#l30.128"></a><span id="l30.128" class="difflineplus">+{</span>
<a href="#l30.129"></a><span id="l30.129" class="difflineplus">+  try</span>
<a href="#l30.130"></a><span id="l30.130" class="difflineplus">+  {</span>
<a href="#l30.131"></a><span id="l30.131" class="difflineplus">+    // Make sure the URLs are HTTP, HTTPS, or FTP.</span>
<a href="#l30.132"></a><span id="l30.132" class="difflineplus">+    var isWeb = /^(https?|ftp):\/\//i;</span>
<a href="#l30.133"></a><span id="l30.133" class="difflineplus">+</span>
<a href="#l30.134"></a><span id="l30.134" class="difflineplus">+    if (!isWeb.test(engineURL))</span>
<a href="#l30.135"></a><span id="l30.135" class="difflineplus">+      throw &quot;Unsupported search engine URL&quot;;</span>
<a href="#l30.136"></a><span id="l30.136" class="difflineplus">+</span>
<a href="#l30.137"></a><span id="l30.137" class="difflineplus">+    if (iconURL &amp;&amp; !isWeb.test(iconURL))</span>
<a href="#l30.138"></a><span id="l30.138" class="difflineplus">+      throw &quot;Unsupported search icon URL.&quot;;</span>
<a href="#l30.139"></a><span id="l30.139" class="difflineplus">+  }</span>
<a href="#l30.140"></a><span id="l30.140" class="difflineplus">+  catch(ex)</span>
<a href="#l30.141"></a><span id="l30.141" class="difflineplus">+  {</span>
<a href="#l30.142"></a><span id="l30.142" class="difflineplus">+    debug(ex);</span>
<a href="#l30.143"></a><span id="l30.143" class="difflineplus">+    Components.utils.reportError(&quot;Invalid argument passed to window.sidebar.addSearchEngine: &quot; + ex);</span>
<a href="#l30.144"></a><span id="l30.144" class="difflineplus">+</span>
<a href="#l30.145"></a><span id="l30.145" class="difflineplus">+    var searchBundle = Services.strings.createBundle(&quot;chrome://global/locale/search/search.properties&quot;);</span>
<a href="#l30.146"></a><span id="l30.146" class="difflineplus">+    var brandBundle = Services.strings.createBundle(&quot;chrome://branding/locale/brand.properties&quot;);</span>
<a href="#l30.147"></a><span id="l30.147" class="difflineplus">+    var brandName = brandBundle.GetStringFromName(&quot;brandShortName&quot;);</span>
<a href="#l30.148"></a><span id="l30.148" class="difflineplus">+    var title = searchBundle.GetStringFromName(&quot;error_invalid_engine_title&quot;);</span>
<a href="#l30.149"></a><span id="l30.149" class="difflineplus">+    var msg = searchBundle.formatStringFromName(&quot;error_invalid_engine_msg&quot;,</span>
<a href="#l30.150"></a><span id="l30.150" class="difflineplus">+                                                [brandName], 1);</span>
<a href="#l30.151"></a><span id="l30.151" class="difflineplus">+    Services.ww.getNewPrompter(null).alert(title, msg);</span>
<a href="#l30.152"></a><span id="l30.152" class="difflineplus">+    return false;</span>
<a href="#l30.153"></a><span id="l30.153" class="difflineplus">+  }</span>
<a href="#l30.154"></a><span id="l30.154" class="difflineplus">+</span>
<a href="#l30.155"></a><span id="l30.155" class="difflineplus">+  return true;</span>
<a href="#l30.156"></a><span id="l30.156" class="difflineplus">+}</span>
<a href="#l30.157"></a><span id="l30.157" class="difflineplus">+</span>
<a href="#l30.158"></a><span id="l30.158" class="difflineplus">+// The suggestedTitle and suggestedCategory parameters are ignored, but remain</span>
<a href="#l30.159"></a><span id="l30.159" class="difflineplus">+// for backward compatibility.</span>
<a href="#l30.160"></a><span id="l30.160"> nsSidebar.prototype.addSearchEngine =</span>
<a href="#l30.161"></a><span id="l30.161"> function (engineURL, iconURL, suggestedTitle, suggestedCategory)</span>
<a href="#l30.162"></a><span id="l30.162"> {</span>
<a href="#l30.163"></a><span id="l30.163" class="difflineminus">-    debug(&quot;addSearchEngine(&quot; + engineURL + &quot;, &quot; + iconURL + &quot;, &quot; +</span>
<a href="#l30.164"></a><span id="l30.164" class="difflineminus">-          suggestedCategory + &quot;, &quot; + suggestedTitle + &quot;)&quot;);</span>
<a href="#l30.165"></a><span id="l30.165" class="difflineplus">+  debug(&quot;addSearchEngine(&quot; + engineURL + &quot;, &quot; + iconURL + &quot;, &quot; +</span>
<a href="#l30.166"></a><span id="l30.166" class="difflineplus">+        suggestedCategory + &quot;, &quot; + suggestedTitle + &quot;)&quot;);</span>
<a href="#l30.167"></a><span id="l30.167"> </span>
<a href="#l30.168"></a><span id="l30.168" class="difflineminus">-    try</span>
<a href="#l30.169"></a><span id="l30.169" class="difflineminus">-    {</span>
<a href="#l30.170"></a><span id="l30.170" class="difflineminus">-        // make sure using HTTP or HTTPS and refering to a .src file</span>
<a href="#l30.171"></a><span id="l30.171" class="difflineminus">-        // for the engine.</span>
<a href="#l30.172"></a><span id="l30.172" class="difflineminus">-        if (! /^https?:\/\/.+\.src$/i.test(engineURL))</span>
<a href="#l30.173"></a><span id="l30.173" class="difflineminus">-            throw &quot;Unsupported search engine URL&quot;;</span>
<a href="#l30.174"></a><span id="l30.174" class="difflineplus">+  if (!this.validateSearchEngine(engineURL, iconURL))</span>
<a href="#l30.175"></a><span id="l30.175" class="difflineplus">+    return;</span>
<a href="#l30.176"></a><span id="l30.176"> </span>
<a href="#l30.177"></a><span id="l30.177" class="difflineminus">-        // make sure using HTTP or HTTPS and refering to a</span>
<a href="#l30.178"></a><span id="l30.178" class="difflineminus">-        // .gif/.jpg/.jpeg/.png file for the icon.</span>
<a href="#l30.179"></a><span id="l30.179" class="difflineminus">-        if (! /^https?:\/\/.+\.(gif|jpg|jpeg|png)$/i.test(iconURL))</span>
<a href="#l30.180"></a><span id="l30.180" class="difflineminus">-            throw &quot;Unsupported search icon URL&quot;;</span>
<a href="#l30.181"></a><span id="l30.181" class="difflineminus">-    }</span>
<a href="#l30.182"></a><span id="l30.182" class="difflineminus">-    catch(ex)</span>
<a href="#l30.183"></a><span id="l30.183" class="difflineminus">-    {</span>
<a href="#l30.184"></a><span id="l30.184" class="difflineminus">-        debug(ex);</span>
<a href="#l30.185"></a><span id="l30.185" class="difflineminus">-        this.promptService.alert(null, &quot;Error&quot;, &quot;Failed to add the search engine.&quot;);</span>
<a href="#l30.186"></a><span id="l30.186" class="difflineminus">-        throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l30.187"></a><span id="l30.187" class="difflineminus">-    }</span>
<a href="#l30.188"></a><span id="l30.188" class="difflineplus">+  // OpenSearch files will likely be far more common than Sherlock files, and</span>
<a href="#l30.189"></a><span id="l30.189" class="difflineplus">+  // have less consistent suffixes, so we assume that &quot;.src&quot; is a Sherlock</span>
<a href="#l30.190"></a><span id="l30.190" class="difflineplus">+  // (text) file, and anything else is OpenSearch (XML).</span>
<a href="#l30.191"></a><span id="l30.191" class="difflineplus">+  var dataType;</span>
<a href="#l30.192"></a><span id="l30.192" class="difflineplus">+  if (SHERLOCK_FILE_EXT_REGEXP.test(engineURL))</span>
<a href="#l30.193"></a><span id="l30.193" class="difflineplus">+    dataType = Components.interfaces.nsISearchEngine.DATA_TEXT;</span>
<a href="#l30.194"></a><span id="l30.194" class="difflineplus">+  else</span>
<a href="#l30.195"></a><span id="l30.195" class="difflineplus">+    dataType = Components.interfaces.nsISearchEngine.DATA_XML;</span>
<a href="#l30.196"></a><span id="l30.196" class="difflineplus">+</span>
<a href="#l30.197"></a><span id="l30.197" class="difflineplus">+  Services.search.addEngine(engineURL, dataType, iconURL, true);</span>
<a href="#l30.198"></a><span id="l30.198" class="difflineplus">+}</span>
<a href="#l30.199"></a><span id="l30.199"> </span>
<a href="#l30.200"></a><span id="l30.200" class="difflineminus">-    var titleMessage, dialogMessage;</span>
<a href="#l30.201"></a><span id="l30.201" class="difflineminus">-    try {</span>
<a href="#l30.202"></a><span id="l30.202" class="difflineminus">-        var stringBundle = srGetStrBundle(&quot;chrome://communicator/locale/sidebar/sidebar.properties&quot;);</span>
<a href="#l30.203"></a><span id="l30.203" class="difflineminus">-        var brandStringBundle = srGetStrBundle(&quot;chrome://branding/locale/brand.properties&quot;);</span>
<a href="#l30.204"></a><span id="l30.204" class="difflineminus">-        if (stringBundle) {</span>
<a href="#l30.205"></a><span id="l30.205" class="difflineminus">-            sidebarName = brandStringBundle.GetStringFromName(&quot;sidebarName&quot;);</span>
<a href="#l30.206"></a><span id="l30.206" class="difflineminus">-            titleMessage = stringBundle.GetStringFromName(&quot;addEngineConfirmTitle&quot;);</span>
<a href="#l30.207"></a><span id="l30.207" class="difflineminus">-            dialogMessage = stringBundle.GetStringFromName(&quot;addEngineConfirmMessage&quot;);</span>
<a href="#l30.208"></a><span id="l30.208" class="difflineminus">-            dialogMessage = dialogMessage.replace(/%title%/, suggestedTitle);</span>
<a href="#l30.209"></a><span id="l30.209" class="difflineminus">-            dialogMessage = dialogMessage.replace(/%category%/, suggestedCategory);</span>
<a href="#l30.210"></a><span id="l30.210" class="difflineminus">-            dialogMessage = dialogMessage.replace(/%url%/, engineURL);</span>
<a href="#l30.211"></a><span id="l30.211" class="difflineminus">-            dialogMessage = dialogMessage.replace(/#/g, &quot;\n&quot;);</span>
<a href="#l30.212"></a><span id="l30.212" class="difflineminus">-            dialogMessage = dialogMessage.replace(/%name%/, sidebarName);</span>
<a href="#l30.213"></a><span id="l30.213" class="difflineminus">-        }</span>
<a href="#l30.214"></a><span id="l30.214" class="difflineminus">-    }</span>
<a href="#l30.215"></a><span id="l30.215" class="difflineminus">-    catch (e) {</span>
<a href="#l30.216"></a><span id="l30.216" class="difflineminus">-        titleMessage = &quot;Add Search Engine&quot;;</span>
<a href="#l30.217"></a><span id="l30.217" class="difflineminus">-        dialogMessage = &quot;Add the following search engine?\n\nName: &quot; + suggestedTitle;</span>
<a href="#l30.218"></a><span id="l30.218" class="difflineminus">-        dialogMessage += &quot;\nSearch Category: &quot; + suggestedCategory;</span>
<a href="#l30.219"></a><span id="l30.219" class="difflineminus">-        dialogMessage += &quot;\nSource: &quot; + engineURL;</span>
<a href="#l30.220"></a><span id="l30.220" class="difflineminus">-    }</span>
<a href="#l30.221"></a><span id="l30.221" class="difflineplus">+// This function exists largely to implement window.external.AddSearchProvider(),</span>
<a href="#l30.222"></a><span id="l30.222" class="difflineplus">+// to match other browsers' APIs.  The capitalization, although nonstandard here,</span>
<a href="#l30.223"></a><span id="l30.223" class="difflineplus">+// is therefore important.</span>
<a href="#l30.224"></a><span id="l30.224" class="difflineplus">+nsSidebar.prototype.AddSearchProvider =</span>
<a href="#l30.225"></a><span id="l30.225" class="difflineplus">+function (aDescriptionURL)</span>
<a href="#l30.226"></a><span id="l30.226" class="difflineplus">+{</span>
<a href="#l30.227"></a><span id="l30.227" class="difflineplus">+  // Get the favicon URL for the current page, or our best guess at the current</span>
<a href="#l30.228"></a><span id="l30.228" class="difflineplus">+  // page since we don't have easy access to the active document.  Most search</span>
<a href="#l30.229"></a><span id="l30.229" class="difflineplus">+  // engines will override this with an icon specified in the OpenSearch</span>
<a href="#l30.230"></a><span id="l30.230" class="difflineplus">+  // description anyway.</span>
<a href="#l30.231"></a><span id="l30.231" class="difflineplus">+  var win = Services.wm.getMostRecentWindow(&quot;navigator:browser&quot;);</span>
<a href="#l30.232"></a><span id="l30.232" class="difflineplus">+  var browser = win.getBrowser();</span>
<a href="#l30.233"></a><span id="l30.233" class="difflineplus">+  var iconURL = &quot;&quot;;</span>
<a href="#l30.234"></a><span id="l30.234" class="difflineplus">+  // Use documentURIObject in the check for shouldLoadFavIcon so that we</span>
<a href="#l30.235"></a><span id="l30.235" class="difflineplus">+  // do the right thing with about:-style error pages.  Bug 453442</span>
<a href="#l30.236"></a><span id="l30.236" class="difflineplus">+  if (browser.shouldLoadFavIcon(browser.selectedBrowser</span>
<a href="#l30.237"></a><span id="l30.237" class="difflineplus">+                                       .contentDocument</span>
<a href="#l30.238"></a><span id="l30.238" class="difflineplus">+                                       .documentURIObject))</span>
<a href="#l30.239"></a><span id="l30.239" class="difflineplus">+    iconURL = browser.getIcon();</span>
<a href="#l30.240"></a><span id="l30.240"> </span>
<a href="#l30.241"></a><span id="l30.241" class="difflineminus">-    var rv = this.promptService.confirm(null, titleMessage, dialogMessage);</span>
<a href="#l30.242"></a><span id="l30.242" class="difflineplus">+  if (!this.validateSearchEngine(aDescriptionURL, iconURL))</span>
<a href="#l30.243"></a><span id="l30.243" class="difflineplus">+    return;</span>
<a href="#l30.244"></a><span id="l30.244"> </span>
<a href="#l30.245"></a><span id="l30.245" class="difflineminus">-    if (!rv)</span>
<a href="#l30.246"></a><span id="l30.246" class="difflineminus">-        return;</span>
<a href="#l30.247"></a><span id="l30.247" class="difflineplus">+  const typeXML = Components.interfaces.nsISearchEngine.DATA_XML;</span>
<a href="#l30.248"></a><span id="l30.248" class="difflineplus">+  Services.search.addEngine(aDescriptionURL, typeXML, iconURL, true);</span>
<a href="#l30.249"></a><span id="l30.249" class="difflineplus">+}</span>
<a href="#l30.250"></a><span id="l30.250"> </span>
<a href="#l30.251"></a><span id="l30.251" class="difflineminus">-    var internetSearch = Components.classes[NETSEARCH_CONTRACTID].getService();</span>
<a href="#l30.252"></a><span id="l30.252" class="difflineminus">-    if (internetSearch)</span>
<a href="#l30.253"></a><span id="l30.253" class="difflineminus">-        internetSearch = internetSearch.QueryInterface(nsIInternetSearchService);</span>
<a href="#l30.254"></a><span id="l30.254" class="difflineminus">-    if (internetSearch)</span>
<a href="#l30.255"></a><span id="l30.255" class="difflineminus">-    {</span>
<a href="#l30.256"></a><span id="l30.256" class="difflineminus">-        internetSearch.AddSearchEngine(engineURL, iconURL, suggestedTitle,</span>
<a href="#l30.257"></a><span id="l30.257" class="difflineminus">-                                       suggestedCategory);</span>
<a href="#l30.258"></a><span id="l30.258" class="difflineminus">-    }</span>
<a href="#l30.259"></a><span id="l30.259" class="difflineplus">+// This function exists to implement window.external.IsSearchProviderInstalled(),</span>
<a href="#l30.260"></a><span id="l30.260" class="difflineplus">+// for compatibility with other browsers.  It will return an integer value</span>
<a href="#l30.261"></a><span id="l30.261" class="difflineplus">+// indicating whether the given engine is installed for the current user.</span>
<a href="#l30.262"></a><span id="l30.262" class="difflineplus">+// However, it is currently stubbed out due to security/privacy concerns</span>
<a href="#l30.263"></a><span id="l30.263" class="difflineplus">+// stemming from difficulties in determining what domain issued the request.</span>
<a href="#l30.264"></a><span id="l30.264" class="difflineplus">+// See bug 340604 and</span>
<a href="#l30.265"></a><span id="l30.265" class="difflineplus">+// http://msdn.microsoft.com/en-us/library/aa342526%28VS.85%29.aspx .</span>
<a href="#l30.266"></a><span id="l30.266" class="difflineplus">+// XXX Implement this!</span>
<a href="#l30.267"></a><span id="l30.267" class="difflineplus">+nsSidebar.prototype.IsSearchProviderInstalled =</span>
<a href="#l30.268"></a><span id="l30.268" class="difflineplus">+function (aSearchURL)</span>
<a href="#l30.269"></a><span id="l30.269" class="difflineplus">+{</span>
<a href="#l30.270"></a><span id="l30.270" class="difflineplus">+  return 0;</span>
<a href="#l30.271"></a><span id="l30.271"> }</span>
<a href="#l30.272"></a><span id="l30.272"> </span>
<a href="#l30.273"></a><span id="l30.273"> // property of nsIClassInfo</span>
<a href="#l30.274"></a><span id="l30.274"> nsSidebar.prototype.flags = nsIClassInfo.DOM_OBJECT;</span>
<a href="#l30.275"></a><span id="l30.275"> </span>
<a href="#l30.276"></a><span id="l30.276"> // property of nsIClassInfo</span>
<a href="#l30.277"></a><span id="l30.277"> nsSidebar.prototype.classDescription = &quot;Sidebar&quot;;</span>
<a href="#l30.278"></a><span id="l30.278"> </span>
<a href="#l30.279"></a><span id="l30.279"> // method of nsIClassInfo</span>
<a href="#l30.280"></a><span id="l30.280"> nsSidebar.prototype.getInterfaces = function(count) {</span>
<a href="#l30.281"></a><span id="l30.281" class="difflineminus">-    var interfaceList = [nsISidebar, nsIClassInfo];</span>
<a href="#l30.282"></a><span id="l30.282" class="difflineplus">+    var interfaceList = [nsISidebar, nsISidebarExternal, nsIClassInfo];</span>
<a href="#l30.283"></a><span id="l30.283">     count.value = interfaceList.length;</span>
<a href="#l30.284"></a><span id="l30.284">     return interfaceList;</span>
<a href="#l30.285"></a><span id="l30.285"> }</span>
<a href="#l30.286"></a><span id="l30.286"> </span>
<a href="#l30.287"></a><span id="l30.287"> // method of nsIClassInfo</span>
<a href="#l30.288"></a><span id="l30.288"> nsSidebar.prototype.getHelperForLanguage = function(count) {return null;}</span>
<a href="#l30.289"></a><span id="l30.289"> </span>
<a href="#l30.290"></a><span id="l30.290" class="difflineminus">-nsSidebar.prototype.QueryInterface = </span>
<a href="#l30.291"></a><span id="l30.291" class="difflineminus">-    XPCOMUtils.generateQI([nsISidebar, nsIClassInfo, nsISupports]);</span>
<a href="#l30.292"></a><span id="l30.292" class="difflineplus">+nsSidebar.prototype.QueryInterface =</span>
<a href="#l30.293"></a><span id="l30.293" class="difflineplus">+    XPCOMUtils.generateQI([nsISidebar, nsISidebarExternal, nsIClassInfo]);</span>
<a href="#l30.294"></a><span id="l30.294"> </span>
<a href="#l30.295"></a><span id="l30.295"> nsSidebar.prototype.classID = SIDEBAR_CID;</span>
<a href="#l30.296"></a><span id="l30.296"> </span>
<a href="#l30.297"></a><span id="l30.297"> var NSGetFactory = XPCOMUtils.generateNSGetFactory([nsSidebar]);</span>
<a href="#l30.298"></a><span id="l30.298"> </span>
<a href="#l30.299"></a><span id="l30.299"> /* static functions */</span>
<a href="#l30.300"></a><span id="l30.300"> if (DEBUG)</span>
<a href="#l30.301"></a><span id="l30.301">     debug = function (s) { dump(&quot;-*- sidebar component: &quot; + s + &quot;\n&quot;); }</span>
<a href="#l30.302"></a><span id="l30.302" class="difflineat">@@ -348,35 +379,20 @@ function getSidebarDatasourceURI(panels_</span>
<a href="#l30.303"></a><span id="l30.303">         if (!sidebar_file.exists())</span>
<a href="#l30.304"></a><span id="l30.304">         {</span>
<a href="#l30.305"></a><span id="l30.305">             /* this should not happen, as GetFileLocation() should copy</span>
<a href="#l30.306"></a><span id="l30.306">              * defaults/panels.rdf to the users profile directory */</span>
<a href="#l30.307"></a><span id="l30.307">             debug(&quot;sidebar file does not exist&quot;);</span>
<a href="#l30.308"></a><span id="l30.308">             return null;</span>
<a href="#l30.309"></a><span id="l30.309">         }</span>
<a href="#l30.310"></a><span id="l30.310"> </span>
<a href="#l30.311"></a><span id="l30.311" class="difflineminus">-        var io_service = Components.classes[IO_SERV_CONTRACTID].getService(Components.interfaces.nsIIOService);</span>
<a href="#l30.312"></a><span id="l30.312" class="difflineminus">-        var file_handler = io_service.getProtocolHandler(&quot;file&quot;).QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l30.313"></a><span id="l30.313" class="difflineplus">+        var file_handler = Services.io.getProtocolHandler(&quot;file&quot;).QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l30.314"></a><span id="l30.314">         var sidebar_uri = file_handler.getURLSpecFromFile(sidebar_file);</span>
<a href="#l30.315"></a><span id="l30.315">         debug(&quot;sidebar uri is &quot; + sidebar_uri);</span>
<a href="#l30.316"></a><span id="l30.316">         return sidebar_uri;</span>
<a href="#l30.317"></a><span id="l30.317">     }</span>
<a href="#l30.318"></a><span id="l30.318">     catch (ex)</span>
<a href="#l30.319"></a><span id="l30.319">     {</span>
<a href="#l30.320"></a><span id="l30.320">         /* this should not happen */</span>
<a href="#l30.321"></a><span id="l30.321">         debug(&quot;caught &quot; + ex + &quot; getting sidebar datasource uri&quot;);</span>
<a href="#l30.322"></a><span id="l30.322">         return null;</span>
<a href="#l30.323"></a><span id="l30.323">     }</span>
<a href="#l30.324"></a><span id="l30.324"> }</span>
<a href="#l30.325"></a><span id="l30.325" class="difflineminus">-</span>
<a href="#l30.326"></a><span id="l30.326" class="difflineminus">-</span>
<a href="#l30.327"></a><span id="l30.327" class="difflineminus">-// String bundle service</span>
<a href="#l30.328"></a><span id="l30.328" class="difflineminus">-var gStrBundleService = null;</span>
<a href="#l30.329"></a><span id="l30.329" class="difflineminus">-</span>
<a href="#l30.330"></a><span id="l30.330" class="difflineminus">-function srGetStrBundle(path)</span>
<a href="#l30.331"></a><span id="l30.331" class="difflineminus">-{</span>
<a href="#l30.332"></a><span id="l30.332" class="difflineminus">-  if (!gStrBundleService)</span>
<a href="#l30.333"></a><span id="l30.333" class="difflineminus">-    gStrBundleService =</span>
<a href="#l30.334"></a><span id="l30.334" class="difflineminus">-      Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l30.335"></a><span id="l30.335" class="difflineminus">-                .getService(Components.interfaces.nsIStringBundleService);</span>
<a href="#l30.336"></a><span id="l30.336" class="difflineminus">-</span>
<a href="#l30.337"></a><span id="l30.337" class="difflineminus">-  return gStrBundleService.createBundle(path);</span>
<a href="#l30.338"></a><span id="l30.338" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/suite/confvars.sh</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/suite/confvars.sh</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -47,16 +47,15 @@ MOZ_COMPOSER=1</span>
<a href="#l31.4"></a><span id="l31.4"> MOZ_SUITE=1</span>
<a href="#l31.5"></a><span id="l31.5"> MOZ_APP_VERSION=`cat ${_topsrcdir}/$MOZ_BUILD_APP/config/version.txt`</span>
<a href="#l31.6"></a><span id="l31.6"> SEAMONKEY_VERSION=$MOZ_APP_VERSION</span>
<a href="#l31.7"></a><span id="l31.7"> MOZ_BRANDING_DIRECTORY=suite/branding/nightly</span>
<a href="#l31.8"></a><span id="l31.8"> MOZ_OFFICIAL_BRANDING_DIRECTORY=suite/branding/nightly</span>
<a href="#l31.9"></a><span id="l31.9"> MOZ_EXTENSIONS_DEFAULT=&quot; venkman inspector irc gnomevfs&quot;</span>
<a href="#l31.10"></a><span id="l31.10"> MOZ_UPDATER=1</span>
<a href="#l31.11"></a><span id="l31.11"> MOZ_HELP_VIEWER=1</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-MOZ_TOOLKIT_SEARCH=</span>
<a href="#l31.13"></a><span id="l31.13"> MOZ_MORK=1</span>
<a href="#l31.14"></a><span id="l31.14"> MOZ_STATIC_BUILD_UNSUPPORTED=1</span>
<a href="#l31.15"></a><span id="l31.15"> # XXX This currently specifies mork due to an error in the core build</span>
<a href="#l31.16"></a><span id="l31.16"> # config. Bug 598613 will fix this.</span>
<a href="#l31.17"></a><span id="l31.17"> MOZ_APP_COMPONENT_LIBS=&quot;mail msgsmime import xpautocomplete mork $LDAP_COMPONENT&quot;</span>
<a href="#l31.18"></a><span id="l31.18"> MOZ_APP_EXTRA_LIBS=&quot;$LDAP_LIBS&quot;</span>
<a href="#l31.19"></a><span id="l31.19"> MOZ_APP_COMPONENT_INCLUDE=nsSuiteComponents.h</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/suite/installer/package-manifest.in</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/suite/installer/package-manifest.in</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -27,17 +27,16 @@</span>
<a href="#l32.4"></a><span id="l32.4"> [@AB_CD@]</span>
<a href="#l32.5"></a><span id="l32.5"> @BINPATH@/chrome/@AB_CD@.jar</span>
<a href="#l32.6"></a><span id="l32.6"> @BINPATH@/chrome/@AB_CD@.manifest</span>
<a href="#l32.7"></a><span id="l32.7"> @BINPATH@/defaults/messenger/mailViews.dat</span>
<a href="#l32.8"></a><span id="l32.8"> @BINPATH@/defaults/profile/bookmarks.html</span>
<a href="#l32.9"></a><span id="l32.9"> @BINPATH@/defaults/profile/localstore.rdf</span>
<a href="#l32.10"></a><span id="l32.10"> @BINPATH@/defaults/profile/mimeTypes.rdf</span>
<a href="#l32.11"></a><span id="l32.11"> @BINPATH@/defaults/profile/panels.rdf</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-@BINPATH@/defaults/profile/search.rdf</span>
<a href="#l32.13"></a><span id="l32.13"> @BINPATH@/defaults/profile/chrome/*</span>
<a href="#l32.14"></a><span id="l32.14"> @BINPATH@/@PREF_DIR@/suite-l10n.js</span>
<a href="#l32.15"></a><span id="l32.15"> @BINPATH@/dictionaries/*</span>
<a href="#l32.16"></a><span id="l32.16"> @BINPATH@/searchplugins/*</span>
<a href="#l32.17"></a><span id="l32.17"> @BINPATH@/update.locale</span>
<a href="#l32.18"></a><span id="l32.18"> @BINPATH@/updater.ini</span>
<a href="#l32.19"></a><span id="l32.19"> #ifdef XP_WIN32</span>
<a href="#l32.20"></a><span id="l32.20"> #ifndef WINCE</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineat">@@ -239,30 +238,33 @@</span>
<a href="#l32.22"></a><span id="l32.22"> @BINPATH@/components/saxparser.xpt</span>
<a href="#l32.23"></a><span id="l32.23"> @BINPATH@/components/shellservice.xpt</span>
<a href="#l32.24"></a><span id="l32.24"> @BINPATH@/components/shistory.xpt</span>
<a href="#l32.25"></a><span id="l32.25"> @BINPATH@/components/smile.xpt</span>
<a href="#l32.26"></a><span id="l32.26"> @BINPATH@/components/spellchecker.xpt</span>
<a href="#l32.27"></a><span id="l32.27"> @BINPATH@/components/startupcache.xpt</span>
<a href="#l32.28"></a><span id="l32.28"> @BINPATH@/components/storage.xpt</span>
<a href="#l32.29"></a><span id="l32.29"> @BINPATH@/components/@DLL_PREFIX@suite@DLL_SUFFIX@</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineplus">+#ifdef XP_WIN32</span>
<a href="#l32.31"></a><span id="l32.31"> @BINPATH@/components/suitebrowser.xpt</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+#endif</span>
<a href="#l32.33"></a><span id="l32.33"> @BINPATH@/components/SuiteBrowser.manifest</span>
<a href="#l32.34"></a><span id="l32.34"> @BINPATH@/components/suitecommon.xpt</span>
<a href="#l32.35"></a><span id="l32.35"> @BINPATH@/components/SuiteCommon.manifest</span>
<a href="#l32.36"></a><span id="l32.36"> @BINPATH@/components/suitefeeds.xpt</span>
<a href="#l32.37"></a><span id="l32.37"> @BINPATH@/components/SuiteFeeds.manifest</span>
<a href="#l32.38"></a><span id="l32.38"> #ifndef WINCE</span>
<a href="#l32.39"></a><span id="l32.39"> @BINPATH@/components/suitemigration.xpt</span>
<a href="#l32.40"></a><span id="l32.40"> #endif</span>
<a href="#l32.41"></a><span id="l32.41"> @BINPATH@/components/toolkitplaces.manifest</span>
<a href="#l32.42"></a><span id="l32.42"> @BINPATH@/components/toolkitprofile.xpt</span>
<a href="#l32.43"></a><span id="l32.43"> #ifdef UNIX_BUT_NOT_MAC</span>
<a href="#l32.44"></a><span id="l32.44"> @BINPATH@/components/toolkitremote.xpt</span>
<a href="#l32.45"></a><span id="l32.45"> #endif</span>
<a href="#l32.46"></a><span id="l32.46" class="difflineplus">+@BINPATH@/components/toolkitsearch.manifest</span>
<a href="#l32.47"></a><span id="l32.47"> @BINPATH@/components/txmgr.xpt</span>
<a href="#l32.48"></a><span id="l32.48"> @BINPATH@/components/txtsvc.xpt</span>
<a href="#l32.49"></a><span id="l32.49"> #ifdef MOZ_USE_NATIVE_UCONV</span>
<a href="#l32.50"></a><span id="l32.50"> @BINPATH@/components/ucnative.xpt</span>
<a href="#l32.51"></a><span id="l32.51"> #endif</span>
<a href="#l32.52"></a><span id="l32.52"> @BINPATH@/components/uconv.xpt</span>
<a href="#l32.53"></a><span id="l32.53"> @BINPATH@/components/unicharutil.xpt</span>
<a href="#l32.54"></a><span id="l32.54"> @BINPATH@/components/update.xpt</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineat">@@ -354,16 +356,18 @@</span>
<a href="#l32.56"></a><span id="l32.56"> @BINPATH@/components/nsPlacesAutoComplete.js</span>
<a href="#l32.57"></a><span id="l32.57"> @BINPATH@/components/nsPlacesAutoComplete.manifest</span>
<a href="#l32.58"></a><span id="l32.58"> @BINPATH@/components/nsPlacesDBFlush.js</span>
<a href="#l32.59"></a><span id="l32.59"> @BINPATH@/components/nsPlacesExpiration.js</span>
<a href="#l32.60"></a><span id="l32.60"> @BINPATH@/components/nsPrompter.js</span>
<a href="#l32.61"></a><span id="l32.61"> @BINPATH@/components/nsPrompter.manifest</span>
<a href="#l32.62"></a><span id="l32.62"> @BINPATH@/components/nsProxyAutoConfig.js</span>
<a href="#l32.63"></a><span id="l32.63"> @BINPATH@/components/nsProxyAutoConfig.manifest</span>
<a href="#l32.64"></a><span id="l32.64" class="difflineplus">+@BINPATH@/components/nsSearchService.js</span>
<a href="#l32.65"></a><span id="l32.65" class="difflineplus">+@BINPATH@/components/nsSearchSuggestions.js</span>
<a href="#l32.66"></a><span id="l32.66"> @BINPATH@/components/nsSessionStartup.js</span>
<a href="#l32.67"></a><span id="l32.67"> @BINPATH@/components/nsSessionStore.js</span>
<a href="#l32.68"></a><span id="l32.68"> @BINPATH@/components/nsSidebar.js</span>
<a href="#l32.69"></a><span id="l32.69"> @BINPATH@/components/nsSuiteDownloadManagerUI.js</span>
<a href="#l32.70"></a><span id="l32.70"> @BINPATH@/components/nsSuiteGlue.js</span>
<a href="#l32.71"></a><span id="l32.71"> #ifdef XP_WIN32</span>
<a href="#l32.72"></a><span id="l32.72"> @BINPATH@/components/nsSetDefault.js</span>
<a href="#l32.73"></a><span id="l32.73"> @BINPATH@/components/nsSetDefault.manifest</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/suite/installer/removed-files.in</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/suite/installer/removed-files.in</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -128,16 +128,17 @@ components/xpti.dat</span>
<a href="#l33.4"></a><span id="l33.4"> #ifdef XP_MACOSX</span>
<a href="#l33.5"></a><span id="l33.5"> crashreporter.app/</span>
<a href="#l33.6"></a><span id="l33.6"> #else</span>
<a href="#l33.7"></a><span id="l33.7"> crashreporter@BIN_SUFFIX@</span>
<a href="#l33.8"></a><span id="l33.8"> crashreporter.ini</span>
<a href="#l33.9"></a><span id="l33.9"> #endif</span>
<a href="#l33.10"></a><span id="l33.10"> #endif</span>
<a href="#l33.11"></a><span id="l33.11"> defaults/pref/reporter.js</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+defaults/profile/search.rdf</span>
<a href="#l33.13"></a><span id="l33.13"> defaults/wallet/DistinguishedSchema.tbl</span>
<a href="#l33.14"></a><span id="l33.14"> defaults/wallet/FieldSchema.tbl</span>
<a href="#l33.15"></a><span id="l33.15"> defaults/wallet/PositionalSchema.tbl</span>
<a href="#l33.16"></a><span id="l33.16"> defaults/wallet/SchemaConcat.tbl</span>
<a href="#l33.17"></a><span id="l33.17"> defaults/wallet/SchemaStrings.tbl</span>
<a href="#l33.18"></a><span id="l33.18"> defaults/wallet/StateSchema.tbl</span>
<a href="#l33.19"></a><span id="l33.19"> defaults/wallet/VcardSchema.tbl</span>
<a href="#l33.20"></a><span id="l33.20"> #ifdef XP_WIN</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineat">@@ -245,16 +246,141 @@ res/html/gopher-binary.gif</span>
<a href="#l33.22"></a><span id="l33.22"> res/html/gopher-find.gif</span>
<a href="#l33.23"></a><span id="l33.23"> res/html/gopher-image.gif</span>
<a href="#l33.24"></a><span id="l33.24"> res/html/gopher-menu.gif</span>
<a href="#l33.25"></a><span id="l33.25"> res/html/gopher-movie.gif</span>
<a href="#l33.26"></a><span id="l33.26"> res/html/gopher-sound.gif</span>
<a href="#l33.27"></a><span id="l33.27"> res/html/gopher-telnet.gif</span>
<a href="#l33.28"></a><span id="l33.28"> res/html/gopher-text.gif</span>
<a href="#l33.29"></a><span id="l33.29"> res/html/gopher-unknown.gif</span>
<a href="#l33.30"></a><span id="l33.30" class="difflineplus">+searchplugins/</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineplus">+searchplugins/allegro.png</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+searchplugins/allegro.src</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineplus">+searchplugins/amazon-jp.png</span>
<a href="#l33.34"></a><span id="l33.34" class="difflineplus">+searchplugins/amazon-jp.src</span>
<a href="#l33.35"></a><span id="l33.35" class="difflineplus">+searchplugins/atlas-sk.png</span>
<a href="#l33.36"></a><span id="l33.36" class="difflineplus">+searchplugins/atlas-sk.src</span>
<a href="#l33.37"></a><span id="l33.37" class="difflineplus">+searchplugins/azet-sk.png</span>
<a href="#l33.38"></a><span id="l33.38" class="difflineplus">+searchplugins/azet-sk.src</span>
<a href="#l33.39"></a><span id="l33.39" class="difflineplus">+searchplugins/dmoz.png</span>
<a href="#l33.40"></a><span id="l33.40" class="difflineplus">+searchplugins/dmoz.src</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineplus">+searchplugins/dnp_cikk.png</span>
<a href="#l33.42"></a><span id="l33.42" class="difflineplus">+searchplugins/dnp_cikk.src</span>
<a href="#l33.43"></a><span id="l33.43" class="difflineplus">+searchplugins/dnp_forum.png</span>
<a href="#l33.44"></a><span id="l33.44" class="difflineplus">+searchplugins/dnp_forum.src</span>
<a href="#l33.45"></a><span id="l33.45" class="difflineplus">+searchplugins/dnp.png</span>
<a href="#l33.46"></a><span id="l33.46" class="difflineplus">+searchplugins/dnp.src</span>
<a href="#l33.47"></a><span id="l33.47" class="difflineplus">+searchplugins/dunaj-sk.png</span>
<a href="#l33.48"></a><span id="l33.48" class="difflineplus">+searchplugins/dunaj-sk.src</span>
<a href="#l33.49"></a><span id="l33.49" class="difflineplus">+searchplugins/excite_eiwa.png</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineplus">+searchplugins/excite_eiwa.src</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineplus">+searchplugins/excite_enja.png</span>
<a href="#l33.52"></a><span id="l33.52" class="difflineplus">+searchplugins/excite_enja.src</span>
<a href="#l33.53"></a><span id="l33.53" class="difflineplus">+searchplugins/excite_jaen.png</span>
<a href="#l33.54"></a><span id="l33.54" class="difflineplus">+searchplugins/excite_jaen.src</span>
<a href="#l33.55"></a><span id="l33.55" class="difflineplus">+searchplugins/excite_waei.png</span>
<a href="#l33.56"></a><span id="l33.56" class="difflineplus">+searchplugins/excite_waei.src</span>
<a href="#l33.57"></a><span id="l33.57" class="difflineplus">+searchplugins/goliat.png</span>
<a href="#l33.58"></a><span id="l33.58" class="difflineplus">+searchplugins/goliat.src</span>
<a href="#l33.59"></a><span id="l33.59" class="difflineplus">+searchplugins/google.png</span>
<a href="#l33.60"></a><span id="l33.60" class="difflineplus">+searchplugins/google.src</span>
<a href="#l33.61"></a><span id="l33.61" class="difflineplus">+searchplugins/google-at.png</span>
<a href="#l33.62"></a><span id="l33.62" class="difflineplus">+searchplugins/google-at.src</span>
<a href="#l33.63"></a><span id="l33.63" class="difflineplus">+searchplugins/google-ch.png</span>
<a href="#l33.64"></a><span id="l33.64" class="difflineplus">+searchplugins/google-ch.src</span>
<a href="#l33.65"></a><span id="l33.65" class="difflineplus">+searchplugins/google-de.png</span>
<a href="#l33.66"></a><span id="l33.66" class="difflineplus">+searchplugins/google-de.src</span>
<a href="#l33.67"></a><span id="l33.67" class="difflineplus">+searchplugins/google-jp.png</span>
<a href="#l33.68"></a><span id="l33.68" class="difflineplus">+searchplugins/google-jp.png</span>
<a href="#l33.69"></a><span id="l33.69" class="difflineplus">+searchplugins/google-jp.src</span>
<a href="#l33.70"></a><span id="l33.70" class="difflineplus">+searchplugins/google-jp.src</span>
<a href="#l33.71"></a><span id="l33.71" class="difflineplus">+searchplugins/googlePL.png</span>
<a href="#l33.72"></a><span id="l33.72" class="difflineplus">+searchplugins/googlePL.src</span>
<a href="#l33.73"></a><span id="l33.73" class="difflineplus">+searchplugins/google-ru.png</span>
<a href="#l33.74"></a><span id="l33.74" class="difflineplus">+searchplugins/google-ru.src</span>
<a href="#l33.75"></a><span id="l33.75" class="difflineplus">+searchplugins/google-SE.png</span>
<a href="#l33.76"></a><span id="l33.76" class="difflineplus">+searchplugins/google-SE.src</span>
<a href="#l33.77"></a><span id="l33.77" class="difflineplus">+searchplugins/hirkereso.png</span>
<a href="#l33.78"></a><span id="l33.78" class="difflineplus">+searchplugins/hirkereso.src</span>
<a href="#l33.79"></a><span id="l33.79" class="difflineplus">+searchplugins/hwswc.png</span>
<a href="#l33.80"></a><span id="l33.80" class="difflineplus">+searchplugins/hwswc.src</span>
<a href="#l33.81"></a><span id="l33.81" class="difflineplus">+searchplugins/hwswh.png</span>
<a href="#l33.82"></a><span id="l33.82" class="difflineplus">+searchplugins/hwswh.src</span>
<a href="#l33.83"></a><span id="l33.83" class="difflineplus">+searchplugins/jeeves.png</span>
<a href="#l33.84"></a><span id="l33.84" class="difflineplus">+searchplugins/jeeves.src</span>
<a href="#l33.85"></a><span id="l33.85" class="difflineplus">+searchplugins/jyxo.png</span>
<a href="#l33.86"></a><span id="l33.86" class="difflineplus">+searchplugins/jyxo.src</span>
<a href="#l33.87"></a><span id="l33.87" class="difflineplus">+searchplugins/kereso.png</span>
<a href="#l33.88"></a><span id="l33.88" class="difflineplus">+searchplugins/kereso.src</span>
<a href="#l33.89"></a><span id="l33.89" class="difflineplus">+searchplugins/nepszabadsag.png</span>
<a href="#l33.90"></a><span id="l33.90" class="difflineplus">+searchplugins/nepszabadsag.src</span>
<a href="#l33.91"></a><span id="l33.91" class="difflineplus">+searchplugins/origo.png</span>
<a href="#l33.92"></a><span id="l33.92" class="difflineplus">+searchplugins/origo.src</span>
<a href="#l33.93"></a><span id="l33.93" class="difflineplus">+searchplugins/priceru.png</span>
<a href="#l33.94"></a><span id="l33.94" class="difflineplus">+searchplugins/priceru.src</span>
<a href="#l33.95"></a><span id="l33.95" class="difflineplus">+searchplugins/pwn.png</span>
<a href="#l33.96"></a><span id="l33.96" class="difflineplus">+searchplugins/pwn.src</span>
<a href="#l33.97"></a><span id="l33.97" class="difflineplus">+searchplugins/rambler.png</span>
<a href="#l33.98"></a><span id="l33.98" class="difflineplus">+searchplugins/rambler.src</span>
<a href="#l33.99"></a><span id="l33.99" class="difflineplus">+searchplugins/seznam.png</span>
<a href="#l33.100"></a><span id="l33.100" class="difflineplus">+searchplugins/seznam.src</span>
<a href="#l33.101"></a><span id="l33.101" class="difflineplus">+searchplugins/slovari.yandex.ru.png</span>
<a href="#l33.102"></a><span id="l33.102" class="difflineplus">+searchplugins/slovari.yandex.ru.src</span>
<a href="#l33.103"></a><span id="l33.103" class="difflineplus">+searchplugins/startlap.png</span>
<a href="#l33.104"></a><span id="l33.104" class="difflineplus">+searchplugins/startlap.src</span>
<a href="#l33.105"></a><span id="l33.105" class="difflineplus">+searchplugins/sxc.png</span>
<a href="#l33.106"></a><span id="l33.106" class="difflineplus">+searchplugins/sxc.src</span>
<a href="#l33.107"></a><span id="l33.107" class="difflineplus">+searchplugins/sztaki_en-hu.png</span>
<a href="#l33.108"></a><span id="l33.108" class="difflineplus">+searchplugins/sztaki_en-hu.src</span>
<a href="#l33.109"></a><span id="l33.109" class="difflineplus">+searchplugins/sztaki_fra-hu.png</span>
<a href="#l33.110"></a><span id="l33.110" class="difflineplus">+searchplugins/sztaki_fra-hu.src</span>
<a href="#l33.111"></a><span id="l33.111" class="difflineplus">+searchplugins/sztaki_ger-hu.png</span>
<a href="#l33.112"></a><span id="l33.112" class="difflineplus">+searchplugins/sztaki_ger-hu.src</span>
<a href="#l33.113"></a><span id="l33.113" class="difflineplus">+searchplugins/sztaki_hu-en.png</span>
<a href="#l33.114"></a><span id="l33.114" class="difflineplus">+searchplugins/sztaki_hu-en.src</span>
<a href="#l33.115"></a><span id="l33.115" class="difflineplus">+searchplugins/sztaki_hu-fra.png</span>
<a href="#l33.116"></a><span id="l33.116" class="difflineplus">+searchplugins/sztaki_hu-fra.src</span>
<a href="#l33.117"></a><span id="l33.117" class="difflineplus">+searchplugins/sztaki_hu-ger.png</span>
<a href="#l33.118"></a><span id="l33.118" class="difflineplus">+searchplugins/sztaki_hu-ger.src</span>
<a href="#l33.119"></a><span id="l33.119" class="difflineplus">+searchplugins/sztaki_hu-ita.png</span>
<a href="#l33.120"></a><span id="l33.120" class="difflineplus">+searchplugins/sztaki_hu-ita.src</span>
<a href="#l33.121"></a><span id="l33.121" class="difflineplus">+searchplugins/sztaki_hu-nl.png</span>
<a href="#l33.122"></a><span id="l33.122" class="difflineplus">+searchplugins/sztaki_hu-nl.src</span>
<a href="#l33.123"></a><span id="l33.123" class="difflineplus">+searchplugins/sztaki_ita-hu.png</span>
<a href="#l33.124"></a><span id="l33.124" class="difflineplus">+searchplugins/sztaki_ita-hu.src</span>
<a href="#l33.125"></a><span id="l33.125" class="difflineplus">+searchplugins/sztaki_nl-hu.png</span>
<a href="#l33.126"></a><span id="l33.126" class="difflineplus">+searchplugins/sztaki_nl-hu.src</span>
<a href="#l33.127"></a><span id="l33.127" class="difflineplus">+searchplugins/sztakiw.png</span>
<a href="#l33.128"></a><span id="l33.128" class="difflineplus">+searchplugins/sztakiw.src</span>
<a href="#l33.129"></a><span id="l33.129" class="difflineplus">+searchplugins/szukacz.png</span>
<a href="#l33.130"></a><span id="l33.130" class="difflineplus">+searchplugins/szukacz.src</span>
<a href="#l33.131"></a><span id="l33.131" class="difflineplus">+searchplugins/telepuleskereso.png</span>
<a href="#l33.132"></a><span id="l33.132" class="difflineplus">+searchplugins/telepuleskereso.src</span>
<a href="#l33.133"></a><span id="l33.133" class="difflineplus">+searchplugins/utcakereso.png</span>
<a href="#l33.134"></a><span id="l33.134" class="difflineplus">+searchplugins/utcakereso.src</span>
<a href="#l33.135"></a><span id="l33.135" class="difflineplus">+searchplugins/wikipedia-cs.png</span>
<a href="#l33.136"></a><span id="l33.136" class="difflineplus">+searchplugins/wikipedia-cs.src</span>
<a href="#l33.137"></a><span id="l33.137" class="difflineplus">+searchplugins/wikipedia-hu.png</span>
<a href="#l33.138"></a><span id="l33.138" class="difflineplus">+searchplugins/wikipedia-hu.src</span>
<a href="#l33.139"></a><span id="l33.139" class="difflineplus">+searchplugins/wikipedia-lt.png</span>
<a href="#l33.140"></a><span id="l33.140" class="difflineplus">+searchplugins/wikipedia-lt.src</span>
<a href="#l33.141"></a><span id="l33.141" class="difflineplus">+searchplugins/wikipedia-pl.png</span>
<a href="#l33.142"></a><span id="l33.142" class="difflineplus">+searchplugins/wikipedia-pl.src</span>
<a href="#l33.143"></a><span id="l33.143" class="difflineplus">+searchplugins/wikipedia-ru.png</span>
<a href="#l33.144"></a><span id="l33.144" class="difflineplus">+searchplugins/wikipedia-ru.src</span>
<a href="#l33.145"></a><span id="l33.145" class="difflineplus">+searchplugins/wikipedia-sk.png</span>
<a href="#l33.146"></a><span id="l33.146" class="difflineplus">+searchplugins/wikipedia-sk.src</span>
<a href="#l33.147"></a><span id="l33.147" class="difflineplus">+searchplugins/wni.png</span>
<a href="#l33.148"></a><span id="l33.148" class="difflineplus">+searchplugins/wni.src</span>
<a href="#l33.149"></a><span id="l33.149" class="difflineplus">+searchplugins/yahoo-jp.png</span>
<a href="#l33.150"></a><span id="l33.150" class="difflineplus">+searchplugins/yahoo-jp.src</span>
<a href="#l33.151"></a><span id="l33.151" class="difflineplus">+searchplugins/yandex.png</span>
<a href="#l33.152"></a><span id="l33.152" class="difflineplus">+searchplugins/yandex.src</span>
<a href="#l33.153"></a><span id="l33.153" class="difflineplus">+searchplugins/zoznam-sk.png</span>
<a href="#l33.154"></a><span id="l33.154" class="difflineplus">+searchplugins/zoznam-sk.src</span>
<a href="#l33.155"></a><span id="l33.155"> @DLL_PREFIX@sqlite3@DLL_SUFFIX@</span>
<a href="#l33.156"></a><span id="l33.156"> #ifndef MOZ_CRASHREPORTER</span>
<a href="#l33.157"></a><span id="l33.157"> #ifdef XP_UNIX</span>
<a href="#l33.158"></a><span id="l33.158"> #ifndef XP_MACOSX</span>
<a href="#l33.159"></a><span id="l33.159"> Throbber-small.gif</span>
<a href="#l33.160"></a><span id="l33.160"> #endif</span>
<a href="#l33.161"></a><span id="l33.161"> #endif</span>
<a href="#l33.162"></a><span id="l33.162"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/suite/locales/Makefile.in</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/suite/locales/Makefile.in</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -39,20 +39,18 @@ topsrcdir      = @top_srcdir@</span>
<a href="#l34.4"></a><span id="l34.4"> srcdir         = @srcdir@</span>
<a href="#l34.5"></a><span id="l34.5"> VPATH          = @srcdir@</span>
<a href="#l34.6"></a><span id="l34.6"> relativesrcdir = suite/locales</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l34.9"></a><span id="l34.9"> </span>
<a href="#l34.10"></a><span id="l34.10"> include $(topsrcdir)/config/config.mk</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-vpath %.src @srcdir@/en-US/searchplugins</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-vpath %.png @srcdir@/en-US/searchplugins</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-vpath %.src $(LOCALE_SRCDIR)/searchplugins</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineminus">-vpath %.png $(LOCALE_SRCDIR)/searchplugins</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+vpath %.xml @srcdir@/en-US/searchplugins</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineplus">+vpath %.xml $(LOCALE_SRCDIR)/searchplugins</span>
<a href="#l34.18"></a><span id="l34.18"> </span>
<a href="#l34.19"></a><span id="l34.19"> ifdef LOCALE_MERGEDIR</span>
<a href="#l34.20"></a><span id="l34.20"> vpath crashreporter%.ini $(LOCALE_MERGEDIR)/browser/crashreporter</span>
<a href="#l34.21"></a><span id="l34.21"> endif</span>
<a href="#l34.22"></a><span id="l34.22"> vpath crashreporter%.ini $(LOCALE_SRCDIR)/crashreporter</span>
<a href="#l34.23"></a><span id="l34.23"> ifdef LOCALE_MERGEDIR</span>
<a href="#l34.24"></a><span id="l34.24"> vpath crashreporter%.ini @srcdir@/en-US/crashreporter</span>
<a href="#l34.25"></a><span id="l34.25"> endif</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineat">@@ -155,53 +153,40 @@ PANELS_EXTRA = $(firstword $(wildcard $(</span>
<a href="#l34.27"></a><span id="l34.27"> 	cp $^ $(PANELS_EXTRA) profile/</span>
<a href="#l34.28"></a><span id="l34.28"> 	sed -n 's/.*&lt;RDF:Description about=&quot;\(.*\)&quot;&gt;.*/        &lt;RDF:li resource=&quot;\1&quot;\/&gt;/p' profile/panels.extra &gt; profile/panels-urn.inc</span>
<a href="#l34.29"></a><span id="l34.29"> 	$(PYTHON) $(MOZILLA_SRCDIR)/config/Preprocessor.py profile/panels.rdf.in &gt; $@</span>
<a href="#l34.30"></a><span id="l34.30"> </span>
<a href="#l34.31"></a><span id="l34.31"> SEARCH_PLUGINS = $(shell cat \</span>
<a href="#l34.32"></a><span id="l34.32">    $(firstword $(wildcard $(LOCALE_SRCDIR)/searchplugins/list.txt) \</span>
<a href="#l34.33"></a><span id="l34.33">                @srcdir@/en-US/searchplugins/list.txt ) )</span>
<a href="#l34.34"></a><span id="l34.34"> </span>
<a href="#l34.35"></a><span id="l34.35" class="difflineminus">-%/defaults/profile/search.rdf: generic/profile/search.rdf.in</span>
<a href="#l34.36"></a><span id="l34.36" class="difflineminus">-	$(NSINSTALL) -D $(dir $@)</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineminus">-	$(RM) -rf profile/search*</span>
<a href="#l34.38"></a><span id="l34.38" class="difflineminus">-	$(NSINSTALL) -D profile</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineminus">-	# the #include in the .in file requires both to be in the same dir</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineminus">-	cp $^ profile/</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineminus">-	for engine in $(SEARCH_PLUGINS); do \</span>
<a href="#l34.42"></a><span id="l34.42" class="difflineminus">-	  echo &quot;    &lt;RDF:li resource=\&quot;NC:SearchCategory?engine=urn:search:engine:$$engine.src\&quot; /&gt;&quot; &gt;&gt; profile/search.rdf.inc; \</span>
<a href="#l34.43"></a><span id="l34.43" class="difflineminus">-	done</span>
<a href="#l34.44"></a><span id="l34.44" class="difflineminus">-	$(PYTHON) $(MOZILLA_SRCDIR)/config/Preprocessor.py profile/search.rdf.in &gt; $@</span>
<a href="#l34.45"></a><span id="l34.45" class="difflineminus">-</span>
<a href="#l34.46"></a><span id="l34.46"> GARBAGE_DIRS += profile</span>
<a href="#l34.47"></a><span id="l34.47"> </span>
<a href="#l34.48"></a><span id="l34.48"> libs:: $(FINAL_TARGET)/defaults/profile/bookmarks.html ;</span>
<a href="#l34.49"></a><span id="l34.49" class="difflineminus">-libs:: $(FINAL_TARGET)/defaults/profile/search.rdf ;</span>
<a href="#l34.50"></a><span id="l34.50"> libs:: $(FINAL_TARGET)/defaults/profile/panels.rdf ;</span>
<a href="#l34.51"></a><span id="l34.51"> </span>
<a href="#l34.52"></a><span id="l34.52"> libs:: $(addprefix generic/profile/,$(PROFILE_FILES))</span>
<a href="#l34.53"></a><span id="l34.53"> 	$(SYSINSTALL) $(IFLAGS1) $^ $(FINAL_TARGET)/defaults/profile</span>
<a href="#l34.54"></a><span id="l34.54"> </span>
<a href="#l34.55"></a><span id="l34.55"> libs:: $(addprefix $(LOCALE_SRCDIR)/profile/chrome/,$(PROFILE_CHROME))</span>
<a href="#l34.56"></a><span id="l34.56"> 	$(SYSINSTALL) $(IFLAGS1) $^ $(FINAL_TARGET)/defaults/profile/chrome</span>
<a href="#l34.57"></a><span id="l34.57"> </span>
<a href="#l34.58"></a><span id="l34.58"> install:: $(DESTDIR)$(mozappdir)/defaults/profile/bookmarks.html ;</span>
<a href="#l34.59"></a><span id="l34.59" class="difflineminus">-install:: $(DESTDIR)$(mozappdir)/defaults/profile/search.rdf ;</span>
<a href="#l34.60"></a><span id="l34.60"> install:: $(DESTDIR)$(mozappdir)/defaults/profile/panels.rdf ;</span>
<a href="#l34.61"></a><span id="l34.61"> </span>
<a href="#l34.62"></a><span id="l34.62"> install:: $(addprefix generic/profile/,$(PROFILE_FILES))</span>
<a href="#l34.63"></a><span id="l34.63"> 	$(SYSINSTALL) $(IFLAGS1) $^ $(DESTDIR)$(mozappdir)/defaults/profile</span>
<a href="#l34.64"></a><span id="l34.64"> </span>
<a href="#l34.65"></a><span id="l34.65"> install:: $(addprefix $(LOCALE_SRCDIR)/profile/chrome/,$(PROFILE_CHROME))</span>
<a href="#l34.66"></a><span id="l34.66"> 	$(SYSINSTALL) $(IFLAGS1) $^ $(DESTDIR)$(mozappdir)/defaults/profile/chrome</span>
<a href="#l34.67"></a><span id="l34.67"> </span>
<a href="#l34.68"></a><span id="l34.68" class="difflineminus">-libs:: $(addsuffix .src,$(SEARCH_PLUGINS)) $(addsuffix .png,$(SEARCH_PLUGINS))</span>
<a href="#l34.69"></a><span id="l34.69" class="difflineplus">+libs:: $(addsuffix .xml,$(SEARCH_PLUGINS))</span>
<a href="#l34.70"></a><span id="l34.70"> 	$(SYSINSTALL) $(IFLAGS1) $^ $(FINAL_TARGET)/searchplugins</span>
<a href="#l34.71"></a><span id="l34.71"> </span>
<a href="#l34.72"></a><span id="l34.72" class="difflineminus">-install:: $(addsuffix .src,$(SEARCH_PLUGINS)) $(addsuffix .png,$(SEARCH_PLUGINS))</span>
<a href="#l34.73"></a><span id="l34.73" class="difflineplus">+install:: $(addsuffix .xml,$(SEARCH_PLUGINS))</span>
<a href="#l34.74"></a><span id="l34.74"> 	$(SYSINSTALL) $(IFLAGS1) $^ $(DESTDIR)$(mozappdir)/searchplugins</span>
<a href="#l34.75"></a><span id="l34.75"> </span>
<a href="#l34.76"></a><span id="l34.76"> clobber-%:</span>
<a href="#l34.77"></a><span id="l34.77"> 	$(RM) -rf $(DIST)/xpi-stage/locale-$*</span>
<a href="#l34.78"></a><span id="l34.78"> 	$(RM) -rf $(DIST)/xpi-stage/chatzilla-$* $(DIST)/xpi-stage/chatzilla-*.$*.xpi</span>
<a href="#l34.79"></a><span id="l34.79"> 	$(RM) -rf $(DIST)/xpi-stage/venkman-$* $(DIST)/xpi-stage/venkman-*.$*.xpi</span>
<a href="#l34.80"></a><span id="l34.80"> </span>
<a href="#l34.81"></a><span id="l34.81"> libs-%:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/suite/locales/en-US/chrome/browser/region.properties</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/browser/region.properties</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -1,11 +1,9 @@</span>
<a href="#l35.4"></a><span id="l35.4"> # navigator.properties</span>
<a href="#l35.5"></a><span id="l35.5" class="difflineminus">-fallbackDefaultSearchURL=http://www.google.com/search?q=</span>
<a href="#l35.6"></a><span id="l35.6" class="difflineminus">-otherSearchURL=http://www.google.com</span>
<a href="#l35.7"></a><span id="l35.7"> #</span>
<a href="#l35.8"></a><span id="l35.8"> # all.js</span>
<a href="#l35.9"></a><span id="l35.9"> #</span>
<a href="#l35.10"></a><span id="l35.10"> browser.startup.homepage=http://www.seamonkey-project.org/start/</span>
<a href="#l35.11"></a><span id="l35.11"> browser.throbber.url=http://www.seamonkey-project.org/</span>
<a href="#l35.12"></a><span id="l35.12"> browser.search.defaulturl=http://www.google.com/search?q=</span>
<a href="#l35.13"></a><span id="l35.13"> </span>
<a href="#l35.14"></a><span id="l35.14"> browser.translation.service=http://translate.google.com/translate?prev=/language_tools&amp;u=</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/suite/locales/en-US/chrome/common/contentAreaCommands.properties</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/contentAreaCommands.properties</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -1,9 +1,11 @@</span>
<a href="#l36.4"></a><span id="l36.4"> # context menu strings</span>
<a href="#l36.5"></a><span id="l36.5"> </span>
<a href="#l36.6"></a><span id="l36.6" class="difflineminus">-searchText=Search Web for &quot;%S&quot;</span>
<a href="#l36.7"></a><span id="l36.7" class="difflineminus">-searchText.accesskey=S</span>
<a href="#l36.8"></a><span id="l36.8" class="difflineplus">+# LOCALIZATION NOTE (contextMenuSearchText): %1$S is the search engine,</span>
<a href="#l36.9"></a><span id="l36.9" class="difflineplus">+# %2$S is the selection string.</span>
<a href="#l36.10"></a><span id="l36.10" class="difflineplus">+contextMenuSearchText=Search %1$S for &quot;%2$S&quot;</span>
<a href="#l36.11"></a><span id="l36.11" class="difflineplus">+contextMenuSearchText.accesskey=S</span>
<a href="#l36.12"></a><span id="l36.12"> </span>
<a href="#l36.13"></a><span id="l36.13"> blockImage=Block Images from %S</span>
<a href="#l36.14"></a><span id="l36.14"> blockImage.accesskey=c</span>
<a href="#l36.15"></a><span id="l36.15"> unblockImage=Unblock Images from %S</span>
<a href="#l36.16"></a><span id="l36.16"> unblockImage.accesskey=c</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/suite/locales/en-US/chrome/common/pref/pref-search.dtd</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/pref/pref-search.dtd</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -2,22 +2,14 @@</span>
<a href="#l37.4"></a><span id="l37.4"> </span>
<a href="#l37.5"></a><span id="l37.5"> &lt;!-- LOCALIZATION NOTE : FILE The Search prefs dialog --&gt;</span>
<a href="#l37.6"></a><span id="l37.6"> </span>
<a href="#l37.7"></a><span id="l37.7"> &lt;!ENTITY pref.search.title                &quot;Internet Search&quot;&gt;</span>
<a href="#l37.8"></a><span id="l37.8"> &lt;!ENTITY legendHeader                     &quot;Default Search Engine&quot;&gt;</span>
<a href="#l37.9"></a><span id="l37.9"> &lt;!ENTITY defaultSearchEngine.label        &quot;Search using:&quot;&gt;</span>
<a href="#l37.10"></a><span id="l37.10"> &lt;!ENTITY defaultSearchEngine.accesskey    &quot;S&quot;&gt;</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-&lt;!ENTITY openSidebarSearchPanel.label     &quot;Open the Search tab in the Sidebar when a search is invoked&quot;&gt;</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-&lt;!ENTITY openSidebarSearchPanel.accesskey &quot;O&quot;&gt;</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">-</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineminus">-&lt;!ENTITY openContextSearchTab.label       &quot;Open a tab instead of a window for a context menu web search&quot;&gt;</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineminus">-&lt;!ENTITY openContextSearchTab.accesskey   &quot;t&quot;&gt;</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineminus">-</span>
<a href="#l37.18"></a><span id="l37.18"> &lt;!ENTITY searchResults.label              &quot;Search Results&quot;&gt;</span>
<a href="#l37.19"></a><span id="l37.19"> </span>
<a href="#l37.20"></a><span id="l37.20" class="difflineminus">-&lt;!ENTITY sidebarSearchTabPref.label       &quot;Sidebar Search Tab Preference&quot;&gt;</span>
<a href="#l37.21"></a><span id="l37.21" class="difflineminus">-&lt;!ENTITY searchModeBasic.label            &quot;Basic&quot;&gt;</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineminus">-&lt;!ENTITY searchModeBasic.accesskey        &quot;B&quot;&gt;</span>
<a href="#l37.23"></a><span id="l37.23" class="difflineminus">-&lt;!ENTITY searchModeAdvanced.label         &quot;Advanced&quot;&gt;</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineminus">-&lt;!ENTITY searchModeAdvanced.accesskey     &quot;A&quot;&gt;</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineminus">-</span>
<a href="#l37.26"></a><span id="l37.26" class="difflineplus">+&lt;!ENTITY openInTab.label                  &quot;Open new tabs for sidebar search results&quot;&gt;</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineplus">+&lt;!ENTITY openInTab.accesskey              &quot;n&quot;&gt;</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineplus">+&lt;!ENTITY openSidebarSearchPanel.label     &quot;Open the Search tab in the sidebar when a search is invoked&quot;&gt;</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineplus">+&lt;!ENTITY openSidebarSearchPanel.accesskey &quot;O&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/suite/locales/en-US/chrome/common/region.properties</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/region.properties</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1,8 +1,10 @@</span>
<a href="#l38.4"></a><span id="l38.4" class="difflineminus">-# search-panel.properties</span>
<a href="#l38.5"></a><span id="l38.5" class="difflineminus">-#   Localizable URLs</span>
<a href="#l38.6"></a><span id="l38.6" class="difflineminus">-defaultSearchURL=http://www.google.com/search?q=</span>
<a href="#l38.7"></a><span id="l38.7" class="difflineplus">+# Default search engine</span>
<a href="#l38.8"></a><span id="l38.8"> browser.search.defaultenginename=Google</span>
<a href="#l38.9"></a><span id="l38.9"> </span>
<a href="#l38.10"></a><span id="l38.10" class="difflineplus">+# Search engine order (order displayed in the search bar dropdown)</span>
<a href="#l38.11"></a><span id="l38.11" class="difflineplus">+browser.search.order.1=Google</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineplus">+browser.search.order.2=Yahoo</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+</span>
<a href="#l38.14"></a><span id="l38.14"> # More information about this update link available in the update wizard.</span>
<a href="#l38.15"></a><span id="l38.15"> # Only change this if you are providing localized release notes.</span>
<a href="#l38.16"></a><span id="l38.16"> app.update.url.details=http://www.seamonkey-project.org/releases/</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1">deleted file mode 100644</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineminus">--- a/suite/locales/en-US/chrome/common/search/default.htm</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineplus">+++ /dev/null</span>
<a href="#l39.4"></a><span id="l39.4" class="difflineat">@@ -1,12 +0,0 @@</span>
<a href="#l39.5"></a><span id="l39.5" class="difflineminus">-&lt;HTML&gt;</span>
<a href="#l39.6"></a><span id="l39.6" class="difflineminus">-</span>
<a href="#l39.7"></a><span id="l39.7" class="difflineminus">-&lt;HEAD&gt;</span>
<a href="#l39.8"></a><span id="l39.8" class="difflineminus">-	&lt;TITLE&gt;Search&lt;/TITLE&gt;</span>
<a href="#l39.9"></a><span id="l39.9" class="difflineminus">-	&lt;BASE TARGET=&quot;_blank&quot;&gt;</span>
<a href="#l39.10"></a><span id="l39.10" class="difflineminus">-&lt;/HEAD&gt;</span>
<a href="#l39.11"></a><span id="l39.11" class="difflineminus">-</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-&lt;BODY&gt;</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineminus">-	&lt;CENTER&gt;SeaMonkey Search&lt;/CENTER&gt;</span>
<a href="#l39.14"></a><span id="l39.14" class="difflineminus">-&lt;/BODY&gt;</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineminus">-</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineminus">-&lt;/HTML&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1">deleted file mode 100755</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineminus">--- a/suite/locales/en-US/chrome/common/search/internetresults.dtd</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineplus">+++ /dev/null</span>
<a href="#l40.4"></a><span id="l40.4" class="difflineat">@@ -1,50 +0,0 @@</span>
<a href="#l40.5"></a><span id="l40.5" class="difflineminus">-&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l40.6"></a><span id="l40.6" class="difflineminus">-   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l40.7"></a><span id="l40.7" class="difflineminus">-   -</span>
<a href="#l40.8"></a><span id="l40.8" class="difflineminus">-   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l40.9"></a><span id="l40.9" class="difflineminus">-   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l40.10"></a><span id="l40.10" class="difflineminus">-   - the License. You may obtain a copy of the License at</span>
<a href="#l40.11"></a><span id="l40.11" class="difflineminus">-   - http://www.mozilla.org/MPL/</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-   -</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineminus">-   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineminus">-   - for the specific language governing rights and limitations under the</span>
<a href="#l40.16"></a><span id="l40.16" class="difflineminus">-   - License.</span>
<a href="#l40.17"></a><span id="l40.17" class="difflineminus">-   -</span>
<a href="#l40.18"></a><span id="l40.18" class="difflineminus">-   - The Original Code is Mozilla Communicator.</span>
<a href="#l40.19"></a><span id="l40.19" class="difflineminus">-   -</span>
<a href="#l40.20"></a><span id="l40.20" class="difflineminus">-   - The Initial Developer of the Original Code is</span>
<a href="#l40.21"></a><span id="l40.21" class="difflineminus">-   - Netscape Communications Corp.</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineminus">-   - Portions created by the Initial Developer are Copyright (C) 1999</span>
<a href="#l40.23"></a><span id="l40.23" class="difflineminus">-   - the Initial Developer. All Rights Reserved.</span>
<a href="#l40.24"></a><span id="l40.24" class="difflineminus">-   -</span>
<a href="#l40.25"></a><span id="l40.25" class="difflineminus">-   - Contributor(s):</span>
<a href="#l40.26"></a><span id="l40.26" class="difflineminus">-   -</span>
<a href="#l40.27"></a><span id="l40.27" class="difflineminus">-   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l40.28"></a><span id="l40.28" class="difflineminus">-   - either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l40.29"></a><span id="l40.29" class="difflineminus">-   - or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l40.30"></a><span id="l40.30" class="difflineminus">-   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineminus">-   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineminus">-   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l40.33"></a><span id="l40.33" class="difflineminus">-   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l40.34"></a><span id="l40.34" class="difflineminus">-   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l40.35"></a><span id="l40.35" class="difflineminus">-   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l40.36"></a><span id="l40.36" class="difflineminus">-   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l40.37"></a><span id="l40.37" class="difflineminus">-   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l40.38"></a><span id="l40.38" class="difflineminus">-   -</span>
<a href="#l40.39"></a><span id="l40.39" class="difflineminus">-   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l40.40"></a><span id="l40.40" class="difflineminus">-</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineminus">-&lt;!ENTITY results.title.label         &quot;Results:&quot;&gt;</span>
<a href="#l40.42"></a><span id="l40.42" class="difflineminus">-</span>
<a href="#l40.43"></a><span id="l40.43" class="difflineminus">-&lt;!ENTITY name.column.label           &quot;Name&quot;&gt;</span>
<a href="#l40.44"></a><span id="l40.44" class="difflineminus">-&lt;!ENTITY relevance.column.label      &quot;Relevance&quot;&gt;</span>
<a href="#l40.45"></a><span id="l40.45" class="difflineminus">-&lt;!ENTITY pagerank.column.label       &quot;Page Ranking&quot;&gt;</span>
<a href="#l40.46"></a><span id="l40.46" class="difflineminus">-&lt;!ENTITY price.column.label          &quot;Price&quot;&gt;</span>
<a href="#l40.47"></a><span id="l40.47" class="difflineminus">-&lt;!ENTITY availability.column.label   &quot;Availability&quot;&gt;</span>
<a href="#l40.48"></a><span id="l40.48" class="difflineminus">-&lt;!ENTITY date.column.label           &quot;Date&quot;&gt;</span>
<a href="#l40.49"></a><span id="l40.49" class="difflineminus">-&lt;!ENTITY site.column.label           &quot;Website&quot;&gt;</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineminus">-&lt;!ENTITY results.header.label        &quot;Search Results&quot;&gt;</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineminus">-&lt;!ENTITY engine.column.label         &quot;Search Engine&quot;&gt;</span>
<a href="#l40.52"></a><span id="l40.52" class="difflineminus">-&lt;!ENTITY viewbyprovider.label        &quot;View by search engine:&quot;&gt;</span>
<a href="#l40.53"></a><span id="l40.53" class="difflineminus">-&lt;!ENTITY allresults.title.label      &quot;All results combined&quot;&gt;</span>
<a href="#l40.54"></a><span id="l40.54" class="difflineminus">-&lt;!ENTITY internetresults.title       &quot;Search Results&quot;&gt;</span>
<a href="#l40.55"></a><span id="l40.55">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1">deleted file mode 100755</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineminus">--- a/suite/locales/en-US/chrome/common/search/search-editor.dtd</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineplus">+++ /dev/null</span>
<a href="#l41.4"></a><span id="l41.4" class="difflineat">@@ -1,54 +0,0 @@</span>
<a href="#l41.5"></a><span id="l41.5" class="difflineminus">-&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l41.6"></a><span id="l41.6" class="difflineminus">-   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l41.7"></a><span id="l41.7" class="difflineminus">-   -</span>
<a href="#l41.8"></a><span id="l41.8" class="difflineminus">-   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l41.9"></a><span id="l41.9" class="difflineminus">-   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l41.10"></a><span id="l41.10" class="difflineminus">-   - the License. You may obtain a copy of the License at</span>
<a href="#l41.11"></a><span id="l41.11" class="difflineminus">-   - http://www.mozilla.org/MPL/</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-   -</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineminus">-   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineminus">-   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineminus">-   - for the specific language governing rights and limitations under the</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineminus">-   - License.</span>
<a href="#l41.17"></a><span id="l41.17" class="difflineminus">-   -</span>
<a href="#l41.18"></a><span id="l41.18" class="difflineminus">-   - The Original Code is Mozilla Communicator.</span>
<a href="#l41.19"></a><span id="l41.19" class="difflineminus">-   -</span>
<a href="#l41.20"></a><span id="l41.20" class="difflineminus">-   - The Initial Developer of the Original Code is</span>
<a href="#l41.21"></a><span id="l41.21" class="difflineminus">-   - Netscape Communications Corp.</span>
<a href="#l41.22"></a><span id="l41.22" class="difflineminus">-   - Portions created by the Initial Developer are Copyright (C) 1999</span>
<a href="#l41.23"></a><span id="l41.23" class="difflineminus">-   - the Initial Developer. All Rights Reserved.</span>
<a href="#l41.24"></a><span id="l41.24" class="difflineminus">-   -</span>
<a href="#l41.25"></a><span id="l41.25" class="difflineminus">-   - Contributor(s):</span>
<a href="#l41.26"></a><span id="l41.26" class="difflineminus">-   -</span>
<a href="#l41.27"></a><span id="l41.27" class="difflineminus">-   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l41.28"></a><span id="l41.28" class="difflineminus">-   - either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l41.29"></a><span id="l41.29" class="difflineminus">-   - or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l41.30"></a><span id="l41.30" class="difflineminus">-   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">-   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineminus">-   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l41.33"></a><span id="l41.33" class="difflineminus">-   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l41.34"></a><span id="l41.34" class="difflineminus">-   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l41.35"></a><span id="l41.35" class="difflineminus">-   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l41.36"></a><span id="l41.36" class="difflineminus">-   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l41.37"></a><span id="l41.37" class="difflineminus">-   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l41.38"></a><span id="l41.38" class="difflineminus">-   -</span>
<a href="#l41.39"></a><span id="l41.39" class="difflineminus">-   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l41.40"></a><span id="l41.40" class="difflineminus">-</span>
<a href="#l41.41"></a><span id="l41.41" class="difflineminus">-&lt;!ENTITY window.title.label          &quot;Edit Categories&quot;&gt;</span>
<a href="#l41.42"></a><span id="l41.42" class="difflineminus">-&lt;!ENTITY allengines.label            &quot;All Engines&quot;&gt;</span>
<a href="#l41.43"></a><span id="l41.43" class="difflineminus">-&lt;!ENTITY engine.column.label         &quot;Engines for this Category&quot;&gt;</span>
<a href="#l41.44"></a><span id="l41.44" class="difflineminus">-&lt;!ENTITY category.label              &quot;Category&quot;&gt;</span>
<a href="#l41.45"></a><span id="l41.45" class="difflineminus">-&lt;!ENTITY category.accesskey          &quot;c&quot;&gt;</span>
<a href="#l41.46"></a><span id="l41.46" class="difflineminus">-&lt;!ENTITY done.label                  &quot;Done&quot;&gt;</span>
<a href="#l41.47"></a><span id="l41.47" class="difflineminus">-</span>
<a href="#l41.48"></a><span id="l41.48" class="difflineminus">-&lt;!ENTITY add.label                   &quot;Add&quot;&gt;</span>
<a href="#l41.49"></a><span id="l41.49" class="difflineminus">-&lt;!ENTITY add.accesskey               &quot;a&quot;&gt;</span>
<a href="#l41.50"></a><span id="l41.50" class="difflineminus">-&lt;!ENTITY remove.label                &quot;Remove&quot;&gt;</span>
<a href="#l41.51"></a><span id="l41.51" class="difflineminus">-&lt;!ENTITY remove.accesskey            &quot;r&quot;&gt;</span>
<a href="#l41.52"></a><span id="l41.52" class="difflineminus">-</span>
<a href="#l41.53"></a><span id="l41.53" class="difflineminus">-&lt;!ENTITY new.category.label          &quot;New…&quot;&gt;</span>
<a href="#l41.54"></a><span id="l41.54" class="difflineminus">-&lt;!ENTITY new.category.accesskey      &quot;n&quot;&gt;</span>
<a href="#l41.55"></a><span id="l41.55" class="difflineminus">-&lt;!ENTITY rename.category.label       &quot;Rename…&quot;&gt;</span>
<a href="#l41.56"></a><span id="l41.56" class="difflineminus">-&lt;!ENTITY rename.category.accesskey   &quot;e&quot;&gt;</span>
<a href="#l41.57"></a><span id="l41.57" class="difflineminus">-&lt;!ENTITY remove.category.label       &quot;Delete&quot;&gt;</span>
<a href="#l41.58"></a><span id="l41.58" class="difflineminus">-&lt;!ENTITY remove.category.accesskey   &quot;d&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1">deleted file mode 100755</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineminus">--- a/suite/locales/en-US/chrome/common/search/search-editor.properties</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineplus">+++ /dev/null</span>
<a href="#l42.4"></a><span id="l42.4" class="difflineat">@@ -1,7 +0,0 @@</span>
<a href="#l42.5"></a><span id="l42.5" class="difflineminus">-NewCategoryPrompt=Enter the category name:</span>
<a href="#l42.6"></a><span id="l42.6" class="difflineminus">-NewCategoryTitle=New Category</span>
<a href="#l42.7"></a><span id="l42.7" class="difflineminus">-RenameCategoryPrompt=Enter the new category name:</span>
<a href="#l42.8"></a><span id="l42.8" class="difflineminus">-RenameCategoryTitle=Rename Category</span>
<a href="#l42.9"></a><span id="l42.9" class="difflineminus">-RemoveCategoryPrompt=Are you sure you want to delete this category?</span>
<a href="#l42.10"></a><span id="l42.10" class="difflineminus">-RemoveCategoryTitle=Delete Category</span>
<a href="#l42.11"></a><span id="l42.11" class="difflineminus">-RemoveCategoryYes=&amp;Delete</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/suite/locales/en-US/chrome/common/search/search-panel.dtd</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/search/search-panel.dtd</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -6,45 +6,35 @@</span>
<a href="#l43.4"></a><span id="l43.4">    - the License. You may obtain a copy of the License at</span>
<a href="#l43.5"></a><span id="l43.5">    - http://www.mozilla.org/MPL/</span>
<a href="#l43.6"></a><span id="l43.6">    -</span>
<a href="#l43.7"></a><span id="l43.7">    - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l43.8"></a><span id="l43.8">    - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l43.9"></a><span id="l43.9">    - for the specific language governing rights and limitations under the</span>
<a href="#l43.10"></a><span id="l43.10">    - License.</span>
<a href="#l43.11"></a><span id="l43.11">    -</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-   - The Original Code is Mozilla Communicator.</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+   - The Original Code is SeaMonkey search panel.</span>
<a href="#l43.14"></a><span id="l43.14">    -</span>
<a href="#l43.15"></a><span id="l43.15">    - The Initial Developer of the Original Code is</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineminus">-   - Netscape Communications Corp.</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineminus">-   - Portions created by the Initial Developer are Copyright (C) 1999</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineplus">+   - the Mozilla Foundation.</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 2010</span>
<a href="#l43.20"></a><span id="l43.20">    - the Initial Developer. All Rights Reserved.</span>
<a href="#l43.21"></a><span id="l43.21">    -</span>
<a href="#l43.22"></a><span id="l43.22">    - Contributor(s):</span>
<a href="#l43.23"></a><span id="l43.23" class="difflineminus">-   -   Robert John Churchill &lt;rjc@netscape.com&gt;</span>
<a href="#l43.24"></a><span id="l43.24" class="difflineplus">+   -   Robert Kaiser &lt;kairo@kairo.at&gt;</span>
<a href="#l43.25"></a><span id="l43.25">    -</span>
<a href="#l43.26"></a><span id="l43.26">    - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l43.27"></a><span id="l43.27" class="difflineminus">-   - either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l43.28"></a><span id="l43.28" class="difflineminus">-   - or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l43.29"></a><span id="l43.29" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l43.30"></a><span id="l43.30" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l43.31"></a><span id="l43.31">    - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l43.32"></a><span id="l43.32">    - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l43.33"></a><span id="l43.33">    - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l43.34"></a><span id="l43.34">    - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l43.35"></a><span id="l43.35">    - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l43.36"></a><span id="l43.36">    - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l43.37"></a><span id="l43.37">    - the provisions above, a recipient may use your version of this file under</span>
<a href="#l43.38"></a><span id="l43.38">    - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l43.39"></a><span id="l43.39">    -</span>
<a href="#l43.40"></a><span id="l43.40">    - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l43.41"></a><span id="l43.41"> </span>
<a href="#l43.42"></a><span id="l43.42"> &lt;!ENTITY search.button.label      &quot;Search&quot;&gt;</span>
<a href="#l43.43"></a><span id="l43.43" class="difflineminus">-&lt;!ENTITY allengines.label         &quot;All Engines&quot;&gt;</span>
<a href="#l43.44"></a><span id="l43.44" class="difflineminus">-&lt;!ENTITY within.label             &quot;within&quot;&gt;</span>
<a href="#l43.45"></a><span id="l43.45" class="difflineminus">-&lt;!ENTITY using.label              &quot;using&quot;&gt;</span>
<a href="#l43.46"></a><span id="l43.46" class="difflineminus">-&lt;!ENTITY choose.label             &quot;Choose search engines, then click Search&quot;&gt;</span>
<a href="#l43.47"></a><span id="l43.47" class="difflineminus">-&lt;!ENTITY results.label            &quot;Search Results&quot;&gt;</span>
<a href="#l43.48"></a><span id="l43.48" class="difflineminus">-&lt;!ENTITY engine.column.label      &quot;Search Engines&quot;&gt;</span>
<a href="#l43.49"></a><span id="l43.49" class="difflineminus">-&lt;!ENTITY customize.menuitem.label &quot;Edit Categories …&quot;&gt;</span>
<a href="#l43.50"></a><span id="l43.50" class="difflineminus">-&lt;!ENTITY next.button.label        &quot;Next&quot;&gt;</span>
<a href="#l43.51"></a><span id="l43.51" class="difflineminus">-&lt;!ENTITY previous.button.label    &quot;Previous&quot;&gt;</span>
<a href="#l43.52"></a><span id="l43.52" class="difflineminus">-&lt;!ENTITY next.button.tooltip      &quot;Show next search results&quot;&gt;</span>
<a href="#l43.53"></a><span id="l43.53" class="difflineminus">-&lt;!ENTITY previous.button.tooltip  &quot;Show previous search results&quot;&gt;</span>
<a href="#l43.54"></a><span id="l43.54" class="difflineplus">+&lt;!ENTITY search.placeholder       &quot;Enter search text&quot;&gt;</span>
<a href="#l43.55"></a><span id="l43.55"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1">deleted file mode 100644</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineminus">--- a/suite/locales/en-US/chrome/common/search/search-panel.properties</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineplus">+++ /dev/null</span>
<a href="#l44.4"></a><span id="l44.4" class="difflineat">@@ -1,15 +0,0 @@</span>
<a href="#l44.5"></a><span id="l44.5" class="difflineminus">-enterstringandlocation=Enter some text to search for and select at least one location to search.</span>
<a href="#l44.6"></a><span id="l44.6" class="difflineminus">-enableAdvanced=Enable advanced search options</span>
<a href="#l44.7"></a><span id="l44.7" class="difflineminus">-disableAdvanced=Disable advanced search options</span>
<a href="#l44.8"></a><span id="l44.8" class="difflineminus">-addtobookmarks=Add to bookmarks</span>
<a href="#l44.9"></a><span id="l44.9" class="difflineminus">-addquerytobookmarks=Add search query to bookmarks</span>
<a href="#l44.10"></a><span id="l44.10" class="difflineminus">-excludeurl=Exclude this URL from future searches</span>
<a href="#l44.11"></a><span id="l44.11" class="difflineminus">-excludedomain=Exclude this domain from future searches</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-clearfilters=Clear all search filters</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineminus">-searchButtonText=Search</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineminus">-stopButtonText=Stop</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineminus">-changeEngineTitle=Change default search engine?</span>
<a href="#l44.16"></a><span id="l44.16" class="difflineminus">-changeEngineMsg=Would you like to make %S your default search engine?</span>
<a href="#l44.17"></a><span id="l44.17" class="difflineminus">-dontAskAgainMsg=Change default engine without asking in the future</span>
<a href="#l44.18"></a><span id="l44.18" class="difflineminus">-thisEngine=this</span>
<a href="#l44.19"></a><span id="l44.19" class="difflineminus">-searchTitle=Search: '%S'</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1">deleted file mode 100644</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineminus">--- a/suite/locales/en-US/chrome/common/search/search-rdf.dtd</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineplus">+++ /dev/null</span>
<a href="#l45.4"></a><span id="l45.4" class="difflineat">@@ -1,1 +0,0 @@</span>
<a href="#l45.5"></a><span id="l45.5" class="difflineminus">-&lt;!ENTITY search.category.web &quot;Web&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/suite/locales/en-US/chrome/common/sidebar/sidebar.properties</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/sidebar/sidebar.properties</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -1,9 +1,6 @@</span>
<a href="#l46.4"></a><span id="l46.4"> addPanelConfirmTitle=Add Tab to Sidebar</span>
<a href="#l46.5"></a><span id="l46.5"> addPanelConfirmMessage=Add the tab '%title%' to the %name%?##Source: %url%</span>
<a href="#l46.6"></a><span id="l46.6"> persistentPanelWarning=The sidebar tab you are adding can transfer data across the Internet and run JavaScript even while %name% is closed.</span>
<a href="#l46.7"></a><span id="l46.7"> </span>
<a href="#l46.8"></a><span id="l46.8"> dupePanelAlertTitle=Sidebar</span>
<a href="#l46.9"></a><span id="l46.9"> dupePanelAlertMessage=%url% already exists in the %name%.</span>
<a href="#l46.10"></a><span id="l46.10" class="difflineminus">-</span>
<a href="#l46.11"></a><span id="l46.11" class="difflineminus">-addEngineConfirmTitle=Add Search Engine</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-addEngineConfirmMessage=Add the following search engine to the %name% Internet Search tab?##Name: %title%#Search Category: %category%#Source: %url%</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1">new file mode 100644</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineminus">--- /dev/null</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineplus">+++ b/suite/locales/en-US/searchplugins/creativecommons.xml</span>
<a href="#l47.4"></a><span id="l47.4" class="difflineat">@@ -0,0 +1,11 @@</span>
<a href="#l47.5"></a><span id="l47.5" class="difflineplus">+&lt;SearchPlugin xmlns=&quot;http://www.mozilla.org/2006/browser/search/&quot;&gt;</span>
<a href="#l47.6"></a><span id="l47.6" class="difflineplus">+&lt;ShortName&gt;Creative Commons&lt;/ShortName&gt;</span>
<a href="#l47.7"></a><span id="l47.7" class="difflineplus">+&lt;Description&gt;Find photos, movies, music, and text to rip, sample, mash, and share.&lt;/Description&gt;</span>
<a href="#l47.8"></a><span id="l47.8" class="difflineplus">+&lt;InputEncoding&gt;utf-8&lt;/InputEncoding&gt;</span>
<a href="#l47.9"></a><span id="l47.9" class="difflineplus">+&lt;Image width=&quot;16&quot; height=&quot;16&quot;&gt;data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJUSURBVDiNjZO9S1thGMXPvTfJFbnkipNkLLS0ksFg0M0lf4CboNCEgIIg/RiKtEOn0qGWTtbVoBYcIji10I9J0ApWCjp0kRaXdhHjTW4+uGnur4NJ8GOwZ3nf4TnnfZ5z3scAdBGGYdyVdN+yrGHTNNOtVqsVhuG+pO+S3gE/LtV3BIxzPDJNc8FxHGN0dNRKpVIGoJ2dndr+/r5Vr9cl6bmkN0AoSQIEyHXdj5KYnZ3F932uolKpkM/nK5KQ9FmSCZwLOI7zQBLr6+vXiFdRLBaDtsiTTve3YrFYkM/nbyR3MDU1dSKpLumO+vr6Xruui+d5AFSrVVZWVtjY2KDRaABwdHTE4uIie3t7AJTLZaLRaFXSCyUSid1MJgOA53n09/eTTqdJJpPMzc2xurqKbduMj48Tj8fZ3d0FYHBw8FjSezmOU56fnwdgeXkZ27ap1WpUKhWazSZjY2Nks1kASqVSd4zp6eljSX/MtiHdRDpnEATyfb+bkiSVSqXu3TCM8xgHBga+dkY4OzvDdV2GhoZIJBLMzMxQKBSIRqNkMhlisRhbW1sAJJPJn5I+KB6Pv7poou/7rK2tsbm5SRAEXROXlpY4ODgAoFarYdu2J+llN8ZcLvffMeZyud+SGpLuCVBPT89jSRQKhRvJxWKxISmU9JTOT5Rk9Pb2fpHE5OQkJycn14inp6dMTEx4bdM/SbKAy8sk6WEkElmwLCuSSqUYGRmxgHB7e7t+eHgYazabgaRnkt7SeZnr63xbUtYwjGHTNNNhGP4F9iR9a6/zr4v1/wDE1D9XlC4rrAAAAABJRU5ErkJggg==&lt;/Image&gt;</span>
<a href="#l47.10"></a><span id="l47.10" class="difflineplus">+&lt;Url type=&quot;text/html&quot; method=&quot;GET&quot; template=&quot;http://search.creativecommons.org/&quot;&gt;</span>
<a href="#l47.11"></a><span id="l47.11" class="difflineplus">+  &lt;Param name=&quot;q&quot; value=&quot;{searchTerms}&quot;/&gt;</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineplus">+  &lt;Param name=&quot;sourceid&quot; value=&quot;Mozilla-search&quot;/&gt;</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+&lt;/Url&gt;</span>
<a href="#l47.14"></a><span id="l47.14" class="difflineplus">+&lt;SearchForm&gt;http://search.creativecommons.org/&lt;/SearchForm&gt;</span>
<a href="#l47.15"></a><span id="l47.15" class="difflineplus">+&lt;/SearchPlugin&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1">deleted file mode 100644</span>
<a href="#l48.2"></a><span id="l48.2">index df723f0a8fc1abc638130c3b06963461b542ca1c..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l48.3"></a><span id="l48.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1">deleted file mode 100644</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineminus">--- a/suite/locales/en-US/searchplugins/dmoz.src</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineplus">+++ /dev/null</span>
<a href="#l49.4"></a><span id="l49.4" class="difflineat">@@ -1,36 +0,0 @@</span>
<a href="#l49.5"></a><span id="l49.5" class="difflineminus">-# Search file for dmoz.org</span>
<a href="#l49.6"></a><span id="l49.6" class="difflineminus">-#</span>
<a href="#l49.7"></a><span id="l49.7" class="difflineminus">-# Creation:  April 24, 2000 by Robert John Churchill  &lt;rjc@netscape.com&gt;</span>
<a href="#l49.8"></a><span id="l49.8" class="difflineminus">-</span>
<a href="#l49.9"></a><span id="l49.9" class="difflineminus">-&lt;SEARCH</span>
<a href="#l49.10"></a><span id="l49.10" class="difflineminus">-      name=&quot;dmoz.org&quot;</span>
<a href="#l49.11"></a><span id="l49.11" class="difflineminus">-      description = &quot;dmoz.org&quot;</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-      method=&quot;GET&quot;</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineminus">-      action=&quot;http://search.dmoz.org/cgi-bin/search&quot;</span>
<a href="#l49.14"></a><span id="l49.14" class="difflineminus">-      queryCharset=&quot;utf-8&quot;</span>
<a href="#l49.15"></a><span id="l49.15" class="difflineminus">-&gt;</span>
<a href="#l49.16"></a><span id="l49.16" class="difflineminus">-</span>
<a href="#l49.17"></a><span id="l49.17" class="difflineminus">-&lt;INPUT NAME=&quot;search&quot; user&gt;</span>
<a href="#l49.18"></a><span id="l49.18" class="difflineminus">-</span>
<a href="#l49.19"></a><span id="l49.19" class="difflineminus">-&lt;INTERPRET</span>
<a href="#l49.20"></a><span id="l49.20" class="difflineminus">-      browserResultType = &quot;category&quot;</span>
<a href="#l49.21"></a><span id="l49.21" class="difflineminus">-      resultListStart = &quot;&lt;b&gt;Open Directory Categories&lt;/b&gt;&quot;</span>
<a href="#l49.22"></a><span id="l49.22" class="difflineminus">-      resultListEnd = &quot;&lt;/ol&gt;&quot;</span>
<a href="#l49.23"></a><span id="l49.23" class="difflineminus">-      resultItemStart = &quot;&lt;li&gt;&quot;</span>
<a href="#l49.24"></a><span id="l49.24" class="difflineminus">-&gt;</span>
<a href="#l49.25"></a><span id="l49.25" class="difflineminus">-</span>
<a href="#l49.26"></a><span id="l49.26" class="difflineminus">-&lt;INTERPRET</span>
<a href="#l49.27"></a><span id="l49.27" class="difflineminus">-      browserResultType = &quot;result&quot;</span>
<a href="#l49.28"></a><span id="l49.28" class="difflineminus">-      resultListStart = &quot;&lt;b&gt;Open Directory Websites&lt;/b&gt;&quot;</span>
<a href="#l49.29"></a><span id="l49.29" class="difflineminus">-      resultListEnd = &quot;&lt;/ol&gt;&quot;</span>
<a href="#l49.30"></a><span id="l49.30" class="difflineminus">-      resultItemStart = &quot;&lt;li&gt;&quot;</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineminus">-      charset=&quot;utf-8&quot;</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineminus">-&gt;</span>
<a href="#l49.33"></a><span id="l49.33" class="difflineminus">-</span>
<a href="#l49.34"></a><span id="l49.34" class="difflineminus">-&lt;/SEARCH&gt;</span>
<a href="#l49.35"></a><span id="l49.35" class="difflineminus">-</span>
<a href="#l49.36"></a><span id="l49.36" class="difflineminus">-&lt;BROWSER</span>
<a href="#l49.37"></a><span id="l49.37" class="difflineminus">-      update=&quot;http://www.mozilla.org/projects/search/dmoz.src&quot; </span>
<a href="#l49.38"></a><span id="l49.38" class="difflineminus">-      updateIcon=&quot;http://www.mozilla.org/projects/search/dmoz.gif&quot; </span>
<a href="#l49.39"></a><span id="l49.39" class="difflineminus">-      updateCheckDays=&quot;3&quot;</span>
<a href="#l49.40"></a><span id="l49.40" class="difflineminus">-&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1">deleted file mode 100644</span>
<a href="#l50.2"></a><span id="l50.2">index 78b9568a313d96dc4461187f7e515dd6b9ad7d62..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l50.3"></a><span id="l50.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1">deleted file mode 100644</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineminus">--- a/suite/locales/en-US/searchplugins/google.src</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineplus">+++ /dev/null</span>
<a href="#l51.4"></a><span id="l51.4" class="difflineat">@@ -1,28 +0,0 @@</span>
<a href="#l51.5"></a><span id="l51.5" class="difflineminus">-# Mozilla/Google plug-in by amitp+mozilla@google.com</span>
<a href="#l51.6"></a><span id="l51.6" class="difflineminus">-</span>
<a href="#l51.7"></a><span id="l51.7" class="difflineminus">-&lt;search </span>
<a href="#l51.8"></a><span id="l51.8" class="difflineminus">-   name=&quot;Google&quot;</span>
<a href="#l51.9"></a><span id="l51.9" class="difflineminus">-   description=&quot;Google Search&quot;</span>
<a href="#l51.10"></a><span id="l51.10" class="difflineminus">-   method=&quot;GET&quot;</span>
<a href="#l51.11"></a><span id="l51.11" class="difflineminus">-   action=&quot;http://www.google.com/search&quot;</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-   update=&quot;http://www.google.com/mozilla/google.src&quot;</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineminus">-   updateCheckDays=1   </span>
<a href="#l51.14"></a><span id="l51.14" class="difflineminus">-   queryEncoding=&quot;utf-8&quot;</span>
<a href="#l51.15"></a><span id="l51.15" class="difflineminus">-   queryCharset=&quot;utf-8&quot;</span>
<a href="#l51.16"></a><span id="l51.16" class="difflineminus">-&gt;</span>
<a href="#l51.17"></a><span id="l51.17" class="difflineminus">-</span>
<a href="#l51.18"></a><span id="l51.18" class="difflineminus">-&lt;input name=&quot;q&quot; user&gt;</span>
<a href="#l51.19"></a><span id="l51.19" class="difflineminus">-&lt;inputnext name=&quot;start&quot; factor=&quot;10&quot;&gt;</span>
<a href="#l51.20"></a><span id="l51.20" class="difflineminus">-&lt;inputprev name=&quot;start&quot; factor=&quot;10&quot;&gt;</span>
<a href="#l51.21"></a><span id="l51.21" class="difflineminus">-&lt;input name=&quot;ie&quot; value=&quot;utf-8&quot;&gt;</span>
<a href="#l51.22"></a><span id="l51.22" class="difflineminus">-&lt;input name=&quot;oe&quot; value=&quot;utf-8&quot;&gt;</span>
<a href="#l51.23"></a><span id="l51.23" class="difflineminus">-</span>
<a href="#l51.24"></a><span id="l51.24" class="difflineminus">-&lt;interpret </span>
<a href="#l51.25"></a><span id="l51.25" class="difflineminus">-    browserResultType=&quot;result&quot; </span>
<a href="#l51.26"></a><span id="l51.26" class="difflineminus">-    charset = &quot;UTF-8&quot;</span>
<a href="#l51.27"></a><span id="l51.27" class="difflineminus">-    resultListStart=&quot;&lt;!--a--&gt;&quot; </span>
<a href="#l51.28"></a><span id="l51.28" class="difflineminus">-    resultListEnd=&quot;&lt;!--z--&gt;&quot; </span>
<a href="#l51.29"></a><span id="l51.29" class="difflineminus">-    resultItemStart=&quot;&lt;!--m--&gt;&quot; </span>
<a href="#l51.30"></a><span id="l51.30" class="difflineminus">-    resultItemEnd=&quot;&lt;!--n--&gt;&quot;</span>
<a href="#l51.31"></a><span id="l51.31" class="difflineminus">-&gt;</span>
<a href="#l51.32"></a><span id="l51.32" class="difflineminus">-&lt;/search&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1">new file mode 100644</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineminus">--- /dev/null</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineplus">+++ b/suite/locales/en-US/searchplugins/google.xml</span>
<a href="#l52.4"></a><span id="l52.4" class="difflineat">@@ -0,0 +1,17 @@</span>
<a href="#l52.5"></a><span id="l52.5" class="difflineplus">+&lt;SearchPlugin xmlns=&quot;http://www.mozilla.org/2006/browser/search/&quot;&gt;</span>
<a href="#l52.6"></a><span id="l52.6" class="difflineplus">+&lt;ShortName&gt;Google&lt;/ShortName&gt;</span>
<a href="#l52.7"></a><span id="l52.7" class="difflineplus">+&lt;Description&gt;Google Search&lt;/Description&gt;</span>
<a href="#l52.8"></a><span id="l52.8" class="difflineplus">+&lt;InputEncoding&gt;UTF-8&lt;/InputEncoding&gt;</span>
<a href="#l52.9"></a><span id="l52.9" class="difflineplus">+&lt;Image width=&quot;16&quot; height=&quot;16&quot;&gt;data:image/png;base64,AAABAAEAEBAAAAEAGABoAwAAFgAAACgAAAAQAAAAIAAAAAEAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADs9Pt8xetPtu9FsfFNtu%2BTzvb2%2B%2Fne4dFJeBw0egA%2FfAJAfAA8ewBBegAAAAD%2B%2FPtft98Mp%2BwWsfAVsvEbs%2FQeqvF8xO7%2F%2F%2F63yqkxdgM7gwE%2FggM%2BfQA%2BegBDeQDe7PIbotgQufcMufEPtfIPsvAbs%2FQvq%2Bfz%2Bf%2F%2B%2B%2FZKhR05hgBBhQI8hgBAgAI9ewD0%2B%2Fg3pswAtO8Cxf4Kw%2FsJvvYAqupKsNv%2B%2Fv7%2F%2FP5VkSU0iQA7jQA9hgBDgQU%2BfQH%2F%2Ff%2FQ6fM4sM4KsN8AteMCruIqqdbZ7PH8%2Fv%2Fg6Nc%2Fhg05kAA8jAM9iQI%2BhQA%2BgQDQu6b97uv%2F%2F%2F7V8Pqw3eiWz97q8%2Ff%2F%2F%2F%2F7%2FPptpkkqjQE4kwA7kAA5iwI8iAA8hQCOSSKdXjiyflbAkG7u2s%2F%2B%2F%2F39%2F%2F7r8utrqEYtjQE8lgA7kwA7kwA9jwA9igA9hACiWSekVRyeSgiYSBHx6N%2F%2B%2Fv7k7OFRmiYtlAA5lwI7lwI4lAA7kgI9jwE9iwI4iQCoVhWcTxCmb0K%2BooT8%2Fv%2F7%2F%2F%2FJ2r8fdwI1mwA3mQA3mgA8lAE8lAE4jwA9iwE%2BhwGfXifWvqz%2B%2Ff%2F58u%2Fev6Dt4tr%2B%2F%2F2ZuIUsggA7mgM6mAM3lgA5lgA6kQE%2FkwBChwHt4dv%2F%2F%2F728ei1bCi7VAC5XQ7kz7n%2F%2F%2F6bsZkgcB03lQA9lgM7kwA2iQktZToPK4r9%2F%2F%2F9%2F%2F%2FSqYK5UwDKZAS9WALIkFn%2B%2F%2F3%2F%2BP8oKccGGcIRJrERILYFEMwAAuEAAdX%2F%2Ff7%2F%2FP%2B%2BfDvGXQLIZgLEWgLOjlf7%2F%2F%2F%2F%2F%2F9QU90EAPQAAf8DAP0AAfMAAOUDAtr%2F%2F%2F%2F7%2B%2Fu2bCTIYwDPZgDBWQDSr4P%2F%2Fv%2F%2F%2FP5GRuABAPkAA%2FwBAfkDAPAAAesAAN%2F%2F%2B%2Fz%2F%2F%2F64g1C5VwDMYwK8Yg7y5tz8%2Fv%2FV1PYKDOcAAP0DAf4AAf0AAfYEAOwAAuAAAAD%2F%2FPvi28ymXyChTATRrIb8%2F%2F3v8fk6P8MAAdUCAvoAAP0CAP0AAfYAAO4AAACAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAQAA&lt;/Image&gt;</span>
<a href="#l52.10"></a><span id="l52.10" class="difflineplus">+&lt;Url type=&quot;application/x-suggestions+json&quot; method=&quot;GET&quot; template=&quot;http://suggestqueries.google.com/complete/search?output=firefox&amp;amp;client=seamonkey&amp;amp;hl={moz:locale}&amp;amp;q={searchTerms}&quot;/&gt;</span>
<a href="#l52.11"></a><span id="l52.11" class="difflineplus">+&lt;Url type=&quot;text/html&quot; method=&quot;GET&quot; template=&quot;http://www.google.com/search&quot;&gt;</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineplus">+  &lt;Param name=&quot;q&quot; value=&quot;{searchTerms}&quot;/&gt;</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+  &lt;Param name=&quot;ie&quot; value=&quot;utf-8&quot;/&gt;</span>
<a href="#l52.14"></a><span id="l52.14" class="difflineplus">+  &lt;Param name=&quot;oe&quot; value=&quot;utf-8&quot;/&gt;</span>
<a href="#l52.15"></a><span id="l52.15" class="difflineplus">+  &lt;Param name=&quot;aq&quot; value=&quot;t&quot;/&gt;</span>
<a href="#l52.16"></a><span id="l52.16" class="difflineplus">+  &lt;!-- Dynamic parameters --&gt;</span>
<a href="#l52.17"></a><span id="l52.17" class="difflineplus">+  &lt;Param name=&quot;rls&quot; value=&quot;{moz:distributionID}:{moz:locale}:{moz:official}&quot;/&gt;</span>
<a href="#l52.18"></a><span id="l52.18" class="difflineplus">+  &lt;MozParam name=&quot;client&quot; condition=&quot;defaultEngine&quot; trueValue=&quot;seamonkey-a&quot; falseValue=&quot;seamonkey&quot;/&gt;</span>
<a href="#l52.19"></a><span id="l52.19" class="difflineplus">+&lt;/Url&gt;</span>
<a href="#l52.20"></a><span id="l52.20" class="difflineplus">+&lt;SearchForm&gt;http://www.google.com/&lt;/SearchForm&gt;</span>
<a href="#l52.21"></a><span id="l52.21" class="difflineplus">+&lt;/SearchPlugin&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1">deleted file mode 100644</span>
<a href="#l53.2"></a><span id="l53.2">index 52722acb835d558cf237411f9d593b4f79456f17..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l53.3"></a><span id="l53.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1">deleted file mode 100644</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineminus">--- a/suite/locales/en-US/searchplugins/jeeves.src</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineplus">+++ /dev/null</span>
<a href="#l54.4"></a><span id="l54.4" class="difflineat">@@ -1,30 +0,0 @@</span>
<a href="#l54.5"></a><span id="l54.5" class="difflineminus">-# Mozilla/AskJeeves plug-in (sspitzer@mozilla.org)</span>
<a href="#l54.6"></a><span id="l54.6" class="difflineminus">-#</span>
<a href="#l54.7"></a><span id="l54.7" class="difflineminus">-# I started with amitp+mozilla@google.com google plugin (google.src)</span>
<a href="#l54.8"></a><span id="l54.8" class="difflineminus">-# and jeeves.src from the mycroft guys</span>
<a href="#l54.9"></a><span id="l54.9" class="difflineminus">-# Erich Iseli &lt;sherlock@iseli.org&gt;, Julius Ross &lt;juliusross@mac.com&gt;</span>
<a href="#l54.10"></a><span id="l54.10" class="difflineminus">-# and modified it to work for ask.com</span>
<a href="#l54.11"></a><span id="l54.11" class="difflineminus">-# Last updated November 19, 2006 (Charles Caygill, Mycroft Project)</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineminus">-&lt;search </span>
<a href="#l54.14"></a><span id="l54.14" class="difflineminus">-   name=&quot;Ask.com&quot;</span>
<a href="#l54.15"></a><span id="l54.15" class="difflineminus">-   description=&quot;Ask.com Search Engine&quot;</span>
<a href="#l54.16"></a><span id="l54.16" class="difflineminus">-   method=&quot;GET&quot;</span>
<a href="#l54.17"></a><span id="l54.17" class="difflineminus">-   action=&quot;http://www.ask.com/web&quot;</span>
<a href="#l54.18"></a><span id="l54.18" class="difflineminus">-   queryCharset=&quot;utf-8&quot;</span>
<a href="#l54.19"></a><span id="l54.19" class="difflineminus">-&gt;</span>
<a href="#l54.20"></a><span id="l54.20" class="difflineminus">-</span>
<a href="#l54.21"></a><span id="l54.21" class="difflineminus">-&lt;input name=&quot;q&quot; user&gt;</span>
<a href="#l54.22"></a><span id="l54.22" class="difflineminus">-&lt;inputnext name=&quot;page&quot; factor=&quot;1&quot;&gt;</span>
<a href="#l54.23"></a><span id="l54.23" class="difflineminus">-&lt;inputprev&gt;</span>
<a href="#l54.24"></a><span id="l54.24" class="difflineminus">-</span>
<a href="#l54.25"></a><span id="l54.25" class="difflineminus">-&lt;interpret </span>
<a href="#l54.26"></a><span id="l54.26" class="difflineminus">-    browserResultType=&quot;result&quot; </span>
<a href="#l54.27"></a><span id="l54.27" class="difflineminus">-    charset=&quot;utf-8&quot;</span>
<a href="#l54.28"></a><span id="l54.28" class="difflineminus">-    resultListStart='&lt;html&gt;'</span>
<a href="#l54.29"></a><span id="l54.29" class="difflineminus">-    resultListEnd='&lt;/html&gt;'</span>
<a href="#l54.30"></a><span id="l54.30" class="difflineminus">-    resultItemStart='class=&quot;L4&quot;'</span>
<a href="#l54.31"></a><span id="l54.31" class="difflineminus">-    resultItemEnd='class=&quot;T1&quot;'</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineminus">-&gt;</span>
<a href="#l54.33"></a><span id="l54.33" class="difflineminus">-</span>
<a href="#l54.34"></a><span id="l54.34" class="difflineminus">-&lt;/search&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/suite/locales/en-US/searchplugins/list.txt</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/suite/locales/en-US/searchplugins/list.txt</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -1,3 +1,4 @@</span>
<a href="#l55.4"></a><span id="l55.4" class="difflineplus">+creativecommons</span>
<a href="#l55.5"></a><span id="l55.5"> google</span>
<a href="#l55.6"></a><span id="l55.6" class="difflineminus">-dmoz</span>
<a href="#l55.7"></a><span id="l55.7" class="difflineminus">-jeeves</span>
<a href="#l55.8"></a><span id="l55.8" class="difflineplus">+wikipedia</span>
<a href="#l55.9"></a><span id="l55.9" class="difflineplus">+yahoo</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1">new file mode 100644</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineminus">--- /dev/null</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineplus">+++ b/suite/locales/en-US/searchplugins/wikipedia.xml</span>
<a href="#l56.4"></a><span id="l56.4" class="difflineat">@@ -0,0 +1,15 @@</span>
<a href="#l56.5"></a><span id="l56.5" class="difflineplus">+&lt;SearchPlugin xmlns=&quot;http://www.mozilla.org/2006/browser/search/&quot;&gt;</span>
<a href="#l56.6"></a><span id="l56.6" class="difflineplus">+&lt;ShortName&gt;Wikipedia (en)&lt;/ShortName&gt;</span>
<a href="#l56.7"></a><span id="l56.7" class="difflineplus">+&lt;Description&gt;Wikipedia, the free encyclopedia&lt;/Description&gt;</span>
<a href="#l56.8"></a><span id="l56.8" class="difflineplus">+&lt;InputEncoding&gt;UTF-8&lt;/InputEncoding&gt;</span>
<a href="#l56.9"></a><span id="l56.9" class="difflineplus">+&lt;Image width=&quot;16&quot; height=&quot;16&quot;&gt;data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAEAgQAhIOEAMjHyABIR0gA6ejpAGlqaQCpqKkAKCgoAPz9%2FAAZGBkAmJiYANjZ2ABXWFcAent6ALm6uQA8OjwAiIiIiIiIiIiIiI4oiL6IiIiIgzuIV4iIiIhndo53KIiIiB%2FWvXoYiIiIfEZfWBSIiIEGi%2FfoqoiIgzuL84i9iIjpGIoMiEHoiMkos3FojmiLlUipYliEWIF%2BiDe0GoRa7D6GPbjcu1yIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&lt;/Image&gt;</span>
<a href="#l56.10"></a><span id="l56.10" class="difflineplus">+&lt;Url type=&quot;application/x-suggestions+json&quot; method=&quot;GET&quot; template=&quot;http://en.wikipedia.org/w/api.php&quot;&gt;</span>
<a href="#l56.11"></a><span id="l56.11" class="difflineplus">+  &lt;Param name=&quot;action&quot; value=&quot;opensearch&quot;/&gt;</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineplus">+  &lt;Param name=&quot;search&quot; value=&quot;{searchTerms}&quot;/&gt;</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+&lt;/Url&gt;</span>
<a href="#l56.14"></a><span id="l56.14" class="difflineplus">+&lt;Url type=&quot;text/html&quot; method=&quot;GET&quot; template=&quot;http://en.wikipedia.org/wiki/Special:Search&quot;&gt;</span>
<a href="#l56.15"></a><span id="l56.15" class="difflineplus">+  &lt;Param name=&quot;search&quot; value=&quot;{searchTerms}&quot;/&gt;</span>
<a href="#l56.16"></a><span id="l56.16" class="difflineplus">+  &lt;Param name=&quot;sourceid&quot; value=&quot;Mozilla-search&quot;/&gt;</span>
<a href="#l56.17"></a><span id="l56.17" class="difflineplus">+&lt;/Url&gt;</span>
<a href="#l56.18"></a><span id="l56.18" class="difflineplus">+&lt;SearchForm&gt;http://en.wikipedia.org/wiki/Special:Search&lt;/SearchForm&gt;</span>
<a href="#l56.19"></a><span id="l56.19" class="difflineplus">+&lt;/SearchPlugin&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1">new file mode 100644</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineminus">--- /dev/null</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineplus">+++ b/suite/locales/en-US/searchplugins/yahoo.xml</span>
<a href="#l57.4"></a><span id="l57.4" class="difflineat">@@ -0,0 +1,13 @@</span>
<a href="#l57.5"></a><span id="l57.5" class="difflineplus">+&lt;SearchPlugin xmlns=&quot;http://www.mozilla.org/2006/browser/search/&quot;&gt;</span>
<a href="#l57.6"></a><span id="l57.6" class="difflineplus">+&lt;ShortName&gt;Yahoo&lt;/ShortName&gt;</span>
<a href="#l57.7"></a><span id="l57.7" class="difflineplus">+&lt;Description&gt;Yahoo Search&lt;/Description&gt;</span>
<a href="#l57.8"></a><span id="l57.8" class="difflineplus">+&lt;InputEncoding&gt;UTF-8&lt;/InputEncoding&gt;</span>
<a href="#l57.9"></a><span id="l57.9" class="difflineplus">+&lt;Image width=&quot;16&quot; height=&quot;16&quot;&gt;data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbgJqAIoCdgCaAnoAnhKCAKYijgCuLpIAskKeALpSpgC+Yq4AzHy8ANqezgDmvt4A7tLqAPz5+wD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKlRFIoABWAKERERE6ADcKMzzu2hOgAAhERK8REWCWBERE36ERMHMEREvo6iEgY6hEn6Pu0mAzqkz/xjMzoDNwpERERDoAMzAKlERIoAAzMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAA//8AAP//AADAOQAAgBkAAAAPAAAACQAAAAkAAAAIAAAACAAAAAgAAIAYAADAOAAA//8AAP//AAD//wAA&lt;/Image&gt;</span>
<a href="#l57.10"></a><span id="l57.10" class="difflineplus">+&lt;Url type=&quot;application/x-suggestions+json&quot; method=&quot;GET&quot;</span>
<a href="#l57.11"></a><span id="l57.11" class="difflineplus">+     template=&quot;http://ff.search.yahoo.com/gossip?output=fxjson&amp;amp;command={searchTerms}&quot; /&gt;</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineplus">+&lt;Url type=&quot;text/html&quot; method=&quot;GET&quot; template=&quot;http://search.yahoo.com/search&quot;&gt;</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+  &lt;Param name=&quot;p&quot; value=&quot;{searchTerms}&quot;/&gt;</span>
<a href="#l57.14"></a><span id="l57.14" class="difflineplus">+  &lt;Param name=&quot;ei&quot; value=&quot;UTF-8&quot;/&gt;</span>
<a href="#l57.15"></a><span id="l57.15" class="difflineplus">+&lt;/Url&gt;</span>
<a href="#l57.16"></a><span id="l57.16" class="difflineplus">+&lt;SearchForm&gt;http://search.yahoo.com/&lt;/SearchForm&gt;</span>
<a href="#l57.17"></a><span id="l57.17" class="difflineplus">+&lt;/SearchPlugin&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1">deleted file mode 100644</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineminus">--- a/suite/locales/generic/profile/search.rdf.in</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineplus">+++ /dev/null</span>
<a href="#l58.4"></a><span id="l58.4" class="difflineat">@@ -1,66 +0,0 @@</span>
<a href="#l58.5"></a><span id="l58.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt; &lt;!-- -*- Mode: SGML -*- --&gt;</span>
<a href="#l58.6"></a><span id="l58.6" class="difflineminus">-&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l58.7"></a><span id="l58.7" class="difflineminus">-   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l58.8"></a><span id="l58.8" class="difflineminus">-   -</span>
<a href="#l58.9"></a><span id="l58.9" class="difflineminus">-   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l58.10"></a><span id="l58.10" class="difflineminus">-   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l58.11"></a><span id="l58.11" class="difflineminus">-   - the License. You may obtain a copy of the License at</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-   - http://www.mozilla.org/MPL/</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineminus">-   -</span>
<a href="#l58.14"></a><span id="l58.14" class="difflineminus">-   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l58.15"></a><span id="l58.15" class="difflineminus">-   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l58.16"></a><span id="l58.16" class="difflineminus">-   - for the specific language governing rights and limitations under the</span>
<a href="#l58.17"></a><span id="l58.17" class="difflineminus">-   - License.</span>
<a href="#l58.18"></a><span id="l58.18" class="difflineminus">-   -</span>
<a href="#l58.19"></a><span id="l58.19" class="difflineminus">-   - The Original Code is Mozilla Communicator.</span>
<a href="#l58.20"></a><span id="l58.20" class="difflineminus">-   -</span>
<a href="#l58.21"></a><span id="l58.21" class="difflineminus">-   - The Initial Developer of the Original Code is</span>
<a href="#l58.22"></a><span id="l58.22" class="difflineminus">-   - Netscape Communications Corp.</span>
<a href="#l58.23"></a><span id="l58.23" class="difflineminus">-   - Portions created by the Initial Developer are Copyright (C) 1999</span>
<a href="#l58.24"></a><span id="l58.24" class="difflineminus">-   - the Initial Developer. All Rights Reserved.</span>
<a href="#l58.25"></a><span id="l58.25" class="difflineminus">-   -</span>
<a href="#l58.26"></a><span id="l58.26" class="difflineminus">-   - Contributor(s):</span>
<a href="#l58.27"></a><span id="l58.27" class="difflineminus">-   -   Robert John Churchill (rjc@netscape.com)</span>
<a href="#l58.28"></a><span id="l58.28" class="difflineminus">-   -</span>
<a href="#l58.29"></a><span id="l58.29" class="difflineminus">-   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l58.30"></a><span id="l58.30" class="difflineminus">-   - either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l58.31"></a><span id="l58.31" class="difflineminus">-   - or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l58.32"></a><span id="l58.32" class="difflineminus">-   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l58.33"></a><span id="l58.33" class="difflineminus">-   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l58.34"></a><span id="l58.34" class="difflineminus">-   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l58.35"></a><span id="l58.35" class="difflineminus">-   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l58.36"></a><span id="l58.36" class="difflineminus">-   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l58.37"></a><span id="l58.37" class="difflineminus">-   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l58.38"></a><span id="l58.38" class="difflineminus">-   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l58.39"></a><span id="l58.39" class="difflineminus">-   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l58.40"></a><span id="l58.40" class="difflineminus">-   -</span>
<a href="#l58.41"></a><span id="l58.41" class="difflineminus">-   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l58.42"></a><span id="l58.42" class="difflineminus">-</span>
<a href="#l58.43"></a><span id="l58.43" class="difflineminus">-</span>
<a href="#l58.44"></a><span id="l58.44" class="difflineminus">-&lt;!DOCTYPE RDF SYSTEM &quot;chrome://communicator/locale/search/search-rdf.dtd&quot;&gt;</span>
<a href="#l58.45"></a><span id="l58.45" class="difflineminus">-</span>
<a href="#l58.46"></a><span id="l58.46" class="difflineminus">-</span>
<a href="#l58.47"></a><span id="l58.47" class="difflineminus">-&lt;RDF:RDF xmlns:RDF=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l58.48"></a><span id="l58.48" class="difflineminus">-         xmlns:NC=&quot;http://home.netscape.com/NC-rdf#&quot;&gt;</span>
<a href="#l58.49"></a><span id="l58.49" class="difflineminus">-</span>
<a href="#l58.50"></a><span id="l58.50" class="difflineminus">-</span>
<a href="#l58.51"></a><span id="l58.51" class="difflineminus">-&lt;!-- search categories (under the &quot;NC:SearchCategoryRoot&quot; node) --&gt;</span>
<a href="#l58.52"></a><span id="l58.52" class="difflineminus">-&lt;!-- Note: these names SHOULD be localized via a DTD --&gt;</span>
<a href="#l58.53"></a><span id="l58.53" class="difflineminus">-</span>
<a href="#l58.54"></a><span id="l58.54" class="difflineminus">-  &lt;RDF:Seq about=&quot;NC:SearchCategoryRoot&quot;&gt;</span>
<a href="#l58.55"></a><span id="l58.55" class="difflineminus">-  	&lt;RDF:li&gt;</span>
<a href="#l58.56"></a><span id="l58.56" class="difflineminus">-  		&lt;RDF:Description about=&quot;urn:search:category:1&quot;&gt;</span>
<a href="#l58.57"></a><span id="l58.57" class="difflineminus">-			&lt;NC:title&gt;&amp;search.category.web;&lt;/NC:title&gt;</span>
<a href="#l58.58"></a><span id="l58.58" class="difflineminus">-  		&lt;/RDF:Description&gt;</span>
<a href="#l58.59"></a><span id="l58.59" class="difflineminus">-  	&lt;/RDF:li&gt;</span>
<a href="#l58.60"></a><span id="l58.60" class="difflineminus">-  &lt;/RDF:Seq&gt;</span>
<a href="#l58.61"></a><span id="l58.61" class="difflineminus">-</span>
<a href="#l58.62"></a><span id="l58.62" class="difflineminus">-</span>
<a href="#l58.63"></a><span id="l58.63" class="difflineminus">-&lt;!-- engines per category (Note that specific prefixes are required) --&gt;</span>
<a href="#l58.64"></a><span id="l58.64" class="difflineminus">-</span>
<a href="#l58.65"></a><span id="l58.65" class="difflineminus">-</span>
<a href="#l58.66"></a><span id="l58.66" class="difflineminus">-  &lt;RDF:Seq about=&quot;NC:SearchCategory?category=urn:search:category:1&quot;&gt;</span>
<a href="#l58.67"></a><span id="l58.67" class="difflineminus">-#include search.rdf.inc</span>
<a href="#l58.68"></a><span id="l58.68" class="difflineminus">-  &lt;/RDF:Seq&gt;</span>
<a href="#l58.69"></a><span id="l58.69" class="difflineminus">-</span>
<a href="#l58.70"></a><span id="l58.70" class="difflineminus">-&lt;/RDF:RDF&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/suite/locales/jar.mn</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/suite/locales/jar.mn</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -178,23 +178,17 @@</span>
<a href="#l59.4"></a><span id="l59.4">   locale/@AB_CD@/communicator/pref/pref-security.dtd                        (%chrome/common/pref/pref-security.dtd)</span>
<a href="#l59.5"></a><span id="l59.5">   locale/@AB_CD@/communicator/pref/pref-smartupdate.dtd                     (%chrome/common/pref/pref-smartupdate.dtd)</span>
<a href="#l59.6"></a><span id="l59.6">   locale/@AB_CD@/communicator/pref/pref-tabs.dtd                            (%chrome/common/pref/pref-tabs.dtd)</span>
<a href="#l59.7"></a><span id="l59.7">   locale/@AB_CD@/communicator-platform/mac/pref/platformPrefOverlay.dtd     (%chrome/common/pref/mac/platformPrefOverlay.dtd)</span>
<a href="#l59.8"></a><span id="l59.8">   locale/@AB_CD@/communicator-platform/unix/pref/platformPrefOverlay.dtd    (%chrome/common/pref/unix/platformPrefOverlay.dtd)</span>
<a href="#l59.9"></a><span id="l59.9">   locale/@AB_CD@/communicator-platform/win/pref/platformPrefOverlay.dtd     (%chrome/common/pref/win/platformPrefOverlay.dtd)</span>
<a href="#l59.10"></a><span id="l59.10">   locale/@AB_CD@/communicator/profile/profileSelection.dtd                  (%chrome/common/profile/profileSelection.dtd)</span>
<a href="#l59.11"></a><span id="l59.11">   locale/@AB_CD@/communicator/profile/profileSelection.properties           (%chrome/common/profile/profileSelection.properties)</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-  locale/@AB_CD@/communicator/search/default.htm                            (%chrome/common/search/default.htm)</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineminus">-  locale/@AB_CD@/communicator/search/internetresults.dtd                    (%chrome/common/search/internetresults.dtd)</span>
<a href="#l59.14"></a><span id="l59.14" class="difflineminus">-  locale/@AB_CD@/communicator/search/search-editor.dtd                      (%chrome/common/search/search-editor.dtd)</span>
<a href="#l59.15"></a><span id="l59.15" class="difflineminus">-  locale/@AB_CD@/communicator/search/search-editor.properties               (%chrome/common/search/search-editor.properties)</span>
<a href="#l59.16"></a><span id="l59.16">   locale/@AB_CD@/communicator/search/search-panel.dtd                       (%chrome/common/search/search-panel.dtd)</span>
<a href="#l59.17"></a><span id="l59.17" class="difflineminus">-  locale/@AB_CD@/communicator/search/search-panel.properties                (%chrome/common/search/search-panel.properties)</span>
<a href="#l59.18"></a><span id="l59.18" class="difflineminus">-  locale/@AB_CD@/communicator/search/search-rdf.dtd                         (%chrome/common/search/search-rdf.dtd)</span>
<a href="#l59.19"></a><span id="l59.19">   locale/@AB_CD@/communicator/sidebar/customize.dtd                         (%chrome/common/sidebar/customize.dtd)</span>
<a href="#l59.20"></a><span id="l59.20">   locale/@AB_CD@/communicator/sidebar/local-panels.dtd                      (%chrome/common/sidebar/local-panels.dtd)</span>
<a href="#l59.21"></a><span id="l59.21">   locale/@AB_CD@/communicator/sidebar/preview.dtd                           (%chrome/common/sidebar/preview.dtd)</span>
<a href="#l59.22"></a><span id="l59.22">   locale/@AB_CD@/communicator/sidebar/sidebar.properties                    (%chrome/common/sidebar/sidebar.properties)</span>
<a href="#l59.23"></a><span id="l59.23">   locale/@AB_CD@/communicator/sidebar/sidebarOverlay.dtd                    (%chrome/common/sidebar/sidebarOverlay.dtd)</span>
<a href="#l59.24"></a><span id="l59.24">   locale/@AB_CD@/communicator-platform/win/platformCommunicatorOverlay.dtd  (%chrome/common/win/platformCommunicatorOverlay.dtd)</span>
<a href="#l59.25"></a><span id="l59.25">   locale/@AB_CD@/communicator-platform/unix/platformCommunicatorOverlay.dtd (%chrome/common/unix/platformCommunicatorOverlay.dtd)</span>
<a href="#l59.26"></a><span id="l59.26">   locale/@AB_CD@/communicator-platform/mac/platformCommunicatorOverlay.dtd  (%chrome/common/mac/platformCommunicatorOverlay.dtd)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/suite/mailnews/mailWindowOverlay.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/suite/mailnews/mailWindowOverlay.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -1750,29 +1750,30 @@ function MsgOpenSelectedMessageInExistin</span>
<a href="#l60.4"></a><span id="l60.4">         return true;</span>
<a href="#l60.5"></a><span id="l60.5">     }</span>
<a href="#l60.6"></a><span id="l60.6">     catch (ex) {</span>
<a href="#l60.7"></a><span id="l60.7">         dump(&quot;reusing existing standalone message window failed: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l60.8"></a><span id="l60.8">     }</span>
<a href="#l60.9"></a><span id="l60.9">     return false;</span>
<a href="#l60.10"></a><span id="l60.10"> }</span>
<a href="#l60.11"></a><span id="l60.11"> </span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-function MsgOpenSearch(aSearchStr, aReverseBackgroundPref)</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+function MsgBrowserSearch(aSearchStr)</span>
<a href="#l60.14"></a><span id="l60.14"> {</span>
<a href="#l60.15"></a><span id="l60.15">   var topWindow = getTopWin();</span>
<a href="#l60.16"></a><span id="l60.16">   if (topWindow)</span>
<a href="#l60.17"></a><span id="l60.17">   {</span>
<a href="#l60.18"></a><span id="l60.18" class="difflineminus">-    topWindow.OpenSearch(&quot;internet&quot;, aSearchStr, true, aReverseBackgroundPref);</span>
<a href="#l60.19"></a><span id="l60.19" class="difflineplus">+    topWindow.BrowserSearch.loadSearch(aSearchStr, true);</span>
<a href="#l60.20"></a><span id="l60.20" class="difflineplus">+    topWindow.focus();</span>
<a href="#l60.21"></a><span id="l60.21">   }</span>
<a href="#l60.22"></a><span id="l60.22">   else</span>
<a href="#l60.23"></a><span id="l60.23">   {</span>
<a href="#l60.24"></a><span id="l60.24">     // open the requested window, but block it until it's fully loaded</span>
<a href="#l60.25"></a><span id="l60.25">     function NewSearchWindowLoaded()</span>
<a href="#l60.26"></a><span id="l60.26">     {</span>
<a href="#l60.27"></a><span id="l60.27" class="difflineminus">-      topWindow.setTimeout(topWindow.OpenSearch, 0, &quot;internet&quot;, aSearchStr, false, aReverseBackgroundPref);</span>
<a href="#l60.28"></a><span id="l60.28" class="difflineplus">+      topWindow.setTimeout(topWindow.BrowserSearch.loadSearch, 0, aSearchStr, false);</span>
<a href="#l60.29"></a><span id="l60.29">       // make sure that this handler is called only once</span>
<a href="#l60.30"></a><span id="l60.30">       topWindow.removeEventListener(&quot;load&quot;, NewSearchWindowLoaded, false);</span>
<a href="#l60.31"></a><span id="l60.31">     }</span>
<a href="#l60.32"></a><span id="l60.32">     // open a new window to load the search in and remember it until it's fully loaded</span>
<a href="#l60.33"></a><span id="l60.33">     topWindow = window.openDialog(getBrowserURL(), &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;);</span>
<a href="#l60.34"></a><span id="l60.34">     topWindow.addEventListener(&quot;load&quot;, NewSearchWindowLoaded, false);</span>
<a href="#l60.35"></a><span id="l60.35">   }</span>
<a href="#l60.36"></a><span id="l60.36"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/suite/mailnews/mailWindowOverlay.xul</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/suite/mailnews/mailWindowOverlay.xul</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -563,17 +563,17 @@</span>
<a href="#l61.4"></a><span id="l61.4">               label=&quot;&amp;selectAllCmd.label;&quot;</span>
<a href="#l61.5"></a><span id="l61.5">               accesskey=&quot;&amp;selectAllCmd.accesskey;&quot;</span>
<a href="#l61.6"></a><span id="l61.6">               command=&quot;cmd_selectAll&quot;/&gt;</span>
<a href="#l61.7"></a><span id="l61.7">     &lt;menuitem id=&quot;context-copy&quot;</span>
<a href="#l61.8"></a><span id="l61.8">               label=&quot;&amp;copyCmd.label;&quot;</span>
<a href="#l61.9"></a><span id="l61.9">               accesskey=&quot;&amp;copyCmd.accesskey;&quot;</span>
<a href="#l61.10"></a><span id="l61.10">               command=&quot;cmd_copy&quot;/&gt;</span>
<a href="#l61.11"></a><span id="l61.11">     &lt;menuitem id=&quot;context-searchselect&quot;</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-              oncommand=&quot;MsgOpenSearch(gContextMenu.searchSelected(), event.shiftKey);&quot;/&gt;</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+              oncommand=&quot;MsgBrowserSearch(gContextMenu.searchSelected());&quot;/&gt;</span>
<a href="#l61.14"></a><span id="l61.14">     &lt;menuitem id=&quot;mailContext-openNewWindow&quot;</span>
<a href="#l61.15"></a><span id="l61.15">               label=&quot;&amp;contextOpenNewWindow.label;&quot;</span>
<a href="#l61.16"></a><span id="l61.16">               accesskey=&quot;&amp;contextOpenNewWindow.accesskey;&quot;</span>
<a href="#l61.17"></a><span id="l61.17">               oncommand=&quot;MsgOpenNewWindowForMessage();&quot;/&gt;</span>
<a href="#l61.18"></a><span id="l61.18">     &lt;menuitem id=&quot;mailContext-openNewTab&quot;</span>
<a href="#l61.19"></a><span id="l61.19">               label=&quot;&amp;contextOpenNewTab.label;&quot;</span>
<a href="#l61.20"></a><span id="l61.20">               accesskey=&quot;&amp;contextOpenNewTab.accesskey;&quot;</span>
<a href="#l61.21"></a><span id="l61.21">               oncommand=&quot;MsgOpenNewTabForMessage();&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1">deleted file mode 100644</span>
<a href="#l62.2"></a><span id="l62.2">index bde266c9f8f4a3b299769869ce405d23aa85e23c..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l62.3"></a><span id="l62.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1">deleted file mode 100644</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineminus">--- a/suite/themes/classic/communicator/search/internetresults.css</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineplus">+++ /dev/null</span>
<a href="#l63.4"></a><span id="l63.4" class="difflineat">@@ -1,35 +0,0 @@</span>
<a href="#l63.5"></a><span id="l63.5" class="difflineminus">-@namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l63.6"></a><span id="l63.6" class="difflineminus">-</span>
<a href="#l63.7"></a><span id="l63.7" class="difflineminus">-#multi-results-header </span>
<a href="#l63.8"></a><span id="l63.8" class="difflineminus">-  {</span>
<a href="#l63.9"></a><span id="l63.9" class="difflineminus">-    background-color      : inactivecaption; </span>
<a href="#l63.10"></a><span id="l63.10" class="difflineminus">-    color                 : inactivecaptiontext;</span>
<a href="#l63.11"></a><span id="l63.11" class="difflineminus">-    border                : 1px outset inactivecaption;</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-    font-weight           : bold;</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineminus">-    padding-top           : 3px;</span>
<a href="#l63.14"></a><span id="l63.14" class="difflineminus">-    padding-bottom        : 2px;</span>
<a href="#l63.15"></a><span id="l63.15" class="difflineminus">-    -moz-padding-start    : 6px;</span>
<a href="#l63.16"></a><span id="l63.16" class="difflineminus">-    -moz-padding-end      : 0px;</span>
<a href="#l63.17"></a><span id="l63.17" class="difflineminus">-  }</span>
<a href="#l63.18"></a><span id="l63.18" class="difflineminus">-</span>
<a href="#l63.19"></a><span id="l63.19" class="difflineminus">-#engineTabs </span>
<a href="#l63.20"></a><span id="l63.20" class="difflineminus">-  {</span>
<a href="#l63.21"></a><span id="l63.21" class="difflineminus">-    padding               : 2px 0px 2px 0px;</span>
<a href="#l63.22"></a><span id="l63.22" class="difflineminus">-    background-color      : ThreeDFace;</span>
<a href="#l63.23"></a><span id="l63.23" class="difflineminus">-    border-left           : 1px solid ThreeDHighlight;</span>
<a href="#l63.24"></a><span id="l63.24" class="difflineminus">-    border-top            : 1px solid ThreeDHighlight;</span>
<a href="#l63.25"></a><span id="l63.25" class="difflineminus">-    border-right          : 1px solid ThreeDShadow;</span>
<a href="#l63.26"></a><span id="l63.26" class="difflineminus">-  }</span>
<a href="#l63.27"></a><span id="l63.27" class="difflineminus">-</span>
<a href="#l63.28"></a><span id="l63.28" class="difflineminus">-#internetresultstree</span>
<a href="#l63.29"></a><span id="l63.29" class="difflineminus">-  {</span>
<a href="#l63.30"></a><span id="l63.30" class="difflineminus">-    border-right          : none;</span>
<a href="#l63.31"></a><span id="l63.31" class="difflineminus">-    border-left           : none;</span>
<a href="#l63.32"></a><span id="l63.32" class="difflineminus">-    border-bottom         : none;</span>
<a href="#l63.33"></a><span id="l63.33" class="difflineminus">-  }  </span>
<a href="#l63.34"></a><span id="l63.34" class="difflineminus">-  </span>
<a href="#l63.35"></a><span id="l63.35" class="difflineminus">-#internetresultstree &gt; .tree-container-treerows</span>
<a href="#l63.36"></a><span id="l63.36" class="difflineminus">-  {</span>
<a href="#l63.37"></a><span id="l63.37" class="difflineminus">-    border-right          : none;</span>
<a href="#l63.38"></a><span id="l63.38" class="difflineminus">-    border-left           : none;</span>
<a href="#l63.39"></a><span id="l63.39" class="difflineminus">-  }  </span>
<a href="#l63.40"></a><span id="l63.40">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1">deleted file mode 100644</span>
<a href="#l64.2"></a><span id="l64.2">index cce7ebb38684b743517eace27726faa8704d7458..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l64.3"></a><span id="l64.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1">deleted file mode 100644</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineminus">--- a/suite/themes/classic/communicator/search/search-editor.css</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineplus">+++ /dev/null</span>
<a href="#l65.4"></a><span id="l65.4" class="difflineat">@@ -1,49 +0,0 @@</span>
<a href="#l65.5"></a><span id="l65.5" class="difflineminus">-/* -*- Mode: C; c-basic-offset: 2 -*- */</span>
<a href="#l65.6"></a><span id="l65.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l65.7"></a><span id="l65.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l65.8"></a><span id="l65.8" class="difflineminus">- *</span>
<a href="#l65.9"></a><span id="l65.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l65.10"></a><span id="l65.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l65.11"></a><span id="l65.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineminus">- *</span>
<a href="#l65.14"></a><span id="l65.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l65.15"></a><span id="l65.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l65.16"></a><span id="l65.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l65.17"></a><span id="l65.17" class="difflineminus">- * License.</span>
<a href="#l65.18"></a><span id="l65.18" class="difflineminus">- *</span>
<a href="#l65.19"></a><span id="l65.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l65.20"></a><span id="l65.20" class="difflineminus">- *</span>
<a href="#l65.21"></a><span id="l65.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l65.22"></a><span id="l65.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l65.23"></a><span id="l65.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l65.24"></a><span id="l65.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l65.25"></a><span id="l65.25" class="difflineminus">- *</span>
<a href="#l65.26"></a><span id="l65.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l65.27"></a><span id="l65.27" class="difflineminus">- *</span>
<a href="#l65.28"></a><span id="l65.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l65.29"></a><span id="l65.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l65.30"></a><span id="l65.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l65.31"></a><span id="l65.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l65.32"></a><span id="l65.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l65.33"></a><span id="l65.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l65.34"></a><span id="l65.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l65.35"></a><span id="l65.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l65.36"></a><span id="l65.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l65.37"></a><span id="l65.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l65.38"></a><span id="l65.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l65.39"></a><span id="l65.39" class="difflineminus">- *</span>
<a href="#l65.40"></a><span id="l65.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l65.41"></a><span id="l65.41" class="difflineminus">-</span>
<a href="#l65.42"></a><span id="l65.42" class="difflineminus">-@namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l65.43"></a><span id="l65.43" class="difflineminus">-</span>
<a href="#l65.44"></a><span id="l65.44" class="difflineminus">-</span>
<a href="#l65.45"></a><span id="l65.45" class="difflineminus">-#add-button</span>
<a href="#l65.46"></a><span id="l65.46" class="difflineminus">-  {</span>
<a href="#l65.47"></a><span id="l65.47" class="difflineminus">-    list-style-image      : url(&quot;chrome://global/skin/scroll-right.gif&quot;);</span>
<a href="#l65.48"></a><span id="l65.48" class="difflineminus">-  }</span>
<a href="#l65.49"></a><span id="l65.49" class="difflineminus">-  </span>
<a href="#l65.50"></a><span id="l65.50" class="difflineminus">-#remove-button</span>
<a href="#l65.51"></a><span id="l65.51" class="difflineminus">-  {</span>
<a href="#l65.52"></a><span id="l65.52" class="difflineminus">-    list-style-image      : url(&quot;chrome://global/skin/scroll-left.gif&quot;);</span>
<a href="#l65.53"></a><span id="l65.53" class="difflineminus">-  }</span>
<a href="#l65.54"></a><span id="l65.54">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/suite/themes/classic/communicator/search/search.css</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/suite/themes/classic/communicator/search/search.css</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -6,46 +6,36 @@</span>
<a href="#l66.4"></a><span id="l66.4">  * the License. You may obtain a copy of the License at</span>
<a href="#l66.5"></a><span id="l66.5">  * http://www.mozilla.org/MPL/</span>
<a href="#l66.6"></a><span id="l66.6">  *</span>
<a href="#l66.7"></a><span id="l66.7">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l66.8"></a><span id="l66.8">  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l66.9"></a><span id="l66.9">  * for the specific language governing rights and limitations under the</span>
<a href="#l66.10"></a><span id="l66.10">  * License.</span>
<a href="#l66.11"></a><span id="l66.11">  *</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+ * The Original Code is SeaMonkey search panel.</span>
<a href="#l66.14"></a><span id="l66.14">  *</span>
<a href="#l66.15"></a><span id="l66.15">  * The Initial Developer of the Original Code is</span>
<a href="#l66.16"></a><span id="l66.16" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l66.17"></a><span id="l66.17" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l66.18"></a><span id="l66.18" class="difflineplus">+ * the Mozilla Foundation.</span>
<a href="#l66.19"></a><span id="l66.19" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2010</span>
<a href="#l66.20"></a><span id="l66.20">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l66.21"></a><span id="l66.21">  *</span>
<a href="#l66.22"></a><span id="l66.22">  * Contributor(s):</span>
<a href="#l66.23"></a><span id="l66.23" class="difflineminus">- *   Joe Hewitt &lt;hewitt@netscape.com&gt;</span>
<a href="#l66.24"></a><span id="l66.24">  *</span>
<a href="#l66.25"></a><span id="l66.25">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l66.26"></a><span id="l66.26">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l66.27"></a><span id="l66.27">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l66.28"></a><span id="l66.28">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l66.29"></a><span id="l66.29">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l66.30"></a><span id="l66.30">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l66.31"></a><span id="l66.31">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l66.32"></a><span id="l66.32">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l66.33"></a><span id="l66.33">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l66.34"></a><span id="l66.34">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l66.35"></a><span id="l66.35">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l66.36"></a><span id="l66.36">  *</span>
<a href="#l66.37"></a><span id="l66.37">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l66.38"></a><span id="l66.38"> </span>
<a href="#l66.39"></a><span id="l66.39"> /* ===== search.css =====================================================</span>
<a href="#l66.40"></a><span id="l66.40" class="difflineminus">-  == Styles specific to the Search sidebar panel.</span>
<a href="#l66.41"></a><span id="l66.41" class="difflineminus">-  ======================================================================= */</span>
<a href="#l66.42"></a><span id="l66.42" class="difflineplus">+   == Styles specific to the Search sidebar panel.</span>
<a href="#l66.43"></a><span id="l66.43" class="difflineplus">+   ====================================================================== */</span>
<a href="#l66.44"></a><span id="l66.44"> </span>
<a href="#l66.45"></a><span id="l66.45"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l66.46"></a><span id="l66.46" class="difflineminus">-</span>
<a href="#l66.47"></a><span id="l66.47" class="difflineminus">-/* :::: undo regular search listbox selection look :::: */</span>
<a href="#l66.48"></a><span id="l66.48" class="difflineminus">-</span>
<a href="#l66.49"></a><span id="l66.49" class="difflineminus">-.searchresult-item[selected=&quot;true&quot;] {</span>
<a href="#l66.50"></a><span id="l66.50" class="difflineminus">-  border: none !important;</span>
<a href="#l66.51"></a><span id="l66.51" class="difflineminus">-  background-color: transparent !important;</span>
<a href="#l66.52"></a><span id="l66.52" class="difflineminus">-  color: inherit !important;</span>
<a href="#l66.53"></a><span id="l66.53" class="difflineminus">-}</span>
<a href="#l66.54"></a><span id="l66.54" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/suite/themes/classic/jar.mn</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/suite/themes/classic/jar.mn</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -96,21 +96,17 @@ classic.jar:</span>
<a href="#l67.4"></a><span id="l67.4">   skin/classic/communicator/directory/folder-open.gif                   (communicator/directory/folder-open.gif)</span>
<a href="#l67.5"></a><span id="l67.5">   skin/classic/communicator/directory/file.gif                          (communicator/directory/file.gif)</span>
<a href="#l67.6"></a><span id="l67.6">   skin/classic/communicator/downloads/dl-remove.png                     (communicator/downloads/dl-remove.png)</span>
<a href="#l67.7"></a><span id="l67.7">   skin/classic/communicator/history/calendar.png                        (communicator/history/calendar.png)</span>
<a href="#l67.8"></a><span id="l67.8">   skin/classic/communicator/profile/migrate.gif                         (communicator/profile/migrate.gif)</span>
<a href="#l67.9"></a><span id="l67.9">   skin/classic/communicator/profile/profile.css                         (communicator/profile/profile.css)</span>
<a href="#l67.10"></a><span id="l67.10">   skin/classic/communicator/profile/profileManager.css                  (communicator/profile/profileManager.css)</span>
<a href="#l67.11"></a><span id="l67.11">   skin/classic/communicator/profile/profileicon-large.gif               (communicator/profile/profileicon-large.gif)</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-  skin/classic/communicator/search/category.gif                         (communicator/search/category.gif)</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineminus">-  skin/classic/communicator/search/result.gif                           (communicator/search/result.gif)</span>
<a href="#l67.14"></a><span id="l67.14" class="difflineminus">-  skin/classic/communicator/search/search-editor.css                    (communicator/search/search-editor.css)</span>
<a href="#l67.15"></a><span id="l67.15">   skin/classic/communicator/search/search.css                           (communicator/search/search.css)</span>
<a href="#l67.16"></a><span id="l67.16" class="difflineminus">-  skin/classic/communicator/search/internetresults.css                  (communicator/search/internetresults.css)</span>
<a href="#l67.17"></a><span id="l67.17">   skin/classic/communicator/sidebar/sbtab-twisty.gif                    (communicator/sidebar/sbtab-twisty.gif)</span>
<a href="#l67.18"></a><span id="l67.18">   skin/classic/communicator/sidebar/sbtab-twisty-open.gif               (communicator/sidebar/sbtab-twisty-open.gif)</span>
<a href="#l67.19"></a><span id="l67.19">   skin/classic/communicator/sidebar/customize.css                       (communicator/sidebar/customize.css)</span>
<a href="#l67.20"></a><span id="l67.20">   skin/classic/communicator/sidebar/preview.css                         (communicator/sidebar/preview.css)</span>
<a href="#l67.21"></a><span id="l67.21">   skin/classic/communicator/sidebar/sidebarBindings.xml                 (communicator/sidebar/sidebarBindings.xml)</span>
<a href="#l67.22"></a><span id="l67.22">   skin/classic/communicator/sidebar/sidebarListView.css                 (communicator/sidebar/sidebarListView.css)</span>
<a href="#l67.23"></a><span id="l67.23">   skin/classic/communicator/xpinstall/xpinstall.css                     (communicator/xpinstall/xpinstall.css)</span>
<a href="#l67.24"></a><span id="l67.24">   skin/classic/communicator/icons/audioFeedIcon.png                     (communicator/icons/feedIcon.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1">deleted file mode 100755</span>
<a href="#l68.2"></a><span id="l68.2">index bae4c3a9ac5f887e12f8fd9e788a32ccdb493e82..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l68.3"></a><span id="l68.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1">deleted file mode 100755</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineminus">--- a/suite/themes/modern/communicator/search/internetresults.css</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineplus">+++ /dev/null</span>
<a href="#l69.4"></a><span id="l69.4" class="difflineat">@@ -1,56 +0,0 @@</span>
<a href="#l69.5"></a><span id="l69.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l69.6"></a><span id="l69.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l69.7"></a><span id="l69.7" class="difflineminus">- *</span>
<a href="#l69.8"></a><span id="l69.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l69.9"></a><span id="l69.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l69.10"></a><span id="l69.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l69.11"></a><span id="l69.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">- *</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l69.14"></a><span id="l69.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l69.15"></a><span id="l69.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l69.16"></a><span id="l69.16" class="difflineminus">- * License.</span>
<a href="#l69.17"></a><span id="l69.17" class="difflineminus">- *</span>
<a href="#l69.18"></a><span id="l69.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l69.19"></a><span id="l69.19" class="difflineminus">- *</span>
<a href="#l69.20"></a><span id="l69.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l69.21"></a><span id="l69.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l69.22"></a><span id="l69.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l69.23"></a><span id="l69.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l69.24"></a><span id="l69.24" class="difflineminus">- *</span>
<a href="#l69.25"></a><span id="l69.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l69.26"></a><span id="l69.26" class="difflineminus">- *   Joe Hewitt &lt;hewitt@netscape.com&gt;</span>
<a href="#l69.27"></a><span id="l69.27" class="difflineminus">- *</span>
<a href="#l69.28"></a><span id="l69.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l69.29"></a><span id="l69.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l69.30"></a><span id="l69.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l69.31"></a><span id="l69.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l69.32"></a><span id="l69.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l69.33"></a><span id="l69.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l69.34"></a><span id="l69.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l69.35"></a><span id="l69.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l69.36"></a><span id="l69.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l69.37"></a><span id="l69.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l69.38"></a><span id="l69.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l69.39"></a><span id="l69.39" class="difflineminus">- *</span>
<a href="#l69.40"></a><span id="l69.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l69.41"></a><span id="l69.41" class="difflineminus">-</span>
<a href="#l69.42"></a><span id="l69.42" class="difflineminus">-/* ===== internetresults.css ============================================</span>
<a href="#l69.43"></a><span id="l69.43" class="difflineminus">-  == Styles specific to the Internet Search results pane.</span>
<a href="#l69.44"></a><span id="l69.44" class="difflineminus">-  ======================================================================= */</span>
<a href="#l69.45"></a><span id="l69.45" class="difflineminus">-</span>
<a href="#l69.46"></a><span id="l69.46" class="difflineminus">-@namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l69.47"></a><span id="l69.47" class="difflineminus">-</span>
<a href="#l69.48"></a><span id="l69.48" class="difflineminus">-#multi-results-header {</span>
<a href="#l69.49"></a><span id="l69.49" class="difflineminus">-  border-bottom: 1px outset #587B98;</span>
<a href="#l69.50"></a><span id="l69.50" class="difflineminus">-  padding: 5px 6px;</span>
<a href="#l69.51"></a><span id="l69.51" class="difflineminus">-  background-color: #587B98;</span>
<a href="#l69.52"></a><span id="l69.52" class="difflineminus">-  color: #ffffff;; </span>
<a href="#l69.53"></a><span id="l69.53" class="difflineminus">-  font-weight: bold;</span>
<a href="#l69.54"></a><span id="l69.54" class="difflineminus">-}</span>
<a href="#l69.55"></a><span id="l69.55" class="difflineminus">-</span>
<a href="#l69.56"></a><span id="l69.56" class="difflineminus">-#engineTabs {</span>
<a href="#l69.57"></a><span id="l69.57" class="difflineminus">-  border-bottom: 1px outset #D7D9E0;</span>
<a href="#l69.58"></a><span id="l69.58" class="difflineminus">-  padding: 2px 3px;</span>
<a href="#l69.59"></a><span id="l69.59" class="difflineminus">-}</span>
<a href="#l69.60"></a><span id="l69.60" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1">deleted file mode 100755</span>
<a href="#l70.2"></a><span id="l70.2">index c439f54873d3406d5ec3f190935d4cba581911e7..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l70.3"></a><span id="l70.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1">deleted file mode 100755</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineminus">--- a/suite/themes/modern/communicator/search/search-editor.css</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineplus">+++ /dev/null</span>
<a href="#l71.4"></a><span id="l71.4" class="difflineat">@@ -1,43 +0,0 @@</span>
<a href="#l71.5"></a><span id="l71.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l71.6"></a><span id="l71.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l71.7"></a><span id="l71.7" class="difflineminus">- *</span>
<a href="#l71.8"></a><span id="l71.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l71.9"></a><span id="l71.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l71.10"></a><span id="l71.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l71.11"></a><span id="l71.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">- *</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l71.14"></a><span id="l71.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l71.15"></a><span id="l71.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l71.16"></a><span id="l71.16" class="difflineminus">- * License.</span>
<a href="#l71.17"></a><span id="l71.17" class="difflineminus">- *</span>
<a href="#l71.18"></a><span id="l71.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l71.19"></a><span id="l71.19" class="difflineminus">- *</span>
<a href="#l71.20"></a><span id="l71.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l71.21"></a><span id="l71.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l71.22"></a><span id="l71.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l71.23"></a><span id="l71.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l71.24"></a><span id="l71.24" class="difflineminus">- *</span>
<a href="#l71.25"></a><span id="l71.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l71.26"></a><span id="l71.26" class="difflineminus">- *   Joe Hewitt &lt;hewitt@netscape.com&gt;</span>
<a href="#l71.27"></a><span id="l71.27" class="difflineminus">- *</span>
<a href="#l71.28"></a><span id="l71.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l71.29"></a><span id="l71.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l71.30"></a><span id="l71.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l71.31"></a><span id="l71.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l71.32"></a><span id="l71.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l71.33"></a><span id="l71.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l71.34"></a><span id="l71.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l71.35"></a><span id="l71.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l71.36"></a><span id="l71.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l71.37"></a><span id="l71.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l71.38"></a><span id="l71.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l71.39"></a><span id="l71.39" class="difflineminus">- *</span>
<a href="#l71.40"></a><span id="l71.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l71.41"></a><span id="l71.41" class="difflineminus">-</span>
<a href="#l71.42"></a><span id="l71.42" class="difflineminus">-/* ===== search-editor.css ==============================================</span>
<a href="#l71.43"></a><span id="l71.43" class="difflineminus">-  == Styles specific to the Search Editor dialog.</span>
<a href="#l71.44"></a><span id="l71.44" class="difflineminus">-  ======================================================================= */</span>
<a href="#l71.45"></a><span id="l71.45" class="difflineminus">-</span>
<a href="#l71.46"></a><span id="l71.46" class="difflineminus">-@namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l71.47"></a><span id="l71.47" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/suite/themes/modern/communicator/search/search.css</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/suite/themes/modern/communicator/search/search.css</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -6,46 +6,36 @@</span>
<a href="#l72.4"></a><span id="l72.4">  * the License. You may obtain a copy of the License at</span>
<a href="#l72.5"></a><span id="l72.5">  * http://www.mozilla.org/MPL/</span>
<a href="#l72.6"></a><span id="l72.6">  *</span>
<a href="#l72.7"></a><span id="l72.7">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l72.8"></a><span id="l72.8">  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l72.9"></a><span id="l72.9">  * for the specific language governing rights and limitations under the</span>
<a href="#l72.10"></a><span id="l72.10">  * License.</span>
<a href="#l72.11"></a><span id="l72.11">  *</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+ * The Original Code is SeaMonkey search panel.</span>
<a href="#l72.14"></a><span id="l72.14">  *</span>
<a href="#l72.15"></a><span id="l72.15">  * The Initial Developer of the Original Code is</span>
<a href="#l72.16"></a><span id="l72.16" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l72.17"></a><span id="l72.17" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l72.18"></a><span id="l72.18" class="difflineplus">+ * the Mozilla Foundation.</span>
<a href="#l72.19"></a><span id="l72.19" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2010</span>
<a href="#l72.20"></a><span id="l72.20">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l72.21"></a><span id="l72.21">  *</span>
<a href="#l72.22"></a><span id="l72.22">  * Contributor(s):</span>
<a href="#l72.23"></a><span id="l72.23" class="difflineminus">- *   Joe Hewitt &lt;hewitt@netscape.com&gt;</span>
<a href="#l72.24"></a><span id="l72.24">  *</span>
<a href="#l72.25"></a><span id="l72.25">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l72.26"></a><span id="l72.26">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l72.27"></a><span id="l72.27">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l72.28"></a><span id="l72.28">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l72.29"></a><span id="l72.29">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l72.30"></a><span id="l72.30">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l72.31"></a><span id="l72.31">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l72.32"></a><span id="l72.32">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l72.33"></a><span id="l72.33">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l72.34"></a><span id="l72.34">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l72.35"></a><span id="l72.35">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l72.36"></a><span id="l72.36">  *</span>
<a href="#l72.37"></a><span id="l72.37">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l72.38"></a><span id="l72.38"> </span>
<a href="#l72.39"></a><span id="l72.39"> /* ===== search.css =====================================================</span>
<a href="#l72.40"></a><span id="l72.40" class="difflineminus">-  == Styles specific to the Search sidebar panel.</span>
<a href="#l72.41"></a><span id="l72.41" class="difflineminus">-  ======================================================================= */</span>
<a href="#l72.42"></a><span id="l72.42" class="difflineplus">+   == Styles specific to the Search sidebar panel.</span>
<a href="#l72.43"></a><span id="l72.43" class="difflineplus">+   ====================================================================== */</span>
<a href="#l72.44"></a><span id="l72.44"> </span>
<a href="#l72.45"></a><span id="l72.45"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l72.46"></a><span id="l72.46" class="difflineminus">-</span>
<a href="#l72.47"></a><span id="l72.47" class="difflineminus">-/* :::: undo regular search listbox selection look :::: */</span>
<a href="#l72.48"></a><span id="l72.48" class="difflineminus">-</span>
<a href="#l72.49"></a><span id="l72.49" class="difflineminus">-.searchresult-item[selected=&quot;true&quot;] {</span>
<a href="#l72.50"></a><span id="l72.50" class="difflineminus">-  border: none !important;</span>
<a href="#l72.51"></a><span id="l72.51" class="difflineminus">-  background-color: transparent !important;</span>
<a href="#l72.52"></a><span id="l72.52" class="difflineminus">-  color: inherit !important;</span>
<a href="#l72.53"></a><span id="l72.53" class="difflineminus">-}</span>
<a href="#l72.54"></a><span id="l72.54" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/suite/themes/modern/jar.mn</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/suite/themes/modern/jar.mn</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -94,20 +94,16 @@ modern.jar:</span>
<a href="#l73.4"></a><span id="l73.4">   skin/modern/communicator/icons/smileys/smiley-foot.png           (communicator/icons/smileys/smiley-foot.png)</span>
<a href="#l73.5"></a><span id="l73.5">   skin/modern/communicator/icons/smileys/smiley-innocent.png       (communicator/icons/smileys/smiley-innocent.png)</span>
<a href="#l73.6"></a><span id="l73.6">   skin/modern/communicator/icons/smileys/smiley-cry.png            (communicator/icons/smileys/smiley-cry.png)</span>
<a href="#l73.7"></a><span id="l73.7">   skin/modern/communicator/icons/smileys/smiley-sealed.png         (communicator/icons/smileys/smiley-sealed.png)</span>
<a href="#l73.8"></a><span id="l73.8">   skin/modern/communicator/icons/videoFeedIcon.png                 (communicator/icons/feedIcon.png)</span>
<a href="#l73.9"></a><span id="l73.9">   skin/modern/communicator/profile/migrate.gif                     (communicator/profile/migrate.gif)</span>
<a href="#l73.10"></a><span id="l73.10">   skin/modern/communicator/profile/profile.gif                     (communicator/profile/profile.gif)</span>
<a href="#l73.11"></a><span id="l73.11">   skin/modern/communicator/profile/profile.css                     (communicator/profile/profile.css)</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-  skin/modern/communicator/search/category.gif                     (communicator/search/category.gif)</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineminus">-  skin/modern/communicator/search/result.gif                       (communicator/search/result.gif)</span>
<a href="#l73.14"></a><span id="l73.14" class="difflineminus">-  skin/modern/communicator/search/internetresults.css              (communicator/search/internetresults.css)</span>
<a href="#l73.15"></a><span id="l73.15" class="difflineminus">-  skin/modern/communicator/search/search-editor.css                (communicator/search/search-editor.css)</span>
<a href="#l73.16"></a><span id="l73.16">   skin/modern/communicator/search/search.css                       (communicator/search/search.css)</span>
<a href="#l73.17"></a><span id="l73.17">   skin/modern/communicator/sidebar/sidebarBindings.xml             (communicator/sidebar/sidebarBindings.xml)</span>
<a href="#l73.18"></a><span id="l73.18">   skin/modern/communicator/sidebar/sbar-top.gif                    (communicator/sidebar/sbar-top.gif)</span>
<a href="#l73.19"></a><span id="l73.19">   skin/modern/communicator/sidebar/sbar-top-tabopen.gif            (communicator/sidebar/sbar-top-tabopen.gif)</span>
<a href="#l73.20"></a><span id="l73.20">   skin/modern/communicator/sidebar/sbtab-rit-top-act.gif           (communicator/sidebar/sbtab-rit-top-act.gif)</span>
<a href="#l73.21"></a><span id="l73.21">   skin/modern/communicator/sidebar/sbtab-rit-btm-act.gif           (communicator/sidebar/sbtab-rit-btm-act.gif)</span>
<a href="#l73.22"></a><span id="l73.22">   skin/modern/communicator/sidebar/sbtab-rit-top.gif               (communicator/sidebar/sbtab-rit-top.gif)</span>
<a href="#l73.23"></a><span id="l73.23">   skin/modern/communicator/sidebar/sbtab-mid.gif                   (communicator/sidebar/sbtab-mid.gif)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

