<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29053:1ea5b27c62450fe8bd6048e0df3440f19c3e208d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 1ea5b27c62450fe8bd6048e0df3440f19c3e208d" />
<meta property="og:url" content="/comm-central/rev/1ea5b27c62450fe8bd6048e0df3440f19c3e208d" />
<meta property="og:description" content="Bug 1608765 - Remove duplication of tests for recurrence. r=pmorris" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 1ea5b27c62450fe8bd6048e0df3440f19c3e208d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/1ea5b27c62450fe8bd6048e0df3440f19c3e208d">shortlog</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/1ea5b27c62450fe8bd6048e0df3440f19c3e208d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d">files</a> |
changeset |
<a href="/comm-central/raw-rev/1ea5b27c62450fe8bd6048e0df3440f19c3e208d">raw</a>  | <a href="/comm-central/archive/1ea5b27c62450fe8bd6048e0df3440f19c3e208d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1608765">Bug 1608765</a> - Remove duplication of tests for recurrence. r=pmorris
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 21 Feb 2020 21:44:32 +1300</td></tr>

<tr>
 <td>changeset 29053</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/1ea5b27c62450fe8bd6048e0df3440f19c3e208d">1ea5b27c62450fe8bd6048e0df3440f19c3e208d</a></td>
</tr>



<tr>
<td>parent 29052</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a9db14ef83805e0d7b601fc6ef4b5153b4becd11">a9db14ef83805e0d7b601fc6ef4b5153b4becd11</a>
</td>
</tr>

<tr>
<td>child 29054</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/13584f9e025c50294e64b29482d941e6ac8207af">13584f9e025c50294e64b29482d941e6ac8207af</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=1ea5b27c62450fe8bd6048e0df3440f19c3e208d">17178</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Tue, 24 Mar 2020 04:17:34 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@1ea5b27c6245 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1ea5b27c62450fe8bd6048e0df3440f19c3e208d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1ea5b27c62450fe8bd6048e0df3440f19c3e208d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1ea5b27c62450fe8bd6048e0df3440f19c3e208d&newProject=comm-central&newRevision=a9db14ef83805e0d7b601fc6ef4b5153b4becd11&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1ea5b27c62450fe8bd6048e0df3440f19c3e208d&newProject=comm-central&newRevision=a9db14ef83805e0d7b601fc6ef4b5153b4becd11&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1ea5b27c62450fe8bd6048e0df3440f19c3e208d&newProject=comm-central&newRevision=a9db14ef83805e0d7b601fc6ef4b5153b4becd11&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28pmorris%29&revcount=50">pmorris</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1608765">1608765</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1608765">Bug 1608765</a> - Remove duplication of tests for recurrence. r=pmorris

Instead, run the same tests twice with different settings.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser.ini">calendar/test/browser/recurrence/browser.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser.ini">file</a> |
<a href="/comm-central/annotate/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser.ini">annotate</a> |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser.ini">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser.ini">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser.ini">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_annual.js">calendar/test/browser/recurrence/browser_annual.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_annual.js">file</a> |
<a href="/comm-central/annotate/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_annual.js">annotate</a> |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_annual.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_annual.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_annual.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_biweekly.js">calendar/test/browser/recurrence/browser_biweekly.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_biweekly.js">file</a> |
<a href="/comm-central/annotate/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_biweekly.js">annotate</a> |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_biweekly.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_biweekly.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_biweekly.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_daily.js">calendar/test/browser/recurrence/browser_daily.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_daily.js">file</a> |
<a href="/comm-central/annotate/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_daily.js">annotate</a> |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_daily.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_daily.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_daily.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">calendar/test/browser/recurrence/browser_lastDayOfMonth.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">file</a> |
<a href="/comm-central/annotate/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">annotate</a> |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_rotated.ini">calendar/test/browser/recurrence/browser_rotated.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_rotated.ini">file</a> |
<a href="/comm-central/annotate/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_rotated.ini">annotate</a> |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_rotated.ini">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_rotated.ini">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_rotated.ini">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyN.js">calendar/test/browser/recurrence/browser_weeklyN.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyN.js">file</a> |
<a href="/comm-central/annotate/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyN.js">annotate</a> |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyN.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyN.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyN.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyUntil.js">calendar/test/browser/recurrence/browser_weeklyUntil.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyUntil.js">file</a> |
<a href="/comm-central/annotate/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyUntil.js">annotate</a> |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyUntil.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyUntil.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyUntil.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyWithException.js">calendar/test/browser/recurrence/browser_weeklyWithException.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyWithException.js">file</a> |
<a href="/comm-central/annotate/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyWithException.js">annotate</a> |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyWithException.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyWithException.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/browser_weeklyWithException.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/head.js">calendar/test/browser/recurrence/head.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/head.js">file</a> |
<a href="/comm-central/annotate/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/head.js">annotate</a> |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/head.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/head.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrence/head.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser.ini">calendar/test/browser/recurrenceRotated/browser.ini</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser.ini">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser.ini">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser.ini">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_annual.js">calendar/test/browser/recurrenceRotated/browser_annual.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_annual.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_annual.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_annual.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_biweekly.js">calendar/test/browser/recurrenceRotated/browser_biweekly.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_biweekly.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_biweekly.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_biweekly.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_daily.js">calendar/test/browser/recurrenceRotated/browser_daily.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_daily.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_daily.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_daily.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js">calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyN.js">calendar/test/browser/recurrenceRotated/browser_weeklyN.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyN.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyN.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyN.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js">calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js">calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/moz.build">calendar/test/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/moz.build">file</a> |
<a href="/comm-central/annotate/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/moz.build">annotate</a> |
<a href="/comm-central/diff/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/moz.build">diff</a> |
<a href="/comm-central/comparison/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/moz.build">comparison</a> |
<a href="/comm-central/log/1ea5b27c62450fe8bd6048e0df3440f19c3e208d/calendar/test/moz.build">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser.ini</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser.ini</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,18 +1,19 @@</span>
<a href="#l1.4"></a><span id="l1.4"> [default]</span>
<a href="#l1.5"></a><span id="l1.5" class="difflineminus">-head = ../head.js</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineplus">+dupe-manifest =</span>
<a href="#l1.7"></a><span id="l1.7"> prefs =</span>
<a href="#l1.8"></a><span id="l1.8">   extensions.installDistroAddons=true</span>
<a href="#l1.9"></a><span id="l1.9">   mail.provider.suppress_dialog_on_startup=true</span>
<a href="#l1.10"></a><span id="l1.10">   mail.spotlight.firstRunDone=true</span>
<a href="#l1.11"></a><span id="l1.11">   mail.winsearch.firstRunDone=true</span>
<a href="#l1.12"></a><span id="l1.12">   mailnews.start_page.override_url=about:blank</span>
<a href="#l1.13"></a><span id="l1.13">   mailnews.start_page.url=about:blank</span>
<a href="#l1.14"></a><span id="l1.14"> subsuite = thunderbird</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+tags = recurrence</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> [browser_annual.js]</span>
<a href="#l1.18"></a><span id="l1.18"> [browser_biweekly.js]</span>
<a href="#l1.19"></a><span id="l1.19"> [browser_daily.js]</span>
<a href="#l1.20"></a><span id="l1.20"> [browser_lastDayOfMonth.js]</span>
<a href="#l1.21"></a><span id="l1.21"> [browser_weeklyN.js]</span>
<a href="#l1.22"></a><span id="l1.22"> [browser_weeklyUntil.js]</span>
<a href="#l1.23"></a><span id="l1.23"> [browser_weeklyWithException.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_annual.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_annual.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -28,17 +28,17 @@ const EPOCH = 1970;</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> add_task(async function testAnnualRecurrence() {</span>
<a href="#l2.6"></a><span id="l2.6">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l2.7"></a><span id="l2.7">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l2.8"></a><span id="l2.8">   goToDate(controller, STARTYEAR, 1, 1);</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10">   // Create yearly recurring all-day event.</span>
<a href="#l2.11"></a><span id="l2.11">   let eventBox = lookupEventBox(&quot;day&quot;, ALLDAY, null, 1, null);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  await invokeEventDialog(controller, eventBox, event =&gt; {</span>
<a href="#l2.14"></a><span id="l2.14">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;yearly&quot;, event);</span>
<a href="#l2.17"></a><span id="l2.17">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l2.18"></a><span id="l2.18">   });</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20">   let checkYears = [STARTYEAR, STARTYEAR + 1, EPOCH - 1, EPOCH, EPOCH + 1];</span>
<a href="#l2.21"></a><span id="l2.21">   for (let year of checkYears) {</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -59,23 +59,23 @@ add_task(async function testAnnualRecurr</span>
<a href="#l2.23"></a><span id="l2.23">     controller.waitForElement(lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, 1, column, null, EVENTPATH));</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25">     // month view</span>
<a href="#l2.26"></a><span id="l2.26">     switchToView(controller, &quot;month&quot;);</span>
<a href="#l2.27"></a><span id="l2.27">     controller.waitForElement(lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, column, null, EVENTPATH));</span>
<a href="#l2.28"></a><span id="l2.28">   }</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30">   // Delete event.</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+  goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l2.32"></a><span id="l2.32">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-  goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l2.34"></a><span id="l2.34">   const boxPath = getEventBoxPath(&quot;day&quot;, ALLDAY, null, 1, null) + EVENTPATH;</span>
<a href="#l2.35"></a><span id="l2.35">   const box = lookup(boxPath);</span>
<a href="#l2.36"></a><span id="l2.36">   controller.click(box);</span>
<a href="#l2.37"></a><span id="l2.37">   handleOccurrencePrompt(controller, box, &quot;delete&quot;, true);</span>
<a href="#l2.38"></a><span id="l2.38">   controller.waitForElementNotPresent(box);</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40">   Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l2.41"></a><span id="l2.41"> });</span>
<a href="#l2.42"></a><span id="l2.42"> </span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+registerCleanupFunction(function teardownModule() {</span>
<a href="#l2.45"></a><span id="l2.45">   deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l2.46"></a><span id="l2.46">   closeAllEventDialogs();</span>
<a href="#l2.47"></a><span id="l2.47"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_biweekly.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_biweekly.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -28,24 +28,25 @@ const HOUR = 8;</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> add_task(async function testBiweeklyRecurrence() {</span>
<a href="#l3.6"></a><span id="l3.6">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l3.7"></a><span id="l3.7">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l3.8"></a><span id="l3.8">   goToDate(controller, 2009, 1, 31);</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">   // Create biweekly event.</span>
<a href="#l3.11"></a><span id="l3.11">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  await invokeEventDialog(controller, eventBox, event =&gt; {</span>
<a href="#l3.14"></a><span id="l3.14">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;bi.weekly&quot;, event);</span>
<a href="#l3.17"></a><span id="l3.17">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l3.18"></a><span id="l3.18">   });</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">   // Check day view.</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+  switchToView(controller, &quot;day&quot;);</span>
<a href="#l3.22"></a><span id="l3.22">   for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l3.23"></a><span id="l3.23">     controller.waitForElement(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH));</span>
<a href="#l3.24"></a><span id="l3.24">     viewForward(controller, 14);</span>
<a href="#l3.25"></a><span id="l3.25">   }</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27">   // Check week view.</span>
<a href="#l3.28"></a><span id="l3.28">   switchToView(controller, &quot;week&quot;);</span>
<a href="#l3.29"></a><span id="l3.29">   goToDate(controller, 2009, 1, 31);</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineat">@@ -89,12 +90,12 @@ add_task(async function testBiweeklyRecu</span>
<a href="#l3.31"></a><span id="l3.31">   let box = lookupEventBox(&quot;month&quot;, CANVAS_BOX, 4, 7, null, EVENTPATH);</span>
<a href="#l3.32"></a><span id="l3.32">   controller.click(box);</span>
<a href="#l3.33"></a><span id="l3.33">   handleOccurrencePrompt(controller, box, &quot;delete&quot;, true);</span>
<a href="#l3.34"></a><span id="l3.34">   controller.waitForElementNotPresent(box);</span>
<a href="#l3.35"></a><span id="l3.35"> </span>
<a href="#l3.36"></a><span id="l3.36">   Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l3.37"></a><span id="l3.37"> });</span>
<a href="#l3.38"></a><span id="l3.38"> </span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+registerCleanupFunction(function teardownModule() {</span>
<a href="#l3.41"></a><span id="l3.41">   deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l3.42"></a><span id="l3.42">   closeAllEventDialogs();</span>
<a href="#l3.43"></a><span id="l3.43"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_daily.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_daily.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -75,17 +75,16 @@ add_task(async function testDailyRecurre</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">   for (let week = 2; week &lt;= 4; week++) {</span>
<a href="#l4.6"></a><span id="l4.6">     for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l4.7"></a><span id="l4.7">       controller.waitForElement(</span>
<a href="#l4.8"></a><span id="l4.8">         lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, week, day, null, EVENTPATH)</span>
<a href="#l4.9"></a><span id="l4.9">       );</span>
<a href="#l4.10"></a><span id="l4.10">     }</span>
<a href="#l4.11"></a><span id="l4.11">   }</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-</span>
<a href="#l4.13"></a><span id="l4.13">   // Check month view for all 5 weeks.</span>
<a href="#l4.14"></a><span id="l4.14">   switchToView(controller, &quot;month&quot;);</span>
<a href="#l4.15"></a><span id="l4.15">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">   for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l4.18"></a><span id="l4.18">     controller.waitForElement(lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, day, null, EVENTPATH));</span>
<a href="#l4.19"></a><span id="l4.19">   }</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -99,30 +98,30 @@ add_task(async function testDailyRecurre</span>
<a href="#l4.22"></a><span id="l4.22">   let saturday = lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, 7, null, EVENTPATH);</span>
<a href="#l4.23"></a><span id="l4.23">   controller.click(saturday);</span>
<a href="#l4.24"></a><span id="l4.24">   handleOccurrencePrompt(controller, saturday, &quot;delete&quot;, false);</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26">   // Verify in all views.</span>
<a href="#l4.27"></a><span id="l4.27">   controller.waitForElementNotPresent(saturday);</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29">   switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, 1, 7, null, EVENTPATH));</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+  controller.assertNodeNotExist(lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, 1, 7, null, EVENTPATH));</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33">   switchToView(controller, &quot;week&quot;);</span>
<a href="#l4.34"></a><span id="l4.34">   controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null, EVENTPATH));</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l4.37"></a><span id="l4.37">   controller.assertNodeNotExist(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH));</span>
<a href="#l4.38"></a><span id="l4.38"> </span>
<a href="#l4.39"></a><span id="l4.39">   // Go to previous day to edit event to occur only on weekdays.</span>
<a href="#l4.40"></a><span id="l4.40">   viewBack(controller, 1);</span>
<a href="#l4.41"></a><span id="l4.41"> </span>
<a href="#l4.42"></a><span id="l4.42">   eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l4.43"></a><span id="l4.43">   handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true);</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-  await invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+  await invokeEventDialog(controller, null, event =&gt; {</span>
<a href="#l4.46"></a><span id="l4.46">     let { eid: eventid, sleep: eventsleep } = helpersForController(event);</span>
<a href="#l4.47"></a><span id="l4.47"> </span>
<a href="#l4.48"></a><span id="l4.48">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;every.weekday&quot;, event);</span>
<a href="#l4.49"></a><span id="l4.49">     eventsleep();</span>
<a href="#l4.50"></a><span id="l4.50">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l4.51"></a><span id="l4.51">   });</span>
<a href="#l4.52"></a><span id="l4.52"> </span>
<a href="#l4.53"></a><span id="l4.53">   // Check day view for 7 days.</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineat">@@ -149,35 +148,35 @@ add_task(async function testDailyRecurre</span>
<a href="#l4.55"></a><span id="l4.55">   }</span>
<a href="#l4.56"></a><span id="l4.56"> </span>
<a href="#l4.57"></a><span id="l4.57">   // Check multiweek view for 4 weeks.</span>
<a href="#l4.58"></a><span id="l4.58">   switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l4.59"></a><span id="l4.59">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l4.60"></a><span id="l4.60"> </span>
<a href="#l4.61"></a><span id="l4.61">   for (let i = 1; i &lt;= 4; i++) {</span>
<a href="#l4.62"></a><span id="l4.62">     controller.waitForElementNotPresent(</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-      lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i, 1, null, EVENTPATH)</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+      lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, i, 1, null, EVENTPATH)</span>
<a href="#l4.65"></a><span id="l4.65">     );</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-    controller.assertNodeNotExist(lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i, 7, null, EVENTPATH));</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, i, 7, null, EVENTPATH));</span>
<a href="#l4.68"></a><span id="l4.68">   }</span>
<a href="#l4.69"></a><span id="l4.69"> </span>
<a href="#l4.70"></a><span id="l4.70">   // Check month view for all 5 weeks.</span>
<a href="#l4.71"></a><span id="l4.71">   switchToView(controller, &quot;month&quot;);</span>
<a href="#l4.72"></a><span id="l4.72">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l4.73"></a><span id="l4.73"> </span>
<a href="#l4.74"></a><span id="l4.74">   for (let i = 1; i &lt;= 5; i++) {</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-    controller.waitForElementNotPresent(lookupEventBox(&quot;month&quot;, EVENT_BOX, i, 1, null, EVENTPATH));</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-    controller.assertNodeNotExist(lookupEventBox(&quot;month&quot;, EVENT_BOX, i, 7, null, EVENTPATH));</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+    controller.waitForElementNotPresent(lookupEventBox(&quot;month&quot;, CANVAS_BOX, i, 1, null, EVENTPATH));</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;month&quot;, CANVAS_BOX, i, 7, null, EVENTPATH));</span>
<a href="#l4.79"></a><span id="l4.79">   }</span>
<a href="#l4.80"></a><span id="l4.80"> </span>
<a href="#l4.81"></a><span id="l4.81">   // Delete event.</span>
<a href="#l4.82"></a><span id="l4.82">   day = lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, 5, null, EVENTPATH);</span>
<a href="#l4.83"></a><span id="l4.83">   controller.click(day);</span>
<a href="#l4.84"></a><span id="l4.84">   handleOccurrencePrompt(controller, day, &quot;delete&quot;, true);</span>
<a href="#l4.85"></a><span id="l4.85">   controller.waitForElementNotPresent(day);</span>
<a href="#l4.86"></a><span id="l4.86"> </span>
<a href="#l4.87"></a><span id="l4.87">   Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l4.88"></a><span id="l4.88"> });</span>
<a href="#l4.89"></a><span id="l4.89"> </span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+registerCleanupFunction(function teardownModule() {</span>
<a href="#l4.92"></a><span id="l4.92">   deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l4.93"></a><span id="l4.93">   closeAllEventDialogs();</span>
<a href="#l4.94"></a><span id="l4.94"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_lastDayOfMonth.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_lastDayOfMonth.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -34,17 +34,17 @@ const HOUR = 8;</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> add_task(async function testLastDayOfMonthRecurrence() {</span>
<a href="#l5.6"></a><span id="l5.6">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l5.7"></a><span id="l5.7">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l5.8"></a><span id="l5.8">   goToDate(controller, 2008, 1, 31); // Start with a leap year.</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10">   // Create monthly recurring event.</span>
<a href="#l5.11"></a><span id="l5.11">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  await invokeEventDialog(controller, eventBox, event =&gt; {</span>
<a href="#l5.14"></a><span id="l5.14">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l5.17"></a><span id="l5.17">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l5.18"></a><span id="l5.18">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l5.21"></a><span id="l5.21">   });</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -116,12 +116,12 @@ function setRecurrence(recurrence) {</span>
<a href="#l5.23"></a><span id="l5.23">   menulistSelect(recid(&quot;monthly-ordinal&quot;), &quot;-1&quot;, recurrence);</span>
<a href="#l5.24"></a><span id="l5.24">   menulistSelect(recid(&quot;monthly-weekday&quot;), &quot;-1&quot;, recurrence);</span>
<a href="#l5.25"></a><span id="l5.25">   recsleep();</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27">   // Close dialog.</span>
<a href="#l5.28"></a><span id="l5.28">   recurrence.click(reclookup(REC_DLG_ACCEPT));</span>
<a href="#l5.29"></a><span id="l5.29"> }</span>
<a href="#l5.30"></a><span id="l5.30"> </span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+registerCleanupFunction(function teardownModule() {</span>
<a href="#l5.33"></a><span id="l5.33">   deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l5.34"></a><span id="l5.34">   closeAllEventDialogs();</span>
<a href="#l5.35"></a><span id="l5.35"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_rotated.ini</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,21 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+[default]</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+head = head.js</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+dupe-manifest =</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+prefs =</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+  calendar.test.rotateViews=true</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+  extensions.installDistroAddons=true</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+  mail.provider.suppress_dialog_on_startup=true</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+  mail.spotlight.firstRunDone=true</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  mail.winsearch.firstRunDone=true</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  mailnews.start_page.override_url=about:blank</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+  mailnews.start_page.url=about:blank</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+subsuite = thunderbird</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+tags = recurrence-rotated</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+[browser_annual.js]</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+[browser_biweekly.js]</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+[browser_daily.js]</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+[browser_lastDayOfMonth.js]</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+[browser_weeklyN.js]</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+[browser_weeklyUntil.js]</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+[browser_weeklyWithException.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_weeklyN.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_weeklyN.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -37,17 +37,17 @@ const HOUR = 8;</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> add_task(async function testWeeklyNRecurrence() {</span>
<a href="#l7.6"></a><span id="l7.6">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l7.7"></a><span id="l7.7">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l7.8"></a><span id="l7.8">   goToDate(controller, 2009, 1, 5);</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">   // Create weekly recurring event.</span>
<a href="#l7.11"></a><span id="l7.11">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  await invokeEventDialog(controller, eventBox, event =&gt; {</span>
<a href="#l7.14"></a><span id="l7.14">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l7.17"></a><span id="l7.17">     event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l7.18"></a><span id="l7.18">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l7.19"></a><span id="l7.19">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -138,12 +138,12 @@ function checkMultiWeekView(view) {</span>
<a href="#l7.23"></a><span id="l7.23">   for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l7.24"></a><span id="l7.24">     controller.assertNode(lookupEventBox(view, CANVAS_BOX, week, i, null, EVENTPATH));</span>
<a href="#l7.25"></a><span id="l7.25">   }</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27">   // Saturday</span>
<a href="#l7.28"></a><span id="l7.28">   controller.assertNodeNotExist(lookupEventBox(view, CANVAS_BOX, week, 7, null, EVENTPATH));</span>
<a href="#l7.29"></a><span id="l7.29"> }</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+registerCleanupFunction(function teardownModule() {</span>
<a href="#l7.33"></a><span id="l7.33">   deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l7.34"></a><span id="l7.34">   closeAllEventDialogs();</span>
<a href="#l7.35"></a><span id="l7.35"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_weeklyUntil.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_weeklyUntil.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -39,17 +39,17 @@ const HOUR = 8;</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5"> add_task(async function testWeeklyUntilRecurrence() {</span>
<a href="#l8.6"></a><span id="l8.6">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l8.7"></a><span id="l8.7">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l8.8"></a><span id="l8.8">   goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">   // Create weekly recurring event.</span>
<a href="#l8.11"></a><span id="l8.11">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  await invokeEventDialog(controller, eventBox, event =&gt; {</span>
<a href="#l8.14"></a><span id="l8.14">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l8.17"></a><span id="l8.17">     event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l8.18"></a><span id="l8.18">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l8.19"></a><span id="l8.19">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -176,15 +176,17 @@ function checkMultiWeekView(view) {</span>
<a href="#l8.23"></a><span id="l8.23">     // Friday</span>
<a href="#l8.24"></a><span id="l8.24">     controller.assertNode(lookupEventBox(view, CANVAS_BOX, week, 6, null, EVENTPATH));</span>
<a href="#l8.25"></a><span id="l8.25">   }</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27">   // Monday, last occurrence</span>
<a href="#l8.28"></a><span id="l8.28">   controller.assertNode(lookupEventBox(view, CANVAS_BOX, startWeek + 3, 2, null, EVENTPATH));</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30">   // Wednesday</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(view, EVENT_BOX, startWeek + 3, 4, null, EVENTPATH));</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+  controller.assertNodeNotExist(</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+    lookupEventBox(view, CANVAS_BOX, startWeek + 3, 4, null, EVENTPATH)</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+  );</span>
<a href="#l8.35"></a><span id="l8.35"> }</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+registerCleanupFunction(function teardownModule() {</span>
<a href="#l8.39"></a><span id="l8.39">   deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l8.40"></a><span id="l8.40">   closeAllEventDialogs();</span>
<a href="#l8.41"></a><span id="l8.41"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_weeklyWithException.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_weeklyWithException.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -44,17 +44,17 @@ const STARTDATE = new Date(2009, 0, 6);</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5"> add_task(async function testWeeklyWithExceptionRecurrence() {</span>
<a href="#l9.6"></a><span id="l9.6">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l9.7"></a><span id="l9.7">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l9.8"></a><span id="l9.8">   goToDate(controller, 2009, 1, 5);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10">   // Create weekly recurring event.</span>
<a href="#l9.11"></a><span id="l9.11">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  await invokeEventDialog(controller, eventBox, event =&gt; {</span>
<a href="#l9.14"></a><span id="l9.14">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16">     event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l9.17"></a><span id="l9.17">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l9.18"></a><span id="l9.18">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l9.19"></a><span id="l9.19">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -167,17 +167,17 @@ add_task(async function testWeeklyWithEx</span>
<a href="#l9.23"></a><span id="l9.23">   switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l9.24"></a><span id="l9.24">   goToDate(controller, 2009, 1, 5);</span>
<a href="#l9.25"></a><span id="l9.25">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l9.26"></a><span id="l9.26"> </span>
<a href="#l9.27"></a><span id="l9.27">   // month view</span>
<a href="#l9.28"></a><span id="l9.28">   switchToView(controller, &quot;month&quot;);</span>
<a href="#l9.29"></a><span id="l9.29">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-  // delete event</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+  // Delete event.</span>
<a href="#l9.33"></a><span id="l9.33">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l9.34"></a><span id="l9.34">   goToDate(controller, 2009, 1, 12);</span>
<a href="#l9.35"></a><span id="l9.35">   path = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l9.36"></a><span id="l9.36">   controller.click(path);</span>
<a href="#l9.37"></a><span id="l9.37">   handleOccurrencePrompt(controller, path, &quot;delete&quot;, true);</span>
<a href="#l9.38"></a><span id="l9.38">   controller.waitForElementNotPresent(path);</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40">   Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineat">@@ -241,19 +241,19 @@ function checkMultiWeekView(view) {</span>
<a href="#l9.42"></a><span id="l9.42">   let assertNodeLookup = (...args) =&gt; {</span>
<a href="#l9.43"></a><span id="l9.43">     return controller.assertNode(lookupEventBox(...args));</span>
<a href="#l9.44"></a><span id="l9.44">   };</span>
<a href="#l9.45"></a><span id="l9.45">   let assertNodeNotExistLookup = (...args) =&gt; {</span>
<a href="#l9.46"></a><span id="l9.46">     return controller.assertNodeNotExist(lookupEventBox(...args));</span>
<a href="#l9.47"></a><span id="l9.47">   };</span>
<a href="#l9.48"></a><span id="l9.48"> </span>
<a href="#l9.49"></a><span id="l9.49">   // Wait for the first items, then check the ones not to be present.</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-  // ASssert exactly two.</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+  // Assert exactly two.</span>
<a href="#l9.52"></a><span id="l9.52">   controller.waitForElement(lookupEventBox(view, EVENT_BOX, startWeek, 3, null, &quot;/[0]&quot;));</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">-  assertNodeLookup(view, EVENT_BOX, startWeek, 3, null, &quot;/[1]&quot;);</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+  assertNodeLookup(view, CANVAS_BOX, startWeek, 3, null, &quot;/[1]&quot;);</span>
<a href="#l9.55"></a><span id="l9.55">   assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 3, null, &quot;/[2]&quot;);</span>
<a href="#l9.56"></a><span id="l9.56">   // Then check no item on the 5th.</span>
<a href="#l9.57"></a><span id="l9.57">   assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 2, null, EVENTPATH);</span>
<a href="#l9.58"></a><span id="l9.58">   assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 3, null, &quot;/[2]&quot;);</span>
<a href="#l9.59"></a><span id="l9.59">   assertNodeLookup(view, CANVAS_BOX, startWeek, 4, null, EVENTPATH);</span>
<a href="#l9.60"></a><span id="l9.60">   assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 5, null, EVENTPATH);</span>
<a href="#l9.61"></a><span id="l9.61">   assertNodeLookup(view, CANVAS_BOX, startWeek, 6, null, EVENTPATH);</span>
<a href="#l9.62"></a><span id="l9.62">   assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 7, null, EVENTPATH);</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineat">@@ -262,12 +262,12 @@ function checkMultiWeekView(view) {</span>
<a href="#l9.64"></a><span id="l9.64">   assertNodeLookup(view, CANVAS_BOX, startWeek + 1, 2, null, EVENTPATH);</span>
<a href="#l9.65"></a><span id="l9.65">   assertNodeLookup(view, CANVAS_BOX, startWeek + 1, 3, null, EVENTPATH);</span>
<a href="#l9.66"></a><span id="l9.66">   assertNodeLookup(view, CANVAS_BOX, startWeek + 1, 4, null, EVENTPATH);</span>
<a href="#l9.67"></a><span id="l9.67">   assertNodeNotExistLookup(view, EVENT_BOX, startWeek + 1, 5, null, EVENTPATH);</span>
<a href="#l9.68"></a><span id="l9.68">   assertNodeLookup(view, CANVAS_BOX, startWeek + 1, 6, null, EVENTPATH);</span>
<a href="#l9.69"></a><span id="l9.69">   assertNodeNotExistLookup(view, EVENT_BOX, startWeek + 1, 7, null, EVENTPATH);</span>
<a href="#l9.70"></a><span id="l9.70"> }</span>
<a href="#l9.71"></a><span id="l9.71"> </span>
<a href="#l9.72"></a><span id="l9.72" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+registerCleanupFunction(function teardownModule() {</span>
<a href="#l9.74"></a><span id="l9.74">   deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l9.75"></a><span id="l9.75">   closeAllEventDialogs();</span>
<a href="#l9.76"></a><span id="l9.76"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/calendar/test/browser/recurrence/head.js</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,13 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+ * file, you can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+/* globals toggleOrientation */</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+let isRotated =</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+  document.getElementById(&quot;calendar_toggle_orientation_command&quot;).getAttribute(&quot;checked&quot;) == &quot;true&quot;;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+let shouldBeRotated = Services.prefs.getBoolPref(&quot;calendar.test.rotateViews&quot;, false);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+if (isRotated != shouldBeRotated) {</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+  toggleOrientation();</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">deleted file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser.ini</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ /dev/null</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -1,18 +0,0 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineminus">-[default]</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineminus">-head = ../head.js</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineminus">-prefs =</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineminus">-  extensions.installDistroAddons=true</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineminus">-  mail.provider.suppress_dialog_on_startup=true</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">-  mail.spotlight.firstRunDone=true</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineminus">-  mail.winsearch.firstRunDone=true</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  mailnews.start_page.override_url=about:blank</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-  mailnews.start_page.url=about:blank</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-subsuite = thunderbird</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-[browser_annual.js]</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-[browser_biweekly.js]</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-[browser_daily.js]</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-[browser_lastDayOfMonth.js]</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-[browser_weeklyN.js]</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-[browser_weeklyUntil.js]</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-[browser_weeklyWithException.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">deleted file mode 100755</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_annual.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ /dev/null</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -1,104 +0,0 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineminus">-</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineminus">-var mozmill = ChromeUtils.import(&quot;resource://testing-common/mozmill/mozmill.jsm&quot;);</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">-</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineminus">-var {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  ALLDAY,</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-  CALENDARNAME,</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-  CANVAS_BOX,</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-  EVENTPATH,</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-  closeAllEventDialogs,</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-  createCalendar,</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-  deleteCalendars,</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-  goToDate,</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-  handleOccurrencePrompt,</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">-  helpersForController,</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">-  invokeEventDialog,</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-  menulistSelect,</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-  switchToView,</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-} = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-var controller = mozmill.getMail3PaneController();</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-var { eid, getEventBoxPath, lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-const STARTYEAR = 1950;</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-const EPOCH = 1970;</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-add_task(async function testAnnualRecurrence() {</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-  createCalendar(controller, CALENDARNAME);</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-  goToDate(controller, STARTYEAR, 1, 1);</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-  // Rotate view.</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-  controller.waitFor(</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-    () =&gt;</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-        .getNode()</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-  );</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-  // Create yearly recurring all-day event.</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-  let eventBox = lookupEventBox(&quot;day&quot;, ALLDAY, null, 1, null);</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-    let { eid: eventid } = helpersForController(event);</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-    menulistSelect(eventid(&quot;item-repeat&quot;), &quot;yearly&quot;, event);</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-    event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-  });</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineminus">-  let checkYears = [STARTYEAR, STARTYEAR + 1, EPOCH - 1, EPOCH, EPOCH + 1];</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">-  for (let year of checkYears) {</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineminus">-    goToDate(controller, year, 1, 1);</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-    let date = new Date(year, 0, 1);</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineminus">-    let column = date.getDay() + 1;</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineminus">-</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineminus">-    // day view</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineminus">-    switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;day&quot;, ALLDAY, null, 1, null, EVENTPATH));</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-    // week view</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-    switchToView(controller, &quot;week&quot;);</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;week&quot;, ALLDAY, null, column, null, EVENTPATH));</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-    // multiweek view</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineminus">-    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, 1, column, null, EVENTPATH));</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-    // month view</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-    switchToView(controller, &quot;month&quot;);</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, column, null, EVENTPATH));</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineminus">-  }</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-  // Delete event.</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-  goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-  const boxPath = getEventBoxPath(&quot;day&quot;, ALLDAY, null, 1, null) + EVENTPATH;</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-  const box = lookup(boxPath);</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-  controller.click(box);</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineminus">-  handleOccurrencePrompt(controller, box, &quot;delete&quot;, true);</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-  controller.waitForElementNotPresent(box);</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-  Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineminus">-});</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineminus">-</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-  deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-  // Reset view.</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-  if (</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineminus">-    eid(&quot;day-view&quot;)</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineminus">-      .getNode()</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineminus">-      .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineminus">-  ) {</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineminus">-  }</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineminus">-  controller.waitFor(</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-    () =&gt;</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineminus">-        .getNode()</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;vertical&quot;</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineminus">-  );</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-  closeAllEventDialogs();</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineminus">-});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">deleted file mode 100755</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_biweekly.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ /dev/null</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -1,125 +0,0 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineminus">-</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineminus">-var mozmill = ChromeUtils.import(&quot;resource://testing-common/mozmill/mozmill.jsm&quot;);</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">-</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineminus">-var {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  CALENDARNAME,</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-  CANVAS_BOX,</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-  EVENTPATH,</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-  EVENT_BOX,</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-  closeAllEventDialogs,</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-  createCalendar,</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-  deleteCalendars,</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-  goToDate,</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-  handleOccurrencePrompt,</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">-  helpersForController,</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">-  invokeEventDialog,</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-  menulistSelect,</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-  switchToView,</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">-  viewForward,</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">-} = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineminus">-</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">-var controller = mozmill.getMail3PaneController();</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">-var { eid, lookupEventBox } = helpersForController(controller);</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-const HOUR = 8;</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-add_task(async function testBiweeklyRecurrence() {</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-  createCalendar(controller, CALENDARNAME);</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-  goToDate(controller, 2009, 1, 31);</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-  // Rotate view.</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-  controller.waitFor(</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-    () =&gt;</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-        .getNode()</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-  );</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-  // Create biweekly event.</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-  let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-    let { eid: eventid } = helpersForController(event);</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-    menulistSelect(eventid(&quot;item-repeat&quot;), &quot;bi.weekly&quot;, event);</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineminus">-    event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-  });</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineminus">-</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineminus">-  // Check day view.</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineminus">-  for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH));</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-    viewForward(controller, 14);</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-  }</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineminus">-  // Check week view.</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineminus">-  switchToView(controller, &quot;week&quot;);</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineminus">-  goToDate(controller, 2009, 1, 31);</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-  for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null, EVENTPATH));</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-    viewForward(controller, 2);</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineminus">-  }</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineminus">-</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineminus">-  // Check multiweek view.</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineminus">-  switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineminus">-  goToDate(controller, 2009, 1, 31);</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineminus">-</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineminus">-  // Always two occurrences in view, 1st and 3rd or 2nd and 4th week.</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineminus">-  for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineminus">-    controller.waitForElement(</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineminus">-      lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, (i % 2) + 1, 7, null, EVENTPATH)</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineminus">-    );</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineminus">-    controller.assertNode(lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, (i % 2) + 3, 7, null, EVENTPATH));</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineminus">-    viewForward(controller, 1);</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineminus">-  }</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineminus">-</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineminus">-  // Check month view.</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineminus">-  switchToView(controller, &quot;month&quot;);</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineminus">-  goToDate(controller, 2009, 1, 31);</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-  // January</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-  controller.waitForElement(lookupEventBox(&quot;month&quot;, CANVAS_BOX, 5, 7, null, EVENTPATH));</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineminus">-</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineminus">-  // February</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineminus">-  controller.waitForElement(lookupEventBox(&quot;month&quot;, CANVAS_BOX, 2, 7, null, EVENTPATH));</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineminus">-  controller.assertNode(lookupEventBox(&quot;month&quot;, CANVAS_BOX, 4, 7, null, EVENTPATH));</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineminus">-</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineminus">-  // March</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineminus">-  controller.waitForElement(lookupEventBox(&quot;month&quot;, CANVAS_BOX, 2, 7, null, EVENTPATH));</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineminus">-  controller.assertNode(lookupEventBox(&quot;month&quot;, CANVAS_BOX, 4, 7, null, EVENTPATH));</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineminus">-</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineminus">-  // Delete event.</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineminus">-  let box = lookupEventBox(&quot;month&quot;, CANVAS_BOX, 4, 7, null, EVENTPATH);</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineminus">-  controller.click(box);</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineminus">-  handleOccurrencePrompt(controller, box, &quot;delete&quot;, true);</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineminus">-  controller.waitForElementNotPresent(box);</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineminus">-</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineminus">-  Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineminus">-});</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineminus">-</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineminus">-  deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineminus">-  // Reset view.</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineminus">-  if (</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineminus">-    eid(&quot;day-view&quot;)</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineminus">-      .getNode()</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineminus">-      .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineminus">-  ) {</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineminus">-    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineminus">-  }</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineminus">-  controller.waitFor(</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineminus">-    () =&gt;</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineminus">-        .getNode()</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;vertical&quot;</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineminus">-  );</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineminus">-  closeAllEventDialogs();</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineminus">-});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">deleted file mode 100755</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_daily.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ /dev/null</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -1,206 +0,0 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineminus">-</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineminus">-var mozmill = ChromeUtils.import(&quot;resource://testing-common/mozmill/mozmill.jsm&quot;);</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineminus">-</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineminus">-var {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  CALENDARNAME,</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-  CANVAS_BOX,</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-  EVENTPATH,</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-  EVENT_BOX,</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-  closeAllEventDialogs,</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-  createCalendar,</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-  deleteCalendars,</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-  goToDate,</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-  handleOccurrencePrompt,</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-  helpersForController,</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-  invokeEventDialog,</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-  menulistSelect,</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-  switchToView,</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-  viewBack,</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">-  viewForward,</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-} = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-var { setData } = ChromeUtils.import(&quot;resource://testing-common/mozmill/ItemEditingHelpers.jsm&quot;);</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">-</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-var controller = mozmill.getMail3PaneController();</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-var { eid, lookupEventBox } = helpersForController(controller);</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-const HOUR = 8;</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-add_task(async function testDailyRecurrence() {</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-  createCalendar(controller, CALENDARNAME);</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-  goToDate(controller, 2009, 1, 1);</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-  // Rotate view.</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-  controller.waitFor(</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-    () =&gt;</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-        .getNode()</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-  );</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-  // Create daily event.</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-  let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-    let { eid: eventid } = helpersForController(event);</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-    await setData(event, iframe, { repeat: &quot;daily&quot;, repeatuntil: new Date(2009, 2, 20) });</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-    event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-  });</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-  // Check day view for 7 days.</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">-  let daybox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineminus">-  controller.waitForElement(daybox);</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">-</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-  for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineminus">-    controller.waitForElement(daybox);</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineminus">-    viewForward(controller, 1);</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineminus">-  }</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">-</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineminus">-  // Check week view for 2 weeks.</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineminus">-  switchToView(controller, &quot;week&quot;);</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-  goToDate(controller, 2009, 1, 1);</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineminus">-</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineminus">-  for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, 1, day, null, EVENTPATH));</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineminus">-  }</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineminus">-</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineminus">-</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineminus">-  for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, 2, day, null, EVENTPATH));</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineminus">-  }</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-  // Check multiweek view for 4 weeks.</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineminus">-  switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineminus">-  goToDate(controller, 2009, 1, 1);</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-  for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, 1, day, null, EVENTPATH));</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-  }</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-  for (let week = 2; week &lt;= 4; week++) {</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-    for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineminus">-      controller.waitForElement(</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineminus">-        lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, week, day, null, EVENTPATH)</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineminus">-      );</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineminus">-    }</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineminus">-  }</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineminus">-  // Check month view for all 5 weeks.</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-  switchToView(controller, &quot;month&quot;);</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineminus">-  goToDate(controller, 2009, 1, 1);</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineminus">-</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-  for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, day, null, EVENTPATH));</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-  }</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-  for (let week = 2; week &lt;= 5; week++) {</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-    for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-      controller.assertNode(lookupEventBox(&quot;month&quot;, CANVAS_BOX, week, day, null, EVENTPATH));</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-    }</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-  }</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineminus">-</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineminus">-  // Delete 3rd January occurrence.</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-  let saturday = lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, 7, null, EVENTPATH);</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineminus">-  controller.click(saturday);</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineminus">-  handleOccurrencePrompt(controller, saturday, &quot;delete&quot;, false);</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineminus">-</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineminus">-  // Verify in all views.</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineminus">-  controller.waitForElementNotPresent(saturday);</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineminus">-</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineminus">-  switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, 1, 7, null, EVENTPATH));</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineminus">-</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineminus">-  switchToView(controller, &quot;week&quot;);</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null, EVENTPATH));</span>
<a href="#l14.123"></a><span id="l14.123" class="difflineminus">-</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH));</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineminus">-</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineminus">-  // Go to previous day to edit event to occur only on weekdays.</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineminus">-  viewBack(controller, 1);</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineminus">-</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineminus">-  eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineminus">-  handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true);</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineminus">-  await invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineminus">-    let { eid: eventid, sleep: eventsleep } = helpersForController(event);</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineminus">-</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineminus">-    menulistSelect(eventid(&quot;item-repeat&quot;), &quot;every.weekday&quot;, event);</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineminus">-    eventsleep();</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineminus">-    event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineminus">-  });</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineminus">-</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineminus">-  // Check day view for 7 days.</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineminus">-  let day = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineminus">-  let dates = [</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineminus">-    [2009, 1, 3],</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineminus">-    [2009, 1, 4],</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineminus">-  ];</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineminus">-  for (let [y, m, d] of dates) {</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineminus">-    goToDate(controller, y, m, d);</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineminus">-    controller.assertNodeNotExist(day);</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineminus">-  }</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineminus">-</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineminus">-  // Check week view for 2 weeks.</span>
<a href="#l14.152"></a><span id="l14.152" class="difflineminus">-  switchToView(controller, &quot;week&quot;);</span>
<a href="#l14.153"></a><span id="l14.153" class="difflineminus">-  goToDate(controller, 2009, 1, 1);</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineminus">-</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineminus">-  for (let i = 0; i &lt;= 1; i++) {</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineminus">-    controller.waitForElementNotPresent(</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineminus">-      lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 1, null, EVENTPATH)</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineminus">-    );</span>
<a href="#l14.159"></a><span id="l14.159" class="difflineminus">-    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null, EVENTPATH));</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineminus">-    viewForward(controller, 1);</span>
<a href="#l14.161"></a><span id="l14.161" class="difflineminus">-  }</span>
<a href="#l14.162"></a><span id="l14.162" class="difflineminus">-</span>
<a href="#l14.163"></a><span id="l14.163" class="difflineminus">-  // Check multiweek view for 4 weeks.</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineminus">-  switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineminus">-  goToDate(controller, 2009, 1, 1);</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineminus">-</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineminus">-  for (let i = 1; i &lt;= 4; i++) {</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineminus">-    controller.waitForElementNotPresent(</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineminus">-      lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, i, 1, null, EVENTPATH)</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineminus">-    );</span>
<a href="#l14.171"></a><span id="l14.171" class="difflineminus">-    controller.assertNodeNotExist(lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, i, 7, null, EVENTPATH));</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineminus">-  }</span>
<a href="#l14.173"></a><span id="l14.173" class="difflineminus">-</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineminus">-  // Check month view for all 5 weeks.</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineminus">-  switchToView(controller, &quot;month&quot;);</span>
<a href="#l14.176"></a><span id="l14.176" class="difflineminus">-  goToDate(controller, 2009, 1, 1);</span>
<a href="#l14.177"></a><span id="l14.177" class="difflineminus">-</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineminus">-  for (let i = 1; i &lt;= 5; i++) {</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineminus">-    controller.waitForElementNotPresent(lookupEventBox(&quot;month&quot;, CANVAS_BOX, i, 1, null, EVENTPATH));</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineminus">-    controller.assertNodeNotExist(lookupEventBox(&quot;month&quot;, CANVAS_BOX, i, 7, null, EVENTPATH));</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineminus">-  }</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineminus">-</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineminus">-  // Delete event.</span>
<a href="#l14.184"></a><span id="l14.184" class="difflineminus">-  day = lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, 5, null, EVENTPATH);</span>
<a href="#l14.185"></a><span id="l14.185" class="difflineminus">-  controller.click(day);</span>
<a href="#l14.186"></a><span id="l14.186" class="difflineminus">-  handleOccurrencePrompt(controller, day, &quot;delete&quot;, true);</span>
<a href="#l14.187"></a><span id="l14.187" class="difflineminus">-  controller.waitForElementNotPresent(day);</span>
<a href="#l14.188"></a><span id="l14.188" class="difflineminus">-</span>
<a href="#l14.189"></a><span id="l14.189" class="difflineminus">-  Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l14.190"></a><span id="l14.190" class="difflineminus">-});</span>
<a href="#l14.191"></a><span id="l14.191" class="difflineminus">-</span>
<a href="#l14.192"></a><span id="l14.192" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l14.193"></a><span id="l14.193" class="difflineminus">-  deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l14.194"></a><span id="l14.194" class="difflineminus">-  // Reset view.</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineminus">-  if (</span>
<a href="#l14.197"></a><span id="l14.197" class="difflineminus">-    eid(&quot;day-view&quot;)</span>
<a href="#l14.198"></a><span id="l14.198" class="difflineminus">-      .getNode()</span>
<a href="#l14.199"></a><span id="l14.199" class="difflineminus">-      .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l14.200"></a><span id="l14.200" class="difflineminus">-  ) {</span>
<a href="#l14.201"></a><span id="l14.201" class="difflineminus">-    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l14.202"></a><span id="l14.202" class="difflineminus">-  }</span>
<a href="#l14.203"></a><span id="l14.203" class="difflineminus">-  controller.waitFor(</span>
<a href="#l14.204"></a><span id="l14.204" class="difflineminus">-    () =&gt;</span>
<a href="#l14.205"></a><span id="l14.205" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l14.206"></a><span id="l14.206" class="difflineminus">-        .getNode()</span>
<a href="#l14.207"></a><span id="l14.207" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;vertical&quot;</span>
<a href="#l14.208"></a><span id="l14.208" class="difflineminus">-  );</span>
<a href="#l14.209"></a><span id="l14.209" class="difflineminus">-  closeAllEventDialogs();</span>
<a href="#l14.210"></a><span id="l14.210" class="difflineminus">-});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">deleted file mode 100755</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ /dev/null</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -1,152 +0,0 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineminus">-</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineminus">-var mozmill = ChromeUtils.import(&quot;resource://testing-common/mozmill/mozmill.jsm&quot;);</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineminus">-</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineminus">-var {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  CALENDARNAME,</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  CANVAS_BOX,</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-  EVENTPATH,</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-  EVENT_BOX,</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-  TIMEOUT_MODAL_DIALOG,</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-  closeAllEventDialogs,</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-  createCalendar,</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">-  deleteCalendars,</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">-  goToDate,</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-  handleOccurrencePrompt,</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-  helpersForController,</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-  invokeEventDialog,</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">-  menulistSelect,</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">-  switchToView,</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-} = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-var { REC_DLG_ACCEPT } = ChromeUtils.import(</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-  &quot;resource://testing-common/mozmill/ItemEditingHelpers.jsm&quot;</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-);</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-var { plan_for_modal_dialog, wait_for_modal_dialog } = ChromeUtils.import(</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-  &quot;resource://testing-common/mozmill/WindowHelpers.jsm&quot;</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-);</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-var controller = mozmill.getMail3PaneController();</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-var { eid, lookupEventBox } = helpersForController(controller);</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-const HOUR = 8;</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-add_task(async function testLastDayOfMonthRecurrence() {</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-  createCalendar(controller, CALENDARNAME);</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-  goToDate(controller, 2008, 1, 31); // Start with a leap year.</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineminus">-  // Rotate view.</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineminus">-  controller.waitFor(</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">-    () =&gt;</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-        .getNode()</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-  );</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineminus">-  // Create monthly recurring event.</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineminus">-  let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-    let { eid: eventid } = helpersForController(event);</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineminus">-</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-    plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineminus">-    menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-    wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineminus">-</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-    event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-  });</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-  // data tuple: [year, month, day, row in month view]</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-  // note: Month starts here with 1 for January.</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-  let checkingData = [</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-    [2008, 1, 31, 5],</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-    [2008, 2, 29, 5],</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-    [2008, 3, 31, 6],</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-    [2008, 4, 30, 5],</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-    [2008, 5, 31, 5],</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineminus">-    [2008, 6, 30, 5],</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineminus">-    [2008, 7, 31, 5],</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineminus">-    [2008, 8, 31, 6],</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-    [2008, 9, 30, 5],</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineminus">-    [2008, 10, 31, 5],</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineminus">-    [2008, 11, 30, 6],</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineminus">-    [2008, 12, 31, 5],</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineminus">-    [2009, 1, 31, 5],</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineminus">-    [2009, 2, 28, 4],</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineminus">-    [2009, 3, 31, 5],</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineminus">-  ];</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineminus">-  // Check all dates.</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineminus">-  for (let [y, m, d, correctRow] of checkingData) {</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-    let date = new Date(y, m - 1, d);</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-    let column = date.getDay() + 1;</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineminus">-    goToDate(controller, y, m, d);</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineminus">-</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineminus">-    // day view</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineminus">-    switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH));</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineminus">-</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineminus">-    // week view</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineminus">-    switchToView(controller, &quot;week&quot;);</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, column, null, EVENTPATH));</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineminus">-</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineminus">-    // multiweek view</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, 1, column, null, EVENTPATH));</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineminus">-</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-    // month view</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineminus">-    switchToView(controller, &quot;month&quot;);</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineminus">-    controller.waitForElement(</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineminus">-      lookupEventBox(&quot;month&quot;, CANVAS_BOX, correctRow, column, null, EVENTPATH)</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineminus">-    );</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineminus">-  }</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineminus">-</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineminus">-  // Delete event.</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineminus">-  goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineminus">-  let box = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l15.115"></a><span id="l15.115" class="difflineminus">-  controller.waitThenClick(box);</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineminus">-  handleOccurrencePrompt(controller, box, &quot;delete&quot;, true);</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineminus">-  controller.waitForElementNotPresent(box);</span>
<a href="#l15.118"></a><span id="l15.118" class="difflineminus">-</span>
<a href="#l15.119"></a><span id="l15.119" class="difflineminus">-  Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineminus">-});</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineminus">-</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineminus">-function setRecurrence(recurrence) {</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineminus">-  let { sleep: recsleep, lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineminus">-</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineminus">-  // monthly</span>
<a href="#l15.126"></a><span id="l15.126" class="difflineminus">-  menulistSelect(recid(&quot;period-list&quot;), &quot;2&quot;, recurrence);</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineminus">-</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineminus">-  // last day of month</span>
<a href="#l15.129"></a><span id="l15.129" class="difflineminus">-  recurrence.radio(recid(&quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineminus">-  menulistSelect(recid(&quot;monthly-ordinal&quot;), &quot;-1&quot;, recurrence);</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineminus">-  menulistSelect(recid(&quot;monthly-weekday&quot;), &quot;-1&quot;, recurrence);</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineminus">-  recsleep();</span>
<a href="#l15.133"></a><span id="l15.133" class="difflineminus">-</span>
<a href="#l15.134"></a><span id="l15.134" class="difflineminus">-  // Close dialog.</span>
<a href="#l15.135"></a><span id="l15.135" class="difflineminus">-  recurrence.click(reclookup(REC_DLG_ACCEPT));</span>
<a href="#l15.136"></a><span id="l15.136" class="difflineminus">-}</span>
<a href="#l15.137"></a><span id="l15.137" class="difflineminus">-</span>
<a href="#l15.138"></a><span id="l15.138" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineminus">-  deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l15.140"></a><span id="l15.140" class="difflineminus">-  // Reset view.</span>
<a href="#l15.141"></a><span id="l15.141" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineminus">-  if (</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineminus">-    eid(&quot;day-view&quot;)</span>
<a href="#l15.144"></a><span id="l15.144" class="difflineminus">-      .getNode()</span>
<a href="#l15.145"></a><span id="l15.145" class="difflineminus">-      .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l15.146"></a><span id="l15.146" class="difflineminus">-  ) {</span>
<a href="#l15.147"></a><span id="l15.147" class="difflineminus">-    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l15.148"></a><span id="l15.148" class="difflineminus">-  }</span>
<a href="#l15.149"></a><span id="l15.149" class="difflineminus">-  controller.waitFor(</span>
<a href="#l15.150"></a><span id="l15.150" class="difflineminus">-    () =&gt;</span>
<a href="#l15.151"></a><span id="l15.151" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l15.152"></a><span id="l15.152" class="difflineminus">-        .getNode()</span>
<a href="#l15.153"></a><span id="l15.153" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;vertical&quot;</span>
<a href="#l15.154"></a><span id="l15.154" class="difflineminus">-  );</span>
<a href="#l15.155"></a><span id="l15.155" class="difflineminus">-  closeAllEventDialogs();</span>
<a href="#l15.156"></a><span id="l15.156" class="difflineminus">-});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">deleted file mode 100755</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_weeklyN.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ /dev/null</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -1,173 +0,0 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineminus">-</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineminus">-var mozmill = ChromeUtils.import(&quot;resource://testing-common/mozmill/mozmill.jsm&quot;);</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineminus">-</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineminus">-var {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  CALENDARNAME,</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-  CANVAS_BOX,</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-  EVENTPATH,</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-  EVENT_BOX,</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-  TIMEOUT_MODAL_DIALOG,</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-  closeAllEventDialogs,</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineminus">-  createCalendar,</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineminus">-  deleteCalendars,</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-  goToDate,</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">-  handleOccurrencePrompt,</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">-  helpersForController,</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">-  invokeEventDialog,</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineminus">-  menulistSelect,</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-  switchToView,</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-  viewForward,</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-} = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">-var { REC_DLG_ACCEPT, REC_DLG_DAYS } = ChromeUtils.import(</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">-  &quot;resource://testing-common/mozmill/ItemEditingHelpers.jsm&quot;</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-);</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-var { plan_for_modal_dialog, wait_for_modal_dialog } = ChromeUtils.import(</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">-  &quot;resource://testing-common/mozmill/WindowHelpers.jsm&quot;</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">-);</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-var { cal } = ChromeUtils.import(&quot;resource:///modules/calendar/calUtils.jsm&quot;);</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">-</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-var controller = mozmill.getMail3PaneController();</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-var { eid, lookupEventBox } = helpersForController(controller);</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineminus">-</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineminus">-const HOUR = 8;</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineminus">-</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-add_task(async function testWeeklyNRecurrence() {</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-  createCalendar(controller, CALENDARNAME);</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineminus">-  goToDate(controller, 2009, 1, 5);</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineminus">-</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-  // Rotate view.</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-  controller.waitFor(</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-    () =&gt;</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-        .getNode()</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineminus">-  );</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineminus">-</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineminus">-  // Create weekly recurring event.</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineminus">-  let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineminus">-    let { eid: eventid } = helpersForController(event);</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineminus">-</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineminus">-    plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineminus">-    event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineminus">-    menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineminus">-    wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineminus">-</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineminus">-    event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineminus">-  });</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineminus">-</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineminus">-  // Check day view.</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineminus">-  let box = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineminus">-  // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineminus">-  for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineminus">-    controller.waitForElement(box);</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineminus">-    viewForward(controller, 1);</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineminus">-  }</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineminus">-</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineminus">-  // Not Friday</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineminus">-  controller.waitForElementNotPresent(box);</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineminus">-</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineminus">-  // Not Saturday as only 4 occurrences are set.</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineminus">-  controller.waitForElementNotPresent(box);</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineminus">-</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineminus">-  // Check week view.</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineminus">-  switchToView(controller, &quot;week&quot;);</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineminus">-</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineminus">-  // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineminus">-  for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, i, null, EVENTPATH));</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineminus">-  }</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineminus">-</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineminus">-  // Saturday</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null, EVENTPATH));</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineminus">-</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineminus">-  // check multiweek view</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineminus">-  switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineminus">-  checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineminus">-</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineminus">-  // Check month view.</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineminus">-  switchToView(controller, &quot;month&quot;);</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineminus">-  checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineminus">-</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineminus">-  // Delete event.</span>
<a href="#l16.104"></a><span id="l16.104" class="difflineminus">-  box = lookupEventBox(&quot;month&quot;, CANVAS_BOX, 2, 2, null, EVENTPATH);</span>
<a href="#l16.105"></a><span id="l16.105" class="difflineminus">-  controller.click(box);</span>
<a href="#l16.106"></a><span id="l16.106" class="difflineminus">-  handleOccurrencePrompt(controller, box, &quot;delete&quot;, true);</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineminus">-  controller.waitForElementNotPresent(box);</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineminus">-</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineminus">-  Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineminus">-});</span>
<a href="#l16.111"></a><span id="l16.111" class="difflineminus">-</span>
<a href="#l16.112"></a><span id="l16.112" class="difflineminus">-function setRecurrence(recurrence) {</span>
<a href="#l16.113"></a><span id="l16.113" class="difflineminus">-  let { sleep: recsleep, lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineminus">-</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineminus">-  // weekly</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineminus">-  recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineminus">-  menulistSelect(recid(&quot;period-list&quot;), &quot;1&quot;, recurrence);</span>
<a href="#l16.118"></a><span id="l16.118" class="difflineminus">-  recsleep();</span>
<a href="#l16.119"></a><span id="l16.119" class="difflineminus">-</span>
<a href="#l16.120"></a><span id="l16.120" class="difflineminus">-  let mon = cal.l10n.getDateFmtString(&quot;day.2.Mmm&quot;);</span>
<a href="#l16.121"></a><span id="l16.121" class="difflineminus">-  let tue = cal.l10n.getDateFmtString(&quot;day.3.Mmm&quot;);</span>
<a href="#l16.122"></a><span id="l16.122" class="difflineminus">-  let wed = cal.l10n.getDateFmtString(&quot;day.4.Mmm&quot;);</span>
<a href="#l16.123"></a><span id="l16.123" class="difflineminus">-  let thu = cal.l10n.getDateFmtString(&quot;day.5.Mmm&quot;);</span>
<a href="#l16.124"></a><span id="l16.124" class="difflineminus">-  let sat = cal.l10n.getDateFmtString(&quot;day.7.Mmm&quot;);</span>
<a href="#l16.125"></a><span id="l16.125" class="difflineminus">-</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineminus">-  // Starting from Monday so it should be checked. We have to wait a little,</span>
<a href="#l16.127"></a><span id="l16.127" class="difflineminus">-  // because the checkedstate is set in background by JS.</span>
<a href="#l16.128"></a><span id="l16.128" class="difflineminus">-  recurrence.waitFor(() =&gt; {</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineminus">-    return recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineminus">-  }, 30000);</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineminus">-  // Check Tuesday, Wednesday, Thursday and Saturday too.</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineminus">-  recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineminus">-  recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineminus">-  recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${thu}&quot;}`));</span>
<a href="#l16.135"></a><span id="l16.135" class="difflineminus">-  recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${sat}&quot;}`));</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineminus">-</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineminus">-  // Set number of recurrences.</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineminus">-  recurrence.click(recid(&quot;recurrence-range-for&quot;));</span>
<a href="#l16.139"></a><span id="l16.139" class="difflineminus">-  let ntimesField = recid(&quot;repeat-ntimes-count&quot;);</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineminus">-  ntimesField.getNode().value = &quot;4&quot;;</span>
<a href="#l16.141"></a><span id="l16.141" class="difflineminus">-</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineminus">-  // close dialog</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineminus">-  recurrence.click(reclookup(REC_DLG_ACCEPT));</span>
<a href="#l16.144"></a><span id="l16.144" class="difflineminus">-}</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineminus">-</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineminus">-function checkMultiWeekView(view) {</span>
<a href="#l16.147"></a><span id="l16.147" class="difflineminus">-  // In month view event starts from 2nd row.</span>
<a href="#l16.148"></a><span id="l16.148" class="difflineminus">-  let week = view == &quot;month&quot; ? 2 : 1;</span>
<a href="#l16.149"></a><span id="l16.149" class="difflineminus">-</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineminus">-  // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineminus">-  for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineminus">-    controller.assertNode(lookupEventBox(view, CANVAS_BOX, week, i, null, EVENTPATH));</span>
<a href="#l16.153"></a><span id="l16.153" class="difflineminus">-  }</span>
<a href="#l16.154"></a><span id="l16.154" class="difflineminus">-</span>
<a href="#l16.155"></a><span id="l16.155" class="difflineminus">-  // Saturday</span>
<a href="#l16.156"></a><span id="l16.156" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(view, CANVAS_BOX, week, 7, null, EVENTPATH));</span>
<a href="#l16.157"></a><span id="l16.157" class="difflineminus">-}</span>
<a href="#l16.158"></a><span id="l16.158" class="difflineminus">-</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l16.160"></a><span id="l16.160" class="difflineminus">-  deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l16.161"></a><span id="l16.161" class="difflineminus">-  // Reset view.</span>
<a href="#l16.162"></a><span id="l16.162" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l16.163"></a><span id="l16.163" class="difflineminus">-  if (</span>
<a href="#l16.164"></a><span id="l16.164" class="difflineminus">-    eid(&quot;day-view&quot;)</span>
<a href="#l16.165"></a><span id="l16.165" class="difflineminus">-      .getNode()</span>
<a href="#l16.166"></a><span id="l16.166" class="difflineminus">-      .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l16.167"></a><span id="l16.167" class="difflineminus">-  ) {</span>
<a href="#l16.168"></a><span id="l16.168" class="difflineminus">-    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l16.169"></a><span id="l16.169" class="difflineminus">-  }</span>
<a href="#l16.170"></a><span id="l16.170" class="difflineminus">-  controller.waitFor(</span>
<a href="#l16.171"></a><span id="l16.171" class="difflineminus">-    () =&gt;</span>
<a href="#l16.172"></a><span id="l16.172" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l16.173"></a><span id="l16.173" class="difflineminus">-        .getNode()</span>
<a href="#l16.174"></a><span id="l16.174" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;vertical&quot;</span>
<a href="#l16.175"></a><span id="l16.175" class="difflineminus">-  );</span>
<a href="#l16.176"></a><span id="l16.176" class="difflineminus">-  closeAllEventDialogs();</span>
<a href="#l16.177"></a><span id="l16.177" class="difflineminus">-});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">deleted file mode 100755</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ /dev/null</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -1,230 +0,0 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineminus">-</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineminus">-var mozmill = ChromeUtils.import(&quot;resource://testing-common/mozmill/mozmill.jsm&quot;);</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineminus">-</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineminus">-var { plan_for_modal_dialog, wait_for_modal_dialog } = ChromeUtils.import(</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  &quot;resource://testing-common/mozmill/WindowHelpers.jsm&quot;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-);</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-var { cal } = ChromeUtils.import(&quot;resource:///modules/calendar/calUtils.jsm&quot;);</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-var SHORT_SLEEP, TIMEOUT_MODAL_DIALOG, CALENDARNAME, EVENTPATH, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-var helpersForController, handleOccurrencePrompt, switchToView, goToDate;</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineminus">-var invokeEventDialog,</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineminus">-  viewForward,</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">-  closeAllEventDialogs,</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-  deleteCalendars,</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-  createCalendar,</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-  menulistSelect;</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">-var REC_DLG_DAYS, REC_DLG_ACCEPT, REC_DLG_UNTIL_INPUT;</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineminus">-var controller, eid, lookupEventBox;</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineminus">-</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">-const ENDDATE = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineminus">-const HOUR = 8;</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">-</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-add_task(function setupModule(module) {</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineminus">-  ({</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">-    SHORT_SLEEP,</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-    TIMEOUT_MODAL_DIALOG,</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-    CALENDARNAME,</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">-    EVENTPATH,</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-    EVENT_BOX,</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">-    CANVAS_BOX,</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">-    helpersForController,</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">-    handleOccurrencePrompt,</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-    switchToView,</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-    goToDate,</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-    invokeEventDialog,</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineminus">-    viewForward,</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineminus">-    closeAllEventDialogs,</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineminus">-    deleteCalendars,</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineminus">-    createCalendar,</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineminus">-    menulistSelect,</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-  } = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;));</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineminus">-  ({ eid, lookupEventBox } = helpersForController(controller));</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineminus">-</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineminus">-  ({ REC_DLG_DAYS, REC_DLG_ACCEPT, REC_DLG_UNTIL_INPUT } = ChromeUtils.import(</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineminus">-    &quot;resource://testing-common/mozmill/ItemEditingHelpers.jsm&quot;</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-  ));</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineminus">-</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineminus">-  createCalendar(controller, CALENDARNAME);</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineminus">-  // Rotate view.</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineminus">-  controller.waitFor(</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineminus">-    () =&gt;</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-        .getNode()</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineminus">-  );</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineminus">-});</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineminus">-</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineminus">-add_task(async function testWeeklyUntilRecurrence() {</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineminus">-  goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineminus">-</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineminus">-  // Create weekly recurring event.</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineminus">-  let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineminus">-    let { eid: eventid } = helpersForController(event);</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineminus">-</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineminus">-    plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineminus">-    event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineminus">-    menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineminus">-    wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineminus">-</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineminus">-    event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineminus">-  });</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineminus">-</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineminus">-  let box = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineminus">-</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineminus">-  // Check day view.</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineminus">-  for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineminus">-    // Monday</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineminus">-    controller.waitForElement(box);</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineminus">-    viewForward(controller, 2);</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineminus">-</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineminus">-    // Wednesday</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineminus">-    controller.waitForElement(box);</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineminus">-    viewForward(controller, 2);</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineminus">-</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineminus">-    // Friday</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineminus">-    controller.waitForElement(box);</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineminus">-    viewForward(controller, 3);</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineminus">-  }</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineminus">-</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineminus">-  // Monday, last occurrence</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineminus">-  controller.waitForElement(box);</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-  viewForward(controller, 2);</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineminus">-</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineminus">-  // Wednesday</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineminus">-  controller.waitForElementNotPresent(box);</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineminus">-</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineminus">-  // Check week view.</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineminus">-  switchToView(controller, &quot;week&quot;);</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineminus">-  goToDate(controller, 2009, 1, 5);</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineminus">-  for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineminus">-    // Monday</span>
<a href="#l17.114"></a><span id="l17.114" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, null, EVENTPATH));</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineminus">-</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineminus">-    // Wednesday</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, null, EVENTPATH));</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineminus">-</span>
<a href="#l17.119"></a><span id="l17.119" class="difflineminus">-    // Friday</span>
<a href="#l17.120"></a><span id="l17.120" class="difflineminus">-    controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, null, EVENTPATH));</span>
<a href="#l17.121"></a><span id="l17.121" class="difflineminus">-</span>
<a href="#l17.122"></a><span id="l17.122" class="difflineminus">-    viewForward(controller, 1);</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineminus">-  }</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineminus">-</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineminus">-  // Monday, last occurrence</span>
<a href="#l17.126"></a><span id="l17.126" class="difflineminus">-  controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, null, EVENTPATH));</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineminus">-  // Wednesday</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, null, EVENTPATH));</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineminus">-</span>
<a href="#l17.130"></a><span id="l17.130" class="difflineminus">-  // Check multiweek view.</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineminus">-  switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l17.132"></a><span id="l17.132" class="difflineminus">-  goToDate(controller, 2009, 1, 5);</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineminus">-  checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineminus">-</span>
<a href="#l17.135"></a><span id="l17.135" class="difflineminus">-  // Check month view.</span>
<a href="#l17.136"></a><span id="l17.136" class="difflineminus">-  switchToView(controller, &quot;month&quot;);</span>
<a href="#l17.137"></a><span id="l17.137" class="difflineminus">-  goToDate(controller, 2009, 1, 5);</span>
<a href="#l17.138"></a><span id="l17.138" class="difflineminus">-  checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l17.139"></a><span id="l17.139" class="difflineminus">-</span>
<a href="#l17.140"></a><span id="l17.140" class="difflineminus">-  // Delete event.</span>
<a href="#l17.141"></a><span id="l17.141" class="difflineminus">-  box = lookupEventBox(&quot;month&quot;, CANVAS_BOX, 2, 2, null, EVENTPATH);</span>
<a href="#l17.142"></a><span id="l17.142" class="difflineminus">-  controller.click(box);</span>
<a href="#l17.143"></a><span id="l17.143" class="difflineminus">-  handleOccurrencePrompt(controller, box, &quot;delete&quot;, true);</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineminus">-  controller.waitForElementNotPresent(box);</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineminus">-</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineminus">-  Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineminus">-});</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineminus">-</span>
<a href="#l17.149"></a><span id="l17.149" class="difflineminus">-function setRecurrence(recurrence) {</span>
<a href="#l17.150"></a><span id="l17.150" class="difflineminus">-  let { sleep: recsleep, lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l17.151"></a><span id="l17.151" class="difflineminus">-</span>
<a href="#l17.152"></a><span id="l17.152" class="difflineminus">-  // weekly</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineminus">-  recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l17.154"></a><span id="l17.154" class="difflineminus">-  menulistSelect(recid(&quot;period-list&quot;), &quot;1&quot;, recurrence);</span>
<a href="#l17.155"></a><span id="l17.155" class="difflineminus">-</span>
<a href="#l17.156"></a><span id="l17.156" class="difflineminus">-  let mon = cal.l10n.getDateFmtString(&quot;day.2.Mmm&quot;);</span>
<a href="#l17.157"></a><span id="l17.157" class="difflineminus">-  let wed = cal.l10n.getDateFmtString(&quot;day.4.Mmm&quot;);</span>
<a href="#l17.158"></a><span id="l17.158" class="difflineminus">-  let fri = cal.l10n.getDateFmtString(&quot;day.6.Mmm&quot;);</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineminus">-</span>
<a href="#l17.160"></a><span id="l17.160" class="difflineminus">-  // Starting from Monday so it should be checked. We have to wait a little,</span>
<a href="#l17.161"></a><span id="l17.161" class="difflineminus">-  // because the checkedstate is set in background by JS.</span>
<a href="#l17.162"></a><span id="l17.162" class="difflineminus">-  recurrence.waitFor(() =&gt; {</span>
<a href="#l17.163"></a><span id="l17.163" class="difflineminus">-    return recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l17.164"></a><span id="l17.164" class="difflineminus">-  }, 30000);</span>
<a href="#l17.165"></a><span id="l17.165" class="difflineminus">-  // Starting from Monday so it should be checked.</span>
<a href="#l17.166"></a><span id="l17.166" class="difflineminus">-  recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l17.167"></a><span id="l17.167" class="difflineminus">-  // Check Wednesday and Friday too.</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineminus">-  recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l17.169"></a><span id="l17.169" class="difflineminus">-  recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l17.170"></a><span id="l17.170" class="difflineminus">-</span>
<a href="#l17.171"></a><span id="l17.171" class="difflineminus">-  // Set until date.</span>
<a href="#l17.172"></a><span id="l17.172" class="difflineminus">-  recurrence.radio(recid(&quot;recurrence-range-until&quot;));</span>
<a href="#l17.173"></a><span id="l17.173" class="difflineminus">-</span>
<a href="#l17.174"></a><span id="l17.174" class="difflineminus">-  // Delete previous date.</span>
<a href="#l17.175"></a><span id="l17.175" class="difflineminus">-  let untilInput = reclookup(REC_DLG_UNTIL_INPUT);</span>
<a href="#l17.176"></a><span id="l17.176" class="difflineminus">-  recurrence.keypress(untilInput, &quot;a&quot;, { accelKey: true });</span>
<a href="#l17.177"></a><span id="l17.177" class="difflineminus">-  recurrence.keypress(untilInput, &quot;VK_DELETE&quot;, {});</span>
<a href="#l17.178"></a><span id="l17.178" class="difflineminus">-</span>
<a href="#l17.179"></a><span id="l17.179" class="difflineminus">-  let dateFormatter = cal.getDateFormatter();</span>
<a href="#l17.180"></a><span id="l17.180" class="difflineminus">-</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineminus">-  let endDateString = dateFormatter.formatDateShort(</span>
<a href="#l17.182"></a><span id="l17.182" class="difflineminus">-    cal.dtz.jsDateToDateTime(ENDDATE, cal.dtz.floating)</span>
<a href="#l17.183"></a><span id="l17.183" class="difflineminus">-  );</span>
<a href="#l17.184"></a><span id="l17.184" class="difflineminus">-  recsleep(SHORT_SLEEP);</span>
<a href="#l17.185"></a><span id="l17.185" class="difflineminus">-  recurrence.type(untilInput, endDateString);</span>
<a href="#l17.186"></a><span id="l17.186" class="difflineminus">-</span>
<a href="#l17.187"></a><span id="l17.187" class="difflineminus">-  recsleep(SHORT_SLEEP);</span>
<a href="#l17.188"></a><span id="l17.188" class="difflineminus">-  // Move focus to ensure the date is selected.</span>
<a href="#l17.189"></a><span id="l17.189" class="difflineminus">-  recurrence.keypress(untilInput, &quot;VK_TAB&quot;, {});</span>
<a href="#l17.190"></a><span id="l17.190" class="difflineminus">-</span>
<a href="#l17.191"></a><span id="l17.191" class="difflineminus">-  // Close dialog.</span>
<a href="#l17.192"></a><span id="l17.192" class="difflineminus">-  recurrence.click(reclookup(REC_DLG_ACCEPT));</span>
<a href="#l17.193"></a><span id="l17.193" class="difflineminus">-}</span>
<a href="#l17.194"></a><span id="l17.194" class="difflineminus">-</span>
<a href="#l17.195"></a><span id="l17.195" class="difflineminus">-function checkMultiWeekView(view) {</span>
<a href="#l17.196"></a><span id="l17.196" class="difflineminus">-  let startWeek = view == &quot;month&quot; ? 2 : 1;</span>
<a href="#l17.197"></a><span id="l17.197" class="difflineminus">-</span>
<a href="#l17.198"></a><span id="l17.198" class="difflineminus">-  for (let week = startWeek; week &lt; startWeek + 3; week++) {</span>
<a href="#l17.199"></a><span id="l17.199" class="difflineminus">-    // Monday</span>
<a href="#l17.200"></a><span id="l17.200" class="difflineminus">-    controller.waitForElement(lookupEventBox(view, CANVAS_BOX, week, 2, null, EVENTPATH));</span>
<a href="#l17.201"></a><span id="l17.201" class="difflineminus">-    // Wednesday</span>
<a href="#l17.202"></a><span id="l17.202" class="difflineminus">-    controller.assertNode(lookupEventBox(view, CANVAS_BOX, week, 4, null, EVENTPATH));</span>
<a href="#l17.203"></a><span id="l17.203" class="difflineminus">-    // Friday</span>
<a href="#l17.204"></a><span id="l17.204" class="difflineminus">-    controller.assertNode(lookupEventBox(view, CANVAS_BOX, week, 6, null, EVENTPATH));</span>
<a href="#l17.205"></a><span id="l17.205" class="difflineminus">-  }</span>
<a href="#l17.206"></a><span id="l17.206" class="difflineminus">-</span>
<a href="#l17.207"></a><span id="l17.207" class="difflineminus">-  // Monday, last occurrence</span>
<a href="#l17.208"></a><span id="l17.208" class="difflineminus">-  controller.assertNode(lookupEventBox(view, CANVAS_BOX, startWeek + 3, 2, null, EVENTPATH));</span>
<a href="#l17.209"></a><span id="l17.209" class="difflineminus">-</span>
<a href="#l17.210"></a><span id="l17.210" class="difflineminus">-  // Wednesday</span>
<a href="#l17.211"></a><span id="l17.211" class="difflineminus">-  controller.assertNodeNotExist(</span>
<a href="#l17.212"></a><span id="l17.212" class="difflineminus">-    lookupEventBox(view, CANVAS_BOX, startWeek + 3, 4, null, EVENTPATH)</span>
<a href="#l17.213"></a><span id="l17.213" class="difflineminus">-  );</span>
<a href="#l17.214"></a><span id="l17.214" class="difflineminus">-}</span>
<a href="#l17.215"></a><span id="l17.215" class="difflineminus">-</span>
<a href="#l17.216"></a><span id="l17.216" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l17.217"></a><span id="l17.217" class="difflineminus">-  deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l17.218"></a><span id="l17.218" class="difflineminus">-  // Reset view.</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.220"></a><span id="l17.220" class="difflineminus">-  if (</span>
<a href="#l17.221"></a><span id="l17.221" class="difflineminus">-    eid(&quot;day-view&quot;)</span>
<a href="#l17.222"></a><span id="l17.222" class="difflineminus">-      .getNode()</span>
<a href="#l17.223"></a><span id="l17.223" class="difflineminus">-      .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l17.224"></a><span id="l17.224" class="difflineminus">-  ) {</span>
<a href="#l17.225"></a><span id="l17.225" class="difflineminus">-    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l17.226"></a><span id="l17.226" class="difflineminus">-  }</span>
<a href="#l17.227"></a><span id="l17.227" class="difflineminus">-  controller.waitFor(</span>
<a href="#l17.228"></a><span id="l17.228" class="difflineminus">-    () =&gt;</span>
<a href="#l17.229"></a><span id="l17.229" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l17.230"></a><span id="l17.230" class="difflineminus">-        .getNode()</span>
<a href="#l17.231"></a><span id="l17.231" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;vertical&quot;</span>
<a href="#l17.232"></a><span id="l17.232" class="difflineminus">-  );</span>
<a href="#l17.233"></a><span id="l17.233" class="difflineminus">-  closeAllEventDialogs();</span>
<a href="#l17.234"></a><span id="l17.234" class="difflineminus">-});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">deleted file mode 100755</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ /dev/null</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -1,298 +0,0 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineminus">-</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineminus">-var mozmill = ChromeUtils.import(&quot;resource://testing-common/mozmill/mozmill.jsm&quot;);</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineminus">-</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineminus">-var {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  CALENDARNAME,</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-  CANVAS_BOX,</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-  DAY_VIEW,</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-  EVENTPATH,</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-  EVENT_BOX,</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">-  TIMEOUT_MODAL_DIALOG,</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-  WEEK_VIEW,</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">-  closeAllEventDialogs,</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineminus">-  createCalendar,</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">-  deleteCalendars,</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineminus">-  goToDate,</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">-  handleOccurrencePrompt,</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-  helpersForController,</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-  invokeEventDialog,</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineminus">-  menulistSelect,</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineminus">-  switchToView,</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineminus">-  viewForward,</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineminus">-} = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-var {</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-  REC_DLG_ACCEPT,</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-  REC_DLG_DAYS,</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-  REPEAT_DETAILS,</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">-  helpersForEditUI,</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineminus">-  setData,</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineminus">-} = ChromeUtils.import(&quot;resource://testing-common/mozmill/ItemEditingHelpers.jsm&quot;);</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineminus">-var { plan_for_modal_dialog, wait_for_modal_dialog } = ChromeUtils.import(</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-  &quot;resource://testing-common/mozmill/WindowHelpers.jsm&quot;</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-);</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">-var { cal } = ChromeUtils.import(&quot;resource:///modules/calendar/calUtils.jsm&quot;);</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineminus">-var controller = mozmill.getMail3PaneController();</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineminus">-var { eid, lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineminus">-</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineminus">-const HOUR = 8;</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineminus">-const STARTDATE = new Date(2009, 0, 6);</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineminus">-</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineminus">-add_task(async function testWeeklyWithExceptionRecurrence() {</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-  createCalendar(controller, CALENDARNAME);</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineminus">-  goToDate(controller, 2009, 1, 5);</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineminus">-</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineminus">-  // Rotate view.</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineminus">-  controller.waitFor(</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineminus">-    () =&gt;</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineminus">-        .getNode()</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineminus">-  );</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineminus">-</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineminus">-  // Create weekly recurring event.</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineminus">-  let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineminus">-    let { eid: eventid } = helpersForController(event);</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineminus">-</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineminus">-    event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineminus">-    plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineminus">-    menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineminus">-    wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineminus">-</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineminus">-    event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineminus">-  });</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineminus">-</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineminus">-  // Move 5th January occurrence to 6th January.</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineminus">-  eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l18.78"></a><span id="l18.78" class="difflineminus">-  handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, false);</span>
<a href="#l18.79"></a><span id="l18.79" class="difflineminus">-  await invokeEventDialog(controller, null, async (event, iframe) =&gt; {</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineminus">-    let { eid: eventid } = helpersForController(event);</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineminus">-</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineminus">-    await setData(event, iframe, { startdate: STARTDATE, enddate: STARTDATE });</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineminus">-    event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l18.84"></a><span id="l18.84" class="difflineminus">-  });</span>
<a href="#l18.85"></a><span id="l18.85" class="difflineminus">-</span>
<a href="#l18.86"></a><span id="l18.86" class="difflineminus">-  // Change recurrence rule.</span>
<a href="#l18.87"></a><span id="l18.87" class="difflineminus">-  goToDate(controller, 2009, 1, 7);</span>
<a href="#l18.88"></a><span id="l18.88" class="difflineminus">-  eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l18.89"></a><span id="l18.89" class="difflineminus">-  handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true);</span>
<a href="#l18.90"></a><span id="l18.90" class="difflineminus">-  await invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l18.91"></a><span id="l18.91" class="difflineminus">-    let { eid: eventid } = helpersForController(event);</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineminus">-    let { iframeLookup } = helpersForEditUI(iframe);</span>
<a href="#l18.93"></a><span id="l18.93" class="difflineminus">-</span>
<a href="#l18.94"></a><span id="l18.94" class="difflineminus">-    event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l18.95"></a><span id="l18.95" class="difflineminus">-    plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, changeRecurrence);</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineminus">-    event.click(iframeLookup(REPEAT_DETAILS));</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineminus">-    wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l18.98"></a><span id="l18.98" class="difflineminus">-</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineminus">-    event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l18.100"></a><span id="l18.100" class="difflineminus">-  });</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineminus">-</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineminus">-  // Check two weeks.</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineminus">-  // day view</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.105"></a><span id="l18.105" class="difflineminus">-  let path = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l18.106"></a><span id="l18.106" class="difflineminus">-</span>
<a href="#l18.107"></a><span id="l18.107" class="difflineminus">-  goToDate(controller, 2009, 1, 5);</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineminus">-  controller.waitForElementNotPresent(path);</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineminus">-</span>
<a href="#l18.110"></a><span id="l18.110" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.111"></a><span id="l18.111" class="difflineminus">-  let tuesPath = `</span>
<a href="#l18.112"></a><span id="l18.112" class="difflineminus">-        ${DAY_VIEW}/{&quot;class&quot;:&quot;mainbox&quot;}/{&quot;class&quot;:&quot;scrollbox&quot;}/</span>
<a href="#l18.113"></a><span id="l18.113" class="difflineminus">-        {&quot;class&quot;:&quot;daybox&quot;}/[0]/{&quot;class&quot;:&quot;multiday-column-box-stack&quot;}/</span>
<a href="#l18.114"></a><span id="l18.114" class="difflineminus">-        {&quot;class&quot;:&quot;multiday-column-top-box&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]</span>
<a href="#l18.115"></a><span id="l18.115" class="difflineminus">-    `;</span>
<a href="#l18.116"></a><span id="l18.116" class="difflineminus">-</span>
<a href="#l18.117"></a><span id="l18.117" class="difflineminus">-  // Assert exactly two.</span>
<a href="#l18.118"></a><span id="l18.118" class="difflineminus">-  controller.waitForElement(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + EVENTPATH));</span>
<a href="#l18.119"></a><span id="l18.119" class="difflineminus">-  controller.assertNode(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + EVENTPATH));</span>
<a href="#l18.120"></a><span id="l18.120" class="difflineminus">-  controller.assertNodeNotExist(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + EVENTPATH));</span>
<a href="#l18.121"></a><span id="l18.121" class="difflineminus">-</span>
<a href="#l18.122"></a><span id="l18.122" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineminus">-  controller.waitForElement(path);</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineminus">-  controller.waitForElementNotPresent(path);</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineminus">-  controller.waitForElement(path);</span>
<a href="#l18.128"></a><span id="l18.128" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.129"></a><span id="l18.129" class="difflineminus">-  controller.waitForElementNotPresent(path);</span>
<a href="#l18.130"></a><span id="l18.130" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.131"></a><span id="l18.131" class="difflineminus">-  controller.waitForElementNotPresent(path);</span>
<a href="#l18.132"></a><span id="l18.132" class="difflineminus">-</span>
<a href="#l18.133"></a><span id="l18.133" class="difflineminus">-  // next week</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.135"></a><span id="l18.135" class="difflineminus">-  controller.waitForElement(path);</span>
<a href="#l18.136"></a><span id="l18.136" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineminus">-  controller.waitForElement(path);</span>
<a href="#l18.138"></a><span id="l18.138" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.139"></a><span id="l18.139" class="difflineminus">-  controller.waitForElement(path);</span>
<a href="#l18.140"></a><span id="l18.140" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.141"></a><span id="l18.141" class="difflineminus">-  controller.waitForElementNotPresent(path);</span>
<a href="#l18.142"></a><span id="l18.142" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.143"></a><span id="l18.143" class="difflineminus">-  controller.waitForElement(path);</span>
<a href="#l18.144"></a><span id="l18.144" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.145"></a><span id="l18.145" class="difflineminus">-  controller.waitForElementNotPresent(path);</span>
<a href="#l18.146"></a><span id="l18.146" class="difflineminus">-</span>
<a href="#l18.147"></a><span id="l18.147" class="difflineminus">-  // week view</span>
<a href="#l18.148"></a><span id="l18.148" class="difflineminus">-  switchToView(controller, &quot;week&quot;);</span>
<a href="#l18.149"></a><span id="l18.149" class="difflineminus">-  goToDate(controller, 2009, 1, 5);</span>
<a href="#l18.150"></a><span id="l18.150" class="difflineminus">-</span>
<a href="#l18.151"></a><span id="l18.151" class="difflineminus">-  tuesPath = `</span>
<a href="#l18.152"></a><span id="l18.152" class="difflineminus">-        ${WEEK_VIEW}/{&quot;class&quot;:&quot;mainbox&quot;}/{&quot;class&quot;:&quot;scrollbox&quot;}/</span>
<a href="#l18.153"></a><span id="l18.153" class="difflineminus">-        {&quot;class&quot;:&quot;daybox&quot;}/[2]/{&quot;class&quot;:&quot;multiday-column-box-stack&quot;}/</span>
<a href="#l18.154"></a><span id="l18.154" class="difflineminus">-        {&quot;class&quot;:&quot;multiday-column-top-box&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]</span>
<a href="#l18.155"></a><span id="l18.155" class="difflineminus">-    `;</span>
<a href="#l18.156"></a><span id="l18.156" class="difflineminus">-</span>
<a href="#l18.157"></a><span id="l18.157" class="difflineminus">-  // Assert exactly two.</span>
<a href="#l18.158"></a><span id="l18.158" class="difflineminus">-  controller.waitForElement(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + EVENTPATH));</span>
<a href="#l18.159"></a><span id="l18.159" class="difflineminus">-  controller.assertNode(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + EVENTPATH));</span>
<a href="#l18.160"></a><span id="l18.160" class="difflineminus">-  controller.assertNodeNotExist(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + EVENTPATH));</span>
<a href="#l18.161"></a><span id="l18.161" class="difflineminus">-</span>
<a href="#l18.162"></a><span id="l18.162" class="difflineminus">-  // Wait for the last occurrence because this appears last.</span>
<a href="#l18.163"></a><span id="l18.163" class="difflineminus">-  controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, null));</span>
<a href="#l18.164"></a><span id="l18.164" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 1, null));</span>
<a href="#l18.165"></a><span id="l18.165" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, null));</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineminus">-  controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, null));</span>
<a href="#l18.167"></a><span id="l18.167" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 5, null));</span>
<a href="#l18.168"></a><span id="l18.168" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null));</span>
<a href="#l18.169"></a><span id="l18.169" class="difflineminus">-</span>
<a href="#l18.170"></a><span id="l18.170" class="difflineminus">-  viewForward(controller, 1);</span>
<a href="#l18.171"></a><span id="l18.171" class="difflineminus">-  controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, null));</span>
<a href="#l18.172"></a><span id="l18.172" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 1, null));</span>
<a href="#l18.173"></a><span id="l18.173" class="difflineminus">-  controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, null));</span>
<a href="#l18.174"></a><span id="l18.174" class="difflineminus">-  controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 3, null));</span>
<a href="#l18.175"></a><span id="l18.175" class="difflineminus">-  controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, null));</span>
<a href="#l18.176"></a><span id="l18.176" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 5, null));</span>
<a href="#l18.177"></a><span id="l18.177" class="difflineminus">-  controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null));</span>
<a href="#l18.178"></a><span id="l18.178" class="difflineminus">-</span>
<a href="#l18.179"></a><span id="l18.179" class="difflineminus">-  // multiweek view</span>
<a href="#l18.180"></a><span id="l18.180" class="difflineminus">-  switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l18.181"></a><span id="l18.181" class="difflineminus">-  goToDate(controller, 2009, 1, 5);</span>
<a href="#l18.182"></a><span id="l18.182" class="difflineminus">-  checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l18.183"></a><span id="l18.183" class="difflineminus">-</span>
<a href="#l18.184"></a><span id="l18.184" class="difflineminus">-  // month view</span>
<a href="#l18.185"></a><span id="l18.185" class="difflineminus">-  switchToView(controller, &quot;month&quot;);</span>
<a href="#l18.186"></a><span id="l18.186" class="difflineminus">-  checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l18.187"></a><span id="l18.187" class="difflineminus">-</span>
<a href="#l18.188"></a><span id="l18.188" class="difflineminus">-  // Delete event.</span>
<a href="#l18.189"></a><span id="l18.189" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.190"></a><span id="l18.190" class="difflineminus">-  goToDate(controller, 2009, 1, 12);</span>
<a href="#l18.191"></a><span id="l18.191" class="difflineminus">-  path = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l18.192"></a><span id="l18.192" class="difflineminus">-  controller.click(path);</span>
<a href="#l18.193"></a><span id="l18.193" class="difflineminus">-  handleOccurrencePrompt(controller, path, &quot;delete&quot;, true);</span>
<a href="#l18.194"></a><span id="l18.194" class="difflineminus">-  controller.waitForElementNotPresent(path);</span>
<a href="#l18.195"></a><span id="l18.195" class="difflineminus">-</span>
<a href="#l18.196"></a><span id="l18.196" class="difflineminus">-  Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l18.197"></a><span id="l18.197" class="difflineminus">-});</span>
<a href="#l18.198"></a><span id="l18.198" class="difflineminus">-</span>
<a href="#l18.199"></a><span id="l18.199" class="difflineminus">-function setRecurrence(recurrence) {</span>
<a href="#l18.200"></a><span id="l18.200" class="difflineminus">-  let { lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l18.201"></a><span id="l18.201" class="difflineminus">-</span>
<a href="#l18.202"></a><span id="l18.202" class="difflineminus">-  // weekly</span>
<a href="#l18.203"></a><span id="l18.203" class="difflineminus">-  menulistSelect(recid(&quot;period-list&quot;), &quot;1&quot;, recurrence);</span>
<a href="#l18.204"></a><span id="l18.204" class="difflineminus">-</span>
<a href="#l18.205"></a><span id="l18.205" class="difflineminus">-  let mon = cal.l10n.getDateFmtString(&quot;day.2.Mmm&quot;);</span>
<a href="#l18.206"></a><span id="l18.206" class="difflineminus">-  let wed = cal.l10n.getDateFmtString(&quot;day.4.Mmm&quot;);</span>
<a href="#l18.207"></a><span id="l18.207" class="difflineminus">-  let fri = cal.l10n.getDateFmtString(&quot;day.6.Mmm&quot;);</span>
<a href="#l18.208"></a><span id="l18.208" class="difflineminus">-</span>
<a href="#l18.209"></a><span id="l18.209" class="difflineminus">-  // Starting from Monday so it should be checked. We have to wait a little,</span>
<a href="#l18.210"></a><span id="l18.210" class="difflineminus">-  // because the checkedstate is set in background by JS.</span>
<a href="#l18.211"></a><span id="l18.211" class="difflineminus">-  recurrence.waitFor(() =&gt; {</span>
<a href="#l18.212"></a><span id="l18.212" class="difflineminus">-    return recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l18.213"></a><span id="l18.213" class="difflineminus">-  }, 10000);</span>
<a href="#l18.214"></a><span id="l18.214" class="difflineminus">-  // Check Wednesday and Friday too.</span>
<a href="#l18.215"></a><span id="l18.215" class="difflineminus">-  recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l18.216"></a><span id="l18.216" class="difflineminus">-  recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l18.217"></a><span id="l18.217" class="difflineminus">-  recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l18.218"></a><span id="l18.218" class="difflineminus">-  recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l18.219"></a><span id="l18.219" class="difflineminus">-</span>
<a href="#l18.220"></a><span id="l18.220" class="difflineminus">-  // Close dialog.</span>
<a href="#l18.221"></a><span id="l18.221" class="difflineminus">-  recurrence.click(reclookup(REC_DLG_ACCEPT));</span>
<a href="#l18.222"></a><span id="l18.222" class="difflineminus">-}</span>
<a href="#l18.223"></a><span id="l18.223" class="difflineminus">-</span>
<a href="#l18.224"></a><span id="l18.224" class="difflineminus">-function changeRecurrence(recurrence) {</span>
<a href="#l18.225"></a><span id="l18.225" class="difflineminus">-  let { lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l18.226"></a><span id="l18.226" class="difflineminus">-</span>
<a href="#l18.227"></a><span id="l18.227" class="difflineminus">-  // weekly</span>
<a href="#l18.228"></a><span id="l18.228" class="difflineminus">-  menulistSelect(recid(&quot;period-list&quot;), &quot;1&quot;, recurrence);</span>
<a href="#l18.229"></a><span id="l18.229" class="difflineminus">-</span>
<a href="#l18.230"></a><span id="l18.230" class="difflineminus">-  let mon = cal.l10n.getDateFmtString(&quot;day.2.Mmm&quot;);</span>
<a href="#l18.231"></a><span id="l18.231" class="difflineminus">-  let tue = cal.l10n.getDateFmtString(&quot;day.3.Mmm&quot;);</span>
<a href="#l18.232"></a><span id="l18.232" class="difflineminus">-  let wed = cal.l10n.getDateFmtString(&quot;day.4.Mmm&quot;);</span>
<a href="#l18.233"></a><span id="l18.233" class="difflineminus">-  let fri = cal.l10n.getDateFmtString(&quot;day.6.Mmm&quot;);</span>
<a href="#l18.234"></a><span id="l18.234" class="difflineminus">-</span>
<a href="#l18.235"></a><span id="l18.235" class="difflineminus">-  // Check old rule.</span>
<a href="#l18.236"></a><span id="l18.236" class="difflineminus">-  // Starting from Monday so it should be checked. We have to wait a little,</span>
<a href="#l18.237"></a><span id="l18.237" class="difflineminus">-  // because the checkedstate is set in background by JS.</span>
<a href="#l18.238"></a><span id="l18.238" class="difflineminus">-  recurrence.waitFor(() =&gt; {</span>
<a href="#l18.239"></a><span id="l18.239" class="difflineminus">-    return recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l18.240"></a><span id="l18.240" class="difflineminus">-  }, 10000);</span>
<a href="#l18.241"></a><span id="l18.241" class="difflineminus">-  recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l18.242"></a><span id="l18.242" class="difflineminus">-  recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l18.243"></a><span id="l18.243" class="difflineminus">-</span>
<a href="#l18.244"></a><span id="l18.244" class="difflineminus">-  // Check Tuesday.</span>
<a href="#l18.245"></a><span id="l18.245" class="difflineminus">-  recurrence.click(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l18.246"></a><span id="l18.246" class="difflineminus">-  recurrence.assertChecked(reclookup(`${REC_DLG_DAYS}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l18.247"></a><span id="l18.247" class="difflineminus">-</span>
<a href="#l18.248"></a><span id="l18.248" class="difflineminus">-  // Close dialog.</span>
<a href="#l18.249"></a><span id="l18.249" class="difflineminus">-  recurrence.click(reclookup(REC_DLG_ACCEPT));</span>
<a href="#l18.250"></a><span id="l18.250" class="difflineminus">-}</span>
<a href="#l18.251"></a><span id="l18.251" class="difflineminus">-</span>
<a href="#l18.252"></a><span id="l18.252" class="difflineminus">-function checkMultiWeekView(view) {</span>
<a href="#l18.253"></a><span id="l18.253" class="difflineminus">-  let startWeek = view == &quot;multiweek&quot; ? 1 : 2;</span>
<a href="#l18.254"></a><span id="l18.254" class="difflineminus">-  let assertNodeLookup = (...args) =&gt; {</span>
<a href="#l18.255"></a><span id="l18.255" class="difflineminus">-    return controller.assertNode(lookupEventBox(...args));</span>
<a href="#l18.256"></a><span id="l18.256" class="difflineminus">-  };</span>
<a href="#l18.257"></a><span id="l18.257" class="difflineminus">-  let assertNodeNotExistLookup = (...args) =&gt; {</span>
<a href="#l18.258"></a><span id="l18.258" class="difflineminus">-    return controller.assertNodeNotExist(lookupEventBox(...args));</span>
<a href="#l18.259"></a><span id="l18.259" class="difflineminus">-  };</span>
<a href="#l18.260"></a><span id="l18.260" class="difflineminus">-</span>
<a href="#l18.261"></a><span id="l18.261" class="difflineminus">-  // Wait for the first items, then check the ones not to be present.</span>
<a href="#l18.262"></a><span id="l18.262" class="difflineminus">-  // Assert exactly two.</span>
<a href="#l18.263"></a><span id="l18.263" class="difflineminus">-  controller.waitForElement(lookupEventBox(view, EVENT_BOX, startWeek, 3, null, &quot;/[0]&quot;));</span>
<a href="#l18.264"></a><span id="l18.264" class="difflineminus">-  assertNodeLookup(view, CANVAS_BOX, startWeek, 3, null, &quot;/[1]&quot;);</span>
<a href="#l18.265"></a><span id="l18.265" class="difflineminus">-  assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 3, null, &quot;/[2]&quot;);</span>
<a href="#l18.266"></a><span id="l18.266" class="difflineminus">-  // Then check no item on the 5th.</span>
<a href="#l18.267"></a><span id="l18.267" class="difflineminus">-  assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 2, null, EVENTPATH);</span>
<a href="#l18.268"></a><span id="l18.268" class="difflineminus">-  assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 3, null, &quot;/[2]&quot;);</span>
<a href="#l18.269"></a><span id="l18.269" class="difflineminus">-  assertNodeLookup(view, CANVAS_BOX, startWeek, 4, null, EVENTPATH);</span>
<a href="#l18.270"></a><span id="l18.270" class="difflineminus">-  assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 5, null, EVENTPATH);</span>
<a href="#l18.271"></a><span id="l18.271" class="difflineminus">-  assertNodeLookup(view, CANVAS_BOX, startWeek, 6, null, EVENTPATH);</span>
<a href="#l18.272"></a><span id="l18.272" class="difflineminus">-  assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 7, null, EVENTPATH);</span>
<a href="#l18.273"></a><span id="l18.273" class="difflineminus">-</span>
<a href="#l18.274"></a><span id="l18.274" class="difflineminus">-  assertNodeNotExistLookup(view, EVENT_BOX, startWeek + 1, 1, null, EVENTPATH);</span>
<a href="#l18.275"></a><span id="l18.275" class="difflineminus">-  assertNodeLookup(view, CANVAS_BOX, startWeek + 1, 2, null, EVENTPATH);</span>
<a href="#l18.276"></a><span id="l18.276" class="difflineminus">-  assertNodeLookup(view, CANVAS_BOX, startWeek + 1, 3, null, EVENTPATH);</span>
<a href="#l18.277"></a><span id="l18.277" class="difflineminus">-  assertNodeLookup(view, CANVAS_BOX, startWeek + 1, 4, null, EVENTPATH);</span>
<a href="#l18.278"></a><span id="l18.278" class="difflineminus">-  assertNodeNotExistLookup(view, EVENT_BOX, startWeek + 1, 5, null, EVENTPATH);</span>
<a href="#l18.279"></a><span id="l18.279" class="difflineminus">-  assertNodeLookup(view, CANVAS_BOX, startWeek + 1, 6, null, EVENTPATH);</span>
<a href="#l18.280"></a><span id="l18.280" class="difflineminus">-  assertNodeNotExistLookup(view, EVENT_BOX, startWeek + 1, 7, null, EVENTPATH);</span>
<a href="#l18.281"></a><span id="l18.281" class="difflineminus">-}</span>
<a href="#l18.282"></a><span id="l18.282" class="difflineminus">-</span>
<a href="#l18.283"></a><span id="l18.283" class="difflineminus">-registerCleanupFunction(function teardownModule(module) {</span>
<a href="#l18.284"></a><span id="l18.284" class="difflineminus">-  deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l18.285"></a><span id="l18.285" class="difflineminus">-</span>
<a href="#l18.286"></a><span id="l18.286" class="difflineminus">-  // Reset view.</span>
<a href="#l18.287"></a><span id="l18.287" class="difflineminus">-  switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.288"></a><span id="l18.288" class="difflineminus">-  if (</span>
<a href="#l18.289"></a><span id="l18.289" class="difflineminus">-    eid(&quot;day-view&quot;)</span>
<a href="#l18.290"></a><span id="l18.290" class="difflineminus">-      .getNode()</span>
<a href="#l18.291"></a><span id="l18.291" class="difflineminus">-      .getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;</span>
<a href="#l18.292"></a><span id="l18.292" class="difflineminus">-  ) {</span>
<a href="#l18.293"></a><span id="l18.293" class="difflineminus">-    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l18.294"></a><span id="l18.294" class="difflineminus">-  }</span>
<a href="#l18.295"></a><span id="l18.295" class="difflineminus">-  controller.waitFor(</span>
<a href="#l18.296"></a><span id="l18.296" class="difflineminus">-    () =&gt;</span>
<a href="#l18.297"></a><span id="l18.297" class="difflineminus">-      eid(&quot;day-view&quot;)</span>
<a href="#l18.298"></a><span id="l18.298" class="difflineminus">-        .getNode()</span>
<a href="#l18.299"></a><span id="l18.299" class="difflineminus">-        .getAttribute(&quot;orient&quot;) == &quot;vertical&quot;</span>
<a href="#l18.300"></a><span id="l18.300" class="difflineminus">-  );</span>
<a href="#l18.301"></a><span id="l18.301" class="difflineminus">-  closeAllEventDialogs();</span>
<a href="#l18.302"></a><span id="l18.302" class="difflineminus">-});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/test/moz.build</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/test/moz.build</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -4,17 +4,17 @@</span>
<a href="#l19.4"></a><span id="l19.4"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6"> BROWSER_CHROME_MANIFESTS += [</span>
<a href="#l19.7"></a><span id="l19.7">     'browser/browser.ini',</span>
<a href="#l19.8"></a><span id="l19.8">     'browser/eventDialog/browser.ini',</span>
<a href="#l19.9"></a><span id="l19.9">     'browser/invitations/browser.ini',</span>
<a href="#l19.10"></a><span id="l19.10">     'browser/preferences/browser.ini',</span>
<a href="#l19.11"></a><span id="l19.11">     'browser/recurrence/browser.ini',</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    'browser/recurrenceRotated/browser.ini',</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    'browser/recurrence/browser_rotated.ini',</span>
<a href="#l19.14"></a><span id="l19.14">     'browser/views/browser.ini',</span>
<a href="#l19.15"></a><span id="l19.15"> ]</span>
<a href="#l19.16"></a><span id="l19.16"> </span>
<a href="#l19.17"></a><span id="l19.17"> TESTING_JS_MODULES.mozmill += [</span>
<a href="#l19.18"></a><span id="l19.18">     'modules/CalendarUtils.jsm',</span>
<a href="#l19.19"></a><span id="l19.19">     'modules/ItemEditingHelpers.jsm',</span>
<a href="#l19.20"></a><span id="l19.20"> ]</span>
<a href="#l19.21"></a><span id="l19.21"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

