<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 7652:ca4bc28d9024a45859c85ee167971200f9c69929</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ca4bc28d9024a45859c85ee167971200f9c69929" />
<meta property="og:url" content="/comm-central/rev/ca4bc28d9024a45859c85ee167971200f9c69929" />
<meta property="og:description" content="fix build bustage, bug 653865, 5.0 parts of patch by bienvenu r=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ca4bc28d9024a45859c85ee167971200f9c69929 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ca4bc28d9024a45859c85ee167971200f9c69929">shortlog</a> |
<a href="/comm-central/log/ca4bc28d9024a45859c85ee167971200f9c69929">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ca4bc28d9024a45859c85ee167971200f9c69929">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ca4bc28d9024a45859c85ee167971200f9c69929">files</a> |
changeset |
<a href="/comm-central/raw-rev/ca4bc28d9024a45859c85ee167971200f9c69929">raw</a>  | <a href="/comm-central/archive/ca4bc28d9024a45859c85ee167971200f9c69929.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
fix build bustage, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=653865">bug 653865</a>, 5.0 parts of patch by bienvenu r=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#108;&#105;&#112;&#32;&#67;&#104;&#101;&#101;&#32;&#60;&#112;&#104;&#105;&#108;&#105;&#112;&#46;&#99;&#104;&#101;&#101;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 30 Apr 2011 08:50:51 -0700</td></tr>

<tr>
 <td>changeset 7652</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ca4bc28d9024a45859c85ee167971200f9c69929">ca4bc28d9024a45859c85ee167971200f9c69929</a></td>
</tr>



<tr>
<td>parent 7651</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/44982b66c8f2d52d3f338355c31c79796a615441">44982b66c8f2d52d3f338355c31c79796a615441</a>
</td>
</tr>

<tr>
<td>child 7653</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f63bf0fcb0c1735a09bae59ca1d53ffa258e57e3">f63bf0fcb0c1735a09bae59ca1d53ffa258e57e3</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ca4bc28d9024a45859c85ee167971200f9c69929">5875</a></td></tr>
<tr><td>push user</td><td>bienvenu@nventure.com</td></tr>
<tr><td>push date</td><td class="date age">Sat, 30 Apr 2011 15:50:47 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ca4bc28d9024 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ca4bc28d9024a45859c85ee167971200f9c69929">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ca4bc28d9024a45859c85ee167971200f9c69929&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ca4bc28d9024a45859c85ee167971200f9c69929&newProject=comm-central&newRevision=ca4bc28d9024a45859c85ee167971200f9c69929&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ca4bc28d9024a45859c85ee167971200f9c69929&newProject=comm-central&newRevision=ca4bc28d9024a45859c85ee167971200f9c69929&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ca4bc28d9024a45859c85ee167971200f9c69929&newProject=comm-central&newRevision=ca4bc28d9024a45859c85ee167971200f9c69929&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=653865">653865</a></td></tr>




</table></div>

<div class="page_body description">fix build bustage, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=653865">bug 653865</a>, 5.0 parts of patch by bienvenu r=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.h">mailnews/imap/src/nsImapProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.h">file</a> |
<a href="/comm-central/annotate/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.h">annotate</a> |
<a href="/comm-central/diff/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.h">diff</a> |
<a href="/comm-central/comparison/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.h">comparison</a> |
<a href="/comm-central/log/ca4bc28d9024a45859c85ee167971200f9c69929/mailnews/imap/src/nsImapProtocol.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1156,17 +1156,17 @@ NS_IMETHODIMP nsImapProtocol::OnInputStr</span>
<a href="#l1.4"></a><span id="l1.4">   // should we check if it's a close vs. data available?</span>
<a href="#l1.5"></a><span id="l1.5">   if (m_idle)</span>
<a href="#l1.6"></a><span id="l1.6">   {</span>
<a href="#l1.7"></a><span id="l1.7">     PRUint32 bytesAvailable = 0;</span>
<a href="#l1.8"></a><span id="l1.8">     (void) inStr-&gt;Available(&amp;bytesAvailable);</span>
<a href="#l1.9"></a><span id="l1.9">     // check if data available - might be a close</span>
<a href="#l1.10"></a><span id="l1.10">     if (bytesAvailable != 0)</span>
<a href="#l1.11"></a><span id="l1.11">     {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      MonitorAutoEnter mon(m_urlReadyToRunMonitor);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      ReentrantMonitorAutoEnter mon(m_urlReadyToRunMonitor);</span>
<a href="#l1.14"></a><span id="l1.14">       m_lastActiveTime = PR_Now();</span>
<a href="#l1.15"></a><span id="l1.15">       m_nextUrlReadyToRun = PR_TRUE;</span>
<a href="#l1.16"></a><span id="l1.16">       mon.Notify();</span>
<a href="#l1.17"></a><span id="l1.17">     }</span>
<a href="#l1.18"></a><span id="l1.18">   }</span>
<a href="#l1.19"></a><span id="l1.19">   return NS_OK;</span>
<a href="#l1.20"></a><span id="l1.20"> }</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -1187,21 +1187,21 @@ nsImapProtocol::TellThreadToDie(PRBool a</span>
<a href="#l1.23"></a><span id="l1.23">     nsCOMPtr&lt;nsIImapIncomingServer&gt;</span>
<a href="#l1.24"></a><span id="l1.24">       aImapServer(do_QueryInterface(me_server, &amp;rv));</span>
<a href="#l1.25"></a><span id="l1.25">     if (NS_SUCCEEDED(rv))</span>
<a href="#l1.26"></a><span id="l1.26">       aImapServer-&gt;RemoveConnection(this);</span>
<a href="#l1.27"></a><span id="l1.27">     m_server = nsnull;</span>
<a href="#l1.28"></a><span id="l1.28">     me_server = nsnull;</span>
<a href="#l1.29"></a><span id="l1.29">   }</span>
<a href="#l1.30"></a><span id="l1.30">   {</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-    MonitorAutoEnter deathMon(m_threadDeathMonitor);</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+    ReentrantMonitorAutoEnter deathMon(m_threadDeathMonitor);</span>
<a href="#l1.33"></a><span id="l1.33">     m_safeToCloseConnection = aIsSafeToClose;</span>
<a href="#l1.34"></a><span id="l1.34">     m_threadShouldDie = PR_TRUE;</span>
<a href="#l1.35"></a><span id="l1.35">   }</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-  MonitorAutoEnter readyMon(m_urlReadyToRunMonitor);</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+  ReentrantMonitorAutoEnter readyMon(m_urlReadyToRunMonitor);</span>
<a href="#l1.38"></a><span id="l1.38">   m_nextUrlReadyToRun = PR_TRUE;</span>
<a href="#l1.39"></a><span id="l1.39">   readyMon.Notify();</span>
<a href="#l1.40"></a><span id="l1.40">   return NS_OK;</span>
<a href="#l1.41"></a><span id="l1.41"> }</span>
<a href="#l1.42"></a><span id="l1.42"> </span>
<a href="#l1.43"></a><span id="l1.43"> void</span>
<a href="#l1.44"></a><span id="l1.44"> nsImapProtocol::TellThreadToDie()</span>
<a href="#l1.45"></a><span id="l1.45"> {</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineat">@@ -1259,24 +1259,24 @@ nsImapProtocol::TellThreadToDie()</span>
<a href="#l1.47"></a><span id="l1.47">   if (m_imapProtocolSink) </span>
<a href="#l1.48"></a><span id="l1.48">   {</span>
<a href="#l1.49"></a><span id="l1.49">     m_imapProtocolSink-&gt;CloseStreams();</span>
<a href="#l1.50"></a><span id="l1.50">     m_imapProtocolSink = nsnull;</span>
<a href="#l1.51"></a><span id="l1.51">   }</span>
<a href="#l1.52"></a><span id="l1.52">   Log(&quot;TellThreadToDie&quot;, nsnull, &quot;close socket connection&quot;);</span>
<a href="#l1.53"></a><span id="l1.53"> </span>
<a href="#l1.54"></a><span id="l1.54">   {</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-    MonitorAutoEnter mon(m_threadDeathMonitor);</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+    ReentrantMonitorAutoEnter mon(m_threadDeathMonitor);</span>
<a href="#l1.57"></a><span id="l1.57">     m_threadShouldDie = PR_TRUE;</span>
<a href="#l1.58"></a><span id="l1.58">   }</span>
<a href="#l1.59"></a><span id="l1.59">   {</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-    MonitorAutoEnter dataMon(m_dataAvailableMonitor);</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+    ReentrantMonitorAutoEnter dataMon(m_dataAvailableMonitor);</span>
<a href="#l1.62"></a><span id="l1.62">     dataMon.Notify();</span>
<a href="#l1.63"></a><span id="l1.63">   }</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-  MonitorAutoEnter urlReadyMon(m_urlReadyToRunMonitor);</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+  ReentrantMonitorAutoEnter urlReadyMon(m_urlReadyToRunMonitor);</span>
<a href="#l1.66"></a><span id="l1.66">   urlReadyMon.NotifyAll();</span>
<a href="#l1.67"></a><span id="l1.67"> }</span>
<a href="#l1.68"></a><span id="l1.68"> </span>
<a href="#l1.69"></a><span id="l1.69"> NS_IMETHODIMP</span>
<a href="#l1.70"></a><span id="l1.70"> nsImapProtocol::GetLastActiveTimeStamp(PRTime* aTimeStamp)</span>
<a href="#l1.71"></a><span id="l1.71"> {</span>
<a href="#l1.72"></a><span id="l1.72">   if (aTimeStamp)</span>
<a href="#l1.73"></a><span id="l1.73">     *aTimeStamp = m_lastActiveTime;</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineat">@@ -1333,17 +1333,17 @@ nsImapProtocol::ImapThreadMainLoop()</span>
<a href="#l1.75"></a><span id="l1.75">   PRIntervalTime sleepTime = kImapSleepTime;</span>
<a href="#l1.76"></a><span id="l1.76">   while (!DeathSignalReceived())</span>
<a href="#l1.77"></a><span id="l1.77">   {</span>
<a href="#l1.78"></a><span id="l1.78">     nsresult rv = NS_OK;</span>
<a href="#l1.79"></a><span id="l1.79">     PRBool readyToRun;</span>
<a href="#l1.80"></a><span id="l1.80"> </span>
<a href="#l1.81"></a><span id="l1.81">     // wait for an URL to process...</span>
<a href="#l1.82"></a><span id="l1.82">     {</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineminus">-      MonitorAutoEnter mon(m_urlReadyToRunMonitor);</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+      ReentrantMonitorAutoEnter mon(m_urlReadyToRunMonitor);</span>
<a href="#l1.85"></a><span id="l1.85"> </span>
<a href="#l1.86"></a><span id="l1.86">       while (NS_SUCCEEDED(rv) &amp;&amp; !DeathSignalReceived() &amp;&amp;</span>
<a href="#l1.87"></a><span id="l1.87">              !m_nextUrlReadyToRun &amp;&amp; !m_threadShouldDie)</span>
<a href="#l1.88"></a><span id="l1.88">         rv = mon.Wait(sleepTime);</span>
<a href="#l1.89"></a><span id="l1.89"> </span>
<a href="#l1.90"></a><span id="l1.90">       readyToRun = m_nextUrlReadyToRun;</span>
<a href="#l1.91"></a><span id="l1.91">       m_nextUrlReadyToRun = PR_FALSE;</span>
<a href="#l1.92"></a><span id="l1.92">     }</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineat">@@ -2110,17 +2110,17 @@ NS_IMETHODIMP nsImapProtocol::LoadImapUr</span>
<a href="#l1.94"></a><span id="l1.94"> </span>
<a href="#l1.95"></a><span id="l1.95">       // if we're running a select or delete all, do a noop first.</span>
<a href="#l1.96"></a><span id="l1.96">       // this should really be in the connection cache code when we know</span>
<a href="#l1.97"></a><span id="l1.97">       // we're pulling out a selected state connection, but maybe we</span>
<a href="#l1.98"></a><span id="l1.98">       // can get away with this.</span>
<a href="#l1.99"></a><span id="l1.99">       m_needNoop = (imapAction == nsIImapUrl::nsImapSelectFolder || imapAction == nsIImapUrl::nsImapDeleteAllMsgs);</span>
<a href="#l1.100"></a><span id="l1.100"> </span>
<a href="#l1.101"></a><span id="l1.101">       // We now have a url to run so signal the monitor for url ready to be processed...</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineminus">-      MonitorAutoEnter urlReadyMon(m_urlReadyToRunMonitor);</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+      ReentrantMonitorAutoEnter urlReadyMon(m_urlReadyToRunMonitor);</span>
<a href="#l1.104"></a><span id="l1.104">       m_nextUrlReadyToRun = PR_TRUE;</span>
<a href="#l1.105"></a><span id="l1.105">       urlReadyMon.Notify();</span>
<a href="#l1.106"></a><span id="l1.106"> </span>
<a href="#l1.107"></a><span id="l1.107">     } // if we have an imap url and a transport</span>
<a href="#l1.108"></a><span id="l1.108">     else</span>
<a href="#l1.109"></a><span id="l1.109">       NS_ASSERTION(PR_FALSE, &quot;missing channel or running url&quot;);</span>
<a href="#l1.110"></a><span id="l1.110"> </span>
<a href="#l1.111"></a><span id="l1.111">   } // if we received a url!</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineat">@@ -4197,56 +4197,56 @@ void nsImapProtocol::FolderMsgDump(PRUin</span>
<a href="#l1.113"></a><span id="l1.113"> </span>
<a href="#l1.114"></a><span id="l1.114">   SetProgressString(0);</span>
<a href="#l1.115"></a><span id="l1.115"> }</span>
<a href="#l1.116"></a><span id="l1.116"> </span>
<a href="#l1.117"></a><span id="l1.117"> void nsImapProtocol::WaitForPotentialListOfMsgsToFetch(PRUint32 **msgIdList, PRUint32 &amp;msgCount)</span>
<a href="#l1.118"></a><span id="l1.118"> {</span>
<a href="#l1.119"></a><span id="l1.119">   PRIntervalTime sleepTime = kImapSleepTime;</span>
<a href="#l1.120"></a><span id="l1.120"> </span>
<a href="#l1.121"></a><span id="l1.121" class="difflineminus">-  MonitorAutoEnter fetchListMon(m_fetchMsgListMonitor);</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+  ReentrantMonitorAutoEnter fetchListMon(m_fetchMsgListMonitor);</span>
<a href="#l1.123"></a><span id="l1.123">   while(!m_fetchMsgListIsNew &amp;&amp; !DeathSignalReceived())</span>
<a href="#l1.124"></a><span id="l1.124">     fetchListMon.Wait(sleepTime);</span>
<a href="#l1.125"></a><span id="l1.125">   m_fetchMsgListIsNew = PR_FALSE;</span>
<a href="#l1.126"></a><span id="l1.126"> </span>
<a href="#l1.127"></a><span id="l1.127">   *msgIdList = m_fetchMsgIdList;</span>
<a href="#l1.128"></a><span id="l1.128">   msgCount   = m_fetchCount;</span>
<a href="#l1.129"></a><span id="l1.129"> }</span>
<a href="#l1.130"></a><span id="l1.130"> </span>
<a href="#l1.131"></a><span id="l1.131"> void nsImapProtocol::WaitForPotentialListOfBodysToFetch(PRUint32 **msgIdList, PRUint32 &amp;msgCount)</span>
<a href="#l1.132"></a><span id="l1.132"> {</span>
<a href="#l1.133"></a><span id="l1.133">   PRIntervalTime sleepTime = kImapSleepTime;</span>
<a href="#l1.134"></a><span id="l1.134"> </span>
<a href="#l1.135"></a><span id="l1.135" class="difflineminus">-  MonitorAutoEnter fetchListMon(m_fetchMsgListMonitor);</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineplus">+  ReentrantMonitorAutoEnter fetchListMon(m_fetchMsgListMonitor);</span>
<a href="#l1.137"></a><span id="l1.137">   while(!m_fetchBodyListIsNew &amp;&amp; !DeathSignalReceived())</span>
<a href="#l1.138"></a><span id="l1.138">     fetchListMon.Wait(sleepTime);</span>
<a href="#l1.139"></a><span id="l1.139">   m_fetchBodyListIsNew = PR_FALSE;</span>
<a href="#l1.140"></a><span id="l1.140"> </span>
<a href="#l1.141"></a><span id="l1.141">   *msgIdList = m_fetchBodyIdList;</span>
<a href="#l1.142"></a><span id="l1.142">   msgCount   = m_fetchBodyCount;</span>
<a href="#l1.143"></a><span id="l1.143"> }</span>
<a href="#l1.144"></a><span id="l1.144"> </span>
<a href="#l1.145"></a><span id="l1.145"> // libmsg uses this to notify a running imap url about the message headers it should</span>
<a href="#l1.146"></a><span id="l1.146"> // download while opening a folder. Generally, the imap thread will be blocked</span>
<a href="#l1.147"></a><span id="l1.147"> // in WaitForPotentialListOfMsgsToFetch waiting for this notification.</span>
<a href="#l1.148"></a><span id="l1.148"> NS_IMETHODIMP nsImapProtocol::NotifyHdrsToDownload(PRUint32 *keys, PRUint32 keyCount)</span>
<a href="#l1.149"></a><span id="l1.149"> {</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineminus">-  MonitorAutoEnter fetchListMon(m_fetchMsgListMonitor);</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineplus">+  ReentrantMonitorAutoEnter fetchListMon(m_fetchMsgListMonitor);</span>
<a href="#l1.152"></a><span id="l1.152">   m_fetchMsgIdList = keys;</span>
<a href="#l1.153"></a><span id="l1.153">   m_fetchCount    = keyCount;</span>
<a href="#l1.154"></a><span id="l1.154">   m_fetchMsgListIsNew = PR_TRUE;</span>
<a href="#l1.155"></a><span id="l1.155">   fetchListMon.Notify();</span>
<a href="#l1.156"></a><span id="l1.156">   return NS_OK;</span>
<a href="#l1.157"></a><span id="l1.157"> }</span>
<a href="#l1.158"></a><span id="l1.158"> </span>
<a href="#l1.159"></a><span id="l1.159"> // libmsg uses this to notify a running imap url about message bodies it should download.</span>
<a href="#l1.160"></a><span id="l1.160"> // why not just have libmsg explicitly download the message bodies?</span>
<a href="#l1.161"></a><span id="l1.161"> NS_IMETHODIMP nsImapProtocol::NotifyBodysToDownload(PRUint32 *keys, PRUint32 keyCount)</span>
<a href="#l1.162"></a><span id="l1.162"> {</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineminus">-  MonitorAutoEnter fetchListMon(m_fetchBodyListMonitor);</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineplus">+  ReentrantMonitorAutoEnter fetchListMon(m_fetchBodyListMonitor);</span>
<a href="#l1.165"></a><span id="l1.165">   PR_FREEIF(m_fetchBodyIdList);</span>
<a href="#l1.166"></a><span id="l1.166">   m_fetchBodyIdList = (PRUint32 *) PR_MALLOC(keyCount * sizeof(PRUint32));</span>
<a href="#l1.167"></a><span id="l1.167">   if (m_fetchBodyIdList)</span>
<a href="#l1.168"></a><span id="l1.168">     memcpy(m_fetchBodyIdList, keys, keyCount * sizeof(PRUint32));</span>
<a href="#l1.169"></a><span id="l1.169">   m_fetchBodyCount    = keyCount;</span>
<a href="#l1.170"></a><span id="l1.170">   m_fetchBodyListIsNew = PR_TRUE;</span>
<a href="#l1.171"></a><span id="l1.171">   fetchListMon.Notify();</span>
<a href="#l1.172"></a><span id="l1.172">   return NS_OK;</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineat">@@ -4564,17 +4564,17 @@ PRBool nsImapProtocol::DeathSignalReceiv</span>
<a href="#l1.174"></a><span id="l1.174">   if (!GetPseudoInterrupted() &amp;&amp; m_mockChannel)</span>
<a href="#l1.175"></a><span id="l1.175">   {</span>
<a href="#l1.176"></a><span id="l1.176">     nsCOMPtr&lt;nsIRequest&gt; request = do_QueryInterface(m_mockChannel);</span>
<a href="#l1.177"></a><span id="l1.177">     if (request)</span>
<a href="#l1.178"></a><span id="l1.178">       request-&gt;GetStatus(&amp;returnValue);</span>
<a href="#l1.179"></a><span id="l1.179">   }</span>
<a href="#l1.180"></a><span id="l1.180">   if (NS_SUCCEEDED(returnValue)) // check the other way of cancelling.</span>
<a href="#l1.181"></a><span id="l1.181">   {</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineminus">-    MonitorAutoEnter threadDeathMon(m_threadDeathMonitor);</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineplus">+    ReentrantMonitorAutoEnter threadDeathMon(m_threadDeathMonitor);</span>
<a href="#l1.184"></a><span id="l1.184">     returnValue = m_threadShouldDie;</span>
<a href="#l1.185"></a><span id="l1.185">   }</span>
<a href="#l1.186"></a><span id="l1.186">   return returnValue;</span>
<a href="#l1.187"></a><span id="l1.187"> }</span>
<a href="#l1.188"></a><span id="l1.188"> </span>
<a href="#l1.189"></a><span id="l1.189"> NS_IMETHODIMP nsImapProtocol::ResetToAuthenticatedState()</span>
<a href="#l1.190"></a><span id="l1.190"> {</span>
<a href="#l1.191"></a><span id="l1.191">     GetServerStateParser().PreauthSetAuthenticatedState();</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineat">@@ -4588,37 +4588,37 @@ NS_IMETHODIMP nsImapProtocol::GetSelecte</span>
<a href="#l1.193"></a><span id="l1.193">     if (GetServerStateParser().GetSelectedMailboxName())</span>
<a href="#l1.194"></a><span id="l1.194">         *folderName =</span>
<a href="#l1.195"></a><span id="l1.195">             PL_strdup((GetServerStateParser().GetSelectedMailboxName()));</span>
<a href="#l1.196"></a><span id="l1.196">     return NS_OK;</span>
<a href="#l1.197"></a><span id="l1.197"> }</span>
<a href="#l1.198"></a><span id="l1.198"> </span>
<a href="#l1.199"></a><span id="l1.199"> PRBool nsImapProtocol::GetPseudoInterrupted()</span>
<a href="#l1.200"></a><span id="l1.200"> {</span>
<a href="#l1.201"></a><span id="l1.201" class="difflineminus">-  MonitorAutoEnter pseudoInterruptMon(m_pseudoInterruptMonitor);</span>
<a href="#l1.202"></a><span id="l1.202" class="difflineplus">+  ReentrantMonitorAutoEnter pseudoInterruptMon(m_pseudoInterruptMonitor);</span>
<a href="#l1.203"></a><span id="l1.203">   return m_pseudoInterrupted;</span>
<a href="#l1.204"></a><span id="l1.204"> }</span>
<a href="#l1.205"></a><span id="l1.205"> </span>
<a href="#l1.206"></a><span id="l1.206"> void nsImapProtocol::PseudoInterrupt(PRBool the_interrupt)</span>
<a href="#l1.207"></a><span id="l1.207"> {</span>
<a href="#l1.208"></a><span id="l1.208" class="difflineminus">-  MonitorAutoEnter pseudoInterruptMon(m_pseudoInterruptMonitor);</span>
<a href="#l1.209"></a><span id="l1.209" class="difflineplus">+  ReentrantMonitorAutoEnter pseudoInterruptMon(m_pseudoInterruptMonitor);</span>
<a href="#l1.210"></a><span id="l1.210">   m_pseudoInterrupted = the_interrupt;</span>
<a href="#l1.211"></a><span id="l1.211">   if (the_interrupt)</span>
<a href="#l1.212"></a><span id="l1.212">     Log(&quot;CONTROL&quot;, NULL, &quot;PSEUDO-Interrupted&quot;);</span>
<a href="#l1.213"></a><span id="l1.213"> }</span>
<a href="#l1.214"></a><span id="l1.214"> </span>
<a href="#l1.215"></a><span id="l1.215"> void  nsImapProtocol::SetActive(PRBool active)</span>
<a href="#l1.216"></a><span id="l1.216"> {</span>
<a href="#l1.217"></a><span id="l1.217" class="difflineminus">-  MonitorAutoEnter dataMemberMon(m_dataMemberMonitor);</span>
<a href="#l1.218"></a><span id="l1.218" class="difflineplus">+  ReentrantMonitorAutoEnter dataMemberMon(m_dataMemberMonitor);</span>
<a href="#l1.219"></a><span id="l1.219">   m_active = active;</span>
<a href="#l1.220"></a><span id="l1.220"> }</span>
<a href="#l1.221"></a><span id="l1.221"> </span>
<a href="#l1.222"></a><span id="l1.222"> PRBool  nsImapProtocol::GetActive()</span>
<a href="#l1.223"></a><span id="l1.223"> {</span>
<a href="#l1.224"></a><span id="l1.224" class="difflineminus">-  MonitorAutoEnter dataMemberMon(m_dataMemberMonitor);</span>
<a href="#l1.225"></a><span id="l1.225" class="difflineplus">+  ReentrantMonitorAutoEnter dataMemberMon(m_dataMemberMonitor);</span>
<a href="#l1.226"></a><span id="l1.226">   return m_active;</span>
<a href="#l1.227"></a><span id="l1.227"> }</span>
<a href="#l1.228"></a><span id="l1.228"> </span>
<a href="#l1.229"></a><span id="l1.229"> PRBool nsImapProtocol::GetShowAttachmentsInline()</span>
<a href="#l1.230"></a><span id="l1.230"> {</span>
<a href="#l1.231"></a><span id="l1.231">   PRBool showAttachmentsInline = PR_TRUE;</span>
<a href="#l1.232"></a><span id="l1.232">   if (m_imapServerSink)</span>
<a href="#l1.233"></a><span id="l1.233">     m_imapServerSink-&gt;GetShowAttachmentsInline(&amp;showAttachmentsInline);</span>
<a href="#l1.234"></a><span id="l1.234" class="difflineat">@@ -4810,23 +4810,23 @@ nsImapProtocol::NotifySearchHit(const ch</span>
<a href="#l1.235"></a><span id="l1.235">     nsresult rv;</span>
<a href="#l1.236"></a><span id="l1.236">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsUrl = do_QueryInterface(m_runningUrl, &amp;rv);</span>
<a href="#l1.237"></a><span id="l1.237">     if (m_imapMailFolderSink)</span>
<a href="#l1.238"></a><span id="l1.238">         m_imapMailFolderSink-&gt;NotifySearchHit(mailnewsUrl, hitLine);</span>
<a href="#l1.239"></a><span id="l1.239"> }</span>
<a href="#l1.240"></a><span id="l1.240"> </span>
<a href="#l1.241"></a><span id="l1.241"> void nsImapProtocol::SetMailboxDiscoveryStatus(EMailboxDiscoverStatus status)</span>
<a href="#l1.242"></a><span id="l1.242"> {</span>
<a href="#l1.243"></a><span id="l1.243" class="difflineminus">-  MonitorAutoEnter mon(m_dataMemberMonitor);</span>
<a href="#l1.244"></a><span id="l1.244" class="difflineplus">+  ReentrantMonitorAutoEnter mon(m_dataMemberMonitor);</span>
<a href="#l1.245"></a><span id="l1.245">   m_discoveryStatus = status;</span>
<a href="#l1.246"></a><span id="l1.246"> }</span>
<a href="#l1.247"></a><span id="l1.247"> </span>
<a href="#l1.248"></a><span id="l1.248"> EMailboxDiscoverStatus nsImapProtocol::GetMailboxDiscoveryStatus( )</span>
<a href="#l1.249"></a><span id="l1.249"> {</span>
<a href="#l1.250"></a><span id="l1.250" class="difflineminus">-  MonitorAutoEnter mon(m_dataMemberMonitor);</span>
<a href="#l1.251"></a><span id="l1.251" class="difflineplus">+  ReentrantMonitorAutoEnter mon(m_dataMemberMonitor);</span>
<a href="#l1.252"></a><span id="l1.252">   return m_discoveryStatus;</span>
<a href="#l1.253"></a><span id="l1.253"> }</span>
<a href="#l1.254"></a><span id="l1.254"> </span>
<a href="#l1.255"></a><span id="l1.255"> PRBool</span>
<a href="#l1.256"></a><span id="l1.256"> nsImapProtocol::GetSubscribingNow()</span>
<a href="#l1.257"></a><span id="l1.257"> {</span>
<a href="#l1.258"></a><span id="l1.258">     // ***** code me *****</span>
<a href="#l1.259"></a><span id="l1.259">     return PR_FALSE;// ***** for now</span>
<a href="#l1.260"></a><span id="l1.260" class="difflineat">@@ -8166,17 +8166,17 @@ nsresult nsImapProtocol::GetPassword(nsC</span>
<a href="#l1.261"></a><span id="l1.261">     nsCAutoString pwd; // GetPasswordWithUI truncates the password on Cancel</span>
<a href="#l1.262"></a><span id="l1.262">     rv = m_imapServerSink-&gt;AsyncGetPassword(this,</span>
<a href="#l1.263"></a><span id="l1.263">                                                      newPasswordRequested,</span>
<a href="#l1.264"></a><span id="l1.264">                                                      password);</span>
<a href="#l1.265"></a><span id="l1.265">     if (password.IsEmpty())</span>
<a href="#l1.266"></a><span id="l1.266">     {</span>
<a href="#l1.267"></a><span id="l1.267">       PRIntervalTime sleepTime = kImapSleepTime;</span>
<a href="#l1.268"></a><span id="l1.268">       m_passwordStatus = NS_OK;</span>
<a href="#l1.269"></a><span id="l1.269" class="difflineminus">-      MonitorAutoEnter mon(m_passwordReadyMonitor);</span>
<a href="#l1.270"></a><span id="l1.270" class="difflineplus">+      ReentrantMonitorAutoEnter mon(m_passwordReadyMonitor);</span>
<a href="#l1.271"></a><span id="l1.271">       while (m_password.IsEmpty() &amp;&amp; !NS_FAILED(m_passwordStatus) &amp;&amp;</span>
<a href="#l1.272"></a><span id="l1.272">              m_passwordStatus != NS_MSG_PASSWORD_PROMPT_CANCELLED &amp;&amp;</span>
<a href="#l1.273"></a><span id="l1.273">              !DeathSignalReceived())</span>
<a href="#l1.274"></a><span id="l1.274">         mon.Wait(sleepTime);</span>
<a href="#l1.275"></a><span id="l1.275">       rv = m_passwordStatus;</span>
<a href="#l1.276"></a><span id="l1.276">       password = m_password;</span>
<a href="#l1.277"></a><span id="l1.277">     }</span>
<a href="#l1.278"></a><span id="l1.278">   }</span>
<a href="#l1.279"></a><span id="l1.279" class="difflineat">@@ -8199,40 +8199,40 @@ nsImapProtocol::OnPromptStart(PRInt32 *a</span>
<a href="#l1.280"></a><span id="l1.280">   nsCString password = m_lastPasswordSent;</span>
<a href="#l1.281"></a><span id="l1.281">   rv = imapServer-&gt;PromptPassword(msgWindow, password);</span>
<a href="#l1.282"></a><span id="l1.282">   m_password = password;</span>
<a href="#l1.283"></a><span id="l1.283">   m_passwordStatus = rv;</span>
<a href="#l1.284"></a><span id="l1.284">   if (!m_password.IsEmpty())</span>
<a href="#l1.285"></a><span id="l1.285">     *aResult = PR_TRUE;</span>
<a href="#l1.286"></a><span id="l1.286"> </span>
<a href="#l1.287"></a><span id="l1.287">   // Notify the imap thread that we have a password.</span>
<a href="#l1.288"></a><span id="l1.288" class="difflineminus">-  MonitorAutoEnter passwordMon(m_passwordReadyMonitor);</span>
<a href="#l1.289"></a><span id="l1.289" class="difflineplus">+  ReentrantMonitorAutoEnter passwordMon(m_passwordReadyMonitor);</span>
<a href="#l1.290"></a><span id="l1.290">   passwordMon.Notify();</span>
<a href="#l1.291"></a><span id="l1.291">   return rv;</span>
<a href="#l1.292"></a><span id="l1.292"> }</span>
<a href="#l1.293"></a><span id="l1.293"> </span>
<a href="#l1.294"></a><span id="l1.294"> NS_IMETHODIMP</span>
<a href="#l1.295"></a><span id="l1.295"> nsImapProtocol::OnPromptAuthAvailable()</span>
<a href="#l1.296"></a><span id="l1.296"> {</span>
<a href="#l1.297"></a><span id="l1.297">   nsresult rv;</span>
<a href="#l1.298"></a><span id="l1.298">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; imapServer = do_QueryReferent(m_server, &amp;rv);</span>
<a href="#l1.299"></a><span id="l1.299">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.300"></a><span id="l1.300">   m_passwordStatus = imapServer-&gt;GetPassword(m_password);</span>
<a href="#l1.301"></a><span id="l1.301">   // Notify the imap thread that we have a password.</span>
<a href="#l1.302"></a><span id="l1.302" class="difflineminus">-  MonitorAutoEnter passwordMon(m_passwordReadyMonitor);</span>
<a href="#l1.303"></a><span id="l1.303" class="difflineplus">+  ReentrantMonitorAutoEnter passwordMon(m_passwordReadyMonitor);</span>
<a href="#l1.304"></a><span id="l1.304">   passwordMon.Notify();</span>
<a href="#l1.305"></a><span id="l1.305">   return m_passwordStatus;</span>
<a href="#l1.306"></a><span id="l1.306"> }</span>
<a href="#l1.307"></a><span id="l1.307"> </span>
<a href="#l1.308"></a><span id="l1.308"> NS_IMETHODIMP</span>
<a href="#l1.309"></a><span id="l1.309"> nsImapProtocol::OnPromptCanceled()</span>
<a href="#l1.310"></a><span id="l1.310"> {</span>
<a href="#l1.311"></a><span id="l1.311">   // A prompt was cancelled, so notify the imap thread.</span>
<a href="#l1.312"></a><span id="l1.312">   m_passwordStatus = NS_MSG_PASSWORD_PROMPT_CANCELLED;</span>
<a href="#l1.313"></a><span id="l1.313" class="difflineminus">-  MonitorAutoEnter passwordMon(m_passwordReadyMonitor);</span>
<a href="#l1.314"></a><span id="l1.314" class="difflineplus">+  ReentrantMonitorAutoEnter passwordMon(m_passwordReadyMonitor);</span>
<a href="#l1.315"></a><span id="l1.315">   passwordMon.Notify();</span>
<a href="#l1.316"></a><span id="l1.316">   return NS_OK;</span>
<a href="#l1.317"></a><span id="l1.317"> }</span>
<a href="#l1.318"></a><span id="l1.318"> </span>
<a href="#l1.319"></a><span id="l1.319"> PRBool nsImapProtocol::TryToLogon()</span>
<a href="#l1.320"></a><span id="l1.320"> {</span>
<a href="#l1.321"></a><span id="l1.321">   PR_LOG(IMAP, PR_LOG_DEBUG, (&quot;try to log in&quot;));</span>
<a href="#l1.322"></a><span id="l1.322">   NS_ENSURE_TRUE(m_imapServerSink, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -83,18 +83,22 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &quot;nsICacheListener.h&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> #include &quot;nsIImapHeaderXferInfo.h&quot;</span>
<a href="#l2.6"></a><span id="l2.6"> #include &quot;nsMsgLineBuffer.h&quot;</span>
<a href="#l2.7"></a><span id="l2.7"> #include &quot;nsIAsyncInputStream.h&quot;</span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;nsITimer.h&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> #include &quot;nsIMsgAsyncPrompter.h&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+#ifndef MOZILLA_5_0_BRANCH</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+#include &quot;mozilla/ReentrantMonitor.h&quot;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+#else</span>
<a href="#l2.15"></a><span id="l2.15"> #include &quot;mozilla/Monitor.h&quot;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+#define ReentrantMonitorAutoEnter MonitorAutoEnter</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+#endif</span>
<a href="#l2.19"></a><span id="l2.19"> class nsIMAPMessagePartIDArray;</span>
<a href="#l2.20"></a><span id="l2.20"> class nsIMsgIncomingServer;</span>
<a href="#l2.21"></a><span id="l2.21"> class nsIPrefBranch;</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23"> #define kDownLoadCacheSize 16000 // was 1536 - try making it bigger</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25"> </span>
<a href="#l2.26"></a><span id="l2.26"> typedef struct _msg_line_info {</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineat">@@ -372,25 +376,32 @@ private:</span>
<a href="#l2.28"></a><span id="l2.28">   nsCOMPtr&lt;nsIImapMockChannel&gt;    m_mockChannel;   // this is the channel we should forward to people</span>
<a href="#l2.29"></a><span id="l2.29">   //nsCOMPtr&lt;nsIRequest&gt; mAsyncReadRequest; // we're going to cancel this when we're done with the conn.</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31"> </span>
<a href="#l2.32"></a><span id="l2.32">   // ******* Thread support *******</span>
<a href="#l2.33"></a><span id="l2.33">   nsCOMPtr&lt;nsIEventTarget&gt; m_sinkEventTarget;</span>
<a href="#l2.34"></a><span id="l2.34">   nsCOMPtr&lt;nsIThread&gt;      m_iThread;</span>
<a href="#l2.35"></a><span id="l2.35">   PRThread     *m_thread;</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-  mozilla::Monitor m_dataAvailableMonitor;   // used to notify the arrival of data from the server</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-  mozilla::Monitor m_urlReadyToRunMonitor;   // used to notify the arrival of a new url to be processed</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-  mozilla::Monitor m_pseudoInterruptMonitor;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-  mozilla::Monitor m_dataMemberMonitor;</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-  mozilla::Monitor m_threadDeathMonitor;</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-  mozilla::Monitor m_waitForBodyIdsMonitor;</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-  mozilla::Monitor m_fetchMsgListMonitor;</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-  mozilla::Monitor m_fetchBodyListMonitor;</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-  mozilla::Monitor m_passwordReadyMonitor;</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+#ifndef MOZILLA_5_0_BRANCH</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+  // When we don't need 5.0 branch, should remove typedef and explicitly</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+  // use mozilla::ReentrantMonitor or set the namespace.</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+  typedef mozilla::ReentrantMonitor ReentrantMonitor;</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+#else</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+  typedef mozilla::Monitor ReentrantMonitor;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+#endif</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+  ReentrantMonitor m_dataAvailableMonitor;   // used to notify the arrival of data from the server</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+  ReentrantMonitor m_urlReadyToRunMonitor;   // used to notify the arrival of a new url to be processed</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+  ReentrantMonitor m_pseudoInterruptMonitor;</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+  ReentrantMonitor m_dataMemberMonitor;</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+  ReentrantMonitor m_threadDeathMonitor;</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+  ReentrantMonitor m_waitForBodyIdsMonitor;</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+  ReentrantMonitor m_fetchMsgListMonitor;</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+  ReentrantMonitor m_fetchBodyListMonitor;</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+  ReentrantMonitor m_passwordReadyMonitor;</span>
<a href="#l2.61"></a><span id="l2.61">   mozilla::Mutex mLock;</span>
<a href="#l2.62"></a><span id="l2.62">   // If we get an async password prompt, this is where the UI thread</span>
<a href="#l2.63"></a><span id="l2.63">   // stores the password, before notifying the imap thread of the password</span>
<a href="#l2.64"></a><span id="l2.64">   // via the m_passwordReadyMonitor.</span>
<a href="#l2.65"></a><span id="l2.65">   nsCString m_password;</span>
<a href="#l2.66"></a><span id="l2.66">   // Set to the result of nsImapServer::PromptPassword</span>
<a href="#l2.67"></a><span id="l2.67">   nsresult    m_passwordStatus;</span>
<a href="#l2.68"></a><span id="l2.68"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

