<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27463:e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae" />
<meta property="og:url" content="/comm-central/rev/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae" />
<meta property="og:description" content="Bug 1577835 - Fix 'else and comments' formatting in mail/. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae">shortlog</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae">files</a> |
changeset |
<a href="/comm-central/raw-rev/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae">raw</a>  | <a href="/comm-central/archive/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1577835">Bug 1577835</a> - Fix 'else and comments' formatting in mail/. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#97;&#117;&#108;&#32;&#77;&#111;&#114;&#114;&#105;&#115;&#32;&#60;&#112;&#97;&#117;&#108;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 30 Aug 2019 21:52:10 -0400</td></tr>

<tr>
 <td>changeset 27463</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae">e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae</a></td>
</tr>



<tr>
<td>parent 27462</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f19f1829633fcb4a7496a96ab70bb92d5811f76c">f19f1829633fcb4a7496a96ab70bb92d5811f76c</a>
</td>
</tr>

<tr>
<td>child 27464</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3aceadebffb57f6cc20db9a3a612e0af55071035">3aceadebffb57f6cc20db9a3a612e0af55071035</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae">16348</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 01 Sep 2019 21:02:53 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@8177b85d18db [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8177b85d18db77c4787461cd6db9575ef9935aea">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8177b85d18db77c4787461cd6db9575ef9935aea&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8177b85d18db77c4787461cd6db9575ef9935aea&newProject=comm-central&newRevision=fda41b757b2e6b5288b439aa9227b869ae320aa2&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8177b85d18db77c4787461cd6db9575ef9935aea&newProject=comm-central&newRevision=fda41b757b2e6b5288b439aa9227b869ae320aa2&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8177b85d18db77c4787461cd6db9575ef9935aea&newProject=comm-central&newRevision=fda41b757b2e6b5288b439aa9227b869ae320aa2&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1577835">1577835</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1577835">Bug 1577835</a> - Fix 'else and comments' formatting in mail/. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/contentAreaClick.js">mail/base/content/contentAreaClick.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/contentAreaClick.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/contentAreaClick.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/contentAreaClick.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/contentAreaClick.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/contentAreaClick.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderDisplay.js">mail/base/content/folderDisplay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderDisplay.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderDisplay.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderDisplay.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderDisplay.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderDisplay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderPane.js">mail/base/content/folderPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderPane.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderPane.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderPane.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderPane.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/folderPane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailTabs.js">mail/base/content/mailTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailTabs.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailTabs.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailTabs.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailTabs.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailTabs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailWindowOverlay.js">mail/base/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/msgHdrView.js">mail/base/content/msgHdrView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/msgHdrView.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/msgHdrView.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/msgHdrView.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/msgHdrView.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/msgHdrView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/sanitize.js">mail/base/content/sanitize.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/sanitize.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/sanitize.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/sanitize.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/sanitize.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/sanitize.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/threadPane.js">mail/base/content/threadPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/threadPane.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/threadPane.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/threadPane.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/threadPane.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/content/threadPane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/DBViewWrapper.jsm">mail/base/modules/DBViewWrapper.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/DBViewWrapper.jsm">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/DBViewWrapper.jsm">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/DBViewWrapper.jsm">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/DBViewWrapper.jsm">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/DBViewWrapper.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/SearchSpec.jsm">mail/base/modules/SearchSpec.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/SearchSpec.jsm">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/SearchSpec.jsm">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/SearchSpec.jsm">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/SearchSpec.jsm">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/base/modules/SearchSpec.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCardView.js">mail/components/addrbook/content/abCardView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCardView.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCardView.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCardView.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCardView.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCardView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCommon.js">mail/components/addrbook/content/abCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCommon.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCommon.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCommon.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCommon.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/abCommon.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/addressbook.js">mail/components/addrbook/content/addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/addressbook.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/addressbook.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/addressbook.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/addressbook.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/addrbook/content/addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/im/modules/search_im.jsm">mail/components/im/modules/search_im.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/im/modules/search_im.jsm">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/im/modules/search_im.jsm">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/im/modules/search_im.jsm">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/im/modules/search_im.jsm">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/im/modules/search_im.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/search/SearchIntegration.jsm">mail/components/search/SearchIntegration.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/search/SearchIntegration.jsm">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/search/SearchIntegration.jsm">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/search/SearchIntegration.jsm">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/search/SearchIntegration.jsm">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/components/search/SearchIntegration.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/attachment/test-attachment-size.js">mail/test/mozmill/attachment/test-attachment-size.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/attachment/test-attachment-size.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/attachment/test-attachment-size.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/attachment/test-attachment-size.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/attachment/test-attachment-size.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/attachment/test-attachment-size.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">mail/test/mozmill/shared-modules/test-folder-display-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">file</a> |
<a href="/comm-central/annotate/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">annotate</a> |
<a href="/comm-central/diff/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">diff</a> |
<a href="/comm-central/comparison/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">comparison</a> |
<a href="/comm-central/log/e8bbfa11d96e29a39aecc68e7fb01facafb1b0ae/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/contentAreaClick.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/contentAreaClick.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -144,19 +144,18 @@ function contentAreaClick(aEvent) {</span>
<a href="#l1.4"></a><span id="l1.4">         return false;</span>
<a href="#l1.5"></a><span id="l1.5">       }</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7">       // Is it an image?</span>
<a href="#l1.8"></a><span id="l1.8">       if (target.localName == &quot;img&quot; &amp;&amp; target.hasAttribute(&quot;overflowing&quot;)) {</span>
<a href="#l1.9"></a><span id="l1.9">         if (target.hasAttribute(&quot;shrinktofit&quot;)) {</span>
<a href="#l1.10"></a><span id="l1.10">           // Currently shrunk to fit, so unshrink it.</span>
<a href="#l1.11"></a><span id="l1.11">           target.removeAttribute(&quot;shrinktofit&quot;);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        }</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-        // User wants to shrink now.</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-        else {</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+        } else {</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+          // User wants to shrink now.</span>
<a href="#l1.17"></a><span id="l1.17">           target.setAttribute(&quot;shrinktofit&quot;, true);</span>
<a href="#l1.18"></a><span id="l1.18">         }</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">         return false;</span>
<a href="#l1.21"></a><span id="l1.21">       }</span>
<a href="#l1.22"></a><span id="l1.22">     }</span>
<a href="#l1.23"></a><span id="l1.23">     return true;</span>
<a href="#l1.24"></a><span id="l1.24">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/folderDisplay.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/folderDisplay.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -2649,27 +2649,25 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">     // Assume the bottom row is half-visible and should generally be ignored.</span>
<a href="#l2.5"></a><span id="l2.5">     // (We could actually do the legwork to see if there is a partial one...)</span>
<a href="#l2.6"></a><span id="l2.6">     const halfVisible = 1;</span>
<a href="#l2.7"></a><span id="l2.7">     let last = tree.getLastVisibleRow() - halfVisible;</span>
<a href="#l2.8"></a><span id="l2.8">     let span = tree.getPageLength() - halfVisible;</span>
<a href="#l2.9"></a><span id="l2.9">     let [topPadding, bottomPadding] = this.visibleRowPadding;</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">     let target;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    // If the index is after the last visible guy (with padding), move down</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-    //  so that the target index is padded in 1 from the bottom.</span>
<a href="#l2.14"></a><span id="l2.14">     if (aViewIndex &gt;= last - bottomPadding) {</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+      // The index is after the last visible guy (with padding),</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+      // move down so that the target index is padded in 1 from the bottom.</span>
<a href="#l2.17"></a><span id="l2.17">       target = Math.min(maxIndex, aViewIndex + bottomPadding) - span;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-    }</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-    // If the index is before the first visible guy (with padding), move up</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-    else if (aViewIndex &lt;= first + topPadding) {</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-      // move up</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+    } else if (aViewIndex &lt;= first + topPadding) {</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+      // The index is before the first visible guy (with padding), move up.</span>
<a href="#l2.24"></a><span id="l2.24">       target = Math.max(0, aViewIndex - topPadding);</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-    } // it is already visible</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-    else {</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+    } else {</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+      // It is already visible.</span>
<a href="#l2.29"></a><span id="l2.29">       return;</span>
<a href="#l2.30"></a><span id="l2.30">     }</span>
<a href="#l2.31"></a><span id="l2.31"> </span>
<a href="#l2.32"></a><span id="l2.32">     // this sets the first visible row</span>
<a href="#l2.33"></a><span id="l2.33">     tree.scrollToRow(target);</span>
<a href="#l2.34"></a><span id="l2.34">   },</span>
<a href="#l2.35"></a><span id="l2.35"> </span>
<a href="#l2.36"></a><span id="l2.36">   /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/folderPane.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/folderPane.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -2858,18 +2858,18 @@ var gFolderTreeController = {</span>
<a href="#l3.4"></a><span id="l3.4">     let folder = aParent || gFolderTreeView.getSelectedFolders()[0];</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">     // Make sure we actually can create subfolders</span>
<a href="#l3.7"></a><span id="l3.7">     if (!folder.canCreateSubfolders) {</span>
<a href="#l3.8"></a><span id="l3.8">       // Check if we can create them at the root</span>
<a href="#l3.9"></a><span id="l3.9">       let rootMsgFolder = folder.server.rootMsgFolder;</span>
<a href="#l3.10"></a><span id="l3.10">       if (rootMsgFolder.canCreateSubfolders) {</span>
<a href="#l3.11"></a><span id="l3.11">         folder = rootMsgFolder;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-      } // just use the default account</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-      else {</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+      } else {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+        // Just use the default account.</span>
<a href="#l3.16"></a><span id="l3.16">         folder = GetDefaultAccountRootFolder();</span>
<a href="#l3.17"></a><span id="l3.17">       }</span>
<a href="#l3.18"></a><span id="l3.18">     }</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">     if (!folder) {</span>
<a href="#l3.21"></a><span id="l3.21">       return;</span>
<a href="#l3.22"></a><span id="l3.22">     }</span>
<a href="#l3.23"></a><span id="l3.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/mailTabs.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/mailTabs.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -112,41 +112,37 @@ var mailTabType = {</span>
<a href="#l4.4"></a><span id="l4.4">         // (We don't want to assume that our immediate predecessor was a</span>
<a href="#l4.5"></a><span id="l4.5">         //  &quot;folder&quot; tab.)</span>
<a href="#l4.6"></a><span id="l4.6">         let modelTab = document</span>
<a href="#l4.7"></a><span id="l4.7">           .getElementById(&quot;tabmail&quot;)</span>
<a href="#l4.8"></a><span id="l4.8">           .getTabInfoForCurrentOrFirstModeInstance(aTab.mode);</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10">         // - figure out whether to show the folder pane</span>
<a href="#l4.11"></a><span id="l4.11">         let folderPaneShouldBeVisible;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-        // explicitly told to us?</span>
<a href="#l4.13"></a><span id="l4.13">         if (&quot;folderPaneVisible&quot; in aArgs) {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+          // Explicitly told to us.</span>
<a href="#l4.15"></a><span id="l4.15">           folderPaneShouldBeVisible = aArgs.folderPaneVisible;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-        }</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-        // inherit from the previous tab (if we've got one)</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-        else if (modelTab) {</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+        } else if (modelTab) {</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+          // Inherit from the previous tab (if we've got one).</span>
<a href="#l4.21"></a><span id="l4.21">           folderPaneShouldBeVisible = modelTab.folderDisplay.folderPaneVisible;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-        }</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-        // who doesn't love a folder pane?</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-        else {</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+        } else {</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+          // Who doesn't love a folder pane?</span>
<a href="#l4.27"></a><span id="l4.27">           folderPaneShouldBeVisible = true;</span>
<a href="#l4.28"></a><span id="l4.28">         }</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30">         // - figure out whether to show the message pane</span>
<a href="#l4.31"></a><span id="l4.31">         let messagePaneShouldBeVisible;</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-        // explicitly told to us?</span>
<a href="#l4.33"></a><span id="l4.33">         if (&quot;messagePaneVisible&quot; in aArgs) {</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+          // Explicitly told to us?</span>
<a href="#l4.35"></a><span id="l4.35">           messagePaneShouldBeVisible = aArgs.messagePaneVisible;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-        }</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-        // inherit from the previous tab (if we've got one)</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-        else if (modelTab) {</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+        } else if (modelTab) {</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+          // Inherit from the previous tab (if we've got one).</span>
<a href="#l4.41"></a><span id="l4.41">           messagePaneShouldBeVisible = modelTab.messageDisplay.visible;</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-        }</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-        // who doesn't love a message pane?</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-        else {</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+        } else {</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+          // Who doesn't love a message pane?</span>
<a href="#l4.47"></a><span id="l4.47">           messagePaneShouldBeVisible = true;</span>
<a href="#l4.48"></a><span id="l4.48">         }</span>
<a href="#l4.49"></a><span id="l4.49"> </span>
<a href="#l4.50"></a><span id="l4.50">         this.openTab(</span>
<a href="#l4.51"></a><span id="l4.51">           aTab,</span>
<a href="#l4.52"></a><span id="l4.52">           false,</span>
<a href="#l4.53"></a><span id="l4.53">           new MessagePaneDisplayWidget(messagePaneShouldBeVisible),</span>
<a href="#l4.54"></a><span id="l4.54">           folderPaneShouldBeVisible</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineat">@@ -721,20 +717,19 @@ var mailTabType = {</span>
<a href="#l4.56"></a><span id="l4.56">     // -- display deck (thread pane / account central)</span>
<a href="#l4.57"></a><span id="l4.57">     // in a vertical view, the threadContentArea sits in the #threadPaneBox</span>
<a href="#l4.58"></a><span id="l4.58">     //  next to the message pane and its splitter.</span>
<a href="#l4.59"></a><span id="l4.59">     var kVerticalMailLayout = 2;</span>
<a href="#l4.60"></a><span id="l4.60">     if (layout == kVerticalMailLayout) {</span>
<a href="#l4.61"></a><span id="l4.61">       document.getElementById(</span>
<a href="#l4.62"></a><span id="l4.62">         &quot;threadContentArea&quot;</span>
<a href="#l4.63"></a><span id="l4.63">       ).collapsed = !displayDeckLegal;</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-    }</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-    // whereas in the default view, the displayDeck is the one next to the</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-    //  message pane and its splitter</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineminus">-    else {</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineplus">+    } else {</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+      // Whereas in the default view, the displayDeck is the one next to the</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+      // message pane and its splitter.</span>
<a href="#l4.71"></a><span id="l4.71">       document.getElementById(&quot;displayDeck&quot;).collapsed = !displayDeckLegal;</span>
<a href="#l4.72"></a><span id="l4.72">     }</span>
<a href="#l4.73"></a><span id="l4.73"> </span>
<a href="#l4.74"></a><span id="l4.74">     // -- thread pane</span>
<a href="#l4.75"></a><span id="l4.75">     // the threadpane-splitter collapses the message pane (arguably a misnomer),</span>
<a href="#l4.76"></a><span id="l4.76">     //  but it only needs to exist when the thread-pane is legal</span>
<a href="#l4.77"></a><span id="l4.77">     document.getElementById(</span>
<a href="#l4.78"></a><span id="l4.78">       &quot;threadpane-splitter&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -2197,21 +2197,22 @@ function getDestinationFolder(preselecte</span>
<a href="#l5.4"></a><span id="l5.4">   return destinationFolder;</span>
<a href="#l5.5"></a><span id="l5.5"> }</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> /** Open subscribe window. */</span>
<a href="#l5.8"></a><span id="l5.8"> function MsgSubscribe() {</span>
<a href="#l5.9"></a><span id="l5.9">   var preselectedFolder = GetFirstSelectedMsgFolder();</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">   if (FeedMessageHandler.isFeedFolder(preselectedFolder)) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+    // Open feed subscription dialog.</span>
<a href="#l5.13"></a><span id="l5.13">     openSubscriptionsDialog(preselectedFolder);</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-  } // open feed subscription dialog</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-  else {</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+  } else {</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+    // Open IMAP/NNTP subscription dialog.</span>
<a href="#l5.18"></a><span id="l5.18">     Subscribe(preselectedFolder);</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-  } // open imap/nntp subscription dialog</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+  }</span>
<a href="#l5.21"></a><span id="l5.21"> }</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23"> /**</span>
<a href="#l5.24"></a><span id="l5.24">  * Show a confirmation dialog - check if the user really want to unsubscribe</span>
<a href="#l5.25"></a><span id="l5.25">  * from the given newsgroup/s.</span>
<a href="#l5.26"></a><span id="l5.26">  * @folders an array of newsgroup folders to unsubscribe from</span>
<a href="#l5.27"></a><span id="l5.27">  * @return true if the user said it's ok to unsubscribe</span>
<a href="#l5.28"></a><span id="l5.28">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/content/msgHdrView.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/content/msgHdrView.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -858,18 +858,18 @@ function SetTagHeader() {</span>
<a href="#l6.4"></a><span id="l6.4">     if (!(msgKeyArray[i] in tagKeys)) {</span>
<a href="#l6.5"></a><span id="l6.5">       msgKeyArray.splice(i, 1);</span>
<a href="#l6.6"></a><span id="l6.6">     }</span>
<a href="#l6.7"></a><span id="l6.7">   } // remove non-tag key</span>
<a href="#l6.8"></a><span id="l6.8">   var msgKeys = msgKeyArray.join(&quot; &quot;);</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10">   if (msgKeys) {</span>
<a href="#l6.11"></a><span id="l6.11">     currentHeaderData.tags = { headerName: &quot;tags&quot;, headerValue: msgKeys };</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  } // no more tags, so clear out the header field</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-  else {</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  } else {</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+    // No more tags, so clear out the header field.</span>
<a href="#l6.16"></a><span id="l6.16">     delete currentHeaderData.tags;</span>
<a href="#l6.17"></a><span id="l6.17">   }</span>
<a href="#l6.18"></a><span id="l6.18"> }</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20"> function EnsureSubjectValue() {</span>
<a href="#l6.21"></a><span id="l6.21">   if (!(&quot;subject&quot; in currentHeaderData)) {</span>
<a href="#l6.22"></a><span id="l6.22">     let foo = {};</span>
<a href="#l6.23"></a><span id="l6.23">     foo.headerValue = &quot;&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/content/sanitize.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/content/sanitize.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -36,19 +36,19 @@ Sanitizer.prototype = {</span>
<a href="#l7.4"></a><span id="l7.4">    *           { itemName: error, ... } on (partial) failure</span>
<a href="#l7.5"></a><span id="l7.5">    */</span>
<a href="#l7.6"></a><span id="l7.6">   sanitize() {</span>
<a href="#l7.7"></a><span id="l7.7">     var branch = Services.prefs.getBranch(this.prefDomain);</span>
<a href="#l7.8"></a><span id="l7.8">     var errors = null;</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">     // Cache the range of times to clear</span>
<a href="#l7.11"></a><span id="l7.11">     if (this.ignoreTimespan) {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+      // If we ignore timespan, clear everything.</span>
<a href="#l7.13"></a><span id="l7.13">       var range = null;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-    } // If we ignore timespan, clear everything</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-    else {</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+    } else {</span>
<a href="#l7.17"></a><span id="l7.17">       range = this.range || Sanitizer.getClearRange();</span>
<a href="#l7.18"></a><span id="l7.18">     }</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20">     for (var itemName in this.items) {</span>
<a href="#l7.21"></a><span id="l7.21">       var item = this.items[itemName];</span>
<a href="#l7.22"></a><span id="l7.22">       item.range = range;</span>
<a href="#l7.23"></a><span id="l7.23">       if (&quot;clear&quot; in item &amp;&amp; item.canClear &amp;&amp; branch.getBoolPref(itemName)) {</span>
<a href="#l7.24"></a><span id="l7.24">         // Some of these clear() may raise exceptions (see bug #265028)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/content/threadPane.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/content/threadPane.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -302,19 +302,18 @@ function MsgReverseSortThreadPane() {</span>
<a href="#l8.4"></a><span id="l8.4">   if (grouped) {</span>
<a href="#l8.5"></a><span id="l8.5">     if (gDBView.selection.count) {</span>
<a href="#l8.6"></a><span id="l8.6">       gFolderDisplay._saveSelection();</span>
<a href="#l8.7"></a><span id="l8.7">     }</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9">     if (gFolderDisplay.view.isSingleFolder) {</span>
<a href="#l8.10"></a><span id="l8.10">       if (gFolderDisplay.view.isVirtual) {</span>
<a href="#l8.11"></a><span id="l8.11">         gFolderDisplay.view.showGroupedBySort = false;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      }</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-      // Must ensure rows are collapsed and kExpandAll is unset.</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-      else {</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+      } else {</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+        // Must ensure rows are collapsed and kExpandAll is unset.</span>
<a href="#l8.17"></a><span id="l8.17">         gFolderDisplay.doCommand(Ci.nsMsgViewCommandType.collapseAll);</span>
<a href="#l8.18"></a><span id="l8.18">       }</span>
<a href="#l8.19"></a><span id="l8.19">     }</span>
<a href="#l8.20"></a><span id="l8.20">   }</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22">   if (gFolderDisplay.view.isSortedAscending) {</span>
<a href="#l8.23"></a><span id="l8.23">     gFolderDisplay.view.sortDescending();</span>
<a href="#l8.24"></a><span id="l8.24">   } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/base/modules/DBViewWrapper.jsm</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/base/modules/DBViewWrapper.jsm</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1840,19 +1840,18 @@ DBViewWrapper.prototype = {</span>
<a href="#l9.4"></a><span id="l9.4">    *  and setting us to false is ambiguous.  We should probably be using a</span>
<a href="#l9.5"></a><span id="l9.5">    *  single attribute with three constants...)</span>
<a href="#l9.6"></a><span id="l9.6">    */</span>
<a href="#l9.7"></a><span id="l9.7">   set showThreaded(aShowThreaded) {</span>
<a href="#l9.8"></a><span id="l9.8">     if (this.showThreaded != aShowThreaded) {</span>
<a href="#l9.9"></a><span id="l9.9">       let viewFlags = this._viewFlags;</span>
<a href="#l9.10"></a><span id="l9.10">       if (aShowThreaded) {</span>
<a href="#l9.11"></a><span id="l9.11">         viewFlags |= Ci.nsMsgViewFlagsType.kThreadedDisplay;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-      }</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-      // maybe we shouldn't do anything in this case?</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-      else {</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+      } else {</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+        // Maybe we shouldn't do anything in this case?</span>
<a href="#l9.17"></a><span id="l9.17">         viewFlags &amp;= ~Ci.nsMsgViewFlagsType.kThreadedDisplay;</span>
<a href="#l9.18"></a><span id="l9.18">       }</span>
<a href="#l9.19"></a><span id="l9.19">       // lose the group bit...</span>
<a href="#l9.20"></a><span id="l9.20">       viewFlags &amp;= ~Ci.nsMsgViewFlagsType.kGroupBySort;</span>
<a href="#l9.21"></a><span id="l9.21">       this._viewFlags = viewFlags;</span>
<a href="#l9.22"></a><span id="l9.22">     }</span>
<a href="#l9.23"></a><span id="l9.23">   },</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25" class="difflineat">@@ -1875,19 +1874,18 @@ DBViewWrapper.prototype = {</span>
<a href="#l9.26"></a><span id="l9.26">    */</span>
<a href="#l9.27"></a><span id="l9.27">   set showUnthreaded(aShowUnthreaded) {</span>
<a href="#l9.28"></a><span id="l9.28">     if (this.showUnthreaded != aShowUnthreaded) {</span>
<a href="#l9.29"></a><span id="l9.29">       if (aShowUnthreaded) {</span>
<a href="#l9.30"></a><span id="l9.30">         this._viewFlags &amp;= ~(</span>
<a href="#l9.31"></a><span id="l9.31">           Ci.nsMsgViewFlagsType.kGroupBySort |</span>
<a href="#l9.32"></a><span id="l9.32">           Ci.nsMsgViewFlagsType.kThreadedDisplay</span>
<a href="#l9.33"></a><span id="l9.33">         );</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineminus">-      }</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-      // maybe we shouldn't do anything in this case?</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-      else {</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+      } else {</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+        // Maybe we shouldn't do anything in this case?</span>
<a href="#l9.39"></a><span id="l9.39">         this._viewFlags =</span>
<a href="#l9.40"></a><span id="l9.40">           (this._viewFlags &amp; ~Ci.nsMsgViewFlagsType.kGroupBySort) |</span>
<a href="#l9.41"></a><span id="l9.41">           Ci.nsMsgViewFlagsType.kThreadedDisplay;</span>
<a href="#l9.42"></a><span id="l9.42">       }</span>
<a href="#l9.43"></a><span id="l9.43">     }</span>
<a href="#l9.44"></a><span id="l9.44">   },</span>
<a href="#l9.45"></a><span id="l9.45"> </span>
<a href="#l9.46"></a><span id="l9.46">   /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/base/modules/SearchSpec.jsm</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/base/modules/SearchSpec.jsm</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -252,19 +252,18 @@ SearchSpec.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">    *  weird combo-box that lets you view your unread messages, messages by tag,</span>
<a href="#l10.5"></a><span id="l10.5">    *  messages that aren't deleted, etc.</span>
<a href="#l10.6"></a><span id="l10.6">    *</span>
<a href="#l10.7"></a><span id="l10.7">    * @param aViewTerms The list of terms.  We take ownership and mutate it.</span>
<a href="#l10.8"></a><span id="l10.8">    */</span>
<a href="#l10.9"></a><span id="l10.9">   set viewTerms(aViewTerms) {</span>
<a href="#l10.10"></a><span id="l10.10">     if (aViewTerms) {</span>
<a href="#l10.11"></a><span id="l10.11">       this._viewTerms = this._groupifyTerms(aViewTerms);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    }</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-    // if they are nulling out already null values, do not apply view changes!</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-    else if (this._viewTerms === null) {</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+    } else if (this._viewTerms === null) {</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+      // If they are nulling out already null values, do not apply view changes!</span>
<a href="#l10.17"></a><span id="l10.17">       return;</span>
<a href="#l10.18"></a><span id="l10.18">     } else {</span>
<a href="#l10.19"></a><span id="l10.19">       this._viewTerms = null;</span>
<a href="#l10.20"></a><span id="l10.20">     }</span>
<a href="#l10.21"></a><span id="l10.21">     this.owner._applyViewChanges();</span>
<a href="#l10.22"></a><span id="l10.22">   },</span>
<a href="#l10.23"></a><span id="l10.23">   /**</span>
<a href="#l10.24"></a><span id="l10.24">    * @return the view terms currently in effect.  Do not mutate this.</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineat">@@ -279,19 +278,18 @@ SearchSpec.prototype = {</span>
<a href="#l10.26"></a><span id="l10.26">    * @param aVirtualFolderTerms The list of terms.  We make our own copy and</span>
<a href="#l10.27"></a><span id="l10.27">    *     do not mutate yours.</span>
<a href="#l10.28"></a><span id="l10.28">    */</span>
<a href="#l10.29"></a><span id="l10.29">   set virtualFolderTerms(aVirtualFolderTerms) {</span>
<a href="#l10.30"></a><span id="l10.30">     if (aVirtualFolderTerms) {</span>
<a href="#l10.31"></a><span id="l10.31">       // we need to clone virtual folder terms because they are pulled from a</span>
<a href="#l10.32"></a><span id="l10.32">       //  persistent location rather than created on demand</span>
<a href="#l10.33"></a><span id="l10.33">       this._virtualFolderTerms = this._groupifyTerms(aVirtualFolderTerms, true);</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-    }</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">-    // if they are nulling out already null values, do not apply view changes!</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-    else if (this._virtualFolderTerms === null) {</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+    } else if (this._virtualFolderTerms === null) {</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+      // If they are nulling out already null values, do not apply view changes!</span>
<a href="#l10.39"></a><span id="l10.39">       return;</span>
<a href="#l10.40"></a><span id="l10.40">     } else {</span>
<a href="#l10.41"></a><span id="l10.41">       this._virtualFolderTerms = null;</span>
<a href="#l10.42"></a><span id="l10.42">     }</span>
<a href="#l10.43"></a><span id="l10.43">     this.owner._applyViewChanges();</span>
<a href="#l10.44"></a><span id="l10.44">   },</span>
<a href="#l10.45"></a><span id="l10.45">   /**</span>
<a href="#l10.46"></a><span id="l10.46">    * @return the Virtual folder terms currently in effect.  Do not mutate this.</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineat">@@ -305,19 +303,18 @@ SearchSpec.prototype = {</span>
<a href="#l10.48"></a><span id="l10.48">    *  augmented with the 'context' search terms potentially provided by</span>
<a href="#l10.49"></a><span id="l10.49">    *  viewTerms and virtualFolderTerms.</span>
<a href="#l10.50"></a><span id="l10.50">    *</span>
<a href="#l10.51"></a><span id="l10.51">    * @param aUserTerms The list of terms.  We take ownership and mutate it.</span>
<a href="#l10.52"></a><span id="l10.52">    */</span>
<a href="#l10.53"></a><span id="l10.53">   set userTerms(aUserTerms) {</span>
<a href="#l10.54"></a><span id="l10.54">     if (aUserTerms) {</span>
<a href="#l10.55"></a><span id="l10.55">       this._userTerms = this._groupifyTerms(aUserTerms);</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">-    }</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-    // if they are nulling out already null values, do not apply view changes!</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-    else if (this._userTerms === null) {</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+    } else if (this._userTerms === null) {</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+      // If they are nulling out already null values, do not apply view changes!</span>
<a href="#l10.61"></a><span id="l10.61">       return;</span>
<a href="#l10.62"></a><span id="l10.62">     } else {</span>
<a href="#l10.63"></a><span id="l10.63">       this._userTerms = null;</span>
<a href="#l10.64"></a><span id="l10.64">     }</span>
<a href="#l10.65"></a><span id="l10.65">     this.owner._applyViewChanges();</span>
<a href="#l10.66"></a><span id="l10.66">   },</span>
<a href="#l10.67"></a><span id="l10.67">   /**</span>
<a href="#l10.68"></a><span id="l10.68">    * @return the user terms currently in effect as set via the |userTerms|</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineat">@@ -421,20 +418,19 @@ SearchSpec.prototype = {</span>
<a href="#l10.70"></a><span id="l10.70">         scope = serverScope;</span>
<a href="#l10.71"></a><span id="l10.71">       } else {</span>
<a href="#l10.72"></a><span id="l10.72">         // we need to test the validity in online and offline tables</span>
<a href="#l10.73"></a><span id="l10.73">         let onlineValidityTable = validityManager.getTable(serverScope);</span>
<a href="#l10.74"></a><span id="l10.74"> </span>
<a href="#l10.75"></a><span id="l10.75">         let offlineScope;</span>
<a href="#l10.76"></a><span id="l10.76">         if (folder.flags &amp; Ci.nsMsgFolderFlags.Offline) {</span>
<a href="#l10.77"></a><span id="l10.77">           offlineScope = Ci.nsMsgSearchScope.offlineMail;</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineminus">-        }</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineminus">-        // The onlineManual table is used for local search when there is no</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineminus">-        //  body available.</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineminus">-        else {</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+        } else {</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+          // The onlineManual table is used for local search when there is no</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+          // body available.</span>
<a href="#l10.85"></a><span id="l10.85">           offlineScope = Ci.nsMsgSearchScope.onlineManual;</span>
<a href="#l10.86"></a><span id="l10.86">         }</span>
<a href="#l10.87"></a><span id="l10.87"> </span>
<a href="#l10.88"></a><span id="l10.88">         let offlineValidityTable = validityManager.getTable(offlineScope);</span>
<a href="#l10.89"></a><span id="l10.89">         let offlineAvailable = true;</span>
<a href="#l10.90"></a><span id="l10.90">         let onlineAvailable = true;</span>
<a href="#l10.91"></a><span id="l10.91">         for (let term of fixIterator(</span>
<a href="#l10.92"></a><span id="l10.92">           session.searchTerms,</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineat">@@ -464,22 +460,21 @@ SearchSpec.prototype = {</span>
<a href="#l10.94"></a><span id="l10.94">               }</span>
<a href="#l10.95"></a><span id="l10.95">               if (!onlineValidityTable.getAvailable(term.attrib, term.op)) {</span>
<a href="#l10.96"></a><span id="l10.96">                 onlineAvailable = false;</span>
<a href="#l10.97"></a><span id="l10.97">               }</span>
<a href="#l10.98"></a><span id="l10.98">             }</span>
<a href="#l10.99"></a><span id="l10.99">           }</span>
<a href="#l10.100"></a><span id="l10.100">         }</span>
<a href="#l10.101"></a><span id="l10.101">         // If both scopes work, honor the onlineSearch request, unless we're</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineminus">-        // filtering (quick search and/or a view selected)</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineplus">+        // filtering (quick search and/or a view selected).</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineplus">+        // If only one works, use it. Otherwise, default to offline</span>
<a href="#l10.105"></a><span id="l10.105">         if (onlineAvailable &amp;&amp; offlineAvailable) {</span>
<a href="#l10.106"></a><span id="l10.106">           scope = !filtering &amp;&amp; this.onlineSearch ? serverScope : offlineScope;</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-        }</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineminus">-        // If only one works, use it. Otherwise, default to offline</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineminus">-        else if (onlineAvailable) {</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+        } else if (onlineAvailable) {</span>
<a href="#l10.111"></a><span id="l10.111">           scope = serverScope;</span>
<a href="#l10.112"></a><span id="l10.112">         } else {</span>
<a href="#l10.113"></a><span id="l10.113">           scope = offlineScope;</span>
<a href="#l10.114"></a><span id="l10.114">         }</span>
<a href="#l10.115"></a><span id="l10.115">       }</span>
<a href="#l10.116"></a><span id="l10.116">       session.addScopeTerm(scope, folder);</span>
<a href="#l10.117"></a><span id="l10.117">     }</span>
<a href="#l10.118"></a><span id="l10.118">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/addrbook/content/abCardView.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCardView.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -200,23 +200,18 @@ function DisplayCardViewPane(realCard) {</span>
<a href="#l11.4"></a><span id="l11.4">   };</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6">   var data = top.cvData;</span>
<a href="#l11.7"></a><span id="l11.7">   var visible;</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">   // Contact photo</span>
<a href="#l11.10"></a><span id="l11.10">   displayPhoto(card, cvData.cvPhoto);</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  var titleString;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-  if (generatedName == &quot;&quot;) {</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-    titleString = card.primaryEmail;</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-  } // if no generatedName, use email</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-  else {</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-    titleString = generatedName;</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-  }</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+  // If no generatedName, use email.</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+  let titleString = generatedName == &quot;&quot; ? card.primaryEmail : generatedName;</span>
<a href="#l11.21"></a><span id="l11.21"> </span>
<a href="#l11.22"></a><span id="l11.22">   // set fields in card view pane</span>
<a href="#l11.23"></a><span id="l11.23">   if (card.isMailList) {</span>
<a href="#l11.24"></a><span id="l11.24">     cvSetNode(</span>
<a href="#l11.25"></a><span id="l11.25">       data.CardTitle,</span>
<a href="#l11.26"></a><span id="l11.26">       gAddressBookBundle.getFormattedString(&quot;viewListTitle&quot;, [generatedName])</span>
<a href="#l11.27"></a><span id="l11.27">     );</span>
<a href="#l11.28"></a><span id="l11.28">   } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/addrbook/content/abCommon.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCommon.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -743,19 +743,18 @@ function DirPaneSelectionChange() {</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> function ChangeDirectoryByURI(uri = kPersonalAddressbookURI) {</span>
<a href="#l12.6"></a><span id="l12.6">   SetAbView(uri);</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8">   // Actively de-selecting if there are any pre-existing selections</span>
<a href="#l12.9"></a><span id="l12.9">   // in the results list.</span>
<a href="#l12.10"></a><span id="l12.10">   if (gAbView &amp;&amp; gAbView.getCardFromRow(0)) {</span>
<a href="#l12.11"></a><span id="l12.11">     gAbView.selection.clearSelection();</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  }</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-  // the selection changes if we were switching directories.</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-  else {</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+  } else {</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+    // The selection changes if we were switching directories.</span>
<a href="#l12.17"></a><span id="l12.17">     ResultsPaneSelectionChanged();</span>
<a href="#l12.18"></a><span id="l12.18">   }</span>
<a href="#l12.19"></a><span id="l12.19"> }</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21"> function AbNewList() {</span>
<a href="#l12.22"></a><span id="l12.22">   goNewListDialog(getSelectedDirectoryURI());</span>
<a href="#l12.23"></a><span id="l12.23"> }</span>
<a href="#l12.24"></a><span id="l12.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -784,22 +784,21 @@ function AbIMSelected() {</span>
<a href="#l13.4"></a><span id="l13.4">       } else if (chatContact.canSendMessage) {</span>
<a href="#l13.5"></a><span id="l13.5">         offline.push(chatContact);</span>
<a href="#l13.6"></a><span id="l13.6">       }</span>
<a href="#l13.7"></a><span id="l13.7">     }</span>
<a href="#l13.8"></a><span id="l13.8">   }</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10">   let selectedContact;</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  // If we have any contacts in the online group, we'll take the first one.</span>
<a href="#l13.13"></a><span id="l13.13">   if (online.length) {</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+    // We have contacts in the online group, take the first one.</span>
<a href="#l13.15"></a><span id="l13.15">     selectedContact = online[0];</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-  }</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-  // If not, we'll take the first contact in the offline group.</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-  else if (offline.length) {</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+  } else if (offline.length) {</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+    // Else take the first contact in the offline group.</span>
<a href="#l13.21"></a><span id="l13.21">     selectedContact = offline[0];</span>
<a href="#l13.22"></a><span id="l13.22">   }</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24">   // If we found a contact we can chat with, open / focus the chat tab with</span>
<a href="#l13.25"></a><span id="l13.25">   // a conversation opened with that contact.</span>
<a href="#l13.26"></a><span id="l13.26">   if (selectedContact) {</span>
<a href="#l13.27"></a><span id="l13.27">     let prplConv = selectedContact.createConversation();</span>
<a href="#l13.28"></a><span id="l13.28">     let uiConv = Services.conversations.getUIConversation(prplConv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -4954,25 +4954,24 @@ function AddAttachments(aAttachments, aC</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5">     if (!attachment.name) {</span>
<a href="#l14.6"></a><span id="l14.6">       attachment.name = gMsgCompose.AttachmentPrettyName(attachment.url, null);</span>
<a href="#l14.7"></a><span id="l14.7">     }</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9">     // For security reasons, don't allow *-message:// uris to leak out.</span>
<a href="#l14.10"></a><span id="l14.10">     // We don't want to reveal the .slt path (for mailbox://), or the username</span>
<a href="#l14.11"></a><span id="l14.11">     // or hostname.</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+    // Don't allow file or mail/news protocol uris to leak out either.</span>
<a href="#l14.13"></a><span id="l14.13">     if (</span>
<a href="#l14.14"></a><span id="l14.14">       /^mailbox-message:|^imap-message:|^news-message:/i.test(attachment.name)</span>
<a href="#l14.15"></a><span id="l14.15">     ) {</span>
<a href="#l14.16"></a><span id="l14.16">       attachment.name = getComposeBundle().getString(</span>
<a href="#l14.17"></a><span id="l14.17">         &quot;messageAttachmentSafeName&quot;</span>
<a href="#l14.18"></a><span id="l14.18">       );</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-    }</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-    // Don't allow file or mail/news protocol uris to leak out either.</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-    else if (/^file:|^mailbox:|^imap:|^s?news:/i.test(attachment.name)) {</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+    } else if (/^file:|^mailbox:|^imap:|^s?news:/i.test(attachment.name)) {</span>
<a href="#l14.23"></a><span id="l14.23">       attachment.name = getComposeBundle().getString(&quot;partAttachmentSafeName&quot;);</span>
<a href="#l14.24"></a><span id="l14.24">     }</span>
<a href="#l14.25"></a><span id="l14.25"> </span>
<a href="#l14.26"></a><span id="l14.26">     let item = bucket.appendItem(attachment);</span>
<a href="#l14.27"></a><span id="l14.27">     addedAttachments.appendElement(attachment);</span>
<a href="#l14.28"></a><span id="l14.28"> </span>
<a href="#l14.29"></a><span id="l14.29">     if (attachment.size != -1) {</span>
<a href="#l14.30"></a><span id="l14.30">       gAttachmentsSize += attachment.size;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/im/modules/search_im.jsm</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/im/modules/search_im.jsm</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -154,22 +154,21 @@ function scoreOffsets(aMessage, aContext</span>
<a href="#l15.4"></a><span id="l15.4">   for (let i = 0; i &lt; offsetNums.length; i += 4) {</span>
<a href="#l15.5"></a><span id="l15.5">     let columnIndex = offsetNums[i];</span>
<a href="#l15.6"></a><span id="l15.6">     let termIndex = offsetNums[i + 1];</span>
<a href="#l15.7"></a><span id="l15.7">     columnTermIncidence[columnIndex][termIndex]++;</span>
<a href="#l15.8"></a><span id="l15.8">   }</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">   for (let iColumn = 0; iColumn &lt; COLUMN_ALL_MATCH_SCORES.length; iColumn++) {</span>
<a href="#l15.11"></a><span id="l15.11">     let termIncidence = columnTermIncidence[iColumn];</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    // bestow all match credit</span>
<a href="#l15.13"></a><span id="l15.13">     if (termIncidence.every(identityFunc)) {</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+      // Bestow all match credit.</span>
<a href="#l15.15"></a><span id="l15.15">       score += COLUMN_ALL_MATCH_SCORES[iColumn];</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-    }</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-    // bestow partial match credit</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-    else if (termIncidence.some(identityFunc)) {</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+    } else if (termIncidence.some(identityFunc)) {</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+      // Bestow partial match credit.</span>
<a href="#l15.21"></a><span id="l15.21">       score += Math.min(</span>
<a href="#l15.22"></a><span id="l15.22">         COLUMN_ALL_MATCH_SCORES[iColumn],</span>
<a href="#l15.23"></a><span id="l15.23">         COLUMN_PARTIAL_PER_MATCH_SCORES[iColumn] *</span>
<a href="#l15.24"></a><span id="l15.24">           termIncidence.filter(identityFunc).length</span>
<a href="#l15.25"></a><span id="l15.25">       );</span>
<a href="#l15.26"></a><span id="l15.26">     }</span>
<a href="#l15.27"></a><span id="l15.27">     // bestow multiple match credit</span>
<a href="#l15.28"></a><span id="l15.28">     score +=</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineat">@@ -276,21 +275,19 @@ GlodaIMSearcher.prototype = {</span>
<a href="#l15.30"></a><span id="l15.30">         fulltextQueryString += this.andTerms ? &quot; &quot; : &quot; OR &quot;;</span>
<a href="#l15.31"></a><span id="l15.31">       }</span>
<a href="#l15.32"></a><span id="l15.32"> </span>
<a href="#l15.33"></a><span id="l15.33">       // Put our term in quotes.  This is needed for the tokenizer to be able</span>
<a href="#l15.34"></a><span id="l15.34">       //  to do useful things.  The exception is people clever enough to use</span>
<a href="#l15.35"></a><span id="l15.35">       //  NEAR.</span>
<a href="#l15.36"></a><span id="l15.36">       if (/^NEAR(\/\d+)?$/.test(term)) {</span>
<a href="#l15.37"></a><span id="l15.37">         fulltextQueryString += term;</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-      }</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-      // Check if this is a single-character CJK search query.  If so, we want</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-      //  to add a wildcard.</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">-      // Our tokenizer treats anything at/above 0x2000 as CJK for now.</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-      else if (term.length == 1 &amp;&amp; term.charCodeAt(0) &gt;= 0x2000) {</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+      } else if (term.length == 1 &amp;&amp; term.charCodeAt(0) &gt;= 0x2000) {</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+        // This is a single-character CJK search query, so add a wildcard.</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+        // Our tokenizer treats anything at/above 0x2000 as CJK for now.</span>
<a href="#l15.46"></a><span id="l15.46">         fulltextQueryString += term + &quot;*&quot;;</span>
<a href="#l15.47"></a><span id="l15.47">       } else if (</span>
<a href="#l15.48"></a><span id="l15.48">         (term.length == 2 &amp;&amp;</span>
<a href="#l15.49"></a><span id="l15.49">           term.charCodeAt(0) &gt;= 0x2000 &amp;&amp;</span>
<a href="#l15.50"></a><span id="l15.50">           term.charCodeAt(1) &gt;= 0x2000) ||</span>
<a href="#l15.51"></a><span id="l15.51">         term.length &gt;= 3</span>
<a href="#l15.52"></a><span id="l15.52">       ) {</span>
<a href="#l15.53"></a><span id="l15.53">         fulltextQueryString += '&quot;' + term + '&quot;';</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/components/search/SearchIntegration.jsm</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/components/search/SearchIntegration.jsm</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -494,20 +494,19 @@ var SearchSupport = {</span>
<a href="#l16.4"></a><span id="l16.4">       this._currentFolderToIndex = this._foldersToIndex.next().value;</span>
<a href="#l16.5"></a><span id="l16.5">     }</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7">     // we'd like to index more than one message on each timer fire,</span>
<a href="#l16.8"></a><span id="l16.8">     // but since streaming is async, it's hard to know how long</span>
<a href="#l16.9"></a><span id="l16.9">     // it's going to take to stream any particular message.</span>
<a href="#l16.10"></a><span id="l16.10">     if (this._currentFolderToIndex) {</span>
<a href="#l16.11"></a><span id="l16.11">       msgHdrAndReindexTime = this._findNextHdrToIndex();</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    }</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-    // we've cycled through all the folders, we should take a break</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-    // from indexing of existing messages</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-    else {</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+    } else {</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+      // We've cycled through all the folders. We should take a break</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+      // from indexing of existing messages.</span>
<a href="#l16.19"></a><span id="l16.19">       this.__backgroundIndexingDone = true;</span>
<a href="#l16.20"></a><span id="l16.20">     }</span>
<a href="#l16.21"></a><span id="l16.21"> </span>
<a href="#l16.22"></a><span id="l16.22">     if (!msgHdrAndReindexTime) {</span>
<a href="#l16.23"></a><span id="l16.23">       this._log.debug(&quot;reached end of folder&quot;);</span>
<a href="#l16.24"></a><span id="l16.24">       if (this._currentFolderToIndex) {</span>
<a href="#l16.25"></a><span id="l16.25">         this._currentFolderToIndex = null;</span>
<a href="#l16.26"></a><span id="l16.26">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/test/mozmill/attachment/test-attachment-size.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/test/mozmill/attachment/test-attachment-size.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -208,18 +208,18 @@ function setupModule(module) {</span>
<a href="#l17.4"></a><span id="l17.4">   /* Much like the above comment, libmime counts bytes differently on Windows,</span>
<a href="#l17.5"></a><span id="l17.5">    * where it counts newlines (\r\n) as 2 bytes. Mac and Linux treats them as</span>
<a href="#l17.6"></a><span id="l17.6">    * 1 byte.</span>
<a href="#l17.7"></a><span id="l17.7">    */</span>
<a href="#l17.8"></a><span id="l17.8">   var attachedMessageLength;</span>
<a href="#l17.9"></a><span id="l17.9">   if (epsilon == 4) {</span>
<a href="#l17.10"></a><span id="l17.10">     // Windows</span>
<a href="#l17.11"></a><span id="l17.11">     attachedMessageLength = attachedMessage.toMessageString().length;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  } // Mac/Linux</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-  else {</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+  } else {</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+    // Mac/Linux</span>
<a href="#l17.16"></a><span id="l17.16">     attachedMessageLength = attachedMessage</span>
<a href="#l17.17"></a><span id="l17.17">       .toMessageString()</span>
<a href="#l17.18"></a><span id="l17.18">       .replace(/\r\n/g, &quot;\n&quot;).length;</span>
<a href="#l17.19"></a><span id="l17.19">   }</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21">   folder = create_folder(&quot;AttachmentSizeA&quot;);</span>
<a href="#l17.22"></a><span id="l17.22">   for (let i = 0; i &lt; messages.length; i++) {</span>
<a href="#l17.23"></a><span id="l17.23">     // First, add any missing info to the message object.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -818,22 +818,21 @@ function switch_tab(aNewTab) {</span>
<a href="#l18.4"></a><span id="l18.4">     targetTab.messageDisplay.visible &amp;&amp;</span>
<a href="#l18.5"></a><span id="l18.5">     targetTab.folderDisplay.selectedCount</span>
<a href="#l18.6"></a><span id="l18.6">   ) {</span>
<a href="#l18.7"></a><span id="l18.7">     plan_for_message_display(targetTab);</span>
<a href="#l18.8"></a><span id="l18.8">   }</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">   mc.tabmail.switchToTab(targetTab);</span>
<a href="#l18.11"></a><span id="l18.11">   if (mc.messageDisplay.visible) {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    // if there is something selected, wait for display completion</span>
<a href="#l18.13"></a><span id="l18.13">     if (mc.folderDisplay.selectedCount) {</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+      // There is something selected, wait for display completion.</span>
<a href="#l18.15"></a><span id="l18.15">       wait_for_message_display_completion(mc, true);</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-    }</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">-    // otherwise wait for the pane to end up blank</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-    else {</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+    } else {</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+      // Wait for the pane to end up blank.</span>
<a href="#l18.21"></a><span id="l18.21">       wait_for_blank_content_pane();</span>
<a href="#l18.22"></a><span id="l18.22">     }</span>
<a href="#l18.23"></a><span id="l18.23">   }</span>
<a href="#l18.24"></a><span id="l18.24"> }</span>
<a href="#l18.25"></a><span id="l18.25"> </span>
<a href="#l18.26"></a><span id="l18.26"> /**</span>
<a href="#l18.27"></a><span id="l18.27">  * Assert that the currently selected tab is the given one.</span>
<a href="#l18.28"></a><span id="l18.28">  *</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineat">@@ -988,19 +987,18 @@ function close_tab(aTabToClose) {</span>
<a href="#l18.30"></a><span id="l18.30">   }</span>
<a href="#l18.31"></a><span id="l18.31"> </span>
<a href="#l18.32"></a><span id="l18.32">   mc.tabmail.closeTab(aTabToClose);</span>
<a href="#l18.33"></a><span id="l18.33"> </span>
<a href="#l18.34"></a><span id="l18.34">   // if there is a message visible in the tab, make sure we wait for the load</span>
<a href="#l18.35"></a><span id="l18.35">   if (nextTab &amp;&amp; mc.messageDisplay.visible) {</span>
<a href="#l18.36"></a><span id="l18.36">     if (mc.folderDisplay.selectedCount) {</span>
<a href="#l18.37"></a><span id="l18.37">       wait_for_message_display_completion(mc, true);</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-    }</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-    // otherwise wait for the pane to end up blank</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-    else {</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+    } else {</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineplus">+      // Otherwise wait for the pane to end up blank.</span>
<a href="#l18.43"></a><span id="l18.43">       wait_for_blank_content_pane();</span>
<a href="#l18.44"></a><span id="l18.44">     }</span>
<a href="#l18.45"></a><span id="l18.45">   }</span>
<a href="#l18.46"></a><span id="l18.46"> </span>
<a href="#l18.47"></a><span id="l18.47">   // check that the tab count decreased</span>
<a href="#l18.48"></a><span id="l18.48">   if (mc.tabmail.tabContainer.allTabs.length != preCount - 1) {</span>
<a href="#l18.49"></a><span id="l18.49">     throw new Error(&quot;The tab never actually got closed!&quot;);</span>
<a href="#l18.50"></a><span id="l18.50">   }</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineat">@@ -1759,18 +1757,18 @@ function close_popup(aController, eid) {</span>
<a href="#l18.52"></a><span id="l18.52">     return;</span>
<a href="#l18.53"></a><span id="l18.53">   }</span>
<a href="#l18.54"></a><span id="l18.54">   mark_action(&quot;fdh&quot;, &quot;close_popup&quot;, [elem]);</span>
<a href="#l18.55"></a><span id="l18.55">   // if it's in the process of closing, don't push escape</span>
<a href="#l18.56"></a><span id="l18.56">   if (elem.state == &quot;hiding&quot;) {</span>
<a href="#l18.57"></a><span id="l18.57">     mark_action(&quot;fdh&quot;, &quot;close_popup&quot;, [</span>
<a href="#l18.58"></a><span id="l18.58">       &quot;popup suspiciously already closing...&quot;,</span>
<a href="#l18.59"></a><span id="l18.59">     ]);</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineminus">-  } // actually push escape because it's not closing/closed</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineminus">-  else {</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineplus">+  } else {</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineplus">+    // Actually push escape because it's not closing/closed.</span>
<a href="#l18.64"></a><span id="l18.64">     aController.keypress(eid, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l18.65"></a><span id="l18.65">   }</span>
<a href="#l18.66"></a><span id="l18.66">   utils.waitFor(() =&gt; elem.state == &quot;closed&quot;, &quot;Popup did not close!&quot;, 1000, 50);</span>
<a href="#l18.67"></a><span id="l18.67"> }</span>
<a href="#l18.68"></a><span id="l18.68"> </span>
<a href="#l18.69"></a><span id="l18.69"> /**</span>
<a href="#l18.70"></a><span id="l18.70">  * Pretend we are pressing the delete key, triggering message deletion of the</span>
<a href="#l18.71"></a><span id="l18.71">  *  selected messages.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -70,21 +70,20 @@</span>
<a href="#l19.4"></a><span id="l19.4">   // bug 418356:</span>
<a href="#l19.5"></a><span id="l19.5">   //</span>
<a href="#l19.6"></a><span id="l19.6">   // https://bugzilla.mozilla.org/show_bug.cgi?id=418356</span>
<a href="#l19.7"></a><span id="l19.7">   var parentChromeURIString;</span>
<a href="#l19.8"></a><span id="l19.8">   if (baseURI) {</span>
<a href="#l19.9"></a><span id="l19.9">     // We're being loaded from a chrome-privileged document, so</span>
<a href="#l19.10"></a><span id="l19.10">     // use its URL as the parent string.</span>
<a href="#l19.11"></a><span id="l19.11">     parentChromeURIString = baseURI.spec;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  }</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-  // We're being loaded from a chrome-privileged JS module or</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-  // SecurableModule, so use its filename (which may itself</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-  // contain a reference to a parent).</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-  else {</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+  } else {</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+    // We're being loaded from a chrome-privileged JS module or</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+    // SecurableModule, so use its filename (which may itself</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+    // contain a reference to a parent).</span>
<a href="#l19.21"></a><span id="l19.21">     parentChromeURIString = Components.stack.filename;</span>
<a href="#l19.22"></a><span id="l19.22">   }</span>
<a href="#l19.23"></a><span id="l19.23"> </span>
<a href="#l19.24"></a><span id="l19.24">   function maybeParentifyFilename(filename) {</span>
<a href="#l19.25"></a><span id="l19.25">     var doParentifyFilename = true;</span>
<a href="#l19.26"></a><span id="l19.26">     try {</span>
<a href="#l19.27"></a><span id="l19.27">       // TODO: Ideally we should just make</span>
<a href="#l19.28"></a><span id="l19.28">       // nsIChromeRegistry.wrappersEnabled() available from script</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

