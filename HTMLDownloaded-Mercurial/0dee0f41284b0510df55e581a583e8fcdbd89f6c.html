<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29781:0dee0f41284b0510df55e581a583e8fcdbd89f6c</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 0dee0f41284b0510df55e581a583e8fcdbd89f6c" />
<meta property="og:url" content="/comm-central/rev/0dee0f41284b0510df55e581a583e8fcdbd89f6c" />
<meta property="og:description" content="Bug 1625806 - Modify build-libotr.sh to work as a toolchain build script. r=darktrojan" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 0dee0f41284b0510df55e581a583e8fcdbd89f6c 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/0dee0f41284b0510df55e581a583e8fcdbd89f6c">shortlog</a> |
<a href="/comm-central/log/0dee0f41284b0510df55e581a583e8fcdbd89f6c">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/0dee0f41284b0510df55e581a583e8fcdbd89f6c">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/0dee0f41284b0510df55e581a583e8fcdbd89f6c">files</a> |
changeset |
<a href="/comm-central/raw-rev/0dee0f41284b0510df55e581a583e8fcdbd89f6c">raw</a>  | <a href="/comm-central/archive/0dee0f41284b0510df55e581a583e8fcdbd89f6c.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1625806">Bug 1625806</a> - Modify build-libotr.sh to work as a toolchain build script. r=darktrojan
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#111;&#98;&#32;&#76;&#101;&#109;&#108;&#101;&#121;&#32;&#60;&#114;&#111;&#98;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 04 Jun 2020 01:52:53 +0000</td></tr>

<tr>
 <td>changeset 29781</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/0dee0f41284b0510df55e581a583e8fcdbd89f6c">0dee0f41284b0510df55e581a583e8fcdbd89f6c</a></td>
</tr>



<tr>
<td>parent 29780</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6ef6741b3bd30c27c20c8d49df9473fcfa9db2fb">6ef6741b3bd30c27c20c8d49df9473fcfa9db2fb</a>
</td>
</tr>

<tr>
<td>child 29782</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/84e76015274197ef91b9ebd22cb5d08854fe29e5">84e76015274197ef91b9ebd22cb5d08854fe29e5</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=0dee0f41284b0510df55e581a583e8fcdbd89f6c">17530</a></td></tr>
<tr><td>push user</td><td>thunderbird@calypsoblue.org</td></tr>
<tr><td>push date</td><td class="date age">Thu, 04 Jun 2020 14:57:25 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@98c0fbe4a5e8 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=98c0fbe4a5e804ea077776ce3f4bf6b22e943c11">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=98c0fbe4a5e804ea077776ce3f4bf6b22e943c11&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=98c0fbe4a5e804ea077776ce3f4bf6b22e943c11&newProject=comm-central&newRevision=0dee0f41284b0510df55e581a583e8fcdbd89f6c&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=98c0fbe4a5e804ea077776ce3f4bf6b22e943c11&newProject=comm-central&newRevision=0dee0f41284b0510df55e581a583e8fcdbd89f6c&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=98c0fbe4a5e804ea077776ce3f4bf6b22e943c11&newProject=comm-central&newRevision=0dee0f41284b0510df55e581a583e8fcdbd89f6c&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28darktrojan%29&revcount=50">darktrojan</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1625806">1625806</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1625806">Bug 1625806</a> - Modify build-libotr.sh to work as a toolchain build script. r=darktrojan

Toolchain builds have things in a slightly different arrangement. GECKO_PATH
is at /builds/worker/workspace/build/src, so removing build at line 17 will
delete the checkout we need for the libotr sources.
At the same time, this script will also run on the thunderbird-mingw docker
image which uses the build image layout, and the build directory will need
to be created.
In either case, workspace can be cached between Taskcluster runs under some
circumstances so clearing out the directories that this script uses is still
warranted.

Differential Revision: <a href="https://phabricator.services.mozilla.com/D78205">https://phabricator.services.mozilla.com/D78205</a></div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0dee0f41284b0510df55e581a583e8fcdbd89f6c/taskcluster/scripts/build-libotr.sh">taskcluster/scripts/build-libotr.sh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0dee0f41284b0510df55e581a583e8fcdbd89f6c/taskcluster/scripts/build-libotr.sh">file</a> |
<a href="/comm-central/annotate/0dee0f41284b0510df55e581a583e8fcdbd89f6c/taskcluster/scripts/build-libotr.sh">annotate</a> |
<a href="/comm-central/diff/0dee0f41284b0510df55e581a583e8fcdbd89f6c/taskcluster/scripts/build-libotr.sh">diff</a> |
<a href="/comm-central/comparison/0dee0f41284b0510df55e581a583e8fcdbd89f6c/taskcluster/scripts/build-libotr.sh">comparison</a> |
<a href="/comm-central/log/0dee0f41284b0510df55e581a583e8fcdbd89f6c/taskcluster/scripts/build-libotr.sh">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/taskcluster/scripts/build-libotr.sh</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/taskcluster/scripts/build-libotr.sh</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -9,17 +9,24 @@ set -x -e -v</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> # Environment variables that are set by Taskcluster.</span>
<a href="#l1.6"></a><span id="l1.6"> GECKO_PATH=${GECKO_PATH:-&quot;/builds/worker/checkouts/gecko&quot;}</span>
<a href="#l1.7"></a><span id="l1.7"> MOZ_FETCHES_DIR=${MOZ_FETCHES_DIR:-&quot;/builds/worker/workspace/fetches&quot;}</span>
<a href="#l1.8"></a><span id="l1.8"> UPLOAD_DIR=${UPLOAD_DIR:-&quot;/builds/worker/artifacts&quot;}</span>
<a href="#l1.9"></a><span id="l1.9"> WORKSPACE=${WORKSPACE:-&quot;${HOME}/workspace&quot;}</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> cd &quot;$WORKSPACE&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-rm -rf build &amp;&amp; mkdir build</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+if [[ ! -d build ]]; then</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+  mkdir build</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+fi</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+for _d in build/libgpg-error build/libgcrypt build/libotr build/build_prefix; do</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+  if [[ -e &quot;${_d}&quot; ]]; then</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+    rm -rf &quot;${_d}&quot;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+  fi</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+done</span>
<a href="#l1.21"></a><span id="l1.21"> BUILD=&quot;${WORKSPACE}/build&quot;</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23"> COMPRESS_EXT=xz</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25"> _INSTDIR=&quot;build_prefix&quot;</span>
<a href="#l1.26"></a><span id="l1.26"> _PREFIX=&quot;${BUILD}/${_INSTDIR}&quot;</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28"> _ARTIFACT_STAGEDIR=&quot;${BUILD}/libotr_stage&quot;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

