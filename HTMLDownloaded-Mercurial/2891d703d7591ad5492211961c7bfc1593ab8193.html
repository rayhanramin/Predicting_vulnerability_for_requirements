<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28992:2891d703d7591ad5492211961c7bfc1593ab8193</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 2891d703d7591ad5492211961c7bfc1593ab8193" />
<meta property="og:url" content="/comm-central/rev/2891d703d7591ad5492211961c7bfc1593ab8193" />
<meta property="og:description" content="Bug 1621587 - remove external API compatibility functions from nsMsgUtils.h. r=benc DONTBUILD" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 2891d703d7591ad5492211961c7bfc1593ab8193 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/2891d703d7591ad5492211961c7bfc1593ab8193">shortlog</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/2891d703d7591ad5492211961c7bfc1593ab8193">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193">files</a> |
changeset |
<a href="/comm-central/raw-rev/2891d703d7591ad5492211961c7bfc1593ab8193">raw</a>  | <a href="/comm-central/archive/2891d703d7591ad5492211961c7bfc1593ab8193.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1621587">Bug 1621587</a> - remove external API compatibility functions from nsMsgUtils.h. r=benc DONTBUILD
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#103;&#110;&#117;&#115;&#32;&#77;&#101;&#108;&#105;&#110;&#32;&#60;&#109;&#107;&#109;&#101;&#108;&#105;&#110;&#43;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#105;&#107;&#105;&#46;&#102;&#105;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 16 Mar 2020 12:54:02 +0200</td></tr>

<tr>
 <td>changeset 28992</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/2891d703d7591ad5492211961c7bfc1593ab8193">2891d703d7591ad5492211961c7bfc1593ab8193</a></td>
</tr>



<tr>
<td>parent 28991</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c84838d1d59664681b4abd35f5ee9f7c0dad6769">c84838d1d59664681b4abd35f5ee9f7c0dad6769</a>
</td>
</tr>

<tr>
<td>child 28993</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3511b452ac30ac419fb0148b133a323939e3152f">3511b452ac30ac419fb0148b133a323939e3152f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=2891d703d7591ad5492211961c7bfc1593ab8193">17143</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Mon, 16 Mar 2020 10:54:37 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@2891d703d759 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2891d703d7591ad5492211961c7bfc1593ab8193">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2891d703d7591ad5492211961c7bfc1593ab8193&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2891d703d7591ad5492211961c7bfc1593ab8193&newProject=comm-central&newRevision=2891d703d7591ad5492211961c7bfc1593ab8193&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2891d703d7591ad5492211961c7bfc1593ab8193&newProject=comm-central&newRevision=2891d703d7591ad5492211961c7bfc1593ab8193&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2891d703d7591ad5492211961c7bfc1593ab8193&newProject=comm-central&newRevision=2891d703d7591ad5492211961c7bfc1593ab8193&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28benc%29&revcount=50">benc</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1621587">1621587</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1621587">Bug 1621587</a> - remove external API compatibility functions from nsMsgUtils.h. r=benc DONTBUILD

#define MsgLowerCaseEqualsLiteral(str, l) (str).LowerCaseEqualsLiteral(l)
find . -type f -not -path &quot;*.hg/*&quot; -regex &quot;.*\.\(c\|h\|cpp\)$&quot; -exec sed -i -E &quot;s/MsgLowerCaseEqualsLiteral\((.+), (.+)\)/\1.LowerCaseEqualsLiteral(\2)/g&quot; {} \;
sed -i -E &quot;s/MsgLowerCaseEqualsLiteral\(([^,]+), */\1.LowerCaseEqualsLiteral(/g&quot; mailnews/base/util/nsMsgDBFolder.cpp mailnews/compose/src/nsURLFetcher.cpp

#define MsgRFindChar(str, ch, len) (str).RFindChar(ch, len)
find . -type f -not -path &quot;*.hg/*&quot; -regex &quot;.*\.\(c\|h\|cpp\)$&quot; -exec sed -i -E &quot;s/MsgRFindChar\(([^,]+), */\1.RFindChar(/g&quot; {} \;

#define MsgCompressWhitespace(str) (str).CompressWhitespace()
find . -type f -not -path &quot;*.hg/*&quot; -regex &quot;.*\.\(c\|h\|cpp\)$&quot; -exec sed -i -E &quot;s/MsgCompressWhitespace\(([^,]+)\)/\1.CompressWhitespace()/g&quot; {} \;

#define MsgReplaceSubstring(str, what, replacement) (str).ReplaceSubstring(what, replacement)
find . -type f -not -path &quot;*.hg/*&quot; -regex &quot;.*\.\(c\|h\|cpp\)$&quot; -exec sed -i -E &quot;s/MsgReplaceSubstring\(([^,]+), */\1.ReplaceSubstring(/g&quot; {} \;

#define MsgIsUTF8(str) mozilla::IsUtf8(str)
find . -type f -not -path &quot;*.hg/*&quot; -regex &quot;.*\.\(c\|h\|cpp\)$&quot; -exec sed -i 's/MsgIsUTF8/mozilla::IsUtf8/g' {} \;

#define MsgNewInterfaceRequestorAggregation(aFirst, aSecond, aResult) NS_NewInterfaceRequestorAggregation(aFirst, aSecond, aResult)
find . -type f -not -path &quot;*.hg/*&quot; -regex &quot;.*\.\(c\|h\|cpp\)$&quot; -exec sed -i 's/MsgNewInterfaceRequestorAggregation/NS_NewInterfaceRequestorAggregation/g' {} \;

#define MsgNewNotificationCallbacksAggregation(aCallbacks, aLoadGroup, aResult) NS_NewNotificationCallbacksAggregation(aCallbacks, aLoadGroup, aResult)
find . -type f -not -path &quot;*.hg/*&quot; -regex &quot;.*\.\(c\|h\|cpp\)$&quot; -exec sed -i 's/MsgNewNotificationCallbacksAggregation/NS_NewNotificationCallbacksAggregation/g' {} \;

#define MsgReplaceChar(aString, aNeedle, aReplacement) (aString).ReplaceChar(aNeedle, aReplacement)
find . -type f -not -path &quot;*.hg/*&quot; -regex &quot;.*\.\(c\|h\|cpp\)$&quot; -exec sed -i -E &quot;s/MsgReplaceChar\(([^,]+), */\1.ReplaceChar(/g&quot; {} \;

#define MsgFind(str, what, ignore_case, offset) (str).Find(what, ignore_case, offset)
find . -type f -not -path &quot;*.hg/*&quot; -regex &quot;.*\.\(c\|h\|cpp\)$&quot; -exec sed -i -E &quot;s/MsgFind\(([^,]+), */\1.Find(/g&quot; {} \;

#define MsgCountChar(aString, aChar) (aString).CountChar(aChar)
find . -type f -not -path &quot;*.hg/*&quot; -regex &quot;.*\.\(c\|h\|cpp\)$&quot; -exec sed -i -E &quot;s/MsgCountChar\(([^,]+), */\1.CountChar(/g&quot; {} \;

# Find files using mozilla:IsUTF8 but not including the header
grep --exclude-dir=.hg -rl &quot;mozilla::IsUtf8&quot; | xargs grep -L &quot;mozilla/Utf8.h&quot;

# Now remove defines from mailnews/base/util/nsMsgUtils.h manually
# + remove IsUtf8 from nsMSgUtils.h
cd ..
./mach clang-format -p comm/mailnews</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessengerWinIntegration.cpp">mailnews/base/src/nsMessengerWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessengerWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessengerWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessengerWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessengerWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMessengerWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgContentPolicy.cpp">mailnews/base/src/nsMsgContentPolicy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgContentPolicy.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgContentPolicy.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgContentPolicy.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgContentPolicy.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgContentPolicy.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgTagService.cpp">mailnews/base/src/nsMsgTagService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgTagService.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgTagService.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgTagService.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgTagService.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsMsgTagService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSpamSettings.cpp">mailnews/base/src/nsSpamSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSpamSettings.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSpamSettings.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSpamSettings.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSpamSettings.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSpamSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSubscribableServer.cpp">mailnews/base/src/nsSubscribableServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSubscribableServer.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSubscribableServer.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSubscribableServer.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSubscribableServer.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/src/nsSubscribableServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgI18N.cpp">mailnews/base/util/nsMsgI18N.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgI18N.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgI18N.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgI18N.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgI18N.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgI18N.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.h">mailnews/base/util/nsMsgUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.h">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.h">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.h">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.h">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/base/util/nsMsgUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompUtils.cpp">mailnews/compose/src/nsMsgCompUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompUtils.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompUtils.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompUtils.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompUtils.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsURLFetcher.cpp">mailnews/compose/src/nsURLFetcher.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsURLFetcher.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsURLFetcher.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsURLFetcher.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsURLFetcher.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/compose/src/nsURLFetcher.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapFlagAndUidState.cpp">mailnews/imap/src/nsImapFlagAndUidState.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapFlagAndUidState.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapFlagAndUidState.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapFlagAndUidState.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapFlagAndUidState.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapFlagAndUidState.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapService.cpp">mailnews/imap/src/nsImapService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapService.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapService.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapService.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapService.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUndoTxn.cpp">mailnews/imap/src/nsImapUndoTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUndoTxn.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUndoTxn.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUndoTxn.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUndoTxn.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUndoTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUrl.cpp">mailnews/imap/src/nsImapUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUrl.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUrl.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUrl.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUrl.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUtils.cpp">mailnews/imap/src/nsImapUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUtils.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUtils.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUtils.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUtils.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/imap/src/nsImapUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/MapiApi.cpp">mailnews/import/outlook/src/MapiApi.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/MapiApi.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/MapiApi.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/MapiApi.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/MapiApi.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/MapiApi.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/nsOutlookMail.cpp">mailnews/import/outlook/src/nsOutlookMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/nsOutlookMail.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/nsOutlookMail.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/nsOutlookMail.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/nsOutlookMail.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/outlook/src/nsOutlookMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/text/src/nsTextAddress.cpp">mailnews/import/text/src/nsTextAddress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/text/src/nsTextAddress.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/text/src/nsTextAddress.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/text/src/nsTextAddress.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/text/src/nsTextAddress.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/import/text/src/nsTextAddress.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUndoTxn.cpp">mailnews/local/src/nsLocalUndoTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUndoTxn.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUndoTxn.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUndoTxn.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUndoTxn.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUndoTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUtils.cpp">mailnews/local/src/nsLocalUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUtils.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUtils.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUtils.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUtils.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsLocalUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsPop3Protocol.cpp">mailnews/local/src/nsPop3Protocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsPop3Protocol.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsPop3Protocol.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsPop3Protocol.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsPop3Protocol.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/local/src/nsPop3Protocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/mimehdrs.cpp">mailnews/mime/src/mimehdrs.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/mimehdrs.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/mimehdrs.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/mimehdrs.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/mimehdrs.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/mimehdrs.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/nsStreamConverter.cpp">mailnews/mime/src/nsStreamConverter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/nsStreamConverter.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/nsStreamConverter.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/nsStreamConverter.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/nsStreamConverter.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/mime/src/nsStreamConverter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNNTPProtocol.cpp">mailnews/news/src/nsNNTPProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNNTPProtocol.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNNTPProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNNTPProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNNTPProtocol.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNNTPProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpService.cpp">mailnews/news/src/nsNntpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpService.cpp">file</a> |
<a href="/comm-central/annotate/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpService.cpp">annotate</a> |
<a href="/comm-central/diff/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpService.cpp">diff</a> |
<a href="/comm-central/comparison/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpService.cpp">comparison</a> |
<a href="/comm-central/log/2891d703d7591ad5492211961c7bfc1593ab8193/mailnews/news/src/nsNntpService.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -978,17 +978,17 @@ nsresult nsMsgSearchTerm::MatchString(co</span>
<a href="#l1.4"></a><span id="l1.4">     nsAutoString utf16StrToMatch;</span>
<a href="#l1.5"></a><span id="l1.5">     rv = NS_ERROR_UNEXPECTED;</span>
<a href="#l1.6"></a><span id="l1.6">     if (charset) {</span>
<a href="#l1.7"></a><span id="l1.7">       rv = nsMsgI18NConvertToUnicode(nsDependentCString(charset), stringToMatch,</span>
<a href="#l1.8"></a><span id="l1.8">                                      utf16StrToMatch);</span>
<a href="#l1.9"></a><span id="l1.9">     }</span>
<a href="#l1.10"></a><span id="l1.10">     if (NS_FAILED(rv)) {</span>
<a href="#l1.11"></a><span id="l1.11">       // No charset or conversion failed, maybe due to a bad charset, try UTF-8.</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      if (MsgIsUTF8(stringToMatch)) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      if (mozilla::IsUtf8(stringToMatch)) {</span>
<a href="#l1.14"></a><span id="l1.14">         CopyUTF8toUTF16(stringToMatch, utf16StrToMatch);</span>
<a href="#l1.15"></a><span id="l1.15">       } else {</span>
<a href="#l1.16"></a><span id="l1.16">         // Bad luck, let's assume ASCII/windows-1252 then.</span>
<a href="#l1.17"></a><span id="l1.17">         CopyASCIItoUTF16(stringToMatch, utf16StrToMatch);</span>
<a href="#l1.18"></a><span id="l1.18">       }</span>
<a href="#l1.19"></a><span id="l1.19">     }</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21">     rv = MatchString(utf16StrToMatch, &amp;result);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -111,17 +111,17 @@ static void ConvertAndSanitizeFileName(c</span>
<a href="#l2.4"></a><span id="l2.4">   /* we need to convert the UTF-8 fileName to platform specific character set.</span>
<a href="#l2.5"></a><span id="l2.5">      The display name is in UTF-8 because it has been escaped from JS</span>
<a href="#l2.6"></a><span id="l2.6">   */</span>
<a href="#l2.7"></a><span id="l2.7">   MsgUnescapeString(displayName, 0, unescapedName);</span>
<a href="#l2.8"></a><span id="l2.8">   CopyUTF8toUTF16(unescapedName, aResult);</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10">   // replace platform specific path separator and illegale characters to avoid</span>
<a href="#l2.11"></a><span id="l2.11">   // any confusion</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  MsgReplaceChar(aResult, FILE_PATH_SEPARATOR FILE_ILLEGAL_CHARACTERS, '-');</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  aResult.ReplaceChar(FILE_PATH_SEPARATOR FILE_ILLEGAL_CHARACTERS, '-');</span>
<a href="#l2.14"></a><span id="l2.14"> }</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16"> // ***************************************************</span>
<a href="#l2.17"></a><span id="l2.17"> // jefft - this is a rather obscured class serves for Save Message As File,</span>
<a href="#l2.18"></a><span id="l2.18"> // Save Message As Template, and Save Attachment to a file</span>
<a href="#l2.19"></a><span id="l2.19"> //</span>
<a href="#l2.20"></a><span id="l2.20"> class nsSaveAllAttachmentsState;</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -632,17 +632,17 @@ nsresult nsMessenger::SaveAttachment(nsI</span>
<a href="#l2.23"></a><span id="l2.23">   int32_t typeIndex = urlString.Find(&quot;?type=application/x-message-display&quot;);</span>
<a href="#l2.24"></a><span id="l2.24">   if (typeIndex != kNotFound) {</span>
<a href="#l2.25"></a><span id="l2.25">     urlString.Cut(typeIndex, sizeof(&quot;?type=application/x-message-display&quot;) - 1);</span>
<a href="#l2.26"></a><span id="l2.26">     // we also need to replace the next '&amp;' with '?'</span>
<a href="#l2.27"></a><span id="l2.27">     int32_t firstPartIndex = urlString.FindChar('&amp;');</span>
<a href="#l2.28"></a><span id="l2.28">     if (firstPartIndex != kNotFound) urlString.SetCharAt('?', firstPartIndex);</span>
<a href="#l2.29"></a><span id="l2.29">   }</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-  MsgReplaceSubstring(urlString, &quot;/;section&quot;, &quot;?section&quot;);</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  urlString.ReplaceSubstring(&quot;/;section&quot;, &quot;?section&quot;);</span>
<a href="#l2.33"></a><span id="l2.33">   nsCOMPtr&lt;nsIURI&gt; URL;</span>
<a href="#l2.34"></a><span id="l2.34">   nsresult rv = NS_NewURI(getter_AddRefs(URL), urlString);</span>
<a href="#l2.35"></a><span id="l2.35"> </span>
<a href="#l2.36"></a><span id="l2.36">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l2.37"></a><span id="l2.37">     rv = GetMessageServiceFromURI(aMessageUri, getter_AddRefs(messageService));</span>
<a href="#l2.38"></a><span id="l2.38">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l2.39"></a><span id="l2.39">       fetchService = do_QueryInterface(messageService);</span>
<a href="#l2.40"></a><span id="l2.40">       // if the message service has a fetch part service then we know we can</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -590,28 +590,27 @@ nsMessengerWinIntegration::Observe(nsISu</span>
<a href="#l3.4"></a><span id="l3.4"> }</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> static void EscapeAmpersands(nsString &amp;aToolTip) {</span>
<a href="#l3.7"></a><span id="l3.7">   // First, check to see whether we have any ampersands.</span>
<a href="#l3.8"></a><span id="l3.8">   int32_t pos = aToolTip.FindChar('&amp;');</span>
<a href="#l3.9"></a><span id="l3.9">   if (pos == kNotFound) return;</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   // Next, see if we only have bare ampersands.</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  pos = MsgFind(aToolTip, &quot;&amp;&amp;&quot;, false, pos);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  pos = aToolTip.Find(&quot;&amp;&amp;&quot;, false, pos);</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15">   // Windows tooltip code removes one ampersand from each run,</span>
<a href="#l3.16"></a><span id="l3.16">   // then collapses pairs of amperands. This means that in the easy case,</span>
<a href="#l3.17"></a><span id="l3.17">   // we need to replace each ampersand with three.</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-  MsgReplaceSubstring(aToolTip, NS_LITERAL_STRING(&quot;&amp;&quot;),</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-                      NS_LITERAL_STRING(&quot;&amp;&amp;&amp;&quot;));</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+  aToolTip.ReplaceSubstring(NS_LITERAL_STRING(&quot;&amp;&quot;), NS_LITERAL_STRING(&quot;&amp;&amp;&amp;&quot;));</span>
<a href="#l3.21"></a><span id="l3.21">   if (pos == kNotFound) return;</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23">   // We inserted too many ampersands. Remove some.</span>
<a href="#l3.24"></a><span id="l3.24">   for (;;) {</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-    pos = MsgFind(aToolTip, &quot;&amp;&amp;&amp;&amp;&amp;&amp;&quot;, false, pos);</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+    pos = aToolTip.Find(&quot;&amp;&amp;&amp;&amp;&amp;&amp;&quot;, false, pos);</span>
<a href="#l3.27"></a><span id="l3.27">     if (pos == kNotFound) return;</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29">     aToolTip.Cut(pos, 1);</span>
<a href="#l3.30"></a><span id="l3.30">     pos += 2;</span>
<a href="#l3.31"></a><span id="l3.31">   }</span>
<a href="#l3.32"></a><span id="l3.32"> }</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34"> void nsMessengerWinIntegration::FillToolTipInfo() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -434,19 +434,19 @@ bool nsMsgContentPolicy::IsExposedProtoc</span>
<a href="#l4.4"></a><span id="l4.4">   nsresult rv = aContentLocation-&gt;GetScheme(contentScheme);</span>
<a href="#l4.5"></a><span id="l4.5">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7">   // Check some exposed protocols. Not all protocols in the list of</span>
<a href="#l4.8"></a><span id="l4.8">   // network.protocol-handler.expose.* prefs in all-thunderbird.js are</span>
<a href="#l4.9"></a><span id="l4.9">   // admitted purely based on their scheme.</span>
<a href="#l4.10"></a><span id="l4.10">   // news, snews, nntp, imap and mailbox are checked before the call</span>
<a href="#l4.11"></a><span id="l4.11">   // to this function by matching content location and requesting location.</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  if (MsgLowerCaseEqualsLiteral(contentScheme, &quot;mailto&quot;) ||</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-      MsgLowerCaseEqualsLiteral(contentScheme, &quot;addbook&quot;) ||</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-      MsgLowerCaseEqualsLiteral(contentScheme, &quot;about&quot;))</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+  if (contentScheme.LowerCaseEqualsLiteral(&quot;mailto&quot;) ||</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+      contentScheme.LowerCaseEqualsLiteral(&quot;addbook&quot;) ||</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+      contentScheme.LowerCaseEqualsLiteral(&quot;about&quot;))</span>
<a href="#l4.18"></a><span id="l4.18">     return true;</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20">   // check if customized exposed scheme</span>
<a href="#l4.21"></a><span id="l4.21">   if (mCustomExposedProtocols.Contains(contentScheme)) return true;</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23">   bool isData;</span>
<a href="#l4.24"></a><span id="l4.24">   bool isChrome;</span>
<a href="#l4.25"></a><span id="l4.25">   bool isRes;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -2149,25 +2149,25 @@ nsMsgDBView::Open(nsIMsgFolder *folder, </span>
<a href="#l5.4"></a><span id="l5.4">     rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l5.5"></a><span id="l5.5">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.6"></a><span id="l5.6">     nsCString type;</span>
<a href="#l5.7"></a><span id="l5.7">     rv = server-&gt;GetType(type);</span>
<a href="#l5.8"></a><span id="l5.8">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10">     // I'm not sure this is correct, because XF virtual folders with mixed news</span>
<a href="#l5.11"></a><span id="l5.11">     // and mail can have this set.</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    mIsNews = MsgLowerCaseEqualsLiteral(type, &quot;nntp&quot;);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    mIsNews = type.LowerCaseEqualsLiteral(&quot;nntp&quot;);</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15">     // Default to a virtual folder if folder not set, since synthetic search</span>
<a href="#l5.16"></a><span id="l5.16">     // views may not have a folder.</span>
<a href="#l5.17"></a><span id="l5.17">     uint32_t folderFlags = nsMsgFolderFlags::Virtual;</span>
<a href="#l5.18"></a><span id="l5.18">     if (folder) folder-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20">     mIsXFVirtual = folderFlags &amp; nsMsgFolderFlags::Virtual;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-    if (!mIsXFVirtual &amp;&amp; MsgLowerCaseEqualsLiteral(type, &quot;rss&quot;)) mIsRss = true;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+    if (!mIsXFVirtual &amp;&amp; type.LowerCaseEqualsLiteral(&quot;rss&quot;)) mIsRss = true;</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">     // Special case nntp --&gt; news since we'll break themes if we try to be</span>
<a href="#l5.25"></a><span id="l5.25">     // consistent.</span>
<a href="#l5.26"></a><span id="l5.26">     if (mIsNews)</span>
<a href="#l5.27"></a><span id="l5.27">       mMessageType.AssignLiteral(&quot;news&quot;);</span>
<a href="#l5.28"></a><span id="l5.28">     else</span>
<a href="#l5.29"></a><span id="l5.29">       CopyUTF8toUTF16(type, mMessageType);</span>
<a href="#l5.30"></a><span id="l5.30"> </span>
<a href="#l5.31"></a><span id="l5.31" class="difflineat">@@ -7519,18 +7519,18 @@ bool nsMsgDBView::JunkControlsEnabled(ns</span>
<a href="#l5.32"></a><span id="l5.32">   if (folder) {</span>
<a href="#l5.33"></a><span id="l5.33">     // Check if this is a mail message in search folders.</span>
<a href="#l5.34"></a><span id="l5.34">     if (mIsXFVirtual) {</span>
<a href="#l5.35"></a><span id="l5.35">       nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l5.36"></a><span id="l5.36">       folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l5.37"></a><span id="l5.37">       nsAutoCString type;</span>
<a href="#l5.38"></a><span id="l5.38">       if (server) server-&gt;GetType(type);</span>
<a href="#l5.39"></a><span id="l5.39"> </span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-      if (!(MsgLowerCaseEqualsLiteral(type, &quot;nntp&quot;) ||</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-            MsgLowerCaseEqualsLiteral(type, &quot;rss&quot;)))</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+      if (!(type.LowerCaseEqualsLiteral(&quot;nntp&quot;) ||</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+            type.LowerCaseEqualsLiteral(&quot;rss&quot;)))</span>
<a href="#l5.44"></a><span id="l5.44">         return true;</span>
<a href="#l5.45"></a><span id="l5.45">     }</span>
<a href="#l5.46"></a><span id="l5.46"> </span>
<a href="#l5.47"></a><span id="l5.47">     // For rss and news, check the inherited folder property.</span>
<a href="#l5.48"></a><span id="l5.48">     nsAutoCString junkEnableOverride;</span>
<a href="#l5.49"></a><span id="l5.49">     folder-&gt;GetInheritedStringProperty(&quot;dobayes.mailnews@mozilla.org#junk&quot;,</span>
<a href="#l5.50"></a><span id="l5.50">                                        junkEnableOverride);</span>
<a href="#l5.51"></a><span id="l5.51">     if (junkEnableOverride.EqualsLiteral(&quot;true&quot;)) return true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -205,17 +205,17 @@ NS_IMETHODIMP nsMsgTagService::AddTag(co</span>
<a href="#l6.4"></a><span id="l6.4">                                       const nsACString &amp;color,</span>
<a href="#l6.5"></a><span id="l6.5">                                       const nsACString &amp;ordinal) {</span>
<a href="#l6.6"></a><span id="l6.6">   // figure out key from tag. Apply transformation stripping out</span>
<a href="#l6.7"></a><span id="l6.7">   // illegal characters like &lt;SP&gt; and then convert to imap mod utf7.</span>
<a href="#l6.8"></a><span id="l6.8">   // Then, check if we have a tag with that key yet, and if so,</span>
<a href="#l6.9"></a><span id="l6.9">   // make it unique by appending A, AA, etc.</span>
<a href="#l6.10"></a><span id="l6.10">   // Should we use an iterator?</span>
<a href="#l6.11"></a><span id="l6.11">   nsAutoString transformedTag(tag);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  MsgReplaceChar(transformedTag, &quot; ()/{%*&lt;&gt;\\\&quot;&quot;, '_');</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  transformedTag.ReplaceChar(&quot; ()/{%*&lt;&gt;\\\&quot;&quot;, '_');</span>
<a href="#l6.14"></a><span id="l6.14">   nsAutoCString key;</span>
<a href="#l6.15"></a><span id="l6.15">   CopyUTF16toMUTF7(transformedTag, key);</span>
<a href="#l6.16"></a><span id="l6.16">   // We have an imap server that converts keys to upper case so we're going</span>
<a href="#l6.17"></a><span id="l6.17">   // to normalize all keys to lower case (upper case looks ugly in prefs.js)</span>
<a href="#l6.18"></a><span id="l6.18">   ToLowerCase(key);</span>
<a href="#l6.19"></a><span id="l6.19">   nsAutoCString prefName(key);</span>
<a href="#l6.20"></a><span id="l6.20">   while (true) {</span>
<a href="#l6.21"></a><span id="l6.21">     nsAutoString tagValue;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -680,18 +680,18 @@ NS_IMETHODIMP nsSpamSettings::LogJunkStr</span>
<a href="#l7.4"></a><span id="l7.4">   PRExplodedTime exploded;</span>
<a href="#l7.5"></a><span id="l7.5">   PR_ExplodeTime(PR_Now(), PR_LocalTimeParameters, &amp;exploded);</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">   mozilla::DateTimeFormat::FormatPRExplodedTime(mozilla::kDateFormatShort,</span>
<a href="#l7.8"></a><span id="l7.8">                                                 mozilla::kTimeFormatSeconds,</span>
<a href="#l7.9"></a><span id="l7.9">                                                 &amp;exploded, dateValue);</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">   nsCString timestampString(LOG_ENTRY_TIMESTAMP);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  MsgReplaceSubstring(timestampString, &quot;$S&quot;,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-                      NS_ConvertUTF16toUTF8(dateValue).get());</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+  timestampString.ReplaceSubstring(&quot;$S&quot;,</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+                                   NS_ConvertUTF16toUTF8(dateValue).get());</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17">   nsCOMPtr&lt;nsIOutputStream&gt; logStream;</span>
<a href="#l7.18"></a><span id="l7.18">   rv = GetLogStream(getter_AddRefs(logStream));</span>
<a href="#l7.19"></a><span id="l7.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">   uint32_t writeCount;</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23">   rv = logStream-&gt;Write(LOG_ENTRY_START_TAG, LOG_ENTRY_START_TAG_LEN,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsSubscribableServer.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsSubscribableServer.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -10,16 +10,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l8.5"></a><span id="l8.5"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l8.6"></a><span id="l8.6"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l8.7"></a><span id="l8.7"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l8.8"></a><span id="l8.8"> #include &quot;nsStringEnumerator.h&quot;</span>
<a href="#l8.9"></a><span id="l8.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l8.10"></a><span id="l8.10"> #include &quot;nsTreeColumns.h&quot;</span>
<a href="#l8.11"></a><span id="l8.11"> #include &quot;mozilla/dom/DataTransfer.h&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+#include &quot;mozilla/Utf8.h&quot;</span>
<a href="#l8.13"></a><span id="l8.13"> </span>
<a href="#l8.14"></a><span id="l8.14"> nsSubscribableServer::nsSubscribableServer(void) {</span>
<a href="#l8.15"></a><span id="l8.15">   mDelimiter = '.';</span>
<a href="#l8.16"></a><span id="l8.16">   mShowFullName = true;</span>
<a href="#l8.17"></a><span id="l8.17">   mTreeRoot = nullptr;</span>
<a href="#l8.18"></a><span id="l8.18">   mStopped = false;</span>
<a href="#l8.19"></a><span id="l8.19"> }</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21" class="difflineat">@@ -109,17 +110,17 @@ nsSubscribableServer::AddTo(const nsACSt</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23"> NS_IMETHODIMP</span>
<a href="#l8.24"></a><span id="l8.24"> nsSubscribableServer::SetState(const nsACString &amp;aPath, bool aState,</span>
<a href="#l8.25"></a><span id="l8.25">                                bool *aStateChanged) {</span>
<a href="#l8.26"></a><span id="l8.26">   nsresult rv = NS_OK;</span>
<a href="#l8.27"></a><span id="l8.27">   NS_ASSERTION(!aPath.IsEmpty() &amp;&amp; aStateChanged, &quot;no path or stateChanged&quot;);</span>
<a href="#l8.28"></a><span id="l8.28">   if (aPath.IsEmpty() || !aStateChanged) return NS_ERROR_NULL_POINTER;</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-  NS_ASSERTION(MsgIsUTF8(aPath), &quot;aPath is not in UTF-8&quot;);</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+  NS_ASSERTION(mozilla::IsUtf8(aPath), &quot;aPath is not in UTF-8&quot;);</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33">   *aStateChanged = false;</span>
<a href="#l8.34"></a><span id="l8.34"> </span>
<a href="#l8.35"></a><span id="l8.35">   SubscribeTreeNode *node = nullptr;</span>
<a href="#l8.36"></a><span id="l8.36">   rv = FindAndCreateNode(aPath, &amp;node);</span>
<a href="#l8.37"></a><span id="l8.37">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.38"></a><span id="l8.38"> </span>
<a href="#l8.39"></a><span id="l8.39">   NS_ASSERTION(node, &quot;didn't find the node&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -66,16 +66,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> #include &quot;nsIMsgFilter.h&quot;</span>
<a href="#l9.5"></a><span id="l9.5"> #include &quot;nsIScriptError.h&quot;</span>
<a href="#l9.6"></a><span id="l9.6"> #include &quot;nsIURIMutator.h&quot;</span>
<a href="#l9.7"></a><span id="l9.7"> #include &quot;nsIXULAppInfo.h&quot;</span>
<a href="#l9.8"></a><span id="l9.8"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l9.9"></a><span id="l9.9"> #include &quot;mozilla/intl/LocaleService.h&quot;</span>
<a href="#l9.10"></a><span id="l9.10"> #include &quot;mozilla/Logging.h&quot;</span>
<a href="#l9.11"></a><span id="l9.11"> #include &quot;mozilla/UniquePtr.h&quot;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+#include &quot;mozilla/Utf8.h&quot;</span>
<a href="#l9.13"></a><span id="l9.13"> </span>
<a href="#l9.14"></a><span id="l9.14"> using namespace mozilla;</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16"> extern LazyLogModule FILTERLOGMODULE;</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18"> static PRTime gtimeOfLastPurgeCheck;  // variable to know when to check for</span>
<a href="#l9.19"></a><span id="l9.19">                                       // purge threshold</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21" class="difflineat">@@ -2886,17 +2887,17 @@ nsresult nsMsgDBFolder::parseURI(bool ne</span>
<a href="#l9.22"></a><span id="l9.22">     // the name is the trailing directory in the path</span>
<a href="#l9.23"></a><span id="l9.23">     nsAutoCString fileName;</span>
<a href="#l9.24"></a><span id="l9.24">     nsAutoCString escapedFileName;</span>
<a href="#l9.25"></a><span id="l9.25">     url-&gt;GetFileName(escapedFileName);</span>
<a href="#l9.26"></a><span id="l9.26">     if (!escapedFileName.IsEmpty()) {</span>
<a href="#l9.27"></a><span id="l9.27">       // XXX conversion to unicode here? is fileName in UTF8?</span>
<a href="#l9.28"></a><span id="l9.28">       // yes, let's say it is in utf8</span>
<a href="#l9.29"></a><span id="l9.29">       MsgUnescapeString(escapedFileName, 0, fileName);</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-      NS_ASSERTION(MsgIsUTF8(fileName), &quot;fileName is not in UTF-8&quot;);</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+      NS_ASSERTION(mozilla::IsUtf8(fileName), &quot;fileName is not in UTF-8&quot;);</span>
<a href="#l9.32"></a><span id="l9.32">       CopyUTF8toUTF16(fileName, mName);</span>
<a href="#l9.33"></a><span id="l9.33">     }</span>
<a href="#l9.34"></a><span id="l9.34">   }</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36">   // grab the server by parsing the URI and looking it up</span>
<a href="#l9.37"></a><span id="l9.37">   // in the account manager...</span>
<a href="#l9.38"></a><span id="l9.38">   // But avoid this extra work by first asking the parent, if any</span>
<a href="#l9.39"></a><span id="l9.39">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryReferent(mServer, &amp;rv);</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineat">@@ -2960,17 +2961,17 @@ nsresult nsMsgDBFolder::parseURI(bool ne</span>
<a href="#l9.41"></a><span id="l9.41">     rv = server-&gt;GetLocalPath(getter_AddRefs(serverPath));</span>
<a href="#l9.42"></a><span id="l9.42">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l9.43"></a><span id="l9.43"> </span>
<a href="#l9.44"></a><span id="l9.44">     if (!mPath &amp;&amp; serverPath) {</span>
<a href="#l9.45"></a><span id="l9.45">       if (!newPath.IsEmpty()) {</span>
<a href="#l9.46"></a><span id="l9.46">         // I hope this is temporary - Ultimately,</span>
<a href="#l9.47"></a><span id="l9.47">         // NS_MsgCreatePathStringFromFolderURI will need to be fixed.</span>
<a href="#l9.48"></a><span id="l9.48"> #if defined(XP_WIN)</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-        MsgReplaceChar(newPath, '/', '\\');</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+        newPath.ReplaceChar('/', '\\');</span>
<a href="#l9.51"></a><span id="l9.51"> #endif</span>
<a href="#l9.52"></a><span id="l9.52">         rv = serverPath-&gt;AppendRelativeNativePath(newPath);</span>
<a href="#l9.53"></a><span id="l9.53">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;failed to append to the serverPath&quot;);</span>
<a href="#l9.54"></a><span id="l9.54">         if (NS_FAILED(rv)) {</span>
<a href="#l9.55"></a><span id="l9.55">           mPath = nullptr;</span>
<a href="#l9.56"></a><span id="l9.56">           return rv;</span>
<a href="#l9.57"></a><span id="l9.57">         }</span>
<a href="#l9.58"></a><span id="l9.58">       }</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineat">@@ -3435,29 +3436,29 @@ NS_IMETHODIMP nsMsgDBFolder::AddSubfolde</span>
<a href="#l9.60"></a><span id="l9.60">   // have the right uri.</span>
<a href="#l9.61"></a><span id="l9.61">   // on disk, host\INBOX should be a folder with the uri</span>
<a href="#l9.62"></a><span id="l9.62">   // mailbox://user@host/Inbox&quot; as mailbox://user@host/Inbox !=</span>
<a href="#l9.63"></a><span id="l9.63">   // mailbox://user@host/INBOX</span>
<a href="#l9.64"></a><span id="l9.64">   nsCOMPtr&lt;nsIMsgFolder&gt; rootFolder;</span>
<a href="#l9.65"></a><span id="l9.65">   rv = GetRootFolder(getter_AddRefs(rootFolder));</span>
<a href="#l9.66"></a><span id="l9.66">   if (NS_SUCCEEDED(rv) &amp;&amp; rootFolder &amp;&amp;</span>
<a href="#l9.67"></a><span id="l9.67">       (rootFolder.get() == (nsIMsgFolder *)this)) {</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-    if (MsgLowerCaseEqualsLiteral(escapedName, &quot;inbox&quot;))</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+    if (escapedName.LowerCaseEqualsLiteral(&quot;inbox&quot;))</span>
<a href="#l9.70"></a><span id="l9.70">       uri += &quot;Inbox&quot;;</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineminus">-    else if (MsgLowerCaseEqualsLiteral(escapedName, &quot;unsent%20messages&quot;))</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+    else if (escapedName.LowerCaseEqualsLiteral(&quot;unsent%20messages&quot;))</span>
<a href="#l9.73"></a><span id="l9.73">       uri += &quot;Unsent%20Messages&quot;;</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-    else if (MsgLowerCaseEqualsLiteral(escapedName, &quot;drafts&quot;))</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+    else if (escapedName.LowerCaseEqualsLiteral(&quot;drafts&quot;))</span>
<a href="#l9.76"></a><span id="l9.76">       uri += &quot;Drafts&quot;;</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineminus">-    else if (MsgLowerCaseEqualsLiteral(escapedName, &quot;trash&quot;))</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+    else if (escapedName.LowerCaseEqualsLiteral(&quot;trash&quot;))</span>
<a href="#l9.79"></a><span id="l9.79">       uri += &quot;Trash&quot;;</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">-    else if (MsgLowerCaseEqualsLiteral(escapedName, &quot;sent&quot;))</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+    else if (escapedName.LowerCaseEqualsLiteral(&quot;sent&quot;))</span>
<a href="#l9.82"></a><span id="l9.82">       uri += &quot;Sent&quot;;</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-    else if (MsgLowerCaseEqualsLiteral(escapedName, &quot;templates&quot;))</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+    else if (escapedName.LowerCaseEqualsLiteral(&quot;templates&quot;))</span>
<a href="#l9.85"></a><span id="l9.85">       uri += &quot;Templates&quot;;</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineminus">-    else if (MsgLowerCaseEqualsLiteral(escapedName, &quot;archives&quot;))</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+    else if (escapedName.LowerCaseEqualsLiteral(&quot;archives&quot;))</span>
<a href="#l9.88"></a><span id="l9.88">       uri += &quot;Archives&quot;;</span>
<a href="#l9.89"></a><span id="l9.89">     else</span>
<a href="#l9.90"></a><span id="l9.90">       uri += escapedName.get();</span>
<a href="#l9.91"></a><span id="l9.91">   } else</span>
<a href="#l9.92"></a><span id="l9.92">     uri += escapedName.get();</span>
<a href="#l9.93"></a><span id="l9.93"> </span>
<a href="#l9.94"></a><span id="l9.94">   nsCOMPtr&lt;nsIMsgFolder&gt; msgFolder;</span>
<a href="#l9.95"></a><span id="l9.95">   rv = GetChildWithURI(uri, false /*deep*/, true /*case Insensitive*/,</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineat">@@ -5158,23 +5159,22 @@ NS_IMETHODIMP nsMsgDBFolder::GetMsgTextF</span>
<a href="#l9.97"></a><span id="l9.97">  * @param aEncodingType  the encoding type (base64, quoted-printable)</span>
<a href="#l9.98"></a><span id="l9.98">  * @param aIsComplete    the snippet is actually the entire message so the</span>
<a href="#l9.99"></a><span id="l9.99">  *                       decoder doesn't have to worry about partial data</span>
<a href="#l9.100"></a><span id="l9.100">  * @param aMsgSnippet in/out argument. The encoded msg snippet and then the</span>
<a href="#l9.101"></a><span id="l9.101">  *                                     decoded snippet</span>
<a href="#l9.102"></a><span id="l9.102">  */</span>
<a href="#l9.103"></a><span id="l9.103"> void nsMsgDBFolder::decodeMsgSnippet(const nsACString &amp;aEncodingType,</span>
<a href="#l9.104"></a><span id="l9.104">                                      bool aIsComplete, nsCString &amp;aMsgSnippet) {</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineminus">-  if (MsgLowerCaseEqualsLiteral(aEncodingType, ENCODING_BASE64)) {</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+  if (aEncodingType.LowerCaseEqualsLiteral(ENCODING_BASE64)) {</span>
<a href="#l9.107"></a><span id="l9.107">     int32_t base64Len = aMsgSnippet.Length();</span>
<a href="#l9.108"></a><span id="l9.108">     if (aIsComplete) base64Len -= base64Len % 4;</span>
<a href="#l9.109"></a><span id="l9.109">     char *decodedBody = PL_Base64Decode(aMsgSnippet.get(), base64Len, nullptr);</span>
<a href="#l9.110"></a><span id="l9.110">     if (decodedBody) aMsgSnippet.Adopt(decodedBody);</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineminus">-  } else if (MsgLowerCaseEqualsLiteral(aEncodingType,</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineminus">-                                       ENCODING_QUOTED_PRINTABLE)) {</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineplus">+  } else if (aEncodingType.LowerCaseEqualsLiteral(ENCODING_QUOTED_PRINTABLE)) {</span>
<a href="#l9.114"></a><span id="l9.114">     MsgStripQuotedPrintable(aMsgSnippet);</span>
<a href="#l9.115"></a><span id="l9.115">   }</span>
<a href="#l9.116"></a><span id="l9.116"> }</span>
<a href="#l9.117"></a><span id="l9.117"> </span>
<a href="#l9.118"></a><span id="l9.118"> /**</span>
<a href="#l9.119"></a><span id="l9.119">  * stripQuotesFromMsgSnippet - Reduces quoted reply text including the citation</span>
<a href="#l9.120"></a><span id="l9.120">  * (Scott wrote:) from the message snippet to &quot; ... &quot;. Assumes the snippet has</span>
<a href="#l9.121"></a><span id="l9.121">  * been decoded and converted to plain text.</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineat">@@ -5236,17 +5236,17 @@ nsresult nsMsgDBFolder::GetMsgPreviewTex</span>
<a href="#l9.123"></a><span id="l9.123">   nsCString msgBody;</span>
<a href="#l9.124"></a><span id="l9.124">   nsAutoCString charset;</span>
<a href="#l9.125"></a><span id="l9.125">   msgHdr-&gt;GetCharset(getter_Copies(charset));</span>
<a href="#l9.126"></a><span id="l9.126">   nsAutoCString contentType;</span>
<a href="#l9.127"></a><span id="l9.127">   nsresult rv = GetMsgTextFromStream(stream, charset, 4096, 255, true, true,</span>
<a href="#l9.128"></a><span id="l9.128">                                      contentType, msgBody);</span>
<a href="#l9.129"></a><span id="l9.129">   // replaces all tabs and line returns with a space,</span>
<a href="#l9.130"></a><span id="l9.130">   // then trims off leading and trailing white space</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineminus">-  MsgCompressWhitespace(msgBody);</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineplus">+  msgBody.CompressWhitespace();</span>
<a href="#l9.133"></a><span id="l9.133">   msgHdr-&gt;SetStringProperty(&quot;preview&quot;, msgBody.get());</span>
<a href="#l9.134"></a><span id="l9.134">   return rv;</span>
<a href="#l9.135"></a><span id="l9.135"> }</span>
<a href="#l9.136"></a><span id="l9.136"> </span>
<a href="#l9.137"></a><span id="l9.137"> void nsMsgDBFolder::UpdateTimestamps(bool allowUndo) {</span>
<a href="#l9.138"></a><span id="l9.138">   if (!(mFlags &amp; (nsMsgFolderFlags::Trash | nsMsgFolderFlags::Junk))) {</span>
<a href="#l9.139"></a><span id="l9.139">     SetMRUTime();</span>
<a href="#l9.140"></a><span id="l9.140">     if (allowUndo)  // This is a proxy for a user-initiated act.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.5"></a><span id="l10.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.6"></a><span id="l10.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.7"></a><span id="l10.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9" class="difflineminus">-// as does this</span>
<a href="#l10.10"></a><span id="l10.10"> #include &quot;nsICharsetConverterManager.h&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;mozilla/dom/FallbackEncoding.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+#include &quot;mozilla/Utf8.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15"> #include &quot;nsISupports.h&quot;</span>
<a href="#l10.16"></a><span id="l10.16"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l10.17"></a><span id="l10.17"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l10.18"></a><span id="l10.18"> #include &quot;nsIMimeConverter.h&quot;</span>
<a href="#l10.19"></a><span id="l10.19"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l10.20"></a><span id="l10.20"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -322,17 +322,17 @@ nsresult nsMsgI18NShrinkUTF8Str(const ns</span>
<a href="#l10.22"></a><span id="l10.22">   if (inString.IsEmpty()) {</span>
<a href="#l10.23"></a><span id="l10.23">     outString.Truncate();</span>
<a href="#l10.24"></a><span id="l10.24">     return NS_OK;</span>
<a href="#l10.25"></a><span id="l10.25">   }</span>
<a href="#l10.26"></a><span id="l10.26">   if (inString.Length() &lt; aMaxLength) {</span>
<a href="#l10.27"></a><span id="l10.27">     outString.Assign(inString);</span>
<a href="#l10.28"></a><span id="l10.28">     return NS_OK;</span>
<a href="#l10.29"></a><span id="l10.29">   }</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-  NS_ASSERTION(MsgIsUTF8(inString), &quot;Invalid UTF-8 string is inputted&quot;);</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+  NS_ASSERTION(mozilla::IsUtf8(inString), &quot;Invalid UTF-8 string is inputted&quot;);</span>
<a href="#l10.32"></a><span id="l10.32">   const char* start = inString.get();</span>
<a href="#l10.33"></a><span id="l10.33">   const char* end = start + inString.Length();</span>
<a href="#l10.34"></a><span id="l10.34">   const char* last = start + aMaxLength;</span>
<a href="#l10.35"></a><span id="l10.35">   const char* cur = start;</span>
<a href="#l10.36"></a><span id="l10.36">   const char* prev = nullptr;</span>
<a href="#l10.37"></a><span id="l10.37">   bool err = false;</span>
<a href="#l10.38"></a><span id="l10.38">   while (cur &lt; last) {</span>
<a href="#l10.39"></a><span id="l10.39">     prev = cur;</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineat">@@ -345,17 +345,17 @@ nsresult nsMsgI18NShrinkUTF8Str(const ns</span>
<a href="#l10.41"></a><span id="l10.41">   uint32_t len = prev - start;</span>
<a href="#l10.42"></a><span id="l10.42">   outString.Assign(Substring(inString, 0, len));</span>
<a href="#l10.43"></a><span id="l10.43">   return NS_OK;</span>
<a href="#l10.44"></a><span id="l10.44"> }</span>
<a href="#l10.45"></a><span id="l10.45"> </span>
<a href="#l10.46"></a><span id="l10.46"> void nsMsgI18NConvertRawBytesToUTF16(const nsCString&amp; inString,</span>
<a href="#l10.47"></a><span id="l10.47">                                      const nsACString&amp; charset,</span>
<a href="#l10.48"></a><span id="l10.48">                                      nsAString&amp; outString) {</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-  if (MsgIsUTF8(inString)) {</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+  if (mozilla::IsUtf8(inString)) {</span>
<a href="#l10.51"></a><span id="l10.51">     CopyUTF8toUTF16(inString, outString);</span>
<a href="#l10.52"></a><span id="l10.52">     return;</span>
<a href="#l10.53"></a><span id="l10.53">   }</span>
<a href="#l10.54"></a><span id="l10.54"> </span>
<a href="#l10.55"></a><span id="l10.55">   nsresult rv = nsMsgI18NConvertToUnicode(charset, inString, outString);</span>
<a href="#l10.56"></a><span id="l10.56">   if (NS_SUCCEEDED(rv)) return;</span>
<a href="#l10.57"></a><span id="l10.57"> </span>
<a href="#l10.58"></a><span id="l10.58">   const char* cur = inString.BeginReading();</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineat">@@ -368,17 +368,17 @@ void nsMsgI18NConvertRawBytesToUTF16(con</span>
<a href="#l10.60"></a><span id="l10.60">     else</span>
<a href="#l10.61"></a><span id="l10.61">       outString.Append(c);</span>
<a href="#l10.62"></a><span id="l10.62">   }</span>
<a href="#l10.63"></a><span id="l10.63"> }</span>
<a href="#l10.64"></a><span id="l10.64"> </span>
<a href="#l10.65"></a><span id="l10.65"> void nsMsgI18NConvertRawBytesToUTF8(const nsCString&amp; inString,</span>
<a href="#l10.66"></a><span id="l10.66">                                     const nsACString&amp; charset,</span>
<a href="#l10.67"></a><span id="l10.67">                                     nsACString&amp; outString) {</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineminus">-  if (MsgIsUTF8(inString)) {</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+  if (mozilla::IsUtf8(inString)) {</span>
<a href="#l10.70"></a><span id="l10.70">     outString.Assign(inString);</span>
<a href="#l10.71"></a><span id="l10.71">     return;</span>
<a href="#l10.72"></a><span id="l10.72">   }</span>
<a href="#l10.73"></a><span id="l10.73"> </span>
<a href="#l10.74"></a><span id="l10.74">   nsAutoString utf16Text;</span>
<a href="#l10.75"></a><span id="l10.75">   nsresult rv = nsMsgI18NConvertToUnicode(charset, inString, utf16Text);</span>
<a href="#l10.76"></a><span id="l10.76">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l10.77"></a><span id="l10.77">     CopyUTF16toUTF8(utf16Text, outString);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1072,17 +1072,17 @@ nsMsgIncomingServer::GetEditableFilterLi</span>
<a href="#l11.4"></a><span id="l11.4"> }</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6"> // If the hostname contains ':' (like hostname:1431)</span>
<a href="#l11.7"></a><span id="l11.7"> // then parse and set the port number.</span>
<a href="#l11.8"></a><span id="l11.8"> nsresult nsMsgIncomingServer::InternalSetHostName(const nsACString &amp;aHostname,</span>
<a href="#l11.9"></a><span id="l11.9">                                                   const char *prefName) {</span>
<a href="#l11.10"></a><span id="l11.10">   nsCString hostname;</span>
<a href="#l11.11"></a><span id="l11.11">   hostname = aHostname;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  if (MsgCountChar(hostname, ':') == 1) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  if (hostname.CountChar(':') == 1) {</span>
<a href="#l11.14"></a><span id="l11.14">     int32_t colonPos = hostname.FindChar(':');</span>
<a href="#l11.15"></a><span id="l11.15">     nsAutoCString portString(Substring(hostname, colonPos));</span>
<a href="#l11.16"></a><span id="l11.16">     hostname.SetLength(colonPos);</span>
<a href="#l11.17"></a><span id="l11.17">     nsresult err;</span>
<a href="#l11.18"></a><span id="l11.18">     int32_t port = portString.ToInteger(&amp;err);</span>
<a href="#l11.19"></a><span id="l11.19">     if (NS_SUCCEEDED(err)) SetPort(port);</span>
<a href="#l11.20"></a><span id="l11.20">   }</span>
<a href="#l11.21"></a><span id="l11.21">   return SetCharValue(prefName, hostname);</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -1183,17 +1183,17 @@ nsMsgIncomingServer::SetRealHostName(con</span>
<a href="#l11.23"></a><span id="l11.23">     rv = OnUserOrHostNameChanged(oldName, aHostname, true);</span>
<a href="#l11.24"></a><span id="l11.24">   return rv;</span>
<a href="#l11.25"></a><span id="l11.25"> }</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27"> NS_IMETHODIMP</span>
<a href="#l11.28"></a><span id="l11.28"> nsMsgIncomingServer::GetHostName(nsACString &amp;aResult) {</span>
<a href="#l11.29"></a><span id="l11.29">   nsresult rv;</span>
<a href="#l11.30"></a><span id="l11.30">   rv = GetCharValue(&quot;hostname&quot;, aResult);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-  if (MsgCountChar(aResult, ':') == 1) {</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+  if (aResult.CountChar(':') == 1) {</span>
<a href="#l11.33"></a><span id="l11.33">     // gack, we need to reformat the hostname - SetHostName will do that</span>
<a href="#l11.34"></a><span id="l11.34">     SetHostName(aResult);</span>
<a href="#l11.35"></a><span id="l11.35">     rv = GetCharValue(&quot;hostname&quot;, aResult);</span>
<a href="#l11.36"></a><span id="l11.36">   }</span>
<a href="#l11.37"></a><span id="l11.37">   return rv;</span>
<a href="#l11.38"></a><span id="l11.38"> }</span>
<a href="#l11.39"></a><span id="l11.39"> </span>
<a href="#l11.40"></a><span id="l11.40"> NS_IMETHODIMP</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineat">@@ -1201,17 +1201,17 @@ nsMsgIncomingServer::GetRealHostName(nsA</span>
<a href="#l11.42"></a><span id="l11.42">   // If 'realhostname' is set (was changed) then use it, otherwise use</span>
<a href="#l11.43"></a><span id="l11.43">   // 'hostname'</span>
<a href="#l11.44"></a><span id="l11.44">   nsresult rv;</span>
<a href="#l11.45"></a><span id="l11.45">   rv = GetCharValue(&quot;realhostname&quot;, aResult);</span>
<a href="#l11.46"></a><span id="l11.46">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.47"></a><span id="l11.47"> </span>
<a href="#l11.48"></a><span id="l11.48">   if (aResult.IsEmpty()) return GetHostName(aResult);</span>
<a href="#l11.49"></a><span id="l11.49"> </span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-  if (MsgCountChar(aResult, ':') == 1) {</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+  if (aResult.CountChar(':') == 1) {</span>
<a href="#l11.52"></a><span id="l11.52">     SetRealHostName(aResult);</span>
<a href="#l11.53"></a><span id="l11.53">     rv = GetCharValue(&quot;realhostname&quot;, aResult);</span>
<a href="#l11.54"></a><span id="l11.54">   }</span>
<a href="#l11.55"></a><span id="l11.55"> </span>
<a href="#l11.56"></a><span id="l11.56">   return rv;</span>
<a href="#l11.57"></a><span id="l11.57"> }</span>
<a href="#l11.58"></a><span id="l11.58"> </span>
<a href="#l11.59"></a><span id="l11.59"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -77,16 +77,17 @@</span>
<a href="#l12.4"></a><span id="l12.4"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l12.5"></a><span id="l12.5"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l12.6"></a><span id="l12.6"> #include &quot;nsIURIMutator.h&quot;</span>
<a href="#l12.7"></a><span id="l12.7"> #include &quot;mozilla/Unused.h&quot;</span>
<a href="#l12.8"></a><span id="l12.8"> #include &quot;mozilla/Preferences.h&quot;</span>
<a href="#l12.9"></a><span id="l12.9"> #include &quot;mozilla/Encoding.h&quot;</span>
<a href="#l12.10"></a><span id="l12.10"> #include &quot;mozilla/EncodingDetector.h&quot;</span>
<a href="#l12.11"></a><span id="l12.11"> #include &quot;mozilla/UniquePtr.h&quot;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+#include &quot;mozilla/Utf8.h&quot;</span>
<a href="#l12.13"></a><span id="l12.13"> </span>
<a href="#l12.14"></a><span id="l12.14"> /* for logging to Error Console */</span>
<a href="#l12.15"></a><span id="l12.15"> #include &quot;nsIScriptError.h&quot;</span>
<a href="#l12.16"></a><span id="l12.16"> #include &quot;nsIConsoleService.h&quot;</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18"> // Log an error string to the error console</span>
<a href="#l12.19"></a><span id="l12.19"> // (adapted from nsContentUtils::LogSimpleConsoleError).</span>
<a href="#l12.20"></a><span id="l12.20"> // Flag can indicate error, warning or info.</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineat">@@ -471,17 +472,17 @@ nsresult FormatFileSize(int64_t size, bo</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23"> nsresult NS_MsgCreatePathStringFromFolderURI(const char *aFolderURI,</span>
<a href="#l12.24"></a><span id="l12.24">                                              nsCString &amp;aPathCString,</span>
<a href="#l12.25"></a><span id="l12.25">                                              const nsCString &amp;aScheme,</span>
<a href="#l12.26"></a><span id="l12.26">                                              bool aIsNewsFolder) {</span>
<a href="#l12.27"></a><span id="l12.27">   // A file name has to be in native charset. Here we convert</span>
<a href="#l12.28"></a><span id="l12.28">   // to UTF-16 and check for 'unsafe' characters before converting</span>
<a href="#l12.29"></a><span id="l12.29">   // to native charset.</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-  NS_ENSURE_TRUE(MsgIsUTF8(nsDependentCString(aFolderURI)),</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+  NS_ENSURE_TRUE(mozilla::IsUtf8(nsDependentCString(aFolderURI)),</span>
<a href="#l12.32"></a><span id="l12.32">                  NS_ERROR_UNEXPECTED);</span>
<a href="#l12.33"></a><span id="l12.33">   NS_ConvertUTF8toUTF16 oldPath(aFolderURI);</span>
<a href="#l12.34"></a><span id="l12.34"> </span>
<a href="#l12.35"></a><span id="l12.35">   nsAutoString pathPiece, path;</span>
<a href="#l12.36"></a><span id="l12.36"> </span>
<a href="#l12.37"></a><span id="l12.37">   int32_t startSlashPos = oldPath.FindChar('/');</span>
<a href="#l12.38"></a><span id="l12.38">   int32_t endSlashPos = (startSlashPos &gt;= 0)</span>
<a href="#l12.39"></a><span id="l12.39">                             ? oldPath.FindChar('/', startSlashPos + 1) - 1</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -224,21 +224,16 @@ NS_MSG_BASE bool MsgHostDomainIsTrusted(</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5"> // gets an nsIFile from a UTF-8 file:// path</span>
<a href="#l13.6"></a><span id="l13.6"> NS_MSG_BASE nsresult MsgGetLocalFileFromURI(const nsACString &amp;aUTF8Path,</span>
<a href="#l13.7"></a><span id="l13.7">                                             nsIFile **aFile);</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9"> NS_MSG_BASE void MsgStripQuotedPrintable(nsCString &amp;aSrc);</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11"> /*</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">- * Utility function copied from nsReadableUtils</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">- */</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-NS_MSG_BASE bool MsgIsUTF8(const nsACString &amp;aString);</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-/*</span>
<a href="#l13.17"></a><span id="l13.17">  * Utility functions that call functions from nsINetUtil</span>
<a href="#l13.18"></a><span id="l13.18">  */</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20"> NS_MSG_BASE nsresult MsgEscapeString(const nsACString &amp;aStr, uint32_t aType,</span>
<a href="#l13.21"></a><span id="l13.21">                                      nsACString &amp;aResult);</span>
<a href="#l13.22"></a><span id="l13.22"> </span>
<a href="#l13.23"></a><span id="l13.23"> NS_MSG_BASE nsresult MsgUnescapeString(const nsACString &amp;aStr, uint32_t aFlags,</span>
<a href="#l13.24"></a><span id="l13.24">                                        nsACString &amp;aResult);</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineat">@@ -335,37 +330,16 @@ NS_MSG_BASE nsresult MsgDetectCharsetFro</span>
<a href="#l13.26"></a><span id="l13.26">  */</span>
<a href="#l13.27"></a><span id="l13.27"> NS_MSG_BASE nsresult ConvertBufToPlainText(nsString &amp;aConBuf, bool formatFlowed,</span>
<a href="#l13.28"></a><span id="l13.28">                                            bool delsp, bool formatOutput,</span>
<a href="#l13.29"></a><span id="l13.29">                                            bool disallowBreaks);</span>
<a href="#l13.30"></a><span id="l13.30"> </span>
<a href="#l13.31"></a><span id="l13.31"> #include &quot;nsEscape.h&quot;</span>
<a href="#l13.32"></a><span id="l13.32"> </span>
<a href="#l13.33"></a><span id="l13.33"> /**</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">- * The following methods are not exposed to the external API, but when we're</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">- * using the internal API we can simply redirect the calls appropriately.</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">- */</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-#define MsgLowerCaseEqualsLiteral(str, l) (str).LowerCaseEqualsLiteral(l)</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-#define MsgRFindChar(str, ch, len) (str).RFindChar(ch, len)</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-#define MsgCompressWhitespace(str) (str).CompressWhitespace()</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-#define MsgReplaceSubstring(str, what, replacement) \</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-  (str).ReplaceSubstring(what, replacement)</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-#define MsgIsUTF8(str) mozilla::IsUtf8(str)</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-#define MsgNewInterfaceRequestorAggregation(aFirst, aSecond, aResult) \</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-  NS_NewInterfaceRequestorAggregation(aFirst, aSecond, aResult)</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-#define MsgNewNotificationCallbacksAggregation(aCallbacks, aLoadGroup, \</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-                                               aResult)                \</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-  NS_NewNotificationCallbacksAggregation(aCallbacks, aLoadGroup, aResult)</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-#define MsgReplaceChar(aString, aNeedle, aReplacement) \</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-  (aString).ReplaceChar(aNeedle, aReplacement)</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-#define MsgFind(str, what, ignore_case, offset) \</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-  (str).Find(what, ignore_case, offset)</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-#define MsgCountChar(aString, aChar) (aString).CountChar(aChar)</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineminus">-</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-/**</span>
<a href="#l13.55"></a><span id="l13.55">  * Converts a hex string into an integer.</span>
<a href="#l13.56"></a><span id="l13.56">  * Processes up to aNumChars characters or the first non-hex char.</span>
<a href="#l13.57"></a><span id="l13.57">  * It is not an error if less than aNumChars valid hex digits are found.</span>
<a href="#l13.58"></a><span id="l13.58">  */</span>
<a href="#l13.59"></a><span id="l13.59"> NS_MSG_BASE uint64_t MsgUnhex(const char *aHexString, size_t aNumChars);</span>
<a href="#l13.60"></a><span id="l13.60"> </span>
<a href="#l13.61"></a><span id="l13.61"> /**</span>
<a href="#l13.62"></a><span id="l13.62">  * Checks if a string is a valid hex literal containing at least aNumChars</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1461,17 +1461,17 @@ void GetFolderURIFromUserPrefs(nsMsgDeli</span>
<a href="#l14.4"></a><span id="l14.4">         do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l14.5"></a><span id="l14.5">     if (NS_FAILED(rv)) return;</span>
<a href="#l14.6"></a><span id="l14.6">     rv = prefs-&gt;GetCharPref(&quot;mail.default_sendlater_uri&quot;, uri);</span>
<a href="#l14.7"></a><span id="l14.7">     if (NS_FAILED(rv) || uri.IsEmpty())</span>
<a href="#l14.8"></a><span id="l14.8">       uri.AssignLiteral(ANY_SERVER);</span>
<a href="#l14.9"></a><span id="l14.9">     else {</span>
<a href="#l14.10"></a><span id="l14.10">       // check if uri is unescaped, and if so, escape it and reset the pef.</span>
<a href="#l14.11"></a><span id="l14.11">       if (uri.FindChar(' ') != kNotFound) {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-        MsgReplaceSubstring(uri, &quot; &quot;, &quot;%20&quot;);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+        uri.ReplaceSubstring(&quot; &quot;, &quot;%20&quot;);</span>
<a href="#l14.14"></a><span id="l14.14">         prefs-&gt;SetCharPref(&quot;mail.default_sendlater_uri&quot;, uri);</span>
<a href="#l14.15"></a><span id="l14.15">       }</span>
<a href="#l14.16"></a><span id="l14.16">     }</span>
<a href="#l14.17"></a><span id="l14.17">     return;</span>
<a href="#l14.18"></a><span id="l14.18">   }</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20">   if (!identity) return;</span>
<a href="#l14.21"></a><span id="l14.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -65,16 +65,17 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> #include &quot;mozilla/mailnews/MimeHeaderParser.h&quot;</span>
<a href="#l15.6"></a><span id="l15.6"> #include &quot;mozilla/Preferences.h&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> #include &quot;mozilla/ErrorResult.h&quot;</span>
<a href="#l15.8"></a><span id="l15.8"> #include &quot;mozilla/Telemetry.h&quot;</span>
<a href="#l15.9"></a><span id="l15.9"> #include &quot;mozilla/dom/HTMLAnchorElement.h&quot;</span>
<a href="#l15.10"></a><span id="l15.10"> #include &quot;mozilla/dom/HTMLImageElement.h&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> #include &quot;mozilla/dom/Selection.h&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+#include &quot;mozilla/Utf8.h&quot;</span>
<a href="#l15.13"></a><span id="l15.13"> #include &quot;nsStreamConverter.h&quot;</span>
<a href="#l15.14"></a><span id="l15.14"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l15.15"></a><span id="l15.15"> #include &quot;nsIProtocolHandler.h&quot;</span>
<a href="#l15.16"></a><span id="l15.16"> #include &quot;nsContentUtils.h&quot;</span>
<a href="#l15.17"></a><span id="l15.17"> #include &quot;nsIFileURL.h&quot;</span>
<a href="#l15.18"></a><span id="l15.18"> #include &quot;nsTextNode.h&quot;  // from dom/base</span>
<a href="#l15.19"></a><span id="l15.19"> #include &quot;nsIParserUtils.h&quot;</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21" class="difflineat">@@ -1380,17 +1381,17 @@ NS_IMETHODIMP nsMsgCompose::SendMsg(MSG_</span>
<a href="#l15.22"></a><span id="l15.22">         int32_t index = userid.FindChar('@');</span>
<a href="#l15.23"></a><span id="l15.23">         if (index != kNotFound) userid.SetLength(index);</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25">         if (userid.IsEmpty())</span>
<a href="#l15.26"></a><span id="l15.26">           attachment-&gt;SetName(NS_LITERAL_STRING(&quot;vcard.vcf&quot;));</span>
<a href="#l15.27"></a><span id="l15.27">         else {</span>
<a href="#l15.28"></a><span id="l15.28">           // Replace any dot with underscore to stop vCards</span>
<a href="#l15.29"></a><span id="l15.29">           // generating false positives with some heuristic scanners</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-          MsgReplaceChar(userid, '.', '_');</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+          userid.ReplaceChar('.', '_');</span>
<a href="#l15.32"></a><span id="l15.32">           userid.AppendLiteral(&quot;.vcf&quot;);</span>
<a href="#l15.33"></a><span id="l15.33">           attachment-&gt;SetName(NS_ConvertASCIItoUTF16(userid));</span>
<a href="#l15.34"></a><span id="l15.34">         }</span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36">         attachment-&gt;SetUrl(vCardUrl);</span>
<a href="#l15.37"></a><span id="l15.37">         m_compFields-&gt;AddAttachment(attachment);</span>
<a href="#l15.38"></a><span id="l15.38">       }</span>
<a href="#l15.39"></a><span id="l15.39">     }</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineat">@@ -2047,17 +2048,17 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l15.41"></a><span id="l15.41">               sanitizedSubj.Assign(subject);</span>
<a href="#l15.42"></a><span id="l15.42"> </span>
<a href="#l15.43"></a><span id="l15.43">             // set the file size</span>
<a href="#l15.44"></a><span id="l15.44">             uint32_t messageSize;</span>
<a href="#l15.45"></a><span id="l15.45">             msgHdr-&gt;GetMessageSize(&amp;messageSize);</span>
<a href="#l15.46"></a><span id="l15.46">             attachment-&gt;SetSize(messageSize);</span>
<a href="#l15.47"></a><span id="l15.47"> </span>
<a href="#l15.48"></a><span id="l15.48">             // change all '.' to '_'  see bug #271211</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-            MsgReplaceChar(sanitizedSubj, &quot;.&quot;, '_');</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineplus">+            sanitizedSubj.ReplaceChar(&quot;.&quot;, '_');</span>
<a href="#l15.51"></a><span id="l15.51">             if (addExtension) sanitizedSubj.AppendLiteral(&quot;.eml&quot;);</span>
<a href="#l15.52"></a><span id="l15.52">             attachment-&gt;SetName(sanitizedSubj);</span>
<a href="#l15.53"></a><span id="l15.53">             attachment-&gt;SetUrl(nsDependentCString(uri));</span>
<a href="#l15.54"></a><span id="l15.54">             m_compFields-&gt;AddAttachment(attachment);</span>
<a href="#l15.55"></a><span id="l15.55">           }</span>
<a href="#l15.56"></a><span id="l15.56"> </span>
<a href="#l15.57"></a><span id="l15.57">           if (isFirstPass) {</span>
<a href="#l15.58"></a><span id="l15.58">             nsCString fwdPrefix;</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineat">@@ -3850,17 +3851,17 @@ nsresult nsMsgCompose::LoadDataFromFile(</span>
<a href="#l15.60"></a><span id="l15.60">   inputFile-&gt;Close();</span>
<a href="#l15.61"></a><span id="l15.61"> </span>
<a href="#l15.62"></a><span id="l15.62">   readSize = (uint32_t)fileSize;</span>
<a href="#l15.63"></a><span id="l15.63"> </span>
<a href="#l15.64"></a><span id="l15.64">   nsAutoCString sigEncoding(nsMsgI18NParseMetaCharset(file));</span>
<a href="#l15.65"></a><span id="l15.65">   bool removeSigCharset = !sigEncoding.IsEmpty() &amp;&amp; m_composeHTML;</span>
<a href="#l15.66"></a><span id="l15.66"> </span>
<a href="#l15.67"></a><span id="l15.67">   if (sigEncoding.IsEmpty()) {</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-    if (aAllowUTF8 &amp;&amp; MsgIsUTF8(nsDependentCString(readBuf))) {</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineplus">+    if (aAllowUTF8 &amp;&amp; mozilla::IsUtf8(nsDependentCString(readBuf))) {</span>
<a href="#l15.70"></a><span id="l15.70">       sigEncoding.AssignLiteral(&quot;UTF-8&quot;);</span>
<a href="#l15.71"></a><span id="l15.71">     } else if (sigEncoding.IsEmpty() &amp;&amp; aAllowUTF16 &amp;&amp; readSize % 2 == 0 &amp;&amp;</span>
<a href="#l15.72"></a><span id="l15.72">                readSize &gt;= 2 &amp;&amp;</span>
<a href="#l15.73"></a><span id="l15.73">                ((readBuf[0] == char(0xFE) &amp;&amp; readBuf[1] == char(0xFF)) ||</span>
<a href="#l15.74"></a><span id="l15.74">                 (readBuf[0] == char(0xFF) &amp;&amp; readBuf[1] == char(0xFE)))) {</span>
<a href="#l15.75"></a><span id="l15.75">       sigEncoding.AssignLiteral(&quot;UTF-16&quot;);</span>
<a href="#l15.76"></a><span id="l15.76">     } else {</span>
<a href="#l15.77"></a><span id="l15.77">       // default to platform encoding for plain text files w/o meta charset</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineat">@@ -4289,18 +4290,17 @@ nsresult nsMsgCompose::BuildBodyMessageA</span>
<a href="#l15.79"></a><span id="l15.79">   nsAutoString tSignature;</span>
<a href="#l15.80"></a><span id="l15.80">   if (addSignature) ProcessSignature(m_identity, isQuoted, &amp;tSignature);</span>
<a href="#l15.81"></a><span id="l15.81"> </span>
<a href="#l15.82"></a><span id="l15.82">   // if type is new, but we have body, this is probably a mapi send, so we need</span>
<a href="#l15.83"></a><span id="l15.83">   // to replace '\n' with &lt;br&gt; so that the line breaks won't be lost by html. if</span>
<a href="#l15.84"></a><span id="l15.84">   // mailtourl, do the same.</span>
<a href="#l15.85"></a><span id="l15.85">   if (m_composeHTML &amp;&amp;</span>
<a href="#l15.86"></a><span id="l15.86">       (mType == nsIMsgCompType::New || mType == nsIMsgCompType::MailToUrl))</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-    MsgReplaceSubstring(body, NS_LITERAL_STRING(&quot;\n&quot;),</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-                        NS_LITERAL_STRING(&quot;&lt;br&gt;&quot;));</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineplus">+    body.ReplaceSubstring(NS_LITERAL_STRING(&quot;\n&quot;), NS_LITERAL_STRING(&quot;&lt;br&gt;&quot;));</span>
<a href="#l15.90"></a><span id="l15.90"> </span>
<a href="#l15.91"></a><span id="l15.91">   // Restore flowed text wrapping for Drafts/Templates.</span>
<a href="#l15.92"></a><span id="l15.92">   // Look for unquoted lines - if we have an unquoted line</span>
<a href="#l15.93"></a><span id="l15.93">   // that ends in a space, join this line with the next one</span>
<a href="#l15.94"></a><span id="l15.94">   // by removing the end of line char(s).</span>
<a href="#l15.95"></a><span id="l15.95">   int32_t wrapping_enabled = 0;</span>
<a href="#l15.96"></a><span id="l15.96">   GetWrapLength(&amp;wrapping_enabled);</span>
<a href="#l15.97"></a><span id="l15.97">   if (!m_composeHTML &amp;&amp; wrapping_enabled) {</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineat">@@ -4382,17 +4382,17 @@ nsresult nsMsgCompose::NotifyStateListen</span>
<a href="#l15.99"></a><span id="l15.99">   return NS_OK;</span>
<a href="#l15.100"></a><span id="l15.100"> }</span>
<a href="#l15.101"></a><span id="l15.101"> </span>
<a href="#l15.102"></a><span id="l15.102"> nsresult nsMsgCompose::AttachmentPrettyName(const nsACString &amp;scheme,</span>
<a href="#l15.103"></a><span id="l15.103">                                             const char *charset,</span>
<a href="#l15.104"></a><span id="l15.104">                                             nsACString &amp;_retval) {</span>
<a href="#l15.105"></a><span id="l15.105">   nsresult rv;</span>
<a href="#l15.106"></a><span id="l15.106"> </span>
<a href="#l15.107"></a><span id="l15.107" class="difflineminus">-  if (MsgLowerCaseEqualsLiteral(StringHead(scheme, 5), &quot;file:&quot;)) {</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineplus">+  if (StringHead(scheme, 5).LowerCaseEqualsLiteral(&quot;file:&quot;)) {</span>
<a href="#l15.109"></a><span id="l15.109">     nsCOMPtr&lt;nsIFile&gt; file;</span>
<a href="#l15.110"></a><span id="l15.110">     rv = NS_GetFileFromURLSpec(scheme, getter_AddRefs(file));</span>
<a href="#l15.111"></a><span id="l15.111">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.112"></a><span id="l15.112">     nsAutoString leafName;</span>
<a href="#l15.113"></a><span id="l15.113">     rv = file-&gt;GetLeafName(leafName);</span>
<a href="#l15.114"></a><span id="l15.114">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.115"></a><span id="l15.115">     CopyUTF16toUTF8(leafName, _retval);</span>
<a href="#l15.116"></a><span id="l15.116">     return rv;</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineat">@@ -4408,18 +4408,17 @@ nsresult nsMsgCompose::AttachmentPrettyN</span>
<a href="#l15.118"></a><span id="l15.118">   nsAutoString retUrl;</span>
<a href="#l15.119"></a><span id="l15.119">   rv = textToSubURI-&gt;UnEscapeURIForUI(nsDependentCString(cset), scheme, retUrl);</span>
<a href="#l15.120"></a><span id="l15.120"> </span>
<a href="#l15.121"></a><span id="l15.121">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l15.122"></a><span id="l15.122">     CopyUTF16toUTF8(retUrl, _retval);</span>
<a href="#l15.123"></a><span id="l15.123">   } else {</span>
<a href="#l15.124"></a><span id="l15.124">     _retval.Assign(scheme);</span>
<a href="#l15.125"></a><span id="l15.125">   }</span>
<a href="#l15.126"></a><span id="l15.126" class="difflineminus">-  if (MsgLowerCaseEqualsLiteral(StringHead(scheme, 5), &quot;http:&quot;))</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineminus">-    _retval.Cut(0, 7);</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineplus">+  if (StringHead(scheme, 5).LowerCaseEqualsLiteral(&quot;http:&quot;)) _retval.Cut(0, 7);</span>
<a href="#l15.129"></a><span id="l15.129"> </span>
<a href="#l15.130"></a><span id="l15.130">   return NS_OK;</span>
<a href="#l15.131"></a><span id="l15.131"> }</span>
<a href="#l15.132"></a><span id="l15.132"> </span>
<a href="#l15.133"></a><span id="l15.133"> /**</span>
<a href="#l15.134"></a><span id="l15.134">  * Retrieve address book directories and mailing lists.</span>
<a href="#l15.135"></a><span id="l15.135">  *</span>
<a href="#l15.136"></a><span id="l15.136">  * @param aDirUri               directory URI</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -336,17 +336,17 @@ nsresult nsMsgComposeAndSend::GetNotific</span>
<a href="#l16.4"></a><span id="l16.4">   if (msgWindow) {</span>
<a href="#l16.5"></a><span id="l16.5">     nsCOMPtr&lt;nsIDocShell&gt; docShell;</span>
<a href="#l16.6"></a><span id="l16.6">     msgWindow-&gt;GetRootDocShell(getter_AddRefs(docShell));</span>
<a href="#l16.7"></a><span id="l16.7">     nsCOMPtr&lt;nsIInterfaceRequestor&gt; ir(do_QueryInterface(docShell));</span>
<a href="#l16.8"></a><span id="l16.8">     nsCOMPtr&lt;nsIInterfaceRequestor&gt; notificationCallbacks;</span>
<a href="#l16.9"></a><span id="l16.9">     msgWindow-&gt;GetNotificationCallbacks(getter_AddRefs(notificationCallbacks));</span>
<a href="#l16.10"></a><span id="l16.10">     if (notificationCallbacks) {</span>
<a href="#l16.11"></a><span id="l16.11">       nsCOMPtr&lt;nsIInterfaceRequestor&gt; aggregrateIR;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-      MsgNewInterfaceRequestorAggregation(notificationCallbacks, ir,</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+      NS_NewInterfaceRequestorAggregation(notificationCallbacks, ir,</span>
<a href="#l16.14"></a><span id="l16.14">                                           getter_AddRefs(aggregrateIR));</span>
<a href="#l16.15"></a><span id="l16.15">       ir = aggregrateIR;</span>
<a href="#l16.16"></a><span id="l16.16">     }</span>
<a href="#l16.17"></a><span id="l16.17">     if (ir) {</span>
<a href="#l16.18"></a><span id="l16.18">       ir.forget(aCallbacks);</span>
<a href="#l16.19"></a><span id="l16.19">       return NS_OK;</span>
<a href="#l16.20"></a><span id="l16.20">     }</span>
<a href="#l16.21"></a><span id="l16.21">   }</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -1837,18 +1837,18 @@ nsresult nsMsgComposeAndSend::AddCompFie</span>
<a href="#l16.23"></a><span id="l16.23">                       if (!type.EqualsLiteral(</span>
<a href="#l16.24"></a><span id="l16.24">                               &quot;multipart/appledouble&quot;))  // can't do apple</span>
<a href="#l16.25"></a><span id="l16.25">                                                          // double on non-macs</span>
<a href="#l16.26"></a><span id="l16.26"> #endif</span>
<a href="#l16.27"></a><span id="l16.27">                         m_attachments[newLoc]-&gt;m_type = type;</span>
<a href="#l16.28"></a><span id="l16.28">                       // rtf and vcs files may look like text to sniffers,</span>
<a href="#l16.29"></a><span id="l16.29">                       // but they're not human readable.</span>
<a href="#l16.30"></a><span id="l16.30">                       if (type.IsEmpty() &amp;&amp; !fileExt.IsEmpty() &amp;&amp;</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-                          (MsgLowerCaseEqualsLiteral(fileExt, &quot;rtf&quot;) ||</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">-                           MsgLowerCaseEqualsLiteral(fileExt, &quot;vcs&quot;)))</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+                          (fileExt.LowerCaseEqualsLiteral(&quot;rtf&quot;) ||</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+                           fileExt.LowerCaseEqualsLiteral(&quot;vcs&quot;)))</span>
<a href="#l16.35"></a><span id="l16.35">                         m_attachments[newLoc]-&gt;m_type =</span>
<a href="#l16.36"></a><span id="l16.36">                             APPLICATION_OCTET_STREAM;</span>
<a href="#l16.37"></a><span id="l16.37">                     }</span>
<a href="#l16.38"></a><span id="l16.38">                   }</span>
<a href="#l16.39"></a><span id="l16.39">                 }</span>
<a href="#l16.40"></a><span id="l16.40">               }</span>
<a href="#l16.41"></a><span id="l16.41">             }</span>
<a href="#l16.42"></a><span id="l16.42">           } else {</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineat">@@ -2369,17 +2369,17 @@ nsresult nsMsgComposeAndSend::InitCompos</span>
<a href="#l16.44"></a><span id="l16.44">           }</span>
<a href="#l16.45"></a><span id="l16.45">         }</span>
<a href="#l16.46"></a><span id="l16.46">       }</span>
<a href="#l16.47"></a><span id="l16.47"> </span>
<a href="#l16.48"></a><span id="l16.48">       if (useDefaultFCC) {</span>
<a href="#l16.49"></a><span id="l16.49">         nsCString uri;</span>
<a href="#l16.50"></a><span id="l16.50">         GetFolderURIFromUserPrefs(nsMsgDeliverNow, mUserIdentity, uri);</span>
<a href="#l16.51"></a><span id="l16.51">         mCompFields-&gt;SetFcc(</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-            MsgLowerCaseEqualsLiteral(uri, &quot;nocopy://&quot;) ? &quot;&quot; : uri.get());</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+            uri.LowerCaseEqualsLiteral(&quot;nocopy://&quot;) ? &quot;&quot; : uri.get());</span>
<a href="#l16.54"></a><span id="l16.54">       }</span>
<a href="#l16.55"></a><span id="l16.55">     }</span>
<a href="#l16.56"></a><span id="l16.56">   }</span>
<a href="#l16.57"></a><span id="l16.57"> </span>
<a href="#l16.58"></a><span id="l16.58">   //</span>
<a href="#l16.59"></a><span id="l16.59">   // Deal with an additional FCC operation for this email.</span>
<a href="#l16.60"></a><span id="l16.60">   //</span>
<a href="#l16.61"></a><span id="l16.61">   const char *fieldsFCC2 = fields-&gt;GetFcc2();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -847,17 +847,17 @@ nsresult nsSmtpProtocol::SendEhloRespons</span>
<a href="#l17.4"></a><span id="l17.4">   int32_t endPos;</span>
<a href="#l17.5"></a><span id="l17.5">   do {</span>
<a href="#l17.6"></a><span id="l17.6">     endPos = m_responseText.FindChar('\n', startPos + 1);</span>
<a href="#l17.7"></a><span id="l17.7">     nsAutoCString responseLine;</span>
<a href="#l17.8"></a><span id="l17.8">     responseLine.Assign(</span>
<a href="#l17.9"></a><span id="l17.9">         Substring(m_responseText, startPos,</span>
<a href="#l17.10"></a><span id="l17.10">                   (endPos &gt;= 0 ? endPos : responseLength) - startPos));</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    MsgCompressWhitespace(responseLine);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    responseLine.CompressWhitespace();</span>
<a href="#l17.14"></a><span id="l17.14">     if (responseLine.LowerCaseEqualsLiteral(&quot;starttls&quot;)) {</span>
<a href="#l17.15"></a><span id="l17.15">       SetFlag(SMTP_EHLO_STARTTLS_ENABLED);</span>
<a href="#l17.16"></a><span id="l17.16">     } else if (responseLine.LowerCaseEqualsLiteral(&quot;dsn&quot;)) {</span>
<a href="#l17.17"></a><span id="l17.17">       SetFlag(SMTP_EHLO_DSN_ENABLED);</span>
<a href="#l17.18"></a><span id="l17.18">     } else if (responseLine.LowerCaseEqualsLiteral(&quot;clientid&quot;)) {</span>
<a href="#l17.19"></a><span id="l17.19">       SetFlag(SMTP_EHLO_CLIENTID_ENABLED);</span>
<a href="#l17.20"></a><span id="l17.20">       // If we have &quot;clientid&quot; in the ehlo response, then TLS must be present.</span>
<a href="#l17.21"></a><span id="l17.21">       if (m_prefSocketType == nsMsgSocketType::SSL) m_tlsEnabled = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/compose/src/nsURLFetcher.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/compose/src/nsURLFetcher.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -227,18 +227,17 @@ nsURLFetcher::OnStopRequest(nsIRequest *</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5">   // time to close the output stream...</span>
<a href="#l18.6"></a><span id="l18.6">   if (mOutStream) {</span>
<a href="#l18.7"></a><span id="l18.7">     mOutStream-&gt;Close();</span>
<a href="#l18.8"></a><span id="l18.8">     mOutStream = nullptr;</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">     /* In case of multipart/x-mixed-replace, we need to truncate the file to the</span>
<a href="#l18.11"></a><span id="l18.11">      * current part size */</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    if (MsgLowerCaseEqualsLiteral(mConverterContentType,</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-                                  MULTIPART_MIXED_REPLACE)) {</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+    if (mConverterContentType.LowerCaseEqualsLiteral(MULTIPART_MIXED_REPLACE)) {</span>
<a href="#l18.15"></a><span id="l18.15">       mLocalFile-&gt;SetFileSize(mTotalWritten);</span>
<a href="#l18.16"></a><span id="l18.16">     }</span>
<a href="#l18.17"></a><span id="l18.17">   }</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19">   // Now if there is a callback, we need to call it...</span>
<a href="#l18.20"></a><span id="l18.20">   if (mCallback)</span>
<a href="#l18.21"></a><span id="l18.21">     mCallback(aStatus, mContentType, mCharset, mTotalWritten, nullptr,</span>
<a href="#l18.22"></a><span id="l18.22">               mTagData);</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineat">@@ -378,18 +377,18 @@ nsURLFetcherStreamConsumer::~nsURLFetche</span>
<a href="#l18.24"></a><span id="l18.24"> /** nsIRequestObserver methods **/</span>
<a href="#l18.25"></a><span id="l18.25"> </span>
<a href="#l18.26"></a><span id="l18.26"> /* void onStartRequest (in nsIRequest request); */</span>
<a href="#l18.27"></a><span id="l18.27"> NS_IMETHODIMP nsURLFetcherStreamConsumer::OnStartRequest(nsIRequest *aRequest) {</span>
<a href="#l18.28"></a><span id="l18.28">   if (!mURLFetcher || !mURLFetcher-&gt;mOutStream) return NS_ERROR_FAILURE;</span>
<a href="#l18.29"></a><span id="l18.29"> </span>
<a href="#l18.30"></a><span id="l18.30">   /* In case of multipart/x-mixed-replace, we need to erase the output file</span>
<a href="#l18.31"></a><span id="l18.31">    * content */</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-  if (MsgLowerCaseEqualsLiteral(mURLFetcher-&gt;mConverterContentType,</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-                                MULTIPART_MIXED_REPLACE)) {</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+  if (mURLFetcher-&gt;mConverterContentType.LowerCaseEqualsLiteral(</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+          MULTIPART_MIXED_REPLACE)) {</span>
<a href="#l18.36"></a><span id="l18.36">     nsCOMPtr&lt;nsISeekableStream&gt; seekStream =</span>
<a href="#l18.37"></a><span id="l18.37">         do_QueryInterface(mURLFetcher-&gt;mOutStream);</span>
<a href="#l18.38"></a><span id="l18.38">     if (seekStream) seekStream-&gt;Seek(nsISeekableStream::NS_SEEK_SET, 0);</span>
<a href="#l18.39"></a><span id="l18.39">     mURLFetcher-&gt;mTotalWritten = 0;</span>
<a href="#l18.40"></a><span id="l18.40">   }</span>
<a href="#l18.41"></a><span id="l18.41"> </span>
<a href="#l18.42"></a><span id="l18.42">   return NS_OK;</span>
<a href="#l18.43"></a><span id="l18.43"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -934,17 +934,17 @@ class MsgDBReporter final : public nsIMe</span>
<a href="#l19.4"></a><span id="l19.4">     nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l19.5"></a><span id="l19.5">     mDatabase-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l19.6"></a><span id="l19.6">     if (folder) {</span>
<a href="#l19.7"></a><span id="l19.7">       if (aAnonymize)</span>
<a href="#l19.8"></a><span id="l19.8">         memoryPath.AppendLiteral(&quot;&lt;anonymized&gt;&quot;);</span>
<a href="#l19.9"></a><span id="l19.9">       else {</span>
<a href="#l19.10"></a><span id="l19.10">         nsAutoCString folderURL;</span>
<a href="#l19.11"></a><span id="l19.11">         folder-&gt;GetFolderURL(folderURL);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-        MsgReplaceChar(folderURL, '/', '\\');</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+        folderURL.ReplaceChar('/', '\\');</span>
<a href="#l19.14"></a><span id="l19.14">         memoryPath += folderURL;</span>
<a href="#l19.15"></a><span id="l19.15">       }</span>
<a href="#l19.16"></a><span id="l19.16">     } else {</span>
<a href="#l19.17"></a><span id="l19.17">       memoryPath.AppendLiteral(&quot;UNKNOWN-FOLDER&quot;);</span>
<a href="#l19.18"></a><span id="l19.18">     }</span>
<a href="#l19.19"></a><span id="l19.19">     memoryPath.Append(')');</span>
<a href="#l19.20"></a><span id="l19.20">   }</span>
<a href="#l19.21"></a><span id="l19.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -737,20 +737,20 @@ void Tokenizer::tokenize(const char* aTe</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5">   // RSS feeds store their summary information as an iframe. But due to</span>
<a href="#l20.6"></a><span id="l20.6">   // bug 365953, we can't see those in the plaintext serializer. As a</span>
<a href="#l20.7"></a><span id="l20.7">   // workaround, allow an option to replace iframe with div in the message</span>
<a href="#l20.8"></a><span id="l20.8">   // text. We disable by default, since most people won't be applying bayes</span>
<a href="#l20.9"></a><span id="l20.9">   // to RSS</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">   if (mIframeToDiv) {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    MsgReplaceSubstring(text, NS_LITERAL_STRING(&quot;&lt;iframe&quot;),</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-                        NS_LITERAL_STRING(&quot;&lt;div&quot;));</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-    MsgReplaceSubstring(text, NS_LITERAL_STRING(&quot;/iframe&gt;&quot;),</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-                        NS_LITERAL_STRING(&quot;/div&gt;&quot;));</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+    text.ReplaceSubstring(NS_LITERAL_STRING(&quot;&lt;iframe&quot;),</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+                          NS_LITERAL_STRING(&quot;&lt;div&quot;));</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+    text.ReplaceSubstring(NS_LITERAL_STRING(&quot;/iframe&gt;&quot;),</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+                          NS_LITERAL_STRING(&quot;/div&gt;&quot;));</span>
<a href="#l20.20"></a><span id="l20.20">   }</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22">   stripHTML(text, strippedUCS2);</span>
<a href="#l20.23"></a><span id="l20.23"> </span>
<a href="#l20.24"></a><span id="l20.24">   // convert 0x3000(full width space) into 0x0020</span>
<a href="#l20.25"></a><span id="l20.25">   char16_t* substr_start = strippedUCS2.BeginWriting();</span>
<a href="#l20.26"></a><span id="l20.26">   char16_t* substr_end = strippedUCS2.EndWriting();</span>
<a href="#l20.27"></a><span id="l20.27">   while (substr_start != substr_end) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/imap/src/nsImapFlagAndUidState.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapFlagAndUidState.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -236,18 +236,18 @@ NS_IMETHODIMP nsImapFlagAndUidState::Add</span>
<a href="#l21.4"></a><span id="l21.4">       // and the flag is at the beginning of the string or there is ' ' + flag</span>
<a href="#l21.5"></a><span id="l21.5">       // then we have this flag already;</span>
<a href="#l21.6"></a><span id="l21.6">       if (((oldValue.Length() == existingCustomFlagPos + customFlagLen) ||</span>
<a href="#l21.7"></a><span id="l21.7">            (oldValue.CharAt(existingCustomFlagPos + customFlagLen) == ' ')) &amp;&amp;</span>
<a href="#l21.8"></a><span id="l21.8">           ((existingCustomFlagPos == 0) ||</span>
<a href="#l21.9"></a><span id="l21.9">            (oldValue.CharAt(existingCustomFlagPos - 1) == ' ')))</span>
<a href="#l21.10"></a><span id="l21.10">         return NS_OK;</span>
<a href="#l21.11"></a><span id="l21.11">       // else, advance to next flag</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-      existingCustomFlagPos = MsgFind(oldValue, customFlagString, false,</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-                                      existingCustomFlagPos + customFlagLen);</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+      existingCustomFlagPos = oldValue.Find(</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+          customFlagString, false, existingCustomFlagPos + customFlagLen);</span>
<a href="#l21.16"></a><span id="l21.16">     }</span>
<a href="#l21.17"></a><span id="l21.17">     ourCustomFlags.Assign(oldValue);</span>
<a href="#l21.18"></a><span id="l21.18">     ourCustomFlags.Append(' ');</span>
<a href="#l21.19"></a><span id="l21.19">     ourCustomFlags.Append(customFlag);</span>
<a href="#l21.20"></a><span id="l21.20">     m_customFlagsHash.Remove(uid);</span>
<a href="#l21.21"></a><span id="l21.21">   } else {</span>
<a href="#l21.22"></a><span id="l21.22">     ourCustomFlags.Assign(customFlag);</span>
<a href="#l21.23"></a><span id="l21.23">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -36,16 +36,17 @@</span>
<a href="#l22.4"></a><span id="l22.4"> #include &quot;nsIMAPNamespace.h&quot;</span>
<a href="#l22.5"></a><span id="l22.5"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l22.6"></a><span id="l22.6"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l22.7"></a><span id="l22.7"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l22.8"></a><span id="l22.8"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l22.9"></a><span id="l22.9"> #include &quot;nsCRTGlue.h&quot;</span>
<a href="#l22.10"></a><span id="l22.10"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l22.11"></a><span id="l22.11"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+#include &quot;mozilla/Utf8.h&quot;</span>
<a href="#l22.13"></a><span id="l22.13"> </span>
<a href="#l22.14"></a><span id="l22.14"> using namespace mozilla;</span>
<a href="#l22.15"></a><span id="l22.15"> </span>
<a href="#l22.16"></a><span id="l22.16"> // Despite its name, this contains a folder path, for example INBOX/Trash.</span>
<a href="#l22.17"></a><span id="l22.17"> #define PREF_TRASH_FOLDER_PATH &quot;trash_folder_name&quot;</span>
<a href="#l22.18"></a><span id="l22.18"> #define DEFAULT_TRASH_FOLDER_PATH &quot;Trash&quot;  // XXX Is this a useful default?</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20"> static NS_DEFINE_CID(kImapProtocolCID, NS_IMAPPROTOCOL_CID);</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineat">@@ -1026,55 +1027,55 @@ NS_IMETHODIMP nsImapIncomingServer::Poss</span>
<a href="#l22.22"></a><span id="l22.22">     // If there is a hierarchy, there is a parent.</span>
<a href="#l22.23"></a><span id="l22.23">     // Don't strip off slash if it's the first character</span>
<a href="#l22.24"></a><span id="l22.24">     parentName.SetLength(leafPos);</span>
<a href="#l22.25"></a><span id="l22.25">     folderName.Cut(0, leafPos + 1);  // get rid of the parent name</span>
<a href="#l22.26"></a><span id="l22.26">     haveParent = true;</span>
<a href="#l22.27"></a><span id="l22.27">     parentUri.Append('/');</span>
<a href="#l22.28"></a><span id="l22.28">     parentUri.Append(parentName);</span>
<a href="#l22.29"></a><span id="l22.29">   }</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineminus">-  if (MsgLowerCaseEqualsLiteral(folderPath, &quot;inbox&quot;) &amp;&amp;</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineplus">+  if (folderPath.LowerCaseEqualsLiteral(&quot;inbox&quot;) &amp;&amp;</span>
<a href="#l22.32"></a><span id="l22.32">       hierarchyDelimiter == kOnlineHierarchySeparatorNil) {</span>
<a href="#l22.33"></a><span id="l22.33">     hierarchyDelimiter = '/';  // set to default in this case (as in 4.x)</span>
<a href="#l22.34"></a><span id="l22.34">     hostFolder-&gt;SetHierarchyDelimiter(hierarchyDelimiter);</span>
<a href="#l22.35"></a><span id="l22.35">   }</span>
<a href="#l22.36"></a><span id="l22.36"> </span>
<a href="#l22.37"></a><span id="l22.37">   nsCOMPtr&lt;nsIMsgFolder&gt; child;</span>
<a href="#l22.38"></a><span id="l22.38"> </span>
<a href="#l22.39"></a><span id="l22.39">   // nsCString possibleName(aSpec-&gt;allocatedPathName);</span>
<a href="#l22.40"></a><span id="l22.40">   uri.Append('/');</span>
<a href="#l22.41"></a><span id="l22.41">   uri.Append(dupFolderPath);</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineminus">-  bool caseInsensitive = MsgLowerCaseEqualsLiteral(dupFolderPath, &quot;inbox&quot;);</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineplus">+  bool caseInsensitive = dupFolderPath.LowerCaseEqualsLiteral(&quot;inbox&quot;);</span>
<a href="#l22.44"></a><span id="l22.44">   a_nsIFolder-&gt;GetChildWithURI(uri, true, caseInsensitive,</span>
<a href="#l22.45"></a><span id="l22.45">                                getter_AddRefs(child));</span>
<a href="#l22.46"></a><span id="l22.46">   // if we couldn't find this folder by URI, tell the imap code it's a new</span>
<a href="#l22.47"></a><span id="l22.47">   // folder to us</span>
<a href="#l22.48"></a><span id="l22.48">   *aNewFolder = !child;</span>
<a href="#l22.49"></a><span id="l22.49">   if (child) found = true;</span>
<a href="#l22.50"></a><span id="l22.50">   if (!found) {</span>
<a href="#l22.51"></a><span id="l22.51">     // trying to find/discover the parent</span>
<a href="#l22.52"></a><span id="l22.52">     if (haveParent) {</span>
<a href="#l22.53"></a><span id="l22.53">       nsCOMPtr&lt;nsIMsgFolder&gt; parent;</span>
<a href="#l22.54"></a><span id="l22.54">       bool parentIsNew;</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineminus">-      caseInsensitive = MsgLowerCaseEqualsLiteral(parentName, &quot;inbox&quot;);</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineplus">+      caseInsensitive = parentName.LowerCaseEqualsLiteral(&quot;inbox&quot;);</span>
<a href="#l22.57"></a><span id="l22.57">       a_nsIFolder-&gt;GetChildWithURI(parentUri, true, caseInsensitive,</span>
<a href="#l22.58"></a><span id="l22.58">                                    getter_AddRefs(parent));</span>
<a href="#l22.59"></a><span id="l22.59">       if (!parent /* || parentFolder-&gt;GetFolderNeedsAdded()*/) {</span>
<a href="#l22.60"></a><span id="l22.60">         PossibleImapMailbox(</span>
<a href="#l22.61"></a><span id="l22.61">             parentName, hierarchyDelimiter,</span>
<a href="#l22.62"></a><span id="l22.62">             kNoselect |       // be defensive</span>
<a href="#l22.63"></a><span id="l22.63">                 ((boxFlags &amp;  // only inherit certain flags from the child</span>
<a href="#l22.64"></a><span id="l22.64">                   (kPublicMailbox | kOtherUsersMailbox | kPersonalMailbox))),</span>
<a href="#l22.65"></a><span id="l22.65">             &amp;parentIsNew);</span>
<a href="#l22.66"></a><span id="l22.66">       }</span>
<a href="#l22.67"></a><span id="l22.67">     }</span>
<a href="#l22.68"></a><span id="l22.68">     rv = hostFolder-&gt;CreateClientSubfolderInfo(</span>
<a href="#l22.69"></a><span id="l22.69">         dupFolderPath, hierarchyDelimiter, boxFlags, false);</span>
<a href="#l22.70"></a><span id="l22.70">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineminus">-    caseInsensitive = MsgLowerCaseEqualsLiteral(dupFolderPath, &quot;inbox&quot;);</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineplus">+    caseInsensitive = dupFolderPath.LowerCaseEqualsLiteral(&quot;inbox&quot;);</span>
<a href="#l22.73"></a><span id="l22.73">     a_nsIFolder-&gt;GetChildWithURI(uri, true, caseInsensitive,</span>
<a href="#l22.74"></a><span id="l22.74">                                  getter_AddRefs(child));</span>
<a href="#l22.75"></a><span id="l22.75">   }</span>
<a href="#l22.76"></a><span id="l22.76">   if (child) {</span>
<a href="#l22.77"></a><span id="l22.77">     nsCOMPtr&lt;nsIMsgImapMailFolder&gt; imapFolder = do_QueryInterface(child);</span>
<a href="#l22.78"></a><span id="l22.78">     if (imapFolder) {</span>
<a href="#l22.79"></a><span id="l22.79">       nsAutoCString onlineName;</span>
<a href="#l22.80"></a><span id="l22.80">       nsAutoString unicodeName;</span>
<a href="#l22.81"></a><span id="l22.81" class="difflineat">@@ -1088,17 +1089,17 @@ NS_IMETHODIMP nsImapIncomingServer::Poss</span>
<a href="#l22.82"></a><span id="l22.82">       }</span>
<a href="#l22.83"></a><span id="l22.83"> </span>
<a href="#l22.84"></a><span id="l22.84">       imapFolder-&gt;SetBoxFlags(boxFlags);</span>
<a href="#l22.85"></a><span id="l22.85">       imapFolder-&gt;SetExplicitlyVerify(explicitlyVerify);</span>
<a href="#l22.86"></a><span id="l22.86">       imapFolder-&gt;GetOnlineName(onlineName);</span>
<a href="#l22.87"></a><span id="l22.87"> </span>
<a href="#l22.88"></a><span id="l22.88">       // online name needs to use the correct hierarchy delimiter (I think...)</span>
<a href="#l22.89"></a><span id="l22.89">       // or the canonical path - one or the other, but be consistent.</span>
<a href="#l22.90"></a><span id="l22.90" class="difflineminus">-      MsgReplaceChar(dupFolderPath, '/', hierarchyDelimiter);</span>
<a href="#l22.91"></a><span id="l22.91" class="difflineplus">+      dupFolderPath.ReplaceChar('/', hierarchyDelimiter);</span>
<a href="#l22.92"></a><span id="l22.92">       if (hierarchyDelimiter != '/')</span>
<a href="#l22.93"></a><span id="l22.93">         nsImapUrl::UnescapeSlashes(dupFolderPath.BeginWriting());</span>
<a href="#l22.94"></a><span id="l22.94"> </span>
<a href="#l22.95"></a><span id="l22.95">       // GMail gives us a localized name for the inbox but doesn't let</span>
<a href="#l22.96"></a><span id="l22.96">       // us select that localized name.</span>
<a href="#l22.97"></a><span id="l22.97">       if (boxFlags &amp; kImapInbox)</span>
<a href="#l22.98"></a><span id="l22.98">         imapFolder-&gt;SetOnlineName(NS_LITERAL_CSTRING(&quot;INBOX&quot;));</span>
<a href="#l22.99"></a><span id="l22.99">       else if (onlineName.IsEmpty() || !onlineName.Equals(dupFolderPath))</span>
<a href="#l22.100"></a><span id="l22.100" class="difflineat">@@ -2266,17 +2267,17 @@ NS_IMETHODIMP</span>
<a href="#l22.101"></a><span id="l22.101"> nsImapIncomingServer::AddTo(const nsACString &amp;aName, bool addAsSubscribed,</span>
<a href="#l22.102"></a><span id="l22.102">                             bool aSubscribable, bool changeIfExists) {</span>
<a href="#l22.103"></a><span id="l22.103">   nsresult rv = EnsureInner();</span>
<a href="#l22.104"></a><span id="l22.104">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.105"></a><span id="l22.105"> </span>
<a href="#l22.106"></a><span id="l22.106">   // RFC 3501 allows UTF-8 in addition to modified UTF-7</span>
<a href="#l22.107"></a><span id="l22.107">   // If it's not UTF-8, it cannot be MUTF7, either. We just ignore it.</span>
<a href="#l22.108"></a><span id="l22.108">   // (otherwise we'll crash. see #63186)</span>
<a href="#l22.109"></a><span id="l22.109" class="difflineminus">-  if (!MsgIsUTF8(aName)) return NS_OK;</span>
<a href="#l22.110"></a><span id="l22.110" class="difflineplus">+  if (!mozilla::IsUtf8(aName)) return NS_OK;</span>
<a href="#l22.111"></a><span id="l22.111"> </span>
<a href="#l22.112"></a><span id="l22.112">   if (!NS_IsAscii(aName.BeginReading(), aName.Length())) {</span>
<a href="#l22.113"></a><span id="l22.113">     nsAutoCString name;</span>
<a href="#l22.114"></a><span id="l22.114">     CopyUTF16toMUTF7(NS_ConvertUTF8toUTF16(aName), name);</span>
<a href="#l22.115"></a><span id="l22.115">     return mInner-&gt;AddTo(name, addAsSubscribed, aSubscribable, changeIfExists);</span>
<a href="#l22.116"></a><span id="l22.116">   }</span>
<a href="#l22.117"></a><span id="l22.117">   return mInner-&gt;AddTo(aName, addAsSubscribed, aSubscribable, changeIfExists);</span>
<a href="#l22.118"></a><span id="l22.118"> }</span>
<a href="#l22.119"></a><span id="l22.119" class="difflineat">@@ -2918,26 +2919,26 @@ nsImapIncomingServer::GetUriWithNamespac</span>
<a href="#l22.120"></a><span id="l22.120">       rv = GetServerDirectory(onlineDir);</span>
<a href="#l22.121"></a><span id="l22.121">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.122"></a><span id="l22.122">       if (!onlineDir.IsEmpty()) {</span>
<a href="#l22.123"></a><span id="l22.123">         char delimiter = ns-&gt;GetDelimiter();</span>
<a href="#l22.124"></a><span id="l22.124">         if (onlineDir.Last() != delimiter) onlineDir += delimiter;</span>
<a href="#l22.125"></a><span id="l22.125">         if (onlineDir.Equals(namespacePrefix)) return NS_OK;</span>
<a href="#l22.126"></a><span id="l22.126">       }</span>
<a href="#l22.127"></a><span id="l22.127"> </span>
<a href="#l22.128"></a><span id="l22.128" class="difflineminus">-      MsgReplaceChar(namespacePrefix, ns-&gt;GetDelimiter(),</span>
<a href="#l22.129"></a><span id="l22.129" class="difflineminus">-                     '/');  // use canonical format</span>
<a href="#l22.130"></a><span id="l22.130" class="difflineplus">+      namespacePrefix.ReplaceChar(ns-&gt;GetDelimiter(),</span>
<a href="#l22.131"></a><span id="l22.131" class="difflineplus">+                                  '/');  // use canonical format</span>
<a href="#l22.132"></a><span id="l22.132">       nsCString uri(originalUri);</span>
<a href="#l22.133"></a><span id="l22.133">       int32_t index = uri.Find(&quot;//&quot;);        // find scheme</span>
<a href="#l22.134"></a><span id="l22.134">       index = uri.FindChar('/', index + 2);  // find '/' after scheme</span>
<a href="#l22.135"></a><span id="l22.135">       // it may be the case that this is the INBOX uri, in which case</span>
<a href="#l22.136"></a><span id="l22.136">       // we don't want to prepend the namespace. In that case, the uri ends with</span>
<a href="#l22.137"></a><span id="l22.137">       // &quot;INBOX&quot;, but the namespace is &quot;INBOX/&quot;, so they don't match.</span>
<a href="#l22.138"></a><span id="l22.138" class="difflineminus">-      if (MsgFind(uri, namespacePrefix, false, index + 1) != index + 1 &amp;&amp;</span>
<a href="#l22.139"></a><span id="l22.139" class="difflineminus">-          !MsgLowerCaseEqualsLiteral(Substring(uri, index + 1), &quot;inbox&quot;))</span>
<a href="#l22.140"></a><span id="l22.140" class="difflineplus">+      if (uri.Find(namespacePrefix, false, index + 1) != index + 1 &amp;&amp;</span>
<a href="#l22.141"></a><span id="l22.141" class="difflineplus">+          !Substring(uri, index + 1).LowerCaseEqualsLiteral(&quot;inbox&quot;))</span>
<a href="#l22.142"></a><span id="l22.142">         uri.Insert(namespacePrefix, index + 1);  // insert namespace prefix</span>
<a href="#l22.143"></a><span id="l22.143">       convertedUri = uri;</span>
<a href="#l22.144"></a><span id="l22.144">     }</span>
<a href="#l22.145"></a><span id="l22.145">   }</span>
<a href="#l22.146"></a><span id="l22.146">   return rv;</span>
<a href="#l22.147"></a><span id="l22.147"> }</span>
<a href="#l22.148"></a><span id="l22.148"> </span>
<a href="#l22.149"></a><span id="l22.149"> NS_IMETHODIMP nsImapIncomingServer::GetTrashFolderName(nsAString &amp;retval) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -1870,17 +1870,17 @@ nsImapMailFolder::GetDBFolderInfoAndDB(n</span>
<a href="#l23.4"></a><span id="l23.4">       nsCString hostname;</span>
<a href="#l23.5"></a><span id="l23.5">       rv = GetHostname(hostname);</span>
<a href="#l23.6"></a><span id="l23.6">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8">       nsCString onlineCName;</span>
<a href="#l23.9"></a><span id="l23.9">       rv = nsImapURI2FullName(kImapRootURI, hostname.get(), uri.get(),</span>
<a href="#l23.10"></a><span id="l23.10">                               getter_Copies(onlineCName));</span>
<a href="#l23.11"></a><span id="l23.11">       if (m_hierarchyDelimiter != '/')</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-        MsgReplaceChar(onlineCName, '/', m_hierarchyDelimiter);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+        onlineCName.ReplaceChar('/', m_hierarchyDelimiter);</span>
<a href="#l23.14"></a><span id="l23.14">       m_onlineFolderName.Assign(onlineCName);</span>
<a href="#l23.15"></a><span id="l23.15">       CopyASCIItoUTF16(onlineCName, autoOnlineName);</span>
<a href="#l23.16"></a><span id="l23.16">     }</span>
<a href="#l23.17"></a><span id="l23.17">     (*folderInfo)-&gt;SetProperty(&quot;onlineName&quot;, autoOnlineName);</span>
<a href="#l23.18"></a><span id="l23.18">   }</span>
<a href="#l23.19"></a><span id="l23.19">   return rv;</span>
<a href="#l23.20"></a><span id="l23.20"> }</span>
<a href="#l23.21"></a><span id="l23.21"> </span>
<a href="#l23.22"></a><span id="l23.22" class="difflineat">@@ -8885,17 +8885,17 @@ NS_IMETHODIMP nsImapMailFolder::GetOffli</span>
<a href="#l23.23"></a><span id="l23.23">           if (labelNames[i].EqualsLiteral(&quot;\&quot;\\\\Spam\&quot;&quot;))</span>
<a href="#l23.24"></a><span id="l23.24">             rv = rootFolder-&gt;GetFolderWithFlags(nsMsgFolderFlags::Junk,</span>
<a href="#l23.25"></a><span id="l23.25">                                                 getter_AddRefs(subMsgFolder));</span>
<a href="#l23.26"></a><span id="l23.26">           if (labelNames[i].EqualsLiteral(&quot;\&quot;\\\\Sent\&quot;&quot;))</span>
<a href="#l23.27"></a><span id="l23.27">             rv = rootFolder-&gt;GetFolderWithFlags(nsMsgFolderFlags::SentMail,</span>
<a href="#l23.28"></a><span id="l23.28">                                                 getter_AddRefs(subMsgFolder));</span>
<a href="#l23.29"></a><span id="l23.29">           if (labelNames[i].Find(&quot;[Imap]/&quot;, /* ignoreCase = */ true) !=</span>
<a href="#l23.30"></a><span id="l23.30">               kNotFound) {</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-            MsgReplaceSubstring(labelNames[i], &quot;[Imap]/&quot;, &quot;&quot;);</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+            labelNames[i].ReplaceSubstring(&quot;[Imap]/&quot;, &quot;&quot;);</span>
<a href="#l23.33"></a><span id="l23.33">             imapRootFolder-&gt;FindOnlineSubFolder(labelNames[i],</span>
<a href="#l23.34"></a><span id="l23.34">                                                 getter_AddRefs(subFolder));</span>
<a href="#l23.35"></a><span id="l23.35">             subMsgFolder = do_QueryInterface(subFolder);</span>
<a href="#l23.36"></a><span id="l23.36">           }</span>
<a href="#l23.37"></a><span id="l23.37">           if (!subMsgFolder) {</span>
<a href="#l23.38"></a><span id="l23.38">             imapRootFolder-&gt;FindOnlineSubFolder(labelNames[i],</span>
<a href="#l23.39"></a><span id="l23.39">                                                 getter_AddRefs(subFolder));</span>
<a href="#l23.40"></a><span id="l23.40">             subMsgFolder = do_QueryInterface(subFolder);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -725,17 +725,17 @@ static void SetSecurityCallbacksFromChan</span>
<a href="#l24.4"></a><span id="l24.4">                                             nsIChannel *aChannel) {</span>
<a href="#l24.5"></a><span id="l24.5">   nsCOMPtr&lt;nsIInterfaceRequestor&gt; callbacks;</span>
<a href="#l24.6"></a><span id="l24.6">   aChannel-&gt;GetNotificationCallbacks(getter_AddRefs(callbacks));</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8">   nsCOMPtr&lt;nsILoadGroup&gt; loadGroup;</span>
<a href="#l24.9"></a><span id="l24.9">   aChannel-&gt;GetLoadGroup(getter_AddRefs(loadGroup));</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11">   nsCOMPtr&lt;nsIInterfaceRequestor&gt; securityCallbacks;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  MsgNewNotificationCallbacksAggregation(callbacks, loadGroup,</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+  NS_NewNotificationCallbacksAggregation(callbacks, loadGroup,</span>
<a href="#l24.14"></a><span id="l24.14">                                          getter_AddRefs(securityCallbacks));</span>
<a href="#l24.15"></a><span id="l24.15">   if (securityCallbacks) aTrans-&gt;SetSecurityCallbacks(securityCallbacks);</span>
<a href="#l24.16"></a><span id="l24.16"> }</span>
<a href="#l24.17"></a><span id="l24.17"> </span>
<a href="#l24.18"></a><span id="l24.18"> // Setup With Url is intended to set up data which is held on a PER URL basis</span>
<a href="#l24.19"></a><span id="l24.19"> // and not a per connection basis. If you have data which is independent of the</span>
<a href="#l24.20"></a><span id="l24.20"> // url we are currently running, then you should put it in Initialize(). This is</span>
<a href="#l24.21"></a><span id="l24.21"> // only ever called from the UI thread. It is called from LoadUrl, right before</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -825,17 +825,17 @@ nsresult nsImapProtocol::SetupWithUrl(ns</span>
<a href="#l24.23"></a><span id="l24.23">         // the messageWindow, with fallback to the docShell (and the</span>
<a href="#l24.24"></a><span id="l24.24">         // loadgroup).</span>
<a href="#l24.25"></a><span id="l24.25">         nsCOMPtr&lt;nsIDocShell&gt; docShell;</span>
<a href="#l24.26"></a><span id="l24.26">         msgWindow-&gt;GetMessageWindowDocShell(getter_AddRefs(docShell));</span>
<a href="#l24.27"></a><span id="l24.27">         nsCOMPtr&lt;nsIInterfaceRequestor&gt; ir(do_QueryInterface(docShell));</span>
<a href="#l24.28"></a><span id="l24.28">         nsCOMPtr&lt;nsIInterfaceRequestor&gt; interfaceRequestor;</span>
<a href="#l24.29"></a><span id="l24.29">         msgWindow-&gt;GetNotificationCallbacks(getter_AddRefs(interfaceRequestor));</span>
<a href="#l24.30"></a><span id="l24.30">         nsCOMPtr&lt;nsIInterfaceRequestor&gt; aggregateIR;</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-        MsgNewInterfaceRequestorAggregation(interfaceRequestor, ir,</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+        NS_NewInterfaceRequestorAggregation(interfaceRequestor, ir,</span>
<a href="#l24.33"></a><span id="l24.33">                                             getter_AddRefs(aggregateIR));</span>
<a href="#l24.34"></a><span id="l24.34">         m_mockChannel-&gt;SetNotificationCallbacks(aggregateIR);</span>
<a href="#l24.35"></a><span id="l24.35">       }</span>
<a href="#l24.36"></a><span id="l24.36">     }</span>
<a href="#l24.37"></a><span id="l24.37"> </span>
<a href="#l24.38"></a><span id="l24.38">     // since we'll be making calls directly from the imap thread to the channel</span>
<a href="#l24.39"></a><span id="l24.39">     // listener, we need to turn it into a proxy object....we'll assume that the</span>
<a href="#l24.40"></a><span id="l24.40">     // listener is on the same thread as the event sink queue</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineat">@@ -4478,17 +4478,17 @@ void nsImapProtocol::Log(const char *log</span>
<a href="#l24.42"></a><span id="l24.42">     int32_t lastLineEnd;</span>
<a href="#l24.43"></a><span id="l24.43"> </span>
<a href="#l24.44"></a><span id="l24.44">     // nspr line length is 512, and we allow some space for the log preamble.</span>
<a href="#l24.45"></a><span id="l24.45">     const int kLogDataChunkSize = 400;</span>
<a href="#l24.46"></a><span id="l24.46"> </span>
<a href="#l24.47"></a><span id="l24.47">     // break up buffers &gt; 400 bytes on line boundaries.</span>
<a href="#l24.48"></a><span id="l24.48">     if (logDataLen &gt; kLogDataChunkSize) {</span>
<a href="#l24.49"></a><span id="l24.49">       logDataLines.Assign(logData);</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-      lastLineEnd = MsgRFindChar(logDataLines, '\n', kLogDataChunkSize);</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+      lastLineEnd = logDataLines.RFindChar('\n', kLogDataChunkSize);</span>
<a href="#l24.52"></a><span id="l24.52">       // null terminate the last line</span>
<a href="#l24.53"></a><span id="l24.53">       if (lastLineEnd == kNotFound) lastLineEnd = kLogDataChunkSize - 1;</span>
<a href="#l24.54"></a><span id="l24.54"> </span>
<a href="#l24.55"></a><span id="l24.55">       logDataLines.Insert('\0', lastLineEnd + 1);</span>
<a href="#l24.56"></a><span id="l24.56">       logDataToLog = logDataLines.get();</span>
<a href="#l24.57"></a><span id="l24.57">     } else {</span>
<a href="#l24.58"></a><span id="l24.58">       logDataToLog = logData;</span>
<a href="#l24.59"></a><span id="l24.59">       lastLineEnd = logDataLen;</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineat">@@ -4527,17 +4527,17 @@ void nsImapProtocol::Log(const char *log</span>
<a href="#l24.61"></a><span id="l24.61"> </span>
<a href="#l24.62"></a><span id="l24.62">     // dump the rest of the string in &lt; 400 byte chunks</span>
<a href="#l24.63"></a><span id="l24.63">     while (logDataLen &gt; kLogDataChunkSize) {</span>
<a href="#l24.64"></a><span id="l24.64">       logDataLines.Cut(</span>
<a href="#l24.65"></a><span id="l24.65">           0,</span>
<a href="#l24.66"></a><span id="l24.66">           lastLineEnd + 2);  // + 2 to account for the LF and the '\0' we added</span>
<a href="#l24.67"></a><span id="l24.67">       logDataLen = logDataLines.Length();</span>
<a href="#l24.68"></a><span id="l24.68">       lastLineEnd = (logDataLen &gt; kLogDataChunkSize)</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineminus">-                        ? MsgRFindChar(logDataLines, '\n', kLogDataChunkSize)</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineplus">+                        ? logDataLines.RFindChar('\n', kLogDataChunkSize)</span>
<a href="#l24.71"></a><span id="l24.71">                         : kNotFound;</span>
<a href="#l24.72"></a><span id="l24.72">       // null terminate the last line</span>
<a href="#l24.73"></a><span id="l24.73">       if (lastLineEnd == kNotFound) lastLineEnd = kLogDataChunkSize - 1;</span>
<a href="#l24.74"></a><span id="l24.74">       logDataLines.Insert('\0', lastLineEnd + 1);</span>
<a href="#l24.75"></a><span id="l24.75">       logDataToLog = logDataLines.get();</span>
<a href="#l24.76"></a><span id="l24.76">       MOZ_LOG(IMAP, LogLevel::Info, (&quot;%.400s&quot;, logDataToLog));</span>
<a href="#l24.77"></a><span id="l24.77">     }</span>
<a href="#l24.78"></a><span id="l24.78">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -265,17 +265,17 @@ NS_IMETHODIMP nsImapService::OpenAttachm</span>
<a href="#l25.4"></a><span id="l25.4">     const char *aMessageUri, nsISupports *aDisplayConsumer,</span>
<a href="#l25.5"></a><span id="l25.5">     nsIMsgWindow *aMsgWindow, nsIUrlListener *aUrlListener) {</span>
<a href="#l25.6"></a><span id="l25.6">   // okay this is a little tricky....we may have to fetch the mime part</span>
<a href="#l25.7"></a><span id="l25.7">   // or it may already be downloaded for us....the only way i can tell to</span>
<a href="#l25.8"></a><span id="l25.8">   // distinguish the two events is to search for ?section or ?part</span>
<a href="#l25.9"></a><span id="l25.9"> </span>
<a href="#l25.10"></a><span id="l25.10">   nsAutoCString uri(aMessageUri);</span>
<a href="#l25.11"></a><span id="l25.11">   nsAutoCString urlString(aUrl);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  MsgReplaceSubstring(urlString, &quot;/;section&quot;, &quot;?section&quot;);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  urlString.ReplaceSubstring(&quot;/;section&quot;, &quot;?section&quot;);</span>
<a href="#l25.14"></a><span id="l25.14"> </span>
<a href="#l25.15"></a><span id="l25.15">   // more stuff i don't understand</span>
<a href="#l25.16"></a><span id="l25.16">   int32_t sectionPos = urlString.Find(&quot;?section&quot;);</span>
<a href="#l25.17"></a><span id="l25.17">   // if we have a section field then we must be dealing with a mime part we need</span>
<a href="#l25.18"></a><span id="l25.18">   // to fetchf</span>
<a href="#l25.19"></a><span id="l25.19">   if (sectionPos &gt; 0) {</span>
<a href="#l25.20"></a><span id="l25.20">     uri.Append(Substring(urlString, sectionPos));</span>
<a href="#l25.21"></a><span id="l25.21">     uri += &quot;&amp;type=&quot;;</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -481,18 +481,18 @@ NS_IMETHODIMP nsImapService::DisplayMess</span>
<a href="#l25.23"></a><span id="l25.23">         if (NS_SUCCEEDED(rv) &amp;&amp; aImapServer)</span>
<a href="#l25.24"></a><span id="l25.24">           aImapServer-&gt;GetMimePartsOnDemand(&amp;useMimePartsOnDemand);</span>
<a href="#l25.25"></a><span id="l25.25">       }</span>
<a href="#l25.26"></a><span id="l25.26"> </span>
<a href="#l25.27"></a><span id="l25.27">       nsAutoCString uriStr(aMessageURI);</span>
<a href="#l25.28"></a><span id="l25.28">       int32_t keySeparator = uriStr.RFindChar('#');</span>
<a href="#l25.29"></a><span id="l25.29">       if (keySeparator != -1) {</span>
<a href="#l25.30"></a><span id="l25.30">         int32_t keyEndSeparator = MsgFindCharInSet(uriStr, &quot;/?&amp;&quot;, keySeparator);</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-        int32_t mpodFetchPos = MsgFind(uriStr, &quot;fetchCompleteMessage=true&quot;,</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">-                                       false, keyEndSeparator);</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+        int32_t mpodFetchPos =</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+            uriStr.Find(&quot;fetchCompleteMessage=true&quot;, false, keyEndSeparator);</span>
<a href="#l25.35"></a><span id="l25.35">         if (mpodFetchPos != -1) useMimePartsOnDemand = false;</span>
<a href="#l25.36"></a><span id="l25.36">       }</span>
<a href="#l25.37"></a><span id="l25.37"> </span>
<a href="#l25.38"></a><span id="l25.38">       if (folder) {</span>
<a href="#l25.39"></a><span id="l25.39">         folder-&gt;ShouldStoreMsgOffline(key, &amp;shouldStoreMsgOffline);</span>
<a href="#l25.40"></a><span id="l25.40">         folder-&gt;HasMsgOffline(key, &amp;hasMsgOffline);</span>
<a href="#l25.41"></a><span id="l25.41">       }</span>
<a href="#l25.42"></a><span id="l25.42">       imapUrl-&gt;SetStoreResultsOffline(shouldStoreMsgOffline);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/imap/src/nsImapUndoTxn.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapUndoTxn.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -43,17 +43,17 @@ nsresult nsImapMoveCopyMsgTxn::Init(nsIM</span>
<a href="#l26.4"></a><span id="l26.4">   nsCOMPtr&lt;nsIMsgDBHdr&gt; srcHdr;</span>
<a href="#l26.5"></a><span id="l26.5">   nsCOMPtr&lt;nsIMsgDBHdr&gt; copySrcHdr;</span>
<a href="#l26.6"></a><span id="l26.6">   nsCString messageId;</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8">   for (i = 0; i &lt; count; i++) {</span>
<a href="#l26.9"></a><span id="l26.9">     rv = srcDB-&gt;GetMsgHdrForKey(m_srcKeyArray[i], getter_AddRefs(srcHdr));</span>
<a href="#l26.10"></a><span id="l26.10">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l26.11"></a><span id="l26.11">       // ** jt -- only do this for mailbox protocol</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-      if (MsgLowerCaseEqualsLiteral(protocolType, &quot;mailbox&quot;)) {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+      if (protocolType.LowerCaseEqualsLiteral(&quot;mailbox&quot;)) {</span>
<a href="#l26.14"></a><span id="l26.14">         m_srcIsPop3 = true;</span>
<a href="#l26.15"></a><span id="l26.15">         uint32_t msgSize;</span>
<a href="#l26.16"></a><span id="l26.16">         rv = srcHdr-&gt;GetMessageSize(&amp;msgSize);</span>
<a href="#l26.17"></a><span id="l26.17">         if (NS_SUCCEEDED(rv)) m_srcSizeArray.AppendElement(msgSize);</span>
<a href="#l26.18"></a><span id="l26.18">         if (isMove) {</span>
<a href="#l26.19"></a><span id="l26.19">           rv = srcDB-&gt;CopyHdrFromExistingHdr(nsMsgKey_None, srcHdr, false,</span>
<a href="#l26.20"></a><span id="l26.20">                                              getter_AddRefs(copySrcHdr));</span>
<a href="#l26.21"></a><span id="l26.21">           nsMsgKey pseudoKey = nsMsgKey_None;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/imap/src/nsImapUrl.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapUrl.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -622,17 +622,17 @@ NS_IMETHODIMP nsImapUrl::AddOnlineDirect</span>
<a href="#l27.4"></a><span id="l27.4">     if (PL_strcasecmp(onlineMailboxName, &quot;INBOX&quot;)) {</span>
<a href="#l27.5"></a><span id="l27.5">       NS_ASSERTION(ns, &quot;couldn't find namespace for host&quot;);</span>
<a href="#l27.6"></a><span id="l27.6">       nsAutoCString onlineDirWithDelimiter(onlineDir);</span>
<a href="#l27.7"></a><span id="l27.7">       // make sure the onlineDir ends with the hierarchy delimiter</span>
<a href="#l27.8"></a><span id="l27.8">       if (ns) {</span>
<a href="#l27.9"></a><span id="l27.9">         char delimiter = ns-&gt;GetDelimiter();</span>
<a href="#l27.10"></a><span id="l27.10">         if (delimiter &amp;&amp; delimiter != kOnlineHierarchySeparatorUnknown) {</span>
<a href="#l27.11"></a><span id="l27.11">           // try to change the canonical online dir name to real dir name first</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-          MsgReplaceChar(onlineDirWithDelimiter, '/', delimiter);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+          onlineDirWithDelimiter.ReplaceChar('/', delimiter);</span>
<a href="#l27.14"></a><span id="l27.14">           // make sure the last character is the delimiter</span>
<a href="#l27.15"></a><span id="l27.15">           if (onlineDirWithDelimiter.Last() != delimiter)</span>
<a href="#l27.16"></a><span id="l27.16">             onlineDirWithDelimiter += delimiter;</span>
<a href="#l27.17"></a><span id="l27.17">           if (!*onlineMailboxName)</span>
<a href="#l27.18"></a><span id="l27.18">             onlineDirWithDelimiter.SetLength(onlineDirWithDelimiter.Length() -</span>
<a href="#l27.19"></a><span id="l27.19">                                              1);</span>
<a href="#l27.20"></a><span id="l27.20">         }</span>
<a href="#l27.21"></a><span id="l27.21">       }</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineat">@@ -812,17 +812,17 @@ NS_IMETHODIMP nsImapUrl::AllocateCanonic</span>
<a href="#l27.23"></a><span id="l27.23">   // subdirectory</span>
<a href="#l27.24"></a><span id="l27.24">   // If this host has an online server directory configured</span>
<a href="#l27.25"></a><span id="l27.25">   LossyCopyUTF16toASCII(aString, onlineDir);</span>
<a href="#l27.26"></a><span id="l27.26"> </span>
<a href="#l27.27"></a><span id="l27.27">   if (currentPath &amp;&amp; !onlineDir.IsEmpty()) {</span>
<a href="#l27.28"></a><span id="l27.28">     // By definition, the online dir must be at the root.</span>
<a href="#l27.29"></a><span id="l27.29">     if (delimiterToUse &amp;&amp; delimiterToUse != kOnlineHierarchySeparatorUnknown) {</span>
<a href="#l27.30"></a><span id="l27.30">       // try to change the canonical online dir name to real dir name first</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-      MsgReplaceChar(onlineDir, '/', delimiterToUse);</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+      onlineDir.ReplaceChar('/', delimiterToUse);</span>
<a href="#l27.33"></a><span id="l27.33">       // Add the delimiter</span>
<a href="#l27.34"></a><span id="l27.34">       if (onlineDir.Last() != delimiterToUse) onlineDir += delimiterToUse;</span>
<a href="#l27.35"></a><span id="l27.35">     }</span>
<a href="#l27.36"></a><span id="l27.36">     int len = onlineDir.Length();</span>
<a href="#l27.37"></a><span id="l27.37">     if (!PL_strncmp(onlineDir.get(), currentPath, len)) {</span>
<a href="#l27.38"></a><span id="l27.38">       // This online path begins with the server sub directory</span>
<a href="#l27.39"></a><span id="l27.39">       currentPath += len;</span>
<a href="#l27.40"></a><span id="l27.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/imap/src/nsImapUtils.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapUtils.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -44,17 +44,17 @@ nsresult nsParseImapMessageURI(const cha</span>
<a href="#l28.4"></a><span id="l28.4">   int32_t folderEnd = -1;</span>
<a href="#l28.5"></a><span id="l28.5">   // imap-message uri's can have imap:// url strings tacked on the end,</span>
<a href="#l28.6"></a><span id="l28.6">   // e.g., when opening/saving attachments. We don't want to look for '#'</span>
<a href="#l28.7"></a><span id="l28.7">   // in that part of the uri, if the attachment name contains '#',</span>
<a href="#l28.8"></a><span id="l28.8">   // so check for that here.</span>
<a href="#l28.9"></a><span id="l28.9">   if (StringBeginsWith(uriStr, NS_LITERAL_CSTRING(&quot;imap-message&quot;)))</span>
<a href="#l28.10"></a><span id="l28.10">     folderEnd = uriStr.Find(&quot;imap://&quot;);</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  int32_t keySeparator = MsgRFindChar(uriStr, '#', folderEnd);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  int32_t keySeparator = uriStr.RFindChar('#', folderEnd);</span>
<a href="#l28.14"></a><span id="l28.14">   if (keySeparator != -1) {</span>
<a href="#l28.15"></a><span id="l28.15">     int32_t keyEndSeparator = MsgFindCharInSet(uriStr, &quot;/?&amp;&quot;, keySeparator);</span>
<a href="#l28.16"></a><span id="l28.16">     nsAutoString folderPath;</span>
<a href="#l28.17"></a><span id="l28.17">     folderURI = StringHead(uriStr, keySeparator);</span>
<a href="#l28.18"></a><span id="l28.18">     folderURI.Cut(4, 8);  // cut out the _message part of imap-message:</span>
<a href="#l28.19"></a><span id="l28.19">     // folder uri's don't have fully escaped usernames.</span>
<a href="#l28.20"></a><span id="l28.20">     int32_t atPos = folderURI.FindChar('@');</span>
<a href="#l28.21"></a><span id="l28.21">     if (atPos != -1) {</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -75,17 +75,17 @@ nsresult nsParseImapMessageURI(const cha</span>
<a href="#l28.23"></a><span id="l28.23">       keyStr = Substring(uriStr, keySeparator + 1,</span>
<a href="#l28.24"></a><span id="l28.24">                          keyEndSeparator - (keySeparator + 1));</span>
<a href="#l28.25"></a><span id="l28.25">     else</span>
<a href="#l28.26"></a><span id="l28.26">       keyStr = Substring(uriStr, keySeparator + 1);</span>
<a href="#l28.27"></a><span id="l28.27"> </span>
<a href="#l28.28"></a><span id="l28.28">     *key = strtoul(keyStr.get(), nullptr, 10);</span>
<a href="#l28.29"></a><span id="l28.29"> </span>
<a href="#l28.30"></a><span id="l28.30">     if (part &amp;&amp; keyEndSeparator != -1) {</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-      int32_t partPos = MsgFind(uriStr, &quot;part=&quot;, false, keyEndSeparator);</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+      int32_t partPos = uriStr.Find(&quot;part=&quot;, false, keyEndSeparator);</span>
<a href="#l28.33"></a><span id="l28.33">       if (partPos != -1) {</span>
<a href="#l28.34"></a><span id="l28.34">         *part = ToNewCString(Substring(uriStr, keyEndSeparator));</span>
<a href="#l28.35"></a><span id="l28.35">       }</span>
<a href="#l28.36"></a><span id="l28.36">     }</span>
<a href="#l28.37"></a><span id="l28.37">   }</span>
<a href="#l28.38"></a><span id="l28.38">   return NS_OK;</span>
<a href="#l28.39"></a><span id="l28.39"> }</span>
<a href="#l28.40"></a><span id="l28.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiApi.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiApi.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -1437,18 +1437,18 @@ void CMapiApi::ListPropertyValue(LPSProp</span>
<a href="#l29.4"></a><span id="l29.4">   s += &quot;value: &quot;;</span>
<a href="#l29.5"></a><span id="l29.5">   switch (PROP_TYPE(pVal-&gt;ulPropTag)) {</span>
<a href="#l29.6"></a><span id="l29.6">     case PT_STRING8:</span>
<a href="#l29.7"></a><span id="l29.7">       GetStringFromProp(pVal, strVal, FALSE);</span>
<a href="#l29.8"></a><span id="l29.8">       if (strVal.Length() &gt; 60) {</span>
<a href="#l29.9"></a><span id="l29.9">         strVal.SetLength(60);</span>
<a href="#l29.10"></a><span id="l29.10">         strVal += &quot;...&quot;;</span>
<a href="#l29.11"></a><span id="l29.11">       }</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-      MsgReplaceSubstring(strVal, &quot;\r&quot;, &quot;\\r&quot;);</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-      MsgReplaceSubstring(strVal, &quot;\n&quot;, &quot;\\n&quot;);</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+      strVal.ReplaceSubstring(&quot;\r&quot;, &quot;\\r&quot;);</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+      strVal.ReplaceSubstring(&quot;\n&quot;, &quot;\\n&quot;);</span>
<a href="#l29.16"></a><span id="l29.16">       s += strVal;</span>
<a href="#l29.17"></a><span id="l29.17">       break;</span>
<a href="#l29.18"></a><span id="l29.18">     case PT_LONG:</span>
<a href="#l29.19"></a><span id="l29.19">       s.AppendInt((int32_t)pVal-&gt;Value.l);</span>
<a href="#l29.20"></a><span id="l29.20">       s += &quot;, 0x&quot;;</span>
<a href="#l29.21"></a><span id="l29.21">       s.AppendInt((int32_t)pVal-&gt;Value.l, 16);</span>
<a href="#l29.22"></a><span id="l29.22">       s += nBuff;</span>
<a href="#l29.23"></a><span id="l29.23">       break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookMail.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookMail.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -680,18 +680,18 @@ nsresult nsOutlookMail::CreateList(const</span>
<a href="#l30.4"></a><span id="l30.4">   m_mapi.MAPIFreeBuffer(value);</span>
<a href="#l30.5"></a><span id="l30.5"> </span>
<a href="#l30.6"></a><span id="l30.6">   nsIAbDirectory *outList;</span>
<a href="#l30.7"></a><span id="l30.7">   rv = pDirectory-&gt;AddMailList(newList, &amp;outList);</span>
<a href="#l30.8"></a><span id="l30.8">   return rv;</span>
<a href="#l30.9"></a><span id="l30.9"> }</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11"> void nsOutlookMail::SanitizeValue(nsString &amp;val) {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  MsgReplaceSubstring(val, NS_LITERAL_STRING(&quot;\r\n&quot;), NS_LITERAL_STRING(&quot;, &quot;));</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-  MsgReplaceChar(val, &quot;\r\n&quot;, ',');</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+  val.ReplaceSubstring(NS_LITERAL_STRING(&quot;\r\n&quot;), NS_LITERAL_STRING(&quot;, &quot;));</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+  val.ReplaceChar(&quot;\r\n&quot;, ',');</span>
<a href="#l30.16"></a><span id="l30.16"> }</span>
<a href="#l30.17"></a><span id="l30.17"> </span>
<a href="#l30.18"></a><span id="l30.18"> void nsOutlookMail::SplitString(nsString &amp;val1, nsString &amp;val2) {</span>
<a href="#l30.19"></a><span id="l30.19">   // Find the last line if there is more than one!</span>
<a href="#l30.20"></a><span id="l30.20">   int32_t idx = val1.RFind(&quot;\x0D\x0A&quot;);</span>
<a href="#l30.21"></a><span id="l30.21">   int32_t cnt = 2;</span>
<a href="#l30.22"></a><span id="l30.22">   if (idx == -1) {</span>
<a href="#l30.23"></a><span id="l30.23">     cnt = 1;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextAddress.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextAddress.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -149,17 +149,17 @@ nsresult nsTextAddress::ReadRecord(nsIUn</span>
<a href="#l31.4"></a><span id="l31.4">       rv = NS_ERROR_FAILURE;</span>
<a href="#l31.5"></a><span id="l31.5">     } else {</span>
<a href="#l31.6"></a><span id="l31.6">       // Read the line and append it</span>
<a href="#l31.7"></a><span id="l31.7">       rv = aLineStream-&gt;ReadLine(line, &amp;more);</span>
<a href="#l31.8"></a><span id="l31.8">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l31.9"></a><span id="l31.9">         if (!aLine.IsEmpty()) aLine.AppendLiteral(MSG_LINEBREAK);</span>
<a href="#l31.10"></a><span id="l31.10">         aLine.Append(line);</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-        numQuotes += MsgCountChar(line, char16_t('&quot;'));</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+        numQuotes += line.CountChar(char16_t('&quot;'));</span>
<a href="#l31.14"></a><span id="l31.14">       }</span>
<a href="#l31.15"></a><span id="l31.15">     }</span>
<a href="#l31.16"></a><span id="l31.16">     // Continue whilst everything is ok, and we have an odd number of quotes.</span>
<a href="#l31.17"></a><span id="l31.17">   } while (NS_SUCCEEDED(rv) &amp;&amp; (numQuotes % 2 != 0));</span>
<a href="#l31.18"></a><span id="l31.18"> </span>
<a href="#l31.19"></a><span id="l31.19">   *aMore = more;</span>
<a href="#l31.20"></a><span id="l31.20">   return rv;</span>
<a href="#l31.21"></a><span id="l31.21"> }</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineat">@@ -317,17 +317,17 @@ bool nsTextAddress::GetField(const nsASt</span>
<a href="#l31.23"></a><span id="l31.23"> </span>
<a href="#l31.24"></a><span id="l31.24">   field.Append(nsDependentSubstring(aLine, startPos, fLen));</span>
<a href="#l31.25"></a><span id="l31.25">   field.Trim(kWhitespace);</span>
<a href="#l31.26"></a><span id="l31.26"> </span>
<a href="#l31.27"></a><span id="l31.27">   if (quoted) {</span>
<a href="#l31.28"></a><span id="l31.28">     int32_t offset = field.Find(&quot;\&quot;\&quot;&quot;);</span>
<a href="#l31.29"></a><span id="l31.29">     while (offset != -1) {</span>
<a href="#l31.30"></a><span id="l31.30">       field.Cut(offset, 1);</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-      offset = MsgFind(field, &quot;\&quot;\&quot;&quot;, false, offset + 1);</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineplus">+      offset = field.Find(&quot;\&quot;\&quot;&quot;, false, offset + 1);</span>
<a href="#l31.33"></a><span id="l31.33">     }</span>
<a href="#l31.34"></a><span id="l31.34">   }</span>
<a href="#l31.35"></a><span id="l31.35"> </span>
<a href="#l31.36"></a><span id="l31.36">   return result;</span>
<a href="#l31.37"></a><span id="l31.37"> }</span>
<a href="#l31.38"></a><span id="l31.38"> </span>
<a href="#l31.39"></a><span id="l31.39"> nsresult nsTextAddress::DetermineDelim(nsIFile *aSrc) {</span>
<a href="#l31.40"></a><span id="l31.40">   nsCOMPtr&lt;nsIInputStream&gt; inputStream;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -1318,18 +1318,18 @@ nsMsgLocalMailFolder::CopyMessages(nsIMs</span>
<a href="#l32.4"></a><span id="l32.4">   UpdateTimestamps(allowUndo);</span>
<a href="#l32.5"></a><span id="l32.5">   nsCString protocolType;</span>
<a href="#l32.6"></a><span id="l32.6">   rv = srcFolder-&gt;GetURI(protocolType);</span>
<a href="#l32.7"></a><span id="l32.7">   protocolType.SetLength(protocolType.FindChar(':'));</span>
<a href="#l32.8"></a><span id="l32.8"> </span>
<a href="#l32.9"></a><span id="l32.9">   // If we're offline and the source folder is imap or news, to do the</span>
<a href="#l32.10"></a><span id="l32.10">   // copy the message bodies MUST reside in offline storage.</span>
<a href="#l32.11"></a><span id="l32.11">   bool needOfflineBodies =</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-      (WeAreOffline() &amp;&amp; (MsgLowerCaseEqualsLiteral(protocolType, &quot;imap&quot;) ||</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-                          MsgLowerCaseEqualsLiteral(protocolType, &quot;news&quot;)));</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+      (WeAreOffline() &amp;&amp; (protocolType.LowerCaseEqualsLiteral(&quot;imap&quot;) ||</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+                          protocolType.LowerCaseEqualsLiteral(&quot;news&quot;)));</span>
<a href="#l32.16"></a><span id="l32.16">   int64_t totalMsgSize = 0;</span>
<a href="#l32.17"></a><span id="l32.17">   uint32_t numMessages = 0;</span>
<a href="#l32.18"></a><span id="l32.18">   bool allMsgsHaveOfflineStore = true;</span>
<a href="#l32.19"></a><span id="l32.19">   messages-&gt;GetLength(&amp;numMessages);</span>
<a href="#l32.20"></a><span id="l32.20">   for (uint32_t i = 0; i &lt; numMessages; i++) {</span>
<a href="#l32.21"></a><span id="l32.21">     nsCOMPtr&lt;nsIMsgDBHdr&gt; message(do_QueryElementAt(messages, i, &amp;rv));</span>
<a href="#l32.22"></a><span id="l32.22">     if (NS_SUCCEEDED(rv) &amp;&amp; message) {</span>
<a href="#l32.23"></a><span id="l32.23">       nsMsgKey key;</span>
<a href="#l32.24"></a><span id="l32.24" class="difflineat">@@ -1438,17 +1438,17 @@ nsMsgLocalMailFolder::CopyMessages(nsIMs</span>
<a href="#l32.25"></a><span id="l32.25">                        isFolder, allowUndo);</span>
<a href="#l32.26"></a><span id="l32.26"> </span>
<a href="#l32.27"></a><span id="l32.27">   if (NS_FAILED(rv)) {</span>
<a href="#l32.28"></a><span id="l32.28">     ThrowAlertMsg(&quot;operationFailedFolderBusy&quot;, msgWindow);</span>
<a href="#l32.29"></a><span id="l32.29">     (void)OnCopyCompleted(srcSupport, false);</span>
<a href="#l32.30"></a><span id="l32.30">     return rv;</span>
<a href="#l32.31"></a><span id="l32.31">   }</span>
<a href="#l32.32"></a><span id="l32.32"> </span>
<a href="#l32.33"></a><span id="l32.33" class="difflineminus">-  if (!MsgLowerCaseEqualsLiteral(protocolType, &quot;mailbox&quot;)) {</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineplus">+  if (!protocolType.LowerCaseEqualsLiteral(&quot;mailbox&quot;)) {</span>
<a href="#l32.35"></a><span id="l32.35">     mCopyState-&gt;m_dummyEnvelopeNeeded = true;</span>
<a href="#l32.36"></a><span id="l32.36">     nsParseMailMessageState *parseMsgState = new nsParseMailMessageState();</span>
<a href="#l32.37"></a><span id="l32.37">     if (parseMsgState) {</span>
<a href="#l32.38"></a><span id="l32.38">       nsCOMPtr&lt;nsIMsgDatabase&gt; msgDb;</span>
<a href="#l32.39"></a><span id="l32.39">       mCopyState-&gt;m_parseMsgState = parseMsgState;</span>
<a href="#l32.40"></a><span id="l32.40">       GetDatabaseWOReparse(getter_AddRefs(msgDb));</span>
<a href="#l32.41"></a><span id="l32.41">       if (msgDb) parseMsgState-&gt;SetMailDB(msgDb);</span>
<a href="#l32.42"></a><span id="l32.42">     }</span>
<a href="#l32.43"></a><span id="l32.43" class="difflineat">@@ -1467,19 +1467,19 @@ nsMsgLocalMailFolder::CopyMessages(nsIMs</span>
<a href="#l32.44"></a><span id="l32.44">         else</span>
<a href="#l32.45"></a><span id="l32.45">           msgTxn-&gt;SetTransactionType(nsIMessenger::eMoveMsg);</span>
<a href="#l32.46"></a><span id="l32.46">       } else</span>
<a href="#l32.47"></a><span id="l32.47">         msgTxn-&gt;SetTransactionType(nsIMessenger::eCopyMsg);</span>
<a href="#l32.48"></a><span id="l32.48">       msgTxn.swap(mCopyState-&gt;m_undoMsgTxn);</span>
<a href="#l32.49"></a><span id="l32.49">     }</span>
<a href="#l32.50"></a><span id="l32.50">   }</span>
<a href="#l32.51"></a><span id="l32.51"> </span>
<a href="#l32.52"></a><span id="l32.52" class="difflineminus">-  if (numMsgs &gt; 1 &amp;&amp; ((MsgLowerCaseEqualsLiteral(protocolType, &quot;imap&quot;) &amp;&amp;</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineplus">+  if (numMsgs &gt; 1 &amp;&amp; ((protocolType.LowerCaseEqualsLiteral(&quot;imap&quot;) &amp;&amp;</span>
<a href="#l32.54"></a><span id="l32.54">                        !allMsgsHaveOfflineStore) ||</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineminus">-                      MsgLowerCaseEqualsLiteral(protocolType, &quot;mailbox&quot;))) {</span>
<a href="#l32.56"></a><span id="l32.56" class="difflineplus">+                      protocolType.LowerCaseEqualsLiteral(&quot;mailbox&quot;))) {</span>
<a href="#l32.57"></a><span id="l32.57">     // For an imap source folder with more than one message to be copied that</span>
<a href="#l32.58"></a><span id="l32.58">     // are not all in offline storage, this fetches all the messages from the</span>
<a href="#l32.59"></a><span id="l32.59">     // imap server to do the copy. When source folder is &quot;mailbox&quot;, this is not</span>
<a href="#l32.60"></a><span id="l32.60">     // a concern since source messages are in local storage.</span>
<a href="#l32.61"></a><span id="l32.61">     mCopyState-&gt;m_copyingMultipleMessages = true;</span>
<a href="#l32.62"></a><span id="l32.62">     rv = CopyMessagesTo(mCopyState-&gt;m_messages, keyArray, msgWindow, this,</span>
<a href="#l32.63"></a><span id="l32.63">                         isMove);</span>
<a href="#l32.64"></a><span id="l32.64">     if (NS_FAILED(rv)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/local/src/nsLocalUndoTxn.cpp</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalUndoTxn.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -37,17 +37,17 @@ nsresult nsLocalMoveCopyMsgTxn::Init(nsI</span>
<a href="#l33.4"></a><span id="l33.4">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.5"></a><span id="l33.5">   m_isMove = isMove;</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7">   mUndoFolderListener = nullptr;</span>
<a href="#l33.8"></a><span id="l33.8"> </span>
<a href="#l33.9"></a><span id="l33.9">   nsCString protocolType;</span>
<a href="#l33.10"></a><span id="l33.10">   rv = srcFolder-&gt;GetURI(protocolType);</span>
<a href="#l33.11"></a><span id="l33.11">   protocolType.SetLength(protocolType.FindChar(':'));</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  if (MsgLowerCaseEqualsLiteral(protocolType, &quot;imap&quot;)) m_srcIsImap4 = true;</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+  if (protocolType.LowerCaseEqualsLiteral(&quot;imap&quot;)) m_srcIsImap4 = true;</span>
<a href="#l33.14"></a><span id="l33.14">   return nsMsgTxn::Init();</span>
<a href="#l33.15"></a><span id="l33.15"> }</span>
<a href="#l33.16"></a><span id="l33.16"> nsresult nsLocalMoveCopyMsgTxn::GetSrcIsImap(bool *isImap) {</span>
<a href="#l33.17"></a><span id="l33.17">   *isImap = m_srcIsImap4;</span>
<a href="#l33.18"></a><span id="l33.18">   return NS_OK;</span>
<a href="#l33.19"></a><span id="l33.19"> }</span>
<a href="#l33.20"></a><span id="l33.20"> nsresult nsLocalMoveCopyMsgTxn::SetSrcFolder(nsIMsgFolder *srcFolder) {</span>
<a href="#l33.21"></a><span id="l33.21">   nsresult rv = NS_ERROR_NULL_POINTER;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/local/src/nsLocalUtils.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalUtils.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -219,11 +219,11 @@ nsresult nsCreateLocalBaseMessageURI(con</span>
<a href="#l34.4"></a><span id="l34.4">   baseMessageURI += tailURI;</span>
<a href="#l34.5"></a><span id="l34.5"> </span>
<a href="#l34.6"></a><span id="l34.6">   return NS_OK;</span>
<a href="#l34.7"></a><span id="l34.7"> }</span>
<a href="#l34.8"></a><span id="l34.8"> </span>
<a href="#l34.9"></a><span id="l34.9"> void nsEscapeNativePath(nsCString&amp; nativePath) {</span>
<a href="#l34.10"></a><span id="l34.10"> #if defined(XP_WIN)</span>
<a href="#l34.11"></a><span id="l34.11">   nativePath.Insert('/', 0);</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-  MsgReplaceChar(nativePath, '\\', '/');</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+  nativePath.ReplaceChar('\\', '/');</span>
<a href="#l34.14"></a><span id="l34.14"> #endif</span>
<a href="#l34.15"></a><span id="l34.15"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -497,17 +497,17 @@ nsresult nsPop3Protocol::InitializeInter</span>
<a href="#l35.4"></a><span id="l35.4">     if (msgwin) {</span>
<a href="#l35.5"></a><span id="l35.5">       nsCOMPtr&lt;nsIDocShell&gt; docshell;</span>
<a href="#l35.6"></a><span id="l35.6">       msgwin-&gt;GetRootDocShell(getter_AddRefs(docshell));</span>
<a href="#l35.7"></a><span id="l35.7">       ir = do_QueryInterface(docshell);</span>
<a href="#l35.8"></a><span id="l35.8">       nsCOMPtr&lt;nsIInterfaceRequestor&gt; notificationCallbacks;</span>
<a href="#l35.9"></a><span id="l35.9">       msgwin-&gt;GetNotificationCallbacks(getter_AddRefs(notificationCallbacks));</span>
<a href="#l35.10"></a><span id="l35.10">       if (notificationCallbacks) {</span>
<a href="#l35.11"></a><span id="l35.11">         nsCOMPtr&lt;nsIInterfaceRequestor&gt; aggregrateIR;</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-        MsgNewInterfaceRequestorAggregation(notificationCallbacks, ir,</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+        NS_NewInterfaceRequestorAggregation(notificationCallbacks, ir,</span>
<a href="#l35.14"></a><span id="l35.14">                                             getter_AddRefs(aggregrateIR));</span>
<a href="#l35.15"></a><span id="l35.15">         ir = aggregrateIR;</span>
<a href="#l35.16"></a><span id="l35.16">       }</span>
<a href="#l35.17"></a><span id="l35.17">     }</span>
<a href="#l35.18"></a><span id="l35.18">   }</span>
<a href="#l35.19"></a><span id="l35.19"> </span>
<a href="#l35.20"></a><span id="l35.20">   int32_t port = 0;</span>
<a href="#l35.21"></a><span id="l35.21">   m_url-&gt;GetPort(&amp;port);</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -3887,17 +3887,17 @@ NS_IMETHODIMP nsPop3Protocol::CheckMessa</span>
<a href="#l35.23"></a><span id="l35.23"> /* Function for finding an APOP Timestamp and simple check</span>
<a href="#l35.24"></a><span id="l35.24">    it for its validity. If returning NS_OK m_ApopTimestamp</span>
<a href="#l35.25"></a><span id="l35.25">    contains the validated substring of m_commandResponse. */</span>
<a href="#l35.26"></a><span id="l35.26"> nsresult nsPop3Protocol::GetApopTimestamp() {</span>
<a href="#l35.27"></a><span id="l35.27">   int32_t startMark = m_commandResponse.Length(), endMark = -1;</span>
<a href="#l35.28"></a><span id="l35.28"> </span>
<a href="#l35.29"></a><span id="l35.29">   while (true) {</span>
<a href="#l35.30"></a><span id="l35.30">     // search for previous &lt;</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-    if ((startMark = MsgRFindChar(m_commandResponse, '&lt;', startMark - 1)) &lt; 0)</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+    if ((startMark = m_commandResponse.RFindChar('&lt;', startMark - 1)) &lt; 0)</span>
<a href="#l35.33"></a><span id="l35.33">       return NS_ERROR_FAILURE;</span>
<a href="#l35.34"></a><span id="l35.34"> </span>
<a href="#l35.35"></a><span id="l35.35">     // search for next &gt;</span>
<a href="#l35.36"></a><span id="l35.36">     if ((endMark = m_commandResponse.FindChar('&gt;', startMark)) &lt; 0) continue;</span>
<a href="#l35.37"></a><span id="l35.37"> </span>
<a href="#l35.38"></a><span id="l35.38">     // look for an @ between start and end as a raw test</span>
<a href="#l35.39"></a><span id="l35.39">     int32_t at = m_commandResponse.FindChar('@', startMark);</span>
<a href="#l35.40"></a><span id="l35.40">     if (at &lt; 0 || at &gt;= endMark) continue;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/mime/src/mimehdrs.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/mime/src/mimehdrs.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -523,22 +523,22 @@ int MimeHeaders_write_all_headers(MimeHe</span>
<a href="#l36.4"></a><span id="l36.4">     nsAutoCString name(Substring(head, colon));</span>
<a href="#l36.5"></a><span id="l36.5">     nsAutoCString hdr_value;</span>
<a href="#l36.6"></a><span id="l36.6"> </span>
<a href="#l36.7"></a><span id="l36.7">     if ((end - contents) &gt; 0) {</span>
<a href="#l36.8"></a><span id="l36.8">       hdr_value = Substring(contents, end);</span>
<a href="#l36.9"></a><span id="l36.9">     }</span>
<a href="#l36.10"></a><span id="l36.10"> </span>
<a href="#l36.11"></a><span id="l36.11">     // MW Fixme: more?</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-    bool convert_charset_only = MsgLowerCaseEqualsLiteral(name, &quot;to&quot;) ||</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-                                MsgLowerCaseEqualsLiteral(name, &quot;from&quot;) ||</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-                                MsgLowerCaseEqualsLiteral(name, &quot;cc&quot;) ||</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineminus">-                                MsgLowerCaseEqualsLiteral(name, &quot;bcc&quot;) ||</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineminus">-                                MsgLowerCaseEqualsLiteral(name, &quot;reply-to&quot;) ||</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineminus">-                                MsgLowerCaseEqualsLiteral(name, &quot;sender&quot;);</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineplus">+    bool convert_charset_only = name.LowerCaseEqualsLiteral(&quot;to&quot;) ||</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineplus">+                                name.LowerCaseEqualsLiteral(&quot;from&quot;) ||</span>
<a href="#l36.20"></a><span id="l36.20" class="difflineplus">+                                name.LowerCaseEqualsLiteral(&quot;cc&quot;) ||</span>
<a href="#l36.21"></a><span id="l36.21" class="difflineplus">+                                name.LowerCaseEqualsLiteral(&quot;bcc&quot;) ||</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineplus">+                                name.LowerCaseEqualsLiteral(&quot;reply-to&quot;) ||</span>
<a href="#l36.23"></a><span id="l36.23" class="difflineplus">+                                name.LowerCaseEqualsLiteral(&quot;sender&quot;);</span>
<a href="#l36.24"></a><span id="l36.24">     MimeHeaders_convert_header_value(opt, hdr_value, convert_charset_only);</span>
<a href="#l36.25"></a><span id="l36.25">     // if we're saving as html, we need to convert headers from utf8 to message</span>
<a href="#l36.26"></a><span id="l36.26">     // charset, if any</span>
<a href="#l36.27"></a><span id="l36.27">     if (opt-&gt;format_out == nsMimeOutput::nsMimeMessageSaveAs &amp;&amp; charset) {</span>
<a href="#l36.28"></a><span id="l36.28">       nsAutoCString convertedStr;</span>
<a href="#l36.29"></a><span id="l36.29">       if (NS_SUCCEEDED(nsMsgI18NConvertFromUnicode(</span>
<a href="#l36.30"></a><span id="l36.30">               nsDependentCString(charset), NS_ConvertUTF8toUTF16(hdr_value),</span>
<a href="#l36.31"></a><span id="l36.31">               convertedStr))) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -288,18 +288,18 @@ nsresult nsStreamConverter::DetermineOut</span>
<a href="#l37.4"></a><span id="l37.4"> </span>
<a href="#l37.5"></a><span id="l37.5">     if (*format) {</span>
<a href="#l37.6"></a><span id="l37.6">       mOverrideFormat = &quot;raw&quot;;</span>
<a href="#l37.7"></a><span id="l37.7"> </span>
<a href="#l37.8"></a><span id="l37.8">       // set mOutputFormat to the supplied format, ensure that we replace any</span>
<a href="#l37.9"></a><span id="l37.9">       // %2F strings with the slash character</span>
<a href="#l37.10"></a><span id="l37.10">       const char *nextField = PL_strpbrk(format, &quot;&amp;; &quot;);</span>
<a href="#l37.11"></a><span id="l37.11">       mOutputFormat.Assign(format, nextField ? nextField - format : -1);</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-      MsgReplaceSubstring(mOutputFormat, &quot;%2F&quot;, &quot;/&quot;);</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-      MsgReplaceSubstring(mOutputFormat, &quot;%2f&quot;, &quot;/&quot;);</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineplus">+      mOutputFormat.ReplaceSubstring(&quot;%2F&quot;, &quot;/&quot;);</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineplus">+      mOutputFormat.ReplaceSubstring(&quot;%2f&quot;, &quot;/&quot;);</span>
<a href="#l37.16"></a><span id="l37.16"> </span>
<a href="#l37.17"></a><span id="l37.17">       // Don't muck with this data!</span>
<a href="#l37.18"></a><span id="l37.18">       *aNewType = nsMimeOutput::nsMimeMessageRaw;</span>
<a href="#l37.19"></a><span id="l37.19">       return NS_OK;</span>
<a href="#l37.20"></a><span id="l37.20">     }</span>
<a href="#l37.21"></a><span id="l37.21">   }</span>
<a href="#l37.22"></a><span id="l37.22"> </span>
<a href="#l37.23"></a><span id="l37.23">   // is this is a part that should just come out raw</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -23,16 +23,17 @@</span>
<a href="#l38.4"></a><span id="l38.4"> #include &quot;prtime.h&quot;</span>
<a href="#l38.5"></a><span id="l38.5"> #include &quot;prerror.h&quot;</span>
<a href="#l38.6"></a><span id="l38.6"> #include &quot;nsString.h&quot;</span>
<a href="#l38.7"></a><span id="l38.7"> #include &quot;mozilla/Attributes.h&quot;</span>
<a href="#l38.8"></a><span id="l38.8"> #include &quot;mozilla/Logging.h&quot;</span>
<a href="#l38.9"></a><span id="l38.9"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l38.10"></a><span id="l38.10"> #include &quot;mozilla/SlicedInputStream.h&quot;</span>
<a href="#l38.11"></a><span id="l38.11"> #include &quot;mozilla/mailnews/MimeHeaderParser.h&quot;</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineplus">+#include &quot;mozilla/Utf8.h&quot;</span>
<a href="#l38.13"></a><span id="l38.13"> #include &quot;nsContentUtils.h&quot;</span>
<a href="#l38.14"></a><span id="l38.14"> #include &quot;nsIURIMutator.h&quot;</span>
<a href="#l38.15"></a><span id="l38.15"> </span>
<a href="#l38.16"></a><span id="l38.16"> #include &quot;prprf.h&quot;</span>
<a href="#l38.17"></a><span id="l38.17"> </span>
<a href="#l38.18"></a><span id="l38.18"> /* include event sink interfaces for news */</span>
<a href="#l38.19"></a><span id="l38.19"> </span>
<a href="#l38.20"></a><span id="l38.20"> #include &quot;nsIMsgSearchSession.h&quot;</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineat">@@ -882,17 +883,17 @@ nsresult nsNNTPProtocol::LoadUrl(nsIURI </span>
<a href="#l38.22"></a><span id="l38.22">   m_runningURL-&gt;GetNewsAction(&amp;m_newsAction);</span>
<a href="#l38.23"></a><span id="l38.23"> </span>
<a href="#l38.24"></a><span id="l38.24">   SetIsBusy(true);</span>
<a href="#l38.25"></a><span id="l38.25"> </span>
<a href="#l38.26"></a><span id="l38.26">   rv = ParseURL(aURL, group, m_messageID);</span>
<a href="#l38.27"></a><span id="l38.27">   NS_ASSERTION(NS_SUCCEEDED(rv), &quot;failed to parse news url&quot;);</span>
<a href="#l38.28"></a><span id="l38.28">   // if (NS_FAILED(rv)) return rv;</span>
<a href="#l38.29"></a><span id="l38.29">   // XXX group returned from ParseURL is assumed to be in UTF-8</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineminus">-  NS_ASSERTION(MsgIsUTF8(group), &quot;newsgroup name is not in UTF-8&quot;);</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineplus">+  NS_ASSERTION(mozilla::IsUtf8(group), &quot;newsgroup name is not in UTF-8&quot;);</span>
<a href="#l38.32"></a><span id="l38.32">   NS_ASSERTION(m_nntpServer, &quot;Parsing must result in an m_nntpServer&quot;);</span>
<a href="#l38.33"></a><span id="l38.33"> </span>
<a href="#l38.34"></a><span id="l38.34">   MOZ_LOG(NNTP, LogLevel::Info,</span>
<a href="#l38.35"></a><span id="l38.35">           (&quot;(%p) m_messageID = %s&quot;, this, m_messageID.get()));</span>
<a href="#l38.36"></a><span id="l38.36">   MOZ_LOG(NNTP, LogLevel::Info, (&quot;(%p) group = %s&quot;, this, group.get()));</span>
<a href="#l38.37"></a><span id="l38.37">   MOZ_LOG(NNTP, LogLevel::Info, (&quot;(%p) m_key = %d&quot;, this, m_key));</span>
<a href="#l38.38"></a><span id="l38.38"> </span>
<a href="#l38.39"></a><span id="l38.39">   if (m_newsAction == nsINntpUrl::ActionFetchArticle ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -29,16 +29,17 @@</span>
<a href="#l39.4"></a><span id="l39.4"> #include &quot;nsISimpleEnumerator.h&quot;</span>
<a href="#l39.5"></a><span id="l39.5"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l39.6"></a><span id="l39.6"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l39.7"></a><span id="l39.7"> #include &quot;mozilla/dom/Element.h&quot;</span>
<a href="#l39.8"></a><span id="l39.8"> #include &quot;mozilla/ErrorResult.h&quot;</span>
<a href="#l39.9"></a><span id="l39.9"> #include &quot;mozilla/dom/XULTreeElement.h&quot;</span>
<a href="#l39.10"></a><span id="l39.10"> #include &quot;mozilla/dom/DataTransfer.h&quot;</span>
<a href="#l39.11"></a><span id="l39.11"> #include &quot;mozilla/LoadInfo.h&quot;</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineplus">+#include &quot;mozilla/Utf8.h&quot;</span>
<a href="#l39.13"></a><span id="l39.13"> </span>
<a href="#l39.14"></a><span id="l39.14"> #define INVALID_VERSION 0</span>
<a href="#l39.15"></a><span id="l39.15"> #define VALID_VERSION 2</span>
<a href="#l39.16"></a><span id="l39.16"> #define NEW_NEWS_DIR_NAME &quot;News&quot;</span>
<a href="#l39.17"></a><span id="l39.17"> #define PREF_MAIL_NEWSRC_ROOT &quot;mail.newsrc_root&quot;</span>
<a href="#l39.18"></a><span id="l39.18"> #define PREF_MAIL_NEWSRC_ROOT_REL &quot;mail.newsrc_root-rel&quot;</span>
<a href="#l39.19"></a><span id="l39.19"> #define PREF_MAILNEWS_VIEW_DEFAULT_CHARSET &quot;mailnews.view_default_charset&quot;</span>
<a href="#l39.20"></a><span id="l39.20"> #define HOSTINFO_FILE_NAME &quot;hostinfo.dat&quot;</span>
<a href="#l39.21"></a><span id="l39.21" class="difflineat">@@ -1020,17 +1021,17 @@ nsNntpIncomingServer::UpdateSubscribed()</span>
<a href="#l39.22"></a><span id="l39.22">   for (uint32_t i = 0; i &lt; length; ++i)</span>
<a href="#l39.23"></a><span id="l39.23">     SetAsSubscribed(mSubscribedNewsgroups[i]);</span>
<a href="#l39.24"></a><span id="l39.24">   return NS_OK;</span>
<a href="#l39.25"></a><span id="l39.25"> }</span>
<a href="#l39.26"></a><span id="l39.26"> </span>
<a href="#l39.27"></a><span id="l39.27"> NS_IMETHODIMP</span>
<a href="#l39.28"></a><span id="l39.28"> nsNntpIncomingServer::AddTo(const nsACString &amp;aName, bool addAsSubscribed,</span>
<a href="#l39.29"></a><span id="l39.29">                             bool aSubscribable, bool changeIfExists) {</span>
<a href="#l39.30"></a><span id="l39.30" class="difflineminus">-  NS_ASSERTION(MsgIsUTF8(aName), &quot;Non-UTF-8 newsgroup name&quot;);</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineplus">+  NS_ASSERTION(mozilla::IsUtf8(aName), &quot;Non-UTF-8 newsgroup name&quot;);</span>
<a href="#l39.32"></a><span id="l39.32">   nsresult rv = EnsureInner();</span>
<a href="#l39.33"></a><span id="l39.33">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l39.34"></a><span id="l39.34"> </span>
<a href="#l39.35"></a><span id="l39.35">   rv = AddGroupOnServer(aName);</span>
<a href="#l39.36"></a><span id="l39.36">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l39.37"></a><span id="l39.37"> </span>
<a href="#l39.38"></a><span id="l39.38">   rv = mInner-&gt;AddTo(aName, addAsSubscribed, aSubscribable, changeIfExists);</span>
<a href="#l39.39"></a><span id="l39.39">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l39.40"></a><span id="l39.40" class="difflineat">@@ -1117,17 +1118,17 @@ nsresult nsNntpIncomingServer::HandleLin</span>
<a href="#l39.41"></a><span id="l39.41">   if (mHasSeenBeginGroups) {</span>
<a href="#l39.42"></a><span id="l39.42">     // v1 hostinfo files had additional data fields delimited by commas.</span>
<a href="#l39.43"></a><span id="l39.43">     // with v2 hostinfo files, the additional data fields are removed.</span>
<a href="#l39.44"></a><span id="l39.44">     char *commaPos = (char *)PL_strchr(line, ',');</span>
<a href="#l39.45"></a><span id="l39.45">     if (commaPos) *commaPos = 0;</span>
<a href="#l39.46"></a><span id="l39.46"> </span>
<a href="#l39.47"></a><span id="l39.47">       // newsrc entries are all in UTF-8</span>
<a href="#l39.48"></a><span id="l39.48"> #ifdef DEBUG_jungshik</span>
<a href="#l39.49"></a><span id="l39.49" class="difflineminus">-    NS_ASSERTION(MsgIsUTF8(nsDependentCString(line)),</span>
<a href="#l39.50"></a><span id="l39.50" class="difflineplus">+    NS_ASSERTION(mozilla::IsUtf8(nsDependentCString(line)),</span>
<a href="#l39.51"></a><span id="l39.51">                  &quot;newsrc line is not utf-8&quot;);</span>
<a href="#l39.52"></a><span id="l39.52"> #endif</span>
<a href="#l39.53"></a><span id="l39.53">     nsresult rv = AddTo(nsDependentCString(line), false, true, true);</span>
<a href="#l39.54"></a><span id="l39.54">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;failed to add line&quot;);</span>
<a href="#l39.55"></a><span id="l39.55">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l39.56"></a><span id="l39.56">       // since we've seen one group, we can claim we've loaded the</span>
<a href="#l39.57"></a><span id="l39.57">       // hostinfo file</span>
<a href="#l39.58"></a><span id="l39.58">       mHostInfoLoaded = true;</span>
<a href="#l39.59"></a><span id="l39.59" class="difflineat">@@ -1503,35 +1504,34 @@ nsNntpIncomingServer::GetCanCreateFolder</span>
<a href="#l39.60"></a><span id="l39.60">   // No folder creation on news servers. Return false.</span>
<a href="#l39.61"></a><span id="l39.61">   *aCanCreateFoldersOnServer = false;</span>
<a href="#l39.62"></a><span id="l39.62">   return NS_OK;</span>
<a href="#l39.63"></a><span id="l39.63"> }</span>
<a href="#l39.64"></a><span id="l39.64"> </span>
<a href="#l39.65"></a><span id="l39.65"> NS_IMETHODIMP</span>
<a href="#l39.66"></a><span id="l39.66"> nsNntpIncomingServer::SetSearchValue(const nsAString &amp;aSearchValue) {</span>
<a href="#l39.67"></a><span id="l39.67">   nsCString searchValue = NS_ConvertUTF16toUTF8(aSearchValue);</span>
<a href="#l39.68"></a><span id="l39.68" class="difflineminus">-  MsgCompressWhitespace(searchValue);</span>
<a href="#l39.69"></a><span id="l39.69" class="difflineplus">+  searchValue.CompressWhitespace();</span>
<a href="#l39.70"></a><span id="l39.70"> </span>
<a href="#l39.71"></a><span id="l39.71">   if (mTree) {</span>
<a href="#l39.72"></a><span id="l39.72">     mTree-&gt;BeginUpdateBatch();</span>
<a href="#l39.73"></a><span id="l39.73">     mTree-&gt;RowCountChanged(</span>
<a href="#l39.74"></a><span id="l39.74">         0, -static_cast&lt;int32_t&gt;(mSubscribeSearchResult.Length()));</span>
<a href="#l39.75"></a><span id="l39.75">   }</span>
<a href="#l39.76"></a><span id="l39.76"> </span>
<a href="#l39.77"></a><span id="l39.77">   nsTArray&lt;nsCString&gt; searchStringParts;</span>
<a href="#l39.78"></a><span id="l39.78">   if (!searchValue.IsEmpty()) ParseString(searchValue, ' ', searchStringParts);</span>
<a href="#l39.79"></a><span id="l39.79"> </span>
<a href="#l39.80"></a><span id="l39.80">   mSubscribeSearchResult.Clear();</span>
<a href="#l39.81"></a><span id="l39.81">   uint32_t length = mGroupsOnServer.Length();</span>
<a href="#l39.82"></a><span id="l39.82">   for (uint32_t i = 0; i &lt; length; i++) {</span>
<a href="#l39.83"></a><span id="l39.83">     // check that all parts of the search string occur</span>
<a href="#l39.84"></a><span id="l39.84">     bool found = true;</span>
<a href="#l39.85"></a><span id="l39.85">     for (uint32_t j = 0; j &lt; searchStringParts.Length(); ++j) {</span>
<a href="#l39.86"></a><span id="l39.86" class="difflineminus">-      if (MsgFind(mGroupsOnServer[i], searchStringParts[j], true, 0) ==</span>
<a href="#l39.87"></a><span id="l39.87" class="difflineminus">-          kNotFound) {</span>
<a href="#l39.88"></a><span id="l39.88" class="difflineplus">+      if (mGroupsOnServer[i].Find(searchStringParts[j], true, 0) == kNotFound) {</span>
<a href="#l39.89"></a><span id="l39.89">         found = false;</span>
<a href="#l39.90"></a><span id="l39.90">         break;</span>
<a href="#l39.91"></a><span id="l39.91">       }</span>
<a href="#l39.92"></a><span id="l39.92">     }</span>
<a href="#l39.93"></a><span id="l39.93"> </span>
<a href="#l39.94"></a><span id="l39.94">     if (found) mSubscribeSearchResult.AppendElement(mGroupsOnServer[i]);</span>
<a href="#l39.95"></a><span id="l39.95">   }</span>
<a href="#l39.96"></a><span id="l39.96"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -41,16 +41,17 @@</span>
<a href="#l40.4"></a><span id="l40.4"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l40.5"></a><span id="l40.5"> #include &quot;nsIStreamListener.h&quot;</span>
<a href="#l40.6"></a><span id="l40.6"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l40.7"></a><span id="l40.7"> #include &quot;nsIURIMutator.h&quot;</span>
<a href="#l40.8"></a><span id="l40.8"> #include &quot;nsTArray.h&quot;</span>
<a href="#l40.9"></a><span id="l40.9"> #include &quot;nsDocShellLoadState.h&quot;</span>
<a href="#l40.10"></a><span id="l40.10"> #include &quot;nsContentUtils.h&quot;</span>
<a href="#l40.11"></a><span id="l40.11"> #include &quot;mozilla/LoadInfo.h&quot;</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineplus">+#include &quot;mozilla/Utf8.h&quot;</span>
<a href="#l40.13"></a><span id="l40.13"> </span>
<a href="#l40.14"></a><span id="l40.14"> #include &quot;../../base/src/MailnewsLoadContextInfo.h&quot;</span>
<a href="#l40.15"></a><span id="l40.15"> </span>
<a href="#l40.16"></a><span id="l40.16"> #undef GetPort  // XXX Windows!</span>
<a href="#l40.17"></a><span id="l40.17"> #undef SetPort  // XXX Windows!</span>
<a href="#l40.18"></a><span id="l40.18"> </span>
<a href="#l40.19"></a><span id="l40.19"> #define PREF_MAIL_ROOT_NNTP \</span>
<a href="#l40.20"></a><span id="l40.20">   &quot;mail.root.nntp&quot;  // old - for backward compatibility only</span>
<a href="#l40.21"></a><span id="l40.21" class="difflineat">@@ -608,17 +609,17 @@ nsresult nsNntpService::FindServerWithNe</span>
<a href="#l40.22"></a><span id="l40.22">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l40.23"></a><span id="l40.23">       do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l40.24"></a><span id="l40.24">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.25"></a><span id="l40.25"> </span>
<a href="#l40.26"></a><span id="l40.26">   nsCOMPtr&lt;nsIArray&gt; servers;</span>
<a href="#l40.27"></a><span id="l40.27">   rv = accountManager-&gt;GetAllServers(getter_AddRefs(servers));</span>
<a href="#l40.28"></a><span id="l40.28">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.29"></a><span id="l40.29"> </span>
<a href="#l40.30"></a><span id="l40.30" class="difflineminus">-  NS_ASSERTION(MsgIsUTF8(groupName), &quot;newsgroup is not in UTF-8&quot;);</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineplus">+  NS_ASSERTION(mozilla::IsUtf8(groupName), &quot;newsgroup is not in UTF-8&quot;);</span>
<a href="#l40.32"></a><span id="l40.32"> </span>
<a href="#l40.33"></a><span id="l40.33">   // XXX TODO</span>
<a href="#l40.34"></a><span id="l40.34">   // this only looks at the list of subscribed newsgroups.</span>
<a href="#l40.35"></a><span id="l40.35">   // fix to use the hostinfo.dat information</span>
<a href="#l40.36"></a><span id="l40.36"> </span>
<a href="#l40.37"></a><span id="l40.37">   uint32_t length;</span>
<a href="#l40.38"></a><span id="l40.38">   rv = servers-&gt;GetLength(&amp;length);</span>
<a href="#l40.39"></a><span id="l40.39">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

