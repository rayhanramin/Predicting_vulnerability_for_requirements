<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27468:90b92315e8a506149834eea1835a7faedd80d298</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 90b92315e8a506149834eea1835a7faedd80d298" />
<meta property="og:url" content="/comm-central/rev/90b92315e8a506149834eea1835a7faedd80d298" />
<meta property="og:description" content="Bug 1577835 - Fix 'else and comments' formatting in mailnews/. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 90b92315e8a506149834eea1835a7faedd80d298 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/90b92315e8a506149834eea1835a7faedd80d298">shortlog</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/90b92315e8a506149834eea1835a7faedd80d298">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298">files</a> |
changeset |
<a href="/comm-central/raw-rev/90b92315e8a506149834eea1835a7faedd80d298">raw</a>  | <a href="/comm-central/archive/90b92315e8a506149834eea1835a7faedd80d298.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1577835">Bug 1577835</a> - Fix 'else and comments' formatting in mailnews/. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#97;&#117;&#108;&#32;&#77;&#111;&#114;&#114;&#105;&#115;&#32;&#60;&#112;&#97;&#117;&#108;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 30 Aug 2019 23:37:40 -0400</td></tr>

<tr>
 <td>changeset 27468</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/90b92315e8a506149834eea1835a7faedd80d298">90b92315e8a506149834eea1835a7faedd80d298</a></td>
</tr>



<tr>
<td>parent 27467</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/77773ecb02ca0f76310211a3d5acc5317cd60083">77773ecb02ca0f76310211a3d5acc5317cd60083</a>
</td>
</tr>

<tr>
<td>child 27469</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d61a07ada51d6fb7fa88083b89615542116197ad">d61a07ada51d6fb7fa88083b89615542116197ad</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=90b92315e8a506149834eea1835a7faedd80d298">16348</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 01 Sep 2019 21:02:53 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@8177b85d18db [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8177b85d18db77c4787461cd6db9575ef9935aea">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8177b85d18db77c4787461cd6db9575ef9935aea&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8177b85d18db77c4787461cd6db9575ef9935aea&newProject=comm-central&newRevision=fda41b757b2e6b5288b439aa9227b869ae320aa2&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8177b85d18db77c4787461cd6db9575ef9935aea&newProject=comm-central&newRevision=fda41b757b2e6b5288b439aa9227b869ae320aa2&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8177b85d18db77c4787461cd6db9575ef9935aea&newProject=comm-central&newRevision=fda41b757b2e6b5288b439aa9227b869ae320aa2&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1577835">1577835</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1577835">Bug 1577835</a> - Fix 'else and comments' formatting in mailnews/. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/content/abDragDrop.js">mailnews/addrbook/content/abDragDrop.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/content/abDragDrop.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/content/abDragDrop.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/content/abDragDrop.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/content/abDragDrop.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/content/abDragDrop.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/src/nsAbLDAPAutoCompleteSearch.js">mailnews/addrbook/src/nsAbLDAPAutoCompleteSearch.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/src/nsAbLDAPAutoCompleteSearch.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/src/nsAbLDAPAutoCompleteSearch.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/src/nsAbLDAPAutoCompleteSearch.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/src/nsAbLDAPAutoCompleteSearch.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/addrbook/src/nsAbLDAPAutoCompleteSearch.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/content/virtualFolderProperties.js">mailnews/base/content/virtualFolderProperties.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/content/virtualFolderProperties.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/content/virtualFolderProperties.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/content/virtualFolderProperties.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/content/virtualFolderProperties.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/content/virtualFolderProperties.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-prefs.js">mailnews/base/prefs/content/am-prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-prefs.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-prefs.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-prefs.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-prefs.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-prefs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-smtp.js">mailnews/base/prefs/content/am-smtp.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-smtp.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-smtp.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-smtp.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-smtp.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/prefs/content/am-smtp.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/src/newMailNotificationService.js">mailnews/base/src/newMailNotificationService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/src/newMailNotificationService.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/src/newMailNotificationService.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/src/newMailNotificationService.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/src/newMailNotificationService.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/src/newMailNotificationService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/JXON.js">mailnews/base/util/JXON.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/JXON.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/JXON.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/JXON.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/JXON.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/JXON.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/hostnameUtils.jsm">mailnews/base/util/hostnameUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/hostnameUtils.jsm">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/hostnameUtils.jsm">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/hostnameUtils.jsm">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/hostnameUtils.jsm">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/hostnameUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/jsTreeSelection.js">mailnews/base/util/jsTreeSelection.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/jsTreeSelection.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/jsTreeSelection.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/jsTreeSelection.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/jsTreeSelection.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/base/util/jsTreeSelection.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/datastore.js">mailnews/db/gloda/modules/datastore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/datastore.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/datastore.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/datastore.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/datastore.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/datastore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/gloda.js">mailnews/db/gloda/modules/gloda.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/gloda.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/gloda.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/gloda.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/gloda.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/gloda.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/index_msg.js">mailnews/db/gloda/modules/index_msg.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/index_msg.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/index_msg.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/index_msg.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/index_msg.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/index_msg.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/indexer.js">mailnews/db/gloda/modules/indexer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/indexer.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/indexer.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/indexer.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/indexer.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/indexer.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/mimemsg.js">mailnews/db/gloda/modules/mimemsg.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/mimemsg.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/mimemsg.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/mimemsg.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/mimemsg.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/mimemsg.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/msg_search.js">mailnews/db/gloda/modules/msg_search.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/msg_search.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/msg_search.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/msg_search.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/msg_search.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/modules/msg_search.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/test/unit/resources/mockTimer.js">mailnews/db/gloda/test/unit/resources/mockTimer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/test/unit/resources/mockTimer.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/test/unit/resources/mockTimer.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/test/unit/resources/mockTimer.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/test/unit/resources/mockTimer.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/db/gloda/test/unit/resources/mockTimer.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/imapd.js">mailnews/test/fakeserver/imapd.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/imapd.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/imapd.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/imapd.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/imapd.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/imapd.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/pop3d.js">mailnews/test/fakeserver/pop3d.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/pop3d.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/pop3d.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/pop3d.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/pop3d.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/pop3d.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/smtpd.js">mailnews/test/fakeserver/smtpd.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/smtpd.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/smtpd.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/smtpd.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/smtpd.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/fakeserver/smtpd.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/resources/messageGenerator.js">mailnews/test/resources/messageGenerator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/resources/messageGenerator.js">file</a> |
<a href="/comm-central/annotate/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/resources/messageGenerator.js">annotate</a> |
<a href="/comm-central/diff/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/resources/messageGenerator.js">diff</a> |
<a href="/comm-central/comparison/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/resources/messageGenerator.js">comparison</a> |
<a href="/comm-central/log/90b92315e8a506149834eea1835a7faedd80d298/mailnews/test/resources/messageGenerator.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/content/abDragDrop.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/content/abDragDrop.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -76,19 +76,18 @@ var abResultsPaneObserver = {</span>
<a href="#l1.4"></a><span id="l1.4">     let srcDirectory = getSelectedDirectory();</span>
<a href="#l1.5"></a><span id="l1.5">     // The default allowable actions are copy, move and link, so we need</span>
<a href="#l1.6"></a><span id="l1.6">     // to restrict them here.</span>
<a href="#l1.7"></a><span id="l1.7">     if (!srcDirectory.readOnly) {</span>
<a href="#l1.8"></a><span id="l1.8">       // Only allow copy &amp; move from read-write directories.</span>
<a href="#l1.9"></a><span id="l1.9">       aDragAction.action =</span>
<a href="#l1.10"></a><span id="l1.10">         Ci.nsIDragService.DRAGDROP_ACTION_COPY |</span>
<a href="#l1.11"></a><span id="l1.11">         Ci.nsIDragService.DRAGDROP_ACTION_MOVE;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    }</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-    // Only allow copy from read-only directories.</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-    else {</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    } else {</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+      // Only allow copy from read-only directories.</span>
<a href="#l1.17"></a><span id="l1.17">       aDragAction.action = Ci.nsIDragService.DRAGDROP_ACTION_COPY;</span>
<a href="#l1.18"></a><span id="l1.18">     }</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">     var card = GetSelectedCard();</span>
<a href="#l1.21"></a><span id="l1.21">     if (card &amp;&amp; card.displayName) {</span>
<a href="#l1.22"></a><span id="l1.22">       try {</span>
<a href="#l1.23"></a><span id="l1.23">         // A card implementation may throw NS_ERROR_NOT_IMPLEMENTED.</span>
<a href="#l1.24"></a><span id="l1.24">         // Don't break drag-and-drop if that happens.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPAutoCompleteSearch.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPAutoCompleteSearch.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -337,21 +337,21 @@ nsAbLDAPAutoCompleteSearch.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">   onSearchFoundCard(aCard) {</span>
<a href="#l2.5"></a><span id="l2.5">     if (!this._listener) {</span>
<a href="#l2.6"></a><span id="l2.6">       return;</span>
<a href="#l2.7"></a><span id="l2.7">     }</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">     this._addToResult(aCard);</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">     /* XXX autocomplete doesn't expect you to rearrange while searching</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    if (this._result.matchCount)</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    if (this._result.matchCount) {</span>
<a href="#l2.14"></a><span id="l2.14">       this._result.searchResult = ACR.RESULT_SUCCESS_ONGOING;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-    else</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+    } else {</span>
<a href="#l2.17"></a><span id="l2.17">       this._result.searchResult = ACR.RESULT_NOMATCH_ONGOING;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+    }</span>
<a href="#l2.20"></a><span id="l2.20">     this._listener.onSearchResult(this, this._result);</span>
<a href="#l2.21"></a><span id="l2.21">     */</span>
<a href="#l2.22"></a><span id="l2.22">   },</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24">   // nsISupports</span>
<a href="#l2.25"></a><span id="l2.25"> </span>
<a href="#l2.26"></a><span id="l2.26">   QueryInterface: ChromeUtils.generateQI([</span>
<a href="#l2.27"></a><span id="l2.27">     Ci.nsIObserver,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/content/virtualFolderProperties.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/content/virtualFolderProperties.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -110,19 +110,19 @@ function onLoad() {</span>
<a href="#l3.4"></a><span id="l3.4">     document.getElementById(&quot;searchOnline&quot;).checked = windowArgs.searchOnline;</span>
<a href="#l3.5"></a><span id="l3.5">   }</span>
<a href="#l3.6"></a><span id="l3.6">   updateOnlineSearchState();</span>
<a href="#l3.7"></a><span id="l3.7">   updateFoldersCount();</span>
<a href="#l3.8"></a><span id="l3.8"> }</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10"> function setupSearchRows(aSearchTerms) {</span>
<a href="#l3.11"></a><span id="l3.11">   if (aSearchTerms &amp;&amp; aSearchTerms.length &gt; 0) {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+    // Load the search terms for the folder.</span>
<a href="#l3.13"></a><span id="l3.13">     initializeSearchRows(Ci.nsMsgSearchScope.offlineMail, aSearchTerms);</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-  } // load the search terms for the folder</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-  else {</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+  } else {</span>
<a href="#l3.17"></a><span id="l3.17">     onMore(null);</span>
<a href="#l3.18"></a><span id="l3.18">   }</span>
<a href="#l3.19"></a><span id="l3.19"> }</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21"> function updateOnlineSearchState() {</span>
<a href="#l3.22"></a><span id="l3.22">   var enableCheckbox = false;</span>
<a href="#l3.23"></a><span id="l3.23">   var checkbox = document.getElementById(&quot;searchOnline&quot;);</span>
<a href="#l3.24"></a><span id="l3.24">   // only enable the checkbox for selection, for online servers</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-prefs.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-prefs.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -30,26 +30,27 @@ function substPrefTokens(aStr, aElement)</span>
<a href="#l4.4"></a><span id="l4.4">   /* here's a little loop that goes through</span>
<a href="#l4.5"></a><span id="l4.5">      each part of the string separated by a dot, and</span>
<a href="#l4.6"></a><span id="l4.6">      if any parts are of the form %string%, it will replace</span>
<a href="#l4.7"></a><span id="l4.7">      them with the value of the attribute of that name from</span>
<a href="#l4.8"></a><span id="l4.8">      the xul object */</span>
<a href="#l4.9"></a><span id="l4.9">   for (let i = 0; i &lt; prefPartsArray.length; i++) {</span>
<a href="#l4.10"></a><span id="l4.10">     token = prefPartsArray[i].match(tokenpat);</span>
<a href="#l4.11"></a><span id="l4.11">     if (token) {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      /* we've got a %% match */</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+      // We've got a %% match.</span>
<a href="#l4.14"></a><span id="l4.14">       if (token[1]) {</span>
<a href="#l4.15"></a><span id="l4.15">         if (aElement[token[1]]) {</span>
<a href="#l4.16"></a><span id="l4.16">           newprefstr += aElement[token[1]] + &quot;.&quot;; // here's where we get the info</span>
<a href="#l4.17"></a><span id="l4.17">         } else {</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-          /* all we got was this stinkin % */</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+          // All we got was this stinkin %.</span>
<a href="#l4.20"></a><span id="l4.20">           newprefstr += prefPartsArray[i] + &quot;.&quot;;</span>
<a href="#l4.21"></a><span id="l4.21">         }</span>
<a href="#l4.22"></a><span id="l4.22">       }</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-    } /* if (token) */ else {</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+    } else {</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+      // token is falsy.</span>
<a href="#l4.26"></a><span id="l4.26">       newprefstr += prefPartsArray[i] + &quot;.&quot;;</span>
<a href="#l4.27"></a><span id="l4.27">     }</span>
<a href="#l4.28"></a><span id="l4.28">   }</span>
<a href="#l4.29"></a><span id="l4.29">   newprefstr = newprefstr.slice(0, -1); // remove the last char, a dot</span>
<a href="#l4.30"></a><span id="l4.30">   if (newprefstr.length &lt;= 0) {</span>
<a href="#l4.31"></a><span id="l4.31">     newprefstr = null;</span>
<a href="#l4.32"></a><span id="l4.32">   }</span>
<a href="#l4.33"></a><span id="l4.33"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-smtp.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-smtp.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -191,18 +191,18 @@ var gSmtpServerListWindow = {</span>
<a href="#l5.4"></a><span id="l5.4">       MailServices.smtp.servers,</span>
<a href="#l5.5"></a><span id="l5.5">       MailServices.smtp.defaultServer</span>
<a href="#l5.6"></a><span id="l5.6">     );</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">     if (aServerKeyToSelect) {</span>
<a href="#l5.9"></a><span id="l5.9">       this.setSelectedServer(</span>
<a href="#l5.10"></a><span id="l5.10">         this.mServerList.querySelector('[key=&quot;' + aServerKeyToSelect + '&quot;]')</span>
<a href="#l5.11"></a><span id="l5.11">       );</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    } // select the default server</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-    else {</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+    } else {</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+      // Select the default server.</span>
<a href="#l5.16"></a><span id="l5.16">       this.setSelectedServer(</span>
<a href="#l5.17"></a><span id="l5.17">         this.mServerList.querySelector('[default=&quot;true&quot;]')</span>
<a href="#l5.18"></a><span id="l5.18">       );</span>
<a href="#l5.19"></a><span id="l5.19">     }</span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21">     if (aFocusList) {</span>
<a href="#l5.22"></a><span id="l5.22">       this.mServerList.focus();</span>
<a href="#l5.23"></a><span id="l5.23">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/src/newMailNotificationService.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/src/newMailNotificationService.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -195,35 +195,29 @@ NewMailNotificationService.prototype = {</span>
<a href="#l6.4"></a><span id="l6.4">         &quot; flags &quot; +</span>
<a href="#l6.5"></a><span id="l6.5">         aFolder.flags</span>
<a href="#l6.6"></a><span id="l6.6">     );</span>
<a href="#l6.7"></a><span id="l6.7">     let srv = null;</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9">     // If it's not a mail folder we don't count it by default</span>
<a href="#l6.10"></a><span id="l6.10">     if (!(aFolder.flags &amp; Ci.nsMsgFolderFlags.Mail)) {</span>
<a href="#l6.11"></a><span id="l6.11">       shouldCount.data = false;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    }</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-    // For whatever reason, RSS folders have the 'Mail' flag</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-    else if ((srv = aFolder.server) &amp;&amp; srv.type == &quot;rss&quot;) {</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+    } else if ((srv = aFolder.server) &amp;&amp; srv.type == &quot;rss&quot;) {</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+      // For whatever reason, RSS folders have the 'Mail' flag.</span>
<a href="#l6.18"></a><span id="l6.18">       shouldCount.data = false;</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-    }</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-    // If it's a special folder *other than the inbox* we don't count it by default</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-    else if (</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+    } else if (</span>
<a href="#l6.24"></a><span id="l6.24">       aFolder.flags &amp; Ci.nsMsgFolderFlags.SpecialUse &amp;&amp;</span>
<a href="#l6.25"></a><span id="l6.25">       !(aFolder.flags &amp; Ci.nsMsgFolderFlags.Inbox)</span>
<a href="#l6.26"></a><span id="l6.26">     ) {</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+      // It's a special folder *other than the inbox*, don't count it by default.</span>
<a href="#l6.28"></a><span id="l6.28">       shouldCount.data = false;</span>
<a href="#l6.29"></a><span id="l6.29">     } else if (aFolder.flags &amp; Ci.nsMsgFolderFlags.Virtual) {</span>
<a href="#l6.30"></a><span id="l6.30">       shouldCount.data = false;</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-    }</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-    // if we're only counting inboxes and it's not an inbox...</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-    else {</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+    } else {</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+      // If we're only counting inboxes and it's not an inbox...</span>
<a href="#l6.37"></a><span id="l6.37">       try {</span>
<a href="#l6.38"></a><span id="l6.38">         // If we can't get this pref, just leave it as the default</span>
<a href="#l6.39"></a><span id="l6.39">         let onlyCountInboxes = Services.prefs.getBoolPref(countInboxesPref);</span>
<a href="#l6.40"></a><span id="l6.40">         if (onlyCountInboxes &amp;&amp; !(aFolder.flags &amp; Ci.nsMsgFolderFlags.Inbox)) {</span>
<a href="#l6.41"></a><span id="l6.41">           shouldCount.data = false;</span>
<a href="#l6.42"></a><span id="l6.42">         }</span>
<a href="#l6.43"></a><span id="l6.43">       } catch (error) {}</span>
<a href="#l6.44"></a><span id="l6.44">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/util/JXON.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/util/JXON.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -143,38 +143,40 @@ var JXON = new (function() {</span>
<a href="#l7.4"></a><span id="l7.4">   function loadObjTree(oXMLDoc, oParentEl, oParentObj) {</span>
<a href="#l7.5"></a><span id="l7.5">     var vValue, oChild;</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">     if (</span>
<a href="#l7.8"></a><span id="l7.8">       oParentObj instanceof String ||</span>
<a href="#l7.9"></a><span id="l7.9">       oParentObj instanceof Number ||</span>
<a href="#l7.10"></a><span id="l7.10">       oParentObj instanceof Boolean</span>
<a href="#l7.11"></a><span id="l7.11">     ) {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+      // Verbosity level is 0.</span>
<a href="#l7.13"></a><span id="l7.13">       oParentEl.appendChild(oXMLDoc.createTextNode(oParentObj.toString()));</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-    } /* verbosity level is 0 */ else if (oParentObj.constructor === Date) {</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    } else if (oParentObj.constructor === Date) {</span>
<a href="#l7.16"></a><span id="l7.16">       oParentEl.appendChild(oXMLDoc.createTextNode(oParentObj.toGMTString()));</span>
<a href="#l7.17"></a><span id="l7.17">     }</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">     for (var sName in oParentObj) {</span>
<a href="#l7.20"></a><span id="l7.20">       vValue = oParentObj[sName];</span>
<a href="#l7.21"></a><span id="l7.21">       if (isFinite(sName) || vValue instanceof Function) {</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+        // Verbosity level is 0.</span>
<a href="#l7.23"></a><span id="l7.23">         continue;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-      } /* verbosity level is 0 */</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+      }</span>
<a href="#l7.26"></a><span id="l7.26">       if (sName === sValueProp) {</span>
<a href="#l7.27"></a><span id="l7.27">         if (vValue !== null &amp;&amp; vValue !== true) {</span>
<a href="#l7.28"></a><span id="l7.28">           oParentEl.appendChild(</span>
<a href="#l7.29"></a><span id="l7.29">             oXMLDoc.createTextNode(</span>
<a href="#l7.30"></a><span id="l7.30">               vValue.constructor === Date</span>
<a href="#l7.31"></a><span id="l7.31">                 ? vValue.toGMTString()</span>
<a href="#l7.32"></a><span id="l7.32">                 : String(vValue)</span>
<a href="#l7.33"></a><span id="l7.33">             )</span>
<a href="#l7.34"></a><span id="l7.34">           );</span>
<a href="#l7.35"></a><span id="l7.35">         }</span>
<a href="#l7.36"></a><span id="l7.36">       } else if (sName === sAttributesProp) {</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-        /* verbosity level is 3 */</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+        // Verbosity level is 3.</span>
<a href="#l7.39"></a><span id="l7.39">         for (var sAttrib in vValue) {</span>
<a href="#l7.40"></a><span id="l7.40">           oParentEl.setAttribute(sAttrib, vValue[sAttrib]);</span>
<a href="#l7.41"></a><span id="l7.41">         }</span>
<a href="#l7.42"></a><span id="l7.42">       } else if (sName.charAt(0) === sAttrPref) {</span>
<a href="#l7.43"></a><span id="l7.43">         oParentEl.setAttribute(sName.slice(1), vValue);</span>
<a href="#l7.44"></a><span id="l7.44">       } else if (vValue.constructor === Array) {</span>
<a href="#l7.45"></a><span id="l7.45">         for (var nItem = 0; nItem &lt; vValue.length; nItem++) {</span>
<a href="#l7.46"></a><span id="l7.46">           oChild = oXMLDoc.createXULElement(sName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/util/hostnameUtils.jsm</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/util/hostnameUtils.jsm</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -136,19 +136,18 @@ function isLegalIPv4Address(aHostName, a</span>
<a href="#l8.4"></a><span id="l8.4">     let component;</span>
<a href="#l8.5"></a><span id="l8.5">     // Is the component decimal?</span>
<a href="#l8.6"></a><span id="l8.6">     if (/^(0|([1-9][0-9]{0,9}))$/.test(aValue)) {</span>
<a href="#l8.7"></a><span id="l8.7">       component = parseInt(aValue, 10);</span>
<a href="#l8.8"></a><span id="l8.8">     } else if (aAllowExtendedIPFormats) {</span>
<a href="#l8.9"></a><span id="l8.9">       // Is the component octal?</span>
<a href="#l8.10"></a><span id="l8.10">       if (/^(0[0-7]{1,12})$/.test(aValue)) {</span>
<a href="#l8.11"></a><span id="l8.11">         component = parseInt(aValue, 8);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      }</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-      // Is the component hex?</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-      else if (/^(0x[0-9a-f]{1,8})$/i.test(aValue)) {</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+      } else if (/^(0x[0-9a-f]{1,8})$/i.test(aValue)) {</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+        // The component is hex.</span>
<a href="#l8.17"></a><span id="l8.17">         component = parseInt(aValue, 16);</span>
<a href="#l8.18"></a><span id="l8.18">       } else {</span>
<a href="#l8.19"></a><span id="l8.19">         return null;</span>
<a href="#l8.20"></a><span id="l8.20">       }</span>
<a href="#l8.21"></a><span id="l8.21">     } else {</span>
<a href="#l8.22"></a><span id="l8.22">       return null;</span>
<a href="#l8.23"></a><span id="l8.23">     }</span>
<a href="#l8.24"></a><span id="l8.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/util/jsTreeSelection.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/util/jsTreeSelection.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -173,30 +173,27 @@ JSTreeSelection.prototype = {</span>
<a href="#l9.4"></a><span id="l9.4">           // then it gets its own range</span>
<a href="#l9.5"></a><span id="l9.5">           this._ranges.splice(iTupe, 0, [aIndex, aIndex]);</span>
<a href="#l9.6"></a><span id="l9.6">           break;</span>
<a href="#l9.7"></a><span id="l9.7">         }</span>
<a href="#l9.8"></a><span id="l9.8">         // in the range?  will need to either nuke, shrink, or split the range to</span>
<a href="#l9.9"></a><span id="l9.9">         //  remove it</span>
<a href="#l9.10"></a><span id="l9.10">         if (aIndex &gt;= low &amp;&amp; aIndex &lt;= high) {</span>
<a href="#l9.11"></a><span id="l9.11">           this._count--;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-          // nuke</span>
<a href="#l9.13"></a><span id="l9.13">           if (aIndex == low &amp;&amp; aIndex == high) {</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+            // nuke</span>
<a href="#l9.15"></a><span id="l9.15">             this._ranges.splice(iTupe, 1);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-          }</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-          // lower shrink</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-          else if (aIndex == low) {</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+          } else if (aIndex == low) {</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+            // lower shrink</span>
<a href="#l9.21"></a><span id="l9.21">             this._ranges[iTupe][0] = aIndex + 1;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-          }</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-          // upper shrink</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-          else if (aIndex == high) {</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+          } else if (aIndex == high) {</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+            // upper shrink</span>
<a href="#l9.27"></a><span id="l9.27">             this._ranges[iTupe][1] = aIndex - 1;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-          }</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-          // split</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-          else {</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+          } else {</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+            // split</span>
<a href="#l9.33"></a><span id="l9.33">             this._ranges.splice(</span>
<a href="#l9.34"></a><span id="l9.34">               iTupe,</span>
<a href="#l9.35"></a><span id="l9.35">               1,</span>
<a href="#l9.36"></a><span id="l9.36">               [low, aIndex - 1],</span>
<a href="#l9.37"></a><span id="l9.37">               [aIndex + 1, high]</span>
<a href="#l9.38"></a><span id="l9.38">             );</span>
<a href="#l9.39"></a><span id="l9.39">           }</span>
<a href="#l9.40"></a><span id="l9.40">           break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/db/gloda/modules/datastore.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/datastore.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -248,23 +248,21 @@ QueryFromQueryCallback.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">         if (item.id in pendingIdMap) {</span>
<a href="#l10.5"></a><span id="l10.5">           continue;</span>
<a href="#l10.6"></a><span id="l10.6">         }</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8">         // QFQ_LOG.debug(&quot;loading item &quot; + nounDef.id + &quot;:&quot; + item.id + &quot; existing: &quot; +</span>
<a href="#l10.9"></a><span id="l10.9">         //    this.selfReferences[item.id] + &quot; cached: &quot; + cachedItem);</span>
<a href="#l10.10"></a><span id="l10.10">         if (cachedItem) {</span>
<a href="#l10.11"></a><span id="l10.11">           item = cachedItem;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-        }</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-        // we may already have been loaded by this process</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-        else if (this.selfReferences[item.id] != null) {</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+        } else if (this.selfReferences[item.id] != null) {</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+          // We may already have been loaded by this process.</span>
<a href="#l10.17"></a><span id="l10.17">           item = this.selfReferences[item.id];</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">-        }</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineminus">-        // perform loading logic which may produce reference dependencies</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-        else {</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+        } else {</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+          // Perform loading logic which may produce reference dependencies.</span>
<a href="#l10.23"></a><span id="l10.23">           this.needsLoads =</span>
<a href="#l10.24"></a><span id="l10.24">             GlodaDatastore.loadNounItem(</span>
<a href="#l10.25"></a><span id="l10.25">               item,</span>
<a href="#l10.26"></a><span id="l10.26">               this.referencesByNounID,</span>
<a href="#l10.27"></a><span id="l10.27">               this.inverseReferencesByNounID</span>
<a href="#l10.28"></a><span id="l10.28">             ) || this.needsLoads;</span>
<a href="#l10.29"></a><span id="l10.29">         }</span>
<a href="#l10.30"></a><span id="l10.30"> </span>
<a href="#l10.31"></a><span id="l10.31" class="difflineat">@@ -1787,21 +1785,21 @@ var GlodaDatastore = {</span>
<a href="#l10.32"></a><span id="l10.32"> </span>
<a href="#l10.33"></a><span id="l10.33">   /**</span>
<a href="#l10.34"></a><span id="l10.34">    * Helper that uses the appropriate getter given the data type; should be</span>
<a href="#l10.35"></a><span id="l10.35">    *  mooted once we move to 1.9.2 and can use built-in variant support.</span>
<a href="#l10.36"></a><span id="l10.36">    */</span>
<a href="#l10.37"></a><span id="l10.37">   _getVariant(aRow, aIndex) {</span>
<a href="#l10.38"></a><span id="l10.38">     let typeOfIndex = aRow.getTypeOfIndex(aIndex);</span>
<a href="#l10.39"></a><span id="l10.39">     if (typeOfIndex == Ci.mozIStorageValueArray.VALUE_TYPE_NULL) {</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+      // XPConnect would just end up going through an intermediary double stage</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+      // for the int64 case anyways...</span>
<a href="#l10.42"></a><span id="l10.42">       return null;</span>
<a href="#l10.43"></a><span id="l10.43">     }</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-    // XPConnect would just end up going through an intermediary double stage</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-    //  for the int64 case anyways...</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-    else if (</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+    if (</span>
<a href="#l10.48"></a><span id="l10.48">       typeOfIndex == Ci.mozIStorageValueArray.VALUE_TYPE_INTEGER ||</span>
<a href="#l10.49"></a><span id="l10.49">       typeOfIndex == Ci.mozIStorageValueArray.VALUE_TYPE_DOUBLE</span>
<a href="#l10.50"></a><span id="l10.50">     ) {</span>
<a href="#l10.51"></a><span id="l10.51">       return aRow.getDouble(aIndex);</span>
<a href="#l10.52"></a><span id="l10.52">     }</span>
<a href="#l10.53"></a><span id="l10.53">     // typeOfIndex == Ci.mozIStorageValueArray.VALUE_TYPE_TEXT</span>
<a href="#l10.54"></a><span id="l10.54">     return aRow.getString(aIndex);</span>
<a href="#l10.55"></a><span id="l10.55">   },</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineat">@@ -2170,32 +2168,31 @@ var GlodaDatastore = {</span>
<a href="#l10.57"></a><span id="l10.57">     // Do not walk into trash/junk folders, unless the user is explicitly</span>
<a href="#l10.58"></a><span id="l10.58">     //  telling us to do so.</span>
<a href="#l10.59"></a><span id="l10.59">     let specialFolderFlags =</span>
<a href="#l10.60"></a><span id="l10.60">       Ci.nsMsgFolderFlags.Trash | Ci.nsMsgFolderFlags.Junk;</span>
<a href="#l10.61"></a><span id="l10.61">     if (aFolder.isSpecialFolder(specialFolderFlags, true)) {</span>
<a href="#l10.62"></a><span id="l10.62">       indexingPriority = aAllowSpecialFolderIndexing</span>
<a href="#l10.63"></a><span id="l10.63">         ? GlodaFolder.prototype.kIndexingDefaultPriority</span>
<a href="#l10.64"></a><span id="l10.64">         : GlodaFolder.prototype.kIndexingNeverPriority;</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">-    }</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineminus">-    // Queue folders should always be ignored just because messages should not</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineminus">-    //  spend much time in there.</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineminus">-    // We hate newsgroups, and public IMAP folders are similar.</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-    // Other user IMAP folders should be ignored because it's not this user's</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineminus">-    //  mail.</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineminus">-    else if (</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+    } else if (</span>
<a href="#l10.73"></a><span id="l10.73">       aFolder.flags &amp;</span>
<a href="#l10.74"></a><span id="l10.74">       (Ci.nsMsgFolderFlags.Queue | Ci.nsMsgFolderFlags.Newsgroup)</span>
<a href="#l10.75"></a><span id="l10.75">       // In unit testing at least folders can be</span>
<a href="#l10.76"></a><span id="l10.76">       // confusingly labeled ImapPublic when they</span>
<a href="#l10.77"></a><span id="l10.77">       // should not be.  Or at least I don't think they</span>
<a href="#l10.78"></a><span id="l10.78">       // should be.  So they're legit for now.</span>
<a href="#l10.79"></a><span id="l10.79">       // | Ci.nsMsgFolderFlags.ImapPublic</span>
<a href="#l10.80"></a><span id="l10.80">       // | Ci.nsMsgFolderFlags.ImapOtherUser</span>
<a href="#l10.81"></a><span id="l10.81">     ) {</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+      // Queue folders should always be ignored just because messages should not</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+      // spend much time in there.</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+      // We hate newsgroups, and public IMAP folders are similar.</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+      // Other user IMAP folders should be ignored because it's not this user's</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+      // mail.</span>
<a href="#l10.87"></a><span id="l10.87">       indexingPriority = GlodaFolder.prototype.kIndexingNeverPriority;</span>
<a href="#l10.88"></a><span id="l10.88">     } else if (aFolder.flags &amp; Ci.nsMsgFolderFlags.Inbox) {</span>
<a href="#l10.89"></a><span id="l10.89">       indexingPriority = GlodaFolder.prototype.kIndexingInboxPriority;</span>
<a href="#l10.90"></a><span id="l10.90">     } else if (aFolder.flags &amp; Ci.nsMsgFolderFlags.SentMail) {</span>
<a href="#l10.91"></a><span id="l10.91">       indexingPriority = GlodaFolder.prototype.kIndexingSentMailPriority;</span>
<a href="#l10.92"></a><span id="l10.92">     } else if (aFolder.flags &amp; Ci.nsMsgFolderFlags.Favorite) {</span>
<a href="#l10.93"></a><span id="l10.93">       indexingPriority = GlodaFolder.prototype.kIndexingFavoritePriority;</span>
<a href="#l10.94"></a><span id="l10.94">     } else if (aFolder.flags &amp; Ci.nsMsgFolderFlags.CheckNew) {</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineat">@@ -2221,19 +2218,18 @@ var GlodaDatastore = {</span>
<a href="#l10.96"></a><span id="l10.96"> </span>
<a href="#l10.97"></a><span id="l10.97">     let folderID = this._nextFolderId++;</span>
<a href="#l10.98"></a><span id="l10.98"> </span>
<a href="#l10.99"></a><span id="l10.99">     // if there's an indexingPriority stored on the folder, just use that</span>
<a href="#l10.100"></a><span id="l10.100">     let indexingPriority;</span>
<a href="#l10.101"></a><span id="l10.101">     let stringPrio = aFolder.getStringProperty(&quot;indexingPriority&quot;);</span>
<a href="#l10.102"></a><span id="l10.102">     if (stringPrio.length) {</span>
<a href="#l10.103"></a><span id="l10.103">       indexingPriority = parseInt(stringPrio);</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-    }</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineminus">-    // otherwise, fall back to the default for folders of this type</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-    else {</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+    } else {</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+      // Otherwise, fall back to the default for folders of this type.</span>
<a href="#l10.109"></a><span id="l10.109">       indexingPriority = this.getDefaultIndexingPriority(aFolder);</span>
<a href="#l10.110"></a><span id="l10.110">     }</span>
<a href="#l10.111"></a><span id="l10.111"> </span>
<a href="#l10.112"></a><span id="l10.112">     // If there are messages in the folder, it is filthy.  If there are no</span>
<a href="#l10.113"></a><span id="l10.113">     //  messages, it can be clean.</span>
<a href="#l10.114"></a><span id="l10.114">     let dirtyStatus = aFolder.getTotalMessages(false)</span>
<a href="#l10.115"></a><span id="l10.115">       ? GlodaFolder.prototype.kFolderFilthy</span>
<a href="#l10.116"></a><span id="l10.116">       : GlodaFolder.prototype.kFolderClean;</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineat">@@ -3541,18 +3537,18 @@ var GlodaDatastore = {</span>
<a href="#l10.118"></a><span id="l10.118">               objectNounDef.toParamAndValue(upperVal)[1]</span>
<a href="#l10.119"></a><span id="l10.119">           );</span>
<a href="#l10.120"></a><span id="l10.120">         } else if (upperVal == null) {</span>
<a href="#l10.121"></a><span id="l10.121">           dbStrings.push(</span>
<a href="#l10.122"></a><span id="l10.122">             aValueColumnName +</span>
<a href="#l10.123"></a><span id="l10.123">               &quot; &gt;= &quot; +</span>
<a href="#l10.124"></a><span id="l10.124">               objectNounDef.toParamAndValue(lowerVal)[1]</span>
<a href="#l10.125"></a><span id="l10.125">           );</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineminus">-        } // no one is null!</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineminus">-        else {</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineplus">+        } else {</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineplus">+          // No one is null!</span>
<a href="#l10.130"></a><span id="l10.130">           dbStrings.push(</span>
<a href="#l10.131"></a><span id="l10.131">             aValueColumnName +</span>
<a href="#l10.132"></a><span id="l10.132">               &quot; BETWEEN &quot; +</span>
<a href="#l10.133"></a><span id="l10.133">               objectNounDef.toParamAndValue(lowerVal)[1] +</span>
<a href="#l10.134"></a><span id="l10.134">               &quot; AND &quot; +</span>
<a href="#l10.135"></a><span id="l10.135">               objectNounDef.toParamAndValue(upperVal)[1]</span>
<a href="#l10.136"></a><span id="l10.136">           );</span>
<a href="#l10.137"></a><span id="l10.137">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/db/gloda/modules/gloda.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/gloda.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -342,18 +342,18 @@ var Gloda = {</span>
<a href="#l11.4"></a><span id="l11.4">     let clause;</span>
<a href="#l11.5"></a><span id="l11.5">     // build a query, using a separate union clause for each folder.</span>
<a href="#l11.6"></a><span id="l11.6">     for (let folderURI in headersByFolder) {</span>
<a href="#l11.7"></a><span id="l11.7">       let headersForFolder = headersByFolder[folderURI];</span>
<a href="#l11.8"></a><span id="l11.8">       let folder = this.getFolderForFolder(headersForFolder[0].folder);</span>
<a href="#l11.9"></a><span id="l11.9">       // if this is the first or clause, just use the query itself</span>
<a href="#l11.10"></a><span id="l11.10">       if (!clause) {</span>
<a href="#l11.11"></a><span id="l11.11">         clause = query;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-      } // create a new query clause via the 'or' command</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-      else {</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+      } else {</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+        // Create a new query clause via the 'or' command.</span>
<a href="#l11.16"></a><span id="l11.16">         clause = query.or();</span>
<a href="#l11.17"></a><span id="l11.17">       }</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19">       clause.folder(folder);</span>
<a href="#l11.20"></a><span id="l11.20">       let messageKeys = headersForFolder.map(hdr =&gt; hdr.messageKey);</span>
<a href="#l11.21"></a><span id="l11.21">       clause.messageKey.apply(clause, messageKeys);</span>
<a href="#l11.22"></a><span id="l11.22">     }</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24" class="difflineat">@@ -498,18 +498,18 @@ var Gloda = {</span>
<a href="#l11.25"></a><span id="l11.25">       contact._identities = [identity];</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27">       // give the address book indexer a chance if we have a card.</span>
<a href="#l11.28"></a><span id="l11.28">       // (it will fix-up the name based on the card as appropriate)</span>
<a href="#l11.29"></a><span id="l11.29">       if (card) {</span>
<a href="#l11.30"></a><span id="l11.30">         yield aCallbackHandle.pushAndGo(</span>
<a href="#l11.31"></a><span id="l11.31">           Gloda.grokNounItem(contact, { card }, true, true, aCallbackHandle)</span>
<a href="#l11.32"></a><span id="l11.32">         );</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-      } // grokNounItem will issue the insert for us...</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-      else {</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+      } else {</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+        // grokNounItem will issue the insert for us...</span>
<a href="#l11.37"></a><span id="l11.37">         GlodaDatastore.insertContact(contact);</span>
<a href="#l11.38"></a><span id="l11.38">       }</span>
<a href="#l11.39"></a><span id="l11.39"> </span>
<a href="#l11.40"></a><span id="l11.40">       for (let iResList = 1; iResList &lt; nameAndResultLists.length; iResList++) {</span>
<a href="#l11.41"></a><span id="l11.41">         nameAndResultLists[iResList].push(identity);</span>
<a href="#l11.42"></a><span id="l11.42">       }</span>
<a href="#l11.43"></a><span id="l11.43">     }</span>
<a href="#l11.44"></a><span id="l11.44"> </span>
<a href="#l11.45"></a><span id="l11.45" class="difflineat">@@ -2384,19 +2384,18 @@ var Gloda = {</span>
<a href="#l11.46"></a><span id="l11.46">           );</span>
<a href="#l11.47"></a><span id="l11.47">         }</span>
<a href="#l11.48"></a><span id="l11.48"> </span>
<a href="#l11.49"></a><span id="l11.49">         // Add/remove the empty set indicator as appropriate.</span>
<a href="#l11.50"></a><span id="l11.50">         if (attrib.emptySetIsSignificant) {</span>
<a href="#l11.51"></a><span id="l11.51">           // if we are now non-zero but previously were zero, remove.</span>
<a href="#l11.52"></a><span id="l11.52">           if (value.length &amp;&amp; !oldValue.length) {</span>
<a href="#l11.53"></a><span id="l11.53">             removeDBAttribs.push([GlodaDatastore.kEmptySetAttrId, attribDB.id]);</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineminus">-          }</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineminus">-          // if we are now zero length but previously were not, add</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-          else if (!value.length &amp;&amp; oldValue.length) {</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+          } else if (!value.length &amp;&amp; oldValue.length) {</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+            // We are now zero length but previously were not, add.</span>
<a href="#l11.59"></a><span id="l11.59">             addDBAttribs.push([GlodaDatastore.kEmptySetAttrId, attribDB.id]);</span>
<a href="#l11.60"></a><span id="l11.60">           }</span>
<a href="#l11.61"></a><span id="l11.61">         }</span>
<a href="#l11.62"></a><span id="l11.62">       } else {</span>
<a href="#l11.63"></a><span id="l11.63">         // no old value, all values are new</span>
<a href="#l11.64"></a><span id="l11.64">         // add the db reps on the new values</span>
<a href="#l11.65"></a><span id="l11.65">         if (attrib.singular) {</span>
<a href="#l11.66"></a><span id="l11.66">           value = [value];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/db/gloda/modules/index_msg.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/index_msg.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1647,20 +1647,19 @@ var GlodaMsgIndexer = {</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5">       let msgHdr;</span>
<a href="#l12.6"></a><span id="l12.6">       // GetMessageHeader can be affected by the use cache, so we need to check</span>
<a href="#l12.7"></a><span id="l12.7">       //  ContainsKey first to see if the header is really actually there.</span>
<a href="#l12.8"></a><span id="l12.8">       if (typeof item[1] == &quot;number&quot;) {</span>
<a href="#l12.9"></a><span id="l12.9">         msgHdr =</span>
<a href="#l12.10"></a><span id="l12.10">           this._indexingDatabase.ContainsKey(item[1]) &amp;&amp;</span>
<a href="#l12.11"></a><span id="l12.11">           this._indexingFolder.GetMessageHeader(item[1]);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-      }</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-      // same deal as in move processing.</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-      // TODO fixme to not assume singular message-id's.</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-      else {</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+      } else {</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+        // Same deal as in move processing.</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+        // TODO fixme to not assume singular message-id's.</span>
<a href="#l12.19"></a><span id="l12.19">         msgHdr = this._indexingDatabase.getMsgHdrForMessageID(item[1]);</span>
<a href="#l12.20"></a><span id="l12.20">       }</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22">       if (msgHdr) {</span>
<a href="#l12.23"></a><span id="l12.23">         yield aCallbackHandle.pushAndGo(</span>
<a href="#l12.24"></a><span id="l12.24">           this._indexMessage(msgHdr, aCallbackHandle),</span>
<a href="#l12.25"></a><span id="l12.25">           { what: &quot;indexMessage&quot;, msgHdr }</span>
<a href="#l12.26"></a><span id="l12.26">         );</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineat">@@ -3339,25 +3338,24 @@ var GlodaMsgIndexer = {</span>
<a href="#l12.28"></a><span id="l12.28">         // if (we are in the same folder and) the candidate message has a null</span>
<a href="#l12.29"></a><span id="l12.29">         //  message key, we treat it as our best option unless we find an exact</span>
<a href="#l12.30"></a><span id="l12.30">         //  key match. (this would happen because the 'move' notification case</span>
<a href="#l12.31"></a><span id="l12.31">         //  has to deal with not knowing the target message key.  this case</span>
<a href="#l12.32"></a><span id="l12.32">         //  will hopefully be somewhat improved in the future to not go through</span>
<a href="#l12.33"></a><span id="l12.33">         //  this path which mandates re-indexing of the message in its entirety)</span>
<a href="#l12.34"></a><span id="l12.34">         if (candMsg.messageKey === null) {</span>
<a href="#l12.35"></a><span id="l12.35">           curMsg = candMsg;</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-        }</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-        // if (we are in the same folder and) the candidate message's underlying</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-        //  message no longer exists/matches, we'll assume we are the same but</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-        //  were betrayed by a re-indexing or something, but we have to make</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-        //  sure a perfect match doesn't turn up.</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-        else if (</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+        } else if (</span>
<a href="#l12.43"></a><span id="l12.43">           curMsg === null &amp;&amp;</span>
<a href="#l12.44"></a><span id="l12.44">           !this._indexingDatabase.ContainsKey(candMsg.messageKey)</span>
<a href="#l12.45"></a><span id="l12.45">         ) {</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineplus">+          // (We are in the same folder and) the candidate message's underlying</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+          // message no longer exists/matches. Assume we are the same but</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+          // were betrayed by a re-indexing or something, but we have to make</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+          // sure a perfect match doesn't turn up.</span>
<a href="#l12.50"></a><span id="l12.50">           curMsg = candMsg;</span>
<a href="#l12.51"></a><span id="l12.51">         }</span>
<a href="#l12.52"></a><span id="l12.52">       } else if (curMsg === null &amp;&amp; candMsg.folderID === null) {</span>
<a href="#l12.53"></a><span id="l12.53">         // a ghost/deleted message is fine</span>
<a href="#l12.54"></a><span id="l12.54">         curMsg = candMsg;</span>
<a href="#l12.55"></a><span id="l12.55">       }</span>
<a href="#l12.56"></a><span id="l12.56">     }</span>
<a href="#l12.57"></a><span id="l12.57"> </span>
<a href="#l12.58"></a><span id="l12.58" class="difflineat">@@ -3500,20 +3498,19 @@ var GlodaMsgIndexer = {</span>
<a href="#l12.59"></a><span id="l12.59">     for (let convMsg of conversationMsgs) {</span>
<a href="#l12.60"></a><span id="l12.60">       // ignore our own message</span>
<a href="#l12.61"></a><span id="l12.61">       if (convMsg.id == aMessage.id) {</span>
<a href="#l12.62"></a><span id="l12.62">         continue;</span>
<a href="#l12.63"></a><span id="l12.63">       }</span>
<a href="#l12.64"></a><span id="l12.64"> </span>
<a href="#l12.65"></a><span id="l12.65">       if (convMsg._isGhost) {</span>
<a href="#l12.66"></a><span id="l12.66">         ghostCount++;</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-      }</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-      // This message is our (living) twin if it is not a ghost, not deleted,</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-      //  and has the same message-id header.</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-      else if (</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+      } else if (</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+        // This message is our (living) twin if it is not a ghost, not deleted,</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+        // and has the same message-id header.</span>
<a href="#l12.74"></a><span id="l12.74">         !convMsg._isDeleted &amp;&amp;</span>
<a href="#l12.75"></a><span id="l12.75">         convMsg.headerMessageID == aMessage.headerMessageID</span>
<a href="#l12.76"></a><span id="l12.76">       ) {</span>
<a href="#l12.77"></a><span id="l12.77">         twinMessageExists = true;</span>
<a href="#l12.78"></a><span id="l12.78">       }</span>
<a href="#l12.79"></a><span id="l12.79">     }</span>
<a href="#l12.80"></a><span id="l12.80"> </span>
<a href="#l12.81"></a><span id="l12.81">     // -- If everyone else is a ghost, blow away the conversation.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/db/gloda/modules/indexer.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/indexer.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -853,18 +853,18 @@ var GlodaIndexer = {</span>
<a href="#l13.4"></a><span id="l13.4">         args = aArgs;</span>
<a href="#l13.5"></a><span id="l13.5">       }</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7">       let result;</span>
<a href="#l13.8"></a><span id="l13.8">       if (args.length == 0) {</span>
<a href="#l13.9"></a><span id="l13.9">         result = this._batch.next().value;</span>
<a href="#l13.10"></a><span id="l13.10">       } else if (args.length == 1) {</span>
<a href="#l13.11"></a><span id="l13.11">         result = this._batch.next(args[0]).value;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-      } // arguments works with destructuring assignment</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-      else {</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+      } else {</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+        // Arguments works with destructuring assignment.</span>
<a href="#l13.16"></a><span id="l13.16">         result = this._batch.next(args).value;</span>
<a href="#l13.17"></a><span id="l13.17">       }</span>
<a href="#l13.18"></a><span id="l13.18">       switch (result) {</span>
<a href="#l13.19"></a><span id="l13.19">         // job's done, close the batch and re-schedule ourselves if there's more</span>
<a href="#l13.20"></a><span id="l13.20">         //  to do.</span>
<a href="#l13.21"></a><span id="l13.21">         case this.kWorkDone:</span>
<a href="#l13.22"></a><span id="l13.22">           this._batch.return();</span>
<a href="#l13.23"></a><span id="l13.23">           this._batch = null;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineat">@@ -1006,19 +1006,18 @@ var GlodaIndexer = {</span>
<a href="#l13.25"></a><span id="l13.25">    *  tokens available, workBatch will keep driving the activeIterator until it</span>
<a href="#l13.26"></a><span id="l13.26">    *  encounters a kWorkAsync (which workBatch will yield to callbackDriver), or</span>
<a href="#l13.27"></a><span id="l13.27">    *  it runs out of tokens and yields a kWorkPause or kWorkDone.</span>
<a href="#l13.28"></a><span id="l13.28">    */</span>
<a href="#l13.29"></a><span id="l13.29">   *workBatch() {</span>
<a href="#l13.30"></a><span id="l13.30">     // Do we still have an open transaction? If not, start a new one.</span>
<a href="#l13.31"></a><span id="l13.31">     if (!this._idleToCommit) {</span>
<a href="#l13.32"></a><span id="l13.32">       GlodaDatastore._beginTransaction();</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-    }</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-    // We'll manage commit ourself while this routine is active.</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-    else {</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+    } else {</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+      // We'll manage commit ourself while this routine is active.</span>
<a href="#l13.38"></a><span id="l13.38">       this._idleToCommit = false;</span>
<a href="#l13.39"></a><span id="l13.39">     }</span>
<a href="#l13.40"></a><span id="l13.40"> </span>
<a href="#l13.41"></a><span id="l13.41">     this._perfIndexStopwatch.start();</span>
<a href="#l13.42"></a><span id="l13.42">     let batchCount;</span>
<a href="#l13.43"></a><span id="l13.43">     let haveMoreWork = true;</span>
<a href="#l13.44"></a><span id="l13.44">     let transactionToCommit = true;</span>
<a href="#l13.45"></a><span id="l13.45">     let inIdle;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/db/gloda/modules/mimemsg.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/mimemsg.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -527,20 +527,19 @@ MimeContainer.prototype = {</span>
<a href="#l14.4"></a><span id="l14.4">       let htmlPart;</span>
<a href="#l14.5"></a><span id="l14.5">       // pick the text/plain if we can find one, otherwise remember the HTML one</span>
<a href="#l14.6"></a><span id="l14.6">       for (let part of this.parts) {</span>
<a href="#l14.7"></a><span id="l14.7">         if (part.contentType == &quot;text/plain&quot;) {</span>
<a href="#l14.8"></a><span id="l14.8">           return part.body;</span>
<a href="#l14.9"></a><span id="l14.9">         }</span>
<a href="#l14.10"></a><span id="l14.10">         if (part.contentType == &quot;text/html&quot;) {</span>
<a href="#l14.11"></a><span id="l14.11">           htmlPart = part;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-        }</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-        // text/enriched gets transformed into HTML, use it if we don't already</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-        //  have an HTML part.</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-        else if (!htmlPart &amp;&amp; part.contentType == &quot;text/enriched&quot;) {</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+        } else if (!htmlPart &amp;&amp; part.contentType == &quot;text/enriched&quot;) {</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+          // text/enriched gets transformed into HTML, so use it if we don't</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+          // already have an HTML part.</span>
<a href="#l14.19"></a><span id="l14.19">           htmlPart = part;</span>
<a href="#l14.20"></a><span id="l14.20">         }</span>
<a href="#l14.21"></a><span id="l14.21">       }</span>
<a href="#l14.22"></a><span id="l14.22">       // convert the HTML part if we have one</span>
<a href="#l14.23"></a><span id="l14.23">       if (htmlPart) {</span>
<a href="#l14.24"></a><span id="l14.24">         return aMsgFolder.convertMsgSnippetToPlainText(htmlPart.body);</span>
<a href="#l14.25"></a><span id="l14.25">       }</span>
<a href="#l14.26"></a><span id="l14.26">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/db/gloda/modules/msg_search.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/msg_search.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -159,29 +159,28 @@ function scoreOffsets(aMessage, aContext</span>
<a href="#l15.4"></a><span id="l15.4">   for (let i = 0; i &lt; offsetNums.length; i += 4) {</span>
<a href="#l15.5"></a><span id="l15.5">     let columnIndex = offsetNums[i];</span>
<a href="#l15.6"></a><span id="l15.6">     let termIndex = offsetNums[i + 1];</span>
<a href="#l15.7"></a><span id="l15.7">     columnTermIncidence[columnIndex][termIndex]++;</span>
<a href="#l15.8"></a><span id="l15.8">   }</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">   for (let iColumn = 0; iColumn &lt; COLUMN_ALL_MATCH_SCORES.length; iColumn++) {</span>
<a href="#l15.11"></a><span id="l15.11">     let termIncidence = columnTermIncidence[iColumn];</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    // bestow all match credit</span>
<a href="#l15.13"></a><span id="l15.13">     if (termIncidence.every(identityFunc)) {</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+      // Bestow all match credit.</span>
<a href="#l15.15"></a><span id="l15.15">       score += COLUMN_ALL_MATCH_SCORES[iColumn];</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-    }</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-    // bestow partial match credit</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-    else if (termIncidence.some(identityFunc)) {</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+    } else if (termIncidence.some(identityFunc)) {</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+      // Bestow partial match credit.</span>
<a href="#l15.21"></a><span id="l15.21">       score += Math.min(</span>
<a href="#l15.22"></a><span id="l15.22">         COLUMN_ALL_MATCH_SCORES[iColumn],</span>
<a href="#l15.23"></a><span id="l15.23">         COLUMN_PARTIAL_PER_MATCH_SCORES[iColumn] *</span>
<a href="#l15.24"></a><span id="l15.24">           termIncidence.filter(identityFunc).length</span>
<a href="#l15.25"></a><span id="l15.25">       );</span>
<a href="#l15.26"></a><span id="l15.26">     }</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-    // bestow multiple match credit</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineplus">+    // Bestow multiple match credit.</span>
<a href="#l15.29"></a><span id="l15.29">     score +=</span>
<a href="#l15.30"></a><span id="l15.30">       Math.min(</span>
<a href="#l15.31"></a><span id="l15.31">         termIncidence.map(oneLessMaxZero).reduce(reduceSum, 0),</span>
<a href="#l15.32"></a><span id="l15.32">         COLUMN_MULTIPLE_MATCH_LIMIT[iColumn]</span>
<a href="#l15.33"></a><span id="l15.33">       ) * COLUMN_MULTIPLE_MATCH_SCORES[iColumn];</span>
<a href="#l15.34"></a><span id="l15.34">   }</span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36">   return score;</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineat">@@ -281,21 +280,19 @@ GlodaMsgSearcher.prototype = {</span>
<a href="#l15.38"></a><span id="l15.38">         fulltextQueryString += this.andTerms ? &quot; &quot; : &quot; OR &quot;;</span>
<a href="#l15.39"></a><span id="l15.39">       }</span>
<a href="#l15.40"></a><span id="l15.40"> </span>
<a href="#l15.41"></a><span id="l15.41">       // Put our term in quotes.  This is needed for the tokenizer to be able</span>
<a href="#l15.42"></a><span id="l15.42">       //  to do useful things.  The exception is people clever enough to use</span>
<a href="#l15.43"></a><span id="l15.43">       //  NEAR.</span>
<a href="#l15.44"></a><span id="l15.44">       if (/^NEAR(\/\d+)?$/.test(term)) {</span>
<a href="#l15.45"></a><span id="l15.45">         fulltextQueryString += term;</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-      }</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineminus">-      // Check if this is a single-character CJK search query.  If so, we want</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">-      //  to add a wildcard.</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-      // Our tokenizer treats anything at/above 0x2000 as CJK for now.</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-      else if (term.length == 1 &amp;&amp; term.charCodeAt(0) &gt;= 0x2000) {</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineplus">+      } else if (term.length == 1 &amp;&amp; term.charCodeAt(0) &gt;= 0x2000) {</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineplus">+        // This is a single-character CJK search query, so add a wildcard.</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineplus">+        // Our tokenizer treats anything at/above 0x2000 as CJK for now.</span>
<a href="#l15.54"></a><span id="l15.54">         fulltextQueryString += term + &quot;*&quot;;</span>
<a href="#l15.55"></a><span id="l15.55">       } else if (</span>
<a href="#l15.56"></a><span id="l15.56">         (term.length == 2 &amp;&amp;</span>
<a href="#l15.57"></a><span id="l15.57">           term.charCodeAt(0) &gt;= 0x2000 &amp;&amp;</span>
<a href="#l15.58"></a><span id="l15.58">           term.charCodeAt(1) &gt;= 0x2000) ||</span>
<a href="#l15.59"></a><span id="l15.59">         term.length &gt;= 3</span>
<a href="#l15.60"></a><span id="l15.60">       ) {</span>
<a href="#l15.61"></a><span id="l15.61">         fulltextQueryString += '&quot;' + term + '&quot;';</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/resources/mockTimer.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/resources/mockTimer.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -11,18 +11,18 @@ function MockTimer(aObj, aAttrName) {</span>
<a href="#l16.4"></a><span id="l16.4"> MockTimer.prototype = {</span>
<a href="#l16.5"></a><span id="l16.5">   /* public interface */</span>
<a href="#l16.6"></a><span id="l16.6">   TYPE_ONE_SHOT: 0,</span>
<a href="#l16.7"></a><span id="l16.7">   TYPE_REPEATING_SLACK: 1,</span>
<a href="#l16.8"></a><span id="l16.8">   TYPE_REPEATING_PRECISE: 2,</span>
<a href="#l16.9"></a><span id="l16.9">   initWithCallback(aCallback, aDelay, aType) {</span>
<a href="#l16.10"></a><span id="l16.10">     if (aCallback instanceof Ci.nsITimerCallback) {</span>
<a href="#l16.11"></a><span id="l16.11">       this.callback = aCallback;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    } // it was just a function that we need to dress up.</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-    else {</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+    } else {</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+      // It was just a function that we need to dress up.</span>
<a href="#l16.16"></a><span id="l16.16">       this.callback = {</span>
<a href="#l16.17"></a><span id="l16.17">         notify() {</span>
<a href="#l16.18"></a><span id="l16.18">           aCallback();</span>
<a href="#l16.19"></a><span id="l16.19">         },</span>
<a href="#l16.20"></a><span id="l16.20">       };</span>
<a href="#l16.21"></a><span id="l16.21">     }</span>
<a href="#l16.22"></a><span id="l16.22">     this.delay = aDelay;</span>
<a href="#l16.23"></a><span id="l16.23">     this.type = aType;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -389,19 +389,18 @@ var junkListener = {</span>
<a href="#l17.4"></a><span id="l17.4">     // checks of aJunkPercent</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6">     if (command == kClassJ || command == kClassT) {</span>
<a href="#l17.7"></a><span id="l17.7">       // classify returns the actual junk percents</span>
<a href="#l17.8"></a><span id="l17.8">       Assert.equal(Math.abs(junkPercent), aJunkPercent);</span>
<a href="#l17.9"></a><span id="l17.9">     } else if (command == kTrainJ || command == kTrainT) {</span>
<a href="#l17.10"></a><span id="l17.10">       // train returns the ham and spam limits</span>
<a href="#l17.11"></a><span id="l17.11">       Assert.equal(aJunkPercent, junkPercent &lt; 90 ? kIsHamScore : kIsSpamScore);</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    }</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-    // forget always returns 0</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-    else {</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+    } else {</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+      // Forget always returns 0.</span>
<a href="#l17.17"></a><span id="l17.17">       Assert.equal(aJunkPercent, 0);</span>
<a href="#l17.18"></a><span id="l17.18">     }</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20">     // if the current test includes a trait listener, it will</span>
<a href="#l17.21"></a><span id="l17.21">     // run next, so we defer to it for starting the next command</span>
<a href="#l17.22"></a><span id="l17.22">     if (gTest.traitListener) {</span>
<a href="#l17.23"></a><span id="l17.23">       return;</span>
<a href="#l17.24"></a><span id="l17.24">     }</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineat">@@ -429,19 +428,18 @@ var traitListener = {</span>
<a href="#l17.26"></a><span id="l17.26">       // &quot;forgets&quot; with null newClassifications does not return a percent</span>
<a href="#l17.27"></a><span id="l17.27">       Assert.equal(aPercents.length, 0);</span>
<a href="#l17.28"></a><span id="l17.28">     } else {</span>
<a href="#l17.29"></a><span id="l17.29">       var percent = aPercents[0];</span>
<a href="#l17.30"></a><span id="l17.30">       // print(&quot;Percent is &quot; + percent);</span>
<a href="#l17.31"></a><span id="l17.31">       if (command == kClassJ || command == kClassT) {</span>
<a href="#l17.32"></a><span id="l17.32">         // Classify returns actual percents</span>
<a href="#l17.33"></a><span id="l17.33">         Assert.equal(percent, junkPercent);</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">-      }</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-      // Train simply returns 100</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-      else {</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+      } else {</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+        // Train simply returns 100.</span>
<a href="#l17.39"></a><span id="l17.39">         Assert.equal(percent, 100);</span>
<a href="#l17.40"></a><span id="l17.40">       }</span>
<a href="#l17.41"></a><span id="l17.41">     }</span>
<a href="#l17.42"></a><span id="l17.42"> </span>
<a href="#l17.43"></a><span id="l17.43">     // checks of aTraits</span>
<a href="#l17.44"></a><span id="l17.44"> </span>
<a href="#l17.45"></a><span id="l17.45">     if (command == kForgetJ || command == kForgetT) {</span>
<a href="#l17.46"></a><span id="l17.46">       // &quot;forgets&quot; with null newClassifications does not return a</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/test/fakeserver/imapd.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/test/fakeserver/imapd.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -2427,18 +2427,18 @@ var IMAP_RFC2195_extension = {</span>
<a href="#l18.4"></a><span id="l18.4">     this._multiline = true;</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">     return &quot;+ &quot; + btoa(&quot;Username:&quot;);</span>
<a href="#l18.7"></a><span id="l18.7">   },</span>
<a href="#l18.8"></a><span id="l18.8">   authLOGINUsername(line) {</span>
<a href="#l18.9"></a><span id="l18.9">     var req = AuthLOGIN.decodeLine(line);</span>
<a href="#l18.10"></a><span id="l18.10">     if (req == this.kUsername) {</span>
<a href="#l18.11"></a><span id="l18.11">       this._nextAuthFunction = this.authLOGINPassword;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    } // Don't return error yet, to not reveal valid usernames</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-    else {</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+    } else {</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+      // Don't return error yet, to not reveal valid usernames</span>
<a href="#l18.16"></a><span id="l18.16">       this._nextAuthFunction = this.authLOGINBadUsername;</span>
<a href="#l18.17"></a><span id="l18.17">     }</span>
<a href="#l18.18"></a><span id="l18.18">     this._multiline = true;</span>
<a href="#l18.19"></a><span id="l18.19">     return &quot;+ &quot; + btoa(&quot;Password:&quot;);</span>
<a href="#l18.20"></a><span id="l18.20">   },</span>
<a href="#l18.21"></a><span id="l18.21">   authLOGINBadUsername(line) {</span>
<a href="#l18.22"></a><span id="l18.22">     return &quot;BAD Wrong username or password, crook!&quot;;</span>
<a href="#l18.23"></a><span id="l18.23">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/test/fakeserver/pop3d.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/test/fakeserver/pop3d.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -84,19 +84,18 @@ pop3Daemon.prototype = {</span>
<a href="#l19.4"></a><span id="l19.4">   setMessages(messages) {</span>
<a href="#l19.5"></a><span id="l19.5">     this._messages = [];</span>
<a href="#l19.6"></a><span id="l19.6">     this._totalMessageSize = 0;</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8">     function addMessage(element) {</span>
<a href="#l19.9"></a><span id="l19.9">       // if it's a string, then it's a file-name.</span>
<a href="#l19.10"></a><span id="l19.10">       if (typeof element == &quot;string&quot;) {</span>
<a href="#l19.11"></a><span id="l19.11">         this._messages.push({ fileData: readFile(element), size: -1 });</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-      }</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-      // otherwise it's an object as dictionary already</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-      else {</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+      } else {</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+        // Otherwise it's an object as dictionary already.</span>
<a href="#l19.17"></a><span id="l19.17">         this._messages.push(element);</span>
<a href="#l19.18"></a><span id="l19.18">       }</span>
<a href="#l19.19"></a><span id="l19.19">     }</span>
<a href="#l19.20"></a><span id="l19.20">     messages.forEach(addMessage, this);</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22">     for (var i = 0; i &lt; this._messages.length; ++i) {</span>
<a href="#l19.23"></a><span id="l19.23">       this._messages[i].size = this._messages[i].fileData.length;</span>
<a href="#l19.24"></a><span id="l19.24">       this._messages[i].uidl = &quot;UIDL&quot; + gUIDLCount++;</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineat">@@ -422,18 +421,18 @@ POP3_RFC5034_handler.prototype = {</span>
<a href="#l19.26"></a><span id="l19.26">     this._multiline = true;</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">     return &quot;+ &quot; + btoa(&quot;Username:&quot;);</span>
<a href="#l19.29"></a><span id="l19.29">   },</span>
<a href="#l19.30"></a><span id="l19.30">   authLOGINUsername(line) {</span>
<a href="#l19.31"></a><span id="l19.31">     var req = AuthLOGIN.decodeLine(line);</span>
<a href="#l19.32"></a><span id="l19.32">     if (req == this.kUsername) {</span>
<a href="#l19.33"></a><span id="l19.33">       this._nextAuthFunction = this.authLOGINPassword;</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">-    } // Don't return error yet, to not reveal valid usernames</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineminus">-    else {</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+    } else {</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+      // Don't return error yet, to not reveal valid usernames.</span>
<a href="#l19.38"></a><span id="l19.38">       this._nextAuthFunction = this.authLOGINBadUsername;</span>
<a href="#l19.39"></a><span id="l19.39">     }</span>
<a href="#l19.40"></a><span id="l19.40">     this._multiline = true;</span>
<a href="#l19.41"></a><span id="l19.41">     return &quot;+ &quot; + btoa(&quot;Password:&quot;);</span>
<a href="#l19.42"></a><span id="l19.42">   },</span>
<a href="#l19.43"></a><span id="l19.43">   authLOGINBadUsername(line) {</span>
<a href="#l19.44"></a><span id="l19.44">     if (this.dropOnAuthFailure) {</span>
<a href="#l19.45"></a><span id="l19.45">       this.closing = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/test/fakeserver/smtpd.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/test/fakeserver/smtpd.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -188,18 +188,18 @@ SMTP_RFC2821_handler.prototype = {</span>
<a href="#l20.4"></a><span id="l20.4">     this._multiline = true;</span>
<a href="#l20.5"></a><span id="l20.5"> </span>
<a href="#l20.6"></a><span id="l20.6">     return &quot;334 &quot; + btoa(&quot;Username:&quot;);</span>
<a href="#l20.7"></a><span id="l20.7">   },</span>
<a href="#l20.8"></a><span id="l20.8">   authLOGINUsername(line) {</span>
<a href="#l20.9"></a><span id="l20.9">     var req = AuthLOGIN.decodeLine(line);</span>
<a href="#l20.10"></a><span id="l20.10">     if (req == this.kUsername) {</span>
<a href="#l20.11"></a><span id="l20.11">       this._nextAuthFunction = this.authLOGINPassword;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    } // Don't return error yet, to not reveal valid usernames</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-    else {</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+    } else {</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+      // Don't return error yet, to not reveal valid usernames.</span>
<a href="#l20.16"></a><span id="l20.16">       this._nextAuthFunction = this.authLOGINBadUsername;</span>
<a href="#l20.17"></a><span id="l20.17">     }</span>
<a href="#l20.18"></a><span id="l20.18">     this._multiline = true;</span>
<a href="#l20.19"></a><span id="l20.19">     return &quot;334 &quot; + btoa(&quot;Password:&quot;);</span>
<a href="#l20.20"></a><span id="l20.20">   },</span>
<a href="#l20.21"></a><span id="l20.21">   authLOGINBadUsername(line) {</span>
<a href="#l20.22"></a><span id="l20.22">     if (this.dropOnAuthFailure) {</span>
<a href="#l20.23"></a><span id="l20.23">       this.closing = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/test/resources/messageGenerator.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/test/resources/messageGenerator.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1123,18 +1123,18 @@ MessageGenerator.prototype = {</span>
<a href="#l21.4"></a><span id="l21.4">       msg.metaState.read = true;</span>
<a href="#l21.5"></a><span id="l21.5">     }</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7">     let bodyPart;</span>
<a href="#l21.8"></a><span id="l21.8">     if (aArgs.bodyPart) {</span>
<a href="#l21.9"></a><span id="l21.9">       bodyPart = aArgs.bodyPart;</span>
<a href="#l21.10"></a><span id="l21.10">     } else if (aArgs.body) {</span>
<a href="#l21.11"></a><span id="l21.11">       bodyPart = new SyntheticPartLeaf(aArgs.body.body, aArgs.body);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-    } // different messages should have a chance at different bodies</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-    else {</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+    } else {</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+      // Different messages should have a chance at different bodies.</span>
<a href="#l21.16"></a><span id="l21.16">       bodyPart = new SyntheticPartLeaf(&quot;Hello &quot; + msg.toName + &quot;!&quot;);</span>
<a href="#l21.17"></a><span id="l21.17">     }</span>
<a href="#l21.18"></a><span id="l21.18"> </span>
<a href="#l21.19"></a><span id="l21.19">     // if it has any attachments, create a multipart/mixed to be the body and</span>
<a href="#l21.20"></a><span id="l21.20">     //  have it be the parent of the existing body and all the attachments</span>
<a href="#l21.21"></a><span id="l21.21">     if (aArgs.attachments) {</span>
<a href="#l21.22"></a><span id="l21.22">       let parts = [bodyPart];</span>
<a href="#l21.23"></a><span id="l21.23">       for (let attachDesc of aArgs.attachments) {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

