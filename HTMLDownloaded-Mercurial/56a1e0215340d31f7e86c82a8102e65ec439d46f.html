<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 23120:56a1e0215340d31f7e86c82a8102e65ec439d46f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 56a1e0215340d31f7e86c82a8102e65ec439d46f" />
<meta property="og:url" content="/comm-central/rev/56a1e0215340d31f7e86c82a8102e65ec439d46f" />
<meta property="og:description" content="Bug 1431913 - Port bug 1431204 to mailnews: Make nsIURI.spec readonly. rs=bustage-fix" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 56a1e0215340d31f7e86c82a8102e65ec439d46f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/56a1e0215340d31f7e86c82a8102e65ec439d46f">shortlog</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/56a1e0215340d31f7e86c82a8102e65ec439d46f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f">files</a> |
changeset |
<a href="/comm-central/raw-rev/56a1e0215340d31f7e86c82a8102e65ec439d46f">raw</a>  | <a href="/comm-central/archive/56a1e0215340d31f7e86c82a8102e65ec439d46f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1431913">Bug 1431913</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1431204">bug 1431204</a> to mailnews: Make nsIURI.spec readonly. rs=bustage-fix
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 21 Jan 2018 20:56:48 +0100</td></tr>

<tr>
 <td>changeset 23120</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/56a1e0215340d31f7e86c82a8102e65ec439d46f">56a1e0215340d31f7e86c82a8102e65ec439d46f</a></td>
</tr>



<tr>
<td>parent 23119</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3b24922dc1938d8d8a8c2475e046984ce2fb154f">3b24922dc1938d8d8a8c2475e046984ce2fb154f</a>
</td>
</tr>

<tr>
<td>child 23121</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/603955ee98d37a04c231db0c5025f20b7d934a1b">603955ee98d37a04c231db0c5025f20b7d934a1b</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=56a1e0215340d31f7e86c82a8102e65ec439d46f">13990</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 21 Jan 2018 19:57:06 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@603955ee98d3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=603955ee98d37a04c231db0c5025f20b7d934a1b">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=603955ee98d37a04c231db0c5025f20b7d934a1b&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=603955ee98d37a04c231db0c5025f20b7d934a1b&newProject=comm-central&newRevision=56a1e0215340d31f7e86c82a8102e65ec439d46f&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=603955ee98d37a04c231db0c5025f20b7d934a1b&newProject=comm-central&newRevision=56a1e0215340d31f7e86c82a8102e65ec439d46f&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=603955ee98d37a04c231db0c5025f20b7d934a1b&newProject=comm-central&newRevision=56a1e0215340d31f7e86c82a8102e65ec439d46f&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bustage-fix%29&revcount=50">bustage-fix</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1431913">1431913</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1431204">1431204</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1431913">Bug 1431913</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1431204">bug 1431204</a> to mailnews: Make nsIURI.spec readonly. rs=bustage-fix</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/ldap/xpcom/src/nsLDAPURL.cpp">ldap/xpcom/src/nsLDAPURL.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/ldap/xpcom/src/nsLDAPURL.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/ldap/xpcom/src/nsLDAPURL.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/ldap/xpcom/src/nsLDAPURL.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/ldap/xpcom/src/nsLDAPURL.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/ldap/xpcom/src/nsLDAPURL.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">mailnews/addrbook/src/nsAddbookProtocolHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookUrl.cpp">mailnews/addrbook/src/nsAddbookUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookUrl.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookUrl.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookUrl.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookUrl.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/addrbook/src/nsAddbookUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/src/nsMessengerOSXIntegration.mm">mailnews/base/src/nsMessengerOSXIntegration.mm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/src/nsMessengerOSXIntegration.mm">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/src/nsMessengerOSXIntegration.mm">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/src/nsMessengerOSXIntegration.mm">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/src/nsMessengerOSXIntegration.mm">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/src/nsMessengerOSXIntegration.mm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgMailNewsUrl.cpp">mailnews/base/util/nsMsgMailNewsUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgMailNewsUrl.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgMailNewsUrl.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgMailNewsUrl.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgMailNewsUrl.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgMailNewsUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgAttachmentHandler.cpp">mailnews/compose/src/nsMsgAttachmentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgAttachmentHandler.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgAttachmentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgAttachmentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgAttachmentHandler.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgAttachmentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgComposeService.cpp">mailnews/compose/src/nsMsgComposeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgComposeService.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgComposeService.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgComposeService.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgComposeService.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgComposeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgCopy.cpp">mailnews/compose/src/nsMsgCopy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgCopy.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgCopy.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgCopy.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgCopy.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgCopy.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpService.cpp">mailnews/compose/src/nsSmtpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpService.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpService.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpService.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpService.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpUrl.cpp">mailnews/compose/src/nsSmtpUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpUrl.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpUrl.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpUrl.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpUrl.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/compose/src/nsSmtpUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapService.cpp">mailnews/imap/src/nsImapService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapService.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapService.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapService.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapService.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.cpp">mailnews/imap/src/nsImapUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.h">mailnews/imap/src/nsImapUrl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.h">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.h">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.h">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.h">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/imap/src/nsImapUrl.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalUtils.cpp">mailnews/local/src/nsLocalUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalUtils.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalUtils.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalUtils.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalUtils.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsLocalUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxService.cpp">mailnews/local/src/nsMailboxService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxService.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxService.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxService.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxService.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.cpp">mailnews/local/src/nsMailboxUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.h">mailnews/local/src/nsMailboxUrl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.h">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.h">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.h">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.h">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMailboxUrl.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMsgMaildirStore.cpp">mailnews/local/src/nsMsgMaildirStore.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMsgMaildirStore.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMsgMaildirStore.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMsgMaildirStore.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMsgMaildirStore.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsMsgMaildirStore.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsPop3Service.cpp">mailnews/local/src/nsPop3Service.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsPop3Service.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsPop3Service.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsPop3Service.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsPop3Service.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/local/src/nsPop3Service.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNewsFolder.cpp">mailnews/news/src/nsNewsFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNewsFolder.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNewsFolder.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNewsFolder.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNewsFolder.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNewsFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpService.cpp">mailnews/news/src/nsNntpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpService.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpService.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpService.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpService.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.cpp">mailnews/news/src/nsNntpUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.cpp">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.cpp">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.cpp">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.cpp">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.h">mailnews/news/src/nsNntpUrl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.h">file</a> |
<a href="/comm-central/annotate/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.h">annotate</a> |
<a href="/comm-central/diff/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.h">diff</a> |
<a href="/comm-central/comparison/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.h">comparison</a> |
<a href="/comm-central/log/56a1e0215340d31f7e86c82a8102e65ec439d46f/mailnews/news/src/nsNntpUrl.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/ldap/xpcom/src/nsLDAPURL.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/ldap/xpcom/src/nsLDAPURL.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -51,17 +51,17 @@ nsLDAPURL::Init(uint32_t aUrlType, int32</span>
<a href="#l1.4"></a><span id="l1.4">                          aBaseURI);</span>
<a href="#l1.5"></a><span id="l1.5">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7">   // Now get the spec from the mBaseURL in case it was a relative one</span>
<a href="#l1.8"></a><span id="l1.8">   nsCString spec;</span>
<a href="#l1.9"></a><span id="l1.9">   rv = mBaseURL-&gt;GetSpec(spec);</span>
<a href="#l1.10"></a><span id="l1.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  return SetSpec(spec);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  return SetSpecInternal(spec);</span>
<a href="#l1.14"></a><span id="l1.14"> }</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> void</span>
<a href="#l1.17"></a><span id="l1.17"> nsLDAPURL::GetPathInternal(nsCString &amp;aPath)</span>
<a href="#l1.18"></a><span id="l1.18"> {</span>
<a href="#l1.19"></a><span id="l1.19">   aPath.Assign('/');</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21">   if (!mDN.IsEmpty())</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -144,34 +144,34 @@ NS_IMETHODIMP</span>
<a href="#l1.23"></a><span id="l1.23"> nsLDAPURL::GetSpec(nsACString &amp;_retval)</span>
<a href="#l1.24"></a><span id="l1.24"> {</span>
<a href="#l1.25"></a><span id="l1.25">   if (!mBaseURL)</span>
<a href="#l1.26"></a><span id="l1.26">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28">   return mBaseURL-&gt;GetSpec(_retval);</span>
<a href="#l1.29"></a><span id="l1.29"> }</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-nsLDAPURL::SetSpec(const nsACString &amp;aSpec)</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+nsresult</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+nsLDAPURL::SetSpecInternal(const nsACString &amp;aSpec)</span>
<a href="#l1.35"></a><span id="l1.35"> {</span>
<a href="#l1.36"></a><span id="l1.36">   if (!mBaseURL)</span>
<a href="#l1.37"></a><span id="l1.37">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">   // Cache the original spec in case we don't like what we've been passed and</span>
<a href="#l1.40"></a><span id="l1.40">   // need to reset ourselves.</span>
<a href="#l1.41"></a><span id="l1.41">   nsCString originalSpec;</span>
<a href="#l1.42"></a><span id="l1.42">   nsresult rv = mBaseURL-&gt;GetSpec(originalSpec);</span>
<a href="#l1.43"></a><span id="l1.43">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.44"></a><span id="l1.44"> </span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-  rv = mBaseURL-&gt;SetSpec(aSpec);</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+  rv = mBaseURL-&gt;SetSpecInternal(aSpec);</span>
<a href="#l1.47"></a><span id="l1.47">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.48"></a><span id="l1.48"> </span>
<a href="#l1.49"></a><span id="l1.49">   rv = SetPathInternal(PromiseFlatCString(aSpec));</span>
<a href="#l1.50"></a><span id="l1.50">   if (NS_FAILED(rv))</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-    mBaseURL-&gt;SetSpec(originalSpec);</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+    mBaseURL-&gt;SetSpecInternal(originalSpec);</span>
<a href="#l1.53"></a><span id="l1.53"> </span>
<a href="#l1.54"></a><span id="l1.54">   return rv;</span>
<a href="#l1.55"></a><span id="l1.55"> }</span>
<a href="#l1.56"></a><span id="l1.56"> </span>
<a href="#l1.57"></a><span id="l1.57"> NS_IMETHODIMP nsLDAPURL::GetPrePath(nsACString &amp;_retval)</span>
<a href="#l1.58"></a><span id="l1.58"> {</span>
<a href="#l1.59"></a><span id="l1.59">   if (!mBaseURL)</span>
<a href="#l1.60"></a><span id="l1.60">     return NS_ERROR_NOT_INITIALIZED;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddbookProtocolHandler.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -58,17 +58,17 @@ NS_IMETHODIMP nsAddbookProtocolHandler::</span>
<a href="#l2.4"></a><span id="l2.4">                                                const char *aOriginCharset, // ignored</span>
<a href="#l2.5"></a><span id="l2.5">                                                nsIURI *aBaseURI,</span>
<a href="#l2.6"></a><span id="l2.6">                                                nsIURI **_retval)</span>
<a href="#l2.7"></a><span id="l2.7"> {</span>
<a href="#l2.8"></a><span id="l2.8">   nsresult rv;</span>
<a href="#l2.9"></a><span id="l2.9">   nsCOMPtr&lt;nsIAddbookUrl&gt; addbookUrl = do_CreateInstance(NS_ADDBOOKURL_CONTRACTID, &amp;rv);</span>
<a href="#l2.10"></a><span id="l2.10">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  rv = addbookUrl-&gt;SetSpec(aSpec);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  rv = addbookUrl-&gt;SetSpecInternal(aSpec);</span>
<a href="#l2.14"></a><span id="l2.14">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16">   nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(addbookUrl, &amp;rv);</span>
<a href="#l2.17"></a><span id="l2.17">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">   uri.forget(_retval);</span>
<a href="#l2.20"></a><span id="l2.20">   return NS_OK;</span>
<a href="#l2.21"></a><span id="l2.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddbookUrl.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddbookUrl.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -23,20 +23,20 @@ nsAddbookUrl::nsAddbookUrl()</span>
<a href="#l3.4"></a><span id="l3.4"> }</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> nsAddbookUrl::~nsAddbookUrl()</span>
<a href="#l3.7"></a><span id="l3.7"> {</span>
<a href="#l3.8"></a><span id="l3.8"> }</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10"> NS_IMPL_ISUPPORTS(nsAddbookUrl, nsIAddbookUrl, nsIURI)</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-nsAddbookUrl::SetSpec(const nsACString &amp;aSpec)</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+nsresult</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+nsAddbookUrl::SetSpecInternal(const nsACString &amp;aSpec)</span>
<a href="#l3.16"></a><span id="l3.16"> {</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-  nsresult rv = m_baseURL-&gt;SetSpec(aSpec);</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+  nsresult rv = m_baseURL-&gt;SetSpecInternal(aSpec);</span>
<a href="#l3.19"></a><span id="l3.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.20"></a><span id="l3.20">   return ParseUrl();</span>
<a href="#l3.21"></a><span id="l3.21"> }</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23"> nsresult nsAddbookUrl::ParseUrl()</span>
<a href="#l3.24"></a><span id="l3.24"> {</span>
<a href="#l3.25"></a><span id="l3.25">   nsAutoCString pathStr;</span>
<a href="#l3.26"></a><span id="l3.26"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.mm</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -88,17 +88,17 @@ static void openMailWindow(const nsCStri</span>
<a href="#l4.4"></a><span id="l4.4">   if (topMostMsgWindow)</span>
<a href="#l4.5"></a><span id="l4.5">   {</span>
<a href="#l4.6"></a><span id="l4.6">     if (!aUri.IsEmpty())</span>
<a href="#l4.7"></a><span id="l4.7">     {</span>
<a href="#l4.8"></a><span id="l4.8">       nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; msgUri(do_CreateInstance(NS_MAILBOXURL_CONTRACTID, &amp;rv));</span>
<a href="#l4.9"></a><span id="l4.9">       if (NS_FAILED(rv))</span>
<a href="#l4.10"></a><span id="l4.10">         return;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      rv = msgUri-&gt;SetSpec(aUri);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+      rv = msgUri-&gt;SetSpecInternal(aUri);</span>
<a href="#l4.14"></a><span id="l4.14">       if (NS_FAILED(rv))</span>
<a href="#l4.15"></a><span id="l4.15">         return;</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">       bool isMessageUri = false;</span>
<a href="#l4.18"></a><span id="l4.18">       msgUri-&gt;GetIsMessageUri(&amp;isMessageUri);</span>
<a href="#l4.19"></a><span id="l4.19">       if (isMessageUri)</span>
<a href="#l4.20"></a><span id="l4.20">       {</span>
<a href="#l4.21"></a><span id="l4.21">         nsCOMPtr&lt;nsIWindowWatcher&gt; wwatch(do_GetService(NS_WINDOWWATCHER_CONTRACTID, &amp;rv));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -3128,17 +3128,17 @@ nsresult</span>
<a href="#l5.4"></a><span id="l5.4"> nsMsgDBFolder::parseURI(bool needServer)</span>
<a href="#l5.5"></a><span id="l5.5"> {</span>
<a href="#l5.6"></a><span id="l5.6">   nsresult rv;</span>
<a href="#l5.7"></a><span id="l5.7">   nsCOMPtr&lt;nsIURL&gt; url;</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">   url = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l5.10"></a><span id="l5.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  rv = url-&gt;SetSpec(mURI);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  rv = url-&gt;SetSpecInternal(mURI);</span>
<a href="#l5.14"></a><span id="l5.14">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.15"></a><span id="l5.15">   // empty path tells us it's a server.</span>
<a href="#l5.16"></a><span id="l5.16">   if (!mIsServerIsValid)</span>
<a href="#l5.17"></a><span id="l5.17">   {</span>
<a href="#l5.18"></a><span id="l5.18">     nsAutoCString path;</span>
<a href="#l5.19"></a><span id="l5.19">     rv = url-&gt;GetPathQueryRef(path);</span>
<a href="#l5.20"></a><span id="l5.20">     if (NS_SUCCEEDED(rv))</span>
<a href="#l5.21"></a><span id="l5.21">       mIsServer = path.EqualsLiteral(&quot;/&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -202,17 +202,17 @@ NS_IMETHODIMP nsMsgMailNewsUrl::GetServe</span>
<a href="#l6.4"></a><span id="l6.4">   nsAutoCString urlstr;</span>
<a href="#l6.5"></a><span id="l6.5">   nsAutoCString scheme;</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">   nsCOMPtr&lt;nsIURL&gt; url = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l6.8"></a><span id="l6.8">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10">   rv = m_baseURL-&gt;GetSpec(urlstr);</span>
<a href="#l6.11"></a><span id="l6.11">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  rv = url-&gt;SetSpec(urlstr);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  rv = url-&gt;SetSpecInternal(urlstr);</span>
<a href="#l6.14"></a><span id="l6.14">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l6.15"></a><span id="l6.15">   rv = GetScheme(scheme);</span>
<a href="#l6.16"></a><span id="l6.16">     if (NS_SUCCEEDED(rv))</span>
<a href="#l6.17"></a><span id="l6.17">     {</span>
<a href="#l6.18"></a><span id="l6.18">         if (scheme.EqualsLiteral(&quot;pop&quot;))</span>
<a href="#l6.19"></a><span id="l6.19">           scheme.AssignLiteral(&quot;pop3&quot;);</span>
<a href="#l6.20"></a><span id="l6.20">         // we use &quot;nntp&quot; in the server list so translate it here.</span>
<a href="#l6.21"></a><span id="l6.21">         if (scheme.EqualsLiteral(&quot;news&quot;))</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -393,17 +393,17 @@ NS_IMETHODIMP nsMsgMailNewsUrl::GetSearc</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24"> NS_IMETHODIMP nsMsgMailNewsUrl::GetSpec(nsACString &amp;aSpec)</span>
<a href="#l6.25"></a><span id="l6.25"> {</span>
<a href="#l6.26"></a><span id="l6.26">   return m_baseURL-&gt;GetSpec(aSpec);</span>
<a href="#l6.27"></a><span id="l6.27"> }</span>
<a href="#l6.28"></a><span id="l6.28"> </span>
<a href="#l6.29"></a><span id="l6.29"> #define FILENAME_PART_LEN 10</span>
<a href="#l6.30"></a><span id="l6.30"> </span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-NS_IMETHODIMP nsMsgMailNewsUrl::SetSpec(const nsACString &amp;aSpec)</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+nsresult nsMsgMailNewsUrl::SetSpecInternal(const nsACString &amp;aSpec)</span>
<a href="#l6.33"></a><span id="l6.33"> {</span>
<a href="#l6.34"></a><span id="l6.34">   nsAutoCString spec(aSpec);</span>
<a href="#l6.35"></a><span id="l6.35">   // Parse out &quot;filename&quot; attribute if present.</span>
<a href="#l6.36"></a><span id="l6.36">   char *start, *end;</span>
<a href="#l6.37"></a><span id="l6.37">   start = PL_strcasestr(spec.BeginWriting(),&quot;?filename=&quot;);</span>
<a href="#l6.38"></a><span id="l6.38">   if (!start)</span>
<a href="#l6.39"></a><span id="l6.39">     start = PL_strcasestr(spec.BeginWriting(),&quot;&amp;filename=&quot;);</span>
<a href="#l6.40"></a><span id="l6.40">   if (start)</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineat">@@ -415,17 +415,17 @@ NS_IMETHODIMP nsMsgMailNewsUrl::SetSpec(</span>
<a href="#l6.42"></a><span id="l6.42">       mAttachmentFileName = start+FILENAME_PART_LEN;</span>
<a href="#l6.43"></a><span id="l6.43">       *end = '&amp;';</span>
<a href="#l6.44"></a><span id="l6.44">     }</span>
<a href="#l6.45"></a><span id="l6.45">     else</span>
<a href="#l6.46"></a><span id="l6.46">       mAttachmentFileName = start+FILENAME_PART_LEN;</span>
<a href="#l6.47"></a><span id="l6.47">   }</span>
<a href="#l6.48"></a><span id="l6.48"> </span>
<a href="#l6.49"></a><span id="l6.49">   // Now, set the rest.</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-  nsresult rv = m_baseURL-&gt;SetSpec(aSpec);</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+  nsresult rv = m_baseURL-&gt;SetSpecInternal(aSpec);</span>
<a href="#l6.52"></a><span id="l6.52">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.53"></a><span id="l6.53"> </span>
<a href="#l6.54"></a><span id="l6.54">   // Check whether the URL is in normalised form.</span>
<a href="#l6.55"></a><span id="l6.55">   nsCOMPtr &lt;nsIMsgMessageUrl&gt; msgUrl;</span>
<a href="#l6.56"></a><span id="l6.56">   QueryInterface(NS_GET_IID(nsIMsgMessageUrl), getter_AddRefs(msgUrl));</span>
<a href="#l6.57"></a><span id="l6.57"> </span>
<a href="#l6.58"></a><span id="l6.58">   nsAutoCString principalSpec;</span>
<a href="#l6.59"></a><span id="l6.59">   if (!msgUrl || NS_FAILED(msgUrl-&gt;GetPrincipalSpec(principalSpec))) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -196,17 +196,17 @@ nsresult CreateStartupUrl(const char *ur</span>
<a href="#l7.4"></a><span id="l7.4">   else if (PL_strncasecmp(uri, &quot;news&quot;, 4) == 0)</span>
<a href="#l7.5"></a><span id="l7.5">   {</span>
<a href="#l7.6"></a><span id="l7.6">     nsCOMPtr&lt;nsINntpUrl&gt; nntpUrl = do_CreateInstance(kCNntpUrlCID, &amp;rv);</span>
<a href="#l7.7"></a><span id="l7.7">     if (NS_SUCCEEDED(rv) &amp;&amp; nntpUrl)</span>
<a href="#l7.8"></a><span id="l7.8">       rv = nntpUrl-&gt;QueryInterface(NS_GET_IID(nsIURI),</span>
<a href="#l7.9"></a><span id="l7.9">       (void**) aUrl);</span>
<a href="#l7.10"></a><span id="l7.10">   }</span>
<a href="#l7.11"></a><span id="l7.11">   if (*aUrl) // SetSpec can fail, for mailbox urls, but we still have a url.</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    (void) (*aUrl)-&gt;SetSpec(nsDependentCString(uri));</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    (void)(*aUrl)-&gt;SetSpecInternal(nsDependentCString(uri));</span>
<a href="#l7.14"></a><span id="l7.14">   return rv;</span>
<a href="#l7.15"></a><span id="l7.15"> }</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18"> // Where should this live? It's a utility used to convert a string priority,</span>
<a href="#l7.19"></a><span id="l7.19"> //  e.g., &quot;High, Low, Normal&quot; to an enum.</span>
<a href="#l7.20"></a><span id="l7.20"> // Perhaps we should have an interface that groups together all these</span>
<a href="#l7.21"></a><span id="l7.21"> //  utilities...</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -851,17 +851,17 @@ nsMsgAttachmentHandler::ConvertToAppleEn</span>
<a href="#l8.4"></a><span id="l8.4">   bool sendResourceFork = HasResourceFork(&amp;fsRef);</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6">   // if we have a resource fork, check the filename extension, maybe we don't need the resource fork!</span>
<a href="#l8.7"></a><span id="l8.7">   if (sendResourceFork)</span>
<a href="#l8.8"></a><span id="l8.8">   {</span>
<a href="#l8.9"></a><span id="l8.9">     nsCOMPtr&lt;nsIURL&gt; fileUrl(do_CreateInstance(NS_STANDARDURL_CONTRACTID));</span>
<a href="#l8.10"></a><span id="l8.10">     if (fileUrl)</span>
<a href="#l8.11"></a><span id="l8.11">     {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      rv = fileUrl-&gt;SetSpec(aFileURI);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+      rv = fileUrl-&gt;SetSpecInternal(aFileURI);</span>
<a href="#l8.14"></a><span id="l8.14">       if (NS_SUCCEEDED(rv))</span>
<a href="#l8.15"></a><span id="l8.15">       {</span>
<a href="#l8.16"></a><span id="l8.16">         nsAutoCString ext;</span>
<a href="#l8.17"></a><span id="l8.17">         rv = fileUrl-&gt;GetFileExtension(ext);</span>
<a href="#l8.18"></a><span id="l8.18">         if (NS_SUCCEEDED(rv) &amp;&amp; !ext.IsEmpty())</span>
<a href="#l8.19"></a><span id="l8.19">         {</span>
<a href="#l8.20"></a><span id="l8.20">           sendResourceFork =</span>
<a href="#l8.21"></a><span id="l8.21">           PL_strcasecmp(ext.get(), &quot;TXT&quot;) &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1328,17 +1328,17 @@ nsMsgComposeService::RunMessageThroughMi</span>
<a href="#l9.4"></a><span id="l9.4">   if (fileUrl || PromiseFlatCString(aMsgURI).Find(&quot;&amp;type=application/x-message-display&quot;) &gt;= 0)</span>
<a href="#l9.5"></a><span id="l9.5">     rv = NS_NewURI(getter_AddRefs(url), mailboxUri);</span>
<a href="#l9.6"></a><span id="l9.6">   else</span>
<a href="#l9.7"></a><span id="l9.7">     rv = messageService-&gt;GetUrlForUri(PromiseFlatCString(aMsgURI).get(), getter_AddRefs(url), aMsgWindow);</span>
<a href="#l9.8"></a><span id="l9.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10">   // ignore errors here - it's not fatal, and in the case of mailbox messages,</span>
<a href="#l9.11"></a><span id="l9.11">   // we're always passing in an invalid spec...</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  (void )url-&gt;SetSpec(mailboxUri);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  (void)url-&gt;SetSpecInternal(mailboxUri);</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15">   // if we are forwarding a message and that message used a charset over ride</span>
<a href="#l9.16"></a><span id="l9.16">   // then use that over ride charset instead of the charset specified in the message</span>
<a href="#l9.17"></a><span id="l9.17">   nsCString mailCharset;</span>
<a href="#l9.18"></a><span id="l9.18">   if (aMsgWindow)</span>
<a href="#l9.19"></a><span id="l9.19">   {</span>
<a href="#l9.20"></a><span id="l9.20">     bool charsetOverride;</span>
<a href="#l9.21"></a><span id="l9.21">     if (NS_SUCCEEDED(aMsgWindow-&gt;GetCharsetOverride(&amp;charsetOverride)) &amp;&amp; charsetOverride)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCopy.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCopy.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -537,17 +537,17 @@ MessageFolderIsLocal(nsIMsgIdentity   *u</span>
<a href="#l10.4"></a><span id="l10.4"> {</span>
<a href="#l10.5"></a><span id="l10.5">   nsresult rv;</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7">   if (!aFolderURI) return NS_ERROR_NULL_POINTER;</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9">   nsCOMPtr &lt;nsIURL&gt; url = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l10.10"></a><span id="l10.10">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  rv = url-&gt;SetSpec(nsDependentCString(aFolderURI));</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  rv = url-&gt;SetSpecInternal(nsDependentCString(aFolderURI));</span>
<a href="#l10.14"></a><span id="l10.14">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16">   /* mailbox:/ means its local (on disk) */</span>
<a href="#l10.17"></a><span id="l10.17">   rv = url-&gt;SchemeIs(&quot;mailbox&quot;, aResult);</span>
<a href="#l10.18"></a><span id="l10.18">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l10.19"></a><span id="l10.19">   return NS_OK;</span>
<a href="#l10.20"></a><span id="l10.20"> }</span>
<a href="#l10.21"></a><span id="l10.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -2095,17 +2095,17 @@ nsMsgComposeAndSend::AddCompFieldLocalAt</span>
<a href="#l11.4"></a><span id="l11.4">   #endif</span>
<a href="#l11.5"></a><span id="l11.5">                     m_attachments[newLoc]-&gt;m_type = type;</span>
<a href="#l11.6"></a><span id="l11.6">                   }</span>
<a href="#l11.7"></a><span id="l11.7">                 }</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">                 //Then try using the url if we still haven't figured out the content type</span>
<a href="#l11.10"></a><span id="l11.10">                 if (m_attachments[newLoc]-&gt;m_type.IsEmpty())</span>
<a href="#l11.11"></a><span id="l11.11">                 {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-                  rv = fileUrl-&gt;SetSpec(url);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+                  rv = fileUrl-&gt;SetSpecInternal(url);</span>
<a href="#l11.14"></a><span id="l11.14">                   if (NS_SUCCEEDED(rv))</span>
<a href="#l11.15"></a><span id="l11.15">                   {</span>
<a href="#l11.16"></a><span id="l11.16">                     rv = fileUrl-&gt;GetFileExtension(fileExt);</span>
<a href="#l11.17"></a><span id="l11.17">                     if (NS_SUCCEEDED(rv) &amp;&amp; !fileExt.IsEmpty()) {</span>
<a href="#l11.18"></a><span id="l11.18">                       nsAutoCString type;</span>
<a href="#l11.19"></a><span id="l11.19">                       mimeFinder-&gt;GetTypeFromExtension(fileExt, type);</span>
<a href="#l11.20"></a><span id="l11.20">   #ifndef XP_MACOSX</span>
<a href="#l11.21"></a><span id="l11.21">                     if (!type.EqualsLiteral(&quot;multipart/appledouble&quot;))  // can't do apple double on non-macs</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -2196,17 +2196,17 @@ nsMsgComposeAndSend::AddCompFieldRemoteA</span>
<a href="#l11.23"></a><span id="l11.23">       {</span>
<a href="#l11.24"></a><span id="l11.24">         // Just look for files that are NOT local file attachments and do</span>
<a href="#l11.25"></a><span id="l11.25">         // the right thing.</span>
<a href="#l11.26"></a><span id="l11.26">         if (! nsMsgIsLocalFile(url.get()))</span>
<a href="#l11.27"></a><span id="l11.27">         {</span>
<a href="#l11.28"></a><span id="l11.28">           // Check for message attachment, see nsMsgMailNewsUrl::GetIsMessageUri.</span>
<a href="#l11.29"></a><span id="l11.29">           nsCOMPtr&lt;nsIURI&gt; nsiuri = do_CreateInstance(NS_STANDARDURL_CONTRACTID);</span>
<a href="#l11.30"></a><span id="l11.30">           NS_ENSURE_STATE(nsiuri);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-          nsiuri-&gt;SetSpec(url);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+          nsiuri-&gt;SetSpecInternal(url);</span>
<a href="#l11.33"></a><span id="l11.33">           nsAutoCString scheme;</span>
<a href="#l11.34"></a><span id="l11.34">           nsiuri-&gt;GetScheme(scheme);</span>
<a href="#l11.35"></a><span id="l11.35">           bool isAMessageAttachment =</span>
<a href="#l11.36"></a><span id="l11.36">             StringEndsWith(scheme, NS_LITERAL_CSTRING(&quot;-message&quot;));</span>
<a href="#l11.37"></a><span id="l11.37"> </span>
<a href="#l11.38"></a><span id="l11.38">           m_attachments[newLoc]-&gt;mDeleteFile = true;</span>
<a href="#l11.39"></a><span id="l11.39">           m_attachments[newLoc]-&gt;m_done = false;</span>
<a href="#l11.40"></a><span id="l11.40">           m_attachments[newLoc]-&gt;SetMimeDeliveryState(this);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -171,17 +171,17 @@ nsresult NS_MsgBuildSmtpUrl(nsIFile * aF</span>
<a href="#l12.4"></a><span id="l12.4">   {</span>
<a href="#l12.5"></a><span id="l12.5">     urlSpec.Append(':');</span>
<a href="#l12.6"></a><span id="l12.6">     urlSpec.AppendInt(smtpPort);</span>
<a href="#l12.7"></a><span id="l12.7">   }</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; url(do_QueryInterface(smtpUrl, &amp;rv));</span>
<a href="#l12.10"></a><span id="l12.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  rv = url-&gt;SetSpec(urlSpec);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  rv = url-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l12.14"></a><span id="l12.14">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16">   smtpUrl-&gt;SetSender(aSender);</span>
<a href="#l12.17"></a><span id="l12.17">   smtpUrl-&gt;SetRecipients(aRecipients);</span>
<a href="#l12.18"></a><span id="l12.18">   smtpUrl-&gt;SetRequestDSN(aRequestDSN);</span>
<a href="#l12.19"></a><span id="l12.19">   smtpUrl-&gt;SetPostMessageFile(aFilePath);</span>
<a href="#l12.20"></a><span id="l12.20">   smtpUrl-&gt;SetSenderIdentity(aSenderIdentity);</span>
<a href="#l12.21"></a><span id="l12.21">   if (aNotificationCallbacks)</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -309,19 +309,19 @@ NS_IMETHODIMP nsSmtpService::NewURI(cons</span>
<a href="#l12.23"></a><span id="l12.23">       utf8Converter(do_GetService(NS_UTF8CONVERTERSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l12.24"></a><span id="l12.24">     if (NS_SUCCEEDED(rv))</span>
<a href="#l12.25"></a><span id="l12.25">       rv = utf8Converter-&gt;ConvertURISpecToUTF8(aSpec, aOriginCharset, utf8Spec);</span>
<a href="#l12.26"></a><span id="l12.26">   }</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">   // utf8Spec is filled up only when aOriginCharset is specified and</span>
<a href="#l12.29"></a><span id="l12.29">   // the conversion is successful. Otherwise, fall back to aSpec.</span>
<a href="#l12.30"></a><span id="l12.30">   if (aOriginCharset &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-    rv = mailtoUrl-&gt;SetSpec(utf8Spec);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+    rv = mailtoUrl-&gt;SetSpecInternal(utf8Spec);</span>
<a href="#l12.33"></a><span id="l12.33">   else</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-    rv = mailtoUrl-&gt;SetSpec(aSpec);</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+    rv = mailtoUrl-&gt;SetSpecInternal(aSpec);</span>
<a href="#l12.36"></a><span id="l12.36">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.37"></a><span id="l12.37"> </span>
<a href="#l12.38"></a><span id="l12.38">   mailtoUrl.forget(_retval);</span>
<a href="#l12.39"></a><span id="l12.39">   return NS_OK;</span>
<a href="#l12.40"></a><span id="l12.40"> }</span>
<a href="#l12.41"></a><span id="l12.41"> </span>
<a href="#l12.42"></a><span id="l12.42"> NS_IMETHODIMP nsSmtpService::NewChannel(nsIURI *aURI, nsIChannel **_retval)</span>
<a href="#l12.43"></a><span id="l12.43"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpUrl.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpUrl.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -258,19 +258,19 @@ nsresult nsMailtoUrl::ParseMailtoUrl(cha</span>
<a href="#l13.4"></a><span id="l13.4">         m_referencePart += inReplyToPart;</span>
<a href="#l13.5"></a><span id="l13.5">       }</span>
<a href="#l13.6"></a><span id="l13.6">     }</span>
<a href="#l13.7"></a><span id="l13.7">   }</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9">   return NS_OK;</span>
<a href="#l13.10"></a><span id="l13.10"> }</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-NS_IMETHODIMP nsMailtoUrl::SetSpec(const nsACString &amp;aSpec)</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+nsresult nsMailtoUrl::SetSpecInternal(const nsACString &amp;aSpec)</span>
<a href="#l13.14"></a><span id="l13.14"> {</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-  nsresult rv = m_baseURL-&gt;SetSpec(aSpec);</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+  nsresult rv = m_baseURL-&gt;SetSpecInternal(aSpec);</span>
<a href="#l13.17"></a><span id="l13.17">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.18"></a><span id="l13.18">   return ParseUrl();</span>
<a href="#l13.19"></a><span id="l13.19"> }</span>
<a href="#l13.20"></a><span id="l13.20"> </span>
<a href="#l13.21"></a><span id="l13.21"> nsresult nsMailtoUrl::CleanupMailtoState()</span>
<a href="#l13.22"></a><span id="l13.22"> {</span>
<a href="#l13.23"></a><span id="l13.23">     m_ccPart = &quot;&quot;;</span>
<a href="#l13.24"></a><span id="l13.24">     m_subjectPart = &quot;&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -211,17 +211,17 @@ NS_IMETHODIMP nsImapService::SelectFolde</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5">     if (NS_SUCCEEDED(rv))</span>
<a href="#l14.6"></a><span id="l14.6">     {</span>
<a href="#l14.7"></a><span id="l14.7">       nsAutoCString folderName;</span>
<a href="#l14.8"></a><span id="l14.8">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l14.9"></a><span id="l14.9">       urlSpec.AppendLiteral(&quot;/select&gt;&quot;);</span>
<a href="#l14.10"></a><span id="l14.10">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.11"></a><span id="l14.11">       urlSpec.Append(folderName);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-      rv = mailNewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+      rv = mailNewsUrl-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.14"></a><span id="l14.14">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.15"></a><span id="l14.15">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.16"></a><span id="l14.16">     }</span>
<a href="#l14.17"></a><span id="l14.17">   } // if we have a url to run....</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19">   return rv;</span>
<a href="#l14.20"></a><span id="l14.20"> }</span>
<a href="#l14.21"></a><span id="l14.21"> </span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -269,17 +269,17 @@ NS_IMETHODIMP nsImapService::GetUrlForUr</span>
<a href="#l14.23"></a><span id="l14.23">     urlSpec.AppendLiteral(&quot;fetch&gt;UID&gt;&quot;);</span>
<a href="#l14.24"></a><span id="l14.24">     urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.25"></a><span id="l14.25"> </span>
<a href="#l14.26"></a><span id="l14.26">     nsAutoCString folderName;</span>
<a href="#l14.27"></a><span id="l14.27">     GetFolderName(folder, folderName);</span>
<a href="#l14.28"></a><span id="l14.28">     urlSpec.Append(folderName);</span>
<a href="#l14.29"></a><span id="l14.29">     urlSpec.Append('&gt;');</span>
<a href="#l14.30"></a><span id="l14.30">     urlSpec.Append(msgKey);</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-    rv = url-&gt;SetSpec(urlSpec);</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+    rv = url-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.33"></a><span id="l14.33">     imapUrl-&gt;QueryInterface(NS_GET_IID(nsIURI), (void **) aURL);</span>
<a href="#l14.34"></a><span id="l14.34">   }</span>
<a href="#l14.35"></a><span id="l14.35"> </span>
<a href="#l14.36"></a><span id="l14.36">   return rv;</span>
<a href="#l14.37"></a><span id="l14.37"> }</span>
<a href="#l14.38"></a><span id="l14.38"> </span>
<a href="#l14.39"></a><span id="l14.39"> NS_IMETHODIMP nsImapService::OpenAttachment(const char *aContentType, </span>
<a href="#l14.40"></a><span id="l14.40">                                             const char *aFileName,</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineat">@@ -353,17 +353,17 @@ NS_IMETHODIMP nsImapService::OpenAttachm</span>
<a href="#l14.42"></a><span id="l14.42">       urlSpec.Append(msgKey);</span>
<a href="#l14.43"></a><span id="l14.43">       urlSpec.Append(uriMimePart);</span>
<a href="#l14.44"></a><span id="l14.44"> </span>
<a href="#l14.45"></a><span id="l14.45">       if (!uriMimePart.IsEmpty())</span>
<a href="#l14.46"></a><span id="l14.46">       {</span>
<a href="#l14.47"></a><span id="l14.47">         nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailUrl (do_QueryInterface(imapUrl));</span>
<a href="#l14.48"></a><span id="l14.48">         if (mailUrl)</span>
<a href="#l14.49"></a><span id="l14.49">         {</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-          rv = mailUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+          rv = mailUrl-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.52"></a><span id="l14.52">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.53"></a><span id="l14.53">           if (aFileName)</span>
<a href="#l14.54"></a><span id="l14.54">             mailUrl-&gt;SetFileName(nsDependentCString(aFileName));</span>
<a href="#l14.55"></a><span id="l14.55">         }</span>
<a href="#l14.56"></a><span id="l14.56">         rv =  FetchMimePart(imapUrl, nsIImapUrl::nsImapOpenMimePart, folder, imapMessageSink,</span>
<a href="#l14.57"></a><span id="l14.57">                             nullptr, aDisplayConsumer, msgKey, uriMimePart);</span>
<a href="#l14.58"></a><span id="l14.58">       }</span>
<a href="#l14.59"></a><span id="l14.59">     } // if we got a message sink</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineat">@@ -598,17 +598,17 @@ nsresult nsImapService::FetchMimePart(ns</span>
<a href="#l14.61"></a><span id="l14.61">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.62"></a><span id="l14.62"> </span>
<a href="#l14.63"></a><span id="l14.63">     // rhp: If we are displaying this message for the purpose of printing, we</span>
<a href="#l14.64"></a><span id="l14.64">     // need to append the header=print option.</span>
<a href="#l14.65"></a><span id="l14.65">     //</span>
<a href="#l14.66"></a><span id="l14.66">     if (mPrintingOperation)</span>
<a href="#l14.67"></a><span id="l14.67">       urlSpec.AppendLiteral(&quot;?header=print&quot;);</span>
<a href="#l14.68"></a><span id="l14.68"> </span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-    rv = url-&gt;SetSpec(urlSpec);</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+    rv = url-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.71"></a><span id="l14.71">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.72"></a><span id="l14.72"> </span>
<a href="#l14.73"></a><span id="l14.73">     rv = aImapUrl-&gt;SetImapAction(actionToUse /* nsIImapUrl::nsImapMsgFetch */);</span>
<a href="#l14.74"></a><span id="l14.74">     if (aImapMailFolder &amp;&amp; aDisplayConsumer)</span>
<a href="#l14.75"></a><span id="l14.75">     {</span>
<a href="#l14.76"></a><span id="l14.76">       nsCOMPtr&lt;nsIMsgIncomingServer&gt; aMsgIncomingServer;</span>
<a href="#l14.77"></a><span id="l14.77">       rv = aImapMailFolder-&gt;GetServer(getter_AddRefs(aMsgIncomingServer));</span>
<a href="#l14.78"></a><span id="l14.78">       if (NS_SUCCEEDED(rv) &amp;&amp; aMsgIncomingServer)</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineat">@@ -836,17 +836,17 @@ NS_IMETHODIMP nsImapService::Search(nsIM</span>
<a href="#l14.80"></a><span id="l14.80">     urlSpec.Append('&gt;');</span>
<a href="#l14.81"></a><span id="l14.81">     // escape aSearchUri so that IMAP special characters (i.e. '\')</span>
<a href="#l14.82"></a><span id="l14.82">     // won't be replaced with '/' in NECKO.</span>
<a href="#l14.83"></a><span id="l14.83">     // it will be unescaped in nsImapUrl::ParseUrl().</span>
<a href="#l14.84"></a><span id="l14.84">     nsCString escapedSearchUri;</span>
<a href="#l14.85"></a><span id="l14.85"> </span>
<a href="#l14.86"></a><span id="l14.86">     MsgEscapeString(nsDependentCString(aSearchUri), nsINetUtil::ESCAPE_XALPHAS, escapedSearchUri);</span>
<a href="#l14.87"></a><span id="l14.87">     urlSpec.Append(escapedSearchUri);</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-    rv = mailNewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+    rv = mailNewsUrl-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.90"></a><span id="l14.90">     if (NS_SUCCEEDED(rv))</span>
<a href="#l14.91"></a><span id="l14.91">       rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, nullptr);</span>
<a href="#l14.92"></a><span id="l14.92">   }</span>
<a href="#l14.93"></a><span id="l14.93">   return rv;</span>
<a href="#l14.94"></a><span id="l14.94"> }</span>
<a href="#l14.95"></a><span id="l14.95"> </span>
<a href="#l14.96"></a><span id="l14.96"> // just a helper method to break down imap message URIs....</span>
<a href="#l14.97"></a><span id="l14.97"> nsresult nsImapService::DecomposeImapURI(const nsACString &amp;aMessageURI,</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineat">@@ -971,17 +971,17 @@ NS_IMETHODIMP nsImapService::AddImapFetc</span>
<a href="#l14.99"></a><span id="l14.99">   urlSpec.Append(aMessageIdentifierList);</span>
<a href="#l14.100"></a><span id="l14.100"> </span>
<a href="#l14.101"></a><span id="l14.101">   if (!aAdditionalHeader.IsEmpty())</span>
<a href="#l14.102"></a><span id="l14.102">   {</span>
<a href="#l14.103"></a><span id="l14.103">     urlSpec.AppendLiteral(&quot;?header=&quot;);</span>
<a href="#l14.104"></a><span id="l14.104">     urlSpec.Append(aAdditionalHeader);</span>
<a href="#l14.105"></a><span id="l14.105">   }</span>
<a href="#l14.106"></a><span id="l14.106"> </span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-  return aUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineplus">+  return aUrl-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.109"></a><span id="l14.109"> }</span>
<a href="#l14.110"></a><span id="l14.110"> </span>
<a href="#l14.111"></a><span id="l14.111"> NS_IMETHODIMP nsImapService::FetchMessage(nsIImapUrl *aImapUrl,</span>
<a href="#l14.112"></a><span id="l14.112">                                           nsImapAction aImapAction,</span>
<a href="#l14.113"></a><span id="l14.113">                                           nsIMsgFolder *aImapMailFolder, </span>
<a href="#l14.114"></a><span id="l14.114">                                           nsIImapMessageSink *aImapMessage,</span>
<a href="#l14.115"></a><span id="l14.115">                                           nsIMsgWindow *aMsgWindow,</span>
<a href="#l14.116"></a><span id="l14.116">                                           nsISupports *aDisplayConsumer, </span>
<a href="#l14.117"></a><span id="l14.117" class="difflineat">@@ -1293,18 +1293,18 @@ NS_IMETHODIMP nsImapService::IsMsgInMemC</span>
<a href="#l14.118"></a><span id="l14.118">     // stick the uid validity in front of the url, so that if the uid validity</span>
<a href="#l14.119"></a><span id="l14.119">     // changes, we won't re-use the wrong cache entries.</span>
<a href="#l14.120"></a><span id="l14.120">     nsAutoCString extension;</span>
<a href="#l14.121"></a><span id="l14.121">     extension.AppendInt(uidValidity, 16);</span>
<a href="#l14.122"></a><span id="l14.122"> </span>
<a href="#l14.123"></a><span id="l14.123">     bool exists;</span>
<a href="#l14.124"></a><span id="l14.124">     if (truncated) {</span>
<a href="#l14.125"></a><span id="l14.125">       nsCOMPtr&lt;nsIURI&gt; newUri;</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineminus">-      aUrl-&gt;Clone(getter_AddRefs(newUri));</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineminus">-      newUri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineplus">+      rv = NS_NewURI(getter_AddRefs(newUri), urlSpec);</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.130"></a><span id="l14.130">       rv = mCacheStorage-&gt;Exists(newUri, extension, &amp;exists);</span>
<a href="#l14.131"></a><span id="l14.131">     } else {</span>
<a href="#l14.132"></a><span id="l14.132">       rv = mCacheStorage-&gt;Exists(aUrl, extension, &amp;exists);</span>
<a href="#l14.133"></a><span id="l14.133">     }</span>
<a href="#l14.134"></a><span id="l14.134">     if (NS_SUCCEEDED(rv) &amp;&amp; exists) {</span>
<a href="#l14.135"></a><span id="l14.135">       *aResult = true;</span>
<a href="#l14.136"></a><span id="l14.136">     }</span>
<a href="#l14.137"></a><span id="l14.137">   }</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineat">@@ -1360,17 +1360,17 @@ nsresult nsImapService::CreateStartOfIma</span>
<a href="#l14.139"></a><span id="l14.139">     urlSpec.Append(':');</span>
<a href="#l14.140"></a><span id="l14.140"> </span>
<a href="#l14.141"></a><span id="l14.141">     nsAutoCString portStr;</span>
<a href="#l14.142"></a><span id="l14.142">     portStr.AppendInt(port);</span>
<a href="#l14.143"></a><span id="l14.143">     urlSpec.Append(portStr);</span>
<a href="#l14.144"></a><span id="l14.144"> </span>
<a href="#l14.145"></a><span id="l14.145">     // *** jefft - force to parse the urlSpec in order to search for</span>
<a href="#l14.146"></a><span id="l14.146">     // the correct incoming server</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineminus">-    rv = mailnewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineplus">+    rv = mailnewsUrl-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.149"></a><span id="l14.149">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.150"></a><span id="l14.150"> </span>
<a href="#l14.151"></a><span id="l14.151">     hierarchyDelimiter = kOnlineHierarchySeparatorUnknown;</span>
<a href="#l14.152"></a><span id="l14.152">     nsCOMPtr &lt;nsIMsgImapMailFolder&gt; imapFolder = do_QueryInterface(aImapMailFolder);</span>
<a href="#l14.153"></a><span id="l14.153">     if (imapFolder)</span>
<a href="#l14.154"></a><span id="l14.154">       imapFolder-&gt;GetHierarchyDelimiter(&amp;hierarchyDelimiter);</span>
<a href="#l14.155"></a><span id="l14.155">   }</span>
<a href="#l14.156"></a><span id="l14.156">   return rv;</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineat">@@ -1412,17 +1412,17 @@ NS_IMETHODIMP nsImapService::GetHeaders(</span>
<a href="#l14.158"></a><span id="l14.158">       urlSpec.Append(char (hierarchyDelimiter));</span>
<a href="#l14.159"></a><span id="l14.159"> </span>
<a href="#l14.160"></a><span id="l14.160">       nsCString folderName;</span>
<a href="#l14.161"></a><span id="l14.161"> </span>
<a href="#l14.162"></a><span id="l14.162">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l14.163"></a><span id="l14.163">       urlSpec.Append(folderName);</span>
<a href="#l14.164"></a><span id="l14.164">       urlSpec.Append('&gt;');</span>
<a href="#l14.165"></a><span id="l14.165">       urlSpec.Append(messageIdentifierList);</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.168"></a><span id="l14.168"> </span>
<a href="#l14.169"></a><span id="l14.169">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.170"></a><span id="l14.170">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.171"></a><span id="l14.171">     }</span>
<a href="#l14.172"></a><span id="l14.172">   }</span>
<a href="#l14.173"></a><span id="l14.173">   return rv;</span>
<a href="#l14.174"></a><span id="l14.174"> }</span>
<a href="#l14.175"></a><span id="l14.175"> </span>
<a href="#l14.176"></a><span id="l14.176" class="difflineat">@@ -1463,17 +1463,17 @@ NS_IMETHODIMP nsImapService::GetBodyStar</span>
<a href="#l14.177"></a><span id="l14.177"> </span>
<a href="#l14.178"></a><span id="l14.178">       nsCString folderName;</span>
<a href="#l14.179"></a><span id="l14.179">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l14.180"></a><span id="l14.180">       urlSpec.Append(folderName);</span>
<a href="#l14.181"></a><span id="l14.181">       urlSpec.Append('&gt;');</span>
<a href="#l14.182"></a><span id="l14.182">       urlSpec.Append(messageIdentifierList);</span>
<a href="#l14.183"></a><span id="l14.183">       urlSpec.Append('&gt;');</span>
<a href="#l14.184"></a><span id="l14.184">       urlSpec.AppendInt(numBytes);</span>
<a href="#l14.185"></a><span id="l14.185" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.186"></a><span id="l14.186" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.187"></a><span id="l14.187">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.188"></a><span id="l14.188">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.189"></a><span id="l14.189">     }</span>
<a href="#l14.190"></a><span id="l14.190">   }</span>
<a href="#l14.191"></a><span id="l14.191">   return rv;</span>
<a href="#l14.192"></a><span id="l14.192"> }</span>
<a href="#l14.193"></a><span id="l14.193"> </span>
<a href="#l14.194"></a><span id="l14.194"> nsresult nsImapService::FolderCommand(nsIMsgFolder *imapMailFolder,</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineat">@@ -1503,17 +1503,17 @@ nsresult nsImapService::FolderCommand(ns</span>
<a href="#l14.196"></a><span id="l14.196">     if (NS_SUCCEEDED(rv))</span>
<a href="#l14.197"></a><span id="l14.197">     {</span>
<a href="#l14.198"></a><span id="l14.198">       urlSpec.Append(aCommand);</span>
<a href="#l14.199"></a><span id="l14.199">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.200"></a><span id="l14.200"> </span>
<a href="#l14.201"></a><span id="l14.201">       nsCString folderName;</span>
<a href="#l14.202"></a><span id="l14.202">       GetFolderName(imapMailFolder, folderName);</span>
<a href="#l14.203"></a><span id="l14.203">       urlSpec.Append(folderName);</span>
<a href="#l14.204"></a><span id="l14.204" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.205"></a><span id="l14.205" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.206"></a><span id="l14.206">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.207"></a><span id="l14.207">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, url);</span>
<a href="#l14.208"></a><span id="l14.208">     }</span>
<a href="#l14.209"></a><span id="l14.209">   }</span>
<a href="#l14.210"></a><span id="l14.210">   return rv;</span>
<a href="#l14.211"></a><span id="l14.211"> }</span>
<a href="#l14.212"></a><span id="l14.212"> </span>
<a href="#l14.213"></a><span id="l14.213"> NS_IMETHODIMP</span>
<a href="#l14.214"></a><span id="l14.214" class="difflineat">@@ -1530,17 +1530,17 @@ nsImapService::VerifyLogon(nsIMsgFolder </span>
<a href="#l14.215"></a><span id="l14.215">   {</span>
<a href="#l14.216"></a><span id="l14.216">     nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l14.217"></a><span id="l14.217"> </span>
<a href="#l14.218"></a><span id="l14.218">     nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailNewsUrl = do_QueryInterface(imapUrl);</span>
<a href="#l14.219"></a><span id="l14.219">     mailNewsUrl-&gt;SetSuppressErrorMsgs(true);</span>
<a href="#l14.220"></a><span id="l14.220">     mailNewsUrl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l14.221"></a><span id="l14.221">     rv = SetImapUrlSink(aFolder, imapUrl);</span>
<a href="#l14.222"></a><span id="l14.222">     urlSpec.AppendLiteral(&quot;/verifyLogon&quot;);</span>
<a href="#l14.223"></a><span id="l14.223" class="difflineminus">-    rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.224"></a><span id="l14.224" class="difflineplus">+    rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.225"></a><span id="l14.225">     if (NS_SUCCEEDED(rv))</span>
<a href="#l14.226"></a><span id="l14.226">       rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, nullptr);</span>
<a href="#l14.227"></a><span id="l14.227">     if (aURL)</span>
<a href="#l14.228"></a><span id="l14.228">       uri.forget(aURL);</span>
<a href="#l14.229"></a><span id="l14.229">   }</span>
<a href="#l14.230"></a><span id="l14.230">   return rv;</span>
<a href="#l14.231"></a><span id="l14.231"> }</span>
<a href="#l14.232"></a><span id="l14.232"> </span>
<a href="#l14.233"></a><span id="l14.233" class="difflineat">@@ -1604,17 +1604,17 @@ NS_IMETHODIMP nsImapService::Biff(nsIMsg</span>
<a href="#l14.234"></a><span id="l14.234">       urlSpec.AppendLiteral(&quot;/Biff&gt;&quot;);</span>
<a href="#l14.235"></a><span id="l14.235">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.236"></a><span id="l14.236"> </span>
<a href="#l14.237"></a><span id="l14.237">       nsCString folderName;</span>
<a href="#l14.238"></a><span id="l14.238">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l14.239"></a><span id="l14.239">       urlSpec.Append(folderName);</span>
<a href="#l14.240"></a><span id="l14.240">       urlSpec.Append('&gt;');</span>
<a href="#l14.241"></a><span id="l14.241">       urlSpec.AppendInt(uidHighWater);</span>
<a href="#l14.242"></a><span id="l14.242" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.243"></a><span id="l14.243" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.244"></a><span id="l14.244">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.245"></a><span id="l14.245">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.246"></a><span id="l14.246">     }</span>
<a href="#l14.247"></a><span id="l14.247">   }</span>
<a href="#l14.248"></a><span id="l14.248">   return rv;</span>
<a href="#l14.249"></a><span id="l14.249"> }</span>
<a href="#l14.250"></a><span id="l14.250"> </span>
<a href="#l14.251"></a><span id="l14.251"> NS_IMETHODIMP nsImapService::DeleteFolder(nsIMsgFolder *aImapMailFolder,</span>
<a href="#l14.252"></a><span id="l14.252" class="difflineat">@@ -1672,17 +1672,17 @@ NS_IMETHODIMP nsImapService::DeleteMessa</span>
<a href="#l14.253"></a><span id="l14.253">       urlSpec.Append('&gt;');</span>
<a href="#l14.254"></a><span id="l14.254">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.255"></a><span id="l14.255"> </span>
<a href="#l14.256"></a><span id="l14.256">       nsCString folderName;</span>
<a href="#l14.257"></a><span id="l14.257">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l14.258"></a><span id="l14.258">       urlSpec.Append(folderName);</span>
<a href="#l14.259"></a><span id="l14.259">       urlSpec.Append('&gt;');</span>
<a href="#l14.260"></a><span id="l14.260">       urlSpec.Append(messageIdentifierList);</span>
<a href="#l14.261"></a><span id="l14.261" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.262"></a><span id="l14.262" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.263"></a><span id="l14.263">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.264"></a><span id="l14.264">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.265"></a><span id="l14.265">     }</span>
<a href="#l14.266"></a><span id="l14.266">   }</span>
<a href="#l14.267"></a><span id="l14.267">   return rv;</span>
<a href="#l14.268"></a><span id="l14.268"> }</span>
<a href="#l14.269"></a><span id="l14.269"> </span>
<a href="#l14.270"></a><span id="l14.270"> // Delete all messages in a folder, used to empty trash</span>
<a href="#l14.271"></a><span id="l14.271" class="difflineat">@@ -1772,17 +1772,17 @@ nsresult nsImapService::DiddleFlags(nsIM</span>
<a href="#l14.272"></a><span id="l14.272">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.273"></a><span id="l14.273">       nsCString folderName;</span>
<a href="#l14.274"></a><span id="l14.274">       GetFolderName(aImapMailFolder, folderName);</span>
<a href="#l14.275"></a><span id="l14.275">       urlSpec.Append(folderName);</span>
<a href="#l14.276"></a><span id="l14.276">       urlSpec.Append('&gt;');</span>
<a href="#l14.277"></a><span id="l14.277">       urlSpec.Append(messageIdentifierList);</span>
<a href="#l14.278"></a><span id="l14.278">       urlSpec.Append('&gt;');</span>
<a href="#l14.279"></a><span id="l14.279">       urlSpec.AppendInt(flags);</span>
<a href="#l14.280"></a><span id="l14.280" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.281"></a><span id="l14.281" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.282"></a><span id="l14.282">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.283"></a><span id="l14.283">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.284"></a><span id="l14.284">     }</span>
<a href="#l14.285"></a><span id="l14.285">   }</span>
<a href="#l14.286"></a><span id="l14.286">   return rv;</span>
<a href="#l14.287"></a><span id="l14.287"> }</span>
<a href="#l14.288"></a><span id="l14.288"> </span>
<a href="#l14.289"></a><span id="l14.289"> nsresult nsImapService::SetImapUrlSink(nsIMsgFolder *aMsgFolder, nsIImapUrl *aImapUrl)</span>
<a href="#l14.290"></a><span id="l14.290" class="difflineat">@@ -1836,17 +1836,17 @@ NS_IMETHODIMP nsImapService::DiscoverAll</span>
<a href="#l14.291"></a><span id="l14.291">     if (NS_SUCCEEDED(rv))</span>
<a href="#l14.292"></a><span id="l14.292">     {</span>
<a href="#l14.293"></a><span id="l14.293">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(imapUrl);</span>
<a href="#l14.294"></a><span id="l14.294">       nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsurl = do_QueryInterface(imapUrl);</span>
<a href="#l14.295"></a><span id="l14.295">       if (mailnewsurl)</span>
<a href="#l14.296"></a><span id="l14.296">         mailnewsurl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l14.297"></a><span id="l14.297">       urlSpec.AppendLiteral(&quot;/discoverallboxes&quot;);</span>
<a href="#l14.298"></a><span id="l14.298">       nsCOMPtr &lt;nsIURI&gt; url = do_QueryInterface(imapUrl, &amp;rv);</span>
<a href="#l14.299"></a><span id="l14.299" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.300"></a><span id="l14.300" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.301"></a><span id="l14.301">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.302"></a><span id="l14.302">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.303"></a><span id="l14.303">     }</span>
<a href="#l14.304"></a><span id="l14.304">   }</span>
<a href="#l14.305"></a><span id="l14.305">   return rv;</span>
<a href="#l14.306"></a><span id="l14.306"> }</span>
<a href="#l14.307"></a><span id="l14.307"> </span>
<a href="#l14.308"></a><span id="l14.308"> NS_IMETHODIMP nsImapService::DiscoverAllAndSubscribedFolders(nsIMsgFolder *aImapMailFolder,</span>
<a href="#l14.309"></a><span id="l14.309" class="difflineat">@@ -1863,17 +1863,17 @@ NS_IMETHODIMP nsImapService::DiscoverAll</span>
<a href="#l14.310"></a><span id="l14.310">                                      aUrlListener, urlSpec, hierarchyDelimiter);</span>
<a href="#l14.311"></a><span id="l14.311">   if (NS_SUCCEEDED(rv) &amp;&amp; aImapUrl)</span>
<a href="#l14.312"></a><span id="l14.312">   {</span>
<a href="#l14.313"></a><span id="l14.313">     rv = SetImapUrlSink(aImapMailFolder, aImapUrl);</span>
<a href="#l14.314"></a><span id="l14.314">     if (NS_SUCCEEDED(rv))</span>
<a href="#l14.315"></a><span id="l14.315">     {</span>
<a href="#l14.316"></a><span id="l14.316">       nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(aImapUrl);</span>
<a href="#l14.317"></a><span id="l14.317">       urlSpec.AppendLiteral(&quot;/discoverallandsubscribedboxes&quot;);</span>
<a href="#l14.318"></a><span id="l14.318" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.319"></a><span id="l14.319" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.320"></a><span id="l14.320">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.321"></a><span id="l14.321">         rv = GetImapConnectionAndLoadUrl(aImapUrl, nullptr, aURL);</span>
<a href="#l14.322"></a><span id="l14.322">     }</span>
<a href="#l14.323"></a><span id="l14.323">   }</span>
<a href="#l14.324"></a><span id="l14.324">   return rv;</span>
<a href="#l14.325"></a><span id="l14.325"> }</span>
<a href="#l14.326"></a><span id="l14.326"> </span>
<a href="#l14.327"></a><span id="l14.327"> NS_IMETHODIMP nsImapService::DiscoverChildren(nsIMsgFolder *aImapMailFolder,</span>
<a href="#l14.328"></a><span id="l14.328" class="difflineat">@@ -1895,17 +1895,17 @@ NS_IMETHODIMP nsImapService::DiscoverChi</span>
<a href="#l14.329"></a><span id="l14.329">     if (NS_SUCCEEDED(rv))</span>
<a href="#l14.330"></a><span id="l14.330">     {</span>
<a href="#l14.331"></a><span id="l14.331">       if (!folderPath.IsEmpty())</span>
<a href="#l14.332"></a><span id="l14.332">       {</span>
<a href="#l14.333"></a><span id="l14.333">         nsCOMPtr&lt;nsIURI&gt; uri = do_QueryInterface(aImapUrl);</span>
<a href="#l14.334"></a><span id="l14.334">         urlSpec.AppendLiteral(&quot;/discoverchildren&gt;&quot;);</span>
<a href="#l14.335"></a><span id="l14.335">         urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.336"></a><span id="l14.336">         urlSpec.Append(folderPath);</span>
<a href="#l14.337"></a><span id="l14.337" class="difflineminus">-        rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.338"></a><span id="l14.338" class="difflineplus">+        rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.339"></a><span id="l14.339"> </span>
<a href="#l14.340"></a><span id="l14.340">         // Make sure the uri has the same hierarchy separator as the one in msg folder </span>
<a href="#l14.341"></a><span id="l14.341">         // obj if it's not kOnlineHierarchySeparatorUnknown (ie, '^').</span>
<a href="#l14.342"></a><span id="l14.342">         char uriDelimiter;</span>
<a href="#l14.343"></a><span id="l14.343">         nsresult rv1 = aImapUrl-&gt;GetOnlineSubDirSeparator(&amp;uriDelimiter);</span>
<a href="#l14.344"></a><span id="l14.344">         if (NS_SUCCEEDED (rv1) &amp;&amp; hierarchyDelimiter != kOnlineHierarchySeparatorUnknown &amp;&amp;</span>
<a href="#l14.345"></a><span id="l14.345">             uriDelimiter != hierarchyDelimiter)</span>
<a href="#l14.346"></a><span id="l14.346">           aImapUrl-&gt;SetOnlineSubDirSeparator(hierarchyDelimiter);</span>
<a href="#l14.347"></a><span id="l14.347" class="difflineat">@@ -1986,17 +1986,17 @@ NS_IMETHODIMP nsImapService::OnlineMessa</span>
<a href="#l14.348"></a><span id="l14.348">     urlSpec.Append('&gt;');</span>
<a href="#l14.349"></a><span id="l14.349">     urlSpec.Append(messageIds);</span>
<a href="#l14.350"></a><span id="l14.350">     urlSpec.Append('&gt;');</span>
<a href="#l14.351"></a><span id="l14.351">     urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.352"></a><span id="l14.352">     folderName.Adopt(strdup(&quot;&quot;));</span>
<a href="#l14.353"></a><span id="l14.353">     GetFolderName(aDstFolder, folderName);</span>
<a href="#l14.354"></a><span id="l14.354">     urlSpec.Append(folderName);</span>
<a href="#l14.355"></a><span id="l14.355"> </span>
<a href="#l14.356"></a><span id="l14.356" class="difflineminus">-    rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.357"></a><span id="l14.357" class="difflineplus">+    rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.358"></a><span id="l14.358">     if (NS_SUCCEEDED(rv))</span>
<a href="#l14.359"></a><span id="l14.359">       rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.360"></a><span id="l14.360">   }</span>
<a href="#l14.361"></a><span id="l14.361">   return rv;</span>
<a href="#l14.362"></a><span id="l14.362"> }</span>
<a href="#l14.363"></a><span id="l14.363"> </span>
<a href="#l14.364"></a><span id="l14.364"> nsresult nsImapService::OfflineAppendFromFile(nsIFile *aFile,</span>
<a href="#l14.365"></a><span id="l14.365">                                               nsIURI *aUrl,</span>
<a href="#l14.366"></a><span id="l14.366" class="difflineat">@@ -2176,17 +2176,17 @@ NS_IMETHODIMP nsImapService::AppendMessa</span>
<a href="#l14.367"></a><span id="l14.367">         urlSpec.Append(uidString);</span>
<a href="#l14.368"></a><span id="l14.368">       else</span>
<a href="#l14.369"></a><span id="l14.369">         urlSpec.Append(sequenceString);</span>
<a href="#l14.370"></a><span id="l14.370">       urlSpec.Append('&gt;');</span>
<a href="#l14.371"></a><span id="l14.371">       if (!messageId.IsEmpty())</span>
<a href="#l14.372"></a><span id="l14.372">         urlSpec.Append(messageId);</span>
<a href="#l14.373"></a><span id="l14.373">     }</span>
<a href="#l14.374"></a><span id="l14.374">     </span>
<a href="#l14.375"></a><span id="l14.375" class="difflineminus">-    rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.376"></a><span id="l14.376" class="difflineplus">+    rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.377"></a><span id="l14.377">     if (WeAreOffline())</span>
<a href="#l14.378"></a><span id="l14.378">     {</span>
<a href="#l14.379"></a><span id="l14.379">       // handle offline append to drafts or templates folder here.</span>
<a href="#l14.380"></a><span id="l14.380">       return OfflineAppendFromFile(aFile, uri, aDstFolder, messageId, inSelectedState, aListener, aURL, aCopyState);</span>
<a href="#l14.381"></a><span id="l14.381">     }</span>
<a href="#l14.382"></a><span id="l14.382">     if (NS_SUCCEEDED(rv))</span>
<a href="#l14.383"></a><span id="l14.383">       rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.384"></a><span id="l14.384">   }</span>
<a href="#l14.385"></a><span id="l14.385" class="difflineat">@@ -2269,17 +2269,17 @@ NS_IMETHODIMP nsImapService::MoveFolder(</span>
<a href="#l14.386"></a><span id="l14.386">       urlSpec.Append(folderName);</span>
<a href="#l14.387"></a><span id="l14.387">       urlSpec.Append('&gt;');</span>
<a href="#l14.388"></a><span id="l14.388">       GetFolderName(dstFolder, folderName);</span>
<a href="#l14.389"></a><span id="l14.389">       if (!folderName.IsEmpty())</span>
<a href="#l14.390"></a><span id="l14.390">       {</span>
<a href="#l14.391"></a><span id="l14.391">         urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.392"></a><span id="l14.392">         urlSpec.Append(folderName);</span>
<a href="#l14.393"></a><span id="l14.393">       }</span>
<a href="#l14.394"></a><span id="l14.394" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.395"></a><span id="l14.395" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.396"></a><span id="l14.396">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.397"></a><span id="l14.397">       {</span>
<a href="#l14.398"></a><span id="l14.398">         GetFolderName(srcFolder, folderName);</span>
<a href="#l14.399"></a><span id="l14.399">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, url);</span>
<a href="#l14.400"></a><span id="l14.400">       }</span>
<a href="#l14.401"></a><span id="l14.401">     }</span>
<a href="#l14.402"></a><span id="l14.402">   }</span>
<a href="#l14.403"></a><span id="l14.403">   return rv;</span>
<a href="#l14.404"></a><span id="l14.404" class="difflineat">@@ -2329,17 +2329,17 @@ NS_IMETHODIMP nsImapService::RenameLeaf(</span>
<a href="#l14.405"></a><span id="l14.405">       CopyUTF16toMUTF7(PromiseFlatString(newLeafName), utfNewName);</span>
<a href="#l14.406"></a><span id="l14.406">       nsCString escapedNewName;</span>
<a href="#l14.407"></a><span id="l14.407">       MsgEscapeString(utfNewName, nsINetUtil::ESCAPE_URL_PATH, escapedNewName);</span>
<a href="#l14.408"></a><span id="l14.408">       nsCString escapedSlashName;</span>
<a href="#l14.409"></a><span id="l14.409">       rv = nsImapUrl::EscapeSlashes(escapedNewName.get(), getter_Copies(escapedSlashName));</span>
<a href="#l14.410"></a><span id="l14.410">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.411"></a><span id="l14.411">       urlSpec.Append(escapedSlashName);</span>
<a href="#l14.412"></a><span id="l14.412"> </span>
<a href="#l14.413"></a><span id="l14.413" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.414"></a><span id="l14.414" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.415"></a><span id="l14.415">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.416"></a><span id="l14.416">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, url);</span>
<a href="#l14.417"></a><span id="l14.417">     } // if (NS_SUCCEEDED(rv))</span>
<a href="#l14.418"></a><span id="l14.418">   } // if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l14.419"></a><span id="l14.419">   return rv;</span>
<a href="#l14.420"></a><span id="l14.420"> }</span>
<a href="#l14.421"></a><span id="l14.421"> </span>
<a href="#l14.422"></a><span id="l14.422"> NS_IMETHODIMP nsImapService::CreateFolder(nsIMsgFolder *parent,</span>
<a href="#l14.423"></a><span id="l14.423" class="difflineat">@@ -2379,17 +2379,17 @@ NS_IMETHODIMP nsImapService::CreateFolde</span>
<a href="#l14.424"></a><span id="l14.424"> </span>
<a href="#l14.425"></a><span id="l14.425">       nsAutoCString utfNewName;</span>
<a href="#l14.426"></a><span id="l14.426">       rv = CopyUTF16toMUTF7(PromiseFlatString(newFolderName), utfNewName);</span>
<a href="#l14.427"></a><span id="l14.427">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.428"></a><span id="l14.428">       nsCString escapedFolderName;</span>
<a href="#l14.429"></a><span id="l14.429">       MsgEscapeString(utfNewName, nsINetUtil::ESCAPE_URL_PATH, escapedFolderName);</span>
<a href="#l14.430"></a><span id="l14.430">       urlSpec.Append(escapedFolderName);</span>
<a href="#l14.431"></a><span id="l14.431"> </span>
<a href="#l14.432"></a><span id="l14.432" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.433"></a><span id="l14.433" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.434"></a><span id="l14.434">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.435"></a><span id="l14.435">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, url);</span>
<a href="#l14.436"></a><span id="l14.436">     } // if (NS_SUCCEEDED(rv))</span>
<a href="#l14.437"></a><span id="l14.437">   } // if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l14.438"></a><span id="l14.438">   return rv;</span>
<a href="#l14.439"></a><span id="l14.439"> }</span>
<a href="#l14.440"></a><span id="l14.440"> </span>
<a href="#l14.441"></a><span id="l14.441"> NS_IMETHODIMP nsImapService::EnsureFolderExists(nsIMsgFolder *parent,</span>
<a href="#l14.442"></a><span id="l14.442" class="difflineat">@@ -2422,17 +2422,17 @@ NS_IMETHODIMP nsImapService::EnsureFolde</span>
<a href="#l14.443"></a><span id="l14.443">         urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.444"></a><span id="l14.444">       }</span>
<a href="#l14.445"></a><span id="l14.445">       nsAutoCString utfNewName; </span>
<a href="#l14.446"></a><span id="l14.446">       CopyUTF16toMUTF7(PromiseFlatString(newFolderName), utfNewName);</span>
<a href="#l14.447"></a><span id="l14.447">       nsCString escapedFolderName;</span>
<a href="#l14.448"></a><span id="l14.448">       MsgEscapeString(utfNewName, nsINetUtil::ESCAPE_URL_PATH, escapedFolderName);</span>
<a href="#l14.449"></a><span id="l14.449">       urlSpec.Append(escapedFolderName);</span>
<a href="#l14.450"></a><span id="l14.450"> </span>
<a href="#l14.451"></a><span id="l14.451" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.452"></a><span id="l14.452" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.453"></a><span id="l14.453">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.454"></a><span id="l14.454">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, url);</span>
<a href="#l14.455"></a><span id="l14.455">     } // if (NS_SUCCEEDED(rv))</span>
<a href="#l14.456"></a><span id="l14.456">   } // if (NS_SUCCEEDED(rv) &amp;&amp; imapUrl)</span>
<a href="#l14.457"></a><span id="l14.457">   return rv;</span>
<a href="#l14.458"></a><span id="l14.458"> }</span>
<a href="#l14.459"></a><span id="l14.459"> </span>
<a href="#l14.460"></a><span id="l14.460"> NS_IMETHODIMP nsImapService::ListFolder(nsIMsgFolder *aImapMailFolder,</span>
<a href="#l14.461"></a><span id="l14.461" class="difflineat">@@ -2527,17 +2527,17 @@ nsresult nsImapService::GetServerFromUrl</span>
<a href="#l14.462"></a><span id="l14.462">   if (NS_FAILED(rv) || !aServer)</span>
<a href="#l14.463"></a><span id="l14.463">   {</span>
<a href="#l14.464"></a><span id="l14.464">     nsAutoCString turl;</span>
<a href="#l14.465"></a><span id="l14.465">     nsCOMPtr&lt;nsIURL&gt; url = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l14.466"></a><span id="l14.466">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.467"></a><span id="l14.467"> </span>
<a href="#l14.468"></a><span id="l14.468">     rv = mailnewsUrl-&gt;GetSpec(turl);</span>
<a href="#l14.469"></a><span id="l14.469">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.470"></a><span id="l14.470" class="difflineminus">-    rv = url-&gt;SetSpec(turl);</span>
<a href="#l14.471"></a><span id="l14.471" class="difflineplus">+    rv = url-&gt;SetSpecInternal(turl);</span>
<a href="#l14.472"></a><span id="l14.472">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.473"></a><span id="l14.473"> </span>
<a href="#l14.474"></a><span id="l14.474">     url-&gt;SetUserPass(EmptyCString());</span>
<a href="#l14.475"></a><span id="l14.475">     rv = accountManager-&gt;FindServerByURI(url, false, aServer);</span>
<a href="#l14.476"></a><span id="l14.476">     if (*aServer)</span>
<a href="#l14.477"></a><span id="l14.477">       aImapUrl-&gt;SetExternalLinkUrl(true);</span>
<a href="#l14.478"></a><span id="l14.478">   }</span>
<a href="#l14.479"></a><span id="l14.479">   </span>
<a href="#l14.480"></a><span id="l14.480" class="difflineat">@@ -2562,21 +2562,21 @@ NS_IMETHODIMP nsImapService::NewURI(cons</span>
<a href="#l14.481"></a><span id="l14.481">   // nsAutoCString unescapedSpec(aSpec);</span>
<a href="#l14.482"></a><span id="l14.482">   // nsUnescape(unescapedSpec.BeginWriting());</span>
<a href="#l14.483"></a><span id="l14.483"> </span>
<a href="#l14.484"></a><span id="l14.484">   // set the spec</span>
<a href="#l14.485"></a><span id="l14.485">   if (aBaseURI)</span>
<a href="#l14.486"></a><span id="l14.486">   {</span>
<a href="#l14.487"></a><span id="l14.487">     nsAutoCString newSpec;</span>
<a href="#l14.488"></a><span id="l14.488">     aBaseURI-&gt;Resolve(aSpec, newSpec);</span>
<a href="#l14.489"></a><span id="l14.489" class="difflineminus">-    rv = mailnewsUrl-&gt;SetSpec(newSpec);</span>
<a href="#l14.490"></a><span id="l14.490" class="difflineplus">+    rv = mailnewsUrl-&gt;SetSpecInternal(newSpec);</span>
<a href="#l14.491"></a><span id="l14.491">   }</span>
<a href="#l14.492"></a><span id="l14.492">   else</span>
<a href="#l14.493"></a><span id="l14.493">   {</span>
<a href="#l14.494"></a><span id="l14.494" class="difflineminus">-    rv = mailnewsUrl-&gt;SetSpec(aSpec);</span>
<a href="#l14.495"></a><span id="l14.495" class="difflineplus">+    rv = mailnewsUrl-&gt;SetSpecInternal(aSpec);</span>
<a href="#l14.496"></a><span id="l14.496">   }</span>
<a href="#l14.497"></a><span id="l14.497"> </span>
<a href="#l14.498"></a><span id="l14.498">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.499"></a><span id="l14.499"> </span>
<a href="#l14.500"></a><span id="l14.500">   nsCString folderName;</span>
<a href="#l14.501"></a><span id="l14.501">   // if we can't get a folder name out of the url then I think this is an error</span>
<a href="#l14.502"></a><span id="l14.502">   aImapUrl-&gt;CreateCanonicalSourceFolderPathString(getter_Copies(folderName));</span>
<a href="#l14.503"></a><span id="l14.503">   if (folderName.IsEmpty())</span>
<a href="#l14.504"></a><span id="l14.504" class="difflineat">@@ -3077,17 +3077,17 @@ nsresult nsImapService::ChangeFolderSubs</span>
<a href="#l14.505"></a><span id="l14.505">       urlSpec.Append(command);</span>
<a href="#l14.506"></a><span id="l14.506">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.507"></a><span id="l14.507">       nsAutoCString utfFolderName;</span>
<a href="#l14.508"></a><span id="l14.508">       rv = CopyUTF16toMUTF7(PromiseFlatString(folderName), utfFolderName);</span>
<a href="#l14.509"></a><span id="l14.509">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.510"></a><span id="l14.510">       nsCString escapedFolderName;</span>
<a href="#l14.511"></a><span id="l14.511">       MsgEscapeString(utfFolderName, nsINetUtil::ESCAPE_URL_PATH, escapedFolderName);</span>
<a href="#l14.512"></a><span id="l14.512">       urlSpec.Append(escapedFolderName);</span>
<a href="#l14.513"></a><span id="l14.513" class="difflineminus">-      rv = uri-&gt;SetSpec(urlSpec);</span>
<a href="#l14.514"></a><span id="l14.514" class="difflineplus">+      rv = uri-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.515"></a><span id="l14.515">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.516"></a><span id="l14.516">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, url);</span>
<a href="#l14.517"></a><span id="l14.517">     }</span>
<a href="#l14.518"></a><span id="l14.518">   }</span>
<a href="#l14.519"></a><span id="l14.519">   return rv;</span>
<a href="#l14.520"></a><span id="l14.520"> }</span>
<a href="#l14.521"></a><span id="l14.521"> </span>
<a href="#l14.522"></a><span id="l14.522"> NS_IMETHODIMP nsImapService::UnsubscribeFolder(nsIMsgFolder *aFolder,</span>
<a href="#l14.523"></a><span id="l14.523" class="difflineat">@@ -3144,17 +3144,17 @@ NS_IMETHODIMP nsImapService::IssueComman</span>
<a href="#l14.524"></a><span id="l14.524">       urlSpec.Append(aCommand);</span>
<a href="#l14.525"></a><span id="l14.525">       urlSpec.Append('&gt;');</span>
<a href="#l14.526"></a><span id="l14.526">       urlSpec.Append(uidString);</span>
<a href="#l14.527"></a><span id="l14.527">       urlSpec.Append('&gt;');</span>
<a href="#l14.528"></a><span id="l14.528">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.529"></a><span id="l14.529">       urlSpec.Append(folderName);</span>
<a href="#l14.530"></a><span id="l14.530">       urlSpec.Append('&gt;');</span>
<a href="#l14.531"></a><span id="l14.531">       urlSpec.Append(uids);</span>
<a href="#l14.532"></a><span id="l14.532" class="difflineminus">-      rv = mailNewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l14.533"></a><span id="l14.533" class="difflineplus">+      rv = mailNewsUrl-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.534"></a><span id="l14.534">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.535"></a><span id="l14.535">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.536"></a><span id="l14.536">     }</span>
<a href="#l14.537"></a><span id="l14.537">   } // if we have a url to run....</span>
<a href="#l14.538"></a><span id="l14.538"> </span>
<a href="#l14.539"></a><span id="l14.539">   return rv;</span>
<a href="#l14.540"></a><span id="l14.540"> }</span>
<a href="#l14.541"></a><span id="l14.541"> </span>
<a href="#l14.542"></a><span id="l14.542" class="difflineat">@@ -3189,17 +3189,17 @@ NS_IMETHODIMP nsImapService::FetchCustom</span>
<a href="#l14.543"></a><span id="l14.543">       GetFolderName(anImapFolder, folderName);</span>
<a href="#l14.544"></a><span id="l14.544">       urlSpec.AppendLiteral(&quot;/customFetch&gt;UID&gt;&quot;);</span>
<a href="#l14.545"></a><span id="l14.545">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.546"></a><span id="l14.546">       urlSpec.Append(folderName);</span>
<a href="#l14.547"></a><span id="l14.547">       urlSpec.Append('&gt;');</span>
<a href="#l14.548"></a><span id="l14.548">       urlSpec.Append(uids);</span>
<a href="#l14.549"></a><span id="l14.549">       urlSpec.Append('&gt;');</span>
<a href="#l14.550"></a><span id="l14.550">       urlSpec.Append(aAttribute);</span>
<a href="#l14.551"></a><span id="l14.551" class="difflineminus">-      rv = mailNewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l14.552"></a><span id="l14.552" class="difflineplus">+      rv = mailNewsUrl-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.553"></a><span id="l14.553">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.554"></a><span id="l14.554">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.555"></a><span id="l14.555">     }</span>
<a href="#l14.556"></a><span id="l14.556">   } // if we have a url to run....</span>
<a href="#l14.557"></a><span id="l14.557"> </span>
<a href="#l14.558"></a><span id="l14.558">   return rv;</span>
<a href="#l14.559"></a><span id="l14.559"> }</span>
<a href="#l14.560"></a><span id="l14.560"> </span>
<a href="#l14.561"></a><span id="l14.561" class="difflineat">@@ -3236,17 +3236,17 @@ NS_IMETHODIMP nsImapService::StoreCustom</span>
<a href="#l14.562"></a><span id="l14.562">       urlSpec.Append(hierarchyDelimiter);</span>
<a href="#l14.563"></a><span id="l14.563">       urlSpec.Append(folderName);</span>
<a href="#l14.564"></a><span id="l14.564">       urlSpec.Append('&gt;');</span>
<a href="#l14.565"></a><span id="l14.565">       urlSpec.Append(uids);</span>
<a href="#l14.566"></a><span id="l14.566">       urlSpec.Append('&gt;');</span>
<a href="#l14.567"></a><span id="l14.567">       urlSpec.Append(flagsToAdd);</span>
<a href="#l14.568"></a><span id="l14.568">       urlSpec.Append('&gt;');</span>
<a href="#l14.569"></a><span id="l14.569">       urlSpec.Append(flagsToSubtract);</span>
<a href="#l14.570"></a><span id="l14.570" class="difflineminus">-      rv = mailNewsUrl-&gt;SetSpec(urlSpec);</span>
<a href="#l14.571"></a><span id="l14.571" class="difflineplus">+      rv = mailNewsUrl-&gt;SetSpecInternal(urlSpec);</span>
<a href="#l14.572"></a><span id="l14.572">       if (NS_SUCCEEDED(rv))</span>
<a href="#l14.573"></a><span id="l14.573">         rv = GetImapConnectionAndLoadUrl(imapUrl, nullptr, aURL);</span>
<a href="#l14.574"></a><span id="l14.574">     }</span>
<a href="#l14.575"></a><span id="l14.575">   } // if we have a url to run....</span>
<a href="#l14.576"></a><span id="l14.576"> </span>
<a href="#l14.577"></a><span id="l14.577">   return rv;</span>
<a href="#l14.578"></a><span id="l14.578"> }</span>
<a href="#l14.579"></a><span id="l14.579"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/imap/src/nsImapUrl.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapUrl.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -195,19 +195,19 @@ NS_IMETHODIMP nsImapUrl::SetImapServerSi</span>
<a href="#l15.4"></a><span id="l15.4">   return rv;</span>
<a href="#l15.5"></a><span id="l15.5"> }</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> ////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l15.9"></a><span id="l15.9"> // End nsIImapUrl specific support</span>
<a href="#l15.10"></a><span id="l15.10"> ////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-NS_IMETHODIMP nsImapUrl::SetSpec(const nsACString &amp;aSpec)</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+nsresult nsImapUrl::SetSpecInternal(const nsACString &amp;aSpec)</span>
<a href="#l15.14"></a><span id="l15.14"> {</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-  nsresult rv = nsMsgMailNewsUrl::SetSpec(aSpec);</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+  nsresult rv = nsMsgMailNewsUrl::SetSpecInternal(aSpec);</span>
<a href="#l15.17"></a><span id="l15.17">   if (NS_SUCCEEDED(rv))</span>
<a href="#l15.18"></a><span id="l15.18">   {</span>
<a href="#l15.19"></a><span id="l15.19">     m_validUrl = true;  // assume the best.</span>
<a href="#l15.20"></a><span id="l15.20">     rv = ParseUrl();</span>
<a href="#l15.21"></a><span id="l15.21">   }</span>
<a href="#l15.22"></a><span id="l15.22">   return rv;</span>
<a href="#l15.23"></a><span id="l15.23"> }</span>
<a href="#l15.24"></a><span id="l15.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/imap/src/nsImapUrl.h</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapUrl.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -22,17 +22,17 @@</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5"> class nsImapUrl : public nsIImapUrl, public nsMsgMailNewsUrl, public nsIMsgMessageUrl, public nsIMsgI18NUrl</span>
<a href="#l16.6"></a><span id="l16.6"> {</span>
<a href="#l16.7"></a><span id="l16.7"> public:</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9">   NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11">   // nsIURI override</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  NS_IMETHOD SetSpec(const nsACString &amp;aSpec) override;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  nsresult SetSpecInternal(const nsACString &amp;aSpec) override;</span>
<a href="#l16.14"></a><span id="l16.14">   NS_IMETHOD SetQuery(const nsACString &amp;aQuery) override;</span>
<a href="#l16.15"></a><span id="l16.15">   NS_IMETHOD CloneInternal(uint32_t aRefHandlingMode,</span>
<a href="#l16.16"></a><span id="l16.16">                            const nsACString&amp; newRef, nsIURI **_retval) override;</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18">   //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.19"></a><span id="l16.19">   // we support the nsIImapUrl interface</span>
<a href="#l16.20"></a><span id="l16.20">   //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l16.21"></a><span id="l16.21">   NS_DECL_NSIIMAPURL</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -3107,17 +3107,17 @@ nsMsgLocalMailFolder::GetIncomingServerT</span>
<a href="#l17.4"></a><span id="l17.4"> {</span>
<a href="#l17.5"></a><span id="l17.5">   nsresult rv;</span>
<a href="#l17.6"></a><span id="l17.6">   if (mType.IsEmpty())</span>
<a href="#l17.7"></a><span id="l17.7">   {</span>
<a href="#l17.8"></a><span id="l17.8">     nsCOMPtr&lt;nsIURL&gt; url = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l17.9"></a><span id="l17.9">     if (NS_FAILED(rv))</span>
<a href="#l17.10"></a><span id="l17.10">       return rv;</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    rv = url-&gt;SetSpec(mURI);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    rv = url-&gt;SetSpecInternal(mURI);</span>
<a href="#l17.14"></a><span id="l17.14">     if (NS_FAILED(rv))</span>
<a href="#l17.15"></a><span id="l17.15">       return rv;</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17">     nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l17.18"></a><span id="l17.18">              do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l17.19"></a><span id="l17.19">     if (NS_FAILED(rv))</span>
<a href="#l17.20"></a><span id="l17.20">       return rv;</span>
<a href="#l17.21"></a><span id="l17.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/local/src/nsLocalUtils.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalUtils.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -28,17 +28,17 @@</span>
<a href="#l18.4"></a><span id="l18.4"> static nsresult</span>
<a href="#l18.5"></a><span id="l18.5"> nsGetMailboxServer(const char *uriStr, nsIMsgIncomingServer** aResult)</span>
<a href="#l18.6"></a><span id="l18.6"> {</span>
<a href="#l18.7"></a><span id="l18.7">   nsresult rv = NS_OK;</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9">   nsCOMPtr&lt;nsIURL&gt; aUrl = do_CreateInstance(NS_STANDARDURL_CONTRACTID, &amp;rv);</span>
<a href="#l18.10"></a><span id="l18.10">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  rv = aUrl-&gt;SetSpec(nsDependentCString(uriStr));</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  rv = aUrl-&gt;SetSpecInternal(nsDependentCString(uriStr));</span>
<a href="#l18.14"></a><span id="l18.14">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l18.15"></a><span id="l18.15"> </span>
<a href="#l18.16"></a><span id="l18.16">   // retrieve the AccountManager</span>
<a href="#l18.17"></a><span id="l18.17">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l18.18"></a><span id="l18.18">     do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l18.19"></a><span id="l18.19">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21">   // find all local mail &quot;no servers&quot; matching the given hostname</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -56,17 +56,17 @@ nsresult nsMailboxService::ParseMailbox(</span>
<a href="#l19.4"></a><span id="l19.4">     nsAutoCString buf;</span>
<a href="#l19.5"></a><span id="l19.5">     MsgEscapeURL(mailboxPath,</span>
<a href="#l19.6"></a><span id="l19.6">                  nsINetUtil::ESCAPE_URL_MINIMAL | nsINetUtil::ESCAPE_URL_FORCED, buf);</span>
<a href="#l19.7"></a><span id="l19.7">     nsEscapeNativePath(buf);</span>
<a href="#l19.8"></a><span id="l19.8">     url-&gt;SetUpdatingFolder(true);</span>
<a href="#l19.9"></a><span id="l19.9">     url-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l19.10"></a><span id="l19.10">     nsAutoCString uriSpec(&quot;mailbox://&quot;);</span>
<a href="#l19.11"></a><span id="l19.11">     uriSpec.Append(buf);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    rv = url-&gt;SetSpec(uriSpec);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    rv = url-&gt;SetSpecInternal(uriSpec);</span>
<a href="#l19.14"></a><span id="l19.14">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.15"></a><span id="l19.15"> </span>
<a href="#l19.16"></a><span id="l19.16">     mailboxurl-&gt;SetMailboxParser(aMailboxParser);</span>
<a href="#l19.17"></a><span id="l19.17">     if (aUrlListener)</span>
<a href="#l19.18"></a><span id="l19.18">       url-&gt;RegisterListener(aUrlListener);</span>
<a href="#l19.19"></a><span id="l19.19"> </span>
<a href="#l19.20"></a><span id="l19.20">     rv = RunMailboxUrl(url, nullptr);</span>
<a href="#l19.21"></a><span id="l19.21">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -474,17 +474,17 @@ nsresult nsMailboxService::PrepareMessag</span>
<a href="#l19.23"></a><span id="l19.23">       else if (part)</span>
<a href="#l19.24"></a><span id="l19.24">         urlSpec = PR_smprintf(&quot;mailbox://%s?number=%lu&amp;%s&quot;, buf.get(), msgKey, part);</span>
<a href="#l19.25"></a><span id="l19.25">       else if (header)</span>
<a href="#l19.26"></a><span id="l19.26">         urlSpec = PR_smprintf(&quot;mailbox://%s?number=%lu&amp;%s&quot;, buf.get(), msgKey, header);</span>
<a href="#l19.27"></a><span id="l19.27">       else</span>
<a href="#l19.28"></a><span id="l19.28">         urlSpec = PR_smprintf(&quot;mailbox://%s?number=%lu&quot;, buf.get(), msgKey);</span>
<a href="#l19.29"></a><span id="l19.29"> </span>
<a href="#l19.30"></a><span id="l19.30">       nsCOMPtr &lt;nsIMsgMailNewsUrl&gt; url = do_QueryInterface(*aMailboxUrl);</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-      rv = url-&gt;SetSpec(nsDependentCString(urlSpec));</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+      rv = url-&gt;SetSpecInternal(nsDependentCString(urlSpec));</span>
<a href="#l19.33"></a><span id="l19.33">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.34"></a><span id="l19.34"> </span>
<a href="#l19.35"></a><span id="l19.35">       PR_smprintf_free(urlSpec);</span>
<a href="#l19.36"></a><span id="l19.36"> </span>
<a href="#l19.37"></a><span id="l19.37">       (*aMailboxUrl)-&gt;SetMailboxAction(aMailboxAction);</span>
<a href="#l19.38"></a><span id="l19.38"> </span>
<a href="#l19.39"></a><span id="l19.39">       // set up the url listener</span>
<a href="#l19.40"></a><span id="l19.40">       if (aUrlListener)</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineat">@@ -551,21 +551,21 @@ NS_IMETHODIMP nsMailboxService::NewURI(c</span>
<a href="#l19.42"></a><span id="l19.42">   // mailbox://&lt;account&gt;/&lt;mailbox name&gt;?... instead of</span>
<a href="#l19.43"></a><span id="l19.43">   // mailbox://&lt;path to folder&gt;?.... This is the case for pop3 download urls.</span>
<a href="#l19.44"></a><span id="l19.44">   // We know this, and the failure is harmless.</span>
<a href="#l19.45"></a><span id="l19.45">   if (aBaseURI)</span>
<a href="#l19.46"></a><span id="l19.46">   {</span>
<a href="#l19.47"></a><span id="l19.47">     nsAutoCString newSpec;</span>
<a href="#l19.48"></a><span id="l19.48">     rv = aBaseURI-&gt;Resolve(aSpec, newSpec);</span>
<a href="#l19.49"></a><span id="l19.49">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineminus">-    (void) aMsgUri-&gt;SetSpec(newSpec);</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+    (void)aMsgUri-&gt;SetSpecInternal(newSpec);</span>
<a href="#l19.52"></a><span id="l19.52">   }</span>
<a href="#l19.53"></a><span id="l19.53">   else</span>
<a href="#l19.54"></a><span id="l19.54">   {</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineminus">-    (void) aMsgUri-&gt;SetSpec(aSpec);</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineplus">+    (void)aMsgUri-&gt;SetSpecInternal(aSpec);</span>
<a href="#l19.57"></a><span id="l19.57">   }</span>
<a href="#l19.58"></a><span id="l19.58">   aMsgUri.forget(_retval);</span>
<a href="#l19.59"></a><span id="l19.59"> </span>
<a href="#l19.60"></a><span id="l19.60">   return rv;</span>
<a href="#l19.61"></a><span id="l19.61"> }</span>
<a href="#l19.62"></a><span id="l19.62"> </span>
<a href="#l19.63"></a><span id="l19.63"> NS_IMETHODIMP nsMailboxService::NewChannel(nsIURI *aURI, nsIChannel **_retval)</span>
<a href="#l19.64"></a><span id="l19.64"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxUrl.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxUrl.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -409,19 +409,19 @@ nsresult nsMailboxUrl::ParseUrl()</span>
<a href="#l20.4"></a><span id="l20.4">     m_filePath = do_QueryInterface(fileURLFile, &amp;rv);</span>
<a href="#l20.5"></a><span id="l20.5">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.6"></a><span id="l20.6">   }</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8">   GetPathQueryRef(m_file);</span>
<a href="#l20.9"></a><span id="l20.9">   return NS_OK;</span>
<a href="#l20.10"></a><span id="l20.10"> }</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-NS_IMETHODIMP nsMailboxUrl::SetSpec(const nsACString &amp;aSpec)</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+nsresult nsMailboxUrl::SetSpecInternal(const nsACString &amp;aSpec)</span>
<a href="#l20.14"></a><span id="l20.14"> {</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-  nsresult rv = nsMsgMailNewsUrl::SetSpec(aSpec);</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+  nsresult rv = nsMsgMailNewsUrl::SetSpecInternal(aSpec);</span>
<a href="#l20.17"></a><span id="l20.17">   if (NS_SUCCEEDED(rv))</span>
<a href="#l20.18"></a><span id="l20.18">     rv = ParseUrl();</span>
<a href="#l20.19"></a><span id="l20.19">   return rv;</span>
<a href="#l20.20"></a><span id="l20.20"> }</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22"> NS_IMETHODIMP nsMailboxUrl::SetQuery(const nsACString &amp;aQuery)</span>
<a href="#l20.23"></a><span id="l20.23"> {</span>
<a href="#l20.24"></a><span id="l20.24">   nsresult rv = nsMsgMailNewsUrl::SetQuery(aQuery);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxUrl.h</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxUrl.h</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -14,17 +14,17 @@</span>
<a href="#l21.4"></a><span id="l21.4"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l21.5"></a><span id="l21.5"> #include &quot;MailNewsTypes.h&quot;</span>
<a href="#l21.6"></a><span id="l21.6"> #include &quot;nsTArray.h&quot;</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> class nsMailboxUrl : public nsIMailboxUrl, public nsMsgMailNewsUrl, public nsIMsgMessageUrl, public nsIMsgI18NUrl</span>
<a href="#l21.9"></a><span id="l21.9"> {</span>
<a href="#l21.10"></a><span id="l21.10"> public:</span>
<a href="#l21.11"></a><span id="l21.11">   // nsIURI over-ride...</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  NS_IMETHOD SetSpec(const nsACString &amp;aSpec) override;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  nsresult SetSpecInternal(const nsACString &amp;aSpec) override;</span>
<a href="#l21.14"></a><span id="l21.14">   NS_IMETHOD SetQuery(const nsACString &amp;aQuery) override;</span>
<a href="#l21.15"></a><span id="l21.15"> </span>
<a href="#l21.16"></a><span id="l21.16">   // from nsIMailboxUrl:</span>
<a href="#l21.17"></a><span id="l21.17">   NS_IMETHOD SetMailboxParser(nsIStreamListener * aConsumer) override;</span>
<a href="#l21.18"></a><span id="l21.18">   NS_IMETHOD GetMailboxParser(nsIStreamListener ** aConsumer) override;</span>
<a href="#l21.19"></a><span id="l21.19">   NS_IMETHOD SetMailboxCopyHandler(nsIStreamListener *  aConsumer) override;</span>
<a href="#l21.20"></a><span id="l21.20">   NS_IMETHOD GetMailboxCopyHandler(nsIStreamListener ** aConsumer) override;</span>
<a href="#l21.21"></a><span id="l21.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/local/src/nsMsgMaildirStore.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgMaildirStore.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1250,17 +1250,17 @@ void MaildirStoreParser::TimerCallback(n</span>
<a href="#l22.4"></a><span id="l22.4">       nsCOMPtr&lt;nsIMailboxUrl&gt; mailboxurl =</span>
<a href="#l22.5"></a><span id="l22.5">         do_CreateInstance(NS_MAILBOXURL_CONTRACTID, &amp;rv);</span>
<a href="#l22.6"></a><span id="l22.6">       if (NS_SUCCEEDED(rv) &amp;&amp; mailboxurl)</span>
<a href="#l22.7"></a><span id="l22.7">       {</span>
<a href="#l22.8"></a><span id="l22.8">         nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; url = do_QueryInterface(mailboxurl);</span>
<a href="#l22.9"></a><span id="l22.9">         url-&gt;SetUpdatingFolder(true);</span>
<a href="#l22.10"></a><span id="l22.10">         nsAutoCString uriSpec(&quot;mailbox://&quot;);</span>
<a href="#l22.11"></a><span id="l22.11">         // ### TODO - what if SetSpec fails?</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-        (void) url-&gt;SetSpec(uriSpec);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+        (void)url-&gt;SetSpecInternal(uriSpec);</span>
<a href="#l22.14"></a><span id="l22.14">         parser-&gt;m_listener-&gt;OnStopRunningUrl(url, NS_OK);</span>
<a href="#l22.15"></a><span id="l22.15">       }</span>
<a href="#l22.16"></a><span id="l22.16">     }</span>
<a href="#l22.17"></a><span id="l22.17">     // Parsing complete and timer cancelled, so we release the parser object.</span>
<a href="#l22.18"></a><span id="l22.18">     delete parser;</span>
<a href="#l22.19"></a><span id="l22.19">     return;</span>
<a href="#l22.20"></a><span id="l22.20">   }</span>
<a href="#l22.21"></a><span id="l22.21">   nsCOMPtr&lt;nsISupports&gt; aSupport;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -215,17 +215,17 @@ nsresult nsPop3Service::BuildPop3Url(con</span>
<a href="#l23.4"></a><span id="l23.4">   nsCOMPtr&lt;nsIPop3URL&gt; pop3Url = do_CreateInstance(kPop3UrlCID, &amp;rv);</span>
<a href="#l23.5"></a><span id="l23.5">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7">   pop3Url-&gt;SetPop3Sink(pop3Sink);</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9">   rv = CallQueryInterface(pop3Url, aUrl);</span>
<a href="#l23.10"></a><span id="l23.10">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  rv = (*aUrl)-&gt;SetSpec(nsDependentCString(urlSpec));</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  rv = (*aUrl)-&gt;SetSpecInternal(nsDependentCString(urlSpec));</span>
<a href="#l23.14"></a><span id="l23.14">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l23.15"></a><span id="l23.15"> </span>
<a href="#l23.16"></a><span id="l23.16">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsurl = do_QueryInterface(pop3Url);</span>
<a href="#l23.17"></a><span id="l23.17">   if (mailnewsurl)</span>
<a href="#l23.18"></a><span id="l23.18">   {</span>
<a href="#l23.19"></a><span id="l23.19">     if (aUrlListener)</span>
<a href="#l23.20"></a><span id="l23.20">       mailnewsurl-&gt;RegisterListener(aUrlListener);</span>
<a href="#l23.21"></a><span id="l23.21">     if (aMsgWindow)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -1102,22 +1102,22 @@ nsresult nsMsgNewsFolder::CreateNewsgrou</span>
<a href="#l24.4"></a><span id="l24.4">   rv = nntpServer-&gt;GetSingleSignon(&amp;singleSignon);</span>
<a href="#l24.5"></a><span id="l24.5"> </span>
<a href="#l24.6"></a><span id="l24.6">   if (singleSignon)</span>
<a href="#l24.7"></a><span id="l24.7">   {</span>
<a href="#l24.8"></a><span id="l24.8">     nsCString serverURI;</span>
<a href="#l24.9"></a><span id="l24.9">     rv = server-&gt;GetServerURI(serverURI);</span>
<a href="#l24.10"></a><span id="l24.10">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-    rv = url-&gt;SetSpec(serverURI);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+    rv = url-&gt;SetSpecInternal(serverURI);</span>
<a href="#l24.14"></a><span id="l24.14">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.15"></a><span id="l24.15">   }</span>
<a href="#l24.16"></a><span id="l24.16">   else</span>
<a href="#l24.17"></a><span id="l24.17">   {</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-    rv = url-&gt;SetSpec(mURI);</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+    rv = url-&gt;SetSpecInternal(mURI);</span>
<a href="#l24.20"></a><span id="l24.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.21"></a><span id="l24.21">   }</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23">   int32_t port = 0;</span>
<a href="#l24.24"></a><span id="l24.24">   rv = url-&gt;GetPort(&amp;port);</span>
<a href="#l24.25"></a><span id="l24.25">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.26"></a><span id="l24.26"> </span>
<a href="#l24.27"></a><span id="l24.27">   if (port &lt;= 0)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -522,17 +522,17 @@ nsNntpService::DecomposeNewsMessageURI(c</span>
<a href="#l25.4"></a><span id="l25.4"> </span>
<a href="#l25.5"></a><span id="l25.5">   nsresult rv = NS_OK;</span>
<a href="#l25.6"></a><span id="l25.6"> </span>
<a href="#l25.7"></a><span id="l25.7">   // Construct the news URL</span>
<a href="#l25.8"></a><span id="l25.8">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsurl = do_CreateInstance(NS_NNTPURL_CONTRACTID,&amp;rv);</span>
<a href="#l25.9"></a><span id="l25.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.10"></a><span id="l25.10">   nsCOMPtr&lt;nsINntpUrl&gt; nntpUrl = do_QueryInterface(mailnewsurl, &amp;rv);</span>
<a href="#l25.11"></a><span id="l25.11">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  rv = mailnewsurl-&gt;SetSpec(nsDependentCString(aMessageURI));</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  rv = mailnewsurl-&gt;SetSpecInternal(nsDependentCString(aMessageURI));</span>
<a href="#l25.14"></a><span id="l25.14">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.15"></a><span id="l25.15"> </span>
<a href="#l25.16"></a><span id="l25.16">   // Get the group name and key from the url</span>
<a href="#l25.17"></a><span id="l25.17">   nsAutoCString groupName;</span>
<a href="#l25.18"></a><span id="l25.18">   rv = nntpUrl-&gt;GetGroup(groupName);</span>
<a href="#l25.19"></a><span id="l25.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.20"></a><span id="l25.20"> </span>
<a href="#l25.21"></a><span id="l25.21">   rv = nntpUrl-&gt;GetKey(aMsgKey);</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -850,17 +850,17 @@ nsNntpService::PostMessage(nsIFile *aFil</span>
<a href="#l25.23"></a><span id="l25.23"> </span>
<a href="#l25.24"></a><span id="l25.24">   nsCString newsUrlSpec;</span>
<a href="#l25.25"></a><span id="l25.25">   rv = SetUpNntpUrlForPosting(aAccountKey, getter_Copies(newsUrlSpec));</span>
<a href="#l25.26"></a><span id="l25.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.27"></a><span id="l25.27"> </span>
<a href="#l25.28"></a><span id="l25.28">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsurl = do_QueryInterface(nntpUrl, &amp;rv);</span>
<a href="#l25.29"></a><span id="l25.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.30"></a><span id="l25.30"> </span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-  rv = mailnewsurl-&gt;SetSpec(newsUrlSpec);</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+  rv = mailnewsurl-&gt;SetSpecInternal(newsUrlSpec);</span>
<a href="#l25.33"></a><span id="l25.33">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.34"></a><span id="l25.34"> </span>
<a href="#l25.35"></a><span id="l25.35">   if (aUrlListener) // register listener if there is one...</span>
<a href="#l25.36"></a><span id="l25.36">     mailnewsurl-&gt;RegisterListener(aUrlListener);</span>
<a href="#l25.37"></a><span id="l25.37"> </span>
<a href="#l25.38"></a><span id="l25.38">   nsCOMPtr&lt;nsINNTPNewsgroupPost&gt; post = do_CreateInstance(NS_NNTPNEWSGROUPPOST_CONTRACTID, &amp;rv);</span>
<a href="#l25.39"></a><span id="l25.39">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.40"></a><span id="l25.40"> </span>
<a href="#l25.41"></a><span id="l25.41" class="difflineat">@@ -887,17 +887,17 @@ nsNntpService::ConstructNntpUrl(const ch</span>
<a href="#l25.42"></a><span id="l25.42"> </span>
<a href="#l25.43"></a><span id="l25.43">   nsCOMPtr&lt;nsINntpUrl&gt; nntpUrl = do_CreateInstance(NS_NNTPURL_CONTRACTID, &amp;rv);</span>
<a href="#l25.44"></a><span id="l25.44">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l25.45"></a><span id="l25.45"> </span>
<a href="#l25.46"></a><span id="l25.46">   nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mailnewsurl = do_QueryInterface(nntpUrl);</span>
<a href="#l25.47"></a><span id="l25.47">   mailnewsurl-&gt;SetMsgWindow(aMsgWindow);</span>
<a href="#l25.48"></a><span id="l25.48">   nsCOMPtr&lt;nsIMsgMessageUrl&gt; msgUrl = do_QueryInterface(nntpUrl);</span>
<a href="#l25.49"></a><span id="l25.49">   msgUrl-&gt;SetUri(originalMessageUri);</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineminus">-  rv = mailnewsurl-&gt;SetSpec(nsDependentCString(urlString));</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineplus">+  rv = mailnewsurl-&gt;SetSpecInternal(nsDependentCString(urlString));</span>
<a href="#l25.52"></a><span id="l25.52">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.53"></a><span id="l25.53">   nntpUrl-&gt;SetNewsAction(action);</span>
<a href="#l25.54"></a><span id="l25.54"> </span>
<a href="#l25.55"></a><span id="l25.55">   if (originalMessageUri)</span>
<a href="#l25.56"></a><span id="l25.56">   {</span>
<a href="#l25.57"></a><span id="l25.57">     // we'll use this later in nsNNTPProtocol::ParseURL()</span>
<a href="#l25.58"></a><span id="l25.58">     rv = msgUrl-&gt;SetOriginalSpec(originalMessageUri);</span>
<a href="#l25.59"></a><span id="l25.59">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineat">@@ -1211,21 +1211,21 @@ NS_IMETHODIMP nsNntpService::NewURI(cons</span>
<a href="#l25.61"></a><span id="l25.61"> </span>
<a href="#l25.62"></a><span id="l25.62">     nsCOMPtr&lt;nsIURI&gt; nntpUri = do_CreateInstance(NS_NNTPURL_CONTRACTID, &amp;rv);</span>
<a href="#l25.63"></a><span id="l25.63">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l25.64"></a><span id="l25.64"> </span>
<a href="#l25.65"></a><span id="l25.65">     if (aBaseURI)</span>
<a href="#l25.66"></a><span id="l25.66">     {</span>
<a href="#l25.67"></a><span id="l25.67">       nsAutoCString newSpec;</span>
<a href="#l25.68"></a><span id="l25.68">       aBaseURI-&gt;Resolve(aSpec, newSpec);</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineminus">-      rv = nntpUri-&gt;SetSpec(newSpec);</span>
<a href="#l25.70"></a><span id="l25.70" class="difflineplus">+      rv = nntpUri-&gt;SetSpecInternal(newSpec);</span>
<a href="#l25.71"></a><span id="l25.71">     }</span>
<a href="#l25.72"></a><span id="l25.72">     else</span>
<a href="#l25.73"></a><span id="l25.73">     {</span>
<a href="#l25.74"></a><span id="l25.74" class="difflineminus">-      rv = nntpUri-&gt;SetSpec(aSpec);</span>
<a href="#l25.75"></a><span id="l25.75" class="difflineplus">+      rv = nntpUri-&gt;SetSpecInternal(aSpec);</span>
<a href="#l25.76"></a><span id="l25.76">     }</span>
<a href="#l25.77"></a><span id="l25.77">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l25.78"></a><span id="l25.78"> </span>
<a href="#l25.79"></a><span id="l25.79">     nntpUri.forget(_retval);</span>
<a href="#l25.80"></a><span id="l25.80">     return NS_OK;</span>
<a href="#l25.81"></a><span id="l25.81"> }</span>
<a href="#l25.82"></a><span id="l25.82"> </span>
<a href="#l25.83"></a><span id="l25.83"> NS_IMETHODIMP nsNntpService::NewChannel(nsIURI *aURI, nsIChannel **_retval)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/news/src/nsNntpUrl.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpUrl.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -67,17 +67,17 @@ NS_INTERFACE_MAP_END_INHERITING(nsMsgMai</span>
<a href="#l26.4"></a><span id="l26.4">  * nntp://host/group/key</span>
<a href="#l26.5"></a><span id="l26.5">  * news-message://host/group#key</span>
<a href="#l26.6"></a><span id="l26.6">  *</span>
<a href="#l26.7"></a><span id="l26.7">  * In addition, we use queries on the news URIs with authorities for internal</span>
<a href="#l26.8"></a><span id="l26.8">  * NNTP processing. The most important one is ?group=group&amp;key=key, for cache</span>
<a href="#l26.9"></a><span id="l26.9">  * canonicalization.</span>
<a href="#l26.10"></a><span id="l26.10">  */</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-NS_IMETHODIMP nsNntpUrl::SetSpec(const nsACString &amp;aSpec)</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+nsresult nsNntpUrl::SetSpecInternal(const nsACString &amp;aSpec)</span>
<a href="#l26.14"></a><span id="l26.14"> {</span>
<a href="#l26.15"></a><span id="l26.15">   // For [s]news: URIs, we need to munge the spec if it is no authority, because</span>
<a href="#l26.16"></a><span id="l26.16">   // the URI parser guesses the wrong thing otherwise</span>
<a href="#l26.17"></a><span id="l26.17">   nsCString parseSpec(aSpec);</span>
<a href="#l26.18"></a><span id="l26.18">   int32_t colon = parseSpec.Find(&quot;:&quot;);</span>
<a href="#l26.19"></a><span id="l26.19"> </span>
<a href="#l26.20"></a><span id="l26.20">   // Our smallest scheme is 4 characters long, so colon must be at least 4</span>
<a href="#l26.21"></a><span id="l26.21">   if (colon &lt; 4 || colon + 1 == (int32_t) parseSpec.Length())</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -88,17 +88,17 @@ NS_IMETHODIMP nsNntpUrl::SetSpec(const n</span>
<a href="#l26.23"></a><span id="l26.23">   {</span>
<a href="#l26.24"></a><span id="l26.24">     // To make this parse properly, we add in three slashes, which convinces the</span>
<a href="#l26.25"></a><span id="l26.25">     // parser that the authority component is empty.</span>
<a href="#l26.26"></a><span id="l26.26">     parseSpec = Substring(aSpec, 0, colon + 1);</span>
<a href="#l26.27"></a><span id="l26.27">     parseSpec.AppendLiteral(&quot;///&quot;);</span>
<a href="#l26.28"></a><span id="l26.28">     parseSpec += Substring(aSpec, colon + 1);</span>
<a href="#l26.29"></a><span id="l26.29">   }</span>
<a href="#l26.30"></a><span id="l26.30"> </span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-  nsresult rv = nsMsgMailNewsUrl::SetSpec(parseSpec);</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+  nsresult rv = nsMsgMailNewsUrl::SetSpecInternal(parseSpec);</span>
<a href="#l26.33"></a><span id="l26.33">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l26.34"></a><span id="l26.34"> </span>
<a href="#l26.35"></a><span id="l26.35">   nsAutoCString scheme;</span>
<a href="#l26.36"></a><span id="l26.36">   rv = GetScheme(scheme);</span>
<a href="#l26.37"></a><span id="l26.37">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.38"></a><span id="l26.38"> </span>
<a href="#l26.39"></a><span id="l26.39">   if (scheme.EqualsLiteral(&quot;news&quot;) || scheme.EqualsLiteral(&quot;snews&quot;))</span>
<a href="#l26.40"></a><span id="l26.40">     rv = ParseNewsURL();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/news/src/nsNntpUrl.h</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpUrl.h</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -14,17 +14,17 @@</span>
<a href="#l27.4"></a><span id="l27.4"> class nsNntpUrl : public nsINntpUrl, public nsMsgMailNewsUrl, public nsIMsgMessageUrl, public nsIMsgI18NUrl</span>
<a href="#l27.5"></a><span id="l27.5"> {</span>
<a href="#l27.6"></a><span id="l27.6"> public:</span>
<a href="#l27.7"></a><span id="l27.7">   NS_DECL_NSINNTPURL</span>
<a href="#l27.8"></a><span id="l27.8">   NS_DECL_NSIMSGMESSAGEURL</span>
<a href="#l27.9"></a><span id="l27.9">   NS_DECL_NSIMSGI18NURL</span>
<a href="#l27.10"></a><span id="l27.10"> </span>
<a href="#l27.11"></a><span id="l27.11">   // nsIURI over-ride...</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  NS_IMETHOD SetSpec(const nsACString &amp;aSpec) override;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  nsresult SetSpecInternal(const nsACString &amp;aSpec) override;</span>
<a href="#l27.14"></a><span id="l27.14"> </span>
<a href="#l27.15"></a><span id="l27.15">   NS_IMETHOD IsUrlType(uint32_t type, bool *isType) override;</span>
<a href="#l27.16"></a><span id="l27.16"> </span>
<a href="#l27.17"></a><span id="l27.17">   // nsIMsgMailNewsUrl overrides</span>
<a href="#l27.18"></a><span id="l27.18">   NS_IMETHOD GetServer(nsIMsgIncomingServer **server) override;</span>
<a href="#l27.19"></a><span id="l27.19">   NS_IMETHOD GetFolder(nsIMsgFolder **msgFolder) override;</span>
<a href="#l27.20"></a><span id="l27.20">   NS_IMETHOD CloneInternal(uint32_t aRefHandlingMode,</span>
<a href="#l27.21"></a><span id="l27.21">                            const nsACString&amp; newRef,nsIURI **_retval) override;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

