<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 13982:dab1bbd9b4a0155f8915e327c2980434928ec87c</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ dab1bbd9b4a0155f8915e327c2980434928ec87c" />
<meta property="og:url" content="/comm-central/rev/dab1bbd9b4a0155f8915e327c2980434928ec87c" />
<meta property="og:description" content="Workaround horrible focus bug on Windows. When the focus was given to an already opened conversation tab from the buddy list, the textfield of the conversation was unusable until the user manually unfocused and refocused it." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / dab1bbd9b4a0155f8915e327c2980434928ec87c 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/dab1bbd9b4a0155f8915e327c2980434928ec87c">shortlog</a> |
<a href="/comm-central/log/dab1bbd9b4a0155f8915e327c2980434928ec87c">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/dab1bbd9b4a0155f8915e327c2980434928ec87c">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/dab1bbd9b4a0155f8915e327c2980434928ec87c">files</a> |
changeset |
<a href="/comm-central/raw-rev/dab1bbd9b4a0155f8915e327c2980434928ec87c">raw</a>  | <a href="/comm-central/archive/dab1bbd9b4a0155f8915e327c2980434928ec87c.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Workaround horrible focus bug on Windows. When the focus was given to an already opened conversation tab from the buddy list, the textfield of the conversation was unusable until the user manually unfocused and refocused it.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#108;&#111;&#114;&#105;&#97;&#110;&#32;&#81;&#117;&#232;&#122;&#101;&#32;&#60;&#102;&#108;&#111;&#114;&#105;&#97;&#110;&#64;&#105;&#110;&#115;&#116;&#97;&#110;&#116;&#98;&#105;&#114;&#100;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 23 Jun 2009 18:39:09 +0200</td></tr>

<tr>
 <td>changeset 13982</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/dab1bbd9b4a0155f8915e327c2980434928ec87c">dab1bbd9b4a0155f8915e327c2980434928ec87c</a></td>
</tr>



<tr>
<td>parent 13981</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5cf5cb56513ef44c9b977a9cbb114c09b24282f7">5cf5cb56513ef44c9b977a9cbb114c09b24282f7</a>
</td>
</tr>

<tr>
<td>child 13983</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/240e8bf89b01d653e3c48cb51d5d2a1237fc1ca2">240e8bf89b01d653e3c48cb51d5d2a1237fc1ca2</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=dab1bbd9b4a0155f8915e327c2980434928ec87c">9778</a></td></tr>
<tr><td>push user</td><td>florian@queze.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 12 Jan 2014 18:25:45 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f81a23bfefcd [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>






</table></div>

<div class="page_body description">Workaround horrible focus bug on Windows. When the focus was given to an already opened conversation tab from the buddy list, the textfield of the conversation was unusable until the user manually unfocused and refocused it.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/buddy.xml">im/base/content/instantbird/buddy.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/buddy.xml">file</a> |
<a href="/comm-central/annotate/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/buddy.xml">annotate</a> |
<a href="/comm-central/diff/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/buddy.xml">diff</a> |
<a href="/comm-central/comparison/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/buddy.xml">comparison</a> |
<a href="/comm-central/log/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/buddy.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/conversation.xml">im/base/content/instantbird/conversation.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/conversation.xml">file</a> |
<a href="/comm-central/annotate/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/conversation.xml">annotate</a> |
<a href="/comm-central/diff/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/conversation.xml">diff</a> |
<a href="/comm-central/comparison/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/conversation.xml">comparison</a> |
<a href="/comm-central/log/dab1bbd9b4a0155f8915e327c2980434928ec87c/im/base/content/instantbird/conversation.xml">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/im/base/content/instantbird/buddy.xml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/im/base/content/instantbird/buddy.xml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -420,18 +420,18 @@</span>
<a href="#l1.4"></a><span id="l1.4">            conv = this.accounts[id].createConversation();</span>
<a href="#l1.5"></a><span id="l1.5">            break;</span>
<a href="#l1.6"></a><span id="l1.6">          }</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">          var wm = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l1.9"></a><span id="l1.9">                             .getService(Components.interfaces.nsIWindowMediator);</span>
<a href="#l1.10"></a><span id="l1.10">          var convWindow = wm.getMostRecentWindow(&quot;Messenger:convs&quot;);</span>
<a href="#l1.11"></a><span id="l1.11">          if (convWindow) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+           convWindow.focus();</span>
<a href="#l1.13"></a><span id="l1.13">            convWindow.msgObserver.focusConv(conv);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-           convWindow.focus();</span>
<a href="#l1.15"></a><span id="l1.15">          }</span>
<a href="#l1.16"></a><span id="l1.16">        ]]&gt;</span>
<a href="#l1.17"></a><span id="l1.17">       &lt;/body&gt;</span>
<a href="#l1.18"></a><span id="l1.18">      &lt;/method&gt;</span>
<a href="#l1.19"></a><span id="l1.19">     &lt;/implementation&gt;</span>
<a href="#l1.20"></a><span id="l1.20">     &lt;handlers&gt;</span>
<a href="#l1.21"></a><span id="l1.21">      &lt;handler event=&quot;click&quot; clickcount=&quot;2&quot; action=&quot;openConversation();&quot;/&gt;</span>
<a href="#l1.22"></a><span id="l1.22">     &lt;/handlers&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/im/base/content/instantbird/conversation.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/im/base/content/instantbird/conversation.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -640,16 +640,24 @@</span>
<a href="#l2.4"></a><span id="l2.4">           }</span>
<a href="#l2.5"></a><span id="l2.5">        ]]&gt;</span>
<a href="#l2.6"></a><span id="l2.6">        &lt;/body&gt;</span>
<a href="#l2.7"></a><span id="l2.7">      &lt;/method&gt;</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">      &lt;method name=&quot;focus&quot;&gt;</span>
<a href="#l2.10"></a><span id="l2.10">        &lt;body&gt;</span>
<a href="#l2.11"></a><span id="l2.11">        &lt;![CDATA[</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+#ifdef XP_WIN</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+         // workaround Windows-only focus bug that appeared recently:</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+         // Focusing a window breaks the focus in the currently</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+         // focused textfield. We have to remove and reset the focus to</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+         // work around this. Fortunately, on Windows textboxes have no</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+         // visible focus ring to this hack isn't visible to the user</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+         this.editor.blur();</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+#endif</span>
<a href="#l2.20"></a><span id="l2.20">          this.editor.focus();</span>
<a href="#l2.21"></a><span id="l2.21">          this.displayStatusText();</span>
<a href="#l2.22"></a><span id="l2.22">        ]]&gt;</span>
<a href="#l2.23"></a><span id="l2.23">        &lt;/body&gt;</span>
<a href="#l2.24"></a><span id="l2.24">      &lt;/method&gt;</span>
<a href="#l2.25"></a><span id="l2.25"> </span>
<a href="#l2.26"></a><span id="l2.26">      &lt;method name=&quot;displayStatusText&quot;&gt;</span>
<a href="#l2.27"></a><span id="l2.27">        &lt;body&gt;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

