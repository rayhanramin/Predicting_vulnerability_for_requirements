<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 8485:77a6a1df6eb3a0ae424b70a7acd29ae535d901ab</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 77a6a1df6eb3a0ae424b70a7acd29ae535d901ab" />
<meta property="og:url" content="/comm-central/rev/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab" />
<meta property="og:description" content="Bug 686273 - Subscribed WCAP calendars not appearing (do not use &quot;cal&quot; as variable name because it shadows the namespace &quot;cal&quot;) r=philipp" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 77a6a1df6eb3a0ae424b70a7acd29ae535d901ab 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab">shortlog</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab">files</a> |
changeset |
<a href="/comm-central/raw-rev/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab">raw</a>  | <a href="/comm-central/archive/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=686273">Bug 686273</a> - Subscribed WCAP calendars not appearing (do not use &quot;cal&quot; as variable name because it shadows the namespace &quot;cal&quot;) r=philipp
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#116;&#101;&#102;&#97;&#110;&#32;&#83;&#105;&#116;&#116;&#101;&#114;&#32;&#60;&#115;&#115;&#105;&#116;&#116;&#101;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 13 Sep 2011 21:21:32 +0200</td></tr>

<tr>
 <td>changeset 8485</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab">77a6a1df6eb3a0ae424b70a7acd29ae535d901ab</a></td>
</tr>



<tr>
<td>parent 8484</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e8e6b7cac38d00444bca8997302c9b82be405e38">e8e6b7cac38d00444bca8997302c9b82be405e38</a>
</td>
</tr>

<tr>
<td>child 8486</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/edfbcb8dc14edee3c94b4e3de967d86d3cd2e118">edfbcb8dc14edee3c94b4e3de967d86d3cd2e118</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=77a6a1df6eb3a0ae424b70a7acd29ae535d901ab">6514</a></td></tr>
<tr><td>push user</td><td>ssitter@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 13 Sep 2011 19:22:38 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@77a6a1df6eb3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=77a6a1df6eb3a0ae424b70a7acd29ae535d901ab">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=77a6a1df6eb3a0ae424b70a7acd29ae535d901ab&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=77a6a1df6eb3a0ae424b70a7acd29ae535d901ab&newProject=comm-central&newRevision=77a6a1df6eb3a0ae424b70a7acd29ae535d901ab&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=77a6a1df6eb3a0ae424b70a7acd29ae535d901ab&newProject=comm-central&newRevision=77a6a1df6eb3a0ae424b70a7acd29ae535d901ab&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=77a6a1df6eb3a0ae424b70a7acd29ae535d901ab&newProject=comm-central&newRevision=77a6a1df6eb3a0ae424b70a7acd29ae535d901ab&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28philipp%29&revcount=50">philipp</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=686273">686273</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=686273">Bug 686273</a> - Subscribed WCAP calendars not appearing (do not use &quot;cal&quot; as variable name because it shadows the namespace &quot;cal&quot;) r=philipp</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-common-sets.js">calendar/base/content/calendar-common-sets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-common-sets.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-common-sets.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-common-sets.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-common-sets.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-common-sets.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-item-editing.js">calendar/base/content/calendar-item-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-item-editing.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-item-editing.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-item-editing.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-item-editing.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-item-editing.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-event-dialog.js">calendar/base/content/dialogs/calendar-event-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-event-dialog.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-event-dialog.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-event-dialog.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-event-dialog.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-event-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-migration-dialog.js">calendar/base/content/dialogs/calendar-migration-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-migration-dialog.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-migration-dialog.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-migration-dialog.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-migration-dialog.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-migration-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">calendar/base/content/dialogs/calendar-subscriptions-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/chooseCalendarDialog.xul">calendar/base/content/dialogs/chooseCalendarDialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/chooseCalendarDialog.xul">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/chooseCalendarDialog.xul">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/chooseCalendarDialog.xul">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/chooseCalendarDialog.xul">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/content/dialogs/chooseCalendarDialog.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calItemBase.js">calendar/base/src/calItemBase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calItemBase.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calItemBase.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calItemBase.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calItemBase.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calItemBase.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calTransactionManager.js">calendar/base/src/calTransactionManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calTransactionManager.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calTransactionManager.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calTransactionManager.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calTransactionManager.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/base/src/calTransactionManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendar.js">calendar/providers/wcap/calWcapCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendar.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendar.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendar.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendar.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendarItems.js">calendar/providers/wcap/calWcapCalendarItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendarItems.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendarItems.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendarItems.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendarItems.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapCalendarItems.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/calendar.js">calendar/resources/content/calendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/calendar.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/calendar.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/calendar.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/calendar.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/calendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/publish.js">calendar/resources/content/publish.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/publish.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/publish.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/publish.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/publish.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/resources/content/publish.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/head_consts.js">calendar/test/unit/head_consts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/head_consts.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/head_consts.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/head_consts.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/head_consts.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/head_consts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/test_providers.js">calendar/test/unit/test_providers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/test_providers.js">file</a> |
<a href="/comm-central/annotate/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/test_providers.js">annotate</a> |
<a href="/comm-central/diff/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/test_providers.js">diff</a> |
<a href="/comm-central/comparison/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/test_providers.js">comparison</a> |
<a href="/comm-central/log/77a6a1df6eb3a0ae424b70a7acd29ae535d901ab/calendar/test/unit/test_providers.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-common-sets.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-common-sets.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -569,20 +569,20 @@ var calendarController = {</span>
<a href="#l1.4"></a><span id="l1.4">     },</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">     /**</span>
<a href="#l1.7"></a><span id="l1.7">      * Returns a boolean indicating that all local calendars are readonly</span>
<a href="#l1.8"></a><span id="l1.8">      */</span>
<a href="#l1.9"></a><span id="l1.9">     get all_local_calendars_readonly() {</span>
<a href="#l1.10"></a><span id="l1.10">         // We might want to speed this part up by keeping track of this in the</span>
<a href="#l1.11"></a><span id="l1.11">         // calendar manager.</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        var cals = getCalendarManager().getCalendars({});</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-        var count = cals.length;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-        for each (var cal in cals) {</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-            if (!isCalendarWritable(cal)) {</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+        var calendars = getCalendarManager().getCalendars({});</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+        var count = calendars.length;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+        for each (var calendar in calendars) {</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+            if (!isCalendarWritable(calendar)) {</span>
<a href="#l1.20"></a><span id="l1.20">                 count--;</span>
<a href="#l1.21"></a><span id="l1.21">             }</span>
<a href="#l1.22"></a><span id="l1.22">         }</span>
<a href="#l1.23"></a><span id="l1.23">         return (count == 0);</span>
<a href="#l1.24"></a><span id="l1.24">     },</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">     /**</span>
<a href="#l1.27"></a><span id="l1.27">      * Returns a boolean indicating if the items selected in the current view</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineat">@@ -598,37 +598,37 @@ var calendarController = {</span>
<a href="#l1.29"></a><span id="l1.29">     /**</span>
<a href="#l1.30"></a><span id="l1.30">      * Returns a boolean indicating that at least one of the calendars supports</span>
<a href="#l1.31"></a><span id="l1.31">      * tasks.</span>
<a href="#l1.32"></a><span id="l1.32">      */</span>
<a href="#l1.33"></a><span id="l1.33">     get calendars_support_tasks() {</span>
<a href="#l1.34"></a><span id="l1.34">         // XXX We might want to cache this</span>
<a href="#l1.35"></a><span id="l1.35">         var calendars = getCalendarManager().getCalendars({});</span>
<a href="#l1.36"></a><span id="l1.36"> </span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-        for each (var cal in calendars) {</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-            if (isCalendarWritable(cal) &amp;&amp;</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-                cal.getProperty(&quot;capabilities.tasks.supported&quot;) !== false) {</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+        for each (var calendar in calendars) {</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+            if (isCalendarWritable(calendar) &amp;&amp;</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+                calendar.getProperty(&quot;capabilities.tasks.supported&quot;) !== false) {</span>
<a href="#l1.43"></a><span id="l1.43">                 return true;</span>
<a href="#l1.44"></a><span id="l1.44">             }</span>
<a href="#l1.45"></a><span id="l1.45">         }</span>
<a href="#l1.46"></a><span id="l1.46">         return false;</span>
<a href="#l1.47"></a><span id="l1.47">     },</span>
<a href="#l1.48"></a><span id="l1.48"> </span>
<a href="#l1.49"></a><span id="l1.49"> </span>
<a href="#l1.50"></a><span id="l1.50">     /**</span>
<a href="#l1.51"></a><span id="l1.51">      * Returns a boolean indicating that at least one of the calendars supports</span>
<a href="#l1.52"></a><span id="l1.52">      * events.</span>
<a href="#l1.53"></a><span id="l1.53">      */</span>
<a href="#l1.54"></a><span id="l1.54">     get calendars_support_events() {</span>
<a href="#l1.55"></a><span id="l1.55">         // XXX We might want to cache this</span>
<a href="#l1.56"></a><span id="l1.56">         var calendars = getCalendarManager().getCalendars({});</span>
<a href="#l1.57"></a><span id="l1.57"> </span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-        for each (var cal in calendars) {</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-            if (isCalendarWritable(cal) &amp;&amp;</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-                cal.getProperty(&quot;capabilities.events.supported&quot;) !== false) {</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+        for each (var calendar in calendars) {</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+            if (isCalendarWritable(calendar) &amp;&amp;</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+                calendar.getProperty(&quot;capabilities.events.supported&quot;) !== false) {</span>
<a href="#l1.64"></a><span id="l1.64">                 return true;</span>
<a href="#l1.65"></a><span id="l1.65">             }</span>
<a href="#l1.66"></a><span id="l1.66">         }</span>
<a href="#l1.67"></a><span id="l1.67">         return false;</span>
<a href="#l1.68"></a><span id="l1.68">     },</span>
<a href="#l1.69"></a><span id="l1.69"> </span>
<a href="#l1.70"></a><span id="l1.70">     /**</span>
<a href="#l1.71"></a><span id="l1.71">      * Returns a boolean indicating that tasks are selected.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-item-editing.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-editing.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -243,22 +243,22 @@ function openEventDialog(calendarItem, c</span>
<a href="#l2.4"></a><span id="l2.4">     // Set up some defaults</span>
<a href="#l2.5"></a><span id="l2.5">     mode = mode || &quot;new&quot;;</span>
<a href="#l2.6"></a><span id="l2.6">     calendar = calendar || getSelectedCalendar();</span>
<a href="#l2.7"></a><span id="l2.7">     var calendars = getCalendarManager().getCalendars({});</span>
<a href="#l2.8"></a><span id="l2.8">     calendars = calendars.filter(isCalendarWritable);</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10">     var isItemSupported;</span>
<a href="#l2.11"></a><span id="l2.11">     if (isToDo(calendarItem)) {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        isItemSupported = function isTodoSupported(cal) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-            return (cal.getProperty(&quot;capabilities.tasks.supported&quot;) !== false);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+        isItemSupported = function isTodoSupported(aCalendar) {</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+            return (aCalendar.getProperty(&quot;capabilities.tasks.supported&quot;) !== false);</span>
<a href="#l2.16"></a><span id="l2.16">         };</span>
<a href="#l2.17"></a><span id="l2.17">     } else if (isEvent(calendarItem)) {</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-        isItemSupported = function isEventSupported(cal) {</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-            return (cal.getProperty(&quot;capabilities.events.supported&quot;) !== false);</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+        isItemSupported = function isEventSupported(aCalendar) {</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+            return (aCalendar.getProperty(&quot;capabilities.events.supported&quot;) !== false);</span>
<a href="#l2.22"></a><span id="l2.22">         };</span>
<a href="#l2.23"></a><span id="l2.23">     }</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25">     // Filter out calendars that don't support the given calendar item</span>
<a href="#l2.26"></a><span id="l2.26">     calendars = calendars.filter(isItemSupported);</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">     if (mode == &quot;new&quot; &amp;&amp; calendars.length &lt; 1 &amp;&amp;</span>
<a href="#l2.29"></a><span id="l2.29">         (!isCalendarWritable(calendar) || !isItemSupported(calendar))) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1928,19 +1928,19 @@</span>
<a href="#l3.4"></a><span id="l3.4">       &lt;!-- mouse down handler, in empty event column regions.  Starts sweeping out a new</span>
<a href="#l3.5"></a><span id="l3.5">          - event.</span>
<a href="#l3.6"></a><span id="l3.6">         --&gt;</span>
<a href="#l3.7"></a><span id="l3.7">       &lt;handler event=&quot;mousedown&quot;&gt;&lt;![CDATA[</span>
<a href="#l3.8"></a><span id="l3.8">         // select this column</span>
<a href="#l3.9"></a><span id="l3.9">         this.calendarView.selectedDay = this.mDate;</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">         // If the selected calendar is readOnly, we don't want any sweeping.</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-        let cal = getSelectedCalendar();</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-        if (!isCalendarWritable(cal) ||</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-            cal.getProperty(&quot;capabilities.events.supported&quot;) === false) {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+        let calendar = getSelectedCalendar();</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+        if (!isCalendarWritable(calendar) ||</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+            calendar.getProperty(&quot;capabilities.events.supported&quot;) === false) {</span>
<a href="#l3.18"></a><span id="l3.18">             return;</span>
<a href="#l3.19"></a><span id="l3.19">         }</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">         // Only start sweeping out an event if the left button was clicked</span>
<a href="#l3.22"></a><span id="l3.22">         if (event.button != 0) {</span>
<a href="#l3.23"></a><span id="l3.23">             return;</span>
<a href="#l3.24"></a><span id="l3.24">         }</span>
<a href="#l3.25"></a><span id="l3.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -60,23 +60,23 @@ var gConfirmCancel = true;</span>
<a href="#l4.4"></a><span id="l4.4"> var gLastRepeatSelection = 0;</span>
<a href="#l4.5"></a><span id="l4.5"> var gIgnoreUpdate = false;</span>
<a href="#l4.6"></a><span id="l4.6"> var gShowTimeAs = null;</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> /**</span>
<a href="#l4.9"></a><span id="l4.9">  * Checks if the given calendar supports notifying attendees. The item is needed</span>
<a href="#l4.10"></a><span id="l4.10">  * since calendars may support notifications for only some types of items.</span>
<a href="#l4.11"></a><span id="l4.11">  *</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">- * @param calendar    The calendar to check</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+ * @param aCalendar   The calendar to check</span>
<a href="#l4.14"></a><span id="l4.14">  * @param item        The item to check support for.</span>
<a href="#l4.15"></a><span id="l4.15">  */</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-function canNotifyAttendees(calendar, item) {</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+function canNotifyAttendees(aCalendar, item) {</span>
<a href="#l4.18"></a><span id="l4.18">     try {</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-        var cal = calendar.QueryInterface(Components.interfaces.calISchedulingSupport);</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-        return (cal.canNotify(&quot;REQUEST&quot;, item) &amp;&amp; cal.canNotify(&quot;CANCEL&quot;, item));</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+        var calendar = aCalendar.QueryInterface(Components.interfaces.calISchedulingSupport);</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+        return (calendar.canNotify(&quot;REQUEST&quot;, item) &amp;&amp; calendar.canNotify(&quot;CANCEL&quot;, item));</span>
<a href="#l4.23"></a><span id="l4.23">     } catch (exc) {</span>
<a href="#l4.24"></a><span id="l4.24">         return false;</span>
<a href="#l4.25"></a><span id="l4.25">     }</span>
<a href="#l4.26"></a><span id="l4.26"> }</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28"> /**</span>
<a href="#l4.29"></a><span id="l4.29">  * Update menu items that rely on focus</span>
<a href="#l4.30"></a><span id="l4.30">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -305,35 +305,35 @@ var gDataMigrator = {</span>
<a href="#l5.4"></a><span id="l5.4">                 return aNode.getAttributeNS(&quot;http://home.netscape.com/NC-rdf#&quot;,</span>
<a href="#l5.5"></a><span id="l5.5">                                             aAttr);</span>
<a href="#l5.6"></a><span id="l5.6">             }</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">             const RDFNS = &quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;;</span>
<a href="#l5.9"></a><span id="l5.9">             var nodes = aDoc.getElementsByTagNameNS(RDFNS, &quot;Description&quot;);</span>
<a href="#l5.10"></a><span id="l5.10">             LOG(&quot;nodes: &quot; + nodes.length);</span>
<a href="#l5.11"></a><span id="l5.11">             for (var i = 0; i &lt; nodes.length; i++) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-                LOG(&quot;Beginning cal node&quot;);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-                var cal;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+                LOG(&quot;Beginning calendar node&quot;);</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+                var calendar;</span>
<a href="#l5.16"></a><span id="l5.16">                 var node = nodes[i];</span>
<a href="#l5.17"></a><span id="l5.17">                 if (getRDFAttr(node, &quot;remote&quot;) == &quot;false&quot;) {</span>
<a href="#l5.18"></a><span id="l5.18">                     LOG(&quot;not remote&quot;);</span>
<a href="#l5.19"></a><span id="l5.19">                     var localFile = Components.classes[&quot;@mozilla.org/file/local;1&quot;]</span>
<a href="#l5.20"></a><span id="l5.20">                                     .createInstance(Components.interfaces.nsILocalFile);</span>
<a href="#l5.21"></a><span id="l5.21">                     localFile.initWithPath(getRDFAttr(node, &quot;path&quot;));</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-                    cal = gDataMigrator.importICSToStorage(localFile);</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+                    calendar = gDataMigrator.importICSToStorage(localFile);</span>
<a href="#l5.24"></a><span id="l5.24">                 } else {</span>
<a href="#l5.25"></a><span id="l5.25">                     // Remote subscription</span>
<a href="#l5.26"></a><span id="l5.26">                     // XXX check for duplicates</span>
<a href="#l5.27"></a><span id="l5.27">                     var url = makeURL(getRDFAttr(node, &quot;remotePath&quot;));</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-                    cal = calManager.createCalendar(&quot;ics&quot;, url);</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+                    calendar = calManager.createCalendar(&quot;ics&quot;, url);</span>
<a href="#l5.30"></a><span id="l5.30">                 }</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-                cal.name = getRDFAttr(node, &quot;name&quot;);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-                cal.setProperty(&quot;color&quot;, getRDFAttr(node, &quot;color&quot;));</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-                calManager.registerCalendar(cal);</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-                getCompositeCalendar().addCalendar(cal);</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+                calendar.name = getRDFAttr(node, &quot;name&quot;);</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+                calendar.setProperty(&quot;color&quot;, getRDFAttr(node, &quot;color&quot;));</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+                calManager.registerCalendar(calendar);</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+                getCompositeCalendar().addCalendar(calendar);</span>
<a href="#l5.39"></a><span id="l5.39">             }</span>
<a href="#l5.40"></a><span id="l5.40">             aCallback();</span>
<a href="#l5.41"></a><span id="l5.41">         }</span>
<a href="#l5.42"></a><span id="l5.42"> </span>
<a href="#l5.43"></a><span id="l5.43">         var migrators = [];</span>
<a href="#l5.44"></a><span id="l5.44"> </span>
<a href="#l5.45"></a><span id="l5.45">         // Look in our current profile directory, in case we're upgrading in</span>
<a href="#l5.46"></a><span id="l5.46">         // place</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineat">@@ -449,21 +449,21 @@ var gDataMigrator = {</span>
<a href="#l5.48"></a><span id="l5.48">                 var stream = Components.classes[&quot;@mozilla.org/network/file-output-stream;1&quot;]</span>
<a href="#l5.49"></a><span id="l5.49">                              .createInstance(Components.interfaces.nsIFileOutputStream);</span>
<a href="#l5.50"></a><span id="l5.50">                 stream.init(tempFile, 0x2A, parseInt(&quot;0600&quot;, 8), 0);</span>
<a href="#l5.51"></a><span id="l5.51">                 var convStream = Components.classes[&quot;@mozilla.org/intl/converter-output-stream;1&quot;]</span>
<a href="#l5.52"></a><span id="l5.52">                                 .createInstance(Components.interfaces.nsIConverterOutputStream);</span>
<a href="#l5.53"></a><span id="l5.53">                 convStream.init(stream, 'UTF-8', 0, 0x0000);</span>
<a href="#l5.54"></a><span id="l5.54">                 convStream.writeString(str);</span>
<a href="#l5.55"></a><span id="l5.55"> </span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-                var cal = gDataMigrator.importICSToStorage(tempFile);</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-                cal.name = &quot;iCalendar&quot;+i;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+                var calendar = gDataMigrator.importICSToStorage(tempFile);</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+                calendar.name = &quot;iCalendar&quot;+i;</span>
<a href="#l5.60"></a><span id="l5.60">                 i++;</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-                calManager.registerCalendar(cal);</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-                getCompositeCalendar().addCalendar(cal);</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+                calManager.registerCalendar(calendar);</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+                getCompositeCalendar().addCalendar(calendar);</span>
<a href="#l5.65"></a><span id="l5.65">             }</span>
<a href="#l5.66"></a><span id="l5.66">             LOG(&quot;icalMig making callback&quot;);</span>
<a href="#l5.67"></a><span id="l5.67">             aCallback();</span>
<a href="#l5.68"></a><span id="l5.68">         }</span>
<a href="#l5.69"></a><span id="l5.69">         var profileDir = this.dirService.get(&quot;ProfD&quot;, Components.interfaces.nsILocalFile);</span>
<a href="#l5.70"></a><span id="l5.70">         var icalSpec = profileDir.path;</span>
<a href="#l5.71"></a><span id="l5.71">         var icalFile;</span>
<a href="#l5.72"></a><span id="l5.72">         if (cal.isSunbird()) {</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineat">@@ -500,20 +500,20 @@ var gDataMigrator = {</span>
<a href="#l5.74"></a><span id="l5.74">      * stored there.</span>
<a href="#l5.75"></a><span id="l5.75">      */</span>
<a href="#l5.76"></a><span id="l5.76">     checkEvolution: function gdm_evolution() {</span>
<a href="#l5.77"></a><span id="l5.77">         function evoMigrate(aDataDir, aCallback) {</span>
<a href="#l5.78"></a><span id="l5.78">             var i = 1;</span>
<a href="#l5.79"></a><span id="l5.79">             function evoDataMigrate(dataStore) {</span>
<a href="#l5.80"></a><span id="l5.80">                 LOG(&quot;Migrating evolution data file in &quot; + dataStore.path);</span>
<a href="#l5.81"></a><span id="l5.81">                 if (dataStore.exists()) {</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-                    var cal = gDataMigrator.importICSToStorage(dataStore);</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-                    cal.name = &quot;Evolution &quot; + (i++);</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-                    calManager.registerCalendar(cal);</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-                    getCompositeCalendar().addCalendar(cal);</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+                    var calendar = gDataMigrator.importICSToStorage(dataStore);</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+                    calendar.name = &quot;Evolution &quot; + (i++);</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+                    calManager.registerCalendar(calendar);</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+                    getCompositeCalendar().addCalendar(calendar);</span>
<a href="#l5.90"></a><span id="l5.90">                 }</span>
<a href="#l5.91"></a><span id="l5.91">                 return dataStore.exists();</span>
<a href="#l5.92"></a><span id="l5.92">             }</span>
<a href="#l5.93"></a><span id="l5.93"> </span>
<a href="#l5.94"></a><span id="l5.94">             var calManager = getCalendarManager();</span>
<a href="#l5.95"></a><span id="l5.95">             var dirs = aDataDir.directoryEntries;</span>
<a href="#l5.96"></a><span id="l5.96">             while (dirs.hasMoreElements()) {</span>
<a href="#l5.97"></a><span id="l5.97">                 var dataDir = dirs.getNext().QueryInterface(Components.interfaces.nsIFile);</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineat">@@ -534,17 +534,17 @@ var gDataMigrator = {</span>
<a href="#l5.99"></a><span id="l5.99"> </span>
<a href="#l5.100"></a><span id="l5.100">     /**</span>
<a href="#l5.101"></a><span id="l5.101">      * Creates and registers a storage calendar and imports the given ics file into it.</span>
<a href="#l5.102"></a><span id="l5.102">      *</span>
<a href="#l5.103"></a><span id="l5.103">      * @param icsFile     The nsI(Local)File to import.</span>
<a href="#l5.104"></a><span id="l5.104">      */</span>
<a href="#l5.105"></a><span id="l5.105">     importICSToStorage: function migrateIcsStorage(icsFile) {</span>
<a href="#l5.106"></a><span id="l5.106">         const uri = 'moz-storage-calendar://';</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-        let cal = cal.getCalendarManager().createCalendar(&quot;storage&quot;, makeURL(uri));</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+        let calendar = cal.getCalendarManager().createCalendar(&quot;storage&quot;, makeURL(uri));</span>
<a href="#l5.109"></a><span id="l5.109">         let icsImporter = Components.classes[&quot;@mozilla.org/calendar/import;1?type=ics&quot;]</span>
<a href="#l5.110"></a><span id="l5.110">                                     .getService(Components.interfaces.calIImporter);</span>
<a href="#l5.111"></a><span id="l5.111"> </span>
<a href="#l5.112"></a><span id="l5.112">         let inputStream = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l5.113"></a><span id="l5.113">                                     .createInstance(Components.interfaces.nsIFileInputStream);</span>
<a href="#l5.114"></a><span id="l5.114">         let items = [];</span>
<a href="#l5.115"></a><span id="l5.115"> </span>
<a href="#l5.116"></a><span id="l5.116">         try {</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineat">@@ -558,19 +558,19 @@ var gDataMigrator = {</span>
<a href="#l5.118"></a><span id="l5.118">                 default:</span>
<a href="#l5.119"></a><span id="l5.119">                     showError(calGetString(&quot;calendar&quot;, &quot;unableToRead&quot;) + icsFile.path + &quot;\n&quot;+ ex);</span>
<a href="#l5.120"></a><span id="l5.120">             }</span>
<a href="#l5.121"></a><span id="l5.121">         } finally {</span>
<a href="#l5.122"></a><span id="l5.122">            inputStream.close();</span>
<a href="#l5.123"></a><span id="l5.123">         }</span>
<a href="#l5.124"></a><span id="l5.124"> </span>
<a href="#l5.125"></a><span id="l5.125">         // Defined in import-export.js</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineminus">-        putItemsIntoCal(cal, items);</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineplus">+        putItemsIntoCal(calendar, items);</span>
<a href="#l5.128"></a><span id="l5.128"> </span>
<a href="#l5.129"></a><span id="l5.129" class="difflineminus">-        return cal;</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineplus">+        return calendar;</span>
<a href="#l5.131"></a><span id="l5.131">     },</span>
<a href="#l5.132"></a><span id="l5.132"> </span>
<a href="#l5.133"></a><span id="l5.133">     /**</span>
<a href="#l5.134"></a><span id="l5.134">      * Helper functions for getting the profile directory of various MozApps</span>
<a href="#l5.135"></a><span id="l5.135">      * (Getting the profile dir is way harder than it should be.)</span>
<a href="#l5.136"></a><span id="l5.136">      *</span>
<a href="#l5.137"></a><span id="l5.137">      * Sunbird:</span>
<a href="#l5.138"></a><span id="l5.138">      *     Unix:     ~jdoe/.mozilla/sunbird/</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-subscriptions-dialog.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-subscriptions-dialog.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -125,18 +125,18 @@ function onCancel() {</span>
<a href="#l6.4"></a><span id="l6.4">  */</span>
<a href="#l6.5"></a><span id="l6.5"> function onSearch() {</span>
<a href="#l6.6"></a><span id="l6.6">     cancelPendingSearchOperation();</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">     var richListBox = document.getElementById(&quot;subscriptions-listbox&quot;);</span>
<a href="#l6.9"></a><span id="l6.9">     richListBox.clear();</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">     var registeredCals = {};</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    for each (var cal in getCalendarManager().getCalendars({})) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-        registeredCals[cal.id] = true;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+    for each (var calendar in getCalendarManager().getCalendars({})) {</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+        registeredCals[calendar.id] = true;</span>
<a href="#l6.16"></a><span id="l6.16">     }</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18">     var opListener = {</span>
<a href="#l6.19"></a><span id="l6.19">         onResult: function search_onResult(op, result) {</span>
<a href="#l6.20"></a><span id="l6.20">             var richListBox = document.getElementById(&quot;subscriptions-listbox&quot;);</span>
<a href="#l6.21"></a><span id="l6.21">             if (result) {</span>
<a href="#l6.22"></a><span id="l6.22">                 for each (var calendar in result) {</span>
<a href="#l6.23"></a><span id="l6.23">                     richListBox.addCalendar(calendar, registeredCals[calendar.id]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/dialogs/chooseCalendarDialog.xul</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/dialogs/chooseCalendarDialog.xul</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -67,36 +67,36 @@</span>
<a href="#l7.4"></a><span id="l7.4">             if (window.arguments[0].calendars) {</span>
<a href="#l7.5"></a><span id="l7.5">                 calendars = window.arguments[0].calendars;</span>
<a href="#l7.6"></a><span id="l7.6">             } else {</span>
<a href="#l7.7"></a><span id="l7.7">                 calendars = calendarManager.getCalendars({});</span>
<a href="#l7.8"></a><span id="l7.8">             }</span>
<a href="#l7.9"></a><span id="l7.9">             calendars = sortCalendarArray(calendars);</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">             for (var i = 0; i &lt; calendars.length; i++) {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-                var cal = calendars[i];</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+                var calendar = calendars[i];</span>
<a href="#l7.14"></a><span id="l7.14">                 var listItem = document.createElement(&quot;listitem&quot;);</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">                 var colorCell = document.createElement(&quot;listcell&quot;);</span>
<a href="#l7.17"></a><span id="l7.17">                 try {</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-                    var calColor = cal.getProperty('color');</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+                    var calColor = calendar.getProperty('color');</span>
<a href="#l7.20"></a><span id="l7.20">                     colorCell.style.background = calColor || &quot;#a8c2e1&quot;;</span>
<a href="#l7.21"></a><span id="l7.21">                 } catch(e) {} </span>
<a href="#l7.22"></a><span id="l7.22">                 listItem.appendChild(colorCell);</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24">                 var nameCell = document.createElement(&quot;listcell&quot;);</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-                nameCell.setAttribute(&quot;label&quot;, cal.name);</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+                nameCell.setAttribute(&quot;label&quot;, calendar.name);</span>
<a href="#l7.27"></a><span id="l7.27">                 listItem.appendChild(nameCell);</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-                listItem.calendar = cal;</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+                listItem.calendar = calendar;</span>
<a href="#l7.31"></a><span id="l7.31">                 listbox.appendChild(listItem);</span>
<a href="#l7.32"></a><span id="l7.32">                 listItem.setAttribute(&quot;flex&quot;,&quot;1&quot;);</span>
<a href="#l7.33"></a><span id="l7.33"> </span>
<a href="#l7.34"></a><span id="l7.34">                 // Select the default calendar of the opening calendar window.</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-                if (cal.id == composite.defaultCalendar.id) {</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+                if (calendar.id == composite.defaultCalendar.id) {</span>
<a href="#l7.37"></a><span id="l7.37">                     selectedIndex = i;</span>
<a href="#l7.38"></a><span id="l7.38">                 }</span>
<a href="#l7.39"></a><span id="l7.39">             }</span>
<a href="#l7.40"></a><span id="l7.40">             document.getElementById(&quot;prompt&quot;).value = window.arguments[0].promptText;</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42">             if (calendars.length) {</span>
<a href="#l7.43"></a><span id="l7.43">                 listbox.ensureIndexIsVisible(selectedIndex);</span>
<a href="#l7.44"></a><span id="l7.44">                 var selItem = listbox.getItemAtIndex(selectedIndex);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -102,18 +102,18 @@ var gCalendarManagerAddonListener = {</span>
<a href="#l8.4"></a><span id="l8.4">         }</span>
<a href="#l8.5"></a><span id="l8.5">     },</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7">     queryUninstallProvider: function(aAddon) {</span>
<a href="#l8.8"></a><span id="l8.8">         const uri = &quot;chrome://calendar/content/calendar-providerUninstall-dialog.xul&quot;;</span>
<a href="#l8.9"></a><span id="l8.9">         const features = &quot;chrome,titlebar,resizable,modal&quot;;</span>
<a href="#l8.10"></a><span id="l8.10">         let calMgr = cal.getCalendarManager();</span>
<a href="#l8.11"></a><span id="l8.11">         let affectedCalendars =</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-            [ cal for each (cal in calMgr.getCalendars({}))</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-              if (cal.providerID == aAddon.id) ];</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+            [ calendar for each (calendar in calMgr.getCalendars({}))</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+              if (calendar.providerID == aAddon.id) ];</span>
<a href="#l8.16"></a><span id="l8.16">         if (!affectedCalendars.length) {</span>
<a href="#l8.17"></a><span id="l8.17">             // If no calendars are affected, then everything is fine.</span>
<a href="#l8.18"></a><span id="l8.18">             return true;</span>
<a href="#l8.19"></a><span id="l8.19">         }</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">         let args = { shouldUninstall: false, extension: aAddon };</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23">         // Now find a window. The best choice would be the most recent</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineat">@@ -193,18 +193,18 @@ calCalendarManager.prototype = {</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26">         Services.obs.addObserver(this, &quot;http-on-modify-request&quot;, false);</span>
<a href="#l8.27"></a><span id="l8.27">         Services.obs.addObserver(this, &quot;http-on-examine-response&quot;, false);</span>
<a href="#l8.28"></a><span id="l8.28"> </span>
<a href="#l8.29"></a><span id="l8.29">         aCompleteListener.onResult(null, Components.results.NS_OK);</span>
<a href="#l8.30"></a><span id="l8.30">     },</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32">     shutdown: function ccm_shutdown(aCompleteListener) {</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-        for each (var cal in this.mCache) {</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-            cal.removeObserver(this.mCalObservers[cal.id]);</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+        for each (var calendar in this.mCache) {</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+            calendar.removeObserver(this.mCalObservers[calendar.id]);</span>
<a href="#l8.37"></a><span id="l8.37">         }</span>
<a href="#l8.38"></a><span id="l8.38"> </span>
<a href="#l8.39"></a><span id="l8.39">         this.cleanupOfflineObservers();</span>
<a href="#l8.40"></a><span id="l8.40"> </span>
<a href="#l8.41"></a><span id="l8.41">         Services.obs.removeObserver(this, &quot;profile-after-change&quot;);</span>
<a href="#l8.42"></a><span id="l8.42">         Services.obs.removeObserver(this, &quot;profile-before-change&quot;);</span>
<a href="#l8.43"></a><span id="l8.43">         Services.obs.removeObserver(this, &quot;http-on-modify-request&quot;);</span>
<a href="#l8.44"></a><span id="l8.44">         Services.obs.removeObserver(this, &quot;http-on-examine-response&quot;);</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineat">@@ -246,19 +246,19 @@ calCalendarManager.prototype = {</span>
<a href="#l8.46"></a><span id="l8.46">                 this.startup();</span>
<a href="#l8.47"></a><span id="l8.47">                 break;</span>
<a href="#l8.48"></a><span id="l8.48">             case &quot;profile-before-change&quot;:</span>
<a href="#l8.49"></a><span id="l8.49">                 this.shutdown();</span>
<a href="#l8.50"></a><span id="l8.50">                 break;</span>
<a href="#l8.51"></a><span id="l8.51">             case &quot;timer-callback&quot;:</span>
<a href="#l8.52"></a><span id="l8.52">                 // Refresh all the calendars that can be refreshed.</span>
<a href="#l8.53"></a><span id="l8.53">                 var cals = this.getCalendars({});</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-                for each (var cal in cals) {</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-                    if (!cal.getProperty(&quot;disabled&quot;) &amp;&amp; cal.canRefresh) {</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-                        cal.refresh();</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+                for each (var calendar in cals) {</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+                    if (!calendar.getProperty(&quot;disabled&quot;) &amp;&amp; calendar.canRefresh) {</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+                        calendar.refresh();</span>
<a href="#l8.60"></a><span id="l8.60">                     }</span>
<a href="#l8.61"></a><span id="l8.61">                 }</span>
<a href="#l8.62"></a><span id="l8.62">                 break;</span>
<a href="#l8.63"></a><span id="l8.63">             case &quot;network:offline-status-changed&quot;:</span>
<a href="#l8.64"></a><span id="l8.64">                 for each (var calendar in this.mCache) {</span>
<a href="#l8.65"></a><span id="l8.65">                     if (calendar instanceof calCachedCalendar) {</span>
<a href="#l8.66"></a><span id="l8.66">                         calendar.onOfflineStatusChanged(aData == &quot;offline&quot;);</span>
<a href="#l8.67"></a><span id="l8.67">                     }</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineat">@@ -783,18 +783,18 @@ calCalendarManager.prototype = {</span>
<a href="#l8.69"></a><span id="l8.69">                 Components.utils.reportError(&quot;error purging calendar: &quot; + e);</span>
<a href="#l8.70"></a><span id="l8.70">             }</span>
<a href="#l8.71"></a><span id="l8.71">         }</span>
<a href="#l8.72"></a><span id="l8.72">     },</span>
<a href="#l8.73"></a><span id="l8.73"> </span>
<a href="#l8.74"></a><span id="l8.74">     getCalendars: function cmgr_getCalendars(count) {</span>
<a href="#l8.75"></a><span id="l8.75">         this.assureCache();</span>
<a href="#l8.76"></a><span id="l8.76">         var calendars = [];</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-        for each (var cal in this.mCache) {</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineminus">-            calendars.push(cal);</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+        for each (var calendar in this.mCache) {</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+            calendars.push(calendar);</span>
<a href="#l8.81"></a><span id="l8.81">         }</span>
<a href="#l8.82"></a><span id="l8.82">         count.value = calendars.length;</span>
<a href="#l8.83"></a><span id="l8.83">         return calendars;</span>
<a href="#l8.84"></a><span id="l8.84">     },</span>
<a href="#l8.85"></a><span id="l8.85"> </span>
<a href="#l8.86"></a><span id="l8.86">     assureCache: function cmgr_assureCache() {</span>
<a href="#l8.87"></a><span id="l8.87">         if (!this.mCache) {</span>
<a href="#l8.88"></a><span id="l8.88">             this.mCache = {};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/src/calItemBase.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/src/calItemBase.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -86,21 +86,21 @@ calItemBase.prototype = {</span>
<a href="#l9.4"></a><span id="l9.4">     /**</span>
<a href="#l9.5"></a><span id="l9.5">      * @see calIItemBase</span>
<a href="#l9.6"></a><span id="l9.6">      */</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8">     // readonly attribute AUTF8String hashId;</span>
<a href="#l9.9"></a><span id="l9.9">     get hashId() {</span>
<a href="#l9.10"></a><span id="l9.10">         if (this.mHashId === null) {</span>
<a href="#l9.11"></a><span id="l9.11">             var rid = this.recurrenceId;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-            var cal = this.calendar;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+            var calendar = this.calendar;</span>
<a href="#l9.14"></a><span id="l9.14">             // some unused delim character:</span>
<a href="#l9.15"></a><span id="l9.15">             this.mHashId = [encodeURIComponent(this.id),</span>
<a href="#l9.16"></a><span id="l9.16">                             rid ? rid.getInTimezone(UTC()).icalString : &quot;&quot;,</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-                            cal ? encodeURIComponent(cal.id) : &quot;&quot;].join(&quot;#&quot;);</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+                            calendar ? encodeURIComponent(calendar.id) : &quot;&quot;].join(&quot;#&quot;);</span>
<a href="#l9.19"></a><span id="l9.19">         }</span>
<a href="#l9.20"></a><span id="l9.20">         return this.mHashId;</span>
<a href="#l9.21"></a><span id="l9.21">     },</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23">     // attribute AUTF8String id;</span>
<a href="#l9.24"></a><span id="l9.24">     get id() {</span>
<a href="#l9.25"></a><span id="l9.25">         return this.getProperty(&quot;UID&quot;);</span>
<a href="#l9.26"></a><span id="l9.26">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/src/calTransactionManager.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/src/calTransactionManager.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -92,18 +92,18 @@ calTransactionManager.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">     },</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6">     checkWritable: function cTM_checkWritable(transaction) {</span>
<a href="#l10.7"></a><span id="l10.7">         if (transaction) {</span>
<a href="#l10.8"></a><span id="l10.8">             transaction = transaction.wrappedJSObject;</span>
<a href="#l10.9"></a><span id="l10.9">             if (transaction) {</span>
<a href="#l10.10"></a><span id="l10.10">                 function checkItem(item) {</span>
<a href="#l10.11"></a><span id="l10.11">                     if (item) {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-                        var cal = item.calendar;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-                        if (cal &amp;&amp; !isCalendarWritable(cal)) {</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+                        var calendar = item.calendar;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+                        if (calendar &amp;&amp; !isCalendarWritable(calendar)) {</span>
<a href="#l10.16"></a><span id="l10.16">                             return false;</span>
<a href="#l10.17"></a><span id="l10.17">                         }</span>
<a href="#l10.18"></a><span id="l10.18">                     }</span>
<a href="#l10.19"></a><span id="l10.19">                     return true;</span>
<a href="#l10.20"></a><span id="l10.20">                 }</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22">                 if (!checkItem(transaction.mItem) ||</span>
<a href="#l10.23"></a><span id="l10.23">                     !checkItem(transaction.mOldItem)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -119,18 +119,18 @@ calStorageCalendar.prototype = {</span>
<a href="#l11.4"></a><span id="l11.4">     get displayName() {</span>
<a href="#l11.5"></a><span id="l11.5">         return calGetString(&quot;calendar&quot;, &quot;storageName&quot;);</span>
<a href="#l11.6"></a><span id="l11.6">     },</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8">     createCalendar: function cSC_createCalendar() {</span>
<a href="#l11.9"></a><span id="l11.9">         throw NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l11.10"></a><span id="l11.10">     },</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    deleteCalendar: function cSC_deleteCalendar(cal, listener) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-        cal = cal.wrappedJSObject;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+    deleteCalendar: function cSC_deleteCalendar(aCalendar, listener) {</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+        aCalendar = aCalendar.wrappedJSObject;</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">         for each (let stmt in this.mDeleteEventExtras) {</span>
<a href="#l11.18"></a><span id="l11.18">             try {</span>
<a href="#l11.19"></a><span id="l11.19">                 this.prepareStatement(stmt);</span>
<a href="#l11.20"></a><span id="l11.20">                 stmt.execute();</span>
<a href="#l11.21"></a><span id="l11.21">             } finally {</span>
<a href="#l11.22"></a><span id="l11.22">                 stmt.reset();</span>
<a href="#l11.23"></a><span id="l11.23">             }</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineat">@@ -163,17 +163,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l11.25"></a><span id="l11.25">             this.prepareStatement(this.mDeleteAllMetaData);</span>
<a href="#l11.26"></a><span id="l11.26">             this.mDeleteAllMetaData.execute();</span>
<a href="#l11.27"></a><span id="l11.27">         } finally {</span>
<a href="#l11.28"></a><span id="l11.28">             this.mDeleteAllMetaData.reset();</span>
<a href="#l11.29"></a><span id="l11.29">         }</span>
<a href="#l11.30"></a><span id="l11.30"> </span>
<a href="#l11.31"></a><span id="l11.31">         try {</span>
<a href="#l11.32"></a><span id="l11.32">             if (listener) {</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-                listener.onDeleteCalendar(cal, Components.results.NS_OK, null);</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+                listener.onDeleteCalendar(aCalendar, Components.results.NS_OK, null);</span>
<a href="#l11.35"></a><span id="l11.35">             }</span>
<a href="#l11.36"></a><span id="l11.36">         } catch (ex) {</span>
<a href="#l11.37"></a><span id="l11.37">             this.logError(&quot;error calling listener.onDeleteCalendar&quot;, ex);</span>
<a href="#l11.38"></a><span id="l11.38">         }</span>
<a href="#l11.39"></a><span id="l11.39">     },</span>
<a href="#l11.40"></a><span id="l11.40"> </span>
<a href="#l11.41"></a><span id="l11.41">     mRelaxedMode: undefined,</span>
<a href="#l11.42"></a><span id="l11.42">     get relaxedMode() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -198,19 +198,19 @@ calWcapCalendar.prototype = {</span>
<a href="#l12.4"></a><span id="l12.4">     },</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6">     setProperty: function calWcapCalendar_setProperty(aName, aValue) {</span>
<a href="#l12.7"></a><span id="l12.7">         switch (aName) {</span>
<a href="#l12.8"></a><span id="l12.8">             case &quot;disabled&quot;:</span>
<a href="#l12.9"></a><span id="l12.9">                 if (this.isDefaultCalendar) {</span>
<a href="#l12.10"></a><span id="l12.10">                     // disabling/enabling the default calendar will enable/disable all calendars</span>
<a href="#l12.11"></a><span id="l12.11">                     // belonging to the same session:</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-                    for each (var cal in this.session.getRegisteredCalendars()) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-                        if (!cal.isDefaultCalendar) {</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-                            cal.setProperty(&quot;disabled&quot;, aValue);</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+                    for each (let calendar in this.session.getRegisteredCalendars()) {</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+                        if (!calendar.isDefaultCalendar) {</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+                            calendar.setProperty(&quot;disabled&quot;, aValue);</span>
<a href="#l12.18"></a><span id="l12.18">                         }</span>
<a href="#l12.19"></a><span id="l12.19">                     }</span>
<a href="#l12.20"></a><span id="l12.20">                 }</span>
<a href="#l12.21"></a><span id="l12.21">                 // fallthru intended</span>
<a href="#l12.22"></a><span id="l12.22">             default:</span>
<a href="#l12.23"></a><span id="l12.23">                 this.__proto__.__proto__.setProperty.apply(this, arguments);</span>
<a href="#l12.24"></a><span id="l12.24">                 break;</span>
<a href="#l12.25"></a><span id="l12.25">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1378,17 +1378,17 @@ function calWcapCalendar_replayChangesOn</span>
<a href="#l13.4"></a><span id="l13.4">             }</span>
<a href="#l13.5"></a><span id="l13.5">         },</span>
<a href="#l13.6"></a><span id="l13.6">         log(&quot;replayChangesOn():\n\titemFilter=0x&quot; + itemFilter.toString(0x10) +</span>
<a href="#l13.7"></a><span id="l13.7">             &quot;\n\tdtFrom=&quot; + getIcalUTC(dtFrom), this));</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9">     try {</span>
<a href="#l13.10"></a><span id="l13.10">         var writeListener = {</span>
<a href="#l13.11"></a><span id="l13.11">             onGetResult: function() {},</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-            onOperationComplete: function(cal, status, opType, id, detail) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+            onOperationComplete: function(aCalendar, status, opType, id, detail) {</span>
<a href="#l13.14"></a><span id="l13.14">                 if (!Components.isSuccessCode(status)) {</span>
<a href="#l13.15"></a><span id="l13.15">                     request.execRespFunc(status); // any error on writing breaks whole operation</span>
<a href="#l13.16"></a><span id="l13.16">                 }</span>
<a href="#l13.17"></a><span id="l13.17">             }</span>
<a href="#l13.18"></a><span id="l13.18">         };</span>
<a href="#l13.19"></a><span id="l13.19">         var request = new calWcapRequest(</span>
<a href="#l13.20"></a><span id="l13.20">             function netFinishedRespFunc(err, data) {</span>
<a href="#l13.21"></a><span id="l13.21">                 var modifiedIds = {};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -556,23 +556,23 @@ calWcapSession.prototype = {</span>
<a href="#l14.4"></a><span id="l14.4">                                         cals[calId] = null;</span>
<a href="#l14.5"></a><span id="l14.5">                                         hasSubscriptions = true;</span>
<a href="#l14.6"></a><span id="l14.6">                                     }</span>
<a href="#l14.7"></a><span id="l14.7">                                 }</span>
<a href="#l14.8"></a><span id="l14.8">                             }</span>
<a href="#l14.9"></a><span id="l14.9">                         }</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11">                         if (hasSubscriptions) {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-                            calprops_resp = function(cal) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-                                if (cal.isDefaultCalendar) {</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+                            calprops_resp = function(aCalendar) {</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+                                if (aCalendar.isDefaultCalendar) {</span>
<a href="#l14.16"></a><span id="l14.16">                                     // tweak name:</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-                                    cal.setProperty(&quot;name&quot;, cal.displayName);</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+                                    aCalendar.setProperty(&quot;name&quot;, aCalendar.displayName);</span>
<a href="#l14.19"></a><span id="l14.19">                                 } else {</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-                                    log(&quot;registering subscribed calendar: &quot; + cal.calId, this_);</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-                                    cal.getCalendarManager().registerCalendar(cal);</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+                                    log(&quot;registering subscribed calendar: &quot; + aCalendar.calId, this_);</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+                                    cal.getCalendarManager().registerCalendar(aCalendar);</span>
<a href="#l14.24"></a><span id="l14.24">                                 }</span>
<a href="#l14.25"></a><span id="l14.25">                             }</span>
<a href="#l14.26"></a><span id="l14.26">                             // do only once:</span>
<a href="#l14.27"></a><span id="l14.27">                             defaultCal.setProperty(&quot;subscriptions_registered&quot;, true);</span>
<a href="#l14.28"></a><span id="l14.28">                         }</span>
<a href="#l14.29"></a><span id="l14.29">                     }</span>
<a href="#l14.30"></a><span id="l14.30"> </span>
<a href="#l14.31"></a><span id="l14.31">                     if (!defaultCal.getProperty(&quot;user_id&quot;)) { // nail once:</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineat">@@ -614,27 +614,27 @@ calWcapSession.prototype = {</span>
<a href="#l14.33"></a><span id="l14.33">             var nodeList = xml.getElementsByTagName(&quot;iCal&quot;);</span>
<a href="#l14.34"></a><span id="l14.34">             for (var i = 0; i &lt; nodeList.length; ++i) {</span>
<a href="#l14.35"></a><span id="l14.35">                 try {</span>
<a href="#l14.36"></a><span id="l14.36">                     var node = nodeList.item(i);</span>
<a href="#l14.37"></a><span id="l14.37">                     checkWcapXmlErrno(node);</span>
<a href="#l14.38"></a><span id="l14.38">                     var ar = filterXmlNodes(&quot;X-NSCP-CALPROPS-RELATIVE-CALID&quot;, node);</span>
<a href="#l14.39"></a><span id="l14.39">                     if (ar.length &gt; 0) {</span>
<a href="#l14.40"></a><span id="l14.40">                         var calId = ar[0];</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-                        var cal = cals[calId];</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-                        if (cal === null) {</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-                            cal = new calWcapCalendar(this_);</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+                        let calendar = cals[calId];</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+                        if (calendar === null) {</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+                            calendar = new calWcapCalendar(this_);</span>
<a href="#l14.47"></a><span id="l14.47">                             var uri = this_.uri.clone();</span>
<a href="#l14.48"></a><span id="l14.48">                             uri.path += (&quot;?calid=&quot; + encodeURIComponent(calId));</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-                            cal.uri = uri;</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+                            calendar.uri = uri;</span>
<a href="#l14.51"></a><span id="l14.51">                         }</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-                        if (cal) {</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-                            cal.m_calProps = node;</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+                        if (calendar) {</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+                            calendar.m_calProps = node;</span>
<a href="#l14.56"></a><span id="l14.56">                             if (respFunc) {</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-                                respFunc(cal);</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+                                respFunc(calendar);</span>
<a href="#l14.59"></a><span id="l14.59">                             }</span>
<a href="#l14.60"></a><span id="l14.60">                         }</span>
<a href="#l14.61"></a><span id="l14.61">                     }</span>
<a href="#l14.62"></a><span id="l14.62"> </span>
<a href="#l14.63"></a><span id="l14.63">                 } catch (exc) { // ignore but log any errors on subscribed calendars:</span>
<a href="#l14.64"></a><span id="l14.64">                     logError(exc, this_);</span>
<a href="#l14.65"></a><span id="l14.65">                 }</span>
<a href="#l14.66"></a><span id="l14.66">             }</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineat">@@ -664,25 +664,25 @@ calWcapSession.prototype = {</span>
<a href="#l14.68"></a><span id="l14.68">                     onResult: function search_onResult(request, result) {</span>
<a href="#l14.69"></a><span id="l14.69">                         try {</span>
<a href="#l14.70"></a><span id="l14.70">                             if (!Components.isSuccessCode(request.status)) {</span>
<a href="#l14.71"></a><span id="l14.71">                                 throw request.status;</span>
<a href="#l14.72"></a><span id="l14.72">                             }</span>
<a href="#l14.73"></a><span id="l14.73">                             if (result.length &lt; 1) {</span>
<a href="#l14.74"></a><span id="l14.74">                                 throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l14.75"></a><span id="l14.75">                             }</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineminus">-                            for each (var cal in result) {</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineplus">+                            for each (let calendar in result) {</span>
<a href="#l14.78"></a><span id="l14.78">                                 // user may have dangling users referred in his subscription list, so</span>
<a href="#l14.79"></a><span id="l14.79">                                 // retrieve each by each, don't break:</span>
<a href="#l14.80"></a><span id="l14.80">                                 try {</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-                                    var calId = cal.calId;</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+                                    var calId = calendar.calId;</span>
<a href="#l14.83"></a><span id="l14.83">                                     if ((cals[calId] !== undefined) &amp;&amp; !retrievedCals[calId]) {</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-                                        retrievedCals[calId] = cal;</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+                                        retrievedCals[calId] = calendar;</span>
<a href="#l14.86"></a><span id="l14.86">                                         if (respFunc) {</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-                                            respFunc(cal);</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+                                            respFunc(calendar);</span>
<a href="#l14.89"></a><span id="l14.89">                                         }</span>
<a href="#l14.90"></a><span id="l14.90">                                     }</span>
<a href="#l14.91"></a><span id="l14.91">                                 }</span>
<a href="#l14.92"></a><span id="l14.92">                                 catch (exc) { // ignore but log any errors on subscribed calendars:</span>
<a href="#l14.93"></a><span id="l14.93">                                     logError(exc, this_);</span>
<a href="#l14.94"></a><span id="l14.94">                                 }</span>
<a href="#l14.95"></a><span id="l14.95">                             }</span>
<a href="#l14.96"></a><span id="l14.96">                         } catch (exc) { // ignore but log any errors on subscribed calendars:</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineat">@@ -951,26 +951,26 @@ calWcapSession.prototype = {</span>
<a href="#l14.98"></a><span id="l14.98">                     var nodeList = xml.getElementsByTagName(&quot;iCal&quot;);</span>
<a href="#l14.99"></a><span id="l14.99">                     for (var i = 0; i &lt; nodeList.length; ++i) {</span>
<a href="#l14.100"></a><span id="l14.100">                         var node = nodeList.item(i);</span>
<a href="#l14.101"></a><span id="l14.101">                         try {</span>
<a href="#l14.102"></a><span id="l14.102">                             checkWcapXmlErrno(node);</span>
<a href="#l14.103"></a><span id="l14.103">                             var ar = filterXmlNodes(&quot;X-NSCP-CALPROPS-RELATIVE-CALID&quot;, node);</span>
<a href="#l14.104"></a><span id="l14.104">                             if (ar.length &gt; 0) {</span>
<a href="#l14.105"></a><span id="l14.105">                                 var calId = ar[0];</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-                                var cal = registeredCalendars[calId];</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-                                if (cal) {</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-                                    cal.m_calProps = node; // update calprops</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineplus">+                                let calendar = registeredCalendars[calId];</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineplus">+                                if (calendar) {</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineplus">+                                    calendar.m_calProps = node; // update calprops</span>
<a href="#l14.112"></a><span id="l14.112">                                 } else {</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineminus">-                                    cal = new calWcapCalendar(this_, node);</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineplus">+                                    calendar = new calWcapCalendar(this_, node);</span>
<a href="#l14.115"></a><span id="l14.115">                                     var uri = this_.uri.clone();</span>
<a href="#l14.116"></a><span id="l14.116">                                     uri.path += (&quot;?calid=&quot; + encodeURIComponent(calId));</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineminus">-                                    cal.uri = uri;</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineplus">+                                    calendar.uri = uri;</span>
<a href="#l14.119"></a><span id="l14.119">                                 }</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineminus">-                                ret.push(cal);</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineplus">+                                ret.push(calendar);</span>
<a href="#l14.122"></a><span id="l14.122">                             }</span>
<a href="#l14.123"></a><span id="l14.123">                         } catch (exc) {</span>
<a href="#l14.124"></a><span id="l14.124">                             switch (getResultCode(exc)) {</span>
<a href="#l14.125"></a><span id="l14.125">                                 case calIWcapErrors.WCAP_NO_ERRNO: // workaround</span>
<a href="#l14.126"></a><span id="l14.126">                                 case calIWcapErrors.WCAP_ACCESS_DENIED_TO_CALENDAR:</span>
<a href="#l14.127"></a><span id="l14.127">                                     log(&quot;searchForCalendars_netResp() ignored error: &quot; + errorToString(exc), this_);</span>
<a href="#l14.128"></a><span id="l14.128">                                     break;</span>
<a href="#l14.129"></a><span id="l14.129">                                 default:</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineat">@@ -1095,29 +1095,29 @@ calWcapSession.prototype = {</span>
<a href="#l14.131"></a><span id="l14.131">                                             .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l14.132"></a><span id="l14.132">             observerService.removeObserver(this, &quot;quit-application&quot;);</span>
<a href="#l14.133"></a><span id="l14.133">         }</span>
<a href="#l14.134"></a><span id="l14.134">     },</span>
<a href="#l14.135"></a><span id="l14.135"> </span>
<a href="#l14.136"></a><span id="l14.136">     // calICalendarManagerObserver:</span>
<a href="#l14.137"></a><span id="l14.137"> </span>
<a href="#l14.138"></a><span id="l14.138">     // called after the calendar is registered</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineminus">-    onCalendarRegistered: function calWcapSession_onCalendarRegistered(cal) {</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineplus">+    onCalendarRegistered: function calWcapSession_onCalendarRegistered(aCalendar) {</span>
<a href="#l14.141"></a><span id="l14.141">         try {</span>
<a href="#l14.142"></a><span id="l14.142">             // make sure the calendar belongs to this session:</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineminus">-            if (this.belongsTo(cal)) {</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineplus">+            if (this.belongsTo(aCalendar)) {</span>
<a href="#l14.145"></a><span id="l14.145"> </span>
<a href="#l14.146"></a><span id="l14.146">                 function assureDefault(pref, val) {</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineminus">-                    if (cal.getProperty(pref) === null) {</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineminus">-                        cal.setProperty(pref, val);</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineplus">+                    if (aCalendar.getProperty(pref) === null) {</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineplus">+                        aCalendar.setProperty(pref, val);</span>
<a href="#l14.151"></a><span id="l14.151">                     }</span>
<a href="#l14.152"></a><span id="l14.152">                 }</span>
<a href="#l14.153"></a><span id="l14.153"> </span>
<a href="#l14.154"></a><span id="l14.154">                 assureDefault(&quot;shared_context&quot;, this.m_contextId);</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineminus">-                assureDefault(&quot;name&quot;, cal.name);</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineplus">+                assureDefault(&quot;name&quot;, aCalendar.name);</span>
<a href="#l14.157"></a><span id="l14.157"> </span>
<a href="#l14.158"></a><span id="l14.158">                 const s_colors = [&quot;#FFCCCC&quot;, &quot;#FFCC99&quot;, &quot;#FFFF99&quot;, &quot;#FFFFCC&quot;, &quot;#99FF99&quot;,</span>
<a href="#l14.159"></a><span id="l14.159">                                   &quot;#99FFFF&quot;, &quot;#CCFFFF&quot;, &quot;#CCCCFF&quot;, &quot;#FFCCFF&quot;, &quot;#FF6666&quot;,</span>
<a href="#l14.160"></a><span id="l14.160">                                   &quot;#FF9966&quot;, &quot;#FFFF66&quot;, &quot;#FFFF33&quot;, &quot;#66FF99&quot;, &quot;#33FFFF&quot;,</span>
<a href="#l14.161"></a><span id="l14.161">                                   &quot;#66FFFF&quot;, &quot;#9999FF&quot;, &quot;#FF99FF&quot;, &quot;#FF0000&quot;, &quot;#FF9900&quot;,</span>
<a href="#l14.162"></a><span id="l14.162">                                   &quot;#FFCC66&quot;, &quot;#FFFF00&quot;, &quot;#33FF33&quot;, &quot;#66CCCC&quot;, &quot;#33CCFF&quot;,</span>
<a href="#l14.163"></a><span id="l14.163">                                   &quot;#6666CC&quot;, &quot;#CC66CC&quot;, &quot;#CC0000&quot;, &quot;#FF6600&quot;, &quot;#FFCC33&quot;,</span>
<a href="#l14.164"></a><span id="l14.164">                                   &quot;#FFCC00&quot;, &quot;#33CC00&quot;, &quot;#00CCCC&quot;, &quot;#3366FF&quot;, &quot;#6633FF&quot;,</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineat">@@ -1130,22 +1130,22 @@ calWcapSession.prototype = {</span>
<a href="#l14.166"></a><span id="l14.166">                 assureDefault(&quot;color&quot;, s_colors[(new Date()).getUTCMilliseconds() % s_colors.length]);</span>
<a href="#l14.167"></a><span id="l14.167">             }</span>
<a href="#l14.168"></a><span id="l14.168">         } catch (exc) { // never break the listener chain</span>
<a href="#l14.169"></a><span id="l14.169">             this.notifyError(exc);</span>
<a href="#l14.170"></a><span id="l14.170">         }</span>
<a href="#l14.171"></a><span id="l14.171">     },</span>
<a href="#l14.172"></a><span id="l14.172"> </span>
<a href="#l14.173"></a><span id="l14.173">     // called before the unregister actually takes place</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineminus">-    onCalendarUnregistering: function calWcapSession_onCalendarUnregistering(cal) {</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineplus">+    onCalendarUnregistering: function calWcapSession_onCalendarUnregistering(aCalendar) {</span>
<a href="#l14.176"></a><span id="l14.176">         try {</span>
<a href="#l14.177"></a><span id="l14.177">             // make sure the calendar belongs to this session and is the default calendar,</span>
<a href="#l14.178"></a><span id="l14.178">             // then remove all subscribed calendars:</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineminus">-            cal = this.belongsTo(cal);</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineminus">-            if (cal &amp;&amp; cal.isDefaultCalendar) {</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineplus">+            aCalendar = this.belongsTo(aCalendar);</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineplus">+            if (aCalendar &amp;&amp; aCalendar.isDefaultCalendar) {</span>
<a href="#l14.183"></a><span id="l14.183">                 getFreeBusyService().removeProvider(this);</span>
<a href="#l14.184"></a><span id="l14.184">                 getCalendarSearchService().removeProvider(this);</span>
<a href="#l14.185"></a><span id="l14.185">                 var registeredCalendars = this.getRegisteredCalendars();</span>
<a href="#l14.186"></a><span id="l14.186">                 for each (var regCal in registeredCalendars) {</span>
<a href="#l14.187"></a><span id="l14.187">                     try {</span>
<a href="#l14.188"></a><span id="l14.188">                         if (!regCal.isDefaultCalendar) {</span>
<a href="#l14.189"></a><span id="l14.189">                             cal.getCalendarManager().unregisterCalendar(regCal);</span>
<a href="#l14.190"></a><span id="l14.190">                         }</span>
<a href="#l14.191"></a><span id="l14.191" class="difflineat">@@ -1155,17 +1155,17 @@ calWcapSession.prototype = {</span>
<a href="#l14.192"></a><span id="l14.192">                 }</span>
<a href="#l14.193"></a><span id="l14.193">             }</span>
<a href="#l14.194"></a><span id="l14.194">         } catch (exc) { // never break the listener chain</span>
<a href="#l14.195"></a><span id="l14.195">             this.notifyError(exc);</span>
<a href="#l14.196"></a><span id="l14.196">         }</span>
<a href="#l14.197"></a><span id="l14.197">     },</span>
<a href="#l14.198"></a><span id="l14.198"> </span>
<a href="#l14.199"></a><span id="l14.199">     // called before the delete actually takes place</span>
<a href="#l14.200"></a><span id="l14.200" class="difflineminus">-    onCalendarDeleting: function calWcapSession_onCalendarDeleting(cal) {</span>
<a href="#l14.201"></a><span id="l14.201" class="difflineplus">+    onCalendarDeleting: function calWcapSession_onCalendarDeleting(aCalendar) {</span>
<a href="#l14.202"></a><span id="l14.202">     }</span>
<a href="#l14.203"></a><span id="l14.203"> };</span>
<a href="#l14.204"></a><span id="l14.204"> </span>
<a href="#l14.205"></a><span id="l14.205"> function confirmInsecureLogin(uri)</span>
<a href="#l14.206"></a><span id="l14.206"> {</span>
<a href="#l14.207"></a><span id="l14.207">     if (!confirmInsecureLogin.m_confirmedHttpLogins) {</span>
<a href="#l14.208"></a><span id="l14.208">         confirmInsecureLogin.m_confirmedHttpLogins = {};</span>
<a href="#l14.209"></a><span id="l14.209">         var confirmedHttpLogins = getPref(&quot;calendar.wcap.confirmed_http_logins&quot;, &quot;&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/resources/content/calendar.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/resources/content/calendar.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -114,32 +114,32 @@ function handleCommandLine(aComLine) {</span>
<a href="#l15.4"></a><span id="l15.4">                 comLine.removeArguments(i, i);</span>
<a href="#l15.5"></a><span id="l15.5">             }</span>
<a href="#l15.6"></a><span id="l15.6">         }</span>
<a href="#l15.7"></a><span id="l15.7">     }</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9">     //subscribe to all files in the calurl array</span>
<a href="#l15.10"></a><span id="l15.10">     for (var i = 0; i &lt; calurl.length; i++) {</span>
<a href="#l15.11"></a><span id="l15.11">         var uri = comLine.resolveURI(calurl[i]);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        var cal = getCalendarManager().createCalendar(&quot;ics&quot;, uri);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+        var calendar = getCalendarManager().createCalendar(&quot;ics&quot;, uri);</span>
<a href="#l15.14"></a><span id="l15.14"> </span>
<a href="#l15.15"></a><span id="l15.15">         // Strip &quot;.ics&quot; from filename for use as calendar name</span>
<a href="#l15.16"></a><span id="l15.16">         var fullPathRegEx = new RegExp(&quot;([^/:]+)[.]ics$&quot;);</span>
<a href="#l15.17"></a><span id="l15.17">         var path = uri.path;</span>
<a href="#l15.18"></a><span id="l15.18">         var prettyName = path.match(fullPathRegEx);</span>
<a href="#l15.19"></a><span id="l15.19"> </span>
<a href="#l15.20"></a><span id="l15.20">         var name;</span>
<a href="#l15.21"></a><span id="l15.21">         if (prettyName &amp;&amp; prettyName.length &gt;= 1) {</span>
<a href="#l15.22"></a><span id="l15.22">             name = decodeURIComponent(prettyName[1]);</span>
<a href="#l15.23"></a><span id="l15.23">         } else {</span>
<a href="#l15.24"></a><span id="l15.24">             name = calGetString(&quot;calendar&quot;, &quot;untitledCalendarName&quot;);</span>
<a href="#l15.25"></a><span id="l15.25">         }</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-        cal.name = name;</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+        calendar.name = name;</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-        getCalendarManager().registerCalendar(cal);</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+        getCalendarManager().registerCalendar(calendar);</span>
<a href="#l15.31"></a><span id="l15.31">     }</span>
<a href="#l15.32"></a><span id="l15.32"> }</span>
<a href="#l15.33"></a><span id="l15.33"> </span>
<a href="#l15.34"></a><span id="l15.34"> /* Called at midnight to tell us to update the views and other ui bits */</span>
<a href="#l15.35"></a><span id="l15.35"> function refreshUIBits() {</span>
<a href="#l15.36"></a><span id="l15.36">     try {</span>
<a href="#l15.37"></a><span id="l15.37">         currentView().goToDay(now());</span>
<a href="#l15.38"></a><span id="l15.38">         refreshEventTree();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/resources/content/publish.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/resources/content/publish.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -61,28 +61,28 @@ function publishCalendarDataDialogRespon</span>
<a href="#l16.4"></a><span id="l16.4">     publishItemArray(currentView().getSelectedItems({}), </span>
<a href="#l16.5"></a><span id="l16.5">                      CalendarPublishObject.remotePath, aProgressDialog);</span>
<a href="#l16.6"></a><span id="l16.6"> }</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> /**</span>
<a href="#l16.9"></a><span id="l16.9">  * publishEntireCalendar</span>
<a href="#l16.10"></a><span id="l16.10">  * Show publish dialog, ask for URL and publish all items from the calendar.</span>
<a href="#l16.11"></a><span id="l16.11">  *</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">- * @param cal   (optional) The calendar that will be published. If ommitted</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">- *                         the user will be prompted to select a calendar.</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+ * @param aCalendar   (optional) The calendar that will be published. If ommitted</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+ *                               the user will be prompted to select a calendar.</span>
<a href="#l16.16"></a><span id="l16.16">  */</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-function publishEntireCalendar(cal)</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+function publishEntireCalendar(aCalendar)</span>
<a href="#l16.19"></a><span id="l16.19"> {</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-    if (!cal) {</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+    if (!aCalendar) {</span>
<a href="#l16.22"></a><span id="l16.22">         var count = new Object();</span>
<a href="#l16.23"></a><span id="l16.23">         var calendars = getCalendarManager().getCalendars(count);</span>
<a href="#l16.24"></a><span id="l16.24"> </span>
<a href="#l16.25"></a><span id="l16.25">         if (count.value == 1) {</span>
<a href="#l16.26"></a><span id="l16.26">             // Do not ask user for calendar if only one calendar exists</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-            cal = calendars[0];</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineplus">+            aCalendar = calendars[0];</span>
<a href="#l16.29"></a><span id="l16.29">         } else {</span>
<a href="#l16.30"></a><span id="l16.30">             // Ask user to select the calendar that should be published.</span>
<a href="#l16.31"></a><span id="l16.31">             // publishEntireCalendar() will be called again if OK is pressed</span>
<a href="#l16.32"></a><span id="l16.32">             // in the dialog and the selected calendar will be passed in. </span>
<a href="#l16.33"></a><span id="l16.33">             // Therefore return after openDialog().</span>
<a href="#l16.34"></a><span id="l16.34">             var args = new Object();</span>
<a href="#l16.35"></a><span id="l16.35">             args.onOk = publishEntireCalendar;</span>
<a href="#l16.36"></a><span id="l16.36">             args.promptText = calGetString(&quot;calendar&quot;, &quot;publishPrompt&quot;);</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineat">@@ -92,20 +92,20 @@ function publishEntireCalendar(cal)</span>
<a href="#l16.38"></a><span id="l16.38">         }</span>
<a href="#l16.39"></a><span id="l16.39">     }</span>
<a href="#l16.40"></a><span id="l16.40"> </span>
<a href="#l16.41"></a><span id="l16.41">     var args = new Object();</span>
<a href="#l16.42"></a><span id="l16.42">     var publishObject = new Object( );</span>
<a href="#l16.43"></a><span id="l16.43"> </span>
<a href="#l16.44"></a><span id="l16.44">     args.onOk =  self.publishEntireCalendarDialogResponse;</span>
<a href="#l16.45"></a><span id="l16.45"> </span>
<a href="#l16.46"></a><span id="l16.46" class="difflineminus">-    publishObject.calendar = cal;</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineplus">+    publishObject.calendar = aCalendar;</span>
<a href="#l16.48"></a><span id="l16.48"> </span>
<a href="#l16.49"></a><span id="l16.49">     // restore the remote ics path preference from the calendar passed in</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-    var remotePath = cal.getProperty(&quot;remote-ics-path&quot;);</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+    var remotePath = aCalendar.getProperty(&quot;remote-ics-path&quot;);</span>
<a href="#l16.52"></a><span id="l16.52">     if (remotePath &amp;&amp; remotePath.length &amp;&amp; remotePath.length &gt; 0) {</span>
<a href="#l16.53"></a><span id="l16.53">         publishObject.remotePath = remotePath;</span>
<a href="#l16.54"></a><span id="l16.54">     }</span>
<a href="#l16.55"></a><span id="l16.55"> </span>
<a href="#l16.56"></a><span id="l16.56">     args.publishObject = publishObject;</span>
<a href="#l16.57"></a><span id="l16.57">     openDialog(&quot;chrome://calendar/content/publishDialog.xul&quot;, &quot;caPublishEvents&quot;, </span>
<a href="#l16.58"></a><span id="l16.58">                &quot;chrome,titlebar,modal,resizable&quot;, args );</span>
<a href="#l16.59"></a><span id="l16.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/test/unit/head_consts.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/test/unit/head_consts.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -90,27 +90,27 @@ function createTodoFromIcalString(icalSt</span>
<a href="#l17.4"></a><span id="l17.4">     var todo = Cc[&quot;@mozilla.org/calendar/todo;1&quot;]</span>
<a href="#l17.5"></a><span id="l17.5">                .createInstance(Ci.calITodo);</span>
<a href="#l17.6"></a><span id="l17.6">     todo.icalString = icalString;</span>
<a href="#l17.7"></a><span id="l17.7">     return todo;</span>
<a href="#l17.8"></a><span id="l17.8"> }</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10"> function getMemoryCal() {</span>
<a href="#l17.11"></a><span id="l17.11">     // create memory calendar</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    var cal = Cc[&quot;@mozilla.org/calendar/calendar;1?type=memory&quot;]</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-              .createInstance(Ci.calISyncWriteCalendar);</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+    var memoryCalendar = Cc[&quot;@mozilla.org/calendar/calendar;1?type=memory&quot;]</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+                         .createInstance(Ci.calISyncWriteCalendar);</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17">     // remove existing items</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-    var calendar = cal.QueryInterface(Ci.calICalendarProvider);</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+    var calendar = memoryCalendar.QueryInterface(Ci.calICalendarProvider);</span>
<a href="#l17.20"></a><span id="l17.20">     try {</span>
<a href="#l17.21"></a><span id="l17.21">         calendar.deleteCalendar(calendar, null);</span>
<a href="#l17.22"></a><span id="l17.22">     } catch (e) {</span>
<a href="#l17.23"></a><span id="l17.23">         print(&quot;*** error purging calendar: &quot; + e);</span>
<a href="#l17.24"></a><span id="l17.24">     }</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">-    return cal;</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+    return memoryCalendar;</span>
<a href="#l17.27"></a><span id="l17.27"> }</span>
<a href="#l17.28"></a><span id="l17.28"> </span>
<a href="#l17.29"></a><span id="l17.29"> function getStorageCal() {</span>
<a href="#l17.30"></a><span id="l17.30">     var dirSvc = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l17.31"></a><span id="l17.31">                  .getService(Ci.nsIProperties);</span>
<a href="#l17.32"></a><span id="l17.32">     var db = dirSvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l17.33"></a><span id="l17.33">     db.append(&quot;test_storage.sqlite&quot;);</span>
<a href="#l17.34"></a><span id="l17.34"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/test/unit/test_providers.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/test/unit/test_providers.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -386,64 +386,64 @@ function run_test() {</span>
<a href="#l18.4"></a><span id="l18.4">             calendar.addItem(aItem, listener);</span>
<a href="#l18.5"></a><span id="l18.5">         }</span>
<a href="#l18.6"></a><span id="l18.6">     }</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8">     testMetaData();</span>
<a href="#l18.9"></a><span id="l18.9"> }</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11"> function testMetaData() {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    function testMetaData_(cal) {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-        dump(&quot;testMetaData_() calendar type: &quot; + cal.type + &quot;\n&quot;);</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+    function testMetaData_(aCalendar) {</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+        dump(&quot;testMetaData_() calendar type: &quot; + aCalendar.type + &quot;\n&quot;);</span>
<a href="#l18.16"></a><span id="l18.16">         var event1 = createEventFromIcalString(&quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l18.17"></a><span id="l18.17">                                                &quot;DTSTART;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l18.18"></a><span id="l18.18">                                                &quot;END:VEVENT\n&quot;);</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20">         event1.id = &quot;item1&quot;;</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">-        cal.addItem(event1, null);</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineminus">-        cal.setMetaData(&quot;item1&quot;, &quot;meta1&quot;);</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">-        do_check_eq(cal.getMetaData(&quot;item1&quot;), &quot;meta1&quot;);</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-        do_check_eq(cal.getMetaData(&quot;unknown&quot;), null);</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineplus">+        aCalendar.addItem(event1, null);</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+        aCalendar.setMetaData(&quot;item1&quot;, &quot;meta1&quot;);</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineplus">+        do_check_eq(aCalendar.getMetaData(&quot;item1&quot;), &quot;meta1&quot;);</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+        do_check_eq(aCalendar.getMetaData(&quot;unknown&quot;), null);</span>
<a href="#l18.29"></a><span id="l18.29"> </span>
<a href="#l18.30"></a><span id="l18.30">         var event2 = event1.clone();</span>
<a href="#l18.31"></a><span id="l18.31">         event2.id = &quot;item2&quot;;</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-        cal.addItem(event2, null);</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-        cal.setMetaData(&quot;item2&quot;, &quot;meta2-&quot;);</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">-        do_check_eq(cal.getMetaData(&quot;item2&quot;), &quot;meta2-&quot;);</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+        aCalendar.addItem(event2, null);</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineplus">+        aCalendar.setMetaData(&quot;item2&quot;, &quot;meta2-&quot;);</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineplus">+        do_check_eq(aCalendar.getMetaData(&quot;item2&quot;), &quot;meta2-&quot;);</span>
<a href="#l18.38"></a><span id="l18.38"> </span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-        cal.setMetaData(&quot;item2&quot;, &quot;meta2&quot;);</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-        do_check_eq(cal.getMetaData(&quot;item2&quot;), &quot;meta2&quot;);</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+        aCalendar.setMetaData(&quot;item2&quot;, &quot;meta2&quot;);</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineplus">+        do_check_eq(aCalendar.getMetaData(&quot;item2&quot;), &quot;meta2&quot;);</span>
<a href="#l18.43"></a><span id="l18.43"> </span>
<a href="#l18.44"></a><span id="l18.44">         var count = {};</span>
<a href="#l18.45"></a><span id="l18.45">         var ids = {};</span>
<a href="#l18.46"></a><span id="l18.46">         var values = {};</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineminus">-        cal.getAllMetaData(count, ids, values);</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineplus">+        aCalendar.getAllMetaData(count, ids, values);</span>
<a href="#l18.49"></a><span id="l18.49">         do_check_eq(count.value, 2);</span>
<a href="#l18.50"></a><span id="l18.50">         do_check_true(ids.value[0] ==  &quot;item1&quot; || ids.value[1] == &quot;item1&quot;);</span>
<a href="#l18.51"></a><span id="l18.51">         do_check_true(ids.value[0] ==  &quot;item2&quot; || ids.value[1] == &quot;item2&quot;);</span>
<a href="#l18.52"></a><span id="l18.52">         do_check_true(values.value[0] ==  &quot;meta1&quot; || values.value[1] == &quot;meta1&quot;);</span>
<a href="#l18.53"></a><span id="l18.53">         do_check_true(values.value[0] ==  &quot;meta2&quot; || values.value[1] == &quot;meta2&quot;);</span>
<a href="#l18.54"></a><span id="l18.54"> </span>
<a href="#l18.55"></a><span id="l18.55" class="difflineminus">-        cal.deleteItem(event1, null);</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineminus">-        do_check_eq(cal.getMetaData(&quot;item1&quot;), null);</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineminus">-        cal.getAllMetaData(count, ids, values);</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineplus">+        aCalendar.deleteItem(event1, null);</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineplus">+        do_check_eq(aCalendar.getMetaData(&quot;item1&quot;), null);</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineplus">+        aCalendar.getAllMetaData(count, ids, values);</span>
<a href="#l18.61"></a><span id="l18.61">         do_check_eq(count.value, 1);</span>
<a href="#l18.62"></a><span id="l18.62">         do_check_true(ids.value[0] ==  &quot;item2&quot;);</span>
<a href="#l18.63"></a><span id="l18.63">         do_check_true(values.value[0] ==  &quot;meta2&quot;);</span>
<a href="#l18.64"></a><span id="l18.64"> </span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-        cal.deleteMetaData(&quot;item2&quot;);</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineminus">-        do_check_eq(cal.getMetaData(&quot;item2&quot;), null);</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineminus">-        cal.getAllMetaData(count, ids, values);</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineplus">+        aCalendar.deleteMetaData(&quot;item2&quot;);</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineplus">+        do_check_eq(aCalendar.getMetaData(&quot;item2&quot;), null);</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineplus">+        aCalendar.getAllMetaData(count, ids, values);</span>
<a href="#l18.71"></a><span id="l18.71">         do_check_eq(count.value, 0);</span>
<a href="#l18.72"></a><span id="l18.72"> </span>
<a href="#l18.73"></a><span id="l18.73" class="difflineminus">-        cal.setMetaData(&quot;item2&quot;, &quot;meta2&quot;);</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineminus">-        do_check_eq(cal.getMetaData(&quot;item2&quot;), &quot;meta2&quot;);</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineminus">-        cal.QueryInterface(Ci.calICalendarProvider).deleteCalendar(cal, null);</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineminus">-        do_check_eq(cal.getMetaData(&quot;item2&quot;), null);</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineminus">-        cal.getAllMetaData(count, ids, values);</span>
<a href="#l18.78"></a><span id="l18.78" class="difflineplus">+        aCalendar.setMetaData(&quot;item2&quot;, &quot;meta2&quot;);</span>
<a href="#l18.79"></a><span id="l18.79" class="difflineplus">+        do_check_eq(aCalendar.getMetaData(&quot;item2&quot;), &quot;meta2&quot;);</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineplus">+        aCalendar.QueryInterface(Ci.calICalendarProvider).deleteCalendar(aCalendar, null);</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineplus">+        do_check_eq(aCalendar.getMetaData(&quot;item2&quot;), null);</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineplus">+        aCalendar.getAllMetaData(count, ids, values);</span>
<a href="#l18.83"></a><span id="l18.83">         do_check_eq(count.value, 0);</span>
<a href="#l18.84"></a><span id="l18.84"> </span>
<a href="#l18.85"></a><span id="l18.85" class="difflineminus">-        cal.deleteMetaData(&quot;unknown&quot;); // check graceful return</span>
<a href="#l18.86"></a><span id="l18.86" class="difflineplus">+        aCalendar.deleteMetaData(&quot;unknown&quot;); // check graceful return</span>
<a href="#l18.87"></a><span id="l18.87">     }</span>
<a href="#l18.88"></a><span id="l18.88"> </span>
<a href="#l18.89"></a><span id="l18.89">     testMetaData_(getMemoryCal());</span>
<a href="#l18.90"></a><span id="l18.90">     testMetaData_(getStorageCal());</span>
<a href="#l18.91"></a><span id="l18.91"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

