<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 17997:3c00ed4749ee94339abc3d9da534b5baacba74f2</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 3c00ed4749ee94339abc3d9da534b5baacba74f2" />
<meta property="og:url" content="/comm-central/rev/3c00ed4749ee94339abc3d9da534b5baacba74f2" />
<meta property="og:description" content="Bug 995737 - Adapt seamonkey for the addressbook remote content policy change; use the permission manager instead of address book property r=IanN moa=Mnyromyr" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 3c00ed4749ee94339abc3d9da534b5baacba74f2 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/3c00ed4749ee94339abc3d9da534b5baacba74f2">shortlog</a> |
<a href="/comm-central/log/3c00ed4749ee94339abc3d9da534b5baacba74f2">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/3c00ed4749ee94339abc3d9da534b5baacba74f2">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/3c00ed4749ee94339abc3d9da534b5baacba74f2">files</a> |
changeset |
<a href="/comm-central/raw-rev/3c00ed4749ee94339abc3d9da534b5baacba74f2">raw</a>  | <a href="/comm-central/archive/3c00ed4749ee94339abc3d9da534b5baacba74f2.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=995737">Bug 995737</a> - Adapt seamonkey for the addressbook remote content policy change; use the permission manager instead of address book property r=IanN moa=Mnyromyr
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#32;&#67;&#104;&#101;&#101;&#32;&#60;&#112;&#104;&#105;&#108;&#105;&#112;&#46;&#99;&#104;&#101;&#101;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 03 Jun 2015 01:19:28 +0800</td></tr>

<tr>
 <td>changeset 17997</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/3c00ed4749ee94339abc3d9da534b5baacba74f2">3c00ed4749ee94339abc3d9da534b5baacba74f2</a></td>
</tr>



<tr>
<td>parent 17996</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f836c11cd54502ef5d819ead8339bcaaac3f18e6">f836c11cd54502ef5d819ead8339bcaaac3f18e6</a>
</td>
</tr>

<tr>
<td>child 17998</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0979b9fca097dd3460b4fd32823002a291ecaab6">0979b9fca097dd3460b4fd32823002a291ecaab6</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=3c00ed4749ee94339abc3d9da534b5baacba74f2">11061</a></td></tr>
<tr><td>push user</td><td>philip.chee@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 02 Jun 2015 17:20:41 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0979b9fca097 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0979b9fca097dd3460b4fd32823002a291ecaab6">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0979b9fca097dd3460b4fd32823002a291ecaab6&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0979b9fca097dd3460b4fd32823002a291ecaab6&newProject=comm-central&newRevision=3c00ed4749ee94339abc3d9da534b5baacba74f2&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0979b9fca097dd3460b4fd32823002a291ecaab6&newProject=comm-central&newRevision=3c00ed4749ee94339abc3d9da534b5baacba74f2&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0979b9fca097dd3460b4fd32823002a291ecaab6&newProject=comm-central&newRevision=3c00ed4749ee94339abc3d9da534b5baacba74f2&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28IanN%29&revcount=50">IanN</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=995737">995737</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=995737">Bug 995737</a> - Adapt seamonkey for the addressbook remote content policy change; use the permission manager instead of address book property r=IanN moa=Mnyromyr</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">file</a> |
<a href="/comm-central/annotate/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">annotate</a> |
<a href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">diff</a> |
<a href="/comm-central/comparison/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">comparison</a> |
<a href="/comm-central/log/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.dtd">suite/locales/en-US/chrome/mailnews/messenger.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.dtd">file</a> |
<a href="/comm-central/annotate/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.dtd">annotate</a> |
<a href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.dtd">diff</a> |
<a href="/comm-central/comparison/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.dtd">comparison</a> |
<a href="/comm-central/log/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.properties">suite/locales/en-US/chrome/mailnews/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.properties">file</a> |
<a href="/comm-central/annotate/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.properties">annotate</a> |
<a href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.properties">diff</a> |
<a href="/comm-central/comparison/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.properties">comparison</a> |
<a href="/comm-central/log/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/locales/en-US/chrome/mailnews/messenger.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.js">suite/mailnews/addrbook/abCardOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.js">file</a> |
<a href="/comm-central/annotate/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.js">annotate</a> |
<a href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.js">diff</a> |
<a href="/comm-central/comparison/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.js">comparison</a> |
<a href="/comm-central/log/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.xul">suite/mailnews/addrbook/abCardOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.xul">file</a> |
<a href="/comm-central/annotate/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.xul">annotate</a> |
<a href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.xul">diff</a> |
<a href="/comm-central/comparison/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.xul">comparison</a> |
<a href="/comm-central/log/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/addrbook/abCardOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.js">suite/mailnews/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.xul">suite/mailnews/mailWindowOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.xul">file</a> |
<a href="/comm-central/annotate/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.xul">annotate</a> |
<a href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.xul">diff</a> |
<a href="/comm-central/comparison/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.xul">comparison</a> |
<a href="/comm-central/log/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/mailWindowOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messageWindow.xul">suite/mailnews/messageWindow.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messageWindow.xul">file</a> |
<a href="/comm-central/annotate/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messageWindow.xul">annotate</a> |
<a href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messageWindow.xul">diff</a> |
<a href="/comm-central/comparison/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messageWindow.xul">comparison</a> |
<a href="/comm-central/log/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messageWindow.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messenger.xul">suite/mailnews/messenger.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messenger.xul">file</a> |
<a href="/comm-central/annotate/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messenger.xul">annotate</a> |
<a href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messenger.xul">diff</a> |
<a href="/comm-central/comparison/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messenger.xul">comparison</a> |
<a href="/comm-central/log/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/messenger.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/msgHdrViewOverlay.js">suite/mailnews/msgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/msgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/msgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/msgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/msgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/3c00ed4749ee94339abc3d9da534b5baacba74f2/suite/mailnews/msgHdrViewOverlay.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/addressbook/abCardOverlay.dtd</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -43,24 +43,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;!ENTITY PreferMailFormat.label         &quot;Prefers to receive messages formatted as:&quot;&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> &lt;!ENTITY PreferMailFormat.accesskey     &quot;v&quot;&gt;</span>
<a href="#l1.6"></a><span id="l1.6"> &lt;!ENTITY PlainText.label                &quot;Plain Text&quot;&gt;</span>
<a href="#l1.7"></a><span id="l1.7"> &lt;!ENTITY HTML.label                     &quot;HTML&quot;&gt;</span>
<a href="#l1.8"></a><span id="l1.8"> &lt;!ENTITY Unknown.label                  &quot;Unknown&quot;&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> &lt;!ENTITY ScreenName.label               &quot;Screen Name:&quot;&gt;</span>
<a href="#l1.10"></a><span id="l1.10"> &lt;!ENTITY ScreenName.accesskey           &quot;S&quot;&gt;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-&lt;!ENTITY allowRemoteContent1.label      &quot;Allow remote content.&quot;&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-&lt;!ENTITY allowRemoteContent1.accesskey  &quot;r&quot;&gt;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-&lt;!ENTITY allowRemoteContent1.tooltip    &quot;In HTML messages it is possible to</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-embed content from remote sources. Opening such a message will open a</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-connection to this external source. This may allow tracking of the</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-message being read. Checking this box will allow such external embedded</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-content in HTML messages from this contact.&quot;&gt;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-</span>
<a href="#l1.20"></a><span id="l1.20"> &lt;!ENTITY WorkPhone.label                &quot;Work:&quot;&gt;</span>
<a href="#l1.21"></a><span id="l1.21"> &lt;!ENTITY WorkPhone.accesskey            &quot;k&quot;&gt;</span>
<a href="#l1.22"></a><span id="l1.22"> &lt;!ENTITY HomePhone.label                &quot;Home:&quot;&gt;</span>
<a href="#l1.23"></a><span id="l1.23"> &lt;!ENTITY HomePhone.accesskey            &quot;m&quot;&gt;</span>
<a href="#l1.24"></a><span id="l1.24"> &lt;!ENTITY FaxNumber.label                &quot;Fax:&quot;&gt;</span>
<a href="#l1.25"></a><span id="l1.25"> &lt;!ENTITY FaxNumber.accesskey            &quot;x&quot;&gt;</span>
<a href="#l1.26"></a><span id="l1.26"> &lt;!ENTITY PagerNumber.label              &quot;Pager:&quot;&gt;</span>
<a href="#l1.27"></a><span id="l1.27"> &lt;!ENTITY PagerNumber.accesskey          &quot;g&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/messenger.dtd</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/messenger.dtd</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -440,16 +440,22 @@</span>
<a href="#l2.4"></a><span id="l2.4"> &lt;!ENTITY deleteButton.tooltip &quot;Delete selected message or folder&quot;&gt;</span>
<a href="#l2.5"></a><span id="l2.5"> &lt;!ENTITY undeleteButton.tooltip &quot;Undelete selected message&quot;&gt;</span>
<a href="#l2.6"></a><span id="l2.6"> &lt;!ENTITY markButton.tooltip &quot;Mark messages&quot;&gt;</span>
<a href="#l2.7"></a><span id="l2.7"> &lt;!ENTITY stopButton.tooltip &quot;Stop the current transfer&quot;&gt;</span>
<a href="#l2.8"></a><span id="l2.8"> &lt;!ENTITY throbber.tooltip &quot;Go to the &amp;vendorShortName; home page&quot;&gt;</span>
<a href="#l2.9"></a><span id="l2.9"> &lt;!ENTITY junkButton.tooltip &quot;Mark the selected messages as junk&quot;&gt;</span>
<a href="#l2.10"></a><span id="l2.10"> &lt;!ENTITY notJunkButton.tooltip &quot;Mark the selected messages as not junk&quot;&gt;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+&lt;!-- Remote Content Button Popup --&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+&lt;!ENTITY remoteContentOptionsAllowForMsg.label &quot;Show remote content in this message&quot;&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+&lt;!ENTITY remoteContentOptionsAllowForMsg.accesskey &quot;S&quot;&gt;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+&lt;!ENTITY editRemoteContentSettings.label &quot;Edit permissions for remote content…&quot;&gt;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+&lt;!ENTITY editRemoteContentSettings.accesskey &quot;E&quot;&gt;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+</span>
<a href="#l2.18"></a><span id="l2.18"> &lt;!-- Statusbar --&gt;</span>
<a href="#l2.19"></a><span id="l2.19"> &lt;!ENTITY  statusText.label &quot;Done&quot;&gt;</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21"> &lt;!-- Thread Pane Context Menu --&gt;</span>
<a href="#l2.22"></a><span id="l2.22"> &lt;!ENTITY contextOpenNewWindow.label &quot;Open Message in New Window&quot;&gt;</span>
<a href="#l2.23"></a><span id="l2.23"> &lt;!ENTITY contextOpenNewWindow.accesskey &quot;W&quot;&gt;</span>
<a href="#l2.24"></a><span id="l2.24"> &lt;!ENTITY contextOpenNewTab.label &quot;Open Message in New Tab&quot;&gt;</span>
<a href="#l2.25"></a><span id="l2.25"> &lt;!ENTITY contextOpenNewTab.accesskey &quot;T&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -409,19 +409,16 @@ errorOpenMessageForMessageIdTitle=Error </span>
<a href="#l3.4"></a><span id="l3.4"> errorOpenMessageForMessageIdMessage=Message for message-id %S not found</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> # Warnings to alert users about phishing urls</span>
<a href="#l3.7"></a><span id="l3.7"> confirmPhishingTitle=Email Scam Alert</span>
<a href="#l3.8"></a><span id="l3.8"> #LOCALIZATION NOTE %1$S is the brand name, %2$S is the host name of the url being visited</span>
<a href="#l3.9"></a><span id="l3.9"> confirmPhishingUrl1=%1$S thinks this website is suspicious! It may be trying to impersonate the web page you want to visit. Most legitimate websites use names instead of numbers. Are you sure you want to visit %2$S?</span>
<a href="#l3.10"></a><span id="l3.10"> confirmPhishingUrl2=%1$S thinks this website is suspicious! It may be trying to impersonate the web page you want to visit. Are you sure you want to visit %2$S?</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-#LOCALIZATION NOTE %1$S is the e-mail address of the person we will allow remote content for</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-alwaysLoadRemoteContentForSender=Click here to always load remote content from %1$S.</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-</span>
<a href="#l3.15"></a><span id="l3.15"> #LOCALIZATION NOTE(mdnBarMessageNormal) %1$S is the name of the sender</span>
<a href="#l3.16"></a><span id="l3.16"> mdnBarMessageNormal=%1$S has asked to be notified when you read this message.</span>
<a href="#l3.17"></a><span id="l3.17"> #LOCALIZATION NOTE(mdnBarMessageAddressDiffers) %1$S is the name of the sender, %2$S is the address(es) to send return receipt to</span>
<a href="#l3.18"></a><span id="l3.18"> mdnBarMessageAddressDiffers=%1$S has asked to be notified at %2$S when you read this message.</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20"> # mailCommands.js</span>
<a href="#l3.21"></a><span id="l3.21"> emptyJunkTitle=Confirm</span>
<a href="#l3.22"></a><span id="l3.22"> emptyJunkMessage=Are you sure you want to permanently delete all messages and subfolders in the Junk folder?</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineat">@@ -462,18 +459,21 @@ mailServerLoginFailedEnterNewPasswordBut</span>
<a href="#l3.24"></a><span id="l3.24"> # LOCALIZATION NOTE (junkBarMessage): %S is the brandname</span>
<a href="#l3.25"></a><span id="l3.25"> junkBarMessage=%S regards this message as junk.</span>
<a href="#l3.26"></a><span id="l3.26"> junkBarButton=Not Junk</span>
<a href="#l3.27"></a><span id="l3.27"> junkBarButtonKey=N</span>
<a href="#l3.28"></a><span id="l3.28"> junkBarInfoButton=?</span>
<a href="#l3.29"></a><span id="l3.29"> junkBarInfoButtonKey=?</span>
<a href="#l3.30"></a><span id="l3.30"> # LOCALIZATION NOTE (remoteContentBarMessage): %S is the brandname</span>
<a href="#l3.31"></a><span id="l3.31"> remoteContentBarMessage=To protect your privacy, %S has blocked remote content in this message.</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-remoteContentBarButton=Show Remote Content</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-remoteContentBarButtonKey=S</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+remoteContentPrefLabel=Options</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+remoteContentPrefAccesskey=O</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+# LOCALIZATION NOTE(remoteContentAllow): %S is host name</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+remoteContentAllow=Allow remote content for %S</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+</span>
<a href="#l3.39"></a><span id="l3.39"> # LOCALIZATION NOTE (phishingBarMessage): %S is the brandname</span>
<a href="#l3.40"></a><span id="l3.40"> phishingBarMessage=%S regards this message as an e-mail scam.</span>
<a href="#l3.41"></a><span id="l3.41"> phishingBarIgnoreButton=Ignore Warning</span>
<a href="#l3.42"></a><span id="l3.42"> phishingBarIgnoreButtonKey=I</span>
<a href="#l3.43"></a><span id="l3.43"> mdnBarMessage=The sender of this message has asked to be notified when you read this message. Do you wish to notify the sender?</span>
<a href="#l3.44"></a><span id="l3.44"> mdnBarIgnoreButton=Ignore Request</span>
<a href="#l3.45"></a><span id="l3.45"> mdnBarIgnoreButtonKey=I</span>
<a href="#l3.46"></a><span id="l3.46"> mdnBarSendReqButton=Send Receipt</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/mailnews/addrbook/abCardOverlay.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/mailnews/addrbook/abCardOverlay.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l4.5"></a><span id="l4.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.6"></a><span id="l4.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.7"></a><span id="l4.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9"> const kNonVcardFields =</span>
<a href="#l4.10"></a><span id="l4.10">         [&quot;NickNameContainer&quot;, &quot;SecondaryEmailContainer&quot;, &quot;ScreenNameContainer&quot;,</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">-         &quot;customFields&quot;, &quot;allowRemoteContent&quot;, &quot;preferDisplayName&quot;];</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+         &quot;customFields&quot;, &quot;preferDisplayName&quot;];</span>
<a href="#l4.13"></a><span id="l4.13"> </span>
<a href="#l4.14"></a><span id="l4.14"> const kPhoneticFields =</span>
<a href="#l4.15"></a><span id="l4.15">         [&quot;PhoneticLastName&quot;, &quot;PhoneticLabel1&quot;, &quot;PhoneticSpacer1&quot;,</span>
<a href="#l4.16"></a><span id="l4.16">          &quot;PhoneticFirstName&quot;, &quot;PhoneticLabel2&quot;, &quot;PhoneticSpacer2&quot;];</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18"> // Item is |[dialogField, cardProperty]|.</span>
<a href="#l4.19"></a><span id="l4.19"> const kVcardFields =</span>
<a href="#l4.20"></a><span id="l4.20">         [ // Contact &gt; Name</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -104,20 +104,16 @@ function OnLoadNewCard()</span>
<a href="#l4.22"></a><span id="l4.22">       // when the user types a first or last name</span>
<a href="#l4.23"></a><span id="l4.23">       if (gEditCard.card.displayName)</span>
<a href="#l4.24"></a><span id="l4.24">         gEditCard.generateDisplayName = false;</span>
<a href="#l4.25"></a><span id="l4.25">     }</span>
<a href="#l4.26"></a><span id="l4.26">     if (&quot;aimScreenName&quot; in window.arguments[0])</span>
<a href="#l4.27"></a><span id="l4.27">       gEditCard.card.setProperty(&quot;_AimScreenName&quot;,</span>
<a href="#l4.28"></a><span id="l4.28">                                  window.arguments[0].aimScreenName);</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-    if (&quot;allowRemoteContent&quot; in window.arguments[0])</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-      gEditCard.card.setProperty(&quot;AllowRemoteContent&quot;,</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-                                 window.arguments[0].allowRemoteContent);</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-</span>
<a href="#l4.34"></a><span id="l4.34">     if (&quot;okCallback&quot; in window.arguments[0])</span>
<a href="#l4.35"></a><span id="l4.35">       gOkCallback = window.arguments[0].okCallback;</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37">     if (&quot;escapedVCardStr&quot; in window.arguments[0]) {</span>
<a href="#l4.38"></a><span id="l4.38">       // hide non vcard values</span>
<a href="#l4.39"></a><span id="l4.39">       HideNonVcardFields();</span>
<a href="#l4.40"></a><span id="l4.40">       gEditCard.card = MailServices.ab.escapedVCardToAbCard(window.arguments[0].escapedVCardStr);</span>
<a href="#l4.41"></a><span id="l4.41">     }</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineat">@@ -268,30 +264,25 @@ function OnLoadEditCard()</span>
<a href="#l4.43"></a><span id="l4.43">         document.getElementById(&quot;PhotoURI&quot;).placeholder      = &quot;&quot;;</span>
<a href="#l4.44"></a><span id="l4.44">         document.getElementById(&quot;BrowsePhoto&quot;).disabled      = true;</span>
<a href="#l4.45"></a><span id="l4.45">         document.getElementById(&quot;UpdatePhoto&quot;).disabled      = true;</span>
<a href="#l4.46"></a><span id="l4.46"> </span>
<a href="#l4.47"></a><span id="l4.47">         // And the phonetic fields</span>
<a href="#l4.48"></a><span id="l4.48">         document.getElementById(kPhoneticFields[0]).readOnly = true;</span>
<a href="#l4.49"></a><span id="l4.49">         document.getElementById(kPhoneticFields[3]).readOnly = true;</span>
<a href="#l4.50"></a><span id="l4.50"> </span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-        // Also disable the mail format popup and allow remote content items.</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+        // Also disable the mail format popup.</span>
<a href="#l4.53"></a><span id="l4.53">         document.getElementById(&quot;PreferMailFormatPopup&quot;).disabled = true;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-        document.getElementById(&quot;allowRemoteContent&quot;).disabled = true;</span>
<a href="#l4.55"></a><span id="l4.55"> </span>
<a href="#l4.56"></a><span id="l4.56">         // And the &quot;prefer display name&quot; checkbox.</span>
<a href="#l4.57"></a><span id="l4.57">         document.getElementById(&quot;preferDisplayName&quot;).disabled = true;</span>
<a href="#l4.58"></a><span id="l4.58"> </span>
<a href="#l4.59"></a><span id="l4.59">         document.documentElement.buttons = &quot;accept&quot;;</span>
<a href="#l4.60"></a><span id="l4.60">         document.documentElement.removeAttribute(&quot;ondialogaccept&quot;);</span>
<a href="#l4.61"></a><span id="l4.61">       }</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-      // hide remote content in HTML field for remote directories</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-      if (directory.isRemote)</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-        document.getElementById('allowRemoteContent').hidden = true;</span>
<a href="#l4.66"></a><span id="l4.66">     }</span>
<a href="#l4.67"></a><span id="l4.67">   }</span>
<a href="#l4.68"></a><span id="l4.68"> }</span>
<a href="#l4.69"></a><span id="l4.69"> </span>
<a href="#l4.70"></a><span id="l4.70"> /* Registers functions that are called when loading the card</span>
<a href="#l4.71"></a><span id="l4.71">  * values into the contact editor dialog.  This is useful if</span>
<a href="#l4.72"></a><span id="l4.72">  * extensions have added extra fields to the nsIAbCard, and</span>
<a href="#l4.73"></a><span id="l4.73">  * need to display them in the contact editor.</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineat">@@ -414,21 +405,16 @@ function NewCardOKButton()</span>
<a href="#l4.75"></a><span id="l4.75">         return false;  // don't close window</span>
<a href="#l4.76"></a><span id="l4.76"> </span>
<a href="#l4.77"></a><span id="l4.77">       // replace gEditCard.card with the card we added</span>
<a href="#l4.78"></a><span id="l4.78">       // so that save listeners can get / set attributes on</span>
<a href="#l4.79"></a><span id="l4.79">       // the card that got created.</span>
<a href="#l4.80"></a><span id="l4.80">       var directory = GetDirectoryFromURI(uri);</span>
<a href="#l4.81"></a><span id="l4.81">       gEditCard.card = directory.addCard(gEditCard.card);</span>
<a href="#l4.82"></a><span id="l4.82">       NotifySaveListeners(directory);</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-      if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0] &amp;&amp;</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-          &quot;allowRemoteContent&quot; in window.arguments[0])</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-        // getProperty may return a &quot;1&quot; or &quot;0&quot; string, we want a boolean</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-        window.arguments[0].allowRemoteContent =</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineminus">-          gEditCard.card.getProperty(&quot;AllowRemoteContent&quot;, false) != false;</span>
<a href="#l4.88"></a><span id="l4.88">     }</span>
<a href="#l4.89"></a><span id="l4.89">   }</span>
<a href="#l4.90"></a><span id="l4.90"> </span>
<a href="#l4.91"></a><span id="l4.91">   return true;  // close the window</span>
<a href="#l4.92"></a><span id="l4.92"> }</span>
<a href="#l4.93"></a><span id="l4.93"> </span>
<a href="#l4.94"></a><span id="l4.94"> // Move the data from the cardproperty to the dialog</span>
<a href="#l4.95"></a><span id="l4.95"> function GetCardValues(cardproperty, doc)</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineat">@@ -479,21 +465,16 @@ function GetCardValues(cardproperty, doc</span>
<a href="#l4.97"></a><span id="l4.97">   birthday.onchange = calculateAge;</span>
<a href="#l4.98"></a><span id="l4.98">   var age = doc.getElementById(&quot;Age&quot;);</span>
<a href="#l4.99"></a><span id="l4.99">   age.onchange = calculateYear;</span>
<a href="#l4.100"></a><span id="l4.100"> </span>
<a href="#l4.101"></a><span id="l4.101">   var popup = document.getElementById(&quot;PreferMailFormatPopup&quot;);</span>
<a href="#l4.102"></a><span id="l4.102">   if (popup)</span>
<a href="#l4.103"></a><span id="l4.103">     popup.value = cardproperty.getProperty(&quot;PreferMailFormat&quot;, &quot;&quot;);</span>
<a href="#l4.104"></a><span id="l4.104"> </span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-  var allowRemoteContentEl = document.getElementById(&quot;allowRemoteContent&quot;);</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-  if (allowRemoteContentEl)</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-    // getProperty may return a &quot;1&quot; or &quot;0&quot; string, we want a boolean</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-    allowRemoteContentEl.checked = cardproperty.getProperty(&quot;AllowRemoteContent&quot;, false) != false;</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineminus">-</span>
<a href="#l4.110"></a><span id="l4.110">   var preferDisplayNameEl = document.getElementById(&quot;preferDisplayName&quot;);</span>
<a href="#l4.111"></a><span id="l4.111">   if (preferDisplayNameEl)</span>
<a href="#l4.112"></a><span id="l4.112">     // getProperty may return a &quot;1&quot; or &quot;0&quot; string, we want a boolean</span>
<a href="#l4.113"></a><span id="l4.113">     preferDisplayNameEl.checked = cardproperty.getProperty(&quot;PreferDisplayName&quot;, true) != false;</span>
<a href="#l4.114"></a><span id="l4.114"> </span>
<a href="#l4.115"></a><span id="l4.115">   // get phonetic fields if exist</span>
<a href="#l4.116"></a><span id="l4.116">   try {</span>
<a href="#l4.117"></a><span id="l4.117">     doc.getElementById(&quot;PhoneticFirstName&quot;).value = cardproperty.getProperty(&quot;PhoneticFirstName&quot;, &quot;&quot;);</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineat">@@ -550,20 +531,16 @@ function CheckAndSetCardValues(cardprope</span>
<a href="#l4.119"></a><span id="l4.119">   cardproperty.setProperty(&quot;BirthDay&quot;, birthDay);</span>
<a href="#l4.120"></a><span id="l4.120">   cardproperty.setProperty(&quot;BirthMonth&quot;, birthMonth);</span>
<a href="#l4.121"></a><span id="l4.121">   cardproperty.setProperty(&quot;BirthYear&quot;, birthYear);</span>
<a href="#l4.122"></a><span id="l4.122"> </span>
<a href="#l4.123"></a><span id="l4.123">   var popup = document.getElementById(&quot;PreferMailFormatPopup&quot;);</span>
<a href="#l4.124"></a><span id="l4.124">   if (popup)</span>
<a href="#l4.125"></a><span id="l4.125">     cardproperty.setProperty(&quot;PreferMailFormat&quot;, popup.value);</span>
<a href="#l4.126"></a><span id="l4.126"> </span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-  var allowRemoteContentEl = document.getElementById(&quot;allowRemoteContent&quot;);</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-  if (allowRemoteContentEl)</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-    cardproperty.setProperty(&quot;AllowRemoteContent&quot;, allowRemoteContentEl.checked);</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-</span>
<a href="#l4.131"></a><span id="l4.131">   var preferDisplayNameEl = document.getElementById(&quot;preferDisplayName&quot;);</span>
<a href="#l4.132"></a><span id="l4.132">   if (preferDisplayNameEl)</span>
<a href="#l4.133"></a><span id="l4.133">     cardproperty.setProperty(&quot;PreferDisplayName&quot;, preferDisplayNameEl.checked);</span>
<a href="#l4.134"></a><span id="l4.134"> </span>
<a href="#l4.135"></a><span id="l4.135">   // set phonetic fields if exist</span>
<a href="#l4.136"></a><span id="l4.136">   try {</span>
<a href="#l4.137"></a><span id="l4.137">     cardproperty.setProperty(&quot;PhoneticFirstName&quot;, doc.getElementById(&quot;PhoneticFirstName&quot;).value);</span>
<a href="#l4.138"></a><span id="l4.138">     cardproperty.setProperty(&quot;PhoneticLastName&quot;, doc.getElementById(&quot;PhoneticLastName&quot;).value);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/mailnews/addrbook/abCardOverlay.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/mailnews/addrbook/abCardOverlay.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -178,19 +178,16 @@</span>
<a href="#l5.4"></a><span id="l5.4">           &lt;menulist id=&quot;PreferMailFormatPopup&quot;&gt;</span>
<a href="#l5.5"></a><span id="l5.5">             &lt;menupopup&gt;</span>
<a href="#l5.6"></a><span id="l5.6">               &lt;!-- 0,1,2 come from nsIAbPreferMailFormat in nsIAbCard.idl --&gt;</span>
<a href="#l5.7"></a><span id="l5.7">               &lt;menuitem value=&quot;0&quot; label=&quot;&amp;Unknown.label;&quot;/&gt;</span>
<a href="#l5.8"></a><span id="l5.8">               &lt;menuitem value=&quot;1&quot; label=&quot;&amp;PlainText.label;&quot;/&gt;</span>
<a href="#l5.9"></a><span id="l5.9">               &lt;menuitem value=&quot;2&quot; label=&quot;&amp;HTML.label;&quot;/&gt;</span>
<a href="#l5.10"></a><span id="l5.10">             &lt;/menupopup&gt;</span>
<a href="#l5.11"></a><span id="l5.11">           &lt;/menulist&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-          &lt;checkbox id=&quot;allowRemoteContent&quot; label=&quot;&amp;allowRemoteContent1.label;&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-                    accesskey=&quot;&amp;allowRemoteContent1.accesskey;&quot;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-                    tooltiptext=&quot;&amp;allowRemoteContent1.tooltip;&quot;/&gt;</span>
<a href="#l5.15"></a><span id="l5.15">         &lt;/hbox&gt;</span>
<a href="#l5.16"></a><span id="l5.16">       &lt;/vbox&gt; &lt;!-- End of Name Tab --&gt;</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18">       &lt;!-- ** Home Address Tab ** --&gt;</span>
<a href="#l5.19"></a><span id="l5.19">       &lt;vbox id=&quot;abHomeTab&quot; &gt;</span>
<a href="#l5.20"></a><span id="l5.20">         &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l5.21"></a><span id="l5.21">           &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l5.22"></a><span id="l5.22">           &lt;label control=&quot;HomeAddress&quot; value=&quot;&amp;HomeAddress.label;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/mailnews/mailWindowOverlay.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/mailnews/mailWindowOverlay.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -2532,17 +2532,17 @@ function HandleJunkStatusChanged(folder)</span>
<a href="#l6.4"></a><span id="l6.4">       if ((!isJunk &amp;&amp; folder.isSpecialFolder(Components.interfaces.nsMsgFolderFlags.Inbox)) ||</span>
<a href="#l6.5"></a><span id="l6.5">           (isJunk &amp;&amp; !folder.server.spamSettings.manualMark) ||</span>
<a href="#l6.6"></a><span id="l6.6">           (isJunk &amp;&amp; folder.isSpecialFolder(Components.interfaces.nsMsgFolderFlags.Junk)))</span>
<a href="#l6.7"></a><span id="l6.7">         ReloadMessage();</span>
<a href="#l6.8"></a><span id="l6.8">     }</span>
<a href="#l6.9"></a><span id="l6.9">   }</span>
<a href="#l6.10"></a><span id="l6.10"> }</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-var gMessageNotificationBar = </span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+var gMessageNotificationBar =</span>
<a href="#l6.14"></a><span id="l6.14"> {</span>
<a href="#l6.15"></a><span id="l6.15">   get mStringBundle()</span>
<a href="#l6.16"></a><span id="l6.16">   {</span>
<a href="#l6.17"></a><span id="l6.17">     delete this.mStringBundle;</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19">     return this.mStringBundle = document.getElementById('bundle_messenger');</span>
<a href="#l6.20"></a><span id="l6.20">   },</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -2602,59 +2602,49 @@ var gMessageNotificationBar =</span>
<a href="#l6.23"></a><span id="l6.23">         }];</span>
<a href="#l6.24"></a><span id="l6.24">         this.mMsgNotificationBar.appendNotification(junkBarMsg, &quot;junkContent&quot;,</span>
<a href="#l6.25"></a><span id="l6.25">           null, this.mMsgNotificationBar.PRIORITY_WARNING_HIGH, buttons);</span>
<a href="#l6.26"></a><span id="l6.26">         this.mMsgNotificationBar.collapsed = false;</span>
<a href="#l6.27"></a><span id="l6.27">       }</span>
<a href="#l6.28"></a><span id="l6.28">     }</span>
<a href="#l6.29"></a><span id="l6.29">   },</span>
<a href="#l6.30"></a><span id="l6.30"> </span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-  setRemoteContentMsg: function(aMsgHdr)</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-  {  </span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-    var headerParser = Components.classes[&quot;@mozilla.org/messenger/headerparser;1&quot;]</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-                                 .getService(Components.interfaces.nsIMsgHeaderParser);</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-    var emailAddress = headerParser.extractHeaderAddressMailboxes(aMsgHdr.author);</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-    var oldNotif = this.mMsgNotificationBar.getNotificationWithValue(&quot;remoteContent&quot;);</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-    if (!oldNotif)</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-    {</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-      let displayName = headerParser.extractHeaderAddressName(aMsgHdr.author);</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-      let brandName = this.mBrandBundle.getString('brandShortName');</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-      let remoteContentMsg = this.mStringBundle.getFormattedString('remoteContentBarMessage', </span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-                                                                   [brandName]);</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineminus">-      let buttons = [{</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">-        label: this.mStringBundle.getString('remoteContentBarButton'),</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineminus">-        accessKey: this.mStringBundle.getString('remoteContentBarButtonKey'),</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineminus">-        popup: null,</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-        callback: function()</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-        {</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-          LoadMsgWithRemoteContent();</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-        }</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-      }];</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineminus">-      let bar =</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineminus">-        this.mMsgNotificationBar.appendNotification(remoteContentMsg, &quot;remoteContent&quot;,</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-          null, this.mMsgNotificationBar.PRIORITY_WARNING_MEDIUM, buttons);</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineminus">-      if (emailAddress)</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-      {</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineminus">-        let XULNS = &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;;</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-        let linkLabel = bar.ownerDocument.createElementNS(XULNS, &quot;label&quot;);</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-        let addedLink = this.mStringBundle.getFormattedString('alwaysLoadRemoteContentForSender', </span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-                                                              [emailAddress]);</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-        linkLabel.className = &quot;text-link&quot;;</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-        linkLabel.textContent = addedLink;</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-        linkLabel.flex = 1;</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-        linkLabel.onclick = function() { allowRemoteContentForSender(emailAddress, </span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-                                                                     displayName); };</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-        bar.insertBefore(linkLabel, bar.firstChild);</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-      }</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-    }</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineplus">+  remoteHosts: null,</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+  setRemoteContentMsg: function(aMsgHdr, aContentURI)</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+  {</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineplus">+    // remoteHosts is a Set of all blockable hosts.</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+    if (!this.remoteHosts)</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+      this.remoteHosts = new Set();</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+    this.remoteHosts.add(aContentURI.host);</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineplus">+</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineplus">+    if (this.mMsgNotificationBar.getNotificationWithValue(&quot;remoteContent&quot;))</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+      return;</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineplus">+    var headerParser = MailServices.headerParser;</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineplus">+    // update the allow remote content for sender string</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+    var mailbox = headerParser.extractHeaderAddressMailboxes(aMsgHdr.author);</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+    var emailAddress = mailbox || aMsgHdr.author;</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineplus">+    var displayName = headerParser.extractHeaderAddressName(aMsgHdr.author);</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineplus">+    var brandName = this.mBrandBundle.getString(&quot;brandShortName&quot;);</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineplus">+    var remoteContentMsg = this.mStringBundle</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineplus">+                               .getFormattedString(&quot;remoteContentBarMessage&quot;,</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineplus">+                                                   [brandName]);</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineplus">+    var buttons = [{</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+      label: this.mStringBundle.getString(&quot;remoteContentPrefLabel&quot;),</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineplus">+      accessKey: this.mStringBundle.getString(&quot;remoteContentPrefAccesskey&quot;),</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineplus">+      popup: &quot;remoteContentOptions&quot;</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineplus">+    }];</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineplus">+</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineplus">+    this.mMsgNotificationBar</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineplus">+        .appendNotification(remoteContentMsg,</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineplus">+                            &quot;remoteContent&quot;,</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineplus">+                            null,</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineplus">+                            this.mMsgNotificationBar.PRIORITY_WARNING_MEDIUM,</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineplus">+                            buttons);</span>
<a href="#l6.107"></a><span id="l6.107">   },</span>
<a href="#l6.108"></a><span id="l6.108"> </span>
<a href="#l6.109"></a><span id="l6.109">   // aUrl is the nsIURI for the message currently loaded in the message pane</span>
<a href="#l6.110"></a><span id="l6.110">   setPhishingMsg: function(aUrl)</span>
<a href="#l6.111"></a><span id="l6.111">   {</span>
<a href="#l6.112"></a><span id="l6.112">     // if we've explicitly marked this message as not being an email scam, then don't</span>
<a href="#l6.113"></a><span id="l6.113">     // bother checking it with the phishing detector.</span>
<a href="#l6.114"></a><span id="l6.114">     var phishingMsg = false;</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineat">@@ -2749,76 +2739,87 @@ function LoadMsgWithRemoteContent()</span>
<a href="#l6.116"></a><span id="l6.116">   // change the &quot;remoteContentBar&quot; property on it</span>
<a href="#l6.117"></a><span id="l6.117">   // then reload the message</span>
<a href="#l6.118"></a><span id="l6.118"> </span>
<a href="#l6.119"></a><span id="l6.119">   setMsgHdrPropertyAndReload(&quot;remoteContentPolicy&quot;, kAllowRemoteContent);</span>
<a href="#l6.120"></a><span id="l6.120">   window.content.focus();</span>
<a href="#l6.121"></a><span id="l6.121"> }</span>
<a href="#l6.122"></a><span id="l6.122"> </span>
<a href="#l6.123"></a><span id="l6.123"> /**</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineplus">+ * Populate the remote content options for the current message.</span>
<a href="#l6.125"></a><span id="l6.125" class="difflineplus">+ */</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineplus">+function onRemoteContentOptionsShowing(aEvent)</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineplus">+{</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineplus">+  var hosts = [...gMessageNotificationBar.remoteHosts];</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineplus">+</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineplus">+  var addresses = {};</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineplus">+  MailServices.headerParser.parseHeadersWithArray(</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineplus">+    gMessageDisplay.displayedMessage.author, addresses, {}, {});</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineplus">+  var authorEmailAddress = addresses.value[0];</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineplus">+  if (authorEmailAddress)</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineplus">+    hosts.unshift(authorEmailAddress);</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineplus">+</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineplus">+  // Out with the old...</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineplus">+  let childNodes = aEvent.target.querySelectorAll(&quot;.allow-remote-uri&quot;);</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineplus">+  for (let child of childNodes)</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineplus">+    child.remove();</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineplus">+</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineplus">+  var messengerBundle = gMessageNotificationBar.mStringBundle;</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineplus">+  var separator = document.getElementById(&quot;remoteContentSettingsMenuSeparator&quot;)</span>
<a href="#l6.144"></a><span id="l6.144" class="difflineplus">+</span>
<a href="#l6.145"></a><span id="l6.145" class="difflineplus">+  // ... and in with the new.</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineplus">+  for (let host of hosts)</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineplus">+  {</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineplus">+    let menuitem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l6.149"></a><span id="l6.149" class="difflineplus">+    menuitem.setAttribute(&quot;label&quot;,</span>
<a href="#l6.150"></a><span id="l6.150" class="difflineplus">+      messengerBundle.getFormattedString(&quot;remoteContentAllow&quot;, [host]));</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineplus">+    menuitem.setAttribute(&quot;host&quot;, host);</span>
<a href="#l6.152"></a><span id="l6.152" class="difflineplus">+    menuitem.setAttribute(&quot;class&quot;, &quot;allow-remote-uri&quot;);</span>
<a href="#l6.153"></a><span id="l6.153" class="difflineplus">+    aEvent.target.insertBefore(menuitem, separator);</span>
<a href="#l6.154"></a><span id="l6.154" class="difflineplus">+  }</span>
<a href="#l6.155"></a><span id="l6.155" class="difflineplus">+}</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineplus">+</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineplus">+/**</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineplus">+ * Add privileges to display remote content for the given uri.</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineplus">+ * @param aItem |nsIDOMNode| Item that was selected. The host</span>
<a href="#l6.160"></a><span id="l6.160" class="difflineplus">+ *        is extracted and converted to a uri and used to add</span>
<a href="#l6.161"></a><span id="l6.161" class="difflineplus">+ *        permissions for the site.</span>
<a href="#l6.162"></a><span id="l6.162" class="difflineplus">+ */</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineplus">+function allowRemoteContentForURI(aItem)</span>
<a href="#l6.164"></a><span id="l6.164" class="difflineplus">+{</span>
<a href="#l6.165"></a><span id="l6.165" class="difflineplus">+  var host = aItem.getAttribute(&quot;host&quot;);</span>
<a href="#l6.166"></a><span id="l6.166" class="difflineplus">+  if (!host)</span>
<a href="#l6.167"></a><span id="l6.167" class="difflineplus">+    return;</span>
<a href="#l6.168"></a><span id="l6.168" class="difflineplus">+</span>
<a href="#l6.169"></a><span id="l6.169" class="difflineplus">+  var scheme = host.includes(&quot;@&quot;) ? &quot;mailto:&quot; : &quot;http://&quot;;</span>
<a href="#l6.170"></a><span id="l6.170" class="difflineplus">+  var uri = Services.io.newURI(scheme + host, null, null);</span>
<a href="#l6.171"></a><span id="l6.171" class="difflineplus">+  Services.perms.add(uri, &quot;image&quot;, Services.perms.ALLOW_ACTION);</span>
<a href="#l6.172"></a><span id="l6.172" class="difflineplus">+  ReloadMessage();</span>
<a href="#l6.173"></a><span id="l6.173" class="difflineplus">+}</span>
<a href="#l6.174"></a><span id="l6.174" class="difflineplus">+</span>
<a href="#l6.175"></a><span id="l6.175" class="difflineplus">+/**</span>
<a href="#l6.176"></a><span id="l6.176" class="difflineplus">+ * Displays fine-grained, per-site permissions for remote content.</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineplus">+ */</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineplus">+function editRemoteContentSettings()</span>
<a href="#l6.179"></a><span id="l6.179" class="difflineplus">+{</span>
<a href="#l6.180"></a><span id="l6.180" class="difflineplus">+  toDataManager(&quot;|permissions&quot;);</span>
<a href="#l6.181"></a><span id="l6.181" class="difflineplus">+  if (!Services.prefs.getBoolPref(&quot;browser.preferences.instantApply&quot;))</span>
<a href="#l6.182"></a><span id="l6.182" class="difflineplus">+    ReloadMessage();</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineplus">+}</span>
<a href="#l6.184"></a><span id="l6.184" class="difflineplus">+</span>
<a href="#l6.185"></a><span id="l6.185" class="difflineplus">+/**</span>
<a href="#l6.186"></a><span id="l6.186">  *  msgHdrForCurrentMessage</span>
<a href="#l6.187"></a><span id="l6.187">  *   Returns the msg hdr associated with the current loaded message.</span>
<a href="#l6.188"></a><span id="l6.188">  */</span>
<a href="#l6.189"></a><span id="l6.189"> function msgHdrForCurrentMessage()</span>
<a href="#l6.190"></a><span id="l6.190"> {</span>
<a href="#l6.191"></a><span id="l6.191">   var msgURI = GetLoadedMessage();</span>
<a href="#l6.192"></a><span id="l6.192">   return (msgURI &amp;&amp; !(/type=application\/x-message-display/.test(msgURI))) ? messenger.msgHdrFromURI(msgURI) : null;</span>
<a href="#l6.193"></a><span id="l6.193"> }</span>
<a href="#l6.194"></a><span id="l6.194"> </span>
<a href="#l6.195"></a><span id="l6.195" class="difflineminus">-/**</span>
<a href="#l6.196"></a><span id="l6.196" class="difflineminus">- *  Reloads the message after adjusting the remote content policy for the sender.</span>
<a href="#l6.197"></a><span id="l6.197" class="difflineminus">- *  Iterate through the local address books looking for a card with the same e-mail address as the </span>
<a href="#l6.198"></a><span id="l6.198" class="difflineminus">- *  sender of the current loaded message. If we find a card, update the allow remote content field.</span>
<a href="#l6.199"></a><span id="l6.199" class="difflineminus">- *  If we can't find a card, prompt the user with a new AB card dialog, pre-selecting the remote content field.</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineminus">- */</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineminus">-function allowRemoteContentForSender(aAuthorEmailAddress, aAuthorDisplayName)</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineminus">-{</span>
<a href="#l6.203"></a><span id="l6.203" class="difflineminus">-  // search through all of our local address books looking for a match.</span>
<a href="#l6.204"></a><span id="l6.204" class="difflineminus">-  var enumerator = Components.classes[&quot;@mozilla.org/abmanager;1&quot;]</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineminus">-                             .getService(Components.interfaces.nsIAbManager)</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineminus">-                             .directories;</span>
<a href="#l6.207"></a><span id="l6.207" class="difflineminus">-  var cardForEmailAddress = null;</span>
<a href="#l6.208"></a><span id="l6.208" class="difflineminus">-  var addrbook = null;</span>
<a href="#l6.209"></a><span id="l6.209" class="difflineminus">-  while (!cardForEmailAddress &amp;&amp; enumerator.hasMoreElements())</span>
<a href="#l6.210"></a><span id="l6.210" class="difflineminus">-  {</span>
<a href="#l6.211"></a><span id="l6.211" class="difflineminus">-    addrbook = enumerator.getNext()</span>
<a href="#l6.212"></a><span id="l6.212" class="difflineminus">-                         .QueryInterface(Components.interfaces.nsIAbDirectory);</span>
<a href="#l6.213"></a><span id="l6.213" class="difflineminus">-    // Try/catch because cardForEmailAddress will throw if not implemented.</span>
<a href="#l6.214"></a><span id="l6.214" class="difflineminus">-    try</span>
<a href="#l6.215"></a><span id="l6.215" class="difflineminus">-    {</span>
<a href="#l6.216"></a><span id="l6.216" class="difflineminus">-      // If it's a read-only book, don't find a card as we won't be able</span>
<a href="#l6.217"></a><span id="l6.217" class="difflineminus">-      // to modify the card.</span>
<a href="#l6.218"></a><span id="l6.218" class="difflineminus">-      if (!addrbook.readOnly)</span>
<a href="#l6.219"></a><span id="l6.219" class="difflineminus">-        cardForEmailAddress = addrbook.cardForEmailAddress(authorEmailAddress);</span>
<a href="#l6.220"></a><span id="l6.220" class="difflineminus">-    } catch (e) {}</span>
<a href="#l6.221"></a><span id="l6.221" class="difflineminus">-  }</span>
<a href="#l6.222"></a><span id="l6.222" class="difflineminus">-</span>
<a href="#l6.223"></a><span id="l6.223" class="difflineminus">-  var allowRemoteContent = false;</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineminus">-  if (cardForEmailAddress)</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineminus">-  {</span>
<a href="#l6.226"></a><span id="l6.226" class="difflineminus">-    // set the property for remote content</span>
<a href="#l6.227"></a><span id="l6.227" class="difflineminus">-    cardForEmailAddress.setProperty(&quot;AllowRemoteContent&quot;, true);</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineminus">-    addrbook.modifyCard(cardForEmailAddress);</span>
<a href="#l6.229"></a><span id="l6.229" class="difflineminus">-    allowRemoteContent = true;</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineminus">-  }</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineminus">-  else</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineminus">-  {</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineminus">-    var args = {primaryEmail:aAuthorEmailAddress, displayName:aAuthorDisplayName,</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineminus">-                 allowRemoteContent:true};</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineminus">-    // create a new card and set the property</span>
<a href="#l6.236"></a><span id="l6.236" class="difflineminus">-    window.openDialog(&quot;chrome://messenger/content/addressbook/abNewCardDialog.xul&quot;,</span>
<a href="#l6.237"></a><span id="l6.237" class="difflineminus">-                      &quot;&quot;, &quot;chrome,resizable=no,titlebar,modal,centerscreen&quot;, args);</span>
<a href="#l6.238"></a><span id="l6.238" class="difflineminus">-    allowRemoteContent = args.allowRemoteContent;</span>
<a href="#l6.239"></a><span id="l6.239" class="difflineminus">-  } </span>
<a href="#l6.240"></a><span id="l6.240" class="difflineminus">-</span>
<a href="#l6.241"></a><span id="l6.241" class="difflineminus">-  // reload the message if we've updated the remote content policy for the sender  </span>
<a href="#l6.242"></a><span id="l6.242" class="difflineminus">-  if (allowRemoteContent)</span>
<a href="#l6.243"></a><span id="l6.243" class="difflineminus">-    ReloadMessage();</span>
<a href="#l6.244"></a><span id="l6.244" class="difflineminus">-}</span>
<a href="#l6.245"></a><span id="l6.245" class="difflineminus">-</span>
<a href="#l6.246"></a><span id="l6.246"> function MsgIsNotAScam()</span>
<a href="#l6.247"></a><span id="l6.247"> {</span>
<a href="#l6.248"></a><span id="l6.248">   // we want to get the msg hdr for the currently selected message</span>
<a href="#l6.249"></a><span id="l6.249">   // change the &quot;isPhishingMsg&quot; property on it</span>
<a href="#l6.250"></a><span id="l6.250">   // then reload the message</span>
<a href="#l6.251"></a><span id="l6.251"> </span>
<a href="#l6.252"></a><span id="l6.252">   setMsgHdrPropertyAndReload(&quot;notAPhishMessage&quot;, kNotAPhishMessage);</span>
<a href="#l6.253"></a><span id="l6.253"> }</span>
<a href="#l6.254"></a><span id="l6.254" class="difflineat">@@ -2916,16 +2917,19 @@ function OnMsgLoaded(aUrl)</span>
<a href="#l6.255"></a><span id="l6.255">     // if the user clicks on another message then that message stays selected</span>
<a href="#l6.256"></a><span id="l6.256">     // and the selection does not &quot;snap back&quot; to the message chosen by</span>
<a href="#l6.257"></a><span id="l6.257">     // SetNextMessageAfterDelete() when the operation completes (bug 243532).</span>
<a href="#l6.258"></a><span id="l6.258">     var wintype = document.documentElement.getAttribute('windowtype');</span>
<a href="#l6.259"></a><span id="l6.259">     gNextMessageViewIndexAfterDelete = -2;</span>
<a href="#l6.260"></a><span id="l6.260"> </span>
<a href="#l6.261"></a><span id="l6.261">     var msgHdr = msgHdrForCurrentMessage();</span>
<a href="#l6.262"></a><span id="l6.262">     gMessageNotificationBar.setJunkMsg(msgHdr);</span>
<a href="#l6.263"></a><span id="l6.263" class="difflineplus">+    // Reset the blocked hosts so we can populate it again for this message.</span>
<a href="#l6.264"></a><span id="l6.264" class="difflineplus">+    // Reset to null so it's only a Set if there's something in the Set.</span>
<a href="#l6.265"></a><span id="l6.265" class="difflineplus">+    gMessageNotificationBar.remoteHosts = null;</span>
<a href="#l6.266"></a><span id="l6.266"> </span>
<a href="#l6.267"></a><span id="l6.267">     var markReadAutoMode = Services.prefs.getBoolPref(&quot;mailnews.mark_message_read.auto&quot;);</span>
<a href="#l6.268"></a><span id="l6.268"> </span>
<a href="#l6.269"></a><span id="l6.269">     // We just finished loading a message. If messages are to be marked as read</span>
<a href="#l6.270"></a><span id="l6.270">     // automatically, set a timer to mark the message is read after n seconds</span>
<a href="#l6.271"></a><span id="l6.271">     // where n can be configured by the user.</span>
<a href="#l6.272"></a><span id="l6.272">     if (msgHdr &amp;&amp; !msgHdr.isRead &amp;&amp; markReadAutoMode)</span>
<a href="#l6.273"></a><span id="l6.273">     {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/mailnews/mailWindowOverlay.xul</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/mailnews/mailWindowOverlay.xul</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -871,16 +871,30 @@</span>
<a href="#l7.4"></a><span id="l7.4">               oncommand=&quot;gContextMenu.saveImage();&quot;/&gt;</span>
<a href="#l7.5"></a><span id="l7.5">     &lt;menuitem id=&quot;context-bookmarklink&quot;</span>
<a href="#l7.6"></a><span id="l7.6">               label=&quot;&amp;bookmarkLinkCmd.label;&quot;</span>
<a href="#l7.7"></a><span id="l7.7">               accesskey=&quot;&amp;bookmarkLinkCmd.accesskey;&quot;</span>
<a href="#l7.8"></a><span id="l7.8">               oncommand=&quot;PlacesUIUtils.showMinimalAddBookmarkUI(makeURI(gContextMenu.linkURL),</span>
<a href="#l7.9"></a><span id="l7.9">                                                                 gContextMenu.linkText());&quot;/&gt;</span>
<a href="#l7.10"></a><span id="l7.10">   &lt;/menupopup&gt;</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+  &lt;menupopup id=&quot;remoteContentOptions&quot;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+             onpopupshowing=&quot;onRemoteContentOptionsShowing(event);&quot;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+             oncommand=&quot;allowRemoteContentForURI(event.target);&quot;&gt;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    &lt;menuitem id=&quot;remoteContentOptionAllowForMsg&quot;</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+              label=&quot;&amp;remoteContentOptionsAllowForMsg.label;&quot;</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+              accesskey=&quot;&amp;remoteContentOptionsAllowForMsg.accesskey;&quot;</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+              oncommand=&quot;LoadMsgWithRemoteContent();&quot;/&gt;</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+    &lt;menuseparator id=&quot;remoteContentSettingsMenuSeparator&quot;/&gt;</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+    &lt;menuitem id=&quot;editRemoteContentSettings&quot;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+              label=&quot;&amp;editRemoteContentSettings.label;&quot;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+              accesskey=&quot;&amp;editRemoteContentSettings.accesskey;&quot;</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+              oncommand=&quot;editRemoteContentSettings();&quot;/&gt;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+  &lt;/menupopup&gt;</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+</span>
<a href="#l7.26"></a><span id="l7.26">   &lt;toolbar type=&quot;menubar&quot;</span>
<a href="#l7.27"></a><span id="l7.27">            id=&quot;mail-toolbar-menubar2&quot;</span>
<a href="#l7.28"></a><span id="l7.28">            class=&quot;chromeclass-menubar&quot;</span>
<a href="#l7.29"></a><span id="l7.29">            persist=&quot;collapsed&quot;</span>
<a href="#l7.30"></a><span id="l7.30">            grippytooltiptext=&quot;&amp;menuBar.tooltip;&quot;</span>
<a href="#l7.31"></a><span id="l7.31">            customizable=&quot;true&quot;</span>
<a href="#l7.32"></a><span id="l7.32">            defaultset=&quot;menubar-items&quot;</span>
<a href="#l7.33"></a><span id="l7.33">            mode=&quot;icons&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/mailnews/messageWindow.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/mailnews/messageWindow.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -86,16 +86,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5">   &lt;popupset id=&quot;messagePopupSet&quot;&gt;</span>
<a href="#l8.6"></a><span id="l8.6">     &lt;menupopup id=&quot;mailContext&quot;/&gt;</span>
<a href="#l8.7"></a><span id="l8.7">     &lt;menupopup id=&quot;attachmentListContext&quot;/&gt;</span>
<a href="#l8.8"></a><span id="l8.8">     &lt;menupopup id=&quot;copyUrlPopup&quot;/&gt;</span>
<a href="#l8.9"></a><span id="l8.9">     &lt;menupopup id=&quot;messageIdContext&quot;/&gt;</span>
<a href="#l8.10"></a><span id="l8.10">     &lt;menupopup id=&quot;emailAddressPopup&quot;/&gt;</span>
<a href="#l8.11"></a><span id="l8.11">     &lt;menupopup id=&quot;toolbar-context-menu&quot;/&gt;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+    &lt;menupopup id=&quot;remoteContentOptions&quot;/&gt;</span>
<a href="#l8.13"></a><span id="l8.13">     &lt;tooltip id=&quot;aHTMLTooltip&quot;</span>
<a href="#l8.14"></a><span id="l8.14">              onpopupshowing=&quot;return FillInHTMLTooltip(document.tooltipNode);&quot;/&gt;</span>
<a href="#l8.15"></a><span id="l8.15">     &lt;panel id=&quot;customizeToolbarSheetPopup&quot;/&gt;</span>
<a href="#l8.16"></a><span id="l8.16">   &lt;/popupset&gt;</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18">   &lt;vbox id=&quot;titlebar&quot;/&gt;</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">   &lt;toolbox id=&quot;mail-toolbox&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/mailnews/messenger.xul</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/mailnews/messenger.xul</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -104,16 +104,17 @@</span>
<a href="#l9.4"></a><span id="l9.4">     &lt;menupopup id=&quot;messageIdContext&quot;/&gt;</span>
<a href="#l9.5"></a><span id="l9.5">     &lt;menupopup id=&quot;emailAddressPopup&quot;/&gt;</span>
<a href="#l9.6"></a><span id="l9.6">     &lt;menupopup id=&quot;toolbar-context-menu&quot;/&gt;</span>
<a href="#l9.7"></a><span id="l9.7">     &lt;tooltip id=&quot;folderpopup&quot; class=&quot;folderSummaryPopup&quot;/&gt;</span>
<a href="#l9.8"></a><span id="l9.8">     &lt;tooltip id=&quot;aHTMLTooltip&quot;</span>
<a href="#l9.9"></a><span id="l9.9">              onpopupshowing=&quot;return FillInHTMLTooltip(document.tooltipNode);&quot;/&gt;</span>
<a href="#l9.10"></a><span id="l9.10">     &lt;panel id=&quot;customizeToolbarSheetPopup&quot;/&gt;</span>
<a href="#l9.11"></a><span id="l9.11">     &lt;menupopup id=&quot;networkProperties&quot;/&gt;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+    &lt;menupopup id=&quot;remoteContentOptions&quot;/&gt;</span>
<a href="#l9.13"></a><span id="l9.13">   &lt;/popupset&gt;</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15">   &lt;vbox id=&quot;titlebar&quot;/&gt;</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17">   &lt;toolbox id=&quot;mail-toolbox&quot; class=&quot;toolbox-top&quot;&gt;</span>
<a href="#l9.18"></a><span id="l9.18">     &lt;toolbar id=&quot;mail-toolbar-menubar2&quot;&gt;</span>
<a href="#l9.19"></a><span id="l9.19">       &lt;toolbaritem id=&quot;menubar-items&quot;&gt;</span>
<a href="#l9.20"></a><span id="l9.20">         &lt;menubar id=&quot;mail-menubar&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/mailnews/msgHdrViewOverlay.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/mailnews/msgHdrViewOverlay.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -613,19 +613,19 @@ var messageHeaderSink = {</span>
<a href="#l10.4"></a><span id="l10.4">       OnMsgParsed(url);</span>
<a href="#l10.5"></a><span id="l10.5">     },</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7">     onEndMsgHeaders: function(url)</span>
<a href="#l10.8"></a><span id="l10.8">     {</span>
<a href="#l10.9"></a><span id="l10.9">       OnMsgLoaded(url);</span>
<a href="#l10.10"></a><span id="l10.10">     },</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    onMsgHasRemoteContent: function(aMsgHdr)</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    onMsgHasRemoteContent: function(aMsgHdr, aContentURI)</span>
<a href="#l10.14"></a><span id="l10.14">     {</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-      gMessageNotificationBar.setRemoteContentMsg(aMsgHdr);</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+      gMessageNotificationBar.setRemoteContentMsg(aMsgHdr, aContentURI);</span>
<a href="#l10.17"></a><span id="l10.17">     },</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19">     mSecurityInfo  : null,</span>
<a href="#l10.20"></a><span id="l10.20">     mSaveHdr: null,</span>
<a href="#l10.21"></a><span id="l10.21">     get securityInfo()</span>
<a href="#l10.22"></a><span id="l10.22">     {</span>
<a href="#l10.23"></a><span id="l10.23">       return this.mSecurityInfo;</span>
<a href="#l10.24"></a><span id="l10.24">     },</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

