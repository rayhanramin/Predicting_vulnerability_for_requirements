<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 6100:b7f04f55aa20f29039d50312ee05657b89d39ebb</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ b7f04f55aa20f29039d50312ee05657b89d39ebb" />
<meta property="og:url" content="/comm-central/rev/b7f04f55aa20f29039d50312ee05657b89d39ebb" />
<meta property="og:description" content="bug 580662 - Add management UI for places bookmarks, r=IanN" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / b7f04f55aa20f29039d50312ee05657b89d39ebb 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/b7f04f55aa20f29039d50312ee05657b89d39ebb">shortlog</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/b7f04f55aa20f29039d50312ee05657b89d39ebb">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb">files</a> |
changeset |
<a href="/comm-central/raw-rev/b7f04f55aa20f29039d50312ee05657b89d39ebb">raw</a>  | <a href="/comm-central/archive/b7f04f55aa20f29039d50312ee05657b89d39ebb.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=580662">bug 580662</a> - Add management UI for places bookmarks, r=IanN
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#111;&#98;&#101;&#114;&#116;&#32;&#75;&#97;&#105;&#115;&#101;&#114;&#32;&#60;&#107;&#97;&#105;&#114;&#111;&#64;&#107;&#97;&#105;&#114;&#111;&#46;&#97;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 08 Aug 2010 22:06:47 +0200</td></tr>

<tr>
 <td>changeset 6100</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/b7f04f55aa20f29039d50312ee05657b89d39ebb">b7f04f55aa20f29039d50312ee05657b89d39ebb</a></td>
</tr>



<tr>
<td>parent 6099</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/05e7e38f82eac13db314e88884331255b0499057">05e7e38f82eac13db314e88884331255b0499057</a>
</td>
</tr>

<tr>
<td>child 6101</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b7d14a8dd2d0b25bf30b7bbf09319d796376f147">b7d14a8dd2d0b25bf30b7bbf09319d796376f147</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=b7f04f55aa20f29039d50312ee05657b89d39ebb">4716</a></td></tr>
<tr><td>push user</td><td>kairo@kairo.at</td></tr>
<tr><td>push date</td><td class="date age">Sun, 08 Aug 2010 20:07:31 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@b9e980d6f85d [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b9e980d6f85d8be090681db70a0be5a06d5b216d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b9e980d6f85d8be090681db70a0be5a06d5b216d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b9e980d6f85d8be090681db70a0be5a06d5b216d&newProject=comm-central&newRevision=6e9656086f3397ba950d84983e1878cb757598d0&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b9e980d6f85d8be090681db70a0be5a06d5b216d&newProject=comm-central&newRevision=6e9656086f3397ba950d84983e1878cb757598d0&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b9e980d6f85d8be090681db70a0be5a06d5b216d&newProject=comm-central&newRevision=6e9656086f3397ba950d84983e1878cb757598d0&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28IanN%29&revcount=50">IanN</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=580662">580662</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=580662">bug 580662</a> - Add management UI for places bookmarks, r=IanN</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/browser-prefs.js">suite/browser/browser-prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/browser-prefs.js">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/browser-prefs.js">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/browser-prefs.js">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/browser-prefs.js">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/browser-prefs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.js">suite/browser/navigator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.js">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.js">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.js">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.js">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.xul">suite/browser/navigator.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.xul">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.xul">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.xul">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.xul">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/browser/navigator.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-panel.xul">suite/common/bookmarks/bm-panel.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-panel.xul">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-panel.xul">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-panel.xul">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-panel.xul">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-panel.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.js">suite/common/bookmarks/bm-props.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.js">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.js">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.js">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.js">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.xul">suite/common/bookmarks/bm-props.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.xul">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.xul">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.xul">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.xul">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bm-props.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.js">suite/common/bookmarks/bookmarksManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.js">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.js">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.js">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.js">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.xul">suite/common/bookmarks/bookmarksManager.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.xul">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.xul">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.xul">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.xul">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/bookmarksManager.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/browser-places.js">suite/common/bookmarks/browser-places.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/browser-places.js">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/browser-places.js">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/browser-places.js">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/browser-places.js">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/browser-places.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.js">suite/common/bookmarks/editBookmarkOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.js">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.js">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.js">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.js">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.xul">suite/common/bookmarks/editBookmarkOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.xul">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.xul">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.xul">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.xul">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/editBookmarkOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.js">suite/common/bookmarks/moveBookmarks.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.js">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.js">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.js">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.js">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.xul">suite/common/bookmarks/moveBookmarks.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.xul">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.xul">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.xul">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.xul">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/moveBookmarks.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/organizer.css">suite/common/bookmarks/organizer.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/organizer.css">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/organizer.css">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/organizer.css">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/organizer.css">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/organizer.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/placesOverlay.xul">suite/common/bookmarks/placesOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/placesOverlay.xul">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/placesOverlay.xul">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/placesOverlay.xul">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/placesOverlay.xul">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/bookmarks/placesOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/history.js">suite/common/history/history.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/history.js">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/history.js">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/history.js">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/history.js">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/history.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/placesOverlay.xul">suite/common/history/placesOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/placesOverlay.xul">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/placesOverlay.xul">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/placesOverlay.xul">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/placesOverlay.xul">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/history/placesOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/jar.mn">suite/common/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/jar.mn">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/jar.mn">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/jar.mn">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/jar.mn">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/common/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/browser/navigator.properties">suite/locales/en-US/chrome/browser/navigator.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/browser/navigator.properties">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/browser/navigator.properties">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/browser/navigator.properties">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/browser/navigator.properties">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/browser/navigator.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/bm-props.properties">suite/locales/en-US/chrome/common/bookmarks/bm-props.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/bm-props.properties">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/bm-props.properties">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/bm-props.properties">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/bm-props.properties">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/bm-props.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/editBookmarkOverlay.dtd">suite/locales/en-US/chrome/common/bookmarks/editBookmarkOverlay.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/editBookmarkOverlay.dtd">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/editBookmarkOverlay.dtd">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/editBookmarkOverlay.dtd">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/editBookmarkOverlay.dtd">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/editBookmarkOverlay.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/moveBookmarks.dtd">suite/locales/en-US/chrome/common/bookmarks/moveBookmarks.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/moveBookmarks.dtd">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/moveBookmarks.dtd">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/moveBookmarks.dtd">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/moveBookmarks.dtd">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/moveBookmarks.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/places.dtd">suite/locales/en-US/chrome/common/bookmarks/places.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/places.dtd">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/places.dtd">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/places.dtd">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/places.dtd">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/en-US/chrome/common/bookmarks/places.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/jar.mn">suite/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/mailnews/mailWindowOverlay.xul">suite/mailnews/mailWindowOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/mailnews/mailWindowOverlay.xul">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/mailnews/mailWindowOverlay.xul">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/mailnews/mailWindowOverlay.xul">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/mailnews/mailWindowOverlay.xul">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/mailnews/mailWindowOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/bookmarksManager.css">suite/themes/classic/communicator/bookmarks/bookmarksManager.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/bookmarksManager.css">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/bookmarksManager.css">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/bookmarksManager.css">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/bookmarksManager.css">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/bookmarksManager.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/editBookmarkOverlay.css">suite/themes/classic/communicator/bookmarks/editBookmarkOverlay.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/editBookmarkOverlay.css">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/editBookmarkOverlay.css">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/editBookmarkOverlay.css">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/editBookmarkOverlay.css">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/editBookmarkOverlay.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/home.png">suite/themes/classic/communicator/bookmarks/home.png</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/home.png">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/home.png">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/communicator/bookmarks/home.png">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/jar.mn">suite/themes/classic/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/jar.mn">file</a> |
<a href="/comm-central/annotate/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/jar.mn">annotate</a> |
<a href="/comm-central/diff/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/jar.mn">diff</a> |
<a href="/comm-central/comparison/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/jar.mn">comparison</a> |
<a href="/comm-central/log/b7f04f55aa20f29039d50312ee05657b89d39ebb/suite/themes/classic/jar.mn">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/browser/browser-prefs.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/browser/browser-prefs.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -212,16 +212,20 @@ pref(&quot;places.frecency.unvisitedTypedBonu</span>
<a href="#l1.4"></a><span id="l1.4"> pref(&quot;browser.bookmarks.autoExportHTML&quot;, false);</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> // The maximum number of daily bookmark backups to</span>
<a href="#l1.7"></a><span id="l1.7"> // keep in {PROFILEDIR}/bookmarkbackups. Special values:</span>
<a href="#l1.8"></a><span id="l1.8"> // -1: unlimited</span>
<a href="#l1.9"></a><span id="l1.9"> //  0: no backups created (and deletes all existing backups)</span>
<a href="#l1.10"></a><span id="l1.10"> pref(&quot;browser.bookmarks.max_backups&quot;, 10);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+// Don't try to alter this pref, it'll be reset the next time you use the</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+// bookmarking dialog</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+pref(&quot;browser.bookmarks.editDialog.firstEditField&quot;, &quot;namePicker&quot;);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+</span>
<a href="#l1.16"></a><span id="l1.16"> // Tabbed browser</span>
<a href="#l1.17"></a><span id="l1.17"> pref(&quot;browser.tabs.loadDivertedInBackground&quot;, false);</span>
<a href="#l1.18"></a><span id="l1.18"> pref(&quot;browser.tabs.loadInBackground&quot;, true);</span>
<a href="#l1.19"></a><span id="l1.19"> pref(&quot;browser.tabs.opentabfor.doubleclick&quot;, false);</span>
<a href="#l1.20"></a><span id="l1.20"> pref(&quot;browser.tabs.opentabfor.middleclick&quot;, true);</span>
<a href="#l1.21"></a><span id="l1.21"> pref(&quot;browser.tabs.opentabfor.urlbar&quot;, true);</span>
<a href="#l1.22"></a><span id="l1.22"> pref(&quot;browser.tabs.tooltippreview.enable&quot;, true);</span>
<a href="#l1.23"></a><span id="l1.23"> pref(&quot;browser.tabs.tooltippreview.width&quot;, 300);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/browser/navigator.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/browser/navigator.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -36,16 +36,25 @@</span>
<a href="#l2.4"></a><span id="l2.4">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l2.5"></a><span id="l2.5">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l2.6"></a><span id="l2.6">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l2.7"></a><span id="l2.7">  *</span>
<a href="#l2.8"></a><span id="l2.8">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> Components.utils.import(&quot;resource://gre/modules/AddonManager.jsm&quot;);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+__defineGetter__(&quot;PluralForm&quot;, function() {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  return this.PluralForm;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+});</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+__defineSetter__(&quot;PluralForm&quot;, function (val) {</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+  delete this.PluralForm;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+  return this.PluralForm = val;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+});</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+</span>
<a href="#l2.21"></a><span id="l2.21"> const REMOTESERVICE_CONTRACTID = &quot;@mozilla.org/toolkit/remote-service;1&quot;;</span>
<a href="#l2.22"></a><span id="l2.22"> const XUL_NAMESPACE = &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;;</span>
<a href="#l2.23"></a><span id="l2.23"> var gURLBar = null;</span>
<a href="#l2.24"></a><span id="l2.24"> var gProxyButton = null;</span>
<a href="#l2.25"></a><span id="l2.25"> var gProxyFavIcon = null;</span>
<a href="#l2.26"></a><span id="l2.26"> var gProxyDeck = null;</span>
<a href="#l2.27"></a><span id="l2.27"> var gSearchService = null;</span>
<a href="#l2.28"></a><span id="l2.28"> var gNavigatorBundle;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/browser/navigator.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/browser/navigator.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -91,16 +91,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://navigator/content/browser.js&quot;/&gt;</span>
<a href="#l3.5"></a><span id="l3.5">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://navigator/content/navigator.js&quot;/&gt;</span>
<a href="#l3.6"></a><span id="l3.6">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://navigator/content/navigatorDD.js&quot;/&gt;</span>
<a href="#l3.7"></a><span id="l3.7">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://navigator/content/sessionHistoryUI.js&quot;/&gt;</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">   &lt;!-- Places Bookmarks Utilities --&gt;</span>
<a href="#l3.10"></a><span id="l3.10">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/places/browserPlacesViews.js&quot;/&gt;</span>
<a href="#l3.11"></a><span id="l3.11">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/bookmarks/browser-places.js&quot;/&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/bookmarks/editBookmarkOverlay.js&quot;/&gt;</span>
<a href="#l3.13"></a><span id="l3.13"> </span>
<a href="#l3.14"></a><span id="l3.14">   &lt;!-- hook for stringbundle overlays --&gt;</span>
<a href="#l3.15"></a><span id="l3.15">   &lt;stringbundleset id=&quot;stringbundleset&quot;&gt;</span>
<a href="#l3.16"></a><span id="l3.16">     &lt;stringbundle id=&quot;bundle_navigator&quot; src=&quot;chrome://navigator/locale/navigator.properties&quot;/&gt;</span>
<a href="#l3.17"></a><span id="l3.17">     &lt;stringbundle id=&quot;bundle_brand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l3.18"></a><span id="l3.18">     &lt;stringbundle id=&quot;bundle_navigator_region&quot; src=&quot;chrome://navigator-region/locale/region.properties&quot;/&gt;</span>
<a href="#l3.19"></a><span id="l3.19">     &lt;stringbundle id=&quot;findBundle&quot; src=&quot;chrome://global/locale/finddialog.properties&quot;/&gt;</span>
<a href="#l3.20"></a><span id="l3.20">   &lt;/stringbundleset&gt;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -149,16 +150,18 @@</span>
<a href="#l3.22"></a><span id="l3.22">     &lt;menupopup id=&quot;toolbar-context-menu&quot;/&gt;</span>
<a href="#l3.23"></a><span id="l3.23"> </span>
<a href="#l3.24"></a><span id="l3.24">     &lt;menupopup id=&quot;feedsPopup&quot; popupanchor=&quot;bottomright&quot; popupalign=&quot;topright&quot;</span>
<a href="#l3.25"></a><span id="l3.25">                onpopupshowing=&quot;window.XULBrowserWindow.populateFeeds(this);&quot;</span>
<a href="#l3.26"></a><span id="l3.26">                oncommand=&quot;subscribeToFeed(event.target.statusText, event);&quot;</span>
<a href="#l3.27"></a><span id="l3.27">                onclick=&quot;checkForMiddleClick(this, event);&quot;/&gt;</span>
<a href="#l3.28"></a><span id="l3.28">     &lt;panel id=&quot;PopupAutoComplete&quot; type=&quot;autocomplete&quot; noautofocus=&quot;true&quot;/&gt;</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+    &lt;panel id=&quot;editBookmarkPanel&quot;/&gt;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+</span>
<a href="#l3.32"></a><span id="l3.32">     &lt;menupopup id=&quot;placesContext&quot;/&gt;</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34">     &lt;!-- Bookmarks and history tooltip --&gt;</span>
<a href="#l3.35"></a><span id="l3.35">     &lt;tooltip id=&quot;bhTooltip&quot;/&gt;</span>
<a href="#l3.36"></a><span id="l3.36"> </span>
<a href="#l3.37"></a><span id="l3.37">     &lt;menupopup id=&quot;popupBlockerMenu&quot;</span>
<a href="#l3.38"></a><span id="l3.38">                oncommand=&quot;popupBlockerMenuCommand(event.target);&quot;</span>
<a href="#l3.39"></a><span id="l3.39">                onpopupshowing=&quot;return popupBlockerMenuShowing(event)&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/common/bookmarks/bm-panel.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/common/bookmarks/bm-panel.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -59,17 +59,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l4.6"></a><span id="l4.6">           src=&quot;chrome://communicator/content/places/sidebarUtils.js&quot;/&gt;</span>
<a href="#l4.7"></a><span id="l4.7">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l4.8"></a><span id="l4.8">           src=&quot;chrome://communicator/content/bookmarks/bm-panel.js&quot;/&gt;</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10">   &lt;commandset id=&quot;placesCommands&quot;/&gt;</span>
<a href="#l4.11"></a><span id="l4.11">   &lt;commandset id=&quot;editMenuCommands&quot;/&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  &lt;popup id=&quot;placesContext&quot;/&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  &lt;menupopup id=&quot;placesContext&quot;/&gt;</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15">   &lt;!-- Bookmarks and history tooltip --&gt;</span>
<a href="#l4.16"></a><span id="l4.16">   &lt;tooltip id=&quot;bhTooltip&quot;/&gt;</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18">   &lt;hbox id=&quot;sidebar-search-container&quot; align=&quot;center&quot;&gt;</span>
<a href="#l4.19"></a><span id="l4.19">     &lt;label id=&quot;sidebar-search-label&quot;</span>
<a href="#l4.20"></a><span id="l4.20">            value=&quot;&amp;search.label;&quot; accesskey=&quot;&amp;search.accesskey;&quot; control=&quot;search-box&quot;/&gt;</span>
<a href="#l4.21"></a><span id="l4.21">     &lt;textbox id=&quot;search-box&quot; flex=&quot;1&quot; type=&quot;search&quot; class=&quot;compact&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/common/bookmarks/bm-props.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/common/bookmarks/bm-props.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,376 +1,672 @@</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineminus">-/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.6"></a><span id="l5.6"> /* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.7"></a><span id="l5.7">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.8"></a><span id="l5.8">  *</span>
<a href="#l5.9"></a><span id="l5.9">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.10"></a><span id="l5.10">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.11"></a><span id="l5.11">  * the License. You may obtain a copy of the License at</span>
<a href="#l5.12"></a><span id="l5.12">  * http://www.mozilla.org/MPL/</span>
<a href="#l5.13"></a><span id="l5.13">  *</span>
<a href="#l5.14"></a><span id="l5.14">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.15"></a><span id="l5.15">  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.16"></a><span id="l5.16">  * for the specific language governing rights and limitations under the</span>
<a href="#l5.17"></a><span id="l5.17">  * License.</span>
<a href="#l5.18"></a><span id="l5.18">  *</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+ * The Original Code is the Places Bookmark Properties dialog.</span>
<a href="#l5.21"></a><span id="l5.21">  *</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l5.27"></a><span id="l5.27">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l5.28"></a><span id="l5.28">  *</span>
<a href="#l5.29"></a><span id="l5.29">  * Contributor(s):</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+ *   Joe Hughes &lt;jhughes@google.com&gt;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+ *   Dietrich Ayala &lt;dietrich@mozilla.com&gt;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+ *   Marco Bonardo &lt;mak77@bonardo.net&gt;</span>
<a href="#l5.34"></a><span id="l5.34">  *</span>
<a href="#l5.35"></a><span id="l5.35">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.40"></a><span id="l5.40">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.41"></a><span id="l5.41">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.42"></a><span id="l5.42">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.43"></a><span id="l5.43">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.44"></a><span id="l5.44">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.45"></a><span id="l5.45">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.46"></a><span id="l5.46">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.47"></a><span id="l5.47">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.48"></a><span id="l5.48">  *</span>
<a href="#l5.49"></a><span id="l5.49">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l5.50"></a><span id="l5.50"> </span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-// This is the set of fields that are visible in the window.</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-var gFields;</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-// ...and this is a parallel array that contains the RDF properties</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-// that they are associated with.</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-var gProperties;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-// The ID of the current shown bookmark</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-var gBookmarkID;</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-function Init()</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-{</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-  initServices();</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-  initBMService();</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-  // This is the set of fields that are visible in the window.</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-  gFields     = [&quot;name&quot;, &quot;url&quot;, &quot;shortcut&quot;, &quot;description&quot;];</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+/**</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+ * The panel is initialized based on data given in the js object passed</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+ * as window.arguments[0]. The object must have the following fields set:</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+ *   @ action (String). Possible values:</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+ *     - &quot;add&quot; - for adding a new item.</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+ *       @ type (String). Possible values:</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+ *         - &quot;bookmark&quot;</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+ *           @ loadBookmarkInSidebar - optional, the default state for the</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+ *             &quot;Load this bookmark in the sidebar&quot; field.</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+ *         - &quot;folder&quot;</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+ *           @ URIList (Array of nsIURI objects) - optional, list of uris to</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+ *             be bookmarked under the new folder.</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+ *         - &quot;livemark&quot;</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+ *       @ uri (nsIURI object) - optional, the default uri for the new item.</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+ *         The property is not used for the &quot;folder with items&quot; type.</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+ *       @ title (String) - optional, the default title for the new item.</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+ *       @ description (String) - optional, the default description for the new</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+ *         item.</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+ *       @ defaultInsertionPoint (InsertionPoint JS object) - optional, the</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+ *         default insertion point for the new item.</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+ *       @ keyword (String) - optional, the default keyword for the new item.</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+ *       @ postData (String) - optional, POST data to accompany the keyword.</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+ *       @ charSet (String) - optional, character-set to accompany the keyword.</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+ *      Notes:</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+ *        1) If |uri| is set for a bookmark/livemark item and |title| isn't,</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+ *           the dialog will query the history tables for the title associated</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+ *           with the given uri. If the dialog is set to adding a folder with</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+ *           bookmark items under it (see URIList), a default static title is</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+ *           used (&quot;[Folder Name]&quot;).</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+ *        2) The index field of the default insertion point is ignored if</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineplus">+ *           the folder picker is shown.</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineplus">+ *     - &quot;edit&quot; - for editing a bookmark item or a folder.</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineplus">+ *       @ type (String). Possible values:</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+ *         - &quot;bookmark&quot;</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineplus">+ *           @ itemId (Integer) - the id of the bookmark item.</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineplus">+ *         - &quot;folder&quot; (also applies to livemarks)</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineplus">+ *           @ itemId (Integer) - the id of the folder.</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineplus">+ *   @ hiddenRows (Strings array) - optional, list of rows to be hidden</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineplus">+ *     regardless of the item edited or added by the dialog.</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+ *     Possible values:</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+ *     - &quot;title&quot;</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineplus">+ *     - &quot;location&quot;</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+ *     - &quot;description&quot;</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+ *     - &quot;keyword&quot;</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+ *     - &quot;tags&quot;</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+ *     - &quot;loadInSidebar&quot;</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+ *     - &quot;feedLocation&quot;</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+ *     - &quot;siteLocation&quot;</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineplus">+ *     - &quot;folderPicker&quot; - hides both the tree and the menu.</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineplus">+ *   @ readOnly (Boolean) - optional, states if the panel should be read-only</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+ *</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineplus">+ * window.arguments[0].performed is set to true if any transaction has</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineplus">+ * been performed by the dialog.</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineplus">+ */</span>
<a href="#l5.122"></a><span id="l5.122"> </span>
<a href="#l5.123"></a><span id="l5.123" class="difflineminus">-  // ...and this is a parallel array that contains the RDF properties</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineminus">-  // that they are associated with.</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineminus">-  gProperties = [NC_NS + &quot;Name&quot;,</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineminus">-                 NC_NS + &quot;URL&quot;,</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineminus">-                 NC_NS + &quot;ShortcutURL&quot;,</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineminus">-                 NC_NS + &quot;Description&quot;];</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineplus">+const BOOKMARK_ITEM = 0;</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineplus">+const BOOKMARK_FOLDER = 1;</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineplus">+const LIVEMARK_CONTAINER = 2;</span>
<a href="#l5.132"></a><span id="l5.132"> </span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-  gBookmarkID = window.arguments[0];</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineplus">+const ACTION_EDIT = 0;</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineplus">+const ACTION_ADD = 1;</span>
<a href="#l5.136"></a><span id="l5.136"> </span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-  var i;</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineminus">-  var resource = RDF.GetResource(gBookmarkID);</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-  // Initialize the properties panel by copying the values from the</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineminus">-  // RDF graph into the fields on screen.</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineplus">+var BookmarkPropertiesPanel = {</span>
<a href="#l5.142"></a><span id="l5.142"> </span>
<a href="#l5.143"></a><span id="l5.143" class="difflineminus">-  for (i = 0; i &lt; gFields.length; ++i) {</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineminus">-    var field = document.getElementById(gFields[i]);</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineminus">-</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineminus">-    var value = BMDS.GetTarget(resource, RDF.GetResource(gProperties[i]), true);</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineminus">-</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineminus">-    if (value)</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-      value = value.QueryInterface(Components.interfaces.nsIRDFLiteral).Value;</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineminus">-    if (value) //make sure were aren't stuffing null into any fields</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineminus">-      field.value = value;</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineminus">-  }</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineminus">-</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineminus">-  var nameNode = document.getElementById(&quot;name&quot;);</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineminus">-  document.title = document.title.replace(/\*\*bm_title\*\*/gi, nameNode.value);</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineplus">+  /** UI Text Strings */</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineplus">+  __strings: null,</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineplus">+  get _strings() {</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineplus">+    if (!this.__strings) {</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineplus">+      this.__strings = document.getElementById(&quot;stringBundle&quot;);</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineplus">+    }</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineplus">+    return this.__strings;</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineplus">+  },</span>
<a href="#l5.165"></a><span id="l5.165"> </span>
<a href="#l5.166"></a><span id="l5.166" class="difflineminus">-  // if its a container, disable some things</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineminus">-  var isContainerFlag = RDFCU.IsContainer(BMDS, resource);</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineminus">-  if (!isContainerFlag) {</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineminus">-    // XXX To do: the &quot;RDFCU.IsContainer&quot; call above only works for RDF sequences;</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineminus">-    //            if its not a RDF sequence, we should to more checking to see if</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineminus">-    //            the item in question is really a container of not.  A good example</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineminus">-    //            of this is the &quot;File System&quot; container.</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineminus">-  }</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineplus">+  _action: null,</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineplus">+  _itemType: null,</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineplus">+  _itemId: -1,</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineplus">+  _uri: null,</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineplus">+  _loadInSidebar: false,</span>
<a href="#l5.179"></a><span id="l5.179" class="difflineplus">+  _title: &quot;&quot;,</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineplus">+  _description: &quot;&quot;,</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineplus">+  _URIs: [],</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineplus">+  _keyword: &quot;&quot;,</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineplus">+  _postData: null,</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineplus">+  _charSet: &quot;&quot;,</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineplus">+  _feedURI: null,</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineplus">+  _siteURI: null,</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineplus">+</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineplus">+  _defaultInsertionPoint: null,</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineplus">+  _hiddenRows: [],</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineplus">+  _batching: false,</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineplus">+  _readOnly: false,</span>
<a href="#l5.192"></a><span id="l5.192"> </span>
<a href="#l5.193"></a><span id="l5.193" class="difflineminus">-  var isSeparator = BookmarksUtils.resolveType(resource) == &quot;BookmarkSeparator&quot;;</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineplus">+  /**</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineplus">+   * This method returns the correct label for the dialog's &quot;accept&quot;</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineplus">+   * button based on the variant of the dialog.</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineplus">+   */</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineplus">+  _getAcceptLabel: function BPP__getAcceptLabel() {</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineplus">+    if (this._action == ACTION_ADD) {</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineplus">+      if (this._URIs.length)</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineplus">+        return this._strings.getString(&quot;dialogAcceptLabelAddMulti&quot;);</span>
<a href="#l5.202"></a><span id="l5.202"> </span>
<a href="#l5.203"></a><span id="l5.203" class="difflineminus">-  if (isContainerFlag || isSeparator) {</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineminus">-    // If it is a folder, it has no URL or Keyword</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineminus">-    document.getElementById(&quot;locationrow&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineminus">-    document.getElementById(&quot;shortcutrow&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineminus">-    if (isSeparator) {</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineminus">-      document.getElementById(&quot;descriptionrow&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineplus">+      if (this._itemType == LIVEMARK_CONTAINER)</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineplus">+        return this._strings.getString(&quot;dialogAcceptLabelAddLivemark&quot;);</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineplus">+</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineplus">+      if (this._dummyItem || this._loadInSidebar)</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineplus">+        return this._strings.getString(&quot;dialogAcceptLabelAddItem&quot;);</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineplus">+</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineplus">+      return this._strings.getString(&quot;dialogAcceptLabelSaveItem&quot;);</span>
<a href="#l5.216"></a><span id="l5.216">     }</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineminus">-  }</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineplus">+    return this._strings.getString(&quot;dialogAcceptLabelEdit&quot;);</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineplus">+  },</span>
<a href="#l5.220"></a><span id="l5.220"> </span>
<a href="#l5.221"></a><span id="l5.221" class="difflineminus">-  var showScheduling = false;</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineminus">-  var url = BMDS.GetTarget(resource, RDF.GetResource(gProperties[1]), true);</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineminus">-  if (url) {</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineminus">-    url = url.QueryInterface(Components.interfaces.nsIRDFLiteral).Value;</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineminus">-    if (url.substr(0, 7).toLowerCase() == &quot;http://&quot; ||</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineminus">-        url.substr(0, 8).toLowerCase() == &quot;https://&quot;) {</span>
<a href="#l5.227"></a><span id="l5.227" class="difflineminus">-      showScheduling = true;</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineplus">+  /**</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineplus">+   * This method returns the correct title for the current variant</span>
<a href="#l5.230"></a><span id="l5.230" class="difflineplus">+   * of this dialog.</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineplus">+   */</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineplus">+  _getDialogTitle: function BPP__getDialogTitle() {</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineplus">+    if (this._action == ACTION_ADD) {</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineplus">+      if (this._itemType == BOOKMARK_ITEM)</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineplus">+        return this._strings.getString(&quot;dialogTitleAddBookmark&quot;);</span>
<a href="#l5.236"></a><span id="l5.236" class="difflineplus">+      if (this._itemType == LIVEMARK_CONTAINER)</span>
<a href="#l5.237"></a><span id="l5.237" class="difflineplus">+        return this._strings.getString(&quot;dialogTitleAddLivemark&quot;);</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineplus">+</span>
<a href="#l5.239"></a><span id="l5.239" class="difflineplus">+      // add folder</span>
<a href="#l5.240"></a><span id="l5.240" class="difflineplus">+      NS_ASSERT(this._itemType == BOOKMARK_FOLDER, &quot;Unknown item type&quot;);</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineplus">+      if (this._URIs.length)</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineplus">+        return this._strings.getString(&quot;dialogTitleAddMulti&quot;);</span>
<a href="#l5.243"></a><span id="l5.243" class="difflineplus">+</span>
<a href="#l5.244"></a><span id="l5.244" class="difflineplus">+      return this._strings.getString(&quot;dialogTitleAddFolder&quot;);</span>
<a href="#l5.245"></a><span id="l5.245">     }</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineminus">-  }</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineplus">+    if (this._action == ACTION_EDIT) {</span>
<a href="#l5.248"></a><span id="l5.248" class="difflineplus">+      return this._strings.getFormattedString(&quot;dialogTitleEdit&quot;, [this._title]);</span>
<a href="#l5.249"></a><span id="l5.249" class="difflineplus">+    }</span>
<a href="#l5.250"></a><span id="l5.250" class="difflineplus">+    return &quot;&quot;;</span>
<a href="#l5.251"></a><span id="l5.251" class="difflineplus">+  },</span>
<a href="#l5.252"></a><span id="l5.252"> </span>
<a href="#l5.253"></a><span id="l5.253" class="difflineminus">-  if (!showScheduling) {</span>
<a href="#l5.254"></a><span id="l5.254" class="difflineminus">-    // only allow scheduling of http/https URLs</span>
<a href="#l5.255"></a><span id="l5.255" class="difflineminus">-    document.getElementById(&quot;scheduling&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l5.256"></a><span id="l5.256" class="difflineminus">-  } else {</span>
<a href="#l5.257"></a><span id="l5.257" class="difflineminus">-    // check bookmark schedule</span>
<a href="#l5.258"></a><span id="l5.258" class="difflineminus">-    var scheduleArc = RDF.GetResource(&quot;http://home.netscape.com/WEB-rdf#Schedule&quot;);</span>
<a href="#l5.259"></a><span id="l5.259" class="difflineminus">-    value = BMDS.GetTarget(resource, scheduleArc, true);</span>
<a href="#l5.260"></a><span id="l5.260" class="difflineminus">-  </span>
<a href="#l5.261"></a><span id="l5.261" class="difflineminus">-    if (value) {</span>
<a href="#l5.262"></a><span id="l5.262" class="difflineminus">-      value = value.QueryInterface(Components.interfaces.nsIRDFLiteral).Value;</span>
<a href="#l5.263"></a><span id="l5.263" class="difflineminus">-  </span>
<a href="#l5.264"></a><span id="l5.264" class="difflineminus">-      if (value) {</span>
<a href="#l5.265"></a><span id="l5.265" class="difflineminus">-        var values = value.split(&quot;|&quot;);</span>
<a href="#l5.266"></a><span id="l5.266" class="difflineminus">-        if (values.length == 4) {</span>
<a href="#l5.267"></a><span id="l5.267" class="difflineminus">-          // get day range</span>
<a href="#l5.268"></a><span id="l5.268" class="difflineminus">-          var days = values[0];</span>
<a href="#l5.269"></a><span id="l5.269" class="difflineminus">-          var dayNode = document.getElementById(&quot;dayRange&quot;);</span>
<a href="#l5.270"></a><span id="l5.270" class="difflineminus">-          var dayItems = dayNode.childNodes[0].childNodes;</span>
<a href="#l5.271"></a><span id="l5.271" class="difflineminus">-          for (i=0; i &lt; dayItems.length; ++i) {</span>
<a href="#l5.272"></a><span id="l5.272" class="difflineminus">-            if (dayItems[i].getAttribute(&quot;value&quot;) == days) {</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineminus">-              dayNode.selectedItem = dayItems[i];</span>
<a href="#l5.274"></a><span id="l5.274" class="difflineminus">-              break;</span>
<a href="#l5.275"></a><span id="l5.275" class="difflineplus">+  /**</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineplus">+   * Determines the initial data for the item edited or added by this dialog</span>
<a href="#l5.277"></a><span id="l5.277" class="difflineplus">+   */</span>
<a href="#l5.278"></a><span id="l5.278" class="difflineplus">+  _determineItemInfo: function BPP__determineItemInfo() {</span>
<a href="#l5.279"></a><span id="l5.279" class="difflineplus">+    var dialogInfo = window.arguments[0];</span>
<a href="#l5.280"></a><span id="l5.280" class="difflineplus">+    this._action = dialogInfo.action == &quot;add&quot; ? ACTION_ADD : ACTION_EDIT;</span>
<a href="#l5.281"></a><span id="l5.281" class="difflineplus">+    this._hiddenRows = dialogInfo.hiddenRows ? dialogInfo.hiddenRows : [];</span>
<a href="#l5.282"></a><span id="l5.282" class="difflineplus">+    if (this._action == ACTION_ADD) {</span>
<a href="#l5.283"></a><span id="l5.283" class="difflineplus">+      NS_ASSERT(&quot;type&quot; in dialogInfo, &quot;missing type property for add action&quot;);</span>
<a href="#l5.284"></a><span id="l5.284" class="difflineplus">+</span>
<a href="#l5.285"></a><span id="l5.285" class="difflineplus">+      if (&quot;title&quot; in dialogInfo)</span>
<a href="#l5.286"></a><span id="l5.286" class="difflineplus">+        this._title = dialogInfo.title;</span>
<a href="#l5.287"></a><span id="l5.287" class="difflineplus">+</span>
<a href="#l5.288"></a><span id="l5.288" class="difflineplus">+      if (&quot;defaultInsertionPoint&quot; in dialogInfo) {</span>
<a href="#l5.289"></a><span id="l5.289" class="difflineplus">+        this._defaultInsertionPoint = dialogInfo.defaultInsertionPoint;</span>
<a href="#l5.290"></a><span id="l5.290" class="difflineplus">+      }</span>
<a href="#l5.291"></a><span id="l5.291" class="difflineplus">+      else</span>
<a href="#l5.292"></a><span id="l5.292" class="difflineplus">+        this._defaultInsertionPoint =</span>
<a href="#l5.293"></a><span id="l5.293" class="difflineplus">+          new InsertionPoint(PlacesUtils.bookmarksMenuFolderId,</span>
<a href="#l5.294"></a><span id="l5.294" class="difflineplus">+                             PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l5.295"></a><span id="l5.295" class="difflineplus">+                             Components.interfaces.nsITreeView.DROP_ON);</span>
<a href="#l5.296"></a><span id="l5.296" class="difflineplus">+</span>
<a href="#l5.297"></a><span id="l5.297" class="difflineplus">+      switch (dialogInfo.type) {</span>
<a href="#l5.298"></a><span id="l5.298" class="difflineplus">+        case &quot;bookmark&quot;:</span>
<a href="#l5.299"></a><span id="l5.299" class="difflineplus">+          this._itemType = BOOKMARK_ITEM;</span>
<a href="#l5.300"></a><span id="l5.300" class="difflineplus">+          if (&quot;uri&quot; in dialogInfo) {</span>
<a href="#l5.301"></a><span id="l5.301" class="difflineplus">+            NS_ASSERT(dialogInfo.uri instanceof Components.interfaces.nsIURI,</span>
<a href="#l5.302"></a><span id="l5.302" class="difflineplus">+                      &quot;uri property should be a uri object&quot;);</span>
<a href="#l5.303"></a><span id="l5.303" class="difflineplus">+            this._uri = dialogInfo.uri;</span>
<a href="#l5.304"></a><span id="l5.304" class="difflineplus">+            if (typeof(this._title) != &quot;string&quot;) {</span>
<a href="#l5.305"></a><span id="l5.305" class="difflineplus">+              this._title = this._getURITitleFromHistory(this._uri) ||</span>
<a href="#l5.306"></a><span id="l5.306" class="difflineplus">+                            this._uri.spec;</span>
<a href="#l5.307"></a><span id="l5.307">             }</span>
<a href="#l5.308"></a><span id="l5.308">           }</span>
<a href="#l5.309"></a><span id="l5.309" class="difflineminus">-          // Set up the enabled of controls on the scheduling panels</span>
<a href="#l5.310"></a><span id="l5.310" class="difflineminus">-          dayRangeChange(dayNode);</span>
<a href="#l5.311"></a><span id="l5.311" class="difflineminus">-  </span>
<a href="#l5.312"></a><span id="l5.312" class="difflineminus">-          // get hour range</span>
<a href="#l5.313"></a><span id="l5.313" class="difflineminus">-          var hours = values[1].split(&quot;-&quot;);</span>
<a href="#l5.314"></a><span id="l5.314" class="difflineminus">-          var startHour = &quot;&quot;;</span>
<a href="#l5.315"></a><span id="l5.315" class="difflineminus">-          var endHour = &quot;&quot;;</span>
<a href="#l5.316"></a><span id="l5.316" class="difflineminus">-  </span>
<a href="#l5.317"></a><span id="l5.317" class="difflineminus">-          if (hours.length == 2) {</span>
<a href="#l5.318"></a><span id="l5.318" class="difflineminus">-            startHour = hours[0];</span>
<a href="#l5.319"></a><span id="l5.319" class="difflineminus">-            endHour = hours[1];</span>
<a href="#l5.320"></a><span id="l5.320" class="difflineplus">+          else {</span>
<a href="#l5.321"></a><span id="l5.321" class="difflineplus">+            this._uri = PlacesUtils._uri(&quot;about:blank&quot;);</span>
<a href="#l5.322"></a><span id="l5.322" class="difflineplus">+            this._title = this._strings.getString(&quot;newBookmarkDefault&quot;);</span>
<a href="#l5.323"></a><span id="l5.323" class="difflineplus">+            this._dummyItem = true;</span>
<a href="#l5.324"></a><span id="l5.324">           }</span>
<a href="#l5.325"></a><span id="l5.325" class="difflineminus">-  </span>
<a href="#l5.326"></a><span id="l5.326" class="difflineminus">-          // set start hour</span>
<a href="#l5.327"></a><span id="l5.327" class="difflineminus">-          var startHourNode = document.getElementById(&quot;startHourRange&quot;);</span>
<a href="#l5.328"></a><span id="l5.328" class="difflineminus">-          var startHourItems = startHourNode.childNodes[0].childNodes;</span>
<a href="#l5.329"></a><span id="l5.329" class="difflineminus">-          for (i=0; i &lt; startHourItems.length; ++i) {</span>
<a href="#l5.330"></a><span id="l5.330" class="difflineminus">-            if (startHourItems[i].getAttribute(&quot;value&quot;) == startHour) {</span>
<a href="#l5.331"></a><span id="l5.331" class="difflineminus">-              startHourNode.selectedItem = startHourItems[i];</span>
<a href="#l5.332"></a><span id="l5.332" class="difflineminus">-              break;</span>
<a href="#l5.333"></a><span id="l5.333" class="difflineplus">+</span>
<a href="#l5.334"></a><span id="l5.334" class="difflineplus">+          if (&quot;loadBookmarkInSidebar&quot; in dialogInfo)</span>
<a href="#l5.335"></a><span id="l5.335" class="difflineplus">+            this._loadInSidebar = dialogInfo.loadBookmarkInSidebar;</span>
<a href="#l5.336"></a><span id="l5.336" class="difflineplus">+</span>
<a href="#l5.337"></a><span id="l5.337" class="difflineplus">+          if (&quot;keyword&quot; in dialogInfo) {</span>
<a href="#l5.338"></a><span id="l5.338" class="difflineplus">+            this._keyword = dialogInfo.keyword;</span>
<a href="#l5.339"></a><span id="l5.339" class="difflineplus">+            this._isAddKeywordDialog = true;</span>
<a href="#l5.340"></a><span id="l5.340" class="difflineplus">+            if (&quot;postData&quot; in dialogInfo)</span>
<a href="#l5.341"></a><span id="l5.341" class="difflineplus">+              this._postData = dialogInfo.postData;</span>
<a href="#l5.342"></a><span id="l5.342" class="difflineplus">+            if (&quot;charSet&quot; in dialogInfo)</span>
<a href="#l5.343"></a><span id="l5.343" class="difflineplus">+              this._charSet = dialogInfo.charSet;</span>
<a href="#l5.344"></a><span id="l5.344" class="difflineplus">+          }</span>
<a href="#l5.345"></a><span id="l5.345" class="difflineplus">+          break;</span>
<a href="#l5.346"></a><span id="l5.346" class="difflineplus">+</span>
<a href="#l5.347"></a><span id="l5.347" class="difflineplus">+        case &quot;folder&quot;:</span>
<a href="#l5.348"></a><span id="l5.348" class="difflineplus">+          this._itemType = BOOKMARK_FOLDER;</span>
<a href="#l5.349"></a><span id="l5.349" class="difflineplus">+          if (!this._title) {</span>
<a href="#l5.350"></a><span id="l5.350" class="difflineplus">+            if (&quot;URIList&quot; in dialogInfo) {</span>
<a href="#l5.351"></a><span id="l5.351" class="difflineplus">+              this._title = this._strings.getString(&quot;bookmarkAllTabsDefault&quot;);</span>
<a href="#l5.352"></a><span id="l5.352" class="difflineplus">+              this._URIs = dialogInfo.URIList;</span>
<a href="#l5.353"></a><span id="l5.353">             }</span>
<a href="#l5.354"></a><span id="l5.354" class="difflineplus">+            else</span>
<a href="#l5.355"></a><span id="l5.355" class="difflineplus">+              this._title = this._strings.getString(&quot;newFolderDefault&quot;);</span>
<a href="#l5.356"></a><span id="l5.356" class="difflineplus">+              this._dummyItem = true;</span>
<a href="#l5.357"></a><span id="l5.357">           }</span>
<a href="#l5.358"></a><span id="l5.358" class="difflineminus">-  </span>
<a href="#l5.359"></a><span id="l5.359" class="difflineminus">-          // set end hour</span>
<a href="#l5.360"></a><span id="l5.360" class="difflineminus">-          var endHourNode = document.getElementById(&quot;endHourRange&quot;);</span>
<a href="#l5.361"></a><span id="l5.361" class="difflineminus">-          var endHourItems = endHourNode.childNodes[0].childNodes;</span>
<a href="#l5.362"></a><span id="l5.362" class="difflineminus">-          for (i=0; i &lt; endHourItems.length; ++i) {</span>
<a href="#l5.363"></a><span id="l5.363" class="difflineminus">-            if (endHourItems[i].getAttribute(&quot;value&quot;) == endHour) {</span>
<a href="#l5.364"></a><span id="l5.364" class="difflineminus">-              endHourNode.selectedItem = endHourItems[i];</span>
<a href="#l5.365"></a><span id="l5.365" class="difflineminus">-              break;</span>
<a href="#l5.366"></a><span id="l5.366" class="difflineplus">+          break;</span>
<a href="#l5.367"></a><span id="l5.367" class="difflineplus">+</span>
<a href="#l5.368"></a><span id="l5.368" class="difflineplus">+        case &quot;livemark&quot;:</span>
<a href="#l5.369"></a><span id="l5.369" class="difflineplus">+          this._itemType = LIVEMARK_CONTAINER;</span>
<a href="#l5.370"></a><span id="l5.370" class="difflineplus">+          if (&quot;feedURI&quot; in dialogInfo)</span>
<a href="#l5.371"></a><span id="l5.371" class="difflineplus">+            this._feedURI = dialogInfo.feedURI;</span>
<a href="#l5.372"></a><span id="l5.372" class="difflineplus">+          if (&quot;siteURI&quot; in dialogInfo)</span>
<a href="#l5.373"></a><span id="l5.373" class="difflineplus">+            this._siteURI = dialogInfo.siteURI;</span>
<a href="#l5.374"></a><span id="l5.374" class="difflineplus">+</span>
<a href="#l5.375"></a><span id="l5.375" class="difflineplus">+          if (!this._title) {</span>
<a href="#l5.376"></a><span id="l5.376" class="difflineplus">+            if (this._feedURI) {</span>
<a href="#l5.377"></a><span id="l5.377" class="difflineplus">+              this._title = this._getURITitleFromHistory(this._feedURI) ||</span>
<a href="#l5.378"></a><span id="l5.378" class="difflineplus">+                            this._feedURI.spec;</span>
<a href="#l5.379"></a><span id="l5.379">             }</span>
<a href="#l5.380"></a><span id="l5.380" class="difflineplus">+            else</span>
<a href="#l5.381"></a><span id="l5.381" class="difflineplus">+              this._title = this._strings.getString(&quot;newLivemarkDefault&quot;);</span>
<a href="#l5.382"></a><span id="l5.382">           }</span>
<a href="#l5.383"></a><span id="l5.383" class="difflineminus">-  </span>
<a href="#l5.384"></a><span id="l5.384" class="difflineminus">-          // get duration</span>
<a href="#l5.385"></a><span id="l5.385" class="difflineminus">-          var duration = values[2];</span>
<a href="#l5.386"></a><span id="l5.386" class="difflineminus">-          var durationNode = document.getElementById(&quot;duration&quot;);</span>
<a href="#l5.387"></a><span id="l5.387" class="difflineminus">-          durationNode.value = duration;</span>
<a href="#l5.388"></a><span id="l5.388" class="difflineminus">-  </span>
<a href="#l5.389"></a><span id="l5.389" class="difflineminus">-          // get notification method</span>
<a href="#l5.390"></a><span id="l5.390" class="difflineminus">-          var method = values[3];</span>
<a href="#l5.391"></a><span id="l5.391" class="difflineminus">-          if (method.indexOf(&quot;icon&quot;) &gt;= 0)</span>
<a href="#l5.392"></a><span id="l5.392" class="difflineminus">-            document.getElementById(&quot;bookmarkIcon&quot;).checked = true;</span>
<a href="#l5.393"></a><span id="l5.393" class="difflineminus">-  </span>
<a href="#l5.394"></a><span id="l5.394" class="difflineminus">-          if (method.indexOf(&quot;sound&quot;) &gt;= 0)</span>
<a href="#l5.395"></a><span id="l5.395" class="difflineminus">-            document.getElementById(&quot;playSound&quot;).checked = true;</span>
<a href="#l5.396"></a><span id="l5.396" class="difflineminus">-  </span>
<a href="#l5.397"></a><span id="l5.397" class="difflineminus">-          if (method.indexOf(&quot;alert&quot;) &gt;= 0)</span>
<a href="#l5.398"></a><span id="l5.398" class="difflineminus">-            document.getElementById(&quot;showAlert&quot;).checked = true;</span>
<a href="#l5.399"></a><span id="l5.399" class="difflineminus">-  </span>
<a href="#l5.400"></a><span id="l5.400" class="difflineminus">-          if (method.indexOf(&quot;open&quot;) &gt;= 0)</span>
<a href="#l5.401"></a><span id="l5.401" class="difflineminus">-            document.getElementById(&quot;openWindow&quot;).checked = true;</span>
<a href="#l5.402"></a><span id="l5.402" class="difflineminus">-        }</span>
<a href="#l5.403"></a><span id="l5.403" class="difflineplus">+      }</span>
<a href="#l5.404"></a><span id="l5.404" class="difflineplus">+</span>
<a href="#l5.405"></a><span id="l5.405" class="difflineplus">+      if (&quot;description&quot; in dialogInfo)</span>
<a href="#l5.406"></a><span id="l5.406" class="difflineplus">+        this._description = dialogInfo.description;</span>
<a href="#l5.407"></a><span id="l5.407" class="difflineplus">+    }</span>
<a href="#l5.408"></a><span id="l5.408" class="difflineplus">+    else { // edit</span>
<a href="#l5.409"></a><span id="l5.409" class="difflineplus">+      NS_ASSERT(&quot;itemId&quot; in dialogInfo);</span>
<a href="#l5.410"></a><span id="l5.410" class="difflineplus">+      this._itemId = dialogInfo.itemId;</span>
<a href="#l5.411"></a><span id="l5.411" class="difflineplus">+      this._title = PlacesUtils.bookmarks.getItemTitle(this._itemId);</span>
<a href="#l5.412"></a><span id="l5.412" class="difflineplus">+      // Don't show folderPicker when editing</span>
<a href="#l5.413"></a><span id="l5.413" class="difflineplus">+      this._hiddenRows.push(&quot;folderPicker&quot;);</span>
<a href="#l5.414"></a><span id="l5.414" class="difflineplus">+      this._readOnly = !!dialogInfo.readOnly;</span>
<a href="#l5.415"></a><span id="l5.415" class="difflineplus">+</span>
<a href="#l5.416"></a><span id="l5.416" class="difflineplus">+      switch (dialogInfo.type) {</span>
<a href="#l5.417"></a><span id="l5.417" class="difflineplus">+        case &quot;bookmark&quot;:</span>
<a href="#l5.418"></a><span id="l5.418" class="difflineplus">+          this._itemType = BOOKMARK_ITEM;</span>
<a href="#l5.419"></a><span id="l5.419" class="difflineplus">+</span>
<a href="#l5.420"></a><span id="l5.420" class="difflineplus">+          this._uri = PlacesUtils.bookmarks.getBookmarkURI(this._itemId);</span>
<a href="#l5.421"></a><span id="l5.421" class="difflineplus">+          // keyword</span>
<a href="#l5.422"></a><span id="l5.422" class="difflineplus">+          this._keyword = PlacesUtils.bookmarks</span>
<a href="#l5.423"></a><span id="l5.423" class="difflineplus">+                                     .getKeywordForBookmark(this._itemId);</span>
<a href="#l5.424"></a><span id="l5.424" class="difflineplus">+          // Load In Sidebar</span>
<a href="#l5.425"></a><span id="l5.425" class="difflineplus">+          this._loadInSidebar = PlacesUtils.annotations</span>
<a href="#l5.426"></a><span id="l5.426" class="difflineplus">+                                           .itemHasAnnotation(this._itemId,</span>
<a href="#l5.427"></a><span id="l5.427" class="difflineplus">+                                                              PlacesUIUtils.LOAD_IN_SIDEBAR_ANNO);</span>
<a href="#l5.428"></a><span id="l5.428" class="difflineplus">+          break;</span>
<a href="#l5.429"></a><span id="l5.429" class="difflineplus">+</span>
<a href="#l5.430"></a><span id="l5.430" class="difflineplus">+        case &quot;folder&quot;:</span>
<a href="#l5.431"></a><span id="l5.431" class="difflineplus">+          if (PlacesUtils.itemIsLivemark(this._itemId)) {</span>
<a href="#l5.432"></a><span id="l5.432" class="difflineplus">+            this._itemType = LIVEMARK_CONTAINER;</span>
<a href="#l5.433"></a><span id="l5.433" class="difflineplus">+            this._feedURI = PlacesUtils.livemarks.getFeedURI(this._itemId);</span>
<a href="#l5.434"></a><span id="l5.434" class="difflineplus">+            this._siteURI = PlacesUtils.livemarks.getSiteURI(this._itemId);</span>
<a href="#l5.435"></a><span id="l5.435" class="difflineplus">+          }</span>
<a href="#l5.436"></a><span id="l5.436" class="difflineplus">+          else</span>
<a href="#l5.437"></a><span id="l5.437" class="difflineplus">+            this._itemType = BOOKMARK_FOLDER;</span>
<a href="#l5.438"></a><span id="l5.438" class="difflineplus">+          break;</span>
<a href="#l5.439"></a><span id="l5.439" class="difflineplus">+      }</span>
<a href="#l5.440"></a><span id="l5.440" class="difflineplus">+</span>
<a href="#l5.441"></a><span id="l5.441" class="difflineplus">+      // Description</span>
<a href="#l5.442"></a><span id="l5.442" class="difflineplus">+      if (PlacesUtils.annotations</span>
<a href="#l5.443"></a><span id="l5.443" class="difflineplus">+                     .itemHasAnnotation(this._itemId, PlacesUIUtils.DESCRIPTION_ANNO)) {</span>
<a href="#l5.444"></a><span id="l5.444" class="difflineplus">+        this._description = PlacesUtils.annotations</span>
<a href="#l5.445"></a><span id="l5.445" class="difflineplus">+                                       .getItemAnnotation(this._itemId,</span>
<a href="#l5.446"></a><span id="l5.446" class="difflineplus">+                                                          PlacesUIUtils.DESCRIPTION_ANNO);</span>
<a href="#l5.447"></a><span id="l5.447">       }</span>
<a href="#l5.448"></a><span id="l5.448">     }</span>
<a href="#l5.449"></a><span id="l5.449" class="difflineminus">-  }</span>
<a href="#l5.450"></a><span id="l5.450" class="difflineplus">+  },</span>
<a href="#l5.451"></a><span id="l5.451"> </span>
<a href="#l5.452"></a><span id="l5.452" class="difflineminus">-  sizeToContent();</span>
<a href="#l5.453"></a><span id="l5.453" class="difflineminus">-  </span>
<a href="#l5.454"></a><span id="l5.454" class="difflineminus">-  // set initial focus</span>
<a href="#l5.455"></a><span id="l5.455" class="difflineminus">-  nameNode.focus();</span>
<a href="#l5.456"></a><span id="l5.456" class="difflineminus">-  nameNode.select();</span>
<a href="#l5.457"></a><span id="l5.457" class="difflineminus">-</span>
<a href="#l5.458"></a><span id="l5.458" class="difflineminus">-}</span>
<a href="#l5.459"></a><span id="l5.459" class="difflineplus">+  /**</span>
<a href="#l5.460"></a><span id="l5.460" class="difflineplus">+   * This method returns the title string corresponding to a given URI.</span>
<a href="#l5.461"></a><span id="l5.461" class="difflineplus">+   * If none is available from the bookmark service (probably because</span>
<a href="#l5.462"></a><span id="l5.462" class="difflineplus">+   * the given URI doesn't appear in bookmarks or history), we synthesize</span>
<a href="#l5.463"></a><span id="l5.463" class="difflineplus">+   * a title from the first 100 characters of the URI.</span>
<a href="#l5.464"></a><span id="l5.464" class="difflineplus">+   *</span>
<a href="#l5.465"></a><span id="l5.465" class="difflineplus">+   * @param aURI</span>
<a href="#l5.466"></a><span id="l5.466" class="difflineplus">+   *        nsIURI object for which we want the title</span>
<a href="#l5.467"></a><span id="l5.467" class="difflineplus">+   *</span>
<a href="#l5.468"></a><span id="l5.468" class="difflineplus">+   * @returns a title string</span>
<a href="#l5.469"></a><span id="l5.469" class="difflineplus">+   */</span>
<a href="#l5.470"></a><span id="l5.470" class="difflineplus">+  _getURITitleFromHistory: function BPP__getURITitleFromHistory(aURI) {</span>
<a href="#l5.471"></a><span id="l5.471" class="difflineplus">+    NS_ASSERT(aURI instanceof Components.interfaces.nsIURI);</span>
<a href="#l5.472"></a><span id="l5.472"> </span>
<a href="#l5.473"></a><span id="l5.473" class="difflineminus">-</span>
<a href="#l5.474"></a><span id="l5.474" class="difflineminus">-function Commit()</span>
<a href="#l5.475"></a><span id="l5.475" class="difflineminus">-{</span>
<a href="#l5.476"></a><span id="l5.476" class="difflineminus">-  var changed = false;</span>
<a href="#l5.477"></a><span id="l5.477" class="difflineplus">+    // get the title from History</span>
<a href="#l5.478"></a><span id="l5.478" class="difflineplus">+    return PlacesUtils.history.getPageTitle(aURI);</span>
<a href="#l5.479"></a><span id="l5.479" class="difflineplus">+  },</span>
<a href="#l5.480"></a><span id="l5.480"> </span>
<a href="#l5.481"></a><span id="l5.481" class="difflineminus">-  // Grovel through the fields to see if any of the values have</span>
<a href="#l5.482"></a><span id="l5.482" class="difflineminus">-  // changed. If so, update the RDF graph and force them to be saved</span>
<a href="#l5.483"></a><span id="l5.483" class="difflineminus">-  // to disk.</span>
<a href="#l5.484"></a><span id="l5.484" class="difflineminus">-  for (var i = 0; i &lt; gFields.length; ++i) {</span>
<a href="#l5.485"></a><span id="l5.485" class="difflineminus">-    var field = document.getElementById(gFields[i]);</span>
<a href="#l5.486"></a><span id="l5.486" class="difflineplus">+  /**</span>
<a href="#l5.487"></a><span id="l5.487" class="difflineplus">+   * This method should be called by the onload of the Bookmark Properties</span>
<a href="#l5.488"></a><span id="l5.488" class="difflineplus">+   * dialog to initialize the state of the panel.</span>
<a href="#l5.489"></a><span id="l5.489" class="difflineplus">+   */</span>
<a href="#l5.490"></a><span id="l5.490" class="difflineplus">+  onDialogLoad: function BPP_onDialogLoad() {</span>
<a href="#l5.491"></a><span id="l5.491" class="difflineplus">+    this._determineItemInfo();</span>
<a href="#l5.492"></a><span id="l5.492" class="difflineplus">+</span>
<a href="#l5.493"></a><span id="l5.493" class="difflineplus">+    document.title = this._getDialogTitle();</span>
<a href="#l5.494"></a><span id="l5.494" class="difflineplus">+    var acceptButton = document.documentElement.getButton(&quot;accept&quot;);</span>
<a href="#l5.495"></a><span id="l5.495" class="difflineplus">+    acceptButton.label = this._getAcceptLabel();</span>
<a href="#l5.496"></a><span id="l5.496" class="difflineplus">+</span>
<a href="#l5.497"></a><span id="l5.497" class="difflineplus">+    this._beginBatch();</span>
<a href="#l5.498"></a><span id="l5.498"> </span>
<a href="#l5.499"></a><span id="l5.499" class="difflineminus">-    if (field) {</span>
<a href="#l5.500"></a><span id="l5.500" class="difflineminus">-      // Get the new value as a literal, using 'null' if the value is empty.</span>
<a href="#l5.501"></a><span id="l5.501" class="difflineminus">-      var newvalue = field.value;</span>
<a href="#l5.502"></a><span id="l5.502" class="difflineminus">-</span>
<a href="#l5.503"></a><span id="l5.503" class="difflineminus">-      var oldvalue = BMDS.GetTarget(RDF.GetResource(gBookmarkID),</span>
<a href="#l5.504"></a><span id="l5.504" class="difflineminus">-                                    RDF.GetResource(gProperties[i]), true);</span>
<a href="#l5.505"></a><span id="l5.505" class="difflineminus">-</span>
<a href="#l5.506"></a><span id="l5.506" class="difflineminus">-      if (oldvalue)</span>
<a href="#l5.507"></a><span id="l5.507" class="difflineminus">-        oldvalue = oldvalue.QueryInterface(Components.interfaces.nsIRDFLiteral);</span>
<a href="#l5.508"></a><span id="l5.508" class="difflineplus">+    switch (this._action) {</span>
<a href="#l5.509"></a><span id="l5.509" class="difflineplus">+      case ACTION_EDIT:</span>
<a href="#l5.510"></a><span id="l5.510" class="difflineplus">+        this._fillEditProperties();</span>
<a href="#l5.511"></a><span id="l5.511" class="difflineplus">+        acceptButton.disabled = this._readOnly;</span>
<a href="#l5.512"></a><span id="l5.512" class="difflineplus">+        break;</span>
<a href="#l5.513"></a><span id="l5.513" class="difflineplus">+      case ACTION_ADD:</span>
<a href="#l5.514"></a><span id="l5.514" class="difflineplus">+        this._fillAddProperties();</span>
<a href="#l5.515"></a><span id="l5.515" class="difflineplus">+        // if this is an uri related dialog disable accept button until</span>
<a href="#l5.516"></a><span id="l5.516" class="difflineplus">+        // the user fills an uri value.</span>
<a href="#l5.517"></a><span id="l5.517" class="difflineplus">+        if (this._itemType == BOOKMARK_ITEM ||</span>
<a href="#l5.518"></a><span id="l5.518" class="difflineplus">+            this._itemType == LIVEMARK_CONTAINER)</span>
<a href="#l5.519"></a><span id="l5.519" class="difflineplus">+          acceptButton.disabled = !this._inputIsValid();</span>
<a href="#l5.520"></a><span id="l5.520" class="difflineplus">+        break;</span>
<a href="#l5.521"></a><span id="l5.521" class="difflineplus">+    }</span>
<a href="#l5.522"></a><span id="l5.522"> </span>
<a href="#l5.523"></a><span id="l5.523" class="difflineminus">-      if (newvalue &amp;&amp; gProperties[i] == (NC_NS + &quot;ShortcutURL&quot;)) {</span>
<a href="#l5.524"></a><span id="l5.524" class="difflineminus">-        // shortcuts are always lowercased internally</span>
<a href="#l5.525"></a><span id="l5.525" class="difflineminus">-        newvalue = newvalue.toLowerCase();</span>
<a href="#l5.526"></a><span id="l5.526" class="difflineplus">+    // When collapsible elements change their collapsed attribute we must</span>
<a href="#l5.527"></a><span id="l5.527" class="difflineplus">+    // resize the dialog.</span>
<a href="#l5.528"></a><span id="l5.528" class="difflineplus">+    // sizeToContent is not usable due to bug 90276, so we'll use resizeTo</span>
<a href="#l5.529"></a><span id="l5.529" class="difflineplus">+    // instead and cache the element size. See WSucks in the legacy</span>
<a href="#l5.530"></a><span id="l5.530" class="difflineplus">+    // UI code (addBookmark2.js).</span>
<a href="#l5.531"></a><span id="l5.531" class="difflineplus">+    if (!this._element(&quot;tagsRow&quot;).collapsed) {</span>
<a href="#l5.532"></a><span id="l5.532" class="difflineplus">+      this._element(&quot;tagsSelectorRow&quot;)</span>
<a href="#l5.533"></a><span id="l5.533" class="difflineplus">+          .addEventListener(&quot;DOMAttrModified&quot;, this, false);</span>
<a href="#l5.534"></a><span id="l5.534" class="difflineplus">+    }</span>
<a href="#l5.535"></a><span id="l5.535" class="difflineplus">+    if (!this._element(&quot;folderRow&quot;).collapsed) {</span>
<a href="#l5.536"></a><span id="l5.536" class="difflineplus">+      this._element(&quot;folderTreeRow&quot;)</span>
<a href="#l5.537"></a><span id="l5.537" class="difflineplus">+          .addEventListener(&quot;DOMAttrModified&quot;, this, false);</span>
<a href="#l5.538"></a><span id="l5.538" class="difflineplus">+    }</span>
<a href="#l5.539"></a><span id="l5.539" class="difflineplus">+</span>
<a href="#l5.540"></a><span id="l5.540" class="difflineplus">+    if (!this._readOnly) {</span>
<a href="#l5.541"></a><span id="l5.541" class="difflineplus">+      // Listen on uri fields to enable accept button if input is valid</span>
<a href="#l5.542"></a><span id="l5.542" class="difflineplus">+      if (this._itemType == BOOKMARK_ITEM) {</span>
<a href="#l5.543"></a><span id="l5.543" class="difflineplus">+        this._element(&quot;locationField&quot;)</span>
<a href="#l5.544"></a><span id="l5.544" class="difflineplus">+            .addEventListener(&quot;input&quot;, this, false);</span>
<a href="#l5.545"></a><span id="l5.545" class="difflineplus">+        if (this._isAddKeywordDialog) {</span>
<a href="#l5.546"></a><span id="l5.546" class="difflineplus">+          this._element(&quot;keywordField&quot;)</span>
<a href="#l5.547"></a><span id="l5.547" class="difflineplus">+              .addEventListener(&quot;input&quot;, this, false);</span>
<a href="#l5.548"></a><span id="l5.548" class="difflineplus">+        }</span>
<a href="#l5.549"></a><span id="l5.549">       }</span>
<a href="#l5.550"></a><span id="l5.550" class="difflineminus">-      else if (newvalue &amp;&amp; gProperties[i] == (NC_NS + &quot;URL&quot;)) {</span>
<a href="#l5.551"></a><span id="l5.551" class="difflineminus">-        // we're dealing with the URL attribute;</span>
<a href="#l5.552"></a><span id="l5.552" class="difflineminus">-        // if a scheme isn't specified, use &quot;http://&quot;</span>
<a href="#l5.553"></a><span id="l5.553" class="difflineminus">-        if (newvalue.indexOf(&quot;:&quot;) &lt; 0)</span>
<a href="#l5.554"></a><span id="l5.554" class="difflineminus">-          newvalue = &quot;http://&quot; + newvalue;</span>
<a href="#l5.555"></a><span id="l5.555" class="difflineminus">-      }</span>
<a href="#l5.556"></a><span id="l5.556" class="difflineminus">-</span>
<a href="#l5.557"></a><span id="l5.557" class="difflineminus">-      if (newvalue)</span>
<a href="#l5.558"></a><span id="l5.558" class="difflineminus">-        newvalue = RDF.GetLiteral(newvalue);</span>
<a href="#l5.559"></a><span id="l5.559" class="difflineminus">-</span>
<a href="#l5.560"></a><span id="l5.560" class="difflineminus">-      if (updateAttribute(gProperties[i], oldvalue, newvalue)) {</span>
<a href="#l5.561"></a><span id="l5.561" class="difflineminus">-        changed = true;</span>
<a href="#l5.562"></a><span id="l5.562" class="difflineplus">+      else if (this._itemType == LIVEMARK_CONTAINER) {</span>
<a href="#l5.563"></a><span id="l5.563" class="difflineplus">+        this._element(&quot;feedLocationField&quot;)</span>
<a href="#l5.564"></a><span id="l5.564" class="difflineplus">+            .addEventListener(&quot;input&quot;, this, false);</span>
<a href="#l5.565"></a><span id="l5.565" class="difflineplus">+        this._element(&quot;siteLocationField&quot;)</span>
<a href="#l5.566"></a><span id="l5.566" class="difflineplus">+            .addEventListener(&quot;input&quot;, this, false);</span>
<a href="#l5.567"></a><span id="l5.567">       }</span>
<a href="#l5.568"></a><span id="l5.568">     }</span>
<a href="#l5.569"></a><span id="l5.569" class="difflineminus">-  }</span>
<a href="#l5.570"></a><span id="l5.570" class="difflineplus">+</span>
<a href="#l5.571"></a><span id="l5.571" class="difflineplus">+    window.sizeToContent();</span>
<a href="#l5.572"></a><span id="l5.572" class="difflineplus">+  },</span>
<a href="#l5.573"></a><span id="l5.573" class="difflineplus">+</span>
<a href="#l5.574"></a><span id="l5.574" class="difflineplus">+  // nsIDOMEventListener</span>
<a href="#l5.575"></a><span id="l5.575" class="difflineplus">+  _elementsHeight: [],</span>
<a href="#l5.576"></a><span id="l5.576" class="difflineplus">+  handleEvent: function BPP_handleEvent(aEvent) {</span>
<a href="#l5.577"></a><span id="l5.577" class="difflineplus">+    var target = aEvent.target;</span>
<a href="#l5.578"></a><span id="l5.578" class="difflineplus">+    switch (aEvent.type) {</span>
<a href="#l5.579"></a><span id="l5.579" class="difflineplus">+      case &quot;input&quot;:</span>
<a href="#l5.580"></a><span id="l5.580" class="difflineplus">+        if (target.id == &quot;editBMPanel_locationField&quot; ||</span>
<a href="#l5.581"></a><span id="l5.581" class="difflineplus">+            target.id == &quot;editBMPanel_feedLocationField&quot; ||</span>
<a href="#l5.582"></a><span id="l5.582" class="difflineplus">+            target.id == &quot;editBMPanel_siteLocationField&quot; ||</span>
<a href="#l5.583"></a><span id="l5.583" class="difflineplus">+            target.id == &quot;editBMPanel_keywordField&quot;) {</span>
<a href="#l5.584"></a><span id="l5.584" class="difflineplus">+          // Check uri fields to enable accept button if input is valid</span>
<a href="#l5.585"></a><span id="l5.585" class="difflineplus">+          document.documentElement</span>
<a href="#l5.586"></a><span id="l5.586" class="difflineplus">+                  .getButton(&quot;accept&quot;).disabled = !this._inputIsValid();</span>
<a href="#l5.587"></a><span id="l5.587" class="difflineplus">+        }</span>
<a href="#l5.588"></a><span id="l5.588" class="difflineplus">+        break;</span>
<a href="#l5.589"></a><span id="l5.589"> </span>
<a href="#l5.590"></a><span id="l5.590" class="difflineminus">-  // Update bookmark schedule if necessary;</span>
<a href="#l5.591"></a><span id="l5.591" class="difflineminus">-  // if the tab was removed, just skip it</span>
<a href="#l5.592"></a><span id="l5.592" class="difflineminus">-  var scheduling = document.getElementById(&quot;scheduling&quot;);</span>
<a href="#l5.593"></a><span id="l5.593" class="difflineminus">-  var schedulingHidden = scheduling.getAttribute(&quot;hidden&quot;);</span>
<a href="#l5.594"></a><span id="l5.594" class="difflineminus">-  if (schedulingHidden != &quot;true&quot;) {</span>
<a href="#l5.595"></a><span id="l5.595" class="difflineminus">-    var scheduleRes = &quot;http://home.netscape.com/WEB-rdf#Schedule&quot;;</span>
<a href="#l5.596"></a><span id="l5.596" class="difflineminus">-    oldvalue = BMDS.GetTarget(RDF.GetResource(gBookmarkID),</span>
<a href="#l5.597"></a><span id="l5.597" class="difflineminus">-                              RDF.GetResource(scheduleRes), true);</span>
<a href="#l5.598"></a><span id="l5.598" class="difflineminus">-    newvalue = &quot;&quot;;</span>
<a href="#l5.599"></a><span id="l5.599" class="difflineminus">-    var dayRangeNode = document.getElementById(&quot;dayRange&quot;);</span>
<a href="#l5.600"></a><span id="l5.600" class="difflineminus">-    var dayRange = dayRangeNode.selectedItem.getAttribute(&quot;value&quot;);</span>
<a href="#l5.601"></a><span id="l5.601" class="difflineplus">+      case &quot;DOMAttrModified&quot;:</span>
<a href="#l5.602"></a><span id="l5.602" class="difflineplus">+        // this is called when collapsing a node, but also its direct children,</span>
<a href="#l5.603"></a><span id="l5.603" class="difflineplus">+        // we only need to resize when the original node changes.</span>
<a href="#l5.604"></a><span id="l5.604" class="difflineplus">+        if ((target.id == &quot;editBMPanel_tagsSelectorRow&quot; ||</span>
<a href="#l5.605"></a><span id="l5.605" class="difflineplus">+             target.id == &quot;editBMPanel_folderTreeRow&quot;) &amp;&amp;</span>
<a href="#l5.606"></a><span id="l5.606" class="difflineplus">+            aEvent.attrName == &quot;collapsed&quot; &amp;&amp;</span>
<a href="#l5.607"></a><span id="l5.607" class="difflineplus">+            target == aEvent.originalTarget) {</span>
<a href="#l5.608"></a><span id="l5.608" class="difflineplus">+          var id = target.id;</span>
<a href="#l5.609"></a><span id="l5.609" class="difflineplus">+          var newHeight = window.outerHeight;</span>
<a href="#l5.610"></a><span id="l5.610" class="difflineplus">+          if (aEvent.newValue) // is collapsed</span>
<a href="#l5.611"></a><span id="l5.611" class="difflineplus">+            newHeight -= this._elementsHeight[id];</span>
<a href="#l5.612"></a><span id="l5.612" class="difflineplus">+          else {</span>
<a href="#l5.613"></a><span id="l5.613" class="difflineplus">+            this._elementsHeight[id] = target.boxObject.height;</span>
<a href="#l5.614"></a><span id="l5.614" class="difflineplus">+            newHeight += this._elementsHeight[id];</span>
<a href="#l5.615"></a><span id="l5.615" class="difflineplus">+          }</span>
<a href="#l5.616"></a><span id="l5.616" class="difflineplus">+</span>
<a href="#l5.617"></a><span id="l5.617" class="difflineplus">+          window.resizeTo(window.outerWidth, newHeight);</span>
<a href="#l5.618"></a><span id="l5.618" class="difflineplus">+        }</span>
<a href="#l5.619"></a><span id="l5.619" class="difflineplus">+        break;</span>
<a href="#l5.620"></a><span id="l5.620" class="difflineplus">+    }</span>
<a href="#l5.621"></a><span id="l5.621" class="difflineplus">+  },</span>
<a href="#l5.622"></a><span id="l5.622"> </span>
<a href="#l5.623"></a><span id="l5.623" class="difflineminus">-    if (dayRange) {</span>
<a href="#l5.624"></a><span id="l5.624" class="difflineminus">-      var startHourRangeNode = document.getElementById(&quot;startHourRange&quot;);</span>
<a href="#l5.625"></a><span id="l5.625" class="difflineminus">-      var startHourRange = startHourRangeNode.selectedItem.getAttribute(&quot;value&quot;);</span>
<a href="#l5.626"></a><span id="l5.626" class="difflineplus">+  _beginBatch: function BPP__beginBatch() {</span>
<a href="#l5.627"></a><span id="l5.627" class="difflineplus">+    if (this._batching)</span>
<a href="#l5.628"></a><span id="l5.628" class="difflineplus">+      return;</span>
<a href="#l5.629"></a><span id="l5.629" class="difflineplus">+</span>
<a href="#l5.630"></a><span id="l5.630" class="difflineplus">+    PlacesUIUtils.ptm.beginBatch();</span>
<a href="#l5.631"></a><span id="l5.631" class="difflineplus">+    this._batching = true;</span>
<a href="#l5.632"></a><span id="l5.632" class="difflineplus">+  },</span>
<a href="#l5.633"></a><span id="l5.633"> </span>
<a href="#l5.634"></a><span id="l5.634" class="difflineminus">-      var endHourRangeNode = document.getElementById(&quot;endHourRange&quot;);</span>
<a href="#l5.635"></a><span id="l5.635" class="difflineminus">-      var endHourRange = endHourRangeNode.selectedItem.getAttribute(&quot;value&quot;);</span>
<a href="#l5.636"></a><span id="l5.636" class="difflineplus">+  _endBatch: function BPP__endBatch() {</span>
<a href="#l5.637"></a><span id="l5.637" class="difflineplus">+    if (!this._batching)</span>
<a href="#l5.638"></a><span id="l5.638" class="difflineplus">+      return;</span>
<a href="#l5.639"></a><span id="l5.639" class="difflineplus">+</span>
<a href="#l5.640"></a><span id="l5.640" class="difflineplus">+    PlacesUIUtils.ptm.endBatch();</span>
<a href="#l5.641"></a><span id="l5.641" class="difflineplus">+    this._batching = false;</span>
<a href="#l5.642"></a><span id="l5.642" class="difflineplus">+  },</span>
<a href="#l5.643"></a><span id="l5.643" class="difflineplus">+</span>
<a href="#l5.644"></a><span id="l5.644" class="difflineplus">+  _fillEditProperties: function BPP__fillEditProperties() {</span>
<a href="#l5.645"></a><span id="l5.645" class="difflineplus">+    gEditItemOverlay.initPanel(this._itemId,</span>
<a href="#l5.646"></a><span id="l5.646" class="difflineplus">+                               { hiddenRows: this._hiddenRows,</span>
<a href="#l5.647"></a><span id="l5.647" class="difflineplus">+                                 forceReadOnly: this._readOnly });</span>
<a href="#l5.648"></a><span id="l5.648" class="difflineplus">+  },</span>
<a href="#l5.649"></a><span id="l5.649"> </span>
<a href="#l5.650"></a><span id="l5.650" class="difflineminus">-      if (parseInt(startHourRange) &gt; parseInt(endHourRange)) {</span>
<a href="#l5.651"></a><span id="l5.651" class="difflineminus">-        var temp = startHourRange;</span>
<a href="#l5.652"></a><span id="l5.652" class="difflineminus">-        startHourRange = endHourRange;</span>
<a href="#l5.653"></a><span id="l5.653" class="difflineminus">-        endHourRange = temp;</span>
<a href="#l5.654"></a><span id="l5.654" class="difflineminus">-      }</span>
<a href="#l5.655"></a><span id="l5.655" class="difflineplus">+  _fillAddProperties: function BPP__fillAddProperties() {</span>
<a href="#l5.656"></a><span id="l5.656" class="difflineplus">+    this._createNewItem();</span>
<a href="#l5.657"></a><span id="l5.657" class="difflineplus">+    // Edit the new item</span>
<a href="#l5.658"></a><span id="l5.658" class="difflineplus">+    gEditItemOverlay.initPanel(this._itemId,</span>
<a href="#l5.659"></a><span id="l5.659" class="difflineplus">+                               { hiddenRows: this._hiddenRows });</span>
<a href="#l5.660"></a><span id="l5.660" class="difflineplus">+    // Empty location field if the uri is about:blank, this way inserting a new</span>
<a href="#l5.661"></a><span id="l5.661" class="difflineplus">+    // url will be easier for the user, Accept button will be automatically</span>
<a href="#l5.662"></a><span id="l5.662" class="difflineplus">+    // disabled by the input listener until the user fills the field.</span>
<a href="#l5.663"></a><span id="l5.663" class="difflineplus">+    var locationField = this._element(&quot;locationField&quot;);</span>
<a href="#l5.664"></a><span id="l5.664" class="difflineplus">+    if (locationField.value == &quot;about:blank&quot;)</span>
<a href="#l5.665"></a><span id="l5.665" class="difflineplus">+      locationField.value = &quot;&quot;;</span>
<a href="#l5.666"></a><span id="l5.666" class="difflineplus">+  },</span>
<a href="#l5.667"></a><span id="l5.667" class="difflineplus">+</span>
<a href="#l5.668"></a><span id="l5.668" class="difflineplus">+  // nsISupports</span>
<a href="#l5.669"></a><span id="l5.669" class="difflineplus">+  QueryInterface: function BPP_QueryInterface(aIID) {</span>
<a href="#l5.670"></a><span id="l5.670" class="difflineplus">+    if (aIID.equals(Components.interfaces.nsIDOMEventListener) ||</span>
<a href="#l5.671"></a><span id="l5.671" class="difflineplus">+        aIID.equals(Components.interfaces.nsISupports))</span>
<a href="#l5.672"></a><span id="l5.672" class="difflineplus">+      return this;</span>
<a href="#l5.673"></a><span id="l5.673"> </span>
<a href="#l5.674"></a><span id="l5.674" class="difflineminus">-      var duration = document.getElementById(&quot;duration&quot;).value;</span>
<a href="#l5.675"></a><span id="l5.675" class="difflineminus">-      if (!duration) {</span>
<a href="#l5.676"></a><span id="l5.676" class="difflineminus">-        alert(BookmarksUtils.getLocaleString(&quot;pleaseEnterADuration&quot;));</span>
<a href="#l5.677"></a><span id="l5.677" class="difflineminus">-        return false;</span>
<a href="#l5.678"></a><span id="l5.678" class="difflineminus">-      }</span>
<a href="#l5.679"></a><span id="l5.679" class="difflineplus">+    throw Components.results.NS_NOINTERFACE;</span>
<a href="#l5.680"></a><span id="l5.680" class="difflineplus">+  },</span>
<a href="#l5.681"></a><span id="l5.681" class="difflineplus">+</span>
<a href="#l5.682"></a><span id="l5.682" class="difflineplus">+  _element: function BPP__element(aID) {</span>
<a href="#l5.683"></a><span id="l5.683" class="difflineplus">+    return document.getElementById(&quot;editBMPanel_&quot; + aID);</span>
<a href="#l5.684"></a><span id="l5.684" class="difflineplus">+  },</span>
<a href="#l5.685"></a><span id="l5.685" class="difflineplus">+</span>
<a href="#l5.686"></a><span id="l5.686" class="difflineplus">+  onDialogUnload: function BPP_onDialogUnload() {</span>
<a href="#l5.687"></a><span id="l5.687" class="difflineplus">+    // gEditItemOverlay does not exist anymore here, so don't rely on it.</span>
<a href="#l5.688"></a><span id="l5.688" class="difflineplus">+    // Calling removeEventListener with arguments which do not identify any</span>
<a href="#l5.689"></a><span id="l5.689" class="difflineplus">+    // currently registered EventListener on the EventTarget has no effect.</span>
<a href="#l5.690"></a><span id="l5.690" class="difflineplus">+    this._element(&quot;tagsSelectorRow&quot;)</span>
<a href="#l5.691"></a><span id="l5.691" class="difflineplus">+        .removeEventListener(&quot;DOMAttrModified&quot;, this, false);</span>
<a href="#l5.692"></a><span id="l5.692" class="difflineplus">+    this._element(&quot;folderTreeRow&quot;)</span>
<a href="#l5.693"></a><span id="l5.693" class="difflineplus">+        .removeEventListener(&quot;DOMAttrModified&quot;, this, false);</span>
<a href="#l5.694"></a><span id="l5.694" class="difflineplus">+    this._element(&quot;locationField&quot;)</span>
<a href="#l5.695"></a><span id="l5.695" class="difflineplus">+        .removeEventListener(&quot;input&quot;, this, false);</span>
<a href="#l5.696"></a><span id="l5.696" class="difflineplus">+    this._element(&quot;feedLocationField&quot;)</span>
<a href="#l5.697"></a><span id="l5.697" class="difflineplus">+        .removeEventListener(&quot;input&quot;, this, false);</span>
<a href="#l5.698"></a><span id="l5.698" class="difflineplus">+    this._element(&quot;siteLocationField&quot;)</span>
<a href="#l5.699"></a><span id="l5.699" class="difflineplus">+        .removeEventListener(&quot;input&quot;, this, false);</span>
<a href="#l5.700"></a><span id="l5.700" class="difflineplus">+  },</span>
<a href="#l5.701"></a><span id="l5.701"> </span>
<a href="#l5.702"></a><span id="l5.702" class="difflineminus">-      var methods = [];</span>
<a href="#l5.703"></a><span id="l5.703" class="difflineminus">-      if (document.getElementById(&quot;bookmarkIcon&quot;).checked)</span>
<a href="#l5.704"></a><span id="l5.704" class="difflineminus">-        methods.push(&quot;icon&quot;);</span>
<a href="#l5.705"></a><span id="l5.705" class="difflineminus">-      if (document.getElementById(&quot;playSound&quot;).checked)</span>
<a href="#l5.706"></a><span id="l5.706" class="difflineminus">-        methods.push(&quot;sound&quot;);</span>
<a href="#l5.707"></a><span id="l5.707" class="difflineminus">-      if (document.getElementById(&quot;showAlert&quot;).checked)</span>
<a href="#l5.708"></a><span id="l5.708" class="difflineminus">-        methods.push(&quot;alert&quot;);</span>
<a href="#l5.709"></a><span id="l5.709" class="difflineminus">-      if (document.getElementById(&quot;openWindow&quot;).checked)</span>
<a href="#l5.710"></a><span id="l5.710" class="difflineminus">-        methods.push(&quot;open&quot;);</span>
<a href="#l5.711"></a><span id="l5.711" class="difflineplus">+  onDialogAccept: function BPP_onDialogAccept() {</span>
<a href="#l5.712"></a><span id="l5.712" class="difflineplus">+    // We must blur current focused element to save its changes correctly</span>
<a href="#l5.713"></a><span id="l5.713" class="difflineplus">+    document.commandDispatcher.focusedElement.blur();</span>
<a href="#l5.714"></a><span id="l5.714" class="difflineplus">+    // The order here is important! We have to uninit the panel first, otherwise</span>
<a href="#l5.715"></a><span id="l5.715" class="difflineplus">+    // late changes could force it to commit more transactions.</span>
<a href="#l5.716"></a><span id="l5.716" class="difflineplus">+    gEditItemOverlay.uninitPanel(true);</span>
<a href="#l5.717"></a><span id="l5.717" class="difflineplus">+    gEditItemOverlay = null;</span>
<a href="#l5.718"></a><span id="l5.718" class="difflineplus">+    this._endBatch();</span>
<a href="#l5.719"></a><span id="l5.719" class="difflineplus">+    window.arguments[0].performed = true;</span>
<a href="#l5.720"></a><span id="l5.720" class="difflineplus">+  },</span>
<a href="#l5.721"></a><span id="l5.721"> </span>
<a href="#l5.722"></a><span id="l5.722" class="difflineminus">-      if (methods.length == 0) {</span>
<a href="#l5.723"></a><span id="l5.723" class="difflineminus">-        alert(BookmarksUtils.getLocaleString(&quot;pleaseSelectANotification&quot;));</span>
<a href="#l5.724"></a><span id="l5.724" class="difflineplus">+  onDialogCancel: function BPP_onDialogCancel() {</span>
<a href="#l5.725"></a><span id="l5.725" class="difflineplus">+    // The order here is important! We have to uninit the panel first, otherwise</span>
<a href="#l5.726"></a><span id="l5.726" class="difflineplus">+    // changes done as part of Undo may change the panel contents and by</span>
<a href="#l5.727"></a><span id="l5.727" class="difflineplus">+    // that force it to commit more transactions.</span>
<a href="#l5.728"></a><span id="l5.728" class="difflineplus">+    gEditItemOverlay.uninitPanel(true);</span>
<a href="#l5.729"></a><span id="l5.729" class="difflineplus">+    gEditItemOverlay = null;</span>
<a href="#l5.730"></a><span id="l5.730" class="difflineplus">+    this._endBatch();</span>
<a href="#l5.731"></a><span id="l5.731" class="difflineplus">+    PlacesUIUtils.ptm.undoTransaction();</span>
<a href="#l5.732"></a><span id="l5.732" class="difflineplus">+    window.arguments[0].performed = false;</span>
<a href="#l5.733"></a><span id="l5.733" class="difflineplus">+  },</span>
<a href="#l5.734"></a><span id="l5.734" class="difflineplus">+</span>
<a href="#l5.735"></a><span id="l5.735" class="difflineplus">+  /**</span>
<a href="#l5.736"></a><span id="l5.736" class="difflineplus">+   * This method checks to see if the input fields are in a valid state.</span>
<a href="#l5.737"></a><span id="l5.737" class="difflineplus">+   *</span>
<a href="#l5.738"></a><span id="l5.738" class="difflineplus">+   * @returns  true if the input is valid, false otherwise</span>
<a href="#l5.739"></a><span id="l5.739" class="difflineplus">+   */</span>
<a href="#l5.740"></a><span id="l5.740" class="difflineplus">+  _inputIsValid: function BPP__inputIsValid() {</span>
<a href="#l5.741"></a><span id="l5.741" class="difflineplus">+    if (this._itemType == BOOKMARK_ITEM &amp;&amp;</span>
<a href="#l5.742"></a><span id="l5.742" class="difflineplus">+        !this._containsValidURI(&quot;locationField&quot;))</span>
<a href="#l5.743"></a><span id="l5.743" class="difflineplus">+      return false;</span>
<a href="#l5.744"></a><span id="l5.744" class="difflineplus">+    if (this._isAddKeywordDialog &amp;&amp; !this._element(&quot;keywordField&quot;).value.length)</span>
<a href="#l5.745"></a><span id="l5.745" class="difflineplus">+      return false;</span>
<a href="#l5.746"></a><span id="l5.746" class="difflineplus">+</span>
<a href="#l5.747"></a><span id="l5.747" class="difflineplus">+    // Feed Location has to be a valid URI;</span>
<a href="#l5.748"></a><span id="l5.748" class="difflineplus">+    // Site Location has to be a valid URI or empty</span>
<a href="#l5.749"></a><span id="l5.749" class="difflineplus">+    if (this._itemType == LIVEMARK_CONTAINER) {</span>
<a href="#l5.750"></a><span id="l5.750" class="difflineplus">+      if (!this._containsValidURI(&quot;feedLocationField&quot;))</span>
<a href="#l5.751"></a><span id="l5.751">         return false;</span>
<a href="#l5.752"></a><span id="l5.752" class="difflineminus">-      }</span>
<a href="#l5.753"></a><span id="l5.753" class="difflineminus">-</span>
<a href="#l5.754"></a><span id="l5.754" class="difflineminus">-      var method = methods.join(); // join string in array with &quot;,&quot;</span>
<a href="#l5.755"></a><span id="l5.755" class="difflineminus">-</span>
<a href="#l5.756"></a><span id="l5.756" class="difflineminus">-      newvalue = dayRange + &quot;|&quot; + startHourRange + &quot;-&quot; + endHourRange + &quot;|&quot; + duration + &quot;|&quot; + method;</span>
<a href="#l5.757"></a><span id="l5.757" class="difflineplus">+      if (!this._containsValidURI(&quot;siteLocationField&quot;) &amp;&amp;</span>
<a href="#l5.758"></a><span id="l5.758" class="difflineplus">+          (this._element(&quot;siteLocationField&quot;).value.length &gt; 0))</span>
<a href="#l5.759"></a><span id="l5.759" class="difflineplus">+        return false;</span>
<a href="#l5.760"></a><span id="l5.760">     }</span>
<a href="#l5.761"></a><span id="l5.761"> </span>
<a href="#l5.762"></a><span id="l5.762" class="difflineminus">-    if (newvalue)</span>
<a href="#l5.763"></a><span id="l5.763" class="difflineminus">-      newvalue = RDF.GetLiteral(newvalue);</span>
<a href="#l5.764"></a><span id="l5.764" class="difflineminus">-</span>
<a href="#l5.765"></a><span id="l5.765" class="difflineminus">-    if (updateAttribute(scheduleRes, oldvalue, newvalue))</span>
<a href="#l5.766"></a><span id="l5.766" class="difflineminus">-      changed = true;</span>
<a href="#l5.767"></a><span id="l5.767" class="difflineminus">-  }</span>
<a href="#l5.768"></a><span id="l5.768" class="difflineplus">+    return true;</span>
<a href="#l5.769"></a><span id="l5.769" class="difflineplus">+  },</span>
<a href="#l5.770"></a><span id="l5.770"> </span>
<a href="#l5.771"></a><span id="l5.771" class="difflineminus">-  if (changed) {</span>
<a href="#l5.772"></a><span id="l5.772" class="difflineminus">-    var remote = BMDS.QueryInterface(Components.interfaces.nsIRDFRemoteDataSource);</span>
<a href="#l5.773"></a><span id="l5.773" class="difflineminus">-    if (remote)</span>
<a href="#l5.774"></a><span id="l5.774" class="difflineminus">-      remote.Flush();</span>
<a href="#l5.775"></a><span id="l5.775" class="difflineminus">-  }</span>
<a href="#l5.776"></a><span id="l5.776" class="difflineminus">-</span>
<a href="#l5.777"></a><span id="l5.777" class="difflineminus">-  window.close();</span>
<a href="#l5.778"></a><span id="l5.778" class="difflineminus">-  return true;</span>
<a href="#l5.779"></a><span id="l5.779" class="difflineminus">-}</span>
<a href="#l5.780"></a><span id="l5.780" class="difflineplus">+  /**</span>
<a href="#l5.781"></a><span id="l5.781" class="difflineplus">+   * Determines whether the XUL textbox with the given ID contains a</span>
<a href="#l5.782"></a><span id="l5.782" class="difflineplus">+   * string that can be converted into an nsIURI.</span>
<a href="#l5.783"></a><span id="l5.783" class="difflineplus">+   *</span>
<a href="#l5.784"></a><span id="l5.784" class="difflineplus">+   * @param aTextboxID</span>
<a href="#l5.785"></a><span id="l5.785" class="difflineplus">+   *        the ID of the textbox element whose contents we'll test</span>
<a href="#l5.786"></a><span id="l5.786" class="difflineplus">+   *</span>
<a href="#l5.787"></a><span id="l5.787" class="difflineplus">+   * @returns true if the textbox contains a valid URI string, false otherwise</span>
<a href="#l5.788"></a><span id="l5.788" class="difflineplus">+   */</span>
<a href="#l5.789"></a><span id="l5.789" class="difflineplus">+  _containsValidURI: function BPP__containsValidURI(aTextboxID) {</span>
<a href="#l5.790"></a><span id="l5.790" class="difflineplus">+    try {</span>
<a href="#l5.791"></a><span id="l5.791" class="difflineplus">+      var value = this._element(aTextboxID).value;</span>
<a href="#l5.792"></a><span id="l5.792" class="difflineplus">+      if (value) {</span>
<a href="#l5.793"></a><span id="l5.793" class="difflineplus">+        PlacesUIUtils.createFixedURI(value);</span>
<a href="#l5.794"></a><span id="l5.794" class="difflineplus">+        return true;</span>
<a href="#l5.795"></a><span id="l5.795" class="difflineplus">+      }</span>
<a href="#l5.796"></a><span id="l5.796" class="difflineplus">+    } catch (e) { }</span>
<a href="#l5.797"></a><span id="l5.797" class="difflineplus">+    return false;</span>
<a href="#l5.798"></a><span id="l5.798" class="difflineplus">+  },</span>
<a href="#l5.799"></a><span id="l5.799"> </span>
<a href="#l5.800"></a><span id="l5.800" class="difflineminus">-function updateAttribute(prop, oldvalue, newvalue)</span>
<a href="#l5.801"></a><span id="l5.801" class="difflineminus">-{</span>
<a href="#l5.802"></a><span id="l5.802" class="difflineminus">-  var changed = false;</span>
<a href="#l5.803"></a><span id="l5.803" class="difflineplus">+  /**</span>
<a href="#l5.804"></a><span id="l5.804" class="difflineplus">+   * [New Item Mode] Get the insertion point details for the new item, given</span>
<a href="#l5.805"></a><span id="l5.805" class="difflineplus">+   * dialog state and opening arguments.</span>
<a href="#l5.806"></a><span id="l5.806" class="difflineplus">+   *</span>
<a href="#l5.807"></a><span id="l5.807" class="difflineplus">+   * The container-identifier and insertion-index are returned separately in</span>
<a href="#l5.808"></a><span id="l5.808" class="difflineplus">+   * the form of [containerIdentifier, insertionIndex]</span>
<a href="#l5.809"></a><span id="l5.809" class="difflineplus">+   */</span>
<a href="#l5.810"></a><span id="l5.810" class="difflineplus">+  _getInsertionPointDetails: function BPP__getInsertionPointDetails() {</span>
<a href="#l5.811"></a><span id="l5.811" class="difflineplus">+    var containerId = this._defaultInsertionPoint.itemId;</span>
<a href="#l5.812"></a><span id="l5.812" class="difflineplus">+    var indexInContainer = this._defaultInsertionPoint.index;</span>
<a href="#l5.813"></a><span id="l5.813"> </span>
<a href="#l5.814"></a><span id="l5.814" class="difflineminus">-  if (prop &amp;&amp; (oldvalue || newvalue) &amp;&amp; oldvalue != newvalue) {</span>
<a href="#l5.815"></a><span id="l5.815" class="difflineplus">+    return [containerId, indexInContainer];</span>
<a href="#l5.816"></a><span id="l5.816" class="difflineplus">+  },</span>
<a href="#l5.817"></a><span id="l5.817"> </span>
<a href="#l5.818"></a><span id="l5.818" class="difflineminus">-    if (oldvalue &amp;&amp; !newvalue) {</span>
<a href="#l5.819"></a><span id="l5.819" class="difflineminus">-      BMDS.Unassert(RDF.GetResource(gBookmarkID), </span>
<a href="#l5.820"></a><span id="l5.820" class="difflineminus">-                    RDF.GetResource(prop), oldvalue);</span>
<a href="#l5.821"></a><span id="l5.821" class="difflineplus">+  /**</span>
<a href="#l5.822"></a><span id="l5.822" class="difflineplus">+   * Returns a transaction for creating a new bookmark item representing the</span>
<a href="#l5.823"></a><span id="l5.823" class="difflineplus">+   * various fields and opening arguments of the dialog.</span>
<a href="#l5.824"></a><span id="l5.824" class="difflineplus">+   */</span>
<a href="#l5.825"></a><span id="l5.825" class="difflineplus">+  _getCreateNewBookmarkTransaction:</span>
<a href="#l5.826"></a><span id="l5.826" class="difflineplus">+  function BPP__getCreateNewBookmarkTransaction(aContainer, aIndex) {</span>
<a href="#l5.827"></a><span id="l5.827" class="difflineplus">+    var annotations = [];</span>
<a href="#l5.828"></a><span id="l5.828" class="difflineplus">+    var childTransactions = [];</span>
<a href="#l5.829"></a><span id="l5.829" class="difflineplus">+</span>
<a href="#l5.830"></a><span id="l5.830" class="difflineplus">+    if (this._description) {</span>
<a href="#l5.831"></a><span id="l5.831" class="difflineplus">+      childTransactions.push(</span>
<a href="#l5.832"></a><span id="l5.832" class="difflineplus">+        PlacesUIUtils.ptm.editItemDescription(-1, this._description));</span>
<a href="#l5.833"></a><span id="l5.833">     }</span>
<a href="#l5.834"></a><span id="l5.834" class="difflineminus">-    else if (!oldvalue &amp;&amp; newvalue) {</span>
<a href="#l5.835"></a><span id="l5.835" class="difflineminus">-      BMDS.Assert(RDF.GetResource(gBookmarkID),</span>
<a href="#l5.836"></a><span id="l5.836" class="difflineminus">-                  RDF.GetResource(prop), newvalue, true);</span>
<a href="#l5.837"></a><span id="l5.837" class="difflineplus">+</span>
<a href="#l5.838"></a><span id="l5.838" class="difflineplus">+    if (this._loadInSidebar) {</span>
<a href="#l5.839"></a><span id="l5.839" class="difflineplus">+      childTransactions.push(</span>
<a href="#l5.840"></a><span id="l5.840" class="difflineplus">+        PlacesUIUtils.ptm.setLoadInSidebar(-1, this._loadInSidebar));</span>
<a href="#l5.841"></a><span id="l5.841">     }</span>
<a href="#l5.842"></a><span id="l5.842" class="difflineminus">-    else /* if (oldvalue &amp;&amp; newvalue) */ {</span>
<a href="#l5.843"></a><span id="l5.843" class="difflineminus">-      BMDS.Change(RDF.GetResource(gBookmarkID), </span>
<a href="#l5.844"></a><span id="l5.844" class="difflineminus">-                  RDF.GetResource(prop), oldvalue, newvalue);</span>
<a href="#l5.845"></a><span id="l5.845" class="difflineplus">+</span>
<a href="#l5.846"></a><span id="l5.846" class="difflineplus">+    if (this._postData) {</span>
<a href="#l5.847"></a><span id="l5.847" class="difflineplus">+      childTransactions.push(</span>
<a href="#l5.848"></a><span id="l5.848" class="difflineplus">+        PlacesUIUtils.ptm.editBookmarkPostData(-1, this._postData));</span>
<a href="#l5.849"></a><span id="l5.849">     }</span>
<a href="#l5.850"></a><span id="l5.850"> </span>
<a href="#l5.851"></a><span id="l5.851" class="difflineminus">-    changed = true;</span>
<a href="#l5.852"></a><span id="l5.852" class="difflineminus">-  }</span>
<a href="#l5.853"></a><span id="l5.853" class="difflineplus">+    //XXX TODO: this should be in a transaction!</span>
<a href="#l5.854"></a><span id="l5.854" class="difflineplus">+    if (this._charSet)</span>
<a href="#l5.855"></a><span id="l5.855" class="difflineplus">+      PlacesUtils.history.setCharsetForURI(this._uri, this._charSet);</span>
<a href="#l5.856"></a><span id="l5.856"> </span>
<a href="#l5.857"></a><span id="l5.857" class="difflineminus">-  return changed;</span>
<a href="#l5.858"></a><span id="l5.858" class="difflineminus">-}</span>
<a href="#l5.859"></a><span id="l5.859" class="difflineplus">+    var transactions = [PlacesUIUtils.ptm.createItem(this._uri,</span>
<a href="#l5.860"></a><span id="l5.860" class="difflineplus">+                                                     aContainer, aIndex,</span>
<a href="#l5.861"></a><span id="l5.861" class="difflineplus">+                                                     this._title, this._keyword,</span>
<a href="#l5.862"></a><span id="l5.862" class="difflineplus">+                                                     annotations,</span>
<a href="#l5.863"></a><span id="l5.863" class="difflineplus">+                                                     childTransactions)];</span>
<a href="#l5.864"></a><span id="l5.864" class="difflineplus">+</span>
<a href="#l5.865"></a><span id="l5.865" class="difflineplus">+    return PlacesUIUtils.ptm.aggregateTransactions(this._getDialogTitle(),</span>
<a href="#l5.866"></a><span id="l5.866" class="difflineplus">+                                                   transactions);</span>
<a href="#l5.867"></a><span id="l5.867" class="difflineplus">+  },</span>
<a href="#l5.868"></a><span id="l5.868"> </span>
<a href="#l5.869"></a><span id="l5.869" class="difflineminus">-function setEndHourRange()</span>
<a href="#l5.870"></a><span id="l5.870" class="difflineminus">-{</span>
<a href="#l5.871"></a><span id="l5.871" class="difflineminus">-  // Get the values of the start-time and end-time as ints</span>
<a href="#l5.872"></a><span id="l5.872" class="difflineminus">-  var startHourRangeNode = document.getElementById(&quot;startHourRange&quot;);</span>
<a href="#l5.873"></a><span id="l5.873" class="difflineminus">-  var startHourRange = startHourRangeNode.selectedItem.getAttribute(&quot;value&quot;);</span>
<a href="#l5.874"></a><span id="l5.874" class="difflineminus">-  var startHourRangeInt = parseInt(startHourRange);</span>
<a href="#l5.875"></a><span id="l5.875" class="difflineplus">+  /**</span>
<a href="#l5.876"></a><span id="l5.876" class="difflineplus">+   * Returns a childItems-transactions array representing the URIList with</span>
<a href="#l5.877"></a><span id="l5.877" class="difflineplus">+   * which the dialog has been opened.</span>
<a href="#l5.878"></a><span id="l5.878" class="difflineplus">+   */</span>
<a href="#l5.879"></a><span id="l5.879" class="difflineplus">+  _getTransactionsForURIList: function BPP__getTransactionsForURIList() {</span>
<a href="#l5.880"></a><span id="l5.880" class="difflineplus">+    var transactions = [];</span>
<a href="#l5.881"></a><span id="l5.881" class="difflineplus">+    for (var i = 0; i &lt; this._URIs.length; ++i) {</span>
<a href="#l5.882"></a><span id="l5.882" class="difflineplus">+      var uri = this._URIs[i];</span>
<a href="#l5.883"></a><span id="l5.883" class="difflineplus">+      var title = this._getURITitleFromHistory(uri);</span>
<a href="#l5.884"></a><span id="l5.884" class="difflineplus">+      transactions.push(PlacesUIUtils.ptm.createItem(uri, -1, -1, title));</span>
<a href="#l5.885"></a><span id="l5.885" class="difflineplus">+    }</span>
<a href="#l5.886"></a><span id="l5.886" class="difflineplus">+    return transactions; </span>
<a href="#l5.887"></a><span id="l5.887" class="difflineplus">+  },</span>
<a href="#l5.888"></a><span id="l5.888"> </span>
<a href="#l5.889"></a><span id="l5.889" class="difflineminus">-  var endHourRangeNode = document.getElementById(&quot;endHourRange&quot;);</span>
<a href="#l5.890"></a><span id="l5.890" class="difflineminus">-  var endHourRange = endHourRangeNode.selectedItem.getAttribute(&quot;value&quot;);</span>
<a href="#l5.891"></a><span id="l5.891" class="difflineminus">-  var endHourRangeInt = parseInt(endHourRange);</span>
<a href="#l5.892"></a><span id="l5.892" class="difflineminus">-</span>
<a href="#l5.893"></a><span id="l5.893" class="difflineminus">-  var endHourItemNode = endHourRangeNode.firstChild.firstChild;</span>
<a href="#l5.894"></a><span id="l5.894" class="difflineminus">-</span>
<a href="#l5.895"></a><span id="l5.895" class="difflineminus">-  var index = 0;</span>
<a href="#l5.896"></a><span id="l5.896" class="difflineplus">+  /**</span>
<a href="#l5.897"></a><span id="l5.897" class="difflineplus">+   * Returns a transaction for creating a new folder item representing the</span>
<a href="#l5.898"></a><span id="l5.898" class="difflineplus">+   * various fields and opening arguments of the dialog.</span>
<a href="#l5.899"></a><span id="l5.899" class="difflineplus">+   */</span>
<a href="#l5.900"></a><span id="l5.900" class="difflineplus">+  _getCreateNewFolderTransaction:</span>
<a href="#l5.901"></a><span id="l5.901" class="difflineplus">+  function BPP__getCreateNewFolderTransaction(aContainer, aIndex) {</span>
<a href="#l5.902"></a><span id="l5.902" class="difflineplus">+    var annotations = [];</span>
<a href="#l5.903"></a><span id="l5.903" class="difflineplus">+    var childItemsTransactions;</span>
<a href="#l5.904"></a><span id="l5.904" class="difflineplus">+    if (this._URIs.length)</span>
<a href="#l5.905"></a><span id="l5.905" class="difflineplus">+      childItemsTransactions = this._getTransactionsForURIList();</span>
<a href="#l5.906"></a><span id="l5.906"> </span>
<a href="#l5.907"></a><span id="l5.907" class="difflineminus">-  // disable all those end-times before the start-time</span>
<a href="#l5.908"></a><span id="l5.908" class="difflineminus">-  for (; index &lt; startHourRangeInt; ++index) {</span>
<a href="#l5.909"></a><span id="l5.909" class="difflineminus">-    endHourItemNode.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l5.910"></a><span id="l5.910" class="difflineminus">-    endHourItemNode = endHourItemNode.nextSibling;</span>
<a href="#l5.911"></a><span id="l5.911" class="difflineminus">-  }</span>
<a href="#l5.912"></a><span id="l5.912" class="difflineplus">+    if (this._description)</span>
<a href="#l5.913"></a><span id="l5.913" class="difflineplus">+      annotations.push(this._getDescriptionAnnotation(this._description));</span>
<a href="#l5.914"></a><span id="l5.914" class="difflineplus">+</span>
<a href="#l5.915"></a><span id="l5.915" class="difflineplus">+    return PlacesUIUtils.ptm.createFolder(this._title, aContainer, aIndex,</span>
<a href="#l5.916"></a><span id="l5.916" class="difflineplus">+                                          annotations, childItemsTransactions);</span>
<a href="#l5.917"></a><span id="l5.917" class="difflineplus">+  },</span>
<a href="#l5.918"></a><span id="l5.918"> </span>
<a href="#l5.919"></a><span id="l5.919" class="difflineminus">-  // update the selected value if it's out of the allowed range</span>
<a href="#l5.920"></a><span id="l5.920" class="difflineminus">-  if (startHourRangeInt &gt;= endHourRangeInt)</span>
<a href="#l5.921"></a><span id="l5.921" class="difflineminus">-    endHourRangeNode.selectedItem = endHourItemNode;</span>
<a href="#l5.922"></a><span id="l5.922" class="difflineplus">+  /**</span>
<a href="#l5.923"></a><span id="l5.923" class="difflineplus">+   * Returns a transaction for creating a new live-bookmark item representing</span>
<a href="#l5.924"></a><span id="l5.924" class="difflineplus">+   * the various fields and opening arguments of the dialog.</span>
<a href="#l5.925"></a><span id="l5.925" class="difflineplus">+   */</span>
<a href="#l5.926"></a><span id="l5.926" class="difflineplus">+  _getCreateNewLivemarkTransaction:</span>
<a href="#l5.927"></a><span id="l5.927" class="difflineplus">+  function BPP__getCreateNewLivemarkTransaction(aContainer, aIndex) {</span>
<a href="#l5.928"></a><span id="l5.928" class="difflineplus">+    return PlacesUIUtils.ptm.createLivemark(this._feedURI, this._siteURI,</span>
<a href="#l5.929"></a><span id="l5.929" class="difflineplus">+                                            this._title,</span>
<a href="#l5.930"></a><span id="l5.930" class="difflineplus">+                                            aContainer, aIndex);</span>
<a href="#l5.931"></a><span id="l5.931" class="difflineplus">+  },</span>
<a href="#l5.932"></a><span id="l5.932"> </span>
<a href="#l5.933"></a><span id="l5.933" class="difflineminus">-  // make sure all the end-times after the start-time are enabled</span>
<a href="#l5.934"></a><span id="l5.934" class="difflineminus">-  for (; index &lt; 24; ++index) {</span>
<a href="#l5.935"></a><span id="l5.935" class="difflineminus">-    endHourItemNode.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l5.936"></a><span id="l5.936" class="difflineminus">-    endHourItemNode = endHourItemNode.nextSibling;</span>
<a href="#l5.937"></a><span id="l5.937" class="difflineminus">-  }</span>
<a href="#l5.938"></a><span id="l5.938" class="difflineminus">-}</span>
<a href="#l5.939"></a><span id="l5.939" class="difflineplus">+  /**</span>
<a href="#l5.940"></a><span id="l5.940" class="difflineplus">+   * Dialog-accept code-path for creating a new item (any type)</span>
<a href="#l5.941"></a><span id="l5.941" class="difflineplus">+   */</span>
<a href="#l5.942"></a><span id="l5.942" class="difflineplus">+  _createNewItem: function BPP__getCreateItemTransaction() {</span>
<a href="#l5.943"></a><span id="l5.943" class="difflineplus">+    var [container, index] = this._getInsertionPointDetails();</span>
<a href="#l5.944"></a><span id="l5.944" class="difflineplus">+    var txn;</span>
<a href="#l5.945"></a><span id="l5.945"> </span>
<a href="#l5.946"></a><span id="l5.946" class="difflineminus">-function dayRangeChange (aMenuList)</span>
<a href="#l5.947"></a><span id="l5.947" class="difflineminus">-{</span>
<a href="#l5.948"></a><span id="l5.948" class="difflineminus">-  var controls = [&quot;startHourRange&quot;, &quot;endHourRange&quot;, &quot;duration&quot;, &quot;bookmarkIcon&quot;, </span>
<a href="#l5.949"></a><span id="l5.949" class="difflineminus">-                  &quot;showAlert&quot;, &quot;openWindow&quot;, &quot;playSound&quot;, &quot;durationSubLabel&quot;, </span>
<a href="#l5.950"></a><span id="l5.950" class="difflineminus">-                  &quot;durationLabel&quot;, &quot;startHourRangeLabel&quot;, &quot;endHourRangeLabel&quot;];</span>
<a href="#l5.951"></a><span id="l5.951" class="difflineminus">-  for (var i = 0; i &lt; controls.length; ++i)</span>
<a href="#l5.952"></a><span id="l5.952" class="difflineminus">-    document.getElementById(controls[i]).disabled = !aMenuList.value;</span>
<a href="#l5.953"></a><span id="l5.953" class="difflineminus">-}</span>
<a href="#l5.954"></a><span id="l5.954" class="difflineplus">+    switch (this._itemType) {</span>
<a href="#l5.955"></a><span id="l5.955" class="difflineplus">+      case BOOKMARK_FOLDER:</span>
<a href="#l5.956"></a><span id="l5.956" class="difflineplus">+        txn = this._getCreateNewFolderTransaction(container, index);</span>
<a href="#l5.957"></a><span id="l5.957" class="difflineplus">+        break;</span>
<a href="#l5.958"></a><span id="l5.958" class="difflineplus">+      case LIVEMARK_CONTAINER:</span>
<a href="#l5.959"></a><span id="l5.959" class="difflineplus">+        txn = this._getCreateNewLivemarkTransaction(container, index);</span>
<a href="#l5.960"></a><span id="l5.960" class="difflineplus">+        break;      </span>
<a href="#l5.961"></a><span id="l5.961" class="difflineplus">+      default: // BOOKMARK_ITEM</span>
<a href="#l5.962"></a><span id="l5.962" class="difflineplus">+        txn = this._getCreateNewBookmarkTransaction(container, index);</span>
<a href="#l5.963"></a><span id="l5.963" class="difflineplus">+    }</span>
<a href="#l5.964"></a><span id="l5.964" class="difflineplus">+</span>
<a href="#l5.965"></a><span id="l5.965" class="difflineplus">+    PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l5.966"></a><span id="l5.966" class="difflineplus">+    this._itemId = PlacesUtils.bookmarks.getIdForItemAt(container, index);</span>
<a href="#l5.967"></a><span id="l5.967" class="difflineplus">+  }</span>
<a href="#l5.968"></a><span id="l5.968" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/common/bookmarks/bm-props.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/common/bookmarks/bm-props.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,215 +1,78 @@</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt; &lt;!-- -*- Mode: SGML; indent-tabs-mode: nil; -*- --&gt;</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineminus">-&lt;!--</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineminus">-</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineminus">- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">- Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">-</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">- The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">- 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">- the License. You may obtain a copy of the License at</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">- http://www.mozilla.org/MPL/</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">- Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">- WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">- for the specific language governing rights and limitations under the</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">- License.</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">- The Original Code is mozilla.org code.</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">- The Initial Developer of the Original Code is</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">- Netscape Communications Corporation.</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">- Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">- the Initial Developer. All Rights Reserved.</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">- Contributor(s):</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+   -</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+   -</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+   - License.</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+   -</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+   - The Original Code is the Places Bookmark Properties dialog.</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+   -</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+   - The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+   -</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+   - Contributor(s):</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+   -   Joe Hughes &lt;jhughes@google.com&gt;</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+   -   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+   -   Ehsan Akhgari &lt;ehsan.akhgari@gmail.com&gt;</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+   -   Marco Bonardo &lt;mak77@bonardo.net&gt;</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+   -</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+   -</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l6.67"></a><span id="l6.67"> </span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">- Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">- either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">- or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">- in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">- of those above. If you wish to allow use of your version of this file only</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">- under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">- use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">- decision by deleting the provisions above and replace them with the notice</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">- and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineminus">- the provisions above, a recipient may use your version of this file under</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">- the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot;?&gt;</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/content/places/places.css&quot;?&gt;</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/bookmarks/editBookmarkOverlay.css&quot;?&gt;</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/bookmarks/bookmarks.css&quot;?&gt;</span>
<a href="#l6.83"></a><span id="l6.83"> </span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">- ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/bookmarks/bookmarks.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://communicator/content/bookmarks/placesOverlay.xul&quot;?&gt;</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://communicator/content/bookmarks/editBookmarkOverlay.xul&quot;?&gt;</span>
<a href="#l6.90"></a><span id="l6.90"> </span>
<a href="#l6.91"></a><span id="l6.91"> &lt;!DOCTYPE dialog [</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineminus">-&lt;!ENTITY % brandDTD SYSTEM &quot;chrome://branding/locale/brand.dtd&quot; &gt;</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-%brandDTD;</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-&lt;!ENTITY % bmpropsDTD SYSTEM &quot;chrome://communicator/locale/bookmarks/bm-props.dtd&quot;&gt;</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-%bmpropsDTD;</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+  &lt;!ENTITY % editBookmarkOverlayDTD SYSTEM &quot;chrome://communicator/locale/bookmarks/editBookmarkOverlay.dtd&quot;&gt;</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineplus">+  %editBookmarkOverlayDTD;</span>
<a href="#l6.98"></a><span id="l6.98"> ]&gt;</span>
<a href="#l6.99"></a><span id="l6.99"> </span>
<a href="#l6.100"></a><span id="l6.100" class="difflineminus">-&lt;dialog id=&quot;bmPropsWindow&quot; xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineminus">-        title=&quot;&amp;bookmarks.windowtitle.label;&quot;</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineminus">-        onload=&quot;Init()&quot; style=&quot;width: 40em;&quot;</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineminus">-        ondialogaccept=&quot;return Commit();&quot;&gt;</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineminus">- </span>
<a href="#l6.105"></a><span id="l6.105" class="difflineminus">-  &lt;stringbundleset&gt;</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineminus">-    &lt;stringbundle id=&quot;bundle_bookmarks&quot; src=&quot;chrome://communicator/locale/bookmarks/bookmarks.properties&quot;/&gt;</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineminus">-    &lt;stringbundle id=&quot;bundle_brand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineplus">+&lt;dialog id=&quot;bookmarkproperties&quot;</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineplus">+        buttons=&quot;accept, cancel&quot;</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineplus">+        buttoniconaccept=&quot;save&quot;</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineplus">+        ondialogaccept=&quot;BookmarkPropertiesPanel.onDialogAccept();&quot;</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineplus">+        ondialogcancel=&quot;BookmarkPropertiesPanel.onDialogCancel();&quot;</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineplus">+        onload=&quot;BookmarkPropertiesPanel.onDialogLoad();&quot;</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineplus">+        onunload=&quot;BookmarkPropertiesPanel.onDialogUnload();&quot;</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineplus">+        style=&quot;min-width: 30em;&quot;</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineplus">+        persist=&quot;screenX screenY width&quot;&gt;</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineplus">+</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineplus">+  &lt;stringbundleset id=&quot;stringbundleset&quot;&gt;</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineplus">+    &lt;stringbundle id=&quot;stringBundle&quot;</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineplus">+                  src=&quot;chrome://communicator/locale/bookmarks/bm-props.properties&quot;/&gt;</span>
<a href="#l6.122"></a><span id="l6.122">   &lt;/stringbundleset&gt;</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/bookmarks/bookmarks.js&quot;/&gt;</span>
<a href="#l6.125"></a><span id="l6.125" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/bookmarks/bm-props.js&quot;/&gt;</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineminus">- </span>
<a href="#l6.127"></a><span id="l6.127" class="difflineminus">-  &lt;keyset id=&quot;keyset&quot;/&gt;  </span>
<a href="#l6.128"></a><span id="l6.128" class="difflineminus">-    </span>
<a href="#l6.129"></a><span id="l6.129" class="difflineminus">-  &lt;groupbox&gt;</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineminus">-    &lt;caption label=&quot;&amp;generalInfo.label;&quot; /&gt;</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineminus">-    &lt;grid&gt;</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineminus">-      &lt;columns&gt;</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineminus">-        &lt;column /&gt;</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineminus">-        &lt;column flex=&quot;1&quot;/&gt;</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineminus">-      &lt;/columns&gt;</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineminus">-      &lt;rows&gt;</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineminus">-        &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineminus">-          &lt;label value=&quot;&amp;bookmarks.name.label;&quot; </span>
<a href="#l6.139"></a><span id="l6.139" class="difflineminus">-                 accesskey=&quot;&amp;bookmarks.name.accesskey;&quot; control=&quot;name&quot;/&gt;</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineminus">-          &lt;textbox id=&quot;name&quot;/&gt;</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineminus">-        &lt;/row&gt;</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineminus">-        &lt;row id=&quot;locationrow&quot; align=&quot;center&quot;&gt;</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineminus">-          &lt;label value=&quot;&amp;bookmarks.location.label;&quot; </span>
<a href="#l6.144"></a><span id="l6.144" class="difflineminus">-                 accesskey=&quot;&amp;bookmarks.location.accesskey;&quot; control=&quot;url&quot;/&gt;</span>
<a href="#l6.145"></a><span id="l6.145" class="difflineminus">-          &lt;textbox id=&quot;url&quot; class=&quot;uri-element&quot; /&gt;</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineminus">-        &lt;/row&gt;</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineminus">-        &lt;row id=&quot;shortcutrow&quot; align=&quot;center&quot;&gt;</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineminus">-          &lt;label value=&quot;&amp;bookmarks.shortcut.label;&quot; </span>
<a href="#l6.149"></a><span id="l6.149" class="difflineminus">-                 accesskey=&quot;&amp;bookmarks.shortcut.accesskey;&quot; control=&quot;shortcut&quot;/&gt;</span>
<a href="#l6.150"></a><span id="l6.150" class="difflineminus">-          &lt;textbox id=&quot;shortcut&quot; /&gt;</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineminus">-        &lt;/row&gt;</span>
<a href="#l6.152"></a><span id="l6.152" class="difflineminus">-        &lt;row id=&quot;descriptionrow&quot;&gt;</span>
<a href="#l6.153"></a><span id="l6.153" class="difflineminus">-          &lt;label value=&quot;&amp;bookmarks.description.label;&quot; </span>
<a href="#l6.154"></a><span id="l6.154" class="difflineminus">-                 accesskey=&quot;&amp;bookmarks.description.accesskey;&quot; control=&quot;description&quot;/&gt;</span>
<a href="#l6.155"></a><span id="l6.155" class="difflineminus">-          &lt;textbox multiline=&quot;true&quot; wrap=&quot;virtual&quot; id=&quot;description&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineminus">-        &lt;/row&gt;</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineminus">-      &lt;/rows&gt;</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineminus">-    &lt;/grid&gt;</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineminus">-  &lt;/groupbox&gt;</span>
<a href="#l6.160"></a><span id="l6.160" class="difflineminus">-  &lt;hbox id=&quot;scheduling&quot;&gt;</span>
<a href="#l6.161"></a><span id="l6.161" class="difflineminus">-    &lt;groupbox&gt;</span>
<a href="#l6.162"></a><span id="l6.162" class="difflineminus">-      &lt;caption label=&quot;&amp;checkforupdates.legend.label;&quot;/&gt;</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineminus">-      &lt;grid flex=&quot;1&quot;&gt;</span>
<a href="#l6.164"></a><span id="l6.164" class="difflineminus">-        &lt;columns&gt;</span>
<a href="#l6.165"></a><span id="l6.165" class="difflineminus">-          &lt;column/&gt;</span>
<a href="#l6.166"></a><span id="l6.166" class="difflineminus">-          &lt;column flex=&quot;1&quot;/&gt;</span>
<a href="#l6.167"></a><span id="l6.167" class="difflineminus">-        &lt;/columns&gt;</span>
<a href="#l6.168"></a><span id="l6.168" class="difflineminus">-        &lt;rows&gt;</span>
<a href="#l6.169"></a><span id="l6.169" class="difflineminus">-          &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l6.170"></a><span id="l6.170" class="difflineminus">-            &lt;label value=&quot;&amp;when.label;&quot; accesskey=&quot;&amp;when.accesskey;&quot; control=&quot;dayRange&quot;/&gt;</span>
<a href="#l6.171"></a><span id="l6.171" class="difflineminus">-            &lt;hbox&gt;</span>
<a href="#l6.172"></a><span id="l6.172" class="difflineminus">-              &lt;menulist id=&quot;dayRange&quot; oncommand=&quot;dayRangeChange(this);&quot;&gt;</span>
<a href="#l6.173"></a><span id="l6.173" class="difflineminus">-                &lt;menupopup&gt;</span>
<a href="#l6.174"></a><span id="l6.174" class="difflineminus">-                  &lt;menuitem value=&quot;&quot; label=&quot;&amp;checknever.label;&quot;/&gt;</span>
<a href="#l6.175"></a><span id="l6.175" class="difflineminus">-                  &lt;menuseparator /&gt;</span>
<a href="#l6.176"></a><span id="l6.176" class="difflineminus">-                  &lt;menuitem value=&quot;0123456&quot; label=&quot;&amp;checkeveryday.label;&quot;/&gt;</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineminus">-                  &lt;menuitem value=&quot;12345&quot; label=&quot;&amp;checkweekdays.label;&quot;/&gt;</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineminus">-                  &lt;menuitem value=&quot;06&quot; label=&quot;&amp;checkweekends.label;&quot;/&gt;</span>
<a href="#l6.179"></a><span id="l6.179" class="difflineminus">-                  &lt;menuitem value=&quot;1&quot; label=&quot;&amp;checkmondays.label;&quot;/&gt;</span>
<a href="#l6.180"></a><span id="l6.180" class="difflineminus">-                  &lt;menuitem value=&quot;2&quot; label=&quot;&amp;checktuesdays.label;&quot;/&gt;</span>
<a href="#l6.181"></a><span id="l6.181" class="difflineminus">-                  &lt;menuitem value=&quot;3&quot; label=&quot;&amp;checkwednesdays.label;&quot;/&gt;</span>
<a href="#l6.182"></a><span id="l6.182" class="difflineminus">-                  &lt;menuitem value=&quot;4&quot; label=&quot;&amp;checkthursdays.label;&quot;/&gt;</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineminus">-                  &lt;menuitem value=&quot;5&quot; label=&quot;&amp;checkfridays.label;&quot;/&gt;</span>
<a href="#l6.184"></a><span id="l6.184" class="difflineminus">-                  &lt;menuitem value=&quot;6&quot; label=&quot;&amp;checksaturdays.label;&quot;/&gt;</span>
<a href="#l6.185"></a><span id="l6.185" class="difflineminus">-                  &lt;menuitem value=&quot;0&quot; label=&quot;&amp;checksundays.label;&quot;/&gt;</span>
<a href="#l6.186"></a><span id="l6.186" class="difflineminus">-                &lt;/menupopup&gt;</span>
<a href="#l6.187"></a><span id="l6.187" class="difflineminus">-              &lt;/menulist&gt;</span>
<a href="#l6.188"></a><span id="l6.188" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l6.189"></a><span id="l6.189" class="difflineminus">-          &lt;/row&gt;</span>
<a href="#l6.190"></a><span id="l6.190" class="difflineminus">-          &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l6.191"></a><span id="l6.191" class="difflineminus">-            &lt;label id=&quot;startHourRangeLabel&quot; value=&quot;&amp;from.label;&quot; </span>
<a href="#l6.192"></a><span id="l6.192" class="difflineminus">-                   accesskey=&quot;&amp;from.accesskey;&quot; control=&quot;startHourRange&quot;/&gt;</span>
<a href="#l6.193"></a><span id="l6.193" class="difflineminus">-            &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l6.194"></a><span id="l6.194" class="difflineminus">-              &lt;menulist id=&quot;startHourRange&quot; oncommand=&quot;setEndHourRange()&quot; disabled=&quot;true&quot;&gt;</span>
<a href="#l6.195"></a><span id="l6.195" class="difflineminus">-                &lt;menupopup&gt;</span>
<a href="#l6.196"></a><span id="l6.196" class="difflineminus">-                  &lt;menuitem value=&quot;0&quot; label=&quot;&amp;midnight.label;&quot;/&gt;</span>
<a href="#l6.197"></a><span id="l6.197" class="difflineminus">-                  &lt;menuitem value=&quot;1&quot; label=&quot;&amp;AMone.label;&quot;/&gt;</span>
<a href="#l6.198"></a><span id="l6.198" class="difflineminus">-                  &lt;menuitem value=&quot;2&quot; label=&quot;&amp;AMtwo.label;&quot;/&gt;</span>
<a href="#l6.199"></a><span id="l6.199" class="difflineminus">-                  &lt;menuitem value=&quot;3&quot; label=&quot;&amp;AMthree.label;&quot;/&gt;</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineminus">-                  &lt;menuitem value=&quot;4&quot; label=&quot;&amp;AMfour.label;&quot;/&gt;</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineminus">-                  &lt;menuitem value=&quot;5&quot; label=&quot;&amp;AMfive.label;&quot;/&gt;</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineminus">-                  &lt;menuitem value=&quot;6&quot; label=&quot;&amp;AMsix.label;&quot;/&gt;</span>
<a href="#l6.203"></a><span id="l6.203" class="difflineminus">-                  &lt;menuitem value=&quot;7&quot; label=&quot;&amp;AMseven.label;&quot;/&gt;</span>
<a href="#l6.204"></a><span id="l6.204" class="difflineminus">-                  &lt;menuitem value=&quot;8&quot; label=&quot;&amp;AMeight.label;&quot;/&gt;</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineminus">-                  &lt;menuitem value=&quot;9&quot; label=&quot;&amp;AMnine.label;&quot;/&gt;</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineminus">-                  &lt;menuitem value=&quot;10&quot; label=&quot;&amp;AMten.label;&quot;/&gt;</span>
<a href="#l6.207"></a><span id="l6.207" class="difflineminus">-                  &lt;menuitem value=&quot;11&quot; label=&quot;&amp;AMeleven.label;&quot;/&gt;</span>
<a href="#l6.208"></a><span id="l6.208" class="difflineminus">-                  &lt;menuitem value=&quot;12&quot; label=&quot;&amp;noon.label;&quot;/&gt;</span>
<a href="#l6.209"></a><span id="l6.209" class="difflineminus">-                  &lt;menuitem value=&quot;13&quot; label=&quot;&amp;PMone.label;&quot;/&gt;</span>
<a href="#l6.210"></a><span id="l6.210" class="difflineminus">-                  &lt;menuitem value=&quot;14&quot; label=&quot;&amp;PMtwo.label;&quot;/&gt;</span>
<a href="#l6.211"></a><span id="l6.211" class="difflineminus">-                  &lt;menuitem value=&quot;15&quot; label=&quot;&amp;PMthree.label;&quot;/&gt;</span>
<a href="#l6.212"></a><span id="l6.212" class="difflineminus">-                  &lt;menuitem value=&quot;16&quot; label=&quot;&amp;PMfour.label;&quot;/&gt;</span>
<a href="#l6.213"></a><span id="l6.213" class="difflineminus">-                  &lt;menuitem value=&quot;17&quot; label=&quot;&amp;PMfive.label;&quot;/&gt;</span>
<a href="#l6.214"></a><span id="l6.214" class="difflineminus">-                  &lt;menuitem value=&quot;18&quot; label=&quot;&amp;PMsix.label;&quot;/&gt;</span>
<a href="#l6.215"></a><span id="l6.215" class="difflineminus">-                  &lt;menuitem value=&quot;19&quot; label=&quot;&amp;PMseven.label;&quot;/&gt;</span>
<a href="#l6.216"></a><span id="l6.216" class="difflineminus">-                  &lt;menuitem value=&quot;20&quot; label=&quot;&amp;PMeight.label;&quot;/&gt;</span>
<a href="#l6.217"></a><span id="l6.217" class="difflineminus">-                  &lt;menuitem value=&quot;21&quot; label=&quot;&amp;PMnine.label;&quot;/&gt;</span>
<a href="#l6.218"></a><span id="l6.218" class="difflineminus">-                  &lt;menuitem value=&quot;22&quot; label=&quot;&amp;PMten.label;&quot;/&gt;</span>
<a href="#l6.219"></a><span id="l6.219" class="difflineminus">-                  &lt;menuitem value=&quot;23&quot; label=&quot;&amp;PMeleven.label;&quot;/&gt;</span>
<a href="#l6.220"></a><span id="l6.220" class="difflineminus">-                &lt;/menupopup&gt;</span>
<a href="#l6.221"></a><span id="l6.221" class="difflineminus">-              &lt;/menulist&gt;</span>
<a href="#l6.222"></a><span id="l6.222" class="difflineminus">-              &lt;label id=&quot;endHourRangeLabel&quot; value=&quot;&amp;to.label;&quot; </span>
<a href="#l6.223"></a><span id="l6.223" class="difflineminus">-                     accesskey=&quot;&amp;to.accesskey;&quot; control=&quot;endHourRange&quot;/&gt;</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineminus">-              &lt;menulist id=&quot;endHourRange&quot; disabled=&quot;true&quot;&gt;</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineminus">-                &lt;menupopup onpopupshowing=&quot;setEndHourRange()&quot;&gt;</span>
<a href="#l6.226"></a><span id="l6.226" class="difflineminus">-                  &lt;menuitem value=&quot;1&quot; label=&quot;&amp;AMone.label;&quot;/&gt;</span>
<a href="#l6.227"></a><span id="l6.227" class="difflineminus">-                  &lt;menuitem value=&quot;2&quot; label=&quot;&amp;AMtwo.label;&quot;/&gt;</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineminus">-                  &lt;menuitem value=&quot;3&quot; label=&quot;&amp;AMthree.label;&quot;/&gt;</span>
<a href="#l6.229"></a><span id="l6.229" class="difflineminus">-                  &lt;menuitem value=&quot;4&quot; label=&quot;&amp;AMfour.label;&quot;/&gt;</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineminus">-                  &lt;menuitem value=&quot;5&quot; label=&quot;&amp;AMfive.label;&quot;/&gt;</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineminus">-                  &lt;menuitem value=&quot;6&quot; label=&quot;&amp;AMsix.label;&quot;/&gt;</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineminus">-                  &lt;menuitem value=&quot;7&quot; label=&quot;&amp;AMseven.label;&quot;/&gt;</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineminus">-                  &lt;menuitem value=&quot;8&quot; label=&quot;&amp;AMeight.label;&quot;/&gt;</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineminus">-                  &lt;menuitem value=&quot;9&quot; label=&quot;&amp;AMnine.label;&quot;/&gt;</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineminus">-                  &lt;menuitem value=&quot;10&quot; label=&quot;&amp;AMten.label;&quot;/&gt;</span>
<a href="#l6.236"></a><span id="l6.236" class="difflineminus">-                  &lt;menuitem value=&quot;11&quot; label=&quot;&amp;AMeleven.label;&quot;/&gt;</span>
<a href="#l6.237"></a><span id="l6.237" class="difflineminus">-                  &lt;menuitem value=&quot;12&quot; label=&quot;&amp;noon.label;&quot;/&gt;</span>
<a href="#l6.238"></a><span id="l6.238" class="difflineminus">-                  &lt;menuitem value=&quot;13&quot; label=&quot;&amp;PMone.label;&quot;/&gt;</span>
<a href="#l6.239"></a><span id="l6.239" class="difflineminus">-                  &lt;menuitem value=&quot;14&quot; label=&quot;&amp;PMtwo.label;&quot;/&gt;</span>
<a href="#l6.240"></a><span id="l6.240" class="difflineminus">-                  &lt;menuitem value=&quot;15&quot; label=&quot;&amp;PMthree.label;&quot;/&gt;</span>
<a href="#l6.241"></a><span id="l6.241" class="difflineminus">-                  &lt;menuitem value=&quot;16&quot; label=&quot;&amp;PMfour.label;&quot;/&gt;</span>
<a href="#l6.242"></a><span id="l6.242" class="difflineminus">-                  &lt;menuitem value=&quot;17&quot; label=&quot;&amp;PMfive.label;&quot;/&gt;</span>
<a href="#l6.243"></a><span id="l6.243" class="difflineminus">-                  &lt;menuitem value=&quot;18&quot; label=&quot;&amp;PMsix.label;&quot;/&gt;</span>
<a href="#l6.244"></a><span id="l6.244" class="difflineminus">-                  &lt;menuitem value=&quot;19&quot; label=&quot;&amp;PMseven.label;&quot;/&gt;</span>
<a href="#l6.245"></a><span id="l6.245" class="difflineminus">-                  &lt;menuitem value=&quot;20&quot; label=&quot;&amp;PMeight.label;&quot;/&gt;</span>
<a href="#l6.246"></a><span id="l6.246" class="difflineminus">-                  &lt;menuitem value=&quot;21&quot; label=&quot;&amp;PMnine.label;&quot;/&gt;</span>
<a href="#l6.247"></a><span id="l6.247" class="difflineminus">-                  &lt;menuitem value=&quot;22&quot; label=&quot;&amp;PMten.label;&quot;/&gt;</span>
<a href="#l6.248"></a><span id="l6.248" class="difflineminus">-                  &lt;menuitem value=&quot;23&quot; label=&quot;&amp;PMeleven.label;&quot;/&gt;</span>
<a href="#l6.249"></a><span id="l6.249" class="difflineminus">-                  &lt;menuitem value=&quot;24&quot; label=&quot;&amp;midnight.label;&quot;/&gt;</span>
<a href="#l6.250"></a><span id="l6.250" class="difflineminus">-                &lt;/menupopup&gt;</span>
<a href="#l6.251"></a><span id="l6.251" class="difflineminus">-              &lt;/menulist&gt;</span>
<a href="#l6.252"></a><span id="l6.252" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l6.253"></a><span id="l6.253" class="difflineminus">-          &lt;/row&gt;</span>
<a href="#l6.254"></a><span id="l6.254" class="difflineminus">-          &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l6.255"></a><span id="l6.255" class="difflineminus">-            &lt;label id=&quot;durationLabel&quot; value=&quot;&amp;every.label;&quot; </span>
<a href="#l6.256"></a><span id="l6.256" class="difflineminus">-                   accesskey=&quot;&amp;every.accesskey;&quot; control=&quot;duration&quot;/&gt;</span>
<a href="#l6.257"></a><span id="l6.257" class="difflineminus">-            &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l6.258"></a><span id="l6.258" class="difflineminus">-              &lt;textbox id=&quot;duration&quot; size=&quot;4&quot; value=&quot;60&quot; disabled=&quot;true&quot; /&gt;</span>
<a href="#l6.259"></a><span id="l6.259" class="difflineminus">-              &lt;label id=&quot;durationSubLabel&quot; value=&quot;&amp;minutes.label;&quot; /&gt;</span>
<a href="#l6.260"></a><span id="l6.260" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l6.261"></a><span id="l6.261" class="difflineminus">-          &lt;/row&gt;</span>
<a href="#l6.262"></a><span id="l6.262" class="difflineminus">-        &lt;/rows&gt;</span>
<a href="#l6.263"></a><span id="l6.263" class="difflineminus">-      &lt;/grid&gt;</span>
<a href="#l6.264"></a><span id="l6.264" class="difflineminus">-    &lt;/groupbox&gt;</span>
<a href="#l6.265"></a><span id="l6.265" class="difflineminus">-    &lt;groupbox&gt;</span>
<a href="#l6.266"></a><span id="l6.266" class="difflineminus">-      &lt;caption label=&quot;&amp;notifications.legend.label;&quot; /&gt;</span>
<a href="#l6.267"></a><span id="l6.267" class="difflineminus">-      &lt;vbox align=&quot;start&quot;&gt;</span>
<a href="#l6.268"></a><span id="l6.268" class="difflineminus">-        &lt;checkbox id=&quot;bookmarkIcon&quot; label=&quot;&amp;notification.icon.label;&quot; </span>
<a href="#l6.269"></a><span id="l6.269" class="difflineminus">-                  accesskey=&quot;&amp;notification.icon.accesskey;&quot; disabled=&quot;true&quot; /&gt;</span>
<a href="#l6.270"></a><span id="l6.270" class="difflineminus">-        &lt;checkbox id=&quot;showAlert&quot; label=&quot;&amp;notification.alert.label;&quot; </span>
<a href="#l6.271"></a><span id="l6.271" class="difflineminus">-                  accesskey=&quot;&amp;notification.alert.accesskey;&quot; disabled=&quot;true&quot; /&gt;</span>
<a href="#l6.272"></a><span id="l6.272" class="difflineminus">-        &lt;checkbox id=&quot;openWindow&quot; label=&quot;&amp;notification.window.label;&quot; </span>
<a href="#l6.273"></a><span id="l6.273" class="difflineminus">-                  accesskey=&quot;&amp;notification.window.accesskey;&quot; disabled=&quot;true&quot; /&gt;</span>
<a href="#l6.274"></a><span id="l6.274" class="difflineminus">-        &lt;checkbox id=&quot;playSound&quot; label=&quot;&amp;notification.sound.label;&quot; </span>
<a href="#l6.275"></a><span id="l6.275" class="difflineminus">-                  accesskey=&quot;&amp;notification.sound.accesskey;&quot; disabled=&quot;true&quot; /&gt;</span>
<a href="#l6.276"></a><span id="l6.276" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l6.277"></a><span id="l6.277" class="difflineminus">-    &lt;/groupbox&gt;</span>
<a href="#l6.278"></a><span id="l6.278" class="difflineminus">-  &lt;/hbox&gt;</span>
<a href="#l6.279"></a><span id="l6.279" class="difflineplus">+</span>
<a href="#l6.280"></a><span id="l6.280" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l6.281"></a><span id="l6.281" class="difflineplus">+          src=&quot;chrome://communicator/content/bookmarks/editBookmarkOverlay.js&quot;/&gt;</span>
<a href="#l6.282"></a><span id="l6.282" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l6.283"></a><span id="l6.283" class="difflineplus">+          src=&quot;chrome://communicator/content/bookmarks/bm-props.js&quot;/&gt;</span>
<a href="#l6.284"></a><span id="l6.284" class="difflineplus">+</span>
<a href="#l6.285"></a><span id="l6.285" class="difflineplus">+&lt;vbox id=&quot;editBookmarkPanelContent&quot;/&gt;</span>
<a href="#l6.286"></a><span id="l6.286" class="difflineplus">+</span>
<a href="#l6.287"></a><span id="l6.287"> &lt;/dialog&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/common/bookmarks/bookmarksManager.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/common/bookmarks/bookmarksManager.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,134 +1,1295 @@</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineminus">-/* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- </span>
<a href="#l7.5"></a><span id="l7.5" class="difflineminus">- *</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l7.9"></a><span id="l7.9">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l7.10"></a><span id="l7.10">  *</span>
<a href="#l7.11"></a><span id="l7.11">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l7.12"></a><span id="l7.12">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l7.13"></a><span id="l7.13">  * the License. You may obtain a copy of the License at</span>
<a href="#l7.14"></a><span id="l7.14">  * http://www.mozilla.org/MPL/</span>
<a href="#l7.15"></a><span id="l7.15">  *</span>
<a href="#l7.16"></a><span id="l7.16">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l7.17"></a><span id="l7.17">  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l7.18"></a><span id="l7.18">  * for the specific language governing rights and limitations under the</span>
<a href="#l7.19"></a><span id="l7.19">  * License.</span>
<a href="#l7.20"></a><span id="l7.20">  *</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+ * The Original Code is Mozilla Places Organizer.</span>
<a href="#l7.23"></a><span id="l7.23">  *</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2005-2006</span>
<a href="#l7.29"></a><span id="l7.29">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l7.30"></a><span id="l7.30">  *</span>
<a href="#l7.31"></a><span id="l7.31">  * Contributor(s):</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">- *   Ben Goodger &lt;ben@netscape.com&gt; (Original Author, v3.0)</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+ *   Annie Sullivan &lt;annie.sullivan@gmail.com&gt;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+ *   Ehsan Akhgari &lt;ehsan.akhgari@gmail.com&gt;</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+ *   Drew Willcoxon &lt;adw@mozilla.com&gt;</span>
<a href="#l7.38"></a><span id="l7.38">  *</span>
<a href="#l7.39"></a><span id="l7.39">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l7.44"></a><span id="l7.44">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l7.45"></a><span id="l7.45">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l7.46"></a><span id="l7.46">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l7.47"></a><span id="l7.47">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l7.48"></a><span id="l7.48">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l7.49"></a><span id="l7.49">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l7.50"></a><span id="l7.50">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l7.51"></a><span id="l7.51">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l7.52"></a><span id="l7.52">  *</span>
<a href="#l7.53"></a><span id="l7.53">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l7.54"></a><span id="l7.54"> </span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-// Initialize the command controllers, set focus, tree root, </span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-// window title state, etc. </span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-function Startup()</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-{</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-  const windowNode = document.getElementById(&quot;bookmark-window&quot;);</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-  const bookmarksView = document.getElementById(&quot;bookmarks-view&quot;);</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+var PlacesOrganizer = {</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+  _places: null,</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+  _content: null,</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+  // IDs of fields from editBookmarkOverlay that should be hidden when infoBox</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+  // is minimal. IDs should be kept in sync with the IDs of the elements</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+  // observing additionalInfoBroadcaster.</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+  _additionalInfoFields: [</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+    &quot;editBMPanel_descriptionRow&quot;,</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+    &quot;editBMPanel_loadInSidebarCheckbox&quot;,</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+    &quot;editBMPanel_keywordRow&quot;,</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+  ],</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineplus">+</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineplus">+  _initFolderTree: function() {</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+    var leftPaneRoot = PlacesUIUtils.leftPaneFolderId;</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+    this._places.place = &quot;place:excludeItems=1&amp;expandQueries=0&amp;folder=&quot; + leftPaneRoot;</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+  },</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+  selectLeftPaneQuery: function PO_selectLeftPaneQuery(aQueryName) {</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineplus">+    var itemId = PlacesUIUtils.leftPaneQueries[aQueryName];</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+    this._places.selectItems([itemId]);</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+    // Forcefully expand all-bookmarks</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineplus">+    if (aQueryName == &quot;AllBookmarks&quot;)</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineplus">+      PlacesUtils.asContainer(this._places.selectedNode).containerOpen = true;</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+  },</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineplus">+  init: function PO_init() {</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+    this._places = document.getElementById(&quot;placesList&quot;);</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineplus">+    this._content = document.getElementById(&quot;placeContent&quot;);</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineplus">+    this._initFolderTree();</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineplus">+</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineplus">+    var leftPaneSelection = &quot;AllBookmarks&quot;; // default to all-bookmarks</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineplus">+    if (&quot;arguments&quot; in window &amp;&amp; window.arguments.length &gt; 0)</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineplus">+      leftPaneSelection = window.arguments[0];</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineplus">+</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineplus">+    this.selectLeftPaneQuery(leftPaneSelection);</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineplus">+    // clear the back-stack</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineplus">+    this._backHistory.splice(0);</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineplus">+    document.getElementById(&quot;OrganizerCommand:Back&quot;).setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineplus">+</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineplus">+    var view = this._content.treeBoxObject.view;</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineplus">+    if (view.rowCount &gt; 0)</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineplus">+      view.selection.select(0);</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+    this._content.focus();</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineplus">+</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineplus">+    // Set up the search UI.</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineplus">+    PlacesSearchBox.init();</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineplus">+    window.addEventListener(&quot;AppCommand&quot;, this, true);</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineplus">+</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineplus">+    // remove the &quot;Properties&quot; context-menu item, we've our own details pane</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineplus">+    document.getElementById(&quot;placesContext&quot;)</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineplus">+            .removeChild(document.getElementById(&quot;placesContext_show:info&quot;));</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineplus">+  },</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineplus">+</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineplus">+  QueryInterface: function PO_QueryInterface(aIID) {</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineplus">+    if (aIID.equals(Components.interfaces.nsIDOMEventListener) ||</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineplus">+        aIID.equals(Components.interfaces.nsISupports))</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineplus">+      return this;</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineplus">+</span>
<a href="#l7.123"></a><span id="l7.123" class="difflineplus">+    throw Components.results.NS_NOINTERFACE;</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineplus">+  },</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineplus">+</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineplus">+  handleEvent: function PO_handleEvent(aEvent) {</span>
<a href="#l7.127"></a><span id="l7.127" class="difflineplus">+    if (aEvent.type != &quot;AppCommand&quot;)</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineplus">+      return;</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineplus">+</span>
<a href="#l7.130"></a><span id="l7.130" class="difflineplus">+    aEvent.stopPropagation();</span>
<a href="#l7.131"></a><span id="l7.131" class="difflineplus">+    switch (aEvent.command) {</span>
<a href="#l7.132"></a><span id="l7.132" class="difflineplus">+      case &quot;Back&quot;:</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineplus">+        if (this._backHistory.length &gt; 0)</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineplus">+          this.back();</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineplus">+        break;</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineplus">+      case &quot;Forward&quot;:</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineplus">+        if (this._forwardHistory.length &gt; 0)</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineplus">+          this.forward();</span>
<a href="#l7.139"></a><span id="l7.139" class="difflineplus">+        break;</span>
<a href="#l7.140"></a><span id="l7.140" class="difflineplus">+      case &quot;Search&quot;:</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineplus">+        PlacesSearchBox.findAll();</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineplus">+        break;</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineplus">+    }</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineplus">+  },</span>
<a href="#l7.145"></a><span id="l7.145" class="difflineplus">+</span>
<a href="#l7.146"></a><span id="l7.146" class="difflineplus">+  destroy: function PO_destroy() {</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineplus">+  },</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineplus">+</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineplus">+  _location: null,</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineplus">+  get location() {</span>
<a href="#l7.151"></a><span id="l7.151" class="difflineplus">+    return this._location;</span>
<a href="#l7.152"></a><span id="l7.152" class="difflineplus">+  },</span>
<a href="#l7.153"></a><span id="l7.153" class="difflineplus">+</span>
<a href="#l7.154"></a><span id="l7.154" class="difflineplus">+  set location(aLocation) {</span>
<a href="#l7.155"></a><span id="l7.155" class="difflineplus">+    if (!aLocation || this._location == aLocation)</span>
<a href="#l7.156"></a><span id="l7.156" class="difflineplus">+      return aLocation;</span>
<a href="#l7.157"></a><span id="l7.157" class="difflineplus">+</span>
<a href="#l7.158"></a><span id="l7.158" class="difflineplus">+    if (this.location) {</span>
<a href="#l7.159"></a><span id="l7.159" class="difflineplus">+      this._backHistory.unshift(this.location);</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineplus">+      this._forwardHistory.splice(0);</span>
<a href="#l7.161"></a><span id="l7.161" class="difflineplus">+    }</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineplus">+</span>
<a href="#l7.163"></a><span id="l7.163" class="difflineplus">+    this._location = aLocation;</span>
<a href="#l7.164"></a><span id="l7.164" class="difflineplus">+    this._places.selectPlaceURI(aLocation);</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineplus">+</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineplus">+    if (!this._places.hasSelection) {</span>
<a href="#l7.167"></a><span id="l7.167" class="difflineplus">+      // If no node was found for the given place: uri, just load it directly</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineplus">+      this._content.place = aLocation;</span>
<a href="#l7.169"></a><span id="l7.169" class="difflineplus">+    }</span>
<a href="#l7.170"></a><span id="l7.170" class="difflineplus">+    this.onContentTreeSelect();</span>
<a href="#l7.171"></a><span id="l7.171" class="difflineplus">+</span>
<a href="#l7.172"></a><span id="l7.172" class="difflineplus">+    // update navigation commands</span>
<a href="#l7.173"></a><span id="l7.173" class="difflineplus">+    if (this._backHistory.length == 0)</span>
<a href="#l7.174"></a><span id="l7.174" class="difflineplus">+      document.getElementById(&quot;OrganizerCommand:Back&quot;).setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l7.175"></a><span id="l7.175" class="difflineplus">+    else</span>
<a href="#l7.176"></a><span id="l7.176" class="difflineplus">+      document.getElementById(&quot;OrganizerCommand:Back&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l7.177"></a><span id="l7.177" class="difflineplus">+    if (this._forwardHistory.length == 0)</span>
<a href="#l7.178"></a><span id="l7.178" class="difflineplus">+      document.getElementById(&quot;OrganizerCommand:Forward&quot;).setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l7.179"></a><span id="l7.179" class="difflineplus">+    else</span>
<a href="#l7.180"></a><span id="l7.180" class="difflineplus">+      document.getElementById(&quot;OrganizerCommand:Forward&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l7.181"></a><span id="l7.181" class="difflineplus">+</span>
<a href="#l7.182"></a><span id="l7.182" class="difflineplus">+    return aLocation;</span>
<a href="#l7.183"></a><span id="l7.183" class="difflineplus">+  },</span>
<a href="#l7.184"></a><span id="l7.184" class="difflineplus">+</span>
<a href="#l7.185"></a><span id="l7.185" class="difflineplus">+  _backHistory: [],</span>
<a href="#l7.186"></a><span id="l7.186" class="difflineplus">+  _forwardHistory: [],</span>
<a href="#l7.187"></a><span id="l7.187" class="difflineplus">+</span>
<a href="#l7.188"></a><span id="l7.188" class="difflineplus">+  back: function PO_back() {</span>
<a href="#l7.189"></a><span id="l7.189" class="difflineplus">+    this._forwardHistory.unshift(this.location);</span>
<a href="#l7.190"></a><span id="l7.190" class="difflineplus">+    var historyEntry = this._backHistory.shift();</span>
<a href="#l7.191"></a><span id="l7.191" class="difflineplus">+    this._location = null;</span>
<a href="#l7.192"></a><span id="l7.192" class="difflineplus">+    this.location = historyEntry;</span>
<a href="#l7.193"></a><span id="l7.193" class="difflineplus">+  },</span>
<a href="#l7.194"></a><span id="l7.194" class="difflineplus">+  forward: function PO_forward() {</span>
<a href="#l7.195"></a><span id="l7.195" class="difflineplus">+    this._backHistory.unshift(this.location);</span>
<a href="#l7.196"></a><span id="l7.196" class="difflineplus">+    var historyEntry = this._forwardHistory.shift();</span>
<a href="#l7.197"></a><span id="l7.197" class="difflineplus">+    this._location = null;</span>
<a href="#l7.198"></a><span id="l7.198" class="difflineplus">+    this.location = historyEntry;</span>
<a href="#l7.199"></a><span id="l7.199" class="difflineplus">+  },</span>
<a href="#l7.200"></a><span id="l7.200"> </span>
<a href="#l7.201"></a><span id="l7.201" class="difflineminus">-  var titleString;</span>
<a href="#l7.202"></a><span id="l7.202" class="difflineplus">+  /**</span>
<a href="#l7.203"></a><span id="l7.203" class="difflineplus">+   * Called when a place folder is selected in the left pane.</span>
<a href="#l7.204"></a><span id="l7.204" class="difflineplus">+   * @param   resetSearchBox</span>
<a href="#l7.205"></a><span id="l7.205" class="difflineplus">+   *          true if the search box should also be reset, false otherwise.</span>
<a href="#l7.206"></a><span id="l7.206" class="difflineplus">+   *          The search box should be reset when a new folder in the left</span>
<a href="#l7.207"></a><span id="l7.207" class="difflineplus">+   *          pane is selected; the search scope and text need to be cleared in</span>
<a href="#l7.208"></a><span id="l7.208" class="difflineplus">+   *          preparation for the new folder.  Note that if the user manually</span>
<a href="#l7.209"></a><span id="l7.209" class="difflineplus">+   *          resets the search box, either by clicking its reset button or by</span>
<a href="#l7.210"></a><span id="l7.210" class="difflineplus">+   *          deleting its text, this will be false.</span>
<a href="#l7.211"></a><span id="l7.211" class="difflineplus">+   */</span>
<a href="#l7.212"></a><span id="l7.212" class="difflineplus">+  _cachedLeftPaneSelectedURI: null,</span>
<a href="#l7.213"></a><span id="l7.213" class="difflineplus">+  onPlaceSelected: function PO_onPlaceSelected(resetSearchBox) {</span>
<a href="#l7.214"></a><span id="l7.214" class="difflineplus">+    // Don't change the right-hand pane contents when there's no selection.</span>
<a href="#l7.215"></a><span id="l7.215" class="difflineplus">+    if (!this._places.hasSelection)</span>
<a href="#l7.216"></a><span id="l7.216" class="difflineplus">+      return;</span>
<a href="#l7.217"></a><span id="l7.217" class="difflineplus">+</span>
<a href="#l7.218"></a><span id="l7.218" class="difflineplus">+    var node = this._places.selectedNode;</span>
<a href="#l7.219"></a><span id="l7.219" class="difflineplus">+    var queries = PlacesUtils.asQuery(node).getQueries();</span>
<a href="#l7.220"></a><span id="l7.220" class="difflineplus">+</span>
<a href="#l7.221"></a><span id="l7.221" class="difflineplus">+    // Items are only excluded on the left pane.</span>
<a href="#l7.222"></a><span id="l7.222" class="difflineplus">+    var options = node.queryOptions.clone();</span>
<a href="#l7.223"></a><span id="l7.223" class="difflineplus">+    options.excludeItems = false;</span>
<a href="#l7.224"></a><span id="l7.224" class="difflineplus">+    var placeURI = PlacesUtils.history.queriesToQueryString(queries,</span>
<a href="#l7.225"></a><span id="l7.225" class="difflineplus">+                                                            queries.length,</span>
<a href="#l7.226"></a><span id="l7.226" class="difflineplus">+                                                            options);</span>
<a href="#l7.227"></a><span id="l7.227" class="difflineplus">+</span>
<a href="#l7.228"></a><span id="l7.228" class="difflineplus">+    // If either the place of the content tree in the right pane has changed or</span>
<a href="#l7.229"></a><span id="l7.229" class="difflineplus">+    // the user cleared the search box, update the place, hide the search UI,</span>
<a href="#l7.230"></a><span id="l7.230" class="difflineplus">+    // and update the back/forward buttons by setting location.</span>
<a href="#l7.231"></a><span id="l7.231" class="difflineplus">+    if (this._content.place != placeURI || !resetSearchBox) {</span>
<a href="#l7.232"></a><span id="l7.232" class="difflineplus">+      this._content.place = placeURI;</span>
<a href="#l7.233"></a><span id="l7.233" class="difflineplus">+      PlacesSearchBox.hideSearchUI();</span>
<a href="#l7.234"></a><span id="l7.234" class="difflineplus">+      this.location = node.uri;</span>
<a href="#l7.235"></a><span id="l7.235" class="difflineplus">+    }</span>
<a href="#l7.236"></a><span id="l7.236" class="difflineplus">+</span>
<a href="#l7.237"></a><span id="l7.237" class="difflineplus">+    // Update the selected folder title where it appears in the UI: the folder</span>
<a href="#l7.238"></a><span id="l7.238" class="difflineplus">+    // scope button, &quot;Find in &lt;current collection&gt;&quot; command, and the search box</span>
<a href="#l7.239"></a><span id="l7.239" class="difflineplus">+    // emptytext.  They must be updated even if the selection hasn't changed --</span>
<a href="#l7.240"></a><span id="l7.240" class="difflineplus">+    // specifically when node's title changes.  In that case a selection event</span>
<a href="#l7.241"></a><span id="l7.241" class="difflineplus">+    // is generated, this method is called, but the selection does not change.</span>
<a href="#l7.242"></a><span id="l7.242" class="difflineplus">+    var folderButton = document.getElementById(&quot;scopeBarFolder&quot;);</span>
<a href="#l7.243"></a><span id="l7.243" class="difflineplus">+    var folderTitle = node.title || folderButton.getAttribute(&quot;emptytitle&quot;);</span>
<a href="#l7.244"></a><span id="l7.244" class="difflineplus">+    folderButton.setAttribute(&quot;label&quot;, folderTitle);</span>
<a href="#l7.245"></a><span id="l7.245" class="difflineplus">+    var cmd = document.getElementById(&quot;OrganizerCommand_find:current&quot;);</span>
<a href="#l7.246"></a><span id="l7.246" class="difflineplus">+    var label = PlacesUIUtils.getFormattedString(&quot;findInPrefix&quot;, [folderTitle]);</span>
<a href="#l7.247"></a><span id="l7.247" class="difflineplus">+    cmd.setAttribute(&quot;label&quot;, label);</span>
<a href="#l7.248"></a><span id="l7.248" class="difflineplus">+    if (PlacesSearchBox.filterCollection == &quot;collection&quot;)</span>
<a href="#l7.249"></a><span id="l7.249" class="difflineplus">+      PlacesSearchBox.updateCollectionTitle(folderTitle);</span>
<a href="#l7.250"></a><span id="l7.250" class="difflineplus">+</span>
<a href="#l7.251"></a><span id="l7.251" class="difflineplus">+    // When we invalidate a container we use suppressSelectionEvent, when it is</span>
<a href="#l7.252"></a><span id="l7.252" class="difflineplus">+    // unset a select event is fired, in many cases the selection did not really</span>
<a href="#l7.253"></a><span id="l7.253" class="difflineplus">+    // change, so we should check for it, and return early in such a case. Note</span>
<a href="#l7.254"></a><span id="l7.254" class="difflineplus">+    // that we cannot return any earlier than this point, because when</span>
<a href="#l7.255"></a><span id="l7.255" class="difflineplus">+    // !resetSearchBox, we need to update location and hide the UI as above,</span>
<a href="#l7.256"></a><span id="l7.256" class="difflineplus">+    // even though the selection has not changed.</span>
<a href="#l7.257"></a><span id="l7.257" class="difflineplus">+    if (node.uri == this._cachedLeftPaneSelectedURI)</span>
<a href="#l7.258"></a><span id="l7.258" class="difflineplus">+      return;</span>
<a href="#l7.259"></a><span id="l7.259" class="difflineplus">+    this._cachedLeftPaneSelectedURI = node.uri;</span>
<a href="#l7.260"></a><span id="l7.260" class="difflineplus">+</span>
<a href="#l7.261"></a><span id="l7.261" class="difflineplus">+    // At this point, resetSearchBox is true, because the left pane selection</span>
<a href="#l7.262"></a><span id="l7.262" class="difflineplus">+    // has changed; otherwise we would have returned earlier.</span>
<a href="#l7.263"></a><span id="l7.263" class="difflineplus">+</span>
<a href="#l7.264"></a><span id="l7.264" class="difflineplus">+    PlacesSearchBox.searchFilter.reset();</span>
<a href="#l7.265"></a><span id="l7.265" class="difflineplus">+    this._setSearchScopeForNode(node);</span>
<a href="#l7.266"></a><span id="l7.266" class="difflineplus">+    if (this._places.treeBoxObject.focused)</span>
<a href="#l7.267"></a><span id="l7.267" class="difflineplus">+      this._fillDetailsPane([node]);</span>
<a href="#l7.268"></a><span id="l7.268" class="difflineplus">+  },</span>
<a href="#l7.269"></a><span id="l7.269" class="difflineplus">+</span>
<a href="#l7.270"></a><span id="l7.270" class="difflineplus">+  /**</span>
<a href="#l7.271"></a><span id="l7.271" class="difflineplus">+   * Sets the search scope based on aNode's properties.</span>
<a href="#l7.272"></a><span id="l7.272" class="difflineplus">+   * @param   aNode</span>
<a href="#l7.273"></a><span id="l7.273" class="difflineplus">+   *          the node to set up scope from</span>
<a href="#l7.274"></a><span id="l7.274" class="difflineplus">+   */</span>
<a href="#l7.275"></a><span id="l7.275" class="difflineplus">+  _setSearchScopeForNode: function PO__setScopeForNode(aNode) {</span>
<a href="#l7.276"></a><span id="l7.276" class="difflineplus">+    var itemId = aNode.itemId;</span>
<a href="#l7.277"></a><span id="l7.277" class="difflineplus">+    PlacesQueryBuilder.setScope(&quot;bookmarks&quot;);</span>
<a href="#l7.278"></a><span id="l7.278" class="difflineplus">+</span>
<a href="#l7.279"></a><span id="l7.279" class="difflineplus">+    // Enable or disable the folder scope button.</span>
<a href="#l7.280"></a><span id="l7.280" class="difflineplus">+    var folderButton = document.getElementById(&quot;scopeBarFolder&quot;);</span>
<a href="#l7.281"></a><span id="l7.281" class="difflineplus">+    folderButton.hidden = !PlacesUtils.nodeIsFolder(aNode) ||</span>
<a href="#l7.282"></a><span id="l7.282" class="difflineplus">+                          itemId == PlacesUIUtils.allBookmarksFolderId;</span>
<a href="#l7.283"></a><span id="l7.283" class="difflineplus">+  },</span>
<a href="#l7.284"></a><span id="l7.284" class="difflineplus">+</span>
<a href="#l7.285"></a><span id="l7.285" class="difflineplus">+  /**</span>
<a href="#l7.286"></a><span id="l7.286" class="difflineplus">+   * Handle clicks on the tree.</span>
<a href="#l7.287"></a><span id="l7.287" class="difflineplus">+   * Single Left click, right click or modified click do not result in any</span>
<a href="#l7.288"></a><span id="l7.288" class="difflineplus">+   * special action, since they're related to selection.</span>
<a href="#l7.289"></a><span id="l7.289" class="difflineplus">+   * @param   aEvent</span>
<a href="#l7.290"></a><span id="l7.290" class="difflineplus">+   *          The mouse event.</span>
<a href="#l7.291"></a><span id="l7.291" class="difflineplus">+   */</span>
<a href="#l7.292"></a><span id="l7.292" class="difflineplus">+  onTreeClick: function PO_onTreeClick(aEvent) {</span>
<a href="#l7.293"></a><span id="l7.293" class="difflineplus">+    // Only handle clicks on tree children.</span>
<a href="#l7.294"></a><span id="l7.294" class="difflineplus">+    if (aEvent.target.localName != &quot;treechildren&quot;)</span>
<a href="#l7.295"></a><span id="l7.295" class="difflineplus">+      return;</span>
<a href="#l7.296"></a><span id="l7.296" class="difflineplus">+</span>
<a href="#l7.297"></a><span id="l7.297" class="difflineplus">+    var currentView = aEvent.currentTarget;</span>
<a href="#l7.298"></a><span id="l7.298" class="difflineplus">+    var selectedNode = currentView.selectedNode;</span>
<a href="#l7.299"></a><span id="l7.299" class="difflineplus">+    if (selectedNode) {</span>
<a href="#l7.300"></a><span id="l7.300" class="difflineplus">+      // might be worth to ensure that double-click onley works in placeContent</span>
<a href="#l7.301"></a><span id="l7.301" class="difflineplus">+      var doubleClick = (aEvent.button == 0 &amp;&amp; aEvent.detail == 2);</span>
<a href="#l7.302"></a><span id="l7.302" class="difflineplus">+      var middleClick = (aEvent.button == 1 &amp;&amp; aEvent.detail == 1);</span>
<a href="#l7.303"></a><span id="l7.303" class="difflineplus">+</span>
<a href="#l7.304"></a><span id="l7.304" class="difflineplus">+      if (PlacesUtils.nodeIsURI(selectedNode) &amp;&amp;</span>
<a href="#l7.305"></a><span id="l7.305" class="difflineplus">+          (doubleClick || middleClick)) {</span>
<a href="#l7.306"></a><span id="l7.306" class="difflineplus">+        // Open associated uri in the browser.</span>
<a href="#l7.307"></a><span id="l7.307" class="difflineplus">+        PlacesOrganizer.openSelectedNode(aEvent);</span>
<a href="#l7.308"></a><span id="l7.308" class="difflineplus">+      }</span>
<a href="#l7.309"></a><span id="l7.309" class="difflineplus">+      else if (middleClick &amp;&amp;</span>
<a href="#l7.310"></a><span id="l7.310" class="difflineplus">+               PlacesUtils.nodeIsContainer(selectedNode)) {</span>
<a href="#l7.311"></a><span id="l7.311" class="difflineplus">+        // The command execution function will take care of seeing if the</span>
<a href="#l7.312"></a><span id="l7.312" class="difflineplus">+        // selection is a folder or a different container type, and will</span>
<a href="#l7.313"></a><span id="l7.313" class="difflineplus">+        // load its contents in tabs.</span>
<a href="#l7.314"></a><span id="l7.314" class="difflineplus">+        PlacesUIUtils.openContainerNodeInTabs(selectedNode, aEvent);</span>
<a href="#l7.315"></a><span id="l7.315" class="difflineplus">+      }</span>
<a href="#l7.316"></a><span id="l7.316" class="difflineplus">+    }</span>
<a href="#l7.317"></a><span id="l7.317" class="difflineplus">+  },</span>
<a href="#l7.318"></a><span id="l7.318" class="difflineplus">+</span>
<a href="#l7.319"></a><span id="l7.319" class="difflineplus">+  /**</span>
<a href="#l7.320"></a><span id="l7.320" class="difflineplus">+   * Handle focus changes on the trees.</span>
<a href="#l7.321"></a><span id="l7.321" class="difflineplus">+   * When moving focus between panes we should update the details pane contents.</span>
<a href="#l7.322"></a><span id="l7.322" class="difflineplus">+   * @param   aEvent</span>
<a href="#l7.323"></a><span id="l7.323" class="difflineplus">+   *          The mouse event.</span>
<a href="#l7.324"></a><span id="l7.324" class="difflineplus">+   */</span>
<a href="#l7.325"></a><span id="l7.325" class="difflineplus">+  onTreeFocus: function PO_onTreeFocus(aEvent) {</span>
<a href="#l7.326"></a><span id="l7.326" class="difflineplus">+    var currentView = aEvent.currentTarget;</span>
<a href="#l7.327"></a><span id="l7.327" class="difflineplus">+    var selectedNodes = currentView.selectedNode ? [currentView.selectedNode] :</span>
<a href="#l7.328"></a><span id="l7.328" class="difflineplus">+                        this._content.selectedNodes;</span>
<a href="#l7.329"></a><span id="l7.329" class="difflineplus">+    this._fillDetailsPane(selectedNodes);</span>
<a href="#l7.330"></a><span id="l7.330" class="difflineplus">+  },</span>
<a href="#l7.331"></a><span id="l7.331" class="difflineplus">+</span>
<a href="#l7.332"></a><span id="l7.332" class="difflineplus">+  openFlatContainer: function PO_openFlatContainerFlatContainer(aContainer) {</span>
<a href="#l7.333"></a><span id="l7.333" class="difflineplus">+    if (aContainer.itemId != -1)</span>
<a href="#l7.334"></a><span id="l7.334" class="difflineplus">+      this._places.selectItems([aContainer.itemId]);</span>
<a href="#l7.335"></a><span id="l7.335" class="difflineplus">+    else if (PlacesUtils.nodeIsQuery(aContainer))</span>
<a href="#l7.336"></a><span id="l7.336" class="difflineplus">+      this._places.selectPlaceURI(aContainer.uri);</span>
<a href="#l7.337"></a><span id="l7.337" class="difflineplus">+  },</span>
<a href="#l7.338"></a><span id="l7.338" class="difflineplus">+</span>
<a href="#l7.339"></a><span id="l7.339" class="difflineplus">+  openSelectedNode: function PO_openSelectedNode(aEvent) {</span>
<a href="#l7.340"></a><span id="l7.340" class="difflineplus">+    PlacesUIUtils.openNodeWithEvent(this._content.selectedNode, aEvent);</span>
<a href="#l7.341"></a><span id="l7.341" class="difflineplus">+  },</span>
<a href="#l7.342"></a><span id="l7.342" class="difflineplus">+</span>
<a href="#l7.343"></a><span id="l7.343" class="difflineplus">+  /**</span>
<a href="#l7.344"></a><span id="l7.344" class="difflineplus">+   * Returns the options associated with the query currently loaded in the</span>
<a href="#l7.345"></a><span id="l7.345" class="difflineplus">+   * main places pane.</span>
<a href="#l7.346"></a><span id="l7.346" class="difflineplus">+   */</span>
<a href="#l7.347"></a><span id="l7.347" class="difflineplus">+  getCurrentOptions: function PO_getCurrentOptions() {</span>
<a href="#l7.348"></a><span id="l7.348" class="difflineplus">+    return PlacesUtils.asQuery(this._content.result.root).queryOptions;</span>
<a href="#l7.349"></a><span id="l7.349" class="difflineplus">+  },</span>
<a href="#l7.350"></a><span id="l7.350" class="difflineplus">+</span>
<a href="#l7.351"></a><span id="l7.351" class="difflineplus">+  /**</span>
<a href="#l7.352"></a><span id="l7.352" class="difflineplus">+   * Returns the queries associated with the query currently loaded in the</span>
<a href="#l7.353"></a><span id="l7.353" class="difflineplus">+   * main places pane.</span>
<a href="#l7.354"></a><span id="l7.354" class="difflineplus">+   */</span>
<a href="#l7.355"></a><span id="l7.355" class="difflineplus">+  getCurrentQueries: function PO_getCurrentQueries() {</span>
<a href="#l7.356"></a><span id="l7.356" class="difflineplus">+    return PlacesUtils.asQuery(this._content.result.root).getQueries();</span>
<a href="#l7.357"></a><span id="l7.357" class="difflineplus">+  },</span>
<a href="#l7.358"></a><span id="l7.358" class="difflineplus">+</span>
<a href="#l7.359"></a><span id="l7.359" class="difflineplus">+  /**</span>
<a href="#l7.360"></a><span id="l7.360" class="difflineplus">+   * Show the migration wizard for importing from a file.</span>
<a href="#l7.361"></a><span id="l7.361" class="difflineplus">+   */</span>
<a href="#l7.362"></a><span id="l7.362" class="difflineplus">+  importBookmarks: function PO_import() {</span>
<a href="#l7.363"></a><span id="l7.363" class="difflineplus">+    // XXX: ifdef it to be non-modal (non-&quot;sheet&quot;) on mac (see bug 259039)</span>
<a href="#l7.364"></a><span id="l7.364" class="difflineplus">+    var features = &quot;modal,centerscreen,chrome,resizable=no&quot;;</span>
<a href="#l7.365"></a><span id="l7.365"> </span>
<a href="#l7.366"></a><span id="l7.366" class="difflineminus">-  // If we've been opened with a parameter, root the tree on it.</span>
<a href="#l7.367"></a><span id="l7.367" class="difflineminus">-  if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0]) {</span>
<a href="#l7.368"></a><span id="l7.368" class="difflineminus">-    var title;</span>
<a href="#l7.369"></a><span id="l7.369" class="difflineminus">-    var uri = window.arguments[0];</span>
<a href="#l7.370"></a><span id="l7.370" class="difflineminus">-    bookmarksView.tree.setAttribute(&quot;ref&quot;, uri);</span>
<a href="#l7.371"></a><span id="l7.371" class="difflineminus">-    document.getElementById(&quot;bookmarks-search-box&quot;).hidden = true;</span>
<a href="#l7.372"></a><span id="l7.372" class="difflineminus">-    if (uri.substring(0,5) == &quot;find:&quot;) {</span>
<a href="#l7.373"></a><span id="l7.373" class="difflineminus">-      title = BookmarksUtils.getLocaleString(&quot;search_results_title&quot;);</span>
<a href="#l7.374"></a><span id="l7.374" class="difflineminus">-      // Update the windowtype so that future searches are directed </span>
<a href="#l7.375"></a><span id="l7.375" class="difflineminus">-      // there and the window is not re-used for bookmarks. </span>
<a href="#l7.376"></a><span id="l7.376" class="difflineminus">-      windowNode.setAttribute(&quot;windowtype&quot;, &quot;bookmarks:searchresults&quot;);</span>
<a href="#l7.377"></a><span id="l7.377" class="difflineplus">+    // The migrator window will set this to true when it closes, if the user</span>
<a href="#l7.378"></a><span id="l7.378" class="difflineplus">+    // chose to migrate from a specific file.</span>
<a href="#l7.379"></a><span id="l7.379" class="difflineplus">+    window.fromFile = false;</span>
<a href="#l7.380"></a><span id="l7.380" class="difflineplus">+    openDialog(&quot;chrome://communicator/content/migration/migration.xul&quot;,</span>
<a href="#l7.381"></a><span id="l7.381" class="difflineplus">+               &quot;migration&quot;, features, &quot;bookmarks&quot;);</span>
<a href="#l7.382"></a><span id="l7.382" class="difflineplus">+    if (window.fromFile)</span>
<a href="#l7.383"></a><span id="l7.383" class="difflineplus">+      this.importFromFile();</span>
<a href="#l7.384"></a><span id="l7.384" class="difflineplus">+  },</span>
<a href="#l7.385"></a><span id="l7.385" class="difflineplus">+</span>
<a href="#l7.386"></a><span id="l7.386" class="difflineplus">+  /**</span>
<a href="#l7.387"></a><span id="l7.387" class="difflineplus">+   * Open a file-picker and import the selected file into the bookmarks store</span>
<a href="#l7.388"></a><span id="l7.388" class="difflineplus">+   */</span>
<a href="#l7.389"></a><span id="l7.389" class="difflineplus">+  importFromFile: function PO_importFromFile() {</span>
<a href="#l7.390"></a><span id="l7.390" class="difflineplus">+    var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l7.391"></a><span id="l7.391" class="difflineplus">+                       .createInstance(Components.interfaces.nsIFilePicker);</span>
<a href="#l7.392"></a><span id="l7.392" class="difflineplus">+    fp.init(window, PlacesUIUtils.getString(&quot;SelectImport&quot;),</span>
<a href="#l7.393"></a><span id="l7.393" class="difflineplus">+            Components.interfaces.nsIFilePicker.modeOpen);</span>
<a href="#l7.394"></a><span id="l7.394" class="difflineplus">+    fp.appendFilters(Components.interfaces.nsIFilePicker.filterHTML);</span>
<a href="#l7.395"></a><span id="l7.395" class="difflineplus">+    if (fp.show() != Components.interfaces.nsIFilePicker.returnCancel) {</span>
<a href="#l7.396"></a><span id="l7.396" class="difflineplus">+      if (fp.file) {</span>
<a href="#l7.397"></a><span id="l7.397" class="difflineplus">+        var importer = Components.classes[&quot;@mozilla.org/browser/places/import-export-service;1&quot;]</span>
<a href="#l7.398"></a><span id="l7.398" class="difflineplus">+                                 .getService(Components.interfaces.nsIPlacesImportExportService);</span>
<a href="#l7.399"></a><span id="l7.399" class="difflineplus">+        importer.importHTMLFromFile(fp.file, false);</span>
<a href="#l7.400"></a><span id="l7.400" class="difflineplus">+      }</span>
<a href="#l7.401"></a><span id="l7.401" class="difflineplus">+    }</span>
<a href="#l7.402"></a><span id="l7.402" class="difflineplus">+  },</span>
<a href="#l7.403"></a><span id="l7.403" class="difflineplus">+</span>
<a href="#l7.404"></a><span id="l7.404" class="difflineplus">+  /**</span>
<a href="#l7.405"></a><span id="l7.405" class="difflineplus">+   * Allows simple exporting of bookmarks.</span>
<a href="#l7.406"></a><span id="l7.406" class="difflineplus">+   */</span>
<a href="#l7.407"></a><span id="l7.407" class="difflineplus">+  exportBookmarks: function PO_exportBookmarks() {</span>
<a href="#l7.408"></a><span id="l7.408" class="difflineplus">+    var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l7.409"></a><span id="l7.409" class="difflineplus">+                       .createInstance(Components.interfaces.nsIFilePicker);</span>
<a href="#l7.410"></a><span id="l7.410" class="difflineplus">+    fp.init(window, PlacesUIUtils.getString(&quot;EnterExport&quot;),</span>
<a href="#l7.411"></a><span id="l7.411" class="difflineplus">+            Components.interfaces.nsIFilePicker.modeSave);</span>
<a href="#l7.412"></a><span id="l7.412" class="difflineplus">+    fp.appendFilters(Components.interfaces.nsIFilePicker.filterHTML);</span>
<a href="#l7.413"></a><span id="l7.413" class="difflineplus">+    fp.defaultString = &quot;bookmarks.html&quot;;</span>
<a href="#l7.414"></a><span id="l7.414" class="difflineplus">+    if (fp.show() != Components.interfaces.nsIFilePicker.returnCancel) {</span>
<a href="#l7.415"></a><span id="l7.415" class="difflineplus">+      var exporter = Components.classes[&quot;@mozilla.org/browser/places/import-export-service;1&quot;]</span>
<a href="#l7.416"></a><span id="l7.416" class="difflineplus">+                               .getService(Components.interfaces.nsIPlacesImportExportService);</span>
<a href="#l7.417"></a><span id="l7.417" class="difflineplus">+      exporter.exportHTMLToFile(fp.file);</span>
<a href="#l7.418"></a><span id="l7.418" class="difflineplus">+    }</span>
<a href="#l7.419"></a><span id="l7.419" class="difflineplus">+  },</span>
<a href="#l7.420"></a><span id="l7.420" class="difflineplus">+</span>
<a href="#l7.421"></a><span id="l7.421" class="difflineplus">+  /**</span>
<a href="#l7.422"></a><span id="l7.422" class="difflineplus">+   * Populates the restore menu with the dates of the backups available.</span>
<a href="#l7.423"></a><span id="l7.423" class="difflineplus">+   */</span>
<a href="#l7.424"></a><span id="l7.424" class="difflineplus">+  populateRestoreMenu: function PO_populateRestoreMenu() {</span>
<a href="#l7.425"></a><span id="l7.425" class="difflineplus">+    let restorePopup = document.getElementById(&quot;fileRestorePopup&quot;);</span>
<a href="#l7.426"></a><span id="l7.426" class="difflineplus">+</span>
<a href="#l7.427"></a><span id="l7.427" class="difflineplus">+    let dateSvc = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l7.428"></a><span id="l7.428" class="difflineplus">+                            .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l7.429"></a><span id="l7.429" class="difflineplus">+</span>
<a href="#l7.430"></a><span id="l7.430" class="difflineplus">+    // Remove existing menu items.  Last item is the restoreFromFile item.</span>
<a href="#l7.431"></a><span id="l7.431" class="difflineplus">+    while (restorePopup.childNodes.length &gt; 1)</span>
<a href="#l7.432"></a><span id="l7.432" class="difflineplus">+      restorePopup.removeChild(restorePopup.firstChild);</span>
<a href="#l7.433"></a><span id="l7.433" class="difflineplus">+</span>
<a href="#l7.434"></a><span id="l7.434" class="difflineplus">+    let backupFiles = PlacesUtils.backups.entries;</span>
<a href="#l7.435"></a><span id="l7.435" class="difflineplus">+    if (backupFiles.length == 0)</span>
<a href="#l7.436"></a><span id="l7.436" class="difflineplus">+      return;</span>
<a href="#l7.437"></a><span id="l7.437" class="difflineplus">+</span>
<a href="#l7.438"></a><span id="l7.438" class="difflineplus">+    // Populate menu with backups.</span>
<a href="#l7.439"></a><span id="l7.439" class="difflineplus">+    for (let i = 0; i &lt; backupFiles.length; i++) {</span>
<a href="#l7.440"></a><span id="l7.440" class="difflineplus">+      let backupDate = PlacesUtils.backups.getDateForFile(backupFiles[i]);</span>
<a href="#l7.441"></a><span id="l7.441" class="difflineplus">+      let m = restorePopup.insertBefore(document.createElement(&quot;menuitem&quot;),</span>
<a href="#l7.442"></a><span id="l7.442" class="difflineplus">+                                        document.getElementById(&quot;restoreFromFile&quot;));</span>
<a href="#l7.443"></a><span id="l7.443" class="difflineplus">+      m.setAttribute(&quot;label&quot;,</span>
<a href="#l7.444"></a><span id="l7.444" class="difflineplus">+                     dateSvc.FormatDate(&quot;&quot;,</span>
<a href="#l7.445"></a><span id="l7.445" class="difflineplus">+                                        Components.interfaces.nsIScriptableDateFormat.dateFormatLong,</span>
<a href="#l7.446"></a><span id="l7.446" class="difflineplus">+                                        backupDate.getFullYear(),</span>
<a href="#l7.447"></a><span id="l7.447" class="difflineplus">+                                        backupDate.getMonth() + 1,</span>
<a href="#l7.448"></a><span id="l7.448" class="difflineplus">+                                        backupDate.getDate()));</span>
<a href="#l7.449"></a><span id="l7.449" class="difflineplus">+      m.setAttribute(&quot;value&quot;, backupFiles[i].leafName);</span>
<a href="#l7.450"></a><span id="l7.450" class="difflineplus">+      m.setAttribute(&quot;oncommand&quot;,</span>
<a href="#l7.451"></a><span id="l7.451" class="difflineplus">+                     &quot;PlacesOrganizer.onRestoreMenuItemClick(this);&quot;);</span>
<a href="#l7.452"></a><span id="l7.452" class="difflineplus">+    }</span>
<a href="#l7.453"></a><span id="l7.453" class="difflineplus">+</span>
<a href="#l7.454"></a><span id="l7.454" class="difflineplus">+    // Add the restoreFromFile item.</span>
<a href="#l7.455"></a><span id="l7.455" class="difflineplus">+    restorePopup.insertBefore(document.createElement(&quot;menuseparator&quot;),</span>
<a href="#l7.456"></a><span id="l7.456" class="difflineplus">+                              document.getElementById(&quot;restoreFromFile&quot;));</span>
<a href="#l7.457"></a><span id="l7.457" class="difflineplus">+  },</span>
<a href="#l7.458"></a><span id="l7.458" class="difflineplus">+</span>
<a href="#l7.459"></a><span id="l7.459" class="difflineplus">+  /**</span>
<a href="#l7.460"></a><span id="l7.460" class="difflineplus">+   * Called when a menuitem is selected from the restore menu.</span>
<a href="#l7.461"></a><span id="l7.461" class="difflineplus">+   */</span>
<a href="#l7.462"></a><span id="l7.462" class="difflineplus">+  onRestoreMenuItemClick: function PO_onRestoreMenuItemClick(aMenuItem) {</span>
<a href="#l7.463"></a><span id="l7.463" class="difflineplus">+    let backupName = aMenuItem.getAttribute(&quot;value&quot;);</span>
<a href="#l7.464"></a><span id="l7.464" class="difflineplus">+    let backupFiles = PlacesUtils.backups.entries;</span>
<a href="#l7.465"></a><span id="l7.465" class="difflineplus">+    for (let i = 0; i &lt; backupFiles.length; i++) {</span>
<a href="#l7.466"></a><span id="l7.466" class="difflineplus">+      if (backupFiles[i].leafName == backupName) {</span>
<a href="#l7.467"></a><span id="l7.467" class="difflineplus">+        this.restoreBookmarksFromFile(backupFiles[i]);</span>
<a href="#l7.468"></a><span id="l7.468" class="difflineplus">+        break;</span>
<a href="#l7.469"></a><span id="l7.469" class="difflineplus">+      }</span>
<a href="#l7.470"></a><span id="l7.470" class="difflineplus">+    }</span>
<a href="#l7.471"></a><span id="l7.471" class="difflineplus">+  },</span>
<a href="#l7.472"></a><span id="l7.472" class="difflineplus">+</span>
<a href="#l7.473"></a><span id="l7.473" class="difflineplus">+  /**</span>
<a href="#l7.474"></a><span id="l7.474" class="difflineplus">+   * Called when 'Choose File...' is selected from the restore menu.</span>
<a href="#l7.475"></a><span id="l7.475" class="difflineplus">+   * Prompts for a file and restores bookmarks to those in the file.</span>
<a href="#l7.476"></a><span id="l7.476" class="difflineplus">+   */</span>
<a href="#l7.477"></a><span id="l7.477" class="difflineplus">+  onRestoreBookmarksFromFile: function PO_onRestoreBookmarksFromFile() {</span>
<a href="#l7.478"></a><span id="l7.478" class="difflineplus">+    var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l7.479"></a><span id="l7.479" class="difflineplus">+                       .createInstance(Components.interfaces.nsIFilePicker);</span>
<a href="#l7.480"></a><span id="l7.480" class="difflineplus">+    fp.init(window, PlacesUIUtils.getString(&quot;bookmarksRestoreTitle&quot;),</span>
<a href="#l7.481"></a><span id="l7.481" class="difflineplus">+            Components.interfaces.nsIFilePicker.modeOpen);</span>
<a href="#l7.482"></a><span id="l7.482" class="difflineplus">+    fp.appendFilter(PlacesUIUtils.getString(&quot;bookmarksRestoreFilterName&quot;),</span>
<a href="#l7.483"></a><span id="l7.483" class="difflineplus">+                    PlacesUIUtils.getString(&quot;bookmarksRestoreFilterExtension&quot;));</span>
<a href="#l7.484"></a><span id="l7.484" class="difflineplus">+    fp.appendFilters(Components.interfaces.nsIFilePicker.filterAll);</span>
<a href="#l7.485"></a><span id="l7.485" class="difflineplus">+</span>
<a href="#l7.486"></a><span id="l7.486" class="difflineplus">+    var dirSvc = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l7.487"></a><span id="l7.487" class="difflineplus">+                           .getService(Components.interfaces.nsIProperties);</span>
<a href="#l7.488"></a><span id="l7.488" class="difflineplus">+    var backupsDir = dirSvc.get(&quot;Desk&quot;, Components.interfaces.nsILocalFile);</span>
<a href="#l7.489"></a><span id="l7.489" class="difflineplus">+    fp.displayDirectory = backupsDir;</span>
<a href="#l7.490"></a><span id="l7.490" class="difflineplus">+</span>
<a href="#l7.491"></a><span id="l7.491" class="difflineplus">+    if (fp.show() != Components.interfaces.nsIFilePicker.returnCancel)</span>
<a href="#l7.492"></a><span id="l7.492" class="difflineplus">+      this.restoreBookmarksFromFile(fp.file);</span>
<a href="#l7.493"></a><span id="l7.493" class="difflineplus">+  },</span>
<a href="#l7.494"></a><span id="l7.494" class="difflineplus">+</span>
<a href="#l7.495"></a><span id="l7.495" class="difflineplus">+  /**</span>
<a href="#l7.496"></a><span id="l7.496" class="difflineplus">+   * Restores bookmarks from a JSON file.</span>
<a href="#l7.497"></a><span id="l7.497" class="difflineplus">+   */</span>
<a href="#l7.498"></a><span id="l7.498" class="difflineplus">+  restoreBookmarksFromFile: function PO_restoreBookmarksFromFile(aFile) {</span>
<a href="#l7.499"></a><span id="l7.499" class="difflineplus">+    // check file extension</span>
<a href="#l7.500"></a><span id="l7.500" class="difflineplus">+    if (!aFile.leafName.match(/\.json$/)) {</span>
<a href="#l7.501"></a><span id="l7.501" class="difflineplus">+      this._showErrorAlert(PlacesUIUtils.getString(&quot;bookmarksRestoreFormatError&quot;));</span>
<a href="#l7.502"></a><span id="l7.502" class="difflineplus">+      return;</span>
<a href="#l7.503"></a><span id="l7.503" class="difflineplus">+    }</span>
<a href="#l7.504"></a><span id="l7.504" class="difflineplus">+</span>
<a href="#l7.505"></a><span id="l7.505" class="difflineplus">+    // confirm ok to delete existing bookmarks</span>
<a href="#l7.506"></a><span id="l7.506" class="difflineplus">+    var prompts = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l7.507"></a><span id="l7.507" class="difflineplus">+                            .getService(Components.interfaces.nsIPromptService);</span>
<a href="#l7.508"></a><span id="l7.508" class="difflineplus">+    if (!prompts.confirm(null,</span>
<a href="#l7.509"></a><span id="l7.509" class="difflineplus">+                         PlacesUIUtils.getString(&quot;bookmarksRestoreAlertTitle&quot;),</span>
<a href="#l7.510"></a><span id="l7.510" class="difflineplus">+                         PlacesUIUtils.getString(&quot;bookmarksRestoreAlert&quot;)))</span>
<a href="#l7.511"></a><span id="l7.511" class="difflineplus">+      return;</span>
<a href="#l7.512"></a><span id="l7.512" class="difflineplus">+</span>
<a href="#l7.513"></a><span id="l7.513" class="difflineplus">+    try {</span>
<a href="#l7.514"></a><span id="l7.514" class="difflineplus">+      PlacesUtils.restoreBookmarksFromJSONFile(aFile);</span>
<a href="#l7.515"></a><span id="l7.515" class="difflineplus">+    }</span>
<a href="#l7.516"></a><span id="l7.516" class="difflineplus">+    catch(ex) {</span>
<a href="#l7.517"></a><span id="l7.517" class="difflineplus">+      this._showErrorAlert(PlacesUIUtils.getString(&quot;bookmarksRestoreParseError&quot;));</span>
<a href="#l7.518"></a><span id="l7.518">     }</span>
<a href="#l7.519"></a><span id="l7.519" class="difflineminus">-    else</span>
<a href="#l7.520"></a><span id="l7.520" class="difflineminus">-      title = BookmarksUtils.getProperty(window.arguments[0], NC_NS+&quot;Name&quot;);</span>
<a href="#l7.521"></a><span id="l7.521" class="difflineminus">-    </span>
<a href="#l7.522"></a><span id="l7.522" class="difflineminus">-    titleString = BookmarksUtils.getLocaleString(&quot;window_title&quot;, title);</span>
<a href="#l7.523"></a><span id="l7.523" class="difflineminus">-  }</span>
<a href="#l7.524"></a><span id="l7.524" class="difflineminus">-  else {</span>
<a href="#l7.525"></a><span id="l7.525" class="difflineminus">-    titleString = BookmarksUtils.getLocaleString(&quot;bookmarks_title&quot;, title);</span>
<a href="#l7.526"></a><span id="l7.526" class="difflineminus">-    // always open the bookmark top root folder</span>
<a href="#l7.527"></a><span id="l7.527" class="difflineminus">-    if (!bookmarksView.treeBoxObject.view.isContainerOpen(0))</span>
<a href="#l7.528"></a><span id="l7.528" class="difflineminus">-      bookmarksView.treeBoxObject.view.toggleOpenState(0);</span>
<a href="#l7.529"></a><span id="l7.529" class="difflineminus">-  }</span>
<a href="#l7.530"></a><span id="l7.530" class="difflineplus">+  },</span>
<a href="#l7.531"></a><span id="l7.531" class="difflineplus">+</span>
<a href="#l7.532"></a><span id="l7.532" class="difflineplus">+  _showErrorAlert: function PO__showErrorAlert(aMsg) {</span>
<a href="#l7.533"></a><span id="l7.533" class="difflineplus">+    var brandShortName = document.getElementById(&quot;brandStrings&quot;)</span>
<a href="#l7.534"></a><span id="l7.534" class="difflineplus">+                                 .getString(&quot;brandShortName&quot;);</span>
<a href="#l7.535"></a><span id="l7.535" class="difflineplus">+</span>
<a href="#l7.536"></a><span id="l7.536" class="difflineplus">+    Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l7.537"></a><span id="l7.537" class="difflineplus">+              .getService(Components.interfaces.nsIPromptService)</span>
<a href="#l7.538"></a><span id="l7.538" class="difflineplus">+              .alert(window, brandShortName, aMsg);</span>
<a href="#l7.539"></a><span id="l7.539" class="difflineplus">+  },</span>
<a href="#l7.540"></a><span id="l7.540" class="difflineplus">+</span>
<a href="#l7.541"></a><span id="l7.541" class="difflineplus">+  /**</span>
<a href="#l7.542"></a><span id="l7.542" class="difflineplus">+   * Backup bookmarks to desktop, auto-generate a filename with a date.</span>
<a href="#l7.543"></a><span id="l7.543" class="difflineplus">+   * The file is a JSON serialization of bookmarks, tags and any annotations</span>
<a href="#l7.544"></a><span id="l7.544" class="difflineplus">+   * of those items.</span>
<a href="#l7.545"></a><span id="l7.545" class="difflineplus">+   */</span>
<a href="#l7.546"></a><span id="l7.546" class="difflineplus">+  backupBookmarks: function PO_backupBookmarks() {</span>
<a href="#l7.547"></a><span id="l7.547" class="difflineplus">+    var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l7.548"></a><span id="l7.548" class="difflineplus">+                       .createInstance(Components.interfaces.nsIFilePicker);</span>
<a href="#l7.549"></a><span id="l7.549" class="difflineplus">+    fp.init(window, PlacesUIUtils.getString(&quot;bookmarksBackupTitle&quot;),</span>
<a href="#l7.550"></a><span id="l7.550" class="difflineplus">+            Components.interfaces.nsIFilePicker.modeSave);</span>
<a href="#l7.551"></a><span id="l7.551" class="difflineplus">+    fp.appendFilter(PlacesUIUtils.getString(&quot;bookmarksRestoreFilterName&quot;),</span>
<a href="#l7.552"></a><span id="l7.552" class="difflineplus">+                    PlacesUIUtils.getString(&quot;bookmarksRestoreFilterExtension&quot;));</span>
<a href="#l7.553"></a><span id="l7.553" class="difflineplus">+</span>
<a href="#l7.554"></a><span id="l7.554" class="difflineplus">+    var dirSvc = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l7.555"></a><span id="l7.555" class="difflineplus">+                           .getService(Components.interfaces.nsIProperties);</span>
<a href="#l7.556"></a><span id="l7.556" class="difflineplus">+    var backupsDir = dirSvc.get(&quot;Desk&quot;, Components.interfaces.nsILocalFile);</span>
<a href="#l7.557"></a><span id="l7.557" class="difflineplus">+    fp.displayDirectory = backupsDir;</span>
<a href="#l7.558"></a><span id="l7.558" class="difflineplus">+</span>
<a href="#l7.559"></a><span id="l7.559" class="difflineplus">+    fp.defaultString = PlacesUtils.backups.getFilenameForDate();</span>
<a href="#l7.560"></a><span id="l7.560" class="difflineplus">+</span>
<a href="#l7.561"></a><span id="l7.561" class="difflineplus">+    if (fp.show() != Components.interfaces.nsIFilePicker.returnCancel)</span>
<a href="#l7.562"></a><span id="l7.562" class="difflineplus">+      PlacesUtils.backups.saveBookmarksToJSONFile(fp.file);</span>
<a href="#l7.563"></a><span id="l7.563" class="difflineplus">+  },</span>
<a href="#l7.564"></a><span id="l7.564" class="difflineplus">+</span>
<a href="#l7.565"></a><span id="l7.565" class="difflineplus">+  _paneDisabled: false,</span>
<a href="#l7.566"></a><span id="l7.566" class="difflineplus">+  _setDetailsFieldsDisabledState:</span>
<a href="#l7.567"></a><span id="l7.567" class="difflineplus">+  function PO__setDetailsFieldsDisabledState(aDisabled) {</span>
<a href="#l7.568"></a><span id="l7.568" class="difflineplus">+    if (aDisabled) {</span>
<a href="#l7.569"></a><span id="l7.569" class="difflineplus">+      document.getElementById(&quot;paneElementsBroadcaster&quot;)</span>
<a href="#l7.570"></a><span id="l7.570" class="difflineplus">+              .setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l7.571"></a><span id="l7.571" class="difflineplus">+    }</span>
<a href="#l7.572"></a><span id="l7.572" class="difflineplus">+    else {</span>
<a href="#l7.573"></a><span id="l7.573" class="difflineplus">+      document.getElementById(&quot;paneElementsBroadcaster&quot;)</span>
<a href="#l7.574"></a><span id="l7.574" class="difflineplus">+              .removeAttribute(&quot;disabled&quot;);</span>
<a href="#l7.575"></a><span id="l7.575" class="difflineplus">+    }</span>
<a href="#l7.576"></a><span id="l7.576" class="difflineplus">+  },</span>
<a href="#l7.577"></a><span id="l7.577" class="difflineplus">+</span>
<a href="#l7.578"></a><span id="l7.578" class="difflineplus">+  _detectAndSetDetailsPaneMinimalState:</span>
<a href="#l7.579"></a><span id="l7.579" class="difflineplus">+  function PO__detectAndSetDetailsPaneMinimalState(aNode) {</span>
<a href="#l7.580"></a><span id="l7.580" class="difflineplus">+    /**</span>
<a href="#l7.581"></a><span id="l7.581" class="difflineplus">+     * The details of simple folder-items (as opposed to livemarks) or the</span>
<a href="#l7.582"></a><span id="l7.582" class="difflineplus">+     * of livemark-children are not likely to fill the infoBox anyway,</span>
<a href="#l7.583"></a><span id="l7.583" class="difflineplus">+     * thus we remove the &quot;More/Less&quot; button and show all details.</span>
<a href="#l7.584"></a><span id="l7.584" class="difflineplus">+     *</span>
<a href="#l7.585"></a><span id="l7.585" class="difflineplus">+     * the wasminimal attribute here is used to persist the &quot;more/less&quot;</span>
<a href="#l7.586"></a><span id="l7.586" class="difflineplus">+     * state in a bookmark-&gt;folder-&gt;bookmark scenario.</span>
<a href="#l7.587"></a><span id="l7.587" class="difflineplus">+     */</span>
<a href="#l7.588"></a><span id="l7.588" class="difflineplus">+    var infoBox = document.getElementById(&quot;infoBox&quot;);</span>
<a href="#l7.589"></a><span id="l7.589" class="difflineplus">+    var infoBoxExpander = document.getElementById(&quot;infoBoxExpander&quot;);</span>
<a href="#l7.590"></a><span id="l7.590" class="difflineplus">+    var infoBoxExpanderWrapper = document.getElementById(&quot;infoBoxExpanderWrapper&quot;);</span>
<a href="#l7.591"></a><span id="l7.591" class="difflineplus">+    var additionalInfoBroadcaster = document.getElementById(&quot;additionalInfoBroadcaster&quot;);</span>
<a href="#l7.592"></a><span id="l7.592"> </span>
<a href="#l7.593"></a><span id="l7.593" class="difflineminus">-  bookmarksView.treeBoxObject.view.selection.select(0);</span>
<a href="#l7.594"></a><span id="l7.594" class="difflineplus">+    if (!aNode) {</span>
<a href="#l7.595"></a><span id="l7.595" class="difflineplus">+      infoBoxExpanderWrapper.hidden = true;</span>
<a href="#l7.596"></a><span id="l7.596" class="difflineplus">+      return;</span>
<a href="#l7.597"></a><span id="l7.597" class="difflineplus">+    }</span>
<a href="#l7.598"></a><span id="l7.598" class="difflineplus">+    if (aNode.itemId != -1 &amp;&amp;</span>
<a href="#l7.599"></a><span id="l7.599" class="difflineplus">+        ((PlacesUtils.nodeIsFolder(aNode) &amp;&amp;</span>
<a href="#l7.600"></a><span id="l7.600" class="difflineplus">+          !PlacesUtils.nodeIsLivemarkContainer(aNode)) ||</span>
<a href="#l7.601"></a><span id="l7.601" class="difflineplus">+         PlacesUtils.nodeIsLivemarkItem(aNode))) {</span>
<a href="#l7.602"></a><span id="l7.602" class="difflineplus">+      if (infoBox.getAttribute(&quot;minimal&quot;) == &quot;true&quot;)</span>
<a href="#l7.603"></a><span id="l7.603" class="difflineplus">+        infoBox.setAttribute(&quot;wasminimal&quot;, &quot;true&quot;);</span>
<a href="#l7.604"></a><span id="l7.604" class="difflineplus">+      infoBox.removeAttribute(&quot;minimal&quot;);</span>
<a href="#l7.605"></a><span id="l7.605" class="difflineplus">+      infoBoxExpanderWrapper.hidden = true;</span>
<a href="#l7.606"></a><span id="l7.606" class="difflineplus">+    }</span>
<a href="#l7.607"></a><span id="l7.607" class="difflineplus">+    else {</span>
<a href="#l7.608"></a><span id="l7.608" class="difflineplus">+      if (infoBox.getAttribute(&quot;wasminimal&quot;) == &quot;true&quot;)</span>
<a href="#l7.609"></a><span id="l7.609" class="difflineplus">+        infoBox.setAttribute(&quot;minimal&quot;, &quot;true&quot;);</span>
<a href="#l7.610"></a><span id="l7.610" class="difflineplus">+      infoBox.removeAttribute(&quot;wasminimal&quot;);</span>
<a href="#l7.611"></a><span id="l7.611" class="difflineplus">+      infoBoxExpanderWrapper.hidden =</span>
<a href="#l7.612"></a><span id="l7.612" class="difflineplus">+        this._additionalInfoFields.every(function (id)</span>
<a href="#l7.613"></a><span id="l7.613" class="difflineplus">+          document.getElementById(id).collapsed);</span>
<a href="#l7.614"></a><span id="l7.614" class="difflineplus">+    }</span>
<a href="#l7.615"></a><span id="l7.615" class="difflineplus">+    additionalInfoBroadcaster.hidden = infoBox.getAttribute(&quot;minimal&quot;) == &quot;true&quot;;</span>
<a href="#l7.616"></a><span id="l7.616" class="difflineplus">+  },</span>
<a href="#l7.617"></a><span id="l7.617" class="difflineplus">+</span>
<a href="#l7.618"></a><span id="l7.618" class="difflineplus">+  // NOT YET USED</span>
<a href="#l7.619"></a><span id="l7.619" class="difflineplus">+  updateThumbnailProportions: function PO_updateThumbnailProportions() {</span>
<a href="#l7.620"></a><span id="l7.620" class="difflineplus">+    var previewBox = document.getElementById(&quot;previewBox&quot;);</span>
<a href="#l7.621"></a><span id="l7.621" class="difflineplus">+    var canvas = document.getElementById(&quot;itemThumbnail&quot;);</span>
<a href="#l7.622"></a><span id="l7.622" class="difflineplus">+    var height = previewBox.boxObject.height;</span>
<a href="#l7.623"></a><span id="l7.623" class="difflineplus">+    var width = height * (screen.width / screen.height);</span>
<a href="#l7.624"></a><span id="l7.624" class="difflineplus">+    canvas.width = width;</span>
<a href="#l7.625"></a><span id="l7.625" class="difflineplus">+    canvas.height = height;</span>
<a href="#l7.626"></a><span id="l7.626" class="difflineplus">+  },</span>
<a href="#l7.627"></a><span id="l7.627" class="difflineplus">+</span>
<a href="#l7.628"></a><span id="l7.628" class="difflineplus">+  onContentTreeSelect: function PO_onContentTreeSelect() {</span>
<a href="#l7.629"></a><span id="l7.629" class="difflineplus">+    if (this._content.treeBoxObject.focused)</span>
<a href="#l7.630"></a><span id="l7.630" class="difflineplus">+      this._fillDetailsPane(this._content.selectedNodes);</span>
<a href="#l7.631"></a><span id="l7.631" class="difflineplus">+  },</span>
<a href="#l7.632"></a><span id="l7.632" class="difflineplus">+</span>
<a href="#l7.633"></a><span id="l7.633" class="difflineplus">+  _fillDetailsPane: function PO__fillDetailsPane(aNodeList) {</span>
<a href="#l7.634"></a><span id="l7.634" class="difflineplus">+    var infoBox = document.getElementById(&quot;infoBox&quot;);</span>
<a href="#l7.635"></a><span id="l7.635" class="difflineplus">+    var detailsDeck = document.getElementById(&quot;detailsDeck&quot;);</span>
<a href="#l7.636"></a><span id="l7.636"> </span>
<a href="#l7.637"></a><span id="l7.637" class="difflineminus">-  document.title = titleString;</span>
<a href="#l7.638"></a><span id="l7.638" class="difflineplus">+    // Make sure the infoBox UI is visible if we need to use it, we hide it</span>
<a href="#l7.639"></a><span id="l7.639" class="difflineplus">+    // below when we don't.</span>
<a href="#l7.640"></a><span id="l7.640" class="difflineplus">+    infoBox.hidden = false;</span>
<a href="#l7.641"></a><span id="l7.641" class="difflineplus">+    var aSelectedNode = aNodeList.length == 1 ? aNodeList[0] : null;</span>
<a href="#l7.642"></a><span id="l7.642" class="difflineplus">+    // If a textbox within a panel is focused, force-blur it so its contents</span>
<a href="#l7.643"></a><span id="l7.643" class="difflineplus">+    // are saved</span>
<a href="#l7.644"></a><span id="l7.644" class="difflineplus">+    if (gEditItemOverlay.itemId != -1) {</span>
<a href="#l7.645"></a><span id="l7.645" class="difflineplus">+      var focusedElement = document.commandDispatcher.focusedElement;</span>
<a href="#l7.646"></a><span id="l7.646" class="difflineplus">+      if ((focusedElement instanceof HTMLInputElement ||</span>
<a href="#l7.647"></a><span id="l7.647" class="difflineplus">+           focusedElement instanceof HTMLTextAreaElement) &amp;&amp;</span>
<a href="#l7.648"></a><span id="l7.648" class="difflineplus">+          /^editBMPanel.*/.test(focusedElement.parentNode.parentNode.id))</span>
<a href="#l7.649"></a><span id="l7.649" class="difflineplus">+        focusedElement.blur();</span>
<a href="#l7.650"></a><span id="l7.650" class="difflineplus">+</span>
<a href="#l7.651"></a><span id="l7.651" class="difflineplus">+      // don't update the panel if we are already editing this node unless we're</span>
<a href="#l7.652"></a><span id="l7.652" class="difflineplus">+      // in multi-edit mode</span>
<a href="#l7.653"></a><span id="l7.653" class="difflineplus">+      if (aSelectedNode) {</span>
<a href="#l7.654"></a><span id="l7.654" class="difflineplus">+        var concreteId = PlacesUtils.getConcreteItemId(aSelectedNode);</span>
<a href="#l7.655"></a><span id="l7.655" class="difflineplus">+        var nodeIsSame = gEditItemOverlay.itemId == aSelectedNode.itemId ||</span>
<a href="#l7.656"></a><span id="l7.656" class="difflineplus">+                         gEditItemOverlay.itemId == concreteId ||</span>
<a href="#l7.657"></a><span id="l7.657" class="difflineplus">+                         (aSelectedNode.itemId == -1 &amp;&amp; gEditItemOverlay.uri &amp;&amp;</span>
<a href="#l7.658"></a><span id="l7.658" class="difflineplus">+                          gEditItemOverlay.uri == aSelectedNode.uri);</span>
<a href="#l7.659"></a><span id="l7.659" class="difflineplus">+        if (nodeIsSame &amp;&amp; detailsDeck.selectedIndex == 1 &amp;&amp;</span>
<a href="#l7.660"></a><span id="l7.660" class="difflineplus">+            !gEditItemOverlay.multiEdit)</span>
<a href="#l7.661"></a><span id="l7.661" class="difflineplus">+          return;</span>
<a href="#l7.662"></a><span id="l7.662" class="difflineplus">+      }</span>
<a href="#l7.663"></a><span id="l7.663" class="difflineplus">+    }</span>
<a href="#l7.664"></a><span id="l7.664" class="difflineplus">+</span>
<a href="#l7.665"></a><span id="l7.665" class="difflineplus">+    // Clean up the panel before initing it again.</span>
<a href="#l7.666"></a><span id="l7.666" class="difflineplus">+    gEditItemOverlay.uninitPanel(false);</span>
<a href="#l7.667"></a><span id="l7.667" class="difflineplus">+</span>
<a href="#l7.668"></a><span id="l7.668" class="difflineplus">+    if (aSelectedNode &amp;&amp; !PlacesUtils.nodeIsSeparator(aSelectedNode)) {</span>
<a href="#l7.669"></a><span id="l7.669" class="difflineplus">+      detailsDeck.selectedIndex = 1;</span>
<a href="#l7.670"></a><span id="l7.670" class="difflineplus">+      // Using the concrete itemId is arguably wrong.  The bookmarks API</span>
<a href="#l7.671"></a><span id="l7.671" class="difflineplus">+      // does allow setting properties for folder shortcuts as well, but since</span>
<a href="#l7.672"></a><span id="l7.672" class="difflineplus">+      // the UI does not distinct between the couple, we better just show</span>
<a href="#l7.673"></a><span id="l7.673" class="difflineplus">+      // the concrete item properties for shortcuts to root nodes.</span>
<a href="#l7.674"></a><span id="l7.674" class="difflineplus">+      var concreteId = PlacesUtils.getConcreteItemId(aSelectedNode);</span>
<a href="#l7.675"></a><span id="l7.675" class="difflineplus">+      var isRootItem = concreteId != -1 &amp;&amp; PlacesUtils.isRootItem(concreteId);</span>
<a href="#l7.676"></a><span id="l7.676" class="difflineplus">+      var readOnly = isRootItem ||</span>
<a href="#l7.677"></a><span id="l7.677" class="difflineplus">+                     aSelectedNode.parent.itemId == PlacesUIUtils.leftPaneFolderId;</span>
<a href="#l7.678"></a><span id="l7.678" class="difflineplus">+      var useConcreteId = isRootItem ||</span>
<a href="#l7.679"></a><span id="l7.679" class="difflineplus">+                          PlacesUtils.nodeIsTagQuery(aSelectedNode);</span>
<a href="#l7.680"></a><span id="l7.680" class="difflineplus">+      var itemId = -1;</span>
<a href="#l7.681"></a><span id="l7.681" class="difflineplus">+      if (concreteId != -1 &amp;&amp; useConcreteId)</span>
<a href="#l7.682"></a><span id="l7.682" class="difflineplus">+        itemId = concreteId;</span>
<a href="#l7.683"></a><span id="l7.683" class="difflineplus">+      else if (aSelectedNode.itemId != -1)</span>
<a href="#l7.684"></a><span id="l7.684" class="difflineplus">+        itemId = aSelectedNode.itemId;</span>
<a href="#l7.685"></a><span id="l7.685" class="difflineplus">+      else</span>
<a href="#l7.686"></a><span id="l7.686" class="difflineplus">+        itemId = PlacesUtils._uri(aSelectedNode.uri);</span>
<a href="#l7.687"></a><span id="l7.687" class="difflineplus">+</span>
<a href="#l7.688"></a><span id="l7.688" class="difflineplus">+      gEditItemOverlay.initPanel(itemId, { hiddenRows: [&quot;folderPicker&quot;],</span>
<a href="#l7.689"></a><span id="l7.689" class="difflineplus">+                                           forceReadOnly: readOnly });</span>
<a href="#l7.690"></a><span id="l7.690" class="difflineplus">+</span>
<a href="#l7.691"></a><span id="l7.691" class="difflineplus">+      // Dynamically generated queries, like history date containers, have</span>
<a href="#l7.692"></a><span id="l7.692" class="difflineplus">+      // itemId !=0 and do not exist in history.  For them the panel is</span>
<a href="#l7.693"></a><span id="l7.693" class="difflineplus">+      // read-only, but empty, since it can't get a valid title for the object.</span>
<a href="#l7.694"></a><span id="l7.694" class="difflineplus">+      // In such a case we force the title using the selectedNode one, for UI</span>
<a href="#l7.695"></a><span id="l7.695" class="difflineplus">+      // polishness.</span>
<a href="#l7.696"></a><span id="l7.696" class="difflineplus">+      if (aSelectedNode.itemId == -1 &amp;&amp;</span>
<a href="#l7.697"></a><span id="l7.697" class="difflineplus">+          (PlacesUtils.nodeIsDay(aSelectedNode) ||</span>
<a href="#l7.698"></a><span id="l7.698" class="difflineplus">+           PlacesUtils.nodeIsHost(aSelectedNode)))</span>
<a href="#l7.699"></a><span id="l7.699" class="difflineplus">+        gEditItemOverlay._element(&quot;namePicker&quot;).value = aSelectedNode.title;</span>
<a href="#l7.700"></a><span id="l7.700"> </span>
<a href="#l7.701"></a><span id="l7.701" class="difflineminus">-  // correct keybinding command attributes which don't do our business yet</span>
<a href="#l7.702"></a><span id="l7.702" class="difflineminus">-  var key = document.getElementById(&quot;key_delete&quot;);</span>
<a href="#l7.703"></a><span id="l7.703" class="difflineminus">-  if (key.getAttribute(&quot;command&quot;))</span>
<a href="#l7.704"></a><span id="l7.704" class="difflineminus">-    key.setAttribute(&quot;command&quot;, &quot;cmd_bm_delete&quot;);</span>
<a href="#l7.705"></a><span id="l7.705" class="difflineminus">-  key = document.getElementById(&quot;key_delete2&quot;);</span>
<a href="#l7.706"></a><span id="l7.706" class="difflineminus">-  if (key.getAttribute(&quot;command&quot;))</span>
<a href="#l7.707"></a><span id="l7.707" class="difflineminus">-    key.setAttribute(&quot;command&quot;, &quot;cmd_bm_delete&quot;);</span>
<a href="#l7.708"></a><span id="l7.708" class="difflineminus">-  </span>
<a href="#l7.709"></a><span id="l7.709" class="difflineminus">-  document.getElementById(&quot;CommandUpdate_Bookmarks&quot;).setAttribute(&quot;commandupdater&quot;,&quot;true&quot;);</span>
<a href="#l7.710"></a><span id="l7.710" class="difflineminus">-  bookmarksView.tree.focus();</span>
<a href="#l7.711"></a><span id="l7.711" class="difflineminus">-}</span>
<a href="#l7.712"></a><span id="l7.712" class="difflineplus">+      this._detectAndSetDetailsPaneMinimalState(aSelectedNode);</span>
<a href="#l7.713"></a><span id="l7.713" class="difflineplus">+    }</span>
<a href="#l7.714"></a><span id="l7.714" class="difflineplus">+    else if (!aSelectedNode &amp;&amp; aNodeList[0]) {</span>
<a href="#l7.715"></a><span id="l7.715" class="difflineplus">+      var itemIds = [];</span>
<a href="#l7.716"></a><span id="l7.716" class="difflineplus">+      for (var i = 0; i &lt; aNodeList.length; i++) {</span>
<a href="#l7.717"></a><span id="l7.717" class="difflineplus">+        if (!PlacesUtils.nodeIsBookmark(aNodeList[i]) &amp;&amp;</span>
<a href="#l7.718"></a><span id="l7.718" class="difflineplus">+            !PlacesUtils.nodeIsURI(aNodeList[i])) {</span>
<a href="#l7.719"></a><span id="l7.719" class="difflineplus">+          detailsDeck.selectedIndex = 0;</span>
<a href="#l7.720"></a><span id="l7.720" class="difflineplus">+          var selectItemDesc = document.getElementById(&quot;selectItemDescription&quot;);</span>
<a href="#l7.721"></a><span id="l7.721" class="difflineplus">+          var itemsCountLabel = document.getElementById(&quot;itemsCountText&quot;);</span>
<a href="#l7.722"></a><span id="l7.722" class="difflineplus">+          selectItemDesc.hidden = false;</span>
<a href="#l7.723"></a><span id="l7.723" class="difflineplus">+          itemsCountLabel.value =</span>
<a href="#l7.724"></a><span id="l7.724" class="difflineplus">+            PlacesUIUtils.getFormattedString(&quot;detailsPane.multipleItems&quot;,</span>
<a href="#l7.725"></a><span id="l7.725" class="difflineplus">+                                             [aNodeList.length]);</span>
<a href="#l7.726"></a><span id="l7.726" class="difflineplus">+          infoBox.hidden = true;</span>
<a href="#l7.727"></a><span id="l7.727" class="difflineplus">+          return;</span>
<a href="#l7.728"></a><span id="l7.728" class="difflineplus">+        }</span>
<a href="#l7.729"></a><span id="l7.729" class="difflineplus">+        itemIds[i] = aNodeList[i].itemId != -1 ? aNodeList[i].itemId :</span>
<a href="#l7.730"></a><span id="l7.730" class="difflineplus">+                     PlacesUtils._uri(aNodeList[i].uri);</span>
<a href="#l7.731"></a><span id="l7.731" class="difflineplus">+      }</span>
<a href="#l7.732"></a><span id="l7.732" class="difflineplus">+      detailsDeck.selectedIndex = 1;</span>
<a href="#l7.733"></a><span id="l7.733" class="difflineplus">+      gEditItemOverlay.initPanel(itemIds,</span>
<a href="#l7.734"></a><span id="l7.734" class="difflineplus">+                                 { hiddenRows: [&quot;folderPicker&quot;,</span>
<a href="#l7.735"></a><span id="l7.735" class="difflineplus">+                                                &quot;loadInSidebar&quot;,</span>
<a href="#l7.736"></a><span id="l7.736" class="difflineplus">+                                                &quot;location&quot;,</span>
<a href="#l7.737"></a><span id="l7.737" class="difflineplus">+                                                &quot;keyword&quot;,</span>
<a href="#l7.738"></a><span id="l7.738" class="difflineplus">+                                                &quot;description&quot;,</span>
<a href="#l7.739"></a><span id="l7.739" class="difflineplus">+                                                &quot;name&quot;]});</span>
<a href="#l7.740"></a><span id="l7.740" class="difflineplus">+      this._detectAndSetDetailsPaneMinimalState(aSelectedNode);</span>
<a href="#l7.741"></a><span id="l7.741" class="difflineplus">+    }</span>
<a href="#l7.742"></a><span id="l7.742" class="difflineplus">+    else {</span>
<a href="#l7.743"></a><span id="l7.743" class="difflineplus">+      detailsDeck.selectedIndex = 0;</span>
<a href="#l7.744"></a><span id="l7.744" class="difflineplus">+      infoBox.hidden = true;</span>
<a href="#l7.745"></a><span id="l7.745" class="difflineplus">+      var selectItemDesc = document.getElementById(&quot;selectItemDescription&quot;);</span>
<a href="#l7.746"></a><span id="l7.746" class="difflineplus">+      var itemsCountLabel = document.getElementById(&quot;itemsCountText&quot;);</span>
<a href="#l7.747"></a><span id="l7.747" class="difflineplus">+      var rowCount = this._content.treeBoxObject.view.rowCount;</span>
<a href="#l7.748"></a><span id="l7.748" class="difflineplus">+      if (rowCount == 0) {</span>
<a href="#l7.749"></a><span id="l7.749" class="difflineplus">+        selectItemDesc.hidden = true;</span>
<a href="#l7.750"></a><span id="l7.750" class="difflineplus">+        itemsCountLabel.value = PlacesUIUtils.getString(&quot;detailsPane.noItems&quot;);</span>
<a href="#l7.751"></a><span id="l7.751" class="difflineplus">+      }</span>
<a href="#l7.752"></a><span id="l7.752" class="difflineplus">+      else {</span>
<a href="#l7.753"></a><span id="l7.753" class="difflineplus">+        selectItemDesc.hidden = false;</span>
<a href="#l7.754"></a><span id="l7.754" class="difflineplus">+        if (rowCount == 1)</span>
<a href="#l7.755"></a><span id="l7.755" class="difflineplus">+          itemsCountLabel.value = PlacesUIUtils.getString(&quot;detailsPane.oneItem&quot;);</span>
<a href="#l7.756"></a><span id="l7.756" class="difflineplus">+        else {</span>
<a href="#l7.757"></a><span id="l7.757" class="difflineplus">+          itemsCountLabel.value =</span>
<a href="#l7.758"></a><span id="l7.758" class="difflineplus">+            PlacesUIUtils.getFormattedString(&quot;detailsPane.multipleItems&quot;,</span>
<a href="#l7.759"></a><span id="l7.759" class="difflineplus">+                                             [rowCount]);</span>
<a href="#l7.760"></a><span id="l7.760" class="difflineplus">+        }</span>
<a href="#l7.761"></a><span id="l7.761" class="difflineplus">+      }</span>
<a href="#l7.762"></a><span id="l7.762" class="difflineplus">+    }</span>
<a href="#l7.763"></a><span id="l7.763" class="difflineplus">+  },</span>
<a href="#l7.764"></a><span id="l7.764" class="difflineplus">+</span>
<a href="#l7.765"></a><span id="l7.765" class="difflineplus">+  // NOT YET USED</span>
<a href="#l7.766"></a><span id="l7.766" class="difflineplus">+  _updateThumbnail: function PO__updateThumbnail() {</span>
<a href="#l7.767"></a><span id="l7.767" class="difflineplus">+    var bo = document.getElementById(&quot;previewBox&quot;).boxObject;</span>
<a href="#l7.768"></a><span id="l7.768" class="difflineplus">+    var width  = bo.width;</span>
<a href="#l7.769"></a><span id="l7.769" class="difflineplus">+    var height = bo.height;</span>
<a href="#l7.770"></a><span id="l7.770" class="difflineplus">+</span>
<a href="#l7.771"></a><span id="l7.771" class="difflineplus">+    var canvas = document.getElementById(&quot;itemThumbnail&quot;);</span>
<a href="#l7.772"></a><span id="l7.772" class="difflineplus">+    var ctx = canvas.getContext('2d');</span>
<a href="#l7.773"></a><span id="l7.773" class="difflineplus">+    var notAvailableText = canvas.getAttribute(&quot;notavailabletext&quot;);</span>
<a href="#l7.774"></a><span id="l7.774" class="difflineplus">+    ctx.save();</span>
<a href="#l7.775"></a><span id="l7.775" class="difflineplus">+    ctx.fillStyle = &quot;-moz-Dialog&quot;;</span>
<a href="#l7.776"></a><span id="l7.776" class="difflineplus">+    ctx.fillRect(0, 0, width, height);</span>
<a href="#l7.777"></a><span id="l7.777" class="difflineplus">+    ctx.translate(width/2, height/2);</span>
<a href="#l7.778"></a><span id="l7.778" class="difflineplus">+</span>
<a href="#l7.779"></a><span id="l7.779" class="difflineplus">+    ctx.fillStyle = &quot;GrayText&quot;;</span>
<a href="#l7.780"></a><span id="l7.780" class="difflineplus">+    ctx.mozTextStyle = &quot;12pt sans serif&quot;;</span>
<a href="#l7.781"></a><span id="l7.781" class="difflineplus">+    var len = ctx.mozMeasureText(notAvailableText);</span>
<a href="#l7.782"></a><span id="l7.782" class="difflineplus">+    ctx.translate(-len/2,0);</span>
<a href="#l7.783"></a><span id="l7.783" class="difflineplus">+    ctx.mozDrawText(notAvailableText);</span>
<a href="#l7.784"></a><span id="l7.784" class="difflineplus">+    ctx.restore();</span>
<a href="#l7.785"></a><span id="l7.785" class="difflineplus">+  },</span>
<a href="#l7.786"></a><span id="l7.786" class="difflineplus">+</span>
<a href="#l7.787"></a><span id="l7.787" class="difflineplus">+  toggleAdditionalInfoFields: function PO_toggleAdditionalInfoFields() {</span>
<a href="#l7.788"></a><span id="l7.788" class="difflineplus">+    var infoBox = document.getElementById(&quot;infoBox&quot;);</span>
<a href="#l7.789"></a><span id="l7.789" class="difflineplus">+    var infoBoxExpander = document.getElementById(&quot;infoBoxExpander&quot;);</span>
<a href="#l7.790"></a><span id="l7.790" class="difflineplus">+    var infoBoxExpanderLabel = document.getElementById(&quot;infoBoxExpanderLabel&quot;);</span>
<a href="#l7.791"></a><span id="l7.791" class="difflineplus">+    var additionalInfoBroadcaster = document.getElementById(&quot;additionalInfoBroadcaster&quot;);</span>
<a href="#l7.792"></a><span id="l7.792" class="difflineplus">+</span>
<a href="#l7.793"></a><span id="l7.793" class="difflineplus">+    if (infoBox.getAttribute(&quot;minimal&quot;) == &quot;true&quot;) {</span>
<a href="#l7.794"></a><span id="l7.794" class="difflineplus">+      infoBox.removeAttribute(&quot;minimal&quot;);</span>
<a href="#l7.795"></a><span id="l7.795" class="difflineplus">+      infoBoxExpanderLabel.value = infoBoxExpanderLabel.getAttribute(&quot;lesslabel&quot;);</span>
<a href="#l7.796"></a><span id="l7.796" class="difflineplus">+      infoBoxExpanderLabel.accessKey = infoBoxExpanderLabel.getAttribute(&quot;lessaccesskey&quot;);</span>
<a href="#l7.797"></a><span id="l7.797" class="difflineplus">+      infoBoxExpander.className = &quot;expander-up&quot;;</span>
<a href="#l7.798"></a><span id="l7.798" class="difflineplus">+      additionalInfoBroadcaster.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l7.799"></a><span id="l7.799" class="difflineplus">+    }</span>
<a href="#l7.800"></a><span id="l7.800" class="difflineplus">+    else {</span>
<a href="#l7.801"></a><span id="l7.801" class="difflineplus">+      infoBox.setAttribute(&quot;minimal&quot;, &quot;true&quot;);</span>
<a href="#l7.802"></a><span id="l7.802" class="difflineplus">+      infoBoxExpanderLabel.value = infoBoxExpanderLabel.getAttribute(&quot;morelabel&quot;);</span>
<a href="#l7.803"></a><span id="l7.803" class="difflineplus">+      infoBoxExpanderLabel.accessKey = infoBoxExpanderLabel.getAttribute(&quot;moreaccesskey&quot;);</span>
<a href="#l7.804"></a><span id="l7.804" class="difflineplus">+      infoBoxExpander.className = &quot;expander-down&quot;;</span>
<a href="#l7.805"></a><span id="l7.805" class="difflineplus">+      additionalInfoBroadcaster.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l7.806"></a><span id="l7.806" class="difflineplus">+    }</span>
<a href="#l7.807"></a><span id="l7.807" class="difflineplus">+  },</span>
<a href="#l7.808"></a><span id="l7.808" class="difflineplus">+</span>
<a href="#l7.809"></a><span id="l7.809" class="difflineplus">+  /**</span>
<a href="#l7.810"></a><span id="l7.810" class="difflineplus">+   * Save the current search (or advanced query) to the bookmarks root.</span>
<a href="#l7.811"></a><span id="l7.811" class="difflineplus">+   */</span>
<a href="#l7.812"></a><span id="l7.812" class="difflineplus">+  saveSearch: function PO_saveSearch() {</span>
<a href="#l7.813"></a><span id="l7.813" class="difflineplus">+    // Get the place: uri for the query.</span>
<a href="#l7.814"></a><span id="l7.814" class="difflineplus">+    // If the advanced query builder is showing, use that.</span>
<a href="#l7.815"></a><span id="l7.815" class="difflineplus">+    var options = this.getCurrentOptions();</span>
<a href="#l7.816"></a><span id="l7.816" class="difflineplus">+    var queries = this.getCurrentQueries();</span>
<a href="#l7.817"></a><span id="l7.817" class="difflineplus">+</span>
<a href="#l7.818"></a><span id="l7.818" class="difflineplus">+    var placeSpec = PlacesUtils.history.queriesToQueryString(queries,</span>
<a href="#l7.819"></a><span id="l7.819" class="difflineplus">+                                                             queries.length,</span>
<a href="#l7.820"></a><span id="l7.820" class="difflineplus">+                                                             options);</span>
<a href="#l7.821"></a><span id="l7.821" class="difflineplus">+    var placeURI = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l7.822"></a><span id="l7.822" class="difflineplus">+                             .getService(Components.interfaces.nsIIOService)</span>
<a href="#l7.823"></a><span id="l7.823" class="difflineplus">+                             .newURI(placeSpec, null, null);</span>
<a href="#l7.824"></a><span id="l7.824" class="difflineplus">+</span>
<a href="#l7.825"></a><span id="l7.825" class="difflineplus">+    // Prompt the user for a name for the query.</span>
<a href="#l7.826"></a><span id="l7.826" class="difflineplus">+    // XXX - using prompt service for now; will need to make</span>
<a href="#l7.827"></a><span id="l7.827" class="difflineplus">+    // a real dialog and localize when we're sure this is the UI we want.</span>
<a href="#l7.828"></a><span id="l7.828" class="difflineplus">+    var title = PlacesUIUtils.getString(&quot;saveSearch.title&quot;);</span>
<a href="#l7.829"></a><span id="l7.829" class="difflineplus">+    var inputLabel = PlacesUIUtils.getString(&quot;saveSearch.inputLabel&quot;);</span>
<a href="#l7.830"></a><span id="l7.830" class="difflineplus">+    var defaultText = PlacesUIUtils.getString(&quot;saveSearch.inputDefaultText&quot;);</span>
<a href="#l7.831"></a><span id="l7.831" class="difflineplus">+</span>
<a href="#l7.832"></a><span id="l7.832" class="difflineplus">+    var prompts = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l7.833"></a><span id="l7.833" class="difflineplus">+                            .getService(Components.interfaces.nsIPromptService);</span>
<a href="#l7.834"></a><span id="l7.834" class="difflineplus">+    var check = {value: false};</span>
<a href="#l7.835"></a><span id="l7.835" class="difflineplus">+    var input = {value: defaultText};</span>
<a href="#l7.836"></a><span id="l7.836" class="difflineplus">+    var save = prompts.prompt(null, title, inputLabel, input, null, check);</span>
<a href="#l7.837"></a><span id="l7.837" class="difflineplus">+</span>
<a href="#l7.838"></a><span id="l7.838" class="difflineplus">+    // Don't add the query if the user cancels or clears the seach name.</span>
<a href="#l7.839"></a><span id="l7.839" class="difflineplus">+    if (!save || input.value == &quot;&quot;)</span>
<a href="#l7.840"></a><span id="l7.840" class="difflineplus">+     return;</span>
<a href="#l7.841"></a><span id="l7.841" class="difflineplus">+</span>
<a href="#l7.842"></a><span id="l7.842" class="difflineplus">+    // Add the place: uri as a bookmark under the bookmarks root.</span>
<a href="#l7.843"></a><span id="l7.843" class="difflineplus">+    var txn = PlacesUIUtils.ptm.createItem(placeURI,</span>
<a href="#l7.844"></a><span id="l7.844" class="difflineplus">+                                           PlacesUtils.bookmarksMenuFolderId,</span>
<a href="#l7.845"></a><span id="l7.845" class="difflineplus">+                                           PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l7.846"></a><span id="l7.846" class="difflineplus">+                                           input.value);</span>
<a href="#l7.847"></a><span id="l7.847" class="difflineplus">+    PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l7.848"></a><span id="l7.848" class="difflineplus">+</span>
<a href="#l7.849"></a><span id="l7.849" class="difflineplus">+    // select and load the new query</span>
<a href="#l7.850"></a><span id="l7.850" class="difflineplus">+    this._places.selectPlaceURI(placeSpec);</span>
<a href="#l7.851"></a><span id="l7.851" class="difflineplus">+  }</span>
<a href="#l7.852"></a><span id="l7.852" class="difflineplus">+};</span>
<a href="#l7.853"></a><span id="l7.853" class="difflineplus">+</span>
<a href="#l7.854"></a><span id="l7.854" class="difflineplus">+/**</span>
<a href="#l7.855"></a><span id="l7.855" class="difflineplus">+ * A set of utilities relating to search within Bookmarks.</span>
<a href="#l7.856"></a><span id="l7.856" class="difflineplus">+ */</span>
<a href="#l7.857"></a><span id="l7.857" class="difflineplus">+var PlacesSearchBox = {</span>
<a href="#l7.858"></a><span id="l7.858" class="difflineplus">+</span>
<a href="#l7.859"></a><span id="l7.859" class="difflineplus">+  /**</span>
<a href="#l7.860"></a><span id="l7.860" class="difflineplus">+   * The Search text field</span>
<a href="#l7.861"></a><span id="l7.861" class="difflineplus">+   */</span>
<a href="#l7.862"></a><span id="l7.862" class="difflineplus">+  get searchFilter() {</span>
<a href="#l7.863"></a><span id="l7.863" class="difflineplus">+    return document.getElementById(&quot;searchFilter&quot;);</span>
<a href="#l7.864"></a><span id="l7.864" class="difflineplus">+  },</span>
<a href="#l7.865"></a><span id="l7.865"> </span>
<a href="#l7.866"></a><span id="l7.866" class="difflineminus">-function Shutdown()</span>
<a href="#l7.867"></a><span id="l7.867" class="difflineminus">-{</span>
<a href="#l7.868"></a><span id="l7.868" class="difflineminus">-  // Store current window position and size in window attributes (for persistence).</span>
<a href="#l7.869"></a><span id="l7.869" class="difflineminus">-  var win = document.getElementById(&quot;bookmark-window&quot;);</span>
<a href="#l7.870"></a><span id="l7.870" class="difflineminus">-  win.setAttribute(&quot;x&quot;, screenX);</span>
<a href="#l7.871"></a><span id="l7.871" class="difflineminus">-  win.setAttribute(&quot;y&quot;, screenY);</span>
<a href="#l7.872"></a><span id="l7.872" class="difflineminus">-  win.setAttribute(&quot;height&quot;, outerHeight);</span>
<a href="#l7.873"></a><span id="l7.873" class="difflineminus">-  win.setAttribute(&quot;width&quot;, outerWidth);</span>
<a href="#l7.874"></a><span id="l7.874" class="difflineminus">-}</span>
<a href="#l7.875"></a><span id="l7.875" class="difflineplus">+  /**</span>
<a href="#l7.876"></a><span id="l7.876" class="difflineplus">+   * Folders to include when searching.</span>
<a href="#l7.877"></a><span id="l7.877" class="difflineplus">+   */</span>
<a href="#l7.878"></a><span id="l7.878" class="difflineplus">+  _folders: [],</span>
<a href="#l7.879"></a><span id="l7.879" class="difflineplus">+  get folders() {</span>
<a href="#l7.880"></a><span id="l7.880" class="difflineplus">+    if (this._folders.length == 0)</span>
<a href="#l7.881"></a><span id="l7.881" class="difflineplus">+      this._folders.push(PlacesUtils.bookmarksMenuFolderId,</span>
<a href="#l7.882"></a><span id="l7.882" class="difflineplus">+                         PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l7.883"></a><span id="l7.883" class="difflineplus">+                         PlacesUtils.toolbarFolderId);</span>
<a href="#l7.884"></a><span id="l7.884" class="difflineplus">+    return this._folders;</span>
<a href="#l7.885"></a><span id="l7.885" class="difflineplus">+  },</span>
<a href="#l7.886"></a><span id="l7.886" class="difflineplus">+  set folders(aFolders) {</span>
<a href="#l7.887"></a><span id="l7.887" class="difflineplus">+    this._folders = aFolders;</span>
<a href="#l7.888"></a><span id="l7.888" class="difflineplus">+    return aFolders;</span>
<a href="#l7.889"></a><span id="l7.889" class="difflineplus">+  },</span>
<a href="#l7.890"></a><span id="l7.890" class="difflineplus">+</span>
<a href="#l7.891"></a><span id="l7.891" class="difflineplus">+  /**</span>
<a href="#l7.892"></a><span id="l7.892" class="difflineplus">+   * Run a search for the specified text, over the collection specified by</span>
<a href="#l7.893"></a><span id="l7.893" class="difflineplus">+   * the dropdown arrow. The default is all bookmarks, but can be</span>
<a href="#l7.894"></a><span id="l7.894" class="difflineplus">+   * localized to the active collection.</span>
<a href="#l7.895"></a><span id="l7.895" class="difflineplus">+   * @param   filterString</span>
<a href="#l7.896"></a><span id="l7.896" class="difflineplus">+   *          The text to search for.</span>
<a href="#l7.897"></a><span id="l7.897" class="difflineplus">+   */</span>
<a href="#l7.898"></a><span id="l7.898" class="difflineplus">+  search: function PSB_search(filterString) {</span>
<a href="#l7.899"></a><span id="l7.899" class="difflineplus">+    var PO = PlacesOrganizer;</span>
<a href="#l7.900"></a><span id="l7.900" class="difflineplus">+    // If the user empties the search box manually, reset it and load all</span>
<a href="#l7.901"></a><span id="l7.901" class="difflineplus">+    // contents of the current scope.</span>
<a href="#l7.902"></a><span id="l7.902" class="difflineplus">+    // XXX this might be to jumpy, maybe should search for &quot;&quot;, so results</span>
<a href="#l7.903"></a><span id="l7.903" class="difflineplus">+    // are ungrouped, and search box not reset</span>
<a href="#l7.904"></a><span id="l7.904" class="difflineplus">+    if (filterString == &quot;&quot;) {</span>
<a href="#l7.905"></a><span id="l7.905" class="difflineplus">+      PO.onPlaceSelected(false);</span>
<a href="#l7.906"></a><span id="l7.906" class="difflineplus">+      return;</span>
<a href="#l7.907"></a><span id="l7.907" class="difflineplus">+    }</span>
<a href="#l7.908"></a><span id="l7.908" class="difflineplus">+</span>
<a href="#l7.909"></a><span id="l7.909" class="difflineplus">+    var currentOptions = PO.getCurrentOptions();</span>
<a href="#l7.910"></a><span id="l7.910" class="difflineplus">+    var content = PO._content;</span>
<a href="#l7.911"></a><span id="l7.911" class="difflineplus">+</span>
<a href="#l7.912"></a><span id="l7.912" class="difflineplus">+    // Search according to the current scope and folders, which were set by</span>
<a href="#l7.913"></a><span id="l7.913" class="difflineplus">+    // PQB_setScope()</span>
<a href="#l7.914"></a><span id="l7.914" class="difflineplus">+    switch (PlacesSearchBox.filterCollection) {</span>
<a href="#l7.915"></a><span id="l7.915" class="difflineplus">+    case &quot;collection&quot;:</span>
<a href="#l7.916"></a><span id="l7.916" class="difflineplus">+      content.applyFilter(filterString, this.folders);</span>
<a href="#l7.917"></a><span id="l7.917" class="difflineplus">+      // XXX changing the button text is badness</span>
<a href="#l7.918"></a><span id="l7.918" class="difflineplus">+      //var scopeBtn = document.getElementById(&quot;scopeBarFolder&quot;);</span>
<a href="#l7.919"></a><span id="l7.919" class="difflineplus">+      //scopeBtn.label = PlacesOrganizer._places.selectedNode.title;</span>
<a href="#l7.920"></a><span id="l7.920" class="difflineplus">+      break;</span>
<a href="#l7.921"></a><span id="l7.921" class="difflineplus">+    case &quot;bookmarks&quot;:</span>
<a href="#l7.922"></a><span id="l7.922" class="difflineplus">+      content.applyFilter(filterString, this.folders);</span>
<a href="#l7.923"></a><span id="l7.923" class="difflineplus">+      break;</span>
<a href="#l7.924"></a><span id="l7.924" class="difflineplus">+    default:</span>
<a href="#l7.925"></a><span id="l7.925" class="difflineplus">+      throw &quot;Invalid filterCollection on search&quot;;</span>
<a href="#l7.926"></a><span id="l7.926" class="difflineplus">+      break;</span>
<a href="#l7.927"></a><span id="l7.927" class="difflineplus">+    }</span>
<a href="#l7.928"></a><span id="l7.928" class="difflineplus">+</span>
<a href="#l7.929"></a><span id="l7.929" class="difflineplus">+    PlacesSearchBox.showSearchUI();</span>
<a href="#l7.930"></a><span id="l7.930" class="difflineplus">+</span>
<a href="#l7.931"></a><span id="l7.931" class="difflineplus">+    // Update the details panel</span>
<a href="#l7.932"></a><span id="l7.932" class="difflineplus">+    PlacesOrganizer.onContentTreeSelect();</span>
<a href="#l7.933"></a><span id="l7.933" class="difflineplus">+  },</span>
<a href="#l7.934"></a><span id="l7.934" class="difflineplus">+</span>
<a href="#l7.935"></a><span id="l7.935" class="difflineplus">+  /**</span>
<a href="#l7.936"></a><span id="l7.936" class="difflineplus">+   * Finds across all bookmarks</span>
<a href="#l7.937"></a><span id="l7.937" class="difflineplus">+   */</span>
<a href="#l7.938"></a><span id="l7.938" class="difflineplus">+  findAll: function PSB_findAll() {</span>
<a href="#l7.939"></a><span id="l7.939" class="difflineplus">+    PlacesQueryBuilder.setScope(&quot;bookmarks&quot;);</span>
<a href="#l7.940"></a><span id="l7.940" class="difflineplus">+    this.focus();</span>
<a href="#l7.941"></a><span id="l7.941" class="difflineplus">+  },</span>
<a href="#l7.942"></a><span id="l7.942" class="difflineplus">+</span>
<a href="#l7.943"></a><span id="l7.943" class="difflineplus">+  /**</span>
<a href="#l7.944"></a><span id="l7.944" class="difflineplus">+   * Finds in the currently selected Place.</span>
<a href="#l7.945"></a><span id="l7.945" class="difflineplus">+   */</span>
<a href="#l7.946"></a><span id="l7.946" class="difflineplus">+  findCurrent: function PSB_findCurrent() {</span>
<a href="#l7.947"></a><span id="l7.947" class="difflineplus">+    PlacesQueryBuilder.setScope(&quot;collection&quot;);</span>
<a href="#l7.948"></a><span id="l7.948" class="difflineplus">+    this.focus();</span>
<a href="#l7.949"></a><span id="l7.949" class="difflineplus">+  },</span>
<a href="#l7.950"></a><span id="l7.950" class="difflineplus">+</span>
<a href="#l7.951"></a><span id="l7.951" class="difflineplus">+  /**</span>
<a href="#l7.952"></a><span id="l7.952" class="difflineplus">+   * Updates the display with the title of the current collection.</span>
<a href="#l7.953"></a><span id="l7.953" class="difflineplus">+   * @param   title</span>
<a href="#l7.954"></a><span id="l7.954" class="difflineplus">+   *          The title of the current collection.</span>
<a href="#l7.955"></a><span id="l7.955" class="difflineplus">+   */</span>
<a href="#l7.956"></a><span id="l7.956" class="difflineplus">+  updateCollectionTitle: function PSB_updateCollectionTitle(title) {</span>
<a href="#l7.957"></a><span id="l7.957" class="difflineplus">+    if (title)</span>
<a href="#l7.958"></a><span id="l7.958" class="difflineplus">+      this.searchFilter.placeholder =</span>
<a href="#l7.959"></a><span id="l7.959" class="difflineplus">+        PlacesUIUtils.getFormattedString(&quot;searchCurrentDefault&quot;, [title]);</span>
<a href="#l7.960"></a><span id="l7.960" class="difflineplus">+    else</span>
<a href="#l7.961"></a><span id="l7.961" class="difflineplus">+      this.searchFilter.placeholder = PlacesUIUtils.getString(&quot;searchBookmarks&quot;);</span>
<a href="#l7.962"></a><span id="l7.962" class="difflineplus">+  },</span>
<a href="#l7.963"></a><span id="l7.963" class="difflineplus">+</span>
<a href="#l7.964"></a><span id="l7.964" class="difflineplus">+  /**</span>
<a href="#l7.965"></a><span id="l7.965" class="difflineplus">+   * Gets/sets the active collection from the dropdown menu.</span>
<a href="#l7.966"></a><span id="l7.966" class="difflineplus">+   */</span>
<a href="#l7.967"></a><span id="l7.967" class="difflineplus">+  get filterCollection() {</span>
<a href="#l7.968"></a><span id="l7.968" class="difflineplus">+    return this.searchFilter.getAttribute(&quot;collection&quot;);</span>
<a href="#l7.969"></a><span id="l7.969" class="difflineplus">+  },</span>
<a href="#l7.970"></a><span id="l7.970" class="difflineplus">+  set filterCollection(collectionName) {</span>
<a href="#l7.971"></a><span id="l7.971" class="difflineplus">+    if (collectionName == this.filterCollection)</span>
<a href="#l7.972"></a><span id="l7.972" class="difflineplus">+      return collectionName;</span>
<a href="#l7.973"></a><span id="l7.973" class="difflineplus">+</span>
<a href="#l7.974"></a><span id="l7.974" class="difflineplus">+    this.searchFilter.setAttribute(&quot;collection&quot;, collectionName);</span>
<a href="#l7.975"></a><span id="l7.975" class="difflineplus">+</span>
<a href="#l7.976"></a><span id="l7.976" class="difflineplus">+    var newGrayText = null;</span>
<a href="#l7.977"></a><span id="l7.977" class="difflineplus">+    if (collectionName == &quot;collection&quot;) {</span>
<a href="#l7.978"></a><span id="l7.978" class="difflineplus">+      newGrayText = PlacesOrganizer._places.selectedNode.title ||</span>
<a href="#l7.979"></a><span id="l7.979" class="difflineplus">+                    document.getElementById(&quot;scopeBarFolder&quot;).</span>
<a href="#l7.980"></a><span id="l7.980" class="difflineplus">+                      getAttribute(&quot;emptytitle&quot;);</span>
<a href="#l7.981"></a><span id="l7.981" class="difflineplus">+    }</span>
<a href="#l7.982"></a><span id="l7.982" class="difflineplus">+    this.updateCollectionTitle(newGrayText);</span>
<a href="#l7.983"></a><span id="l7.983" class="difflineplus">+    return collectionName;</span>
<a href="#l7.984"></a><span id="l7.984" class="difflineplus">+  },</span>
<a href="#l7.985"></a><span id="l7.985" class="difflineplus">+</span>
<a href="#l7.986"></a><span id="l7.986" class="difflineplus">+  /**</span>
<a href="#l7.987"></a><span id="l7.987" class="difflineplus">+   * Focus the search box</span>
<a href="#l7.988"></a><span id="l7.988" class="difflineplus">+   */</span>
<a href="#l7.989"></a><span id="l7.989" class="difflineplus">+  focus: function PSB_focus() {</span>
<a href="#l7.990"></a><span id="l7.990" class="difflineplus">+    this.searchFilter.focus();</span>
<a href="#l7.991"></a><span id="l7.991" class="difflineplus">+  },</span>
<a href="#l7.992"></a><span id="l7.992" class="difflineplus">+</span>
<a href="#l7.993"></a><span id="l7.993" class="difflineplus">+  /**</span>
<a href="#l7.994"></a><span id="l7.994" class="difflineplus">+   * Set up the gray text in the search bar as the Places View loads.</span>
<a href="#l7.995"></a><span id="l7.995" class="difflineplus">+   */</span>
<a href="#l7.996"></a><span id="l7.996" class="difflineplus">+  init: function PSB_init() {</span>
<a href="#l7.997"></a><span id="l7.997" class="difflineplus">+    this.updateCollectionTitle();</span>
<a href="#l7.998"></a><span id="l7.998" class="difflineplus">+  },</span>
<a href="#l7.999"></a><span id="l7.999" class="difflineplus">+</span>
<a href="#l7.1000"></a><span id="l7.1000" class="difflineplus">+  /**</span>
<a href="#l7.1001"></a><span id="l7.1001" class="difflineplus">+   * Gets or sets the text shown in the Places Search Box</span>
<a href="#l7.1002"></a><span id="l7.1002" class="difflineplus">+   */</span>
<a href="#l7.1003"></a><span id="l7.1003" class="difflineplus">+  get value() {</span>
<a href="#l7.1004"></a><span id="l7.1004" class="difflineplus">+    return this.searchFilter.value;</span>
<a href="#l7.1005"></a><span id="l7.1005" class="difflineplus">+  },</span>
<a href="#l7.1006"></a><span id="l7.1006" class="difflineplus">+  set value(value) {</span>
<a href="#l7.1007"></a><span id="l7.1007" class="difflineplus">+    return this.searchFilter.value = value;</span>
<a href="#l7.1008"></a><span id="l7.1008" class="difflineplus">+  },</span>
<a href="#l7.1009"></a><span id="l7.1009" class="difflineplus">+</span>
<a href="#l7.1010"></a><span id="l7.1010" class="difflineplus">+  showSearchUI: function PSB_showSearchUI() {</span>
<a href="#l7.1011"></a><span id="l7.1011" class="difflineplus">+    // Hide the advanced search controls when the user hasn't searched</span>
<a href="#l7.1012"></a><span id="l7.1012" class="difflineplus">+    var searchModifiers = document.getElementById(&quot;searchModifiers&quot;);</span>
<a href="#l7.1013"></a><span id="l7.1013" class="difflineplus">+    searchModifiers.hidden = false;</span>
<a href="#l7.1014"></a><span id="l7.1014" class="difflineplus">+  },</span>
<a href="#l7.1015"></a><span id="l7.1015" class="difflineplus">+</span>
<a href="#l7.1016"></a><span id="l7.1016" class="difflineplus">+  hideSearchUI: function PSB_hideSearchUI() {</span>
<a href="#l7.1017"></a><span id="l7.1017" class="difflineplus">+    var searchModifiers = document.getElementById(&quot;searchModifiers&quot;);</span>
<a href="#l7.1018"></a><span id="l7.1018" class="difflineplus">+    searchModifiers.hidden = true;</span>
<a href="#l7.1019"></a><span id="l7.1019" class="difflineplus">+  }</span>
<a href="#l7.1020"></a><span id="l7.1020" class="difflineplus">+};</span>
<a href="#l7.1021"></a><span id="l7.1021" class="difflineplus">+</span>
<a href="#l7.1022"></a><span id="l7.1022" class="difflineplus">+/**</span>
<a href="#l7.1023"></a><span id="l7.1023" class="difflineplus">+ * Functions and data for advanced query builder</span>
<a href="#l7.1024"></a><span id="l7.1024" class="difflineplus">+ */</span>
<a href="#l7.1025"></a><span id="l7.1025" class="difflineplus">+var PlacesQueryBuilder = {</span>
<a href="#l7.1026"></a><span id="l7.1026" class="difflineplus">+</span>
<a href="#l7.1027"></a><span id="l7.1027" class="difflineplus">+  queries: [],</span>
<a href="#l7.1028"></a><span id="l7.1028" class="difflineplus">+  queryOptions: null,</span>
<a href="#l7.1029"></a><span id="l7.1029"> </span>
<a href="#l7.1030"></a><span id="l7.1030" class="difflineminus">-function UpdateViewColumns()</span>
<a href="#l7.1031"></a><span id="l7.1031" class="difflineminus">-{</span>
<a href="#l7.1032"></a><span id="l7.1032" class="difflineminus">-  var bookmarksView = document.getElementById(&quot;bookmarks-view&quot;);</span>
<a href="#l7.1033"></a><span id="l7.1033" class="difflineminus">-  var columns = bookmarksView.columns;</span>
<a href="#l7.1034"></a><span id="l7.1034" class="difflineminus">-  for (var i = 0; i &lt; columns.length; ++i) {</span>
<a href="#l7.1035"></a><span id="l7.1035" class="difflineminus">-    var element = document.getElementById(&quot;columnMenuItem:&quot; + columns[i].id);</span>
<a href="#l7.1036"></a><span id="l7.1036" class="difflineminus">-    if (element)</span>
<a href="#l7.1037"></a><span id="l7.1037" class="difflineminus">-      element.setAttribute(&quot;checked&quot;, columns[i].hidden != &quot;true&quot;);</span>
<a href="#l7.1038"></a><span id="l7.1038" class="difflineplus">+  /**</span>
<a href="#l7.1039"></a><span id="l7.1039" class="difflineplus">+   * Called when a scope button in the scope bar is clicked.</span>
<a href="#l7.1040"></a><span id="l7.1040" class="difflineplus">+   * @param   aButton</span>
<a href="#l7.1041"></a><span id="l7.1041" class="difflineplus">+   *          the scope button that was selected</span>
<a href="#l7.1042"></a><span id="l7.1042" class="difflineplus">+   */</span>
<a href="#l7.1043"></a><span id="l7.1043" class="difflineplus">+  onScopeSelected: function PQB_onScopeSelected(aButton) {</span>
<a href="#l7.1044"></a><span id="l7.1044" class="difflineplus">+    switch (aButton.id) {</span>
<a href="#l7.1045"></a><span id="l7.1045" class="difflineplus">+    case &quot;scopeBarFolder&quot;:</span>
<a href="#l7.1046"></a><span id="l7.1046" class="difflineplus">+      this.setScope(&quot;collection&quot;);</span>
<a href="#l7.1047"></a><span id="l7.1047" class="difflineplus">+      break;</span>
<a href="#l7.1048"></a><span id="l7.1048" class="difflineplus">+    case &quot;scopeBarAll&quot;:</span>
<a href="#l7.1049"></a><span id="l7.1049" class="difflineplus">+      this.setScope(&quot;bookmarks&quot;);</span>
<a href="#l7.1050"></a><span id="l7.1050" class="difflineplus">+      break;</span>
<a href="#l7.1051"></a><span id="l7.1051" class="difflineplus">+    default:</span>
<a href="#l7.1052"></a><span id="l7.1052" class="difflineplus">+      throw &quot;Invalid search scope button ID&quot;;</span>
<a href="#l7.1053"></a><span id="l7.1053" class="difflineplus">+      break;</span>
<a href="#l7.1054"></a><span id="l7.1054" class="difflineplus">+    }</span>
<a href="#l7.1055"></a><span id="l7.1055" class="difflineplus">+  },</span>
<a href="#l7.1056"></a><span id="l7.1056" class="difflineplus">+</span>
<a href="#l7.1057"></a><span id="l7.1057" class="difflineplus">+  /**</span>
<a href="#l7.1058"></a><span id="l7.1058" class="difflineplus">+   * Sets the search scope.  This can be called when no search is active, and</span>
<a href="#l7.1059"></a><span id="l7.1059" class="difflineplus">+   * in that case, when the user does begin a search aScope will be used (see</span>
<a href="#l7.1060"></a><span id="l7.1060" class="difflineplus">+   * PSB_search()).  If there is an active search, it's performed again to</span>
<a href="#l7.1061"></a><span id="l7.1061" class="difflineplus">+   * update the content tree.</span>
<a href="#l7.1062"></a><span id="l7.1062" class="difflineplus">+   * @param   aScope</span>
<a href="#l7.1063"></a><span id="l7.1063" class="difflineplus">+   *          the search scope, &quot;bookmarks&quot; or &quot;collection&quot;</span>
<a href="#l7.1064"></a><span id="l7.1064" class="difflineplus">+   */</span>
<a href="#l7.1065"></a><span id="l7.1065" class="difflineplus">+  setScope: function PQB_setScope(aScope) {</span>
<a href="#l7.1066"></a><span id="l7.1066" class="difflineplus">+    // Determine filterCollection, folders, and scopeButtonId based on aScope.</span>
<a href="#l7.1067"></a><span id="l7.1067" class="difflineplus">+    var filterCollection;</span>
<a href="#l7.1068"></a><span id="l7.1068" class="difflineplus">+    var folders = [];</span>
<a href="#l7.1069"></a><span id="l7.1069" class="difflineplus">+    var scopeButtonId;</span>
<a href="#l7.1070"></a><span id="l7.1070" class="difflineplus">+    switch (aScope) {</span>
<a href="#l7.1071"></a><span id="l7.1071" class="difflineplus">+    case &quot;collection&quot;:</span>
<a href="#l7.1072"></a><span id="l7.1072" class="difflineplus">+      // The folder scope button can only become hidden upon selecting a new</span>
<a href="#l7.1073"></a><span id="l7.1073" class="difflineplus">+      // folder in the left pane, and the disabled state will remain unchanged</span>
<a href="#l7.1074"></a><span id="l7.1074" class="difflineplus">+      // until a new folder is selected.  See PO__setScopeForNode().</span>
<a href="#l7.1075"></a><span id="l7.1075" class="difflineplus">+      if (!document.getElementById(&quot;scopeBarFolder&quot;).hidden) {</span>
<a href="#l7.1076"></a><span id="l7.1076" class="difflineplus">+        filterCollection = &quot;collection&quot;;</span>
<a href="#l7.1077"></a><span id="l7.1077" class="difflineplus">+        scopeButtonId = &quot;scopeBarFolder&quot;;</span>
<a href="#l7.1078"></a><span id="l7.1078" class="difflineplus">+        folders.push(PlacesUtils.getConcreteItemId(</span>
<a href="#l7.1079"></a><span id="l7.1079" class="difflineplus">+                       PlacesOrganizer._places.selectedNode));</span>
<a href="#l7.1080"></a><span id="l7.1080" class="difflineplus">+        break;</span>
<a href="#l7.1081"></a><span id="l7.1081" class="difflineplus">+      }</span>
<a href="#l7.1082"></a><span id="l7.1082" class="difflineplus">+      // Fall through.  If collection scope doesn't make sense for the</span>
<a href="#l7.1083"></a><span id="l7.1083" class="difflineplus">+      // selected node, choose bookmarks scope.</span>
<a href="#l7.1084"></a><span id="l7.1084" class="difflineplus">+    case &quot;bookmarks&quot;:</span>
<a href="#l7.1085"></a><span id="l7.1085" class="difflineplus">+      filterCollection = &quot;bookmarks&quot;;</span>
<a href="#l7.1086"></a><span id="l7.1086" class="difflineplus">+      scopeButtonId = &quot;scopeBarAll&quot;;</span>
<a href="#l7.1087"></a><span id="l7.1087" class="difflineplus">+      folders.push(PlacesUtils.bookmarksMenuFolderId,</span>
<a href="#l7.1088"></a><span id="l7.1088" class="difflineplus">+                   PlacesUtils.toolbarFolderId,</span>
<a href="#l7.1089"></a><span id="l7.1089" class="difflineplus">+                   PlacesUtils.unfiledBookmarksFolderId);</span>
<a href="#l7.1090"></a><span id="l7.1090" class="difflineplus">+      break;</span>
<a href="#l7.1091"></a><span id="l7.1091" class="difflineplus">+    default:</span>
<a href="#l7.1092"></a><span id="l7.1092" class="difflineplus">+      throw &quot;Invalid search scope&quot;;</span>
<a href="#l7.1093"></a><span id="l7.1093" class="difflineplus">+      break;</span>
<a href="#l7.1094"></a><span id="l7.1094" class="difflineplus">+    }</span>
<a href="#l7.1095"></a><span id="l7.1095" class="difflineplus">+</span>
<a href="#l7.1096"></a><span id="l7.1096" class="difflineplus">+    // Check the appropriate scope button in the scope bar.</span>
<a href="#l7.1097"></a><span id="l7.1097" class="difflineplus">+    document.getElementById(scopeButtonId).checked = true;</span>
<a href="#l7.1098"></a><span id="l7.1098" class="difflineplus">+</span>
<a href="#l7.1099"></a><span id="l7.1099" class="difflineplus">+    // Update the search box.  Re-search if there's an active search.</span>
<a href="#l7.1100"></a><span id="l7.1100" class="difflineplus">+    PlacesSearchBox.filterCollection = filterCollection;</span>
<a href="#l7.1101"></a><span id="l7.1101" class="difflineplus">+    PlacesSearchBox.folders = folders;</span>
<a href="#l7.1102"></a><span id="l7.1102" class="difflineplus">+    var searchStr = PlacesSearchBox.searchFilter.value;</span>
<a href="#l7.1103"></a><span id="l7.1103" class="difflineplus">+    if (searchStr)</span>
<a href="#l7.1104"></a><span id="l7.1104" class="difflineplus">+      PlacesSearchBox.search(searchStr);</span>
<a href="#l7.1105"></a><span id="l7.1105">   }</span>
<a href="#l7.1106"></a><span id="l7.1106" class="difflineminus">-}</span>
<a href="#l7.1107"></a><span id="l7.1107" class="difflineplus">+};</span>
<a href="#l7.1108"></a><span id="l7.1108" class="difflineplus">+</span>
<a href="#l7.1109"></a><span id="l7.1109" class="difflineplus">+/**</span>
<a href="#l7.1110"></a><span id="l7.1110" class="difflineplus">+ * Population and commands for the View Menu.</span>
<a href="#l7.1111"></a><span id="l7.1111" class="difflineplus">+ */</span>
<a href="#l7.1112"></a><span id="l7.1112" class="difflineplus">+var ViewMenu = {</span>
<a href="#l7.1113"></a><span id="l7.1113" class="difflineplus">+  /**</span>
<a href="#l7.1114"></a><span id="l7.1114" class="difflineplus">+   * Removes content generated previously from a menupopup.</span>
<a href="#l7.1115"></a><span id="l7.1115" class="difflineplus">+   * @param   popup</span>
<a href="#l7.1116"></a><span id="l7.1116" class="difflineplus">+   *          The popup that contains the previously generated content.</span>
<a href="#l7.1117"></a><span id="l7.1117" class="difflineplus">+   * @param   startID</span>
<a href="#l7.1118"></a><span id="l7.1118" class="difflineplus">+   *          The id attribute of an element that is the start of the</span>
<a href="#l7.1119"></a><span id="l7.1119" class="difflineplus">+   *          dynamically generated region - remove elements after this</span>
<a href="#l7.1120"></a><span id="l7.1120" class="difflineplus">+   *          item only.</span>
<a href="#l7.1121"></a><span id="l7.1121" class="difflineplus">+   *          Must be contained by popup. Can be null (in which case the</span>
<a href="#l7.1122"></a><span id="l7.1122" class="difflineplus">+   *          contents of popup are removed).</span>
<a href="#l7.1123"></a><span id="l7.1123" class="difflineplus">+   * @param   endID</span>
<a href="#l7.1124"></a><span id="l7.1124" class="difflineplus">+   *          The id attribute of an element that is the end of the</span>
<a href="#l7.1125"></a><span id="l7.1125" class="difflineplus">+   *          dynamically generated region - remove elements up to this</span>
<a href="#l7.1126"></a><span id="l7.1126" class="difflineplus">+   *          item only.</span>
<a href="#l7.1127"></a><span id="l7.1127" class="difflineplus">+   *          Must be contained by popup. Can be null (in which case all</span>
<a href="#l7.1128"></a><span id="l7.1128" class="difflineplus">+   *          items until the end of the popup will be removed). Ignored</span>
<a href="#l7.1129"></a><span id="l7.1129" class="difflineplus">+   *          if startID is null.</span>
<a href="#l7.1130"></a><span id="l7.1130" class="difflineplus">+   * @returns The element for the caller to insert new items before,</span>
<a href="#l7.1131"></a><span id="l7.1131" class="difflineplus">+   *          null if the caller should just append to the popup.</span>
<a href="#l7.1132"></a><span id="l7.1132" class="difflineplus">+   */</span>
<a href="#l7.1133"></a><span id="l7.1133" class="difflineplus">+  _clean: function VM__clean(popup, startID, endID) {</span>
<a href="#l7.1134"></a><span id="l7.1134" class="difflineplus">+    if (endID)</span>
<a href="#l7.1135"></a><span id="l7.1135" class="difflineplus">+      NS_ASSERT(startID, &quot;meaningless to have valid endID and null startID&quot;);</span>
<a href="#l7.1136"></a><span id="l7.1136" class="difflineplus">+    if (startID) {</span>
<a href="#l7.1137"></a><span id="l7.1137" class="difflineplus">+      var startElement = document.getElementById(startID);</span>
<a href="#l7.1138"></a><span id="l7.1138" class="difflineplus">+      NS_ASSERT(startElement.parentNode ==</span>
<a href="#l7.1139"></a><span id="l7.1139" class="difflineplus">+                popup, &quot;startElement is not in popup&quot;);</span>
<a href="#l7.1140"></a><span id="l7.1140" class="difflineplus">+      NS_ASSERT(startElement,</span>
<a href="#l7.1141"></a><span id="l7.1141" class="difflineplus">+                &quot;startID does not correspond to an existing element&quot;);</span>
<a href="#l7.1142"></a><span id="l7.1142" class="difflineplus">+      var endElement = null;</span>
<a href="#l7.1143"></a><span id="l7.1143" class="difflineplus">+      if (endID) {</span>
<a href="#l7.1144"></a><span id="l7.1144" class="difflineplus">+        endElement = document.getElementById(endID);</span>
<a href="#l7.1145"></a><span id="l7.1145" class="difflineplus">+        NS_ASSERT(endElement.parentNode == popup,</span>
<a href="#l7.1146"></a><span id="l7.1146" class="difflineplus">+                  &quot;endElement is not in popup&quot;);</span>
<a href="#l7.1147"></a><span id="l7.1147" class="difflineplus">+        NS_ASSERT(endElement,</span>
<a href="#l7.1148"></a><span id="l7.1148" class="difflineplus">+                  &quot;endID does not correspond to an existing element&quot;);</span>
<a href="#l7.1149"></a><span id="l7.1149" class="difflineplus">+      }</span>
<a href="#l7.1150"></a><span id="l7.1150" class="difflineplus">+      while (startElement.nextSibling != endElement)</span>
<a href="#l7.1151"></a><span id="l7.1151" class="difflineplus">+        popup.removeChild(startElement.nextSibling);</span>
<a href="#l7.1152"></a><span id="l7.1152" class="difflineplus">+      return endElement;</span>
<a href="#l7.1153"></a><span id="l7.1153" class="difflineplus">+    }</span>
<a href="#l7.1154"></a><span id="l7.1154" class="difflineplus">+    else {</span>
<a href="#l7.1155"></a><span id="l7.1155" class="difflineplus">+      while(popup.hasChildNodes())</span>
<a href="#l7.1156"></a><span id="l7.1156" class="difflineplus">+        popup.removeChild(popup.firstChild);</span>
<a href="#l7.1157"></a><span id="l7.1157" class="difflineplus">+    }</span>
<a href="#l7.1158"></a><span id="l7.1158" class="difflineplus">+    return null;</span>
<a href="#l7.1159"></a><span id="l7.1159" class="difflineplus">+  },</span>
<a href="#l7.1160"></a><span id="l7.1160" class="difflineplus">+</span>
<a href="#l7.1161"></a><span id="l7.1161" class="difflineplus">+  /**</span>
<a href="#l7.1162"></a><span id="l7.1162" class="difflineplus">+   * Fills a menupopup with a list of columns</span>
<a href="#l7.1163"></a><span id="l7.1163" class="difflineplus">+   * @param   event</span>
<a href="#l7.1164"></a><span id="l7.1164" class="difflineplus">+   *          The popupshowing event that invoked this function.</span>
<a href="#l7.1165"></a><span id="l7.1165" class="difflineplus">+   * @param   startID</span>
<a href="#l7.1166"></a><span id="l7.1166" class="difflineplus">+   *          see _clean</span>
<a href="#l7.1167"></a><span id="l7.1167" class="difflineplus">+   * @param   endID</span>
<a href="#l7.1168"></a><span id="l7.1168" class="difflineplus">+   *          see _clean</span>
<a href="#l7.1169"></a><span id="l7.1169" class="difflineplus">+   * @param   type</span>
<a href="#l7.1170"></a><span id="l7.1170" class="difflineplus">+   *          the type of the menuitem, e.g. &quot;radio&quot; or &quot;checkbox&quot;.</span>
<a href="#l7.1171"></a><span id="l7.1171" class="difflineplus">+   *          Can be null (no-type).</span>
<a href="#l7.1172"></a><span id="l7.1172" class="difflineplus">+   *          Checkboxes are checked if the column is visible.</span>
<a href="#l7.1173"></a><span id="l7.1173" class="difflineplus">+   * @param   propertyPrefix</span>
<a href="#l7.1174"></a><span id="l7.1174" class="difflineplus">+   *          If propertyPrefix is non-null:</span>
<a href="#l7.1175"></a><span id="l7.1175" class="difflineplus">+   *          propertyPrefix + column ID + &quot;.label&quot; will be used to get the</span>
<a href="#l7.1176"></a><span id="l7.1176" class="difflineplus">+   *          localized label string.</span>
<a href="#l7.1177"></a><span id="l7.1177" class="difflineplus">+   *          propertyPrefix + column ID + &quot;.accesskey&quot; will be used to get the</span>
<a href="#l7.1178"></a><span id="l7.1178" class="difflineplus">+   *          localized accesskey.</span>
<a href="#l7.1179"></a><span id="l7.1179" class="difflineplus">+   *          If propertyPrefix is null, the column label is used as label and</span>
<a href="#l7.1180"></a><span id="l7.1180" class="difflineplus">+   *          no accesskey is assigned.</span>
<a href="#l7.1181"></a><span id="l7.1181" class="difflineplus">+   */</span>
<a href="#l7.1182"></a><span id="l7.1182" class="difflineplus">+  fillWithColumns: function VM_fillWithColumns(event, startID, endID, type, propertyPrefix) {</span>
<a href="#l7.1183"></a><span id="l7.1183" class="difflineplus">+    var popup = event.target;</span>
<a href="#l7.1184"></a><span id="l7.1184" class="difflineplus">+    var pivot = this._clean(popup, startID, endID);</span>
<a href="#l7.1185"></a><span id="l7.1185"> </span>
<a href="#l7.1186"></a><span id="l7.1186" class="difflineminus">-function onViewMenuColumnItemSelected(aEvent)</span>
<a href="#l7.1187"></a><span id="l7.1187" class="difflineminus">-{</span>
<a href="#l7.1188"></a><span id="l7.1188" class="difflineminus">-  var colid = aEvent.target.id.replace(/columnMenuItem:/, &quot;&quot;);</span>
<a href="#l7.1189"></a><span id="l7.1189" class="difflineminus">-  if (colid != &quot;&quot;) {</span>
<a href="#l7.1190"></a><span id="l7.1190" class="difflineminus">-    var bookmarksView = document.getElementById(&quot;bookmarks-view&quot;);</span>
<a href="#l7.1191"></a><span id="l7.1191" class="difflineminus">-    bookmarksView.toggleColumnVisibility(colid);</span>
<a href="#l7.1192"></a><span id="l7.1192" class="difflineminus">-  }  </span>
<a href="#l7.1193"></a><span id="l7.1193" class="difflineminus">-  aEvent.stopPropagation();</span>
<a href="#l7.1194"></a><span id="l7.1194" class="difflineminus">-}</span>
<a href="#l7.1195"></a><span id="l7.1195" class="difflineplus">+    // If no column is &quot;sort-active&quot;, the &quot;Unsorted&quot; item needs to be checked,</span>
<a href="#l7.1196"></a><span id="l7.1196" class="difflineplus">+    // so track whether or not we find a column that is sort-active.</span>
<a href="#l7.1197"></a><span id="l7.1197" class="difflineplus">+    var isSorted = false;</span>
<a href="#l7.1198"></a><span id="l7.1198" class="difflineplus">+    var content = document.getElementById(&quot;placeContent&quot;);</span>
<a href="#l7.1199"></a><span id="l7.1199" class="difflineplus">+    var columns = content.columns;</span>
<a href="#l7.1200"></a><span id="l7.1200" class="difflineplus">+    for (var i = 0; i &lt; columns.count; ++i) {</span>
<a href="#l7.1201"></a><span id="l7.1201" class="difflineplus">+      var column = columns.getColumnAt(i).element;</span>
<a href="#l7.1202"></a><span id="l7.1202" class="difflineplus">+      var menuitem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l7.1203"></a><span id="l7.1203" class="difflineplus">+      menuitem.id = &quot;menucol_&quot; + column.id;</span>
<a href="#l7.1204"></a><span id="l7.1204" class="difflineplus">+      menuitem.column = column;</span>
<a href="#l7.1205"></a><span id="l7.1205" class="difflineplus">+      var label = column.getAttribute(&quot;label&quot;);</span>
<a href="#l7.1206"></a><span id="l7.1206" class="difflineplus">+      if (propertyPrefix) {</span>
<a href="#l7.1207"></a><span id="l7.1207" class="difflineplus">+        var menuitemPrefix = propertyPrefix;</span>
<a href="#l7.1208"></a><span id="l7.1208" class="difflineplus">+        // for string properties, use &quot;name&quot; as the id, instead of &quot;title&quot;</span>
<a href="#l7.1209"></a><span id="l7.1209" class="difflineplus">+        // see bug #386287 for details</span>
<a href="#l7.1210"></a><span id="l7.1210" class="difflineplus">+        var columnId = column.getAttribute(&quot;anonid&quot;);</span>
<a href="#l7.1211"></a><span id="l7.1211" class="difflineplus">+        menuitemPrefix += columnId == &quot;title&quot; ? &quot;name&quot; : columnId;</span>
<a href="#l7.1212"></a><span id="l7.1212" class="difflineplus">+        label = PlacesUIUtils.getString(menuitemPrefix + &quot;.label&quot;);</span>
<a href="#l7.1213"></a><span id="l7.1213" class="difflineplus">+        var accesskey = PlacesUIUtils.getString(menuitemPrefix + &quot;.accesskey&quot;);</span>
<a href="#l7.1214"></a><span id="l7.1214" class="difflineplus">+        menuitem.setAttribute(&quot;accesskey&quot;, accesskey);</span>
<a href="#l7.1215"></a><span id="l7.1215" class="difflineplus">+      }</span>
<a href="#l7.1216"></a><span id="l7.1216" class="difflineplus">+      menuitem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l7.1217"></a><span id="l7.1217" class="difflineplus">+      if (type == &quot;radio&quot;) {</span>
<a href="#l7.1218"></a><span id="l7.1218" class="difflineplus">+        menuitem.setAttribute(&quot;type&quot;, &quot;radio&quot;);</span>
<a href="#l7.1219"></a><span id="l7.1219" class="difflineplus">+        menuitem.setAttribute(&quot;name&quot;, &quot;columns&quot;);</span>
<a href="#l7.1220"></a><span id="l7.1220" class="difflineplus">+        // This column is the sort key. Its item is checked.</span>
<a href="#l7.1221"></a><span id="l7.1221" class="difflineplus">+        if (column.getAttribute(&quot;sortDirection&quot;) != &quot;&quot;) {</span>
<a href="#l7.1222"></a><span id="l7.1222" class="difflineplus">+          menuitem.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l7.1223"></a><span id="l7.1223" class="difflineplus">+          isSorted = true;</span>
<a href="#l7.1224"></a><span id="l7.1224" class="difflineplus">+        }</span>
<a href="#l7.1225"></a><span id="l7.1225" class="difflineplus">+      }</span>
<a href="#l7.1226"></a><span id="l7.1226" class="difflineplus">+      else if (type == &quot;checkbox&quot;) {</span>
<a href="#l7.1227"></a><span id="l7.1227" class="difflineplus">+        menuitem.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l7.1228"></a><span id="l7.1228" class="difflineplus">+        // Cannot uncheck the primary column.</span>
<a href="#l7.1229"></a><span id="l7.1229" class="difflineplus">+        if (column.getAttribute(&quot;primary&quot;) == &quot;true&quot;)</span>
<a href="#l7.1230"></a><span id="l7.1230" class="difflineplus">+          menuitem.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l7.1231"></a><span id="l7.1231" class="difflineplus">+        // Items for visible columns are checked.</span>
<a href="#l7.1232"></a><span id="l7.1232" class="difflineplus">+        if (!column.hidden)</span>
<a href="#l7.1233"></a><span id="l7.1233" class="difflineplus">+          menuitem.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l7.1234"></a><span id="l7.1234" class="difflineplus">+      }</span>
<a href="#l7.1235"></a><span id="l7.1235" class="difflineplus">+      if (pivot)</span>
<a href="#l7.1236"></a><span id="l7.1236" class="difflineplus">+        popup.insertBefore(menuitem, pivot);</span>
<a href="#l7.1237"></a><span id="l7.1237" class="difflineplus">+      else</span>
<a href="#l7.1238"></a><span id="l7.1238" class="difflineplus">+        popup.appendChild(menuitem);</span>
<a href="#l7.1239"></a><span id="l7.1239" class="difflineplus">+    }</span>
<a href="#l7.1240"></a><span id="l7.1240" class="difflineplus">+    event.stopPropagation();</span>
<a href="#l7.1241"></a><span id="l7.1241" class="difflineplus">+  },</span>
<a href="#l7.1242"></a><span id="l7.1242" class="difflineplus">+</span>
<a href="#l7.1243"></a><span id="l7.1243" class="difflineplus">+  /**</span>
<a href="#l7.1244"></a><span id="l7.1244" class="difflineplus">+   * Set up the content of the view menu.</span>
<a href="#l7.1245"></a><span id="l7.1245" class="difflineplus">+   */</span>
<a href="#l7.1246"></a><span id="l7.1246" class="difflineplus">+  populateSortMenu: function VM_populateSortMenu(event) {</span>
<a href="#l7.1247"></a><span id="l7.1247" class="difflineplus">+    this.fillWithColumns(event, &quot;viewUnsorted&quot;, &quot;directionSeparator&quot;, &quot;radio&quot;, &quot;view.sortBy.&quot;);</span>
<a href="#l7.1248"></a><span id="l7.1248" class="difflineplus">+</span>
<a href="#l7.1249"></a><span id="l7.1249" class="difflineplus">+    var sortColumn = this._getSortColumn();</span>
<a href="#l7.1250"></a><span id="l7.1250" class="difflineplus">+    var viewSortAscending = document.getElementById(&quot;viewSortAscending&quot;);</span>
<a href="#l7.1251"></a><span id="l7.1251" class="difflineplus">+    var viewSortDescending = document.getElementById(&quot;viewSortDescending&quot;);</span>
<a href="#l7.1252"></a><span id="l7.1252" class="difflineplus">+    // We need to remove an existing checked attribute because the unsorted</span>
<a href="#l7.1253"></a><span id="l7.1253" class="difflineplus">+    // menu item is not rebuilt every time we open the menu like the others.</span>
<a href="#l7.1254"></a><span id="l7.1254" class="difflineplus">+    var viewUnsorted = document.getElementById(&quot;viewUnsorted&quot;);</span>
<a href="#l7.1255"></a><span id="l7.1255" class="difflineplus">+    if (!sortColumn) {</span>
<a href="#l7.1256"></a><span id="l7.1256" class="difflineplus">+      viewSortAscending.removeAttribute(&quot;checked&quot;);</span>
<a href="#l7.1257"></a><span id="l7.1257" class="difflineplus">+      viewSortDescending.removeAttribute(&quot;checked&quot;);</span>
<a href="#l7.1258"></a><span id="l7.1258" class="difflineplus">+      viewUnsorted.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l7.1259"></a><span id="l7.1259" class="difflineplus">+    }</span>
<a href="#l7.1260"></a><span id="l7.1260" class="difflineplus">+    else if (sortColumn.getAttribute(&quot;sortDirection&quot;) == &quot;ascending&quot;) {</span>
<a href="#l7.1261"></a><span id="l7.1261" class="difflineplus">+      viewSortAscending.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l7.1262"></a><span id="l7.1262" class="difflineplus">+      viewSortDescending.removeAttribute(&quot;checked&quot;);</span>
<a href="#l7.1263"></a><span id="l7.1263" class="difflineplus">+      viewUnsorted.removeAttribute(&quot;checked&quot;);</span>
<a href="#l7.1264"></a><span id="l7.1264" class="difflineplus">+    }</span>
<a href="#l7.1265"></a><span id="l7.1265" class="difflineplus">+    else if (sortColumn.getAttribute(&quot;sortDirection&quot;) == &quot;descending&quot;) {</span>
<a href="#l7.1266"></a><span id="l7.1266" class="difflineplus">+      viewSortDescending.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l7.1267"></a><span id="l7.1267" class="difflineplus">+      viewSortAscending.removeAttribute(&quot;checked&quot;);</span>
<a href="#l7.1268"></a><span id="l7.1268" class="difflineplus">+      viewUnsorted.removeAttribute(&quot;checked&quot;);</span>
<a href="#l7.1269"></a><span id="l7.1269" class="difflineplus">+    }</span>
<a href="#l7.1270"></a><span id="l7.1270" class="difflineplus">+  },</span>
<a href="#l7.1271"></a><span id="l7.1271" class="difflineplus">+</span>
<a href="#l7.1272"></a><span id="l7.1272" class="difflineplus">+  /**</span>
<a href="#l7.1273"></a><span id="l7.1273" class="difflineplus">+   * Shows/Hides a tree column.</span>
<a href="#l7.1274"></a><span id="l7.1274" class="difflineplus">+   * @param   element</span>
<a href="#l7.1275"></a><span id="l7.1275" class="difflineplus">+   *          The menuitem element for the column</span>
<a href="#l7.1276"></a><span id="l7.1276" class="difflineplus">+   */</span>
<a href="#l7.1277"></a><span id="l7.1277" class="difflineplus">+  showHideColumn: function VM_showHideColumn(element) {</span>
<a href="#l7.1278"></a><span id="l7.1278" class="difflineplus">+    var column = element.column;</span>
<a href="#l7.1279"></a><span id="l7.1279" class="difflineplus">+</span>
<a href="#l7.1280"></a><span id="l7.1280" class="difflineplus">+    var splitter = column.nextSibling;</span>
<a href="#l7.1281"></a><span id="l7.1281" class="difflineplus">+    if (splitter &amp;&amp; splitter.localName != &quot;splitter&quot;)</span>
<a href="#l7.1282"></a><span id="l7.1282" class="difflineplus">+      splitter = null;</span>
<a href="#l7.1283"></a><span id="l7.1283"> </span>
<a href="#l7.1284"></a><span id="l7.1284" class="difflineminus">-function OpenBookmarksFile()</span>
<a href="#l7.1285"></a><span id="l7.1285" class="difflineminus">-{</span>
<a href="#l7.1286"></a><span id="l7.1286" class="difflineminus">-  const nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l7.1287"></a><span id="l7.1287" class="difflineminus">-  var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;].createInstance(nsIFilePicker);</span>
<a href="#l7.1288"></a><span id="l7.1288" class="difflineminus">-  fp.init(window, BookmarksUtils.getLocaleString(&quot;SelectOpen&quot;), nsIFilePicker.modeOpen);</span>
<a href="#l7.1289"></a><span id="l7.1289" class="difflineminus">-  fp.appendFilters(nsIFilePicker.filterHTML);</span>
<a href="#l7.1290"></a><span id="l7.1290" class="difflineminus">-  if (fp.show() == nsIFilePicker.returnOK) {</span>
<a href="#l7.1291"></a><span id="l7.1291" class="difflineminus">-    var path = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l7.1292"></a><span id="l7.1292" class="difflineminus">-               .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l7.1293"></a><span id="l7.1293" class="difflineminus">-    path.data = fp.file.path;</span>
<a href="#l7.1294"></a><span id="l7.1294" class="difflineminus">-    PREF.setComplexValue(&quot;browser.bookmarks.file&quot;,</span>
<a href="#l7.1295"></a><span id="l7.1295" class="difflineminus">-                         Components.interfaces.nsISupportsString, path);</span>
<a href="#l7.1296"></a><span id="l7.1296" class="difflineplus">+    if (element.getAttribute(&quot;checked&quot;) == &quot;true&quot;) {</span>
<a href="#l7.1297"></a><span id="l7.1297" class="difflineplus">+      column.setAttribute(&quot;hidden&quot;, &quot;false&quot;);</span>
<a href="#l7.1298"></a><span id="l7.1298" class="difflineplus">+      if (splitter)</span>
<a href="#l7.1299"></a><span id="l7.1299" class="difflineplus">+        splitter.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l7.1300"></a><span id="l7.1300" class="difflineplus">+    }</span>
<a href="#l7.1301"></a><span id="l7.1301" class="difflineplus">+    else {</span>
<a href="#l7.1302"></a><span id="l7.1302" class="difflineplus">+      column.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l7.1303"></a><span id="l7.1303" class="difflineplus">+      if (splitter)</span>
<a href="#l7.1304"></a><span id="l7.1304" class="difflineplus">+        splitter.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l7.1305"></a><span id="l7.1305" class="difflineplus">+    }</span>
<a href="#l7.1306"></a><span id="l7.1306" class="difflineplus">+  },</span>
<a href="#l7.1307"></a><span id="l7.1307" class="difflineplus">+</span>
<a href="#l7.1308"></a><span id="l7.1308" class="difflineplus">+  /**</span>
<a href="#l7.1309"></a><span id="l7.1309" class="difflineplus">+   * Gets the last column that was sorted.</span>
<a href="#l7.1310"></a><span id="l7.1310" class="difflineplus">+   * @returns  the currently sorted column, null if there is no sorted column.</span>
<a href="#l7.1311"></a><span id="l7.1311" class="difflineplus">+   */</span>
<a href="#l7.1312"></a><span id="l7.1312" class="difflineplus">+  _getSortColumn: function VM__getSortColumn() {</span>
<a href="#l7.1313"></a><span id="l7.1313" class="difflineplus">+    var content = document.getElementById(&quot;placeContent&quot;);</span>
<a href="#l7.1314"></a><span id="l7.1314" class="difflineplus">+    var cols = content.columns;</span>
<a href="#l7.1315"></a><span id="l7.1315" class="difflineplus">+    for (var i = 0; i &lt; cols.count; ++i) {</span>
<a href="#l7.1316"></a><span id="l7.1316" class="difflineplus">+      var column = cols.getColumnAt(i).element;</span>
<a href="#l7.1317"></a><span id="l7.1317" class="difflineplus">+      var sortDirection = column.getAttribute(&quot;sortDirection&quot;);</span>
<a href="#l7.1318"></a><span id="l7.1318" class="difflineplus">+      if (sortDirection == &quot;ascending&quot; || sortDirection == &quot;descending&quot;)</span>
<a href="#l7.1319"></a><span id="l7.1319" class="difflineplus">+        return column;</span>
<a href="#l7.1320"></a><span id="l7.1320" class="difflineplus">+    }</span>
<a href="#l7.1321"></a><span id="l7.1321" class="difflineplus">+    return null;</span>
<a href="#l7.1322"></a><span id="l7.1322" class="difflineplus">+  },</span>
<a href="#l7.1323"></a><span id="l7.1323" class="difflineplus">+</span>
<a href="#l7.1324"></a><span id="l7.1324" class="difflineplus">+  /**</span>
<a href="#l7.1325"></a><span id="l7.1325" class="difflineplus">+   * Sorts the view by the specified column.</span>
<a href="#l7.1326"></a><span id="l7.1326" class="difflineplus">+   * @param   aColumn</span>
<a href="#l7.1327"></a><span id="l7.1327" class="difflineplus">+   *          The colum that is the sort key. Can be null - the</span>
<a href="#l7.1328"></a><span id="l7.1328" class="difflineplus">+   *          current sort column or the title column will be used.</span>
<a href="#l7.1329"></a><span id="l7.1329" class="difflineplus">+   * @param   aDirection</span>
<a href="#l7.1330"></a><span id="l7.1330" class="difflineplus">+   *          The direction to sort - &quot;ascending&quot; or &quot;descending&quot;.</span>
<a href="#l7.1331"></a><span id="l7.1331" class="difflineplus">+   *          Can be null - the last direction or descending will be used.</span>
<a href="#l7.1332"></a><span id="l7.1332" class="difflineplus">+   *</span>
<a href="#l7.1333"></a><span id="l7.1333" class="difflineplus">+   * If both aColumnID and aDirection are null, the view will be unsorted.</span>
<a href="#l7.1334"></a><span id="l7.1334" class="difflineplus">+   */</span>
<a href="#l7.1335"></a><span id="l7.1335" class="difflineplus">+  setSortColumn: function VM_setSortColumn(aColumn, aDirection) {</span>
<a href="#l7.1336"></a><span id="l7.1336" class="difflineplus">+    var result = document.getElementById(&quot;placeContent&quot;).result;</span>
<a href="#l7.1337"></a><span id="l7.1337" class="difflineplus">+    if (!aColumn &amp;&amp; !aDirection) {</span>
<a href="#l7.1338"></a><span id="l7.1338" class="difflineplus">+      result.sortingMode = Components.interfaces.nsINavHistoryQueryOptions.SORT_BY_NONE;</span>
<a href="#l7.1339"></a><span id="l7.1339" class="difflineplus">+      return;</span>
<a href="#l7.1340"></a><span id="l7.1340" class="difflineplus">+    }</span>
<a href="#l7.1341"></a><span id="l7.1341" class="difflineplus">+</span>
<a href="#l7.1342"></a><span id="l7.1342" class="difflineplus">+    var columnId;</span>
<a href="#l7.1343"></a><span id="l7.1343" class="difflineplus">+    if (aColumn) {</span>
<a href="#l7.1344"></a><span id="l7.1344" class="difflineplus">+      columnId = aColumn.getAttribute(&quot;anonid&quot;);</span>
<a href="#l7.1345"></a><span id="l7.1345" class="difflineplus">+      if (!aDirection) {</span>
<a href="#l7.1346"></a><span id="l7.1346" class="difflineplus">+        var sortColumn = this._getSortColumn();</span>
<a href="#l7.1347"></a><span id="l7.1347" class="difflineplus">+        if (sortColumn)</span>
<a href="#l7.1348"></a><span id="l7.1348" class="difflineplus">+          aDirection = sortColumn.getAttribute(&quot;sortDirection&quot;);</span>
<a href="#l7.1349"></a><span id="l7.1349" class="difflineplus">+      }</span>
<a href="#l7.1350"></a><span id="l7.1350" class="difflineplus">+    }</span>
<a href="#l7.1351"></a><span id="l7.1351" class="difflineplus">+    else {</span>
<a href="#l7.1352"></a><span id="l7.1352" class="difflineplus">+      var sortColumn = this._getSortColumn();</span>
<a href="#l7.1353"></a><span id="l7.1353" class="difflineplus">+      columnId = sortColumn ? sortColumn.getAttribute(&quot;anonid&quot;) : &quot;title&quot;;</span>
<a href="#l7.1354"></a><span id="l7.1354" class="difflineplus">+    }</span>
<a href="#l7.1355"></a><span id="l7.1355" class="difflineplus">+</span>
<a href="#l7.1356"></a><span id="l7.1356" class="difflineplus">+    // This maps the possible values of columnId (i.e., anonid's of treecols in</span>
<a href="#l7.1357"></a><span id="l7.1357" class="difflineplus">+    // placeContent) to the default sortingMode and sortingAnnotation values for</span>
<a href="#l7.1358"></a><span id="l7.1358" class="difflineplus">+    // each column.</span>
<a href="#l7.1359"></a><span id="l7.1359" class="difflineplus">+    //   key:  Sort key in the name of one of the</span>
<a href="#l7.1360"></a><span id="l7.1360" class="difflineplus">+    //         nsINavHistoryQueryOptions.SORT_BY_* constants</span>
<a href="#l7.1361"></a><span id="l7.1361" class="difflineplus">+    //   dir:  Default sort direction to use if none has been specified</span>
<a href="#l7.1362"></a><span id="l7.1362" class="difflineplus">+    //   anno: The annotation to sort by, if key is &quot;ANNOTATION&quot;</span>
<a href="#l7.1363"></a><span id="l7.1363" class="difflineplus">+    var colLookupTable = {</span>
<a href="#l7.1364"></a><span id="l7.1364" class="difflineplus">+      title:        { key: &quot;TITLE&quot;,        dir: &quot;ascending&quot;  },</span>
<a href="#l7.1365"></a><span id="l7.1365" class="difflineplus">+      tags:         { key: &quot;TAGS&quot;,         dir: &quot;ascending&quot;  },</span>
<a href="#l7.1366"></a><span id="l7.1366" class="difflineplus">+      url:          { key: &quot;URI&quot;,          dir: &quot;ascending&quot;  },</span>
<a href="#l7.1367"></a><span id="l7.1367" class="difflineplus">+      date:         { key: &quot;DATE&quot;,         dir: &quot;descending&quot; },</span>
<a href="#l7.1368"></a><span id="l7.1368" class="difflineplus">+      visitCount:   { key: &quot;VISITCOUNT&quot;,   dir: &quot;descending&quot; },</span>
<a href="#l7.1369"></a><span id="l7.1369" class="difflineplus">+      keyword:      { key: &quot;KEYWORD&quot;,      dir: &quot;ascending&quot;  },</span>
<a href="#l7.1370"></a><span id="l7.1370" class="difflineplus">+      dateAdded:    { key: &quot;DATEADDED&quot;,    dir: &quot;descending&quot; },</span>
<a href="#l7.1371"></a><span id="l7.1371" class="difflineplus">+      lastModified: { key: &quot;LASTMODIFIED&quot;, dir: &quot;descending&quot; },</span>
<a href="#l7.1372"></a><span id="l7.1372" class="difflineplus">+      description:  { key: &quot;ANNOTATION&quot;,</span>
<a href="#l7.1373"></a><span id="l7.1373" class="difflineplus">+                      dir: &quot;ascending&quot;,</span>
<a href="#l7.1374"></a><span id="l7.1374" class="difflineplus">+                      anno: PlacesUIUtils.DESCRIPTION_ANNO }</span>
<a href="#l7.1375"></a><span id="l7.1375" class="difflineplus">+    };</span>
<a href="#l7.1376"></a><span id="l7.1376" class="difflineplus">+</span>
<a href="#l7.1377"></a><span id="l7.1377" class="difflineplus">+    // Make sure we have a valid column.</span>
<a href="#l7.1378"></a><span id="l7.1378" class="difflineplus">+    if (!colLookupTable.hasOwnProperty(columnId))</span>
<a href="#l7.1379"></a><span id="l7.1379" class="difflineplus">+      throw(&quot;Invalid column&quot;);</span>
<a href="#l7.1380"></a><span id="l7.1380" class="difflineplus">+</span>
<a href="#l7.1381"></a><span id="l7.1381" class="difflineplus">+    // Use a default sort direction if none has been specified.  If aDirection</span>
<a href="#l7.1382"></a><span id="l7.1382" class="difflineplus">+    // is invalid, result.sortingMode will be undefined, which has the effect</span>
<a href="#l7.1383"></a><span id="l7.1383" class="difflineplus">+    // of unsorting the tree.</span>
<a href="#l7.1384"></a><span id="l7.1384" class="difflineplus">+    aDirection = (aDirection || colLookupTable[columnId].dir).toUpperCase();</span>
<a href="#l7.1385"></a><span id="l7.1385" class="difflineplus">+</span>
<a href="#l7.1386"></a><span id="l7.1386" class="difflineplus">+    var sortConst = &quot;SORT_BY_&quot; + colLookupTable[columnId].key + &quot;_&quot; + aDirection;</span>
<a href="#l7.1387"></a><span id="l7.1387" class="difflineplus">+    result.sortingAnnotation = colLookupTable[columnId].anno || &quot;&quot;;</span>
<a href="#l7.1388"></a><span id="l7.1388" class="difflineplus">+    result.sortingMode = Components.interfaces.nsINavHistoryQueryOptions[sortConst];</span>
<a href="#l7.1389"></a><span id="l7.1389">   }</span>
<a href="#l7.1390"></a><span id="l7.1390" class="difflineminus">-}</span>
<a href="#l7.1391"></a><span id="l7.1391" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/common/bookmarks/bookmarksManager.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/common/bookmarks/bookmarksManager.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,269 +1,449 @@</span>
<a href="#l8.4"></a><span id="l8.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6" class="difflineminus">-&lt;!-- -*- Mode: HTML; indent-tabs-mode: nil; -*- --&gt;</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineminus">-&lt;!--</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineminus">-</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">- Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">-</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">- The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">- 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">- the License. You may obtain a copy of the License at</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">- http://www.mozilla.org/MPL/</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">- Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">- WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">- for the specific language governing rights and limitations under the</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">- License.</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">- The Original Code is mozilla.org code.</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">- The Initial Developer of the Original Code is</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">- Netscape Communications Corporation.</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">- Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">- the Initial Developer. All Rights Reserved.</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+   -</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+   -</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+   - License.</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+   -</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+   - The Original Code is the Places Organizer.</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+   -</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+   - The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 2005-2006</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+   -</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+   - Contributor(s):</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+   -   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+   -   Annie Sullivan &lt;annie.sullivan@gmail.com&gt;</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+   -   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+   -   Ehsan Akhgari &lt;ehsan.akhgari@gmail.com&gt;</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+   -   Dietrich Ayala &lt;dietrich@mozilla.com&gt;</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+   -</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+   -</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l8.67"></a><span id="l8.67"> </span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">- Contributor(s):</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-   Ben Goodger &lt;ben@netscape.com&gt;</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-   Blake Ross &lt;blakeross@telocity.com&gt;</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-   Dean Tessman &lt;dean_tessman@hotmail.com&gt;</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-   Mike Kowalski &lt;mikejk@ameritech.net&gt;</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/content/places/places.css&quot;?&gt;</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/content/bookmarks/organizer.css&quot;?&gt;</span>
<a href="#l8.75"></a><span id="l8.75"> </span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">- Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">- either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineminus">- or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">- in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">- of those above. If you wish to allow use of your version of this file only</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">- under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineminus">- use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">- decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">- and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">- the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">- the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot;?&gt;</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/bookmarks/bookmarks.css&quot;?&gt;</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/bookmarks/bookmarksManager.css&quot;?&gt;</span>
<a href="#l8.90"></a><span id="l8.90"> </span>
<a href="#l8.91"></a><span id="l8.91" class="difflineminus">- ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://communicator/content/bookmarks/editBookmarkOverlay.xul&quot;?&gt;</span>
<a href="#l8.93"></a><span id="l8.93"> </span>
<a href="#l8.94"></a><span id="l8.94" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/bookmarks/bookmarksWindow.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/content/bookmarks/bookmarks.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineminus">-&lt;?xul-overlay href=&quot;chrome://global/content/globalOverlay.xul&quot;?&gt;</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineminus">-&lt;?xul-overlay href=&quot;chrome://communicator/content/bookmarks/bookmarksOverlay.xul&quot;?&gt;</span>
<a href="#l8.99"></a><span id="l8.99"> &lt;?xul-overlay href=&quot;chrome://communicator/content/utilityOverlay.xul&quot;?&gt;</span>
<a href="#l8.100"></a><span id="l8.100"> &lt;?xul-overlay href=&quot;chrome://communicator/content/tasksOverlay.xul&quot;?&gt;</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://global/content/editMenuOverlay.xul&quot;?&gt;</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://communicator/content/bookmarks/placesOverlay.xul&quot;?&gt;</span>
<a href="#l8.103"></a><span id="l8.103"> </span>
<a href="#l8.104"></a><span id="l8.104"> &lt;!DOCTYPE window [</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-&lt;!ENTITY % utilDTD SYSTEM &quot;chrome://communicator/locale/utilityOverlay.dtd&quot; &gt;</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineminus">-%utilDTD;</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineminus">-&lt;!ENTITY % bmDTD SYSTEM &quot;chrome://communicator/locale/bookmarks/bookmarks.dtd&quot;&gt;</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineminus">-%bmDTD;</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineplus">+&lt;!ENTITY % placesDTD SYSTEM &quot;chrome://communicator/locale/bookmarks/places.dtd&quot;&gt;</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineplus">+%placesDTD;</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineplus">+&lt;!ENTITY % editMenuOverlayDTD SYSTEM &quot;chrome://global/locale/editMenuOverlay.dtd&quot;&gt;</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineplus">+%editMenuOverlayDTD;</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineplus">+&lt;!ENTITY % navDTD SYSTEM &quot;chrome://navigator/locale/navigator.dtd&quot;&gt;</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineplus">+%navDTD;</span>
<a href="#l8.115"></a><span id="l8.115"> ]&gt;</span>
<a href="#l8.116"></a><span id="l8.116"> </span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-&lt;window id=&quot;bookmark-window&quot; windowtype=&quot;bookmarks:manager&quot;</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineminus">-        title=&quot;&amp;bookmarksWindowTitle.label;&quot;</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineminus">-        xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineminus">-        xmlns:web=&quot;http://home.netscape.com/WEB-rdf#&quot;</span>
<a href="#l8.121"></a><span id="l8.121" class="difflineplus">+&lt;window id=&quot;places&quot;</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineplus">+        title=&quot;&amp;bookmarksManager.title;&quot;</span>
<a href="#l8.123"></a><span id="l8.123" class="difflineplus">+        windowtype=&quot;bookmarks:manager&quot;</span>
<a href="#l8.124"></a><span id="l8.124">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineminus">-        width=&quot;630&quot; height=&quot;400&quot; screenX=&quot;20&quot; screenY=&quot;20&quot;</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineminus">-        persist=&quot;width height screenX screenY sizemode&quot;</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineplus">+        xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineplus">+        onload=&quot;PlacesOrganizer.init();&quot;</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineplus">+        onunload=&quot;PlacesOrganizer.destroy();&quot;</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineplus">+        width=&quot;&amp;bookmarksManager.width;&quot; height=&quot;&amp;bookmarksManager.height;&quot;</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineplus">+        screenX=&quot;10&quot; screenY=&quot;10&quot;</span>
<a href="#l8.132"></a><span id="l8.132">         toggletoolbar=&quot;true&quot;</span>
<a href="#l8.133"></a><span id="l8.133" class="difflineminus">-        onload=&quot;Startup();&quot; onunload=&quot;Shutdown();&quot;&gt;</span>
<a href="#l8.134"></a><span id="l8.134" class="difflineminus">-</span>
<a href="#l8.135"></a><span id="l8.135" class="difflineminus">-  &lt;!-- The order of loading of these script files is IMPORTANT --&gt;</span>
<a href="#l8.136"></a><span id="l8.136" class="difflineplus">+        persist=&quot;width height screenX screenY sizemode&quot;&gt;</span>
<a href="#l8.137"></a><span id="l8.137"> </span>
<a href="#l8.138"></a><span id="l8.138" class="difflineminus">-  &lt;!-- XXX - This should SO become an XBL widget --&gt;</span>
<a href="#l8.139"></a><span id="l8.139" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l8.140"></a><span id="l8.140" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineplus">+          src=&quot;chrome://communicator/content/bookmarks/bookmarksManager.js&quot;/&gt;</span>
<a href="#l8.142"></a><span id="l8.142" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l8.143"></a><span id="l8.143" class="difflineplus">+          src=&quot;chrome://communicator/content/bookmarks/editBookmarkOverlay.js&quot;/&gt;</span>
<a href="#l8.144"></a><span id="l8.144"> </span>
<a href="#l8.145"></a><span id="l8.145" class="difflineminus">-  &lt;!-- Shared Bookmarks Utility Library --&gt;</span>
<a href="#l8.146"></a><span id="l8.146" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/bookmarks/bookmarks.js&quot;/&gt;</span>
<a href="#l8.147"></a><span id="l8.147" class="difflineminus">-  &lt;!-- Bookmarks Window --&gt;</span>
<a href="#l8.148"></a><span id="l8.148" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/bookmarks/bookmarksManager.js&quot;/&gt;</span>
<a href="#l8.149"></a><span id="l8.149" class="difflineplus">+  &lt;stringbundleset id=&quot;placesStringSet&quot;&gt;</span>
<a href="#l8.150"></a><span id="l8.150" class="difflineplus">+    &lt;stringbundle id=&quot;brandStrings&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l8.151"></a><span id="l8.151" class="difflineplus">+  &lt;/stringbundleset&gt;</span>
<a href="#l8.152"></a><span id="l8.152" class="difflineplus">+</span>
<a href="#l8.153"></a><span id="l8.153"> </span>
<a href="#l8.154"></a><span id="l8.154" class="difflineminus">-  &lt;!-- Bookmarks Window Drag &amp; Drop --&gt;</span>
<a href="#l8.155"></a><span id="l8.155" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/nsDragAndDrop.js&quot;/&gt;</span>
<a href="#l8.156"></a><span id="l8.156" class="difflineminus">-</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineminus">-  &lt;popupset id=&quot;bookmarksPopupset&quot;/&gt;</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineplus">+  &lt;commandset id=&quot;editMenuCommands&quot;/&gt;</span>
<a href="#l8.159"></a><span id="l8.159" class="difflineplus">+  &lt;commandset id=&quot;placesCommands&quot;/&gt;</span>
<a href="#l8.160"></a><span id="l8.160" class="difflineplus">+  &lt;commandset id=&quot;tasksCommands&quot;&gt;</span>
<a href="#l8.161"></a><span id="l8.161" class="difflineplus">+    &lt;command id=&quot;cmd_quit&quot;/&gt;</span>
<a href="#l8.162"></a><span id="l8.162" class="difflineplus">+  &lt;/commandset&gt;</span>
<a href="#l8.163"></a><span id="l8.163"> </span>
<a href="#l8.164"></a><span id="l8.164" class="difflineminus">-  &lt;commands id=&quot;commands&quot;&gt;</span>
<a href="#l8.165"></a><span id="l8.165" class="difflineminus">-    &lt;commandset id=&quot;CommandUpdate_Bookmarks&quot;</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineminus">-                events=&quot;focus,tree-select&quot;</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineminus">-                oncommandupdate=&quot;document.getElementById('bookmarks-view').onCommandUpdate();&quot;&gt;</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineminus">-    &lt;/commandset&gt;</span>
<a href="#l8.169"></a><span id="l8.169" class="difflineplus">+  &lt;commandset id=&quot;organizerCommandSet&quot;&gt;</span>
<a href="#l8.170"></a><span id="l8.170" class="difflineplus">+    &lt;command id=&quot;OrganizerCommand_find:all&quot;</span>
<a href="#l8.171"></a><span id="l8.171" class="difflineplus">+             label=&quot;&amp;cmd.findInBookmarks.label;&quot;</span>
<a href="#l8.172"></a><span id="l8.172" class="difflineplus">+             accesskey=&quot;&amp;cmd.findInBookmarks.accesskey;&quot;</span>
<a href="#l8.173"></a><span id="l8.173" class="difflineplus">+             oncommand=&quot;PlacesSearchBox.findAll();&quot;/&gt;</span>
<a href="#l8.174"></a><span id="l8.174" class="difflineplus">+    &lt;command id=&quot;OrganizerCommand_find:current&quot;</span>
<a href="#l8.175"></a><span id="l8.175" class="difflineplus">+             label=&quot;&amp;cmd.findCurrent.label;&quot;</span>
<a href="#l8.176"></a><span id="l8.176" class="difflineplus">+             accesskey=&quot;&amp;cmd.findCurrent.accesskey;&quot;</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineplus">+             oncommand=&quot;PlacesSearchBox.findCurrent();&quot;/&gt;</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineplus">+    &lt;command id=&quot;OrganizerCommand_export&quot;</span>
<a href="#l8.179"></a><span id="l8.179" class="difflineplus">+             oncommand=&quot;PlacesOrganizer.exportBookmarks();&quot;/&gt;</span>
<a href="#l8.180"></a><span id="l8.180" class="difflineplus">+    &lt;command id=&quot;OrganizerCommand_import&quot;</span>
<a href="#l8.181"></a><span id="l8.181" class="difflineplus">+             oncommand=&quot;PlacesOrganizer.importBookmarks();&quot;/&gt;</span>
<a href="#l8.182"></a><span id="l8.182" class="difflineplus">+    &lt;command id=&quot;OrganizerCommand_backup&quot;</span>
<a href="#l8.183"></a><span id="l8.183" class="difflineplus">+             oncommand=&quot;PlacesOrganizer.backupBookmarks();&quot;/&gt;</span>
<a href="#l8.184"></a><span id="l8.184" class="difflineplus">+    &lt;command id=&quot;OrganizerCommand_restoreFromFile&quot;</span>
<a href="#l8.185"></a><span id="l8.185" class="difflineplus">+             oncommand=&quot;PlacesOrganizer.onRestoreBookmarksFromFile();&quot;/&gt;</span>
<a href="#l8.186"></a><span id="l8.186" class="difflineplus">+    &lt;command id=&quot;OrganizerCommand_search:save&quot;</span>
<a href="#l8.187"></a><span id="l8.187" class="difflineplus">+             oncommand=&quot;PlacesOrganizer.saveSearch();&quot;/&gt;</span>
<a href="#l8.188"></a><span id="l8.188" class="difflineplus">+    &lt;command id=&quot;OrganizerCommand_search:moreCriteria&quot;</span>
<a href="#l8.189"></a><span id="l8.189" class="difflineplus">+             oncommand=&quot;PlacesQueryBuilder.addRow();&quot;/&gt;</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineplus">+    &lt;command id=&quot;OrganizerCommand:Back&quot;</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineplus">+             oncommand=&quot;PlacesOrganizer.back();&quot;/&gt;</span>
<a href="#l8.192"></a><span id="l8.192" class="difflineplus">+    &lt;command id=&quot;OrganizerCommand:Forward&quot;</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineplus">+             oncommand=&quot;PlacesOrganizer.forward();&quot;/&gt;</span>
<a href="#l8.194"></a><span id="l8.194" class="difflineplus">+  &lt;/commandset&gt;</span>
<a href="#l8.195"></a><span id="l8.195"> </span>
<a href="#l8.196"></a><span id="l8.196" class="difflineminus">-    &lt;commandset id=&quot;tasksCommands&quot;/&gt;</span>
<a href="#l8.197"></a><span id="l8.197"> </span>
<a href="#l8.198"></a><span id="l8.198" class="difflineminus">-    &lt;!-- File Menu --&gt;</span>
<a href="#l8.199"></a><span id="l8.199" class="difflineminus">-    &lt;command id=&quot;cmd_close&quot; oncommand=&quot;close()&quot;/&gt;</span>
<a href="#l8.200"></a><span id="l8.200" class="difflineminus">-    &lt;command id=&quot;cmd_quit&quot;/&gt;</span>
<a href="#l8.201"></a><span id="l8.201" class="difflineminus">-    &lt;!-- Edit Menu --&gt;</span>
<a href="#l8.202"></a><span id="l8.202" class="difflineminus">-    &lt;command id=&quot;cmd_undo&quot;/&gt;</span>
<a href="#l8.203"></a><span id="l8.203" class="difflineminus">-    &lt;command id=&quot;cmd_redo&quot;/&gt;</span>
<a href="#l8.204"></a><span id="l8.204" class="difflineminus">-  &lt;/commands&gt;</span>
<a href="#l8.205"></a><span id="l8.205" class="difflineminus">-  </span>
<a href="#l8.206"></a><span id="l8.206" class="difflineminus">-  &lt;stringbundleset id=&quot;stringbundleset&quot;/&gt;</span>
<a href="#l8.207"></a><span id="l8.207" class="difflineplus">+  &lt;keyset id=&quot;placesOrganizerKeyset&quot;&gt;</span>
<a href="#l8.208"></a><span id="l8.208" class="difflineplus">+    &lt;!-- Instantiation Keys --&gt;</span>
<a href="#l8.209"></a><span id="l8.209" class="difflineplus">+    &lt;key id=&quot;placesKey_close&quot; key=&quot;&amp;cmd.close.key;&quot; modifiers=&quot;accel&quot; </span>
<a href="#l8.210"></a><span id="l8.210" class="difflineplus">+         oncommand=&quot;close();&quot;/&gt;</span>
<a href="#l8.211"></a><span id="l8.211" class="difflineplus">+</span>
<a href="#l8.212"></a><span id="l8.212" class="difflineplus">+    &lt;!-- Command Keys --&gt;</span>
<a href="#l8.213"></a><span id="l8.213" class="difflineplus">+    &lt;key id=&quot;placesKey_find:all&quot;</span>
<a href="#l8.214"></a><span id="l8.214" class="difflineplus">+         command=&quot;OrganizerCommand_find:all&quot; </span>
<a href="#l8.215"></a><span id="l8.215" class="difflineplus">+         key=&quot;&amp;cmd.find.key;&quot;</span>
<a href="#l8.216"></a><span id="l8.216" class="difflineplus">+         modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineplus">+    &lt;key id=&quot;placesKey_find:current&quot;</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineplus">+         command=&quot;OrganizerCommand_find:current&quot; </span>
<a href="#l8.219"></a><span id="l8.219" class="difflineplus">+         key=&quot;&amp;cmd.find.key;&quot;</span>
<a href="#l8.220"></a><span id="l8.220" class="difflineplus">+         modifiers=&quot;accel,shift&quot;/&gt;</span>
<a href="#l8.221"></a><span id="l8.221"> </span>
<a href="#l8.222"></a><span id="l8.222" class="difflineminus">-  &lt;keyset id=&quot;tasksKeys&quot;&gt;</span>
<a href="#l8.223"></a><span id="l8.223" class="difflineminus">-    &lt;!-- File Menu --&gt;</span>
<a href="#l8.224"></a><span id="l8.224" class="difflineminus">-    &lt;key id=&quot;key_close&quot;/&gt;</span>
<a href="#l8.225"></a><span id="l8.225" class="difflineminus">-    &lt;key id=&quot;key_quit&quot;/&gt;</span>
<a href="#l8.226"></a><span id="l8.226" class="difflineplus">+    &lt;!-- Back/Forward Keys Support --&gt;</span>
<a href="#l8.227"></a><span id="l8.227" class="difflineplus">+    &lt;key id=&quot;placesKey_goBackKb&quot;</span>
<a href="#l8.228"></a><span id="l8.228" class="difflineplus">+         keycode=&quot;VK_LEFT&quot;</span>
<a href="#l8.229"></a><span id="l8.229" class="difflineplus">+         command=&quot;OrganizerCommand:Back&quot;</span>
<a href="#l8.230"></a><span id="l8.230" class="difflineplus">+         modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l8.231"></a><span id="l8.231" class="difflineplus">+    &lt;key id=&quot;placesKey_goForwardKb&quot;</span>
<a href="#l8.232"></a><span id="l8.232" class="difflineplus">+         keycode=&quot;VK_RIGHT&quot;</span>
<a href="#l8.233"></a><span id="l8.233" class="difflineplus">+         command=&quot;OrganizerCommand:Forward&quot;</span>
<a href="#l8.234"></a><span id="l8.234" class="difflineplus">+         modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l8.235"></a><span id="l8.235">   &lt;/keyset&gt;</span>
<a href="#l8.236"></a><span id="l8.236" class="difflineminus">-  &lt;keyset id=&quot;bookmarks-tasksKeys&quot;&gt;</span>
<a href="#l8.237"></a><span id="l8.237" class="difflineminus">-    &lt;key key=&quot;&amp;search.key;&quot;</span>
<a href="#l8.238"></a><span id="l8.238" class="difflineminus">-         modifiers=&quot;accel&quot;</span>
<a href="#l8.239"></a><span id="l8.239" class="difflineminus">-         oncommand=&quot;focusElement(document.getElementById('search-box'));&quot;/&gt;</span>
<a href="#l8.240"></a><span id="l8.240" class="difflineplus">+</span>
<a href="#l8.241"></a><span id="l8.241" class="difflineplus">+  &lt;keyset id=&quot;editMenuKeys&quot;&gt;</span>
<a href="#l8.242"></a><span id="l8.242" class="difflineplus">+    &lt;key id=&quot;key_delete2&quot; keycode=&quot;VK_BACK&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l8.243"></a><span id="l8.243" class="difflineplus">+  &lt;/keyset&gt;</span>
<a href="#l8.244"></a><span id="l8.244" class="difflineplus">+  &lt;keyset id=&quot;tasksKeys&quot;&gt;</span>
<a href="#l8.245"></a><span id="l8.245" class="difflineplus">+    &lt;key id=&quot;key_close2&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l8.246"></a><span id="l8.246" class="difflineplus">+    &lt;key id=&quot;key_quit&quot;/&gt;</span>
<a href="#l8.247"></a><span id="l8.247">   &lt;/keyset&gt;</span>
<a href="#l8.248"></a><span id="l8.248"> </span>
<a href="#l8.249"></a><span id="l8.249" class="difflineminus">-  &lt;toolbox id=&quot;bookmarks-toolbox&quot;&gt;</span>
<a href="#l8.250"></a><span id="l8.250" class="difflineminus">-    &lt;menubar id=&quot;main-menubar&quot; grippytooltiptext=&quot;&amp;menuBar.tooltip;&quot;&gt;</span>
<a href="#l8.251"></a><span id="l8.251" class="difflineminus">-      &lt;menu id=&quot;menu_File&quot;&gt;</span>
<a href="#l8.252"></a><span id="l8.252" class="difflineminus">-        &lt;menupopup id=&quot;menu_FilePopup&quot;&gt;</span>
<a href="#l8.253"></a><span id="l8.253" class="difflineminus">-          &lt;menu id=&quot;menu_New&quot;&gt;</span>
<a href="#l8.254"></a><span id="l8.254" class="difflineminus">-            &lt;menupopup&gt;</span>
<a href="#l8.255"></a><span id="l8.255" class="difflineminus">-              &lt;menuitem label=&quot;&amp;menuitem.newBookmark.label;&quot;</span>
<a href="#l8.256"></a><span id="l8.256" class="difflineminus">-                        accesskey=&quot;&amp;menuitem.newBookmark.accesskey;&quot;</span>
<a href="#l8.257"></a><span id="l8.257" class="difflineminus">-                        observes=&quot;cmd_bm_newbookmark&quot;/&gt;</span>
<a href="#l8.258"></a><span id="l8.258" class="difflineminus">-              &lt;menuitem label=&quot;&amp;menuitem.newFolder.label;&quot;</span>
<a href="#l8.259"></a><span id="l8.259" class="difflineminus">-                        accesskey=&quot;&amp;menuitem.newFolder.accesskey;&quot;</span>
<a href="#l8.260"></a><span id="l8.260" class="difflineminus">-                        observes=&quot;cmd_bm_newfolder&quot;/&gt;</span>
<a href="#l8.261"></a><span id="l8.261" class="difflineminus">-              &lt;menuitem label=&quot;&amp;menuitem.newSeparator.label;&quot;</span>
<a href="#l8.262"></a><span id="l8.262" class="difflineminus">-                        accesskey=&quot;&amp;menuitem.newSeparator.accesskey;&quot;</span>
<a href="#l8.263"></a><span id="l8.263" class="difflineminus">-                        observes=&quot;cmd_bm_newseparator&quot;/&gt;</span>
<a href="#l8.264"></a><span id="l8.264" class="difflineminus">-            &lt;/menupopup&gt;</span>
<a href="#l8.265"></a><span id="l8.265" class="difflineminus">-          &lt;/menu&gt;</span>
<a href="#l8.266"></a><span id="l8.266" class="difflineminus">-          &lt;menuitem label=&quot;&amp;menuitem.open.label;&quot;</span>
<a href="#l8.267"></a><span id="l8.267" class="difflineminus">-                    accesskey=&quot;&amp;menuitem.open.accesskey;&quot;</span>
<a href="#l8.268"></a><span id="l8.268" class="difflineminus">-                    oncommand=&quot;OpenBookmarksFile();&quot;/&gt;</span>
<a href="#l8.269"></a><span id="l8.269" class="difflineminus">-          &lt;menuitem id=&quot;menu_close&quot;/&gt;</span>
<a href="#l8.270"></a><span id="l8.270" class="difflineminus">-        &lt;/menupopup&gt;</span>
<a href="#l8.271"></a><span id="l8.271" class="difflineminus">-      &lt;/menu&gt;</span>
<a href="#l8.272"></a><span id="l8.272" class="difflineminus">-      &lt;menu id=&quot;menu_Edit&quot;&gt;</span>
<a href="#l8.273"></a><span id="l8.273" class="difflineminus">-        &lt;menupopup&gt;</span>
<a href="#l8.274"></a><span id="l8.274" class="difflineminus">-          &lt;menuitem id=&quot;menu_undo&quot;/&gt;</span>
<a href="#l8.275"></a><span id="l8.275" class="difflineminus">-          &lt;menuitem id=&quot;menu_redo&quot;/&gt;</span>
<a href="#l8.276"></a><span id="l8.276" class="difflineminus">-          &lt;menuseparator/&gt;</span>
<a href="#l8.277"></a><span id="l8.277" class="difflineminus">-          &lt;menuitem id=&quot;menu_bm_cut&quot;</span>
<a href="#l8.278"></a><span id="l8.278" class="difflineminus">-                    label=&quot;&amp;cutCmd.label;&quot; accesskey=&quot;&amp;cutCmd.accesskey;&quot;</span>
<a href="#l8.279"></a><span id="l8.279" class="difflineminus">-                    key=&quot;key_cut&quot; command=&quot;cmd_bm_cut&quot;/&gt;</span>
<a href="#l8.280"></a><span id="l8.280" class="difflineminus">-          &lt;menuitem id=&quot;menu_bm_copy&quot;</span>
<a href="#l8.281"></a><span id="l8.281" class="difflineminus">-                    label=&quot;&amp;copyCmd.label;&quot; accesskey=&quot;&amp;copyCmd.accesskey;&quot;</span>
<a href="#l8.282"></a><span id="l8.282" class="difflineminus">-                    key=&quot;key_copy&quot; command=&quot;cmd_bm_copy&quot;/&gt;</span>
<a href="#l8.283"></a><span id="l8.283" class="difflineminus">-          &lt;menuitem id=&quot;menu_bm_paste&quot;</span>
<a href="#l8.284"></a><span id="l8.284" class="difflineminus">-                    label=&quot;&amp;pasteCmd.label;&quot; accesskey=&quot;&amp;pasteCmd.accesskey;&quot;</span>
<a href="#l8.285"></a><span id="l8.285" class="difflineminus">-                    key=&quot;key_paste&quot; command=&quot;cmd_bm_paste&quot;/&gt;</span>
<a href="#l8.286"></a><span id="l8.286" class="difflineminus">-          &lt;menuitem id=&quot;menu_bm_delete&quot;</span>
<a href="#l8.287"></a><span id="l8.287" class="difflineminus">-                    label=&quot;&amp;deleteCmd.label;&quot; accesskey=&quot;&amp;deleteCmd.accesskey;&quot;</span>
<a href="#l8.288"></a><span id="l8.288" class="difflineminus">-                    key=&quot;key_delete&quot; command=&quot;cmd_bm_delete&quot;/&gt;</span>
<a href="#l8.289"></a><span id="l8.289" class="difflineminus">-          &lt;menuseparator/&gt;</span>
<a href="#l8.290"></a><span id="l8.290" class="difflineminus">-          &lt;menuitem id=&quot;menu_bm_selectAll&quot;</span>
<a href="#l8.291"></a><span id="l8.291" class="difflineminus">-                    label=&quot;&amp;selectAllCmd.label;&quot; accesskey=&quot;&amp;selectAllCmd.accesskey;&quot;</span>
<a href="#l8.292"></a><span id="l8.292" class="difflineminus">-                    key=&quot;key_selectAll&quot; command=&quot;cmd_bm_selectAll&quot;/&gt;</span>
<a href="#l8.293"></a><span id="l8.293" class="difflineminus">-          &lt;menuseparator/&gt;</span>
<a href="#l8.294"></a><span id="l8.294" class="difflineminus">-          &lt;menuitem label=&quot;&amp;menuitem.moveBookmark.label;&quot;</span>
<a href="#l8.295"></a><span id="l8.295" class="difflineminus">-                    accesskey=&quot;&amp;menuitem.moveBookmark.accesskey;&quot;</span>
<a href="#l8.296"></a><span id="l8.296" class="difflineminus">-                    command=&quot;cmd_bm_movebookmark&quot;/&gt;</span>
<a href="#l8.297"></a><span id="l8.297" class="difflineminus">-          &lt;menuseparator/&gt;</span>
<a href="#l8.298"></a><span id="l8.298" class="difflineminus">-          &lt;menuitem label=&quot;&amp;command.sortFolder.label;&quot;</span>
<a href="#l8.299"></a><span id="l8.299" class="difflineminus">-                    accesskey=&quot;&amp;command.sortFolder.accesskey;&quot;</span>
<a href="#l8.300"></a><span id="l8.300" class="difflineminus">-                    key=&quot;bm_key_sortFolder&quot;</span>
<a href="#l8.301"></a><span id="l8.301" class="difflineminus">-                    command=&quot;cmd_bm_sortfolder&quot;/&gt;</span>
<a href="#l8.302"></a><span id="l8.302" class="difflineminus">-          &lt;menuitem label=&quot;&amp;command.sortFolderByName.label;&quot;</span>
<a href="#l8.303"></a><span id="l8.303" class="difflineminus">-                    accesskey=&quot;&amp;command.sortFolderByName.accesskey;&quot;</span>
<a href="#l8.304"></a><span id="l8.304" class="difflineminus">-                    command=&quot;cmd_bm_sortfolderbyname&quot;/&gt;</span>
<a href="#l8.305"></a><span id="l8.305" class="difflineminus">-          &lt;menuseparator/&gt;</span>
<a href="#l8.306"></a><span id="l8.306" class="difflineminus">-          &lt;menuitem label=&quot;&amp;menuitem.properties.label;&quot;</span>
<a href="#l8.307"></a><span id="l8.307" class="difflineminus">-                    accesskey=&quot;&amp;menuitem.properties.accesskey;&quot;</span>
<a href="#l8.308"></a><span id="l8.308" class="difflineminus">-                    key=&quot;bm_key_properties&quot;</span>
<a href="#l8.309"></a><span id="l8.309" class="difflineminus">-                    command=&quot;cmd_bm_properties&quot; /&gt;</span>
<a href="#l8.310"></a><span id="l8.310" class="difflineminus">-        &lt;/menupopup&gt;</span>
<a href="#l8.311"></a><span id="l8.311" class="difflineminus">-      &lt;/menu&gt;</span>
<a href="#l8.312"></a><span id="l8.312" class="difflineplus">+  &lt;popupset id=&quot;placesPopupset&quot;&gt;</span>
<a href="#l8.313"></a><span id="l8.313" class="difflineplus">+    &lt;menupopup id=&quot;placesContext&quot;/&gt;</span>
<a href="#l8.314"></a><span id="l8.314" class="difflineplus">+    &lt;menupopup id=&quot;placesColumnsContext&quot;</span>
<a href="#l8.315"></a><span id="l8.315" class="difflineplus">+               onpopupshowing=&quot;ViewMenu.fillWithColumns(event, null, null, 'checkbox', null);&quot;</span>
<a href="#l8.316"></a><span id="l8.316" class="difflineplus">+               oncommand=&quot;ViewMenu.showHideColumn(event.target); event.stopPropagation();&quot;/&gt;</span>
<a href="#l8.317"></a><span id="l8.317" class="difflineplus">+  &lt;/popupset&gt;</span>
<a href="#l8.318"></a><span id="l8.318" class="difflineplus">+</span>
<a href="#l8.319"></a><span id="l8.319" class="difflineplus">+  &lt;toolbox id=&quot;placesToolbox&quot;&gt;</span>
<a href="#l8.320"></a><span id="l8.320" class="difflineplus">+    &lt;toolbar class=&quot;chromeclass-toolbar&quot; id=&quot;placesToolbar&quot; align=&quot;center&quot;&gt;</span>
<a href="#l8.321"></a><span id="l8.321" class="difflineplus">+      &lt;menubar id=&quot;placesMenu&quot;&gt;</span>
<a href="#l8.322"></a><span id="l8.322" class="difflineplus">+        &lt;menu id=&quot;menu_File&quot;&gt;</span>
<a href="#l8.323"></a><span id="l8.323" class="difflineplus">+          &lt;menupopup id=&quot;menu_FilePopup&quot;&gt;</span>
<a href="#l8.324"></a><span id="l8.324" class="difflineplus">+            &lt;menuitem id=&quot;newbookmark&quot;</span>
<a href="#l8.325"></a><span id="l8.325" class="difflineplus">+                      command=&quot;placesCmd_new:bookmark&quot;</span>
<a href="#l8.326"></a><span id="l8.326" class="difflineplus">+                      label=&quot;&amp;cmd.new_bookmark.label;&quot;</span>
<a href="#l8.327"></a><span id="l8.327" class="difflineplus">+                      accesskey=&quot;&amp;cmd.new_bookmark.accesskey;&quot;/&gt;</span>
<a href="#l8.328"></a><span id="l8.328" class="difflineplus">+            &lt;menuitem id=&quot;newfolder&quot;</span>
<a href="#l8.329"></a><span id="l8.329" class="difflineplus">+                      command=&quot;placesCmd_new:folder&quot;</span>
<a href="#l8.330"></a><span id="l8.330" class="difflineplus">+                      label=&quot;&amp;cmd.new_folder.label;&quot;</span>
<a href="#l8.331"></a><span id="l8.331" class="difflineplus">+                      accesskey=&quot;&amp;cmd.new_folder.accesskey;&quot;/&gt;</span>
<a href="#l8.332"></a><span id="l8.332" class="difflineplus">+            &lt;menuitem id=&quot;newseparator&quot;</span>
<a href="#l8.333"></a><span id="l8.333" class="difflineplus">+                      command=&quot;placesCmd_new:separator&quot;</span>
<a href="#l8.334"></a><span id="l8.334" class="difflineplus">+                      label=&quot;&amp;cmd.new_separator.label;&quot;</span>
<a href="#l8.335"></a><span id="l8.335" class="difflineplus">+                      accesskey=&quot;&amp;cmd.new_separator.accesskey;&quot;/&gt;</span>
<a href="#l8.336"></a><span id="l8.336" class="difflineplus">+            &lt;menuseparator id=&quot;fileNewSeparator&quot;/&gt;</span>
<a href="#l8.337"></a><span id="l8.337" class="difflineplus">+            &lt;menuitem id=&quot;orgClose&quot;</span>
<a href="#l8.338"></a><span id="l8.338" class="difflineplus">+                      key=&quot;placesKey_close&quot; </span>
<a href="#l8.339"></a><span id="l8.339" class="difflineplus">+                      label=&quot;&amp;file.close.label;&quot;</span>
<a href="#l8.340"></a><span id="l8.340" class="difflineplus">+                      accesskey=&quot;&amp;file.close.accesskey;&quot; </span>
<a href="#l8.341"></a><span id="l8.341" class="difflineplus">+                      oncommand=&quot;close();&quot;/&gt;</span>
<a href="#l8.342"></a><span id="l8.342" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l8.343"></a><span id="l8.343" class="difflineplus">+        &lt;/menu&gt;</span>
<a href="#l8.344"></a><span id="l8.344" class="difflineplus">+</span>
<a href="#l8.345"></a><span id="l8.345" class="difflineplus">+        &lt;menu id=&quot;menu_Edit&quot;&gt;</span>
<a href="#l8.346"></a><span id="l8.346" class="difflineplus">+          &lt;menupopup id=&quot;menu_EditPopup&quot;&gt;</span>
<a href="#l8.347"></a><span id="l8.347" class="difflineplus">+            &lt;menuitem id=&quot;orgCut&quot;</span>
<a href="#l8.348"></a><span id="l8.348" class="difflineplus">+                      command=&quot;cmd_cut&quot;</span>
<a href="#l8.349"></a><span id="l8.349" class="difflineplus">+                      label=&quot;&amp;cutCmd.label;&quot;</span>
<a href="#l8.350"></a><span id="l8.350" class="difflineplus">+                      key=&quot;key_cut&quot;</span>
<a href="#l8.351"></a><span id="l8.351" class="difflineplus">+                      accesskey=&quot;&amp;cutCmd.accesskey;&quot;</span>
<a href="#l8.352"></a><span id="l8.352" class="difflineplus">+                      selection=&quot;separator|link|folder|mixed&quot;/&gt;</span>
<a href="#l8.353"></a><span id="l8.353" class="difflineplus">+            &lt;menuitem id=&quot;orgCopy&quot;</span>
<a href="#l8.354"></a><span id="l8.354" class="difflineplus">+                      command=&quot;cmd_copy&quot;</span>
<a href="#l8.355"></a><span id="l8.355" class="difflineplus">+                      label=&quot;&amp;copyCmd.label;&quot;</span>
<a href="#l8.356"></a><span id="l8.356" class="difflineplus">+                      key=&quot;key_copy&quot;</span>
<a href="#l8.357"></a><span id="l8.357" class="difflineplus">+                      accesskey=&quot;&amp;copyCmd.accesskey;&quot;</span>
<a href="#l8.358"></a><span id="l8.358" class="difflineplus">+                      selection=&quot;separator|link|folder|mixed&quot;/&gt;</span>
<a href="#l8.359"></a><span id="l8.359" class="difflineplus">+            &lt;menuitem id=&quot;orgPaste&quot;</span>
<a href="#l8.360"></a><span id="l8.360" class="difflineplus">+                      command=&quot;cmd_paste&quot;</span>
<a href="#l8.361"></a><span id="l8.361" class="difflineplus">+                      label=&quot;&amp;pasteCmd.label;&quot;</span>
<a href="#l8.362"></a><span id="l8.362" class="difflineplus">+                      key=&quot;key_paste&quot;</span>
<a href="#l8.363"></a><span id="l8.363" class="difflineplus">+                      accesskey=&quot;&amp;pasteCmd.accesskey;&quot;</span>
<a href="#l8.364"></a><span id="l8.364" class="difflineplus">+                      selection=&quot;mutable&quot;/&gt;</span>
<a href="#l8.365"></a><span id="l8.365" class="difflineplus">+            &lt;menuitem id=&quot;orgUndo&quot;</span>
<a href="#l8.366"></a><span id="l8.366" class="difflineplus">+                      command=&quot;cmd_undo&quot;</span>
<a href="#l8.367"></a><span id="l8.367" class="difflineplus">+                      label=&quot;&amp;undoCmd.label;&quot;</span>
<a href="#l8.368"></a><span id="l8.368" class="difflineplus">+                      key=&quot;key_undo&quot;</span>
<a href="#l8.369"></a><span id="l8.369" class="difflineplus">+                      accesskey=&quot;&amp;undoCmd.accesskey;&quot;/&gt;</span>
<a href="#l8.370"></a><span id="l8.370" class="difflineplus">+            &lt;menuitem id=&quot;orgRedo&quot;</span>
<a href="#l8.371"></a><span id="l8.371" class="difflineplus">+                      command=&quot;cmd_redo&quot;</span>
<a href="#l8.372"></a><span id="l8.372" class="difflineplus">+                      label=&quot;&amp;redoCmd.label;&quot;</span>
<a href="#l8.373"></a><span id="l8.373" class="difflineplus">+                      key=&quot;key_redo&quot;</span>
<a href="#l8.374"></a><span id="l8.374" class="difflineplus">+                      accesskey=&quot;&amp;redoCmd.accesskey;&quot;/&gt;</span>
<a href="#l8.375"></a><span id="l8.375" class="difflineplus">+</span>
<a href="#l8.376"></a><span id="l8.376" class="difflineplus">+            &lt;menuseparator id=&quot;selectAllSeparator&quot;/&gt;</span>
<a href="#l8.377"></a><span id="l8.377" class="difflineplus">+</span>
<a href="#l8.378"></a><span id="l8.378" class="difflineplus">+            &lt;menuitem id=&quot;orgSelectAll&quot;</span>
<a href="#l8.379"></a><span id="l8.379" class="difflineplus">+                      command=&quot;cmd_selectAll&quot;</span>
<a href="#l8.380"></a><span id="l8.380" class="difflineplus">+                      label=&quot;&amp;selectAllCmd.label;&quot;</span>
<a href="#l8.381"></a><span id="l8.381" class="difflineplus">+                      key=&quot;key_selectAll&quot;</span>
<a href="#l8.382"></a><span id="l8.382" class="difflineplus">+                      accesskey=&quot;&amp;selectAllCmd.accesskey;&quot;/&gt;</span>
<a href="#l8.383"></a><span id="l8.383"> </span>
<a href="#l8.384"></a><span id="l8.384" class="difflineminus">-      &lt;menu id=&quot;menu_View&quot;&gt;</span>
<a href="#l8.385"></a><span id="l8.385" class="difflineminus">-        &lt;menupopup&gt;</span>
<a href="#l8.386"></a><span id="l8.386" class="difflineminus">-          &lt;menuitem id=&quot;viewCommandToolbar&quot; type=&quot;checkbox&quot; class=&quot;menuitem-iconic&quot;</span>
<a href="#l8.387"></a><span id="l8.387" class="difflineminus">-                    label=&quot;&amp;menuitem.view.command.toolbar.label;&quot;</span>
<a href="#l8.388"></a><span id="l8.388" class="difflineminus">-                    accesskey=&quot;&amp;menuitem.view.command.toolbar.accesskey;&quot;</span>
<a href="#l8.389"></a><span id="l8.389" class="difflineminus">-                    oncommand=&quot;goToggleToolbar('command-toolbar', 'viewCommandToolbar'); event.stopPropagation();&quot;</span>
<a href="#l8.390"></a><span id="l8.390" class="difflineminus">-                    checked=&quot;true&quot;/&gt;</span>
<a href="#l8.391"></a><span id="l8.391" class="difflineminus">-          &lt;menu label=&quot;&amp;menuitem.view.show_columns.label;&quot;</span>
<a href="#l8.392"></a><span id="l8.392" class="difflineminus">-                accesskey=&quot;&amp;menuitem.view.show_columns.accesskey;&quot;&gt;</span>
<a href="#l8.393"></a><span id="l8.393" class="difflineminus">-            &lt;menupopup id=&quot;columnsPopup&quot; onpopupshowing=&quot;UpdateViewColumns();&quot;</span>
<a href="#l8.394"></a><span id="l8.394" class="difflineminus">-                       oncommand=&quot;onViewMenuColumnItemSelected(event);&quot;&gt;</span>
<a href="#l8.395"></a><span id="l8.395" class="difflineminus">-              &lt;menuitem id=&quot;columnMenuItem:Name&quot; disabled=&quot;true&quot; label=&quot;&amp;treecol.name.label;&quot;</span>
<a href="#l8.396"></a><span id="l8.396" class="difflineminus">-                        accesskey=&quot;&amp;treecol.name.accesskey;&quot; type=&quot;checkbox&quot;/&gt;</span>
<a href="#l8.397"></a><span id="l8.397" class="difflineminus">-              &lt;menuitem id=&quot;columnMenuItem:URL&quot; label=&quot;&amp;treecol.url.label;&quot;</span>
<a href="#l8.398"></a><span id="l8.398" class="difflineminus">-                        accesskey=&quot;&amp;treecol.url.accesskey;&quot; type=&quot;checkbox&quot;/&gt;</span>
<a href="#l8.399"></a><span id="l8.399" class="difflineminus">-              &lt;menuitem id=&quot;columnMenuItem:ShortcutURL&quot; label=&quot;&amp;treecol.shortcut.label;&quot;</span>
<a href="#l8.400"></a><span id="l8.400" class="difflineminus">-                        accesskey=&quot;&amp;treecol.shortcut.accesskey;&quot; type=&quot;checkbox&quot;/&gt;</span>
<a href="#l8.401"></a><span id="l8.401" class="difflineminus">-              &lt;menuitem id=&quot;columnMenuItem:Description&quot; label=&quot;&amp;treecol.description.label;&quot;</span>
<a href="#l8.402"></a><span id="l8.402" class="difflineminus">-                        accesskey=&quot;&amp;treecol.description.accesskey;&quot; type=&quot;checkbox&quot;/&gt;</span>
<a href="#l8.403"></a><span id="l8.403" class="difflineminus">-              &lt;menuitem id=&quot;columnMenuItem:BookmarkAddDate&quot; label=&quot;&amp;treecol.addedon.label;&quot;</span>
<a href="#l8.404"></a><span id="l8.404" class="difflineminus">-                        accesskey=&quot;&amp;treecol.addedon.accesskey;&quot; type=&quot;checkbox&quot;/&gt;</span>
<a href="#l8.405"></a><span id="l8.405" class="difflineminus">-              &lt;menuitem id=&quot;columnMenuItem:LastModifiedDate&quot; label=&quot;&amp;treecol.lastmod.label;&quot;</span>
<a href="#l8.406"></a><span id="l8.406" class="difflineminus">-                        accesskey=&quot;&amp;treecol.lastmod.accesskey;&quot; type=&quot;checkbox&quot;/&gt;</span>
<a href="#l8.407"></a><span id="l8.407" class="difflineminus">-              &lt;menuitem id=&quot;columnMenuItem:LastVisitDate&quot; label=&quot;&amp;treecol.lastvisit.label;&quot;</span>
<a href="#l8.408"></a><span id="l8.408" class="difflineminus">-                        accesskey=&quot;&amp;treecol.lastvisit.accesskey;&quot; type=&quot;checkbox&quot;/&gt;</span>
<a href="#l8.409"></a><span id="l8.409" class="difflineminus">-            &lt;/menupopup&gt;</span>
<a href="#l8.410"></a><span id="l8.410" class="difflineminus">-          &lt;/menu&gt;</span>
<a href="#l8.411"></a><span id="l8.411" class="difflineminus">-          &lt;menuseparator/&gt;</span>
<a href="#l8.412"></a><span id="l8.412" class="difflineminus">-          &lt;menuitem label=&quot;&amp;menuitem.newbookmarkfolder.label;&quot;</span>
<a href="#l8.413"></a><span id="l8.413" class="difflineminus">-                    command=&quot;cmd_bm_setnewbookmarkfolder&quot;</span>
<a href="#l8.414"></a><span id="l8.414" class="difflineminus">-                    accesskey=&quot;&amp;menuitem.newbookmarkfolder.accesskey;&quot;/&gt;</span>
<a href="#l8.415"></a><span id="l8.415" class="difflineminus">-          &lt;menuitem label=&quot;&amp;menuitem.newinternetsearchfolder.label;&quot;</span>
<a href="#l8.416"></a><span id="l8.416" class="difflineminus">-                    command=&quot;cmd_bm_setnewsearchfolder&quot;</span>
<a href="#l8.417"></a><span id="l8.417" class="difflineminus">-                    accesskey=&quot;&amp;menuitem.newinternetsearchfolder.accesskey;&quot;/&gt;</span>
<a href="#l8.418"></a><span id="l8.418" class="difflineminus">-          &lt;menuitem label=&quot;&amp;menuitem.personaltoolbarfolder.label;&quot;</span>
<a href="#l8.419"></a><span id="l8.419" class="difflineminus">-                    command=&quot;cmd_bm_setpersonaltoolbarfolder&quot;</span>
<a href="#l8.420"></a><span id="l8.420" class="difflineminus">-                    accesskey=&quot;&amp;menuitem.personaltoolbarfolder.accesskey;&quot;/&gt;</span>
<a href="#l8.421"></a><span id="l8.421" class="difflineminus">-        &lt;/menupopup&gt;</span>
<a href="#l8.422"></a><span id="l8.422" class="difflineminus">-      &lt;/menu&gt;</span>
<a href="#l8.423"></a><span id="l8.423" class="difflineminus">-      &lt;menu id=&quot;tasksMenu&quot;&gt;</span>
<a href="#l8.424"></a><span id="l8.424" class="difflineminus">-        &lt;menupopup id=&quot;taskPopup&quot;&gt;</span>
<a href="#l8.425"></a><span id="l8.425" class="difflineminus">-          &lt;menuitem command=&quot;cmd_bm_find&quot; key=&quot;bm_key_find&quot;</span>
<a href="#l8.426"></a><span id="l8.426" class="difflineminus">-                    label=&quot;&amp;menuitem.find.label;&quot;</span>
<a href="#l8.427"></a><span id="l8.427" class="difflineminus">-                    accesskey=&quot;&amp;menuitem.find.accesskey;&quot;/&gt;</span>
<a href="#l8.428"></a><span id="l8.428" class="difflineminus">-          &lt;menuitem label=&quot;&amp;menuitem.import.label;&quot;</span>
<a href="#l8.429"></a><span id="l8.429" class="difflineminus">-                    accesskey=&quot;&amp;menuitem.import.accesskey;&quot;</span>
<a href="#l8.430"></a><span id="l8.430" class="difflineminus">-                    observes=&quot;cmd_bm_import&quot;/&gt;</span>
<a href="#l8.431"></a><span id="l8.431" class="difflineminus">-          &lt;menuitem label=&quot;&amp;menuitem.export.label;&quot;</span>
<a href="#l8.432"></a><span id="l8.432" class="difflineminus">-                    accesskey=&quot;&amp;menuitem.export.accesskey;&quot;</span>
<a href="#l8.433"></a><span id="l8.433" class="difflineminus">-                    observes=&quot;cmd_bm_export&quot;/&gt;</span>
<a href="#l8.434"></a><span id="l8.434" class="difflineminus">-          &lt;menuseparator/&gt;</span>
<a href="#l8.435"></a><span id="l8.435" class="difflineminus">-        &lt;/menupopup&gt;</span>
<a href="#l8.436"></a><span id="l8.436" class="difflineminus">-      &lt;/menu&gt;</span>
<a href="#l8.437"></a><span id="l8.437" class="difflineminus">-      &lt;menu id=&quot;windowMenu&quot;/&gt;</span>
<a href="#l8.438"></a><span id="l8.438" class="difflineminus">-      &lt;menu id=&quot;menu_Help&quot;/&gt;</span>
<a href="#l8.439"></a><span id="l8.439" class="difflineminus">-    &lt;/menubar&gt;</span>
<a href="#l8.440"></a><span id="l8.440" class="difflineplus">+            &lt;menuseparator id=&quot;orgMoveSeparator&quot;/&gt;</span>
<a href="#l8.441"></a><span id="l8.441" class="difflineplus">+            &lt;menuitem id=&quot;orgMoveBookmarks&quot;</span>
<a href="#l8.442"></a><span id="l8.442" class="difflineplus">+                      command=&quot;placesCmd_moveBookmarks&quot;</span>
<a href="#l8.443"></a><span id="l8.443" class="difflineplus">+                      label=&quot;&amp;cmd.moveBookmarks.label;&quot;</span>
<a href="#l8.444"></a><span id="l8.444" class="difflineplus">+                      accesskey=&quot;&amp;cmd.moveBookmarks.accesskey;&quot;/&gt;</span>
<a href="#l8.445"></a><span id="l8.445" class="difflineplus">+            &lt;menuitem id=&quot;orgDelete&quot;</span>
<a href="#l8.446"></a><span id="l8.446" class="difflineplus">+                      command=&quot;cmd_delete&quot;</span>
<a href="#l8.447"></a><span id="l8.447" class="difflineplus">+                      label=&quot;&amp;deleteCmd.label;&quot;</span>
<a href="#l8.448"></a><span id="l8.448" class="difflineplus">+                      key=&quot;key_delete&quot;</span>
<a href="#l8.449"></a><span id="l8.449" class="difflineplus">+                      accesskey=&quot;&amp;deleteCmd.accesskey;&quot;/&gt;</span>
<a href="#l8.450"></a><span id="l8.450" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l8.451"></a><span id="l8.451" class="difflineplus">+        &lt;/menu&gt;</span>
<a href="#l8.452"></a><span id="l8.452" class="difflineplus">+</span>
<a href="#l8.453"></a><span id="l8.453" class="difflineplus">+        &lt;menu id=&quot;menu_View&quot;&gt;</span>
<a href="#l8.454"></a><span id="l8.454" class="difflineplus">+          &lt;menupopup id=&quot;menu_ViewPopup&quot;&gt;</span>
<a href="#l8.455"></a><span id="l8.455" class="difflineplus">+            &lt;menu id=&quot;viewColumns&quot;</span>
<a href="#l8.456"></a><span id="l8.456" class="difflineplus">+                  label=&quot;&amp;view.columns.label;&quot; accesskey=&quot;&amp;view.columns.accesskey;&quot;&gt;</span>
<a href="#l8.457"></a><span id="l8.457" class="difflineplus">+              &lt;menupopup onpopupshowing=&quot;ViewMenu.fillWithColumns(event, null, null, 'checkbox', null);&quot;</span>
<a href="#l8.458"></a><span id="l8.458" class="difflineplus">+                         oncommand=&quot;ViewMenu.showHideColumn(event.target); event.stopPropagation();&quot;/&gt;</span>
<a href="#l8.459"></a><span id="l8.459" class="difflineplus">+            &lt;/menu&gt;</span>
<a href="#l8.460"></a><span id="l8.460" class="difflineplus">+</span>
<a href="#l8.461"></a><span id="l8.461" class="difflineplus">+            &lt;menu id=&quot;viewSort&quot; label=&quot;&amp;view.sort.label;&quot;</span>
<a href="#l8.462"></a><span id="l8.462" class="difflineplus">+                  accesskey=&quot;&amp;view.sort.accesskey;&quot;&gt;</span>
<a href="#l8.463"></a><span id="l8.463" class="difflineplus">+              &lt;menupopup onpopupshowing=&quot;ViewMenu.populateSortMenu(event);&quot;</span>
<a href="#l8.464"></a><span id="l8.464" class="difflineplus">+                         oncommand=&quot;ViewMenu.setSortColumn(event.target.column, null);&quot;&gt;</span>
<a href="#l8.465"></a><span id="l8.465" class="difflineplus">+                &lt;menuitem id=&quot;viewUnsorted&quot; type=&quot;radio&quot; name=&quot;columns&quot; </span>
<a href="#l8.466"></a><span id="l8.466" class="difflineplus">+                          label=&quot;&amp;view.unsorted.label;&quot; accesskey=&quot;&amp;view.unsorted.accesskey;&quot;</span>
<a href="#l8.467"></a><span id="l8.467" class="difflineplus">+                          oncommand=&quot;ViewMenu.setSortColumn(null, null);&quot;/&gt;</span>
<a href="#l8.468"></a><span id="l8.468" class="difflineplus">+                &lt;menuseparator id=&quot;directionSeparator&quot;/&gt;</span>
<a href="#l8.469"></a><span id="l8.469" class="difflineplus">+                &lt;menuitem id=&quot;viewSortAscending&quot; type=&quot;radio&quot; name=&quot;direction&quot; </span>
<a href="#l8.470"></a><span id="l8.470" class="difflineplus">+                          label=&quot;&amp;view.sortAscending.label;&quot; accesskey=&quot;&amp;view.sortAscending.accesskey;&quot;</span>
<a href="#l8.471"></a><span id="l8.471" class="difflineplus">+                          oncommand=&quot;ViewMenu.setSortColumn(null, 'ascending'); event.stopPropagation();&quot;/&gt;</span>
<a href="#l8.472"></a><span id="l8.472" class="difflineplus">+                &lt;menuitem id=&quot;viewSortDescending&quot; type=&quot;radio&quot; name=&quot;direction&quot; </span>
<a href="#l8.473"></a><span id="l8.473" class="difflineplus">+                          label=&quot;&amp;view.sortDescending.label;&quot; accesskey=&quot;&amp;view.sortDescending.accesskey;&quot;</span>
<a href="#l8.474"></a><span id="l8.474" class="difflineplus">+                          oncommand=&quot;ViewMenu.setSortColumn(null, 'descending'); event.stopPropagation();&quot;/&gt;</span>
<a href="#l8.475"></a><span id="l8.475" class="difflineplus">+              &lt;/menupopup&gt;</span>
<a href="#l8.476"></a><span id="l8.476" class="difflineplus">+            &lt;/menu&gt;</span>
<a href="#l8.477"></a><span id="l8.477" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l8.478"></a><span id="l8.478" class="difflineplus">+        &lt;/menu&gt;</span>
<a href="#l8.479"></a><span id="l8.479"> </span>
<a href="#l8.480"></a><span id="l8.480" class="difflineminus">-    &lt;toolbar class=&quot;chromeclass-toolbar&quot; id=&quot;command-toolbar&quot; grippytooltiptext=&quot;&amp;bookmarkToolbar.tooltip;&quot;&gt;</span>
<a href="#l8.481"></a><span id="l8.481" class="difflineminus">-      &lt;toolbarbutton id=&quot;newfolder&quot; label=&quot;&amp;button.newFolder.label;&quot;</span>
<a href="#l8.482"></a><span id="l8.482" class="difflineminus">-                     accesskey=&quot;&amp;button.newFolder.accesskey;&quot;</span>
<a href="#l8.483"></a><span id="l8.483" class="difflineminus">-                     command=&quot;cmd_bm_newfolder&quot;/&gt;</span>
<a href="#l8.484"></a><span id="l8.484" class="difflineminus">-      &lt;toolbarbutton id=&quot;newseparator&quot; label=&quot;&amp;button.newSeparator.label;&quot;</span>
<a href="#l8.485"></a><span id="l8.485" class="difflineminus">-                     accesskey=&quot;&amp;button.newSeparator.accesskey;&quot;</span>
<a href="#l8.486"></a><span id="l8.486" class="difflineminus">-                     command=&quot;cmd_bm_newseparator&quot;/&gt;</span>
<a href="#l8.487"></a><span id="l8.487" class="difflineminus">-      &lt;toolbarseparator/&gt;</span>
<a href="#l8.488"></a><span id="l8.488" class="difflineminus">-      &lt;toolbarbutton id=&quot;moveBookmark&quot; label=&quot;&amp;button.moveBookmark.label;&quot;</span>
<a href="#l8.489"></a><span id="l8.489" class="difflineminus">-                     accesskey=&quot;&amp;button.moveBookmark.accesskey;&quot;</span>
<a href="#l8.490"></a><span id="l8.490" class="difflineminus">-                     command=&quot;cmd_bm_movebookmark&quot;/&gt;</span>
<a href="#l8.491"></a><span id="l8.491" class="difflineminus">-      &lt;toolbarseparator/&gt;</span>
<a href="#l8.492"></a><span id="l8.492" class="difflineminus">-      &lt;toolbarbutton id=&quot;properties&quot; label=&quot;&amp;button.properties.label;&quot;</span>
<a href="#l8.493"></a><span id="l8.493" class="difflineminus">-                     accesskey=&quot;&amp;button.properties.accesskey;&quot;</span>
<a href="#l8.494"></a><span id="l8.494" class="difflineminus">-                     command=&quot;cmd_bm_properties&quot;/&gt;</span>
<a href="#l8.495"></a><span id="l8.495" class="difflineminus">-      &lt;toolbarbutton id=&quot;rename&quot; label=&quot;&amp;button.rename.label;&quot;</span>
<a href="#l8.496"></a><span id="l8.496" class="difflineminus">-                     accesskey=&quot;&amp;button.rename.accesskey;&quot;</span>
<a href="#l8.497"></a><span id="l8.497" class="difflineminus">-                     command=&quot;cmd_bm_rename&quot;/&gt;</span>
<a href="#l8.498"></a><span id="l8.498" class="difflineminus">-      &lt;toolbarbutton id=&quot;delete&quot; label=&quot;&amp;button.delete.label;&quot;</span>
<a href="#l8.499"></a><span id="l8.499" class="difflineminus">-                     accesskey=&quot;&amp;button.delete.accesskey;&quot;</span>
<a href="#l8.500"></a><span id="l8.500" class="difflineminus">-                     command=&quot;cmd_bm_delete&quot;/&gt;</span>
<a href="#l8.501"></a><span id="l8.501" class="difflineminus">-      &lt;toolbarspring/&gt;</span>
<a href="#l8.502"></a><span id="l8.502" class="difflineminus">-      &lt;toolbaritem id=&quot;bookmarks-search-box&quot; align=&quot;center&quot;&gt;</span>
<a href="#l8.503"></a><span id="l8.503" class="difflineminus">-        &lt;textbox id=&quot;search-box&quot; type=&quot;search&quot; clickSelectsAll=&quot;true&quot;</span>
<a href="#l8.504"></a><span id="l8.504" class="difflineminus">-                 placeholder=&quot;&amp;search.placeholder;&quot;</span>
<a href="#l8.505"></a><span id="l8.505" class="difflineminus">-                 oncommand=&quot;document.getElementById('bookmarks-view').searchBookmarks(this.value)&quot;/&gt;</span>
<a href="#l8.506"></a><span id="l8.506" class="difflineminus">-      &lt;/toolbaritem&gt;</span>
<a href="#l8.507"></a><span id="l8.507" class="difflineplus">+        &lt;!-- tasks menu filled from tasksOverlay --&gt;</span>
<a href="#l8.508"></a><span id="l8.508" class="difflineplus">+        &lt;menu id=&quot;tasksMenu&quot;&gt;</span>
<a href="#l8.509"></a><span id="l8.509" class="difflineplus">+          &lt;menupopup id=&quot;taskPopup&quot;&gt;</span>
<a href="#l8.510"></a><span id="l8.510" class="difflineplus">+            &lt;menuitem id=&quot;backupBookmarks&quot;</span>
<a href="#l8.511"></a><span id="l8.511" class="difflineplus">+                      command=&quot;OrganizerCommand_backup&quot;</span>
<a href="#l8.512"></a><span id="l8.512" class="difflineplus">+                      label=&quot;&amp;cmd.backup.label;&quot;</span>
<a href="#l8.513"></a><span id="l8.513" class="difflineplus">+                      accesskey=&quot;&amp;cmd.backup.accesskey;&quot;/&gt;</span>
<a href="#l8.514"></a><span id="l8.514" class="difflineplus">+            &lt;menu id=&quot;fileRestoreMenu&quot; label=&quot;&amp;cmd.restore2.label;&quot;</span>
<a href="#l8.515"></a><span id="l8.515" class="difflineplus">+                      accesskey=&quot;&amp;cmd.restore2.accesskey;&quot;&gt;</span>
<a href="#l8.516"></a><span id="l8.516" class="difflineplus">+              &lt;menupopup id=&quot;fileRestorePopup&quot; onpopupshowing=&quot;PlacesOrganizer.populateRestoreMenu();&quot;&gt;</span>
<a href="#l8.517"></a><span id="l8.517" class="difflineplus">+                &lt;menuitem id=&quot;restoreFromFile&quot;</span>
<a href="#l8.518"></a><span id="l8.518" class="difflineplus">+                          command=&quot;OrganizerCommand_restoreFromFile&quot;</span>
<a href="#l8.519"></a><span id="l8.519" class="difflineplus">+                          label=&quot;&amp;cmd.restoreFromFile.label;&quot;</span>
<a href="#l8.520"></a><span id="l8.520" class="difflineplus">+                          accesskey=&quot;&amp;cmd.restoreFromFile.accesskey;&quot;/&gt;</span>
<a href="#l8.521"></a><span id="l8.521" class="difflineplus">+              &lt;/menupopup&gt;</span>
<a href="#l8.522"></a><span id="l8.522" class="difflineplus">+            &lt;/menu&gt;</span>
<a href="#l8.523"></a><span id="l8.523" class="difflineplus">+            &lt;menuseparator/&gt;</span>
<a href="#l8.524"></a><span id="l8.524" class="difflineplus">+            &lt;menuitem id=&quot;fileImport&quot;</span>
<a href="#l8.525"></a><span id="l8.525" class="difflineplus">+                      command=&quot;OrganizerCommand_import&quot;</span>
<a href="#l8.526"></a><span id="l8.526" class="difflineplus">+                      label=&quot;&amp;cmd.importHTML.label;&quot;</span>
<a href="#l8.527"></a><span id="l8.527" class="difflineplus">+                      accesskey=&quot;&amp;cmd.importHTML.accesskey;&quot;/&gt;</span>
<a href="#l8.528"></a><span id="l8.528" class="difflineplus">+            &lt;menuitem id=&quot;fileExport&quot;</span>
<a href="#l8.529"></a><span id="l8.529" class="difflineplus">+                      command=&quot;OrganizerCommand_export&quot;</span>
<a href="#l8.530"></a><span id="l8.530" class="difflineplus">+                      label=&quot;&amp;cmd.exportHTML.label;&quot;</span>
<a href="#l8.531"></a><span id="l8.531" class="difflineplus">+                      accesskey=&quot;&amp;cmd.exportHTML.accesskey;&quot;/&gt;</span>
<a href="#l8.532"></a><span id="l8.532" class="difflineplus">+            &lt;menuseparator/&gt;</span>
<a href="#l8.533"></a><span id="l8.533" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l8.534"></a><span id="l8.534" class="difflineplus">+        &lt;/menu&gt;</span>
<a href="#l8.535"></a><span id="l8.535" class="difflineplus">+</span>
<a href="#l8.536"></a><span id="l8.536" class="difflineplus">+        &lt;!-- window menu filled from tasksOverlay --&gt;</span>
<a href="#l8.537"></a><span id="l8.537" class="difflineplus">+        &lt;menu id=&quot;windowMenu&quot;/&gt;</span>
<a href="#l8.538"></a><span id="l8.538" class="difflineplus">+</span>
<a href="#l8.539"></a><span id="l8.539" class="difflineplus">+        &lt;!-- help menu filled from globalOverlay --&gt;</span>
<a href="#l8.540"></a><span id="l8.540" class="difflineplus">+        &lt;menu id=&quot;menu_Help&quot;/&gt;</span>
<a href="#l8.541"></a><span id="l8.541" class="difflineplus">+      &lt;/menubar&gt;</span>
<a href="#l8.542"></a><span id="l8.542" class="difflineplus">+</span>
<a href="#l8.543"></a><span id="l8.543" class="difflineplus">+      &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l8.544"></a><span id="l8.544" class="difflineplus">+      &lt;toolbarbutton id=&quot;back-button&quot; class=&quot;toolbarbutton-1 chromeclass-toolbar-additional&quot;</span>
<a href="#l8.545"></a><span id="l8.545" class="difflineplus">+                     command=&quot;OrganizerCommand:Back&quot;</span>
<a href="#l8.546"></a><span id="l8.546" class="difflineplus">+                     tooltiptext=&quot;&amp;backButton.tooltip;&quot;</span>
<a href="#l8.547"></a><span id="l8.547" class="difflineplus">+                     disabled=&quot;true&quot;/&gt;</span>
<a href="#l8.548"></a><span id="l8.548" class="difflineplus">+</span>
<a href="#l8.549"></a><span id="l8.549" class="difflineplus">+      &lt;toolbarbutton id=&quot;forward-button&quot; class=&quot;toolbarbutton-1 chromeclass-toolbar-additional&quot;</span>
<a href="#l8.550"></a><span id="l8.550" class="difflineplus">+                     command=&quot;OrganizerCommand:Forward&quot;</span>
<a href="#l8.551"></a><span id="l8.551" class="difflineplus">+                     tooltiptext=&quot;&amp;forwardButton.tooltip;&quot;</span>
<a href="#l8.552"></a><span id="l8.552" class="difflineplus">+                     disabled=&quot;true&quot;/&gt;</span>
<a href="#l8.553"></a><span id="l8.553" class="difflineplus">+</span>
<a href="#l8.554"></a><span id="l8.554" class="difflineplus">+</span>
<a href="#l8.555"></a><span id="l8.555" class="difflineplus">+      &lt;textbox id=&quot;searchFilter&quot;</span>
<a href="#l8.556"></a><span id="l8.556" class="difflineplus">+               clickSelectsAll=&quot;true&quot;</span>
<a href="#l8.557"></a><span id="l8.557" class="difflineplus">+               type=&quot;search&quot;</span>
<a href="#l8.558"></a><span id="l8.558" class="difflineplus">+               aria-controls=&quot;placeContent&quot;</span>
<a href="#l8.559"></a><span id="l8.559" class="difflineplus">+               oncommand=&quot;PlacesSearchBox.search(this.value);&quot;</span>
<a href="#l8.560"></a><span id="l8.560" class="difflineplus">+               collection=&quot;bookmarks&quot;&gt;</span>
<a href="#l8.561"></a><span id="l8.561" class="difflineplus">+      &lt;/textbox&gt;</span>
<a href="#l8.562"></a><span id="l8.562">     &lt;/toolbar&gt;</span>
<a href="#l8.563"></a><span id="l8.563">   &lt;/toolbox&gt;</span>
<a href="#l8.564"></a><span id="l8.564"> </span>
<a href="#l8.565"></a><span id="l8.565" class="difflineminus">-  &lt;bookmarks-tree id=&quot;bookmarks-view&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l8.566"></a><span id="l8.566" class="difflineplus">+  &lt;hbox flex=&quot;1&quot; id=&quot;placesView&quot;&gt;</span>
<a href="#l8.567"></a><span id="l8.567" class="difflineplus">+    &lt;tree id=&quot;placesList&quot;</span>
<a href="#l8.568"></a><span id="l8.568" class="difflineplus">+          class=&quot;placesTree&quot;</span>
<a href="#l8.569"></a><span id="l8.569" class="difflineplus">+          type=&quot;places&quot;</span>
<a href="#l8.570"></a><span id="l8.570" class="difflineplus">+          hidecolumnpicker=&quot;true&quot; context=&quot;placesContext&quot;</span>
<a href="#l8.571"></a><span id="l8.571" class="difflineplus">+          onselect=&quot;PlacesOrganizer.onPlaceSelected(true);&quot;</span>
<a href="#l8.572"></a><span id="l8.572" class="difflineplus">+          onclick=&quot;PlacesOrganizer.onTreeClick(event);&quot;</span>
<a href="#l8.573"></a><span id="l8.573" class="difflineplus">+          onfocus=&quot;PlacesOrganizer.onTreeFocus(event);&quot;</span>
<a href="#l8.574"></a><span id="l8.574" class="difflineplus">+          seltype=&quot;single&quot;</span>
<a href="#l8.575"></a><span id="l8.575" class="difflineplus">+          persist=&quot;width&quot;</span>
<a href="#l8.576"></a><span id="l8.576" class="difflineplus">+          width=&quot;200&quot;</span>
<a href="#l8.577"></a><span id="l8.577" class="difflineplus">+          minwidth=&quot;100&quot;</span>
<a href="#l8.578"></a><span id="l8.578" class="difflineplus">+          maxwidth=&quot;400&quot;&gt;</span>
<a href="#l8.579"></a><span id="l8.579" class="difflineplus">+      &lt;treecols&gt;</span>
<a href="#l8.580"></a><span id="l8.580" class="difflineplus">+        &lt;treecol anonid=&quot;title&quot; flex=&quot;1&quot; primary=&quot;true&quot; hideheader=&quot;true&quot;/&gt;</span>
<a href="#l8.581"></a><span id="l8.581" class="difflineplus">+      &lt;/treecols&gt;</span>
<a href="#l8.582"></a><span id="l8.582" class="difflineplus">+      &lt;treechildren flex=&quot;1&quot;/&gt;</span>
<a href="#l8.583"></a><span id="l8.583" class="difflineplus">+    &lt;/tree&gt;</span>
<a href="#l8.584"></a><span id="l8.584" class="difflineplus">+    &lt;splitter collapse=&quot;none&quot; persist=&quot;state&quot;&gt;&lt;/splitter&gt;</span>
<a href="#l8.585"></a><span id="l8.585" class="difflineplus">+    &lt;vbox id=&quot;contentView&quot; flex=&quot;4&quot;&gt;</span>
<a href="#l8.586"></a><span id="l8.586" class="difflineplus">+      &lt;deck id=&quot;contentDeck&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l8.587"></a><span id="l8.587" class="difflineplus">+        &lt;vbox id=&quot;defaultView&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l8.588"></a><span id="l8.588" class="difflineplus">+          &lt;vbox id=&quot;searchModifiers&quot; hidden=&quot;true&quot;&gt;</span>
<a href="#l8.589"></a><span id="l8.589" class="difflineplus">+            &lt;toolbar id=&quot;organizerScopeBar&quot; class=&quot;chromeclass-toolbar&quot; align=&quot;center&quot;&gt;</span>
<a href="#l8.590"></a><span id="l8.590" class="difflineplus">+              &lt;label id=&quot;scopeBarTitle&quot; value=&quot;&amp;search.label;&quot;/&gt;</span>
<a href="#l8.591"></a><span id="l8.591" class="difflineplus">+              &lt;toolbarbutton id=&quot;scopeBarAll&quot; type=&quot;radio&quot; group=&quot;scopeBar&quot;</span>
<a href="#l8.592"></a><span id="l8.592" class="difflineplus">+                             oncommand=&quot;PlacesQueryBuilder.onScopeSelected(this);&quot;</span>
<a href="#l8.593"></a><span id="l8.593" class="difflineplus">+                             label=&quot;&amp;search.scopeBookmarks.label;&quot;</span>
<a href="#l8.594"></a><span id="l8.594" class="difflineplus">+                             accesskey=&quot;&amp;search.scopeBookmarks.accesskey;&quot;/&gt;</span>
<a href="#l8.595"></a><span id="l8.595" class="difflineplus">+              &lt;toolbarbutton id=&quot;scopeBarFolder&quot; type=&quot;radio&quot; group=&quot;scopeBar&quot;</span>
<a href="#l8.596"></a><span id="l8.596" class="difflineplus">+                             oncommand=&quot;PlacesQueryBuilder.onScopeSelected(this);&quot;</span>
<a href="#l8.597"></a><span id="l8.597" class="difflineplus">+                             accesskey=&quot;&amp;search.scopeFolder.accesskey;&quot;</span>
<a href="#l8.598"></a><span id="l8.598" class="difflineplus">+                             emptytitle=&quot;&amp;search.scopeFolder.label;&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l8.599"></a><span id="l8.599" class="difflineplus">+              &lt;!-- The folder scope button should flex but not take up more room</span>
<a href="#l8.600"></a><span id="l8.600" class="difflineplus">+                   than its label needs.  The only simple way to do that is to</span>
<a href="#l8.601"></a><span id="l8.601" class="difflineplus">+                   set a really big flex on the spacer, e.g., 2^31 - 1. --&gt;</span>
<a href="#l8.602"></a><span id="l8.602" class="difflineplus">+              &lt;spacer flex=&quot;2147483647&quot;/&gt;</span>
<a href="#l8.603"></a><span id="l8.603" class="difflineplus">+              &lt;button id=&quot;saveSearch&quot; class=&quot;small&quot;</span>
<a href="#l8.604"></a><span id="l8.604" class="difflineplus">+                       label=&quot;&amp;saveSearch.label;&quot; accesskey=&quot;&amp;saveSearch.accesskey;&quot;</span>
<a href="#l8.605"></a><span id="l8.605" class="difflineplus">+                       command=&quot;OrganizerCommand_search:save&quot;/&gt;</span>
<a href="#l8.606"></a><span id="l8.606" class="difflineplus">+            &lt;/toolbar&gt;</span>
<a href="#l8.607"></a><span id="l8.607"> </span>
<a href="#l8.608"></a><span id="l8.608" class="difflineplus">+          &lt;/vbox&gt;</span>
<a href="#l8.609"></a><span id="l8.609" class="difflineplus">+          &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l8.610"></a><span id="l8.610" class="difflineplus">+            &lt;tree id=&quot;placeContent&quot; class=&quot;placesTree&quot; context=&quot;placesContext&quot;</span>
<a href="#l8.611"></a><span id="l8.611" class="difflineplus">+                  hidecolumnpicker=&quot;true&quot;</span>
<a href="#l8.612"></a><span id="l8.612" class="difflineplus">+                  flex=&quot;1&quot; type=&quot;places&quot;</span>
<a href="#l8.613"></a><span id="l8.613" class="difflineplus">+                  enableColumnDrag=&quot;true&quot;</span>
<a href="#l8.614"></a><span id="l8.614" class="difflineplus">+                  onkeypress=&quot;if (event.keyCode == KeyEvent.DOM_VK_RETURN) PlacesOrganizer.openSelectedNode(event);&quot;</span>
<a href="#l8.615"></a><span id="l8.615" class="difflineplus">+                  onopenflatcontainer=&quot;PlacesOrganizer.openFlatContainer(aContainer);&quot;</span>
<a href="#l8.616"></a><span id="l8.616" class="difflineplus">+                  onselect=&quot;PlacesOrganizer.onContentTreeSelect();&quot;</span>
<a href="#l8.617"></a><span id="l8.617" class="difflineplus">+                  onfocus=&quot;PlacesOrganizer.onTreeFocus(event);&quot;</span>
<a href="#l8.618"></a><span id="l8.618" class="difflineplus">+                  onclick=&quot;PlacesOrganizer.onTreeClick(event);&quot;&gt;</span>
<a href="#l8.619"></a><span id="l8.619" class="difflineplus">+              &lt;treecols id=&quot;placeContentColumns&quot; context=&quot;placesColumnsContext&quot;&gt;</span>
<a href="#l8.620"></a><span id="l8.620" class="difflineplus">+                &lt;treecol label=&quot;&amp;col.name.label;&quot; id=&quot;placesContentTitle&quot; anonid=&quot;title&quot; flex=&quot;5&quot; primary=&quot;true&quot; ordinal=&quot;1&quot; </span>
<a href="#l8.621"></a><span id="l8.621" class="difflineplus">+                         persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l8.622"></a><span id="l8.622" class="difflineplus">+                &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.623"></a><span id="l8.623" class="difflineplus">+                &lt;treecol label=&quot;&amp;col.tags.label;&quot; id=&quot;placesContentTags&quot; anonid=&quot;tags&quot; flex=&quot;2&quot;</span>
<a href="#l8.624"></a><span id="l8.624" class="difflineplus">+                         persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l8.625"></a><span id="l8.625" class="difflineplus">+                &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.626"></a><span id="l8.626" class="difflineplus">+                &lt;treecol label=&quot;&amp;col.url.label;&quot; id=&quot;placesContentUrl&quot; anonid=&quot;url&quot; flex=&quot;5&quot;</span>
<a href="#l8.627"></a><span id="l8.627" class="difflineplus">+                         persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l8.628"></a><span id="l8.628" class="difflineplus">+                &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.629"></a><span id="l8.629" class="difflineplus">+                &lt;treecol label=&quot;&amp;col.lastvisit.label;&quot; id=&quot;placesContentDate&quot; anonid=&quot;date&quot; flex=&quot;1&quot; hidden=&quot;true&quot;</span>
<a href="#l8.630"></a><span id="l8.630" class="difflineplus">+                         persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l8.631"></a><span id="l8.631" class="difflineplus">+                &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.632"></a><span id="l8.632" class="difflineplus">+                &lt;treecol label=&quot;&amp;col.visitcount.label;&quot; id=&quot;placesContentVisitCount&quot; anonid=&quot;visitCount&quot; flex=&quot;1&quot; hidden=&quot;true&quot;</span>
<a href="#l8.633"></a><span id="l8.633" class="difflineplus">+                         persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l8.634"></a><span id="l8.634" class="difflineplus">+                &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.635"></a><span id="l8.635" class="difflineplus">+                &lt;treecol label=&quot;&amp;col.keyword.label;&quot; id=&quot;placesContentKeyword&quot; anonid=&quot;keyword&quot; flex=&quot;1&quot; hidden=&quot;true&quot;</span>
<a href="#l8.636"></a><span id="l8.636" class="difflineplus">+                         persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l8.637"></a><span id="l8.637" class="difflineplus">+                &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.638"></a><span id="l8.638" class="difflineplus">+                &lt;treecol label=&quot;&amp;col.description.label;&quot; id=&quot;placesContentDescription&quot; anonid=&quot;description&quot; flex=&quot;1&quot; hidden=&quot;true&quot;</span>
<a href="#l8.639"></a><span id="l8.639" class="difflineplus">+                         persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l8.640"></a><span id="l8.640" class="difflineplus">+                &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.641"></a><span id="l8.641" class="difflineplus">+                &lt;treecol label=&quot;&amp;col.dateadded.label;&quot; id=&quot;placesContentDateAdded&quot; anonid=&quot;dateAdded&quot; flex=&quot;1&quot; hidden=&quot;true&quot;</span>
<a href="#l8.642"></a><span id="l8.642" class="difflineplus">+                         persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l8.643"></a><span id="l8.643" class="difflineplus">+                &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l8.644"></a><span id="l8.644" class="difflineplus">+                &lt;treecol label=&quot;&amp;col.lastmodified.label;&quot; id=&quot;placesContentLastModified&quot; anonid=&quot;lastModified&quot; flex=&quot;1&quot; hidden=&quot;true&quot;</span>
<a href="#l8.645"></a><span id="l8.645" class="difflineplus">+                         persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l8.646"></a><span id="l8.646" class="difflineplus">+              &lt;/treecols&gt;</span>
<a href="#l8.647"></a><span id="l8.647" class="difflineplus">+              &lt;treechildren flex=&quot;1&quot;/&gt;</span>
<a href="#l8.648"></a><span id="l8.648" class="difflineplus">+            &lt;/tree&gt;</span>
<a href="#l8.649"></a><span id="l8.649" class="difflineplus">+            &lt;hbox id=&quot;infoPaneBox&quot; style=&quot;height: 11em;&quot;&gt;</span>
<a href="#l8.650"></a><span id="l8.650" class="difflineplus">+              &lt;deck flex=&quot;1&quot; id=&quot;detailsDeck&quot;&gt;</span>
<a href="#l8.651"></a><span id="l8.651" class="difflineplus">+                &lt;vbox id=&quot;itemsCountBox&quot; align=&quot;center&quot;&gt;</span>
<a href="#l8.652"></a><span id="l8.652" class="difflineplus">+                  &lt;spacer flex=&quot;3&quot;/&gt;</span>
<a href="#l8.653"></a><span id="l8.653" class="difflineplus">+                  &lt;label id=&quot;itemsCountText&quot;/&gt;</span>
<a href="#l8.654"></a><span id="l8.654" class="difflineplus">+                  &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l8.655"></a><span id="l8.655" class="difflineplus">+                  &lt;description id=&quot;selectItemDescription&quot;&gt;</span>
<a href="#l8.656"></a><span id="l8.656" class="difflineplus">+                     &amp;detailsPane.selectAnItemText.description;</span>
<a href="#l8.657"></a><span id="l8.657" class="difflineplus">+                  &lt;/description&gt;</span>
<a href="#l8.658"></a><span id="l8.658" class="difflineplus">+                  &lt;spacer flex=&quot;3&quot;/&gt;</span>
<a href="#l8.659"></a><span id="l8.659" class="difflineplus">+                &lt;/vbox&gt;</span>
<a href="#l8.660"></a><span id="l8.660" class="difflineplus">+                &lt;vbox id=&quot;infoBox&quot; minimal=&quot;true&quot;&gt;</span>
<a href="#l8.661"></a><span id="l8.661" class="difflineplus">+                  &lt;vbox id=&quot;editBookmarkPanelContent&quot;/&gt;</span>
<a href="#l8.662"></a><span id="l8.662" class="difflineplus">+                  &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l8.663"></a><span id="l8.663" class="difflineplus">+                  &lt;hbox id=&quot;infoBoxExpanderWrapper&quot; align=&quot;center&quot;&gt;</span>
<a href="#l8.664"></a><span id="l8.664" class="difflineplus">+</span>
<a href="#l8.665"></a><span id="l8.665" class="difflineplus">+                    &lt;button type=&quot;image&quot; id=&quot;infoBoxExpander&quot;</span>
<a href="#l8.666"></a><span id="l8.666" class="difflineplus">+                            class=&quot;expander-down&quot;</span>
<a href="#l8.667"></a><span id="l8.667" class="difflineplus">+                            oncommand=&quot;PlacesOrganizer.toggleAdditionalInfoFields();&quot;</span>
<a href="#l8.668"></a><span id="l8.668" class="difflineplus">+                            observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l8.669"></a><span id="l8.669" class="difflineplus">+</span>
<a href="#l8.670"></a><span id="l8.670" class="difflineplus">+                    &lt;label id=&quot;infoBoxExpanderLabel&quot;</span>
<a href="#l8.671"></a><span id="l8.671" class="difflineplus">+                           lesslabel=&quot;&amp;detailsPane.less.label;&quot;</span>
<a href="#l8.672"></a><span id="l8.672" class="difflineplus">+                           lessaccesskey=&quot;&amp;detailsPane.less.accesskey;&quot;</span>
<a href="#l8.673"></a><span id="l8.673" class="difflineplus">+                           morelabel=&quot;&amp;detailsPane.more.label;&quot;</span>
<a href="#l8.674"></a><span id="l8.674" class="difflineplus">+                           moreaccesskey=&quot;&amp;detailsPane.more.accesskey;&quot;</span>
<a href="#l8.675"></a><span id="l8.675" class="difflineplus">+                           value=&quot;&amp;detailsPane.more.label;&quot;</span>
<a href="#l8.676"></a><span id="l8.676" class="difflineplus">+                           accesskey=&quot;&amp;detailsPane.more.accesskey;&quot;</span>
<a href="#l8.677"></a><span id="l8.677" class="difflineplus">+                           control=&quot;infoBoxExpander&quot;/&gt;</span>
<a href="#l8.678"></a><span id="l8.678" class="difflineplus">+</span>
<a href="#l8.679"></a><span id="l8.679" class="difflineplus">+                    &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l8.680"></a><span id="l8.680" class="difflineplus">+                  &lt;/hbox&gt;</span>
<a href="#l8.681"></a><span id="l8.681" class="difflineplus">+                &lt;/vbox&gt;</span>
<a href="#l8.682"></a><span id="l8.682" class="difflineplus">+              &lt;/deck&gt;</span>
<a href="#l8.683"></a><span id="l8.683" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l8.684"></a><span id="l8.684" class="difflineplus">+          &lt;/vbox&gt;</span>
<a href="#l8.685"></a><span id="l8.685" class="difflineplus">+        &lt;/vbox&gt;</span>
<a href="#l8.686"></a><span id="l8.686" class="difflineplus">+      &lt;/deck&gt;</span>
<a href="#l8.687"></a><span id="l8.687" class="difflineplus">+    &lt;/vbox&gt;</span>
<a href="#l8.688"></a><span id="l8.688" class="difflineplus">+  &lt;/hbox&gt;</span>
<a href="#l8.689"></a><span id="l8.689"> &lt;/window&gt;</span>
<a href="#l8.690"></a><span id="l8.690" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/common/bookmarks/browser-places.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/common/bookmarks/browser-places.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -33,16 +33,261 @@</span>
<a href="#l9.4"></a><span id="l9.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l9.5"></a><span id="l9.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l9.6"></a><span id="l9.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l9.7"></a><span id="l9.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.8"></a><span id="l9.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.9"></a><span id="l9.9">  *</span>
<a href="#l9.10"></a><span id="l9.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+var StarUI = {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  _itemId: -1,</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  uri: null,</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+  _batching: false,</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+  _element: function(aID) {</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+    return document.getElementById(aID);</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+  },</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+  // Edit-bookmark panel</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+  get panel() {</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+    delete this.panel;</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+    var element = this._element(&quot;editBookmarkPanel&quot;);</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+    // initially the panel is hidden</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+    // to avoid impacting startup / new window performance</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+    element.hidden = false;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+    element.addEventListener(&quot;popuphidden&quot;, this, false);</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+    element.addEventListener(&quot;keypress&quot;, this, false);</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+    return this.panel = element;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+  },</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+  // Array of command elements to disable when the panel is opened.</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+  get _blockedCommands() {</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+    delete this._blockedCommands;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+    return this._blockedCommands =</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+      [&quot;cmd_close&quot;, &quot;cmd_closeWindow&quot;].map(function (id) this._element(id), this);</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+  },</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+  _blockCommands: function SU__blockCommands() {</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+    this._blockedCommands.forEach(function (elt) {</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+      // make sure not to permanently disable this item (see bug 409155)</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+      if (elt.hasAttribute(&quot;wasDisabled&quot;))</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+        return;</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+      if (elt.getAttribute(&quot;disabled&quot;) == &quot;true&quot;) {</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+        elt.setAttribute(&quot;wasDisabled&quot;, &quot;true&quot;);</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+      } else {</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+        elt.setAttribute(&quot;wasDisabled&quot;, &quot;false&quot;);</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+        elt.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+      }</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+    });</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+  },</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+  _restoreCommandsState: function SU__restoreCommandsState() {</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+    this._blockedCommands.forEach(function (elt) {</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+      if (elt.getAttribute(&quot;wasDisabled&quot;) != &quot;true&quot;)</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+        elt.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+      elt.removeAttribute(&quot;wasDisabled&quot;);</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+    });</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+  },</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+  // nsIDOMEventListener</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+  handleEvent: function SU_handleEvent(aEvent) {</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+    switch (aEvent.type) {</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+      case &quot;popuphidden&quot;:</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+        if (aEvent.originalTarget == this.panel) {</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+          if (!this._element(&quot;editBookmarkPanelContent&quot;).hidden)</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+            this.quitEditMode();</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+          this._restoreCommandsState();</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+          this._itemId = -1;</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+          if (this._batching) {</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+            PlacesUIUtils.ptm.endBatch();</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+            this._batching = false;</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+          }</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+          switch (this._actionOnHide) {</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+            case &quot;cancel&quot;: {</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+              PlacesUIUtils.ptm.undoTransaction();</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+              break;</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+            }</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+            case &quot;remove&quot;: {</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+              // Remove all bookmarks for the bookmark's url, this also removes</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+              // the tags for the url.</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+              PlacesUIUtils.ptm.beginBatch();</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+              let itemIds = PlacesUtils.getBookmarksForURI(this._uriForRemoval);</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+              for (let i = 0; i &lt; itemIds.length; i++) {</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+                let txn = PlacesUIUtils.ptm.removeItem(itemIds[i]);</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+                PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineplus">+              }</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineplus">+              PlacesUIUtils.ptm.endBatch();</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineplus">+              this._uriForRemoval = null;</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineplus">+              break;</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineplus">+            }</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+          }</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+          this._actionOnHide = &quot;&quot;;</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineplus">+        }</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineplus">+        break;</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineplus">+      case &quot;keypress&quot;:</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineplus">+        if (aEvent.getPreventDefault()) {</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineplus">+          // The event has already been consumed inside of the panel.</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineplus">+          break;</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineplus">+        }</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineplus">+        switch (aEvent.keyCode) {</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineplus">+          case KeyEvent.DOM_VK_ESCAPE:</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+            if (!this._element(&quot;editBookmarkPanelContent&quot;).hidden)</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+              this.cancelButtonOnCommand();</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineplus">+            break;</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineplus">+          case KeyEvent.DOM_VK_RETURN:</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineplus">+            if (aEvent.target.className == &quot;expander-up&quot; ||</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineplus">+                aEvent.target.className == &quot;expander-down&quot; ||</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineplus">+                aEvent.target.id == &quot;editBMPanel_newFolderButton&quot;) {</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineplus">+              //XXX Why is this necessary? The getPreventDefault() check should</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineplus">+              //    be enough.</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineplus">+              break;</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineplus">+            }</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineplus">+            this.panel.hidePopup();</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineplus">+            break;</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineplus">+        }</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineplus">+        break;</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineplus">+    }</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineplus">+  },</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineplus">+</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineplus">+  _overlayLoaded: false,</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineplus">+  _overlayLoading: false,</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineplus">+  showEditBookmarkPopup:</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+  function SU_showEditBookmarkPopup(aItemId, aAnchorElement, aPosition) {</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineplus">+    // Performance: load the overlay the first time the panel is opened</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineplus">+    // (see bug 392443).</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineplus">+    if (this._overlayLoading)</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineplus">+      return;</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineplus">+</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineplus">+    if (this._overlayLoaded) {</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineplus">+      this._doShowEditBookmarkPanel(aItemId, aAnchorElement, aPosition);</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineplus">+      return;</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineplus">+    }</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineplus">+</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineplus">+    var loadObserver = {</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineplus">+      _self: this,</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineplus">+      _itemId: aItemId,</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineplus">+      _anchorElement: aAnchorElement,</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineplus">+      _position: aPosition,</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineplus">+      observe: function (aSubject, aTopic, aData) {</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineplus">+        this._self._overlayLoading = false;</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineplus">+        this._self._overlayLoaded = true;</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineplus">+        this._self._doShowEditBookmarkPanel(this._itemId, this._anchorElement,</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineplus">+                                            this._position);</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineplus">+      }</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineplus">+    };</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineplus">+    this._overlayLoading = true;</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineplus">+    document.loadOverlay(&quot;chrome://communicator/content/bookmarks/editBookmarkOverlay.xul&quot;,</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineplus">+                         loadObserver);</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineplus">+  },</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineplus">+</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineplus">+  _doShowEditBookmarkPanel:</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineplus">+  function SU__doShowEditBookmarkPanel(aItemId, aAnchorElement, aPosition) {</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineplus">+    if (this.panel.state != &quot;closed&quot;)</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineplus">+      return;</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineplus">+</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineplus">+    this._blockCommands(); // un-done in the popuphiding handler</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineplus">+</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineplus">+    // Move the header (star, title, possibly a button) into the grid,</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineplus">+    // so that it aligns nicely with the other items (bug 484022).</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineplus">+    var rows = this._element(&quot;editBookmarkPanelGrid&quot;).lastChild;</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineplus">+    var header = this._element(&quot;editBookmarkPanelHeader&quot;);</span>
<a href="#l9.166"></a><span id="l9.166" class="difflineplus">+    rows.insertBefore(header, rows.firstChild);</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineplus">+    header.hidden = false;</span>
<a href="#l9.168"></a><span id="l9.168" class="difflineplus">+</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineplus">+    // Set panel title:</span>
<a href="#l9.170"></a><span id="l9.170" class="difflineplus">+    // if we are batching, i.e. the bookmark has been added now,</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineplus">+    // then show Page Bookmarked, else if the bookmark did already exist,</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineplus">+    // we are about editing it, then use Edit This Bookmark.</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+    this._element(&quot;editBookmarkPanelTitle&quot;).value =</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineplus">+      this._batching ?</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineplus">+        gNavigatorBundle.getString(&quot;editBookmarkPanel.pageBookmarkedTitle&quot;) :</span>
<a href="#l9.176"></a><span id="l9.176" class="difflineplus">+        gNavigatorBundle.getString(&quot;editBookmarkPanel.editBookmarkTitle&quot;);</span>
<a href="#l9.177"></a><span id="l9.177" class="difflineplus">+</span>
<a href="#l9.178"></a><span id="l9.178" class="difflineplus">+    // No description; show the Done, Cancel;</span>
<a href="#l9.179"></a><span id="l9.179" class="difflineplus">+    this._element(&quot;editBookmarkPanelDescription&quot;).textContent = &quot;&quot;;</span>
<a href="#l9.180"></a><span id="l9.180" class="difflineplus">+    this._element(&quot;editBookmarkPanelBottomButtons&quot;).hidden = false;</span>
<a href="#l9.181"></a><span id="l9.181" class="difflineplus">+    this._element(&quot;editBookmarkPanelContent&quot;).hidden = false;</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineplus">+</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineplus">+    // The remove button is shown only if we're not already batching, i.e.</span>
<a href="#l9.184"></a><span id="l9.184" class="difflineplus">+    // if the cancel button/ESC does not remove the bookmark.</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineplus">+    this._element(&quot;editBookmarkPanelRemoveButton&quot;).hidden = this._batching;</span>
<a href="#l9.186"></a><span id="l9.186" class="difflineplus">+</span>
<a href="#l9.187"></a><span id="l9.187" class="difflineplus">+    // The label of the remove button differs if the URI is bookmarked</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineplus">+    // multiple times.</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineplus">+    var bookmarks = PlacesUtils.getBookmarksForURI(gBrowser.currentURI);</span>
<a href="#l9.190"></a><span id="l9.190" class="difflineplus">+    var forms = gNavigatorBundle.getString(&quot;editBookmark.removeBookmarks.label&quot;);</span>
<a href="#l9.191"></a><span id="l9.191" class="difflineplus">+    var label = PluralForm.get(bookmarks.length, forms).replace(&quot;#1&quot;, bookmarks.length);</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineplus">+    this._element(&quot;editBookmarkPanelRemoveButton&quot;).label = label;</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineplus">+</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineplus">+    // unset the unstarred state, if set</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineplus">+    this._element(&quot;editBookmarkPanelStarIcon&quot;).removeAttribute(&quot;unstarred&quot;);</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineplus">+</span>
<a href="#l9.197"></a><span id="l9.197" class="difflineplus">+    this._itemId = aItemId !== undefined ? aItemId : this._itemId;</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineplus">+    this.beginBatch();</span>
<a href="#l9.199"></a><span id="l9.199" class="difflineplus">+</span>
<a href="#l9.200"></a><span id="l9.200" class="difflineplus">+    // Consume dismiss clicks, see bug 400924</span>
<a href="#l9.201"></a><span id="l9.201" class="difflineplus">+    this.panel.popupBoxObject</span>
<a href="#l9.202"></a><span id="l9.202" class="difflineplus">+        .setConsumeRollupEvent(Components.interfaces.nsIPopupBoxObject.ROLLUP_CONSUME);</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineplus">+    this.panel.openPopup(aAnchorElement, aPosition, -1, -1);</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineplus">+</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineplus">+    gEditItemOverlay.initPanel(this._itemId,</span>
<a href="#l9.206"></a><span id="l9.206" class="difflineplus">+                               { hiddenRows: [&quot;description&quot;, &quot;location&quot;,</span>
<a href="#l9.207"></a><span id="l9.207" class="difflineplus">+                                              &quot;loadInSidebar&quot;, &quot;keyword&quot;] });</span>
<a href="#l9.208"></a><span id="l9.208" class="difflineplus">+  },</span>
<a href="#l9.209"></a><span id="l9.209" class="difflineplus">+</span>
<a href="#l9.210"></a><span id="l9.210" class="difflineplus">+  panelShown:</span>
<a href="#l9.211"></a><span id="l9.211" class="difflineplus">+  function SU_panelShown(aEvent) {</span>
<a href="#l9.212"></a><span id="l9.212" class="difflineplus">+    if (aEvent.target == this.panel) {</span>
<a href="#l9.213"></a><span id="l9.213" class="difflineplus">+      if (!this._element(&quot;editBookmarkPanelContent&quot;).hidden) {</span>
<a href="#l9.214"></a><span id="l9.214" class="difflineplus">+        let fieldToFocus = &quot;editBMPanel_&quot; +</span>
<a href="#l9.215"></a><span id="l9.215" class="difflineplus">+          Services.prefs.getCharPref(&quot;browser.bookmarks.editDialog.firstEditField&quot;);</span>
<a href="#l9.216"></a><span id="l9.216" class="difflineplus">+        var elt = this._element(fieldToFocus);</span>
<a href="#l9.217"></a><span id="l9.217" class="difflineplus">+        elt.focus();</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineplus">+        elt.select();</span>
<a href="#l9.219"></a><span id="l9.219" class="difflineplus">+      }</span>
<a href="#l9.220"></a><span id="l9.220" class="difflineplus">+      else {</span>
<a href="#l9.221"></a><span id="l9.221" class="difflineplus">+        // Note this isn't actually used anymore, we should remove this</span>
<a href="#l9.222"></a><span id="l9.222" class="difflineplus">+        // once we decide not to bring back the page bookmarked notification</span>
<a href="#l9.223"></a><span id="l9.223" class="difflineplus">+        this.panel.focus();</span>
<a href="#l9.224"></a><span id="l9.224" class="difflineplus">+      }</span>
<a href="#l9.225"></a><span id="l9.225" class="difflineplus">+    }</span>
<a href="#l9.226"></a><span id="l9.226" class="difflineplus">+  },</span>
<a href="#l9.227"></a><span id="l9.227" class="difflineplus">+</span>
<a href="#l9.228"></a><span id="l9.228" class="difflineplus">+  quitEditMode: function SU_quitEditMode() {</span>
<a href="#l9.229"></a><span id="l9.229" class="difflineplus">+    this._element(&quot;editBookmarkPanelContent&quot;).hidden = true;</span>
<a href="#l9.230"></a><span id="l9.230" class="difflineplus">+    this._element(&quot;editBookmarkPanelBottomButtons&quot;).hidden = true;</span>
<a href="#l9.231"></a><span id="l9.231" class="difflineplus">+    gEditItemOverlay.uninitPanel(true);</span>
<a href="#l9.232"></a><span id="l9.232" class="difflineplus">+  },</span>
<a href="#l9.233"></a><span id="l9.233" class="difflineplus">+</span>
<a href="#l9.234"></a><span id="l9.234" class="difflineplus">+  editButtonCommand: function SU_editButtonCommand() {</span>
<a href="#l9.235"></a><span id="l9.235" class="difflineplus">+    this.showEditBookmarkPopup();</span>
<a href="#l9.236"></a><span id="l9.236" class="difflineplus">+  },</span>
<a href="#l9.237"></a><span id="l9.237" class="difflineplus">+</span>
<a href="#l9.238"></a><span id="l9.238" class="difflineplus">+  cancelButtonOnCommand: function SU_cancelButtonOnCommand() {</span>
<a href="#l9.239"></a><span id="l9.239" class="difflineplus">+    this._actionOnHide = &quot;cancel&quot;;</span>
<a href="#l9.240"></a><span id="l9.240" class="difflineplus">+    this.panel.hidePopup();</span>
<a href="#l9.241"></a><span id="l9.241" class="difflineplus">+  },</span>
<a href="#l9.242"></a><span id="l9.242" class="difflineplus">+</span>
<a href="#l9.243"></a><span id="l9.243" class="difflineplus">+  removeBookmarkButtonCommand: function SU_removeBookmarkButtonCommand() {</span>
<a href="#l9.244"></a><span id="l9.244" class="difflineplus">+    this._uriForRemoval = PlacesUtils.bookmarks.getBookmarkURI(this._itemId);</span>
<a href="#l9.245"></a><span id="l9.245" class="difflineplus">+    this._actionOnHide = &quot;remove&quot;;</span>
<a href="#l9.246"></a><span id="l9.246" class="difflineplus">+    this.panel.hidePopup();</span>
<a href="#l9.247"></a><span id="l9.247" class="difflineplus">+  },</span>
<a href="#l9.248"></a><span id="l9.248" class="difflineplus">+</span>
<a href="#l9.249"></a><span id="l9.249" class="difflineplus">+  beginBatch: function SU_beginBatch() {</span>
<a href="#l9.250"></a><span id="l9.250" class="difflineplus">+    if (!this._batching) {</span>
<a href="#l9.251"></a><span id="l9.251" class="difflineplus">+      PlacesUIUtils.ptm.beginBatch();</span>
<a href="#l9.252"></a><span id="l9.252" class="difflineplus">+      this._batching = true;</span>
<a href="#l9.253"></a><span id="l9.253" class="difflineplus">+    }</span>
<a href="#l9.254"></a><span id="l9.254" class="difflineplus">+  }</span>
<a href="#l9.255"></a><span id="l9.255" class="difflineplus">+}</span>
<a href="#l9.256"></a><span id="l9.256" class="difflineplus">+</span>
<a href="#l9.257"></a><span id="l9.257"> var PlacesCommandHook = {</span>
<a href="#l9.258"></a><span id="l9.258">   /**</span>
<a href="#l9.259"></a><span id="l9.259">    * Adds a bookmark to the page loaded in the given browser.</span>
<a href="#l9.260"></a><span id="l9.260">    *</span>
<a href="#l9.261"></a><span id="l9.261">    * @param aBrowser</span>
<a href="#l9.262"></a><span id="l9.262">    *        a &lt;browser&gt; element.</span>
<a href="#l9.263"></a><span id="l9.263">    * @param [optional] aParent</span>
<a href="#l9.264"></a><span id="l9.264">    *        The folder in which to create a new bookmark if the page loaded in</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/suite/common/bookmarks/editBookmarkOverlay.js</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,1170 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+ *</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+ *</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+ * License.</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+ *</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+ * The Original Code is the Places Bookmark Properties dialog.</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+ *</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+ *</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+ *</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+ *</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+const LAST_USED_ANNO = &quot;bookmarkPropertiesDialog/folderLastUsed&quot;;</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+const STATIC_TITLE_ANNO = &quot;bookmarks/staticTitle&quot;;</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+const MAX_FOLDER_ITEM_IN_MENU_LIST = 5;</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+var gEditItemOverlay = {</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+  _uri: null,</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+  _itemId: -1,</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+  _itemIds: [],</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+  _uris: [],</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+  _tags: [],</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+  _allTags: [],</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+  _multiEdit: false,</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+  _itemType: -1,</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+  _readOnly: false,</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+  _microsummaries: null,</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+  _hiddenRows: [],</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+  _observersAdded: false,</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+  _staticFoldersListBuilt: false,</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+  _initialized: false,</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+  // the first field which was edited after this panel was initialized for</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+  // a certain item</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+  _firstEditedField: &quot;&quot;,</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+  get itemId() {</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+    return this._itemId;</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+  },</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+  get uri() {</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+    return this._uri;</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+  },</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+  get multiEdit() {</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+    return this._multiEdit;</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+  },</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+  /**</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+   * Determines the initial data for the item edited or added by this dialog</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+   */</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+  _determineInfo: function EIO__determineInfo(aInfo) {</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+    // hidden rows</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+    if (aInfo &amp;&amp; aInfo.hiddenRows)</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+      this._hiddenRows = aInfo.hiddenRows;</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+    else</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+      this._hiddenRows.splice(0);</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+    // force-read-only</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+    this._readOnly = aInfo &amp;&amp; aInfo.forceReadOnly;</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+  },</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+  _showHideRows: function EIO__showHideRows() {</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+    var isBookmark = this._itemId != -1 &amp;&amp;</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+                     this._itemType == Components.interfaces.nsINavBookmarksService.TYPE_BOOKMARK;</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+    var isQuery = false;</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+    if (this._uri)</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+      isQuery = this._uri.schemeIs(&quot;place&quot;);</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineplus">+    this._element(&quot;nameRow&quot;).collapsed = this._hiddenRows.indexOf(&quot;name&quot;) != -1;</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+    this._element(&quot;folderRow&quot;).collapsed =</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+      this._hiddenRows.indexOf(&quot;folderPicker&quot;) != -1 || this._readOnly;</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+    this._element(&quot;tagsRow&quot;).collapsed = !this._uri ||</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineplus">+      this._hiddenRows.indexOf(&quot;tags&quot;) != -1 || isQuery;</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineplus">+    // Collapse the tag selector if the item does not accept tags.</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineplus">+    if (!this._element(&quot;tagsSelectorRow&quot;).collapsed &amp;&amp;</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+        this._element(&quot;tagsRow&quot;).collapsed)</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineplus">+      this.toggleTagsSelector();</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+    this._element(&quot;descriptionRow&quot;).collapsed =</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+      this._hiddenRows.indexOf(&quot;description&quot;) != -1 || this._readOnly;</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+    this._element(&quot;keywordRow&quot;).collapsed = !isBookmark || this._readOnly ||</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+      this._hiddenRows.indexOf(&quot;keyword&quot;) != -1 || isQuery;</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineplus">+    this._element(&quot;locationRow&quot;).collapsed = !(this._uri &amp;&amp; !isQuery) ||</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+      this._hiddenRows.indexOf(&quot;location&quot;) != -1;</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+    this._element(&quot;loadInSidebarCheckbox&quot;).collapsed = !isBookmark || isQuery ||</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+      this._readOnly || this._hiddenRows.indexOf(&quot;loadInSidebar&quot;) != -1;</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+    this._element(&quot;feedLocationRow&quot;).collapsed = !this._isLivemark ||</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineplus">+      this._hiddenRows.indexOf(&quot;feedLocation&quot;) != -1;</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineplus">+    this._element(&quot;siteLocationRow&quot;).collapsed = !this._isLivemark ||</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+      this._hiddenRows.indexOf(&quot;siteLocation&quot;) != -1;</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineplus">+    this._element(&quot;selectionCount&quot;).hidden = !this._multiEdit;</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineplus">+  },</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineplus">+  /**</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineplus">+   * Initialize the panel</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineplus">+   * @param aFor</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineplus">+   *        Either a places-itemId (of a bookmark, folder or a live bookmark),</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineplus">+   *        an array of itemIds (used for bulk tagging), or a URI object (in </span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+   *        which case, the panel would be initialized in read-only mode).</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineplus">+   * @param [optional] aInfo</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineplus">+   *        JS object which stores additional info for the panel</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineplus">+   *        initialization. The following properties may bet set:</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineplus">+   *        * hiddenRows (Strings array): list of rows to be hidden regardless</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineplus">+   *          of the item edited. Possible values: &quot;title&quot;, &quot;location&quot;,</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineplus">+   *          &quot;description&quot;, &quot;keyword&quot;, &quot;loadInSidebar&quot;, &quot;feedLocation&quot;,</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineplus">+   *          &quot;siteLocation&quot;, folderPicker&quot;</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineplus">+   *        * forceReadOnly - set this flag to initialize the panel to its</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineplus">+   *          read-only (view) mode even if the given item is editable.</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineplus">+   */</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineplus">+  initPanel: function EIO_initPanel(aFor, aInfo) {</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineplus">+    // For sanity ensure that the implementer has uninited the panel before</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineplus">+    // trying to init it again, or we could end up leaking due to observers.</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineplus">+    if (this._initialized)</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineplus">+      this.uninitPanel(false);</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineplus">+</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineplus">+    var aItemIdList;</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineplus">+    if (aFor.length) {</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineplus">+      aItemIdList = aFor;</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineplus">+      aFor = aItemIdList[0];</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineplus">+    }</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineplus">+    else if (this._multiEdit) {</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineplus">+      this._multiEdit = false;</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineplus">+      this._tags = [];</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineplus">+      this._uris = [];</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineplus">+      this._allTags = [];</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineplus">+      this._itemIds = [];</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineplus">+      this._element(&quot;selectionCount&quot;).hidden = true;</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineplus">+    }</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineplus">+</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineplus">+    this._folderMenuList = this._element(&quot;folderMenuList&quot;);</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineplus">+    this._folderTree = this._element(&quot;folderTree&quot;);</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineplus">+</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineplus">+    this._determineInfo(aInfo);</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineplus">+    if (aFor instanceof Components.interfaces.nsIURI) {</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineplus">+      this._itemId = -1;</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineplus">+      this._uri = aFor;</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineplus">+      this._readOnly = true;</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineplus">+    }</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineplus">+    else {</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineplus">+      this._itemId = aFor;</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineplus">+      var containerId = PlacesUtils.bookmarks.getFolderIdForItem(this._itemId);</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineplus">+      this._itemType = PlacesUtils.bookmarks.getItemType(this._itemId);</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineplus">+      if (this._itemType == Components.interfaces.nsINavBookmarksService.TYPE_BOOKMARK) {</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineplus">+        this._uri = PlacesUtils.bookmarks.getBookmarkURI(this._itemId);</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineplus">+        if (!this._readOnly) // If readOnly wasn't forced through aInfo</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineplus">+          this._readOnly = PlacesUtils.itemIsLivemark(containerId);</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineplus">+        this._initTextField(&quot;keywordField&quot;,</span>
<a href="#l10.176"></a><span id="l10.176" class="difflineplus">+                            PlacesUtils.bookmarks</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineplus">+                                       .getKeywordForBookmark(this._itemId));</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineplus">+        // Load In Sidebar checkbox</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineplus">+        this._element(&quot;loadInSidebarCheckbox&quot;).checked =</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineplus">+          PlacesUtils.annotations.itemHasAnnotation(this._itemId,</span>
<a href="#l10.181"></a><span id="l10.181" class="difflineplus">+                                                    PlacesUIUtils.LOAD_IN_SIDEBAR_ANNO);</span>
<a href="#l10.182"></a><span id="l10.182" class="difflineplus">+      }</span>
<a href="#l10.183"></a><span id="l10.183" class="difflineplus">+      else {</span>
<a href="#l10.184"></a><span id="l10.184" class="difflineplus">+        if (!this._readOnly) // If readOnly wasn't forced through aInfo</span>
<a href="#l10.185"></a><span id="l10.185" class="difflineplus">+          this._readOnly = false;</span>
<a href="#l10.186"></a><span id="l10.186" class="difflineplus">+</span>
<a href="#l10.187"></a><span id="l10.187" class="difflineplus">+        this._uri = null;</span>
<a href="#l10.188"></a><span id="l10.188" class="difflineplus">+        this._isLivemark = PlacesUtils.itemIsLivemark(this._itemId);</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineplus">+        if (this._isLivemark) {</span>
<a href="#l10.190"></a><span id="l10.190" class="difflineplus">+          var feedURI = PlacesUtils.livemarks.getFeedURI(this._itemId);</span>
<a href="#l10.191"></a><span id="l10.191" class="difflineplus">+          var siteURI = PlacesUtils.livemarks.getSiteURI(this._itemId);</span>
<a href="#l10.192"></a><span id="l10.192" class="difflineplus">+          this._initTextField(&quot;feedLocationField&quot;, feedURI.spec);</span>
<a href="#l10.193"></a><span id="l10.193" class="difflineplus">+          this._initTextField(&quot;siteLocationField&quot;, siteURI ? siteURI.spec : &quot;&quot;);</span>
<a href="#l10.194"></a><span id="l10.194" class="difflineplus">+        }</span>
<a href="#l10.195"></a><span id="l10.195" class="difflineplus">+      }</span>
<a href="#l10.196"></a><span id="l10.196" class="difflineplus">+</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineplus">+      // folder picker</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineplus">+      this._initFolderMenuList(containerId);</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineplus">+</span>
<a href="#l10.200"></a><span id="l10.200" class="difflineplus">+      // description field</span>
<a href="#l10.201"></a><span id="l10.201" class="difflineplus">+      this._initTextField(&quot;descriptionField&quot;, </span>
<a href="#l10.202"></a><span id="l10.202" class="difflineplus">+                          PlacesUIUtils.getItemDescription(this._itemId));</span>
<a href="#l10.203"></a><span id="l10.203" class="difflineplus">+    }</span>
<a href="#l10.204"></a><span id="l10.204" class="difflineplus">+</span>
<a href="#l10.205"></a><span id="l10.205" class="difflineplus">+    if (this._itemId == -1 ||</span>
<a href="#l10.206"></a><span id="l10.206" class="difflineplus">+        this._itemType == Components.interfaces.nsINavBookmarksService.TYPE_BOOKMARK) {</span>
<a href="#l10.207"></a><span id="l10.207" class="difflineplus">+      this._isLivemark = false;</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineplus">+</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineplus">+      this._initTextField(&quot;locationField&quot;, this._uri.spec);</span>
<a href="#l10.210"></a><span id="l10.210" class="difflineplus">+      if (!aItemIdList) {</span>
<a href="#l10.211"></a><span id="l10.211" class="difflineplus">+        var tags = PlacesUtils.tagging.getTagsForURI(this._uri).join(&quot;, &quot;);</span>
<a href="#l10.212"></a><span id="l10.212" class="difflineplus">+        this._initTextField(&quot;tagsField&quot;, tags, false);</span>
<a href="#l10.213"></a><span id="l10.213" class="difflineplus">+      }</span>
<a href="#l10.214"></a><span id="l10.214" class="difflineplus">+      else {</span>
<a href="#l10.215"></a><span id="l10.215" class="difflineplus">+        this._multiEdit = true;</span>
<a href="#l10.216"></a><span id="l10.216" class="difflineplus">+        this._allTags = [];</span>
<a href="#l10.217"></a><span id="l10.217" class="difflineplus">+        this._itemIds = aItemIdList;</span>
<a href="#l10.218"></a><span id="l10.218" class="difflineplus">+        var nodeToCheck = 0;</span>
<a href="#l10.219"></a><span id="l10.219" class="difflineplus">+        for (var i = 0; i &lt; aItemIdList.length; i++) {</span>
<a href="#l10.220"></a><span id="l10.220" class="difflineplus">+          if (aItemIdList[i] instanceof Components.interfaces.nsIURI) {</span>
<a href="#l10.221"></a><span id="l10.221" class="difflineplus">+            this._uris[i] = aItemIdList[i];</span>
<a href="#l10.222"></a><span id="l10.222" class="difflineplus">+            this._itemIds[i] = -1;</span>
<a href="#l10.223"></a><span id="l10.223" class="difflineplus">+          }</span>
<a href="#l10.224"></a><span id="l10.224" class="difflineplus">+          else</span>
<a href="#l10.225"></a><span id="l10.225" class="difflineplus">+            this._uris[i] = PlacesUtils.bookmarks.getBookmarkURI(this._itemIds[i]);</span>
<a href="#l10.226"></a><span id="l10.226" class="difflineplus">+          this._tags[i] = PlacesUtils.tagging.getTagsForURI(this._uris[i]);</span>
<a href="#l10.227"></a><span id="l10.227" class="difflineplus">+          if (this._tags[i].length &lt; this._tags[nodeToCheck].length)</span>
<a href="#l10.228"></a><span id="l10.228" class="difflineplus">+            nodeToCheck =  i;</span>
<a href="#l10.229"></a><span id="l10.229" class="difflineplus">+        }</span>
<a href="#l10.230"></a><span id="l10.230" class="difflineplus">+        this._getCommonTags(nodeToCheck);</span>
<a href="#l10.231"></a><span id="l10.231" class="difflineplus">+        this._initTextField(&quot;tagsField&quot;, this._allTags.join(&quot;, &quot;), false);</span>
<a href="#l10.232"></a><span id="l10.232" class="difflineplus">+        this._element(&quot;itemsCountText&quot;).value =</span>
<a href="#l10.233"></a><span id="l10.233" class="difflineplus">+          PlacesUIUtils.getFormattedString(&quot;detailsPane.multipleItems&quot;,</span>
<a href="#l10.234"></a><span id="l10.234" class="difflineplus">+                                           [this._itemIds.length]);</span>
<a href="#l10.235"></a><span id="l10.235" class="difflineplus">+      }</span>
<a href="#l10.236"></a><span id="l10.236" class="difflineplus">+</span>
<a href="#l10.237"></a><span id="l10.237" class="difflineplus">+      // tags selector</span>
<a href="#l10.238"></a><span id="l10.238" class="difflineplus">+      this._rebuildTagsSelectorList();</span>
<a href="#l10.239"></a><span id="l10.239" class="difflineplus">+    }</span>
<a href="#l10.240"></a><span id="l10.240" class="difflineplus">+</span>
<a href="#l10.241"></a><span id="l10.241" class="difflineplus">+    // name picker</span>
<a href="#l10.242"></a><span id="l10.242" class="difflineplus">+    this._initNamePicker();</span>
<a href="#l10.243"></a><span id="l10.243" class="difflineplus">+</span>
<a href="#l10.244"></a><span id="l10.244" class="difflineplus">+    this._showHideRows();</span>
<a href="#l10.245"></a><span id="l10.245" class="difflineplus">+</span>
<a href="#l10.246"></a><span id="l10.246" class="difflineplus">+    // observe changes</span>
<a href="#l10.247"></a><span id="l10.247" class="difflineplus">+    if (!this._observersAdded) {</span>
<a href="#l10.248"></a><span id="l10.248" class="difflineplus">+      if (this._itemId != -1)</span>
<a href="#l10.249"></a><span id="l10.249" class="difflineplus">+        PlacesUtils.bookmarks.addObserver(this, false);</span>
<a href="#l10.250"></a><span id="l10.250" class="difflineplus">+      window.addEventListener(&quot;unload&quot;, this, false);</span>
<a href="#l10.251"></a><span id="l10.251" class="difflineplus">+      this._observersAdded = true;</span>
<a href="#l10.252"></a><span id="l10.252" class="difflineplus">+    }</span>
<a href="#l10.253"></a><span id="l10.253" class="difflineplus">+</span>
<a href="#l10.254"></a><span id="l10.254" class="difflineplus">+    this._initialized = true;</span>
<a href="#l10.255"></a><span id="l10.255" class="difflineplus">+  },</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineplus">+</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineplus">+  _getCommonTags: function(aArrIndex) {</span>
<a href="#l10.258"></a><span id="l10.258" class="difflineplus">+    var tempArray = this._tags[aArrIndex];</span>
<a href="#l10.259"></a><span id="l10.259" class="difflineplus">+    var isAllTag;</span>
<a href="#l10.260"></a><span id="l10.260" class="difflineplus">+    for (var k = 0; k &lt; tempArray.length; k++) {</span>
<a href="#l10.261"></a><span id="l10.261" class="difflineplus">+      isAllTag = true;</span>
<a href="#l10.262"></a><span id="l10.262" class="difflineplus">+      for (var j = 0; j &lt; this._tags.length; j++) {</span>
<a href="#l10.263"></a><span id="l10.263" class="difflineplus">+        if (j == aArrIndex)</span>
<a href="#l10.264"></a><span id="l10.264" class="difflineplus">+          continue;</span>
<a href="#l10.265"></a><span id="l10.265" class="difflineplus">+        if (this._tags[j].indexOf(tempArray[k]) == -1) {</span>
<a href="#l10.266"></a><span id="l10.266" class="difflineplus">+          isAllTag = false;</span>
<a href="#l10.267"></a><span id="l10.267" class="difflineplus">+          break;</span>
<a href="#l10.268"></a><span id="l10.268" class="difflineplus">+        }</span>
<a href="#l10.269"></a><span id="l10.269" class="difflineplus">+      }</span>
<a href="#l10.270"></a><span id="l10.270" class="difflineplus">+      if (isAllTag)</span>
<a href="#l10.271"></a><span id="l10.271" class="difflineplus">+        this._allTags.push(tempArray[k]);</span>
<a href="#l10.272"></a><span id="l10.272" class="difflineplus">+    }</span>
<a href="#l10.273"></a><span id="l10.273" class="difflineplus">+  },</span>
<a href="#l10.274"></a><span id="l10.274" class="difflineplus">+</span>
<a href="#l10.275"></a><span id="l10.275" class="difflineplus">+  _initTextField: function(aTextFieldId, aValue, aReadOnly) {</span>
<a href="#l10.276"></a><span id="l10.276" class="difflineplus">+    var field = this._element(aTextFieldId);</span>
<a href="#l10.277"></a><span id="l10.277" class="difflineplus">+    field.readOnly = aReadOnly !== undefined ? aReadOnly : this._readOnly;</span>
<a href="#l10.278"></a><span id="l10.278" class="difflineplus">+</span>
<a href="#l10.279"></a><span id="l10.279" class="difflineplus">+    if (field.value != aValue) {</span>
<a href="#l10.280"></a><span id="l10.280" class="difflineplus">+      field.value = aValue;</span>
<a href="#l10.281"></a><span id="l10.281" class="difflineplus">+</span>
<a href="#l10.282"></a><span id="l10.282" class="difflineplus">+      // clear the undo stack</span>
<a href="#l10.283"></a><span id="l10.283" class="difflineplus">+      var editor = field.editor;</span>
<a href="#l10.284"></a><span id="l10.284" class="difflineplus">+      if (editor)</span>
<a href="#l10.285"></a><span id="l10.285" class="difflineplus">+        editor.transactionManager.clear();</span>
<a href="#l10.286"></a><span id="l10.286" class="difflineplus">+    }</span>
<a href="#l10.287"></a><span id="l10.287" class="difflineplus">+  },</span>
<a href="#l10.288"></a><span id="l10.288" class="difflineplus">+</span>
<a href="#l10.289"></a><span id="l10.289" class="difflineplus">+  /**</span>
<a href="#l10.290"></a><span id="l10.290" class="difflineplus">+   * Appends a menu-item representing a bookmarks folder to a menu-popup.</span>
<a href="#l10.291"></a><span id="l10.291" class="difflineplus">+   * @param aMenupopup</span>
<a href="#l10.292"></a><span id="l10.292" class="difflineplus">+   *        The popup to which the menu-item should be added.</span>
<a href="#l10.293"></a><span id="l10.293" class="difflineplus">+   * @param aFolderId</span>
<a href="#l10.294"></a><span id="l10.294" class="difflineplus">+   *        The identifier of the bookmarks folder.</span>
<a href="#l10.295"></a><span id="l10.295" class="difflineplus">+   * @return the new menu item.</span>
<a href="#l10.296"></a><span id="l10.296" class="difflineplus">+   */</span>
<a href="#l10.297"></a><span id="l10.297" class="difflineplus">+  _appendFolderItemToMenupopup:</span>
<a href="#l10.298"></a><span id="l10.298" class="difflineplus">+  function EIO__appendFolderItemToMenuList(aMenupopup, aFolderId) {</span>
<a href="#l10.299"></a><span id="l10.299" class="difflineplus">+    // First make sure the folders-separator is visible</span>
<a href="#l10.300"></a><span id="l10.300" class="difflineplus">+    this._element(&quot;foldersSeparator&quot;).hidden = false;</span>
<a href="#l10.301"></a><span id="l10.301" class="difflineplus">+</span>
<a href="#l10.302"></a><span id="l10.302" class="difflineplus">+    var folderMenuItem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l10.303"></a><span id="l10.303" class="difflineplus">+    var folderTitle = PlacesUtils.bookmarks.getItemTitle(aFolderId)</span>
<a href="#l10.304"></a><span id="l10.304" class="difflineplus">+    folderMenuItem.folderId = aFolderId;</span>
<a href="#l10.305"></a><span id="l10.305" class="difflineplus">+    folderMenuItem.setAttribute(&quot;label&quot;, folderTitle);</span>
<a href="#l10.306"></a><span id="l10.306" class="difflineplus">+    folderMenuItem.className = &quot;menuitem-iconic folder-icon&quot;;</span>
<a href="#l10.307"></a><span id="l10.307" class="difflineplus">+    aMenupopup.appendChild(folderMenuItem);</span>
<a href="#l10.308"></a><span id="l10.308" class="difflineplus">+    return folderMenuItem;</span>
<a href="#l10.309"></a><span id="l10.309" class="difflineplus">+  },</span>
<a href="#l10.310"></a><span id="l10.310" class="difflineplus">+</span>
<a href="#l10.311"></a><span id="l10.311" class="difflineplus">+  _initFolderMenuList: function EIO__initFolderMenuList(aSelectedFolder) {</span>
<a href="#l10.312"></a><span id="l10.312" class="difflineplus">+    // clean up first</span>
<a href="#l10.313"></a><span id="l10.313" class="difflineplus">+    var menupopup = this._folderMenuList.menupopup;</span>
<a href="#l10.314"></a><span id="l10.314" class="difflineplus">+    while (menupopup.childNodes.length &gt; 6)</span>
<a href="#l10.315"></a><span id="l10.315" class="difflineplus">+      menupopup.removeChild(menupopup.lastChild);</span>
<a href="#l10.316"></a><span id="l10.316" class="difflineplus">+</span>
<a href="#l10.317"></a><span id="l10.317" class="difflineplus">+    const bms = PlacesUtils.bookmarks;</span>
<a href="#l10.318"></a><span id="l10.318" class="difflineplus">+    const annos = PlacesUtils.annotations;</span>
<a href="#l10.319"></a><span id="l10.319" class="difflineplus">+</span>
<a href="#l10.320"></a><span id="l10.320" class="difflineplus">+    // Build the static list</span>
<a href="#l10.321"></a><span id="l10.321" class="difflineplus">+    var unfiledItem = this._element(&quot;unfiledRootItem&quot;);</span>
<a href="#l10.322"></a><span id="l10.322" class="difflineplus">+    if (!this._staticFoldersListBuilt) {</span>
<a href="#l10.323"></a><span id="l10.323" class="difflineplus">+      unfiledItem.label = bms.getItemTitle(PlacesUtils.unfiledBookmarksFolderId);</span>
<a href="#l10.324"></a><span id="l10.324" class="difflineplus">+      unfiledItem.folderId = PlacesUtils.unfiledBookmarksFolderId;</span>
<a href="#l10.325"></a><span id="l10.325" class="difflineplus">+      var bmMenuItem = this._element(&quot;bmRootItem&quot;);</span>
<a href="#l10.326"></a><span id="l10.326" class="difflineplus">+      bmMenuItem.label = bms.getItemTitle(PlacesUtils.bookmarksMenuFolderId);</span>
<a href="#l10.327"></a><span id="l10.327" class="difflineplus">+      bmMenuItem.folderId = PlacesUtils.bookmarksMenuFolderId;</span>
<a href="#l10.328"></a><span id="l10.328" class="difflineplus">+      var toolbarItem = this._element(&quot;toolbarFolderItem&quot;);</span>
<a href="#l10.329"></a><span id="l10.329" class="difflineplus">+      toolbarItem.label = bms.getItemTitle(PlacesUtils.toolbarFolderId);</span>
<a href="#l10.330"></a><span id="l10.330" class="difflineplus">+      toolbarItem.folderId = PlacesUtils.toolbarFolderId;</span>
<a href="#l10.331"></a><span id="l10.331" class="difflineplus">+      this._staticFoldersListBuilt = true;</span>
<a href="#l10.332"></a><span id="l10.332" class="difflineplus">+    }</span>
<a href="#l10.333"></a><span id="l10.333" class="difflineplus">+</span>
<a href="#l10.334"></a><span id="l10.334" class="difflineplus">+    // List of recently used folders:</span>
<a href="#l10.335"></a><span id="l10.335" class="difflineplus">+    var folderIds = annos.getItemsWithAnnotation(LAST_USED_ANNO);</span>
<a href="#l10.336"></a><span id="l10.336" class="difflineplus">+</span>
<a href="#l10.337"></a><span id="l10.337" class="difflineplus">+    /**</span>
<a href="#l10.338"></a><span id="l10.338" class="difflineplus">+     * The value of the LAST_USED_ANNO annotation is the time (in the form of</span>
<a href="#l10.339"></a><span id="l10.339" class="difflineplus">+     * Date.getTime) at which the folder has been last used.</span>
<a href="#l10.340"></a><span id="l10.340" class="difflineplus">+     *</span>
<a href="#l10.341"></a><span id="l10.341" class="difflineplus">+     * First we build the annotated folders array, each item has both the</span>
<a href="#l10.342"></a><span id="l10.342" class="difflineplus">+     * folder identifier and the time at which it was last-used by this dialog</span>
<a href="#l10.343"></a><span id="l10.343" class="difflineplus">+     * set. Then we sort it descendingly based on the time field.</span>
<a href="#l10.344"></a><span id="l10.344" class="difflineplus">+     */</span>
<a href="#l10.345"></a><span id="l10.345" class="difflineplus">+    this._recentFolders = [];</span>
<a href="#l10.346"></a><span id="l10.346" class="difflineplus">+    for (var i = 0; i &lt; folderIds.length; i++) {</span>
<a href="#l10.347"></a><span id="l10.347" class="difflineplus">+      var lastUsed = annos.getItemAnnotation(folderIds[i], LAST_USED_ANNO);</span>
<a href="#l10.348"></a><span id="l10.348" class="difflineplus">+      this._recentFolders.push({ folderId: folderIds[i], lastUsed: lastUsed });</span>
<a href="#l10.349"></a><span id="l10.349" class="difflineplus">+    }</span>
<a href="#l10.350"></a><span id="l10.350" class="difflineplus">+    this._recentFolders.sort(function(a, b) {</span>
<a href="#l10.351"></a><span id="l10.351" class="difflineplus">+      if (b.lastUsed &lt; a.lastUsed)</span>
<a href="#l10.352"></a><span id="l10.352" class="difflineplus">+        return -1;</span>
<a href="#l10.353"></a><span id="l10.353" class="difflineplus">+      if (b.lastUsed &gt; a.lastUsed)</span>
<a href="#l10.354"></a><span id="l10.354" class="difflineplus">+        return 1;</span>
<a href="#l10.355"></a><span id="l10.355" class="difflineplus">+      return 0;</span>
<a href="#l10.356"></a><span id="l10.356" class="difflineplus">+    });</span>
<a href="#l10.357"></a><span id="l10.357" class="difflineplus">+</span>
<a href="#l10.358"></a><span id="l10.358" class="difflineplus">+    var numberOfItems = Math.min(MAX_FOLDER_ITEM_IN_MENU_LIST,</span>
<a href="#l10.359"></a><span id="l10.359" class="difflineplus">+                                 this._recentFolders.length);</span>
<a href="#l10.360"></a><span id="l10.360" class="difflineplus">+    for (var i = 0; i &lt; numberOfItems; i++) {</span>
<a href="#l10.361"></a><span id="l10.361" class="difflineplus">+      this._appendFolderItemToMenupopup(menupopup,</span>
<a href="#l10.362"></a><span id="l10.362" class="difflineplus">+                                        this._recentFolders[i].folderId);</span>
<a href="#l10.363"></a><span id="l10.363" class="difflineplus">+    }</span>
<a href="#l10.364"></a><span id="l10.364" class="difflineplus">+</span>
<a href="#l10.365"></a><span id="l10.365" class="difflineplus">+    var defaultItem = this._getFolderMenuItem(aSelectedFolder);</span>
<a href="#l10.366"></a><span id="l10.366" class="difflineplus">+    this._folderMenuList.selectedItem = defaultItem;</span>
<a href="#l10.367"></a><span id="l10.367" class="difflineplus">+</span>
<a href="#l10.368"></a><span id="l10.368" class="difflineplus">+    // Set a selectedIndex attribute to show special icons</span>
<a href="#l10.369"></a><span id="l10.369" class="difflineplus">+    this._folderMenuList.setAttribute(&quot;selectedIndex&quot;,</span>
<a href="#l10.370"></a><span id="l10.370" class="difflineplus">+                                      this._folderMenuList.selectedIndex);</span>
<a href="#l10.371"></a><span id="l10.371" class="difflineplus">+</span>
<a href="#l10.372"></a><span id="l10.372" class="difflineplus">+    // Hide the folders-separator if no folder is annotated as recently-used</span>
<a href="#l10.373"></a><span id="l10.373" class="difflineplus">+    this._element(&quot;foldersSeparator&quot;).hidden = (menupopup.childNodes.length &lt;= 6);</span>
<a href="#l10.374"></a><span id="l10.374" class="difflineplus">+    this._folderMenuList.disabled = this._readOnly;</span>
<a href="#l10.375"></a><span id="l10.375" class="difflineplus">+  },</span>
<a href="#l10.376"></a><span id="l10.376" class="difflineplus">+</span>
<a href="#l10.377"></a><span id="l10.377" class="difflineplus">+  QueryInterface: function EIO_QueryInterface(aIID) {</span>
<a href="#l10.378"></a><span id="l10.378" class="difflineplus">+    if (aIID.equals(Components.interfaces.nsIMicrosummaryObserver) ||</span>
<a href="#l10.379"></a><span id="l10.379" class="difflineplus">+        aIID.equals(Components.interfaces.nsIDOMEventListener) ||</span>
<a href="#l10.380"></a><span id="l10.380" class="difflineplus">+        aIID.equals(Components.interfaces.nsINavBookmarkObserver) ||</span>
<a href="#l10.381"></a><span id="l10.381" class="difflineplus">+        aIID.equals(Components.interfaces.nsISupports))</span>
<a href="#l10.382"></a><span id="l10.382" class="difflineplus">+      return this;</span>
<a href="#l10.383"></a><span id="l10.383" class="difflineplus">+</span>
<a href="#l10.384"></a><span id="l10.384" class="difflineplus">+    throw Components.results.NS_ERROR_NO_INTERFACE;</span>
<a href="#l10.385"></a><span id="l10.385" class="difflineplus">+  },</span>
<a href="#l10.386"></a><span id="l10.386" class="difflineplus">+</span>
<a href="#l10.387"></a><span id="l10.387" class="difflineplus">+  _element: function EIO__element(aID) {</span>
<a href="#l10.388"></a><span id="l10.388" class="difflineplus">+    return document.getElementById(&quot;editBMPanel_&quot; + aID);</span>
<a href="#l10.389"></a><span id="l10.389" class="difflineplus">+  },</span>
<a href="#l10.390"></a><span id="l10.390" class="difflineplus">+</span>
<a href="#l10.391"></a><span id="l10.391" class="difflineplus">+  _createMicrosummaryMenuItem:</span>
<a href="#l10.392"></a><span id="l10.392" class="difflineplus">+  function EIO__createMicrosummaryMenuItem(aMicrosummary) {</span>
<a href="#l10.393"></a><span id="l10.393" class="difflineplus">+    var menuItem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l10.394"></a><span id="l10.394" class="difflineplus">+</span>
<a href="#l10.395"></a><span id="l10.395" class="difflineplus">+    // Store a reference to the microsummary in the menu item, so we know</span>
<a href="#l10.396"></a><span id="l10.396" class="difflineplus">+    // which microsummary this menu item represents when it's time to</span>
<a href="#l10.397"></a><span id="l10.397" class="difflineplus">+    // save changes or load its content.</span>
<a href="#l10.398"></a><span id="l10.398" class="difflineplus">+    menuItem.microsummary = aMicrosummary;</span>
<a href="#l10.399"></a><span id="l10.399" class="difflineplus">+</span>
<a href="#l10.400"></a><span id="l10.400" class="difflineplus">+    // Content may have to be generated asynchronously; we don't necessarily</span>
<a href="#l10.401"></a><span id="l10.401" class="difflineplus">+    // have it now.  If we do, great; otherwise, fall back to the generator</span>
<a href="#l10.402"></a><span id="l10.402" class="difflineplus">+    // name, then the URI, and we trigger a microsummary content update. Once</span>
<a href="#l10.403"></a><span id="l10.403" class="difflineplus">+    // the update completes, the microsummary will notify our observer to</span>
<a href="#l10.404"></a><span id="l10.404" class="difflineplus">+    // update the corresponding menu-item.</span>
<a href="#l10.405"></a><span id="l10.405" class="difflineplus">+    // XXX Instead of just showing the generator name or (heaven forbid)</span>
<a href="#l10.406"></a><span id="l10.406" class="difflineplus">+    // its URI when we don't have content, we should tell the user that</span>
<a href="#l10.407"></a><span id="l10.407" class="difflineplus">+    // we're loading the microsummary, perhaps with some throbbing to let</span>
<a href="#l10.408"></a><span id="l10.408" class="difflineplus">+    // her know it is in progress.</span>
<a href="#l10.409"></a><span id="l10.409" class="difflineplus">+    if (aMicrosummary.content)</span>
<a href="#l10.410"></a><span id="l10.410" class="difflineplus">+      menuItem.setAttribute(&quot;label&quot;, aMicrosummary.content);</span>
<a href="#l10.411"></a><span id="l10.411" class="difflineplus">+    else {</span>
<a href="#l10.412"></a><span id="l10.412" class="difflineplus">+      menuItem.setAttribute(&quot;label&quot;, aMicrosummary.generator.name ||</span>
<a href="#l10.413"></a><span id="l10.413" class="difflineplus">+                                     aMicrosummary.generator.uri.spec);</span>
<a href="#l10.414"></a><span id="l10.414" class="difflineplus">+      aMicrosummary.update();</span>
<a href="#l10.415"></a><span id="l10.415" class="difflineplus">+    }</span>
<a href="#l10.416"></a><span id="l10.416" class="difflineplus">+</span>
<a href="#l10.417"></a><span id="l10.417" class="difflineplus">+    return menuItem;</span>
<a href="#l10.418"></a><span id="l10.418" class="difflineplus">+  },</span>
<a href="#l10.419"></a><span id="l10.419" class="difflineplus">+</span>
<a href="#l10.420"></a><span id="l10.420" class="difflineplus">+  _getItemStaticTitle: function EIO__getItemStaticTitle() {</span>
<a href="#l10.421"></a><span id="l10.421" class="difflineplus">+    if (this._itemId == -1)</span>
<a href="#l10.422"></a><span id="l10.422" class="difflineplus">+      return PlacesUtils.history.getPageTitle(this._uri);</span>
<a href="#l10.423"></a><span id="l10.423" class="difflineplus">+</span>
<a href="#l10.424"></a><span id="l10.424" class="difflineplus">+    const annos = PlacesUtils.annotations;</span>
<a href="#l10.425"></a><span id="l10.425" class="difflineplus">+    if (annos.itemHasAnnotation(this._itemId, STATIC_TITLE_ANNO))</span>
<a href="#l10.426"></a><span id="l10.426" class="difflineplus">+      return annos.getItemAnnotation(this._itemId, STATIC_TITLE_ANNO);</span>
<a href="#l10.427"></a><span id="l10.427" class="difflineplus">+</span>
<a href="#l10.428"></a><span id="l10.428" class="difflineplus">+    return PlacesUtils.bookmarks.getItemTitle(this._itemId);</span>
<a href="#l10.429"></a><span id="l10.429" class="difflineplus">+  },</span>
<a href="#l10.430"></a><span id="l10.430" class="difflineplus">+</span>
<a href="#l10.431"></a><span id="l10.431" class="difflineplus">+  _initNamePicker: function EIO_initNamePicker() {</span>
<a href="#l10.432"></a><span id="l10.432" class="difflineplus">+    var userEnteredNameField = this._element(&quot;userEnteredName&quot;);</span>
<a href="#l10.433"></a><span id="l10.433" class="difflineplus">+    var namePicker = this._element(&quot;namePicker&quot;);</span>
<a href="#l10.434"></a><span id="l10.434" class="difflineplus">+    var droppable = false;</span>
<a href="#l10.435"></a><span id="l10.435" class="difflineplus">+</span>
<a href="#l10.436"></a><span id="l10.436" class="difflineplus">+    userEnteredNameField.label = this._getItemStaticTitle();</span>
<a href="#l10.437"></a><span id="l10.437" class="difflineplus">+</span>
<a href="#l10.438"></a><span id="l10.438" class="difflineplus">+    // clean up old entries</span>
<a href="#l10.439"></a><span id="l10.439" class="difflineplus">+    var menupopup = namePicker.menupopup;</span>
<a href="#l10.440"></a><span id="l10.440" class="difflineplus">+    while (menupopup.childNodes.length &gt; 2)</span>
<a href="#l10.441"></a><span id="l10.441" class="difflineplus">+      menupopup.removeChild(menupopup.lastChild);</span>
<a href="#l10.442"></a><span id="l10.442" class="difflineplus">+</span>
<a href="#l10.443"></a><span id="l10.443" class="difflineplus">+    if (this._microsummaries) {</span>
<a href="#l10.444"></a><span id="l10.444" class="difflineplus">+      this._microsummaries.removeObserver(this);</span>
<a href="#l10.445"></a><span id="l10.445" class="difflineplus">+      this._microsummaries = null;</span>
<a href="#l10.446"></a><span id="l10.446" class="difflineplus">+    }</span>
<a href="#l10.447"></a><span id="l10.447" class="difflineplus">+</span>
<a href="#l10.448"></a><span id="l10.448" class="difflineplus">+    var itemToSelect = userEnteredNameField;</span>
<a href="#l10.449"></a><span id="l10.449" class="difflineplus">+    try {</span>
<a href="#l10.450"></a><span id="l10.450" class="difflineplus">+      if (this._itemId != -1 &amp;&amp;</span>
<a href="#l10.451"></a><span id="l10.451" class="difflineplus">+          this._itemType == Components.interfaces.nsINavBookmarksService.TYPE_BOOKMARK &amp;&amp;</span>
<a href="#l10.452"></a><span id="l10.452" class="difflineplus">+          !this._readOnly)</span>
<a href="#l10.453"></a><span id="l10.453" class="difflineplus">+        this._microsummaries = PlacesUtils.microsummaries</span>
<a href="#l10.454"></a><span id="l10.454" class="difflineplus">+                                          .getMicrosummaries(this._uri, -1);</span>
<a href="#l10.455"></a><span id="l10.455" class="difflineplus">+    }</span>
<a href="#l10.456"></a><span id="l10.456" class="difflineplus">+    catch(ex) {</span>
<a href="#l10.457"></a><span id="l10.457" class="difflineplus">+      // getMicrosummaries will throw an exception in at least two cases:</span>
<a href="#l10.458"></a><span id="l10.458" class="difflineplus">+      // 1. the bookmarked URI contains a scheme that the service won't</span>
<a href="#l10.459"></a><span id="l10.459" class="difflineplus">+      //    download for security reasons (currently it only handles http,</span>
<a href="#l10.460"></a><span id="l10.460" class="difflineplus">+      //    https, and file);</span>
<a href="#l10.461"></a><span id="l10.461" class="difflineplus">+      // 2. the page to which the URI refers isn't HTML or XML (the only two</span>
<a href="#l10.462"></a><span id="l10.462" class="difflineplus">+      //    content types the service knows how to summarize).</span>
<a href="#l10.463"></a><span id="l10.463" class="difflineplus">+      this._microsummaries = null;</span>
<a href="#l10.464"></a><span id="l10.464" class="difflineplus">+    }</span>
<a href="#l10.465"></a><span id="l10.465" class="difflineplus">+    if (this._microsummaries) {</span>
<a href="#l10.466"></a><span id="l10.466" class="difflineplus">+      var enumerator = this._microsummaries.Enumerate();</span>
<a href="#l10.467"></a><span id="l10.467" class="difflineplus">+</span>
<a href="#l10.468"></a><span id="l10.468" class="difflineplus">+      if (enumerator.hasMoreElements()) {</span>
<a href="#l10.469"></a><span id="l10.469" class="difflineplus">+        // Show the drop marker if there are microsummaries</span>
<a href="#l10.470"></a><span id="l10.470" class="difflineplus">+        droppable = true;</span>
<a href="#l10.471"></a><span id="l10.471" class="difflineplus">+        while (enumerator.hasMoreElements()) {</span>
<a href="#l10.472"></a><span id="l10.472" class="difflineplus">+          var microsummary = enumerator.getNext()</span>
<a href="#l10.473"></a><span id="l10.473" class="difflineplus">+                                       .QueryInterface(Components.interfaces.nsIMicrosummary);</span>
<a href="#l10.474"></a><span id="l10.474" class="difflineplus">+          var menuItem = this._createMicrosummaryMenuItem(microsummary);</span>
<a href="#l10.475"></a><span id="l10.475" class="difflineplus">+          if (PlacesUtils.microsummaries</span>
<a href="#l10.476"></a><span id="l10.476" class="difflineplus">+                         .isMicrosummary(this._itemId, microsummary))</span>
<a href="#l10.477"></a><span id="l10.477" class="difflineplus">+            itemToSelect = menuItem;</span>
<a href="#l10.478"></a><span id="l10.478" class="difflineplus">+</span>
<a href="#l10.479"></a><span id="l10.479" class="difflineplus">+          menupopup.appendChild(menuItem);</span>
<a href="#l10.480"></a><span id="l10.480" class="difflineplus">+        }</span>
<a href="#l10.481"></a><span id="l10.481" class="difflineplus">+      }</span>
<a href="#l10.482"></a><span id="l10.482" class="difflineplus">+</span>
<a href="#l10.483"></a><span id="l10.483" class="difflineplus">+      this._microsummaries.addObserver(this);</span>
<a href="#l10.484"></a><span id="l10.484" class="difflineplus">+    }</span>
<a href="#l10.485"></a><span id="l10.485" class="difflineplus">+</span>
<a href="#l10.486"></a><span id="l10.486" class="difflineplus">+    if (namePicker.selectedItem == itemToSelect)</span>
<a href="#l10.487"></a><span id="l10.487" class="difflineplus">+      namePicker.value = itemToSelect.label;</span>
<a href="#l10.488"></a><span id="l10.488" class="difflineplus">+    else</span>
<a href="#l10.489"></a><span id="l10.489" class="difflineplus">+      namePicker.selectedItem = itemToSelect;</span>
<a href="#l10.490"></a><span id="l10.490" class="difflineplus">+</span>
<a href="#l10.491"></a><span id="l10.491" class="difflineplus">+    namePicker.setAttribute(&quot;droppable&quot;, droppable);</span>
<a href="#l10.492"></a><span id="l10.492" class="difflineplus">+    namePicker.readOnly = this._readOnly;</span>
<a href="#l10.493"></a><span id="l10.493" class="difflineplus">+</span>
<a href="#l10.494"></a><span id="l10.494" class="difflineplus">+    // clear the undo stack</span>
<a href="#l10.495"></a><span id="l10.495" class="difflineplus">+    var editor = namePicker.editor;</span>
<a href="#l10.496"></a><span id="l10.496" class="difflineplus">+    if (editor)</span>
<a href="#l10.497"></a><span id="l10.497" class="difflineplus">+      editor.transactionManager.clear();</span>
<a href="#l10.498"></a><span id="l10.498" class="difflineplus">+  },</span>
<a href="#l10.499"></a><span id="l10.499" class="difflineplus">+</span>
<a href="#l10.500"></a><span id="l10.500" class="difflineplus">+  // nsIMicrosummaryObserver</span>
<a href="#l10.501"></a><span id="l10.501" class="difflineplus">+  onContentLoaded: function EIO_onContentLoaded(aMicrosummary) {</span>
<a href="#l10.502"></a><span id="l10.502" class="difflineplus">+    var namePicker = this._element(&quot;namePicker&quot;);</span>
<a href="#l10.503"></a><span id="l10.503" class="difflineplus">+    var childNodes = namePicker.menupopup.childNodes;</span>
<a href="#l10.504"></a><span id="l10.504" class="difflineplus">+</span>
<a href="#l10.505"></a><span id="l10.505" class="difflineplus">+    // 0: user-entered item; 1: separator</span>
<a href="#l10.506"></a><span id="l10.506" class="difflineplus">+    for (var i = 2; i &lt; childNodes.length; i++) {</span>
<a href="#l10.507"></a><span id="l10.507" class="difflineplus">+      if (childNodes[i].microsummary == aMicrosummary) {</span>
<a href="#l10.508"></a><span id="l10.508" class="difflineplus">+        var newLabel = aMicrosummary.content;</span>
<a href="#l10.509"></a><span id="l10.509" class="difflineplus">+        // XXXmano: non-editable menulist would do this for us, see bug 360220</span>
<a href="#l10.510"></a><span id="l10.510" class="difflineplus">+        // We should fix editable-menulists to set the DOMAttrModified handler</span>
<a href="#l10.511"></a><span id="l10.511" class="difflineplus">+        // as well.</span>
<a href="#l10.512"></a><span id="l10.512" class="difflineplus">+        //</span>
<a href="#l10.513"></a><span id="l10.513" class="difflineplus">+        // Also note the order importance: if the label of the menu-item is</span>
<a href="#l10.514"></a><span id="l10.514" class="difflineplus">+        // set to something different than the menulist's current value,</span>
<a href="#l10.515"></a><span id="l10.515" class="difflineplus">+        // the menulist no longer has selectedItem set</span>
<a href="#l10.516"></a><span id="l10.516" class="difflineplus">+        if (namePicker.selectedItem == childNodes[i])</span>
<a href="#l10.517"></a><span id="l10.517" class="difflineplus">+          namePicker.value = newLabel;</span>
<a href="#l10.518"></a><span id="l10.518" class="difflineplus">+</span>
<a href="#l10.519"></a><span id="l10.519" class="difflineplus">+        childNodes[i].label = newLabel;</span>
<a href="#l10.520"></a><span id="l10.520" class="difflineplus">+        return;</span>
<a href="#l10.521"></a><span id="l10.521" class="difflineplus">+      }</span>
<a href="#l10.522"></a><span id="l10.522" class="difflineplus">+    }</span>
<a href="#l10.523"></a><span id="l10.523" class="difflineplus">+  },</span>
<a href="#l10.524"></a><span id="l10.524" class="difflineplus">+</span>
<a href="#l10.525"></a><span id="l10.525" class="difflineplus">+  onElementAppended: function EIO_onElementAppended(aMicrosummary) {</span>
<a href="#l10.526"></a><span id="l10.526" class="difflineplus">+    var namePicker = this._element(&quot;namePicker&quot;);</span>
<a href="#l10.527"></a><span id="l10.527" class="difflineplus">+    namePicker.menupopup</span>
<a href="#l10.528"></a><span id="l10.528" class="difflineplus">+              .appendChild(this._createMicrosummaryMenuItem(aMicrosummary));</span>
<a href="#l10.529"></a><span id="l10.529" class="difflineplus">+</span>
<a href="#l10.530"></a><span id="l10.530" class="difflineplus">+    // Make sure the drop-marker is shown</span>
<a href="#l10.531"></a><span id="l10.531" class="difflineplus">+    namePicker.setAttribute(&quot;droppable&quot;, &quot;true&quot;);</span>
<a href="#l10.532"></a><span id="l10.532" class="difflineplus">+  },</span>
<a href="#l10.533"></a><span id="l10.533" class="difflineplus">+</span>
<a href="#l10.534"></a><span id="l10.534" class="difflineplus">+  uninitPanel: function EIO_uninitPanel(aHideCollapsibleElements) {</span>
<a href="#l10.535"></a><span id="l10.535" class="difflineplus">+    if (aHideCollapsibleElements) {</span>
<a href="#l10.536"></a><span id="l10.536" class="difflineplus">+      // hide the folder tree if it was previously visible</span>
<a href="#l10.537"></a><span id="l10.537" class="difflineplus">+      var folderTreeRow = this._element(&quot;folderTreeRow&quot;);</span>
<a href="#l10.538"></a><span id="l10.538" class="difflineplus">+      if (!folderTreeRow.collapsed)</span>
<a href="#l10.539"></a><span id="l10.539" class="difflineplus">+        this.toggleFolderTreeVisibility();</span>
<a href="#l10.540"></a><span id="l10.540" class="difflineplus">+</span>
<a href="#l10.541"></a><span id="l10.541" class="difflineplus">+      // hide the tag selector if it was previously visible</span>
<a href="#l10.542"></a><span id="l10.542" class="difflineplus">+      var tagsSelectorRow = this._element(&quot;tagsSelectorRow&quot;);</span>
<a href="#l10.543"></a><span id="l10.543" class="difflineplus">+      if (!tagsSelectorRow.collapsed)</span>
<a href="#l10.544"></a><span id="l10.544" class="difflineplus">+        this.toggleTagsSelector();</span>
<a href="#l10.545"></a><span id="l10.545" class="difflineplus">+    }</span>
<a href="#l10.546"></a><span id="l10.546" class="difflineplus">+</span>
<a href="#l10.547"></a><span id="l10.547" class="difflineplus">+    if (this._observersAdded) {</span>
<a href="#l10.548"></a><span id="l10.548" class="difflineplus">+      if (this._itemId != -1)</span>
<a href="#l10.549"></a><span id="l10.549" class="difflineplus">+        PlacesUtils.bookmarks.removeObserver(this);</span>
<a href="#l10.550"></a><span id="l10.550" class="difflineplus">+</span>
<a href="#l10.551"></a><span id="l10.551" class="difflineplus">+      this._observersAdded = false;</span>
<a href="#l10.552"></a><span id="l10.552" class="difflineplus">+    }</span>
<a href="#l10.553"></a><span id="l10.553" class="difflineplus">+    if (this._microsummaries) {</span>
<a href="#l10.554"></a><span id="l10.554" class="difflineplus">+      this._microsummaries.removeObserver(this);</span>
<a href="#l10.555"></a><span id="l10.555" class="difflineplus">+      this._microsummaries = null;</span>
<a href="#l10.556"></a><span id="l10.556" class="difflineplus">+    }</span>
<a href="#l10.557"></a><span id="l10.557" class="difflineplus">+    this._itemId = -1;</span>
<a href="#l10.558"></a><span id="l10.558" class="difflineplus">+    this._uri = null;</span>
<a href="#l10.559"></a><span id="l10.559" class="difflineplus">+    this._uris = [];</span>
<a href="#l10.560"></a><span id="l10.560" class="difflineplus">+    this._tags = [];</span>
<a href="#l10.561"></a><span id="l10.561" class="difflineplus">+    this._allTags = [];</span>
<a href="#l10.562"></a><span id="l10.562" class="difflineplus">+    this._itemIds = [];</span>
<a href="#l10.563"></a><span id="l10.563" class="difflineplus">+    this._multiEdit = false;</span>
<a href="#l10.564"></a><span id="l10.564" class="difflineplus">+    this._firstEditedField = &quot;&quot;;</span>
<a href="#l10.565"></a><span id="l10.565" class="difflineplus">+    this._initialized = false;</span>
<a href="#l10.566"></a><span id="l10.566" class="difflineplus">+  },</span>
<a href="#l10.567"></a><span id="l10.567" class="difflineplus">+</span>
<a href="#l10.568"></a><span id="l10.568" class="difflineplus">+  onTagsFieldBlur: function EIO_onTagsFieldBlur() {</span>
<a href="#l10.569"></a><span id="l10.569" class="difflineplus">+    if (this._updateTags()) // if anything has changed</span>
<a href="#l10.570"></a><span id="l10.570" class="difflineplus">+      this._mayUpdateFirstEditField(&quot;tagsField&quot;);</span>
<a href="#l10.571"></a><span id="l10.571" class="difflineplus">+  },</span>
<a href="#l10.572"></a><span id="l10.572" class="difflineplus">+</span>
<a href="#l10.573"></a><span id="l10.573" class="difflineplus">+  _updateTags: function EIO__updateTags() {</span>
<a href="#l10.574"></a><span id="l10.574" class="difflineplus">+    if (this._multiEdit)</span>
<a href="#l10.575"></a><span id="l10.575" class="difflineplus">+      return this._updateMultipleTagsForItems();</span>
<a href="#l10.576"></a><span id="l10.576" class="difflineplus">+    return this._updateSingleTagForItem();</span>
<a href="#l10.577"></a><span id="l10.577" class="difflineplus">+  },</span>
<a href="#l10.578"></a><span id="l10.578" class="difflineplus">+</span>
<a href="#l10.579"></a><span id="l10.579" class="difflineplus">+  _updateSingleTagForItem: function EIO__updateSingleTagForItem() {</span>
<a href="#l10.580"></a><span id="l10.580" class="difflineplus">+    var currentTags = PlacesUtils.tagging.getTagsForURI(this._uri);</span>
<a href="#l10.581"></a><span id="l10.581" class="difflineplus">+    var tags = this._getTagsArrayFromTagField();</span>
<a href="#l10.582"></a><span id="l10.582" class="difflineplus">+    if (tags.length &gt; 0 || currentTags.length &gt; 0) {</span>
<a href="#l10.583"></a><span id="l10.583" class="difflineplus">+      var tagsToRemove = [];</span>
<a href="#l10.584"></a><span id="l10.584" class="difflineplus">+      var tagsToAdd = [];</span>
<a href="#l10.585"></a><span id="l10.585" class="difflineplus">+      var txns = []; </span>
<a href="#l10.586"></a><span id="l10.586" class="difflineplus">+      for (var i = 0; i &lt; currentTags.length; i++) {</span>
<a href="#l10.587"></a><span id="l10.587" class="difflineplus">+        if (tags.indexOf(currentTags[i]) == -1)</span>
<a href="#l10.588"></a><span id="l10.588" class="difflineplus">+          tagsToRemove.push(currentTags[i]);</span>
<a href="#l10.589"></a><span id="l10.589" class="difflineplus">+      }</span>
<a href="#l10.590"></a><span id="l10.590" class="difflineplus">+      for (var i = 0; i &lt; tags.length; i++) {</span>
<a href="#l10.591"></a><span id="l10.591" class="difflineplus">+        if (currentTags.indexOf(tags[i]) == -1)</span>
<a href="#l10.592"></a><span id="l10.592" class="difflineplus">+          tagsToAdd.push(tags[i]);</span>
<a href="#l10.593"></a><span id="l10.593" class="difflineplus">+      }</span>
<a href="#l10.594"></a><span id="l10.594" class="difflineplus">+</span>
<a href="#l10.595"></a><span id="l10.595" class="difflineplus">+      if (tagsToRemove.length &gt; 0)</span>
<a href="#l10.596"></a><span id="l10.596" class="difflineplus">+        txns.push(PlacesUIUtils.ptm.untagURI(this._uri, tagsToRemove));</span>
<a href="#l10.597"></a><span id="l10.597" class="difflineplus">+      if (tagsToAdd.length &gt; 0)</span>
<a href="#l10.598"></a><span id="l10.598" class="difflineplus">+        txns.push(PlacesUIUtils.ptm.tagURI(this._uri, tagsToAdd));</span>
<a href="#l10.599"></a><span id="l10.599" class="difflineplus">+</span>
<a href="#l10.600"></a><span id="l10.600" class="difflineplus">+      if (txns.length &gt; 0) {</span>
<a href="#l10.601"></a><span id="l10.601" class="difflineplus">+        var aggregate = PlacesUIUtils.ptm.aggregateTransactions(&quot;Update tags&quot;,</span>
<a href="#l10.602"></a><span id="l10.602" class="difflineplus">+                                                                txns);</span>
<a href="#l10.603"></a><span id="l10.603" class="difflineplus">+        PlacesUIUtils.ptm.doTransaction(aggregate);</span>
<a href="#l10.604"></a><span id="l10.604" class="difflineplus">+</span>
<a href="#l10.605"></a><span id="l10.605" class="difflineplus">+        // Ensure the tagsField is in sync, clean it up from empty tags</span>
<a href="#l10.606"></a><span id="l10.606" class="difflineplus">+        var tags = PlacesUtils.tagging.getTagsForURI(this._uri).join(&quot;, &quot;);</span>
<a href="#l10.607"></a><span id="l10.607" class="difflineplus">+        this._initTextField(&quot;tagsField&quot;, tags, false);</span>
<a href="#l10.608"></a><span id="l10.608" class="difflineplus">+        return true;</span>
<a href="#l10.609"></a><span id="l10.609" class="difflineplus">+      }</span>
<a href="#l10.610"></a><span id="l10.610" class="difflineplus">+    }</span>
<a href="#l10.611"></a><span id="l10.611" class="difflineplus">+    return false;</span>
<a href="#l10.612"></a><span id="l10.612" class="difflineplus">+  },</span>
<a href="#l10.613"></a><span id="l10.613" class="difflineplus">+</span>
<a href="#l10.614"></a><span id="l10.614" class="difflineplus">+   /**</span>
<a href="#l10.615"></a><span id="l10.615" class="difflineplus">+    * Stores the first-edit field for this dialog, if the passed-in field</span>
<a href="#l10.616"></a><span id="l10.616" class="difflineplus">+    * is indeed the first edited field</span>
<a href="#l10.617"></a><span id="l10.617" class="difflineplus">+    * @param aNewField</span>
<a href="#l10.618"></a><span id="l10.618" class="difflineplus">+    *        the id of the field that may be set (without the &quot;editBMPanel_&quot;</span>
<a href="#l10.619"></a><span id="l10.619" class="difflineplus">+    *        prefix)</span>
<a href="#l10.620"></a><span id="l10.620" class="difflineplus">+    */</span>
<a href="#l10.621"></a><span id="l10.621" class="difflineplus">+  _mayUpdateFirstEditField: function EIO__mayUpdateFirstEditField(aNewField) {</span>
<a href="#l10.622"></a><span id="l10.622" class="difflineplus">+    // * The first-edit-field behavior is not applied in the multi-edit case</span>
<a href="#l10.623"></a><span id="l10.623" class="difflineplus">+    // * if this._firstEditedField is already set, this is not the first field,</span>
<a href="#l10.624"></a><span id="l10.624" class="difflineplus">+    //   so there's nothing to do</span>
<a href="#l10.625"></a><span id="l10.625" class="difflineplus">+    if (this._multiEdit || this._firstEditedField)</span>
<a href="#l10.626"></a><span id="l10.626" class="difflineplus">+      return;</span>
<a href="#l10.627"></a><span id="l10.627" class="difflineplus">+</span>
<a href="#l10.628"></a><span id="l10.628" class="difflineplus">+    this._firstEditedField = aNewField;</span>
<a href="#l10.629"></a><span id="l10.629" class="difflineplus">+</span>
<a href="#l10.630"></a><span id="l10.630" class="difflineplus">+    // set the pref</span>
<a href="#l10.631"></a><span id="l10.631" class="difflineplus">+    var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].</span>
<a href="#l10.632"></a><span id="l10.632" class="difflineplus">+                getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l10.633"></a><span id="l10.633" class="difflineplus">+    prefs.setCharPref(&quot;browser.bookmarks.editDialog.firstEditField&quot;, aNewField);</span>
<a href="#l10.634"></a><span id="l10.634" class="difflineplus">+  },</span>
<a href="#l10.635"></a><span id="l10.635" class="difflineplus">+</span>
<a href="#l10.636"></a><span id="l10.636" class="difflineplus">+  _updateMultipleTagsForItems: function EIO__updateMultipleTagsForItems() {</span>
<a href="#l10.637"></a><span id="l10.637" class="difflineplus">+    var tags = this._getTagsArrayFromTagField();</span>
<a href="#l10.638"></a><span id="l10.638" class="difflineplus">+    if (tags.length &gt; 0 || this._allTags.length &gt; 0) {</span>
<a href="#l10.639"></a><span id="l10.639" class="difflineplus">+      var tagsToRemove = [];</span>
<a href="#l10.640"></a><span id="l10.640" class="difflineplus">+      var tagsToAdd = [];</span>
<a href="#l10.641"></a><span id="l10.641" class="difflineplus">+      var txns = []; </span>
<a href="#l10.642"></a><span id="l10.642" class="difflineplus">+      for (var i = 0; i &lt; this._allTags.length; i++) {</span>
<a href="#l10.643"></a><span id="l10.643" class="difflineplus">+        if (tags.indexOf(this._allTags[i]) == -1)</span>
<a href="#l10.644"></a><span id="l10.644" class="difflineplus">+          tagsToRemove.push(this._allTags[i]);</span>
<a href="#l10.645"></a><span id="l10.645" class="difflineplus">+      }</span>
<a href="#l10.646"></a><span id="l10.646" class="difflineplus">+      for (var i = 0; i &lt; this._tags.length; i++) {</span>
<a href="#l10.647"></a><span id="l10.647" class="difflineplus">+        tagsToAdd[i] = [];</span>
<a href="#l10.648"></a><span id="l10.648" class="difflineplus">+        for (var j = 0; j &lt; tags.length; j++) {</span>
<a href="#l10.649"></a><span id="l10.649" class="difflineplus">+          if (this._tags[i].indexOf(tags[j]) == -1)</span>
<a href="#l10.650"></a><span id="l10.650" class="difflineplus">+            tagsToAdd[i].push(tags[j]);</span>
<a href="#l10.651"></a><span id="l10.651" class="difflineplus">+        }</span>
<a href="#l10.652"></a><span id="l10.652" class="difflineplus">+      }</span>
<a href="#l10.653"></a><span id="l10.653" class="difflineplus">+</span>
<a href="#l10.654"></a><span id="l10.654" class="difflineplus">+      if (tagsToAdd.length &gt; 0) {</span>
<a href="#l10.655"></a><span id="l10.655" class="difflineplus">+        for (i = 0; i &lt; this._uris.length; i++) {</span>
<a href="#l10.656"></a><span id="l10.656" class="difflineplus">+          if (tagsToAdd[i].length &gt; 0)</span>
<a href="#l10.657"></a><span id="l10.657" class="difflineplus">+            txns.push(PlacesUIUtils.ptm.tagURI(this._uris[i], tagsToAdd[i]));</span>
<a href="#l10.658"></a><span id="l10.658" class="difflineplus">+        }</span>
<a href="#l10.659"></a><span id="l10.659" class="difflineplus">+      }</span>
<a href="#l10.660"></a><span id="l10.660" class="difflineplus">+      if (tagsToRemove.length &gt; 0) {</span>
<a href="#l10.661"></a><span id="l10.661" class="difflineplus">+        for (var i = 0; i &lt; this._uris.length; i++)</span>
<a href="#l10.662"></a><span id="l10.662" class="difflineplus">+          txns.push(PlacesUIUtils.ptm.untagURI(this._uris[i], tagsToRemove));</span>
<a href="#l10.663"></a><span id="l10.663" class="difflineplus">+      }</span>
<a href="#l10.664"></a><span id="l10.664" class="difflineplus">+</span>
<a href="#l10.665"></a><span id="l10.665" class="difflineplus">+      if (txns.length &gt; 0) {</span>
<a href="#l10.666"></a><span id="l10.666" class="difflineplus">+        var aggregate = PlacesUIUtils.ptm.aggregateTransactions(&quot;Update tags&quot;,</span>
<a href="#l10.667"></a><span id="l10.667" class="difflineplus">+                                                                txns);</span>
<a href="#l10.668"></a><span id="l10.668" class="difflineplus">+        PlacesUIUtils.ptm.doTransaction(aggregate);</span>
<a href="#l10.669"></a><span id="l10.669" class="difflineplus">+</span>
<a href="#l10.670"></a><span id="l10.670" class="difflineplus">+        this._allTags = tags;</span>
<a href="#l10.671"></a><span id="l10.671" class="difflineplus">+        this._tags = [];</span>
<a href="#l10.672"></a><span id="l10.672" class="difflineplus">+        for (i = 0; i &lt; this._uris.length; i++)</span>
<a href="#l10.673"></a><span id="l10.673" class="difflineplus">+          this._tags[i] = PlacesUtils.tagging.getTagsForURI(this._uris[i]);</span>
<a href="#l10.674"></a><span id="l10.674" class="difflineplus">+</span>
<a href="#l10.675"></a><span id="l10.675" class="difflineplus">+        // Ensure the tagsField is in sync, clean it up from empty tags</span>
<a href="#l10.676"></a><span id="l10.676" class="difflineplus">+        this._initTextField(&quot;tagsField&quot;, tags, false);</span>
<a href="#l10.677"></a><span id="l10.677" class="difflineplus">+        return true;</span>
<a href="#l10.678"></a><span id="l10.678" class="difflineplus">+      }</span>
<a href="#l10.679"></a><span id="l10.679" class="difflineplus">+    }</span>
<a href="#l10.680"></a><span id="l10.680" class="difflineplus">+    return false;</span>
<a href="#l10.681"></a><span id="l10.681" class="difflineplus">+  },</span>
<a href="#l10.682"></a><span id="l10.682" class="difflineplus">+</span>
<a href="#l10.683"></a><span id="l10.683" class="difflineplus">+  onNamePickerInput: function EIO_onNamePickerInput() {</span>
<a href="#l10.684"></a><span id="l10.684" class="difflineplus">+    var title = this._element(&quot;namePicker&quot;).value;</span>
<a href="#l10.685"></a><span id="l10.685" class="difflineplus">+    this._element(&quot;userEnteredName&quot;).label = title;</span>
<a href="#l10.686"></a><span id="l10.686" class="difflineplus">+  },</span>
<a href="#l10.687"></a><span id="l10.687" class="difflineplus">+</span>
<a href="#l10.688"></a><span id="l10.688" class="difflineplus">+  onNamePickerChange: function EIO_onNamePickerChange() {</span>
<a href="#l10.689"></a><span id="l10.689" class="difflineplus">+    if (this._itemId == -1)</span>
<a href="#l10.690"></a><span id="l10.690" class="difflineplus">+      return;</span>
<a href="#l10.691"></a><span id="l10.691" class="difflineplus">+</span>
<a href="#l10.692"></a><span id="l10.692" class="difflineplus">+    var namePicker = this._element(&quot;namePicker&quot;)</span>
<a href="#l10.693"></a><span id="l10.693" class="difflineplus">+    var txns = [];</span>
<a href="#l10.694"></a><span id="l10.694" class="difflineplus">+    const ptm = PlacesUIUtils.ptm;</span>
<a href="#l10.695"></a><span id="l10.695" class="difflineplus">+</span>
<a href="#l10.696"></a><span id="l10.696" class="difflineplus">+    // Here we update either the item title or its cached static title</span>
<a href="#l10.697"></a><span id="l10.697" class="difflineplus">+    var newTitle = this._element(&quot;userEnteredName&quot;).label;</span>
<a href="#l10.698"></a><span id="l10.698" class="difflineplus">+    if (this._getItemStaticTitle() != newTitle) {</span>
<a href="#l10.699"></a><span id="l10.699" class="difflineplus">+      this._mayUpdateFirstEditField(&quot;namePicker&quot;);</span>
<a href="#l10.700"></a><span id="l10.700" class="difflineplus">+      if (PlacesUtils.microsummaries.hasMicrosummary(this._itemId)) {</span>
<a href="#l10.701"></a><span id="l10.701" class="difflineplus">+        // Note: this implicitly also takes care of the microsummary-&gt;static</span>
<a href="#l10.702"></a><span id="l10.702" class="difflineplus">+        // title case, the removeMicorosummary method in the service will set</span>
<a href="#l10.703"></a><span id="l10.703" class="difflineplus">+        // the item-title to the value of this annotation.</span>
<a href="#l10.704"></a><span id="l10.704" class="difflineplus">+        //</span>
<a href="#l10.705"></a><span id="l10.705" class="difflineplus">+        // XXXmano: use a transaction</span>
<a href="#l10.706"></a><span id="l10.706" class="difflineplus">+        PlacesUtils.setAnnotationsForItem(this._itemId,</span>
<a href="#l10.707"></a><span id="l10.707" class="difflineplus">+                                          [{name: STATIC_TITLE_ANNO,</span>
<a href="#l10.708"></a><span id="l10.708" class="difflineplus">+                                            value: newTitle}]);</span>
<a href="#l10.709"></a><span id="l10.709" class="difflineplus">+      }</span>
<a href="#l10.710"></a><span id="l10.710" class="difflineplus">+      else</span>
<a href="#l10.711"></a><span id="l10.711" class="difflineplus">+        txns.push(ptm.editItemTitle(this._itemId, newTitle));</span>
<a href="#l10.712"></a><span id="l10.712" class="difflineplus">+    }</span>
<a href="#l10.713"></a><span id="l10.713" class="difflineplus">+</span>
<a href="#l10.714"></a><span id="l10.714" class="difflineplus">+    var newMicrosummary = namePicker.selectedItem.microsummary;</span>
<a href="#l10.715"></a><span id="l10.715" class="difflineplus">+</span>
<a href="#l10.716"></a><span id="l10.716" class="difflineplus">+    // Only add a microsummary update to the transaction if the microsummary</span>
<a href="#l10.717"></a><span id="l10.717" class="difflineplus">+    // has actually changed, i.e. the user selected no microsummary, but the</span>
<a href="#l10.718"></a><span id="l10.718" class="difflineplus">+    // bookmark previously had one, or the user selected a microsummary which</span>
<a href="#l10.719"></a><span id="l10.719" class="difflineplus">+    // is not the one the bookmark previously had</span>
<a href="#l10.720"></a><span id="l10.720" class="difflineplus">+    if ((newMicrosummary == null &amp;&amp;</span>
<a href="#l10.721"></a><span id="l10.721" class="difflineplus">+         PlacesUtils.microsummaries.hasMicrosummary(this._itemId)) ||</span>
<a href="#l10.722"></a><span id="l10.722" class="difflineplus">+        (newMicrosummary != null &amp;&amp;</span>
<a href="#l10.723"></a><span id="l10.723" class="difflineplus">+         !PlacesUtils.microsummaries</span>
<a href="#l10.724"></a><span id="l10.724" class="difflineplus">+                     .isMicrosummary(this._itemId, newMicrosummary))) {</span>
<a href="#l10.725"></a><span id="l10.725" class="difflineplus">+      txns.push(ptm.editBookmarkMicrosummary(this._itemId, newMicrosummary));</span>
<a href="#l10.726"></a><span id="l10.726" class="difflineplus">+    }</span>
<a href="#l10.727"></a><span id="l10.727" class="difflineplus">+</span>
<a href="#l10.728"></a><span id="l10.728" class="difflineplus">+    var aggregate = ptm.aggregateTransactions(&quot;Edit Item Title&quot;, txns);</span>
<a href="#l10.729"></a><span id="l10.729" class="difflineplus">+    ptm.doTransaction(aggregate);</span>
<a href="#l10.730"></a><span id="l10.730" class="difflineplus">+  },</span>
<a href="#l10.731"></a><span id="l10.731" class="difflineplus">+</span>
<a href="#l10.732"></a><span id="l10.732" class="difflineplus">+  onDescriptionFieldBlur: function EIO_onDescriptionFieldBlur() {</span>
<a href="#l10.733"></a><span id="l10.733" class="difflineplus">+    var description = this._element(&quot;descriptionField&quot;).value;</span>
<a href="#l10.734"></a><span id="l10.734" class="difflineplus">+    if (description != PlacesUIUtils.getItemDescription(this._itemId)) {</span>
<a href="#l10.735"></a><span id="l10.735" class="difflineplus">+      var txn = PlacesUIUtils.ptm</span>
<a href="#l10.736"></a><span id="l10.736" class="difflineplus">+                             .editItemDescription(this._itemId, description);</span>
<a href="#l10.737"></a><span id="l10.737" class="difflineplus">+      PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l10.738"></a><span id="l10.738" class="difflineplus">+    }</span>
<a href="#l10.739"></a><span id="l10.739" class="difflineplus">+  },</span>
<a href="#l10.740"></a><span id="l10.740" class="difflineplus">+</span>
<a href="#l10.741"></a><span id="l10.741" class="difflineplus">+  onLocationFieldBlur: function EIO_onLocationFieldBlur() {</span>
<a href="#l10.742"></a><span id="l10.742" class="difflineplus">+    var uri;</span>
<a href="#l10.743"></a><span id="l10.743" class="difflineplus">+    try {</span>
<a href="#l10.744"></a><span id="l10.744" class="difflineplus">+      uri = PlacesUIUtils.createFixedURI(this._element(&quot;locationField&quot;).value);</span>
<a href="#l10.745"></a><span id="l10.745" class="difflineplus">+    }</span>
<a href="#l10.746"></a><span id="l10.746" class="difflineplus">+    catch(ex) { return; }</span>
<a href="#l10.747"></a><span id="l10.747" class="difflineplus">+</span>
<a href="#l10.748"></a><span id="l10.748" class="difflineplus">+    if (!this._uri.equals(uri)) {</span>
<a href="#l10.749"></a><span id="l10.749" class="difflineplus">+      var txn = PlacesUIUtils.ptm.editBookmarkURI(this._itemId, uri);</span>
<a href="#l10.750"></a><span id="l10.750" class="difflineplus">+      PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l10.751"></a><span id="l10.751" class="difflineplus">+      this._uri = uri;</span>
<a href="#l10.752"></a><span id="l10.752" class="difflineplus">+    }</span>
<a href="#l10.753"></a><span id="l10.753" class="difflineplus">+  },</span>
<a href="#l10.754"></a><span id="l10.754" class="difflineplus">+</span>
<a href="#l10.755"></a><span id="l10.755" class="difflineplus">+  onKeywordFieldBlur: function EIO_onKeywordFieldBlur() {</span>
<a href="#l10.756"></a><span id="l10.756" class="difflineplus">+    var keyword = this._element(&quot;keywordField&quot;).value;</span>
<a href="#l10.757"></a><span id="l10.757" class="difflineplus">+    if (keyword != PlacesUtils.bookmarks.getKeywordForBookmark(this._itemId)) {</span>
<a href="#l10.758"></a><span id="l10.758" class="difflineplus">+      var txn = PlacesUIUtils.ptm.editBookmarkKeyword(this._itemId, keyword);</span>
<a href="#l10.759"></a><span id="l10.759" class="difflineplus">+      PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l10.760"></a><span id="l10.760" class="difflineplus">+    }</span>
<a href="#l10.761"></a><span id="l10.761" class="difflineplus">+  },</span>
<a href="#l10.762"></a><span id="l10.762" class="difflineplus">+</span>
<a href="#l10.763"></a><span id="l10.763" class="difflineplus">+  onFeedLocationFieldBlur: function EIO_onFeedLocationFieldBlur() {</span>
<a href="#l10.764"></a><span id="l10.764" class="difflineplus">+    var uri;</span>
<a href="#l10.765"></a><span id="l10.765" class="difflineplus">+    try {</span>
<a href="#l10.766"></a><span id="l10.766" class="difflineplus">+      uri = PlacesUIUtils.createFixedURI(this._element(&quot;feedLocationField&quot;).value);</span>
<a href="#l10.767"></a><span id="l10.767" class="difflineplus">+    }</span>
<a href="#l10.768"></a><span id="l10.768" class="difflineplus">+    catch(ex) { return; }</span>
<a href="#l10.769"></a><span id="l10.769" class="difflineplus">+</span>
<a href="#l10.770"></a><span id="l10.770" class="difflineplus">+    var currentFeedURI = PlacesUtils.livemarks.getFeedURI(this._itemId);</span>
<a href="#l10.771"></a><span id="l10.771" class="difflineplus">+    if (!currentFeedURI.equals(uri)) {</span>
<a href="#l10.772"></a><span id="l10.772" class="difflineplus">+      var txn = PlacesUIUtils.ptm.editLivemarkFeedURI(this._itemId, uri);</span>
<a href="#l10.773"></a><span id="l10.773" class="difflineplus">+      PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l10.774"></a><span id="l10.774" class="difflineplus">+    }</span>
<a href="#l10.775"></a><span id="l10.775" class="difflineplus">+  },</span>
<a href="#l10.776"></a><span id="l10.776" class="difflineplus">+</span>
<a href="#l10.777"></a><span id="l10.777" class="difflineplus">+  onSiteLocationFieldBlur: function EIO_onSiteLocationFieldBlur() {</span>
<a href="#l10.778"></a><span id="l10.778" class="difflineplus">+    var uri = null;</span>
<a href="#l10.779"></a><span id="l10.779" class="difflineplus">+    try {</span>
<a href="#l10.780"></a><span id="l10.780" class="difflineplus">+      uri = PlacesUIUtils.createFixedURI(this._element(&quot;siteLocationField&quot;).value);</span>
<a href="#l10.781"></a><span id="l10.781" class="difflineplus">+    }</span>
<a href="#l10.782"></a><span id="l10.782" class="difflineplus">+    catch(ex) {  }</span>
<a href="#l10.783"></a><span id="l10.783" class="difflineplus">+</span>
<a href="#l10.784"></a><span id="l10.784" class="difflineplus">+    var currentSiteURI = PlacesUtils.livemarks.getSiteURI(this._itemId);</span>
<a href="#l10.785"></a><span id="l10.785" class="difflineplus">+    if (!uri || !currentSiteURI.equals(uri)) {</span>
<a href="#l10.786"></a><span id="l10.786" class="difflineplus">+      var txn = PlacesUIUtils.ptm.editLivemarkSiteURI(this._itemId, uri);</span>
<a href="#l10.787"></a><span id="l10.787" class="difflineplus">+      PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l10.788"></a><span id="l10.788" class="difflineplus">+    }</span>
<a href="#l10.789"></a><span id="l10.789" class="difflineplus">+  },</span>
<a href="#l10.790"></a><span id="l10.790" class="difflineplus">+</span>
<a href="#l10.791"></a><span id="l10.791" class="difflineplus">+  onLoadInSidebarCheckboxCommand:</span>
<a href="#l10.792"></a><span id="l10.792" class="difflineplus">+  function EIO_onLoadInSidebarCheckboxCommand() {</span>
<a href="#l10.793"></a><span id="l10.793" class="difflineplus">+    var loadInSidebarChecked = this._element(&quot;loadInSidebarCheckbox&quot;).checked;</span>
<a href="#l10.794"></a><span id="l10.794" class="difflineplus">+    var txn = PlacesUIUtils.ptm.setLoadInSidebar(this._itemId,</span>
<a href="#l10.795"></a><span id="l10.795" class="difflineplus">+                                                 loadInSidebarChecked);</span>
<a href="#l10.796"></a><span id="l10.796" class="difflineplus">+    PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l10.797"></a><span id="l10.797" class="difflineplus">+  },</span>
<a href="#l10.798"></a><span id="l10.798" class="difflineplus">+</span>
<a href="#l10.799"></a><span id="l10.799" class="difflineplus">+  toggleFolderTreeVisibility: function EIO_toggleFolderTreeVisibility() {</span>
<a href="#l10.800"></a><span id="l10.800" class="difflineplus">+    var expander = this._element(&quot;foldersExpander&quot;);</span>
<a href="#l10.801"></a><span id="l10.801" class="difflineplus">+    var folderTreeRow = this._element(&quot;folderTreeRow&quot;);</span>
<a href="#l10.802"></a><span id="l10.802" class="difflineplus">+    if (!folderTreeRow.collapsed) {</span>
<a href="#l10.803"></a><span id="l10.803" class="difflineplus">+      expander.className = &quot;expander-down&quot;;</span>
<a href="#l10.804"></a><span id="l10.804" class="difflineplus">+      expander.setAttribute(&quot;tooltiptext&quot;,</span>
<a href="#l10.805"></a><span id="l10.805" class="difflineplus">+                            expander.getAttribute(&quot;tooltiptextdown&quot;));</span>
<a href="#l10.806"></a><span id="l10.806" class="difflineplus">+      folderTreeRow.collapsed = true;</span>
<a href="#l10.807"></a><span id="l10.807" class="difflineplus">+      this._element(&quot;chooseFolderSeparator&quot;).hidden =</span>
<a href="#l10.808"></a><span id="l10.808" class="difflineplus">+        this._element(&quot;chooseFolderMenuItem&quot;).hidden = false;</span>
<a href="#l10.809"></a><span id="l10.809" class="difflineplus">+    }</span>
<a href="#l10.810"></a><span id="l10.810" class="difflineplus">+    else {</span>
<a href="#l10.811"></a><span id="l10.811" class="difflineplus">+      expander.className = &quot;expander-up&quot;</span>
<a href="#l10.812"></a><span id="l10.812" class="difflineplus">+      expander.setAttribute(&quot;tooltiptext&quot;,</span>
<a href="#l10.813"></a><span id="l10.813" class="difflineplus">+                            expander.getAttribute(&quot;tooltiptextup&quot;));</span>
<a href="#l10.814"></a><span id="l10.814" class="difflineplus">+      folderTreeRow.collapsed = false;</span>
<a href="#l10.815"></a><span id="l10.815" class="difflineplus">+      // XXXmano: Ideally we would only do this once, but for some odd reason,</span>
<a href="#l10.816"></a><span id="l10.816" class="difflineplus">+      // the editable mode set on this tree, together with its collapsed state</span>
<a href="#l10.817"></a><span id="l10.817" class="difflineplus">+      // breaks the view.</span>
<a href="#l10.818"></a><span id="l10.818" class="difflineplus">+      const FOLDER_TREE_PLACE_URI =</span>
<a href="#l10.819"></a><span id="l10.819" class="difflineplus">+        &quot;place:excludeItems=1&amp;excludeQueries=1&amp;excludeReadOnlyFolders=1&amp;folder=&quot; +</span>
<a href="#l10.820"></a><span id="l10.820" class="difflineplus">+        PlacesUIUtils.allBookmarksFolderId;</span>
<a href="#l10.821"></a><span id="l10.821" class="difflineplus">+      this._folderTree.place = FOLDER_TREE_PLACE_URI;</span>
<a href="#l10.822"></a><span id="l10.822" class="difflineplus">+</span>
<a href="#l10.823"></a><span id="l10.823" class="difflineplus">+      this._element(&quot;chooseFolderSeparator&quot;).hidden =</span>
<a href="#l10.824"></a><span id="l10.824" class="difflineplus">+        this._element(&quot;chooseFolderMenuItem&quot;).hidden = true;</span>
<a href="#l10.825"></a><span id="l10.825" class="difflineplus">+      var currentFolder = this._getFolderIdFromMenuList();</span>
<a href="#l10.826"></a><span id="l10.826" class="difflineplus">+      this._folderTree.selectItems([currentFolder]);</span>
<a href="#l10.827"></a><span id="l10.827" class="difflineplus">+      this._folderTree.focus();</span>
<a href="#l10.828"></a><span id="l10.828" class="difflineplus">+    }</span>
<a href="#l10.829"></a><span id="l10.829" class="difflineplus">+  },</span>
<a href="#l10.830"></a><span id="l10.830" class="difflineplus">+</span>
<a href="#l10.831"></a><span id="l10.831" class="difflineplus">+  _getFolderIdFromMenuList:</span>
<a href="#l10.832"></a><span id="l10.832" class="difflineplus">+  function EIO__getFolderIdFromMenuList() {</span>
<a href="#l10.833"></a><span id="l10.833" class="difflineplus">+    var selectedItem = this._folderMenuList.selectedItem;</span>
<a href="#l10.834"></a><span id="l10.834" class="difflineplus">+    NS_ASSERT(&quot;folderId&quot; in selectedItem,</span>
<a href="#l10.835"></a><span id="l10.835" class="difflineplus">+              &quot;Invalid menuitem in the folders-menulist&quot;);</span>
<a href="#l10.836"></a><span id="l10.836" class="difflineplus">+    return selectedItem.folderId;</span>
<a href="#l10.837"></a><span id="l10.837" class="difflineplus">+  },</span>
<a href="#l10.838"></a><span id="l10.838" class="difflineplus">+</span>
<a href="#l10.839"></a><span id="l10.839" class="difflineplus">+  /**</span>
<a href="#l10.840"></a><span id="l10.840" class="difflineplus">+   * Get the corresponding menu-item in the folder-menu-list for a bookmarks</span>
<a href="#l10.841"></a><span id="l10.841" class="difflineplus">+   * folder if such an item exists. Otherwise, this creates a menu-item for the</span>
<a href="#l10.842"></a><span id="l10.842" class="difflineplus">+   * folder. If the items-count limit (see MAX_FOLDERS_IN_MENU_LIST) is reached,</span>
<a href="#l10.843"></a><span id="l10.843" class="difflineplus">+   * the new item replaces the last menu-item.</span>
<a href="#l10.844"></a><span id="l10.844" class="difflineplus">+   * @param aFolderId</span>
<a href="#l10.845"></a><span id="l10.845" class="difflineplus">+   *        The identifier of the bookmarks folder.</span>
<a href="#l10.846"></a><span id="l10.846" class="difflineplus">+   */</span>
<a href="#l10.847"></a><span id="l10.847" class="difflineplus">+  _getFolderMenuItem:</span>
<a href="#l10.848"></a><span id="l10.848" class="difflineplus">+  function EIO__getFolderMenuItem(aFolderId) {</span>
<a href="#l10.849"></a><span id="l10.849" class="difflineplus">+    var menupopup = this._folderMenuList.menupopup;</span>
<a href="#l10.850"></a><span id="l10.850" class="difflineplus">+</span>
<a href="#l10.851"></a><span id="l10.851" class="difflineplus">+    for (var i = 0; i &lt; menupopup.childNodes.length; i++) {</span>
<a href="#l10.852"></a><span id="l10.852" class="difflineplus">+      if (&quot;folderId&quot; in menupopup.childNodes[i] &amp;&amp;</span>
<a href="#l10.853"></a><span id="l10.853" class="difflineplus">+          menupopup.childNodes[i].folderId == aFolderId)</span>
<a href="#l10.854"></a><span id="l10.854" class="difflineplus">+        return menupopup.childNodes[i];</span>
<a href="#l10.855"></a><span id="l10.855" class="difflineplus">+    }</span>
<a href="#l10.856"></a><span id="l10.856" class="difflineplus">+</span>
<a href="#l10.857"></a><span id="l10.857" class="difflineplus">+    // 3 special folders + separator + folder-items-count limit</span>
<a href="#l10.858"></a><span id="l10.858" class="difflineplus">+    if (menupopup.childNodes.length == 4 + MAX_FOLDER_ITEM_IN_MENU_LIST)</span>
<a href="#l10.859"></a><span id="l10.859" class="difflineplus">+      menupopup.removeChild(menupopup.lastChild);</span>
<a href="#l10.860"></a><span id="l10.860" class="difflineplus">+</span>
<a href="#l10.861"></a><span id="l10.861" class="difflineplus">+    return this._appendFolderItemToMenupopup(menupopup, aFolderId);</span>
<a href="#l10.862"></a><span id="l10.862" class="difflineplus">+  },</span>
<a href="#l10.863"></a><span id="l10.863" class="difflineplus">+</span>
<a href="#l10.864"></a><span id="l10.864" class="difflineplus">+  onFolderMenuListCommand: function EIO_onFolderMenuListCommand(aEvent) {</span>
<a href="#l10.865"></a><span id="l10.865" class="difflineplus">+    // Set a selectedIndex attribute to show special icons</span>
<a href="#l10.866"></a><span id="l10.866" class="difflineplus">+    this._folderMenuList.setAttribute(&quot;selectedIndex&quot;,</span>
<a href="#l10.867"></a><span id="l10.867" class="difflineplus">+                                      this._folderMenuList.selectedIndex);</span>
<a href="#l10.868"></a><span id="l10.868" class="difflineplus">+</span>
<a href="#l10.869"></a><span id="l10.869" class="difflineplus">+    if (aEvent.target.id == &quot;editBMPanel_chooseFolderMenuItem&quot;) {</span>
<a href="#l10.870"></a><span id="l10.870" class="difflineplus">+      // reset the selection back to where it was and expand the tree</span>
<a href="#l10.871"></a><span id="l10.871" class="difflineplus">+      // (this menu-item is hidden when the tree is already visible</span>
<a href="#l10.872"></a><span id="l10.872" class="difflineplus">+      var container = PlacesUtils.bookmarks.getFolderIdForItem(this._itemId);</span>
<a href="#l10.873"></a><span id="l10.873" class="difflineplus">+      var item = this._getFolderMenuItem(container);</span>
<a href="#l10.874"></a><span id="l10.874" class="difflineplus">+      this._folderMenuList.selectedItem = item;</span>
<a href="#l10.875"></a><span id="l10.875" class="difflineplus">+      // XXXmano HACK: setTimeout 100, otherwise focus goes back to the</span>
<a href="#l10.876"></a><span id="l10.876" class="difflineplus">+      // menulist right away</span>
<a href="#l10.877"></a><span id="l10.877" class="difflineplus">+      setTimeout(function(self) self.toggleFolderTreeVisibility(), 100, this);</span>
<a href="#l10.878"></a><span id="l10.878" class="difflineplus">+      return;</span>
<a href="#l10.879"></a><span id="l10.879" class="difflineplus">+    }</span>
<a href="#l10.880"></a><span id="l10.880" class="difflineplus">+</span>
<a href="#l10.881"></a><span id="l10.881" class="difflineplus">+    // Move the item</span>
<a href="#l10.882"></a><span id="l10.882" class="difflineplus">+    var container = this._getFolderIdFromMenuList();</span>
<a href="#l10.883"></a><span id="l10.883" class="difflineplus">+    if (PlacesUtils.bookmarks.getFolderIdForItem(this._itemId) != container) {</span>
<a href="#l10.884"></a><span id="l10.884" class="difflineplus">+      var txn = PlacesUIUtils.ptm.moveItem(this._itemId, container, -1);</span>
<a href="#l10.885"></a><span id="l10.885" class="difflineplus">+      PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l10.886"></a><span id="l10.886" class="difflineplus">+</span>
<a href="#l10.887"></a><span id="l10.887" class="difflineplus">+      // Mark the containing folder as recently-used if it isn't in the</span>
<a href="#l10.888"></a><span id="l10.888" class="difflineplus">+      // static list</span>
<a href="#l10.889"></a><span id="l10.889" class="difflineplus">+      if (container != PlacesUtils.unfiledBookmarksFolderId &amp;&amp;</span>
<a href="#l10.890"></a><span id="l10.890" class="difflineplus">+          container != PlacesUtils.toolbarFolderId &amp;&amp;</span>
<a href="#l10.891"></a><span id="l10.891" class="difflineplus">+          container != PlacesUtils.bookmarksMenuFolderId)</span>
<a href="#l10.892"></a><span id="l10.892" class="difflineplus">+        this._markFolderAsRecentlyUsed(container);</span>
<a href="#l10.893"></a><span id="l10.893" class="difflineplus">+    }</span>
<a href="#l10.894"></a><span id="l10.894" class="difflineplus">+</span>
<a href="#l10.895"></a><span id="l10.895" class="difflineplus">+    // Update folder-tree selection</span>
<a href="#l10.896"></a><span id="l10.896" class="difflineplus">+    var folderTreeRow = this._element(&quot;folderTreeRow&quot;);</span>
<a href="#l10.897"></a><span id="l10.897" class="difflineplus">+    if (!folderTreeRow.collapsed) {</span>
<a href="#l10.898"></a><span id="l10.898" class="difflineplus">+      var selectedNode = this._folderTree.selectedNode;</span>
<a href="#l10.899"></a><span id="l10.899" class="difflineplus">+      if (!selectedNode ||</span>
<a href="#l10.900"></a><span id="l10.900" class="difflineplus">+          PlacesUtils.getConcreteItemId(selectedNode) != container)</span>
<a href="#l10.901"></a><span id="l10.901" class="difflineplus">+        this._folderTree.selectItems([container]);</span>
<a href="#l10.902"></a><span id="l10.902" class="difflineplus">+    }</span>
<a href="#l10.903"></a><span id="l10.903" class="difflineplus">+  },</span>
<a href="#l10.904"></a><span id="l10.904" class="difflineplus">+</span>
<a href="#l10.905"></a><span id="l10.905" class="difflineplus">+  onFolderTreeSelect: function EIO_onFolderTreeSelect() {</span>
<a href="#l10.906"></a><span id="l10.906" class="difflineplus">+    var selectedNode = this._folderTree.selectedNode;</span>
<a href="#l10.907"></a><span id="l10.907" class="difflineplus">+</span>
<a href="#l10.908"></a><span id="l10.908" class="difflineplus">+    // Disable the &quot;New Folder&quot; button if we cannot create a new folder</span>
<a href="#l10.909"></a><span id="l10.909" class="difflineplus">+    this._element(&quot;newFolderButton&quot;)</span>
<a href="#l10.910"></a><span id="l10.910" class="difflineplus">+        .disabled = !this._folderTree.insertionPoint || !selectedNode;</span>
<a href="#l10.911"></a><span id="l10.911" class="difflineplus">+</span>
<a href="#l10.912"></a><span id="l10.912" class="difflineplus">+    if (!selectedNode)</span>
<a href="#l10.913"></a><span id="l10.913" class="difflineplus">+      return;</span>
<a href="#l10.914"></a><span id="l10.914" class="difflineplus">+</span>
<a href="#l10.915"></a><span id="l10.915" class="difflineplus">+    var folderId = PlacesUtils.getConcreteItemId(selectedNode);</span>
<a href="#l10.916"></a><span id="l10.916" class="difflineplus">+    if (this._getFolderIdFromMenuList() == folderId)</span>
<a href="#l10.917"></a><span id="l10.917" class="difflineplus">+      return;</span>
<a href="#l10.918"></a><span id="l10.918" class="difflineplus">+</span>
<a href="#l10.919"></a><span id="l10.919" class="difflineplus">+    var folderItem = this._getFolderMenuItem(folderId);</span>
<a href="#l10.920"></a><span id="l10.920" class="difflineplus">+    this._folderMenuList.selectedItem = folderItem;</span>
<a href="#l10.921"></a><span id="l10.921" class="difflineplus">+    folderItem.doCommand();</span>
<a href="#l10.922"></a><span id="l10.922" class="difflineplus">+  },</span>
<a href="#l10.923"></a><span id="l10.923" class="difflineplus">+</span>
<a href="#l10.924"></a><span id="l10.924" class="difflineplus">+  _markFolderAsRecentlyUsed:</span>
<a href="#l10.925"></a><span id="l10.925" class="difflineplus">+  function EIO__markFolderAsRecentlyUsed(aFolderId) {</span>
<a href="#l10.926"></a><span id="l10.926" class="difflineplus">+    var txns = [];</span>
<a href="#l10.927"></a><span id="l10.927" class="difflineplus">+</span>
<a href="#l10.928"></a><span id="l10.928" class="difflineplus">+    // Expire old unused recent folders</span>
<a href="#l10.929"></a><span id="l10.929" class="difflineplus">+    var anno = this._getLastUsedAnnotationObject(false);</span>
<a href="#l10.930"></a><span id="l10.930" class="difflineplus">+    while (this._recentFolders.length &gt; MAX_FOLDER_ITEM_IN_MENU_LIST) {</span>
<a href="#l10.931"></a><span id="l10.931" class="difflineplus">+      var folderId = this._recentFolders.pop().folderId;</span>
<a href="#l10.932"></a><span id="l10.932" class="difflineplus">+      txns.push(PlacesUIUtils.ptm.setItemAnnotation(folderId, anno));</span>
<a href="#l10.933"></a><span id="l10.933" class="difflineplus">+    }</span>
<a href="#l10.934"></a><span id="l10.934" class="difflineplus">+</span>
<a href="#l10.935"></a><span id="l10.935" class="difflineplus">+    // Mark folder as recently used</span>
<a href="#l10.936"></a><span id="l10.936" class="difflineplus">+    anno = this._getLastUsedAnnotationObject(true);</span>
<a href="#l10.937"></a><span id="l10.937" class="difflineplus">+    txns.push(PlacesUIUtils.ptm.setItemAnnotation(aFolderId, anno));</span>
<a href="#l10.938"></a><span id="l10.938" class="difflineplus">+</span>
<a href="#l10.939"></a><span id="l10.939" class="difflineplus">+    var aggregate = PlacesUIUtils.ptm.aggregateTransactions(&quot;Update last used folders&quot;, txns);</span>
<a href="#l10.940"></a><span id="l10.940" class="difflineplus">+    PlacesUIUtils.ptm.doTransaction(aggregate);</span>
<a href="#l10.941"></a><span id="l10.941" class="difflineplus">+  },</span>
<a href="#l10.942"></a><span id="l10.942" class="difflineplus">+</span>
<a href="#l10.943"></a><span id="l10.943" class="difflineplus">+  /**</span>
<a href="#l10.944"></a><span id="l10.944" class="difflineplus">+   * Returns an object which could then be used to set/unset the</span>
<a href="#l10.945"></a><span id="l10.945" class="difflineplus">+   * LAST_USED_ANNO annotation for a folder.</span>
<a href="#l10.946"></a><span id="l10.946" class="difflineplus">+   *</span>
<a href="#l10.947"></a><span id="l10.947" class="difflineplus">+   * @param aLastUsed</span>
<a href="#l10.948"></a><span id="l10.948" class="difflineplus">+   *        Whether to set or unset the LAST_USED_ANNO annotation.</span>
<a href="#l10.949"></a><span id="l10.949" class="difflineplus">+   * @returns an object representing the annotation which could then be used</span>
<a href="#l10.950"></a><span id="l10.950" class="difflineplus">+   *          with the transaction manager.</span>
<a href="#l10.951"></a><span id="l10.951" class="difflineplus">+   */</span>
<a href="#l10.952"></a><span id="l10.952" class="difflineplus">+  _getLastUsedAnnotationObject:</span>
<a href="#l10.953"></a><span id="l10.953" class="difflineplus">+  function EIO__getLastUsedAnnotationObject(aLastUsed) {</span>
<a href="#l10.954"></a><span id="l10.954" class="difflineplus">+    var anno = { name: LAST_USED_ANNO,</span>
<a href="#l10.955"></a><span id="l10.955" class="difflineplus">+                 type: Components.interfaces.nsIAnnotationService.TYPE_INT32,</span>
<a href="#l10.956"></a><span id="l10.956" class="difflineplus">+                 flags: 0,</span>
<a href="#l10.957"></a><span id="l10.957" class="difflineplus">+                 value: aLastUsed ? new Date().getTime() : null,</span>
<a href="#l10.958"></a><span id="l10.958" class="difflineplus">+                 expires: Components.interfaces.nsIAnnotationService.EXPIRE_NEVER };</span>
<a href="#l10.959"></a><span id="l10.959" class="difflineplus">+</span>
<a href="#l10.960"></a><span id="l10.960" class="difflineplus">+    return anno;</span>
<a href="#l10.961"></a><span id="l10.961" class="difflineplus">+  },</span>
<a href="#l10.962"></a><span id="l10.962" class="difflineplus">+</span>
<a href="#l10.963"></a><span id="l10.963" class="difflineplus">+  _rebuildTagsSelectorList: function EIO__rebuildTagsSelectorList() {</span>
<a href="#l10.964"></a><span id="l10.964" class="difflineplus">+    var tagsSelector = this._element(&quot;tagsSelector&quot;);</span>
<a href="#l10.965"></a><span id="l10.965" class="difflineplus">+    var tagsSelectorRow = this._element(&quot;tagsSelectorRow&quot;);</span>
<a href="#l10.966"></a><span id="l10.966" class="difflineplus">+    if (tagsSelectorRow.collapsed)</span>
<a href="#l10.967"></a><span id="l10.967" class="difflineplus">+      return;</span>
<a href="#l10.968"></a><span id="l10.968" class="difflineplus">+</span>
<a href="#l10.969"></a><span id="l10.969" class="difflineplus">+    while (tagsSelector.hasChildNodes())</span>
<a href="#l10.970"></a><span id="l10.970" class="difflineplus">+      tagsSelector.removeChild(tagsSelector.lastChild);</span>
<a href="#l10.971"></a><span id="l10.971" class="difflineplus">+</span>
<a href="#l10.972"></a><span id="l10.972" class="difflineplus">+    var tagsInField = this._getTagsArrayFromTagField();</span>
<a href="#l10.973"></a><span id="l10.973" class="difflineplus">+    var allTags = PlacesUtils.tagging.allTags;</span>
<a href="#l10.974"></a><span id="l10.974" class="difflineplus">+    for (var i = 0; i &lt; allTags.length; i++) {</span>
<a href="#l10.975"></a><span id="l10.975" class="difflineplus">+      var tag = allTags[i];</span>
<a href="#l10.976"></a><span id="l10.976" class="difflineplus">+      var elt = document.createElement(&quot;listitem&quot;);</span>
<a href="#l10.977"></a><span id="l10.977" class="difflineplus">+      elt.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l10.978"></a><span id="l10.978" class="difflineplus">+      elt.setAttribute(&quot;label&quot;, tag);</span>
<a href="#l10.979"></a><span id="l10.979" class="difflineplus">+      if (tagsInField.indexOf(tag) != -1)</span>
<a href="#l10.980"></a><span id="l10.980" class="difflineplus">+        elt.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l10.981"></a><span id="l10.981" class="difflineplus">+</span>
<a href="#l10.982"></a><span id="l10.982" class="difflineplus">+      tagsSelector.appendChild(elt);</span>
<a href="#l10.983"></a><span id="l10.983" class="difflineplus">+    }</span>
<a href="#l10.984"></a><span id="l10.984" class="difflineplus">+  },</span>
<a href="#l10.985"></a><span id="l10.985" class="difflineplus">+</span>
<a href="#l10.986"></a><span id="l10.986" class="difflineplus">+  toggleTagsSelector: function EIO_toggleTagsSelector() {</span>
<a href="#l10.987"></a><span id="l10.987" class="difflineplus">+    var tagsSelector = this._element(&quot;tagsSelector&quot;);</span>
<a href="#l10.988"></a><span id="l10.988" class="difflineplus">+    var tagsSelectorRow = this._element(&quot;tagsSelectorRow&quot;);</span>
<a href="#l10.989"></a><span id="l10.989" class="difflineplus">+    var expander = this._element(&quot;tagsSelectorExpander&quot;);</span>
<a href="#l10.990"></a><span id="l10.990" class="difflineplus">+    if (tagsSelectorRow.collapsed) {</span>
<a href="#l10.991"></a><span id="l10.991" class="difflineplus">+      expander.className = &quot;expander-up&quot;;</span>
<a href="#l10.992"></a><span id="l10.992" class="difflineplus">+      expander.setAttribute(&quot;tooltiptext&quot;,</span>
<a href="#l10.993"></a><span id="l10.993" class="difflineplus">+                            expander.getAttribute(&quot;tooltiptextup&quot;));</span>
<a href="#l10.994"></a><span id="l10.994" class="difflineplus">+      tagsSelectorRow.collapsed = false;</span>
<a href="#l10.995"></a><span id="l10.995" class="difflineplus">+      this._rebuildTagsSelectorList();</span>
<a href="#l10.996"></a><span id="l10.996" class="difflineplus">+</span>
<a href="#l10.997"></a><span id="l10.997" class="difflineplus">+      // This is a no-op if we've added the listener.</span>
<a href="#l10.998"></a><span id="l10.998" class="difflineplus">+      tagsSelector.addEventListener(&quot;CheckboxStateChange&quot;, this, false);</span>
<a href="#l10.999"></a><span id="l10.999" class="difflineplus">+    }</span>
<a href="#l10.1000"></a><span id="l10.1000" class="difflineplus">+    else {</span>
<a href="#l10.1001"></a><span id="l10.1001" class="difflineplus">+      expander.className = &quot;expander-down&quot;;</span>
<a href="#l10.1002"></a><span id="l10.1002" class="difflineplus">+      expander.setAttribute(&quot;tooltiptext&quot;,</span>
<a href="#l10.1003"></a><span id="l10.1003" class="difflineplus">+                            expander.getAttribute(&quot;tooltiptextdown&quot;));</span>
<a href="#l10.1004"></a><span id="l10.1004" class="difflineplus">+      tagsSelectorRow.collapsed = true;</span>
<a href="#l10.1005"></a><span id="l10.1005" class="difflineplus">+    }</span>
<a href="#l10.1006"></a><span id="l10.1006" class="difflineplus">+  },</span>
<a href="#l10.1007"></a><span id="l10.1007" class="difflineplus">+</span>
<a href="#l10.1008"></a><span id="l10.1008" class="difflineplus">+  _getTagsArrayFromTagField: function EIO__getTagsArrayFromTagField() {</span>
<a href="#l10.1009"></a><span id="l10.1009" class="difflineplus">+    // we don't require the leading space (after each comma)</span>
<a href="#l10.1010"></a><span id="l10.1010" class="difflineplus">+    var tags = this._element(&quot;tagsField&quot;).value.split(&quot;,&quot;);</span>
<a href="#l10.1011"></a><span id="l10.1011" class="difflineplus">+    for (var i=0; i &lt; tags.length; i++) {</span>
<a href="#l10.1012"></a><span id="l10.1012" class="difflineplus">+      // remove trailing and leading spaces</span>
<a href="#l10.1013"></a><span id="l10.1013" class="difflineplus">+      tags[i] = tags[i].replace(/^\s+/, &quot;&quot;).replace(/\s+$/, &quot;&quot;);</span>
<a href="#l10.1014"></a><span id="l10.1014" class="difflineplus">+</span>
<a href="#l10.1015"></a><span id="l10.1015" class="difflineplus">+      // remove empty entries from the array.</span>
<a href="#l10.1016"></a><span id="l10.1016" class="difflineplus">+      if (tags[i] == &quot;&quot;) {</span>
<a href="#l10.1017"></a><span id="l10.1017" class="difflineplus">+        tags.splice(i, 1);</span>
<a href="#l10.1018"></a><span id="l10.1018" class="difflineplus">+        i--;</span>
<a href="#l10.1019"></a><span id="l10.1019" class="difflineplus">+      }</span>
<a href="#l10.1020"></a><span id="l10.1020" class="difflineplus">+    }</span>
<a href="#l10.1021"></a><span id="l10.1021" class="difflineplus">+    return tags;</span>
<a href="#l10.1022"></a><span id="l10.1022" class="difflineplus">+  },</span>
<a href="#l10.1023"></a><span id="l10.1023" class="difflineplus">+</span>
<a href="#l10.1024"></a><span id="l10.1024" class="difflineplus">+  newFolder: function EIO_newFolder() {</span>
<a href="#l10.1025"></a><span id="l10.1025" class="difflineplus">+    var ip = this._folderTree.insertionPoint;</span>
<a href="#l10.1026"></a><span id="l10.1026" class="difflineplus">+</span>
<a href="#l10.1027"></a><span id="l10.1027" class="difflineplus">+    // default to the bookmarks menu folder</span>
<a href="#l10.1028"></a><span id="l10.1028" class="difflineplus">+    if (!ip || ip.itemId == PlacesUIUtils.allBookmarksFolderId) {</span>
<a href="#l10.1029"></a><span id="l10.1029" class="difflineplus">+        ip = new InsertionPoint(PlacesUtils.bookmarksMenuFolderId,</span>
<a href="#l10.1030"></a><span id="l10.1030" class="difflineplus">+                                PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l10.1031"></a><span id="l10.1031" class="difflineplus">+                                Components.interfaces.nsITreeView.DROP_ON);</span>
<a href="#l10.1032"></a><span id="l10.1032" class="difflineplus">+    }</span>
<a href="#l10.1033"></a><span id="l10.1033" class="difflineplus">+</span>
<a href="#l10.1034"></a><span id="l10.1034" class="difflineplus">+    // XXXmano: add a separate &quot;New Folder&quot; string at some point...</span>
<a href="#l10.1035"></a><span id="l10.1035" class="difflineplus">+    var defaultLabel = this._element(&quot;newFolderButton&quot;).label;</span>
<a href="#l10.1036"></a><span id="l10.1036" class="difflineplus">+    var txn = PlacesUIUtils.ptm.createFolder(defaultLabel, ip.itemId, ip.index);</span>
<a href="#l10.1037"></a><span id="l10.1037" class="difflineplus">+    PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l10.1038"></a><span id="l10.1038" class="difflineplus">+    this._folderTree.focus();</span>
<a href="#l10.1039"></a><span id="l10.1039" class="difflineplus">+    this._folderTree.selectItems([this._lastNewItem]);</span>
<a href="#l10.1040"></a><span id="l10.1040" class="difflineplus">+    this._folderTree.startEditing(this._folderTree.view.selection.currentIndex,</span>
<a href="#l10.1041"></a><span id="l10.1041" class="difflineplus">+                                  this._folderTree.columns.getFirstColumn());</span>
<a href="#l10.1042"></a><span id="l10.1042" class="difflineplus">+  },</span>
<a href="#l10.1043"></a><span id="l10.1043" class="difflineplus">+</span>
<a href="#l10.1044"></a><span id="l10.1044" class="difflineplus">+  // nsIDOMEventListener</span>
<a href="#l10.1045"></a><span id="l10.1045" class="difflineplus">+  handleEvent: function EIO_nsIDOMEventListener(aEvent) {</span>
<a href="#l10.1046"></a><span id="l10.1046" class="difflineplus">+    switch (aEvent.type) {</span>
<a href="#l10.1047"></a><span id="l10.1047" class="difflineplus">+    case &quot;CheckboxStateChange&quot;:</span>
<a href="#l10.1048"></a><span id="l10.1048" class="difflineplus">+      // Update the tags field when items are checked/unchecked in the listbox</span>
<a href="#l10.1049"></a><span id="l10.1049" class="difflineplus">+      var tags = this._getTagsArrayFromTagField();</span>
<a href="#l10.1050"></a><span id="l10.1050" class="difflineplus">+</span>
<a href="#l10.1051"></a><span id="l10.1051" class="difflineplus">+      if (aEvent.target.checked) {</span>
<a href="#l10.1052"></a><span id="l10.1052" class="difflineplus">+        if (tags.indexOf(aEvent.target.label) == -1)</span>
<a href="#l10.1053"></a><span id="l10.1053" class="difflineplus">+          tags.push(aEvent.target.label);</span>
<a href="#l10.1054"></a><span id="l10.1054" class="difflineplus">+      }</span>
<a href="#l10.1055"></a><span id="l10.1055" class="difflineplus">+      else {</span>
<a href="#l10.1056"></a><span id="l10.1056" class="difflineplus">+        var indexOfItem = tags.indexOf(aEvent.target.label);</span>
<a href="#l10.1057"></a><span id="l10.1057" class="difflineplus">+        if (indexOfItem != -1)</span>
<a href="#l10.1058"></a><span id="l10.1058" class="difflineplus">+          tags.splice(indexOfItem, 1);</span>
<a href="#l10.1059"></a><span id="l10.1059" class="difflineplus">+      }</span>
<a href="#l10.1060"></a><span id="l10.1060" class="difflineplus">+      this._element(&quot;tagsField&quot;).value = tags.join(&quot;, &quot;);</span>
<a href="#l10.1061"></a><span id="l10.1061" class="difflineplus">+      this._updateTags();</span>
<a href="#l10.1062"></a><span id="l10.1062" class="difflineplus">+      break;</span>
<a href="#l10.1063"></a><span id="l10.1063" class="difflineplus">+    case &quot;unload&quot;:</span>
<a href="#l10.1064"></a><span id="l10.1064" class="difflineplus">+      this.uninitPanel(false);</span>
<a href="#l10.1065"></a><span id="l10.1065" class="difflineplus">+      break;</span>
<a href="#l10.1066"></a><span id="l10.1066" class="difflineplus">+    }</span>
<a href="#l10.1067"></a><span id="l10.1067" class="difflineplus">+  },</span>
<a href="#l10.1068"></a><span id="l10.1068" class="difflineplus">+</span>
<a href="#l10.1069"></a><span id="l10.1069" class="difflineplus">+  // nsINavBookmarkObserver</span>
<a href="#l10.1070"></a><span id="l10.1070" class="difflineplus">+  onItemChanged: function EIO_onItemChanged(aItemId, aProperty,</span>
<a href="#l10.1071"></a><span id="l10.1071" class="difflineplus">+                                            aIsAnnotationProperty, aValue,</span>
<a href="#l10.1072"></a><span id="l10.1072" class="difflineplus">+                                            aLastModified, aItemType) {</span>
<a href="#l10.1073"></a><span id="l10.1073" class="difflineplus">+    if (this._itemId != aItemId) {</span>
<a href="#l10.1074"></a><span id="l10.1074" class="difflineplus">+      if (aProperty == &quot;title&quot;) {</span>
<a href="#l10.1075"></a><span id="l10.1075" class="difflineplus">+        // If the title of a folder which is listed within the folders</span>
<a href="#l10.1076"></a><span id="l10.1076" class="difflineplus">+        // menulist has been changed, we need to update the label of its</span>
<a href="#l10.1077"></a><span id="l10.1077" class="difflineplus">+        // representing element.</span>
<a href="#l10.1078"></a><span id="l10.1078" class="difflineplus">+        var menupopup = this._folderMenuList.menupopup;</span>
<a href="#l10.1079"></a><span id="l10.1079" class="difflineplus">+        for (var i = 0; i &lt; menupopup.childNodes.length; i++) {</span>
<a href="#l10.1080"></a><span id="l10.1080" class="difflineplus">+          if (&quot;folderId&quot; in menupopup.childNodes[i] &amp;&amp;</span>
<a href="#l10.1081"></a><span id="l10.1081" class="difflineplus">+              menupopup.childNodes[i].folderId == aItemId) {</span>
<a href="#l10.1082"></a><span id="l10.1082" class="difflineplus">+            menupopup.childNodes[i].label = aValue;</span>
<a href="#l10.1083"></a><span id="l10.1083" class="difflineplus">+            break;</span>
<a href="#l10.1084"></a><span id="l10.1084" class="difflineplus">+          }</span>
<a href="#l10.1085"></a><span id="l10.1085" class="difflineplus">+        }</span>
<a href="#l10.1086"></a><span id="l10.1086" class="difflineplus">+      }</span>
<a href="#l10.1087"></a><span id="l10.1087" class="difflineplus">+</span>
<a href="#l10.1088"></a><span id="l10.1088" class="difflineplus">+      return;</span>
<a href="#l10.1089"></a><span id="l10.1089" class="difflineplus">+    }</span>
<a href="#l10.1090"></a><span id="l10.1090" class="difflineplus">+</span>
<a href="#l10.1091"></a><span id="l10.1091" class="difflineplus">+    switch (aProperty) {</span>
<a href="#l10.1092"></a><span id="l10.1092" class="difflineplus">+    case &quot;title&quot;:</span>
<a href="#l10.1093"></a><span id="l10.1093" class="difflineplus">+      if (PlacesUtils.annotations.itemHasAnnotation(this._itemId,</span>
<a href="#l10.1094"></a><span id="l10.1094" class="difflineplus">+                                                    STATIC_TITLE_ANNO))</span>
<a href="#l10.1095"></a><span id="l10.1095" class="difflineplus">+        return;  // onContentLoaded updates microsummary-items</span>
<a href="#l10.1096"></a><span id="l10.1096" class="difflineplus">+</span>
<a href="#l10.1097"></a><span id="l10.1097" class="difflineplus">+      var userEnteredNameField = this._element(&quot;userEnteredName&quot;);</span>
<a href="#l10.1098"></a><span id="l10.1098" class="difflineplus">+      if (userEnteredNameField.value != aValue) {</span>
<a href="#l10.1099"></a><span id="l10.1099" class="difflineplus">+        userEnteredNameField.value = aValue;</span>
<a href="#l10.1100"></a><span id="l10.1100" class="difflineplus">+        var namePicker = this._element(&quot;namePicker&quot;);</span>
<a href="#l10.1101"></a><span id="l10.1101" class="difflineplus">+        if (namePicker.selectedItem == userEnteredNameField) {</span>
<a href="#l10.1102"></a><span id="l10.1102" class="difflineplus">+          namePicker.label = aValue;</span>
<a href="#l10.1103"></a><span id="l10.1103" class="difflineplus">+</span>
<a href="#l10.1104"></a><span id="l10.1104" class="difflineplus">+          // clear undo stack</span>
<a href="#l10.1105"></a><span id="l10.1105" class="difflineplus">+          namePicker.editor.transactionManager.clear();</span>
<a href="#l10.1106"></a><span id="l10.1106" class="difflineplus">+        }</span>
<a href="#l10.1107"></a><span id="l10.1107" class="difflineplus">+      }</span>
<a href="#l10.1108"></a><span id="l10.1108" class="difflineplus">+      break;</span>
<a href="#l10.1109"></a><span id="l10.1109" class="difflineplus">+    case &quot;uri&quot;:</span>
<a href="#l10.1110"></a><span id="l10.1110" class="difflineplus">+      var locationField = this._element(&quot;locationField&quot;);</span>
<a href="#l10.1111"></a><span id="l10.1111" class="difflineplus">+      if (locationField.value != aValue) {</span>
<a href="#l10.1112"></a><span id="l10.1112" class="difflineplus">+        this._uri = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l10.1113"></a><span id="l10.1113" class="difflineplus">+                              .getService(Components.interfaces.nsIIOService)</span>
<a href="#l10.1114"></a><span id="l10.1114" class="difflineplus">+                              .newURI(aValue, null, null);</span>
<a href="#l10.1115"></a><span id="l10.1115" class="difflineplus">+        this._initTextField(&quot;locationField&quot;, this._uri.spec);</span>
<a href="#l10.1116"></a><span id="l10.1116" class="difflineplus">+        this._initNamePicker(); // for microsummaries</span>
<a href="#l10.1117"></a><span id="l10.1117" class="difflineplus">+        this._initTextField(&quot;tagsField&quot;,</span>
<a href="#l10.1118"></a><span id="l10.1118" class="difflineplus">+                             PlacesUtils.tagging</span>
<a href="#l10.1119"></a><span id="l10.1119" class="difflineplus">+                                        .getTagsForURI(this._uri).join(&quot;, &quot;),</span>
<a href="#l10.1120"></a><span id="l10.1120" class="difflineplus">+                            false);</span>
<a href="#l10.1121"></a><span id="l10.1121" class="difflineplus">+        this._rebuildTagsSelectorList();</span>
<a href="#l10.1122"></a><span id="l10.1122" class="difflineplus">+      }</span>
<a href="#l10.1123"></a><span id="l10.1123" class="difflineplus">+      break;</span>
<a href="#l10.1124"></a><span id="l10.1124" class="difflineplus">+    case &quot;keyword&quot;:</span>
<a href="#l10.1125"></a><span id="l10.1125" class="difflineplus">+      this._initTextField(&quot;keywordField&quot;,</span>
<a href="#l10.1126"></a><span id="l10.1126" class="difflineplus">+                          PlacesUtils.bookmarks</span>
<a href="#l10.1127"></a><span id="l10.1127" class="difflineplus">+                                     .getKeywordForBookmark(this._itemId));</span>
<a href="#l10.1128"></a><span id="l10.1128" class="difflineplus">+      break;</span>
<a href="#l10.1129"></a><span id="l10.1129" class="difflineplus">+    case PlacesUIUtils.DESCRIPTION_ANNO:</span>
<a href="#l10.1130"></a><span id="l10.1130" class="difflineplus">+      this._initTextField(&quot;descriptionField&quot;,</span>
<a href="#l10.1131"></a><span id="l10.1131" class="difflineplus">+                          PlacesUIUtils.getItemDescription(this._itemId));</span>
<a href="#l10.1132"></a><span id="l10.1132" class="difflineplus">+      break;</span>
<a href="#l10.1133"></a><span id="l10.1133" class="difflineplus">+    case PlacesUIUtils.LOAD_IN_SIDEBAR_ANNO:</span>
<a href="#l10.1134"></a><span id="l10.1134" class="difflineplus">+      this._element(&quot;loadInSidebarCheckbox&quot;).checked =</span>
<a href="#l10.1135"></a><span id="l10.1135" class="difflineplus">+        PlacesUtils.annotations.itemHasAnnotation(this._itemId,</span>
<a href="#l10.1136"></a><span id="l10.1136" class="difflineplus">+                                                  PlacesUIUtils.LOAD_IN_SIDEBAR_ANNO);</span>
<a href="#l10.1137"></a><span id="l10.1137" class="difflineplus">+      break;</span>
<a href="#l10.1138"></a><span id="l10.1138" class="difflineplus">+    case PlacesUtils.LMANNO_FEEDURI:</span>
<a href="#l10.1139"></a><span id="l10.1139" class="difflineplus">+      var feedURISpec = PlacesUtils.livemarks.getFeedURI(this._itemId).spec;</span>
<a href="#l10.1140"></a><span id="l10.1140" class="difflineplus">+      this._initTextField(&quot;feedLocationField&quot;, feedURISpec);</span>
<a href="#l10.1141"></a><span id="l10.1141" class="difflineplus">+      break;</span>
<a href="#l10.1142"></a><span id="l10.1142" class="difflineplus">+    case PlacesUtils.LMANNO_SITEURI:</span>
<a href="#l10.1143"></a><span id="l10.1143" class="difflineplus">+      var siteURISpec = &quot;&quot;;</span>
<a href="#l10.1144"></a><span id="l10.1144" class="difflineplus">+      var siteURI = PlacesUtils.livemarks.getSiteURI(this._itemId);</span>
<a href="#l10.1145"></a><span id="l10.1145" class="difflineplus">+      if (siteURI)</span>
<a href="#l10.1146"></a><span id="l10.1146" class="difflineplus">+        siteURISpec = siteURI.spec;</span>
<a href="#l10.1147"></a><span id="l10.1147" class="difflineplus">+      this._initTextField(&quot;siteLocationField&quot;, siteURISpec);</span>
<a href="#l10.1148"></a><span id="l10.1148" class="difflineplus">+      break;</span>
<a href="#l10.1149"></a><span id="l10.1149" class="difflineplus">+    }</span>
<a href="#l10.1150"></a><span id="l10.1150" class="difflineplus">+  },</span>
<a href="#l10.1151"></a><span id="l10.1151" class="difflineplus">+</span>
<a href="#l10.1152"></a><span id="l10.1152" class="difflineplus">+  onItemMoved: function EIO_onItemMoved(aItemId, aOldParent, aOldIndex,</span>
<a href="#l10.1153"></a><span id="l10.1153" class="difflineplus">+                                        aNewParent, aNewIndex, aItemType) {</span>
<a href="#l10.1154"></a><span id="l10.1154" class="difflineplus">+    if (aItemId != this._itemId ||</span>
<a href="#l10.1155"></a><span id="l10.1155" class="difflineplus">+        aNewParent == this._getFolderIdFromMenuList())</span>
<a href="#l10.1156"></a><span id="l10.1156" class="difflineplus">+      return;</span>
<a href="#l10.1157"></a><span id="l10.1157" class="difflineplus">+</span>
<a href="#l10.1158"></a><span id="l10.1158" class="difflineplus">+    var folderItem = this._getFolderMenuItem(aNewParent);</span>
<a href="#l10.1159"></a><span id="l10.1159" class="difflineplus">+</span>
<a href="#l10.1160"></a><span id="l10.1160" class="difflineplus">+    // just setting selectItem _does not_ trigger oncommand, so we don't</span>
<a href="#l10.1161"></a><span id="l10.1161" class="difflineplus">+    // recurse</span>
<a href="#l10.1162"></a><span id="l10.1162" class="difflineplus">+    this._folderMenuList.selectedItem = folderItem;</span>
<a href="#l10.1163"></a><span id="l10.1163" class="difflineplus">+  },</span>
<a href="#l10.1164"></a><span id="l10.1164" class="difflineplus">+</span>
<a href="#l10.1165"></a><span id="l10.1165" class="difflineplus">+  onItemAdded: function EIO_onItemAdded(aItemId, aFolder, aIndex, aItemType) {</span>
<a href="#l10.1166"></a><span id="l10.1166" class="difflineplus">+    this._lastNewItem = aItemId;</span>
<a href="#l10.1167"></a><span id="l10.1167" class="difflineplus">+  },</span>
<a href="#l10.1168"></a><span id="l10.1168" class="difflineplus">+</span>
<a href="#l10.1169"></a><span id="l10.1169" class="difflineplus">+  onBeginUpdateBatch: function() { },</span>
<a href="#l10.1170"></a><span id="l10.1170" class="difflineplus">+  onEndUpdateBatch: function() { },</span>
<a href="#l10.1171"></a><span id="l10.1171" class="difflineplus">+  onBeforeItemRemoved: function() { },</span>
<a href="#l10.1172"></a><span id="l10.1172" class="difflineplus">+  onItemRemoved: function() { },</span>
<a href="#l10.1173"></a><span id="l10.1173" class="difflineplus">+  onItemVisited: function() { },</span>
<a href="#l10.1174"></a><span id="l10.1174" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/suite/common/bookmarks/editBookmarkOverlay.xul</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,263 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+   -</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+   -</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+   - License.</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+   -</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+   - The Original Code is the Places Edit Bookmarks Panel code.</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+   -</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+   - The Initial Developer of the Original Code is</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+   - Mozilla Corporation.</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+   -</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+   - Contributor(s):</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+   -   Asaf Romano &lt;mano@mozilla.com&gt; (Original Author)</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+   -</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+   -</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+&lt;!DOCTYPE overlay [</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+&lt;!ENTITY % editBookmarkOverlayDTD SYSTEM &quot;chrome://communicator/locale/bookmarks/editBookmarkOverlay.dtd&quot;&gt;</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+%editBookmarkOverlayDTD;</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineplus">+]&gt;</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/bookmarks/editBookmarkOverlay.css&quot;?&gt;</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/bookmarks/bookmarks.css&quot;?&gt;</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+&lt;overlay id=&quot;editBookmarkOverlay&quot;</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+  &lt;vbox id=&quot;editBookmarkPanelContent&quot;&gt;</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+    &lt;broadcaster id=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+    &lt;hbox id=&quot;editBMPanel_selectionCount&quot; hidden=&quot;true&quot; pack=&quot;center&quot;&gt;</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineplus">+      &lt;label id=&quot;editBMPanel_itemsCountText&quot;/&gt;</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineplus">+    &lt;grid id=&quot;editBookmarkPanelGrid&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineplus">+      &lt;columns id=&quot;editBMPanel_columns&quot;&gt;</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineplus">+        &lt;column id=&quot;editBMPanel_labelColumn&quot; /&gt;</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineplus">+        &lt;column flex=&quot;1&quot; id=&quot;editBMPanel_editColumn&quot; /&gt;</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineplus">+      &lt;/columns&gt;</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineplus">+      &lt;rows id=&quot;editBMPanel_rows&quot;&gt;</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineplus">+        &lt;row align=&quot;center&quot; id=&quot;editBMPanel_nameRow&quot;&gt;</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineplus">+          &lt;label value=&quot;&amp;editBookmarkOverlay.name.label;&quot;</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+                 class=&quot;editBMPanel_rowLabel&quot;</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineplus">+                 accesskey=&quot;&amp;editBookmarkOverlay.name.accesskey;&quot;</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineplus">+                 control=&quot;editBMPanel_namePicker&quot;</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+                 observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+          &lt;menulist id=&quot;editBMPanel_namePicker&quot;</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+                    flex=&quot;1&quot;</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+                    editable=&quot;true&quot;</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineplus">+                    droppable=&quot;false&quot;</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineplus">+                    oninput=&quot;gEditItemOverlay.onNamePickerInput();&quot;</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineplus">+                    onblur=&quot;gEditItemOverlay.onNamePickerChange();&quot;</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineplus">+                    oncommand=&quot;gEditItemOverlay.onNamePickerChange();&quot;</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineplus">+                    observes=&quot;paneElementsBroadcaster&quot;&gt;</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineplus">+            &lt;menupopup&gt;</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineplus">+              &lt;menuitem id=&quot;editBMPanel_userEnteredName&quot;/&gt;</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineplus">+              &lt;menuitem disabled=&quot;true&quot;&gt;</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineplus">+                &lt;menuseparator flex=&quot;1&quot;/&gt;</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineplus">+                &lt;label value=&quot;&amp;editBookmarkOverlay.liveTitlesSeparator.label;&quot;/&gt;</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineplus">+              &lt;/menuitem&gt;</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+            &lt;/menupopup&gt;</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+          &lt;/menulist&gt;</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineplus">+        &lt;/row&gt;</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineplus">+        &lt;row align=&quot;center&quot; id=&quot;editBMPanel_locationRow&quot;&gt;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+          &lt;label value=&quot;&amp;editBookmarkOverlay.location.label;&quot;</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+                 class=&quot;editBMPanel_rowLabel&quot;</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+                 accesskey=&quot;&amp;editBookmarkOverlay.location.accesskey;&quot;</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineplus">+                 control=&quot;editBMPanel_locationField&quot;</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineplus">+                 observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineplus">+          &lt;textbox id=&quot;editBMPanel_locationField&quot;</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineplus">+                   class=&quot;uri-element&quot;</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineplus">+                   onblur=&quot;gEditItemOverlay.onLocationFieldBlur();&quot;</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineplus">+                   observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineplus">+        &lt;/row&gt;</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineplus">+</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineplus">+        &lt;row align=&quot;center&quot; id=&quot;editBMPanel_feedLocationRow&quot;&gt;</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineplus">+          &lt;label value=&quot;&amp;editBookmarkOverlay.feedLocation.label;&quot;</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineplus">+                 class=&quot;editBMPanel_rowLabel&quot;</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineplus">+                 accesskey=&quot;&amp;editBookmarkOverlay.feedLocation.accesskey;&quot;</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineplus">+                 control=&quot;editBMPanel_feedLocationField&quot;</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineplus">+                 observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineplus">+          &lt;textbox id=&quot;editBMPanel_feedLocationField&quot;</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineplus">+                   class=&quot;uri-element&quot;</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineplus">+                   onblur=&quot;gEditItemOverlay.onFeedLocationFieldBlur();&quot;</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineplus">+                   observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineplus">+        &lt;/row&gt;</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineplus">+</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineplus">+        &lt;row align=&quot;center&quot; id=&quot;editBMPanel_siteLocationRow&quot;&gt;</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineplus">+          &lt;label value=&quot;&amp;editBookmarkOverlay.siteLocation.label;&quot;</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineplus">+                 class=&quot;editBMPanel_rowLabel&quot;</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineplus">+                 accesskey=&quot;&amp;editBookmarkOverlay.siteLocation.accesskey;&quot;</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineplus">+                 control=&quot;editBMPanel_siteLocationField&quot;</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineplus">+                 observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineplus">+          &lt;textbox id=&quot;editBMPanel_siteLocationField&quot;</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineplus">+                   class=&quot;uri-element&quot;</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineplus">+                   onblur=&quot;gEditItemOverlay.onSiteLocationFieldBlur();&quot;</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineplus">+                   observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineplus">+        &lt;/row&gt;</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineplus">+</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineplus">+        &lt;row align=&quot;center&quot; id=&quot;editBMPanel_folderRow&quot;&gt;</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineplus">+          &lt;label value=&quot;&amp;editBookmarkOverlay.folder.label;&quot;</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineplus">+                 class=&quot;editBMPanel_rowLabel&quot;</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineplus">+                 control=&quot;editBMPanel_folderMenuList&quot;</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineplus">+                 observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineplus">+          &lt;hbox flex=&quot;1&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineplus">+            &lt;menulist id=&quot;editBMPanel_folderMenuList&quot;</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineplus">+                      class=&quot;folder-icon&quot;</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineplus">+                      flex=&quot;1&quot;</span>
<a href="#l11.137"></a><span id="l11.137" class="difflineplus">+                      oncommand=&quot;gEditItemOverlay.onFolderMenuListCommand(event);&quot;</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineplus">+                      observes=&quot;paneElementsBroadcaster&quot;&gt;</span>
<a href="#l11.139"></a><span id="l11.139" class="difflineplus">+              &lt;menupopup&gt;</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineplus">+                &lt;!-- Static item for special folders --&gt;</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineplus">+                &lt;menuitem id=&quot;editBMPanel_toolbarFolderItem&quot;</span>
<a href="#l11.142"></a><span id="l11.142" class="difflineplus">+                          class=&quot;menuitem-iconic folder-icon&quot;/&gt;</span>
<a href="#l11.143"></a><span id="l11.143" class="difflineplus">+                &lt;menuitem id=&quot;editBMPanel_bmRootItem&quot;</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineplus">+                          class=&quot;menuitem-iconic folder-icon&quot;/&gt;</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineplus">+                &lt;menuitem id=&quot;editBMPanel_unfiledRootItem&quot;</span>
<a href="#l11.146"></a><span id="l11.146" class="difflineplus">+                          class=&quot;menuitem-iconic folder-icon&quot;/&gt;</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineplus">+                &lt;menuseparator id=&quot;editBMPanel_chooseFolderSeparator&quot;/&gt;</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineplus">+                &lt;menuitem id=&quot;editBMPanel_chooseFolderMenuItem&quot;</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineplus">+                          label=&quot;&amp;editBookmarkOverlay.choose.label;&quot;</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineplus">+                          class=&quot;menuitem-iconic folder-icon&quot;/&gt;</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineplus">+                &lt;menuseparator id=&quot;editBMPanel_foldersSeparator&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l11.152"></a><span id="l11.152" class="difflineplus">+              &lt;/menupopup&gt;</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineplus">+            &lt;/menulist&gt;</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineplus">+            &lt;button id=&quot;editBMPanel_foldersExpander&quot;</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineplus">+                    class=&quot;expander-down&quot;</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineplus">+                    tooltiptext=&quot;&amp;editBookmarkOverlay.foldersExpanderDown.tooltip;&quot;</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineplus">+                    tooltiptextdown=&quot;&amp;editBookmarkOverlay.foldersExpanderDown.tooltip;&quot;</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineplus">+                    tooltiptextup=&quot;&amp;editBookmarkOverlay.expanderUp.tooltip;&quot;</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineplus">+                    oncommand=&quot;gEditItemOverlay.toggleFolderTreeVisibility();&quot;</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineplus">+                    observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineplus">+        &lt;/row&gt;</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineplus">+</span>
<a href="#l11.164"></a><span id="l11.164" class="difflineplus">+        &lt;row align=&quot;center&quot; id=&quot;editBMPanel_folderTreeRow&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineplus">+          &lt;spacer/&gt;</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineplus">+          &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineplus">+            &lt;tree id=&quot;editBMPanel_folderTree&quot;</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineplus">+                  class=&quot;placesTree&quot;</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineplus">+                  type=&quot;places&quot;</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineplus">+                  height=&quot;150&quot;</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineplus">+                  editable=&quot;true&quot;</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineplus">+                  onselect=&quot;gEditItemOverlay.onFolderTreeSelect();&quot;</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineplus">+                  hidecolumnpicker=&quot;true&quot;</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineplus">+                  observes=&quot;paneElementsBroadcaster&quot;&gt;</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineplus">+              &lt;treecols&gt;</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineplus">+                &lt;treecol anonid=&quot;title&quot; flex=&quot;1&quot; primary=&quot;true&quot; hideheader=&quot;true&quot;/&gt;</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineplus">+              &lt;/treecols&gt;</span>
<a href="#l11.178"></a><span id="l11.178" class="difflineplus">+              &lt;treechildren flex=&quot;1&quot;/&gt;</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineplus">+            &lt;/tree&gt;</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineplus">+</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineplus">+            &lt;hbox id=&quot;editBMPanel_newFolderBox&quot;&gt;</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineplus">+              &lt;button label=&quot;&amp;editBookmarkOverlay.newFolderButton.label;&quot;</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineplus">+                      id=&quot;editBMPanel_newFolderButton&quot;</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineplus">+                      accesskey=&quot;&amp;editBookmarkOverlay.newFolderButton.accesskey;&quot;</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineplus">+                      oncommand=&quot;gEditItemOverlay.newFolder();&quot;/&gt;</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineplus">+          &lt;/vbox&gt;</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineplus">+        &lt;/row&gt;</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineplus">+</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineplus">+        &lt;row align=&quot;center&quot; id=&quot;editBMPanel_tagsRow&quot;&gt;</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineplus">+          &lt;label value=&quot;&amp;editBookmarkOverlay.tags.label;&quot;</span>
<a href="#l11.192"></a><span id="l11.192" class="difflineplus">+                 class=&quot;editBMPanel_rowLabel&quot;</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineplus">+                 accesskey=&quot;&amp;editBookmarkOverlay.tags.accesskey;&quot;</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineplus">+                 control=&quot;editBMPanel_tagsField&quot;</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineplus">+                 observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineplus">+          &lt;hbox flex=&quot;1&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.197"></a><span id="l11.197" class="difflineplus">+            &lt;textbox id=&quot;editBMPanel_tagsField&quot;</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineplus">+                     type=&quot;autocomplete&quot;</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineplus">+                     class=&quot;padded&quot;</span>
<a href="#l11.200"></a><span id="l11.200" class="difflineplus">+                     flex=&quot;1&quot;</span>
<a href="#l11.201"></a><span id="l11.201" class="difflineplus">+                     autocompletesearch=&quot;places-tag-autocomplete&quot; </span>
<a href="#l11.202"></a><span id="l11.202" class="difflineplus">+                     completedefaultindex=&quot;true&quot;</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineplus">+                     tabscrolling=&quot;true&quot;</span>
<a href="#l11.204"></a><span id="l11.204" class="difflineplus">+                     showcommentcolumn=&quot;true&quot;</span>
<a href="#l11.205"></a><span id="l11.205" class="difflineplus">+                     onblur=&quot;gEditItemOverlay.onTagsFieldBlur();&quot;</span>
<a href="#l11.206"></a><span id="l11.206" class="difflineplus">+                     observes=&quot;paneElementsBroadcaster&quot;</span>
<a href="#l11.207"></a><span id="l11.207" class="difflineplus">+                     placeholder=&quot;&amp;editBookmarkOverlay.tagsEmptyDesc.label;&quot;/&gt;</span>
<a href="#l11.208"></a><span id="l11.208" class="difflineplus">+            &lt;button id=&quot;editBMPanel_tagsSelectorExpander&quot;</span>
<a href="#l11.209"></a><span id="l11.209" class="difflineplus">+                    class=&quot;expander-down&quot;</span>
<a href="#l11.210"></a><span id="l11.210" class="difflineplus">+                    tooltiptext=&quot;&amp;editBookmarkOverlay.tagsExpanderDown.tooltip;&quot;</span>
<a href="#l11.211"></a><span id="l11.211" class="difflineplus">+                    tooltiptextdown=&quot;&amp;editBookmarkOverlay.tagsExpanderDown.tooltip;&quot;</span>
<a href="#l11.212"></a><span id="l11.212" class="difflineplus">+                    tooltiptextup=&quot;&amp;editBookmarkOverlay.expanderUp.tooltip;&quot;</span>
<a href="#l11.213"></a><span id="l11.213" class="difflineplus">+                    oncommand=&quot;gEditItemOverlay.toggleTagsSelector();&quot;</span>
<a href="#l11.214"></a><span id="l11.214" class="difflineplus">+                    observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.215"></a><span id="l11.215" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.216"></a><span id="l11.216" class="difflineplus">+        &lt;/row&gt;</span>
<a href="#l11.217"></a><span id="l11.217" class="difflineplus">+</span>
<a href="#l11.218"></a><span id="l11.218" class="difflineplus">+        &lt;row id=&quot;editBMPanel_tagsSelectorRow&quot;</span>
<a href="#l11.219"></a><span id="l11.219" class="difflineplus">+             align=&quot;center&quot;</span>
<a href="#l11.220"></a><span id="l11.220" class="difflineplus">+             collapsed=&quot;true&quot;&gt;</span>
<a href="#l11.221"></a><span id="l11.221" class="difflineplus">+          &lt;spacer/&gt;</span>
<a href="#l11.222"></a><span id="l11.222" class="difflineplus">+          &lt;listbox id=&quot;editBMPanel_tagsSelector&quot;</span>
<a href="#l11.223"></a><span id="l11.223" class="difflineplus">+                   height=&quot;150&quot;</span>
<a href="#l11.224"></a><span id="l11.224" class="difflineplus">+                   observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.225"></a><span id="l11.225" class="difflineplus">+        &lt;/row&gt;</span>
<a href="#l11.226"></a><span id="l11.226" class="difflineplus">+</span>
<a href="#l11.227"></a><span id="l11.227" class="difflineplus">+        &lt;row align=&quot;center&quot; id=&quot;editBMPanel_keywordRow&quot;&gt;</span>
<a href="#l11.228"></a><span id="l11.228" class="difflineplus">+          &lt;observes element=&quot;additionalInfoBroadcaster&quot; attribute=&quot;hidden&quot;/&gt;</span>
<a href="#l11.229"></a><span id="l11.229" class="difflineplus">+          &lt;label value=&quot;&amp;editBookmarkOverlay.keyword.label;&quot;</span>
<a href="#l11.230"></a><span id="l11.230" class="difflineplus">+                 class=&quot;editBMPanel_rowLabel&quot;</span>
<a href="#l11.231"></a><span id="l11.231" class="difflineplus">+                 accesskey=&quot;&amp;editBookmarkOverlay.keyword.accesskey;&quot;</span>
<a href="#l11.232"></a><span id="l11.232" class="difflineplus">+                 control=&quot;editBMPanel_keywordField&quot;</span>
<a href="#l11.233"></a><span id="l11.233" class="difflineplus">+                 observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.234"></a><span id="l11.234" class="difflineplus">+          &lt;textbox id=&quot;editBMPanel_keywordField&quot;</span>
<a href="#l11.235"></a><span id="l11.235" class="difflineplus">+                   onblur=&quot;gEditItemOverlay.onKeywordFieldBlur();&quot;</span>
<a href="#l11.236"></a><span id="l11.236" class="difflineplus">+                   observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.237"></a><span id="l11.237" class="difflineplus">+        &lt;/row&gt;</span>
<a href="#l11.238"></a><span id="l11.238" class="difflineplus">+</span>
<a href="#l11.239"></a><span id="l11.239" class="difflineplus">+        &lt;row id=&quot;editBMPanel_descriptionRow&quot;&gt;</span>
<a href="#l11.240"></a><span id="l11.240" class="difflineplus">+          &lt;observes element=&quot;additionalInfoBroadcaster&quot; attribute=&quot;hidden&quot;/&gt;</span>
<a href="#l11.241"></a><span id="l11.241" class="difflineplus">+          &lt;label value=&quot;&amp;editBookmarkOverlay.description.label;&quot;</span>
<a href="#l11.242"></a><span id="l11.242" class="difflineplus">+                 class=&quot;editBMPanel_rowLabel&quot;</span>
<a href="#l11.243"></a><span id="l11.243" class="difflineplus">+                 accesskey=&quot;&amp;editBookmarkOverlay.description.accesskey;&quot;</span>
<a href="#l11.244"></a><span id="l11.244" class="difflineplus">+                 control=&quot;editBMPanel_descriptionField&quot;</span>
<a href="#l11.245"></a><span id="l11.245" class="difflineplus">+                 observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.246"></a><span id="l11.246" class="difflineplus">+          &lt;textbox id=&quot;editBMPanel_descriptionField&quot;</span>
<a href="#l11.247"></a><span id="l11.247" class="difflineplus">+                   multiline=&quot;true&quot;</span>
<a href="#l11.248"></a><span id="l11.248" class="difflineplus">+                   onblur=&quot;gEditItemOverlay.onDescriptionFieldBlur();&quot;</span>
<a href="#l11.249"></a><span id="l11.249" class="difflineplus">+                   observes=&quot;paneElementsBroadcaster&quot;/&gt;</span>
<a href="#l11.250"></a><span id="l11.250" class="difflineplus">+        &lt;/row&gt;</span>
<a href="#l11.251"></a><span id="l11.251" class="difflineplus">+      &lt;/rows&gt;</span>
<a href="#l11.252"></a><span id="l11.252" class="difflineplus">+    &lt;/grid&gt;</span>
<a href="#l11.253"></a><span id="l11.253" class="difflineplus">+</span>
<a href="#l11.254"></a><span id="l11.254" class="difflineplus">+    &lt;checkbox id=&quot;editBMPanel_loadInSidebarCheckbox&quot;</span>
<a href="#l11.255"></a><span id="l11.255" class="difflineplus">+              label=&quot;&amp;editBookmarkOverlay.loadInSidebar.label;&quot;</span>
<a href="#l11.256"></a><span id="l11.256" class="difflineplus">+              accesskey=&quot;&amp;editBookmarkOverlay.loadInSidebar.accesskey;&quot;</span>
<a href="#l11.257"></a><span id="l11.257" class="difflineplus">+              oncommand=&quot;gEditItemOverlay.onLoadInSidebarCheckboxCommand();&quot;</span>
<a href="#l11.258"></a><span id="l11.258" class="difflineplus">+              observes=&quot;paneElementsBroadcaster&quot;&gt;</span>
<a href="#l11.259"></a><span id="l11.259" class="difflineplus">+      &lt;observes element=&quot;additionalInfoBroadcaster&quot; attribute=&quot;hidden&quot;/&gt;</span>
<a href="#l11.260"></a><span id="l11.260" class="difflineplus">+    &lt;/checkbox&gt;</span>
<a href="#l11.261"></a><span id="l11.261" class="difflineplus">+</span>
<a href="#l11.262"></a><span id="l11.262" class="difflineplus">+    &lt;!-- If the ids are changing or additional fields are being added, be sure</span>
<a href="#l11.263"></a><span id="l11.263" class="difflineplus">+         to sync the values in places.js --&gt;</span>
<a href="#l11.264"></a><span id="l11.264" class="difflineplus">+    &lt;broadcaster id=&quot;additionalInfoBroadcaster&quot;/&gt;</span>
<a href="#l11.265"></a><span id="l11.265" class="difflineplus">+</span>
<a href="#l11.266"></a><span id="l11.266" class="difflineplus">+  &lt;/vbox&gt;</span>
<a href="#l11.267"></a><span id="l11.267" class="difflineplus">+&lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- /dev/null</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ b/suite/common/bookmarks/moveBookmarks.js</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -0,0 +1,85 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+ *</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+ *</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+ * License.</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+ *</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+ * The Original Code is the Places Move Bookmarks Dialog.</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+ *</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+ * The Initial Developer of the Original Code is Mozilla Foundation.</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+ *</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineplus">+ *   Sungjoon Steve Won &lt;stevewon@gmail.com&gt;</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+ *</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+ *</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+var gMoveBookmarksDialog = {</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+  _nodes: null,</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineplus">+  _foldersTree: null,</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+  get foldersTree() {</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+    if (!this._foldersTree)</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+      this._foldersTree = document.getElementById(&quot;foldersTree&quot;);</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+    return this._foldersTree;</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+  },</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+  init: function() {</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+    this._nodes = window.arguments[0];</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+    this.foldersTree.place =</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+      &quot;place:excludeItems=1&amp;excludeQueries=1&amp;excludeReadOnlyFolders=1&amp;folder=&quot; +</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+      PlacesUIUtils.allBookmarksFolderId;</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+  },</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+  onOK: function MBD_onOK(aEvent) {</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+    var selectedNode = this.foldersTree.selectedNode;</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineplus">+    NS_ASSERT(selectedNode,</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+              &quot;selectedNode must be set in a single-selection tree with initial selection set&quot;);</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineplus">+    var selectedFolderID = PlacesUtils.getConcreteItemId(selectedNode);</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+    var transactions = [];</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+    for (var i=0; i &lt; this._nodes.length; i++) {</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+      // Nothing to do if the node is already under the selected folder</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+      if (this._nodes[i].parent.itemId == selectedFolderID)</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+        continue;</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineplus">+      transactions.push(new</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineplus">+        PlacesUIUtils.ptm.moveItem(this._nodes[i].itemId, selectedFolderID, -1));</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineplus">+    }</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineplus">+</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineplus">+    if (transactions.length != 0) {</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineplus">+      var txn = PlacesUIUtils.ptm.aggregateTransactions(&quot;Move Items&quot;, transactions);</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineplus">+      PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineplus">+    }</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineplus">+  },</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineplus">+</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineplus">+  newFolder: function MBD_newFolder() {</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineplus">+    // The command is disabled when the tree is not focused</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineplus">+    this.foldersTree.focus();</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineplus">+    goDoCommand(&quot;placesCmd_new:folder&quot;);</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineplus">+  }</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- /dev/null</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ b/suite/common/bookmarks/moveBookmarks.xul</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -0,0 +1,85 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineplus">+   -</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+   -</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+   - License.</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+   -</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+   - The Original Code is the Places Organizer.</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+   -</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+   - The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 2005-2006</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+   -</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+   - Contributor(s):</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+   -   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+   -</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+   -</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot;?&gt;</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/bookmarks/bookmarks.css&quot;?&gt;</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/content/bookmarks/places.css&quot;?&gt;</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://communicator/content/bookmarks/placesOverlay.xul&quot;?&gt;</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineplus">+&lt;!DOCTYPE window [</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+  &lt;!ENTITY % moveBookmarksDTD SYSTEM &quot;chrome://communicator/locale/bookmarks/moveBookmarks.dtd&quot;&gt;</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+  %moveBookmarksDTD;</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+]&gt;</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+&lt;dialog id=&quot;moveBookmarkDialog&quot;</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+        ondialogaccept=&quot;return gMoveBookmarksDialog.onOK(event);&quot;</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+        title=&quot;&amp;window.title;&quot;</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+        onload=&quot;gMoveBookmarksDialog.init();&quot;</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+        style=&quot;&amp;window.style;&quot;</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+        screenX=&quot;24&quot;</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+        screenY=&quot;24&quot;</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+        persist=&quot;screenX screenY width height&quot;&gt;</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+          src=&quot;chrome://communicator/content/bookmarks/moveBookmarks.js&quot;/&gt;</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineplus">+</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+  &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+    &lt;label id=&quot;movetolabel&quot; value=&quot;&amp;moveTo.label;&quot; control=&quot;foldersTree&quot;/&gt;</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+    &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+      &lt;tree id=&quot;foldersTree&quot;</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+            class=&quot;placesTree&quot;</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+            flex=&quot;1&quot;</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+            type=&quot;places&quot;</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+            seltype=&quot;single&quot;</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+            hidecolumnpicker=&quot;true&quot;&gt;</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineplus">+        &lt;treecols&gt;</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineplus">+          &lt;treecol id=&quot;title&quot; flex=&quot;1&quot; primary=&quot;true&quot; hideheader=&quot;true&quot;/&gt;</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineplus">+        &lt;/treecols&gt;</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineplus">+        &lt;treechildren id=&quot;placesListChildren&quot; view=&quot;placesList&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineplus">+      &lt;/tree&gt;</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineplus">+      &lt;vbox&gt;</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineplus">+        &lt;button id=&quot;newFolderButton&quot;</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineplus">+                label=&quot;&amp;newFolderButton.label;&quot;</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineplus">+                accesskey=&quot;&amp;newFolderButton.accesskey;&quot;</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineplus">+                oncommand=&quot;gMoveBookmarksDialog.newFolder();&quot;/&gt;</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineplus">+  &lt;/hbox&gt;</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineplus">+&lt;/dialog&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">new file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- /dev/null</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ b/suite/common/bookmarks/organizer.css</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -0,0 +1,7 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineplus">+#contentTitle {</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineplus">+  width: 0px;</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineplus">+}</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineplus">+</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineplus">+#searchFilter {</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineplus">+  width: 23em;</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/common/bookmarks/placesOverlay.xul</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/common/bookmarks/placesOverlay.xul</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -110,16 +110,51 @@</span>
<a href="#l15.4"></a><span id="l15.4">     &lt;command id=&quot;placesCmd_copy&quot;</span>
<a href="#l15.5"></a><span id="l15.5">              oncommand=&quot;goDoPlacesCommand('placesCmd_copy');&quot;/&gt;</span>
<a href="#l15.6"></a><span id="l15.6">     &lt;command id=&quot;placesCmd_paste&quot;</span>
<a href="#l15.7"></a><span id="l15.7">              oncommand=&quot;goDoPlacesCommand('placesCmd_paste');&quot;/&gt;</span>
<a href="#l15.8"></a><span id="l15.8">     &lt;command id=&quot;placesCmd_delete&quot;</span>
<a href="#l15.9"></a><span id="l15.9">              oncommand=&quot;goDoPlacesCommand('placesCmd_delete');&quot;/&gt;</span>
<a href="#l15.10"></a><span id="l15.10">   &lt;/commandset&gt;</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+  &lt;panel id=&quot;editBookmarkPanel&quot;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+          orient=&quot;vertical&quot;</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+          ignorekeys=&quot;true&quot;</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+          hidden=&quot;true&quot;</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+          onpopupshown=&quot;StarUI.panelShown(event);&quot;</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+          aria-labelledby=&quot;editBookmarkPanelTitle&quot;&gt;</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+    &lt;row id=&quot;editBookmarkPanelHeader&quot; align=&quot;center&quot; hidden=&quot;true&quot;&gt;</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+      &lt;vbox align=&quot;center&quot;&gt;</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+        &lt;image id=&quot;editBookmarkPanelStarIcon&quot;/&gt;</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+      &lt;vbox&gt;</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+        &lt;label id=&quot;editBookmarkPanelTitle&quot;/&gt;</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+        &lt;description id=&quot;editBookmarkPanelDescription&quot;/&gt;</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineplus">+          &lt;button id=&quot;editBookmarkPanelRemoveButton&quot;</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+                  class=&quot;editBookmarkPanelHeaderButton&quot;</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineplus">+                  oncommand=&quot;StarUI.removeBookmarkButtonCommand();&quot;</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+                  accesskey=&quot;&amp;editBookmark.removeBookmark.accessKey;&quot;/&gt;</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+    &lt;/row&gt;</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+    &lt;vbox id=&quot;editBookmarkPanelContent&quot; flex=&quot;1&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+    &lt;hbox id=&quot;editBookmarkPanelBottomButtons&quot; pack=&quot;end&quot;&gt;</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+      &lt;button id=&quot;editBookmarkPanelDeleteButton&quot;</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+              class=&quot;editBookmarkPanelBottomButton&quot;</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+              label=&quot;&amp;editBookmark.cancel.label;&quot;</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+              oncommand=&quot;StarUI.cancelButtonOnCommand();&quot;/&gt;</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+      &lt;button id=&quot;editBookmarkPanelDoneButton&quot;</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+              class=&quot;editBookmarkPanelBottomButton&quot;</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+              label=&quot;&amp;editBookmark.done.label;&quot;</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineplus">+              default=&quot;true&quot;</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+              oncommand=&quot;StarUI.panel.hidePopup();&quot;/&gt;</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+  &lt;/panel&gt;</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+</span>
<a href="#l15.47"></a><span id="l15.47">   &lt;menupopup id=&quot;placesContext&quot;</span>
<a href="#l15.48"></a><span id="l15.48">              onpopupshowing=&quot;this._view = PlacesUIUtils.getViewForNode(document.popupNode);</span>
<a href="#l15.49"></a><span id="l15.49">                              return this._view.buildContextMenu(this);&quot;</span>
<a href="#l15.50"></a><span id="l15.50">              onpopuphiding=&quot;this._view.destroyContextMenu();&quot;&gt;</span>
<a href="#l15.51"></a><span id="l15.51">     &lt;menuitem id=&quot;placesContext_open&quot;</span>
<a href="#l15.52"></a><span id="l15.52">               command=&quot;placesCmd_open&quot;</span>
<a href="#l15.53"></a><span id="l15.53">               label=&quot;&amp;cmd.open.label;&quot;</span>
<a href="#l15.54"></a><span id="l15.54">               accesskey=&quot;&amp;cmd.open.accesskey;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/common/history/history.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/common/history/history.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -182,34 +182,37 @@ function ToggleColumn(aMenuItem)</span>
<a href="#l16.4"></a><span id="l16.4"> function GroupBy(aMenuItem)</span>
<a href="#l16.5"></a><span id="l16.5"> {</span>
<a href="#l16.6"></a><span id="l16.6">   gSearchBox.value = &quot;&quot;;</span>
<a href="#l16.7"></a><span id="l16.7">   gHistoryGrouping = aMenuItem.id.replace(/GroupBy/, &quot;&quot;).toLowerCase();</span>
<a href="#l16.8"></a><span id="l16.8">   gPrefService.setCharPref(&quot;browser.history.grouping&quot;, gHistoryGrouping);</span>
<a href="#l16.9"></a><span id="l16.9">   searchHistory(&quot;&quot;);</span>
<a href="#l16.10"></a><span id="l16.10"> }</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-// we need bookmarks.js to set bookmarks!</span>
<a href="#l16.13"></a><span id="l16.13"> function historyAddBookmarks()</span>
<a href="#l16.14"></a><span id="l16.14"> {</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+  // HACK: as we're importing the actual PlacesUIUtils but that name is taken</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+  // by a cut-down history-specific version, store that latter one temporarily</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+  var HistoryUtils = PlacesUIUtils;</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+  Components.utils.import(&quot;resource:///modules/PlacesUIUtils.jsm&quot;);</span>
<a href="#l16.19"></a><span id="l16.19">   var count = gHistoryTree.view.selection.count;</span>
<a href="#l16.20"></a><span id="l16.20">   if (count == 1)</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">-    BookmarksUtils.addBookmark(gHistoryTree.selectedNode.uri,</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">-                               gHistoryTree.selectedNode.title, null, true);</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+    PlacesUIUtils.showMinimalAddBookmarkUI(PlacesUtils._uri(gHistoryTree.selectedNode.uri),</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+                                           gHistoryTree.selectedNode.title);</span>
<a href="#l16.25"></a><span id="l16.25">   else if (count &gt; 1) {</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-    if (!BMSVC) {</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-      initServices();</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">-      initBMService();</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">-    }</span>
<a href="#l16.30"></a><span id="l16.30">     selNodes = gHistoryTree.getSelectionNodes();</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+    var tabList = [];</span>
<a href="#l16.32"></a><span id="l16.32">     for (var i = 0; i &lt; selNodes.length; i++) {</span>
<a href="#l16.33"></a><span id="l16.33">       if (PlacesUtils.nodeIsURI(selNodes[i]))</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-        BookmarksUtils.addBookmark(selNodes[i].uri, selNodes[i].title, null, false);</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+        tabList.push(PlacesUtils._uri(selNodes[i].uri));</span>
<a href="#l16.36"></a><span id="l16.36">     }</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+    PlacesUIUtils.showMinimalAddMultiBookmarkUI(tabList);</span>
<a href="#l16.38"></a><span id="l16.38">   }</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+  // restore the PlacesUIUtils the history UI actually wants</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+  PlacesUIUtils = HistoryUtils;</span>
<a href="#l16.41"></a><span id="l16.41"> }</span>
<a href="#l16.42"></a><span id="l16.42"> </span>
<a href="#l16.43"></a><span id="l16.43"> function searchHistory(aInput)</span>
<a href="#l16.44"></a><span id="l16.44"> {</span>
<a href="#l16.45"></a><span id="l16.45">   var query = PlacesUtils.history.getNewQuery();</span>
<a href="#l16.46"></a><span id="l16.46">   var options = PlacesUtils.history.getNewQueryOptions();</span>
<a href="#l16.47"></a><span id="l16.47"> </span>
<a href="#l16.48"></a><span id="l16.48">   const NHQO = Components.interfaces.nsINavHistoryQueryOptions;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/suite/common/history/placesOverlay.xul</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/suite/common/history/placesOverlay.xul</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -49,18 +49,16 @@</span>
<a href="#l17.4"></a><span id="l17.4"> </span>
<a href="#l17.5"></a><span id="l17.5"> &lt;overlay id=&quot;placesOverlay&quot;</span>
<a href="#l17.6"></a><span id="l17.6">          xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l17.7"></a><span id="l17.7">          xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l17.10"></a><span id="l17.10">           src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l17.11"></a><span id="l17.11">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-          src=&quot;chrome://communicator/content/bookmarks/bookmarks.js&quot;/&gt;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l17.14"></a><span id="l17.14">           src=&quot;chrome://communicator/content/history/history.js&quot;/&gt;</span>
<a href="#l17.15"></a><span id="l17.15">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l17.16"></a><span id="l17.16">           src=&quot;chrome://communicator/content/history/utils.js&quot;/&gt;</span>
<a href="#l17.17"></a><span id="l17.17">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l17.18"></a><span id="l17.18">           src=&quot;chrome://communicator/content/history/controller.js&quot;/&gt;</span>
<a href="#l17.19"></a><span id="l17.19">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l17.20"></a><span id="l17.20">           src=&quot;chrome://communicator/content/history/treeView.js&quot;/&gt;</span>
<a href="#l17.21"></a><span id="l17.21">   &lt;script type=&quot;application/javascript&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/suite/common/jar.mn</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/suite/common/jar.mn</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -106,33 +106,29 @@ comm.jar:</span>
<a href="#l18.4"></a><span id="l18.4"> #endif</span>
<a href="#l18.5"></a><span id="l18.5"> #endif</span>
<a href="#l18.6"></a><span id="l18.6"> #endif</span>
<a href="#l18.7"></a><span id="l18.7">    content/communicator/bindings/findbar.xml                        (bindings/findbar.xml)</span>
<a href="#l18.8"></a><span id="l18.8">    content/communicator/bindings/general.xml                        (bindings/general.xml)</span>
<a href="#l18.9"></a><span id="l18.9">    content/communicator/bindings/notification.xml                   (bindings/notification.xml)</span>
<a href="#l18.10"></a><span id="l18.10">    content/communicator/bindings/toolbar.xml                        (bindings/toolbar.xml)</span>
<a href="#l18.11"></a><span id="l18.11"> *  content/communicator/bindings/prefwindow.xml                     (bindings/prefwindow.xml)</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-   content/communicator/bookmarks/addBookmark.js                    (bookmarks/addBookmark.js)</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-   content/communicator/bookmarks/addBookmark.xul                   (bookmarks/addBookmark.xul)</span>
<a href="#l18.14"></a><span id="l18.14">    content/communicator/bookmarks/bm-panel.js                       (bookmarks/bm-panel.js)</span>
<a href="#l18.15"></a><span id="l18.15">    content/communicator/bookmarks/bm-panel.xul                      (bookmarks/bm-panel.xul)</span>
<a href="#l18.16"></a><span id="l18.16">    content/communicator/bookmarks/bm-props.js                       (bookmarks/bm-props.js)</span>
<a href="#l18.17"></a><span id="l18.17">    content/communicator/bookmarks/bm-props.xul                      (bookmarks/bm-props.xul)</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-   content/communicator/bookmarks/bookmarks.css                     (bookmarks/bookmarks.css)</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">-   content/communicator/bookmarks/bookmarks.js                      (bookmarks/bookmarks.js)</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+# Provide another URI for the bookmark properties dialog so we can persist the attributes separately</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+% override chrome://communicator/content/bookmarks/bm-props2.xul chrome://communicator/content/bookmarks/bm-props.xul</span>
<a href="#l18.22"></a><span id="l18.22">    content/communicator/bookmarks/bookmarksManager.js               (bookmarks/bookmarksManager.js)</span>
<a href="#l18.23"></a><span id="l18.23">    content/communicator/bookmarks/bookmarksManager.xul              (bookmarks/bookmarksManager.xul)</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-   content/communicator/bookmarks/bookmarksOverlay.xul              (bookmarks/bookmarksOverlay.xul)</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-   content/communicator/bookmarks/bookmarksTree.xml                 (bookmarks/bookmarksTree.xml)</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineminus">-   content/communicator/bookmarks/findBookmark.js                   (bookmarks/findBookmark.js)</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineminus">-   content/communicator/bookmarks/findBookmark.xul                  (bookmarks/findBookmark.xul)</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineminus">-   content/communicator/bookmarks/sortFolder.js                     (bookmarks/sortFolder.js)</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineminus">-   content/communicator/bookmarks/sortFolder.xul                    (bookmarks/sortFolder.xul)</span>
<a href="#l18.30"></a><span id="l18.30">    content/communicator/bookmarks/browser-places.js                 (bookmarks/browser-places.js)</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+   content/communicator/bookmarks/editBookmarkOverlay.js            (bookmarks/editBookmarkOverlay.js)</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+   content/communicator/bookmarks/editBookmarkOverlay.xul           (bookmarks/editBookmarkOverlay.xul)</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+   content/communicator/bookmarks/moveBookmarks.js                  (bookmarks/moveBookmarks.js)</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+   content/communicator/bookmarks/moveBookmarks.xul                 (bookmarks/moveBookmarks.xul)</span>
<a href="#l18.35"></a><span id="l18.35">    content/communicator/bookmarks/placesOverlay.xul                 (bookmarks/placesOverlay.xul)</span>
<a href="#l18.36"></a><span id="l18.36">    content/communicator/directory/directory.html                    (directory/directory.html)</span>
<a href="#l18.37"></a><span id="l18.37">    content/communicator/directory/directory.js                      (directory/directory.js)</span>
<a href="#l18.38"></a><span id="l18.38">    content/communicator/directory/directory.xul                     (directory/directory.xul)</span>
<a href="#l18.39"></a><span id="l18.39">    content/communicator/downloads/downloadmanager.js                (downloads/downloadmanager.js)</span>
<a href="#l18.40"></a><span id="l18.40">    content/communicator/downloads/downloadmanager.xul               (downloads/downloadmanager.xul)</span>
<a href="#l18.41"></a><span id="l18.41">    content/communicator/downloads/DownloadProgressListener.js       (downloads/DownloadProgressListener.js)</span>
<a href="#l18.42"></a><span id="l18.42">    content/communicator/downloads/progressDialog.xul                (downloads/progressDialog.xul)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/locales/en-US/chrome/browser/navigator.properties</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/browser/navigator.properties</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -56,8 +56,21 @@ lwthemePostInstallNotification.manageBut</span>
<a href="#l19.4"></a><span id="l19.4"> menuOpenAllInTabs.label=Open All in Tabs</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6"> # urlbarBindings.xml</span>
<a href="#l19.7"></a><span id="l19.7"> # LOCALIZATION NOTE: This is for the location bar drop-down string:</span>
<a href="#l19.8"></a><span id="l19.8"> #   &quot;Search &quot; + search_engine_name + &quot; for &quot; + user_input</span>
<a href="#l19.9"></a><span id="l19.9"> #   e.g. &quot;Search Google for abc&quot;</span>
<a href="#l19.10"></a><span id="l19.10"> # DO NOT change the %S order when translate, the first %S must be the search engine name.</span>
<a href="#l19.11"></a><span id="l19.11"> searchFor=Search %S for &quot;%S&quot;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+# Edit Bookmark UI</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+editBookmarkPanel.pageBookmarkedTitle=Page Bookmarked</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+editBookmarkPanel.pageBookmarkedDescription=%S will always remember this page for you.</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+editBookmarkPanel.bookmarkedRemovedTitle=Bookmark Removed</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+editBookmarkPanel.editBookmarkTitle=Edit This Bookmark</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+# LOCALIZATION NOTE (editBookmark.removeBookmarks.label)</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+# Semi-colon list of plural forms. Replacement for #1 is</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineplus">+# the number of bookmarks to be removed.</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineplus">+# If this causes problems with localization you can also do &quot;Remove Bookmarks (#1)&quot;</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+# instead of &quot;Remove #1 Bookmarks&quot;.</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+editBookmark.removeBookmarks.label=Remove Bookmark;Remove #1 Bookmarks</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">new file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- /dev/null</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/bookmarks/bm-props.properties</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -0,0 +1,15 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineplus">+dialogAcceptLabelAddItem=Add</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineplus">+dialogAcceptLabelSaveItem=Save</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineplus">+dialogAcceptLabelAddLivemark=Subscribe</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineplus">+dialogAcceptLabelAddMulti=Add Bookmarks</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineplus">+dialogAcceptLabelEdit=Save</span>
<a href="#l20.10"></a><span id="l20.10" class="difflineplus">+dialogTitleAddBookmark=New Bookmark</span>
<a href="#l20.11"></a><span id="l20.11" class="difflineplus">+dialogTitleAddLivemark=Subscribe with Live Bookmark</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+dialogTitleAddFolder=New Folder</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+dialogTitleAddMulti=New Bookmarks</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+dialogTitleEdit=Properties for &quot;%S&quot;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+bookmarkAllTabsDefault=[Folder Name]</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+newFolderDefault=New Folder</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+newBookmarkDefault=New Bookmark</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+newLivemarkDefault=New Live Bookmark</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">new file mode 100644</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineminus">--- /dev/null</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/bookmarks/editBookmarkOverlay.dtd</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineat">@@ -0,0 +1,25 @@</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.name.label                      &quot;Name:&quot;&gt;</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.name.accesskey                  &quot;N&quot;&gt;</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.location.label                  &quot;Location:&quot;&gt;</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.location.accesskey              &quot;L&quot;&gt;</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.feedLocation.label              &quot;Feed Location:&quot;&gt;</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.feedLocation.accesskey          &quot;F&quot;&gt;</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.siteLocation.label              &quot;Site Location:&quot;&gt;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.siteLocation.accesskey          &quot;S&quot;&gt;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.liveTitlesSeparator.label       &quot;Live Titles&quot;&gt;</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.folder.label                    &quot;Folder:&quot;&gt;</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.foldersExpanderDown.tooltip     &quot;Show all the bookmarks folders&quot;&gt;</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.expanderUp.tooltip              &quot;Hide&quot;&gt;</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.tags.label                      &quot;Tags:&quot;&gt;</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.tags.accesskey                  &quot;T&quot;&gt;</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.tagsEmptyDesc.label             &quot;Separate tags with commas&quot;&gt;</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.description.label               &quot;Description:&quot;&gt;</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.description.accesskey           &quot;D&quot;&gt;</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.keyword.label                   &quot;Keyword:&quot;&gt;</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.keyword.accesskey               &quot;K&quot;&gt;</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.tagsExpanderDown.tooltip        &quot;Show all tags&quot;&gt;</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.loadInSidebar.label             &quot;Load this bookmark in the sidebar&quot;&gt;</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.loadInSidebar.accesskey         &quot;h&quot;&gt;</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.choose.label                    &quot;Choose&quot;&gt;</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.newFolderButton.label           &quot;New Folder&quot;&gt;</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+&lt;!ENTITY editBookmarkOverlay.newFolderButton.accesskey       &quot;o&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">new file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- /dev/null</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/bookmarks/moveBookmarks.dtd</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -0,0 +1,5 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineplus">+&lt;!ENTITY window.title              &quot;Choose Folder&quot;&gt;</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineplus">+&lt;!ENTITY window.style              &quot;width: 36em; height: 18em;&quot;&gt;</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineplus">+&lt;!ENTITY moveTo.label              &quot;Move to:&quot;&gt;</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineplus">+&lt;!ENTITY newFolderButton.label     &quot;New Folder&quot;&gt;</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineplus">+&lt;!ENTITY newFolderButton.accesskey &quot;N&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/suite/locales/en-US/chrome/common/bookmarks/places.dtd</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/bookmarks/places.dtd</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -97,8 +97,12 @@</span>
<a href="#l23.4"></a><span id="l23.4"> &lt;!ENTITY backButton.tooltip  &quot;Go back&quot;&gt;</span>
<a href="#l23.5"></a><span id="l23.5"> &lt;!ENTITY forwardButton.tooltip  &quot;Go forward&quot;&gt;</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7"> &lt;!ENTITY detailsPane.more.label &quot;More&quot;&gt;</span>
<a href="#l23.8"></a><span id="l23.8"> &lt;!ENTITY detailsPane.more.accesskey &quot;e&quot;&gt;</span>
<a href="#l23.9"></a><span id="l23.9"> &lt;!ENTITY detailsPane.less.label &quot;Less&quot;&gt;</span>
<a href="#l23.10"></a><span id="l23.10"> &lt;!ENTITY detailsPane.less.accesskey &quot;e&quot;&gt;</span>
<a href="#l23.11"></a><span id="l23.11"> &lt;!ENTITY detailsPane.selectAnItemText.description &quot;Select an item to view and edit its properties&quot;&gt;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+&lt;!ENTITY editBookmark.done.label &quot;Done&quot;&gt;</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+&lt;!ENTITY editBookmark.cancel.label &quot;Cancel&quot;&gt;</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+&lt;!ENTITY editBookmark.removeBookmark.accessKey &quot;R&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/suite/locales/jar.mn</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/suite/locales/jar.mn</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -38,22 +38,19 @@</span>
<a href="#l24.4"></a><span id="l24.4">   locale/@AB_CD@/communicator/sanitize.dtd                                  (%chrome/common/sanitize.dtd)</span>
<a href="#l24.5"></a><span id="l24.5">   locale/@AB_CD@/communicator/tasksOverlay.dtd                              (%chrome/common/tasksOverlay.dtd)</span>
<a href="#l24.6"></a><span id="l24.6">   locale/@AB_CD@/communicator/typeaheadfind.properties                      (%chrome/common/typeaheadfind.properties)</span>
<a href="#l24.7"></a><span id="l24.7">   locale/@AB_CD@/communicator/utilityOverlay.dtd                            (%chrome/common/utilityOverlay.dtd)</span>
<a href="#l24.8"></a><span id="l24.8">   locale/@AB_CD@/communicator/utilityOverlay.properties                     (%chrome/common/utilityOverlay.properties)</span>
<a href="#l24.9"></a><span id="l24.9">   locale/@AB_CD@/communicator/viewZoomOverlay.dtd                           (%chrome/common/viewZoomOverlay.dtd)</span>
<a href="#l24.10"></a><span id="l24.10">   locale/@AB_CD@/communicator/viewZoomOverlay.properties                    (%chrome/common/viewZoomOverlay.properties)</span>
<a href="#l24.11"></a><span id="l24.11">   locale/@AB_CD@/communicator/aboutSessionRestore.dtd                       (%chrome/common/aboutSessionRestore.dtd)</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  locale/@AB_CD@/communicator/bookmarks/addBookmark.dtd                     (%chrome/common/bookmarks/addBookmark.dtd)</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-  locale/@AB_CD@/communicator/bookmarks/bm-props.dtd                        (%chrome/common/bookmarks/bm-props.dtd)</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-  locale/@AB_CD@/communicator/bookmarks/bookmarks.dtd                       (%chrome/common/bookmarks/bookmarks.dtd)</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-  locale/@AB_CD@/communicator/bookmarks/bookmarks.properties                (%chrome/common/bookmarks/bookmarks.properties)</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">-  locale/@AB_CD@/communicator/bookmarks/findBookmark.dtd                    (%chrome/common/bookmarks/findBookmark.dtd)</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">-  locale/@AB_CD@/communicator/bookmarks/sortFolder.dtd                      (%chrome/common/bookmarks/sortFolder.dtd)</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+  locale/@AB_CD@/communicator/bookmarks/bm-props.properties                 (%chrome/common/bookmarks/bm-props.properties)</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+  locale/@AB_CD@/communicator/bookmarks/editBookmarkOverlay.dtd             (%chrome/common/bookmarks/editBookmarkOverlay.dtd)</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+  locale/@AB_CD@/communicator/bookmarks/moveBookmarks.dtd                   (%chrome/common/bookmarks/moveBookmarks.dtd)</span>
<a href="#l24.21"></a><span id="l24.21">   locale/@AB_CD@/communicator/bookmarks/places.dtd                          (%chrome/common/bookmarks/places.dtd)</span>
<a href="#l24.22"></a><span id="l24.22">   locale/@AB_CD@/communicator/directory/directory.dtd                       (%chrome/common/directory/directory.dtd)</span>
<a href="#l24.23"></a><span id="l24.23">   locale/@AB_CD@/communicator/downloads/downloadmanager.dtd                 (%chrome/common/downloads/downloadmanager.dtd)</span>
<a href="#l24.24"></a><span id="l24.24">   locale/@AB_CD@/communicator/downloads/downloadmanager.properties          (%chrome/common/downloads/downloadmanager.properties)</span>
<a href="#l24.25"></a><span id="l24.25">   locale/@AB_CD@/communicator/downloads/progressDialog.dtd                  (%chrome/common/downloads/progressDialog.dtd)</span>
<a href="#l24.26"></a><span id="l24.26">   locale/@AB_CD@/communicator/help/cert_dialog_help.xhtml                   (%chrome/common/help/cert_dialog_help.xhtml)</span>
<a href="#l24.27"></a><span id="l24.27">   locale/@AB_CD@/communicator/help/certs_help.xhtml                         (%chrome/common/help/certs_help.xhtml)</span>
<a href="#l24.28"></a><span id="l24.28">   locale/@AB_CD@/communicator/help/certs_prefs_help.xhtml                   (%chrome/common/help/certs_prefs_help.xhtml)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/suite/mailnews/mailWindowOverlay.xul</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/suite/mailnews/mailWindowOverlay.xul</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -69,19 +69,22 @@</span>
<a href="#l25.4"></a><span id="l25.4"> </span>
<a href="#l25.5"></a><span id="l25.5"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/mailCommands.js&quot;/&gt;</span>
<a href="#l25.6"></a><span id="l25.6"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/junkCommands.js&quot;/&gt;</span>
<a href="#l25.7"></a><span id="l25.7"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/mailWindowOverlay.js&quot;/&gt;</span>
<a href="#l25.8"></a><span id="l25.8"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/msgViewPickerOverlay.js&quot;/&gt;</span>
<a href="#l25.9"></a><span id="l25.9"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger-newsblog/content/newsblogOverlay.js&quot;/&gt;</span>
<a href="#l25.10"></a><span id="l25.10"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/mail-offline.js&quot;/&gt;</span>
<a href="#l25.11"></a><span id="l25.11"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/findUtils.js&quot;/&gt;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-&lt;script type=&quot;application/javascript&quot; src=&quot;chrome://communicator/content/bookmarks/bookmarks.js&quot;/&gt;</span>
<a href="#l25.13"></a><span id="l25.13"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://global/content/printUtils.js&quot;/&gt;</span>
<a href="#l25.14"></a><span id="l25.14"> &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/folderDisplay.js&quot;/&gt;</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+&lt;script type=&quot;application/javascript&quot;&gt;&lt;![CDATA[</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+  Components.utils.import(&quot;resource://gre/modules/PlacesUtils.jsm&quot;);</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+  Components.utils.import(&quot;resource:///modules/PlacesUIUtils.jsm&quot;);</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineplus">+]]&gt;&lt;/script&gt;</span>
<a href="#l25.19"></a><span id="l25.19"> </span>
<a href="#l25.20"></a><span id="l25.20"> &lt;stringbundleset id=&quot;stringbundleset&quot;&gt;</span>
<a href="#l25.21"></a><span id="l25.21">   &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l25.22"></a><span id="l25.22">   &lt;stringbundle id=&quot;bundle_offlinePrompts&quot; src=&quot;chrome://messenger/locale/offline.properties&quot;/&gt;</span>
<a href="#l25.23"></a><span id="l25.23">   &lt;stringbundle id=&quot;bundle_viewZoom&quot;/&gt;</span>
<a href="#l25.24"></a><span id="l25.24">   &lt;stringbundle id=&quot;findBundle&quot; src=&quot;chrome://global/locale/finddialog.properties&quot;/&gt;</span>
<a href="#l25.25"></a><span id="l25.25"> &lt;/stringbundleset&gt;</span>
<a href="#l25.26"></a><span id="l25.26"> </span>
<a href="#l25.27"></a><span id="l25.27" class="difflineat">@@ -925,19 +928,18 @@</span>
<a href="#l25.28"></a><span id="l25.28">               oncommand=&quot;gContextMenu.saveLink();&quot;/&gt;</span>
<a href="#l25.29"></a><span id="l25.29">     &lt;menuitem id=&quot;context-saveimage&quot;</span>
<a href="#l25.30"></a><span id="l25.30">               label=&quot;&amp;saveImageCmd.label;&quot;</span>
<a href="#l25.31"></a><span id="l25.31">               accesskey=&quot;&amp;saveImageCmd.accesskey;&quot;</span>
<a href="#l25.32"></a><span id="l25.32">               oncommand=&quot;gContextMenu.saveImage();&quot;/&gt;</span>
<a href="#l25.33"></a><span id="l25.33">     &lt;menuitem id=&quot;context-bookmarklink&quot;</span>
<a href="#l25.34"></a><span id="l25.34">               label=&quot;&amp;bookmarkLinkCmd.label;&quot;</span>
<a href="#l25.35"></a><span id="l25.35">               accesskey=&quot;&amp;bookmarkLinkCmd.accesskey;&quot;</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineminus">-              oncommand=&quot;initBMService();</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineminus">-                         BookmarksUtils.addBookmark(gContextMenu.linkURL,</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineminus">-                                                    gContextMenu.linkText());&quot;/&gt;</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineplus">+              oncommand=&quot;PlacesUIUtils.showMinimalAddBookmarkUI(makeURI(gContextMenu.linkURL),</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineplus">+                                                                gContextMenu.linkText());&quot;/&gt;</span>
<a href="#l25.41"></a><span id="l25.41">   &lt;/menupopup&gt;</span>
<a href="#l25.42"></a><span id="l25.42"> </span>
<a href="#l25.43"></a><span id="l25.43">   &lt;toolbar type=&quot;menubar&quot;</span>
<a href="#l25.44"></a><span id="l25.44">            id=&quot;mail-toolbar-menubar2&quot;</span>
<a href="#l25.45"></a><span id="l25.45">            class=&quot;chromeclass-menubar&quot;</span>
<a href="#l25.46"></a><span id="l25.46">            persist=&quot;collapsed&quot;</span>
<a href="#l25.47"></a><span id="l25.47">            grippytooltiptext=&quot;&amp;menuBar.tooltip;&quot;</span>
<a href="#l25.48"></a><span id="l25.48">            customizable=&quot;true&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1">new file mode 100644</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineminus">--- /dev/null</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineplus">+++ b/suite/themes/classic/communicator/bookmarks/bookmarksManager.css</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineat">@@ -0,0 +1,71 @@</span>
<a href="#l26.5"></a><span id="l26.5" class="difflineplus">+</span>
<a href="#l26.6"></a><span id="l26.6" class="difflineplus">+/* Place List, Place Content */</span>
<a href="#l26.7"></a><span id="l26.7" class="difflineplus">+.placesTree {</span>
<a href="#l26.8"></a><span id="l26.8" class="difflineplus">+  margin: 0px;</span>
<a href="#l26.9"></a><span id="l26.9" class="difflineplus">+}</span>
<a href="#l26.10"></a><span id="l26.10" class="difflineplus">+</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineplus">+#placesList {</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+  margin: 0px;</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+  border: none;</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+  padding: 0;</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+}</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineplus">+#placeContent {</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineplus">+  border: 0px;</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineplus">+}</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineplus">+</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineplus">+#infoPaneBox {</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineplus">+  border-top: 1px solid ThreeDShadow;</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineplus">+  padding: 5px;</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineplus">+}</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineplus">+</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineplus">+.small, .small[disabled=&quot;true&quot;] {</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineplus">+  min-width: 0px;</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineplus">+  padding: 0px 4px 0px 4px;</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineplus">+  margin: 0px;  </span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+  border: 0px;</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+}</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineplus">+.small .button-text,</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+.small .button-box {</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineplus">+  padding: 0px;</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineplus">+  border: 0px;</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineplus">+}</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineplus">+</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineplus">+#infoBoxExpanderLabel {</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineplus">+  -moz-padding-start: 2px;</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+}</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineplus">+</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineplus">+#organizerScopeBar {</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineplus">+  -moz-appearance: toolbox;</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineplus">+  padding: 2px 0;</span>
<a href="#l26.48"></a><span id="l26.48" class="difflineplus">+  -moz-padding-end: 3px;</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineplus">+}</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineplus">+</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineplus">+#organizerScopeBar &gt; toolbarbutton {</span>
<a href="#l26.52"></a><span id="l26.52" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineplus">+  border: 1px solid transparent;</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineplus">+  -moz-border-radius: 2px;</span>
<a href="#l26.55"></a><span id="l26.55" class="difflineplus">+  padding: 0 !important;</span>
<a href="#l26.56"></a><span id="l26.56" class="difflineplus">+  margin: 0 1px;</span>
<a href="#l26.57"></a><span id="l26.57" class="difflineplus">+}</span>
<a href="#l26.58"></a><span id="l26.58" class="difflineplus">+</span>
<a href="#l26.59"></a><span id="l26.59" class="difflineplus">+#organizerScopeBar &gt; toolbarbutton &gt; .toolbarbutton-icon {</span>
<a href="#l26.60"></a><span id="l26.60" class="difflineplus">+  padding: 0;</span>
<a href="#l26.61"></a><span id="l26.61" class="difflineplus">+  margin: 0;</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineplus">+}</span>
<a href="#l26.63"></a><span id="l26.63" class="difflineplus">+</span>
<a href="#l26.64"></a><span id="l26.64" class="difflineplus">+#organizerScopeBar &gt; toolbarbutton &gt; .toolbarbutton-text {</span>
<a href="#l26.65"></a><span id="l26.65" class="difflineplus">+   margin: 0;</span>
<a href="#l26.66"></a><span id="l26.66" class="difflineplus">+   padding: 2px 5px;</span>
<a href="#l26.67"></a><span id="l26.67" class="difflineplus">+}</span>
<a href="#l26.68"></a><span id="l26.68" class="difflineplus">+</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineplus">+#organizerScopeBar &gt; toolbarbutton:not([disabled=&quot;true&quot;]):not([checked=&quot;true&quot;]):hover {</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+  border-color: ThreeDShadow;</span>
<a href="#l26.71"></a><span id="l26.71" class="difflineplus">+}</span>
<a href="#l26.72"></a><span id="l26.72" class="difflineplus">+</span>
<a href="#l26.73"></a><span id="l26.73" class="difflineplus">+#organizerScopeBar &gt; toolbarbutton[checked=&quot;true&quot;] {</span>
<a href="#l26.74"></a><span id="l26.74" class="difflineplus">+  border-color: ThreeDDarkShadow !important;</span>
<a href="#l26.75"></a><span id="l26.75" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1">new file mode 100644</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineminus">--- /dev/null</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineplus">+++ b/suite/themes/classic/communicator/bookmarks/editBookmarkOverlay.css</span>
<a href="#l27.4"></a><span id="l27.4" class="difflineat">@@ -0,0 +1,147 @@</span>
<a href="#l27.5"></a><span id="l27.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l27.6"></a><span id="l27.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l27.7"></a><span id="l27.7" class="difflineplus">+ *</span>
<a href="#l27.8"></a><span id="l27.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l27.9"></a><span id="l27.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l27.10"></a><span id="l27.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l27.11"></a><span id="l27.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+ *</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineplus">+ * License.</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineplus">+ *</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineplus">+ * The Original Code is Firefox.</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineplus">+ *</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineplus">+ * The Initial Developer of the Original Code is Mozilla.</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2006</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineplus">+ *</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineplus">+ * Contributor(s):</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineplus">+ *   Myk Melez &lt;myk@mozilla.org&gt;</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineplus">+ *</span>
<a href="#l27.28"></a><span id="l27.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineplus">+ *</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineplus">+</span>
<a href="#l27.42"></a><span id="l27.42" class="difflineplus">+/**** folder menulist ****/</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineplus">+.folder-icon &gt; .menulist-label-box &gt; .menulist-icon {</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineplus">+  width: 16px;</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineplus">+  height: 16px;</span>
<a href="#l27.46"></a><span id="l27.46" class="difflineplus">+}</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineplus">+</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineplus">+.folder-icon &gt; .menu-iconic-left {</span>
<a href="#l27.49"></a><span id="l27.49" class="difflineplus">+  display: -moz-box;</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineplus">+}</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineplus">+</span>
<a href="#l27.52"></a><span id="l27.52" class="difflineplus">+.folder-icon {</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/folder-item.png&quot;) !important;</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineplus">+  -moz-image-region: rect(0px, 32px, 16px, 16px) !important;</span>
<a href="#l27.55"></a><span id="l27.55" class="difflineplus">+}</span>
<a href="#l27.56"></a><span id="l27.56" class="difflineplus">+</span>
<a href="#l27.57"></a><span id="l27.57" class="difflineplus">+</span>
<a href="#l27.58"></a><span id="l27.58" class="difflineplus">+/**** expanders ****/</span>
<a href="#l27.59"></a><span id="l27.59" class="difflineplus">+</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineplus">+.expander-up,</span>
<a href="#l27.61"></a><span id="l27.61" class="difflineplus">+.expander-down {</span>
<a href="#l27.62"></a><span id="l27.62" class="difflineplus">+  min-width: 0;</span>
<a href="#l27.63"></a><span id="l27.63" class="difflineplus">+  padding: 2px 0;</span>
<a href="#l27.64"></a><span id="l27.64" class="difflineplus">+  -moz-padding-start: 2px;</span>
<a href="#l27.65"></a><span id="l27.65" class="difflineplus">+}</span>
<a href="#l27.66"></a><span id="l27.66" class="difflineplus">+</span>
<a href="#l27.67"></a><span id="l27.67" class="difflineplus">+.expander-up {</span>
<a href="#l27.68"></a><span id="l27.68" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/arrow/arrow-up.gif&quot;);</span>
<a href="#l27.69"></a><span id="l27.69" class="difflineplus">+}</span>
<a href="#l27.70"></a><span id="l27.70" class="difflineplus">+</span>
<a href="#l27.71"></a><span id="l27.71" class="difflineplus">+.expander-down {</span>
<a href="#l27.72"></a><span id="l27.72" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/arrow/arrow-dn.gif&quot;);</span>
<a href="#l27.73"></a><span id="l27.73" class="difflineplus">+}</span>
<a href="#l27.74"></a><span id="l27.74" class="difflineplus">+</span>
<a href="#l27.75"></a><span id="l27.75" class="difflineplus">+.expander-down:hover:active {</span>
<a href="#l27.76"></a><span id="l27.76" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/arrow/arrow-dn-hov.gif&quot;);</span>
<a href="#l27.77"></a><span id="l27.77" class="difflineplus">+}</span>
<a href="#l27.78"></a><span id="l27.78" class="difflineplus">+</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineplus">+.expander-up:hover:active {</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/arrow/arrow-up-hov.gif&quot;);</span>
<a href="#l27.81"></a><span id="l27.81" class="difflineplus">+}</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineplus">+</span>
<a href="#l27.83"></a><span id="l27.83" class="difflineplus">+#editBookmarkPanelContent {</span>
<a href="#l27.84"></a><span id="l27.84" class="difflineplus">+  min-width: 23em;</span>
<a href="#l27.85"></a><span id="l27.85" class="difflineplus">+}</span>
<a href="#l27.86"></a><span id="l27.86" class="difflineplus">+</span>
<a href="#l27.87"></a><span id="l27.87" class="difflineplus">+#editBMPanel_folderTree {</span>
<a href="#l27.88"></a><span id="l27.88" class="difflineplus">+  margin-top: 2px;</span>
<a href="#l27.89"></a><span id="l27.89" class="difflineplus">+  margin-bottom: 2px;</span>
<a href="#l27.90"></a><span id="l27.90" class="difflineplus">+}</span>
<a href="#l27.91"></a><span id="l27.91" class="difflineplus">+</span>
<a href="#l27.92"></a><span id="l27.92" class="difflineplus">+</span>
<a href="#l27.93"></a><span id="l27.93" class="difflineplus">+/**** name picker ****/</span>
<a href="#l27.94"></a><span id="l27.94" class="difflineplus">+</span>
<a href="#l27.95"></a><span id="l27.95" class="difflineplus">+/* Make the microsummary picker look like a regular textbox instead of</span>
<a href="#l27.96"></a><span id="l27.96" class="difflineplus">+ * an editable menulist when no microsummaries are available.</span>
<a href="#l27.97"></a><span id="l27.97" class="difflineplus">+ */</span>
<a href="#l27.98"></a><span id="l27.98" class="difflineplus">+#editBMPanel_namePicker[droppable=&quot;false&quot;] {</span>
<a href="#l27.99"></a><span id="l27.99" class="difflineplus">+  /* These rules come from the textbox element in textbox.css. */</span>
<a href="#l27.100"></a><span id="l27.100" class="difflineplus">+  -moz-appearance: textfield; /* Normal editable menulists set this to &quot;menulist&quot;. */</span>
<a href="#l27.101"></a><span id="l27.101" class="difflineplus">+  cursor: text;</span>
<a href="#l27.102"></a><span id="l27.102" class="difflineplus">+  border: 2px solid;</span>
<a href="#l27.103"></a><span id="l27.103" class="difflineplus">+  -moz-border-top-colors: ThreeDShadow ThreeDDarkShadow;</span>
<a href="#l27.104"></a><span id="l27.104" class="difflineplus">+  -moz-border-right-colors: ThreeDHighlight ThreeDLightShadow;</span>
<a href="#l27.105"></a><span id="l27.105" class="difflineplus">+  -moz-border-bottom-colors: ThreeDHighlight ThreeDLightShadow;</span>
<a href="#l27.106"></a><span id="l27.106" class="difflineplus">+  -moz-border-left-colors: ThreeDShadow ThreeDDarkShadow;</span>
<a href="#l27.107"></a><span id="l27.107" class="difflineplus">+  padding: 2px 2px 3px;</span>
<a href="#l27.108"></a><span id="l27.108" class="difflineplus">+  -moz-padding-start: 4px;</span>
<a href="#l27.109"></a><span id="l27.109" class="difflineplus">+  background-color: -moz-Field;</span>
<a href="#l27.110"></a><span id="l27.110" class="difflineplus">+  color: -moz-FieldText;</span>
<a href="#l27.111"></a><span id="l27.111" class="difflineplus">+}</span>
<a href="#l27.112"></a><span id="l27.112" class="difflineplus">+</span>
<a href="#l27.113"></a><span id="l27.113" class="difflineplus">+#editBMPanel_namePicker[droppable=&quot;false&quot;] &gt; .menulist-editable-box {</span>
<a href="#l27.114"></a><span id="l27.114" class="difflineplus">+  -moz-appearance: none; /* Normal editable menulists set this to &quot;menulist-textfield&quot;. */</span>
<a href="#l27.115"></a><span id="l27.115" class="difflineplus">+  padding: 0;</span>
<a href="#l27.116"></a><span id="l27.116" class="difflineplus">+}</span>
<a href="#l27.117"></a><span id="l27.117" class="difflineplus">+</span>
<a href="#l27.118"></a><span id="l27.118" class="difflineplus">+#editBMPanel_namePicker[droppable=&quot;false&quot;] &gt; .menulist-dropmarker,</span>
<a href="#l27.119"></a><span id="l27.119" class="difflineplus">+#editBMPanel_namePicker[droppable=&quot;false&quot;] &gt; menupopup {</span>
<a href="#l27.120"></a><span id="l27.120" class="difflineplus">+  display: none;</span>
<a href="#l27.121"></a><span id="l27.121" class="difflineplus">+}</span>
<a href="#l27.122"></a><span id="l27.122" class="difflineplus">+</span>
<a href="#l27.123"></a><span id="l27.123" class="difflineplus">+/* Hide the value column of the tag autocomplete popup</span>
<a href="#l27.124"></a><span id="l27.124" class="difflineplus">+ * leaving only the comment column visible. This is</span>
<a href="#l27.125"></a><span id="l27.125" class="difflineplus">+ * so that only the tag being edited is shown in the</span>
<a href="#l27.126"></a><span id="l27.126" class="difflineplus">+ * popup.</span>
<a href="#l27.127"></a><span id="l27.127" class="difflineplus">+ */</span>
<a href="#l27.128"></a><span id="l27.128" class="difflineplus">+#editBMPanel_tagsField #treecolAutoCompleteValue {</span>
<a href="#l27.129"></a><span id="l27.129" class="difflineplus">+  visibility: collapse;</span>
<a href="#l27.130"></a><span id="l27.130" class="difflineplus">+}</span>
<a href="#l27.131"></a><span id="l27.131" class="difflineplus">+</span>
<a href="#l27.132"></a><span id="l27.132" class="difflineplus">+</span>
<a href="#l27.133"></a><span id="l27.133" class="difflineplus">+/* ::::: bookmark panel dropdown icons ::::: */</span>
<a href="#l27.134"></a><span id="l27.134" class="difflineplus">+</span>
<a href="#l27.135"></a><span id="l27.135" class="difflineplus">+#editBMPanel_folderMenuList[selectedIndex=&quot;0&quot;],</span>
<a href="#l27.136"></a><span id="l27.136" class="difflineplus">+#editBMPanel_toolbarFolderItem {</span>
<a href="#l27.137"></a><span id="l27.137" class="difflineplus">+  list-style-image: url(&quot;chrome://communicator/skin/bookmarks/bookmarksToolbar.png&quot;) !important;</span>
<a href="#l27.138"></a><span id="l27.138" class="difflineplus">+  -moz-image-region: auto !important;</span>
<a href="#l27.139"></a><span id="l27.139" class="difflineplus">+}</span>
<a href="#l27.140"></a><span id="l27.140" class="difflineplus">+</span>
<a href="#l27.141"></a><span id="l27.141" class="difflineplus">+#editBMPanel_folderMenuList[selectedIndex=&quot;1&quot;],</span>
<a href="#l27.142"></a><span id="l27.142" class="difflineplus">+#editBMPanel_bmRootItem {</span>
<a href="#l27.143"></a><span id="l27.143" class="difflineplus">+  list-style-image: url(&quot;chrome://communicator/skin/bookmarks/bookmarksMenu.png&quot;) !important;</span>
<a href="#l27.144"></a><span id="l27.144" class="difflineplus">+  -moz-image-region: auto !important;</span>
<a href="#l27.145"></a><span id="l27.145" class="difflineplus">+}</span>
<a href="#l27.146"></a><span id="l27.146" class="difflineplus">+</span>
<a href="#l27.147"></a><span id="l27.147" class="difflineplus">+#editBMPanel_folderMenuList[selectedIndex=&quot;2&quot;],</span>
<a href="#l27.148"></a><span id="l27.148" class="difflineplus">+#editBMPanel_unfiledRootItem {</span>
<a href="#l27.149"></a><span id="l27.149" class="difflineplus">+  list-style-image: url(&quot;chrome://communicator/skin/bookmarks/unsortedBookmarks.png&quot;) !important;</span>
<a href="#l27.150"></a><span id="l27.150" class="difflineplus">+  -moz-image-region: auto !important;</span>
<a href="#l27.151"></a><span id="l27.151" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1">deleted file mode 100644</span>
<a href="#l28.2"></a><span id="l28.2">index 83cda97a4712ae9999eb14d56dfc4b3d40d26e13..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l28.3"></a><span id="l28.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/suite/themes/classic/jar.mn</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/suite/themes/classic/jar.mn</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -55,25 +55,25 @@ classic.jar:</span>
<a href="#l29.4"></a><span id="l29.4">   skin/classic/communicator/preferences.css                             (communicator/preferences.css)</span>
<a href="#l29.5"></a><span id="l29.5">   skin/classic/communicator/prefpanels.css                              (communicator/prefpanels.css)</span>
<a href="#l29.6"></a><span id="l29.6">   skin/classic/communicator/smileys.css                                 (communicator/smileys.css)</span>
<a href="#l29.7"></a><span id="l29.7">   skin/classic/communicator/tasksOverlay.css                            (communicator/tasksOverlay.css)</span>
<a href="#l29.8"></a><span id="l29.8">   skin/classic/communicator/viewSourceOverlay.css                       (communicator/viewSourceOverlay.css)</span>
<a href="#l29.9"></a><span id="l29.9">   skin/classic/communicator/bookmarks/allBookmarks.png                  (communicator/bookmarks/allBookmarks.png)</span>
<a href="#l29.10"></a><span id="l29.10">   skin/classic/communicator/bookmarks/bookmark-item-dis.png             (communicator/bookmarks/bookmark-item-dis.png)</span>
<a href="#l29.11"></a><span id="l29.11">   skin/classic/communicator/bookmarks/bookmark-item.png                 (communicator/bookmarks/bookmark-item.png)</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+  skin/classic/communicator/bookmarks/bookmarksManager.css              (communicator/bookmarks/bookmarksManager.css)</span>
<a href="#l29.13"></a><span id="l29.13">   skin/classic/communicator/bookmarks/bookmarksMenu.png                 (communicator/bookmarks/bookmarksMenu.png)</span>
<a href="#l29.14"></a><span id="l29.14">   skin/classic/communicator/bookmarks/bookmarksToolbar.png              (communicator/bookmarks/bookmarksToolbar.png)</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+  skin/classic/communicator/bookmarks/editBookmarkOverlay.css           (communicator/bookmarks/editBookmarkOverlay.css)</span>
<a href="#l29.16"></a><span id="l29.16">   skin/classic/communicator/bookmarks/livemark-folder.png               (communicator/bookmarks/livemark-folder.png)</span>
<a href="#l29.17"></a><span id="l29.17">   skin/classic/communicator/bookmarks/livemark-item.png                 (communicator/bookmarks/livemark-item.png)</span>
<a href="#l29.18"></a><span id="l29.18">   skin/classic/communicator/bookmarks/query.png                         (communicator/bookmarks/query.png)</span>
<a href="#l29.19"></a><span id="l29.19">   skin/classic/communicator/bookmarks/toolbarDropMarker.png             (communicator/bookmarks/toolbarDropMarker.png)</span>
<a href="#l29.20"></a><span id="l29.20">   skin/classic/communicator/bookmarks/unsortedBookmarks.png             (communicator/bookmarks/unsortedBookmarks.png)</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineminus">-  skin/classic/communicator/bookmarks/bookmarksWindow.css               (communicator/bookmarks/bookmarksWindow.css)</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineminus">-  skin/classic/communicator/bookmarks/home.png                          (communicator/bookmarks/home.png)</span>
<a href="#l29.23"></a><span id="l29.23">   skin/classic/communicator/brand/throbber-anim.png                     (communicator/brand/throbber-anim.png)</span>
<a href="#l29.24"></a><span id="l29.24">   skin/classic/communicator/brand/throbber-single.png                   (communicator/brand/throbber-single.png)</span>
<a href="#l29.25"></a><span id="l29.25">   skin/classic/communicator/brand/throbber16-anim.png                   (communicator/brand/throbber16-anim.png)</span>
<a href="#l29.26"></a><span id="l29.26">   skin/classic/communicator/brand/throbber16-single.png                 (communicator/brand/throbber16-single.png)</span>
<a href="#l29.27"></a><span id="l29.27">   skin/classic/communicator/directory/directory.css                     (communicator/directory/directory.css)</span>
<a href="#l29.28"></a><span id="l29.28">   skin/classic/communicator/feed-subscribe.css                          (communicator/feed-subscribe.css)</span>
<a href="#l29.29"></a><span id="l29.29">   skin/classic/communicator/fullscreen-video.css                        (communicator/fullscreen-video.css)</span>
<a href="#l29.30"></a><span id="l29.30">   skin/classic/communicator/directory/folder-clsd.gif                   (communicator/directory/folder-clsd.gif)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

