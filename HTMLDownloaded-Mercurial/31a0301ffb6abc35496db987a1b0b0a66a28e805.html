<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20891:31a0301ffb6abc35496db987a1b0b0a66a28e805</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 31a0301ffb6abc35496db987a1b0b0a66a28e805" />
<meta property="og:url" content="/comm-central/rev/31a0301ffb6abc35496db987a1b0b0a66a28e805" />
<meta property="og:description" content="Bug 1310805 - do not force-open root popup without clicking it in click_menus_in_sequence(). Click the proper widgets to open the popup. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 31a0301ffb6abc35496db987a1b0b0a66a28e805 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/31a0301ffb6abc35496db987a1b0b0a66a28e805">shortlog</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/31a0301ffb6abc35496db987a1b0b0a66a28e805">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805">files</a> |
changeset |
<a href="/comm-central/raw-rev/31a0301ffb6abc35496db987a1b0b0a66a28e805">raw</a>  | <a href="/comm-central/archive/31a0301ffb6abc35496db987a1b0b0a66a28e805.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1310805">Bug 1310805</a> - do not force-open root popup without clicking it in click_menus_in_sequence(). Click the proper widgets to open the popup. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 21 Dec 2016 22:00:01 +0100</td></tr>

<tr>
 <td>changeset 20891</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/31a0301ffb6abc35496db987a1b0b0a66a28e805">31a0301ffb6abc35496db987a1b0b0a66a28e805</a></td>
</tr>



<tr>
<td>parent 20890</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a844bb9580da7b60946d7592d772c7ef5b79da71">a844bb9580da7b60946d7592d772c7ef5b79da71</a>
</td>
</tr>

<tr>
<td>child 20892</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e7ac7f2fd2ce84448a342244536069479181004f">e7ac7f2fd2ce84448a342244536069479181004f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=31a0301ffb6abc35496db987a1b0b0a66a28e805">12665</a></td></tr>
<tr><td>push user</td><td>acelists@atlas.sk</td></tr>
<tr><td>push date</td><td class="date age">Wed, 21 Dec 2016 21:01:22 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@31a0301ffb6a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=31a0301ffb6abc35496db987a1b0b0a66a28e805">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=31a0301ffb6abc35496db987a1b0b0a66a28e805&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=31a0301ffb6abc35496db987a1b0b0a66a28e805&newProject=comm-central&newRevision=31a0301ffb6abc35496db987a1b0b0a66a28e805&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=31a0301ffb6abc35496db987a1b0b0a66a28e805&newProject=comm-central&newRevision=31a0301ffb6abc35496db987a1b0b0a66a28e805&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=31a0301ffb6abc35496db987a1b0b0a66a28e805&newProject=comm-central&newRevision=31a0301ffb6abc35496db987a1b0b0a66a28e805&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1310805">1310805</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1310805">Bug 1310805</a> - do not force-open root popup without clicking it in click_menus_in_sequence(). Click the proper widgets to open the popup. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-address-widgets.js">mail/test/mozmill/composition/test-address-widgets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-address-widgets.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-address-widgets.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-address-widgets.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-address-widgets.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-address-widgets.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-attachment-reminder.js">mail/test/mozmill/composition/test-attachment-reminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-attachment-reminder.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-attachment-reminder.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-attachment-reminder.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-attachment-reminder.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-attachment-reminder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-drafts.js">mail/test/mozmill/composition/test-drafts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-drafts.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-drafts.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-drafts.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-drafts.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-drafts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-newmsg-compose-identity.js">mail/test/mozmill/composition/test-newmsg-compose-identity.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-newmsg-compose-identity.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-newmsg-compose-identity.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-newmsg-compose-identity.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-newmsg-compose-identity.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-newmsg-compose-identity.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-send-button.js">mail/test/mozmill/composition/test-send-button.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-send-button.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-send-button.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-send-button.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-send-button.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-send-button.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-signature-updating.js">mail/test/mozmill/composition/test-signature-updating.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-signature-updating.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-signature-updating.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-signature-updating.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-signature-updating.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/composition/test-signature-updating.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/content-policy/test-general-content-policy.js">mail/test/mozmill/content-policy/test-general-content-policy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/content-policy/test-general-content-policy.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/content-policy/test-general-content-policy.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/content-policy/test-general-content-policy.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/content-policy/test-general-content-policy.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/content-policy/test-general-content-policy.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-columns.js">mail/test/mozmill/folder-display/test-columns.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-columns.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-columns.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-columns.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-columns.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-columns.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-watch-ignore-thread.js">mail/test/mozmill/folder-display/test-watch-ignore-thread.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-watch-ignore-thread.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-watch-ignore-thread.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-watch-ignore-thread.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-watch-ignore-thread.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-display/test-watch-ignore-thread.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">mail/test/mozmill/folder-tree-modes/test-mode-switching.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/message-header/test-phishing-bar.js">mail/test/mozmill/message-header/test-phishing-bar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/message-header/test-phishing-bar.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/message-header/test-phishing-bar.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/message-header/test-phishing-bar.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/message-header/test-phishing-bar.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/message-header/test-phishing-bar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">mail/test/mozmill/shared-modules/test-account-manager-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-compose-helpers.js">mail/test/mozmill/shared-modules/test-compose-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-compose-helpers.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-compose-helpers.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-compose-helpers.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-compose-helpers.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-compose-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-notificationbox-helpers.js">mail/test/mozmill/shared-modules/test-notificationbox-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-notificationbox-helpers.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-notificationbox-helpers.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-notificationbox-helpers.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-notificationbox-helpers.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-notificationbox-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-window-helpers.js">mail/test/mozmill/shared-modules/test-window-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-window-helpers.js">file</a> |
<a href="/comm-central/annotate/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-window-helpers.js">annotate</a> |
<a href="/comm-central/diff/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-window-helpers.js">diff</a> |
<a href="/comm-central/comparison/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-window-helpers.js">comparison</a> |
<a href="/comm-central/log/31a0301ffb6abc35496db987a1b0b0a66a28e805/mail/test/mozmill/shared-modules/test-window-helpers.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-address-widgets.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-address-widgets.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -120,26 +120,29 @@ function test_address_types() {</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">   // Now try the same accounts but choosing them in the From dropdown</span>
<a href="#l1.6"></a><span id="l1.6">   // inside compose window.</span>
<a href="#l1.7"></a><span id="l1.7">   be_in_folder(accountPOP3.incomingServer.rootFolder);</span>
<a href="#l1.8"></a><span id="l1.8">   cwc = open_compose_new_mail();</span>
<a href="#l1.9"></a><span id="l1.9">   check_nntp_address_types();</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11">   let NNTPidentity = accountNNTP.defaultIdentity.key;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+  cwc.click(cwc.eid(&quot;msgIdentity&quot;));</span>
<a href="#l1.13"></a><span id="l1.13">   cwc.click_menus_in_sequence(cwc.e(&quot;msgIdentityPopup&quot;), [ { identitykey: NNTPidentity } ]);</span>
<a href="#l1.14"></a><span id="l1.14">   check_nntp_address_types();</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16">   // In a News account, choose &quot;Newsgroup:&quot; as the address type.</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+  cwc.click(cwc.eid(&quot;addressCol1#1&quot;));</span>
<a href="#l1.18"></a><span id="l1.18">   cwc.click_menus_in_sequence(cwc.e(&quot;addressCol1#1&quot;).menupopup,</span>
<a href="#l1.19"></a><span id="l1.19">                               [ { value: &quot;addr_newsgroups&quot; } ]);</span>
<a href="#l1.20"></a><span id="l1.20">   check_nntp_address_types();</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22">   // And switch back to the POP3 account.</span>
<a href="#l1.23"></a><span id="l1.23">   let POP3identity = accountPOP3.defaultIdentity.key;</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+  cwc.click(cwc.eid(&quot;msgIdentity&quot;));</span>
<a href="#l1.25"></a><span id="l1.25">   cwc.click_menus_in_sequence(cwc.e(&quot;msgIdentityPopup&quot;), [ { identitykey: POP3identity } ]);</span>
<a href="#l1.26"></a><span id="l1.26">   check_nntp_address_types();</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28">   close_compose_window(cwc);</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30">   remove_NNTP_account();</span>
<a href="#l1.31"></a><span id="l1.31"> </span>
<a href="#l1.32"></a><span id="l1.32">   // Now the NNTP account is lost, so we should be back to mail only addressees.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-attachment-reminder.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-attachment-reminder.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -248,17 +248,17 @@ function test_attachment_reminder_aggres</span>
<a href="#l2.4"></a><span id="l2.4">  * Test that clicking &quot;No, Send Now&quot; in the attachment reminder alert</span>
<a href="#l2.5"></a><span id="l2.5">  * works.</span>
<a href="#l2.6"></a><span id="l2.6">  */</span>
<a href="#l2.7"></a><span id="l2.7"> function test_no_send_now_sends() {</span>
<a href="#l2.8"></a><span id="l2.8">   let cwc = open_compose_new_mail();</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10">   setup_msg_contents(cwc, &quot;test@example.org&quot;,</span>
<a href="#l2.11"></a><span id="l2.11">                      &quot;will the 'No, Send Now' button work?&quot;,</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-                     &quot;Hello, i got your attachment!&quot;);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+                     &quot;Hello, I got your attachment!&quot;);</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15">   wait_for_reminder_state(cwc, true);</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17">   // Click the send button again, this time choose &quot;No, Send Now&quot;.</span>
<a href="#l2.18"></a><span id="l2.18">   plan_for_modal_dialog(&quot;commonDialog&quot;, click_no_send_now);</span>
<a href="#l2.19"></a><span id="l2.19">   cwc.click(cwc.eid(&quot;button-send&quot;));</span>
<a href="#l2.20"></a><span id="l2.20">   wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -273,16 +273,17 @@ function test_no_send_now_sends() {</span>
<a href="#l2.23"></a><span id="l2.23">  * Click the manual reminder in the menu.</span>
<a href="#l2.24"></a><span id="l2.24">  *</span>
<a href="#l2.25"></a><span id="l2.25">  * @param aCwc            A compose window controller.</span>
<a href="#l2.26"></a><span id="l2.26">  * @param aExpectedState  A boolean specifying what is the expected state</span>
<a href="#l2.27"></a><span id="l2.27">  *                        of the reminder menuitem after the click.</span>
<a href="#l2.28"></a><span id="l2.28">  */</span>
<a href="#l2.29"></a><span id="l2.29"> function click_manual_reminder(aCwc, aExpectedState) {</span>
<a href="#l2.30"></a><span id="l2.30">   wait_for_window_focused(aCwc.window);</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+  aCwc.click(new elementslib.Elem(aCwc.get_menu_dropmarker(aCwc.e(&quot;button-attach&quot;))));</span>
<a href="#l2.32"></a><span id="l2.32">   aCwc.click_menus_in_sequence(aCwc.e(&quot;button-attachPopup&quot;),</span>
<a href="#l2.33"></a><span id="l2.33">                                [ {id: &quot;button-attachPopup_remindLaterItem&quot;} ]);</span>
<a href="#l2.34"></a><span id="l2.34">   wait_for_window_focused(aCwc.window);</span>
<a href="#l2.35"></a><span id="l2.35">   assert_manual_reminder_state(aCwc, aExpectedState);</span>
<a href="#l2.36"></a><span id="l2.36"> }</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38"> /**</span>
<a href="#l2.39"></a><span id="l2.39">  * Bug 521128</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineat">@@ -606,17 +607,21 @@ function test_disabling_attachment_remin</span>
<a href="#l2.41"></a><span id="l2.41">   setup_msg_contents(cwc, &quot;test@example.invalid&quot;, &quot;Testing turning off the reminder&quot;,</span>
<a href="#l2.42"></a><span id="l2.42">                      &quot;Some attachment keywords here...&quot;);</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44">   // This one should have the manual reminder disabled.</span>
<a href="#l2.45"></a><span id="l2.45">   assert_manual_reminder_state(cwc, false);</span>
<a href="#l2.46"></a><span id="l2.46">   // There should be an attachment reminder.</span>
<a href="#l2.47"></a><span id="l2.47">   wait_for_reminder_state(cwc, true);</span>
<a href="#l2.48"></a><span id="l2.48"> </span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-  // Disable the reminder (not just dismiss).</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+  // Disable the reminder (not just dismiss) using the menuitem</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+  // in the notification bar menu-button.</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+  let disableButton = get_notification_button(cwc, kBoxId, kNotificationId,</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+                                              { popup: &quot;reminderBarPopup&quot; });</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+  cwc.click(new elementslib.Elem(cwc.get_menu_dropmarker(disableButton)));</span>
<a href="#l2.55"></a><span id="l2.55">   cwc.click_menus_in_sequence(cwc.e(&quot;reminderBarPopup&quot;),</span>
<a href="#l2.56"></a><span id="l2.56">                               [ {id: &quot;disableReminder&quot;} ]);</span>
<a href="#l2.57"></a><span id="l2.57"> </span>
<a href="#l2.58"></a><span id="l2.58">   wait_for_reminder_state(cwc, false);</span>
<a href="#l2.59"></a><span id="l2.59"> </span>
<a href="#l2.60"></a><span id="l2.60">   // Add more keywords.</span>
<a href="#l2.61"></a><span id="l2.61">   setup_msg_contents(cwc, &quot;&quot;, &quot;&quot;, &quot;... and another file attached.&quot;);</span>
<a href="#l2.62"></a><span id="l2.62">   // Give the notification time to appear. It shouldn't.</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineat">@@ -633,16 +638,19 @@ function test_disabling_attachment_remin</span>
<a href="#l2.64"></a><span id="l2.64">   assert_automatic_reminder_state(cwc, false);</span>
<a href="#l2.65"></a><span id="l2.65"> </span>
<a href="#l2.66"></a><span id="l2.66">   // Add more keywords to trigger automatic reminder.</span>
<a href="#l2.67"></a><span id="l2.67">   setup_msg_contents(cwc, &quot;&quot;, &quot;&quot;, &quot;I enclosed another file.&quot;);</span>
<a href="#l2.68"></a><span id="l2.68">   // Give the notification time to appear. It should now.</span>
<a href="#l2.69"></a><span id="l2.69">   wait_for_reminder_state(cwc, true);</span>
<a href="#l2.70"></a><span id="l2.70"> </span>
<a href="#l2.71"></a><span id="l2.71">   // Disable the reminder again.</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+  disableButton = get_notification_button(cwc, kBoxId, kNotificationId,</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+                                          { popup: &quot;reminderBarPopup&quot; });</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+  cwc.click(new elementslib.Elem(cwc.get_menu_dropmarker(disableButton)));</span>
<a href="#l2.75"></a><span id="l2.75">   cwc.click_menus_in_sequence(cwc.e(&quot;reminderBarPopup&quot;),</span>
<a href="#l2.76"></a><span id="l2.76">                               [ {id: &quot;disableReminder&quot;} ]);</span>
<a href="#l2.77"></a><span id="l2.77">   wait_for_reminder_state(cwc, false);</span>
<a href="#l2.78"></a><span id="l2.78"> </span>
<a href="#l2.79"></a><span id="l2.79">   // Now send the message.</span>
<a href="#l2.80"></a><span id="l2.80">   plan_for_window_close(cwc);</span>
<a href="#l2.81"></a><span id="l2.81">   cwc.window.goDoCommand(&quot;cmd_sendLater&quot;);</span>
<a href="#l2.82"></a><span id="l2.82">   wait_for_window_close();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-drafts.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-drafts.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -87,16 +87,17 @@ function internal_check_delivery_format(</span>
<a href="#l3.4"></a><span id="l3.4">   let cwc = open_compose_new_mail();</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">   setup_msg_contents(cwc, &quot;test@example.invalid&quot;,</span>
<a href="#l3.7"></a><span id="l3.7">                      &quot;Testing storing of the composition properties in the draft!&quot;,</span>
<a href="#l3.8"></a><span id="l3.8">                      &quot;Hello!&quot;);</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">   // Select our wanted format.</span>
<a href="#l3.11"></a><span id="l3.11">   if (!mc.mozmillModule.isMac) {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+    cwc.click(cwc.eid(&quot;optionsMenu&quot;));</span>
<a href="#l3.13"></a><span id="l3.13">     formatMenu = cwc.click_menus_in_sequence(cwc.e(&quot;optionsMenuPopup&quot;),</span>
<a href="#l3.14"></a><span id="l3.14">                                              [ { id: &quot;outputFormatMenu&quot; },</span>
<a href="#l3.15"></a><span id="l3.15">                                                { id: &quot;format_both&quot; } ]);</span>
<a href="#l3.16"></a><span id="l3.16">   } else {</span>
<a href="#l3.17"></a><span id="l3.17">     // On OS X the main menu seems not accessible for clicking from mozmill.</span>
<a href="#l3.18"></a><span id="l3.18">     assert_true(cwc.e(&quot;outputFormatMenu&quot;).getAttribute(&quot;oncommand&quot;).startsWith(&quot;OutputFormatMenuSelect(&quot;));</span>
<a href="#l3.19"></a><span id="l3.19">     cwc.window.OutputFormatMenuSelect(cwc.e(&quot;format_both&quot;));</span>
<a href="#l3.20"></a><span id="l3.20">   }</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -104,16 +105,17 @@ function internal_check_delivery_format(</span>
<a href="#l3.22"></a><span id="l3.22">   /**</span>
<a href="#l3.23"></a><span id="l3.23">    * Check if the right format is selected in the menu.</span>
<a href="#l3.24"></a><span id="l3.24">    *</span>
<a href="#l3.25"></a><span id="l3.25">    * @param aMenuItemId  The id of the menuitem expected to be selected.</span>
<a href="#l3.26"></a><span id="l3.26">    * @param aValue       A value of nsIMsgCompSendFormat contants of the expected selected format.</span>
<a href="#l3.27"></a><span id="l3.27">    */</span>
<a href="#l3.28"></a><span id="l3.28">   function assert_format_value(aMenuItemId, aValue) {</span>
<a href="#l3.29"></a><span id="l3.29">     if (!mc.mozmillModule.isMac) {</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+      cwc.click(cwc.eid(&quot;optionsMenu&quot;));</span>
<a href="#l3.31"></a><span id="l3.31">       let formatMenu = cwc.click_menus_in_sequence(cwc.e(&quot;optionsMenuPopup&quot;),</span>
<a href="#l3.32"></a><span id="l3.32">                                                    [ { id: &quot;outputFormatMenu&quot; } ], true);</span>
<a href="#l3.33"></a><span id="l3.33">       let formatItem = cwc.e(&quot;outputFormatMenuPopup&quot;)</span>
<a href="#l3.34"></a><span id="l3.34">                           .querySelector(&quot;[name=output_format][checked=true]&quot;);</span>
<a href="#l3.35"></a><span id="l3.35">       assert_equals(formatItem.id, aMenuItemId);</span>
<a href="#l3.36"></a><span id="l3.36">       cwc.close_popup_sequence(formatMenu);</span>
<a href="#l3.37"></a><span id="l3.37">     } else {</span>
<a href="#l3.38"></a><span id="l3.38">       assert_equals(cwc.window.gSendFormat, aValue);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-newmsg-compose-identity.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-newmsg-compose-identity.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -111,18 +111,17 @@ function test_compose_from_composer() {</span>
<a href="#l4.4"></a><span id="l4.4">   plan_for_new_window(&quot;msgcompose&quot;);</span>
<a href="#l4.5"></a><span id="l4.5">   mainCompWin.keypress(null, &quot;n&quot;, {shiftKey: false, accelKey: true});</span>
<a href="#l4.6"></a><span id="l4.6">   let newCompWin = wait_for_compose_window();</span>
<a href="#l4.7"></a><span id="l4.7">   checkCompIdentity(newCompWin, account.defaultIdentity.key);</span>
<a href="#l4.8"></a><span id="l4.8">   close_compose_window(newCompWin);</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10">   // Switch to identity2 in the main compose window, new compose windows</span>
<a href="#l4.11"></a><span id="l4.11">   // starting from here should use the same identity as its &quot;parent&quot;.</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  let identityList = mainCompWin.e(&quot;msgIdentity&quot;);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-  identityList.selectedIndex++;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+  mainCompWin.click(mainCompWin.eid(&quot;msgIdentity&quot;));</span>
<a href="#l4.15"></a><span id="l4.15">   mainCompWin.click_menus_in_sequence(mainCompWin.e(&quot;msgIdentityPopup&quot;),</span>
<a href="#l4.16"></a><span id="l4.16">                                       [ { identitykey: identityKey2 } ]);</span>
<a href="#l4.17"></a><span id="l4.17">   checkCompIdentity(mainCompWin, identityKey2);</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">   // Compose a second new message from the compose window.</span>
<a href="#l4.20"></a><span id="l4.20">   plan_for_new_window(&quot;msgcompose&quot;);</span>
<a href="#l4.21"></a><span id="l4.21">   mainCompWin.keypress(null, &quot;n&quot;, {shiftKey: false, accelKey: true});</span>
<a href="#l4.22"></a><span id="l4.22">   let newCompWin2 = wait_for_compose_window();</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineat">@@ -144,16 +143,17 @@ function test_editing_identity() {</span>
<a href="#l4.24"></a><span id="l4.24">   let compWin = open_compose_new_mail();</span>
<a href="#l4.25"></a><span id="l4.25">   checkCompIdentity(compWin, account.defaultIdentity.key, identity1Email);</span>
<a href="#l4.26"></a><span id="l4.26"> </span>
<a href="#l4.27"></a><span id="l4.27">   // Input custom identity data into the From field.</span>
<a href="#l4.28"></a><span id="l4.28">   let customName = &quot;custom&quot;;</span>
<a href="#l4.29"></a><span id="l4.29">   let customEmail = &quot;custom@edited.invalid&quot;;</span>
<a href="#l4.30"></a><span id="l4.30">   let identityCustom = customName + &quot; &lt;&quot; + customEmail + &quot;&gt;&quot;;</span>
<a href="#l4.31"></a><span id="l4.31"> </span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  compWin.click(compWin.eid(&quot;msgIdentity&quot;));</span>
<a href="#l4.33"></a><span id="l4.33">   compWin.click_menus_in_sequence(compWin.e(&quot;msgIdentityPopup&quot;),</span>
<a href="#l4.34"></a><span id="l4.34">                                   [ { command: &quot;cmd_customizeFromAddress&quot; } ]);</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36">   compWin.type(compWin.e(&quot;msgIdentityPopup&quot;).value, identityCustom);</span>
<a href="#l4.37"></a><span id="l4.37"> </span>
<a href="#l4.38"></a><span id="l4.38">   checkCompIdentity(compWin, account.defaultIdentity.key, identityCustom, identityCustom);</span>
<a href="#l4.39"></a><span id="l4.39">   close_compose_window(compWin);</span>
<a href="#l4.40"></a><span id="l4.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-send-button.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-send-button.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -157,21 +157,23 @@ function test_send_enabled_prefilled_add</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">   let identityPicker = cwc.e(&quot;msgIdentity&quot;);</span>
<a href="#l5.6"></a><span id="l5.6">   assert_equals(identityPicker.selectedIndex, 0);</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">   // Switch to the second identity that has no CC. Send should be disabled.</span>
<a href="#l5.9"></a><span id="l5.9">   assert_true(account.identities.length &gt;= 2);</span>
<a href="#l5.10"></a><span id="l5.10">   let identityWithoutCC = account.identities.queryElementAt(1, Ci.nsIMsgIdentity);</span>
<a href="#l5.11"></a><span id="l5.11">   assert_false(identityWithoutCC.doCc);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+  cwc.click(cwc.eid(&quot;msgIdentity&quot;));</span>
<a href="#l5.13"></a><span id="l5.13">   cwc.click_menus_in_sequence(cwc.e(&quot;msgIdentityPopup&quot;),</span>
<a href="#l5.14"></a><span id="l5.14">                               [ { identitykey: identityWithoutCC.key } ]);</span>
<a href="#l5.15"></a><span id="l5.15">   check_send_commands_state(cwc, false);</span>
<a href="#l5.16"></a><span id="l5.16"> </span>
<a href="#l5.17"></a><span id="l5.17">   // Check the first identity again.</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+  cwc.click(cwc.eid(&quot;msgIdentity&quot;));</span>
<a href="#l5.19"></a><span id="l5.19">   cwc.click_menus_in_sequence(cwc.e(&quot;msgIdentityPopup&quot;),</span>
<a href="#l5.20"></a><span id="l5.20">                               [ { identitykey: identityWithCC.key } ]);</span>
<a href="#l5.21"></a><span id="l5.21">   check_send_commands_state(cwc, true);</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23">   close_compose_window(cwc);</span>
<a href="#l5.24"></a><span id="l5.24">   identityWithCC.doCcList = &quot;&quot;;</span>
<a href="#l5.25"></a><span id="l5.25">   identityWithCC.doCc = false;</span>
<a href="#l5.26"></a><span id="l5.26"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-signature-updating.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-signature-updating.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -87,16 +87,17 @@ function plaintextComposeWindowSwitchSig</span>
<a href="#l6.4"></a><span id="l6.4">     assert_equals(brNode.localName, &quot;br&quot;);</span>
<a href="#l6.5"></a><span id="l6.5">     sigNode = brNode.nextSibling;</span>
<a href="#l6.6"></a><span id="l6.6">   }</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">   let expectedText = &quot;Tinderbox is soo 90ies&quot;;</span>
<a href="#l6.9"></a><span id="l6.9">   assert_equals(sigNode.textContent, expectedText);</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11">   // Now switch identities!</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+  cwc.click(cwc.eid(&quot;msgIdentity&quot;));</span>
<a href="#l6.13"></a><span id="l6.13">   cwc.click_menus_in_sequence(cwc.e(&quot;msgIdentityPopup&quot;), [ { identitykey: &quot;id2&quot; } ]);</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15">   node = contentFrame.contentDocument.body.lastChild;</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17">   // The last node is a BR - this allows users to put text after the</span>
<a href="#l6.18"></a><span id="l6.18">   // signature without it being styled like the signature.</span>
<a href="#l6.19"></a><span id="l6.19">   assert_equals(node.localName, &quot;br&quot;);</span>
<a href="#l6.20"></a><span id="l6.20">   node = node.previousSibling;</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -164,16 +165,17 @@ function HTMLComposeWindowSwitchSignatur</span>
<a href="#l6.22"></a><span id="l6.22">   assert_equals(node.className, &quot;moz-signature&quot;);</span>
<a href="#l6.23"></a><span id="l6.23">   node = node.firstChild; // text node containing the signature divider</span>
<a href="#l6.24"></a><span id="l6.24">   if (suppressSigSep)</span>
<a href="#l6.25"></a><span id="l6.25">     assert_equals(node.nodeValue, &quot;Tinderbox is soo 90ies&quot;);</span>
<a href="#l6.26"></a><span id="l6.26">   else</span>
<a href="#l6.27"></a><span id="l6.27">     assert_equals(node.nodeValue, &quot;-- \nTinderbox is soo 90ies&quot;);</span>
<a href="#l6.28"></a><span id="l6.28"> </span>
<a href="#l6.29"></a><span id="l6.29">   // Now switch identities!</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+  cwc.click(cwc.eid(&quot;msgIdentity&quot;));</span>
<a href="#l6.31"></a><span id="l6.31">   cwc.click_menus_in_sequence(cwc.e(&quot;msgIdentityPopup&quot;), [ { identitykey: &quot;id2&quot; } ]);</span>
<a href="#l6.32"></a><span id="l6.32"> </span>
<a href="#l6.33"></a><span id="l6.33">   node = contentFrame.contentDocument.body.lastChild;</span>
<a href="#l6.34"></a><span id="l6.34"> </span>
<a href="#l6.35"></a><span id="l6.35">   // In html compose, the signature is inside the last node</span>
<a href="#l6.36"></a><span id="l6.36">   // with class=&quot;moz-signature&quot;.</span>
<a href="#l6.37"></a><span id="l6.37">   assert_equals(node.className, &quot;moz-signature&quot;);</span>
<a href="#l6.38"></a><span id="l6.38">   node = node.firstChild; // text node containing the signature divider</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/test/mozmill/content-policy/test-general-content-policy.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/test/mozmill/content-policy/test-general-content-policy.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -239,16 +239,19 @@ function allowRemoteContentAndCheck(test</span>
<a href="#l7.4"></a><span id="l7.4">   addMsgToFolderAndCheckContent(folder, test);</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6">   plan_for_message_display(mc);</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">   // Click on the allow remote content button</span>
<a href="#l7.9"></a><span id="l7.9">   const kBoxId = &quot;msgNotificationBar&quot;;</span>
<a href="#l7.10"></a><span id="l7.10">   const kNotificationValue = &quot;remoteContent&quot;;</span>
<a href="#l7.11"></a><span id="l7.11">   wait_for_notification_to_show(mc, kBoxId, kNotificationValue);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+  let prefButton = get_notification_button(mc, kBoxId, kNotificationValue,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+                                           { popup: &quot;remoteContentOptions&quot; });</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+  mc.click(new elib.Elem(prefButton));</span>
<a href="#l7.15"></a><span id="l7.15">   mc.click_menus_in_sequence(mc.e(&quot;remoteContentOptions&quot;),</span>
<a href="#l7.16"></a><span id="l7.16">                              [{id: &quot;remoteContentOptionAllowForMsg&quot;}]);</span>
<a href="#l7.17"></a><span id="l7.17">   wait_for_notification_to_stop(mc, kBoxId, kNotificationValue);</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">   wait_for_message_display_completion(mc, true);</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">   if (!test.checkForAllowed(mc.window.content.document</span>
<a href="#l7.22"></a><span id="l7.22">                               .getElementById(&quot;testelement&quot;)))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-columns.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-columns.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -351,19 +351,17 @@ function invoke_column_picker_option(aAc</span>
<a href="#l8.4"></a><span id="l8.4">   //   |- hbox                item 0</span>
<a href="#l8.5"></a><span id="l8.5">   //   |- treecolpicker   &lt;-- item 1 this is the one we want</span>
<a href="#l8.6"></a><span id="l8.6">   let threadCols = mc.window.document.getElementById(&quot;threadCols&quot;);</span>
<a href="#l8.7"></a><span id="l8.7">   let colPicker = mc.window.document.getAnonymousNodes(threadCols).item(1);</span>
<a href="#l8.8"></a><span id="l8.8">   let colPickerPopup = mc.window.document.getAnonymousElementByAttribute(</span>
<a href="#l8.9"></a><span id="l8.9">                          colPicker, &quot;anonid&quot;, &quot;popup&quot;);</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">   mc.click(new elib.Elem(colPicker));</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  wait_for_popup_to_open(colPickerPopup);</span>
<a href="#l8.13"></a><span id="l8.13">   mc.click_menus_in_sequence(colPickerPopup, aActions);</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-  close_popup(mc, new elib.Elem(colPickerPopup));</span>
<a href="#l8.15"></a><span id="l8.15"> }</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18"> /**</span>
<a href="#l8.19"></a><span id="l8.19">  * The column picker's &quot;reset columns to default&quot; option should set our state</span>
<a href="#l8.20"></a><span id="l8.20">  *  back to inbox state.</span>
<a href="#l8.21"></a><span id="l8.21">  */</span>
<a href="#l8.22"></a><span id="l8.22"> function test_reset_to_inbox() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-watch-ignore-thread.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-watch-ignore-thread.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -30,16 +30,17 @@ function setupModule(module) {</span>
<a href="#l9.4"></a><span id="l9.4">   expand_all_threads();</span>
<a href="#l9.5"></a><span id="l9.5"> }</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> /**</span>
<a href="#l9.8"></a><span id="l9.8">  * Click one of the menu items in the appmenu View | Messages menu.</span>
<a href="#l9.9"></a><span id="l9.9">  * @param aMenuId the id of the menu item to click.</span>
<a href="#l9.10"></a><span id="l9.10">  */</span>
<a href="#l9.11"></a><span id="l9.11"> function clickViewMessagesItem(aMenuId) {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+  mc.click(mc.eid(&quot;button-appmenu&quot;));</span>
<a href="#l9.13"></a><span id="l9.13">   mc.click_menus_in_sequence(mc.e(&quot;appmenu-popup&quot;),</span>
<a href="#l9.14"></a><span id="l9.14">     [</span>
<a href="#l9.15"></a><span id="l9.15">       {id: &quot;appmenu_View&quot;},</span>
<a href="#l9.16"></a><span id="l9.16">       {id: &quot;appmenu_viewMessagesMenu&quot;},</span>
<a href="#l9.17"></a><span id="l9.17">       {id: aMenuId}</span>
<a href="#l9.18"></a><span id="l9.18">     ]</span>
<a href="#l9.19"></a><span id="l9.19">   );</span>
<a href="#l9.20"></a><span id="l9.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/test/mozmill/folder-tree-modes/test-mode-switching.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/test/mozmill/folder-tree-modes/test-mode-switching.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -43,18 +43,20 @@ function setupModule(module) {</span>
<a href="#l10.4"></a><span id="l10.4">   favoriteFolder.flags |= Ci.nsMsgFolderFlags.Favorite;</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6">   toggle_menu = mc.e(&quot;menu_compactFolderView&quot;);</span>
<a href="#l10.7"></a><span id="l10.7">   toggle_appmenu = mc.e(&quot;appmenu_compactFolderView&quot;);</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9">   modeList_menu = mc.e(&quot;menu_FolderViewsPopup&quot;);</span>
<a href="#l10.10"></a><span id="l10.10">   modeList_appmenu = mc.e(&quot;appmenu_FolderViewsPopup&quot;);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  view_menu = mc.e(&quot;menu_View_Popup&quot;);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-  view_appmenu = mc.e(&quot;appmenu-popup&quot;);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+  view_menu = mc.eid(&quot;menu_View&quot;);</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+  view_menupopup = mc.e(&quot;menu_View_Popup&quot;);</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+  appmenu = mc.eid(&quot;button-appmenu&quot;);</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+  appmenupopup = mc.e(&quot;appmenu-popup&quot;);</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19">   tree = mc.folderTreeView;</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21">   select_no_folders();</span>
<a href="#l10.22"></a><span id="l10.22"> }</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24"> /**</span>
<a href="#l10.25"></a><span id="l10.25">  * Check if both &quot;Compact view&quot; checkboxes in menu are of the expected state.</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineat">@@ -78,32 +80,35 @@ function assert_compact_state(aChecked, </span>
<a href="#l10.27"></a><span id="l10.27">  */</span>
<a href="#l10.28"></a><span id="l10.28"> function assert_mode_selected(aMode) {</span>
<a href="#l10.29"></a><span id="l10.29">   assert_equals(tree.mode, aMode);</span>
<a href="#l10.30"></a><span id="l10.30">   let baseMode = tree.baseMode();</span>
<a href="#l10.31"></a><span id="l10.31">   assert_compact_state(baseMode != tree.mode);</span>
<a href="#l10.32"></a><span id="l10.32">   // We need to open the menu because only then the right mode is set in them.</span>
<a href="#l10.33"></a><span id="l10.33">   if (!mc.mozmillModule.isMac) {</span>
<a href="#l10.34"></a><span id="l10.34">     // On OS X the main menu seems not accessible for clicking from mozmill.</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">-    popuplist = mc.click_menus_in_sequence(view_menu, [ { id: modeList_menu.parentNode.id } ], true);</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+    mc.click(view_menu);</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+    popuplist = mc.click_menus_in_sequence(view_menupopup, [ { id: modeList_menu.parentNode.id } ], true);</span>
<a href="#l10.38"></a><span id="l10.38">     assert_true(modeList_menu.querySelector('[value=&quot;' + baseMode + '&quot;]').hasAttribute(&quot;checked&quot;));</span>
<a href="#l10.39"></a><span id="l10.39">     mc.close_popup_sequence(popuplist);</span>
<a href="#l10.40"></a><span id="l10.40">   }</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-  popuplist = mc.click_menus_in_sequence(view_appmenu, [ { id: modeList_appmenu.parentNode.id } ], true);</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+  mc.click(appmenu);</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+  popuplist = mc.click_menus_in_sequence(appmenupopup, [ { id: modeList_appmenu.parentNode.id } ], true);</span>
<a href="#l10.44"></a><span id="l10.44">   assert_true(modeList_menu.querySelector('[value=&quot;' + baseMode + '&quot;]').hasAttribute(&quot;checked&quot;));</span>
<a href="#l10.45"></a><span id="l10.45">   mc.close_popup_sequence(popuplist);</span>
<a href="#l10.46"></a><span id="l10.46"> }</span>
<a href="#l10.47"></a><span id="l10.47"> </span>
<a href="#l10.48"></a><span id="l10.48"> /**</span>
<a href="#l10.49"></a><span id="l10.49">  * Toggle the folder mode by clicking in the menu.</span>
<a href="#l10.50"></a><span id="l10.50">  *</span>
<a href="#l10.51"></a><span id="l10.51">  * @param aMode  The base name of the mode to select.</span>
<a href="#l10.52"></a><span id="l10.52">  */</span>
<a href="#l10.53"></a><span id="l10.53"> function select_mode_in_menu(aMode) {</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-  mc.click_menus_in_sequence(view_appmenu, [ { id: modeList_appmenu.parentNode.id },</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+  mc.click(appmenu);</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+  mc.click_menus_in_sequence(appmenupopup, [ { id: modeList_appmenu.parentNode.id },</span>
<a href="#l10.57"></a><span id="l10.57">                                              { value: aMode } ]);</span>
<a href="#l10.58"></a><span id="l10.58"> }</span>
<a href="#l10.59"></a><span id="l10.59"> </span>
<a href="#l10.60"></a><span id="l10.60"> /**</span>
<a href="#l10.61"></a><span id="l10.61">  * Toggle the Compact view option by clicking in the menu.</span>
<a href="#l10.62"></a><span id="l10.62">  */</span>
<a href="#l10.63"></a><span id="l10.63"> function toggle_compact_in_menu() {</span>
<a href="#l10.64"></a><span id="l10.64">   // For some reason, clicking the menuitem does not work by any means,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/test/mozmill/message-header/test-phishing-bar.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/test/mozmill/message-header/test-phishing-bar.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -52,16 +52,19 @@ function setupModule(module) {</span>
<a href="#l11.4"></a><span id="l11.4"> }</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6"> /**</span>
<a href="#l11.7"></a><span id="l11.7">  * Make sure the notification shows, and goes away once the Ignore menuitem</span>
<a href="#l11.8"></a><span id="l11.8">  * is clicked.</span>
<a href="#l11.9"></a><span id="l11.9">  */</span>
<a href="#l11.10"></a><span id="l11.10"> function assert_ignore_works(aController) {</span>
<a href="#l11.11"></a><span id="l11.11">   wait_for_notification_to_show(aController, kBoxId, kNotificationValue);</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+  let prefButton = get_notification_button(aController, kBoxId, kNotificationValue,</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+                                           { popup: &quot;phishingOptions&quot; });</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+  aController.click(new elementslib.Elem(prefButton));</span>
<a href="#l11.15"></a><span id="l11.15">   aController.click_menus_in_sequence(aController.e(&quot;phishingOptions&quot;),</span>
<a href="#l11.16"></a><span id="l11.16">                                       [{id: &quot;phishingOptionIgnore&quot;}]);</span>
<a href="#l11.17"></a><span id="l11.17">   wait_for_notification_to_stop(aController, kBoxId, kNotificationValue);</span>
<a href="#l11.18"></a><span id="l11.18"> }</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20"> /**</span>
<a href="#l11.21"></a><span id="l11.21">  * Test that when viewing a message, choosing ignore hides the the phishing</span>
<a href="#l11.22"></a><span id="l11.22">  * notification.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-account-manager-helpers.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-account-manager-helpers.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -156,13 +156,14 @@ function remove_account(aAccount, aContr</span>
<a href="#l12.4"></a><span id="l12.4">     cdc.window.document.documentElement.acceptDialog();</span>
<a href="#l12.5"></a><span id="l12.5">     cdc.waitFor(() =&gt; !cdc.window.document.documentElement.getButton(&quot;accept&quot;).disabled,</span>
<a href="#l12.6"></a><span id="l12.6">                 &quot;Timeout waiting for finish of account removal&quot;,</span>
<a href="#l12.7"></a><span id="l12.7">                 5000, 100);</span>
<a href="#l12.8"></a><span id="l12.8">     cdc.window.document.documentElement.acceptDialog();</span>
<a href="#l12.9"></a><span id="l12.9">   });</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11">   // Use the Remove item in the Account actions menu.</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+  aController.click(aController.eid(&quot;accountActionsButton&quot;));</span>
<a href="#l12.13"></a><span id="l12.13">   aController.click_menus_in_sequence(aController.e(&quot;accountActionsDropdown&quot;),</span>
<a href="#l12.14"></a><span id="l12.14">                                       [ {id: &quot;accountActionsDropdownRemove&quot;} ]);</span>
<a href="#l12.15"></a><span id="l12.15">   wh.wait_for_modal_dialog(&quot;removeAccountDialog&quot;);</span>
<a href="#l12.16"></a><span id="l12.16">   // TODO: For unknown reason this also closes the whole account manager.</span>
<a href="#l12.17"></a><span id="l12.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-compose-helpers.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-compose-helpers.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -307,16 +307,17 @@ function clear_recipient(aController, aR</span>
<a href="#l13.4"></a><span id="l13.4">  * Change recipient type in compose widget.</span>
<a href="#l13.5"></a><span id="l13.5">  *</span>
<a href="#l13.6"></a><span id="l13.6">  * @param aController    Compose window controller.</span>
<a href="#l13.7"></a><span id="l13.7">  * @param aType          The recipient type, e.g. &quot;addr_to&quot;.</span>
<a href="#l13.8"></a><span id="l13.8">  * @param aRecipientRow  The compose widget row containing recipient to remove.</span>
<a href="#l13.9"></a><span id="l13.9">  */</span>
<a href="#l13.10"></a><span id="l13.10"> function toggle_recipient_type(aController, aType, aRecipientRow = 1) {</span>
<a href="#l13.11"></a><span id="l13.11">   let addrType = aController.window.awGetPopupElement(aRecipientRow);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+  aController.click(new elib.Elem(addrType));</span>
<a href="#l13.13"></a><span id="l13.13">   aController.click_menus_in_sequence(addrType.menupopup, [ { value: aType } ]);</span>
<a href="#l13.14"></a><span id="l13.14"> }</span>
<a href="#l13.15"></a><span id="l13.15"> </span>
<a href="#l13.16"></a><span id="l13.16"> /**</span>
<a href="#l13.17"></a><span id="l13.17">  * Create and return an nsIMsgAttachment for the passed URL.</span>
<a href="#l13.18"></a><span id="l13.18">  * @param aUrl the URL for this attachment (either a file URL or a web URL)</span>
<a href="#l13.19"></a><span id="l13.19">  * @param aSize (optional) the file size of this attachment, in bytes</span>
<a href="#l13.20"></a><span id="l13.20">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-notificationbox-helpers.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-notificationbox-helpers.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -8,16 +8,17 @@ var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l14.4"></a><span id="l14.4"> var MODULE_REQUIRES = [];</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6"> function installInto(module) {</span>
<a href="#l14.7"></a><span id="l14.7">   module.check_notification_displayed = check_notification_displayed;</span>
<a href="#l14.8"></a><span id="l14.8">   module.assert_notification_displayed = assert_notification_displayed;</span>
<a href="#l14.9"></a><span id="l14.9">   module.close_notification = close_notification;</span>
<a href="#l14.10"></a><span id="l14.10">   module.wait_for_notification_to_stop = wait_for_notification_to_stop;</span>
<a href="#l14.11"></a><span id="l14.11">   module.wait_for_notification_to_show = wait_for_notification_to_show;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+  module.get_notification_button = get_notification_button;</span>
<a href="#l14.13"></a><span id="l14.13"> }</span>
<a href="#l14.14"></a><span id="l14.14"> </span>
<a href="#l14.15"></a><span id="l14.15"> /**</span>
<a href="#l14.16"></a><span id="l14.16">  * A helper function for determining whether or not a notification with</span>
<a href="#l14.17"></a><span id="l14.17">  * a particular value is being displayed.</span>
<a href="#l14.18"></a><span id="l14.18">  *</span>
<a href="#l14.19"></a><span id="l14.19">  * @param aController    the controller of the window to check</span>
<a href="#l14.20"></a><span id="l14.20">  * @param aBoxId         the id of the notification box</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineat">@@ -96,25 +97,76 @@ function wait_for_notification_to_stop(a</span>
<a href="#l14.22"></a><span id="l14.22">                       &quot;Timed out waiting for notification with value &quot; +</span>
<a href="#l14.23"></a><span id="l14.23">                       aValue + &quot; to stop.&quot;);</span>
<a href="#l14.24"></a><span id="l14.24"> }</span>
<a href="#l14.25"></a><span id="l14.25"> </span>
<a href="#l14.26"></a><span id="l14.26"> /**</span>
<a href="#l14.27"></a><span id="l14.27">  * A helper function that waits for a notification with value aValue</span>
<a href="#l14.28"></a><span id="l14.28">  * to show in the window.</span>
<a href="#l14.29"></a><span id="l14.29">  *</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">- * @param aController the controller for the compose window that we want</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+ * @param aController the controller for the window that we want</span>
<a href="#l14.32"></a><span id="l14.32">  *                    the notification to appear in</span>
<a href="#l14.33"></a><span id="l14.33">  * @param aBoxId the id of the notification box</span>
<a href="#l14.34"></a><span id="l14.34">  * @param aValue the value of the notification to wait for</span>
<a href="#l14.35"></a><span id="l14.35">  */</span>
<a href="#l14.36"></a><span id="l14.36"> function wait_for_notification_to_show(aController, aBoxId, aValue) {</span>
<a href="#l14.37"></a><span id="l14.37">   let nb = aController.window.document.getElementById(aBoxId);</span>
<a href="#l14.38"></a><span id="l14.38">   if (!nb)</span>
<a href="#l14.39"></a><span id="l14.39">     throw new Error(&quot;Couldn't find a notification box for id=&quot; + aBoxId);</span>
<a href="#l14.40"></a><span id="l14.40"> </span>
<a href="#l14.41"></a><span id="l14.41">   function nbReady() {</span>
<a href="#l14.42"></a><span id="l14.42">     return (nb.getNotificationWithValue(aValue) != null) &amp;&amp; !nb._animating;</span>
<a href="#l14.43"></a><span id="l14.43">   }</span>
<a href="#l14.44"></a><span id="l14.44">   aController.waitFor(nbReady,</span>
<a href="#l14.45"></a><span id="l14.45">                       &quot;Timed out waiting for notification with value &quot; +</span>
<a href="#l14.46"></a><span id="l14.46">                       aValue + &quot; to show.&quot;);</span>
<a href="#l14.47"></a><span id="l14.47"> }</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+/**</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+ * Gets a button in a notification, as those do not have IDs.</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+ *</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+ * @param aController The controller for the window</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+ *                    that has the notification.</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+ * @param aBoxId      The id of the notification box.</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+ * @param aValue      The value of the notification to find.</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+ * @param aMatch      Attributes of the button to find.</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+ *                    An object with key:value pairs,</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+ *                    similar to click_menus_in_sequence().</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+ */</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+function get_notification_button(aController, aBoxId, aValue, aMatch) {</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+  let nb = aController.window.document.getElementById(aBoxId);</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+  if (!nb)</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+    throw new Error(&quot;Couldn't find a notification box for id=&quot; + aBoxId);</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+  let notification = nb.getNotificationWithValue(aValue);</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+  let buttons = notification.querySelectorAll(&quot;button&quot;);</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+  for (let button of buttons) {</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+    let matchedAll = true;</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+    for (let name in aMatch) {</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+      let value = aMatch[name];</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+      let matched = false;</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineplus">+      if (name == &quot;popup&quot;) {</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+        if (button.getAttribute(&quot;type&quot;) == &quot;menu-button&quot; ||</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineplus">+            button.getAttribute(&quot;type&quot;) == &quot;menu&quot;) {</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineplus">+          // The button contains a menupopup as the first child.</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineplus">+          matched = (button.firstChild &amp;&amp;</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineplus">+                     (button.firstChild.tagName == &quot;menupopup&quot;) &amp;&amp;</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineplus">+                     (button.firstChild.id == value));</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineplus">+        } else {</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineplus">+          // The &quot;popup&quot; attribute is not on the button itself but in its</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+          // buttonInfo member.</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+          matched = ((&quot;buttonInfo&quot; in button) &amp;&amp; (button.buttonInfo.popup == value));</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+        }</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+      } else if (button.hasAttribute(name) &amp;&amp; button.getAttribute(name) == value) {</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+        matched = true;</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineplus">+      }</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+      if (!matched) {</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+        matchedAll = false;</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+        break;</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+      }</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+    }</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineplus">+    if (matchedAll)</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineplus">+      return button;</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+  }</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineplus">+</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineplus">+  throw new Error(&quot;Couldn't find the requested button on a notification&quot;);</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -937,30 +937,29 @@ var AugmentEverybodyWith = {</span>
<a href="#l15.4"></a><span id="l15.4">                               dis.click(aWhatToClick);</span>
<a href="#l15.5"></a><span id="l15.5">                             }, 1000);</span>
<a href="#l15.6"></a><span id="l15.6">     },</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8">     /**</span>
<a href="#l15.9"></a><span id="l15.9">      * Dynamically-built/XBL-defined menus can be hard to work with, this makes it</span>
<a href="#l15.10"></a><span id="l15.10">      *  easier.</span>
<a href="#l15.11"></a><span id="l15.11">      *</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-     * @param aRootPopup The base popup.  We will open it if it is not open or</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-     *     wait for it to open if it is in the process.</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-     * @param aActions A list of objects where each object has a single</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+     * @param aRootPopup  The base popup. The caller is expected to activate it</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+     *     (by clicking/rightclicking the right widget). We will only wait for it</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+     *     to open if it is in the process.</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+     * @param aActions  A list of objects where each object has a single</span>
<a href="#l15.19"></a><span id="l15.19">      *     attribute with a single value.  We pick the menu option whose DOM</span>
<a href="#l15.20"></a><span id="l15.20">      *     node has an attribute with that name and value.  We click whatever we</span>
<a href="#l15.21"></a><span id="l15.21">      *     find.  We throw if we don't find what you were asking for.</span>
<a href="#l15.22"></a><span id="l15.22">      * @param aKeepOpen  If set to true the popups are not closed after last click.</span>
<a href="#l15.23"></a><span id="l15.23">      *</span>
<a href="#l15.24"></a><span id="l15.24">      * @return  An array of popup elements that were left open. It will be</span>
<a href="#l15.25"></a><span id="l15.25">      *          an empty array if aKeepOpen was set to false.</span>
<a href="#l15.26"></a><span id="l15.26">      */</span>
<a href="#l15.27"></a><span id="l15.27">     click_menus_in_sequence: function _click_menus(aRootPopup, aActions, aKeepOpen) {</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-      if (aRootPopup.state == &quot;closed&quot;)</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-        aRootPopup.openPopup(null, &quot;&quot;, 0, 0, true, true);</span>
<a href="#l15.30"></a><span id="l15.30">       if (aRootPopup.state != &quot;open&quot;) { // handle &quot;showing&quot;</span>
<a href="#l15.31"></a><span id="l15.31">         utils.waitFor(() =&gt; aRootPopup.state == &quot;open&quot;,</span>
<a href="#l15.32"></a><span id="l15.32">                       &quot;Popup never opened! id=&quot; + aRootPopup.id +</span>
<a href="#l15.33"></a><span id="l15.33">                       &quot;, state=&quot; + aRootPopup.state);</span>
<a href="#l15.34"></a><span id="l15.34">       }</span>
<a href="#l15.35"></a><span id="l15.35">       // These popups sadly do not close themselves, so we need to keep track</span>
<a href="#l15.36"></a><span id="l15.36">       // of them so we can make sure they end up closed.</span>
<a href="#l15.37"></a><span id="l15.37">       let closeStack = [aRootPopup];</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineat">@@ -1033,24 +1032,38 @@ var AugmentEverybodyWith = {</span>
<a href="#l15.39"></a><span id="l15.39">      *</span>
<a href="#l15.40"></a><span id="l15.40">      * @param aCloseStack  An array of menupopup elements that are to be closed.</span>
<a href="#l15.41"></a><span id="l15.41">      *                     The elements are processed from the end of the array</span>
<a href="#l15.42"></a><span id="l15.42">      *                     to the front (a stack).</span>
<a href="#l15.43"></a><span id="l15.43">      */</span>
<a href="#l15.44"></a><span id="l15.44">     close_popup_sequence: function _close_popup_sequence(aCloseStack) {</span>
<a href="#l15.45"></a><span id="l15.45">       while (aCloseStack.length) {</span>
<a href="#l15.46"></a><span id="l15.46">         let curPopup = aCloseStack.pop();</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineminus">-        this.keypress(new elib.Elem(curPopup), &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineplus">+        if (curPopup.state == &quot;open&quot;)</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineplus">+          this.keypress(new elib.Elem(curPopup), &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l15.50"></a><span id="l15.50">         utils.waitFor(function() { return curPopup.state == &quot;closed&quot;; },</span>
<a href="#l15.51"></a><span id="l15.51">                       &quot;Popup did not close! id=&quot; + curPopup.id +</span>
<a href="#l15.52"></a><span id="l15.52">                       &quot;, state=&quot; +  curPopup.state, 5000, 50);</span>
<a href="#l15.53"></a><span id="l15.53">       }</span>
<a href="#l15.54"></a><span id="l15.54">     },</span>
<a href="#l15.55"></a><span id="l15.55"> </span>
<a href="#l15.56"></a><span id="l15.56">     /**</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+     * Get dropmarker arrow element from </span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+     *</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineplus">+     * @param aNode  An element containing a dropmarker, e.g. menulist or menu-button</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineplus">+     */</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineplus">+    get_menu_dropmarker: function(aNode) {</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineplus">+      let children = aNode.ownerDocument.getAnonymousNodes(aNode);</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineplus">+      for (let node of children) {</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineplus">+        if (node.tagName == &quot;xul:dropmarker&quot;)</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineplus">+          return node;</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineplus">+      }</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineplus">+    },</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineplus">+</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineplus">+    /**</span>
<a href="#l15.70"></a><span id="l15.70">      * mark_action helper method that produces something that can be concat()ed</span>
<a href="#l15.71"></a><span id="l15.71">      *  onto a list being passed to mark_action in order to describe the focus</span>
<a href="#l15.72"></a><span id="l15.72">      *  state of the window.  For now this will be a variable-length list but</span>
<a href="#l15.73"></a><span id="l15.73">      *  could be changed to a single object in the future.</span>
<a href="#l15.74"></a><span id="l15.74">      */</span>
<a href="#l15.75"></a><span id="l15.75">     describeFocus: function() {</span>
<a href="#l15.76"></a><span id="l15.76">       let arr = [</span>
<a href="#l15.77"></a><span id="l15.77">         &quot;in window:&quot;,</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineat">@@ -1091,17 +1104,17 @@ var AugmentEverybodyWith = {</span>
<a href="#l15.79"></a><span id="l15.79">  * border but are no longer so (bug 595652), so we need these wrappers to</span>
<a href="#l15.80"></a><span id="l15.80">  * perform the operations at the center when aLeft or aTop aren't passed in.</span>
<a href="#l15.81"></a><span id="l15.81">  */</span>
<a href="#l15.82"></a><span id="l15.82"> var MOUSE_OPS_TO_WRAP = [</span>
<a href="#l15.83"></a><span id="l15.83">   &quot;click&quot;, &quot;doubleClick&quot;, &quot;mouseDown&quot;, &quot;mouseOut&quot;, &quot;mouseOver&quot;, &quot;mouseUp&quot;,</span>
<a href="#l15.84"></a><span id="l15.84">   &quot;middleClick&quot;, &quot;rightClick&quot;,</span>
<a href="#l15.85"></a><span id="l15.85"> ];</span>
<a href="#l15.86"></a><span id="l15.86"> </span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-for (let [, mouseOp] in Iterator(MOUSE_OPS_TO_WRAP)) {</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineplus">+for (let mouseOp of MOUSE_OPS_TO_WRAP) {</span>
<a href="#l15.89"></a><span id="l15.89">   let thisMouseOp = mouseOp;</span>
<a href="#l15.90"></a><span id="l15.90">   let wrapperFunc = function (aElem, aLeft, aTop) {</span>
<a href="#l15.91"></a><span id="l15.91">     let el = aElem.getNode();</span>
<a href="#l15.92"></a><span id="l15.92">     let rect = el.getBoundingClientRect();</span>
<a href="#l15.93"></a><span id="l15.93">     if (aLeft === undefined)</span>
<a href="#l15.94"></a><span id="l15.94">       aLeft = rect.width / 2;</span>
<a href="#l15.95"></a><span id="l15.95">     if (aTop === undefined)</span>
<a href="#l15.96"></a><span id="l15.96">       aTop = rect.height / 2;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

