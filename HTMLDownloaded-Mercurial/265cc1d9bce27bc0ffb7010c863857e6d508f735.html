<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 12207:265cc1d9bce27bc0ffb7010c863857e6d508f735</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 265cc1d9bce27bc0ffb7010c863857e6d508f735" />
<meta property="og:url" content="/comm-central/rev/265cc1d9bce27bc0ffb7010c863857e6d508f735" />
<meta property="og:description" content="Bug 824150 - Code cleanup in /mail/ and /mailnews/: Use new String methods like startsWith, endsWith, contains, remaining Services.jsm switches and querySelector use instead of NodeList calls: internals. r=Standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 265cc1d9bce27bc0ffb7010c863857e6d508f735 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/265cc1d9bce27bc0ffb7010c863857e6d508f735">shortlog</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/265cc1d9bce27bc0ffb7010c863857e6d508f735">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735">files</a> |
changeset |
<a href="/comm-central/raw-rev/265cc1d9bce27bc0ffb7010c863857e6d508f735">raw</a>  | <a href="/comm-central/archive/265cc1d9bce27bc0ffb7010c863857e6d508f735.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=824150">Bug 824150</a> - Code cleanup in /mail/ and /mailnews/: Use new String methods like startsWith, endsWith, contains, remaining Services.jsm switches and querySelector use instead of NodeList calls: internals. r=Standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#101;&#98;&#97;&#115;&#116;&#105;&#97;&#110;&#32;&#72;&#101;&#110;&#103;&#115;&#116;&#32;&#60;&#97;&#114;&#99;&#104;&#97;&#101;&#111;&#112;&#116;&#101;&#114;&#121;&#120;&#64;&#99;&#111;&#111;&#108;&#101;&#45;&#102;&#105;&#108;&#101;&#115;&#46;&#100;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 26 Mar 2013 19:48:40 +0100</td></tr>

<tr>
 <td>changeset 12207</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/265cc1d9bce27bc0ffb7010c863857e6d508f735">265cc1d9bce27bc0ffb7010c863857e6d508f735</a></td>
</tr>



<tr>
<td>parent 12206</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/fd40aad70424b7d41d0c60024dababb64e3ecfff">fd40aad70424b7d41d0c60024dababb64e3ecfff</a>
</td>
</tr>

<tr>
<td>child 12208</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f6096640502692ffa2cd70a41373d00084d4454d">f6096640502692ffa2cd70a41373d00084d4454d</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=265cc1d9bce27bc0ffb7010c863857e6d508f735">9041</a></td></tr>
<tr><td>push user</td><td>ryanvm@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 27 Mar 2013 14:39:12 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ab8cfe8058f8 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ab8cfe8058f8811b276db2d90bae1132932c98bc">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ab8cfe8058f8811b276db2d90bae1132932c98bc&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ab8cfe8058f8811b276db2d90bae1132932c98bc&newProject=comm-central&newRevision=2775bb72271a4008fa44a376d470a98df827e7c6&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ab8cfe8058f8811b276db2d90bae1132932c98bc&newProject=comm-central&newRevision=2775bb72271a4008fa44a376d470a98df827e7c6&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ab8cfe8058f8811b276db2d90bae1132932c98bc&newProject=comm-central&newRevision=2775bb72271a4008fa44a376d470a98df827e7c6&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=824150">824150</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=824150">Bug 824150</a> - Code cleanup in /mail/ and /mailnews/: Use new String methods like startsWith, endsWith, contains, remaining Services.jsm switches and querySelector use instead of NodeList calls: internals. r=Standard8</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mail-offline.js">mail/base/content/mail-offline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mail-offline.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mail-offline.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mail-offline.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mail-offline.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mail-offline.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailCommands.js">mail/base/content/mailCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailCommands.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailCommands.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailCommands.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailCommands.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailWidgets.xml">mail/base/content/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/utilityOverlay.js">mail/base/content/utilityOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/utilityOverlay.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/utilityOverlay.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/utilityOverlay.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/utilityOverlay.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/content/utilityOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/dbViewWrapper.js">mail/base/modules/dbViewWrapper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/dbViewWrapper.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/dbViewWrapper.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/dbViewWrapper.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/dbViewWrapper.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/dbViewWrapper.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/mailInstrumentation.js">mail/base/modules/mailInstrumentation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/mailInstrumentation.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/mailInstrumentation.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/mailInstrumentation.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/mailInstrumentation.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/modules/mailInstrumentation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/resources/viewWrapperTestUtils.js">mail/base/test/unit/resources/viewWrapperTestUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/resources/viewWrapperTestUtils.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/resources/viewWrapperTestUtils.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/resources/viewWrapperTestUtils.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/resources/viewWrapperTestUtils.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/resources/viewWrapperTestUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_realFolder.js">mail/base/test/unit/test_viewWrapper_realFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_realFolder.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_realFolder.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_realFolder.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_realFolder.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_realFolder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_windows_font_migration.js">mail/base/test/unit/test_windows_font_migration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_windows_font_migration.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_windows_font_migration.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_windows_font_migration.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_windows_font_migration.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/base/test/unit/test_windows_font_migration.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/components/nsMailDefaultHandler.js">mail/components/nsMailDefaultHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/components/nsMailDefaultHandler.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/components/nsMailDefaultHandler.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/components/nsMailDefaultHandler.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/components/nsMailDefaultHandler.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/components/nsMailDefaultHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/instrumentation/test-instrument-setup.js">mail/test/mozmill/instrumentation/test-instrument-setup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/instrumentation/test-instrument-setup.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/instrumentation/test-instrument-setup.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/instrumentation/test-instrument-setup.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/instrumentation/test-instrument-setup.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/instrumentation/test-instrument-setup.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/migration-to-rdf-ui-2/test-migrate-to-rdf-ui-2.js">mail/test/mozmill/migration-to-rdf-ui-2/test-migrate-to-rdf-ui-2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/migration-to-rdf-ui-2/test-migrate-to-rdf-ui-2.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/migration-to-rdf-ui-2/test-migrate-to-rdf-ui-2.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/migration-to-rdf-ui-2/test-migrate-to-rdf-ui-2.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/migration-to-rdf-ui-2/test-migrate-to-rdf-ui-2.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/migration-to-rdf-ui-2/test-migrate-to-rdf-ui-2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/multiple-identities/test-display-names.js">mail/test/mozmill/multiple-identities/test-display-names.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/multiple-identities/test-display-names.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/multiple-identities/test-display-names.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/multiple-identities/test-display-names.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/multiple-identities/test-display-names.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/multiple-identities/test-display-names.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/notification/test-notification.js">mail/test/mozmill/notification/test-notification.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/notification/test-notification.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/notification/test-notification.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/notification/test-notification.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/notification/test-notification.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mail/test/mozmill/notification/test-notification.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/dateFormat.js">mailnews/base/content/dateFormat.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/dateFormat.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/dateFormat.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/dateFormat.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/dateFormat.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/dateFormat.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/msgPrintEngine.js">mailnews/base/content/msgPrintEngine.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/msgPrintEngine.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/msgPrintEngine.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/msgPrintEngine.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/msgPrintEngine.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/content/msgPrintEngine.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMailDirProvider.js">mailnews/base/test/unit/test_nsMailDirProvider.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMailDirProvider.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMailDirProvider.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMailDirProvider.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMailDirProvider.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMailDirProvider.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMsgDBView.js">mailnews/base/test/unit/test_nsMsgDBView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMsgDBView.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMsgDBView.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMsgDBView.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMsgDBView.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_nsMsgDBView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_quarantineFilterMove.js">mailnews/base/test/unit/test_quarantineFilterMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_quarantineFilterMove.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_quarantineFilterMove.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_quarantineFilterMove.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_quarantineFilterMove.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_quarantineFilterMove.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchBody.js">mailnews/base/test/unit/test_searchBody.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchBody.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchBody.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchBody.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchBody.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchBody.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchLocalizationStrings.js">mailnews/base/test/unit/test_searchLocalizationStrings.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchLocalizationStrings.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchLocalizationStrings.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchLocalizationStrings.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchLocalizationStrings.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/test/unit/test_searchLocalizationStrings.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/util/hostnameUtils.jsm">mailnews/base/util/hostnameUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/util/hostnameUtils.jsm">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/util/hostnameUtils.jsm">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/util/hostnameUtils.jsm">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/util/hostnameUtils.jsm">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/base/util/hostnameUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/extensions/smime/content/certFetchingStatus.js">mailnews/extensions/smime/content/certFetchingStatus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/extensions/smime/content/certFetchingStatus.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/extensions/smime/content/certFetchingStatus.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/extensions/smime/content/certFetchingStatus.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/extensions/smime/content/certFetchingStatus.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/extensions/smime/content/certFetchingStatus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/mime/test/unit/test_text_attachment.js">mailnews/mime/test/unit/test_text_attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/mime/test/unit/test_text_attachment.js">file</a> |
<a href="/comm-central/annotate/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/mime/test/unit/test_text_attachment.js">annotate</a> |
<a href="/comm-central/diff/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/mime/test/unit/test_text_attachment.js">diff</a> |
<a href="/comm-central/comparison/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/mime/test/unit/test_text_attachment.js">comparison</a> |
<a href="/comm-central/log/265cc1d9bce27bc0ffb7010c863857e6d508f735/mailnews/mime/test/unit/test_text_attachment.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mail-offline.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mail-offline.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -117,17 +117,17 @@ var MailOfflineMgr = {</span>
<a href="#l1.4"></a><span id="l1.4">       this.offlineBundle.getString('sendMessagesWindowTitle1'),</span>
<a href="#l1.5"></a><span id="l1.5">       this.offlineBundle.getString('sendMessagesLabel2'),</span>
<a href="#l1.6"></a><span id="l1.6">       (Services.prompt.BUTTON_TITLE_IS_STRING * Services.prompt.BUTTON_POS_0) +</span>
<a href="#l1.7"></a><span id="l1.7">       (Services.prompt.BUTTON_TITLE_IS_STRING * Services.prompt.BUTTON_POS_1),</span>
<a href="#l1.8"></a><span id="l1.8">       this.offlineBundle.getString('sendMessagesNow'),</span>
<a href="#l1.9"></a><span id="l1.9">       this.offlineBundle.getString('processMessagesLater'),</span>
<a href="#l1.10"></a><span id="l1.10">       null,</span>
<a href="#l1.11"></a><span id="l1.11">       this.offlineBundle.getString('sendMessagesCheckboxLabel1'),</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      alwaysAsk) == 0 ? true : false;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      alwaysAsk) == 0;</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15">     // if the user changed the ask me setting then update the global pref based on their yes / no answer</span>
<a href="#l1.16"></a><span id="l1.16">     if (!alwaysAsk.value)</span>
<a href="#l1.17"></a><span id="l1.17">       Services.prefs.setIntPref(&quot;offline.send.unsent_messages&quot;, sendUnsentMessages ? 1 : 2);</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19">     return sendUnsentMessages;</span>
<a href="#l1.20"></a><span id="l1.20">   },</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -165,17 +165,17 @@ var MailOfflineMgr = {</span>
<a href="#l1.23"></a><span id="l1.23">       this.offlineBundle.getString('downloadMessagesWindowTitle1'),</span>
<a href="#l1.24"></a><span id="l1.24">       this.offlineBundle.getString('downloadMessagesLabel1'),</span>
<a href="#l1.25"></a><span id="l1.25">       (Services.prompt.BUTTON_TITLE_IS_STRING * Services.prompt.BUTTON_POS_0) +</span>
<a href="#l1.26"></a><span id="l1.26">       (Services.prompt.BUTTON_TITLE_IS_STRING * Services.prompt.BUTTON_POS_1),</span>
<a href="#l1.27"></a><span id="l1.27">       this.offlineBundle.getString('downloadMessagesNow'),</span>
<a href="#l1.28"></a><span id="l1.28">       this.offlineBundle.getString('processMessagesLater'),</span>
<a href="#l1.29"></a><span id="l1.29">       null,</span>
<a href="#l1.30"></a><span id="l1.30">       this.offlineBundle.getString('downloadMessagesCheckboxLabel1'),</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-      alwaysAsk) == 0 ? true : false;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+      alwaysAsk) == 0;</span>
<a href="#l1.33"></a><span id="l1.33"> </span>
<a href="#l1.34"></a><span id="l1.34">     // if the user changed the ask me setting then update the global pref based on their yes / no answer</span>
<a href="#l1.35"></a><span id="l1.35">     if (!alwaysAsk.value)</span>
<a href="#l1.36"></a><span id="l1.36">       Services.prefs.setIntPref(&quot;offline.download.download_messages&quot;, downloadMessages ? 1 : 2);</span>
<a href="#l1.37"></a><span id="l1.37">     return downloadMessages;</span>
<a href="#l1.38"></a><span id="l1.38">   },</span>
<a href="#l1.39"></a><span id="l1.39"> </span>
<a href="#l1.40"></a><span id="l1.40">   /** </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/mailCommands.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/mailCommands.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -24,17 +24,17 @@ function getBestIdentity(identities, opt</span>
<a href="#l2.4"></a><span id="l2.4">     let hints = optionalHint.toLowerCase().split(&quot;,&quot;);</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6">     for (let i = 0 ; i &lt; hints.length; i++) {</span>
<a href="#l2.7"></a><span id="l2.7">       for each (let identity in fixIterator(identities,</span>
<a href="#l2.8"></a><span id="l2.8">                   Components.interfaces.nsIMsgIdentity)) {</span>
<a href="#l2.9"></a><span id="l2.9">         if (!identity.email)</span>
<a href="#l2.10"></a><span id="l2.10">           continue;</span>
<a href="#l2.11"></a><span id="l2.11">         if (hints[i].trim() == identity.email.toLowerCase() ||</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-            hints[i].indexOf(&quot;&lt;&quot; + identity.email.toLowerCase() + &quot;&gt;&quot;) != -1)</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+            hints[i].contains(&quot;&lt;&quot; + identity.email.toLowerCase() + &quot;&gt;&quot;))</span>
<a href="#l2.14"></a><span id="l2.14">           return identity;</span>
<a href="#l2.15"></a><span id="l2.15">       }</span>
<a href="#l2.16"></a><span id="l2.16">     }</span>
<a href="#l2.17"></a><span id="l2.17">   }</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">   // Still no matches? Give up and pick the first one.</span>
<a href="#l2.20"></a><span id="l2.20">   return identities.queryElementAt(0, Components.interfaces.nsIMsgIdentity);</span>
<a href="#l2.21"></a><span id="l2.21"> }</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -68,17 +68,17 @@ function getIdentityForHeader(hdr, type)</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24">     for (let i = 0; i &lt; deliveredTos.length; i++) {</span>
<a href="#l2.25"></a><span id="l2.25">       for each (let identity in fixIterator(accountManager.allIdentities,</span>
<a href="#l2.26"></a><span id="l2.26">                                   Components.interfaces.nsIMsgIdentity)) {</span>
<a href="#l2.27"></a><span id="l2.27">         if (!identity.email)</span>
<a href="#l2.28"></a><span id="l2.28">           continue;</span>
<a href="#l2.29"></a><span id="l2.29">         // If the deliver-to header contains the defined identity, that's it.</span>
<a href="#l2.30"></a><span id="l2.30">         if (deliveredTos[i] == identity.email.toLowerCase() ||</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-            deliveredTos[i].indexOf(&quot;&lt;&quot; + identity.email.toLowerCase() + &quot;&gt;&quot;) != -1)</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+            deliveredTos[i].contains(&quot;&lt;&quot; + identity.email.toLowerCase() + &quot;&gt;&quot;))</span>
<a href="#l2.33"></a><span id="l2.33">           return identity.email;</span>
<a href="#l2.34"></a><span id="l2.34">       }</span>
<a href="#l2.35"></a><span id="l2.35">     }</span>
<a href="#l2.36"></a><span id="l2.36">     return &quot;&quot;;</span>
<a href="#l2.37"></a><span id="l2.37">   }</span>
<a href="#l2.38"></a><span id="l2.38"> </span>
<a href="#l2.39"></a><span id="l2.39">   let hintForIdentity = &quot;&quot;;</span>
<a href="#l2.40"></a><span id="l2.40">   if (type == Components.interfaces.nsIMsgCompType.ReplyToList)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/mailWidgets.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1454,17 +1454,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">             let isCustom = isNaN(this.value);</span>
<a href="#l3.5"></a><span id="l3.5">             let typedValue = isCustom ? this.value : parseInt(this.value);</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7">             // custom attribute to style the unavailable menulist item</span>
<a href="#l3.8"></a><span id="l3.8">             menulist.setAttribute(&quot;unavailable&quot;,</span>
<a href="#l3.9"></a><span id="l3.9">               (this.valueIds.indexOf(typedValue) &lt; 0) ? &quot;true&quot; : null);</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">             // add a hidden menulist item if value is missing</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-            let menuitem = menulist.getElementsByAttribute(&quot;value&quot;, this.value).item(0);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+            let menuitem = menulist.querySelector('[value=&quot;' + this.value + '&quot;]');</span>
<a href="#l3.14"></a><span id="l3.14">             if (!menuitem)</span>
<a href="#l3.15"></a><span id="l3.15">             { // need to add a hidden menuitem</span>
<a href="#l3.16"></a><span id="l3.16">               menuitem = menulist.appendItem(this.valueLabel, this.value);</span>
<a href="#l3.17"></a><span id="l3.17">               menuitem.hidden = true;</span>
<a href="#l3.18"></a><span id="l3.18">             }</span>
<a href="#l3.19"></a><span id="l3.19">             return menuitem;</span>
<a href="#l3.20"></a><span id="l3.20">           ]]&gt;</span>
<a href="#l3.21"></a><span id="l3.21">         &lt;/getter&gt;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -1827,19 +1827,19 @@</span>
<a href="#l3.23"></a><span id="l3.23">                 val == Components.interfaces.nsMsgSearchOp.IsInAB) {</span>
<a href="#l3.24"></a><span id="l3.24">               // if the old internalOperator was</span>
<a href="#l3.25"></a><span id="l3.25">               // IsntInAB or IsInAB, and the new internalOperator is</span>
<a href="#l3.26"></a><span id="l3.26">               // IsntInAB or IsInAB, noop because the search value</span>
<a href="#l3.27"></a><span id="l3.27">               // was an ab type, and it still is.</span>
<a href="#l3.28"></a><span id="l3.28">               // otherwise, switch to the ab picker and select the PAB</span>
<a href="#l3.29"></a><span id="l3.29">               if (this.internalOperator != Components.interfaces.nsMsgSearchOp.IsntInAB &amp;&amp;</span>
<a href="#l3.30"></a><span id="l3.30">                   this.internalOperator != Components.interfaces.nsMsgSearchOp.IsInAB) {</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-                var abs = children[4].getElementsByAttribute(&quot;value&quot;, &quot;moz-abmdbdirectory://abook.mab&quot;);</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-                if (abs.item(0))</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-                  children[4].selectedItem = abs[0];</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+                var abs = children[4].querySelector('[value=&quot;moz-abmdbdirectory://abook.mab&quot;]');</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+                if (abs)</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+                  children[4].selectedItem = abs;</span>
<a href="#l3.37"></a><span id="l3.37">                 this.setAttribute(&quot;selectedIndex&quot;, &quot;4&quot;);</span>
<a href="#l3.38"></a><span id="l3.38">               }</span>
<a href="#l3.39"></a><span id="l3.39">             }</span>
<a href="#l3.40"></a><span id="l3.40">             else {</span>
<a href="#l3.41"></a><span id="l3.41">               // if the old internalOperator wasn't</span>
<a href="#l3.42"></a><span id="l3.42">               // IsntInAB or IsInAB, and the new internalOperator isn't</span>
<a href="#l3.43"></a><span id="l3.43">               // IsntInAB or IsInAB, noop because the search value</span>
<a href="#l3.44"></a><span id="l3.44">               // wasn't an ab type, and it still isn't.</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineat">@@ -1944,71 +1944,71 @@</span>
<a href="#l3.46"></a><span id="l3.46">           if (isNaN(attrib)) // a custom term</span>
<a href="#l3.47"></a><span id="l3.47">           {</span>
<a href="#l3.48"></a><span id="l3.48">             let customHbox = document.getAnonymousNodes(this)[10];</span>
<a href="#l3.49"></a><span id="l3.49">             customHbox.setAttribute(&quot;value&quot;, val.str);</span>
<a href="#l3.50"></a><span id="l3.50">             return val;</span>
<a href="#l3.51"></a><span id="l3.51">           }</span>
<a href="#l3.52"></a><span id="l3.52">           if (attrib == nsMsgSearchAttrib.Priority) {</span>
<a href="#l3.53"></a><span id="l3.53">             var matchingPriority =</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-              children[1].getElementsByAttribute(&quot;value&quot;, val.priority);</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-            if (matchingPriority.item(0))</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-              children[1].selectedItem = matchingPriority[0];</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+              children[1].querySelector('[value=&quot;' + val.priority + '&quot;]');</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+            if (matchingPriority)</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+              children[1].selectedItem = matchingPriority;</span>
<a href="#l3.60"></a><span id="l3.60">           }</span>
<a href="#l3.61"></a><span id="l3.61">           else if (attrib == nsMsgSearchAttrib.MsgStatus) {</span>
<a href="#l3.62"></a><span id="l3.62">             var matchingStatus =</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-              children[2].getElementsByAttribute(&quot;value&quot;, val.status);</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-            if (matchingStatus.item(0))</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-              children[2].selectedItem = matchingStatus[0];</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+              children[2].querySelector('[value=&quot;' + val.status + '&quot;]');</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+            if (matchingStatus)</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+              children[2].selectedItem = matchingStatus;</span>
<a href="#l3.69"></a><span id="l3.69">           }</span>
<a href="#l3.70"></a><span id="l3.70">           else if (attrib == nsMsgSearchAttrib.AgeInDays)</span>
<a href="#l3.71"></a><span id="l3.71">             children[9].value = val.age;</span>
<a href="#l3.72"></a><span id="l3.72">           else if (attrib == nsMsgSearchAttrib.Date)</span>
<a href="#l3.73"></a><span id="l3.73">             children[3].value = convertPRTimeToString(val.date);</span>
<a href="#l3.74"></a><span id="l3.74">           else if (attrib == nsMsgSearchAttrib.Sender ||</span>
<a href="#l3.75"></a><span id="l3.75">                    attrib == nsMsgSearchAttrib.To ||</span>
<a href="#l3.76"></a><span id="l3.76">                    attrib == nsMsgSearchAttrib.CC ||</span>
<a href="#l3.77"></a><span id="l3.77">                    attrib == nsMsgSearchAttrib.AllAddresses ||</span>
<a href="#l3.78"></a><span id="l3.78">                    attrib == nsMsgSearchAttrib.ToOrCC)</span>
<a href="#l3.79"></a><span id="l3.79">           {</span>
<a href="#l3.80"></a><span id="l3.80">             if (this.internalOperator == Components.interfaces.nsMsgSearchOp.IsntInAB ||</span>
<a href="#l3.81"></a><span id="l3.81">                 this.internalOperator == Components.interfaces.nsMsgSearchOp.IsInAB) {</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-              var abs = children[4].getElementsByAttribute(&quot;value&quot;, val.str);</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-              if (abs.item(0))</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-                children[4].selectedItem = abs[0];</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+              var abs = children[4].querySelector('[value=&quot;' + val.str + '&quot;]');</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+              if (abs)</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+                children[4].selectedItem = abs;</span>
<a href="#l3.88"></a><span id="l3.88">             }</span>
<a href="#l3.89"></a><span id="l3.89">             else</span>
<a href="#l3.90"></a><span id="l3.90">               children[0].value = val.str;</span>
<a href="#l3.91"></a><span id="l3.91">           }</span>
<a href="#l3.92"></a><span id="l3.92">           else if (attrib == nsMsgSearchAttrib.Keywords)</span>
<a href="#l3.93"></a><span id="l3.93">           {</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineminus">-            var keywordVal = children[5].getElementsByAttribute(&quot;value&quot;, val.str);</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineminus">-            if (keywordVal.item(0))</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+            var keywordVal = children[5].querySelector('[value=&quot;' + val.str + '&quot;]');</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+            if (keywordVal)</span>
<a href="#l3.98"></a><span id="l3.98">             {</span>
<a href="#l3.99"></a><span id="l3.99">               children[5].value = val.str;</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineminus">-              children[5].selectedItem = keywordVal[0];</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+              children[5].selectedItem = keywordVal;</span>
<a href="#l3.102"></a><span id="l3.102">             }</span>
<a href="#l3.103"></a><span id="l3.103">           }</span>
<a href="#l3.104"></a><span id="l3.104">           else if (attrib == nsMsgSearchAttrib.JunkStatus) {</span>
<a href="#l3.105"></a><span id="l3.105">             var junkStatus =</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-              children[6].getElementsByAttribute(&quot;value&quot;, val.junkStatus);</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-            if (junkStatus.item(0))</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineminus">-              children[6].selectedItem = junkStatus[0];</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+              children[6].querySelector('[value=&quot;' + val.junkStatus + '&quot;]');</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+            if (junkStatus)</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineplus">+              children[6].selectedItem = junkStatus;</span>
<a href="#l3.112"></a><span id="l3.112">           }</span>
<a href="#l3.113"></a><span id="l3.113">           else if (attrib == nsMsgSearchAttrib.HasAttachmentStatus) {</span>
<a href="#l3.114"></a><span id="l3.114">             var hasAttachmentStatus =</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineminus">-              children[7].getElementsByAttribute(&quot;value&quot;, val.hasAttachmentStatus);</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-            if (hasAttachmentStatus.item(0))</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineminus">-              children[7].selectedItem = hasAttachmentStatus[0];</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+              children[7].querySelector('[value=&quot;' + val.hasAttachmentStatus + '&quot;]');</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+            if (hasAttachmentStatus)</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineplus">+              children[7].selectedItem = hasAttachmentStatus;</span>
<a href="#l3.121"></a><span id="l3.121">           }</span>
<a href="#l3.122"></a><span id="l3.122">           else if (attrib == nsMsgSearchAttrib.JunkScoreOrigin) {</span>
<a href="#l3.123"></a><span id="l3.123">             var junkScoreOrigin =</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineminus">-              children[8].getElementsByAttribute(&quot;value&quot;, val.str);</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineminus">-            if (junkScoreOrigin.item(0))</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-              children[8].selectedItem = junkScoreOrigin[0];</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+              children[8].querySelector('[value=&quot;' + val.str + '&quot;]');</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+            if (junkScoreOrigin)</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+              children[8].selectedItem = junkScoreOrigin;</span>
<a href="#l3.130"></a><span id="l3.130">           }</span>
<a href="#l3.131"></a><span id="l3.131">           else if (attrib == nsMsgSearchAttrib.JunkPercent) {</span>
<a href="#l3.132"></a><span id="l3.132">             children[9].value = val.junkPercent;</span>
<a href="#l3.133"></a><span id="l3.133">           }</span>
<a href="#l3.134"></a><span id="l3.134">           else if (attrib == nsMsgSearchAttrib.Size) {</span>
<a href="#l3.135"></a><span id="l3.135">             children[9].value = val.size;</span>
<a href="#l3.136"></a><span id="l3.136">           }</span>
<a href="#l3.137"></a><span id="l3.137">           else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/utilityOverlay.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/utilityOverlay.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -113,24 +113,24 @@ function GenerateValidFilename(filename,</span>
<a href="#l4.4"></a><span id="l4.4">       return filename + extension;</span>
<a href="#l4.5"></a><span id="l4.5">   }</span>
<a href="#l4.6"></a><span id="l4.6">   return null;</span>
<a href="#l4.7"></a><span id="l4.7"> }</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9"> function validateFileName(aFileName)</span>
<a href="#l4.10"></a><span id="l4.10"> {</span>
<a href="#l4.11"></a><span id="l4.11">   var re = /[\/]+/g;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  if (navigator.appVersion.indexOf(&quot;Windows&quot;) != -1) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  if (navigator.appVersion.contains(&quot;Windows&quot;)) {</span>
<a href="#l4.14"></a><span id="l4.14">     re = /[\\\/\|]+/g;</span>
<a href="#l4.15"></a><span id="l4.15">     aFileName = aFileName.replace(/[\&quot;]+/g, &quot;'&quot;);</span>
<a href="#l4.16"></a><span id="l4.16">     aFileName = aFileName.replace(/[\*\:\?]+/g, &quot; &quot;);</span>
<a href="#l4.17"></a><span id="l4.17">     aFileName = aFileName.replace(/[\&lt;]+/g, &quot;(&quot;);</span>
<a href="#l4.18"></a><span id="l4.18">     aFileName = aFileName.replace(/[\&gt;]+/g, &quot;)&quot;);</span>
<a href="#l4.19"></a><span id="l4.19">   }</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-  else if (navigator.appVersion.indexOf(&quot;Macintosh&quot;) != -1)</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+  else if (navigator.appVersion.contains(&quot;Macintosh&quot;))</span>
<a href="#l4.22"></a><span id="l4.22">     re = /[\:\/]+/g;</span>
<a href="#l4.23"></a><span id="l4.23">   </span>
<a href="#l4.24"></a><span id="l4.24">   return aFileName.replace(re, &quot;_&quot;);</span>
<a href="#l4.25"></a><span id="l4.25"> }</span>
<a href="#l4.26"></a><span id="l4.26"> </span>
<a href="#l4.27"></a><span id="l4.27"> function goToggleToolbar( id, elementID )</span>
<a href="#l4.28"></a><span id="l4.28"> {</span>
<a href="#l4.29"></a><span id="l4.29">   var toolbar = document.getElementById( id );</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/modules/dbViewWrapper.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/modules/dbViewWrapper.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -970,17 +970,17 @@ DBViewWrapper.prototype = {</span>
<a href="#l5.4"></a><span id="l5.4">       // if there is a view tag (basically &quot;:tagname&quot;), then it's a</span>
<a href="#l5.5"></a><span id="l5.5">       //  mailview tag.  clearly.</span>
<a href="#l5.6"></a><span id="l5.6">       let mailViewTag = dbFolderInfo.getCharProperty(</span>
<a href="#l5.7"></a><span id="l5.7">                           MailViewConstants.kViewCurrentTag);</span>
<a href="#l5.8"></a><span id="l5.8">       // &quot;0&quot; and &quot;1&quot; are all and unread views, respectively, from 2.0</span>
<a href="#l5.9"></a><span id="l5.9">       if (mailViewTag &amp;&amp; mailViewTag != &quot;0&quot; &amp;&amp; mailViewTag != &quot;1&quot;) {</span>
<a href="#l5.10"></a><span id="l5.10">         // the tag gets stored with a &quot;:&quot; on the front, presumably done</span>
<a href="#l5.11"></a><span id="l5.11">         //  as a means of name-spacing that was never subsequently leveraged.</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-        if (mailViewTag[0] == &quot;:&quot;)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+        if (mailViewTag.startsWith(&quot;:&quot;))</span>
<a href="#l5.14"></a><span id="l5.14">           mailViewTag = mailViewTag.substr(1);</span>
<a href="#l5.15"></a><span id="l5.15">         // (the true is so we don't persist)</span>
<a href="#l5.16"></a><span id="l5.16">         this.setMailView(MailViewConstants.kViewItemTags, mailViewTag, true);</span>
<a href="#l5.17"></a><span id="l5.17">       }</span>
<a href="#l5.18"></a><span id="l5.18">       // otherwise it's just an index. we kinda-sorta migrate from old-school</span>
<a href="#l5.19"></a><span id="l5.19">       //  $label tags, except someone reused one of the indices for</span>
<a href="#l5.20"></a><span id="l5.20">       //  kViewItemNotDeleted, which means that $label2 can no longer be</span>
<a href="#l5.21"></a><span id="l5.21">       //  migrated.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/modules/mailInstrumentation.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/modules/mailInstrumentation.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -51,17 +51,17 @@ var mailInstrumentationManager =</span>
<a href="#l6.4"></a><span id="l6.4">   msgAdded: function (aMsg) {</span>
<a href="#l6.5"></a><span id="l6.5">     gMFNService.removeListener(this);</span>
<a href="#l6.6"></a><span id="l6.6">     this._mfnListener = false;</span>
<a href="#l6.7"></a><span id="l6.7">     mailInstrumentationManager.addEvent(&quot;msgDownloaded&quot;, true);</span>
<a href="#l6.8"></a><span id="l6.8">   },</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10">   _accountsChanged: function() {</span>
<a href="#l6.11"></a><span id="l6.11">     // check if there are at least two accounts - one is local folders account</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    if (Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;).indexOf(',') &gt; 0) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    if (Services.prefs.getCharPref(&quot;mail.accountmanager.accounts&quot;).contains(',', 1)) {</span>
<a href="#l6.14"></a><span id="l6.14">       mailInstrumentationManager.addEvent(&quot;accountAdded&quot;, true);</span>
<a href="#l6.15"></a><span id="l6.15">       this._removeObserver(&quot;mail.accountmanager.accounts&quot;,</span>
<a href="#l6.16"></a><span id="l6.16">                            this._accountsChanged);</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18">     }</span>
<a href="#l6.19"></a><span id="l6.19">   },</span>
<a href="#l6.20"></a><span id="l6.20">   _smtpServerAdded: function() {</span>
<a href="#l6.21"></a><span id="l6.21">     mailInstrumentationManager.addEvent(&quot;smtpServerAdded&quot;, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/test/unit/resources/viewWrapperTestUtils.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/test/unit/resources/viewWrapperTestUtils.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.5"></a><span id="l7.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.6"></a><span id="l7.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> Components.utils.import(&quot;resource:///modules/dbViewWrapper.js&quot;);</span>
<a href="#l7.9"></a><span id="l7.9"> Components.utils.import(&quot;resource:///modules/mailViewManager.js&quot;);</span>
<a href="#l7.10"></a><span id="l7.10"> Components.utils.import(&quot;resource:///modules/virtualFolderWrapper.js&quot;);</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l7.12"></a><span id="l7.12"> </span>
<a href="#l7.13"></a><span id="l7.13"> var gInbox;</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15"> /**</span>
<a href="#l7.16"></a><span id="l7.16">  * Do initialization for xpcshell-tests; not used by</span>
<a href="#l7.17"></a><span id="l7.17">  *  test-folder-display-helpers.js, our friendly mozmill test helper.</span>
<a href="#l7.18"></a><span id="l7.18">  */</span>
<a href="#l7.19"></a><span id="l7.19"> function initViewWrapperTestUtils(aInjectionConfig) {</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineat">@@ -73,20 +74,19 @@ var gFakeCommandUpdater = {</span>
<a href="#l7.21"></a><span id="l7.21">   }</span>
<a href="#l7.22"></a><span id="l7.22"> };</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24"> var gMockViewWrapperListener = {</span>
<a href="#l7.25"></a><span id="l7.25">   __proto__: IDBViewWrapperListener.prototype,</span>
<a href="#l7.26"></a><span id="l7.26">   shouldUseMailViews: true,</span>
<a href="#l7.27"></a><span id="l7.27">   shouldDeferMessageDisplayUntilAfterServerConnect: false,</span>
<a href="#l7.28"></a><span id="l7.28">   shouldMarkMessagesReadOnLeavingFolder : function(aMsgFolder) {</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-      return Cc[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-                 .getService(Ci.nsIPrefBranch)</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-                 .getBoolPref(&quot;mailnews.mark_message_read.&quot; +</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-                              aMsgFolder.server.type);</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+      return Services.prefs</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+                     .getBoolPref(&quot;mailnews.mark_message_read.&quot; +</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+                                  aMsgFolder.server.type);</span>
<a href="#l7.36"></a><span id="l7.36">   },</span>
<a href="#l7.37"></a><span id="l7.37">   messenger: null,</span>
<a href="#l7.38"></a><span id="l7.38">   // use no message window!</span>
<a href="#l7.39"></a><span id="l7.39">   msgWindow: null,</span>
<a href="#l7.40"></a><span id="l7.40">   threadPaneCommandUpdater: gFakeCommandUpdater,</span>
<a href="#l7.41"></a><span id="l7.41">   // event handlers</span>
<a href="#l7.42"></a><span id="l7.42">   allMessagesLoadedEventCount: 0,</span>
<a href="#l7.43"></a><span id="l7.43">   onMessagesLoaded: function(aAll) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_realFolder.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_realFolder.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -9,16 +9,18 @@ load(&quot;../../../../mailnews/resources/asy</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5"> load(&quot;../../../../mailnews/resources/messageGenerator.js&quot;);</span>
<a href="#l8.6"></a><span id="l8.6"> load(&quot;../../../../mailnews/resources/messageModifier.js&quot;);</span>
<a href="#l8.7"></a><span id="l8.7"> load(&quot;../../../../mailnews/resources/messageInjection.js&quot;);</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> load(&quot;resources/viewWrapperTestUtils.js&quot;);</span>
<a href="#l8.10"></a><span id="l8.10"> initViewWrapperTestUtils();</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+</span>
<a href="#l8.14"></a><span id="l8.14"> /* ===== Real Folder, no features ===== */</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16"> /**</span>
<a href="#l8.17"></a><span id="l8.17">  * Open a pre-populated real folder, make sure all the messages show up.</span>
<a href="#l8.18"></a><span id="l8.18">  */</span>
<a href="#l8.19"></a><span id="l8.19"> function test_real_folder_load() {</span>
<a href="#l8.20"></a><span id="l8.20">   let viewWrapper = make_view_wrapper();</span>
<a href="#l8.21"></a><span id="l8.21">   let [msgFolder, msgSet] = make_folder_with_sets(1);</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -536,36 +538,34 @@ function test_real_folder_special_views_</span>
<a href="#l8.23"></a><span id="l8.23">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l8.24"></a><span id="l8.24">   assert_true(viewWrapper.specialViewThreadsWithUnread,</span>
<a href="#l8.25"></a><span id="l8.25">               &quot;We should be in threads-with-unread special view mode.&quot;);</span>
<a href="#l8.26"></a><span id="l8.26"> }</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28"> function test_real_folder_mark_read_on_exit() {</span>
<a href="#l8.29"></a><span id="l8.29">   // set a pref so that the local folders account will think we should</span>
<a href="#l8.30"></a><span id="l8.30">   // mark messages read when leaving the folder.</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  let prefs = Cc[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-              .getService(Ci.nsIPrefBranch);</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-  prefs.setBoolPref(&quot;mailnews.mark_message_read.none&quot;, true);</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+  Services.prefs.setBoolPref(&quot;mailnews.mark_message_read.none&quot;, true);</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36">   let viewWrapper = make_view_wrapper();</span>
<a href="#l8.37"></a><span id="l8.37">   let folder = make_empty_folder();</span>
<a href="#l8.38"></a><span id="l8.38">   yield async_view_open(viewWrapper, folder);</span>
<a href="#l8.39"></a><span id="l8.39"> </span>
<a href="#l8.40"></a><span id="l8.40">   // add some unread messages.</span>
<a href="#l8.41"></a><span id="l8.41">   let [setOne] = make_new_sets_in_folder(folder, 1);</span>
<a href="#l8.42"></a><span id="l8.42">   setOne.setRead(false);</span>
<a href="#l8.43"></a><span id="l8.43">   // verify that we have unread messages.</span>
<a href="#l8.44"></a><span id="l8.44">   assert_equals(folder.getNumUnread(false), setOne.synMessages.length,</span>
<a href="#l8.45"></a><span id="l8.45">                 &quot;all messages should have been added as unread&quot;);</span>
<a href="#l8.46"></a><span id="l8.46">   viewWrapper.close(false);</span>
<a href="#l8.47"></a><span id="l8.47">   // verify that closing the view does the expected marking of the messages</span>
<a href="#l8.48"></a><span id="l8.48">   // as read.</span>
<a href="#l8.49"></a><span id="l8.49">   assert_equals(folder.getNumUnread(false), 0,</span>
<a href="#l8.50"></a><span id="l8.50">                 &quot;messages should have been marked read on view close&quot;);</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-  prefs.clearUserPref(&quot;mailnews.mark_message_read.none&quot;);</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+  Services.prefs.clearUserPref(&quot;mailnews.mark_message_read.none&quot;);</span>
<a href="#l8.53"></a><span id="l8.53"> }</span>
<a href="#l8.54"></a><span id="l8.54"> </span>
<a href="#l8.55"></a><span id="l8.55"> var tests = [</span>
<a href="#l8.56"></a><span id="l8.56">   test_real_folder_load,</span>
<a href="#l8.57"></a><span id="l8.57">   test_real_folder_update,</span>
<a href="#l8.58"></a><span id="l8.58">   test_real_folder_load_after_real_folder_load,</span>
<a href="#l8.59"></a><span id="l8.59">   // - threading modes</span>
<a href="#l8.60"></a><span id="l8.60">   test_real_folder_threading_unthreaded,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -30,17 +30,17 @@ gCustomSearchTermSubject = {</span>
<a href="#l9.4"></a><span id="l9.4">   getAvailable: function subject_getAvailable(scope, op) {</span>
<a href="#l9.5"></a><span id="l9.5">     return true;</span>
<a href="#l9.6"></a><span id="l9.6">   },</span>
<a href="#l9.7"></a><span id="l9.7">   getAvailableOperators: function subject_getAvailableOperators(scope, length) {</span>
<a href="#l9.8"></a><span id="l9.8">     length.value = 1;</span>
<a href="#l9.9"></a><span id="l9.9">     return [Components.interfaces.nsMsgSearchOp.Contains];</span>
<a href="#l9.10"></a><span id="l9.10">   },</span>
<a href="#l9.11"></a><span id="l9.11">   match: function subject_match(aMsgHdr, aSearchValue, aSearchOp) {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    return (aMsgHdr.subject.indexOf(aSearchValue) != -1);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    return (aMsgHdr.subject.contains(aSearchValue));</span>
<a href="#l9.14"></a><span id="l9.14">   },</span>
<a href="#l9.15"></a><span id="l9.15">   needsBody: false,</span>
<a href="#l9.16"></a><span id="l9.16"> };</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18"> let filterService = Cc[&quot;@mozilla.org/messenger/services/filters;1&quot;]</span>
<a href="#l9.19"></a><span id="l9.19">                       .getService(Ci.nsIMsgFilterService);</span>
<a href="#l9.20"></a><span id="l9.20"> filterService.addCustomTerm(gCustomSearchTermSubject);</span>
<a href="#l9.21"></a><span id="l9.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/base/test/unit/test_windows_font_migration.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/base/test/unit/test_windows_font_migration.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -5,19 +5,17 @@</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5"> /*</span>
<a href="#l10.6"></a><span id="l10.6">  * Test font preference migration. This currently only makes sense on Windows --</span>
<a href="#l10.7"></a><span id="l10.7">  * however, we're able to test for all versions of Windows, regardless of which</span>
<a href="#l10.8"></a><span id="l10.8">  * version the test is run on.</span>
<a href="#l10.9"></a><span id="l10.9">  */</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11"> Components.utils.import(&quot;resource:///modules/mailMigrator.js&quot;);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-var gPrefBranch = Cc[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-                    .getService(Ci.nsIPrefBranch);</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l10.16"></a><span id="l10.16"> </span>
<a href="#l10.17"></a><span id="l10.17"> /**</span>
<a href="#l10.18"></a><span id="l10.18">  * A list of font names to verify using |makeVerifier| and</span>
<a href="#l10.19"></a><span id="l10.19">  * |verifier|. |makeVerifier| expects all the prefs to be passed in, while</span>
<a href="#l10.20"></a><span id="l10.20">  * |verifier| doesn't require any.</span>
<a href="#l10.21"></a><span id="l10.21">  */</span>
<a href="#l10.22"></a><span id="l10.22"> const kNamesToVerify = [&quot;serif&quot;, &quot;sans&quot;, &quot;monospace&quot;];</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24" class="difflineat">@@ -48,25 +46,25 @@ function makeVerifier(aFonts) {</span>
<a href="#l10.25"></a><span id="l10.25">       let nonDefaultKey = key + (aFonts.migrated ? &quot;&quot; : &quot;Non&quot;) + &quot;Migrated&quot;;</span>
<a href="#l10.26"></a><span id="l10.26">       expectedFonts[key] = (nonDefaultKey in aNonDefaultFonts ?</span>
<a href="#l10.27"></a><span id="l10.27">                             aNonDefaultFonts[nonDefaultKey] :</span>
<a href="#l10.28"></a><span id="l10.28">                             aFonts[key]);</span>
<a href="#l10.29"></a><span id="l10.29">     }</span>
<a href="#l10.30"></a><span id="l10.30"> </span>
<a href="#l10.31"></a><span id="l10.31">     // A distinct lack of magic here, so that failing stuff is generally easier</span>
<a href="#l10.32"></a><span id="l10.32">     // to comment out and debug.</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-    do_check_eq(gPrefBranch.getCharPref(&quot;font.name.serif.&quot; + aEncoding),</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+    do_check_eq(Services.prefs.getCharPref(&quot;font.name.serif.&quot; + aEncoding),</span>
<a href="#l10.35"></a><span id="l10.35">                 expectedFonts.serif);</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-    do_check_eq(gPrefBranch.getCharPref(&quot;font.name.sans-serif.&quot; + aEncoding),</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+    do_check_eq(Services.prefs.getCharPref(&quot;font.name.sans-serif.&quot; + aEncoding),</span>
<a href="#l10.38"></a><span id="l10.38">                 expectedFonts.sans);</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-    do_check_eq(gPrefBranch.getCharPref(&quot;font.name.monospace.&quot; + aEncoding),</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+    do_check_eq(Services.prefs.getCharPref(&quot;font.name.monospace.&quot; + aEncoding),</span>
<a href="#l10.41"></a><span id="l10.41">                 expectedFonts.monospace);</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-    do_check_eq(gPrefBranch.getIntPref(&quot;font.size.variable.&quot; + aEncoding),</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+    do_check_eq(Services.prefs.getIntPref(&quot;font.size.variable.&quot; + aEncoding),</span>
<a href="#l10.44"></a><span id="l10.44">                 expectedFonts.variableSize);</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-    do_check_eq(gPrefBranch.getIntPref(&quot;font.size.fixed.&quot; + aEncoding),</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+    do_check_eq(Services.prefs.getIntPref(&quot;font.size.fixed.&quot; + aEncoding),</span>
<a href="#l10.47"></a><span id="l10.47">                 expectedFonts.fixedSize);</span>
<a href="#l10.48"></a><span id="l10.48">   }</span>
<a href="#l10.49"></a><span id="l10.49"> </span>
<a href="#l10.50"></a><span id="l10.50">   return verifier;</span>
<a href="#l10.51"></a><span id="l10.51"> }</span>
<a href="#l10.52"></a><span id="l10.52"> </span>
<a href="#l10.53"></a><span id="l10.53"> /**</span>
<a href="#l10.54"></a><span id="l10.54">  * Verifier function for non-ClearType fonts.</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineat">@@ -132,23 +130,23 @@ const kPrefBranchesToClear = [</span>
<a href="#l10.56"></a><span id="l10.56">  * @param [aDontResetVersion] Whether mail.font.windows.version should not be</span>
<a href="#l10.57"></a><span id="l10.57">  *     reset, defaults to false.</span>
<a href="#l10.58"></a><span id="l10.58">  */</span>
<a href="#l10.59"></a><span id="l10.59"> function reset_font_prefs(aDontResetVersion) {</span>
<a href="#l10.60"></a><span id="l10.60">   // kPrefBranchesToClear x kEncodingsToClear</span>
<a href="#l10.61"></a><span id="l10.61">   for (let [, prefBranch] in Iterator(kPrefBranchesToClear)) {</span>
<a href="#l10.62"></a><span id="l10.62">     for (let [, encoding] in Iterator(kEncodingsToClear)) {</span>
<a href="#l10.63"></a><span id="l10.63">       let pref = prefBranch + encoding;</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-      if (gPrefBranch.prefHasUserValue(pref))</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">-        gPrefBranch.clearUserPref(pref);</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+      if (Services.prefs.prefHasUserValue(pref))</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+        Services.prefs.clearUserPref(pref);</span>
<a href="#l10.68"></a><span id="l10.68">     }</span>
<a href="#l10.69"></a><span id="l10.69">   }</span>
<a href="#l10.70"></a><span id="l10.70">   if (!aDontResetVersion &amp;&amp;</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineminus">-      gPrefBranch.prefHasUserValue(&quot;mail.font.windows.version&quot;))</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineminus">-    gPrefBranch.clearUserPref(&quot;mail.font.windows.version&quot;);</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+      Services.prefs.prefHasUserValue(&quot;mail.font.windows.version&quot;))</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+    Services.prefs.clearUserPref(&quot;mail.font.windows.version&quot;);</span>
<a href="#l10.75"></a><span id="l10.75"> }</span>
<a href="#l10.76"></a><span id="l10.76"> </span>
<a href="#l10.77"></a><span id="l10.77"> /**</span>
<a href="#l10.78"></a><span id="l10.78">  * Test that migrating all prefs from defaults works.</span>
<a href="#l10.79"></a><span id="l10.79">  */</span>
<a href="#l10.80"></a><span id="l10.80"> function test_migrating_all_prefs(aVerifier) {</span>
<a href="#l10.81"></a><span id="l10.81">   MailMigrator.migrateToClearTypeFonts();</span>
<a href="#l10.82"></a><span id="l10.82">   aVerifier(&quot;x-unicode&quot;, null);</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineat">@@ -167,21 +165,21 @@ function test_not_migrating_serif(aVerif</span>
<a href="#l10.84"></a><span id="l10.84">   // All the fonts we set are make-believe</span>
<a href="#l10.85"></a><span id="l10.85">   let nonDefaultFonts = {</span>
<a href="#l10.86"></a><span id="l10.86">     serif: &quot;Foo Serif&quot;,</span>
<a href="#l10.87"></a><span id="l10.87">     // If we do not migrate, the font size shouldn't be clobbered at all.</span>
<a href="#l10.88"></a><span id="l10.88">     variableSizeNonMigrated: 20,</span>
<a href="#l10.89"></a><span id="l10.89">   };</span>
<a href="#l10.90"></a><span id="l10.90">   // If we do migrate, if the default style is serif, the font size shouldn't be</span>
<a href="#l10.91"></a><span id="l10.91">   // clobbered. (Otherwise it should.)</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineminus">-  if (gPrefBranch.getCharPref(&quot;font.default.x-unicode&quot;) == &quot;serif&quot;)</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+  if (Services.prefs.getCharPref(&quot;font.default.x-unicode&quot;) == &quot;serif&quot;)</span>
<a href="#l10.94"></a><span id="l10.94">     nonDefaultFonts.variableSizeMigrated = 20;</span>
<a href="#l10.95"></a><span id="l10.95"> </span>
<a href="#l10.96"></a><span id="l10.96" class="difflineminus">-  gPrefBranch.setCharPref(&quot;font.name.serif.x-unicode&quot;, &quot;Foo Serif&quot;);</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineminus">-  gPrefBranch.setIntPref(&quot;font.size.variable.x-unicode&quot;, 20);</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineplus">+  Services.prefs.setCharPref(&quot;font.name.serif.x-unicode&quot;, &quot;Foo Serif&quot;);</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+  Services.prefs.setIntPref(&quot;font.size.variable.x-unicode&quot;, 20);</span>
<a href="#l10.100"></a><span id="l10.100"> </span>
<a href="#l10.101"></a><span id="l10.101">   MailMigrator.migrateToClearTypeFonts();</span>
<a href="#l10.102"></a><span id="l10.102"> </span>
<a href="#l10.103"></a><span id="l10.103">   aVerifier(&quot;x-unicode&quot;, nonDefaultFonts);</span>
<a href="#l10.104"></a><span id="l10.104">   aVerifier(&quot;x-western&quot;, null);</span>
<a href="#l10.105"></a><span id="l10.105">   aVerifier(&quot;x-central-euro&quot;, null);</span>
<a href="#l10.106"></a><span id="l10.106">   aVerifier(&quot;x-cyrillic&quot;, null);</span>
<a href="#l10.107"></a><span id="l10.107">   aVerifier(&quot;x-baltic&quot;, null);</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineat">@@ -195,21 +193,21 @@ function test_not_migrating_serif(aVerif</span>
<a href="#l10.109"></a><span id="l10.109"> function test_not_migrating_sans(aVerifier) {</span>
<a href="#l10.110"></a><span id="l10.110">   let nonDefaultFonts = {</span>
<a href="#l10.111"></a><span id="l10.111">     sans: &quot;Foo Sans&quot;,</span>
<a href="#l10.112"></a><span id="l10.112">     // If we do not migrate, the font size shouldn't be clobbered at all.</span>
<a href="#l10.113"></a><span id="l10.113">     variableSizeNonMigrated: 20,</span>
<a href="#l10.114"></a><span id="l10.114">   };</span>
<a href="#l10.115"></a><span id="l10.115">   // If we do migrate, if the default style is sans-serif, the font size</span>
<a href="#l10.116"></a><span id="l10.116">   // shouldn't be clobbered. (Otherwise it should.)</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineminus">-  if (gPrefBranch.getCharPref(&quot;font.default.x-unicode&quot;) == &quot;sans-serif&quot;)</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+  if (Services.prefs.getCharPref(&quot;font.default.x-unicode&quot;) == &quot;sans-serif&quot;)</span>
<a href="#l10.119"></a><span id="l10.119">     nonDefaultFonts.variableSizeMigrated = 20;</span>
<a href="#l10.120"></a><span id="l10.120"> </span>
<a href="#l10.121"></a><span id="l10.121" class="difflineminus">-  gPrefBranch.setCharPref(&quot;font.name.sans-serif.x-unicode&quot;, &quot;Foo Sans&quot;);</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineminus">-  gPrefBranch.setIntPref(&quot;font.size.variable.x-unicode&quot;, 20);</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineplus">+  Services.prefs.setCharPref(&quot;font.name.sans-serif.x-unicode&quot;, &quot;Foo Sans&quot;);</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineplus">+  Services.prefs.setIntPref(&quot;font.size.variable.x-unicode&quot;, 20);</span>
<a href="#l10.125"></a><span id="l10.125"> </span>
<a href="#l10.126"></a><span id="l10.126">   MailMigrator.migrateToClearTypeFonts();</span>
<a href="#l10.127"></a><span id="l10.127"> </span>
<a href="#l10.128"></a><span id="l10.128">   aVerifier(&quot;x-unicode&quot;, nonDefaultFonts);</span>
<a href="#l10.129"></a><span id="l10.129">   aVerifier(&quot;x-western&quot;, null);</span>
<a href="#l10.130"></a><span id="l10.130">   aVerifier(&quot;x-central-euro&quot;, null);</span>
<a href="#l10.131"></a><span id="l10.131">   aVerifier(&quot;x-cyrillic&quot;, null);</span>
<a href="#l10.132"></a><span id="l10.132">   aVerifier(&quot;x-baltic&quot;, null);</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineat">@@ -223,58 +221,58 @@ function test_not_migrating_sans(aVerifi</span>
<a href="#l10.134"></a><span id="l10.134"> function test_not_migrating_monospace(aVerifier) {</span>
<a href="#l10.135"></a><span id="l10.135">   let nonDefaultFonts = {</span>
<a href="#l10.136"></a><span id="l10.136">     monospace: &quot;Foo Mono&quot;,</span>
<a href="#l10.137"></a><span id="l10.137">     // The font size should remain what we've set it to below.</span>
<a href="#l10.138"></a><span id="l10.138">     fixedSizeMigrated: 20,</span>
<a href="#l10.139"></a><span id="l10.139">     fixedSizeNonMigrated: 20,</span>
<a href="#l10.140"></a><span id="l10.140">   };</span>
<a href="#l10.141"></a><span id="l10.141"> </span>
<a href="#l10.142"></a><span id="l10.142" class="difflineminus">-  gPrefBranch.setCharPref(&quot;font.name.monospace.x-unicode&quot;, &quot;Foo Mono&quot;);</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineminus">-  gPrefBranch.setIntPref(&quot;font.size.fixed.x-unicode&quot;, 20);</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineplus">+  Services.prefs.setCharPref(&quot;font.name.monospace.x-unicode&quot;, &quot;Foo Mono&quot;);</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineplus">+  Services.prefs.setIntPref(&quot;font.size.fixed.x-unicode&quot;, 20);</span>
<a href="#l10.146"></a><span id="l10.146"> </span>
<a href="#l10.147"></a><span id="l10.147">   MailMigrator.migrateToClearTypeFonts();</span>
<a href="#l10.148"></a><span id="l10.148"> </span>
<a href="#l10.149"></a><span id="l10.149">   aVerifier(&quot;x-unicode&quot;, nonDefaultFonts);</span>
<a href="#l10.150"></a><span id="l10.150">   aVerifier(&quot;x-western&quot;, null);</span>
<a href="#l10.151"></a><span id="l10.151">   aVerifier(&quot;x-central-euro&quot;, null);</span>
<a href="#l10.152"></a><span id="l10.152">   aVerifier(&quot;x-cyrillic&quot;, null);</span>
<a href="#l10.153"></a><span id="l10.153">   aVerifier(&quot;x-baltic&quot;, null);</span>
<a href="#l10.154"></a><span id="l10.154">   aVerifier(&quot;el&quot;, null);</span>
<a href="#l10.155"></a><span id="l10.155">   aVerifier(&quot;tr&quot;, null);</span>
<a href="#l10.156"></a><span id="l10.156"> }</span>
<a href="#l10.157"></a><span id="l10.157"> </span>
<a href="#l10.158"></a><span id="l10.158"> /**</span>
<a href="#l10.159"></a><span id="l10.159">  * Test migrating from the default fonts but from font sizes that aren't so.</span>
<a href="#l10.160"></a><span id="l10.160">  */</span>
<a href="#l10.161"></a><span id="l10.161"> function test_migrating_non_default_font_sizes(aVerifier) {</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineminus">-  gPrefBranch.setIntPref(&quot;font.size.variable.x-unicode&quot;, 20);</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineminus">-  gPrefBranch.setIntPref(&quot;font.size.fixed.x-western&quot;, 30);</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineminus">-  gPrefBranch.setIntPref(&quot;font.size.variable.x-central-euro&quot;, 40);</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineminus">-  gPrefBranch.setIntPref(&quot;font.size.fixed.x-cyrillic&quot;, 50);</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineminus">-  gPrefBranch.setIntPref(&quot;font.size.variable.x-baltic&quot;, 60);</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineminus">-  gPrefBranch.setIntPref(&quot;font.size.fixed.el&quot;, 70);</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineminus">-  gPrefBranch.setIntPref(&quot;font.size.variable.tr&quot;, 80);</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineplus">+  Services.prefs.setIntPref(&quot;font.size.variable.x-unicode&quot;, 20);</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineplus">+  Services.prefs.setIntPref(&quot;font.size.fixed.x-western&quot;, 30);</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineplus">+  Services.prefs.setIntPref(&quot;font.size.variable.x-central-euro&quot;, 40);</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineplus">+  Services.prefs.setIntPref(&quot;font.size.fixed.x-cyrillic&quot;, 50);</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineplus">+  Services.prefs.setIntPref(&quot;font.size.variable.x-baltic&quot;, 60);</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineplus">+  Services.prefs.setIntPref(&quot;font.size.fixed.el&quot;, 70);</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineplus">+  Services.prefs.setIntPref(&quot;font.size.variable.tr&quot;, 80);</span>
<a href="#l10.176"></a><span id="l10.176"> </span>
<a href="#l10.177"></a><span id="l10.177">   MailMigrator.migrateToClearTypeFonts();</span>
<a href="#l10.178"></a><span id="l10.178"> </span>
<a href="#l10.179"></a><span id="l10.179">   aVerifier(&quot;x-unicode&quot;, {variableSizeNonMigrated: 20});</span>
<a href="#l10.180"></a><span id="l10.180">   aVerifier(&quot;x-western&quot;, {fixedSizeNonMigrated: 30});</span>
<a href="#l10.181"></a><span id="l10.181">   aVerifier(&quot;x-central-euro&quot;, {variableSizeNonMigrated: 40});</span>
<a href="#l10.182"></a><span id="l10.182">   aVerifier(&quot;x-cyrillic&quot;, {fixedSizeNonMigrated: 50});</span>
<a href="#l10.183"></a><span id="l10.183">   aVerifier(&quot;x-baltic&quot;, {variableSizeNonMigrated: 60});</span>
<a href="#l10.184"></a><span id="l10.184">   aVerifier(&quot;el&quot;, {fixedSizeNonMigrated: 70});</span>
<a href="#l10.185"></a><span id="l10.185">   aVerifier(&quot;tr&quot;, {variableSizeNonMigrated: 80});</span>
<a href="#l10.186"></a><span id="l10.186"> }</span>
<a href="#l10.187"></a><span id="l10.187"> </span>
<a href="#l10.188"></a><span id="l10.188"> /**</span>
<a href="#l10.189"></a><span id="l10.189">  * Test incremental migration from mail.font.windows.version = 1.</span>
<a href="#l10.190"></a><span id="l10.190">  */</span>
<a href="#l10.191"></a><span id="l10.191"> function test_migrate_from_version_1(aVerifier) {</span>
<a href="#l10.192"></a><span id="l10.192" class="difflineminus">-  gPrefBranch.setIntPref(&quot;mail.font.windows.version&quot;, 1);</span>
<a href="#l10.193"></a><span id="l10.193" class="difflineplus">+  Services.prefs.setIntPref(&quot;mail.font.windows.version&quot;, 1);</span>
<a href="#l10.194"></a><span id="l10.194">   MailMigrator.migrateToClearTypeFonts();</span>
<a href="#l10.195"></a><span id="l10.195"> </span>
<a href="#l10.196"></a><span id="l10.196">   // Unicode and Western shouldn't have been migrated.</span>
<a href="#l10.197"></a><span id="l10.197">   gNonCTVerifier(&quot;x-unicode&quot;, null);</span>
<a href="#l10.198"></a><span id="l10.198">   gNonCTVerifier(&quot;x-western&quot;, null);</span>
<a href="#l10.199"></a><span id="l10.199">   // These character encodings should have been migrated.</span>
<a href="#l10.200"></a><span id="l10.200">   aVerifier(&quot;x-central-euro&quot;, null);</span>
<a href="#l10.201"></a><span id="l10.201">   aVerifier(&quot;x-cyrillic&quot;, null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/nsMailDefaultHandler.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/nsMailDefaultHandler.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -13,17 +13,16 @@ const nsISupports              = Compone</span>
<a href="#l11.4"></a><span id="l11.4"> const nsICommandLine           = Components.interfaces.nsICommandLine;</span>
<a href="#l11.5"></a><span id="l11.5"> const nsICommandLineHandler    = Components.interfaces.nsICommandLineHandler;</span>
<a href="#l11.6"></a><span id="l11.6"> const nsICommandLineValidator  = Components.interfaces.nsICommandLineValidator;</span>
<a href="#l11.7"></a><span id="l11.7"> const nsIDOMWindow             = Components.interfaces.nsIDOMWindow;</span>
<a href="#l11.8"></a><span id="l11.8"> const nsIFactory               = Components.interfaces.nsIFactory;</span>
<a href="#l11.9"></a><span id="l11.9"> const nsIFileURL               = Components.interfaces.nsIFileURL;</span>
<a href="#l11.10"></a><span id="l11.10"> const nsINetUtil               = Components.interfaces.nsINetUtil;</span>
<a href="#l11.11"></a><span id="l11.11"> const nsISupportsString        = Components.interfaces.nsISupportsString;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-const nsIURIFixup              = Components.interfaces.nsIURIFixup;</span>
<a href="#l11.13"></a><span id="l11.13"> const nsIURILoader             = Components.interfaces.nsIURILoader;</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15"> const NS_ERROR_ABORT = Components.results.NS_ERROR_ABORT;</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17"> const URI_INHERITS_SECURITY_CONTEXT = Components.interfaces.nsIProtocolHandler</span>
<a href="#l11.18"></a><span id="l11.18">                                         .URI_INHERITS_SECURITY_CONTEXT;</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20"> function resolveURIInternal(aCmdLine, aArgument) {</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineat">@@ -40,20 +39,17 @@ function resolveURIInternal(aCmdLine, aA</span>
<a href="#l11.22"></a><span id="l11.22">   catch (e) {</span>
<a href="#l11.23"></a><span id="l11.23">     Components.utils.reportError(e);</span>
<a href="#l11.24"></a><span id="l11.24">   }</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26">   // We have interpreted the argument as a relative file URI, but the file</span>
<a href="#l11.27"></a><span id="l11.27">   // doesn't exist. Try URI fixup heuristics: see bug 290782.</span>
<a href="#l11.28"></a><span id="l11.28"> </span>
<a href="#l11.29"></a><span id="l11.29">   try {</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-    var urifixup = Components.classes[&quot;@mozilla.org/docshell/urifixup;1&quot;]</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-                             .getService(nsIURIFixup);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-    uri = urifixup.createFixupURI(aArgument, 0);</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+    uri = Services.uriFixup.createFixupURI(aArgument, 0);</span>
<a href="#l11.35"></a><span id="l11.35">   }</span>
<a href="#l11.36"></a><span id="l11.36">   catch (e) {</span>
<a href="#l11.37"></a><span id="l11.37">     Components.utils.reportError(e);</span>
<a href="#l11.38"></a><span id="l11.38">   }</span>
<a href="#l11.39"></a><span id="l11.39"> </span>
<a href="#l11.40"></a><span id="l11.40">   return uri;</span>
<a href="#l11.41"></a><span id="l11.41"> }</span>
<a href="#l11.42"></a><span id="l11.42"> </span>
<a href="#l11.43"></a><span id="l11.43" class="difflineat">@@ -266,88 +262,83 @@ var nsMailDefaultHandler = {</span>
<a href="#l11.44"></a><span id="l11.44">     // The URI might be passed as the argument to the file parameter</span>
<a href="#l11.45"></a><span id="l11.45">     uri = cmdLine.handleFlagWithParam(&quot;file&quot;, false);</span>
<a href="#l11.46"></a><span id="l11.46"> </span>
<a href="#l11.47"></a><span id="l11.47">     var count = cmdLine.length;</span>
<a href="#l11.48"></a><span id="l11.48">     if (count) {</span>
<a href="#l11.49"></a><span id="l11.49">       var i = 0;</span>
<a href="#l11.50"></a><span id="l11.50">       while (i &lt; count) {</span>
<a href="#l11.51"></a><span id="l11.51">         var curarg = cmdLine.getArgument(i);</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-        if (!curarg.match(/^-/))</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+        if (!curarg.startsWith(&quot;-&quot;))</span>
<a href="#l11.54"></a><span id="l11.54">           break;</span>
<a href="#l11.55"></a><span id="l11.55"> </span>
<a href="#l11.56"></a><span id="l11.56">         dump (&quot;Warning: unrecognized command line flag &quot; + curarg + &quot;\n&quot;);</span>
<a href="#l11.57"></a><span id="l11.57">         // To emulate the pre-nsICommandLine behavior, we ignore the</span>
<a href="#l11.58"></a><span id="l11.58">         // argument after an unrecognized flag.</span>
<a href="#l11.59"></a><span id="l11.59">         i += 2;</span>
<a href="#l11.60"></a><span id="l11.60">         // xxxbsmedberg: make me use the console service!</span>
<a href="#l11.61"></a><span id="l11.61">       }</span>
<a href="#l11.62"></a><span id="l11.62"> </span>
<a href="#l11.63"></a><span id="l11.63">       if (i &lt; count) {</span>
<a href="#l11.64"></a><span id="l11.64">         uri = cmdLine.getArgument(i);</span>
<a href="#l11.65"></a><span id="l11.65"> </span>
<a href="#l11.66"></a><span id="l11.66">         // mailto: URIs are frequently passed with spaces in them. They should be</span>
<a href="#l11.67"></a><span id="l11.67">         // escaped into %20, but we hack around bad clients, see bug 231032</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineminus">-        if (uri.match(/^mailto:/)) {</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineplus">+        if (uri.startsWith(&quot;mailto:&quot;)) {</span>
<a href="#l11.70"></a><span id="l11.70">           while (++i &lt; count) {</span>
<a href="#l11.71"></a><span id="l11.71">             var testarg = cmdLine.getArgument(i);</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineminus">-            if (testarg.match(/^-/))</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+            if (testarg.startsWith(&quot;-&quot;))</span>
<a href="#l11.74"></a><span id="l11.74">               break;</span>
<a href="#l11.75"></a><span id="l11.75"> </span>
<a href="#l11.76"></a><span id="l11.76">             uri += &quot; &quot; + testarg;</span>
<a href="#l11.77"></a><span id="l11.77">           }</span>
<a href="#l11.78"></a><span id="l11.78">         }</span>
<a href="#l11.79"></a><span id="l11.79">       }</span>
<a href="#l11.80"></a><span id="l11.80">     }</span>
<a href="#l11.81"></a><span id="l11.81"> </span>
<a href="#l11.82"></a><span id="l11.82">     if (!uri &amp;&amp; cmdLine.preventDefault)</span>
<a href="#l11.83"></a><span id="l11.83">       return;</span>
<a href="#l11.84"></a><span id="l11.84"> </span>
<a href="#l11.85"></a><span id="l11.85">     if (!uri &amp;&amp; cmdLine.state != nsICommandLine.STATE_INITIAL_LAUNCH) {</span>
<a href="#l11.86"></a><span id="l11.86">       try {</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineminus">-        var wmed = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineminus">-                             .getService(nsIWindowMediator);</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineminus">-</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineminus">-        var wlist = wmed.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+        var wlist = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l11.92"></a><span id="l11.92">         if (wlist.hasMoreElements()) {</span>
<a href="#l11.93"></a><span id="l11.93">           var window = wlist.getNext().QueryInterface(nsIDOMWindow);</span>
<a href="#l11.94"></a><span id="l11.94">           window.focus();</span>
<a href="#l11.95"></a><span id="l11.95">           return;</span>
<a href="#l11.96"></a><span id="l11.96">         }</span>
<a href="#l11.97"></a><span id="l11.97">       }</span>
<a href="#l11.98"></a><span id="l11.98">       catch (e) {</span>
<a href="#l11.99"></a><span id="l11.99">         dump(e);</span>
<a href="#l11.100"></a><span id="l11.100">       }</span>
<a href="#l11.101"></a><span id="l11.101">     }</span>
<a href="#l11.102"></a><span id="l11.102"> </span>
<a href="#l11.103"></a><span id="l11.103">     if (uri) {</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineminus">-      if (/^feed:/i.test(uri)) {</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineplus">+      if (uri.toLowerCase().startsWith(&quot;feed:&quot;)) {</span>
<a href="#l11.106"></a><span id="l11.106">         try {</span>
<a href="#l11.107"></a><span id="l11.107">           Components.classes[&quot;@mozilla.org/newsblog-feed-downloader;1&quot;]</span>
<a href="#l11.108"></a><span id="l11.108">                     .getService(Components.interfaces.nsINewsBlogFeedDownloader)</span>
<a href="#l11.109"></a><span id="l11.109">                     .subscribeToFeed(uri, null, null);</span>
<a href="#l11.110"></a><span id="l11.110">         }</span>
<a href="#l11.111"></a><span id="l11.111">         catch (e) {</span>
<a href="#l11.112"></a><span id="l11.112">           // If feed handling is not installed, do nothing</span>
<a href="#l11.113"></a><span id="l11.113">         }</span>
<a href="#l11.114"></a><span id="l11.114">       }</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineminus">-      else if (/\.mozeml$/i.test(uri) || /\.wdseml$/i.test(uri)) {</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineplus">+      else if (uri.toLowerCase().endsWith(&quot;.mozeml&quot;) || uri.toLowerCase().endsWith(&quot;.wdseml&quot;)) {</span>
<a href="#l11.117"></a><span id="l11.117">         handleIndexerResult(cmdLine.resolveFile(uri));</span>
<a href="#l11.118"></a><span id="l11.118">         cmdLine.preventDefault = true;</span>
<a href="#l11.119"></a><span id="l11.119">       }</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineminus">-      else if (/\.eml$/i.test(uri)) {</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineplus">+      else if (uri.toLowerCase().endsWith(&quot;.eml&quot;)) {</span>
<a href="#l11.122"></a><span id="l11.122">         // Open this eml in a new message window</span>
<a href="#l11.123"></a><span id="l11.123">         let file = cmdLine.resolveFile(uri);</span>
<a href="#l11.124"></a><span id="l11.124">         // No point in trying to open a file if it doesn't exist or is empty</span>
<a href="#l11.125"></a><span id="l11.125">         if (file.exists() &amp;&amp; file.fileSize &gt; 0) {</span>
<a href="#l11.126"></a><span id="l11.126">           // Get the URL for this file</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineminus">-          let ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineminus">-                              .getService(Components.interfaces.nsIIOService);</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineminus">-          let fileURL = ios.newFileURI(file)</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineminus">-                           .QueryInterface(Components.interfaces.nsIFileURL);</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineplus">+          let fileURL = Services.io.newFileURI(file)</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineplus">+                                .QueryInterface(Components.interfaces.nsIFileURL);</span>
<a href="#l11.133"></a><span id="l11.133">           fileURL.query = &quot;?type=application/x-message-display&quot;;</span>
<a href="#l11.134"></a><span id="l11.134"> </span>
<a href="#l11.135"></a><span id="l11.135">           Services.ww.openWindow(null,</span>
<a href="#l11.136"></a><span id="l11.136">                                  &quot;chrome://messenger/content/messageWindow.xul&quot;,</span>
<a href="#l11.137"></a><span id="l11.137">                                  &quot;_blank&quot;, &quot;all,chrome,dialog=no,status,toolbar&quot;,</span>
<a href="#l11.138"></a><span id="l11.138">                                  fileURL);</span>
<a href="#l11.139"></a><span id="l11.139">           cmdLine.preventDefault = true;</span>
<a href="#l11.140"></a><span id="l11.140">         }</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineat">@@ -362,17 +353,17 @@ var nsMailDefaultHandler = {</span>
<a href="#l11.142"></a><span id="l11.142">             // The file is empty</span>
<a href="#l11.143"></a><span id="l11.143">             title = bundle.GetStringFromName(&quot;fileEmptyTitle&quot;);</span>
<a href="#l11.144"></a><span id="l11.144">             message = bundle.formatStringFromName(&quot;fileEmptyMsg&quot;, [file.path], 1);</span>
<a href="#l11.145"></a><span id="l11.145">           }</span>
<a href="#l11.146"></a><span id="l11.146"> </span>
<a href="#l11.147"></a><span id="l11.147">           Services.prompt.alert(null, title, message);</span>
<a href="#l11.148"></a><span id="l11.148">         }</span>
<a href="#l11.149"></a><span id="l11.149">       }</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineminus">-      else if (/\.vcf$/i.test(uri)) {</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineplus">+      else if (uri.toLowerCase().endsWith(&quot;.vcf&quot;)) {</span>
<a href="#l11.152"></a><span id="l11.152">         // A VCard! Be smart and open the &quot;add contact&quot; dialog.</span>
<a href="#l11.153"></a><span id="l11.153">         let file = cmdLine.resolveFile(uri);</span>
<a href="#l11.154"></a><span id="l11.154">         if (file.exists() &amp;&amp; file.fileSize &gt; 0) {</span>
<a href="#l11.155"></a><span id="l11.155">           NetUtil.asyncFetch(file, function(inputStream, status) {</span>
<a href="#l11.156"></a><span id="l11.156">             if (!Components.isSuccessCode(status)) {</span>
<a href="#l11.157"></a><span id="l11.157">               return;</span>
<a href="#l11.158"></a><span id="l11.158">             }</span>
<a href="#l11.159"></a><span id="l11.159"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/test/mozmill/instrumentation/test-instrument-setup.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/test/mozmill/instrumentation/test-instrument-setup.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -22,33 +22,31 @@ var user = {</span>
<a href="#l12.4"></a><span id="l12.4">   name: &quot;Roger Sterling&quot;,</span>
<a href="#l12.5"></a><span id="l12.5">   email: &quot;roger.sterling@example.com&quot;,</span>
<a href="#l12.6"></a><span id="l12.6">   incomingHost: &quot;testin.example.com&quot;,</span>
<a href="#l12.7"></a><span id="l12.7">   outgoingHost: &quot;testout.example.com&quot;,</span>
<a href="#l12.8"></a><span id="l12.8"> };</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11"> function setupModule(module) {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  let pref = Cc[&quot;@mozilla.org/preferences-service;1&quot;].getService(Ci.nsIPrefBranch);</span>
<a href="#l12.13"></a><span id="l12.13">   wh = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l12.14"></a><span id="l12.14">   wh.installInto(module);</span>
<a href="#l12.15"></a><span id="l12.15">   var fdh = collector.getModule(&quot;folder-display-helpers&quot;);</span>
<a href="#l12.16"></a><span id="l12.16">   fdh.installInto(module);</span>
<a href="#l12.17"></a><span id="l12.17">   var amh = collector.getModule(&quot;account-manager-helpers&quot;);</span>
<a href="#l12.18"></a><span id="l12.18">   amh.installInto(module);</span>
<a href="#l12.19"></a><span id="l12.19">   var kh = collector.getModule(&quot;keyboard-helpers&quot;);</span>
<a href="#l12.20"></a><span id="l12.20">   kh.installInto(module);</span>
<a href="#l12.21"></a><span id="l12.21"> }</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23"> function test_mail_account_setup() {</span>
<a href="#l12.24"></a><span id="l12.24">   // Set the pref to load a local autoconfig file.</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-  let pref = Cc[&quot;@mozilla.org/preferences-service;1&quot;].getService(Ci.nsIPrefBranch);</span>
<a href="#l12.26"></a><span id="l12.26">   let pref_name = &quot;mailnews.auto_config_url&quot;;</span>
<a href="#l12.27"></a><span id="l12.27">   let url = collector.addHttpResource(&quot;../account/xml&quot;, &quot;autoconfig&quot;);</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-  pref.setCharPref(pref_name, url);</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+  Services.prefs.setCharPref(pref_name, url);</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31">   // Force .com MIME-Type to text/xml</span>
<a href="#l12.32"></a><span id="l12.32">   collector.httpd.registerContentType(&quot;com&quot;, &quot;text/xml&quot;);</span>
<a href="#l12.33"></a><span id="l12.33"> </span>
<a href="#l12.34"></a><span id="l12.34">   // Spawn the existing mail account config dialog by clicking on</span>
<a href="#l12.35"></a><span id="l12.35">   // File &gt; New &gt; Existing Mail Account</span>
<a href="#l12.36"></a><span id="l12.36">   mc.click(mc.eid(&quot;newMailAccountMenuItem&quot;));</span>
<a href="#l12.37"></a><span id="l12.37">   awc = wh.wait_for_existing_window(&quot;mail:autoconfig&quot;);</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineat">@@ -70,17 +68,17 @@ function test_mail_account_setup() {</span>
<a href="#l12.39"></a><span id="l12.39">               8000, 600);</span>
<a href="#l12.40"></a><span id="l12.40">   config = awc.window.gEmailConfigWizard._currentConfig;</span>
<a href="#l12.41"></a><span id="l12.41">   plan_for_window_close(awc);</span>
<a href="#l12.42"></a><span id="l12.42">   awc.e(&quot;create_button&quot;).click();</span>
<a href="#l12.43"></a><span id="l12.43"> </span>
<a href="#l12.44"></a><span id="l12.44">   let events = mc.window.mailInstrumentationManager._currentState.events;</span>
<a href="#l12.45"></a><span id="l12.45"> </span>
<a href="#l12.46"></a><span id="l12.46">   // Clean up</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-  pref.clearUserPref(pref_name);</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+  Services.prefs.clearUserPref(pref_name);</span>
<a href="#l12.49"></a><span id="l12.49">   wait_for_window_close();</span>
<a href="#l12.50"></a><span id="l12.50">   remove_account();</span>
<a href="#l12.51"></a><span id="l12.51"> </span>
<a href="#l12.52"></a><span id="l12.52">   // we expect to have accountAdded and smtpServerAdded events.</span>
<a href="#l12.53"></a><span id="l12.53">   if (! (events[&quot;accountAdded&quot;].data))</span>
<a href="#l12.54"></a><span id="l12.54">     throw new Error(&quot;failed to add an account&quot;);</span>
<a href="#l12.55"></a><span id="l12.55">   else if (! (events[&quot;smtpServerAdded&quot;].data))</span>
<a href="#l12.56"></a><span id="l12.56">     throw new Error(&quot;failed to add an smtp server&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/test/mozmill/migration-to-rdf-ui-2/test-migrate-to-rdf-ui-2.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/test/mozmill/migration-to-rdf-ui-2/test-migrate-to-rdf-ui-2.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -59,11 +59,11 @@ function test_width_persisted() {</span>
<a href="#l13.4"></a><span id="l13.4"> function test_throbber_removed() {</span>
<a href="#l13.5"></a><span id="l13.5">   let currentSet;</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7">   if (mc.mozmillModule.isMac)</span>
<a href="#l13.8"></a><span id="l13.8">     currentSet = mc.e(&quot;mail-bar3&quot;).getAttribute(&quot;currentset&quot;);</span>
<a href="#l13.9"></a><span id="l13.9">   else</span>
<a href="#l13.10"></a><span id="l13.10">     currentSet = mc.e(&quot;mail-toolbar-menubar2&quot;).getAttribute(&quot;currentset&quot;);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  assert_equals(-1, currentSet.indexOf(&quot;throbber-box&quot;),</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-                &quot;We found a throbber-box where we shouldn't have.&quot;);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+  assert_false(currentSet.contains(&quot;throbber-box&quot;),</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+               &quot;We found a throbber-box where we shouldn't have.&quot;);</span>
<a href="#l13.16"></a><span id="l13.16"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/test/mozmill/multiple-identities/test-display-names.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/test/mozmill/multiple-identities/test-display-names.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -6,16 +6,18 @@</span>
<a href="#l14.4"></a><span id="l14.4">  * Test that we can open and close a standalone message display window from the</span>
<a href="#l14.5"></a><span id="l14.5">  *  folder pane.</span>
<a href="#l14.6"></a><span id="l14.6">  */</span>
<a href="#l14.7"></a><span id="l14.7"> var MODULE_NAME = &quot;test-display-names&quot;;</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l14.10"></a><span id="l14.10"> var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;address-book-helpers&quot;];</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+</span>
<a href="#l14.14"></a><span id="l14.14"> var folder;</span>
<a href="#l14.15"></a><span id="l14.15"> var decoyFolder;</span>
<a href="#l14.16"></a><span id="l14.16"> var acctMgr;</span>
<a href="#l14.17"></a><span id="l14.17"> var localAccount;</span>
<a href="#l14.18"></a><span id="l14.18"> var secondIdentity;</span>
<a href="#l14.19"></a><span id="l14.19"> var myEmail = &quot;sender@nul.invalid&quot;; // Dictated by messagerInjector.js</span>
<a href="#l14.20"></a><span id="l14.20"> var friendEmail = &quot;carl@sagan.invalid&quot;;</span>
<a href="#l14.21"></a><span id="l14.21"> var friendName = &quot;Carl Sagan&quot;;</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -58,18 +60,17 @@ function setupModule(module) {</span>
<a href="#l14.23"></a><span id="l14.23">   add_message_to_folder(folder, create_message({from: [&quot;&quot;, friendEmail] }));</span>
<a href="#l14.24"></a><span id="l14.24">   add_message_to_folder(folder, create_message({from: [friendName, friendEmail] }));</span>
<a href="#l14.25"></a><span id="l14.25"> </span>
<a href="#l14.26"></a><span id="l14.26">   let abManager = Cc[&quot;@mozilla.org/abmanager;1&quot;].getService(Ci.nsIAbManager);</span>
<a href="#l14.27"></a><span id="l14.27">   // Ensure all the directories are initialised.</span>
<a href="#l14.28"></a><span id="l14.28">   abManager.directories;</span>
<a href="#l14.29"></a><span id="l14.29">   collectedAddresses = abManager.getDirectory(&quot;moz-abmdbdirectory://history.mab&quot;);</span>
<a href="#l14.30"></a><span id="l14.30"> </span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-  let bundle = Cc[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-                 .getService(Ci.nsIStringBundleService).createBundle(</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+  let bundle = Services.strings.createBundle(</span>
<a href="#l14.34"></a><span id="l14.34">                    &quot;chrome://messenger/locale/messenger.properties&quot;);</span>
<a href="#l14.35"></a><span id="l14.35">   headertoFieldMe = bundle.GetStringFromName(&quot;headertoFieldMe&quot;);</span>
<a href="#l14.36"></a><span id="l14.36"> }</span>
<a href="#l14.37"></a><span id="l14.37"> </span>
<a href="#l14.38"></a><span id="l14.38"> function ensure_single_identity() {</span>
<a href="#l14.39"></a><span id="l14.39">   if (localAccount.identities.length &gt; 1)</span>
<a href="#l14.40"></a><span id="l14.40">     localAccount.removeIdentity(secondIdentity);</span>
<a href="#l14.41"></a><span id="l14.41">   assert_true(acctMgr.allIdentities.length == 1,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/test/mozmill/notification/test-notification.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/test/mozmill/notification/test-notification.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -226,30 +226,30 @@ test_new_mail_received_causes_notificati</span>
<a href="#l15.4"></a><span id="l15.4">  */</span>
<a href="#l15.5"></a><span id="l15.5"> function test_show_oldest_new_unread_since_last_notification() {</span>
<a href="#l15.6"></a><span id="l15.6">   let notifyFirst = &quot;This should notify first&quot;;</span>
<a href="#l15.7"></a><span id="l15.7">   assert_false(gMockAlertsService._didNotify, &quot;Should not have notified yet.&quot;);</span>
<a href="#l15.8"></a><span id="l15.8">   make_gradually_newer_sets_in_folder(gFolder,</span>
<a href="#l15.9"></a><span id="l15.9">                                       [{count: 1,</span>
<a href="#l15.10"></a><span id="l15.10">                                         body: {body: notifyFirst}}])</span>
<a href="#l15.11"></a><span id="l15.11">   assert_true(gMockAlertsService._didNotify, &quot;Should have notified.&quot;);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  assert_true(gMockAlertsService._text.search(notifyFirst) &gt; 0,</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  assert_true(gMockAlertsService._text.contains(notifyFirst, 1),</span>
<a href="#l15.14"></a><span id="l15.14">               &quot;Should have notified for the first message&quot;);</span>
<a href="#l15.15"></a><span id="l15.15"> </span>
<a href="#l15.16"></a><span id="l15.16">   be_in_folder(gFolder);</span>
<a href="#l15.17"></a><span id="l15.17">   gFolder.biffState = Ci.nsIMsgFolder.nsMsgBiffState_NoMail;</span>
<a href="#l15.18"></a><span id="l15.18">   gMockAlertsService._reset();</span>
<a href="#l15.19"></a><span id="l15.19"> </span>
<a href="#l15.20"></a><span id="l15.20">   let notifySecond = &quot;This should notify second&quot;;</span>
<a href="#l15.21"></a><span id="l15.21">   assert_false(gMockAlertsService._didNotify, &quot;Should not have notified yet.&quot;);</span>
<a href="#l15.22"></a><span id="l15.22">   make_gradually_newer_sets_in_folder(gFolder,</span>
<a href="#l15.23"></a><span id="l15.23">                                       [{count: 1,</span>
<a href="#l15.24"></a><span id="l15.24">                                         body: {body: notifySecond}}]);</span>
<a href="#l15.25"></a><span id="l15.25">   assert_true(gMockAlertsService._didNotify, &quot;Should have notified.&quot;);</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-  assert_true(gMockAlertsService._text.search(notifySecond) &gt; 0,</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+  assert_true(gMockAlertsService._text.contains(notifySecond, 1),</span>
<a href="#l15.28"></a><span id="l15.28">               &quot;Should have notified for the second message&quot;);</span>
<a href="#l15.29"></a><span id="l15.29"> }</span>
<a href="#l15.30"></a><span id="l15.30"> test_show_oldest_new_unread_since_last_notification.EXCLUDED_PLATFORMS = ['winnt', 'darwin'];</span>
<a href="#l15.31"></a><span id="l15.31"> </span>
<a href="#l15.32"></a><span id="l15.32"> /**</span>
<a href="#l15.33"></a><span id="l15.33">  * Test that notifications work across different accounts.</span>
<a href="#l15.34"></a><span id="l15.34">  */</span>
<a href="#l15.35"></a><span id="l15.35"> function test_notification_works_across_accounts() {</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineat">@@ -297,33 +297,33 @@ test_notifications_independent_across_ac</span>
<a href="#l15.37"></a><span id="l15.37">  */</span>
<a href="#l15.38"></a><span id="l15.38"> function test_show_subject() {</span>
<a href="#l15.39"></a><span id="l15.39">   let subject = &quot;This should be displayed&quot;;</span>
<a href="#l15.40"></a><span id="l15.40">   make_gradually_newer_sets_in_folder(gFolder,</span>
<a href="#l15.41"></a><span id="l15.41">                                       [{count: 1,</span>
<a href="#l15.42"></a><span id="l15.42">                                         subject: subject</span>
<a href="#l15.43"></a><span id="l15.43">                                        }]);</span>
<a href="#l15.44"></a><span id="l15.44">   assert_true(gMockAlertsService._didNotify, &quot;Should have notified&quot;);</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-  assert_true(gMockAlertsService._text.search(subject) != -1,</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+  assert_true(gMockAlertsService._text.contains(subject),</span>
<a href="#l15.47"></a><span id="l15.47">               &quot;Should have displayed the subject&quot;);</span>
<a href="#l15.48"></a><span id="l15.48"> }</span>
<a href="#l15.49"></a><span id="l15.49"> test_show_subject.EXCLUDED_PLATFORMS = ['winnt', 'darwin'];</span>
<a href="#l15.50"></a><span id="l15.50"> </span>
<a href="#l15.51"></a><span id="l15.51"> /**</span>
<a href="#l15.52"></a><span id="l15.52">  * Test that we can hide the message subject in the notification.</span>
<a href="#l15.53"></a><span id="l15.53">  */</span>
<a href="#l15.54"></a><span id="l15.54"> function test_hide_subject() {</span>
<a href="#l15.55"></a><span id="l15.55">   Services.prefs.setBoolPref(&quot;mail.biff.alert.show_subject&quot;, false);</span>
<a href="#l15.56"></a><span id="l15.56">   let subject = &quot;This should not be displayed&quot;;</span>
<a href="#l15.57"></a><span id="l15.57">   make_gradually_newer_sets_in_folder(gFolder,</span>
<a href="#l15.58"></a><span id="l15.58">                                       [{count: 1,</span>
<a href="#l15.59"></a><span id="l15.59">                                         subject: subject</span>
<a href="#l15.60"></a><span id="l15.60">                                        }]);</span>
<a href="#l15.61"></a><span id="l15.61">   assert_true(gMockAlertsService._didNotify, &quot;Should have notified&quot;);</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineminus">-  assert_equals(gMockAlertsService._text.search(subject), -1,</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineplus">+  assert_true(!gMockAlertsService._text.contains(subject),</span>
<a href="#l15.64"></a><span id="l15.64">                 &quot;Should not have displayed the subject&quot;);</span>
<a href="#l15.65"></a><span id="l15.65"> }</span>
<a href="#l15.66"></a><span id="l15.66"> test_hide_subject.EXCLUDED_PLATFORMS = ['winnt', 'darwin'];</span>
<a href="#l15.67"></a><span id="l15.67"> </span>
<a href="#l15.68"></a><span id="l15.68"> /**</span>
<a href="#l15.69"></a><span id="l15.69">  * Test that we can show just the message sender in the notification.</span>
<a href="#l15.70"></a><span id="l15.70">  */</span>
<a href="#l15.71"></a><span id="l15.71"> function test_show_only_subject() {</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineat">@@ -336,52 +336,52 @@ function test_show_only_subject() {</span>
<a href="#l15.73"></a><span id="l15.73">   let messageBody = &quot;My message preview&quot;;</span>
<a href="#l15.74"></a><span id="l15.74"> </span>
<a href="#l15.75"></a><span id="l15.75">   make_gradually_newer_sets_in_folder(gFolder,</span>
<a href="#l15.76"></a><span id="l15.76">                                       [{count: 1,</span>
<a href="#l15.77"></a><span id="l15.77">                                         from: sender,</span>
<a href="#l15.78"></a><span id="l15.78">                                         subject: subject,</span>
<a href="#l15.79"></a><span id="l15.79">                                         body: {body: messageBody}}]);</span>
<a href="#l15.80"></a><span id="l15.80">   assert_true(gMockAlertsService._didNotify, &quot;Should have notified&quot;);</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineminus">-  assert_true(gMockAlertsService._text.search(subject) != -1,</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineplus">+  assert_true(gMockAlertsService._text.contains(subject),</span>
<a href="#l15.83"></a><span id="l15.83">               &quot;Should have displayed the subject&quot;);</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineminus">-  assert_equals(gMockAlertsService._text.search(messageBody), -1,</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineplus">+  assert_true(!gMockAlertsService._text.contains(messageBody),</span>
<a href="#l15.86"></a><span id="l15.86">                 &quot;Should not have displayed the preview&quot;);</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-  assert_equals(gMockAlertsService._text.search(sender[0]), -1,</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineplus">+  assert_true(!gMockAlertsService._text.contains(sender[0]),</span>
<a href="#l15.89"></a><span id="l15.89">                 &quot;Should not have displayed the sender&quot;);</span>
<a href="#l15.90"></a><span id="l15.90"> </span>
<a href="#l15.91"></a><span id="l15.91"> }</span>
<a href="#l15.92"></a><span id="l15.92"> test_show_only_subject.EXCLUDED_PLATFORMS = ['winnt', 'darwin'];</span>
<a href="#l15.93"></a><span id="l15.93"> </span>
<a href="#l15.94"></a><span id="l15.94"> </span>
<a href="#l15.95"></a><span id="l15.95"> /**</span>
<a href="#l15.96"></a><span id="l15.96">  * Test that we can show the message sender in the notification.</span>
<a href="#l15.97"></a><span id="l15.97">  */</span>
<a href="#l15.98"></a><span id="l15.98"> function test_show_sender() {</span>
<a href="#l15.99"></a><span id="l15.99">   let sender = [&quot;John Cleese&quot;, &quot;john@cleese.invalid&quot;];</span>
<a href="#l15.100"></a><span id="l15.100">   make_gradually_newer_sets_in_folder(gFolder,</span>
<a href="#l15.101"></a><span id="l15.101">                                       [{count: 1,</span>
<a href="#l15.102"></a><span id="l15.102">                                         from: sender}]);</span>
<a href="#l15.103"></a><span id="l15.103">   assert_true(gMockAlertsService._didNotify, &quot;Should have notified&quot;);</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-  assert_true(gMockAlertsService._text.search(sender[0]) != -1,</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineplus">+  assert_true(gMockAlertsService._text.contains(sender[0]),</span>
<a href="#l15.106"></a><span id="l15.106">               &quot;Should have displayed the sender&quot;);</span>
<a href="#l15.107"></a><span id="l15.107"> }</span>
<a href="#l15.108"></a><span id="l15.108"> test_show_sender.EXCLUDED_PLATFORMS = ['winnt', 'darwin'];</span>
<a href="#l15.109"></a><span id="l15.109"> </span>
<a href="#l15.110"></a><span id="l15.110"> /**</span>
<a href="#l15.111"></a><span id="l15.111">  * Test that we can hide the message sender in the notification.</span>
<a href="#l15.112"></a><span id="l15.112">  */</span>
<a href="#l15.113"></a><span id="l15.113"> function test_hide_sender() {</span>
<a href="#l15.114"></a><span id="l15.114">   Services.prefs.setBoolPref(&quot;mail.biff.alert.show_sender&quot;, false);</span>
<a href="#l15.115"></a><span id="l15.115">   let sender = [&quot;John Cleese&quot;, &quot;john@cleese.invalid&quot;];</span>
<a href="#l15.116"></a><span id="l15.116">   make_gradually_newer_sets_in_folder(gFolder,</span>
<a href="#l15.117"></a><span id="l15.117">                                       [{count: 1,</span>
<a href="#l15.118"></a><span id="l15.118">                                         from: sender}]);</span>
<a href="#l15.119"></a><span id="l15.119">   assert_true(gMockAlertsService._didNotify, &quot;Should have notified&quot;);</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineminus">-  assert_equals(gMockAlertsService._text.search(sender[0]), -1,</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineplus">+  assert_true(!gMockAlertsService._text.contains(sender[0]),</span>
<a href="#l15.122"></a><span id="l15.122">                 &quot;Should not have displayed the sender&quot;);</span>
<a href="#l15.123"></a><span id="l15.123"> }</span>
<a href="#l15.124"></a><span id="l15.124"> test_hide_sender.EXCLUDED_PLATFORMS = ['winnt', 'darwin'];</span>
<a href="#l15.125"></a><span id="l15.125"> </span>
<a href="#l15.126"></a><span id="l15.126"> /**</span>
<a href="#l15.127"></a><span id="l15.127">  * Test that we can show just the message sender in the notification.</span>
<a href="#l15.128"></a><span id="l15.128">  */</span>
<a href="#l15.129"></a><span id="l15.129"> function test_show_only_sender() {</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineat">@@ -394,52 +394,52 @@ function test_show_only_sender() {</span>
<a href="#l15.131"></a><span id="l15.131">   let messageBody = &quot;My message preview&quot;;</span>
<a href="#l15.132"></a><span id="l15.132"> </span>
<a href="#l15.133"></a><span id="l15.133">   make_gradually_newer_sets_in_folder(gFolder,</span>
<a href="#l15.134"></a><span id="l15.134">                                       [{count: 1,</span>
<a href="#l15.135"></a><span id="l15.135">                                         from: sender,</span>
<a href="#l15.136"></a><span id="l15.136">                                         subject: subject,</span>
<a href="#l15.137"></a><span id="l15.137">                                         body: {body: messageBody}}]);</span>
<a href="#l15.138"></a><span id="l15.138">   assert_true(gMockAlertsService._didNotify, &quot;Should have notified&quot;);</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineminus">-  assert_true(gMockAlertsService._text.search(sender[0]) != -1,</span>
<a href="#l15.140"></a><span id="l15.140" class="difflineplus">+  assert_true(gMockAlertsService._text.contains(sender[0]),</span>
<a href="#l15.141"></a><span id="l15.141">               &quot;Should have displayed the sender&quot;);</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineminus">-  assert_equals(gMockAlertsService._text.search(messageBody), -1,</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineplus">+  assert_true(!gMockAlertsService._text.contains(messageBody),</span>
<a href="#l15.144"></a><span id="l15.144">                 &quot;Should not have displayed the preview&quot;);</span>
<a href="#l15.145"></a><span id="l15.145" class="difflineminus">-  assert_equals(gMockAlertsService._text.search(subject), -1,</span>
<a href="#l15.146"></a><span id="l15.146" class="difflineplus">+  assert_true(!gMockAlertsService._text.contains(subject),</span>
<a href="#l15.147"></a><span id="l15.147">                 &quot;Should not have displayed the subject&quot;);</span>
<a href="#l15.148"></a><span id="l15.148"> </span>
<a href="#l15.149"></a><span id="l15.149"> }</span>
<a href="#l15.150"></a><span id="l15.150"> test_show_only_sender.EXCLUDED_PLATFORMS = ['winnt', 'darwin'];</span>
<a href="#l15.151"></a><span id="l15.151"> </span>
<a href="#l15.152"></a><span id="l15.152"> /**</span>
<a href="#l15.153"></a><span id="l15.153">  * Test that we can show the message preview in the notification.</span>
<a href="#l15.154"></a><span id="l15.154">  */</span>
<a href="#l15.155"></a><span id="l15.155"> function test_show_preview() {</span>
<a href="#l15.156"></a><span id="l15.156">   Services.prefs.setBoolPref(&quot;mail.biff.alert.show_preview&quot;, true);</span>
<a href="#l15.157"></a><span id="l15.157">   let messageBody = &quot;My message preview&quot;;</span>
<a href="#l15.158"></a><span id="l15.158">   make_gradually_newer_sets_in_folder(gFolder,</span>
<a href="#l15.159"></a><span id="l15.159">                                       [{count: 1,</span>
<a href="#l15.160"></a><span id="l15.160">                                         body: {body: messageBody}}]);</span>
<a href="#l15.161"></a><span id="l15.161">   assert_true(gMockAlertsService._didNotify, &quot;Should have notified&quot;);</span>
<a href="#l15.162"></a><span id="l15.162" class="difflineminus">-  assert_true(gMockAlertsService._text.search(messageBody) != -1,</span>
<a href="#l15.163"></a><span id="l15.163" class="difflineplus">+  assert_true(gMockAlertsService._text.contains(messageBody),</span>
<a href="#l15.164"></a><span id="l15.164">               &quot;Should have displayed the preview&quot;);</span>
<a href="#l15.165"></a><span id="l15.165"> }</span>
<a href="#l15.166"></a><span id="l15.166"> test_show_preview.EXCLUDED_PLATFORMS = ['winnt', 'darwin'];</span>
<a href="#l15.167"></a><span id="l15.167"> </span>
<a href="#l15.168"></a><span id="l15.168"> /**</span>
<a href="#l15.169"></a><span id="l15.169">  * Test that we can hide the message preview in the notification.</span>
<a href="#l15.170"></a><span id="l15.170">  */</span>
<a href="#l15.171"></a><span id="l15.171"> function test_hide_preview() {</span>
<a href="#l15.172"></a><span id="l15.172">   Services.prefs.setBoolPref(&quot;mail.biff.alert.show_preview&quot;, false);</span>
<a href="#l15.173"></a><span id="l15.173">   let messageBody = &quot;My message preview&quot;;</span>
<a href="#l15.174"></a><span id="l15.174">   make_gradually_newer_sets_in_folder(gFolder,</span>
<a href="#l15.175"></a><span id="l15.175">                                       [{count: 1,</span>
<a href="#l15.176"></a><span id="l15.176">                                         body: {body: messageBody}}]);</span>
<a href="#l15.177"></a><span id="l15.177">   assert_true(gMockAlertsService._didNotify, &quot;Should have notified&quot;);</span>
<a href="#l15.178"></a><span id="l15.178" class="difflineminus">-  assert_equals(gMockAlertsService._text.search(messageBody), -1,</span>
<a href="#l15.179"></a><span id="l15.179" class="difflineplus">+  assert_true(!gMockAlertsService._text.contains(messageBody),</span>
<a href="#l15.180"></a><span id="l15.180">                 &quot;Should not have displayed the preview&quot;);</span>
<a href="#l15.181"></a><span id="l15.181"> }</span>
<a href="#l15.182"></a><span id="l15.182"> test_hide_preview.EXCLUDED_PLATFORMS = ['winnt', 'darwin'];</span>
<a href="#l15.183"></a><span id="l15.183"> </span>
<a href="#l15.184"></a><span id="l15.184"> /**</span>
<a href="#l15.185"></a><span id="l15.185">  * Test that we can show justthe message preview in the notification.</span>
<a href="#l15.186"></a><span id="l15.186">  */</span>
<a href="#l15.187"></a><span id="l15.187"> function test_show_only_preview() {</span>
<a href="#l15.188"></a><span id="l15.188" class="difflineat">@@ -451,21 +451,21 @@ function test_show_only_preview() {</span>
<a href="#l15.189"></a><span id="l15.189">   let subject = &quot;This should not be displayed&quot;;</span>
<a href="#l15.190"></a><span id="l15.190">   let messageBody = &quot;My message preview&quot;;</span>
<a href="#l15.191"></a><span id="l15.191">   make_gradually_newer_sets_in_folder(gFolder,</span>
<a href="#l15.192"></a><span id="l15.192">                                       [{count: 1,</span>
<a href="#l15.193"></a><span id="l15.193">                                         from: sender,</span>
<a href="#l15.194"></a><span id="l15.194">                                         subject: subject,</span>
<a href="#l15.195"></a><span id="l15.195">                                         body: {body: messageBody}}]);</span>
<a href="#l15.196"></a><span id="l15.196">   assert_true(gMockAlertsService._didNotify, &quot;Should have notified&quot;);</span>
<a href="#l15.197"></a><span id="l15.197" class="difflineminus">-  assert_true(gMockAlertsService._text.search(messageBody) != -1,</span>
<a href="#l15.198"></a><span id="l15.198" class="difflineplus">+  assert_true(gMockAlertsService._text.contains(messageBody),</span>
<a href="#l15.199"></a><span id="l15.199">               &quot;Should have displayed the preview: &quot; + gMockAlertsService._text);</span>
<a href="#l15.200"></a><span id="l15.200" class="difflineminus">-  assert_equals(gMockAlertsService._text.search(sender[0]), -1,</span>
<a href="#l15.201"></a><span id="l15.201" class="difflineplus">+  assert_true(!gMockAlertsService._text.contains(sender[0]),</span>
<a href="#l15.202"></a><span id="l15.202">                 &quot;Should not have displayed the sender&quot;);</span>
<a href="#l15.203"></a><span id="l15.203" class="difflineminus">-  assert_equals(gMockAlertsService._text.search(subject), -1,</span>
<a href="#l15.204"></a><span id="l15.204" class="difflineplus">+  assert_true(!gMockAlertsService._text.contains(subject),</span>
<a href="#l15.205"></a><span id="l15.205">                 &quot;Should not have displayed the subject&quot;);</span>
<a href="#l15.206"></a><span id="l15.206"> }</span>
<a href="#l15.207"></a><span id="l15.207"> test_show_only_preview.EXCLUDED_PLATFORMS = ['winnt', 'darwin'];</span>
<a href="#l15.208"></a><span id="l15.208"> </span>
<a href="#l15.209"></a><span id="l15.209"> /**</span>
<a href="#l15.210"></a><span id="l15.210">  * Test that we can receive notifications even when the biff state of</span>
<a href="#l15.211"></a><span id="l15.211">  * the folder has not been changed.</span>
<a href="#l15.212"></a><span id="l15.212">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/content/dateFormat.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/content/dateFormat.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -46,17 +46,17 @@ function initLocaleShortDateFormat()</span>
<a href="#l16.4"></a><span id="l16.4">     // check the format option</span>
<a href="#l16.5"></a><span id="l16.5">     if ( arrayOfStrings.length != 3 )       // no successfull split</span>
<a href="#l16.6"></a><span id="l16.6">     {</span>
<a href="#l16.7"></a><span id="l16.7">       dump(&quot;getLocaleShortDateFormat: could not analyze the date format, defaulting to mm/dd/yyyy\n&quot;);</span>
<a href="#l16.8"></a><span id="l16.8">     }</span>
<a href="#l16.9"></a><span id="l16.9">     else</span>
<a href="#l16.10"></a><span id="l16.10">     {</span>
<a href="#l16.11"></a><span id="l16.11">       // the date will contain a zero if that system settings include leading zeros</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-      gSearchDateLeadingZeros = /0/.test(dateString);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+      gSearchDateLeadingZeros = dateString.contains(&quot;0&quot;);</span>
<a href="#l16.14"></a><span id="l16.14"> </span>
<a href="#l16.15"></a><span id="l16.15">       // match 1 as number, since that will match both &quot;1&quot; and &quot;01&quot;</span>
<a href="#l16.16"></a><span id="l16.16">       if ( arrayOfStrings[0] == 1 )</span>
<a href="#l16.17"></a><span id="l16.17">       {</span>
<a href="#l16.18"></a><span id="l16.18">         // 01.12.1999 or 01.1999.12</span>
<a href="#l16.19"></a><span id="l16.19">         gSearchDateFormat = arrayOfStrings[1] == &quot;12&quot; ? 5 : 6;</span>
<a href="#l16.20"></a><span id="l16.20">       }</span>
<a href="#l16.21"></a><span id="l16.21">       else if ( arrayOfStrings[1] == 1 )</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/content/msgPrintEngine.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/content/msgPrintEngine.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -113,22 +113,22 @@ const gStartupPPObserver =</span>
<a href="#l17.4"></a><span id="l17.4"> function ReplaceWithSelection()</span>
<a href="#l17.5"></a><span id="l17.5"> {</span>
<a href="#l17.6"></a><span id="l17.6">   var selection = printOpener.content.getSelection();</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8">   if ( selection != &quot;&quot; ) {</span>
<a href="#l17.9"></a><span id="l17.9">     var range = selection.getRangeAt( 0 );</span>
<a href="#l17.10"></a><span id="l17.10">     var contents = range.cloneContents();</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    var bodies = window.content.document.getElementsByTagName( &quot;body&quot; );</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    var aBody = window.content.document.querySelector( &quot;body&quot; );</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15">     /* Replace the content of &lt;body&gt; with the users' selection. */</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-    if ( bodies.length &gt; 0 ) {</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-      bodies[0].innerHTML = &quot;&quot;;</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-      bodies[0].appendChild( contents );</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+    if ( aBody ) {</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+      aBody.innerHTML = &quot;&quot;;</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+      aBody.appendChild( contents );</span>
<a href="#l17.22"></a><span id="l17.22">     }</span>
<a href="#l17.23"></a><span id="l17.23">   }</span>
<a href="#l17.24"></a><span id="l17.24"> }</span>
<a href="#l17.25"></a><span id="l17.25"> </span>
<a href="#l17.26"></a><span id="l17.26"> function InitPrintEngineWindow()</span>
<a href="#l17.27"></a><span id="l17.27"> {</span>
<a href="#l17.28"></a><span id="l17.28">   /* Store the current opener for later access in ReplaceWithSelection() */</span>
<a href="#l17.29"></a><span id="l17.29">   printOpener = opener;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsMailDirProvider.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsMailDirProvider.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -1,23 +1,22 @@</span>
<a href="#l18.4"></a><span id="l18.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l18.5"></a><span id="l18.5"> /*</span>
<a href="#l18.6"></a><span id="l18.6">  * Test suite for nsMailDirProvider to check we get the right directories and</span>
<a href="#l18.7"></a><span id="l18.7">  * files.</span>
<a href="#l18.8"></a><span id="l18.8">  */</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+</span>
<a href="#l18.12"></a><span id="l18.12"> function run_test() {</span>
<a href="#l18.13"></a><span id="l18.13">   const items = [ { key: &quot;MailD&quot;, value: &quot;Mail&quot; },</span>
<a href="#l18.14"></a><span id="l18.14">                   { key: &quot;IMapMD&quot;, value: &quot;ImapMail&quot; },</span>
<a href="#l18.15"></a><span id="l18.15">                   { key: &quot;NewsD&quot;, value: &quot;News&quot; },</span>
<a href="#l18.16"></a><span id="l18.16">                   { key: &quot;MFCaF&quot;, value: &quot;panacea.dat&quot; } ];</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-  var dirSvc = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">-    .getService(Ci.nsIProperties);</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineminus">-</span>
<a href="#l18.21"></a><span id="l18.21">   items.forEach(function(item) {</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineminus">-    var dir = dirSvc.get(item.key, Ci.nsIFile);</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+    var dir = Services.dirsvc.get(item.key, Ci.nsIFile);</span>
<a href="#l18.24"></a><span id="l18.24">     dump(gProfileDir.path + &quot; &quot; + dir.path + &quot;\n&quot;);</span>
<a href="#l18.25"></a><span id="l18.25">     do_check_true(gProfileDir.equals(dir.parent));</span>
<a href="#l18.26"></a><span id="l18.26"> </span>
<a href="#l18.27"></a><span id="l18.27">     do_check_eq(dir.leafName, item.value);</span>
<a href="#l18.28"></a><span id="l18.28">   });</span>
<a href="#l18.29"></a><span id="l18.29"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsMsgDBView.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsMsgDBView.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -201,20 +201,20 @@ function assert_view_message_at_indices(</span>
<a href="#l19.4"></a><span id="l19.4">       curHdr = gTestFolder.msgDatabase.getMsgHdrForMessageID(thing.messageId);</span>
<a href="#l19.5"></a><span id="l19.5">   }</span>
<a href="#l19.6"></a><span id="l19.6"> }</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8"> var authorFirstLetterCustomColumn = {</span>
<a href="#l19.9"></a><span id="l19.9">   getCellText: function(row, col) {</span>
<a href="#l19.10"></a><span id="l19.10">     let folder = this.dbView.getFolderForViewIndex(row);</span>
<a href="#l19.11"></a><span id="l19.11">     let msgHdr = this.dbView.getMsgHdrAt(row);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    return msgHdr.mime2DecodedAuthor.substr(0, 1).toUpperCase() || &quot;?&quot;;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    return msgHdr.mime2DecodedAuthor.charAt(0).toUpperCase() || &quot;?&quot;;</span>
<a href="#l19.14"></a><span id="l19.14">   },</span>
<a href="#l19.15"></a><span id="l19.15">   getSortStringForRow: function(msgHdr) {</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-    return msgHdr.mime2DecodedAuthor.substr(0, 1).toUpperCase() || &quot;?&quot;;</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+    return msgHdr.mime2DecodedAuthor.charAt(0).toUpperCase() || &quot;?&quot;;</span>
<a href="#l19.18"></a><span id="l19.18">   },</span>
<a href="#l19.19"></a><span id="l19.19">   isString: function() {</span>
<a href="#l19.20"></a><span id="l19.20">     return true;</span>
<a href="#l19.21"></a><span id="l19.21">   },</span>
<a href="#l19.22"></a><span id="l19.22"> </span>
<a href="#l19.23"></a><span id="l19.23">   getCellProperties:   function(row, col) { return &quot;&quot;; },</span>
<a href="#l19.24"></a><span id="l19.24">   getRowProperties:    function(row) { return &quot;&quot;; },</span>
<a href="#l19.25"></a><span id="l19.25">   getImageSrc:         function(row, col) {return null;},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/test/unit/test_quarantineFilterMove.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_quarantineFilterMove.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -51,19 +51,19 @@ const gTestArray =</span>
<a href="#l20.4"></a><span id="l20.4">     // operation was a move</span>
<a href="#l20.5"></a><span id="l20.5">     do_check_eq(folderCount(gLocalInboxFolder), 0);</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7">     let enumerator = gMoveFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l20.8"></a><span id="l20.8">     let firstMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l20.9"></a><span id="l20.9">     let secondMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l20.10"></a><span id="l20.10">     // Check that the messages have content</span>
<a href="#l20.11"></a><span id="l20.11">     messageContent = getContentFromMessage(firstMsgHdr);</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    do_check_true(messageContent.indexOf(&quot;Some User &lt;bugmail@example.org&gt; changed&quot;) != -1);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+    do_check_true(messageContent.contains(&quot;Some User &lt;bugmail@example.org&gt; changed&quot;));</span>
<a href="#l20.14"></a><span id="l20.14">     messageContent = getContentFromMessage(secondMsgHdr);</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-    do_check_true(messageContent.indexOf(&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=436880&quot;) != -1);</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+    do_check_true(messageContent.contains(&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=436880&quot;));</span>
<a href="#l20.17"></a><span id="l20.17"> </span>
<a href="#l20.18"></a><span id="l20.18">     ++gCurTestNum;</span>
<a href="#l20.19"></a><span id="l20.19">     doTest();</span>
<a href="#l20.20"></a><span id="l20.20">   },</span>
<a href="#l20.21"></a><span id="l20.21">   function copyMovedMessages() {</span>
<a href="#l20.22"></a><span id="l20.22">     let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l20.23"></a><span id="l20.23">     let enumerator = gMoveFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l20.24"></a><span id="l20.24">     let firstMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineat">@@ -77,19 +77,19 @@ const gTestArray =</span>
<a href="#l20.26"></a><span id="l20.26">   function verifyFolders2() {</span>
<a href="#l20.27"></a><span id="l20.27">     do_check_eq(folderCount(gMoveFolder2), 2);</span>
<a href="#l20.28"></a><span id="l20.28"> </span>
<a href="#l20.29"></a><span id="l20.29">     let enumerator = gMoveFolder2.msgDatabase.EnumerateMessages();</span>
<a href="#l20.30"></a><span id="l20.30">     let firstMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l20.31"></a><span id="l20.31">     let secondMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l20.32"></a><span id="l20.32">     // Check that the messages have content</span>
<a href="#l20.33"></a><span id="l20.33">     messageContent = getContentFromMessage(firstMsgHdr);</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">-    do_check_true(messageContent.indexOf(&quot;Some User &lt;bugmail@example.org&gt; changed&quot;) != -1);</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineplus">+    do_check_true(messageContent.contains(&quot;Some User &lt;bugmail@example.org&gt; changed&quot;));</span>
<a href="#l20.36"></a><span id="l20.36">     messageContent = getContentFromMessage(secondMsgHdr);</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-    do_check_true(messageContent.indexOf(&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=436880&quot;) != -1);</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+    do_check_true(messageContent.contains(&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=436880&quot;));</span>
<a href="#l20.39"></a><span id="l20.39"> </span>
<a href="#l20.40"></a><span id="l20.40">     ++gCurTestNum;</span>
<a href="#l20.41"></a><span id="l20.41">     doTest();</span>
<a href="#l20.42"></a><span id="l20.42">   },</span>
<a href="#l20.43"></a><span id="l20.43"> ];</span>
<a href="#l20.44"></a><span id="l20.44"> </span>
<a href="#l20.45"></a><span id="l20.45"> function folderCount(folder)</span>
<a href="#l20.46"></a><span id="l20.46"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchBody.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchBody.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -61,17 +61,17 @@ function fixFile(file) {</span>
<a href="#l21.4"></a><span id="l21.4">   var fstream = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l21.5"></a><span id="l21.5">                   .createInstance(Ci.nsIFileInputStream);</span>
<a href="#l21.6"></a><span id="l21.6">   fstream.init(file, -1, -1, Ci.nsIFileInputStream.CLOSE_ON_EOF);</span>
<a href="#l21.7"></a><span id="l21.7">   var sstream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l21.8"></a><span id="l21.8">                   .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l21.9"></a><span id="l21.9">   sstream.init(fstream);</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11">   var str = sstream.read(4096);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  if (str.substring(0, 5) == &quot;From &quot;) {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  if (str.startsWith(&quot;From &quot;)) {</span>
<a href="#l21.14"></a><span id="l21.14">     sstream.close();</span>
<a href="#l21.15"></a><span id="l21.15">     fstream.close();</span>
<a href="#l21.16"></a><span id="l21.16">     return file;</span>
<a href="#l21.17"></a><span id="l21.17">   }</span>
<a href="#l21.18"></a><span id="l21.18">   var data = &quot;From - Tue Oct 02 00:26:47 2007\r\n&quot;;</span>
<a href="#l21.19"></a><span id="l21.19">   do {</span>
<a href="#l21.20"></a><span id="l21.20">     data += str;</span>
<a href="#l21.21"></a><span id="l21.21">     str = sstream.read(4096);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchLocalizationStrings.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchLocalizationStrings.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1,20 +1,21 @@</span>
<a href="#l22.4"></a><span id="l22.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.5"></a><span id="l22.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.6"></a><span id="l22.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.7"></a><span id="l22.7">  </span>
<a href="#l22.8"></a><span id="l22.8">  // tests that localization strings added in bug 484147 are defined in preferences</span>
<a href="#l22.9"></a><span id="l22.9">  </span>
<a href="#l22.10"></a><span id="l22.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineplus">+</span>
<a href="#l22.12"></a><span id="l22.12"> const gValidityManager = Cc['@mozilla.org/mail/search/validityManager;1']</span>
<a href="#l22.13"></a><span id="l22.13">                            .getService(Ci.nsIMsgSearchValidityManager);</span>
<a href="#l22.14"></a><span id="l22.14"> </span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-const gStringBundle = Cc[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-                        .getService(Ci.nsIStringBundleService)</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-                        .createBundle(&quot;chrome://messenger/locale/search-attributes.properties&quot;);</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+const gStringBundle = Services.strings</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+                              .createBundle(&quot;chrome://messenger/locale/search-attributes.properties&quot;);</span>
<a href="#l22.20"></a><span id="l22.20"> </span>
<a href="#l22.21"></a><span id="l22.21"> // The following table of valid table scopes matches the allowable table</span>
<a href="#l22.22"></a><span id="l22.22"> // scopes in nsMsgSearchValidityManager::GetTable</span>
<a href="#l22.23"></a><span id="l22.23"> const kValidScopes =</span>
<a href="#l22.24"></a><span id="l22.24"> [</span>
<a href="#l22.25"></a><span id="l22.25">   Ci.nsMsgSearchScope.offlineMail,</span>
<a href="#l22.26"></a><span id="l22.26">   Ci.nsMsgSearchScope.offlineMailFilter,</span>
<a href="#l22.27"></a><span id="l22.27">   Ci.nsMsgSearchScope.onlineMail,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/util/hostnameUtils.jsm</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/util/hostnameUtils.jsm</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -283,18 +283,18 @@ function isLegalLocalIPAddress(aIPAddres</span>
<a href="#l23.4"></a><span id="l23.4">         ipComponents[6] == &quot;0000&quot; &amp;&amp; ipComponents[7] == &quot;0001&quot;)</span>
<a href="#l23.5"></a><span id="l23.5">       return true;</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7">     // fe80::/10 - link local addresses</span>
<a href="#l23.8"></a><span id="l23.8">     if (ipComponents[0] == &quot;fe80&quot;)</span>
<a href="#l23.9"></a><span id="l23.9">       return true;</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11">     // fc00::/7 - unique local addresses</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    if (ipComponents[0].substr(0,2) == &quot;fc&quot; || // usage has not been defined yet</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-        ipComponents[0].substr(0,2) == &quot;fd&quot;)</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+    if (ipComponents[0].startsWith(&quot;fc&quot;) || // usage has not been defined yet</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+        ipComponents[0].startsWith(&quot;fd&quot;))</span>
<a href="#l23.16"></a><span id="l23.16">       return true;</span>
<a href="#l23.17"></a><span id="l23.17"> </span>
<a href="#l23.18"></a><span id="l23.18">     return false;</span>
<a href="#l23.19"></a><span id="l23.19">   }</span>
<a href="#l23.20"></a><span id="l23.20">   return false;</span>
<a href="#l23.21"></a><span id="l23.21"> }</span>
<a href="#l23.22"></a><span id="l23.22"> </span>
<a href="#l23.23"></a><span id="l23.23"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/extensions/smime/content/certFetchingStatus.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/certFetchingStatus.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -142,17 +142,17 @@ function kickOffSearch()</span>
<a href="#l24.4"></a><span id="l24.4"> {</span>
<a href="#l24.5"></a><span id="l24.5">   try {</span>
<a href="#l24.6"></a><span id="l24.6">     var prefix1 = &quot;&quot;;</span>
<a href="#l24.7"></a><span id="l24.7">     var suffix1 = &quot;&quot;;</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9">     var urlFilter = gLdapServerURL.filter;</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11">     if (urlFilter != null &amp;&amp; urlFilter.length &gt; 0 &amp;&amp; urlFilter != &quot;(objectclass=*)&quot;) {</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-      if (urlFilter[0] == '(') {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+      if (urlFilter.startsWith('(')) {</span>
<a href="#l24.14"></a><span id="l24.14">         prefix1 = &quot;(&amp;&quot; + urlFilter;</span>
<a href="#l24.15"></a><span id="l24.15">       }</span>
<a href="#l24.16"></a><span id="l24.16">       else {</span>
<a href="#l24.17"></a><span id="l24.17">         prefix1 = &quot;(&amp;(&quot; + urlFilter + &quot;)&quot;;</span>
<a href="#l24.18"></a><span id="l24.18">       }</span>
<a href="#l24.19"></a><span id="l24.19">       suffix1 = &quot;)&quot;;</span>
<a href="#l24.20"></a><span id="l24.20">     }</span>
<a href="#l24.21"></a><span id="l24.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_text_attachment.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_text_attachment.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -37,17 +37,17 @@ let gStreamListener = {</span>
<a href="#l25.4"></a><span id="l25.4">   QueryInterface: XPCOMUtils.generateQI([Ci.nsIStreamListener]),</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6">   _str:&quot;&quot;,</span>
<a href="#l25.7"></a><span id="l25.7">   // nsIRequestObserver part</span>
<a href="#l25.8"></a><span id="l25.8">   onStartRequest: function (aRequest, aContext) {</span>
<a href="#l25.9"></a><span id="l25.9">   },</span>
<a href="#l25.10"></a><span id="l25.10">   onStopRequest: function (aRequest, aContext, aStatusCode) {</span>
<a href="#l25.11"></a><span id="l25.11">     // check that text attachment contents didn't end up inline.</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    do_check_eq(this._str.indexOf(textAttachment), -1);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+    do_check_true(!this._str.contains(textAttachment));</span>
<a href="#l25.14"></a><span id="l25.14">     async_driver();</span>
<a href="#l25.15"></a><span id="l25.15">   },</span>
<a href="#l25.16"></a><span id="l25.16"> </span>
<a href="#l25.17"></a><span id="l25.17">   /* okay, our onDataAvailable should actually never be called.  the stream</span>
<a href="#l25.18"></a><span id="l25.18">      converter is actually eating everything except the start and stop</span>
<a href="#l25.19"></a><span id="l25.19">      notification. */</span>
<a href="#l25.20"></a><span id="l25.20">   // nsIStreamListener part</span>
<a href="#l25.21"></a><span id="l25.21">   _stream : null,</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

