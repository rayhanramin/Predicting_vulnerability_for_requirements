<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27580:a3a6442dde2fa53d263a561a8dc4845718f14318</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a3a6442dde2fa53d263a561a8dc4845718f14318" />
<meta property="og:url" content="/comm-central/rev/a3a6442dde2fa53d263a561a8dc4845718f14318" />
<meta property="og:description" content="Bug 1557506 - Remove [array] use in xpidl from chat/. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a3a6442dde2fa53d263a561a8dc4845718f14318 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a3a6442dde2fa53d263a561a8dc4845718f14318">shortlog</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a3a6442dde2fa53d263a561a8dc4845718f14318">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318">files</a> |
changeset |
<a href="/comm-central/raw-rev/a3a6442dde2fa53d263a561a8dc4845718f14318">raw</a>  | <a href="/comm-central/archive/a3a6442dde2fa53d263a561a8dc4845718f14318.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557506">Bug 1557506</a> - Remove [array] use in xpidl from chat/. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#97;&#116;&#114;&#105;&#99;&#107;&#32;&#67;&#108;&#111;&#107;&#101;&#32;&#60;&#99;&#108;&#111;&#107;&#101;&#112;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 13 Sep 2019 11:26:06 -0400</td></tr>

<tr>
 <td>changeset 27580</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a3a6442dde2fa53d263a561a8dc4845718f14318">a3a6442dde2fa53d263a561a8dc4845718f14318</a></td>
</tr>



<tr>
<td>parent 27579</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d9515eb29b309efaf5e8061b9b9f31231cd91b7e">d9515eb29b309efaf5e8061b9b9f31231cd91b7e</a>
</td>
</tr>

<tr>
<td>child 27581</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f8986e7f6f2e8be77dbd46e853b96097004892a4">f8986e7f6f2e8be77dbd46e853b96097004892a4</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a3a6442dde2fa53d263a561a8dc4845718f14318">16401</a></td></tr>
<tr><td>push user</td><td>clokep@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 13 Sep 2019 19:36:42 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@a3a6442dde2f [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a3a6442dde2fa53d263a561a8dc4845718f14318">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a3a6442dde2fa53d263a561a8dc4845718f14318&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a3a6442dde2fa53d263a561a8dc4845718f14318&newProject=comm-central&newRevision=a3a6442dde2fa53d263a561a8dc4845718f14318&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a3a6442dde2fa53d263a561a8dc4845718f14318&newProject=comm-central&newRevision=a3a6442dde2fa53d263a561a8dc4845718f14318&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a3a6442dde2fa53d263a561a8dc4845718f14318&newProject=comm-central&newRevision=a3a6442dde2fa53d263a561a8dc4845718f14318&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557506">1557506</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557506">Bug 1557506</a> - Remove [array] use in xpidl from chat/. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIAccount.idl">chat/components/public/imIAccount.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIAccount.idl">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIAccount.idl">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIAccount.idl">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIAccount.idl">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIAccount.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imICommandsService.idl">chat/components/public/imICommandsService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imICommandsService.idl">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imICommandsService.idl">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imICommandsService.idl">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imICommandsService.idl">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imICommandsService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIContactsService.idl">chat/components/public/imIContactsService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIContactsService.idl">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIContactsService.idl">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIContactsService.idl">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIContactsService.idl">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIContactsService.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIConversationsService.idl">chat/components/public/imIConversationsService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIConversationsService.idl">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIConversationsService.idl">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIConversationsService.idl">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIConversationsService.idl">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imIConversationsService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imILogger.idl">chat/components/public/imILogger.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imILogger.idl">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imILogger.idl">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imILogger.idl">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imILogger.idl">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imILogger.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imITagsService.idl">chat/components/public/imITagsService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imITagsService.idl">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imITagsService.idl">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imITagsService.idl">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imITagsService.idl">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/imITagsService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIConversation.idl">chat/components/public/prplIConversation.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIConversation.idl">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIConversation.idl">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIConversation.idl">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIConversation.idl">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIConversation.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIMessage.idl">chat/components/public/prplIMessage.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIMessage.idl">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIMessage.idl">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIMessage.idl">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIMessage.idl">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/public/prplIMessage.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imAccounts.js">chat/components/src/imAccounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imAccounts.js">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imAccounts.js">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imAccounts.js">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imAccounts.js">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imAccounts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imCommands.js">chat/components/src/imCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imCommands.js">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imCommands.js">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imCommands.js">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imCommands.js">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imContacts.js">chat/components/src/imContacts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imContacts.js">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imContacts.js">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imContacts.js">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imContacts.js">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imContacts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imConversations.js">chat/components/src/imConversations.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imConversations.js">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imConversations.js">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imConversations.js">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imConversations.js">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/imConversations.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/logger.js">chat/components/src/logger.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/logger.js">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/logger.js">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/logger.js">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/logger.js">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/logger.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/test/test_commands.js">chat/components/src/test/test_commands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/test/test_commands.js">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/test/test_commands.js">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/test/test_commands.js">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/test/test_commands.js">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/components/src/test/test_commands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/modules/jsProtoHelper.jsm">chat/modules/jsProtoHelper.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/modules/jsProtoHelper.jsm">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/modules/jsProtoHelper.jsm">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/modules/jsProtoHelper.jsm">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/modules/jsProtoHelper.jsm">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/modules/jsProtoHelper.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/irc.js">chat/protocols/irc/irc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/irc.js">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/irc.js">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/irc.js">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/irc.js">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/irc.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/ircBase.jsm">chat/protocols/irc/ircBase.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/ircBase.jsm">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/ircBase.jsm">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/ircBase.jsm">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/ircBase.jsm">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/ircBase.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/test/test_splitLongMessages.js">chat/protocols/irc/test/test_splitLongMessages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/test/test_splitLongMessages.js">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/test/test_splitLongMessages.js">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/test/test_splitLongMessages.js">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/test/test_splitLongMessages.js">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/irc/test/test_splitLongMessages.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/twitter/twitter.js">chat/protocols/twitter/twitter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/twitter/twitter.js">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/twitter/twitter.js">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/twitter/twitter.js">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/twitter/twitter.js">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/twitter/twitter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/xmpp/xmpp.jsm">chat/protocols/xmpp/xmpp.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/xmpp/xmpp.jsm">file</a> |
<a href="/comm-central/annotate/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/xmpp/xmpp.jsm">annotate</a> |
<a href="/comm-central/diff/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/xmpp/xmpp.jsm">diff</a> |
<a href="/comm-central/comparison/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/xmpp/xmpp.jsm">comparison</a> |
<a href="/comm-central/log/a3a6442dde2fa53d263a561a8dc4845718f14318/chat/protocols/xmpp/xmpp.jsm">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/chat/components/public/imIAccount.idl</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/chat/components/public/imIAccount.idl</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -59,19 +59,17 @@ interface prplIRoomInfo: nsISupports {</span>
<a href="#l1.4"></a><span id="l1.4">  */</span>
<a href="#l1.5"></a><span id="l1.5"> [scriptable, function, uuid(43102a36-883a-421d-a6ac-126aafee5a28)]</span>
<a href="#l1.6"></a><span id="l1.6"> interface prplIRoomInfoCallback: nsISupports {</span>
<a href="#l1.7"></a><span id="l1.7">   /* aRooms is an array of chatroom names. This will be called</span>
<a href="#l1.8"></a><span id="l1.8">    * multiple times as batches of chat rooms are received. The number of rooms</span>
<a href="#l1.9"></a><span id="l1.9">    * in each batch is left for the prplIAccount implementation to decide.</span>
<a href="#l1.10"></a><span id="l1.10">    * aCompleted will be true when aRooms is the last batch.</span>
<a href="#l1.11"></a><span id="l1.11">    */</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  void onRoomInfoAvailable([array, size_is(aCount)] in wstring aRooms,</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-                           in boolean aCompleted,</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-                           in unsigned long aCount);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+  void onRoomInfoAvailable(in Array&lt;AString&gt; aRooms, in boolean aCompleted);</span>
<a href="#l1.16"></a><span id="l1.16"> };</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> /*</span>
<a href="#l1.20"></a><span id="l1.20">  * This interface should be implemented by the protocol plugin.</span>
<a href="#l1.21"></a><span id="l1.21">  */</span>
<a href="#l1.22"></a><span id="l1.22"> [scriptable, uuid(3ce02a3c-f38b-4a1e-9050-a19bea1cb6c1)]</span>
<a href="#l1.23"></a><span id="l1.23"> interface prplIAccount: nsISupports {</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineat">@@ -308,18 +306,17 @@ interface imIAccount: prplIAccount {</span>
<a href="#l1.25"></a><span id="l1.25">   readonly attribute boolean disconnected;</span>
<a href="#l1.26"></a><span id="l1.26">   readonly attribute boolean connected;</span>
<a href="#l1.27"></a><span id="l1.27">   readonly attribute boolean connecting;</span>
<a href="#l1.28"></a><span id="l1.28">   readonly attribute boolean disconnecting;</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30">   void logDebugMessage(in nsIScriptError aMessage, in short aLevel);</span>
<a href="#l1.31"></a><span id="l1.31"> </span>
<a href="#l1.32"></a><span id="l1.32">   /* Get an array of the 50 most recent debug messages. */</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-  void getDebugMessages([optional] out unsigned long aCount,</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-                        [retval, array, size_is(aCount)] out imIDebugMessage aMessages);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+  Array&lt;imIDebugMessage&gt; getDebugMessages();</span>
<a href="#l1.36"></a><span id="l1.36"> </span>
<a href="#l1.37"></a><span id="l1.37">   /* The imIUserStatusInfo instance this account should observe for</span>
<a href="#l1.38"></a><span id="l1.38">      status changes. When this is null (the default value), the</span>
<a href="#l1.39"></a><span id="l1.39">      account will observe the global status. */</span>
<a href="#l1.40"></a><span id="l1.40">   attribute imIUserStatusInfo observedStatusInfo;</span>
<a href="#l1.41"></a><span id="l1.41">   // Same as above, but never null (it fallbacks to the global status info).</span>
<a href="#l1.42"></a><span id="l1.42">   attribute imIUserStatusInfo statusInfo;</span>
<a href="#l1.43"></a><span id="l1.43"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/chat/components/public/imICommandsService.idl</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/chat/components/public/imICommandsService.idl</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -53,24 +53,20 @@ interface imICommandsService: nsISupport</span>
<a href="#l2.4"></a><span id="l2.4">   // with the latter.</span>
<a href="#l2.5"></a><span id="l2.5">   void registerCommand(in imICommand aCommand,</span>
<a href="#l2.6"></a><span id="l2.6">                        [optional] in AUTF8String aPrplId);</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8">   // aPrplId should be the same as what was used for the command registration.</span>
<a href="#l2.9"></a><span id="l2.9">   void unregisterCommand(in AUTF8String aCommandName,</span>
<a href="#l2.10"></a><span id="l2.10">                          [optional] in AUTF8String aPrplId);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  void listCommandsForConversation(</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-    [optional] in prplIConversation aConversation,</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-    [optional] out unsigned long commandCount,</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-    [retval, array, size_is(commandCount)] out imICommand commands);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+  Array&lt;imICommand&gt; listCommandsForConversation(</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+    [optional] in prplIConversation aConversation);</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-  void listCommandsForProtocol(in AUTF8String aPrplId,</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-    [optional] out unsigned long commandCount,</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-    [retval, array, size_is(commandCount)] out imICommand commands);</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+  Array&lt;imICommand&gt; listCommandsForProtocol(in AUTF8String aPrplId);</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24">   // Will return true if a command handled the message (it should not be sent).</span>
<a href="#l2.25"></a><span id="l2.25">   // The aConversation parameters is required to execute protocol specific</span>
<a href="#l2.26"></a><span id="l2.26">   // commands. Application global commands will work without it.</span>
<a href="#l2.27"></a><span id="l2.27">   // If a conversation is returned as a result of executing the command,</span>
<a href="#l2.28"></a><span id="l2.28">   // the caller should consider focusing it.</span>
<a href="#l2.29"></a><span id="l2.29">   boolean executeCommand(in AUTF8String aMessage,</span>
<a href="#l2.30"></a><span id="l2.30">                          [optional] in prplIConversation aConversation,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/chat/components/public/imIContactsService.idl</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/chat/components/public/imIContactsService.idl</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -16,18 +16,17 @@ interface prplIProtocol;</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> [scriptable, uuid(45ce33d9-d335-4cce-b904-44821987e048)]</span>
<a href="#l3.6"></a><span id="l3.6"> interface imIContactsService: nsISupports {</span>
<a href="#l3.7"></a><span id="l3.7">   void initContacts();</span>
<a href="#l3.8"></a><span id="l3.8">   void unInitContacts();</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">   imIContact getContactById(in long aId);</span>
<a href="#l3.11"></a><span id="l3.11">   // Get an array of all existing contacts.</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  void getContacts([optional] out unsigned long contactCount,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                   [retval, array, size_is(contactCount)] out imIContact contacts);</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  Array&lt;imIContact&gt; getContacts();</span>
<a href="#l3.15"></a><span id="l3.15">   imIBuddy getBuddyById(in long aId);</span>
<a href="#l3.16"></a><span id="l3.16">   imIBuddy getBuddyByNameAndProtocol(in AUTF8String aNormalizedName,</span>
<a href="#l3.17"></a><span id="l3.17">                                      in prplIProtocol aPrpl);</span>
<a href="#l3.18"></a><span id="l3.18">   prplIAccountBuddy getAccountBuddyByNameAndAccount(in AUTF8String aNormalizedName,</span>
<a href="#l3.19"></a><span id="l3.19">                                                     in imIAccount aAccount);</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">   // These 3 functions are called by the protocol plugins when</span>
<a href="#l3.22"></a><span id="l3.22">   // synchronizing the buddy list with the server stored list,</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineat">@@ -71,27 +70,25 @@ interface imIContactsService: nsISupport</span>
<a href="#l3.24"></a><span id="l3.24"> [scriptable, uuid(f585b0df-f6ad-40d5-9de4-c58b14af13e4)]</span>
<a href="#l3.25"></a><span id="l3.25"> interface imIContact: imIStatusInfo {</span>
<a href="#l3.26"></a><span id="l3.26">   // The id will be positive if the contact is real (stored in the</span>
<a href="#l3.27"></a><span id="l3.27">   // SQLite database) and negative if the instance is a dummy contact</span>
<a href="#l3.28"></a><span id="l3.28">   // holding only a single buddy without aliases or additional tags.</span>
<a href="#l3.29"></a><span id="l3.29">   readonly attribute long id;</span>
<a href="#l3.30"></a><span id="l3.30">   attribute AUTF8String alias;</span>
<a href="#l3.31"></a><span id="l3.31"> </span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-  void getTags([optional] out unsigned long tagCount,</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-               [retval, array, size_is(tagCount)] out imITag tags);</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+  Array&lt;imITag&gt; getTags();</span>
<a href="#l3.35"></a><span id="l3.35"> </span>
<a href="#l3.36"></a><span id="l3.36">   // Will do nothing if the contact already has aTag.</span>
<a href="#l3.37"></a><span id="l3.37">   void addTag(in imITag aTag);</span>
<a href="#l3.38"></a><span id="l3.38">   // Will throw if the contact doesn't have aTag or doesn't have any other tag.</span>
<a href="#l3.39"></a><span id="l3.39">   void removeTag(in imITag aTag);</span>
<a href="#l3.40"></a><span id="l3.40"> </span>
<a href="#l3.41"></a><span id="l3.41">   readonly attribute imIBuddy preferredBuddy;</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-  void getBuddies([optional] out unsigned long buddyCount,</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-                  [retval, array, size_is(buddyCount)] out imIBuddy buddies);</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+  Array&lt;imIBuddy&gt; getBuddies();</span>
<a href="#l3.45"></a><span id="l3.45"> </span>
<a href="#l3.46"></a><span id="l3.46">   // Move all the buddies of aContact into the current contact,</span>
<a href="#l3.47"></a><span id="l3.47">   // and copy all its tags.</span>
<a href="#l3.48"></a><span id="l3.48">   void mergeContact(in imIContact aContact);</span>
<a href="#l3.49"></a><span id="l3.49"> </span>
<a href="#l3.50"></a><span id="l3.50">   // Change the position of aBuddy in the current contact.</span>
<a href="#l3.51"></a><span id="l3.51">   // The new position is the current position of aBeforeBuddy if it is</span>
<a href="#l3.52"></a><span id="l3.52">   // specified, or at the end otherwise.</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineat">@@ -176,18 +173,17 @@ interface imIBuddy: imIStatusInfo {</span>
<a href="#l3.54"></a><span id="l3.54">   // A name that can be used to check for duplicates and is the basis</span>
<a href="#l3.55"></a><span id="l3.55">   // for the directory name for log storage.</span>
<a href="#l3.56"></a><span id="l3.56">   readonly attribute AUTF8String normalizedName;</span>
<a href="#l3.57"></a><span id="l3.57">   // The optional server alias is in displayName (inherited from imIStatusInfo)</span>
<a href="#l3.58"></a><span id="l3.58">   // displayName = serverAlias || userName.</span>
<a href="#l3.59"></a><span id="l3.59"> </span>
<a href="#l3.60"></a><span id="l3.60">   readonly attribute imIContact contact;</span>
<a href="#l3.61"></a><span id="l3.61">   readonly attribute prplIAccountBuddy preferredAccountBuddy;</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-  void getAccountBuddies([optional] out unsigned long accountBuddyCount,</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-                         [retval, array, size_is(accountBuddyCount)] out prplIAccountBuddy accountBuddies);</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+  Array&lt;prplIAccountBuddy&gt; getAccountBuddies();</span>
<a href="#l3.65"></a><span id="l3.65"> </span>
<a href="#l3.66"></a><span id="l3.66">   // remove the buddy from the buddy list. If the contact becomes empty, it will be removed too.</span>
<a href="#l3.67"></a><span id="l3.67">   void remove();</span>
<a href="#l3.68"></a><span id="l3.68"> </span>
<a href="#l3.69"></a><span id="l3.69">   void addObserver(in nsIObserver aObserver);</span>
<a href="#l3.70"></a><span id="l3.70">   void removeObserver(in nsIObserver aObserver);</span>
<a href="#l3.71"></a><span id="l3.71">   /* Observers will be notified of changes related to the buddy.</span>
<a href="#l3.72"></a><span id="l3.72">    *  aSubject will point to the imIBuddy object.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/chat/components/public/imIConversationsService.idl</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/chat/components/public/imIConversationsService.idl</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -38,32 +38,30 @@ interface imIConversation: prplIConversa</span>
<a href="#l4.4"></a><span id="l4.4">   // Call this to give the core an opportunity to close an inactive</span>
<a href="#l4.5"></a><span id="l4.5">   // conversation.  If the conversation is a left MUC or an IM</span>
<a href="#l4.6"></a><span id="l4.6">   // conversation without unread message, the implementation will call</span>
<a href="#l4.7"></a><span id="l4.7">   // close().</span>
<a href="#l4.8"></a><span id="l4.8">   // The returned value indicates if the conversation was closed.</span>
<a href="#l4.9"></a><span id="l4.9">   boolean checkClose();</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11">   // Get an array of all messages of the conversation.</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  void getMessages([optional] out unsigned long messageCount,</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-                   [retval, array, size_is(messageCount)] out imIMessage messages);</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+  Array&lt;imIMessage&gt; getMessages();</span>
<a href="#l4.15"></a><span id="l4.15"> };</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17"> [scriptable, uuid(984e182c-d395-4fba-ba6e-cc80c71f57bf)]</span>
<a href="#l4.18"></a><span id="l4.18"> interface imIConversationsService: nsISupports {</span>
<a href="#l4.19"></a><span id="l4.19">   void initConversations();</span>
<a href="#l4.20"></a><span id="l4.20">   void unInitConversations();</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22">   // Register a conversation. This will create a unique id for the</span>
<a href="#l4.23"></a><span id="l4.23">   // conversation and set it.</span>
<a href="#l4.24"></a><span id="l4.24">   void addConversation(in prplIConversation aConversation);</span>
<a href="#l4.25"></a><span id="l4.25">   void removeConversation(in prplIConversation aConversation);</span>
<a href="#l4.26"></a><span id="l4.26"> </span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-  void getUIConversations([optional] out unsigned long conversationCount,</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-                          [retval, array, size_is(conversationCount)] out imIConversation conversations);</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+  Array&lt;imIConversation&gt; getUIConversations();</span>
<a href="#l4.30"></a><span id="l4.30">   imIConversation getUIConversation(in prplIConversation aConversation);</span>
<a href="#l4.31"></a><span id="l4.31">   imIConversation getUIConversationByContactId(in long aId);</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33">   nsISimpleEnumerator getConversations();</span>
<a href="#l4.34"></a><span id="l4.34">   prplIConversation getConversationById(in unsigned long aId);</span>
<a href="#l4.35"></a><span id="l4.35">   prplIConversation getConversationByNameAndAccount(in AUTF8String aName,</span>
<a href="#l4.36"></a><span id="l4.36">                                                     in imIAccount aAccount,</span>
<a href="#l4.37"></a><span id="l4.37">                                                     in boolean aIsChat);</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineat">@@ -89,20 +87,20 @@ interface imIOutgoingMessage: nsISupport</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40"> // A cancellable message to be displayed. When the conversation service is</span>
<a href="#l4.41"></a><span id="l4.41"> // notified of a `new-text` (ie. an incoming or outgoing message to be</span>
<a href="#l4.42"></a><span id="l4.42"> // displayed), it in turn notifies observers of `received-message`</span>
<a href="#l4.43"></a><span id="l4.43"> // (again, typically add-ons), which have the opportunity to swap or cancel</span>
<a href="#l4.44"></a><span id="l4.44"> // the message.</span>
<a href="#l4.45"></a><span id="l4.45"> [scriptable, uuid(3f88cc5c-6940-4eb5-a576-c65770f49ce9)]</span>
<a href="#l4.46"></a><span id="l4.46"> interface imIMessage: prplIMessage {</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-           attribute boolean cancelled;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-           // Holds the sender color for Chats.</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-           // Empty string by default, it is set by the conversation binding.</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-           attribute AUTF8String color;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+  attribute boolean cancelled;</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+  // Holds the sender color for Chats.</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+  // Empty string by default, it is set by the conversation binding.</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+  attribute AUTF8String color;</span>
<a href="#l4.55"></a><span id="l4.55"> </span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-           // What eventually gets shown to the user.</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-           attribute AUTF8String displayMessage;</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+  // What eventually gets shown to the user.</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+  attribute AUTF8String displayMessage;</span>
<a href="#l4.60"></a><span id="l4.60"> </span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-           // The related incoming or outgoing message is transmitted</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-           // with encryption.</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-           attribute boolean encrypted;</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+  // The related incoming or outgoing message is transmitted</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+  // with encryption.</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+  attribute boolean encrypted;</span>
<a href="#l4.67"></a><span id="l4.67"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/chat/components/public/imILogger.idl</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/chat/components/public/imILogger.idl</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -26,18 +26,17 @@ interface imILogConversation: nsISupport</span>
<a href="#l5.4"></a><span id="l5.4">   //  - statusInfo will return Services.core.globalUserStatus</span>
<a href="#l5.5"></a><span id="l5.5">   //  - protocol will only contain a &quot;name&quot; attribute, with the prpl's normalized name.</span>
<a href="#l5.6"></a><span id="l5.6">   // Other methods/attributes aren't implemented.</span>
<a href="#l5.7"></a><span id="l5.7">   readonly attribute imIAccount account;</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">   readonly attribute boolean isChat; // always false (compatibility with prplIConversation).</span>
<a href="#l5.10"></a><span id="l5.10">   readonly attribute prplIAccountBuddy buddy; // always null (compatibility with prplIConvIM).</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  void getMessages([optional] out unsigned long messageCount,</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-                   [retval, array, size_is(messageCount)] out imIMessage messages);</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+  Array&lt;imIMessage&gt; getMessages();</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16">   // Callers that process the messages asynchronously should use the enumerator</span>
<a href="#l5.17"></a><span id="l5.17">   // instead of the array version of the getMessages* methods to avoid paying</span>
<a href="#l5.18"></a><span id="l5.18">   // up front the cost of xpconnect wrapping all message objects.</span>
<a href="#l5.19"></a><span id="l5.19">   nsISimpleEnumerator getMessagesEnumerator([optional] out unsigned long messageCount);</span>
<a href="#l5.20"></a><span id="l5.20"> };</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22"> [scriptable, uuid(27712ece-ad2c-4504-87d5-9e2c16d40fef)]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/chat/components/public/imITagsService.idl</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/chat/components/public/imITagsService.idl</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -11,18 +11,17 @@ interface imIContact;</span>
<a href="#l6.4"></a><span id="l6.4"> interface imITag: nsISupports {</span>
<a href="#l6.5"></a><span id="l6.5">   readonly attribute long id;</span>
<a href="#l6.6"></a><span id="l6.6">            attribute AUTF8String name;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">   // Get an array of all the contacts associated with this tag.</span>
<a href="#l6.9"></a><span id="l6.9">   //  Contacts can either &quot;have the tag&quot; (added by user action) or</span>
<a href="#l6.10"></a><span id="l6.10">   //  have inherited the tag because it was the server side group for</span>
<a href="#l6.11"></a><span id="l6.11">   //  one of the AccountBuddy of the contact.</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  void getContacts([optional] out unsigned long contactCount,</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                   [retval, array, size_is(contactCount)] out imIContact contacts);</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  Array&lt;imIContact&gt; getContacts();</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16">   void addObserver(in nsIObserver aObserver);</span>
<a href="#l6.17"></a><span id="l6.17">   void removeObserver(in nsIObserver aObserver);</span>
<a href="#l6.18"></a><span id="l6.18">   /* Observers will be notified of changes related to the contacts</span>
<a href="#l6.19"></a><span id="l6.19">    * that have the tag: contact-*, buddy-*, account-buddy-*</span>
<a href="#l6.20"></a><span id="l6.20">    * notifications forwarded respectively from the imIContact,</span>
<a href="#l6.21"></a><span id="l6.21">    * imIBuddy and prplIAccountBuddy instances.</span>
<a href="#l6.22"></a><span id="l6.22">    */</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineat">@@ -42,17 +41,16 @@ interface imITagsService: nsISupports {</span>
<a href="#l6.24"></a><span id="l6.24">   // Create a new tags or return the existing one if it already exists</span>
<a href="#l6.25"></a><span id="l6.25">   imITag createTag(in AUTF8String aName);</span>
<a href="#l6.26"></a><span id="l6.26">   // Get an existing tag by (numeric) id. Returns null if not found.</span>
<a href="#l6.27"></a><span id="l6.27">   imITag getTagById(in long aId);</span>
<a href="#l6.28"></a><span id="l6.28">   // Get an existing tag by name (will do an SQL query). Returns null</span>
<a href="#l6.29"></a><span id="l6.29">   // if not found.</span>
<a href="#l6.30"></a><span id="l6.30">   imITag getTagByName(in AUTF8String aName);</span>
<a href="#l6.31"></a><span id="l6.31">   // Get an array of all existing tags.</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-  void getTags([optional] out unsigned long tagCount,</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-               [retval, array, size_is(tagCount)] out imITag tags);</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+  Array&lt;imITag&gt; getTags();</span>
<a href="#l6.35"></a><span id="l6.35"> </span>
<a href="#l6.36"></a><span id="l6.36">   boolean isTagHidden(in imITag aTag);</span>
<a href="#l6.37"></a><span id="l6.37">   void hideTag(in imITag aTag);</span>
<a href="#l6.38"></a><span id="l6.38">   void showTag(in imITag aTag);</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40">   readonly attribute imITag otherContactsTag;</span>
<a href="#l6.41"></a><span id="l6.41"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/chat/components/public/prplIConversation.idl</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/chat/components/public/prplIConversation.idl</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -43,19 +43,17 @@ interface prplIConversation: nsISupports</span>
<a href="#l7.4"></a><span id="l7.4">   /* Setable only once by purpleCoreService while calling addConversation. */</span>
<a href="#l7.5"></a><span id="l7.5">            attribute unsigned long id;</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">   /* Send a message in the conversation */</span>
<a href="#l7.8"></a><span id="l7.8">   void sendMsg(in AUTF8String aMsg);</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">   /* Preprocess messages before they are sent (eg. split long messages).</span>
<a href="#l7.11"></a><span id="l7.11">      Can return null if no changes are to be made. */</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  void prepareForSending(in imIOutgoingMessage aMsg,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-                         [optional] out unsigned long aMsgCount,</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-                         [retval, array, size_is(aMsgCount)] out wstring aMsgs);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+  Array&lt;AString&gt; prepareForSending(in imIOutgoingMessage aMsg);</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17">   /* Postprocess messages before they are displayed (eg. escaping). The</span>
<a href="#l7.18"></a><span id="l7.18">      implementation can set aMsg.displayMessage, otherwise the originalMessage</span>
<a href="#l7.19"></a><span id="l7.19">      is used. */</span>
<a href="#l7.20"></a><span id="l7.20">   void prepareForDisplaying(in imIMessage aMsg);</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22">   /* Send information about the current typing state to the server.</span>
<a href="#l7.23"></a><span id="l7.23">      aString should contain the content currently in the text field. The</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/chat/components/public/prplIMessage.idl</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/chat/components/public/prplIMessage.idl</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -65,11 +65,10 @@ interface prplIMessage: nsISupports {</span>
<a href="#l8.4"></a><span id="l8.4">   readonly attribute boolean notification;</span>
<a href="#l8.5"></a><span id="l8.5">   /*  PURPLE_MESSAGE_NO_LINKIFY  = 0x4000  /**&lt; Message should not be auto-linkified */</span>
<a href="#l8.6"></a><span id="l8.6">   readonly attribute boolean noLinkification;</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">   /* An array of actions the user may perform on this message.</span>
<a href="#l8.9"></a><span id="l8.9">      The first action will be the 'default' and may be performed</span>
<a href="#l8.10"></a><span id="l8.10">      automatically when the message is double clicked.</span>
<a href="#l8.11"></a><span id="l8.11">      'Reply' is usually a good default action. */</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  void getActions([optional] out unsigned long actionCount,</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-                  [retval, array, size_is(actionCount)] out prplIMessageAction actions);</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+  Array&lt;prplIMessageAction&gt; getActions();</span>
<a href="#l8.15"></a><span id="l8.15"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/chat/components/src/imAccounts.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/chat/components/src/imAccounts.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -391,17 +391,17 @@ imAccount.prototype = {</span>
<a href="#l9.4"></a><span id="l9.4">       &quot;&quot;,</span>
<a href="#l9.5"></a><span id="l9.5">       0,</span>
<a href="#l9.6"></a><span id="l9.6">       null,</span>
<a href="#l9.7"></a><span id="l9.7">       Ci.nsIScriptError.warningFlag,</span>
<a href="#l9.8"></a><span id="l9.8">       &quot;component javascript&quot;</span>
<a href="#l9.9"></a><span id="l9.9">     );</span>
<a href="#l9.10"></a><span id="l9.10">     return { logLevel: 0, message: scriptError };</span>
<a href="#l9.11"></a><span id="l9.11">   },</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  getDebugMessages(aCount) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  getDebugMessages() {</span>
<a href="#l9.14"></a><span id="l9.14">     let messages = [];</span>
<a href="#l9.15"></a><span id="l9.15">     if (this._omittedDebugMessagesBeforeError) {</span>
<a href="#l9.16"></a><span id="l9.16">       let text = this._omittedDebugMessagesBeforeError + &quot; messages omitted&quot;;</span>
<a href="#l9.17"></a><span id="l9.17">       messages.push(this._createDebugMessage(text));</span>
<a href="#l9.18"></a><span id="l9.18">     }</span>
<a href="#l9.19"></a><span id="l9.19">     if (this._debugMessagesBeforeError) {</span>
<a href="#l9.20"></a><span id="l9.20">       messages = messages.concat(this._debugMessagesBeforeError);</span>
<a href="#l9.21"></a><span id="l9.21">     }</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -416,19 +416,16 @@ imAccount.prototype = {</span>
<a href="#l9.23"></a><span id="l9.23">       let appInfo = Services.appinfo;</span>
<a href="#l9.24"></a><span id="l9.24">       let header =</span>
<a href="#l9.25"></a><span id="l9.25">         `${appInfo.name} ${appInfo.version} (${appInfo.appBuildID}), ` +</span>
<a href="#l9.26"></a><span id="l9.26">         `Gecko ${appInfo.platformVersion} (${appInfo.platformBuildID}) ` +</span>
<a href="#l9.27"></a><span id="l9.27">         `on ${HttpProtocolHandler.oscpu}`;</span>
<a href="#l9.28"></a><span id="l9.28">       messages.unshift(this._createDebugMessage(header));</span>
<a href="#l9.29"></a><span id="l9.29">     }</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-    if (aCount) {</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-      aCount.value = messages.length;</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-    }</span>
<a href="#l9.34"></a><span id="l9.34">     return messages;</span>
<a href="#l9.35"></a><span id="l9.35">   },</span>
<a href="#l9.36"></a><span id="l9.36"> </span>
<a href="#l9.37"></a><span id="l9.37">   _observedStatusInfo: null,</span>
<a href="#l9.38"></a><span id="l9.38">   get observedStatusInfo() {</span>
<a href="#l9.39"></a><span id="l9.39">     return this._observedStatusInfo;</span>
<a href="#l9.40"></a><span id="l9.40">   },</span>
<a href="#l9.41"></a><span id="l9.41">   _statusObserver: null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/chat/components/src/imCommands.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/chat/components/src/imCommands.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -71,17 +71,17 @@ CommandsService.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">         let conv = Services.conversations.getUIConversation(aConv);</span>
<a href="#l10.5"></a><span id="l10.5">         if (!conv) {</span>
<a href="#l10.6"></a><span id="l10.6">           return false;</span>
<a href="#l10.7"></a><span id="l10.7">         }</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9">         // Handle when no command is given, list all possible commands that are</span>
<a href="#l10.10"></a><span id="l10.10">         // available for this conversation (alphabetically).</span>
<a href="#l10.11"></a><span id="l10.11">         if (!aMsg) {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-          let commands = this.cmdSrv.listCommandsForConversation(aConv, {});</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+          let commands = this.cmdSrv.listCommandsForConversation(aConv);</span>
<a href="#l10.14"></a><span id="l10.14">           if (!commands.length) {</span>
<a href="#l10.15"></a><span id="l10.15">             return false;</span>
<a href="#l10.16"></a><span id="l10.16">           }</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18">           // Concatenate the command names (separated by a comma and space).</span>
<a href="#l10.19"></a><span id="l10.19">           let cmds = commands</span>
<a href="#l10.20"></a><span id="l10.20">             .map(aCmd =&gt; aCmd.name)</span>
<a href="#l10.21"></a><span id="l10.21">             .sort()</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -163,48 +163,46 @@ CommandsService.prototype = {</span>
<a href="#l10.23"></a><span id="l10.23">       if (commands.hasOwnProperty(prplId)) {</span>
<a href="#l10.24"></a><span id="l10.24">         delete commands[prplId];</span>
<a href="#l10.25"></a><span id="l10.25">       }</span>
<a href="#l10.26"></a><span id="l10.26">       if (!Object.keys(commands).length) {</span>
<a href="#l10.27"></a><span id="l10.27">         delete this._commands[aCommandName];</span>
<a href="#l10.28"></a><span id="l10.28">       }</span>
<a href="#l10.29"></a><span id="l10.29">     }</span>
<a href="#l10.30"></a><span id="l10.30">   },</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-  listCommandsForConversation(aConversation, commandCount) {</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+  listCommandsForConversation(aConversation) {</span>
<a href="#l10.33"></a><span id="l10.33">     let result = [];</span>
<a href="#l10.34"></a><span id="l10.34">     let prplId = aConversation &amp;&amp; aConversation.account.protocol.id;</span>
<a href="#l10.35"></a><span id="l10.35">     for (let name in this._commands) {</span>
<a href="#l10.36"></a><span id="l10.36">       let commands = this._commands[name];</span>
<a href="#l10.37"></a><span id="l10.37">       if (commands.hasOwnProperty(&quot;&quot;)) {</span>
<a href="#l10.38"></a><span id="l10.38">         result.push(commands[&quot;&quot;]);</span>
<a href="#l10.39"></a><span id="l10.39">       }</span>
<a href="#l10.40"></a><span id="l10.40">       if (prplId &amp;&amp; commands.hasOwnProperty(prplId)) {</span>
<a href="#l10.41"></a><span id="l10.41">         result.push(commands[prplId]);</span>
<a href="#l10.42"></a><span id="l10.42">       }</span>
<a href="#l10.43"></a><span id="l10.43">     }</span>
<a href="#l10.44"></a><span id="l10.44">     if (aConversation) {</span>
<a href="#l10.45"></a><span id="l10.45">       result = result.filter(this._usageContextFilter(aConversation));</span>
<a href="#l10.46"></a><span id="l10.46">     }</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-    commandCount.value = result.length;</span>
<a href="#l10.48"></a><span id="l10.48">     return result;</span>
<a href="#l10.49"></a><span id="l10.49">   },</span>
<a href="#l10.50"></a><span id="l10.50">   // List only the commands for a protocol (excluding the global commands).</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-  listCommandsForProtocol(aPrplId, commandCount) {</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+  listCommandsForProtocol(aPrplId) {</span>
<a href="#l10.53"></a><span id="l10.53">     if (!aPrplId) {</span>
<a href="#l10.54"></a><span id="l10.54">       throw new Error(&quot;You must provide a prpl ID.&quot;);</span>
<a href="#l10.55"></a><span id="l10.55">     }</span>
<a href="#l10.56"></a><span id="l10.56"> </span>
<a href="#l10.57"></a><span id="l10.57">     let result = [];</span>
<a href="#l10.58"></a><span id="l10.58">     for (let name in this._commands) {</span>
<a href="#l10.59"></a><span id="l10.59">       let commands = this._commands[name];</span>
<a href="#l10.60"></a><span id="l10.60">       if (commands.hasOwnProperty(aPrplId)) {</span>
<a href="#l10.61"></a><span id="l10.61">         result.push(commands[aPrplId]);</span>
<a href="#l10.62"></a><span id="l10.62">       }</span>
<a href="#l10.63"></a><span id="l10.63">     }</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-    commandCount.value = result.length;</span>
<a href="#l10.65"></a><span id="l10.65">     return result;</span>
<a href="#l10.66"></a><span id="l10.66">   },</span>
<a href="#l10.67"></a><span id="l10.67">   _usageContextFilter(aConversation) {</span>
<a href="#l10.68"></a><span id="l10.68">     let usageContext =</span>
<a href="#l10.69"></a><span id="l10.69">       Ci.imICommand[&quot;CMD_CONTEXT_&quot; + (aConversation.isChat ? &quot;CHAT&quot; : &quot;IM&quot;)];</span>
<a href="#l10.70"></a><span id="l10.70">     return c =&gt; c.usageContext &amp; usageContext;</span>
<a href="#l10.71"></a><span id="l10.71">   },</span>
<a href="#l10.72"></a><span id="l10.72">   _findCommands(aConversation, aName) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/chat/components/src/imContacts.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/chat/components/src/imContacts.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -178,28 +178,25 @@ TagsService.prototype = {</span>
<a href="#l11.4"></a><span id="l11.4">         return null;</span>
<a href="#l11.5"></a><span id="l11.5">       }</span>
<a href="#l11.6"></a><span id="l11.6">       return this.getTagById(statement.row.id);</span>
<a href="#l11.7"></a><span id="l11.7">     } finally {</span>
<a href="#l11.8"></a><span id="l11.8">       statement.finalize();</span>
<a href="#l11.9"></a><span id="l11.9">     }</span>
<a href="#l11.10"></a><span id="l11.10">   },</span>
<a href="#l11.11"></a><span id="l11.11">   // Get an array of all existing tags.</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  getTags(aTagCount) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  getTags() {</span>
<a href="#l11.14"></a><span id="l11.14">     if (Tags.length) {</span>
<a href="#l11.15"></a><span id="l11.15">       Tags.sort((a, b) =&gt;</span>
<a href="#l11.16"></a><span id="l11.16">         a.name.toLowerCase().localeCompare(b.name.toLowerCase())</span>
<a href="#l11.17"></a><span id="l11.17">       );</span>
<a href="#l11.18"></a><span id="l11.18">     } else {</span>
<a href="#l11.19"></a><span id="l11.19">       this.defaultTag;</span>
<a href="#l11.20"></a><span id="l11.20">     }</span>
<a href="#l11.21"></a><span id="l11.21"> </span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-    if (aTagCount) {</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">-      aTagCount.value = Tags.length;</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">-    }</span>
<a href="#l11.25"></a><span id="l11.25">     return Tags;</span>
<a href="#l11.26"></a><span id="l11.26">   },</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28">   isTagHidden: aTag =&gt; aTag.id in otherContactsTag._hiddenTags,</span>
<a href="#l11.29"></a><span id="l11.29">   hideTag(aTag) {</span>
<a href="#l11.30"></a><span id="l11.30">     otherContactsTag.hideTag(aTag);</span>
<a href="#l11.31"></a><span id="l11.31">   },</span>
<a href="#l11.32"></a><span id="l11.32">   showTag(aTag) {</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineat">@@ -246,22 +243,18 @@ Tag.prototype = {</span>
<a href="#l11.34"></a><span id="l11.34">       statement.execute();</span>
<a href="#l11.35"></a><span id="l11.35">     } finally {</span>
<a href="#l11.36"></a><span id="l11.36">       statement.finalize();</span>
<a href="#l11.37"></a><span id="l11.37">     }</span>
<a href="#l11.38"></a><span id="l11.38"> </span>
<a href="#l11.39"></a><span id="l11.39">     // FIXME move the account buddies if some use this tag as their group</span>
<a href="#l11.40"></a><span id="l11.40">     return aNewName;</span>
<a href="#l11.41"></a><span id="l11.41">   },</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">-  getContacts(aContactCount) {</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-    let contacts = this._contacts.filter(c =&gt; !c._empty);</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineminus">-    if (aContactCount) {</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-      aContactCount.value = contacts.length;</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineminus">-    }</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-    return contacts;</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+  getContacts() {</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+    return this._contacts.filter(c =&gt; !c._empty);</span>
<a href="#l11.50"></a><span id="l11.50">   },</span>
<a href="#l11.51"></a><span id="l11.51">   _addContact(aContact) {</span>
<a href="#l11.52"></a><span id="l11.52">     this._contacts.push(aContact);</span>
<a href="#l11.53"></a><span id="l11.53">   },</span>
<a href="#l11.54"></a><span id="l11.54">   _removeContact(aContact) {</span>
<a href="#l11.55"></a><span id="l11.55">     let index = this._contacts.indexOf(aContact);</span>
<a href="#l11.56"></a><span id="l11.56">     if (index != -1) {</span>
<a href="#l11.57"></a><span id="l11.57">       this._contacts.splice(index, 1);</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineat">@@ -393,22 +386,18 @@ var otherContactsTag = {</span>
<a href="#l11.59"></a><span id="l11.59">     return -1;</span>
<a href="#l11.60"></a><span id="l11.60">   },</span>
<a href="#l11.61"></a><span id="l11.61">   get name() {</span>
<a href="#l11.62"></a><span id="l11.62">     return &quot;__others__&quot;;</span>
<a href="#l11.63"></a><span id="l11.63">   },</span>
<a href="#l11.64"></a><span id="l11.64">   set name(aNewName) {</span>
<a href="#l11.65"></a><span id="l11.65">     throw Cr.NS_ERROR_NOT_AVAILABLE;</span>
<a href="#l11.66"></a><span id="l11.66">   },</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-  getContacts(aContactCount) {</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineminus">-    let contacts = Object.keys(this._contacts).map(id =&gt; this._contacts[id]);</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineminus">-    if (aContactCount) {</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineminus">-      aContactCount.value = contacts.length;</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineminus">-    }</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineminus">-    return contacts;</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+  getContacts() {</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+    return Object.keys(this._contacts).map(id =&gt; this._contacts[id]);</span>
<a href="#l11.75"></a><span id="l11.75">   },</span>
<a href="#l11.76"></a><span id="l11.76">   _addContact(aContact) {</span>
<a href="#l11.77"></a><span id="l11.77">     this._contacts[aContact.id] = aContact;</span>
<a href="#l11.78"></a><span id="l11.78">     this.notifyObservers(aContact, &quot;contact-moved-in&quot;);</span>
<a href="#l11.79"></a><span id="l11.79">     for (let observer of ContactsById[aContact.id]._observers) {</span>
<a href="#l11.80"></a><span id="l11.80">       observer.observe(this, &quot;contact-moved-in&quot;, null);</span>
<a href="#l11.81"></a><span id="l11.81">     }</span>
<a href="#l11.82"></a><span id="l11.82">     aContact.addObserver(this._observer);</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineat">@@ -501,20 +490,17 @@ Contact.prototype = {</span>
<a href="#l11.84"></a><span id="l11.84">     statement = DBConn.createStatement(</span>
<a href="#l11.85"></a><span id="l11.85">       &quot;UPDATE buddies SET contact_id = :id WHERE id = :buddy_id&quot;</span>
<a href="#l11.86"></a><span id="l11.86">     );</span>
<a href="#l11.87"></a><span id="l11.87">     statement.params.id = this._id;</span>
<a href="#l11.88"></a><span id="l11.88">     statement.params.buddy_id = this._buddies[0].id;</span>
<a href="#l11.89"></a><span id="l11.89">     executeAsyncThenFinalize(statement);</span>
<a href="#l11.90"></a><span id="l11.90">   },</span>
<a href="#l11.91"></a><span id="l11.91"> </span>
<a href="#l11.92"></a><span id="l11.92" class="difflineminus">-  getTags(aTagCount) {</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineminus">-    if (aTagCount) {</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineminus">-      aTagCount.value = this._tags.length;</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineminus">-    }</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineplus">+  getTags() {</span>
<a href="#l11.97"></a><span id="l11.97">     return this._tags;</span>
<a href="#l11.98"></a><span id="l11.98">   },</span>
<a href="#l11.99"></a><span id="l11.99">   addTag(aTag, aInherited) {</span>
<a href="#l11.100"></a><span id="l11.100">     if (this.hasTag(aTag)) {</span>
<a href="#l11.101"></a><span id="l11.101">       return;</span>
<a href="#l11.102"></a><span id="l11.102">     }</span>
<a href="#l11.103"></a><span id="l11.103"> </span>
<a href="#l11.104"></a><span id="l11.104">     if (!aInherited) {</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineat">@@ -674,20 +660,17 @@ Contact.prototype = {</span>
<a href="#l11.106"></a><span id="l11.106">       for (let observer of this._observers) {</span>
<a href="#l11.107"></a><span id="l11.107">         observer.observe(aNewTag, &quot;contact-moved-in&quot;, null);</span>
<a href="#l11.108"></a><span id="l11.108">       }</span>
<a href="#l11.109"></a><span id="l11.109">       Services.obs.notifyObservers(this, &quot;contact-tag-added&quot;, aNewTag.id);</span>
<a href="#l11.110"></a><span id="l11.110">     }</span>
<a href="#l11.111"></a><span id="l11.111">     Services.obs.notifyObservers(this, &quot;contact-moved&quot;);</span>
<a href="#l11.112"></a><span id="l11.112">   },</span>
<a href="#l11.113"></a><span id="l11.113"> </span>
<a href="#l11.114"></a><span id="l11.114" class="difflineminus">-  getBuddies(aBuddyCount) {</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineminus">-    if (aBuddyCount) {</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineminus">-      aBuddyCount.value = this._buddies.length;</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineminus">-    }</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineplus">+  getBuddies() {</span>
<a href="#l11.119"></a><span id="l11.119">     return this._buddies;</span>
<a href="#l11.120"></a><span id="l11.120">   },</span>
<a href="#l11.121"></a><span id="l11.121">   get _empty() {</span>
<a href="#l11.122"></a><span id="l11.122">     return this._buddies.length == 0 || this._buddies.every(b =&gt; b._empty);</span>
<a href="#l11.123"></a><span id="l11.123">   },</span>
<a href="#l11.124"></a><span id="l11.124"> </span>
<a href="#l11.125"></a><span id="l11.125">   mergeContact(aContact) {</span>
<a href="#l11.126"></a><span id="l11.126">     // Avoid merging the contact with itself or merging into an</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineat">@@ -1160,20 +1143,17 @@ Buddy.prototype = {</span>
<a href="#l11.128"></a><span id="l11.128">   _hasAccountBuddy(aAccountId, aTagId) {</span>
<a href="#l11.129"></a><span id="l11.129">     for (let ab of this._accounts) {</span>
<a href="#l11.130"></a><span id="l11.130">       if (ab.account.numericId == aAccountId &amp;&amp; ab.tag.id == aTagId) {</span>
<a href="#l11.131"></a><span id="l11.131">         return true;</span>
<a href="#l11.132"></a><span id="l11.132">       }</span>
<a href="#l11.133"></a><span id="l11.133">     }</span>
<a href="#l11.134"></a><span id="l11.134">     return false;</span>
<a href="#l11.135"></a><span id="l11.135">   },</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineminus">-  getAccountBuddies(aAccountBuddyCount) {</span>
<a href="#l11.137"></a><span id="l11.137" class="difflineminus">-    if (aAccountBuddyCount) {</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineminus">-      aAccountBuddyCount.value = this._accounts.length;</span>
<a href="#l11.139"></a><span id="l11.139" class="difflineminus">-    }</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineplus">+  getAccountBuddies() {</span>
<a href="#l11.141"></a><span id="l11.141">     return this._accounts;</span>
<a href="#l11.142"></a><span id="l11.142">   },</span>
<a href="#l11.143"></a><span id="l11.143"> </span>
<a href="#l11.144"></a><span id="l11.144">   _addAccount(aAccountBuddy, aTag) {</span>
<a href="#l11.145"></a><span id="l11.145">     this._accounts.push(aAccountBuddy);</span>
<a href="#l11.146"></a><span id="l11.146">     let contact = this._contact;</span>
<a href="#l11.147"></a><span id="l11.147">     if (!this._contact._tags.includes(aTag)) {</span>
<a href="#l11.148"></a><span id="l11.148">       this._contact._tags.push(aTag);</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineat">@@ -1595,24 +1575,20 @@ ContactsService.prototype = {</span>
<a href="#l11.150"></a><span id="l11.150">       buddy.destroy();</span>
<a href="#l11.151"></a><span id="l11.151">     }</span>
<a href="#l11.152"></a><span id="l11.152">     BuddiesById = {};</span>
<a href="#l11.153"></a><span id="l11.153">     ContactsById = {};</span>
<a href="#l11.154"></a><span id="l11.154">   },</span>
<a href="#l11.155"></a><span id="l11.155"> </span>
<a href="#l11.156"></a><span id="l11.156">   getContactById: aId =&gt; ContactsById[aId],</span>
<a href="#l11.157"></a><span id="l11.157">   // Get an array of all existing contacts.</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineminus">-  getContacts(aContactCount) {</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineminus">-    let contacts = Object.keys(ContactsById)</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineplus">+  getContacts() {</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineplus">+    return Object.keys(ContactsById)</span>
<a href="#l11.162"></a><span id="l11.162">       .filter(id =&gt; !ContactsById[id]._empty)</span>
<a href="#l11.163"></a><span id="l11.163">       .map(id =&gt; ContactsById[id]);</span>
<a href="#l11.164"></a><span id="l11.164" class="difflineminus">-    if (aContactCount) {</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineminus">-      aContactCount.value = contacts.length;</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineminus">-    }</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineminus">-    return contacts;</span>
<a href="#l11.168"></a><span id="l11.168">   },</span>
<a href="#l11.169"></a><span id="l11.169">   getBuddyById: aId =&gt; BuddiesById[aId],</span>
<a href="#l11.170"></a><span id="l11.170">   getBuddyByNameAndProtocol(aNormalizedName, aPrpl) {</span>
<a href="#l11.171"></a><span id="l11.171">     let statement = DBConn.createStatement(</span>
<a href="#l11.172"></a><span id="l11.172">       &quot;SELECT b.id FROM buddies b &quot; +</span>
<a href="#l11.173"></a><span id="l11.173">         &quot;JOIN account_buddy ab ON buddy_id = b.id &quot; +</span>
<a href="#l11.174"></a><span id="l11.174">         &quot;JOIN accounts a ON account_id = a.id &quot; +</span>
<a href="#l11.175"></a><span id="l11.175">         &quot;WHERE b.key = :buddyName and a.prpl = :prplId&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/chat/components/src/imConversations.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/chat/components/src/imConversations.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -129,18 +129,18 @@ imMessage.prototype = {</span>
<a href="#l12.4"></a><span id="l12.4">     return this.prplMessage.notification;</span>
<a href="#l12.5"></a><span id="l12.5">   },</span>
<a href="#l12.6"></a><span id="l12.6">   get noLinkification() {</span>
<a href="#l12.7"></a><span id="l12.7">     return this.prplMessage.noLinkification;</span>
<a href="#l12.8"></a><span id="l12.8">   },</span>
<a href="#l12.9"></a><span id="l12.9">   get originalMessage() {</span>
<a href="#l12.10"></a><span id="l12.10">     return this.prplMessage.originalMessage;</span>
<a href="#l12.11"></a><span id="l12.11">   },</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  getActions(aCount) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-    return this.prplMessage.getActions(aCount || {});</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+  getActions() {</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+    return this.prplMessage.getActions();</span>
<a href="#l12.16"></a><span id="l12.16">   },</span>
<a href="#l12.17"></a><span id="l12.17"> };</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19"> function UIConversation(aPrplConversation) {</span>
<a href="#l12.20"></a><span id="l12.20">   this._prplConv = {};</span>
<a href="#l12.21"></a><span id="l12.21">   this.id = ++gLastUIConvId;</span>
<a href="#l12.22"></a><span id="l12.22">   this._observers = [];</span>
<a href="#l12.23"></a><span id="l12.23">   this._messages = [];</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineat">@@ -282,20 +282,17 @@ UIConversation.prototype = {</span>
<a href="#l12.25"></a><span id="l12.25">     for (let observer of this._observers) {</span>
<a href="#l12.26"></a><span id="l12.26">       observer.observe(</span>
<a href="#l12.27"></a><span id="l12.27">         this,</span>
<a href="#l12.28"></a><span id="l12.28">         &quot;unread-message-count-changed&quot;,</span>
<a href="#l12.29"></a><span id="l12.29">         this._unreadIncomingMessageCount.toString()</span>
<a href="#l12.30"></a><span id="l12.30">       );</span>
<a href="#l12.31"></a><span id="l12.31">     }</span>
<a href="#l12.32"></a><span id="l12.32">   },</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-  getMessages(aMessageCount) {</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-    if (aMessageCount) {</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-      aMessageCount.value = this._messages.length;</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-    }</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+  getMessages() {</span>
<a href="#l12.38"></a><span id="l12.38">     return this._messages;</span>
<a href="#l12.39"></a><span id="l12.39">   },</span>
<a href="#l12.40"></a><span id="l12.40">   checkClose() {</span>
<a href="#l12.41"></a><span id="l12.41">     if (!this._currentTargetId) {</span>
<a href="#l12.42"></a><span id="l12.42">       // Already closed.</span>
<a href="#l12.43"></a><span id="l12.43">       return true;</span>
<a href="#l12.44"></a><span id="l12.44">     }</span>
<a href="#l12.45"></a><span id="l12.45"> </span>
<a href="#l12.46"></a><span id="l12.46" class="difflineat">@@ -796,32 +793,29 @@ ConversationsService.prototype = {</span>
<a href="#l12.47"></a><span id="l12.47">   forgetConversation(aPrplConversation) {</span>
<a href="#l12.48"></a><span id="l12.48">     aPrplConversation.unInit();</span>
<a href="#l12.49"></a><span id="l12.49"> </span>
<a href="#l12.50"></a><span id="l12.50">     this._prplConversations = this._prplConversations.filter(</span>
<a href="#l12.51"></a><span id="l12.51">       c =&gt; c !== aPrplConversation</span>
<a href="#l12.52"></a><span id="l12.52">     );</span>
<a href="#l12.53"></a><span id="l12.53">   },</span>
<a href="#l12.54"></a><span id="l12.54"> </span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-  getUIConversations(aConvCount) {</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+  getUIConversations() {</span>
<a href="#l12.57"></a><span id="l12.57">     let rv = [];</span>
<a href="#l12.58"></a><span id="l12.58">     if (this._uiConv) {</span>
<a href="#l12.59"></a><span id="l12.59">       for (let prplConvId in this._uiConv) {</span>
<a href="#l12.60"></a><span id="l12.60">         // Since an UIConversation may be linked to multiple prplConversations,</span>
<a href="#l12.61"></a><span id="l12.61">         // we must ensure we don't return the same UIConversation twice,</span>
<a href="#l12.62"></a><span id="l12.62">         // by checking the id matches that of the active prplConversation.</span>
<a href="#l12.63"></a><span id="l12.63">         let uiConv = this._uiConv[prplConvId];</span>
<a href="#l12.64"></a><span id="l12.64">         if (prplConvId == uiConv.target.id) {</span>
<a href="#l12.65"></a><span id="l12.65">           rv.push(uiConv);</span>
<a href="#l12.66"></a><span id="l12.66">         }</span>
<a href="#l12.67"></a><span id="l12.67">       }</span>
<a href="#l12.68"></a><span id="l12.68">     }</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-    if (aConvCount) {</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-      aConvCount.value = rv.length;</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineminus">-    }</span>
<a href="#l12.72"></a><span id="l12.72">     return rv;</span>
<a href="#l12.73"></a><span id="l12.73">   },</span>
<a href="#l12.74"></a><span id="l12.74">   getUIConversation(aPrplConversation) {</span>
<a href="#l12.75"></a><span id="l12.75">     let id = aPrplConversation.id;</span>
<a href="#l12.76"></a><span id="l12.76">     if (this._uiConv &amp;&amp; id in this._uiConv) {</span>
<a href="#l12.77"></a><span id="l12.77">       return this._uiConv[id];</span>
<a href="#l12.78"></a><span id="l12.78">     }</span>
<a href="#l12.79"></a><span id="l12.79">     throw new Error(&quot;Unknown conversation&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/chat/components/src/logger.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/chat/components/src/logger.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -543,20 +543,17 @@ LogConversation.prototype = {</span>
<a href="#l13.4"></a><span id="l13.4">     return {</span>
<a href="#l13.5"></a><span id="l13.5">       alias: &quot;&quot;,</span>
<a href="#l13.6"></a><span id="l13.6">       name: this._accountName,</span>
<a href="#l13.7"></a><span id="l13.7">       normalizedName: this._accountName,</span>
<a href="#l13.8"></a><span id="l13.8">       protocol: { name: this._protocolName },</span>
<a href="#l13.9"></a><span id="l13.9">       statusInfo: Services.core.globalUserStatus,</span>
<a href="#l13.10"></a><span id="l13.10">     };</span>
<a href="#l13.11"></a><span id="l13.11">   },</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  getMessages(aMessageCount) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-    if (aMessageCount) {</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-      aMessageCount.value = this._messages.length;</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-    }</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+  getMessages() {</span>
<a href="#l13.17"></a><span id="l13.17">     return this._messages.map(m =&gt; new LogMessage(m, this));</span>
<a href="#l13.18"></a><span id="l13.18">   },</span>
<a href="#l13.19"></a><span id="l13.19">   getMessagesEnumerator(aMessageCount) {</span>
<a href="#l13.20"></a><span id="l13.20">     if (aMessageCount) {</span>
<a href="#l13.21"></a><span id="l13.21">       aMessageCount.value = this._messages.length;</span>
<a href="#l13.22"></a><span id="l13.22">     }</span>
<a href="#l13.23"></a><span id="l13.23">     let enumerator = {</span>
<a href="#l13.24"></a><span id="l13.24">       _index: 0,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/chat/components/src/test/test_commands.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/chat/components/src/test/test_commands.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -206,17 +206,17 @@ function run_test() {</span>
<a href="#l14.4"></a><span id="l14.4">     },</span>
<a href="#l14.5"></a><span id="l14.5">   ];</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7">   for (let test of testData) {</span>
<a href="#l14.8"></a><span id="l14.8">     info(&quot;The following tests are with: &quot; + test.desc);</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10">     // Check which commands are available in which context.</span>
<a href="#l14.11"></a><span id="l14.11">     let cmdlist = cmdserv</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-      .listCommandsForConversation(test.conv, {})</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+      .listCommandsForConversation(test.conv)</span>
<a href="#l14.14"></a><span id="l14.14">       .map(aCmd =&gt; aCmd.name)</span>
<a href="#l14.15"></a><span id="l14.15">       .sort()</span>
<a href="#l14.16"></a><span id="l14.16">       .join(&quot;, &quot;);</span>
<a href="#l14.17"></a><span id="l14.17">     Assert.equal(cmdlist, test.cmdlist);</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19">     for (let testCmd of testCmds) {</span>
<a href="#l14.20"></a><span id="l14.20">       info(&quot;Testing command found for '&quot; + testCmd + &quot;'&quot;);</span>
<a href="#l14.21"></a><span id="l14.21">       let expectedResult = test.results.shift();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/chat/modules/jsProtoHelper.jsm</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/chat/modules/jsProtoHelper.jsm</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -589,20 +589,17 @@ var GenericMessagePrototype = {</span>
<a href="#l15.4"></a><span id="l15.4">   noLog: false,</span>
<a href="#l15.5"></a><span id="l15.5">   error: false,</span>
<a href="#l15.6"></a><span id="l15.6">   delayed: false,</span>
<a href="#l15.7"></a><span id="l15.7">   noFormat: false,</span>
<a href="#l15.8"></a><span id="l15.8">   containsImages: false,</span>
<a href="#l15.9"></a><span id="l15.9">   notification: false,</span>
<a href="#l15.10"></a><span id="l15.10">   noLinkification: false,</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  getActions(aCount) {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-    if (aCount) {</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-      aCount.value = 0;</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-    }</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+  getActions() {</span>
<a href="#l15.17"></a><span id="l15.17">     return [];</span>
<a href="#l15.18"></a><span id="l15.18">   },</span>
<a href="#l15.19"></a><span id="l15.19"> };</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21"> function Message(aWho, aMessage, aObject) {</span>
<a href="#l15.22"></a><span id="l15.22">   this._init(aWho, aMessage, aObject);</span>
<a href="#l15.23"></a><span id="l15.23"> }</span>
<a href="#l15.24"></a><span id="l15.24"> Message.prototype = GenericMessagePrototype;</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineat">@@ -658,17 +655,17 @@ var GenericConversationPrototype = {</span>
<a href="#l15.26"></a><span id="l15.26">       try {</span>
<a href="#l15.27"></a><span id="l15.27">         observer.observe(aSubject, aTopic, aData);</span>
<a href="#l15.28"></a><span id="l15.28">       } catch (e) {</span>
<a href="#l15.29"></a><span id="l15.29">         this.ERROR(e);</span>
<a href="#l15.30"></a><span id="l15.30">       }</span>
<a href="#l15.31"></a><span id="l15.31">     }</span>
<a href="#l15.32"></a><span id="l15.32">   },</span>
<a href="#l15.33"></a><span id="l15.33"> </span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-  prepareForSending: (aOutgoingMessage, aCount) =&gt; null,</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+  prepareForSending: aOutgoingMessage =&gt; null,</span>
<a href="#l15.36"></a><span id="l15.36">   prepareForDisplaying(aImMessage) {</span>
<a href="#l15.37"></a><span id="l15.37">     if (aImMessage.displayMessage !== aImMessage.message) {</span>
<a href="#l15.38"></a><span id="l15.38">       this.DEBUG(</span>
<a href="#l15.39"></a><span id="l15.39">         &quot;Preparing:\n&quot; +</span>
<a href="#l15.40"></a><span id="l15.40">           aImMessage.message +</span>
<a href="#l15.41"></a><span id="l15.41">           &quot;\nDisplaying:\n&quot; +</span>
<a href="#l15.42"></a><span id="l15.42">           aImMessage.displayMessage</span>
<a href="#l15.43"></a><span id="l15.43">       );</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/chat/protocols/irc/irc.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/chat/protocols/irc/irc.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -267,17 +267,17 @@ var GenericIRCConversation = {</span>
<a href="#l16.4"></a><span id="l16.4">     delete messageProps.tags;</span>
<a href="#l16.5"></a><span id="l16.5">     return messageProps;</span>
<a href="#l16.6"></a><span id="l16.6">   },</span>
<a href="#l16.7"></a><span id="l16.7">   // Apply CTCP formatting before displaying.</span>
<a href="#l16.8"></a><span id="l16.8">   prepareForDisplaying(aMsg) {</span>
<a href="#l16.9"></a><span id="l16.9">     aMsg.displayMessage = ctcpFormatToHTML(aMsg.displayMessage);</span>
<a href="#l16.10"></a><span id="l16.10">     GenericConversationPrototype.prepareForDisplaying.apply(this, arguments);</span>
<a href="#l16.11"></a><span id="l16.11">   },</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  prepareForSending(aOutgoingMessage, aCount) {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  prepareForSending(aOutgoingMessage) {</span>
<a href="#l16.14"></a><span id="l16.14">     // Split the message by line breaks and send each one individually.</span>
<a href="#l16.15"></a><span id="l16.15">     let messages = aOutgoingMessage.message.split(/[\r\n]+/);</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17">     let maxLength = this.getMaxMessageLength();</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">     // Attempt to smartly split a string into multiple lines (based on the</span>
<a href="#l16.20"></a><span id="l16.20">     // maximum number of characters the message can contain).</span>
<a href="#l16.21"></a><span id="l16.21">     for (let i = 0; i &lt; messages.length; ++i) {</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -297,20 +297,16 @@ var GenericIRCConversation = {</span>
<a href="#l16.23"></a><span id="l16.23">       messages.splice(</span>
<a href="#l16.24"></a><span id="l16.24">         i,</span>
<a href="#l16.25"></a><span id="l16.25">         1,</span>
<a href="#l16.26"></a><span id="l16.26">         message.substr(0, index == -1 ? maxLength : index),</span>
<a href="#l16.27"></a><span id="l16.27">         message.substr(index + 1 || maxLength)</span>
<a href="#l16.28"></a><span id="l16.28">       );</span>
<a href="#l16.29"></a><span id="l16.29">     }</span>
<a href="#l16.30"></a><span id="l16.30"> </span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-    if (aCount) {</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">-      aCount.value = messages.length;</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">-    }</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-</span>
<a href="#l16.35"></a><span id="l16.35">     return messages;</span>
<a href="#l16.36"></a><span id="l16.36">   },</span>
<a href="#l16.37"></a><span id="l16.37">   sendMsg(aMessage, aIsNotice) {</span>
<a href="#l16.38"></a><span id="l16.38">     if (!aMessage.length) {</span>
<a href="#l16.39"></a><span id="l16.39">       return;</span>
<a href="#l16.40"></a><span id="l16.40">     }</span>
<a href="#l16.41"></a><span id="l16.41"> </span>
<a href="#l16.42"></a><span id="l16.42">     if (</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineat">@@ -1221,32 +1217,28 @@ ircAccount.prototype = {</span>
<a href="#l16.44"></a><span id="l16.44">       this._channelList = new Map();</span>
<a href="#l16.45"></a><span id="l16.45">       this._currentBatch = [];</span>
<a href="#l16.46"></a><span id="l16.46">       this._pendingList = true;</span>
<a href="#l16.47"></a><span id="l16.47">       this._lastListTime = Date.now();</span>
<a href="#l16.48"></a><span id="l16.48">       this.sendMessage(&quot;LIST&quot;);</span>
<a href="#l16.49"></a><span id="l16.49">     } else {</span>
<a href="#l16.50"></a><span id="l16.50">       // Otherwise, pass channels that have already been received to the callback.</span>
<a href="#l16.51"></a><span id="l16.51">       let rooms = [...this._channelList.keys()];</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-      aCallback.onRoomInfoAvailable(rooms, !this._pendingList, rooms.length);</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+      aCallback.onRoomInfoAvailable(rooms, !this._pendingList);</span>
<a href="#l16.54"></a><span id="l16.54">     }</span>
<a href="#l16.55"></a><span id="l16.55"> </span>
<a href="#l16.56"></a><span id="l16.56">     if (this._pendingList) {</span>
<a href="#l16.57"></a><span id="l16.57">       this._roomInfoCallbacks.add(aCallback);</span>
<a href="#l16.58"></a><span id="l16.58">     }</span>
<a href="#l16.59"></a><span id="l16.59">   },</span>
<a href="#l16.60"></a><span id="l16.60">   // Pass room info for any remaining channels to callbacks and clean up.</span>
<a href="#l16.61"></a><span id="l16.61">   _sendRemainingRoomInfo() {</span>
<a href="#l16.62"></a><span id="l16.62">     if (this._currentBatch.length) {</span>
<a href="#l16.63"></a><span id="l16.63">       for (let callback of this._roomInfoCallbacks) {</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineminus">-        callback.onRoomInfoAvailable(</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineminus">-          this._currentBatch,</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineminus">-          true,</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineminus">-          this._currentBatch.length</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineminus">-        );</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+        callback.onRoomInfoAvailable(this._currentBatch, true);</span>
<a href="#l16.70"></a><span id="l16.70">       }</span>
<a href="#l16.71"></a><span id="l16.71">     }</span>
<a href="#l16.72"></a><span id="l16.72">     this._roomInfoCallbacks.clear();</span>
<a href="#l16.73"></a><span id="l16.73">     delete this._pendingList;</span>
<a href="#l16.74"></a><span id="l16.74">     delete this._currentBatch;</span>
<a href="#l16.75"></a><span id="l16.75">   },</span>
<a href="#l16.76"></a><span id="l16.76">   getRoomInfo(aName) {</span>
<a href="#l16.77"></a><span id="l16.77">     return new ircRoomInfo(aName, this);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/chat/protocols/irc/ircBase.jsm</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/chat/protocols/irc/ircBase.jsm</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -962,21 +962,17 @@ var ircBase = {</span>
<a href="#l17.4"></a><span id="l17.4">       // 1058584. This hack can be removed when bug 1058653 is fixed.</span>
<a href="#l17.5"></a><span id="l17.5">       topic = topic ? topic.normalize() : &quot;&quot;;</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7">       this._channelList.set(name, { topic, participantCount });</span>
<a href="#l17.8"></a><span id="l17.8">       this._currentBatch.push(name);</span>
<a href="#l17.9"></a><span id="l17.9">       // Give callbacks a batch of channels of length _channelsPerBatch.</span>
<a href="#l17.10"></a><span id="l17.10">       if (this._currentBatch.length == this._channelsPerBatch) {</span>
<a href="#l17.11"></a><span id="l17.11">         for (let callback of this._roomInfoCallbacks) {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-          callback.onRoomInfoAvailable(</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-            this._currentBatch,</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-            false,</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-            this._channelsPerBatch</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-          );</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+          callback.onRoomInfoAvailable(this._currentBatch, false);</span>
<a href="#l17.18"></a><span id="l17.18">         }</span>
<a href="#l17.19"></a><span id="l17.19">         this._currentBatch = [];</span>
<a href="#l17.20"></a><span id="l17.20">       }</span>
<a href="#l17.21"></a><span id="l17.21">       return true;</span>
<a href="#l17.22"></a><span id="l17.22">     },</span>
<a href="#l17.23"></a><span id="l17.23">     &quot;323&quot;: function(aMessage) {</span>
<a href="#l17.24"></a><span id="l17.24">       // RPL_LISTEND</span>
<a href="#l17.25"></a><span id="l17.25">       // :End of LIST</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/chat/protocols/irc/test/test_splitLongMessages.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/chat/protocols/irc/test/test_splitLongMessages.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -25,16 +25,16 @@ irc.GenericIRCConversation._account = {</span>
<a href="#l18.4"></a><span id="l18.4">   _nickname: &quot;sender&quot;,</span>
<a href="#l18.5"></a><span id="l18.5">   prefix: &quot;!user@host&quot;,</span>
<a href="#l18.6"></a><span id="l18.6">   maxMessageLength: 51, // For convenience.</span>
<a href="#l18.7"></a><span id="l18.7"> };</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9"> function run_test() {</span>
<a href="#l18.10"></a><span id="l18.10">   for (let message in messages) {</span>
<a href="#l18.11"></a><span id="l18.11">     let msg = { message };</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    let generatedMsgs = irc.GenericIRCConversation.prepareForSending(msg, {});</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    let generatedMsgs = irc.GenericIRCConversation.prepareForSending(msg);</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15">     // The expected messages as defined above.</span>
<a href="#l18.16"></a><span id="l18.16">     let expectedMsgs = messages[message];</span>
<a href="#l18.17"></a><span id="l18.17">     // Ensure the arrays are equal.</span>
<a href="#l18.18"></a><span id="l18.18">     deepEqual(generatedMsgs, expectedMsgs);</span>
<a href="#l18.19"></a><span id="l18.19">   }</span>
<a href="#l18.20"></a><span id="l18.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/chat/protocols/twitter/twitter.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/chat/protocols/twitter/twitter.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -67,22 +67,19 @@ ChatBuddy.prototype = {</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5"> function Tweet(aTweet, aWho, aMessage, aObject) {</span>
<a href="#l19.6"></a><span id="l19.6">   this._tweet = aTweet;</span>
<a href="#l19.7"></a><span id="l19.7">   this._init(aWho, aMessage, aObject);</span>
<a href="#l19.8"></a><span id="l19.8"> }</span>
<a href="#l19.9"></a><span id="l19.9"> Tweet.prototype = {</span>
<a href="#l19.10"></a><span id="l19.10">   __proto__: GenericMessagePrototype,</span>
<a href="#l19.11"></a><span id="l19.11">   _deleted: false,</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  getActions(aCount) {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+  getActions() {</span>
<a href="#l19.14"></a><span id="l19.14">     // Direct messages have no actions.</span>
<a href="#l19.15"></a><span id="l19.15">     if (!this.conversation.isChat) {</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-      if (aCount) {</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">-        aCount.value = 0;</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">-      }</span>
<a href="#l19.19"></a><span id="l19.19">       return [];</span>
<a href="#l19.20"></a><span id="l19.20">     }</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22">     let account = this.conversation._account;</span>
<a href="#l19.23"></a><span id="l19.23">     let actions = [];</span>
<a href="#l19.24"></a><span id="l19.24"> </span>
<a href="#l19.25"></a><span id="l19.25">     if (account.connected) {</span>
<a href="#l19.26"></a><span id="l19.26">       actions.push(</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineat">@@ -146,19 +143,16 @@ Tweet.prototype = {</span>
<a href="#l19.28"></a><span id="l19.28">             this._tweet.id_str;</span>
<a href="#l19.29"></a><span id="l19.29">           Cc[&quot;@mozilla.org/widget/clipboardhelper;1&quot;]</span>
<a href="#l19.30"></a><span id="l19.30">             .getService(Ci.nsIClipboardHelper)</span>
<a href="#l19.31"></a><span id="l19.31">             .copyString(href);</span>
<a href="#l19.32"></a><span id="l19.32">         },</span>
<a href="#l19.33"></a><span id="l19.33">         this</span>
<a href="#l19.34"></a><span id="l19.34">       )</span>
<a href="#l19.35"></a><span id="l19.35">     );</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineminus">-    if (aCount) {</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineminus">-      aCount.value = actions.length;</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineminus">-    }</span>
<a href="#l19.39"></a><span id="l19.39">     return actions;</span>
<a href="#l19.40"></a><span id="l19.40">   },</span>
<a href="#l19.41"></a><span id="l19.41">   destroy() {</span>
<a href="#l19.42"></a><span id="l19.42">     // Mark the tweet as deleted until we receive a response.</span>
<a href="#l19.43"></a><span id="l19.43">     this._deleted = true;</span>
<a href="#l19.44"></a><span id="l19.44"> </span>
<a href="#l19.45"></a><span id="l19.45">     this.conversation._account.destroy(</span>
<a href="#l19.46"></a><span id="l19.46">       this._tweet,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/chat/protocols/xmpp/xmpp.jsm</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/chat/protocols/xmpp/xmpp.jsm</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -2359,17 +2359,17 @@ var XMPPAccountPrototype = {</span>
<a href="#l20.4"></a><span id="l20.4">         &quot;get&quot;,</span>
<a href="#l20.5"></a><span id="l20.5">         null,</span>
<a href="#l20.6"></a><span id="l20.6">         this._mucService,</span>
<a href="#l20.7"></a><span id="l20.7">         Stanza.node(&quot;query&quot;, Stanza.NS.disco_items)</span>
<a href="#l20.8"></a><span id="l20.8">       );</span>
<a href="#l20.9"></a><span id="l20.9">       this.sendStanza(iq, this.onRoomDiscovery, this);</span>
<a href="#l20.10"></a><span id="l20.10">     } else {</span>
<a href="#l20.11"></a><span id="l20.11">       let rooms = [...this._roomList.keys()];</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-      aCallback.onRoomInfoAvailable(rooms, !this._pendingList, rooms.length);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+      aCallback.onRoomInfoAvailable(rooms, !this._pendingList);</span>
<a href="#l20.14"></a><span id="l20.14">     }</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16">     if (this._pendingList) {</span>
<a href="#l20.17"></a><span id="l20.17">       this._roomInfoCallbacks.add(aCallback);</span>
<a href="#l20.18"></a><span id="l20.18">     }</span>
<a href="#l20.19"></a><span id="l20.19">   },</span>
<a href="#l20.20"></a><span id="l20.20"> </span>
<a href="#l20.21"></a><span id="l20.21">   onRoomDiscovery(aStanza) {</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -2405,21 +2405,17 @@ var XMPPAccountPrototype = {</span>
<a href="#l20.23"></a><span id="l20.23">       if (!name) {</span>
<a href="#l20.24"></a><span id="l20.24">         name = jid.node ? jid.node : jid.jid;</span>
<a href="#l20.25"></a><span id="l20.25">       }</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27">       this._roomList.set(name, jid.jid);</span>
<a href="#l20.28"></a><span id="l20.28">       rooms.push(name);</span>
<a href="#l20.29"></a><span id="l20.29">     });</span>
<a href="#l20.30"></a><span id="l20.30"> </span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-    this._roomInfoCallback.onRoomInfoAvailable(</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-      rooms,</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-      !this._pendingList,</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">-      rooms.length</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-    );</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineplus">+    this._roomInfoCallback.onRoomInfoAvailable(rooms, !this._pendingList);</span>
<a href="#l20.37"></a><span id="l20.37">   },</span>
<a href="#l20.38"></a><span id="l20.38"> </span>
<a href="#l20.39"></a><span id="l20.39">   getRoomInfo(aName) {</span>
<a href="#l20.40"></a><span id="l20.40">     return new XMPPRoomInfo(aName, this);</span>
<a href="#l20.41"></a><span id="l20.41">   },</span>
<a href="#l20.42"></a><span id="l20.42"> </span>
<a href="#l20.43"></a><span id="l20.43">   // Returns null if not an invitation stanza, and an object</span>
<a href="#l20.44"></a><span id="l20.44">   // describing the invitation otherwise.</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

