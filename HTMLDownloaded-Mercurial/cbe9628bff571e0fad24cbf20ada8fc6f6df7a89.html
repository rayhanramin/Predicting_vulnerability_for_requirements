<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 3607:cbe9628bff571e0fad24cbf20ada8fc6f6df7a89</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ cbe9628bff571e0fad24cbf20ada8fc6f6df7a89" />
<meta property="og:url" content="/comm-central/rev/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89" />
<meta property="og:description" content="Bug 501910 - &quot;Consider Preferences UI for cookies&quot; [r=mkmelin ui-r=clarkbw a=blocking-thunderbird3]" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / cbe9628bff571e0fad24cbf20ada8fc6f6df7a89 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89">shortlog</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89">files</a> |
changeset |
<a href="/comm-central/raw-rev/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89">raw</a>  | <a href="/comm-central/archive/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=501910">Bug 501910</a> - &quot;Consider Preferences UI for cookies&quot; [r=mkmelin ui-r=clarkbw a=blocking-thunderbird3]
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#66;&#108;&#97;&#107;&#101;&#32;&#87;&#105;&#110;&#116;&#111;&#110;&#32;&#60;&#98;&#119;&#105;&#110;&#116;&#111;&#110;&#64;&#108;&#97;&#116;&#116;&#101;&#46;&#99;&#97;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 09 Sep 2009 20:35:54 +0100</td></tr>

<tr>
 <td>changeset 3607</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89">cbe9628bff571e0fad24cbf20ada8fc6f6df7a89</a></td>
</tr>



<tr>
<td>parent 3606</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d45144dc165cddd7cb1a0879d854d2fcb9daa45b">d45144dc165cddd7cb1a0879d854d2fcb9daa45b</a>
</td>
</tr>

<tr>
<td>child 3608</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1eed6232fe8b37a3e95e8db97d3bc0b0329fce70">1eed6232fe8b37a3e95e8db97d3bc0b0329fce70</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=cbe9628bff571e0fad24cbf20ada8fc6f6df7a89">2921</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 09 Sep 2009 19:38:14 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@1eed6232fe8b [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1eed6232fe8b37a3e95e8db97d3bc0b0329fce70">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1eed6232fe8b37a3e95e8db97d3bc0b0329fce70&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1eed6232fe8b37a3e95e8db97d3bc0b0329fce70&newProject=comm-central&newRevision=cbe9628bff571e0fad24cbf20ada8fc6f6df7a89&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1eed6232fe8b37a3e95e8db97d3bc0b0329fce70&newProject=comm-central&newRevision=cbe9628bff571e0fad24cbf20ada8fc6f6df7a89&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1eed6232fe8b37a3e95e8db97d3bc0b0329fce70&newProject=comm-central&newRevision=cbe9628bff571e0fad24cbf20ada8fc6f6df7a89&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a>, <a href="/comm-central/log?rev=reviewer%28clarkbw%29&revcount=50">clarkbw</a>, <a href="/comm-central/log?rev=reviewer%28blocking-thunderbird3%29&revcount=50">blocking-thunderbird3</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=501910">501910</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=501910">Bug 501910</a> - &quot;Consider Preferences UI for cookies&quot; [r=mkmelin ui-r=clarkbw a=blocking-thunderbird3]</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.js">mail/components/preferences/cookies.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.js">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.js">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.js">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.js">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.xul">mail/components/preferences/cookies.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.xul">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.xul">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.xul">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.xul">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/cookies.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/jar.mn">mail/components/preferences/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/jar.mn">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/jar.mn">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/jar.mn">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/jar.mn">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.js">mail/components/preferences/permissions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.js">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.js">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.js">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.js">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.xul">mail/components/preferences/permissions.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.xul">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.xul">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.xul">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.xul">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissions.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissionsutils.js">mail/components/preferences/permissionsutils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissionsutils.js">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissionsutils.js">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissionsutils.js">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissionsutils.js">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/permissionsutils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.js">mail/components/preferences/security.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.js">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.js">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.js">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.js">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.xul">mail/components/preferences/security.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.xul">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.xul">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.xul">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.xul">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/components/preferences/security.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/cookies.dtd">mail/locales/en-US/chrome/messenger/preferences/cookies.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/cookies.dtd">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/cookies.dtd">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/cookies.dtd">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/cookies.dtd">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/cookies.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/permissions.dtd">mail/locales/en-US/chrome/messenger/preferences/permissions.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/permissions.dtd">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/permissions.dtd">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/permissions.dtd">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/permissions.dtd">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/permissions.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">mail/locales/en-US/chrome/messenger/preferences/preferences.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/preferences.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/security.dtd">mail/locales/en-US/chrome/messenger/preferences/security.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/security.dtd">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/security.dtd">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/security.dtd">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/security.dtd">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/en-US/chrome/messenger/preferences/security.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/jar.mn">mail/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/themes/pinstripe/mail/preferences/preferences.css">mail/themes/pinstripe/mail/preferences/preferences.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/themes/pinstripe/mail/preferences/preferences.css">file</a> |
<a href="/comm-central/annotate/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/themes/pinstripe/mail/preferences/preferences.css">annotate</a> |
<a href="/comm-central/diff/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/themes/pinstripe/mail/preferences/preferences.css">diff</a> |
<a href="/comm-central/comparison/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/themes/pinstripe/mail/preferences/preferences.css">comparison</a> |
<a href="/comm-central/log/cbe9628bff571e0fad24cbf20ada8fc6f6df7a89/mail/themes/pinstripe/mail/preferences/preferences.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1">new file mode 100644</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineminus">--- /dev/null</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineplus">+++ b/mail/components/preferences/cookies.js</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineat">@@ -0,0 +1,941 @@</span>
<a href="#l1.5"></a><span id="l1.5" class="difflineplus">+# -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineplus">+#</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+#</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+# License.</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+#</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+# The Original Code is the Firefox Preferences System.</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+#</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+# The Initial Developer of the Original Code is</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+# Ben Goodger.</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 2005</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+#</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+# Contributor(s):</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+#   Ben Goodger &lt;ben@mozilla.org&gt;</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+#   Ehsan Akhgari &lt;ehsan.akhgari@gmail.com&gt;</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+#</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+#</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+const nsICookie = Components.interfaces.nsICookie;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+var gCookiesWindow = {</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+  _cm               : Components.classes[&quot;@mozilla.org/cookiemanager;1&quot;]</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+                                .getService(Components.interfaces.nsICookieManager),</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+  _ds               : Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+                                .getService(Components.interfaces.nsIScriptableDateFormat),</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+  _hosts            : {},</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+  _hostOrder        : [],</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+  _tree             : null,</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+  _bundle           : null,</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+  init: function ()</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+  {</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+    var os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+                       .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+    os.addObserver(this, &quot;cookie-changed&quot;, false);</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+    os.addObserver(this, &quot;perm-changed&quot;, false);</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+    this._bundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+    this._tree = document.getElementById(&quot;cookiesList&quot;);</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+    this._populateList(true);</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+    document.getElementById(&quot;filter&quot;).focus();</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+  },</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+  uninit: function ()</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+  {</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+    var os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+                       .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+    os.removeObserver(this, &quot;cookie-changed&quot;);</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+    os.removeObserver(this, &quot;perm-changed&quot;);</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+  },</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+  _populateList: function (aInitialLoad)</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+  {</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+    this._loadCookies();</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+    this._tree.treeBoxObject.view = this._view;</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+    if (aInitialLoad)</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+      this.sort(&quot;rawHost&quot;);</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+    if (this._view.rowCount &gt; 0)</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+      this._tree.view.selection.select(0);</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+    if (aInitialLoad) {</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+      if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0] &amp;&amp;</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+          window.arguments[0].filterString)</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+      {</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineplus">+        this.setFilter(window.arguments[0].filterString);</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+      }</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+    }</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+    else {</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+      if (document.getElementById(&quot;filter&quot;).value != &quot;&quot;)</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+        this.filter();</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+    }</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+    this._saveState();</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+  },</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+  _cookieEquals: function (aCookieA, aCookieB, aStrippedHost)</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+  {</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+    return aCookieA.rawHost == aStrippedHost &amp;&amp;</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineplus">+           aCookieA.name == aCookieB.name &amp;&amp;</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+           aCookieA.path == aCookieB.path;</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+  },</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineplus">+</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineplus">+  observe: function (aCookie, aTopic, aData)</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineplus">+  {</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineplus">+    if (aTopic != &quot;cookie-changed&quot;)</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+      return;</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineplus">+</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineplus">+    if (aCookie instanceof Components.interfaces.nsICookie) {</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineplus">+      var strippedHost = this._makeStrippedHost(aCookie.host);</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+      if (aData == &quot;changed&quot;)</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+        this._handleCookieChanged(aCookie, strippedHost);</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+      else if (aData == &quot;added&quot;)</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+        this._handleCookieAdded(aCookie, strippedHost);</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineplus">+    }</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+    else if (aData == &quot;cleared&quot;) {</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineplus">+      this._hosts = {};</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineplus">+      this._hostOrder = [];</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineplus">+</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineplus">+      var oldRowCount = this._view._rowCount;</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineplus">+      this._view._rowCount = 0;</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineplus">+      this._tree.treeBoxObject.rowCountChanged(0, -oldRowCount);</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineplus">+      this._view.selection.clearSelection();</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineplus">+    }</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineplus">+    else if (aData == &quot;reload&quot;) {</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineplus">+      // first, clear any existing entries</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineplus">+      this.observe(aCookie, aTopic, &quot;cleared&quot;);</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineplus">+</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineplus">+      // then, reload the list</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineplus">+      this._populateList(false);</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineplus">+    }</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineplus">+</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineplus">+    // We don't yet handle aData == &quot;deleted&quot; - it's a less common case</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineplus">+    // and is rather complicated as selection tracking is difficult</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineplus">+  },</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineplus">+</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineplus">+  _handleCookieChanged: function (changedCookie, strippedHost)</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineplus">+  {</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineplus">+    var rowIndex = 0;</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineplus">+    var cookieItem = null;</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineplus">+    if (!this._view._filtered) {</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineplus">+      for (var i = 0; i &lt; this._hostOrder.length; ++i) { // (var host in this._hosts) {</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineplus">+        ++rowIndex;</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineplus">+        var hostItem = this._hosts[this._hostOrder[i]]; // var hostItem = this._hosts[host];</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineplus">+        if (this._hostOrder[i] == strippedHost) { // host == strippedHost) {</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineplus">+          // Host matches, look for the cookie within this Host collection</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineplus">+          // and update its data</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineplus">+          for (var j = 0; j &lt; hostItem.cookies.length; ++j) {</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineplus">+            ++rowIndex;</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineplus">+            var currCookie = hostItem.cookies[j];</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineplus">+            if (this._cookieEquals(currCookie, changedCookie, strippedHost)) {</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineplus">+              currCookie.value    = changedCookie.value;</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineplus">+              currCookie.isSecure = changedCookie.isSecure;</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineplus">+              currCookie.isDomain = changedCookie.isDomain;</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineplus">+              currCookie.expires  = changedCookie.expires;</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineplus">+              cookieItem = currCookie;</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineplus">+              break;</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineplus">+            }</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineplus">+          }</span>
<a href="#l1.166"></a><span id="l1.166" class="difflineplus">+        }</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineplus">+        else if (hostItem.open)</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineplus">+          rowIndex += hostItem.cookies.length;</span>
<a href="#l1.169"></a><span id="l1.169" class="difflineplus">+      }</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineplus">+    }</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineplus">+    else {</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineplus">+      // Just walk the filter list to find the item. It doesn't matter that</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineplus">+      // we don't update the main Host collection when we do this, because</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineplus">+      // when the filter is reset the Host collection is rebuilt anyway.</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineplus">+      for (rowIndex = 0; rowIndex &lt; this._view._filterSet.length; ++rowIndex) {</span>
<a href="#l1.176"></a><span id="l1.176" class="difflineplus">+        currCookie = this._view._filterSet[rowIndex];</span>
<a href="#l1.177"></a><span id="l1.177" class="difflineplus">+        if (this._cookieEquals(currCookie, changedCookie, strippedHost)) {</span>
<a href="#l1.178"></a><span id="l1.178" class="difflineplus">+          currCookie.value    = changedCookie.value;</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineplus">+          currCookie.isSecure = changedCookie.isSecure;</span>
<a href="#l1.180"></a><span id="l1.180" class="difflineplus">+          currCookie.isDomain = changedCookie.isDomain;</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineplus">+          currCookie.expires  = changedCookie.expires;</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineplus">+          cookieItem = currCookie;</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineplus">+          break;</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineplus">+        }</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineplus">+      }</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineplus">+    }</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineplus">+</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineplus">+    // Make sure the tree display is up to date...</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineplus">+    this._tree.treeBoxObject.invalidateRow(rowIndex);</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineplus">+    // ... and if the cookie is selected, update the displayed metadata too</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineplus">+    if (cookieItem != null &amp;&amp; this._view.selection.currentIndex == rowIndex)</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineplus">+      this._updateCookieData(cookieItem);</span>
<a href="#l1.193"></a><span id="l1.193" class="difflineplus">+  },</span>
<a href="#l1.194"></a><span id="l1.194" class="difflineplus">+</span>
<a href="#l1.195"></a><span id="l1.195" class="difflineplus">+  _handleCookieAdded: function (changedCookie, strippedHost)</span>
<a href="#l1.196"></a><span id="l1.196" class="difflineplus">+  {</span>
<a href="#l1.197"></a><span id="l1.197" class="difflineplus">+    var rowCountImpact = 0;</span>
<a href="#l1.198"></a><span id="l1.198" class="difflineplus">+    var addedHost = { value: 0 };</span>
<a href="#l1.199"></a><span id="l1.199" class="difflineplus">+    this._addCookie(strippedHost, changedCookie, addedHost);</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineplus">+    if (!this._view._filtered) {</span>
<a href="#l1.201"></a><span id="l1.201" class="difflineplus">+      // The Host collection for this cookie already exists, and it's not open,</span>
<a href="#l1.202"></a><span id="l1.202" class="difflineplus">+      // so don't increment the rowCountImpact becaues the user is not going to</span>
<a href="#l1.203"></a><span id="l1.203" class="difflineplus">+      // see the additional rows as they're hidden.</span>
<a href="#l1.204"></a><span id="l1.204" class="difflineplus">+      if (addedHost.value || this._hosts[strippedHost].open)</span>
<a href="#l1.205"></a><span id="l1.205" class="difflineplus">+        ++rowCountImpact;</span>
<a href="#l1.206"></a><span id="l1.206" class="difflineplus">+    }</span>
<a href="#l1.207"></a><span id="l1.207" class="difflineplus">+    else {</span>
<a href="#l1.208"></a><span id="l1.208" class="difflineplus">+      // We're in search mode, and the cookie being added matches</span>
<a href="#l1.209"></a><span id="l1.209" class="difflineplus">+      // the search condition, so add it to the list.</span>
<a href="#l1.210"></a><span id="l1.210" class="difflineplus">+      var c = this._makeCookieObject(strippedHost, changedCookie);</span>
<a href="#l1.211"></a><span id="l1.211" class="difflineplus">+      if (this._cookieMatchesFilter(c)) {</span>
<a href="#l1.212"></a><span id="l1.212" class="difflineplus">+        this._view._filterSet.push(this._makeCookieObject(strippedHost, changedCookie));</span>
<a href="#l1.213"></a><span id="l1.213" class="difflineplus">+        ++rowCountImpact;</span>
<a href="#l1.214"></a><span id="l1.214" class="difflineplus">+      }</span>
<a href="#l1.215"></a><span id="l1.215" class="difflineplus">+    }</span>
<a href="#l1.216"></a><span id="l1.216" class="difflineplus">+    // Now update the tree display at the end (we could/should re run the sort</span>
<a href="#l1.217"></a><span id="l1.217" class="difflineplus">+    // if any to get the position correct.)</span>
<a href="#l1.218"></a><span id="l1.218" class="difflineplus">+    var oldRowCount = this._rowCount;</span>
<a href="#l1.219"></a><span id="l1.219" class="difflineplus">+    this._view._rowCount += rowCountImpact;</span>
<a href="#l1.220"></a><span id="l1.220" class="difflineplus">+    this._tree.treeBoxObject.rowCountChanged(oldRowCount - 1, rowCountImpact);</span>
<a href="#l1.221"></a><span id="l1.221" class="difflineplus">+</span>
<a href="#l1.222"></a><span id="l1.222" class="difflineplus">+    document.getElementById(&quot;removeAllCookies&quot;).disabled = this._view._filtered;</span>
<a href="#l1.223"></a><span id="l1.223" class="difflineplus">+  },</span>
<a href="#l1.224"></a><span id="l1.224" class="difflineplus">+</span>
<a href="#l1.225"></a><span id="l1.225" class="difflineplus">+  _view: {</span>
<a href="#l1.226"></a><span id="l1.226" class="difflineplus">+    _filtered   : false,</span>
<a href="#l1.227"></a><span id="l1.227" class="difflineplus">+    _filterSet  : [],</span>
<a href="#l1.228"></a><span id="l1.228" class="difflineplus">+    _filterValue: &quot;&quot;,</span>
<a href="#l1.229"></a><span id="l1.229" class="difflineplus">+    _rowCount   : 0,</span>
<a href="#l1.230"></a><span id="l1.230" class="difflineplus">+    _cacheValid : 0,</span>
<a href="#l1.231"></a><span id="l1.231" class="difflineplus">+    _cacheItems : [],</span>
<a href="#l1.232"></a><span id="l1.232" class="difflineplus">+    get rowCount()</span>
<a href="#l1.233"></a><span id="l1.233" class="difflineplus">+    {</span>
<a href="#l1.234"></a><span id="l1.234" class="difflineplus">+      return this._rowCount;</span>
<a href="#l1.235"></a><span id="l1.235" class="difflineplus">+    },</span>
<a href="#l1.236"></a><span id="l1.236" class="difflineplus">+</span>
<a href="#l1.237"></a><span id="l1.237" class="difflineplus">+    _getItemAtIndex: function (aIndex)</span>
<a href="#l1.238"></a><span id="l1.238" class="difflineplus">+    {</span>
<a href="#l1.239"></a><span id="l1.239" class="difflineplus">+      if (this._filtered)</span>
<a href="#l1.240"></a><span id="l1.240" class="difflineplus">+        return this._filterSet[aIndex];</span>
<a href="#l1.241"></a><span id="l1.241" class="difflineplus">+</span>
<a href="#l1.242"></a><span id="l1.242" class="difflineplus">+      var start = 0;</span>
<a href="#l1.243"></a><span id="l1.243" class="difflineplus">+      var count = 0, hostIndex = 0;</span>
<a href="#l1.244"></a><span id="l1.244" class="difflineplus">+</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineplus">+      var cacheIndex = Math.min(this._cacheValid, aIndex);</span>
<a href="#l1.246"></a><span id="l1.246" class="difflineplus">+      if (cacheIndex &gt; 0) {</span>
<a href="#l1.247"></a><span id="l1.247" class="difflineplus">+        var cacheItem = this._cacheItems[cacheIndex];</span>
<a href="#l1.248"></a><span id="l1.248" class="difflineplus">+        start = cacheItem['start'];</span>
<a href="#l1.249"></a><span id="l1.249" class="difflineplus">+        count = hostIndex = cacheItem['count'];</span>
<a href="#l1.250"></a><span id="l1.250" class="difflineplus">+      }</span>
<a href="#l1.251"></a><span id="l1.251" class="difflineplus">+</span>
<a href="#l1.252"></a><span id="l1.252" class="difflineplus">+      for (var i = start; i &lt; gCookiesWindow._hostOrder.length; ++i) { // var host in gCookiesWindow._hosts) {</span>
<a href="#l1.253"></a><span id="l1.253" class="difflineplus">+        var currHost = gCookiesWindow._hosts[gCookiesWindow._hostOrder[i]]; // gCookiesWindow._hosts[host];</span>
<a href="#l1.254"></a><span id="l1.254" class="difflineplus">+        if (!currHost) continue;</span>
<a href="#l1.255"></a><span id="l1.255" class="difflineplus">+        if (count == aIndex)</span>
<a href="#l1.256"></a><span id="l1.256" class="difflineplus">+          return currHost;</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineplus">+        hostIndex = count;</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineplus">+</span>
<a href="#l1.259"></a><span id="l1.259" class="difflineplus">+        var cacheEntry = { 'start' : i, 'count' : count };</span>
<a href="#l1.260"></a><span id="l1.260" class="difflineplus">+        var cacheStart = count;</span>
<a href="#l1.261"></a><span id="l1.261" class="difflineplus">+</span>
<a href="#l1.262"></a><span id="l1.262" class="difflineplus">+        if (currHost.open) {</span>
<a href="#l1.263"></a><span id="l1.263" class="difflineplus">+          if (count &lt; aIndex &amp;&amp; aIndex &lt;= (count + currHost.cookies.length)) {</span>
<a href="#l1.264"></a><span id="l1.264" class="difflineplus">+            // We are looking for an entry within this host's children,</span>
<a href="#l1.265"></a><span id="l1.265" class="difflineplus">+            // enumerate them looking for the index.</span>
<a href="#l1.266"></a><span id="l1.266" class="difflineplus">+            ++count;</span>
<a href="#l1.267"></a><span id="l1.267" class="difflineplus">+            for (var i = 0; i &lt; currHost.cookies.length; ++i) {</span>
<a href="#l1.268"></a><span id="l1.268" class="difflineplus">+              if (count == aIndex) {</span>
<a href="#l1.269"></a><span id="l1.269" class="difflineplus">+                var cookie = currHost.cookies[i];</span>
<a href="#l1.270"></a><span id="l1.270" class="difflineplus">+                cookie.parentIndex = hostIndex;</span>
<a href="#l1.271"></a><span id="l1.271" class="difflineplus">+                return cookie;</span>
<a href="#l1.272"></a><span id="l1.272" class="difflineplus">+              }</span>
<a href="#l1.273"></a><span id="l1.273" class="difflineplus">+              ++count;</span>
<a href="#l1.274"></a><span id="l1.274" class="difflineplus">+            }</span>
<a href="#l1.275"></a><span id="l1.275" class="difflineplus">+          }</span>
<a href="#l1.276"></a><span id="l1.276" class="difflineplus">+          else {</span>
<a href="#l1.277"></a><span id="l1.277" class="difflineplus">+            // A host entry was open, but we weren't looking for an index</span>
<a href="#l1.278"></a><span id="l1.278" class="difflineplus">+            // within that host entry's children, so skip forward over the</span>
<a href="#l1.279"></a><span id="l1.279" class="difflineplus">+            // entry's children. We need to add one to increment for the</span>
<a href="#l1.280"></a><span id="l1.280" class="difflineplus">+            // host value too.</span>
<a href="#l1.281"></a><span id="l1.281" class="difflineplus">+            count += currHost.cookies.length + 1;</span>
<a href="#l1.282"></a><span id="l1.282" class="difflineplus">+          }</span>
<a href="#l1.283"></a><span id="l1.283" class="difflineplus">+        }</span>
<a href="#l1.284"></a><span id="l1.284" class="difflineplus">+        else</span>
<a href="#l1.285"></a><span id="l1.285" class="difflineplus">+          ++count;</span>
<a href="#l1.286"></a><span id="l1.286" class="difflineplus">+</span>
<a href="#l1.287"></a><span id="l1.287" class="difflineplus">+        for (var j = cacheStart; j &lt; count; j++)</span>
<a href="#l1.288"></a><span id="l1.288" class="difflineplus">+          this._cacheItems[j] = cacheEntry;</span>
<a href="#l1.289"></a><span id="l1.289" class="difflineplus">+        this._cacheValid = count - 1;</span>
<a href="#l1.290"></a><span id="l1.290" class="difflineplus">+      }</span>
<a href="#l1.291"></a><span id="l1.291" class="difflineplus">+      return null;</span>
<a href="#l1.292"></a><span id="l1.292" class="difflineplus">+    },</span>
<a href="#l1.293"></a><span id="l1.293" class="difflineplus">+</span>
<a href="#l1.294"></a><span id="l1.294" class="difflineplus">+    _removeItemAtIndex: function (aIndex, aCount)</span>
<a href="#l1.295"></a><span id="l1.295" class="difflineplus">+    {</span>
<a href="#l1.296"></a><span id="l1.296" class="difflineplus">+      var removeCount = aCount === undefined ? 1 : aCount;</span>
<a href="#l1.297"></a><span id="l1.297" class="difflineplus">+      if (this._filtered) {</span>
<a href="#l1.298"></a><span id="l1.298" class="difflineplus">+        // remove the cookies from the unfiltered set so that they</span>
<a href="#l1.299"></a><span id="l1.299" class="difflineplus">+        // don't reappear when the filter is changed. See bug 410863.</span>
<a href="#l1.300"></a><span id="l1.300" class="difflineplus">+        for (var i = aIndex; i &lt; aIndex + removeCount; ++i) {</span>
<a href="#l1.301"></a><span id="l1.301" class="difflineplus">+          var item = this._filterSet[i];</span>
<a href="#l1.302"></a><span id="l1.302" class="difflineplus">+          var parent = gCookiesWindow._hosts[item.rawHost];</span>
<a href="#l1.303"></a><span id="l1.303" class="difflineplus">+          for (var j = 0; j &lt; parent.cookies.length; ++j) {</span>
<a href="#l1.304"></a><span id="l1.304" class="difflineplus">+            if (item == parent.cookies[j]) {</span>
<a href="#l1.305"></a><span id="l1.305" class="difflineplus">+              parent.cookies.splice(j, 1);</span>
<a href="#l1.306"></a><span id="l1.306" class="difflineplus">+              break;</span>
<a href="#l1.307"></a><span id="l1.307" class="difflineplus">+            }</span>
<a href="#l1.308"></a><span id="l1.308" class="difflineplus">+          }</span>
<a href="#l1.309"></a><span id="l1.309" class="difflineplus">+        }</span>
<a href="#l1.310"></a><span id="l1.310" class="difflineplus">+        this._filterSet.splice(aIndex, removeCount);</span>
<a href="#l1.311"></a><span id="l1.311" class="difflineplus">+        return;</span>
<a href="#l1.312"></a><span id="l1.312" class="difflineplus">+      }</span>
<a href="#l1.313"></a><span id="l1.313" class="difflineplus">+</span>
<a href="#l1.314"></a><span id="l1.314" class="difflineplus">+      var item = this._getItemAtIndex(aIndex);</span>
<a href="#l1.315"></a><span id="l1.315" class="difflineplus">+      if (!item) return;</span>
<a href="#l1.316"></a><span id="l1.316" class="difflineplus">+      this._invalidateCache(aIndex - 1);</span>
<a href="#l1.317"></a><span id="l1.317" class="difflineplus">+      if (item.container)</span>
<a href="#l1.318"></a><span id="l1.318" class="difflineplus">+        gCookiesWindow._hosts[item.rawHost] = null;</span>
<a href="#l1.319"></a><span id="l1.319" class="difflineplus">+      else {</span>
<a href="#l1.320"></a><span id="l1.320" class="difflineplus">+        var parent = this._getItemAtIndex(item.parentIndex);</span>
<a href="#l1.321"></a><span id="l1.321" class="difflineplus">+        for (var i = 0; i &lt; parent.cookies.length; ++i) {</span>
<a href="#l1.322"></a><span id="l1.322" class="difflineplus">+          var cookie = parent.cookies[i];</span>
<a href="#l1.323"></a><span id="l1.323" class="difflineplus">+          if (item.rawHost == cookie.rawHost &amp;&amp;</span>
<a href="#l1.324"></a><span id="l1.324" class="difflineplus">+              item.name == cookie.name &amp;&amp; item.path == cookie.path)</span>
<a href="#l1.325"></a><span id="l1.325" class="difflineplus">+            parent.cookies.splice(i, removeCount);</span>
<a href="#l1.326"></a><span id="l1.326" class="difflineplus">+        }</span>
<a href="#l1.327"></a><span id="l1.327" class="difflineplus">+      }</span>
<a href="#l1.328"></a><span id="l1.328" class="difflineplus">+    },</span>
<a href="#l1.329"></a><span id="l1.329" class="difflineplus">+</span>
<a href="#l1.330"></a><span id="l1.330" class="difflineplus">+    _invalidateCache: function (aIndex)</span>
<a href="#l1.331"></a><span id="l1.331" class="difflineplus">+    {</span>
<a href="#l1.332"></a><span id="l1.332" class="difflineplus">+      this._cacheValid = Math.min(this._cacheValid, aIndex);</span>
<a href="#l1.333"></a><span id="l1.333" class="difflineplus">+    },</span>
<a href="#l1.334"></a><span id="l1.334" class="difflineplus">+</span>
<a href="#l1.335"></a><span id="l1.335" class="difflineplus">+    getCellText: function (aIndex, aColumn)</span>
<a href="#l1.336"></a><span id="l1.336" class="difflineplus">+    {</span>
<a href="#l1.337"></a><span id="l1.337" class="difflineplus">+      if (!this._filtered) {</span>
<a href="#l1.338"></a><span id="l1.338" class="difflineplus">+        var item = this._getItemAtIndex(aIndex);</span>
<a href="#l1.339"></a><span id="l1.339" class="difflineplus">+        if (!item)</span>
<a href="#l1.340"></a><span id="l1.340" class="difflineplus">+          return &quot;&quot;;</span>
<a href="#l1.341"></a><span id="l1.341" class="difflineplus">+        if (aColumn.id == &quot;domainCol&quot;)</span>
<a href="#l1.342"></a><span id="l1.342" class="difflineplus">+          return item.rawHost;</span>
<a href="#l1.343"></a><span id="l1.343" class="difflineplus">+        else if (aColumn.id == &quot;nameCol&quot;)</span>
<a href="#l1.344"></a><span id="l1.344" class="difflineplus">+          return item.name;</span>
<a href="#l1.345"></a><span id="l1.345" class="difflineplus">+      }</span>
<a href="#l1.346"></a><span id="l1.346" class="difflineplus">+      else {</span>
<a href="#l1.347"></a><span id="l1.347" class="difflineplus">+        if (aColumn.id == &quot;domainCol&quot;)</span>
<a href="#l1.348"></a><span id="l1.348" class="difflineplus">+          return this._filterSet[aIndex].rawHost;</span>
<a href="#l1.349"></a><span id="l1.349" class="difflineplus">+        else if (aColumn.id == &quot;nameCol&quot;)</span>
<a href="#l1.350"></a><span id="l1.350" class="difflineplus">+          return this._filterSet[aIndex].name;</span>
<a href="#l1.351"></a><span id="l1.351" class="difflineplus">+      }</span>
<a href="#l1.352"></a><span id="l1.352" class="difflineplus">+      return &quot;&quot;;</span>
<a href="#l1.353"></a><span id="l1.353" class="difflineplus">+    },</span>
<a href="#l1.354"></a><span id="l1.354" class="difflineplus">+</span>
<a href="#l1.355"></a><span id="l1.355" class="difflineplus">+    _selection: null,</span>
<a href="#l1.356"></a><span id="l1.356" class="difflineplus">+    get selection () { return this._selection; },</span>
<a href="#l1.357"></a><span id="l1.357" class="difflineplus">+    set selection (val) { this._selection = val; return val; },</span>
<a href="#l1.358"></a><span id="l1.358" class="difflineplus">+    getRowProperties: function (aIndex, aProperties) {},</span>
<a href="#l1.359"></a><span id="l1.359" class="difflineplus">+    getCellProperties: function (aIndex, aColumn, aProperties) {},</span>
<a href="#l1.360"></a><span id="l1.360" class="difflineplus">+    getColumnProperties: function (aColumn, aProperties) {},</span>
<a href="#l1.361"></a><span id="l1.361" class="difflineplus">+    isContainer: function (aIndex)</span>
<a href="#l1.362"></a><span id="l1.362" class="difflineplus">+    {</span>
<a href="#l1.363"></a><span id="l1.363" class="difflineplus">+      if (!this._filtered) {</span>
<a href="#l1.364"></a><span id="l1.364" class="difflineplus">+        var item = this._getItemAtIndex(aIndex);</span>
<a href="#l1.365"></a><span id="l1.365" class="difflineplus">+        if (!item) return false;</span>
<a href="#l1.366"></a><span id="l1.366" class="difflineplus">+        return item.container;</span>
<a href="#l1.367"></a><span id="l1.367" class="difflineplus">+      }</span>
<a href="#l1.368"></a><span id="l1.368" class="difflineplus">+      return false;</span>
<a href="#l1.369"></a><span id="l1.369" class="difflineplus">+    },</span>
<a href="#l1.370"></a><span id="l1.370" class="difflineplus">+    isContainerOpen: function (aIndex)</span>
<a href="#l1.371"></a><span id="l1.371" class="difflineplus">+    {</span>
<a href="#l1.372"></a><span id="l1.372" class="difflineplus">+      if (!this._filtered) {</span>
<a href="#l1.373"></a><span id="l1.373" class="difflineplus">+        var item = this._getItemAtIndex(aIndex);</span>
<a href="#l1.374"></a><span id="l1.374" class="difflineplus">+        if (!item) return false;</span>
<a href="#l1.375"></a><span id="l1.375" class="difflineplus">+        return item.open;</span>
<a href="#l1.376"></a><span id="l1.376" class="difflineplus">+      }</span>
<a href="#l1.377"></a><span id="l1.377" class="difflineplus">+      return false;</span>
<a href="#l1.378"></a><span id="l1.378" class="difflineplus">+    },</span>
<a href="#l1.379"></a><span id="l1.379" class="difflineplus">+    isContainerEmpty: function (aIndex)</span>
<a href="#l1.380"></a><span id="l1.380" class="difflineplus">+    {</span>
<a href="#l1.381"></a><span id="l1.381" class="difflineplus">+      if (!this._filtered) {</span>
<a href="#l1.382"></a><span id="l1.382" class="difflineplus">+        var item = this._getItemAtIndex(aIndex);</span>
<a href="#l1.383"></a><span id="l1.383" class="difflineplus">+        if (!item) return false;</span>
<a href="#l1.384"></a><span id="l1.384" class="difflineplus">+        return item.cookies.length == 0;</span>
<a href="#l1.385"></a><span id="l1.385" class="difflineplus">+      }</span>
<a href="#l1.386"></a><span id="l1.386" class="difflineplus">+      return false;</span>
<a href="#l1.387"></a><span id="l1.387" class="difflineplus">+    },</span>
<a href="#l1.388"></a><span id="l1.388" class="difflineplus">+    isSeparator: function (aIndex) { return false; },</span>
<a href="#l1.389"></a><span id="l1.389" class="difflineplus">+    isSorted: function (aIndex) { return false; },</span>
<a href="#l1.390"></a><span id="l1.390" class="difflineplus">+    canDrop: function (aIndex, aOrientation) { return false; },</span>
<a href="#l1.391"></a><span id="l1.391" class="difflineplus">+    drop: function (aIndex, aOrientation) {},</span>
<a href="#l1.392"></a><span id="l1.392" class="difflineplus">+    getParentIndex: function (aIndex)</span>
<a href="#l1.393"></a><span id="l1.393" class="difflineplus">+    {</span>
<a href="#l1.394"></a><span id="l1.394" class="difflineplus">+      if (!this._filtered) {</span>
<a href="#l1.395"></a><span id="l1.395" class="difflineplus">+        var item = this._getItemAtIndex(aIndex);</span>
<a href="#l1.396"></a><span id="l1.396" class="difflineplus">+        // If an item has no parent index (i.e. it is at the top level) this</span>
<a href="#l1.397"></a><span id="l1.397" class="difflineplus">+        // function MUST return -1 otherwise we will go into an infinite loop.</span>
<a href="#l1.398"></a><span id="l1.398" class="difflineplus">+        // Containers are always top level items in the cookies tree, so make</span>
<a href="#l1.399"></a><span id="l1.399" class="difflineplus">+        // sure to return the appropriate value here.</span>
<a href="#l1.400"></a><span id="l1.400" class="difflineplus">+        if (!item || item.container) return -1;</span>
<a href="#l1.401"></a><span id="l1.401" class="difflineplus">+        return item.parentIndex;</span>
<a href="#l1.402"></a><span id="l1.402" class="difflineplus">+      }</span>
<a href="#l1.403"></a><span id="l1.403" class="difflineplus">+      return -1;</span>
<a href="#l1.404"></a><span id="l1.404" class="difflineplus">+    },</span>
<a href="#l1.405"></a><span id="l1.405" class="difflineplus">+    hasNextSibling: function (aParentIndex, aIndex)</span>
<a href="#l1.406"></a><span id="l1.406" class="difflineplus">+    {</span>
<a href="#l1.407"></a><span id="l1.407" class="difflineplus">+      if (!this._filtered) {</span>
<a href="#l1.408"></a><span id="l1.408" class="difflineplus">+        // |aParentIndex| appears to be bogus, but we can get the real</span>
<a href="#l1.409"></a><span id="l1.409" class="difflineplus">+        // parent index by getting the entry for |aIndex| and reading the</span>
<a href="#l1.410"></a><span id="l1.410" class="difflineplus">+        // parentIndex field.</span>
<a href="#l1.411"></a><span id="l1.411" class="difflineplus">+        // The index of the last item in this host collection is the</span>
<a href="#l1.412"></a><span id="l1.412" class="difflineplus">+        // index of the parent + the size of the host collection, and</span>
<a href="#l1.413"></a><span id="l1.413" class="difflineplus">+        // aIndex has a next sibling if it is less than this value.</span>
<a href="#l1.414"></a><span id="l1.414" class="difflineplus">+        var item = this._getItemAtIndex(aIndex);</span>
<a href="#l1.415"></a><span id="l1.415" class="difflineplus">+        if (item) {</span>
<a href="#l1.416"></a><span id="l1.416" class="difflineplus">+          if (item.container) {</span>
<a href="#l1.417"></a><span id="l1.417" class="difflineplus">+            for (var i = aIndex + 1; i &lt; this.rowCount; ++i) {</span>
<a href="#l1.418"></a><span id="l1.418" class="difflineplus">+              var subsequent = this._getItemAtIndex(i);</span>
<a href="#l1.419"></a><span id="l1.419" class="difflineplus">+              if (subsequent.container)</span>
<a href="#l1.420"></a><span id="l1.420" class="difflineplus">+                return true;</span>
<a href="#l1.421"></a><span id="l1.421" class="difflineplus">+            }</span>
<a href="#l1.422"></a><span id="l1.422" class="difflineplus">+            return false;</span>
<a href="#l1.423"></a><span id="l1.423" class="difflineplus">+          }</span>
<a href="#l1.424"></a><span id="l1.424" class="difflineplus">+          else {</span>
<a href="#l1.425"></a><span id="l1.425" class="difflineplus">+            var parent = this._getItemAtIndex(item.parentIndex);</span>
<a href="#l1.426"></a><span id="l1.426" class="difflineplus">+            if (parent &amp;&amp; parent.container)</span>
<a href="#l1.427"></a><span id="l1.427" class="difflineplus">+              return aIndex &lt; item.parentIndex + parent.cookies.length;</span>
<a href="#l1.428"></a><span id="l1.428" class="difflineplus">+          }</span>
<a href="#l1.429"></a><span id="l1.429" class="difflineplus">+        }</span>
<a href="#l1.430"></a><span id="l1.430" class="difflineplus">+      }</span>
<a href="#l1.431"></a><span id="l1.431" class="difflineplus">+      return aIndex &lt; this.rowCount - 1;</span>
<a href="#l1.432"></a><span id="l1.432" class="difflineplus">+    },</span>
<a href="#l1.433"></a><span id="l1.433" class="difflineplus">+    hasPreviousSibling: function (aIndex)</span>
<a href="#l1.434"></a><span id="l1.434" class="difflineplus">+    {</span>
<a href="#l1.435"></a><span id="l1.435" class="difflineplus">+      if (!this._filtered) {</span>
<a href="#l1.436"></a><span id="l1.436" class="difflineplus">+        var item = this._getItemAtIndex(aIndex);</span>
<a href="#l1.437"></a><span id="l1.437" class="difflineplus">+        if (!item) return false;</span>
<a href="#l1.438"></a><span id="l1.438" class="difflineplus">+        var parent = this._getItemAtIndex(item.parentIndex);</span>
<a href="#l1.439"></a><span id="l1.439" class="difflineplus">+        if (parent &amp;&amp; parent.container)</span>
<a href="#l1.440"></a><span id="l1.440" class="difflineplus">+          return aIndex &gt; item.parentIndex + 1;</span>
<a href="#l1.441"></a><span id="l1.441" class="difflineplus">+      }</span>
<a href="#l1.442"></a><span id="l1.442" class="difflineplus">+      return aIndex &gt; 0;</span>
<a href="#l1.443"></a><span id="l1.443" class="difflineplus">+    },</span>
<a href="#l1.444"></a><span id="l1.444" class="difflineplus">+    getLevel: function (aIndex)</span>
<a href="#l1.445"></a><span id="l1.445" class="difflineplus">+    {</span>
<a href="#l1.446"></a><span id="l1.446" class="difflineplus">+      if (!this._filtered) {</span>
<a href="#l1.447"></a><span id="l1.447" class="difflineplus">+        var item = this._getItemAtIndex(aIndex);</span>
<a href="#l1.448"></a><span id="l1.448" class="difflineplus">+        if (!item) return 0;</span>
<a href="#l1.449"></a><span id="l1.449" class="difflineplus">+        return item.level;</span>
<a href="#l1.450"></a><span id="l1.450" class="difflineplus">+      }</span>
<a href="#l1.451"></a><span id="l1.451" class="difflineplus">+      return 0;</span>
<a href="#l1.452"></a><span id="l1.452" class="difflineplus">+    },</span>
<a href="#l1.453"></a><span id="l1.453" class="difflineplus">+    getImageSrc: function (aIndex, aColumn) {},</span>
<a href="#l1.454"></a><span id="l1.454" class="difflineplus">+    getProgressMode: function (aIndex, aColumn) {},</span>
<a href="#l1.455"></a><span id="l1.455" class="difflineplus">+    getCellValue: function (aIndex, aColumn) {},</span>
<a href="#l1.456"></a><span id="l1.456" class="difflineplus">+    setTree: function (aTree) {},</span>
<a href="#l1.457"></a><span id="l1.457" class="difflineplus">+    toggleOpenState: function (aIndex)</span>
<a href="#l1.458"></a><span id="l1.458" class="difflineplus">+    {</span>
<a href="#l1.459"></a><span id="l1.459" class="difflineplus">+      if (!this._filtered) {</span>
<a href="#l1.460"></a><span id="l1.460" class="difflineplus">+        var item = this._getItemAtIndex(aIndex);</span>
<a href="#l1.461"></a><span id="l1.461" class="difflineplus">+        if (!item) return;</span>
<a href="#l1.462"></a><span id="l1.462" class="difflineplus">+        this._invalidateCache(aIndex);</span>
<a href="#l1.463"></a><span id="l1.463" class="difflineplus">+        var multiplier = item.open ? -1 : 1;</span>
<a href="#l1.464"></a><span id="l1.464" class="difflineplus">+        var delta = multiplier * item.cookies.length;</span>
<a href="#l1.465"></a><span id="l1.465" class="difflineplus">+        this._rowCount += delta;</span>
<a href="#l1.466"></a><span id="l1.466" class="difflineplus">+        item.open = !item.open;</span>
<a href="#l1.467"></a><span id="l1.467" class="difflineplus">+        gCookiesWindow._tree.treeBoxObject.rowCountChanged(aIndex + 1, delta);</span>
<a href="#l1.468"></a><span id="l1.468" class="difflineplus">+        gCookiesWindow._tree.treeBoxObject.invalidateRow(aIndex);</span>
<a href="#l1.469"></a><span id="l1.469" class="difflineplus">+      }</span>
<a href="#l1.470"></a><span id="l1.470" class="difflineplus">+    },</span>
<a href="#l1.471"></a><span id="l1.471" class="difflineplus">+    cycleHeader: function (aColumn) {},</span>
<a href="#l1.472"></a><span id="l1.472" class="difflineplus">+    selectionChanged: function () {},</span>
<a href="#l1.473"></a><span id="l1.473" class="difflineplus">+    cycleCell: function (aIndex, aColumn) {},</span>
<a href="#l1.474"></a><span id="l1.474" class="difflineplus">+    isEditable: function (aIndex, aColumn)</span>
<a href="#l1.475"></a><span id="l1.475" class="difflineplus">+    {</span>
<a href="#l1.476"></a><span id="l1.476" class="difflineplus">+      return false;</span>
<a href="#l1.477"></a><span id="l1.477" class="difflineplus">+    },</span>
<a href="#l1.478"></a><span id="l1.478" class="difflineplus">+    isSelectable: function (aIndex, aColumn)</span>
<a href="#l1.479"></a><span id="l1.479" class="difflineplus">+    {</span>
<a href="#l1.480"></a><span id="l1.480" class="difflineplus">+      return false;</span>
<a href="#l1.481"></a><span id="l1.481" class="difflineplus">+    },</span>
<a href="#l1.482"></a><span id="l1.482" class="difflineplus">+    setCellValue: function (aIndex, aColumn, aValue) {},</span>
<a href="#l1.483"></a><span id="l1.483" class="difflineplus">+    setCellText: function (aIndex, aColumn, aValue) {},</span>
<a href="#l1.484"></a><span id="l1.484" class="difflineplus">+    performAction: function (aAction) {},</span>
<a href="#l1.485"></a><span id="l1.485" class="difflineplus">+    performActionOnRow: function (aAction, aIndex) {},</span>
<a href="#l1.486"></a><span id="l1.486" class="difflineplus">+    performActionOnCell: function (aAction, aindex, aColumn) {}</span>
<a href="#l1.487"></a><span id="l1.487" class="difflineplus">+  },</span>
<a href="#l1.488"></a><span id="l1.488" class="difflineplus">+</span>
<a href="#l1.489"></a><span id="l1.489" class="difflineplus">+  _makeStrippedHost: function (aHost)</span>
<a href="#l1.490"></a><span id="l1.490" class="difflineplus">+  {</span>
<a href="#l1.491"></a><span id="l1.491" class="difflineplus">+    var formattedHost = aHost.charAt(0) == &quot;.&quot; ? aHost.substring(1, aHost.length) : aHost;</span>
<a href="#l1.492"></a><span id="l1.492" class="difflineplus">+    return formattedHost.substring(0, 4) == &quot;www.&quot; ? formattedHost.substring(4, formattedHost.length) : formattedHost;</span>
<a href="#l1.493"></a><span id="l1.493" class="difflineplus">+  },</span>
<a href="#l1.494"></a><span id="l1.494" class="difflineplus">+</span>
<a href="#l1.495"></a><span id="l1.495" class="difflineplus">+  _addCookie: function (aStrippedHost, aCookie, aHostCount)</span>
<a href="#l1.496"></a><span id="l1.496" class="difflineplus">+  {</span>
<a href="#l1.497"></a><span id="l1.497" class="difflineplus">+    if (!(aStrippedHost in this._hosts) || !this._hosts[aStrippedHost]) {</span>
<a href="#l1.498"></a><span id="l1.498" class="difflineplus">+      this._hosts[aStrippedHost] = { cookies   : [],</span>
<a href="#l1.499"></a><span id="l1.499" class="difflineplus">+                                     rawHost   : aStrippedHost,</span>
<a href="#l1.500"></a><span id="l1.500" class="difflineplus">+                                     level     : 0,</span>
<a href="#l1.501"></a><span id="l1.501" class="difflineplus">+                                     open      : false,</span>
<a href="#l1.502"></a><span id="l1.502" class="difflineplus">+                                     container : true };</span>
<a href="#l1.503"></a><span id="l1.503" class="difflineplus">+      this._hostOrder.push(aStrippedHost);</span>
<a href="#l1.504"></a><span id="l1.504" class="difflineplus">+      ++aHostCount.value;</span>
<a href="#l1.505"></a><span id="l1.505" class="difflineplus">+    }</span>
<a href="#l1.506"></a><span id="l1.506" class="difflineplus">+</span>
<a href="#l1.507"></a><span id="l1.507" class="difflineplus">+    var c = this._makeCookieObject(aStrippedHost, aCookie);</span>
<a href="#l1.508"></a><span id="l1.508" class="difflineplus">+    this._hosts[aStrippedHost].cookies.push(c);</span>
<a href="#l1.509"></a><span id="l1.509" class="difflineplus">+  },</span>
<a href="#l1.510"></a><span id="l1.510" class="difflineplus">+</span>
<a href="#l1.511"></a><span id="l1.511" class="difflineplus">+  _makeCookieObject: function (aStrippedHost, aCookie)</span>
<a href="#l1.512"></a><span id="l1.512" class="difflineplus">+  {</span>
<a href="#l1.513"></a><span id="l1.513" class="difflineplus">+    var host = aCookie.host;</span>
<a href="#l1.514"></a><span id="l1.514" class="difflineplus">+    var formattedHost = host.charAt(0) == &quot;.&quot; ? host.substring(1, host.length) : host;</span>
<a href="#l1.515"></a><span id="l1.515" class="difflineplus">+    var c = { name        : aCookie.name,</span>
<a href="#l1.516"></a><span id="l1.516" class="difflineplus">+              value       : aCookie.value,</span>
<a href="#l1.517"></a><span id="l1.517" class="difflineplus">+              isDomain    : aCookie.isDomain,</span>
<a href="#l1.518"></a><span id="l1.518" class="difflineplus">+              host        : aCookie.host,</span>
<a href="#l1.519"></a><span id="l1.519" class="difflineplus">+              rawHost     : aStrippedHost,</span>
<a href="#l1.520"></a><span id="l1.520" class="difflineplus">+              path        : aCookie.path,</span>
<a href="#l1.521"></a><span id="l1.521" class="difflineplus">+              isSecure    : aCookie.isSecure,</span>
<a href="#l1.522"></a><span id="l1.522" class="difflineplus">+              expires     : aCookie.expires,</span>
<a href="#l1.523"></a><span id="l1.523" class="difflineplus">+              level       : 1,</span>
<a href="#l1.524"></a><span id="l1.524" class="difflineplus">+              container   : false };</span>
<a href="#l1.525"></a><span id="l1.525" class="difflineplus">+    return c;</span>
<a href="#l1.526"></a><span id="l1.526" class="difflineplus">+  },</span>
<a href="#l1.527"></a><span id="l1.527" class="difflineplus">+</span>
<a href="#l1.528"></a><span id="l1.528" class="difflineplus">+  _loadCookies: function ()</span>
<a href="#l1.529"></a><span id="l1.529" class="difflineplus">+  {</span>
<a href="#l1.530"></a><span id="l1.530" class="difflineplus">+    var e = this._cm.enumerator;</span>
<a href="#l1.531"></a><span id="l1.531" class="difflineplus">+    var hostCount = { value: 0 };</span>
<a href="#l1.532"></a><span id="l1.532" class="difflineplus">+    this._hosts = {};</span>
<a href="#l1.533"></a><span id="l1.533" class="difflineplus">+    this._hostOrder = [];</span>
<a href="#l1.534"></a><span id="l1.534" class="difflineplus">+    while (e.hasMoreElements()) {</span>
<a href="#l1.535"></a><span id="l1.535" class="difflineplus">+      var cookie = e.getNext();</span>
<a href="#l1.536"></a><span id="l1.536" class="difflineplus">+      if (cookie &amp;&amp; cookie instanceof Components.interfaces.nsICookie) {</span>
<a href="#l1.537"></a><span id="l1.537" class="difflineplus">+        var strippedHost = this._makeStrippedHost(cookie.host);</span>
<a href="#l1.538"></a><span id="l1.538" class="difflineplus">+        this._addCookie(strippedHost, cookie, hostCount);</span>
<a href="#l1.539"></a><span id="l1.539" class="difflineplus">+      }</span>
<a href="#l1.540"></a><span id="l1.540" class="difflineplus">+      else</span>
<a href="#l1.541"></a><span id="l1.541" class="difflineplus">+        break;</span>
<a href="#l1.542"></a><span id="l1.542" class="difflineplus">+    }</span>
<a href="#l1.543"></a><span id="l1.543" class="difflineplus">+    this._view._rowCount = hostCount.value;</span>
<a href="#l1.544"></a><span id="l1.544" class="difflineplus">+  },</span>
<a href="#l1.545"></a><span id="l1.545" class="difflineplus">+</span>
<a href="#l1.546"></a><span id="l1.546" class="difflineplus">+  formatExpiresString: function (aExpires)</span>
<a href="#l1.547"></a><span id="l1.547" class="difflineplus">+  {</span>
<a href="#l1.548"></a><span id="l1.548" class="difflineplus">+    if (aExpires) {</span>
<a href="#l1.549"></a><span id="l1.549" class="difflineplus">+      var date = new Date(1000 * aExpires);</span>
<a href="#l1.550"></a><span id="l1.550" class="difflineplus">+      return this._ds.FormatDateTime(&quot;&quot;, this._ds.dateFormatLong,</span>
<a href="#l1.551"></a><span id="l1.551" class="difflineplus">+                                     this._ds.timeFormatSeconds,</span>
<a href="#l1.552"></a><span id="l1.552" class="difflineplus">+                                     date.getFullYear(),</span>
<a href="#l1.553"></a><span id="l1.553" class="difflineplus">+                                     date.getMonth() + 1,</span>
<a href="#l1.554"></a><span id="l1.554" class="difflineplus">+                                     date.getDate(),</span>
<a href="#l1.555"></a><span id="l1.555" class="difflineplus">+                                     date.getHours(),</span>
<a href="#l1.556"></a><span id="l1.556" class="difflineplus">+                                     date.getMinutes(),</span>
<a href="#l1.557"></a><span id="l1.557" class="difflineplus">+                                     date.getSeconds());</span>
<a href="#l1.558"></a><span id="l1.558" class="difflineplus">+    }</span>
<a href="#l1.559"></a><span id="l1.559" class="difflineplus">+    return this._bundle.getString(&quot;AtEndOfSession&quot;);</span>
<a href="#l1.560"></a><span id="l1.560" class="difflineplus">+  },</span>
<a href="#l1.561"></a><span id="l1.561" class="difflineplus">+</span>
<a href="#l1.562"></a><span id="l1.562" class="difflineplus">+  _updateCookieData: function (aItem)</span>
<a href="#l1.563"></a><span id="l1.563" class="difflineplus">+  {</span>
<a href="#l1.564"></a><span id="l1.564" class="difflineplus">+    var seln = this._view.selection;</span>
<a href="#l1.565"></a><span id="l1.565" class="difflineplus">+    var ids = [&quot;name&quot;, &quot;value&quot;, &quot;host&quot;, &quot;path&quot;, &quot;isSecure&quot;, &quot;expires&quot;];</span>
<a href="#l1.566"></a><span id="l1.566" class="difflineplus">+    var properties;</span>
<a href="#l1.567"></a><span id="l1.567" class="difflineplus">+</span>
<a href="#l1.568"></a><span id="l1.568" class="difflineplus">+    if (aItem &amp;&amp; !aItem.container &amp;&amp; seln.count &gt; 0) {</span>
<a href="#l1.569"></a><span id="l1.569" class="difflineplus">+      properties = { name: aItem.name, value: aItem.value, host: aItem.host,</span>
<a href="#l1.570"></a><span id="l1.570" class="difflineplus">+                     path: aItem.path, expires: this.formatExpiresString(aItem.expires),</span>
<a href="#l1.571"></a><span id="l1.571" class="difflineplus">+                     isDomain: aItem.isDomain ? this._bundle.getString(&quot;domainColon&quot;)</span>
<a href="#l1.572"></a><span id="l1.572" class="difflineplus">+                                              : this._bundle.getString(&quot;hostColon&quot;),</span>
<a href="#l1.573"></a><span id="l1.573" class="difflineplus">+                     isSecure: aItem.isSecure ? this._bundle.getString(&quot;forSecureOnly&quot;)</span>
<a href="#l1.574"></a><span id="l1.574" class="difflineplus">+                                              : this._bundle.getString(&quot;forAnyConnection&quot;) };</span>
<a href="#l1.575"></a><span id="l1.575" class="difflineplus">+      for (var i = 0; i &lt; ids.length; ++i)</span>
<a href="#l1.576"></a><span id="l1.576" class="difflineplus">+        document.getElementById(ids[i]).disabled = false;</span>
<a href="#l1.577"></a><span id="l1.577" class="difflineplus">+    }</span>
<a href="#l1.578"></a><span id="l1.578" class="difflineplus">+    else {</span>
<a href="#l1.579"></a><span id="l1.579" class="difflineplus">+      var noneSelected = this._bundle.getString(&quot;noCookieSelected&quot;);</span>
<a href="#l1.580"></a><span id="l1.580" class="difflineplus">+      properties = { name: noneSelected, value: noneSelected, host: noneSelected,</span>
<a href="#l1.581"></a><span id="l1.581" class="difflineplus">+                     path: noneSelected, expires: noneSelected,</span>
<a href="#l1.582"></a><span id="l1.582" class="difflineplus">+                     isSecure: noneSelected };</span>
<a href="#l1.583"></a><span id="l1.583" class="difflineplus">+      for (i = 0; i &lt; ids.length; ++i)</span>
<a href="#l1.584"></a><span id="l1.584" class="difflineplus">+        document.getElementById(ids[i]).disabled = true;</span>
<a href="#l1.585"></a><span id="l1.585" class="difflineplus">+    }</span>
<a href="#l1.586"></a><span id="l1.586" class="difflineplus">+    for (var property in properties)</span>
<a href="#l1.587"></a><span id="l1.587" class="difflineplus">+      document.getElementById(property).value = properties[property];</span>
<a href="#l1.588"></a><span id="l1.588" class="difflineplus">+  },</span>
<a href="#l1.589"></a><span id="l1.589" class="difflineplus">+</span>
<a href="#l1.590"></a><span id="l1.590" class="difflineplus">+  onCookieSelected: function ()</span>
<a href="#l1.591"></a><span id="l1.591" class="difflineplus">+  {</span>
<a href="#l1.592"></a><span id="l1.592" class="difflineplus">+    var properties, item;</span>
<a href="#l1.593"></a><span id="l1.593" class="difflineplus">+    var seln = this._tree.view.selection;</span>
<a href="#l1.594"></a><span id="l1.594" class="difflineplus">+    if (!this._view._filtered)</span>
<a href="#l1.595"></a><span id="l1.595" class="difflineplus">+      item = this._view._getItemAtIndex(seln.currentIndex);</span>
<a href="#l1.596"></a><span id="l1.596" class="difflineplus">+    else</span>
<a href="#l1.597"></a><span id="l1.597" class="difflineplus">+      item = this._view._filterSet[seln.currentIndex];</span>
<a href="#l1.598"></a><span id="l1.598" class="difflineplus">+</span>
<a href="#l1.599"></a><span id="l1.599" class="difflineplus">+    this._updateCookieData(item);</span>
<a href="#l1.600"></a><span id="l1.600" class="difflineplus">+</span>
<a href="#l1.601"></a><span id="l1.601" class="difflineplus">+    var rangeCount = seln.getRangeCount();</span>
<a href="#l1.602"></a><span id="l1.602" class="difflineplus">+    var selectedCookieCount = 0;</span>
<a href="#l1.603"></a><span id="l1.603" class="difflineplus">+    for (var i = 0; i &lt; rangeCount; ++i) {</span>
<a href="#l1.604"></a><span id="l1.604" class="difflineplus">+      var min = {}; var max = {};</span>
<a href="#l1.605"></a><span id="l1.605" class="difflineplus">+      seln.getRangeAt(i, min, max);</span>
<a href="#l1.606"></a><span id="l1.606" class="difflineplus">+      for (var j = min.value; j &lt;= max.value; ++j) {</span>
<a href="#l1.607"></a><span id="l1.607" class="difflineplus">+        item = this._view._getItemAtIndex(j);</span>
<a href="#l1.608"></a><span id="l1.608" class="difflineplus">+        if (!item) continue;</span>
<a href="#l1.609"></a><span id="l1.609" class="difflineplus">+        if (item.container &amp;&amp; !item.open)</span>
<a href="#l1.610"></a><span id="l1.610" class="difflineplus">+          selectedCookieCount += item.cookies.length;</span>
<a href="#l1.611"></a><span id="l1.611" class="difflineplus">+        else if (!item.container)</span>
<a href="#l1.612"></a><span id="l1.612" class="difflineplus">+          ++selectedCookieCount;</span>
<a href="#l1.613"></a><span id="l1.613" class="difflineplus">+      }</span>
<a href="#l1.614"></a><span id="l1.614" class="difflineplus">+    }</span>
<a href="#l1.615"></a><span id="l1.615" class="difflineplus">+    var item = this._view._getItemAtIndex(seln.currentIndex);</span>
<a href="#l1.616"></a><span id="l1.616" class="difflineplus">+    if (item &amp;&amp; seln.count == 1 &amp;&amp; item.container &amp;&amp; item.open)</span>
<a href="#l1.617"></a><span id="l1.617" class="difflineplus">+      selectedCookieCount += 2;</span>
<a href="#l1.618"></a><span id="l1.618" class="difflineplus">+</span>
<a href="#l1.619"></a><span id="l1.619" class="difflineplus">+    var stringKey = selectedCookieCount == 1 ? &quot;removeCookie&quot; : &quot;removeCookies&quot;;</span>
<a href="#l1.620"></a><span id="l1.620" class="difflineplus">+    document.getElementById(&quot;removeCookie&quot;).label = this._bundle.getString(stringKey);</span>
<a href="#l1.621"></a><span id="l1.621" class="difflineplus">+</span>
<a href="#l1.622"></a><span id="l1.622" class="difflineplus">+    document.getElementById(&quot;removeAllCookies&quot;).disabled = this._view._filtered;</span>
<a href="#l1.623"></a><span id="l1.623" class="difflineplus">+    document.getElementById(&quot;removeCookie&quot;).disabled = !(seln.count &gt; 0);</span>
<a href="#l1.624"></a><span id="l1.624" class="difflineplus">+  },</span>
<a href="#l1.625"></a><span id="l1.625" class="difflineplus">+</span>
<a href="#l1.626"></a><span id="l1.626" class="difflineplus">+  deleteCookie: function ()</span>
<a href="#l1.627"></a><span id="l1.627" class="difflineplus">+  {</span>
<a href="#l1.628"></a><span id="l1.628" class="difflineplus">+#   // Selection Notes</span>
<a href="#l1.629"></a><span id="l1.629" class="difflineplus">+#   // - Selection always moves to *NEXT* adjacent item unless item</span>
<a href="#l1.630"></a><span id="l1.630" class="difflineplus">+#   //   is last child at a given level in which case it moves to *PREVIOUS*</span>
<a href="#l1.631"></a><span id="l1.631" class="difflineplus">+#   //   item</span>
<a href="#l1.632"></a><span id="l1.632" class="difflineplus">+#   //</span>
<a href="#l1.633"></a><span id="l1.633" class="difflineplus">+#   // Selection Cases (Somewhat Complicated)</span>
<a href="#l1.634"></a><span id="l1.634" class="difflineplus">+#   //</span>
<a href="#l1.635"></a><span id="l1.635" class="difflineplus">+#   // 1) Single cookie selected, host has single child</span>
<a href="#l1.636"></a><span id="l1.636" class="difflineplus">+#   //    v cnn.com</span>
<a href="#l1.637"></a><span id="l1.637" class="difflineplus">+#   //    //// cnn.com ///////////// goksdjf@ ////</span>
<a href="#l1.638"></a><span id="l1.638" class="difflineplus">+#   //    &gt; atwola.com</span>
<a href="#l1.639"></a><span id="l1.639" class="difflineplus">+#   //</span>
<a href="#l1.640"></a><span id="l1.640" class="difflineplus">+#   //    Before SelectedIndex: 1   Before RowCount: 3</span>
<a href="#l1.641"></a><span id="l1.641" class="difflineplus">+#   //    After  SelectedIndex: 0   After  RowCount: 1</span>
<a href="#l1.642"></a><span id="l1.642" class="difflineplus">+#   //</span>
<a href="#l1.643"></a><span id="l1.643" class="difflineplus">+#   // 2) Host selected, host open</span>
<a href="#l1.644"></a><span id="l1.644" class="difflineplus">+#   //    v goats.com ////////////////////////////</span>
<a href="#l1.645"></a><span id="l1.645" class="difflineplus">+#   //         goats.com             sldkkfjl</span>
<a href="#l1.646"></a><span id="l1.646" class="difflineplus">+#   //         goat.scom             flksj133</span>
<a href="#l1.647"></a><span id="l1.647" class="difflineplus">+#   //    &gt; atwola.com</span>
<a href="#l1.648"></a><span id="l1.648" class="difflineplus">+#   //</span>
<a href="#l1.649"></a><span id="l1.649" class="difflineplus">+#   //    Before SelectedIndex: 0   Before RowCount: 4</span>
<a href="#l1.650"></a><span id="l1.650" class="difflineplus">+#   //    After  SelectedIndex: 0   After  RowCount: 1</span>
<a href="#l1.651"></a><span id="l1.651" class="difflineplus">+#   //</span>
<a href="#l1.652"></a><span id="l1.652" class="difflineplus">+#   // 3) Host selected, host closed</span>
<a href="#l1.653"></a><span id="l1.653" class="difflineplus">+#   //    &gt; goats.com ////////////////////////////</span>
<a href="#l1.654"></a><span id="l1.654" class="difflineplus">+#   //    &gt; atwola.com</span>
<a href="#l1.655"></a><span id="l1.655" class="difflineplus">+#   //</span>
<a href="#l1.656"></a><span id="l1.656" class="difflineplus">+#   //    Before SelectedIndex: 0   Before RowCount: 2</span>
<a href="#l1.657"></a><span id="l1.657" class="difflineplus">+#   //    After  SelectedIndex: 0   After  RowCount: 1</span>
<a href="#l1.658"></a><span id="l1.658" class="difflineplus">+#   //</span>
<a href="#l1.659"></a><span id="l1.659" class="difflineplus">+#   // 4) Single cookie selected, host has many children</span>
<a href="#l1.660"></a><span id="l1.660" class="difflineplus">+#   //    v goats.com</span>
<a href="#l1.661"></a><span id="l1.661" class="difflineplus">+#   //         goats.com             sldkkfjl</span>
<a href="#l1.662"></a><span id="l1.662" class="difflineplus">+#   //    //// goats.com /////////// flksjl33 ////</span>
<a href="#l1.663"></a><span id="l1.663" class="difflineplus">+#   //    &gt; atwola.com</span>
<a href="#l1.664"></a><span id="l1.664" class="difflineplus">+#   //</span>
<a href="#l1.665"></a><span id="l1.665" class="difflineplus">+#   //    Before SelectedIndex: 2   Before RowCount: 4</span>
<a href="#l1.666"></a><span id="l1.666" class="difflineplus">+#   //    After  SelectedIndex: 1   After  RowCount: 3</span>
<a href="#l1.667"></a><span id="l1.667" class="difflineplus">+#   //</span>
<a href="#l1.668"></a><span id="l1.668" class="difflineplus">+#   // 5) Single cookie selected, host has many children</span>
<a href="#l1.669"></a><span id="l1.669" class="difflineplus">+#   //    v goats.com</span>
<a href="#l1.670"></a><span id="l1.670" class="difflineplus">+#   //    //// goats.com /////////// flksjl33 ////</span>
<a href="#l1.671"></a><span id="l1.671" class="difflineplus">+#   //         goats.com             sldkkfjl</span>
<a href="#l1.672"></a><span id="l1.672" class="difflineplus">+#   //    &gt; atwola.com</span>
<a href="#l1.673"></a><span id="l1.673" class="difflineplus">+#   //</span>
<a href="#l1.674"></a><span id="l1.674" class="difflineplus">+#   //    Before SelectedIndex: 1   Before RowCount: 4</span>
<a href="#l1.675"></a><span id="l1.675" class="difflineplus">+#   //    After  SelectedIndex: 1   After  RowCount: 3</span>
<a href="#l1.676"></a><span id="l1.676" class="difflineplus">+    var seln = this._view.selection;</span>
<a href="#l1.677"></a><span id="l1.677" class="difflineplus">+    var tbo = this._tree.treeBoxObject;</span>
<a href="#l1.678"></a><span id="l1.678" class="difflineplus">+</span>
<a href="#l1.679"></a><span id="l1.679" class="difflineplus">+    if (seln.count &lt; 1) return;</span>
<a href="#l1.680"></a><span id="l1.680" class="difflineplus">+</span>
<a href="#l1.681"></a><span id="l1.681" class="difflineplus">+    var nextSelected = 0;</span>
<a href="#l1.682"></a><span id="l1.682" class="difflineplus">+    var rowCountImpact = 0;</span>
<a href="#l1.683"></a><span id="l1.683" class="difflineplus">+    var deleteItems = [];</span>
<a href="#l1.684"></a><span id="l1.684" class="difflineplus">+    if (!this._view._filtered) {</span>
<a href="#l1.685"></a><span id="l1.685" class="difflineplus">+      var ci = seln.currentIndex;</span>
<a href="#l1.686"></a><span id="l1.686" class="difflineplus">+      nextSelected = ci;</span>
<a href="#l1.687"></a><span id="l1.687" class="difflineplus">+      var invalidateRow = -1;</span>
<a href="#l1.688"></a><span id="l1.688" class="difflineplus">+      var item = this._view._getItemAtIndex(ci);</span>
<a href="#l1.689"></a><span id="l1.689" class="difflineplus">+      if (item.container) {</span>
<a href="#l1.690"></a><span id="l1.690" class="difflineplus">+        rowCountImpact -= (item.open ? item.cookies.length : 0) + 1;</span>
<a href="#l1.691"></a><span id="l1.691" class="difflineplus">+        deleteItems = deleteItems.concat(item.cookies);</span>
<a href="#l1.692"></a><span id="l1.692" class="difflineplus">+        if (!this._view.hasNextSibling(-1, ci))</span>
<a href="#l1.693"></a><span id="l1.693" class="difflineplus">+          --nextSelected;</span>
<a href="#l1.694"></a><span id="l1.694" class="difflineplus">+        this._view._removeItemAtIndex(ci);</span>
<a href="#l1.695"></a><span id="l1.695" class="difflineplus">+      }</span>
<a href="#l1.696"></a><span id="l1.696" class="difflineplus">+      else {</span>
<a href="#l1.697"></a><span id="l1.697" class="difflineplus">+        var parent = this._view._getItemAtIndex(item.parentIndex);</span>
<a href="#l1.698"></a><span id="l1.698" class="difflineplus">+        --rowCountImpact;</span>
<a href="#l1.699"></a><span id="l1.699" class="difflineplus">+        if (parent.cookies.length == 1) {</span>
<a href="#l1.700"></a><span id="l1.700" class="difflineplus">+          --rowCountImpact;</span>
<a href="#l1.701"></a><span id="l1.701" class="difflineplus">+          deleteItems.push(item);</span>
<a href="#l1.702"></a><span id="l1.702" class="difflineplus">+          if (!this._view.hasNextSibling(-1, ci))</span>
<a href="#l1.703"></a><span id="l1.703" class="difflineplus">+            --nextSelected;</span>
<a href="#l1.704"></a><span id="l1.704" class="difflineplus">+          if (!this._view.hasNextSibling(-1, item.parentIndex))</span>
<a href="#l1.705"></a><span id="l1.705" class="difflineplus">+            --nextSelected;</span>
<a href="#l1.706"></a><span id="l1.706" class="difflineplus">+          this._view._removeItemAtIndex(item.parentIndex);</span>
<a href="#l1.707"></a><span id="l1.707" class="difflineplus">+          invalidateRow = item.parentIndex;</span>
<a href="#l1.708"></a><span id="l1.708" class="difflineplus">+        }</span>
<a href="#l1.709"></a><span id="l1.709" class="difflineplus">+        else {</span>
<a href="#l1.710"></a><span id="l1.710" class="difflineplus">+          deleteItems.push(item);</span>
<a href="#l1.711"></a><span id="l1.711" class="difflineplus">+          if (!this._view.hasNextSibling(-1, ci))</span>
<a href="#l1.712"></a><span id="l1.712" class="difflineplus">+            --nextSelected;</span>
<a href="#l1.713"></a><span id="l1.713" class="difflineplus">+          this._view._removeItemAtIndex(ci);</span>
<a href="#l1.714"></a><span id="l1.714" class="difflineplus">+        }</span>
<a href="#l1.715"></a><span id="l1.715" class="difflineplus">+      }</span>
<a href="#l1.716"></a><span id="l1.716" class="difflineplus">+      this._view._rowCount += rowCountImpact;</span>
<a href="#l1.717"></a><span id="l1.717" class="difflineplus">+      tbo.rowCountChanged(ci, rowCountImpact);</span>
<a href="#l1.718"></a><span id="l1.718" class="difflineplus">+      if (invalidateRow != -1)</span>
<a href="#l1.719"></a><span id="l1.719" class="difflineplus">+        tbo.invalidateRow(invalidateRow);</span>
<a href="#l1.720"></a><span id="l1.720" class="difflineplus">+    }</span>
<a href="#l1.721"></a><span id="l1.721" class="difflineplus">+    else {</span>
<a href="#l1.722"></a><span id="l1.722" class="difflineplus">+      var rangeCount = seln.getRangeCount();</span>
<a href="#l1.723"></a><span id="l1.723" class="difflineplus">+      for (var i = 0; i &lt; rangeCount; ++i) {</span>
<a href="#l1.724"></a><span id="l1.724" class="difflineplus">+        var min = {}; var max = {};</span>
<a href="#l1.725"></a><span id="l1.725" class="difflineplus">+        seln.getRangeAt(i, min, max);</span>
<a href="#l1.726"></a><span id="l1.726" class="difflineplus">+        nextSelected = min.value;</span>
<a href="#l1.727"></a><span id="l1.727" class="difflineplus">+        for (var j = min.value; j &lt;= max.value; ++j) {</span>
<a href="#l1.728"></a><span id="l1.728" class="difflineplus">+          deleteItems.push(this._view._getItemAtIndex(j));</span>
<a href="#l1.729"></a><span id="l1.729" class="difflineplus">+          if (!this._view.hasNextSibling(-1, max.value))</span>
<a href="#l1.730"></a><span id="l1.730" class="difflineplus">+            --nextSelected;</span>
<a href="#l1.731"></a><span id="l1.731" class="difflineplus">+        }</span>
<a href="#l1.732"></a><span id="l1.732" class="difflineplus">+        var delta = max.value - min.value + 1;</span>
<a href="#l1.733"></a><span id="l1.733" class="difflineplus">+        this._view._removeItemAtIndex(min.value, delta);</span>
<a href="#l1.734"></a><span id="l1.734" class="difflineplus">+        rowCountImpact = -1 * delta;</span>
<a href="#l1.735"></a><span id="l1.735" class="difflineplus">+        this._view._rowCount += rowCountImpact;</span>
<a href="#l1.736"></a><span id="l1.736" class="difflineplus">+        tbo.rowCountChanged(min.value, rowCountImpact);</span>
<a href="#l1.737"></a><span id="l1.737" class="difflineplus">+      }</span>
<a href="#l1.738"></a><span id="l1.738" class="difflineplus">+    }</span>
<a href="#l1.739"></a><span id="l1.739" class="difflineplus">+</span>
<a href="#l1.740"></a><span id="l1.740" class="difflineplus">+    var psvc = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l1.741"></a><span id="l1.741" class="difflineplus">+                         .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l1.742"></a><span id="l1.742" class="difflineplus">+    var blockFutureCookies = false;</span>
<a href="#l1.743"></a><span id="l1.743" class="difflineplus">+    if (psvc.prefHasUserValue(&quot;network.cookie.blockFutureCookies&quot;))</span>
<a href="#l1.744"></a><span id="l1.744" class="difflineplus">+      blockFutureCookies = psvc.getBoolPref(&quot;network.cookie.blockFutureCookies&quot;);</span>
<a href="#l1.745"></a><span id="l1.745" class="difflineplus">+    for (i = 0; i &lt; deleteItems.length; ++i) {</span>
<a href="#l1.746"></a><span id="l1.746" class="difflineplus">+      var item = deleteItems[i];</span>
<a href="#l1.747"></a><span id="l1.747" class="difflineplus">+      this._cm.remove(item.host, item.name, item.path, blockFutureCookies);</span>
<a href="#l1.748"></a><span id="l1.748" class="difflineplus">+    }</span>
<a href="#l1.749"></a><span id="l1.749" class="difflineplus">+</span>
<a href="#l1.750"></a><span id="l1.750" class="difflineplus">+    if (nextSelected &lt; 0)</span>
<a href="#l1.751"></a><span id="l1.751" class="difflineplus">+      seln.clearSelection();</span>
<a href="#l1.752"></a><span id="l1.752" class="difflineplus">+    else {</span>
<a href="#l1.753"></a><span id="l1.753" class="difflineplus">+      seln.select(nextSelected);</span>
<a href="#l1.754"></a><span id="l1.754" class="difflineplus">+      this._tree.focus();</span>
<a href="#l1.755"></a><span id="l1.755" class="difflineplus">+    }</span>
<a href="#l1.756"></a><span id="l1.756" class="difflineplus">+  },</span>
<a href="#l1.757"></a><span id="l1.757" class="difflineplus">+</span>
<a href="#l1.758"></a><span id="l1.758" class="difflineplus">+  deleteAllCookies: function ()</span>
<a href="#l1.759"></a><span id="l1.759" class="difflineplus">+  {</span>
<a href="#l1.760"></a><span id="l1.760" class="difflineplus">+    this._cm.removeAll();</span>
<a href="#l1.761"></a><span id="l1.761" class="difflineplus">+    this._tree.focus();</span>
<a href="#l1.762"></a><span id="l1.762" class="difflineplus">+  },</span>
<a href="#l1.763"></a><span id="l1.763" class="difflineplus">+</span>
<a href="#l1.764"></a><span id="l1.764" class="difflineplus">+  onCookieKeyPress: function (aEvent)</span>
<a href="#l1.765"></a><span id="l1.765" class="difflineplus">+  {</span>
<a href="#l1.766"></a><span id="l1.766" class="difflineplus">+    if (aEvent.keyCode == 46)</span>
<a href="#l1.767"></a><span id="l1.767" class="difflineplus">+      this.deleteCookie();</span>
<a href="#l1.768"></a><span id="l1.768" class="difflineplus">+  },</span>
<a href="#l1.769"></a><span id="l1.769" class="difflineplus">+</span>
<a href="#l1.770"></a><span id="l1.770" class="difflineplus">+  _lastSortProperty : &quot;&quot;,</span>
<a href="#l1.771"></a><span id="l1.771" class="difflineplus">+  _lastSortAscending: false,</span>
<a href="#l1.772"></a><span id="l1.772" class="difflineplus">+  sort: function (aProperty)</span>
<a href="#l1.773"></a><span id="l1.773" class="difflineplus">+  {</span>
<a href="#l1.774"></a><span id="l1.774" class="difflineplus">+    var ascending = (aProperty == this._lastSortProperty) ? !this._lastSortAscending : true;</span>
<a href="#l1.775"></a><span id="l1.775" class="difflineplus">+    // Sort the Non-Filtered Host Collections</span>
<a href="#l1.776"></a><span id="l1.776" class="difflineplus">+    if (aProperty == &quot;rawHost&quot;) {</span>
<a href="#l1.777"></a><span id="l1.777" class="difflineplus">+      function sortByHost(a, b)</span>
<a href="#l1.778"></a><span id="l1.778" class="difflineplus">+      {</span>
<a href="#l1.779"></a><span id="l1.779" class="difflineplus">+        return a.toLowerCase().localeCompare(b.toLowerCase());</span>
<a href="#l1.780"></a><span id="l1.780" class="difflineplus">+      }</span>
<a href="#l1.781"></a><span id="l1.781" class="difflineplus">+      this._hostOrder.sort(sortByHost);</span>
<a href="#l1.782"></a><span id="l1.782" class="difflineplus">+      if (!ascending)</span>
<a href="#l1.783"></a><span id="l1.783" class="difflineplus">+        this._hostOrder.reverse();</span>
<a href="#l1.784"></a><span id="l1.784" class="difflineplus">+    }</span>
<a href="#l1.785"></a><span id="l1.785" class="difflineplus">+</span>
<a href="#l1.786"></a><span id="l1.786" class="difflineplus">+    function sortByProperty(a, b)</span>
<a href="#l1.787"></a><span id="l1.787" class="difflineplus">+    {</span>
<a href="#l1.788"></a><span id="l1.788" class="difflineplus">+      return a[aProperty].toLowerCase().localeCompare(b[aProperty].toLowerCase());</span>
<a href="#l1.789"></a><span id="l1.789" class="difflineplus">+    }</span>
<a href="#l1.790"></a><span id="l1.790" class="difflineplus">+    for (var host in this._hosts) {</span>
<a href="#l1.791"></a><span id="l1.791" class="difflineplus">+      var cookies = this._hosts[host].cookies;</span>
<a href="#l1.792"></a><span id="l1.792" class="difflineplus">+      cookies.sort(sortByProperty);</span>
<a href="#l1.793"></a><span id="l1.793" class="difflineplus">+      if (!ascending)</span>
<a href="#l1.794"></a><span id="l1.794" class="difflineplus">+        cookies.reverse();</span>
<a href="#l1.795"></a><span id="l1.795" class="difflineplus">+    }</span>
<a href="#l1.796"></a><span id="l1.796" class="difflineplus">+    // Sort the Filtered List, if in Filtered mode</span>
<a href="#l1.797"></a><span id="l1.797" class="difflineplus">+    if (this._view._filtered) {</span>
<a href="#l1.798"></a><span id="l1.798" class="difflineplus">+      this._view._filterSet.sort(sortByProperty);</span>
<a href="#l1.799"></a><span id="l1.799" class="difflineplus">+      if (!ascending)</span>
<a href="#l1.800"></a><span id="l1.800" class="difflineplus">+        this._view._filterSet.reverse();</span>
<a href="#l1.801"></a><span id="l1.801" class="difflineplus">+    }</span>
<a href="#l1.802"></a><span id="l1.802" class="difflineplus">+</span>
<a href="#l1.803"></a><span id="l1.803" class="difflineplus">+    this._view._invalidateCache(0);</span>
<a href="#l1.804"></a><span id="l1.804" class="difflineplus">+    this._view.selection.clearSelection();</span>
<a href="#l1.805"></a><span id="l1.805" class="difflineplus">+    this._view.selection.select(0);</span>
<a href="#l1.806"></a><span id="l1.806" class="difflineplus">+    this._tree.treeBoxObject.invalidate();</span>
<a href="#l1.807"></a><span id="l1.807" class="difflineplus">+    this._tree.treeBoxObject.ensureRowIsVisible(0);</span>
<a href="#l1.808"></a><span id="l1.808" class="difflineplus">+</span>
<a href="#l1.809"></a><span id="l1.809" class="difflineplus">+    this._lastSortAscending = ascending;</span>
<a href="#l1.810"></a><span id="l1.810" class="difflineplus">+    this._lastSortProperty = aProperty;</span>
<a href="#l1.811"></a><span id="l1.811" class="difflineplus">+  },</span>
<a href="#l1.812"></a><span id="l1.812" class="difflineplus">+</span>
<a href="#l1.813"></a><span id="l1.813" class="difflineplus">+  clearFilter: function ()</span>
<a href="#l1.814"></a><span id="l1.814" class="difflineplus">+  {</span>
<a href="#l1.815"></a><span id="l1.815" class="difflineplus">+    // Revert to single-select in the tree</span>
<a href="#l1.816"></a><span id="l1.816" class="difflineplus">+    this._tree.setAttribute(&quot;seltype&quot;, &quot;single&quot;);</span>
<a href="#l1.817"></a><span id="l1.817" class="difflineplus">+</span>
<a href="#l1.818"></a><span id="l1.818" class="difflineplus">+    // Clear the Tree Display</span>
<a href="#l1.819"></a><span id="l1.819" class="difflineplus">+    this._view._filtered = false;</span>
<a href="#l1.820"></a><span id="l1.820" class="difflineplus">+    this._view._rowCount = 0;</span>
<a href="#l1.821"></a><span id="l1.821" class="difflineplus">+    this._tree.treeBoxObject.rowCountChanged(0, -this._view._filterSet.length);</span>
<a href="#l1.822"></a><span id="l1.822" class="difflineplus">+    this._view._filterSet = [];</span>
<a href="#l1.823"></a><span id="l1.823" class="difflineplus">+</span>
<a href="#l1.824"></a><span id="l1.824" class="difflineplus">+    // Just reload the list to make sure deletions are respected</span>
<a href="#l1.825"></a><span id="l1.825" class="difflineplus">+    this._loadCookies();</span>
<a href="#l1.826"></a><span id="l1.826" class="difflineplus">+    this._tree.treeBoxObject.view = this._view;</span>
<a href="#l1.827"></a><span id="l1.827" class="difflineplus">+</span>
<a href="#l1.828"></a><span id="l1.828" class="difflineplus">+    // Restore sort order</span>
<a href="#l1.829"></a><span id="l1.829" class="difflineplus">+    var sortby = this._lastSortProperty;</span>
<a href="#l1.830"></a><span id="l1.830" class="difflineplus">+    if (sortby == &quot;&quot;) {</span>
<a href="#l1.831"></a><span id="l1.831" class="difflineplus">+      this._lastSortAscending = false;</span>
<a href="#l1.832"></a><span id="l1.832" class="difflineplus">+      this.sort(&quot;rawHost&quot;);</span>
<a href="#l1.833"></a><span id="l1.833" class="difflineplus">+    }</span>
<a href="#l1.834"></a><span id="l1.834" class="difflineplus">+    else {</span>
<a href="#l1.835"></a><span id="l1.835" class="difflineplus">+      this._lastSortAscending = !this._lastSortAscending;</span>
<a href="#l1.836"></a><span id="l1.836" class="difflineplus">+      this.sort(sortby);</span>
<a href="#l1.837"></a><span id="l1.837" class="difflineplus">+    }</span>
<a href="#l1.838"></a><span id="l1.838" class="difflineplus">+</span>
<a href="#l1.839"></a><span id="l1.839" class="difflineplus">+    // Restore open state</span>
<a href="#l1.840"></a><span id="l1.840" class="difflineplus">+    for (var i = 0; i &lt; this._openIndices.length; ++i)</span>
<a href="#l1.841"></a><span id="l1.841" class="difflineplus">+      this._view.toggleOpenState(this._openIndices[i]);</span>
<a href="#l1.842"></a><span id="l1.842" class="difflineplus">+    this._openIndices = [];</span>
<a href="#l1.843"></a><span id="l1.843" class="difflineplus">+</span>
<a href="#l1.844"></a><span id="l1.844" class="difflineplus">+    // Restore selection</span>
<a href="#l1.845"></a><span id="l1.845" class="difflineplus">+    this._view.selection.clearSelection();</span>
<a href="#l1.846"></a><span id="l1.846" class="difflineplus">+    for (i = 0; i &lt; this._lastSelectedRanges.length; ++i) {</span>
<a href="#l1.847"></a><span id="l1.847" class="difflineplus">+      var range = this._lastSelectedRanges[i];</span>
<a href="#l1.848"></a><span id="l1.848" class="difflineplus">+      this._view.selection.rangedSelect(range.min, range.max, true);</span>
<a href="#l1.849"></a><span id="l1.849" class="difflineplus">+    }</span>
<a href="#l1.850"></a><span id="l1.850" class="difflineplus">+    this._lastSelectedRanges = [];</span>
<a href="#l1.851"></a><span id="l1.851" class="difflineplus">+</span>
<a href="#l1.852"></a><span id="l1.852" class="difflineplus">+    document.getElementById(&quot;cookiesIntro&quot;).value = this._bundle.getString(&quot;cookiesAll&quot;);</span>
<a href="#l1.853"></a><span id="l1.853" class="difflineplus">+  },</span>
<a href="#l1.854"></a><span id="l1.854" class="difflineplus">+</span>
<a href="#l1.855"></a><span id="l1.855" class="difflineplus">+  _cookieMatchesFilter: function (aCookie)</span>
<a href="#l1.856"></a><span id="l1.856" class="difflineplus">+  {</span>
<a href="#l1.857"></a><span id="l1.857" class="difflineplus">+    return aCookie.rawHost.indexOf(this._view._filterValue) != -1 ||</span>
<a href="#l1.858"></a><span id="l1.858" class="difflineplus">+           aCookie.name.indexOf(this._view._filterValue) != -1 ||</span>
<a href="#l1.859"></a><span id="l1.859" class="difflineplus">+           aCookie.value.indexOf(this._view._filterValue) != -1;</span>
<a href="#l1.860"></a><span id="l1.860" class="difflineplus">+  },</span>
<a href="#l1.861"></a><span id="l1.861" class="difflineplus">+</span>
<a href="#l1.862"></a><span id="l1.862" class="difflineplus">+  _filterCookies: function (aFilterValue)</span>
<a href="#l1.863"></a><span id="l1.863" class="difflineplus">+  {</span>
<a href="#l1.864"></a><span id="l1.864" class="difflineplus">+    this._view._filterValue = aFilterValue;</span>
<a href="#l1.865"></a><span id="l1.865" class="difflineplus">+    var cookies = [];</span>
<a href="#l1.866"></a><span id="l1.866" class="difflineplus">+    for (var i = 0; i &lt; gCookiesWindow._hostOrder.length; ++i) { //var host in gCookiesWindow._hosts) {</span>
<a href="#l1.867"></a><span id="l1.867" class="difflineplus">+      var currHost = gCookiesWindow._hosts[gCookiesWindow._hostOrder[i]]; // gCookiesWindow._hosts[host];</span>
<a href="#l1.868"></a><span id="l1.868" class="difflineplus">+      if (!currHost) continue;</span>
<a href="#l1.869"></a><span id="l1.869" class="difflineplus">+      for (var j = 0; j &lt; currHost.cookies.length; ++j) {</span>
<a href="#l1.870"></a><span id="l1.870" class="difflineplus">+        var cookie = currHost.cookies[j];</span>
<a href="#l1.871"></a><span id="l1.871" class="difflineplus">+        if (this._cookieMatchesFilter(cookie))</span>
<a href="#l1.872"></a><span id="l1.872" class="difflineplus">+          cookies.push(cookie);</span>
<a href="#l1.873"></a><span id="l1.873" class="difflineplus">+      }</span>
<a href="#l1.874"></a><span id="l1.874" class="difflineplus">+    }</span>
<a href="#l1.875"></a><span id="l1.875" class="difflineplus">+    return cookies;</span>
<a href="#l1.876"></a><span id="l1.876" class="difflineplus">+  },</span>
<a href="#l1.877"></a><span id="l1.877" class="difflineplus">+</span>
<a href="#l1.878"></a><span id="l1.878" class="difflineplus">+  _lastSelectedRanges: [],</span>
<a href="#l1.879"></a><span id="l1.879" class="difflineplus">+  _openIndices: [],</span>
<a href="#l1.880"></a><span id="l1.880" class="difflineplus">+  _saveState: function ()</span>
<a href="#l1.881"></a><span id="l1.881" class="difflineplus">+  {</span>
<a href="#l1.882"></a><span id="l1.882" class="difflineplus">+    // Save selection</span>
<a href="#l1.883"></a><span id="l1.883" class="difflineplus">+    var seln = this._view.selection;</span>
<a href="#l1.884"></a><span id="l1.884" class="difflineplus">+    this._lastSelectedRanges = [];</span>
<a href="#l1.885"></a><span id="l1.885" class="difflineplus">+    var rangeCount = seln.getRangeCount();</span>
<a href="#l1.886"></a><span id="l1.886" class="difflineplus">+    for (var i = 0; i &lt; rangeCount; ++i) {</span>
<a href="#l1.887"></a><span id="l1.887" class="difflineplus">+      var min = {}; var max = {};</span>
<a href="#l1.888"></a><span id="l1.888" class="difflineplus">+      seln.getRangeAt(i, min, max);</span>
<a href="#l1.889"></a><span id="l1.889" class="difflineplus">+      this._lastSelectedRanges.push({ min: min.value, max: max.value });</span>
<a href="#l1.890"></a><span id="l1.890" class="difflineplus">+    }</span>
<a href="#l1.891"></a><span id="l1.891" class="difflineplus">+</span>
<a href="#l1.892"></a><span id="l1.892" class="difflineplus">+    // Save open states</span>
<a href="#l1.893"></a><span id="l1.893" class="difflineplus">+    this._openIndices = [];</span>
<a href="#l1.894"></a><span id="l1.894" class="difflineplus">+    for (i = 0; i &lt; this._view.rowCount; ++i) {</span>
<a href="#l1.895"></a><span id="l1.895" class="difflineplus">+      var item = this._view._getItemAtIndex(i);</span>
<a href="#l1.896"></a><span id="l1.896" class="difflineplus">+      if (item &amp;&amp; item.container &amp;&amp; item.open)</span>
<a href="#l1.897"></a><span id="l1.897" class="difflineplus">+        this._openIndices.push(i);</span>
<a href="#l1.898"></a><span id="l1.898" class="difflineplus">+    }</span>
<a href="#l1.899"></a><span id="l1.899" class="difflineplus">+  },</span>
<a href="#l1.900"></a><span id="l1.900" class="difflineplus">+</span>
<a href="#l1.901"></a><span id="l1.901" class="difflineplus">+  filter: function ()</span>
<a href="#l1.902"></a><span id="l1.902" class="difflineplus">+  {</span>
<a href="#l1.903"></a><span id="l1.903" class="difflineplus">+    var filter = document.getElementById(&quot;filter&quot;).value;</span>
<a href="#l1.904"></a><span id="l1.904" class="difflineplus">+    if (filter == &quot;&quot;) {</span>
<a href="#l1.905"></a><span id="l1.905" class="difflineplus">+      gCookiesWindow.clearFilter();</span>
<a href="#l1.906"></a><span id="l1.906" class="difflineplus">+      return;</span>
<a href="#l1.907"></a><span id="l1.907" class="difflineplus">+    }</span>
<a href="#l1.908"></a><span id="l1.908" class="difflineplus">+    var view = gCookiesWindow._view;</span>
<a href="#l1.909"></a><span id="l1.909" class="difflineplus">+    view._filterSet = gCookiesWindow._filterCookies(filter);</span>
<a href="#l1.910"></a><span id="l1.910" class="difflineplus">+    if (!view._filtered) {</span>
<a href="#l1.911"></a><span id="l1.911" class="difflineplus">+      // Save Display Info for the Non-Filtered mode when we first</span>
<a href="#l1.912"></a><span id="l1.912" class="difflineplus">+      // enter Filtered mode.</span>
<a href="#l1.913"></a><span id="l1.913" class="difflineplus">+      gCookiesWindow._saveState();</span>
<a href="#l1.914"></a><span id="l1.914" class="difflineplus">+      view._filtered = true;</span>
<a href="#l1.915"></a><span id="l1.915" class="difflineplus">+    }</span>
<a href="#l1.916"></a><span id="l1.916" class="difflineplus">+    // Move to multi-select in the tree</span>
<a href="#l1.917"></a><span id="l1.917" class="difflineplus">+    gCookiesWindow._tree.setAttribute(&quot;seltype&quot;, &quot;multiple&quot;);</span>
<a href="#l1.918"></a><span id="l1.918" class="difflineplus">+</span>
<a href="#l1.919"></a><span id="l1.919" class="difflineplus">+    // Clear the display</span>
<a href="#l1.920"></a><span id="l1.920" class="difflineplus">+    var oldCount = view._rowCount;</span>
<a href="#l1.921"></a><span id="l1.921" class="difflineplus">+    view._rowCount = 0;</span>
<a href="#l1.922"></a><span id="l1.922" class="difflineplus">+    gCookiesWindow._tree.treeBoxObject.rowCountChanged(0, -oldCount);</span>
<a href="#l1.923"></a><span id="l1.923" class="difflineplus">+    // Set up the filtered display</span>
<a href="#l1.924"></a><span id="l1.924" class="difflineplus">+    view._rowCount = view._filterSet.length;</span>
<a href="#l1.925"></a><span id="l1.925" class="difflineplus">+    gCookiesWindow._tree.treeBoxObject.rowCountChanged(0, view.rowCount);</span>
<a href="#l1.926"></a><span id="l1.926" class="difflineplus">+</span>
<a href="#l1.927"></a><span id="l1.927" class="difflineplus">+    // if the view is not empty then select the first item</span>
<a href="#l1.928"></a><span id="l1.928" class="difflineplus">+    if (view.rowCount &gt; 0)</span>
<a href="#l1.929"></a><span id="l1.929" class="difflineplus">+      view.selection.select(0);</span>
<a href="#l1.930"></a><span id="l1.930" class="difflineplus">+</span>
<a href="#l1.931"></a><span id="l1.931" class="difflineplus">+    document.getElementById(&quot;cookiesIntro&quot;).value = gCookiesWindow._bundle.getString(&quot;cookiesFiltered&quot;);</span>
<a href="#l1.932"></a><span id="l1.932" class="difflineplus">+  },</span>
<a href="#l1.933"></a><span id="l1.933" class="difflineplus">+</span>
<a href="#l1.934"></a><span id="l1.934" class="difflineplus">+  setFilter: function (aFilterString) {</span>
<a href="#l1.935"></a><span id="l1.935" class="difflineplus">+    document.getElementById(&quot;filter&quot;).value = aFilterString;</span>
<a href="#l1.936"></a><span id="l1.936" class="difflineplus">+    this.filter();</span>
<a href="#l1.937"></a><span id="l1.937" class="difflineplus">+  },</span>
<a href="#l1.938"></a><span id="l1.938" class="difflineplus">+</span>
<a href="#l1.939"></a><span id="l1.939" class="difflineplus">+  focusFilterBox: function ()</span>
<a href="#l1.940"></a><span id="l1.940" class="difflineplus">+  {</span>
<a href="#l1.941"></a><span id="l1.941" class="difflineplus">+    var filter = document.getElementById(&quot;filter&quot;);</span>
<a href="#l1.942"></a><span id="l1.942" class="difflineplus">+    filter.focus();</span>
<a href="#l1.943"></a><span id="l1.943" class="difflineplus">+    filter.select();</span>
<a href="#l1.944"></a><span id="l1.944" class="difflineplus">+  }</span>
<a href="#l1.945"></a><span id="l1.945" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/mail/components/preferences/cookies.xul</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,141 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+# -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+#</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+#</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+# License.</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+#</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+# The Original Code is the Firefox Preferences System.</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+#</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+# The Initial Developer of the Original Code is</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+# Ben Goodger.</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 2005</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+#</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+# Contributor(s):</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+#   Ben Goodger &lt;ben@mozilla.org&gt;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+#</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+#</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+&lt;!DOCTYPE dialog SYSTEM &quot;chrome://messenger/locale/preferences/cookies.dtd&quot; &gt;</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+&lt;window id=&quot;CookiesDialog&quot; windowtype=&quot;mailnews:cookies&quot;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+        class=&quot;windowDialog&quot; title=&quot;&amp;window.title;&quot;</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+        style=&quot;width: &amp;window.width;;&quot;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+        onload=&quot;gCookiesWindow.init();&quot;</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+        onunload=&quot;gCookiesWindow.uninit();&quot;</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+        persist=&quot;screenX screenY width height&quot;&gt;</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/preferences/permissionsutils.js&quot;/&gt;</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/preferences/cookies.js&quot;/&gt;</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+  &lt;stringbundle id=&quot;bundlePreferences&quot;</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+                src=&quot;chrome://messenger/locale/preferences/preferences.properties&quot;/&gt;</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+  &lt;keyset&gt;</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+    &lt;key key=&quot;&amp;windowClose.key;&quot; modifiers=&quot;accel&quot; oncommand=&quot;window.close();&quot;/&gt;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+    &lt;key key=&quot;&amp;focusSearch1.key;&quot; modifiers=&quot;accel&quot; oncommand=&quot;gCookiesWindow.focusFilterBox();&quot;/&gt;</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+    &lt;key key=&quot;&amp;focusSearch2.key;&quot; modifiers=&quot;accel&quot; oncommand=&quot;gCookiesWindow.focusFilterBox();&quot;/&gt;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+  &lt;/keyset&gt;</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+  &lt;vbox flex=&quot;1&quot; class=&quot;contentPane&quot;&gt;</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+    &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+      &lt;label accesskey=&quot;&amp;filter.accesskey;&quot; control=&quot;filter&quot;&gt;&amp;filter.label;&lt;/label&gt;</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+      &lt;textbox type=&quot;search&quot; id=&quot;filter&quot; flex=&quot;1&quot;</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+               aria-controls=&quot;cookiesList&quot;</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+               oncommand=&quot;gCookiesWindow.filter();&quot;/&gt;</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+    &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+    &lt;label control=&quot;cookiesList&quot; id=&quot;cookiesIntro&quot; value=&quot;&amp;cookiesonsystem.label;&quot;/&gt;</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+    &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+    &lt;tree id=&quot;cookiesList&quot; flex=&quot;1&quot; style=&quot;height: 10em;&quot;</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+          onkeypress=&quot;gCookiesWindow.onCookieKeyPress(event)&quot;</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+          onselect=&quot;gCookiesWindow.onCookieSelected();&quot;</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+          hidecolumnpicker=&quot;true&quot; seltype=&quot;single&quot;&gt;</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+      &lt;treecols&gt;</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+        &lt;treecol id=&quot;domainCol&quot; label=&quot;&amp;cookiedomain.label;&quot; flex=&quot;2&quot; primary=&quot;true&quot;</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+                 class=&quot;sortDirectionIndicator&quot; persist=&quot;width&quot; onclick=&quot;gCookiesWindow.sort('rawHost');&quot; /&gt;</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+        &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+        &lt;treecol id=&quot;nameCol&quot; label=&quot;&amp;cookiename.label;&quot; flex=&quot;1&quot;</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+                 class=&quot;sortDirectionIndicator&quot; persist=&quot;width&quot;</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+                 onclick=&quot;gCookiesWindow.sort('name');&quot;/&gt;</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+      &lt;/treecols&gt;</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+      &lt;treechildren id=&quot;cookiesChildren&quot;/&gt;</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+    &lt;/tree&gt;</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+    &lt;hbox id=&quot;cookieInfoBox&quot;&gt;</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+      &lt;grid flex=&quot;1&quot; id=&quot;cookieInfoGrid&quot;&gt;</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+        &lt;columns&gt;</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+          &lt;column/&gt;</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+          &lt;column flex=&quot;1&quot;/&gt;</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+        &lt;/columns&gt;</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+        &lt;rows&gt;</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+          &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+            &lt;hbox pack=&quot;end&quot;&gt;&lt;label id=&quot;nameLabel&quot; control=&quot;name&quot; value=&quot;&amp;props.name.label;&quot;/&gt;&lt;/hbox&gt;</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+            &lt;textbox id=&quot;name&quot; readonly=&quot;true&quot; class=&quot;plain&quot;/&gt;</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineplus">+          &lt;/row&gt;</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineplus">+          &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineplus">+            &lt;hbox pack=&quot;end&quot;&gt;&lt;label id=&quot;valueLabel&quot; control=&quot;value&quot; value=&quot;&amp;props.value.label;&quot;/&gt;&lt;/hbox&gt;</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineplus">+            &lt;textbox id=&quot;value&quot; readonly=&quot;true&quot; class=&quot;plain&quot;/&gt;</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+          &lt;/row&gt;</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineplus">+          &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineplus">+            &lt;hbox pack=&quot;end&quot;&gt;&lt;label id=&quot;isDomain&quot; control=&quot;host&quot; value=&quot;&amp;props.domain.label;&quot;/&gt;&lt;/hbox&gt;</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineplus">+            &lt;textbox id=&quot;host&quot; readonly=&quot;true&quot; class=&quot;plain&quot;/&gt;</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineplus">+          &lt;/row&gt;</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineplus">+          &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineplus">+            &lt;hbox pack=&quot;end&quot;&gt;&lt;label id=&quot;pathLabel&quot; control=&quot;path&quot; value=&quot;&amp;props.path.label;&quot;/&gt;&lt;/hbox&gt;</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+            &lt;textbox id=&quot;path&quot; readonly=&quot;true&quot; class=&quot;plain&quot;/&gt;</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+          &lt;/row&gt;</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+          &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineplus">+            &lt;hbox pack=&quot;end&quot;&gt;&lt;label id=&quot;isSecureLabel&quot; control=&quot;isSecure&quot; value=&quot;&amp;props.secure.label;&quot;/&gt;&lt;/hbox&gt;</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineplus">+            &lt;textbox id=&quot;isSecure&quot; readonly=&quot;true&quot; class=&quot;plain&quot;/&gt;</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineplus">+          &lt;/row&gt;</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineplus">+          &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineplus">+            &lt;hbox pack=&quot;end&quot;&gt;&lt;label id=&quot;expiresLabel&quot; control=&quot;expires&quot; value=&quot;&amp;props.expires.label;&quot;/&gt;&lt;/hbox&gt;</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineplus">+            &lt;textbox id=&quot;expires&quot; readonly=&quot;true&quot; class=&quot;plain&quot;/&gt;</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineplus">+          &lt;/row&gt;</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineplus">+        &lt;/rows&gt;</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineplus">+      &lt;/grid&gt;</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+  &lt;/vbox&gt;</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineplus">+  &lt;hbox align=&quot;end&quot;&gt;</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineplus">+    &lt;hbox class=&quot;actionButtons&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+      &lt;button id=&quot;removeCookie&quot; disabled=&quot;true&quot; icon=&quot;remove&quot;</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineplus">+              label=&quot;&amp;button.removecookie.label;&quot; accesskey=&quot;&amp;button.removecookie.accesskey;&quot;</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+              oncommand=&quot;gCookiesWindow.deleteCookie();&quot;/&gt;</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+      &lt;button id=&quot;removeAllCookies&quot; disabled=&quot;true&quot; icon=&quot;clear&quot;</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineplus">+              label=&quot;&amp;button.removeallcookies.label;&quot; accesskey=&quot;&amp;button.removeallcookies.accesskey;&quot;</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineplus">+              oncommand=&quot;gCookiesWindow.deleteAllCookies();&quot;/&gt;</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineplus">+      &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineplus">+#ifndef XP_MACOSX</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineplus">+      &lt;button oncommand=&quot;close();&quot; icon=&quot;close&quot;</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineplus">+              label=&quot;&amp;button.close.label;&quot; accesskey=&quot;&amp;button.close.accesskey;&quot;/&gt;</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineplus">+#endif</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineplus">+    &lt;resizer dir=&quot;bottomend&quot;/&gt;</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineplus">+  &lt;/hbox&gt;</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineplus">+&lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/preferences/jar.mn</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/preferences/jar.mn</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -26,8 +26,13 @@ messenger.jar:</span>
<a href="#l3.4"></a><span id="l3.4"> *   content/messenger/preferences/applicationManager.js</span>
<a href="#l3.5"></a><span id="l3.5"> *   content/messenger/preferences/handlers.xml</span>
<a href="#l3.6"></a><span id="l3.6"> *   content/messenger/preferences/handlers.css</span>
<a href="#l3.7"></a><span id="l3.7"> *   content/messenger/preferences/actionsshared.js</span>
<a href="#l3.8"></a><span id="l3.8"> *   content/messenger/preferences/fonts.js</span>
<a href="#l3.9"></a><span id="l3.9"> *   content/messenger/preferences/fonts.xul</span>
<a href="#l3.10"></a><span id="l3.10"> *   content/messenger/preferences/notifications.xul</span>
<a href="#l3.11"></a><span id="l3.11"> *   content/messenger/preferences/offline.xul</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+*   content/messenger/preferences/cookies.js</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+*   content/messenger/preferences/cookies.xul</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+*   content/messenger/preferences/permissions.js</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+*   content/messenger/preferences/permissions.xul</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+*   content/messenger/preferences/permissionsutils.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">new file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- /dev/null</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ b/mail/components/preferences/permissions.js</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -0,0 +1,418 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineplus">+# -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineplus">+#</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+#</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+# License.</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+#</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+# The Original Code is the Firefox Preferences System.</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+#</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+# The Initial Developer of the Original Code is</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+# Ben Goodger.</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 2005</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+#</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+# Contributor(s):</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+#   Ben Goodger &lt;ben@mozilla.org&gt;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+#   Blake Ross &lt;firefox@blakeross.com&gt;</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+#</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+#</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+const nsIPermissionManager = Components.interfaces.nsIPermissionManager;</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+const nsICookiePermission = Components.interfaces.nsICookiePermission;</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+function Permission(host, rawHost, type, capability, perm)</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+{</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+  this.host = host;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+  this.rawHost = rawHost;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+  this.type = type;</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+  this.capability = capability;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+  this.perm = perm;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+}</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+var gPermissionManager = {</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+  _type         : &quot;&quot;,</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+  _permissions  : [],</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+  _pm           : Components.classes[&quot;@mozilla.org/permissionmanager;1&quot;]</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+                            .getService(Components.interfaces.nsIPermissionManager),</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineplus">+  _bundle       : null,</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineplus">+  _tree         : null,</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+  _view: {</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+    _rowCount: 0,</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+    get rowCount()</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+    {</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineplus">+      return this._rowCount;</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+    },</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+    getCellText: function (aRow, aColumn)</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+    {</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+      if (aColumn.id == &quot;siteCol&quot;)</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+        return gPermissionManager._permissions[aRow].rawHost;</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineplus">+      else if (aColumn.id == &quot;statusCol&quot;)</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineplus">+        return gPermissionManager._permissions[aRow].capability;</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineplus">+      return &quot;&quot;;</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+    },</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineplus">+</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+    isSeparator: function(aIndex) { return false; },</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+    isSorted: function() { return false; },</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+    isContainer: function(aIndex) { return false; },</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+    setTree: function(aTree){},</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+    getImageSrc: function(aRow, aColumn) {},</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+    getProgressMode: function(aRow, aColumn) {},</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineplus">+    getCellValue: function(aRow, aColumn) {},</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineplus">+    cycleHeader: function(column) {},</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineplus">+    getRowProperties: function(row,prop){},</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineplus">+    getColumnProperties: function(column,prop){},</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+    getCellProperties: function(row,column,prop){</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+      if (column.element.getAttribute(&quot;id&quot;) == &quot;siteCol&quot;)</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+        prop.AppendElement(this._ltrAtom);</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+    }</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineplus">+  },</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineplus">+</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineplus">+  _getCapabilityString: function (aCapability)</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineplus">+  {</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineplus">+    var stringKey = null;</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineplus">+    switch (aCapability) {</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineplus">+    case nsIPermissionManager.ALLOW_ACTION:</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineplus">+      stringKey = &quot;can&quot;;</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+      break;</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+    case nsIPermissionManager.DENY_ACTION:</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineplus">+      stringKey = &quot;cannot&quot;;</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineplus">+      break;</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineplus">+    case nsICookiePermission.ACCESS_SESSION:</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineplus">+      stringKey = &quot;canSession&quot;;</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+      break;</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+    }</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+    return this._bundle.getString(stringKey);</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+  },</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineplus">+</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineplus">+  addPermission: function (aCapability)</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+  {</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineplus">+    var textbox = document.getElementById(&quot;url&quot;);</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineplus">+    var host = textbox.value.replace(/^\s*([-\w]*:\/+)?/, &quot;&quot;); // trim any leading space and scheme</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineplus">+    try {</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineplus">+      var ioService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineplus">+                                .getService(Components.interfaces.nsIIOService);</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineplus">+      var uri = ioService.newURI(&quot;http://&quot;+host, null, null);</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+      host = uri.host;</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineplus">+    } catch(ex) {</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineplus">+      var promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineplus">+                                    .getService(Components.interfaces.nsIPromptService);</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineplus">+      var message = this._bundle.getString(&quot;invalidURI&quot;);</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineplus">+      var title = this._bundle.getString(&quot;invalidURITitle&quot;);</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineplus">+      promptService.alert(window, title, message);</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+      return;</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineplus">+    }</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineplus">+</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+    var capabilityString = this._getCapabilityString(aCapability);</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineplus">+</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineplus">+    // check whether the permission already exists, if not, add it</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineplus">+    var exists = false;</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineplus">+    for (var i = 0; i &lt; this._permissions.length; ++i) {</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineplus">+      if (this._permissions[i].rawHost == host) {</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+        // Avoid calling the permission manager if the capability settings are</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineplus">+        // the same. Otherwise allow the call to the permissions manager to</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineplus">+        // update the listbox for us.</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineplus">+        exists = this._permissions[i].perm == aCapability;</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineplus">+        break;</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineplus">+      }</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineplus">+    }</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineplus">+</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineplus">+    if (!exists) {</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineplus">+      host = (host.charAt(0) == &quot;.&quot;) ? host.substring(1,host.length) : host;</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineplus">+      var uri = ioService.newURI(&quot;http://&quot; + host, null, null);</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineplus">+      this._pm.add(uri, this._type, aCapability);</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineplus">+    }</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineplus">+    textbox.value = &quot;&quot;;</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineplus">+    textbox.focus();</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineplus">+</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineplus">+    // covers a case where the site exists already, so the buttons don't disable</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineplus">+    this.onHostInput(textbox);</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineplus">+</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineplus">+    // enable &quot;remove all&quot; button as needed</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineplus">+    document.getElementById(&quot;removeAllPermissions&quot;).disabled = this._permissions.length == 0;</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineplus">+  },</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineplus">+</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineplus">+  onHostInput: function (aSiteField)</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineplus">+  {</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineplus">+    document.getElementById(&quot;btnSession&quot;).disabled = !aSiteField.value;</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineplus">+    document.getElementById(&quot;btnBlock&quot;).disabled = !aSiteField.value;</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineplus">+    document.getElementById(&quot;btnAllow&quot;).disabled = !aSiteField.value;</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineplus">+  },</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineplus">+</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineplus">+  onHostKeyPress: function (aEvent)</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineplus">+  {</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineplus">+    if (aEvent.keyCode == KeyEvent.DOM_VK_RETURN)</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineplus">+      document.getElementById(&quot;btnAllow&quot;).click();</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineplus">+  },</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineplus">+</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineplus">+  onLoad: function ()</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineplus">+  {</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineplus">+    this._bundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineplus">+    var params = window.arguments[0];</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineplus">+    this.init(params);</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineplus">+  },</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineplus">+</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineplus">+  init: function (aParams)</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineplus">+  {</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineplus">+    if (this._type) {</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineplus">+      // reusing an open dialog, clear the old observer</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineplus">+      this.uninit();</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineplus">+    }</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineplus">+</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineplus">+    this._type = aParams.permissionType;</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineplus">+    this._manageCapability = aParams.manageCapability;</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineplus">+</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineplus">+    var permissionsText = document.getElementById(&quot;permissionsText&quot;);</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineplus">+    while (permissionsText.hasChildNodes())</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineplus">+      permissionsText.removeChild(permissionsText.firstChild);</span>
<a href="#l4.192"></a><span id="l4.192" class="difflineplus">+    permissionsText.appendChild(document.createTextNode(aParams.introText));</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineplus">+</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineplus">+    document.title = aParams.windowTitle;</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineplus">+</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineplus">+    document.getElementById(&quot;btnBlock&quot;).hidden    = !aParams.blockVisible;</span>
<a href="#l4.197"></a><span id="l4.197" class="difflineplus">+    document.getElementById(&quot;btnSession&quot;).hidden  = !aParams.sessionVisible;</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineplus">+    document.getElementById(&quot;btnAllow&quot;).hidden    = !aParams.allowVisible;</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineplus">+</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineplus">+    var urlFieldVisible = (aParams.blockVisible || aParams.sessionVisible || aParams.allowVisible);</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineplus">+</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineplus">+    var urlField = document.getElementById(&quot;url&quot;);</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineplus">+    urlField.value = aParams.prefilledHost;</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineplus">+    urlField.hidden = !urlFieldVisible;</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineplus">+</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineplus">+    this.onHostInput(urlField);</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineplus">+</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineplus">+    var urlLabel = document.getElementById(&quot;urlLabel&quot;);</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineplus">+    urlLabel.hidden = !urlFieldVisible;</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineplus">+</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineplus">+    var os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineplus">+                       .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineplus">+    os.addObserver(this, &quot;perm-changed&quot;, false);</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineplus">+</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineplus">+    if (this._type == &quot;install&quot;) {</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineplus">+      var enumerator = this._pm.enumerator;</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineplus">+      if (!enumerator.hasMoreElements())</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineplus">+        this._updatePermissions();</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineplus">+    }</span>
<a href="#l4.220"></a><span id="l4.220" class="difflineplus">+</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineplus">+    this._loadPermissions();</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineplus">+</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineplus">+    urlField.focus();</span>
<a href="#l4.224"></a><span id="l4.224" class="difflineplus">+</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineplus">+    this._ltrAtom = Components.classes[&quot;@mozilla.org/atom-service;1&quot;]</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineplus">+                              .getService(Components.interfaces.nsIAtomService)</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineplus">+                              .getAtom(&quot;ltr&quot;);</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineplus">+  },</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineplus">+</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineplus">+  uninit: function ()</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineplus">+  {</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineplus">+    var os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineplus">+                       .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineplus">+    os.removeObserver(this, &quot;perm-changed&quot;);</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineplus">+  },</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineplus">+</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineplus">+  observe: function (aSubject, aTopic, aData)</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineplus">+  {</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineplus">+    if (aTopic == &quot;perm-changed&quot;) {</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineplus">+      var permission = aSubject.QueryInterface(Components.interfaces.nsIPermission);</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineplus">+      if (aData == &quot;added&quot;) {</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineplus">+        this._addPermissionToList(permission);</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineplus">+        ++this._view._rowCount;</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineplus">+        this._tree.treeBoxObject.rowCountChanged(this._view.rowCount - 1, 1);</span>
<a href="#l4.245"></a><span id="l4.245" class="difflineplus">+        // Re-do the sort, since we inserted this new item at the end.</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineplus">+        gTreeUtils.sort(this._tree, this._view, this._permissions,</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineplus">+                        this._lastPermissionSortColumn,</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineplus">+                        this._lastPermissionSortAscending);</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineplus">+      }</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineplus">+      else if (aData == &quot;changed&quot;) {</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineplus">+        for (var i = 0; i &lt; this._permissions.length; ++i) {</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineplus">+          if (this._permissions[i].host == permission.host) {</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineplus">+            this._permissions[i].capability = this._getCapabilityString(permission.capability);</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineplus">+            break;</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineplus">+          }</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineplus">+        }</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineplus">+        // Re-do the sort, if the status changed from Block to Allow</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineplus">+        // or vice versa, since if we're sorted on status, we may no</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineplus">+        // longer be in order.</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineplus">+        if (this._lastPermissionSortColumn.id == &quot;statusCol&quot;) {</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineplus">+          gTreeUtils.sort(this._tree, this._view, this._permissions,</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineplus">+                          this._lastPermissionSortColumn,</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineplus">+                          this._lastPermissionSortAscending);</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineplus">+        }</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineplus">+        this._tree.treeBoxObject.invalidate();</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineplus">+      }</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineplus">+      // No UI other than this window causes this method to be sent a &quot;deleted&quot;</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineplus">+      // notification, so we don't need to implement it since Delete is handled</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineplus">+      // directly by the Permission Removal handlers. If that ever changes, those</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineplus">+      // implementations will have to move into here.</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineplus">+    }</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineplus">+  },</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineplus">+</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineplus">+  onPermissionSelected: function ()</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineplus">+  {</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineplus">+    var hasSelection = this._tree.view.selection.count &gt; 0;</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineplus">+    var hasRows = this._tree.view.rowCount &gt; 0;</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineplus">+    document.getElementById(&quot;removePermission&quot;).disabled = !hasRows || !hasSelection;</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineplus">+    document.getElementById(&quot;removeAllPermissions&quot;).disabled = !hasRows;</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineplus">+  },</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineplus">+</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineplus">+  onPermissionDeleted: function ()</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineplus">+  {</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineplus">+    if (!this._view.rowCount)</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineplus">+      return;</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineplus">+    var removedPermissions = [];</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineplus">+    gTreeUtils.deleteSelectedItems(this._tree, this._view, this._permissions, removedPermissions);</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineplus">+    for (var i = 0; i &lt; removedPermissions.length; ++i) {</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineplus">+      var p = removedPermissions[i];</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineplus">+      this._pm.remove(p.host, p.type);</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineplus">+    }</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineplus">+    document.getElementById(&quot;removePermission&quot;).disabled = !this._permissions.length;</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineplus">+    document.getElementById(&quot;removeAllPermissions&quot;).disabled = !this._permissions.length;</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineplus">+  },</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineplus">+</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineplus">+  onAllPermissionsDeleted: function ()</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineplus">+  {</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineplus">+    if (!this._view.rowCount)</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineplus">+      return;</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineplus">+    var removedPermissions = [];</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineplus">+    gTreeUtils.deleteAll(this._tree, this._view, this._permissions, removedPermissions);</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineplus">+    for (var i = 0; i &lt; removedPermissions.length; ++i) {</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineplus">+      var p = removedPermissions[i];</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineplus">+      this._pm.remove(p.host, p.type);</span>
<a href="#l4.305"></a><span id="l4.305" class="difflineplus">+    }</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineplus">+    document.getElementById(&quot;removePermission&quot;).disabled = true;</span>
<a href="#l4.307"></a><span id="l4.307" class="difflineplus">+    document.getElementById(&quot;removeAllPermissions&quot;).disabled = true;</span>
<a href="#l4.308"></a><span id="l4.308" class="difflineplus">+  },</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineplus">+</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineplus">+  onPermissionKeyPress: function (aEvent)</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineplus">+  {</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineplus">+    if (aEvent.keyCode == 46)</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineplus">+      this.onPermissionDeleted();</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineplus">+  },</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineplus">+</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineplus">+  _lastPermissionSortColumn: &quot;&quot;,</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineplus">+  _lastPermissionSortAscending: false,</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineplus">+</span>
<a href="#l4.319"></a><span id="l4.319" class="difflineplus">+  onPermissionSort: function (aColumn)</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineplus">+  {</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineplus">+    this._lastPermissionSortAscending = gTreeUtils.sort(this._tree,</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineplus">+                                                        this._view,</span>
<a href="#l4.323"></a><span id="l4.323" class="difflineplus">+                                                        this._permissions,</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineplus">+                                                        aColumn,</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineplus">+                                                        this._lastPermissionSortColumn,</span>
<a href="#l4.326"></a><span id="l4.326" class="difflineplus">+                                                        this._lastPermissionSortAscending);</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineplus">+    this._lastPermissionSortColumn = aColumn;</span>
<a href="#l4.328"></a><span id="l4.328" class="difflineplus">+  },</span>
<a href="#l4.329"></a><span id="l4.329" class="difflineplus">+</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineplus">+  _loadPermissions: function ()</span>
<a href="#l4.331"></a><span id="l4.331" class="difflineplus">+  {</span>
<a href="#l4.332"></a><span id="l4.332" class="difflineplus">+    this._tree = document.getElementById(&quot;permissionsTree&quot;);</span>
<a href="#l4.333"></a><span id="l4.333" class="difflineplus">+    this._permissions = [];</span>
<a href="#l4.334"></a><span id="l4.334" class="difflineplus">+</span>
<a href="#l4.335"></a><span id="l4.335" class="difflineplus">+    // load permissions into a table</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineplus">+    var count = 0;</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineplus">+    var enumerator = this._pm.enumerator;</span>
<a href="#l4.338"></a><span id="l4.338" class="difflineplus">+    while (enumerator.hasMoreElements()) {</span>
<a href="#l4.339"></a><span id="l4.339" class="difflineplus">+      var nextPermission = enumerator.getNext().QueryInterface(Components.interfaces.nsIPermission);</span>
<a href="#l4.340"></a><span id="l4.340" class="difflineplus">+      this._addPermissionToList(nextPermission);</span>
<a href="#l4.341"></a><span id="l4.341" class="difflineplus">+    }</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineplus">+</span>
<a href="#l4.343"></a><span id="l4.343" class="difflineplus">+    this._view._rowCount = this._permissions.length;</span>
<a href="#l4.344"></a><span id="l4.344" class="difflineplus">+</span>
<a href="#l4.345"></a><span id="l4.345" class="difflineplus">+    // sort and display the table</span>
<a href="#l4.346"></a><span id="l4.346" class="difflineplus">+    this._tree.treeBoxObject.view = this._view;</span>
<a href="#l4.347"></a><span id="l4.347" class="difflineplus">+    this.onPermissionSort(&quot;rawHost&quot;, false);</span>
<a href="#l4.348"></a><span id="l4.348" class="difflineplus">+</span>
<a href="#l4.349"></a><span id="l4.349" class="difflineplus">+    // disable &quot;remove all&quot; button if there are none</span>
<a href="#l4.350"></a><span id="l4.350" class="difflineplus">+    document.getElementById(&quot;removeAllPermissions&quot;).disabled = this._permissions.length == 0;</span>
<a href="#l4.351"></a><span id="l4.351" class="difflineplus">+  },</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineplus">+</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineplus">+  _addPermissionToList: function (aPermission)</span>
<a href="#l4.354"></a><span id="l4.354" class="difflineplus">+  {</span>
<a href="#l4.355"></a><span id="l4.355" class="difflineplus">+    if (aPermission.type == this._type &amp;&amp;</span>
<a href="#l4.356"></a><span id="l4.356" class="difflineplus">+        (!this._manageCapability ||</span>
<a href="#l4.357"></a><span id="l4.357" class="difflineplus">+         (aPermission.capability == this._manageCapability))) {</span>
<a href="#l4.358"></a><span id="l4.358" class="difflineplus">+</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineplus">+      var host = aPermission.host;</span>
<a href="#l4.360"></a><span id="l4.360" class="difflineplus">+      var capabilityString = this._getCapabilityString(aPermission.capability);</span>
<a href="#l4.361"></a><span id="l4.361" class="difflineplus">+      var p = new Permission(host,</span>
<a href="#l4.362"></a><span id="l4.362" class="difflineplus">+                             (host.charAt(0) == &quot;.&quot;) ? host.substring(1,host.length) : host,</span>
<a href="#l4.363"></a><span id="l4.363" class="difflineplus">+                             aPermission.type,</span>
<a href="#l4.364"></a><span id="l4.364" class="difflineplus">+                             capabilityString,</span>
<a href="#l4.365"></a><span id="l4.365" class="difflineplus">+                             aPermission.capability);</span>
<a href="#l4.366"></a><span id="l4.366" class="difflineplus">+      this._permissions.push(p);</span>
<a href="#l4.367"></a><span id="l4.367" class="difflineplus">+    }</span>
<a href="#l4.368"></a><span id="l4.368" class="difflineplus">+  },</span>
<a href="#l4.369"></a><span id="l4.369" class="difflineplus">+</span>
<a href="#l4.370"></a><span id="l4.370" class="difflineplus">+  _updatePermissions: function ()</span>
<a href="#l4.371"></a><span id="l4.371" class="difflineplus">+  {</span>
<a href="#l4.372"></a><span id="l4.372" class="difflineplus">+    try {</span>
<a href="#l4.373"></a><span id="l4.373" class="difflineplus">+      var ioService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l4.374"></a><span id="l4.374" class="difflineplus">+                                .getService(Components.interfaces.nsIIOService);</span>
<a href="#l4.375"></a><span id="l4.375" class="difflineplus">+      var pbi = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l4.376"></a><span id="l4.376" class="difflineplus">+                          .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l4.377"></a><span id="l4.377" class="difflineplus">+      var prefList = [[&quot;xpinstall.whitelist.add&quot;, nsIPermissionManager.ALLOW_ACTION],</span>
<a href="#l4.378"></a><span id="l4.378" class="difflineplus">+                      [&quot;xpinstall.whitelist.add.103&quot;, nsIPermissionManager.ALLOW_ACTION],</span>
<a href="#l4.379"></a><span id="l4.379" class="difflineplus">+                      [&quot;xpinstall.blacklist.add&quot;, nsIPermissionManager.DENY_ACTION]];</span>
<a href="#l4.380"></a><span id="l4.380" class="difflineplus">+</span>
<a href="#l4.381"></a><span id="l4.381" class="difflineplus">+      for (var i = 0; i &lt; prefList.length; ++i) {</span>
<a href="#l4.382"></a><span id="l4.382" class="difflineplus">+        try {</span>
<a href="#l4.383"></a><span id="l4.383" class="difflineplus">+          // this pref is a comma-delimited list of hosts</span>
<a href="#l4.384"></a><span id="l4.384" class="difflineplus">+          var hosts = pbi.getCharPref(prefList[i][0]);</span>
<a href="#l4.385"></a><span id="l4.385" class="difflineplus">+        } catch(ex) {</span>
<a href="#l4.386"></a><span id="l4.386" class="difflineplus">+          continue;</span>
<a href="#l4.387"></a><span id="l4.387" class="difflineplus">+        }</span>
<a href="#l4.388"></a><span id="l4.388" class="difflineplus">+</span>
<a href="#l4.389"></a><span id="l4.389" class="difflineplus">+        if (!hosts)</span>
<a href="#l4.390"></a><span id="l4.390" class="difflineplus">+          continue;</span>
<a href="#l4.391"></a><span id="l4.391" class="difflineplus">+</span>
<a href="#l4.392"></a><span id="l4.392" class="difflineplus">+        hostList = hosts.split(&quot;,&quot;);</span>
<a href="#l4.393"></a><span id="l4.393" class="difflineplus">+        var capability = prefList[i][1];</span>
<a href="#l4.394"></a><span id="l4.394" class="difflineplus">+        for (var j = 0; j &lt; hostList.length; ++j) {</span>
<a href="#l4.395"></a><span id="l4.395" class="difflineplus">+          // trim leading and trailing spaces</span>
<a href="#l4.396"></a><span id="l4.396" class="difflineplus">+          var host = hostList[j].replace(/^\s*/,&quot;&quot;).replace(/\s*$/,&quot;&quot;);</span>
<a href="#l4.397"></a><span id="l4.397" class="difflineplus">+          try {</span>
<a href="#l4.398"></a><span id="l4.398" class="difflineplus">+            var uri = ioService.newURI(&quot;http://&quot; + host, null, null);</span>
<a href="#l4.399"></a><span id="l4.399" class="difflineplus">+            this._pm.add(uri, this._type, capability);</span>
<a href="#l4.400"></a><span id="l4.400" class="difflineplus">+          } catch(ex) { }</span>
<a href="#l4.401"></a><span id="l4.401" class="difflineplus">+        }</span>
<a href="#l4.402"></a><span id="l4.402" class="difflineplus">+        pbi.setCharPref(prefList[i][0], &quot;&quot;);</span>
<a href="#l4.403"></a><span id="l4.403" class="difflineplus">+      }</span>
<a href="#l4.404"></a><span id="l4.404" class="difflineplus">+    } catch(ex) { }</span>
<a href="#l4.405"></a><span id="l4.405" class="difflineplus">+  },</span>
<a href="#l4.406"></a><span id="l4.406" class="difflineplus">+</span>
<a href="#l4.407"></a><span id="l4.407" class="difflineplus">+  setHost: function (aHost)</span>
<a href="#l4.408"></a><span id="l4.408" class="difflineplus">+  {</span>
<a href="#l4.409"></a><span id="l4.409" class="difflineplus">+    document.getElementById(&quot;url&quot;).value = aHost;</span>
<a href="#l4.410"></a><span id="l4.410" class="difflineplus">+  }</span>
<a href="#l4.411"></a><span id="l4.411" class="difflineplus">+};</span>
<a href="#l4.412"></a><span id="l4.412" class="difflineplus">+</span>
<a href="#l4.413"></a><span id="l4.413" class="difflineplus">+function setHost(aHost)</span>
<a href="#l4.414"></a><span id="l4.414" class="difflineplus">+{</span>
<a href="#l4.415"></a><span id="l4.415" class="difflineplus">+  gPermissionManager.setHost(aHost);</span>
<a href="#l4.416"></a><span id="l4.416" class="difflineplus">+}</span>
<a href="#l4.417"></a><span id="l4.417" class="difflineplus">+</span>
<a href="#l4.418"></a><span id="l4.418" class="difflineplus">+function initWithParams(aParams)</span>
<a href="#l4.419"></a><span id="l4.419" class="difflineplus">+{</span>
<a href="#l4.420"></a><span id="l4.420" class="difflineplus">+  gPermissionManager.init(aParams);</span>
<a href="#l4.421"></a><span id="l4.421" class="difflineplus">+}</span>
<a href="#l4.422"></a><span id="l4.422" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">new file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- /dev/null</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ b/mail/components/preferences/permissions.xul</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -0,0 +1,116 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+# -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+#</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+#</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+# License.</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+#</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+# The Original Code is mozilla.org code.</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+#</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+# The Initial Developer of the Original Code is</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+# Blake Ross.</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 2003</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+#</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+# Contributor(s):</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+#   Blake Ross &lt;firefox@blakeross.com&gt;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+#   Ben Goodger &lt;ben@mozilla.org&gt;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+#</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+#</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+&lt;!DOCTYPE dialog SYSTEM &quot;chrome://messenger/locale/preferences/permissions.dtd&quot; &gt;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+&lt;window id=&quot;PermissionsDialog&quot; class=&quot;windowDialog&quot;</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+        windowtype=&quot;mailnews:permissions&quot;</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+        title=&quot;&amp;window.title;&quot;</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+        style=&quot;width: &amp;window.width;;&quot;</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+        onload=&quot;gPermissionManager.onLoad();&quot;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+        onunload=&quot;gPermissionManager.uninit();&quot;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+        persist=&quot;screenX screenY width height&quot;&gt;</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/preferences/permissionsutils.js&quot;/&gt;</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/preferences/permissions.js&quot;/&gt;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+  &lt;stringbundle id=&quot;bundlePreferences&quot;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+                src=&quot;chrome://messenger/locale/preferences/preferences.properties&quot;/&gt;</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+  &lt;keyset&gt;</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+    &lt;key key=&quot;&amp;windowClose.key;&quot; modifiers=&quot;accel&quot; oncommand=&quot;window.close();&quot;/&gt;</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+  &lt;/keyset&gt;</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+  &lt;vbox class=&quot;contentPane&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+    &lt;description id=&quot;permissionsText&quot; control=&quot;url&quot;/&gt;</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+    &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+    &lt;label id=&quot;urlLabel&quot; control=&quot;url&quot; value=&quot;&amp;address.label;&quot; accesskey=&quot;&amp;address.accesskey;&quot;/&gt;</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+    &lt;hbox align=&quot;start&quot;&gt;</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+      &lt;textbox id=&quot;url&quot; flex=&quot;1&quot;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+               oninput=&quot;gPermissionManager.onHostInput(event.target);&quot;</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+               onkeypress=&quot;gPermissionManager.onHostKeyPress(event);&quot;/&gt;</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+    &lt;hbox pack=&quot;end&quot;&gt;</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+      &lt;button id=&quot;btnBlock&quot; disabled=&quot;true&quot; label=&quot;&amp;block.label;&quot; accesskey=&quot;&amp;block.accesskey;&quot;</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+              oncommand=&quot;gPermissionManager.addPermission(nsIPermissionManager.DENY_ACTION);&quot;/&gt;</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+      &lt;button id=&quot;btnSession&quot; disabled=&quot;true&quot; label=&quot;&amp;session.label;&quot; accesskey=&quot;&amp;session.accesskey;&quot;</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+              oncommand=&quot;gPermissionManager.addPermission(nsICookiePermission.ACCESS_SESSION);&quot;/&gt;</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+      &lt;button id=&quot;btnAllow&quot; disabled=&quot;true&quot; label=&quot;&amp;allow.label;&quot; default=&quot;true&quot; accesskey=&quot;&amp;allow.accesskey;&quot;</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+              oncommand=&quot;gPermissionManager.addPermission(nsIPermissionManager.ALLOW_ACTION);&quot;/&gt;</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+    &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+    &lt;tree id=&quot;permissionsTree&quot; flex=&quot;1&quot; style=&quot;height: 18em;&quot;</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+          hidecolumnpicker=&quot;true&quot;</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+          onkeypress=&quot;gPermissionManager.onPermissionKeyPress(event)&quot;</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+          onselect=&quot;gPermissionManager.onPermissionSelected();&quot;&gt;</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+      &lt;treecols&gt;</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+        &lt;treecol id=&quot;siteCol&quot; label=&quot;&amp;treehead.sitename.label;&quot; flex=&quot;3&quot;</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+                onclick=&quot;gPermissionManager.onPermissionSort('rawHost');&quot; persist=&quot;width&quot;/&gt;</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+        &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+        &lt;treecol id=&quot;statusCol&quot; label=&quot;&amp;treehead.status.label;&quot; flex=&quot;1&quot;</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+                onclick=&quot;gPermissionManager.onPermissionSort('capability');&quot; persist=&quot;width&quot;/&gt;</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineplus">+      &lt;/treecols&gt;</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineplus">+      &lt;treechildren/&gt;</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineplus">+    &lt;/tree&gt;</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+  &lt;/vbox&gt;</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineplus">+  &lt;hbox align=&quot;end&quot;&gt;</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineplus">+    &lt;hbox class=&quot;actionButtons&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineplus">+      &lt;button id=&quot;removePermission&quot; disabled=&quot;true&quot;</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineplus">+              accesskey=&quot;&amp;removepermission.accesskey;&quot;</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineplus">+              icon=&quot;remove&quot; label=&quot;&amp;removepermission.label;&quot;</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+              oncommand=&quot;gPermissionManager.onPermissionDeleted();&quot;/&gt;</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+      &lt;button id=&quot;removeAllPermissions&quot;</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineplus">+              icon=&quot;clear&quot; label=&quot;&amp;removeallpermissions.label;&quot;</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+              accesskey=&quot;&amp;removeallpermissions.accesskey;&quot;</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+              oncommand=&quot;gPermissionManager.onAllPermissionsDeleted();&quot;/&gt;</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+      &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+#ifndef XP_MACOSX</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+      &lt;button oncommand=&quot;close();&quot; icon=&quot;close&quot;</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+              label=&quot;&amp;button.close.label;&quot; accesskey=&quot;&amp;button.close.accesskey;&quot;/&gt;</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineplus">+#endif</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+    &lt;resizer dir=&quot;bottomend&quot;/&gt;</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineplus">+  &lt;/hbox&gt;</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineplus">+&lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/mail/components/preferences/permissionsutils.js</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,102 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+# -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+#</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+#</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+# License.</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+#</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+# The Original Code is the Firefox Preferences System.</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+#</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+# The Initial Developer of the Original Code is</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+# Ben Goodger.</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 2005</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+#</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+# Contributor(s):</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+#   Ben Goodger &lt;ben@mozilla.org&gt;</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+#</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+#</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+var gTreeUtils = {</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+  deleteAll: function (aTree, aView, aItems, aDeletedItems)</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+  {</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+    for (var i = 0; i &lt; aItems.length; ++i)</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+      aDeletedItems.push(aItems[i]);</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+    aItems.splice(0);</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+    var oldCount = aView.rowCount;</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+    aView._rowCount = 0;</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+    aTree.treeBoxObject.rowCountChanged(0, -oldCount);</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+  },</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+  deleteSelectedItems: function (aTree, aView, aItems, aDeletedItems)</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+  {</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+    var selection = aTree.view.selection;</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+    selection.selectEventsSuppressed = true;</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+    var rc = selection.getRangeCount();</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+    for (var i = 0; i &lt; rc; ++i) {</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+      var min = { }; var max = { };</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+      selection.getRangeAt(i, min, max);</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+      for (var j = min.value; j &lt;= max.value; ++j) {</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+        aDeletedItems.push(aItems[j]);</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+        aItems[j] = null;</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+      }</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+    }</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+    var nextSelection = 0;</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+    for (i = 0; i &lt; aItems.length; ++i) {</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+      if (!aItems[i]) {</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+        var j = i;</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+        while (j &lt; aItems.length &amp;&amp; !aItems[j])</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineplus">+          ++j;</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+        aItems.splice(i, j - i);</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+        nextSelection = j &lt; aView.rowCount ? j - 1 : j - 2;</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+        aView._rowCount -= j - i;</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineplus">+        aTree.treeBoxObject.rowCountChanged(i, i - j);</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+      }</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+    }</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineplus">+    if (aItems.length) {</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineplus">+      selection.select(nextSelection);</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+      aTree.treeBoxObject.ensureRowIsVisible(nextSelection);</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+      aTree.focus();</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineplus">+    }</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineplus">+    selection.selectEventsSuppressed = false;</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+  },</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineplus">+  sort: function (aTree, aView, aDataSet, aColumn,</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineplus">+                  aLastSortColumn, aLastSortAscending)</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineplus">+  {</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineplus">+    var ascending = (aColumn == aLastSortColumn) ? !aLastSortAscending : true;</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineplus">+    aDataSet.sort(function (a, b) { return a[aColumn].toLowerCase().localeCompare(b[aColumn].toLowerCase()); });</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineplus">+    if (!ascending)</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+      aDataSet.reverse();</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineplus">+</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineplus">+    aTree.view.selection.select(-1);</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineplus">+    aTree.view.selection.select(0);</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineplus">+    aTree.treeBoxObject.invalidate();</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineplus">+    aTree.treeBoxObject.ensureRowIsVisible(0);</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineplus">+</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineplus">+    return ascending;</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineplus">+  }</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineplus">+};</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/preferences/security.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/preferences/security.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -208,10 +208,69 @@ var gSecurityPane = {</span>
<a href="#l7.4"></a><span id="l7.4">     document.documentElement.openWindow(&quot;Toolkit:PasswordManager&quot;,</span>
<a href="#l7.5"></a><span id="l7.5">                                         &quot;chrome://passwordmgr/content/passwordManager.xul&quot;,</span>
<a href="#l7.6"></a><span id="l7.6">                                         &quot;&quot;, null);</span>
<a href="#l7.7"></a><span id="l7.7">   },</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">   updateDownloadedPhishingListState: function()</span>
<a href="#l7.10"></a><span id="l7.10">   {</span>
<a href="#l7.11"></a><span id="l7.11">     document.getElementById('useDownloadedList').disabled = !document.getElementById('enablePhishingDetector').checked;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+  },</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+  /**</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+   * Reads the network.cookie.cookieBehavior preference value and</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+   * enables/disables the rest of the cookie UI accordingly, returning true</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+   * if cookies are enabled.</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+   */</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+  readAcceptCookies: function ()</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+  {</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+    var pref = document.getElementById(&quot;network.cookie.cookieBehavior&quot;);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+    var keepUntil = document.getElementById(&quot;keepUntil&quot;);</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+    var menu = document.getElementById(&quot;keepCookiesUntil&quot;);</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+    // enable the rest of the UI for anything other than &quot;disable all cookies&quot;</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+    var acceptCookies = (pref.value != 2);</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+    keepUntil.disabled = menu.disabled = this._autoStartPrivateBrowsing || !acceptCookies;</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+    return acceptCookies;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+  },</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+  /**</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+   * Enables/disables the &quot;keep until&quot; label and menulist in response to the</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+   * &quot;accept cookies&quot; checkbox being checked or unchecked.</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+   */</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+  writeAcceptCookies: function ()</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+  {</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+    var accept = document.getElementById(&quot;acceptCookies&quot;);</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+    return accept.checked ? 0 : 2;</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+  },</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+  /**</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+   * Displays fine-grained, per-site preferences for cookies.</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+   */</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+  showCookieExceptions: function ()</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+  {</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+    var bundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+    var params = { blockVisible   : true,</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+                   sessionVisible : true,</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+                   allowVisible   : true,</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+                   prefilledHost  : &quot;&quot;,</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+                   permissionType : &quot;cookie&quot;,</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+                   windowTitle    : bundle.getString(&quot;cookiepermissionstitle&quot;),</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+                   introText      : bundle.getString(&quot;cookiepermissionstext&quot;) };</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+    document.documentElement.openWindow(&quot;mailnews:permissions&quot;,</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+                        &quot;chrome://messenger/content/preferences/permissions.xul&quot;,</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+                        &quot;&quot;, params);</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+  },</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+  /**</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+   * Displays all the user's cookies in a dialog.</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+   */</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+  showCookies: function (aCategory)</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+  {</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+    document.documentElement.openWindow(&quot;mailnews:cookies&quot;,</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+                            &quot;chrome://messenger/content/preferences/cookies.xul&quot;,</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+                            &quot;&quot;, null);</span>
<a href="#l7.70"></a><span id="l7.70">   }</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+</span>
<a href="#l7.72"></a><span id="l7.72"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/components/preferences/security.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/components/preferences/security.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -74,24 +74,41 @@</span>
<a href="#l8.4"></a><span id="l8.4">                   name=&quot;browser.safebrowsing.enabled&quot;</span>
<a href="#l8.5"></a><span id="l8.5">                   type=&quot;bool&quot;/&gt;</span>
<a href="#l8.6"></a><span id="l8.6">       &lt;preference id=&quot;mailnews.downloadToTempFile&quot;</span>
<a href="#l8.7"></a><span id="l8.7">                   name=&quot;mailnews.downloadToTempFile&quot;</span>
<a href="#l8.8"></a><span id="l8.8">                   type=&quot;bool&quot;/&gt;                   </span>
<a href="#l8.9"></a><span id="l8.9">       &lt;preference id=&quot;pref.privacy.disable_button.view_passwords&quot;</span>
<a href="#l8.10"></a><span id="l8.10">                   name=&quot;pref.privacy.disable_button.view_passwords&quot;</span>
<a href="#l8.11"></a><span id="l8.11">                   type=&quot;bool&quot;/&gt;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+      &lt;!-- Cookies --&gt;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+      &lt;preference id=&quot;pref.privacy.disable_button.cookie_exceptions&quot;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+                  name=&quot;pref.privacy.disable_button.cookie_exceptions&quot;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+                  type=&quot;bool&quot;/&gt;</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+      &lt;preference id=&quot;pref.privacy.disable_button.view_cookies&quot;</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+                  name=&quot;pref.privacy.disable_button.view_cookies&quot;</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+                  type=&quot;bool&quot;/&gt;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+      &lt;preference id=&quot;network.cookie.cookieBehavior&quot;</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+                  name=&quot;network.cookie.cookieBehavior&quot;</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+                  type=&quot;int&quot;/&gt;</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+      &lt;preference id=&quot;network.cookie.lifetimePolicy&quot;</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+                  name=&quot;network.cookie.lifetimePolicy&quot;</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+                  type=&quot;int&quot;/&gt;</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+      &lt;preference id=&quot;network.cookie.blockFutureCookies&quot;</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+                  name=&quot;network.cookie.blockFutureCookies&quot;</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+                  type=&quot;bool&quot;/&gt;</span>
<a href="#l8.28"></a><span id="l8.28">     &lt;/preferences&gt;</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30">     &lt;tabbox id=&quot;securityPrefs&quot; flex=&quot;1&quot; onselect=&quot;gSecurityPane.tabSelectionChanged();&quot;&gt;</span>
<a href="#l8.31"></a><span id="l8.31">       &lt;tabs&gt;</span>
<a href="#l8.32"></a><span id="l8.32">         &lt;tab label=&quot;&amp;itemJunk.label;&quot;/&gt;</span>
<a href="#l8.33"></a><span id="l8.33">         &lt;tab label=&quot;&amp;itemPhishing.label;&quot;/&gt;</span>
<a href="#l8.34"></a><span id="l8.34">         &lt;tab label=&quot;&amp;itemAntiVirus.label;&quot;/&gt;</span>
<a href="#l8.35"></a><span id="l8.35">         &lt;tab label=&quot;&amp;itemPasswords.label;&quot;/&gt;</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+        &lt;tab label=&quot;&amp;itemCookies.label;&quot;/&gt;</span>
<a href="#l8.37"></a><span id="l8.37">       &lt;/tabs&gt;</span>
<a href="#l8.38"></a><span id="l8.38">       </span>
<a href="#l8.39"></a><span id="l8.39">       &lt;tabpanels flex=&quot;1&quot;&gt;</span>
<a href="#l8.40"></a><span id="l8.40">         &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l8.41"></a><span id="l8.41">           &lt;description&gt;&amp;junkMail.intro;&lt;/description&gt;</span>
<a href="#l8.42"></a><span id="l8.42">           &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l8.43"></a><span id="l8.43">           </span>
<a href="#l8.44"></a><span id="l8.44">           &lt;checkbox id=&quot;manualMark&quot; </span>
<a href="#l8.45"></a><span id="l8.45" class="difflineat">@@ -170,15 +187,52 @@</span>
<a href="#l8.46"></a><span id="l8.46">                       oncommand=&quot;gSecurityPane.updateMasterPasswordButton();&quot;/&gt;</span>
<a href="#l8.47"></a><span id="l8.47"> </span>
<a href="#l8.48"></a><span id="l8.48">             &lt;button id=&quot;changeMasterPassword&quot;</span>
<a href="#l8.49"></a><span id="l8.49">                     label=&quot;&amp;changeMasterPassword.label;&quot; accesskey=&quot;&amp;changeMasterPassword.accesskey;&quot;</span>
<a href="#l8.50"></a><span id="l8.50">                     oncommand=&quot;gSecurityPane.changeMasterPassword();&quot;/&gt;</span>
<a href="#l8.51"></a><span id="l8.51">           &lt;/hbox&gt;</span>
<a href="#l8.52"></a><span id="l8.52">           &lt;separator flex=&quot;1&quot;/&gt;</span>
<a href="#l8.53"></a><span id="l8.53">         &lt;/tabpanel&gt;</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+        &lt;!-- Cookies --&gt;</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+        &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+          &lt;description&gt;&amp;cookies.intro;&lt;/description&gt;</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+          &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+          &lt;hbox id=&quot;cookiesBox&quot;&gt;</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+            &lt;checkbox id=&quot;acceptCookies&quot; label=&quot;&amp;acceptCookies.label;&quot; flex=&quot;1&quot;</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+                      preference=&quot;network.cookie.cookieBehavior&quot;</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+                      accesskey=&quot;&amp;acceptCookies.accesskey;&quot;</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+                      onsyncfrompreference=&quot;return gSecurityPane.readAcceptCookies();&quot;</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+                      onsynctopreference=&quot;return gSecurityPane.writeAcceptCookies();&quot;/&gt;</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+            &lt;button id=&quot;cookieExceptions&quot; oncommand=&quot;gSecurityPane.showCookieExceptions();&quot;</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+                    label=&quot;&amp;cookieExceptions.label;&quot; accesskey=&quot;&amp;cookieExceptions.accesskey;&quot;</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+                    preference=&quot;pref.privacy.disable_button.cookie_exceptions&quot;/&gt;</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+          &lt;hbox id=&quot;keepRow&quot; class=&quot;indent&quot;&gt;</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+            &lt;hbox id=&quot;keepBox&quot; align=&quot;center&quot;&gt;</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+              &lt;label id=&quot;keepUntil&quot;</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+                     control=&quot;keepCookiesUntil&quot;</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+                     accesskey=&quot;&amp;keepUntil.accesskey;&quot;&gt;&amp;keepUntil.label;&lt;/label&gt;</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+              &lt;menulist id=&quot;keepCookiesUntil&quot;</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+                        preference=&quot;network.cookie.lifetimePolicy&quot;&gt;</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+                &lt;menupopup&gt;</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+                  &lt;menuitem label=&quot;&amp;expire.label;&quot; value=&quot;0&quot;/&gt;</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+                  &lt;menuitem label=&quot;&amp;close.label;&quot; value=&quot;2&quot;/&gt;</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+                  &lt;menuitem label=&quot;&amp;askEachTime.label;&quot; value=&quot;1&quot;/&gt;</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineplus">+                &lt;/menupopup&gt;</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+              &lt;/menulist&gt;</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+            &lt;hbox flex=&quot;1&quot;/&gt;</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+            &lt;button id=&quot;showCookiesButton&quot; label=&quot;&amp;showCookies.label;&quot;</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineplus">+                    accesskey=&quot;&amp;showCookies.accesskey;&quot;</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineplus">+                    oncommand=&quot;gSecurityPane.showCookies();&quot;</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineplus">+                    preference=&quot;pref.privacy.disable_button.view_cookies&quot;/&gt;</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineplus">+        &lt;/tabpanel&gt;</span>
<a href="#l8.91"></a><span id="l8.91">       &lt;/tabpanels&gt;</span>
<a href="#l8.92"></a><span id="l8.92">     &lt;/tabbox&gt;</span>
<a href="#l8.93"></a><span id="l8.93"> </span>
<a href="#l8.94"></a><span id="l8.94">     &lt;separator/&gt;</span>
<a href="#l8.95"></a><span id="l8.95"> </span>
<a href="#l8.96"></a><span id="l8.96">   &lt;/prefpane&gt;</span>
<a href="#l8.97"></a><span id="l8.97"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/cookies.dtd</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,28 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+&lt;!ENTITY window.width                      &quot;36em&quot;&gt;</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+&lt;!ENTITY cookiesonsystem.label             &quot;The following cookies are stored on your computer:&quot;&gt;</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+&lt;!ENTITY cookiename.label                  &quot;Cookie Name&quot;&gt;</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+&lt;!ENTITY cookiedomain.label                &quot;Site&quot;&gt;</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+&lt;!ENTITY button.removecookie.label         &quot;Remove Cookie&quot;&gt;</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+&lt;!ENTITY button.removecookie.accesskey     &quot;R&quot;&gt;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+&lt;!ENTITY button.removeallcookies.label     &quot;Remove All Cookies&quot;&gt;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+&lt;!ENTITY button.removeallcookies.accesskey &quot;A&quot;&gt;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+&lt;!ENTITY props.name.label                  &quot;Name:&quot;&gt;</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+&lt;!ENTITY props.value.label                 &quot;Content:&quot;&gt;</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+&lt;!ENTITY props.domain.label                &quot;Host:&quot;&gt;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+&lt;!ENTITY props.path.label                  &quot;Path:&quot;&gt;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+&lt;!ENTITY props.secure.label                &quot;Send For:&quot;&gt;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+&lt;!ENTITY props.expires.label               &quot;Expires:&quot;&gt;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+&lt;!ENTITY window.title                      &quot;Cookies&quot;&gt;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+&lt;!ENTITY windowClose.key                   &quot;w&quot;&gt;</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+&lt;!ENTITY focusSearch1.key                  &quot;f&quot;&gt;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+&lt;!ENTITY focusSearch2.key                  &quot;k&quot;&gt;</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+&lt;!ENTITY filter.label                      &quot;Search:&quot;&gt;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+&lt;!ENTITY filter.accesskey                  &quot;S&quot;&gt;</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+&lt;!ENTITY button.close.label                &quot;Close&quot;&gt;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+&lt;!ENTITY button.close.accesskey            &quot;C&quot;&gt;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/permissions.dtd</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,22 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+&lt;!ENTITY window.title                 &quot;Exceptions&quot;&gt;</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+&lt;!ENTITY window.width                 &quot;36em&quot;&gt;</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+&lt;!ENTITY treehead.sitename.label      &quot;Site&quot;&gt;</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+&lt;!ENTITY treehead.status.label        &quot;Status&quot;&gt;</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+&lt;!ENTITY removepermission.label       &quot;Remove Site&quot;&gt;</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+&lt;!ENTITY removepermission.accesskey   &quot;R&quot;&gt;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+&lt;!ENTITY removeallpermissions.label   &quot;Remove All Sites&quot;&gt;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+&lt;!ENTITY removeallpermissions.accesskey &quot;e&quot;&gt;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+&lt;!ENTITY address.label                &quot;Address of web site:&quot;&gt;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+&lt;!ENTITY address.accesskey            &quot;d&quot;&gt;</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+&lt;!ENTITY block.label                  &quot;Block&quot;&gt;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+&lt;!ENTITY block.accesskey              &quot;B&quot;&gt;</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+&lt;!ENTITY session.label                &quot;Allow for Session&quot;&gt;</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+&lt;!ENTITY session.accesskey            &quot;S&quot;&gt;</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+&lt;!ENTITY allow.label                  &quot;Allow&quot;&gt;</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+&lt;!ENTITY allow.accesskey              &quot;A&quot;&gt;</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+&lt;!ENTITY windowClose.key              &quot;w&quot;&gt;</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+&lt;!ENTITY button.close.label           &quot;Close&quot;&gt;</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+&lt;!ENTITY button.close.accesskey       &quot;C&quot;&gt;</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/preferences.properties</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/preferences.properties</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -60,8 +60,30 @@ soundFilePickerTitle=Choose Sound</span>
<a href="#l11.4"></a><span id="l11.4"> alreadyDefaultClientTitle=Default Client</span>
<a href="#l11.5"></a><span id="l11.5"> alreadyDefault=%S is already set as your default mail client.</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7"> #### Attachment Reminder</span>
<a href="#l11.8"></a><span id="l11.8"> attachmentReminderAddDialogTitle=Add Keyword</span>
<a href="#l11.9"></a><span id="l11.9"> attachmentReminderAddText=Keyword:</span>
<a href="#l11.10"></a><span id="l11.10"> attachmentReminderEditDialogTitle=Edit Keyword</span>
<a href="#l11.11"></a><span id="l11.11"> attachmentReminderEditText=Keyword:</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+#### Cookies</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+cookiepermissionstitle=Exceptions - Cookies</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+cookiepermissionstext=You can specify which web sites are always or never allowed to use cookies.  Type the exact address of the site you want to manage and then click Block, Allow for Session, or Allow.</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+invalidURI=Please enter a valid hostname</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+invalidURITitle=Invalid Hostname Entered</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+#### Cookie Viewer</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+hostColon=Host:</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+domainColon=Domain:</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+forSecureOnly=Encrypted connections only</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+forAnyConnection=Any type of connection</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+AtEndOfSession=at end of session</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+can=Allow</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+canSession=Allow for Session</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+cannot=Block</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+noCookieSelected=&lt;no cookie selected&gt;</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+cookiesAll=The following cookies are stored on your computer:</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+cookiesFiltered=The following cookies match your search:</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+removeCookies=Remove Cookies</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+removeCookie=Remove Cookie</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/security.dtd</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/security.dtd</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1,12 +1,13 @@</span>
<a href="#l12.4"></a><span id="l12.4"> &lt;!ENTITY itemJunk.label          &quot;Junk&quot;&gt;</span>
<a href="#l12.5"></a><span id="l12.5"> &lt;!ENTITY itemPhishing.label      &quot;E-mail Scams&quot;&gt;</span>
<a href="#l12.6"></a><span id="l12.6"> &lt;!ENTITY itemPasswords.label     &quot;Passwords&quot;&gt;</span>
<a href="#l12.7"></a><span id="l12.7"> &lt;!ENTITY itemAntiVirus.label     &quot;Anti-Virus&quot;&gt;</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+&lt;!ENTITY itemCookies.label       &quot;Web Content&quot;&gt;</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10"> &lt;!-- Junk Mail Controls --&gt;</span>
<a href="#l12.11"></a><span id="l12.11"> &lt;!ENTITY junkMail.intro &quot;Set your default junk mail settings. Account-specific junk mail settings can be configured in Account Settings.&quot;&gt;</span>
<a href="#l12.12"></a><span id="l12.12"> &lt;!ENTITY manualMark.label &quot;When I mark messages as junk:&quot;&gt;</span>
<a href="#l12.13"></a><span id="l12.13"> &lt;!ENTITY manualMark.accesskey &quot;W&quot;&gt;</span>
<a href="#l12.14"></a><span id="l12.14"> &lt;!ENTITY manualMarkModeMove.label &quot;Move them to the account's &amp;quot;Junk&amp;quot; folder&quot;&gt;</span>
<a href="#l12.15"></a><span id="l12.15"> &lt;!ENTITY manualMarkModeMove.accesskey &quot;o&quot;&gt;</span>
<a href="#l12.16"></a><span id="l12.16"> &lt;!ENTITY manualMarkModeDelete.label &quot;Delete them&quot;&gt;</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineat">@@ -36,8 +37,23 @@</span>
<a href="#l12.18"></a><span id="l12.18"> &lt;!ENTITY changeMasterPassword.accesskey &quot;C&quot;&gt;</span>
<a href="#l12.19"></a><span id="l12.19"> &lt;!ENTITY savedPasswords.label           &quot;Saved Passwords…&quot;&gt;</span>
<a href="#l12.20"></a><span id="l12.20"> &lt;!ENTITY savedPasswords.accesskey       &quot;S&quot;&gt;</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22"> &lt;!-- Anti Virus --&gt;</span>
<a href="#l12.23"></a><span id="l12.23"> &lt;!ENTITY antiVirus.intro      &quot;&amp;brandShortName; can make it easy for anti-virus software to analyze incoming mail messages for viruses before they are stored locally.&quot;&gt;</span>
<a href="#l12.24"></a><span id="l12.24"> &lt;!ENTITY antiVirus.label      &quot;Allow anti-virus clients to quarantine individual incoming messages&quot;&gt;</span>
<a href="#l12.25"></a><span id="l12.25"> &lt;!ENTITY antiVirus.accesskey  &quot;A&quot;&gt;</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineplus">+&lt;!-- Cookies --&gt;</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+&lt;!ENTITY cookies.intro                  &quot;&amp;brandShortName; lets you specify which blogs, news feeds, and other web sites are allowed to set cookies.&quot;&gt;</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+&lt;!ENTITY acceptCookies.label            &quot;Accept cookies from sites&quot;&gt;</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+&lt;!ENTITY acceptCookies.accesskey        &quot;c&quot;&gt;</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+&lt;!ENTITY keepUntil.label                &quot;Keep until:&quot;&gt;</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+&lt;!ENTITY keepUntil.accesskey            &quot;K&quot;&gt;</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+&lt;!ENTITY expire.label                   &quot;they expire&quot;&gt;</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+&lt;!ENTITY close.label                    &quot;I close &amp;brandShortName;&quot;&gt;</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+&lt;!ENTITY askEachTime.label              &quot;ask me every time&quot;&gt;</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+&lt;!ENTITY cookieExceptions.label         &quot;Exceptions…&quot;&gt;</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+&lt;!ENTITY cookieExceptions.accesskey     &quot;E&quot;&gt;</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+&lt;!ENTITY showCookies.label              &quot;Show Cookies…&quot;&gt;</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+&lt;!ENTITY showCookies.accesskey          &quot;S&quot;&gt;</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/locales/jar.mn</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/locales/jar.mn</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -130,16 +130,18 @@</span>
<a href="#l13.4"></a><span id="l13.4">   locale/@AB_CD@/messenger/preferences/connection.dtd                   (%chrome/messenger/preferences/connection.dtd)</span>
<a href="#l13.5"></a><span id="l13.5">   locale/@AB_CD@/messenger/preferences/applications.dtd                 (%chrome/messenger/preferences/applications.dtd)</span>
<a href="#l13.6"></a><span id="l13.6">   locale/@AB_CD@/messenger/preferences/applicationManager.dtd           (%chrome/messenger/preferences/applicationManager.dtd)</span>
<a href="#l13.7"></a><span id="l13.7">   locale/@AB_CD@/messenger/preferences/applicationManager.properties    (%chrome/messenger/preferences/applicationManager.properties)</span>
<a href="#l13.8"></a><span id="l13.8">   locale/@AB_CD@/messenger/preferences/fonts.dtd                        (%chrome/messenger/preferences/fonts.dtd)</span>
<a href="#l13.9"></a><span id="l13.9">   locale/@AB_CD@/messenger/preferences/offline.dtd                      (%chrome/messenger/preferences/offline.dtd)</span>
<a href="#l13.10"></a><span id="l13.10">   locale/@AB_CD@/messenger/preferences/notifications.dtd                (%chrome/messenger/preferences/notifications.dtd)</span>
<a href="#l13.11"></a><span id="l13.11">   locale/@AB_CD@/messenger/preferences/preferences.properties           (%chrome/messenger/preferences/preferences.properties)</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+  locale/@AB_CD@/messenger/preferences/cookies.dtd                      (%chrome/messenger/preferences/cookies.dtd)</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  locale/@AB_CD@/messenger/preferences/permissions.dtd                  (%chrome/messenger/preferences/permissions.dtd)</span>
<a href="#l13.14"></a><span id="l13.14">   locale/@AB_CD@/messenger/migration/migration.dtd                      (%chrome/messenger/migration/migration.dtd)</span>
<a href="#l13.15"></a><span id="l13.15">   locale/@AB_CD@/messenger/migration/migration.properties               (%chrome/messenger/migration/migration.properties)</span>
<a href="#l13.16"></a><span id="l13.16">   locale/@AB_CD@/messenger/searchIntegrationWin.dtd                     (%chrome/messenger/searchIntegrationWin.dtd)</span>
<a href="#l13.17"></a><span id="l13.17">   locale/@AB_CD@/messenger/searchIntegrationMac.dtd                     (%chrome/messenger/searchIntegrationMac.dtd)</span>
<a href="#l13.18"></a><span id="l13.18">   locale/@AB_CD@/messenger/searchIntegrationDefault.dtd                 (%chrome/messenger/searchIntegrationDefault.dtd)</span>
<a href="#l13.19"></a><span id="l13.19">   locale/@AB_CD@/messenger/activity.dtd                                 (%chrome/messenger/activity.dtd)</span>
<a href="#l13.20"></a><span id="l13.20">   locale/@AB_CD@/messenger/activity.properties                          (%chrome/messenger/activity.properties)</span>
<a href="#l13.21"></a><span id="l13.21">   locale/@AB_CD@/messenger/downloads/settingsChange.dtd                 (%chrome/overrides/settingsChange.dtd)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/themes/pinstripe/mail/preferences/preferences.css</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/themes/pinstripe/mail/preferences/preferences.css</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -34,16 +34,28 @@</span>
<a href="#l14.4"></a><span id="l14.4"> # decision by deleting the provisions above and replace them with the notice</span>
<a href="#l14.5"></a><span id="l14.5"> # and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l14.6"></a><span id="l14.6"> # the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.7"></a><span id="l14.7"> # the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.8"></a><span id="l14.8"> #</span>
<a href="#l14.9"></a><span id="l14.9"> # ***** END LICENSE BLOCK *****</span>
<a href="#l14.10"></a><span id="l14.10"> */</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+.windowDialog {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  padding: 12px;</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+  font: -moz-dialog;</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+}</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+#permissionsText {</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+  font: small-caption;</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+  font-weight: normal;</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+  line-height: 1.3em;</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+  margin-bottom: 4px !important;</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+}</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+</span>
<a href="#l14.24"></a><span id="l14.24"> #MailPreferences:not([active=&quot;true&quot;]) &gt; .paneSelector &gt; radio {</span>
<a href="#l14.25"></a><span id="l14.25">   opacity: 0.7;</span>
<a href="#l14.26"></a><span id="l14.26"> }</span>
<a href="#l14.27"></a><span id="l14.27"> </span>
<a href="#l14.28"></a><span id="l14.28"> menulist &gt; menupopup &gt; menuitem {</span>
<a href="#l14.29"></a><span id="l14.29">   font: -moz-pull-down-menu;</span>
<a href="#l14.30"></a><span id="l14.30"> }</span>
<a href="#l14.31"></a><span id="l14.31">  </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

