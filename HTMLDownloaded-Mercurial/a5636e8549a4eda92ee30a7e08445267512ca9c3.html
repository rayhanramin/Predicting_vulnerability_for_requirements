<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 18282:a5636e8549a4eda92ee30a7e08445267512ca9c3</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a5636e8549a4eda92ee30a7e08445267512ca9c3" />
<meta property="og:url" content="/comm-central/rev/a5636e8549a4eda92ee30a7e08445267512ca9c3" />
<meta property="og:description" content="Fix bug 1189109 - Errors in import of .ics file: &quot;Component does not have requested interface [calIOperationListener.onOperationComplete]&quot;  nsresult: &quot;0x80004002 (NS_NOINTERFACE)&quot;. r=redDragon" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a5636e8549a4eda92ee30a7e08445267512ca9c3 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a5636e8549a4eda92ee30a7e08445267512ca9c3">shortlog</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a5636e8549a4eda92ee30a7e08445267512ca9c3">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3">files</a> |
changeset |
<a href="/comm-central/raw-rev/a5636e8549a4eda92ee30a7e08445267512ca9c3">raw</a>  | <a href="/comm-central/archive/a5636e8549a4eda92ee30a7e08445267512ca9c3.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1189109">bug 1189109</a> - Errors in import of .ics file: &quot;Component does not have requested interface [calIOperationListener.onOperationComplete]&quot;  nsresult: &quot;0x80004002 (NS_NOINTERFACE)&quot;. r=redDragon
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 08 Aug 2015 12:38:57 +0100</td></tr>

<tr>
 <td>changeset 18282</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a5636e8549a4eda92ee30a7e08445267512ca9c3">a5636e8549a4eda92ee30a7e08445267512ca9c3</a></td>
</tr>



<tr>
<td>parent 18281</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f5e8bee91fc8b2a4a4146bb5b6b24f44ba11decd">f5e8bee91fc8b2a4a4146bb5b6b24f44ba11decd</a>
</td>
</tr>

<tr>
<td>child 18283</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e6c5bce2b8fb6859970e1197ca0027a251693dc1">e6c5bce2b8fb6859970e1197ca0027a251693dc1</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a5636e8549a4eda92ee30a7e08445267512ca9c3">11222</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Tue, 25 Aug 2015 09:07:01 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@e6c5bce2b8fb [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=e6c5bce2b8fb6859970e1197ca0027a251693dc1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=e6c5bce2b8fb6859970e1197ca0027a251693dc1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e6c5bce2b8fb6859970e1197ca0027a251693dc1&newProject=comm-central&newRevision=045d1e8fe4fca3ce03eeb680a548ecdb56cc94f4&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e6c5bce2b8fb6859970e1197ca0027a251693dc1&newProject=comm-central&newRevision=045d1e8fe4fca3ce03eeb680a548ecdb56cc94f4&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e6c5bce2b8fb6859970e1197ca0027a251693dc1&newProject=comm-central&newRevision=045d1e8fe4fca3ce03eeb680a548ecdb56cc94f4&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28redDragon%29&revcount=50">redDragon</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1189109">1189109</a></td></tr>




</table></div>

<div class="page_body description">Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1189109">bug 1189109</a> - Errors in import of .ics file: &quot;Component does not have requested interface [calIOperationListener.onOperationComplete]&quot;  nsresult: &quot;0x80004002 (NS_NOINTERFACE)&quot;. r=redDragon</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-invitations-manager.js">calendar/base/content/calendar-invitations-manager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-invitations-manager.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-invitations-manager.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-invitations-manager.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-invitations-manager.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-invitations-manager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-event-dialog.js">calendar/base/content/dialogs/calendar-event-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-event-dialog.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-event-dialog.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-event-dialog.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-event-dialog.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-event-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-invitations-dialog.js">calendar/base/content/dialogs/calendar-invitations-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-invitations-dialog.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-invitations-dialog.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-invitations-dialog.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-invitations-dialog.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-invitations-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-print-dialog.js">calendar/base/content/dialogs/calendar-print-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-print-dialog.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-print-dialog.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-print-dialog.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-print-dialog.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/dialogs/calendar-print-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/import-export.js">calendar/base/content/import-export.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/import-export.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/import-export.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/import-export.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/import-export.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/content/import-export.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calAsyncUtils.jsm">calendar/base/modules/calAsyncUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calAsyncUtils.jsm">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calAsyncUtils.jsm">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calAsyncUtils.jsm">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calAsyncUtils.jsm">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calAsyncUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calAlarmService.js">calendar/base/src/calAlarmService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calAlarmService.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calAlarmService.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calAlarmService.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calAlarmService.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calAlarmService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calCachedCalendar.js">calendar/base/src/calCachedCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calCachedCalendar.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calCachedCalendar.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calCachedCalendar.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calCachedCalendar.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calCachedCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/imip-bar.js">calendar/lightning/content/imip-bar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/imip-bar.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/imip-bar.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/imip-bar.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/imip-bar.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/imip-bar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/messenger-overlay-sidebar.js">calendar/lightning/content/messenger-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/messenger-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/messenger-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/messenger-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/messenger-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/lightning/content/messenger-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/gdata/modules/shim/Calendar.jsm">calendar/providers/gdata/modules/shim/Calendar.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/gdata/modules/shim/Calendar.jsm">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/gdata/modules/shim/Calendar.jsm">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/gdata/modules/shim/Calendar.jsm">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/gdata/modules/shim/Calendar.jsm">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/gdata/modules/shim/Calendar.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/wcap/calWcapCalendarItems.js">calendar/providers/wcap/calWcapCalendarItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/wcap/calWcapCalendarItems.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/wcap/calWcapCalendarItems.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/wcap/calWcapCalendarItems.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/wcap/calWcapCalendarItems.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/providers/wcap/calWcapCalendarItems.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/resources/content/publish.js">calendar/resources/content/publish.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/resources/content/publish.js">file</a> |
<a href="/comm-central/annotate/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/resources/content/publish.js">annotate</a> |
<a href="/comm-central/diff/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/resources/content/publish.js">diff</a> |
<a href="/comm-central/comparison/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/resources/content/publish.js">comparison</a> |
<a href="/comm-central/log/a5636e8549a4eda92ee30a7e08445267512ca9c3/calendar/resources/content/publish.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.5"></a><span id="l1.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.6"></a><span id="l1.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l1.9"></a><span id="l1.9"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12"> function Synthetic(aOpen, aDuration) {</span>
<a href="#l1.13"></a><span id="l1.13">     this.open = aOpen;</span>
<a href="#l1.14"></a><span id="l1.14">     this.duration = aDuration;</span>
<a href="#l1.15"></a><span id="l1.15"> }</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> var agendaListbox = {</span>
<a href="#l1.18"></a><span id="l1.18">     agendaListboxControl: null,</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineat">@@ -614,16 +615,17 @@ function setupContextMenu(popup) {</span>
<a href="#l1.20"></a><span id="l1.20">  * @param aStart        (optional) The start date for the item query.</span>
<a href="#l1.21"></a><span id="l1.21">  * @param aEnd          (optional) The end date for the item query.</span>
<a href="#l1.22"></a><span id="l1.22">  * @param aCalendar     (optional) If specified, the single calendar from</span>
<a href="#l1.23"></a><span id="l1.23">  *                                   which the refresh will occur.</span>
<a href="#l1.24"></a><span id="l1.24">  */</span>
<a href="#l1.25"></a><span id="l1.25"> agendaListbox.refreshCalendarQuery =</span>
<a href="#l1.26"></a><span id="l1.26"> function refreshCalendarQuery(aStart, aEnd, aCalendar) {</span>
<a href="#l1.27"></a><span id="l1.27">     let refreshJob = {</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l1.29"></a><span id="l1.29">         agendaListbox: this,</span>
<a href="#l1.30"></a><span id="l1.30">         calendar: null,</span>
<a href="#l1.31"></a><span id="l1.31">         calId: null,</span>
<a href="#l1.32"></a><span id="l1.32">         operation: null,</span>
<a href="#l1.33"></a><span id="l1.33">         cancelled: false,</span>
<a href="#l1.34"></a><span id="l1.34"> </span>
<a href="#l1.35"></a><span id="l1.35">         onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l1.36"></a><span id="l1.36">             if (this.agendaListbox.mPendingRefreshJobs.has(this.calId)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -448,16 +448,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">           this.addItemsFromCalendar(this.mCalendar);</span>
<a href="#l2.5"></a><span id="l2.5">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.6"></a><span id="l2.6">       &lt;/method&gt;</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8">       &lt;method name=&quot;addItemsFromCalendar&quot;&gt;</span>
<a href="#l2.9"></a><span id="l2.9">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l2.10"></a><span id="l2.10">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.11"></a><span id="l2.11">           let refreshJob = {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+              QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l2.13"></a><span id="l2.13">               calView: this,</span>
<a href="#l2.14"></a><span id="l2.14">               calendar: null,</span>
<a href="#l2.15"></a><span id="l2.15">               calId: null,</span>
<a href="#l2.16"></a><span id="l2.16">               operation: null,</span>
<a href="#l2.17"></a><span id="l2.17">               cancelled: false,</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">               onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l2.20"></a><span id="l2.20">                   this.calView.mLog.info(&quot;Refresh complete of calendar &quot; + this.calId);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.5"></a><span id="l3.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.6"></a><span id="l3.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l3.9"></a><span id="l3.9"> Components.utils.import(&quot;resource://calendar/modules/calItipUtils.jsm&quot;);</span>
<a href="#l3.10"></a><span id="l3.10"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l3.12"></a><span id="l3.12"> </span>
<a href="#l3.13"></a><span id="l3.13"> /**</span>
<a href="#l3.14"></a><span id="l3.14">  * This object contains functions to take care of manipulating requests.</span>
<a href="#l3.15"></a><span id="l3.15">  */</span>
<a href="#l3.16"></a><span id="l3.16"> var gInvitationsRequestManager = {</span>
<a href="#l3.17"></a><span id="l3.17">     mRequestStatusList: {},</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">     /**</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineat">@@ -125,16 +126,17 @@ InvitationsManager.prototype = {</span>
<a href="#l3.21"></a><span id="l3.21"> </span>
<a href="#l3.22"></a><span id="l3.22">         gInvitationsRequestManager.cancelPendingRequests();</span>
<a href="#l3.23"></a><span id="l3.23">         this.updateStartDate();</span>
<a href="#l3.24"></a><span id="l3.24">         this.deleteAllItems();</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">         var cals = getCalendarManager().getCalendars({});</span>
<a href="#l3.27"></a><span id="l3.27"> </span>
<a href="#l3.28"></a><span id="l3.28">         var opListener = {</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l3.30"></a><span id="l3.30">             mCount: cals.length,</span>
<a href="#l3.31"></a><span id="l3.31">             mRequestManager: gInvitationsRequestManager,</span>
<a href="#l3.32"></a><span id="l3.32">             mInvitationsManager: this,</span>
<a href="#l3.33"></a><span id="l3.33">             mHandledItems: {},</span>
<a href="#l3.34"></a><span id="l3.34"> </span>
<a href="#l3.35"></a><span id="l3.35">             // calIOperationListener</span>
<a href="#l3.36"></a><span id="l3.36">             onOperationComplete: function(aCalendar,</span>
<a href="#l3.37"></a><span id="l3.37">                                           aStatus,</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineat">@@ -266,16 +268,17 @@ InvitationsManager.prototype = {</span>
<a href="#l3.39"></a><span id="l3.39">                                                  jobQueueFinishedCallBack) {</span>
<a href="#l3.40"></a><span id="l3.40">         // TODO: undo/redo</span>
<a href="#l3.41"></a><span id="l3.41">         function operationListener(mgr, queueCallback, oldItem_) {</span>
<a href="#l3.42"></a><span id="l3.42">             this.mInvitationsManager = mgr;</span>
<a href="#l3.43"></a><span id="l3.43">             this.mJobQueueFinishedCallBack = queueCallback;</span>
<a href="#l3.44"></a><span id="l3.44">             this.mOldItem = oldItem_;</span>
<a href="#l3.45"></a><span id="l3.45">         }</span>
<a href="#l3.46"></a><span id="l3.46">         operationListener.prototype = {</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l3.48"></a><span id="l3.48">             onOperationComplete: function (aCalendar,</span>
<a href="#l3.49"></a><span id="l3.49">                                            aStatus,</span>
<a href="#l3.50"></a><span id="l3.50">                                            aOperationType,</span>
<a href="#l3.51"></a><span id="l3.51">                                            aId,</span>
<a href="#l3.52"></a><span id="l3.52">                                            aDetail) {</span>
<a href="#l3.53"></a><span id="l3.53">                 if (Components.isSuccessCode(aStatus) &amp;&amp;</span>
<a href="#l3.54"></a><span id="l3.54">                     aOperationType == Components.interfaces.calIOperationListener.MODIFY) {</span>
<a href="#l3.55"></a><span id="l3.55">                     cal.itip.checkAndSend(aOperationType, aDetail, this.mOldItem);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -912,16 +912,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.6"></a><span id="l4.6">       &lt;/method&gt;</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">       &lt;method name=&quot;refreshFromCalendar&quot;&gt;</span>
<a href="#l4.9"></a><span id="l4.9">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l4.10"></a><span id="l4.10">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.11"></a><span id="l4.11">           let refreshJob = {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+              QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l4.13"></a><span id="l4.13">               binding: this,</span>
<a href="#l4.14"></a><span id="l4.14">               calendar: null,</span>
<a href="#l4.15"></a><span id="l4.15">               items: null,</span>
<a href="#l4.16"></a><span id="l4.16">               operation: null,</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18">               onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l4.19"></a><span id="l4.19">                   if (aCalendar.id in this.binding.mPendingRefreshJobs) {</span>
<a href="#l4.20"></a><span id="l4.20">                       delete this.binding.mPendingRefreshJobs[aCalendar.id];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -874,16 +874,17 @@ function addItemsFromSingleCalendarInter</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> function addItemsFromCalendar(aCalendar, aAddItemsInternalFunc) {</span>
<a href="#l5.6"></a><span id="l5.6">     if (isUnifinderHidden()) {</span>
<a href="#l5.7"></a><span id="l5.7">         // If the unifinder is hidden, don't refresh the events to reduce needed</span>
<a href="#l5.8"></a><span id="l5.8">         // getItems calls.</span>
<a href="#l5.9"></a><span id="l5.9">         return;</span>
<a href="#l5.10"></a><span id="l5.10">     }</span>
<a href="#l5.11"></a><span id="l5.11">     var refreshListener = {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l5.13"></a><span id="l5.13">         mEventArray: [],</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15">         onOperationComplete: function rET_onOperationComplete(aCalendar,</span>
<a href="#l5.16"></a><span id="l5.16">                                                               aStatus,</span>
<a href="#l5.17"></a><span id="l5.17">                                                               aOperationType,</span>
<a href="#l5.18"></a><span id="l5.18">                                                               aId,</span>
<a href="#l5.19"></a><span id="l5.19">                                                               aDateTime) {</span>
<a href="#l5.20"></a><span id="l5.20">             var refreshTreeInternalFunc = function() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -627,16 +627,17 @@ function editSelectedEvents() {</span>
<a href="#l6.4"></a><span id="l6.4"> }</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> /**</span>
<a href="#l6.7"></a><span id="l6.7">  * Select all events from all calendars. Use with care.</span>
<a href="#l6.8"></a><span id="l6.8">  */</span>
<a href="#l6.9"></a><span id="l6.9"> function selectAllEvents() {</span>
<a href="#l6.10"></a><span id="l6.10">     var items = [];</span>
<a href="#l6.11"></a><span id="l6.11">     var listener = {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l6.13"></a><span id="l6.13">         onOperationComplete: function selectAll_ooc(aCalendar, aStatus,</span>
<a href="#l6.14"></a><span id="l6.14">                                                     aOperationType, aId,</span>
<a href="#l6.15"></a><span id="l6.15">                                                     aDetail) {</span>
<a href="#l6.16"></a><span id="l6.16">             currentView().setSelectedItems(items.length, items, false);</span>
<a href="#l6.17"></a><span id="l6.17">         },</span>
<a href="#l6.18"></a><span id="l6.18">         onGetResult: function selectAll_ogr(aCalendar, aStatus, aItemType,</span>
<a href="#l6.19"></a><span id="l6.19">                                             aDetail, aCount, aItems) {</span>
<a href="#l6.20"></a><span id="l6.20">             for each (var item in aItems) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -3,16 +3,17 @@</span>
<a href="#l7.4"></a><span id="l7.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l7.7"></a><span id="l7.7"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l7.8"></a><span id="l7.8"> Components.utils.import(&quot;resource://calendar/modules/calRecurrenceUtils.jsm&quot;);</span>
<a href="#l7.9"></a><span id="l7.9"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l7.10"></a><span id="l7.10"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l7.11"></a><span id="l7.11"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l7.13"></a><span id="l7.13"> </span>
<a href="#l7.14"></a><span id="l7.14"> try {</span>
<a href="#l7.15"></a><span id="l7.15">     Components.utils.import(&quot;resource:///modules/cloudFileAccounts.js&quot;);</span>
<a href="#l7.16"></a><span id="l7.16"> } catch (e) {</span>
<a href="#l7.17"></a><span id="l7.17">     // This will fail on Seamonkey, but thats ok since the pref for cloudfiles</span>
<a href="#l7.18"></a><span id="l7.18">     // is false, which means the UI will not be shown</span>
<a href="#l7.19"></a><span id="l7.19"> }</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -2879,16 +2880,17 @@ function onCommandSave(aIsClosing) {</span>
<a href="#l7.22"></a><span id="l7.22">     // When the call is complete, we need to set the new item, so that the</span>
<a href="#l7.23"></a><span id="l7.23">     // dialog is up to date.</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25">     // XXX Do we want to disable the dialog or at least the save button until</span>
<a href="#l7.26"></a><span id="l7.26">     // the call is complete? This might help when the user tries to save twice</span>
<a href="#l7.27"></a><span id="l7.27">     // before the call is complete. In that case, we do need a progress bar and</span>
<a href="#l7.28"></a><span id="l7.28">     // the ability to cancel the operation though.</span>
<a href="#l7.29"></a><span id="l7.29">     var listener = {</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l7.31"></a><span id="l7.31">         onOperationComplete: function(aCalendar, aStatus, aOpType, aId, aItem) {</span>
<a href="#l7.32"></a><span id="l7.32">             // Check if the current window has a calendarItem first, because in case of undo</span>
<a href="#l7.33"></a><span id="l7.33">             // window refers to the main window and we would get a 'calendarItem is undefined' warning.</span>
<a href="#l7.34"></a><span id="l7.34">             if (&quot;calendarItem&quot; in window) {</span>
<a href="#l7.35"></a><span id="l7.35">                 // If we changed the calendar of the item, onOperationComplete will be called multiple</span>
<a href="#l7.36"></a><span id="l7.36">                 // times. We need to make sure we're receiving the update on the right calendar.</span>
<a href="#l7.37"></a><span id="l7.37">                 if ((!window.calendarItem.id ||aId == window.calendarItem.id) &amp;&amp;</span>
<a href="#l7.38"></a><span id="l7.38">                     (aCalendar.id == window.calendarItem.calendar.id) &amp;&amp;</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineat">@@ -2906,17 +2908,18 @@ function onCommandSave(aIsClosing) {</span>
<a href="#l7.40"></a><span id="l7.40">                     }</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42">                     // We now have an item, so we must change to an edit.</span>
<a href="#l7.43"></a><span id="l7.43">                     window.mode = &quot;modify&quot;;</span>
<a href="#l7.44"></a><span id="l7.44">                     updateTitle();</span>
<a href="#l7.45"></a><span id="l7.45">                     eventDialogCalendarObserver.observe(window.calendarItem.calendar);</span>
<a href="#l7.46"></a><span id="l7.46">                 }</span>
<a href="#l7.47"></a><span id="l7.47">             }</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-        }</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+        },</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+        onGetResult: function() {}</span>
<a href="#l7.51"></a><span id="l7.51">     };</span>
<a href="#l7.52"></a><span id="l7.52"> </span>
<a href="#l7.53"></a><span id="l7.53">     // Let the caller decide how to handle the modified/added item. Only pass</span>
<a href="#l7.54"></a><span id="l7.54">     // the above item if we are not closing, otherwise the listener will be</span>
<a href="#l7.55"></a><span id="l7.55">     // missing its window afterwards.</span>
<a href="#l7.56"></a><span id="l7.56">     window.onAcceptCallback(item, calendar, originalItem, !aIsClosing &amp;&amp; listener);</span>
<a href="#l7.57"></a><span id="l7.57"> </span>
<a href="#l7.58"></a><span id="l7.58"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-invitations-dialog.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-invitations-dialog.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,21 +1,23 @@</span>
<a href="#l8.4"></a><span id="l8.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.5"></a><span id="l8.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.6"></a><span id="l8.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l8.9"></a><span id="l8.9"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12"> /**</span>
<a href="#l8.13"></a><span id="l8.13">  * Sets up the invitations dialog from the window arguments, retrieves the</span>
<a href="#l8.14"></a><span id="l8.14">  * invitations from the invitations manager.</span>
<a href="#l8.15"></a><span id="l8.15">  */</span>
<a href="#l8.16"></a><span id="l8.16"> function onLoad() {</span>
<a href="#l8.17"></a><span id="l8.17">     var operationListener = {</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l8.19"></a><span id="l8.19">         onOperationComplete: function oL_onOperationComplete(aCalendar,</span>
<a href="#l8.20"></a><span id="l8.20">                                                              aStatus,</span>
<a href="#l8.21"></a><span id="l8.21">                                                              aOperationType,</span>
<a href="#l8.22"></a><span id="l8.22">                                                              aId,</span>
<a href="#l8.23"></a><span id="l8.23">                                                              aDetail) {</span>
<a href="#l8.24"></a><span id="l8.24">             var updatingBox = document.getElementById(&quot;updating-box&quot;);</span>
<a href="#l8.25"></a><span id="l8.25">             updatingBox.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l8.26"></a><span id="l8.26">             var richListBox = document.getElementById(&quot;invitations-listbox&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.5"></a><span id="l9.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.6"></a><span id="l9.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l9.10"></a><span id="l9.10"> </span>
<a href="#l9.11"></a><span id="l9.11"> /**</span>
<a href="#l9.12"></a><span id="l9.12">  * Gets the calendar view from the opening window</span>
<a href="#l9.13"></a><span id="l9.13">  */</span>
<a href="#l9.14"></a><span id="l9.14"> function getCalendarView() {</span>
<a href="#l9.15"></a><span id="l9.15">     let theView = window.opener.currentView();</span>
<a href="#l9.16"></a><span id="l9.16">     if (!theView.startDay) {</span>
<a href="#l9.17"></a><span id="l9.17">         theView = null;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineat">@@ -126,16 +127,17 @@ function getPrintSettings(receiverFunc) </span>
<a href="#l9.19"></a><span id="l9.19">     default:</span>
<a href="#l9.20"></a><span id="l9.20">         dump(&quot;Error : no case in printDialog.js::printCalendar()&quot;);</span>
<a href="#l9.21"></a><span id="l9.21">     }</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23">     // Some filters above might have filled the events list themselves. If not,</span>
<a href="#l9.24"></a><span id="l9.24">     // then fetch the items here.</span>
<a href="#l9.25"></a><span id="l9.25">     if (requiresFetch) {</span>
<a href="#l9.26"></a><span id="l9.26">         let listener = {</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l9.28"></a><span id="l9.28">             onOperationComplete:</span>
<a href="#l9.29"></a><span id="l9.29">             function onOperationComplete(aCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l9.30"></a><span id="l9.30">                 receiverFunc(settings);</span>
<a href="#l9.31"></a><span id="l9.31">             },</span>
<a href="#l9.32"></a><span id="l9.32">             onGetResult:</span>
<a href="#l9.33"></a><span id="l9.33">             function onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l9.34"></a><span id="l9.34">                 settings.eventList = settings.eventList.concat(aItems);</span>
<a href="#l9.35"></a><span id="l9.35">                 if (!settings.printTasksWithNoDueDate) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/import-export.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/import-export.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,12 +1,14 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.5"></a><span id="l10.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.6"></a><span id="l10.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+</span>
<a href="#l10.10"></a><span id="l10.10"> // File constants copied from file-utils.js</span>
<a href="#l10.11"></a><span id="l10.11"> const MODE_RDONLY   = 0x01;</span>
<a href="#l10.12"></a><span id="l10.12"> const MODE_WRONLY   = 0x02;</span>
<a href="#l10.13"></a><span id="l10.13"> const MODE_RDWR     = 0x04;</span>
<a href="#l10.14"></a><span id="l10.14"> const MODE_CREATE   = 0x08;</span>
<a href="#l10.15"></a><span id="l10.15"> const MODE_APPEND   = 0x10;</span>
<a href="#l10.16"></a><span id="l10.16"> const MODE_TRUNCATE = 0x20;</span>
<a href="#l10.17"></a><span id="l10.17"> const MODE_SYNC     = 0x40;</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineat">@@ -147,16 +149,17 @@ function putItemsIntoCal(destCal, aItems</span>
<a href="#l10.19"></a><span id="l10.19">     var duplicateCount = 0;</span>
<a href="#l10.20"></a><span id="l10.20">     // Used to store the last error. Only the last error, because we don't</span>
<a href="#l10.21"></a><span id="l10.21">     // wan't to bomb the user with thousands of error messages in case</span>
<a href="#l10.22"></a><span id="l10.22">     // something went really wrong.</span>
<a href="#l10.23"></a><span id="l10.23">     // (example of something very wrong: importing the same file twice.</span>
<a href="#l10.24"></a><span id="l10.24">     //  quite easy to trigger, so we really should do this)</span>
<a href="#l10.25"></a><span id="l10.25">     var lastError;</span>
<a href="#l10.26"></a><span id="l10.26">     var listener = {</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l10.28"></a><span id="l10.28">         onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDetail) {</span>
<a href="#l10.29"></a><span id="l10.29">             count++;</span>
<a href="#l10.30"></a><span id="l10.30">             if (!Components.isSuccessCode(aStatus)) {</span>
<a href="#l10.31"></a><span id="l10.31">                 if (aStatus == Components.interfaces.calIErrors.DUPLICATE_ID) {</span>
<a href="#l10.32"></a><span id="l10.32">                     duplicateCount++;</span>
<a href="#l10.33"></a><span id="l10.33">                 } else {</span>
<a href="#l10.34"></a><span id="l10.34">                     failedCount++;</span>
<a href="#l10.35"></a><span id="l10.35">                     lastError = aStatus;</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineat">@@ -313,16 +316,17 @@ function saveEventsToFile(calendarEventA</span>
<a href="#l10.37"></a><span id="l10.37">  * Exports all the events and tasks in a calendar.  If aCalendar is not specified,</span>
<a href="#l10.38"></a><span id="l10.38">  * the user will be prompted with a list of calendars to choose which one to export.</span>
<a href="#l10.39"></a><span id="l10.39">  *</span>
<a href="#l10.40"></a><span id="l10.40">  * @param aCalendar     (optional) A specific calendar to export</span>
<a href="#l10.41"></a><span id="l10.41">  */</span>
<a href="#l10.42"></a><span id="l10.42"> function exportEntireCalendar(aCalendar) {</span>
<a href="#l10.43"></a><span id="l10.43">     var itemArray = [];</span>
<a href="#l10.44"></a><span id="l10.44">     var getListener = {</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l10.46"></a><span id="l10.46">         onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDetail)</span>
<a href="#l10.47"></a><span id="l10.47">         {</span>
<a href="#l10.48"></a><span id="l10.48">             saveEventsToFile(itemArray, aCalendar.name);</span>
<a href="#l10.49"></a><span id="l10.49">         },</span>
<a href="#l10.50"></a><span id="l10.50">         onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems)</span>
<a href="#l10.51"></a><span id="l10.51">         {</span>
<a href="#l10.52"></a><span id="l10.52">             for each (let item in aItems) {</span>
<a href="#l10.53"></a><span id="l10.53">                 itemArray.push(item);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/modules/calAsyncUtils.jsm</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/modules/calAsyncUtils.jsm</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.5"></a><span id="l11.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.6"></a><span id="l11.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l11.9"></a><span id="l11.9"> Components.utils.import(&quot;resource://gre/modules/Promise.jsm&quot;);</span>
<a href="#l11.10"></a><span id="l11.10"> Components.utils.import(&quot;resource://gre/modules/PromiseUtils.jsm&quot;);</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l11.12"></a><span id="l11.12"> </span>
<a href="#l11.13"></a><span id="l11.13"> /*</span>
<a href="#l11.14"></a><span id="l11.14">  * Asynchronous tools for handling calendar operations.</span>
<a href="#l11.15"></a><span id="l11.15">  */</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17"> this.EXPORTED_SYMBOLS = [&quot;cal&quot;]; // even though it's defined in calUtils.jsm, import needs this</span>
<a href="#l11.18"></a><span id="l11.18"> const cIOL = Components.interfaces.calIOperationListener;</span>
<a href="#l11.19"></a><span id="l11.19"> const cIC = Components.interfaces.calICalendar;</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineat">@@ -87,16 +88,17 @@ cal.async = {</span>
<a href="#l11.21"></a><span id="l11.21">      * See also promisifyCalendar, where the above can be replaced with:</span>
<a href="#l11.22"></a><span id="l11.22">      *   function promiseAddItem(aItem) {</span>
<a href="#l11.23"></a><span id="l11.23">      *     let calendar = cal.async.promisifyCalendar(aItem.calendar);</span>
<a href="#l11.24"></a><span id="l11.24">      *     return calendar.addItem(aItem);</span>
<a href="#l11.25"></a><span id="l11.25">      *   }</span>
<a href="#l11.26"></a><span id="l11.26">      */</span>
<a href="#l11.27"></a><span id="l11.27">     promiseOperationListener: function(deferred) {</span>
<a href="#l11.28"></a><span id="l11.28">         return {</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l11.30"></a><span id="l11.30">             items: [],</span>
<a href="#l11.31"></a><span id="l11.31">             itemStatus: Components.results.NS_OK,</span>
<a href="#l11.32"></a><span id="l11.32">             onGetResult: function(aCalendar, aStatus, aItemType, aDetail,</span>
<a href="#l11.33"></a><span id="l11.33">                                   aCount, aItems) {</span>
<a href="#l11.34"></a><span id="l11.34">                 this.itemStatus = aStatus;</span>
<a href="#l11.35"></a><span id="l11.35">                 if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l11.36"></a><span id="l11.36">                     this.items = this.items.concat(aItems);</span>
<a href="#l11.37"></a><span id="l11.37">                 } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1038,16 +1038,17 @@ function sendMessage(aItem, aMethod, aRe</span>
<a href="#l12.4"></a><span id="l12.4">  * @param opListener operation listener to forward</span>
<a href="#l12.5"></a><span id="l12.5">  * @param oldItem the previous item before modification (if any)</span>
<a href="#l12.6"></a><span id="l12.6">  */</span>
<a href="#l12.7"></a><span id="l12.7"> function ItipOpListener(opListener, oldItem) {</span>
<a href="#l12.8"></a><span id="l12.8">     this.mOpListener = opListener;</span>
<a href="#l12.9"></a><span id="l12.9">     this.mOldItem = oldItem;</span>
<a href="#l12.10"></a><span id="l12.10"> }</span>
<a href="#l12.11"></a><span id="l12.11"> ItipOpListener.prototype = {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l12.13"></a><span id="l12.13">     onOperationComplete: function ItipOpListener_onOperationComplete(aCalendar,</span>
<a href="#l12.14"></a><span id="l12.14">                                                                      aStatus,</span>
<a href="#l12.15"></a><span id="l12.15">                                                                      aOperationType,</span>
<a href="#l12.16"></a><span id="l12.16">                                                                      aId,</span>
<a href="#l12.17"></a><span id="l12.17">                                                                      aDetail) {</span>
<a href="#l12.18"></a><span id="l12.18">         cal.ASSERT(Components.isSuccessCode(aStatus), &quot;error on iTIP processing&quot;);</span>
<a href="#l12.19"></a><span id="l12.19">         if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l12.20"></a><span id="l12.20">             cal.itip.checkAndSend(aOperationType, aDetail, this.mOldItem);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/src/calAlarmService.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/src/calAlarmService.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -476,16 +476,17 @@ calAlarmService.prototype = {</span>
<a href="#l13.4"></a><span id="l13.4">                 }</span>
<a href="#l13.5"></a><span id="l13.5">                 delete this.mTimerMap[calendar.id]</span>
<a href="#l13.6"></a><span id="l13.6">             }</span>
<a href="#l13.7"></a><span id="l13.7">         }</span>
<a href="#l13.8"></a><span id="l13.8">     },</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10">     findAlarms: function cAS_findAlarms(aCalendars, aStart, aUntil) {</span>
<a href="#l13.11"></a><span id="l13.11">         let getListener = {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l13.13"></a><span id="l13.13">             alarmService: this,</span>
<a href="#l13.14"></a><span id="l13.14">             addRemovePromise: PromiseUtils.defer(),</span>
<a href="#l13.15"></a><span id="l13.15">             onOperationComplete: function cAS_fA_onOperationComplete(aCalendar,</span>
<a href="#l13.16"></a><span id="l13.16">                                                                      aStatus,</span>
<a href="#l13.17"></a><span id="l13.17">                                                                      aOperationType,</span>
<a href="#l13.18"></a><span id="l13.18">                                                                      aId,</span>
<a href="#l13.19"></a><span id="l13.19">                                                                      aDetail) {</span>
<a href="#l13.20"></a><span id="l13.20">                 this.addRemovePromise.promise.then((aValue) =&gt; {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -7,16 +7,17 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l14.4"></a><span id="l14.4"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l14.5"></a><span id="l14.5"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> const calICalendar = Components.interfaces.calICalendar;</span>
<a href="#l14.8"></a><span id="l14.8"> const cICL = Components.interfaces.calIChangeLog;</span>
<a href="#l14.9"></a><span id="l14.9"> const cIOL = Components.interfaces.calIOperationListener;</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> let gNoOpListener = {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l14.13"></a><span id="l14.13">     onGetResult: function(calendar, status, itemType, detail, count, items) {</span>
<a href="#l14.14"></a><span id="l14.14">     },</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16">     onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l14.17"></a><span id="l14.17">     }</span>
<a href="#l14.18"></a><span id="l14.18"> };</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20"> /**</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineat">@@ -50,16 +51,17 @@ function isUnavailableCode(result) {</span>
<a href="#l14.22"></a><span id="l14.22">     }</span>
<a href="#l14.23"></a><span id="l14.23"> }</span>
<a href="#l14.24"></a><span id="l14.24"> </span>
<a href="#l14.25"></a><span id="l14.25"> function calCachedCalendarObserverHelper(home, isCachedObserver) {</span>
<a href="#l14.26"></a><span id="l14.26">     this.home = home;</span>
<a href="#l14.27"></a><span id="l14.27">     this.isCachedObserver = isCachedObserver;</span>
<a href="#l14.28"></a><span id="l14.28"> }</span>
<a href="#l14.29"></a><span id="l14.29"> calCachedCalendarObserverHelper.prototype = {</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIObserver]),</span>
<a href="#l14.31"></a><span id="l14.31">     isCachedObserver: false,</span>
<a href="#l14.32"></a><span id="l14.32"> </span>
<a href="#l14.33"></a><span id="l14.33">     onStartBatch: function() {</span>
<a href="#l14.34"></a><span id="l14.34">         this.home.mObservers.notify(&quot;onStartBatch&quot;);</span>
<a href="#l14.35"></a><span id="l14.35">     },</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37">     onEndBatch: function() {</span>
<a href="#l14.38"></a><span id="l14.38">         this.home.mObservers.notify(&quot;onEndBatch&quot;);</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineat">@@ -219,16 +221,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l14.40"></a><span id="l14.40">             Components.utils.reportError(exc);</span>
<a href="#l14.41"></a><span id="l14.41">         }</span>
<a href="#l14.42"></a><span id="l14.42">     },</span>
<a href="#l14.43"></a><span id="l14.43"> </span>
<a href="#l14.44"></a><span id="l14.44">     getOfflineAddedItems: function cCC_getOfflineAddedItems(callbackFunc) {</span>
<a href="#l14.45"></a><span id="l14.45">         let this_ = this;</span>
<a href="#l14.46"></a><span id="l14.46">         this_.offlineCachedItems = {};</span>
<a href="#l14.47"></a><span id="l14.47">         let getListener = {</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l14.49"></a><span id="l14.49">             onGetResult: function cCC_oOC_cL_onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l14.50"></a><span id="l14.50">                 for each (let item in aItems) {</span>
<a href="#l14.51"></a><span id="l14.51">                     this_.offlineCachedItems[item.hashId] = item;</span>
<a href="#l14.52"></a><span id="l14.52">                     this_.offlineCachedItemFlags[item.hashId] = cICL.OFFLINE_FLAG_CREATED_RECORD;</span>
<a href="#l14.53"></a><span id="l14.53">                 }</span>
<a href="#l14.54"></a><span id="l14.54">             },</span>
<a href="#l14.55"></a><span id="l14.55"> </span>
<a href="#l14.56"></a><span id="l14.56">             onOperationComplete: function cCC_oOC_cL_onOperationComplete(aCalendar, aStatus, aOpType, aId, aDetail) {</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineat">@@ -237,16 +240,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l14.58"></a><span id="l14.58">         };</span>
<a href="#l14.59"></a><span id="l14.59">         this.mCachedCalendar.getItems(calICalendar.ITEM_FILTER_ALL_ITEMS | calICalendar.ITEM_FILTER_OFFLINE_CREATED,</span>
<a href="#l14.60"></a><span id="l14.60">                                       0, null, null, getListener);</span>
<a href="#l14.61"></a><span id="l14.61">     },</span>
<a href="#l14.62"></a><span id="l14.62"> </span>
<a href="#l14.63"></a><span id="l14.63">     getOfflineModifiedItems: function cCC_getOfflineModifiedItems(callbackFunc) {</span>
<a href="#l14.64"></a><span id="l14.64">         let this_ = this;</span>
<a href="#l14.65"></a><span id="l14.65">         let getListener = {</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l14.67"></a><span id="l14.67">             onGetResult: function cCC_oOC_cL_onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l14.68"></a><span id="l14.68">                 for each (let item in aItems) {</span>
<a href="#l14.69"></a><span id="l14.69">                     this_.offlineCachedItems[item.hashId] = item;</span>
<a href="#l14.70"></a><span id="l14.70">                     this_.offlineCachedItemFlags[item.hashId] = cICL.OFFLINE_FLAG_MODIFIED_RECORD;</span>
<a href="#l14.71"></a><span id="l14.71">                 }</span>
<a href="#l14.72"></a><span id="l14.72">             },</span>
<a href="#l14.73"></a><span id="l14.73"> </span>
<a href="#l14.74"></a><span id="l14.74">             onOperationComplete: function cCC_oOC_cL_onOperationComplete(aCalendar, aStatus, aOpType, aId, aDetail) {</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineat">@@ -255,16 +259,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l14.76"></a><span id="l14.76">         };</span>
<a href="#l14.77"></a><span id="l14.77">         this.mCachedCalendar.getItems(calICalendar.ITEM_FILTER_OFFLINE_MODIFIED | calICalendar.ITEM_FILTER_ALL_ITEMS,</span>
<a href="#l14.78"></a><span id="l14.78">                                       0, null, null, getListener);</span>
<a href="#l14.79"></a><span id="l14.79">     },</span>
<a href="#l14.80"></a><span id="l14.80"> </span>
<a href="#l14.81"></a><span id="l14.81">     getOfflineDeletedItems: function cCC_getOfflineDeletedItems(callbackFunc) {</span>
<a href="#l14.82"></a><span id="l14.82">         let this_ = this;</span>
<a href="#l14.83"></a><span id="l14.83">         let getListener = {</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l14.85"></a><span id="l14.85">             onGetResult: function cCC_oOC_cL_onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l14.86"></a><span id="l14.86">                 for each (let item in aItems) {</span>
<a href="#l14.87"></a><span id="l14.87">                     this_.offlineCachedItems[item.hashId] = item;</span>
<a href="#l14.88"></a><span id="l14.88">                     this_.offlineCachedItemFlags[item.hashId] = cICL.OFFLINE_FLAG_DELETED_RECORD;</span>
<a href="#l14.89"></a><span id="l14.89">                 }</span>
<a href="#l14.90"></a><span id="l14.90">             },</span>
<a href="#l14.91"></a><span id="l14.91"> </span>
<a href="#l14.92"></a><span id="l14.92">             onOperationComplete: function cCC_oOC_cL_onOperationComplete(aCalendar, aStatus, aOpType, aId, aDetail) {</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineat">@@ -330,16 +335,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l14.94"></a><span id="l14.94">                 }</span>
<a href="#l14.95"></a><span id="l14.95">             };</span>
<a href="#l14.96"></a><span id="l14.96">             this.mPendingSync = this.mUncachedCalendar.replayChangesOn(opListener);</span>
<a href="#l14.97"></a><span id="l14.97">             return this.mPendingSync;</span>
<a href="#l14.98"></a><span id="l14.98">         }</span>
<a href="#l14.99"></a><span id="l14.99"> </span>
<a href="#l14.100"></a><span id="l14.100">         cal.LOG(&quot;[calCachedCalendar] Doing full sync for calendar &quot; + this.uri.spec);</span>
<a href="#l14.101"></a><span id="l14.101">         let completeListener = {</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l14.103"></a><span id="l14.103">             modifiedTimes: {},</span>
<a href="#l14.104"></a><span id="l14.104">             hasRenewedCalendar: false,</span>
<a href="#l14.105"></a><span id="l14.105">             getsCompleted: 0,</span>
<a href="#l14.106"></a><span id="l14.106">             getsReceived: 0,</span>
<a href="#l14.107"></a><span id="l14.107">             opCompleted: false,</span>
<a href="#l14.108"></a><span id="l14.108"> </span>
<a href="#l14.109"></a><span id="l14.109">             onGetResult: function cCC_oOC_cL_onGetResult(aCalendar,</span>
<a href="#l14.110"></a><span id="l14.110">                                                          aStatus,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l15.4"></a><span id="l15.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.5"></a><span id="l15.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.6"></a><span id="l15.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l15.10"></a><span id="l15.10"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12"> /**</span>
<a href="#l15.13"></a><span id="l15.13">  * Object that contains a set of filter properties that may be used by a calFilter object</span>
<a href="#l15.14"></a><span id="l15.14">  * to filter a set of items.</span>
<a href="#l15.15"></a><span id="l15.15">  * Supported filter properties:</span>
<a href="#l15.16"></a><span id="l15.16">  *   start, end:   Specifies the relative date range to use when calculating the filter date</span>
<a href="#l15.17"></a><span id="l15.17">  *               range. The relative date range may relative to the current date and time, the</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineat">@@ -860,16 +861,17 @@ calFilter.prototype = {</span>
<a href="#l15.19"></a><span id="l15.19">         }</span>
<a href="#l15.20"></a><span id="l15.20">         let props = this.mFilterProperties;</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22">         // we use a local proxy listener for the calICalendar.getItems() call, and use it</span>
<a href="#l15.23"></a><span id="l15.23">         // to handle occurrence expansion and filter the results before forwarding them to</span>
<a href="#l15.24"></a><span id="l15.24">         // the listener passed in the aListener argument.</span>
<a href="#l15.25"></a><span id="l15.25">         let self = this;</span>
<a href="#l15.26"></a><span id="l15.26">         let listener = {</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l15.28"></a><span id="l15.28">             onOperationComplete: aListener.onOperationComplete.bind(aListener),</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30">             onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l15.31"></a><span id="l15.31">                 let items;</span>
<a href="#l15.32"></a><span id="l15.32">                 if (props.occurrences == props.FILTER_OCCURRENCES_PAST_AND_NEXT) {</span>
<a href="#l15.33"></a><span id="l15.33">                     // with the FILTER_OCCURRENCES_PAST_AND_NEXT occurrence filter we will</span>
<a href="#l15.34"></a><span id="l15.34">                     // get parent items returned here, so we need to let the getOccurrences</span>
<a href="#l15.35"></a><span id="l15.35">                     // function handle occurrence expansion.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/lightning/content/imip-bar.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/lightning/content/imip-bar.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l16.4"></a><span id="l16.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l16.5"></a><span id="l16.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l16.8"></a><span id="l16.8"> Components.utils.import(&quot;resource://calendar/modules/calItipUtils.jsm&quot;);</span>
<a href="#l16.9"></a><span id="l16.9"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l16.10"></a><span id="l16.10"> Components.utils.import(&quot;resource://calendar/modules/ltnInvitationUtils.jsm&quot;);</span>
<a href="#l16.11"></a><span id="l16.11"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l16.13"></a><span id="l16.13"> </span>
<a href="#l16.14"></a><span id="l16.14"> /**</span>
<a href="#l16.15"></a><span id="l16.15">  * This bar lives inside the message window.</span>
<a href="#l16.16"></a><span id="l16.16">  * Its lifetime is the lifetime of the main thunderbird message window.</span>
<a href="#l16.17"></a><span id="l16.17">  */</span>
<a href="#l16.18"></a><span id="l16.18"> var ltnImipBar = {</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20">     actionFunc: null,</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineat">@@ -244,16 +245,17 @@ var ltnImipBar = {</span>
<a href="#l16.22"></a><span id="l16.22">                     partstat = &quot;&quot;;</span>
<a href="#l16.23"></a><span id="l16.23">                 }</span>
<a href="#l16.24"></a><span id="l16.24">                 // hide the buttons now, to disable pressing them twice...</span>
<a href="#l16.25"></a><span id="l16.25">                 if(aPartStat == partStat) {</span>
<a href="#l16.26"></a><span id="l16.26">                     ltnImipBar.resetButtons();</span>
<a href="#l16.27"></a><span id="l16.27">                 }</span>
<a href="#l16.28"></a><span id="l16.28"> </span>
<a href="#l16.29"></a><span id="l16.29">                 let opListener = {</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+                    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l16.31"></a><span id="l16.31">                     onOperationComplete: function ltnItipActionListener_onOperationComplete(aCalendar,</span>
<a href="#l16.32"></a><span id="l16.32">                                                                                             aStatus,</span>
<a href="#l16.33"></a><span id="l16.33">                                                                                             aOperationType,</span>
<a href="#l16.34"></a><span id="l16.34">                                                                                             aId,</span>
<a href="#l16.35"></a><span id="l16.35">                                                                                             aDetail) {</span>
<a href="#l16.36"></a><span id="l16.36">                         // For now, we just state the status for the user something very simple</span>
<a href="#l16.37"></a><span id="l16.37">                         let imipBar = document.getElementById(&quot;imip-bar&quot;);</span>
<a href="#l16.38"></a><span id="l16.38">                         let label = cal.itip.getCompleteText(aStatus, aOperationType);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -433,16 +433,17 @@ function ltnFinish() {</span>
<a href="#l17.4"></a><span id="l17.4"> const FIRST_DELAY_STARTUP = 100;</span>
<a href="#l17.5"></a><span id="l17.5"> const FIRST_DELAY_RESCHEDULE = 100;</span>
<a href="#l17.6"></a><span id="l17.6"> const FIRST_DELAY_REGISTER = 10000;</span>
<a href="#l17.7"></a><span id="l17.7"> const FIRST_DELAY_UNREGISTER = 0;</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9"> var gInvitationsOperationListener = {</span>
<a href="#l17.10"></a><span id="l17.10">     mCount: 0,</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l17.13"></a><span id="l17.13">     onOperationComplete: function sBOL_onOperationComplete(aCalendar,</span>
<a href="#l17.14"></a><span id="l17.14">                                                            aStatus,</span>
<a href="#l17.15"></a><span id="l17.15">                                                            aOperationType,</span>
<a href="#l17.16"></a><span id="l17.16">                                                            aId,</span>
<a href="#l17.17"></a><span id="l17.17">                                                            aDetail) {</span>
<a href="#l17.18"></a><span id="l17.18">         let invitationsBox = document.getElementById(&quot;calendar-invitations-panel&quot;);</span>
<a href="#l17.19"></a><span id="l17.19">         if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l17.20"></a><span id="l17.20">             let value = ltnGetString(&quot;lightning&quot;, &quot;invitationsLink.label&quot;, [this.mCount]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -254,16 +254,17 @@ calDavCalendar.prototype = {</span>
<a href="#l18.4"></a><span id="l18.4">     /**</span>
<a href="#l18.5"></a><span id="l18.5">      * Ensure that cached items have associated meta data, otherwise server side</span>
<a href="#l18.6"></a><span id="l18.6">      * changes may not be reflected</span>
<a href="#l18.7"></a><span id="l18.7">      */</span>
<a href="#l18.8"></a><span id="l18.8">     ensureMetaData: function caldav_ensureMetaData() {</span>
<a href="#l18.9"></a><span id="l18.9">         let self = this;</span>
<a href="#l18.10"></a><span id="l18.10">         let refreshNeeded = false;</span>
<a href="#l18.11"></a><span id="l18.11">         let getMetaListener = {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l18.13"></a><span id="l18.13">             onGetResult: function meta_onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l18.14"></a><span id="l18.14">                 for each (let item in aItems) {</span>
<a href="#l18.15"></a><span id="l18.15">                     if (!(item.id in self.mItemInfoCache)) {</span>
<a href="#l18.16"></a><span id="l18.16">                         let path = self.getItemLocationPath(item);</span>
<a href="#l18.17"></a><span id="l18.17">                         cal.LOG(&quot;Adding meta-data for cached item &quot; + item.id);</span>
<a href="#l18.18"></a><span id="l18.18">                         self.mItemInfoCache[item.id] = { etag: null,</span>
<a href="#l18.19"></a><span id="l18.19">                                                          isNew: false,</span>
<a href="#l18.20"></a><span id="l18.20">                                                          locationPath: path,</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineat">@@ -1324,16 +1325,17 @@ calDavCalendar.prototype = {</span>
<a href="#l18.22"></a><span id="l18.22">             if (this.isCached &amp;&amp; aChangeLogListener) {</span>
<a href="#l18.23"></a><span id="l18.23">                 aChangeLogListener.onResult({ status: status }, status);</span>
<a href="#l18.24"></a><span id="l18.24">             }</span>
<a href="#l18.25"></a><span id="l18.25">         };</span>
<a href="#l18.26"></a><span id="l18.26"> </span>
<a href="#l18.27"></a><span id="l18.27">         if (!this.mACLEntry) {</span>
<a href="#l18.28"></a><span id="l18.28">             let thisCalendar = this;</span>
<a href="#l18.29"></a><span id="l18.29">             let opListener = {</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+                QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l18.31"></a><span id="l18.31">                 onGetResult: function(calendar, status, itemType, detail, count, items) {</span>
<a href="#l18.32"></a><span id="l18.32">                     ASSERT(false, &quot;unexpected!&quot;);</span>
<a href="#l18.33"></a><span id="l18.33">                 },</span>
<a href="#l18.34"></a><span id="l18.34">                 onOperationComplete: function(opCalendar, opStatus, opType, opId, opDetail) {</span>
<a href="#l18.35"></a><span id="l18.35">                     thisCalendar.mACLEntry = opDetail;</span>
<a href="#l18.36"></a><span id="l18.36">                     thisCalendar.fillACLProperties();</span>
<a href="#l18.37"></a><span id="l18.37">                     thisCalendar.safeRefresh(aChangeLogListener);</span>
<a href="#l18.38"></a><span id="l18.38">                 }</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineat">@@ -2629,16 +2631,17 @@ calDavCalendar.prototype = {</span>
<a href="#l18.40"></a><span id="l18.40">     //</span>
<a href="#l18.41"></a><span id="l18.41"> </span>
<a href="#l18.42"></a><span id="l18.42">     processItipReply: function caldav_processItipReply(aItem, aPath) {</span>
<a href="#l18.43"></a><span id="l18.43">         // modify partstat for in-calendar item</span>
<a href="#l18.44"></a><span id="l18.44">         // delete item from inbox</span>
<a href="#l18.45"></a><span id="l18.45">         var thisCalendar = this;</span>
<a href="#l18.46"></a><span id="l18.46"> </span>
<a href="#l18.47"></a><span id="l18.47">         var getItemListener = {};</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineplus">+        getItemListener.QueryInterface = XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l18.49"></a><span id="l18.49">         getItemListener.onOperationComplete = function caldav_gUIs_oOC(aCalendar,</span>
<a href="#l18.50"></a><span id="l18.50">                                                                        aStatus,</span>
<a href="#l18.51"></a><span id="l18.51">                                                                        aOperationType,</span>
<a href="#l18.52"></a><span id="l18.52">                                                                        aId,</span>
<a href="#l18.53"></a><span id="l18.53">                                                                        aDetail) {</span>
<a href="#l18.54"></a><span id="l18.54">         };</span>
<a href="#l18.55"></a><span id="l18.55">         getItemListener.onGetResult = function caldav_pIR_oGR(aCalendar,</span>
<a href="#l18.56"></a><span id="l18.56">                                                               aStatus,</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineat">@@ -2661,16 +2664,17 @@ calDavCalendar.prototype = {</span>
<a href="#l18.58"></a><span id="l18.58">                     newItem.addAttendee(att);</span>
<a href="#l18.59"></a><span id="l18.59">                 }</span>
<a href="#l18.60"></a><span id="l18.60">             }</span>
<a href="#l18.61"></a><span id="l18.61">             thisCalendar.doModifyItem(newItem, itemToUpdate.parentItem /* related to bug 396182 */,</span>
<a href="#l18.62"></a><span id="l18.62">                                       modListener, true);</span>
<a href="#l18.63"></a><span id="l18.63">         };</span>
<a href="#l18.64"></a><span id="l18.64"> </span>
<a href="#l18.65"></a><span id="l18.65">         var modListener = {};</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineplus">+        modListener.QueryInterface = XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l18.67"></a><span id="l18.67">         modListener.onOperationComplete = function caldav_pIR_moOC(aCalendar,</span>
<a href="#l18.68"></a><span id="l18.68">                                                                    aStatus,</span>
<a href="#l18.69"></a><span id="l18.69">                                                                    aOperationType,</span>
<a href="#l18.70"></a><span id="l18.70">                                                                    aItemId,</span>
<a href="#l18.71"></a><span id="l18.71">                                                                    aDetail) {</span>
<a href="#l18.72"></a><span id="l18.72">             cal.LOG(&quot;CalDAV: status &quot; + aStatus + &quot; while processing iTIP REPLY &quot; +</span>
<a href="#l18.73"></a><span id="l18.73">                     &quot; for &quot; + thisCalendar.name);</span>
<a href="#l18.74"></a><span id="l18.74">             // don't delete the REPLY item from inbox unless modifying the master</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/providers/gdata/modules/shim/Calendar.jsm</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/providers/gdata/modules/shim/Calendar.jsm</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l19.4"></a><span id="l19.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l19.5"></a><span id="l19.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> var EXPORTED_SYMBOLS = [&quot;calendarShim&quot;, &quot;gdataRegisterCalendar&quot;, &quot;promisifyCalendar&quot;];</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9"> Components.utils.import(&quot;resource://gdata-provider/modules/shim/Loader.jsm&quot;);</span>
<a href="#l19.10"></a><span id="l19.10"> CuImport(&quot;resource://calendar/modules/calUtils.jsm&quot;, this);</span>
<a href="#l19.11"></a><span id="l19.11"> CuImport(&quot;resource://gre/modules/PromiseUtils.jsm&quot;, this);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+CuImport(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;, this);</span>
<a href="#l19.13"></a><span id="l19.13"> </span>
<a href="#l19.14"></a><span id="l19.14"> const cIOL = Components.interfaces.calIOperationListener;</span>
<a href="#l19.15"></a><span id="l19.15"> const cICL = Components.interfaces.calIChangeLog;</span>
<a href="#l19.16"></a><span id="l19.16"> const cIC = Components.interfaces.calICalendar;</span>
<a href="#l19.17"></a><span id="l19.17"> </span>
<a href="#l19.18"></a><span id="l19.18"> /**</span>
<a href="#l19.19"></a><span id="l19.19">  * Shim functions that can be injected into an object implementing calICalendar</span>
<a href="#l19.20"></a><span id="l19.20">  * to make it compatible with older versions of Lightning</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineat">@@ -20,28 +21,30 @@ var calendarShim = {</span>
<a href="#l19.22"></a><span id="l19.22">     addItemOrUseCache: function(aItem, useCache, aListener) {</span>
<a href="#l19.23"></a><span id="l19.23">         let newItem = aItem.clone();</span>
<a href="#l19.24"></a><span id="l19.24">         return this.adoptItemOrUseCache(newItem, useCache, aListener);</span>
<a href="#l19.25"></a><span id="l19.25">     },</span>
<a href="#l19.26"></a><span id="l19.26"> </span>
<a href="#l19.27"></a><span id="l19.27">     adoptItemOrUseCache: function(aItem, useCache, aListener) {</span>
<a href="#l19.28"></a><span id="l19.28">         let self = this;</span>
<a href="#l19.29"></a><span id="l19.29">         let addOfflineListener = {</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l19.31"></a><span id="l19.31">             onGetResult: function() {},</span>
<a href="#l19.32"></a><span id="l19.32">             onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l19.33"></a><span id="l19.33">                 if (Components.isSuccessCode(status)) {</span>
<a href="#l19.34"></a><span id="l19.34">                     let storage = self.mOfflineStorage.QueryInterface(Components.interfaces.calIOfflineStorage);</span>
<a href="#l19.35"></a><span id="l19.35">                     storage.addOfflineItem(detail, aListener);</span>
<a href="#l19.36"></a><span id="l19.36">                 } else if (aListener) {</span>
<a href="#l19.37"></a><span id="l19.37">                     aListener.onOperationComplete(self, status, opType, id, detail);</span>
<a href="#l19.38"></a><span id="l19.38">                 }</span>
<a href="#l19.39"></a><span id="l19.39">             }</span>
<a href="#l19.40"></a><span id="l19.40">         };</span>
<a href="#l19.41"></a><span id="l19.41"> </span>
<a href="#l19.42"></a><span id="l19.42">         let intermediateListener = {</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l19.44"></a><span id="l19.44">             onGetResult: function() {},</span>
<a href="#l19.45"></a><span id="l19.45">             onOperationComplete: function(aCalendar, aStatus, aOp, aId, aInnerItem) {</span>
<a href="#l19.46"></a><span id="l19.46">                 if (useCache) {</span>
<a href="#l19.47"></a><span id="l19.47">                     if (isUnavailableCode(aStatus)) {</span>
<a href="#l19.48"></a><span id="l19.48">                         self.mOfflineStorage.adoptItem(aInnerItem, addOfflineListener);</span>
<a href="#l19.49"></a><span id="l19.49">                     } else {</span>
<a href="#l19.50"></a><span id="l19.50">                         self.mOfflineStorage.addItem(aInnerItem, aListener);</span>
<a href="#l19.51"></a><span id="l19.51">                     }</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineat">@@ -53,23 +56,25 @@ var calendarShim = {</span>
<a href="#l19.53"></a><span id="l19.53"> </span>
<a href="#l19.54"></a><span id="l19.54">         return this.adoptItem(aItem, intermediateListener);</span>
<a href="#l19.55"></a><span id="l19.55">     },</span>
<a href="#l19.56"></a><span id="l19.56"> </span>
<a href="#l19.57"></a><span id="l19.57">     modifyItemOrUseCache: function modifyItemOrUseCache(aNewItem, aOldItem, useCache, aListener) {</span>
<a href="#l19.58"></a><span id="l19.58">         let self = this;</span>
<a href="#l19.59"></a><span id="l19.59">         let storage = this.mOfflineStorage.QueryInterface(Components.interfaces.calIOfflineStorage);</span>
<a href="#l19.60"></a><span id="l19.60">         let modifyOfflineListener = {</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l19.62"></a><span id="l19.62">             onGetResult: function(calendar, status, itemType, detail, count, items) {},</span>
<a href="#l19.63"></a><span id="l19.63">             onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l19.64"></a><span id="l19.64">                 storage.modifyOfflineItem(detail, aListener);</span>
<a href="#l19.65"></a><span id="l19.65">             }</span>
<a href="#l19.66"></a><span id="l19.66">         };</span>
<a href="#l19.67"></a><span id="l19.67"> </span>
<a href="#l19.68"></a><span id="l19.68">         let offlineFlagListener = {</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l19.70"></a><span id="l19.70">             onGetResult: function(calendar, status, itemType, detail, count, items) {},</span>
<a href="#l19.71"></a><span id="l19.71">             onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l19.72"></a><span id="l19.72">                 let offline_flag = detail;</span>
<a href="#l19.73"></a><span id="l19.73">                 if ((offline_flag == cICL.OFFLINE_FLAG_CREATED_RECORD ||</span>
<a href="#l19.74"></a><span id="l19.74">                      offline_flag == cICL.OFFLINE_FLAG_MODIFIED_RECORD) &amp;&amp; useCache) {</span>
<a href="#l19.75"></a><span id="l19.75">                     storage.modifyItem(aNewItem, aOldItem, modifyOfflineListener);</span>
<a href="#l19.76"></a><span id="l19.76">                 } else {</span>
<a href="#l19.77"></a><span id="l19.77">                     self.modifyItem(aNewItem, aOldItem, aListener);</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineat">@@ -78,25 +83,27 @@ var calendarShim = {</span>
<a href="#l19.79"></a><span id="l19.79">         };</span>
<a href="#l19.80"></a><span id="l19.80">         storage.getItemOfflineFlag(aOldItem, offlineFlagListener);</span>
<a href="#l19.81"></a><span id="l19.81">     },</span>
<a href="#l19.82"></a><span id="l19.82"> </span>
<a href="#l19.83"></a><span id="l19.83">     deleteItemOrUseCache: function deleteItemOrUseCache(aItem, useCache, aListener) {</span>
<a href="#l19.84"></a><span id="l19.84">         let self = this;</span>
<a href="#l19.85"></a><span id="l19.85">         let storage = this.mOfflineStorage.QueryInterface(Components.interfaces.calIOfflineStorage);</span>
<a href="#l19.86"></a><span id="l19.86">         let deleteOfflineListener = {</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l19.88"></a><span id="l19.88">             onGetResult: function(calendar, status, itemType, detail, count, items) {},</span>
<a href="#l19.89"></a><span id="l19.89">             onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l19.90"></a><span id="l19.90">                 if (aListener) {</span>
<a href="#l19.91"></a><span id="l19.91">                     aListener.onOperationComplete(calendar, status, opType, aItem.id, aItem);</span>
<a href="#l19.92"></a><span id="l19.92">                 }</span>
<a href="#l19.93"></a><span id="l19.93">             }</span>
<a href="#l19.94"></a><span id="l19.94">         };</span>
<a href="#l19.95"></a><span id="l19.95"> </span>
<a href="#l19.96"></a><span id="l19.96">         let offlineFlagListener = {</span>
<a href="#l19.97"></a><span id="l19.97" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l19.98"></a><span id="l19.98">             onGetResult: function(calendar, status, itemType, detail, count, items) {},</span>
<a href="#l19.99"></a><span id="l19.99">             onOperationComplete: function(calendar, status, opType, id, detail) {</span>
<a href="#l19.100"></a><span id="l19.100">                 let offline_flag = detail;</span>
<a href="#l19.101"></a><span id="l19.101">                 if ((offline_flag == cICL.OFFLINE_FLAG_CREATED_RECORD ||</span>
<a href="#l19.102"></a><span id="l19.102">                      offline_flag == cICL.OFFLINE_FLAG_MODIFIED_RECORD) &amp;&amp; useCache) {</span>
<a href="#l19.103"></a><span id="l19.103">                     /* We do not delete the item from the cache, but mark it deleted */</span>
<a href="#l19.104"></a><span id="l19.104">                     storage.deleteOfflineItem(aItem, aListener);</span>
<a href="#l19.105"></a><span id="l19.105">                 } else {</span>
<a href="#l19.106"></a><span id="l19.106" class="difflineat">@@ -192,16 +199,17 @@ function gdataRegisterCalendar(calendar)</span>
<a href="#l19.107"></a><span id="l19.107"> }</span>
<a href="#l19.108"></a><span id="l19.108"> </span>
<a href="#l19.109"></a><span id="l19.109"> /**</span>
<a href="#l19.110"></a><span id="l19.110">  * Shim for calAsyncUtils' promsifyCalendar for Lightning before 3.5</span>
<a href="#l19.111"></a><span id="l19.111">  */</span>
<a href="#l19.112"></a><span id="l19.112"> function promisifyCalendar(aCalendar) {</span>
<a href="#l19.113"></a><span id="l19.113">     function promiseOperationListener(deferred) {</span>
<a href="#l19.114"></a><span id="l19.114">         return {</span>
<a href="#l19.115"></a><span id="l19.115" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l19.116"></a><span id="l19.116">             items: [],</span>
<a href="#l19.117"></a><span id="l19.117">             itemStatus: Components.results.NS_OK,</span>
<a href="#l19.118"></a><span id="l19.118">             onGetResult: function(aCalendar, aStatus, aItemType, aDetail,</span>
<a href="#l19.119"></a><span id="l19.119">                                   aCount, aItems) {</span>
<a href="#l19.120"></a><span id="l19.120">                 this.itemStatus = aStatus;</span>
<a href="#l19.121"></a><span id="l19.121">                 if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l19.122"></a><span id="l19.122">                     this.items = this.items.concat(aItems);</span>
<a href="#l19.123"></a><span id="l19.123">                 } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -315,16 +315,17 @@ calICSCalendar.prototype = {</span>
<a href="#l20.4"></a><span id="l20.4">     },</span>
<a href="#l20.5"></a><span id="l20.5"> </span>
<a href="#l20.6"></a><span id="l20.6">     doWriteICS: function () {</span>
<a href="#l20.7"></a><span id="l20.7">         cal.LOG(&quot;[calICSCalendar] Writing ICS File &quot; + this.uri.spec);</span>
<a href="#l20.8"></a><span id="l20.8">         var savedthis = this;</span>
<a href="#l20.9"></a><span id="l20.9">         var listener =</span>
<a href="#l20.10"></a><span id="l20.10">         {</span>
<a href="#l20.11"></a><span id="l20.11">             serializer: null,</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l20.13"></a><span id="l20.13">             onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDetail)</span>
<a href="#l20.14"></a><span id="l20.14">             {</span>
<a href="#l20.15"></a><span id="l20.15">                 var inLastWindowClosingSurvivalArea = false;</span>
<a href="#l20.16"></a><span id="l20.16">                 try  {</span>
<a href="#l20.17"></a><span id="l20.17">                     // All events are returned. Now set up a channel and a</span>
<a href="#l20.18"></a><span id="l20.18">                     // streamloader to upload.  onStopRequest will be called</span>
<a href="#l20.19"></a><span id="l20.19">                     // once the write has finished</span>
<a href="#l20.20"></a><span id="l20.20">                     var channel = Services.io.newChannelFromURI2(savedthis.mUri,</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineat">@@ -506,16 +507,17 @@ calICSCalendar.prototype = {</span>
<a href="#l20.22"></a><span id="l20.22">     {</span>
<a href="#l20.23"></a><span id="l20.23">         if (this.isLocked())</span>
<a href="#l20.24"></a><span id="l20.24">             return;</span>
<a href="#l20.25"></a><span id="l20.25"> </span>
<a href="#l20.26"></a><span id="l20.26">         function modListener(action) {</span>
<a href="#l20.27"></a><span id="l20.27">             this.mAction = action;</span>
<a href="#l20.28"></a><span id="l20.28">         }</span>
<a href="#l20.29"></a><span id="l20.29">         modListener.prototype = {</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l20.31"></a><span id="l20.31">             onGetResult: function() {},</span>
<a href="#l20.32"></a><span id="l20.32">             onOperationComplete: function() {</span>
<a href="#l20.33"></a><span id="l20.33">                 this.mAction.opCompleteArgs = arguments;</span>
<a href="#l20.34"></a><span id="l20.34">             }</span>
<a href="#l20.35"></a><span id="l20.35">         };</span>
<a href="#l20.36"></a><span id="l20.36"> </span>
<a href="#l20.37"></a><span id="l20.37">         var a;</span>
<a href="#l20.38"></a><span id="l20.38">         var writeICS = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1008,16 +1008,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l21.4"></a><span id="l21.4">                                      Components.interfaces.calIOperationListener.ADD,</span>
<a href="#l21.5"></a><span id="l21.5">                                      aItem.id,</span>
<a href="#l21.6"></a><span id="l21.6">                                      aItem);</span>
<a href="#l21.7"></a><span id="l21.7">     },</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9">     modifyOfflineItem: function(aItem, aListener) {</span>
<a href="#l21.10"></a><span id="l21.10">         let this_ = this;</span>
<a href="#l21.11"></a><span id="l21.11">         let opListener = {</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l21.13"></a><span id="l21.13">             onGetResult: function (calendar, status, itemType, detail, count, items) {</span>
<a href="#l21.14"></a><span id="l21.14">             },</span>
<a href="#l21.15"></a><span id="l21.15">             onOperationComplete: function(calendar, status, opType, id, oldOfflineJournalFlag ) {</span>
<a href="#l21.16"></a><span id="l21.16">                 let newOfflineJournalFlag = cICL.OFFLINE_FLAG_MODIFIED_RECORD;</span>
<a href="#l21.17"></a><span id="l21.17">                 if (oldOfflineJournalFlag == cICL.OFFLINE_FLAG_CREATED_RECORD || oldOfflineJournalFlag == cICL.OFFLINE_FLAG_DELETED_RECORD) {</span>
<a href="#l21.18"></a><span id="l21.18">                     // Do nothing since a flag of &quot;created&quot; or &quot;deleted&quot; exists</span>
<a href="#l21.19"></a><span id="l21.19">                 } else {</span>
<a href="#l21.20"></a><span id="l21.20">                     this_.setOfflineJournalFlag(aItem, newOfflineJournalFlag);</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineat">@@ -1030,16 +1031,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l21.22"></a><span id="l21.22">             }</span>
<a href="#l21.23"></a><span id="l21.23">         };</span>
<a href="#l21.24"></a><span id="l21.24">         this.getItemOfflineFlag(aItem, opListener);</span>
<a href="#l21.25"></a><span id="l21.25">     },</span>
<a href="#l21.26"></a><span id="l21.26"> </span>
<a href="#l21.27"></a><span id="l21.27">     deleteOfflineItem: function(aItem, aListener) {</span>
<a href="#l21.28"></a><span id="l21.28">         let this_ = this;</span>
<a href="#l21.29"></a><span id="l21.29">         let opListener = {</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l21.31"></a><span id="l21.31">             onGetResult: function (calendar, status, itemType, detail, count, items) {</span>
<a href="#l21.32"></a><span id="l21.32"> </span>
<a href="#l21.33"></a><span id="l21.33">             },</span>
<a href="#l21.34"></a><span id="l21.34">             onOperationComplete: function(calendar, status, opType, id, oldOfflineJournalFlag) {</span>
<a href="#l21.35"></a><span id="l21.35">                 var newOfflineJournalFlag = cICL.OFFLINE_FLAG_DELETED_RECORD;</span>
<a href="#l21.36"></a><span id="l21.36">                 if (oldOfflineJournalFlag) {</span>
<a href="#l21.37"></a><span id="l21.37">                     // Delete item if flag is c</span>
<a href="#l21.38"></a><span id="l21.38">                     if (oldOfflineJournalFlag == cICL.OFFLINE_FLAG_CREATED_RECORD) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1,12 +1,13 @@</span>
<a href="#l22.4"></a><span id="l22.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.5"></a><span id="l22.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.6"></a><span id="l22.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l22.9"></a><span id="l22.9"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l22.10"></a><span id="l22.10"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12"> calWcapCalendar.prototype.encodeAttendee =</span>
<a href="#l22.13"></a><span id="l22.13"> function calWcapCalendar_encodeAttendee(att) {</span>
<a href="#l22.14"></a><span id="l22.14">     if (LOG_LEVEL &gt; 2) {</span>
<a href="#l22.15"></a><span id="l22.15">         log(&quot;attendee.icalProperty.icalString=&quot; + att.icalProperty.icalString, this);</span>
<a href="#l22.16"></a><span id="l22.16">     }</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineat">@@ -1338,16 +1339,17 @@ function calWcapCalendar_replayChangesOn</span>
<a href="#l22.18"></a><span id="l22.18">                 listener.onResult(request, null);</span>
<a href="#l22.19"></a><span id="l22.19">             }</span>
<a href="#l22.20"></a><span id="l22.20">         },</span>
<a href="#l22.21"></a><span id="l22.21">         log(&quot;replayChangesOn():\n\titemFilter=0x&quot; + itemFilter.toString(0x10) +</span>
<a href="#l22.22"></a><span id="l22.22">             &quot;\n\tdtFrom=&quot; + getIcalUTC(dtFrom), this));</span>
<a href="#l22.23"></a><span id="l22.23"> </span>
<a href="#l22.24"></a><span id="l22.24">     try {</span>
<a href="#l22.25"></a><span id="l22.25">         var writeListener = {</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l22.27"></a><span id="l22.27">             onGetResult: function() {},</span>
<a href="#l22.28"></a><span id="l22.28">             onOperationComplete: function(aCalendar, status, opType, id, detail) {</span>
<a href="#l22.29"></a><span id="l22.29">                 if (!Components.isSuccessCode(status)) {</span>
<a href="#l22.30"></a><span id="l22.30">                     request.execRespFunc(status); // any error on writing breaks whole operation</span>
<a href="#l22.31"></a><span id="l22.31">                 }</span>
<a href="#l22.32"></a><span id="l22.32">             }</span>
<a href="#l22.33"></a><span id="l22.33">         };</span>
<a href="#l22.34"></a><span id="l22.34">         var request = new calWcapRequest(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/resources/content/publish.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/resources/content/publish.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -1,12 +1,14 @@</span>
<a href="#l23.4"></a><span id="l23.4"> /* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l23.5"></a><span id="l23.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l23.6"></a><span id="l23.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l23.7"></a><span id="l23.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l23.8"></a><span id="l23.8" class="difflineplus">+</span>
<a href="#l23.9"></a><span id="l23.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l23.10"></a><span id="l23.10"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l23.11"></a><span id="l23.11"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l23.12"></a><span id="l23.12"> </span>
<a href="#l23.13"></a><span id="l23.13"> /**</span>
<a href="#l23.14"></a><span id="l23.14">  * publishCalendarData</span>
<a href="#l23.15"></a><span id="l23.15">  * Show publish dialog, ask for URL and publish all selected items.</span>
<a href="#l23.16"></a><span id="l23.16">  */</span>
<a href="#l23.17"></a><span id="l23.17"> function publishCalendarData()</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineat">@@ -88,16 +90,17 @@ function publishEntireCalendar(aCalendar</span>
<a href="#l23.19"></a><span id="l23.19"> function publishEntireCalendarDialogResponse(CalendarPublishObject, aProgressDialog)</span>
<a href="#l23.20"></a><span id="l23.20"> {</span>
<a href="#l23.21"></a><span id="l23.21">     // store the selected remote ics path as a calendar preference</span>
<a href="#l23.22"></a><span id="l23.22">     CalendarPublishObject.calendar.setProperty(&quot;remote-ics-path&quot;,</span>
<a href="#l23.23"></a><span id="l23.23">                                            CalendarPublishObject.remotePath);</span>
<a href="#l23.24"></a><span id="l23.24"> </span>
<a href="#l23.25"></a><span id="l23.25">     var itemArray = [];</span>
<a href="#l23.26"></a><span id="l23.26">     var getListener = {</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineplus">+        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l23.28"></a><span id="l23.28">         onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDetail)</span>
<a href="#l23.29"></a><span id="l23.29">         {</span>
<a href="#l23.30"></a><span id="l23.30">             publishItemArray(itemArray, CalendarPublishObject.remotePath, aProgressDialog);</span>
<a href="#l23.31"></a><span id="l23.31">         },</span>
<a href="#l23.32"></a><span id="l23.32">         onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems)</span>
<a href="#l23.33"></a><span id="l23.33">         {</span>
<a href="#l23.34"></a><span id="l23.34">             if (!Components.isSuccessCode(aStatus)) {</span>
<a href="#l23.35"></a><span id="l23.35">                 aborted = true;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

