<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 19009:fb7c4eecfa942d3b31bf9f235ec38809d576635d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ fb7c4eecfa942d3b31bf9f235ec38809d576635d" />
<meta property="og:url" content="/comm-central/rev/fb7c4eecfa942d3b31bf9f235ec38809d576635d" />
<meta property="og:description" content="Bug 1249979 - Port bug 1229626 to TB. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / fb7c4eecfa942d3b31bf9f235ec38809d576635d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/fb7c4eecfa942d3b31bf9f235ec38809d576635d">shortlog</a> |
<a href="/comm-central/log/fb7c4eecfa942d3b31bf9f235ec38809d576635d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/fb7c4eecfa942d3b31bf9f235ec38809d576635d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/fb7c4eecfa942d3b31bf9f235ec38809d576635d">files</a> |
changeset |
<a href="/comm-central/raw-rev/fb7c4eecfa942d3b31bf9f235ec38809d576635d">raw</a>  | <a href="/comm-central/archive/fb7c4eecfa942d3b31bf9f235ec38809d576635d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1249979">Bug 1249979</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1229626">bug 1229626</a> to TB. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#105;&#99;&#104;&#97;&#114;&#100;&#32;&#77;&#97;&#114;&#116;&#105;&#32;&#60;&#114;&#105;&#99;&#104;&#97;&#114;&#100;&#46;&#109;&#97;&#114;&#116;&#105;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 21 Feb 2016 16:03:32 +0100</td></tr>

<tr>
 <td>changeset 19009</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/fb7c4eecfa942d3b31bf9f235ec38809d576635d">fb7c4eecfa942d3b31bf9f235ec38809d576635d</a></td>
</tr>



<tr>
<td>parent 19008</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/da9ea3ae700be5285cbbf2bab4c7cc877b2ce3c7">da9ea3ae700be5285cbbf2bab4c7cc877b2ce3c7</a>
</td>
</tr>

<tr>
<td>child 19010</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/131bd1aea9ee9b7fd4422a80df0eb619d4a47cc6">131bd1aea9ee9b7fd4422a80df0eb619d4a47cc6</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=fb7c4eecfa942d3b31bf9f235ec38809d576635d">11663</a></td></tr>
<tr><td>push user</td><td>richard.marti@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 21 Feb 2016 20:52:42 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@131bd1aea9ee [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=131bd1aea9ee9b7fd4422a80df0eb619d4a47cc6">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=131bd1aea9ee9b7fd4422a80df0eb619d4a47cc6&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=131bd1aea9ee9b7fd4422a80df0eb619d4a47cc6&newProject=comm-central&newRevision=fb7c4eecfa942d3b31bf9f235ec38809d576635d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=131bd1aea9ee9b7fd4422a80df0eb619d4a47cc6&newProject=comm-central&newRevision=fb7c4eecfa942d3b31bf9f235ec38809d576635d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=131bd1aea9ee9b7fd4422a80df0eb619d4a47cc6&newProject=comm-central&newRevision=fb7c4eecfa942d3b31bf9f235ec38809d576635d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1249979">1249979</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1229626">1229626</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1249979">Bug 1249979</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1229626">bug 1229626</a> to TB. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/installer.nsi">mail/installer/windows/nsis/installer.nsi</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/installer.nsi">file</a> |
<a href="/comm-central/annotate/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/installer.nsi">annotate</a> |
<a href="/comm-central/diff/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/installer.nsi">diff</a> |
<a href="/comm-central/comparison/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/installer.nsi">comparison</a> |
<a href="/comm-central/log/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/installer.nsi">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/shared.nsh">mail/installer/windows/nsis/shared.nsh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/shared.nsh">file</a> |
<a href="/comm-central/annotate/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/shared.nsh">annotate</a> |
<a href="/comm-central/diff/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/shared.nsh">diff</a> |
<a href="/comm-central/comparison/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/shared.nsh">comparison</a> |
<a href="/comm-central/log/fb7c4eecfa942d3b31bf9f235ec38809d576635d/mail/installer/windows/nsis/shared.nsh">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/installer/windows/nsis/installer.nsi</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/installer/windows/nsis/installer.nsi</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -29,16 +29,17 @@ RequestExecutionLevel user</span>
<a href="#l1.4"></a><span id="l1.4">   ManifestDPIAware true</span>
<a href="#l1.5"></a><span id="l1.5"> !endif</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> !addplugindir ./</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> Var TmpVal</span>
<a href="#l1.10"></a><span id="l1.10"> Var InstallType</span>
<a href="#l1.11"></a><span id="l1.11"> Var AddStartMenuSC</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+Var AddTaskbarSC</span>
<a href="#l1.13"></a><span id="l1.13"> Var AddQuickLaunchSC</span>
<a href="#l1.14"></a><span id="l1.14"> Var AddDesktopSC</span>
<a href="#l1.15"></a><span id="l1.15"> Var InstallMaintenanceService</span>
<a href="#l1.16"></a><span id="l1.16"> Var PageName</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> ; By defining NO_STARTMENU_DIR an installer that doesn't provide an option for</span>
<a href="#l1.19"></a><span id="l1.19"> ; an application's Start Menu PROGRAMS directory and doesn't define the</span>
<a href="#l1.20"></a><span id="l1.20"> ; StartMenuDir variable can use the common InstallOnInitCommon macro.</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -378,30 +379,32 @@ Section &quot;-Application&quot; APP_IDX</span>
<a href="#l1.22"></a><span id="l1.22">   ; The following keys should only be set if we can write to HKLM</span>
<a href="#l1.23"></a><span id="l1.23">   ${If} $TmpVal == &quot;HKLM&quot;</span>
<a href="#l1.24"></a><span id="l1.24">     ; Set the Start Menu Internet and Vista Registered App HKLM registry keys.</span>
<a href="#l1.25"></a><span id="l1.25">     ${SetClientsMail}</span>
<a href="#l1.26"></a><span id="l1.26">     ${SetClientsNews}</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28">     ; If we are writing to HKLM and create either the desktop or start menu</span>
<a href="#l1.29"></a><span id="l1.29">     ; shortcuts set IconsVisible to 1 otherwise to 0.</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+    ; Taskbar shortcuts imply having a start menu shortcut.</span>
<a href="#l1.31"></a><span id="l1.31">     StrCpy $0 &quot;Software\Clients\Mail\${ClientsRegName}\InstallInfo&quot;</span>
<a href="#l1.32"></a><span id="l1.32">     ${If} $AddDesktopSC == 1</span>
<a href="#l1.33"></a><span id="l1.33">     ${OrIf} $AddStartMenuSC == 1</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+    ${OrIf} $AddTaskbarSC == 1</span>
<a href="#l1.35"></a><span id="l1.35">       WriteRegDWORD HKLM &quot;$0&quot; &quot;IconsVisible&quot; 1</span>
<a href="#l1.36"></a><span id="l1.36">     ${Else}</span>
<a href="#l1.37"></a><span id="l1.37">       WriteRegDWORD HKLM &quot;$0&quot; &quot;IconsVisible&quot; 0</span>
<a href="#l1.38"></a><span id="l1.38">     ${EndIf}</span>
<a href="#l1.39"></a><span id="l1.39">   ${EndIf}</span>
<a href="#l1.40"></a><span id="l1.40"> </span>
<a href="#l1.41"></a><span id="l1.41"> !ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-  ; If the maintenance service page was displayed then a value was already </span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-  ; explicitly selected for installing the maintenance service and </span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+  ; If the maintenance service page was displayed then a value was already</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+  ; explicitly selected for installing the maintenance service and</span>
<a href="#l1.46"></a><span id="l1.46">   ; and so InstallMaintenanceService will already be 0 or 1.</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-  ; If the maintenance service page was not displayed then </span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+  ; If the maintenance service page was not displayed then</span>
<a href="#l1.49"></a><span id="l1.49">   ; InstallMaintenanceService will be equal to &quot;&quot;.</span>
<a href="#l1.50"></a><span id="l1.50">   ${If} $InstallMaintenanceService == &quot;&quot;</span>
<a href="#l1.51"></a><span id="l1.51">     Call IsUserAdmin</span>
<a href="#l1.52"></a><span id="l1.52">     Pop $R0</span>
<a href="#l1.53"></a><span id="l1.53">     ${If} $R0 == &quot;true&quot;</span>
<a href="#l1.54"></a><span id="l1.54">     ; Only proceed if we have HKLM write access</span>
<a href="#l1.55"></a><span id="l1.55">     ${AndIf} $TmpVal == &quot;HKLM&quot;</span>
<a href="#l1.56"></a><span id="l1.56">     ; On Windows 2000 we do not install the maintenance service.</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineat">@@ -411,17 +414,17 @@ Section &quot;-Application&quot; APP_IDX</span>
<a href="#l1.58"></a><span id="l1.58">     ${Else}</span>
<a href="#l1.59"></a><span id="l1.59">       ; The user is not admin so we should default to install service no</span>
<a href="#l1.60"></a><span id="l1.60">       StrCpy $InstallMaintenanceService &quot;0&quot;</span>
<a href="#l1.61"></a><span id="l1.61">     ${EndIf}</span>
<a href="#l1.62"></a><span id="l1.62">   ${EndIf}</span>
<a href="#l1.63"></a><span id="l1.63"> </span>
<a href="#l1.64"></a><span id="l1.64">   ${If} $InstallMaintenanceService == &quot;1&quot;</span>
<a href="#l1.65"></a><span id="l1.65">     ; The user wants to install the maintenance service, so execute</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-    ; the pre-packaged maintenance service installer. </span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+    ; the pre-packaged maintenance service installer.</span>
<a href="#l1.68"></a><span id="l1.68">     ; This option can only be turned on if the user is an admin so there</span>
<a href="#l1.69"></a><span id="l1.69">     ; is no need to use ExecShell w/ verb runas to enforce elevated.</span>
<a href="#l1.70"></a><span id="l1.70">     nsExec::Exec &quot;$\&quot;$INSTDIR\maintenanceservice_installer.exe$\&quot;&quot;</span>
<a href="#l1.71"></a><span id="l1.71">   ${EndIf}</span>
<a href="#l1.72"></a><span id="l1.72"> !endif</span>
<a href="#l1.73"></a><span id="l1.73"> </span>
<a href="#l1.74"></a><span id="l1.74">   ; These need special handling on uninstall since they may be overwritten by</span>
<a href="#l1.75"></a><span id="l1.75">   ; an install into a different location.</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineat">@@ -551,19 +554,16 @@ Section &quot;-InstallEndCleanup&quot;</span>
<a href="#l1.77"></a><span id="l1.77">         UAC::ExecCodeSegment $0</span>
<a href="#l1.78"></a><span id="l1.78">       ${EndIf}</span>
<a href="#l1.79"></a><span id="l1.79">     ${EndIf}</span>
<a href="#l1.80"></a><span id="l1.80">   ${EndUnless}</span>
<a href="#l1.81"></a><span id="l1.81"> </span>
<a href="#l1.82"></a><span id="l1.82">   ; Adds a pinned Task Bar shortcut (see MigrateTaskBarShortcut for details).</span>
<a href="#l1.83"></a><span id="l1.83">   ${MigrateTaskBarShortcut}</span>
<a href="#l1.84"></a><span id="l1.84"> </span>
<a href="#l1.85"></a><span id="l1.85" class="difflineminus">-  ${GetShortcutsLogPath} $0</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineminus">-  WriteIniStr &quot;$0&quot; &quot;TASKBAR&quot; &quot;Migrated&quot; &quot;true&quot;</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineminus">-</span>
<a href="#l1.88"></a><span id="l1.88">   ; Refresh desktop icons</span>
<a href="#l1.89"></a><span id="l1.89">   System::Call &quot;shell32::SHChangeNotify(i 0x08000000, i 0, i 0, i 0)&quot;</span>
<a href="#l1.90"></a><span id="l1.90"> </span>
<a href="#l1.91"></a><span id="l1.91">   ${InstallEndCleanupCommon}</span>
<a href="#l1.92"></a><span id="l1.92"> </span>
<a href="#l1.93"></a><span id="l1.93">   ${If} ${RebootFlag}</span>
<a href="#l1.94"></a><span id="l1.94">     ; If we have to reboot give SHChangeNotify time to finish refreshing</span>
<a href="#l1.95"></a><span id="l1.95">     ; the icons so the OS doesn't display the icons from helper.exe</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/installer/windows/nsis/shared.nsh</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/installer/windows/nsis/shared.nsh</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -103,27 +103,27 @@</span>
<a href="#l2.4"></a><span id="l2.4">     SetRegView 64</span>
<a href="#l2.5"></a><span id="l2.5">     ReadRegDWORD $5 HKLM &quot;Software\Mozilla\MaintenanceService&quot; &quot;Attempted&quot;</span>
<a href="#l2.6"></a><span id="l2.6">     ClearErrors</span>
<a href="#l2.7"></a><span id="l2.7">     SetRegView lastused</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">     ; If the maintenance service is already installed, do nothing.</span>
<a href="#l2.10"></a><span id="l2.10">     ; The maintenance service will launch:</span>
<a href="#l2.11"></a><span id="l2.11">     ; maintenanceservice_installer.exe /Upgrade to upgrade the maintenance</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    ; service if necessary.   If the update was done from updater.exe without </span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-    ; the service (i.e. service is failing), updater.exe will do the update of </span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-    ; the service.  The reasons we do not do it here is because we don't want </span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-    ; to have to prompt for limited user accounts when the service isn't used </span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+    ; service if necessary.   If the update was done from updater.exe without</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+    ; the service (i.e. service is failing), updater.exe will do the update of</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+    ; the service.  The reasons we do not do it here is because we don't want</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+    ; to have to prompt for limited user accounts when the service isn't used</span>
<a href="#l2.20"></a><span id="l2.20">     ; and we currently call the PostUpdate twice, once for the user and once</span>
<a href="#l2.21"></a><span id="l2.21">     ; for the SYSTEM account.  Also, this would stop the maintenance service</span>
<a href="#l2.22"></a><span id="l2.22">     ; and we need a return result back to the service when run that way.</span>
<a href="#l2.23"></a><span id="l2.23">     ${If} $5 == &quot;&quot;</span>
<a href="#l2.24"></a><span id="l2.24">       ; An install of maintenance service was never attempted.</span>
<a href="#l2.25"></a><span id="l2.25">       ; We call ExecShell (which is ShellExecute) with the verb &quot;runas&quot;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-      ; to ask for elevation if the user isn't already elevated.  If the user </span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+      ; to ask for elevation if the user isn't already elevated.  If the user</span>
<a href="#l2.28"></a><span id="l2.28">       ; is already elevated it will just launch the program.</span>
<a href="#l2.29"></a><span id="l2.29">       ExecShell &quot;runas&quot; &quot;$\&quot;$INSTDIR\maintenanceservice_installer.exe$\&quot;&quot;</span>
<a href="#l2.30"></a><span id="l2.30">     ${EndIf}</span>
<a href="#l2.31"></a><span id="l2.31">   ${EndIf}</span>
<a href="#l2.32"></a><span id="l2.32"> !endif</span>
<a href="#l2.33"></a><span id="l2.33"> </span>
<a href="#l2.34"></a><span id="l2.34">   ; Remove talkback if it is present (remove after bug 386760 is fixed)</span>
<a href="#l2.35"></a><span id="l2.35">   ${If} ${FileExists} &quot;$INSTDIR\extensions\talkback@mozilla.org\&quot;</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineat">@@ -275,25 +275,25 @@</span>
<a href="#l2.37"></a><span id="l2.37">   WriteRegStr HKLM &quot;$0&quot; &quot;&quot; &quot;${ClientsRegName}&quot;</span>
<a href="#l2.38"></a><span id="l2.38">   WriteRegStr HKLM &quot;$0\DefaultIcon&quot; &quot;&quot; &quot;$8,0&quot;</span>
<a href="#l2.39"></a><span id="l2.39">   WriteRegStr HKLM &quot;$0&quot; &quot;DLLPath&quot; &quot;$6&quot;</span>
<a href="#l2.40"></a><span id="l2.40"> </span>
<a href="#l2.41"></a><span id="l2.41">   ; The MapiProxy dll can exist in multiple installs of the application.</span>
<a href="#l2.42"></a><span id="l2.42">   ; Registration occurs as follows with the last action to occur being the one</span>
<a href="#l2.43"></a><span id="l2.43">   ; that wins:</span>
<a href="#l2.44"></a><span id="l2.44">   ; On install and software update when helper.exe runs with the /PostUpdate</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineminus">-  ; argument. On setting the application as the system's default application </span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+  ; argument. On setting the application as the system's default application</span>
<a href="#l2.47"></a><span id="l2.47">   ; using Window's &quot;Set program access and defaults&quot;.</span>
<a href="#l2.48"></a><span id="l2.48"> </span>
<a href="#l2.49"></a><span id="l2.49">   !ifndef NO_LOG</span>
<a href="#l2.50"></a><span id="l2.50">     ${LogHeader} &quot;DLL Registration&quot;</span>
<a href="#l2.51"></a><span id="l2.51">   !endif</span>
<a href="#l2.52"></a><span id="l2.52">   ClearErrors</span>
<a href="#l2.53"></a><span id="l2.53">   ${RegisterDLL} &quot;$INSTDIR\MapiProxy_InUse.dll&quot;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-  !ifndef NO_LOG  </span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+  !ifndef NO_LOG</span>
<a href="#l2.56"></a><span id="l2.56">     ${If} ${Errors}</span>
<a href="#l2.57"></a><span id="l2.57">       ${LogMsg} &quot;** ERROR Registering: $INSTDIR\MapiProxy_InUse.dll **&quot;</span>
<a href="#l2.58"></a><span id="l2.58">     ${Else}</span>
<a href="#l2.59"></a><span id="l2.59">       ${LogUninstall} &quot;DLLReg: \MapiProxy_InUse.dll&quot;</span>
<a href="#l2.60"></a><span id="l2.60">       ${LogMsg} &quot;Registered: $INSTDIR\MapiProxy_InUse.dll&quot;</span>
<a href="#l2.61"></a><span id="l2.61">     ${EndIf}</span>
<a href="#l2.62"></a><span id="l2.62">   !endif</span>
<a href="#l2.63"></a><span id="l2.63"> </span>
<a href="#l2.64"></a><span id="l2.64" class="difflineat">@@ -335,17 +335,17 @@</span>
<a href="#l2.65"></a><span id="l2.65"> </span>
<a href="#l2.66"></a><span id="l2.66">   ; safemode</span>
<a href="#l2.67"></a><span id="l2.67">   WriteRegStr HKLM &quot;$0\shell\safemode&quot; &quot;&quot; &quot;$(CONTEXT_SAFE_MODE)&quot;</span>
<a href="#l2.68"></a><span id="l2.68">   WriteRegStr HKLM &quot;$0\shell\safemode\command&quot; &quot;&quot; &quot;$\&quot;$8$\&quot; -safe-mode&quot;</span>
<a href="#l2.69"></a><span id="l2.69"> </span>
<a href="#l2.70"></a><span id="l2.70">   ; Protocols</span>
<a href="#l2.71"></a><span id="l2.71">   StrCpy $1 &quot;$\&quot;$8$\&quot; -osint -compose $\&quot;%1$\&quot;&quot;</span>
<a href="#l2.72"></a><span id="l2.72">   ${AddHandlerValues} &quot;$0\Protocols\mailto&quot; &quot;$1&quot; &quot;$8,0&quot; &quot;${AppRegNameMail} URL&quot; &quot;true&quot; &quot;&quot;</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">- </span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+</span>
<a href="#l2.75"></a><span id="l2.75">   ; Vista Capabilities registry keys</span>
<a href="#l2.76"></a><span id="l2.76">   WriteRegStr HKLM &quot;$0\Capabilities&quot; &quot;ApplicationDescription&quot; &quot;$(REG_APP_DESC)&quot;</span>
<a href="#l2.77"></a><span id="l2.77">   WriteRegStr HKLM &quot;$0\Capabilities&quot; &quot;ApplicationIcon&quot; &quot;$8,0&quot;</span>
<a href="#l2.78"></a><span id="l2.78">   WriteRegStr HKLM &quot;$0\Capabilities&quot; &quot;ApplicationName&quot; &quot;${AppRegNameMail}&quot;</span>
<a href="#l2.79"></a><span id="l2.79">   WriteRegStr HKLM &quot;$0\Capabilities\FileAssociations&quot; &quot;.eml&quot;   &quot;ThunderbirdEML&quot;</span>
<a href="#l2.80"></a><span id="l2.80">   WriteRegStr HKLM &quot;$0\Capabilities\FileAssociations&quot; &quot;.wdseml&quot; &quot;ThunderbirdEML&quot;</span>
<a href="#l2.81"></a><span id="l2.81">   WriteRegStr HKLM &quot;$0\Capabilities\StartMenu&quot; &quot;Mail&quot; &quot;${ClientsRegName}&quot;</span>
<a href="#l2.82"></a><span id="l2.82">   WriteRegStr HKLM &quot;$0\Capabilities\URLAssociations&quot; &quot;mailto&quot; &quot;Thunderbird.Url.mailto&quot;</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineat">@@ -367,25 +367,25 @@</span>
<a href="#l2.84"></a><span id="l2.84">   WriteRegStr HKLM &quot;$0&quot; &quot;&quot; &quot;${ClientsRegName}&quot;</span>
<a href="#l2.85"></a><span id="l2.85">   WriteRegStr HKLM &quot;$0\DefaultIcon&quot; &quot;&quot; &quot;$8,0&quot;</span>
<a href="#l2.86"></a><span id="l2.86">   WriteRegStr HKLM &quot;$0&quot; &quot;DLLPath&quot; &quot;$6&quot;</span>
<a href="#l2.87"></a><span id="l2.87"> </span>
<a href="#l2.88"></a><span id="l2.88">   ; The MapiProxy dll can exist in multiple installs of the application.</span>
<a href="#l2.89"></a><span id="l2.89">   ; Registration occurs as follows with the last action to occur being the one</span>
<a href="#l2.90"></a><span id="l2.90">   ; that wins:</span>
<a href="#l2.91"></a><span id="l2.91">   ; On install and software update when helper.exe runs with the /PostUpdate</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-  ; argument. On setting the application as the system's default application </span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+  ; argument. On setting the application as the system's default application</span>
<a href="#l2.94"></a><span id="l2.94">   ; using Window's &quot;Set program access and defaults&quot;.</span>
<a href="#l2.95"></a><span id="l2.95"> </span>
<a href="#l2.96"></a><span id="l2.96">   !ifndef NO_LOG</span>
<a href="#l2.97"></a><span id="l2.97">     ${LogHeader} &quot;DLL Registration&quot;</span>
<a href="#l2.98"></a><span id="l2.98">   !endif</span>
<a href="#l2.99"></a><span id="l2.99">   ClearErrors</span>
<a href="#l2.100"></a><span id="l2.100">   ${RegisterDLL} &quot;$INSTDIR\MapiProxy_InUse.dll&quot;</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineminus">-  !ifndef NO_LOG  </span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+  !ifndef NO_LOG</span>
<a href="#l2.103"></a><span id="l2.103">     ${If} ${Errors}</span>
<a href="#l2.104"></a><span id="l2.104">       ${LogMsg} &quot;** ERROR Registering: $INSTDIR\MapiProxy_InUse.dll **&quot;</span>
<a href="#l2.105"></a><span id="l2.105">     ${Else}</span>
<a href="#l2.106"></a><span id="l2.106">       ${LogUninstall} &quot;DLLReg: \MapiProxy_InUse.dll&quot;</span>
<a href="#l2.107"></a><span id="l2.107">       ${LogMsg} &quot;Registered: $INSTDIR\MapiProxy_InUse.dll&quot;</span>
<a href="#l2.108"></a><span id="l2.108">     ${EndIf}</span>
<a href="#l2.109"></a><span id="l2.109">   !endif</span>
<a href="#l2.110"></a><span id="l2.110"> </span>
<a href="#l2.111"></a><span id="l2.111" class="difflineat">@@ -580,17 +580,17 @@</span>
<a href="#l2.112"></a><span id="l2.112">     ; These values associate the allowed certificates for the previous</span>
<a href="#l2.113"></a><span id="l2.113">     ;  installation, so that we can update from it cleanly using the</span>
<a href="#l2.114"></a><span id="l2.114">     ;  old updater.exe (which will still have this signature).</span>
<a href="#l2.115"></a><span id="l2.115">     WriteRegStr HKLM &quot;$R0\1&quot; &quot;name&quot; &quot;${CERTIFICATE_NAME_PREVIOUS}&quot;</span>
<a href="#l2.116"></a><span id="l2.116">     WriteRegStr HKLM &quot;$R0\1&quot; &quot;issuer&quot; &quot;${CERTIFICATE_ISSUER_PREVIOUS}&quot;</span>
<a href="#l2.117"></a><span id="l2.117"> </span>
<a href="#l2.118"></a><span id="l2.118">     SetRegView lastused</span>
<a href="#l2.119"></a><span id="l2.119">     ClearErrors</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineminus">-  ${EndIf} </span>
<a href="#l2.121"></a><span id="l2.121" class="difflineplus">+  ${EndIf}</span>
<a href="#l2.122"></a><span id="l2.122">   ; Restore the previously used value back</span>
<a href="#l2.123"></a><span id="l2.123">   Pop $R0</span>
<a href="#l2.124"></a><span id="l2.124"> !macroend</span>
<a href="#l2.125"></a><span id="l2.125"> !define AddMaintCertKeys &quot;!insertmacro AddMaintCertKeys&quot;</span>
<a href="#l2.126"></a><span id="l2.126"> !endif</span>
<a href="#l2.127"></a><span id="l2.127"> </span>
<a href="#l2.128"></a><span id="l2.128"> ; Removes various registry entries for reasons noted below (does not use SHCTX).</span>
<a href="#l2.129"></a><span id="l2.129"> !macro RemoveDeprecatedKeys</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineat">@@ -1017,22 +1017,22 @@ Function SetAsDefaultAppUser</span>
<a href="#l2.131"></a><span id="l2.131">   ${EndUnless}</span>
<a href="#l2.132"></a><span id="l2.132"> </span>
<a href="#l2.133"></a><span id="l2.133">   ; The code after ElevateUAC won't be executed on Vista and above when the</span>
<a href="#l2.134"></a><span id="l2.134">   ; user:</span>
<a href="#l2.135"></a><span id="l2.135">   ; a) is a member of the administrators group (e.g. elevation is required)</span>
<a href="#l2.136"></a><span id="l2.136">   ; b) is not a member of the administrators group and chooses to elevate</span>
<a href="#l2.137"></a><span id="l2.137">   ${ElevateUAC}</span>
<a href="#l2.138"></a><span id="l2.138"> </span>
<a href="#l2.139"></a><span id="l2.139" class="difflineminus">-  SetShellVarContext all  ; Set SHCTX to all users (e.g. HKLM)  </span>
<a href="#l2.140"></a><span id="l2.140" class="difflineplus">+  SetShellVarContext all  ; Set SHCTX to all users (e.g. HKLM)</span>
<a href="#l2.141"></a><span id="l2.141">   ${SetClientsMail}</span>
<a href="#l2.142"></a><span id="l2.142">   ${SetClientsNews}</span>
<a href="#l2.143"></a><span id="l2.143"> </span>
<a href="#l2.144"></a><span id="l2.144">   ${RemoveDeprecatedKeys}</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineminus">-  ${PinToTaskBar}</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineplus">+  ${MigrateTaskBarShortcut}</span>
<a href="#l2.147"></a><span id="l2.147"> </span>
<a href="#l2.148"></a><span id="l2.148">   ClearErrors</span>
<a href="#l2.149"></a><span id="l2.149">   ${GetParameters} $0</span>
<a href="#l2.150"></a><span id="l2.150">   ${GetOptions} &quot;$0&quot; &quot;/UAC:&quot; $0</span>
<a href="#l2.151"></a><span id="l2.151">   ${If} ${Errors}</span>
<a href="#l2.152"></a><span id="l2.152">     ClearErrors</span>
<a href="#l2.153"></a><span id="l2.153">     ${GetOptions} &quot;$R0&quot; &quot;Mail&quot; $R1</span>
<a href="#l2.154"></a><span id="l2.154">     ${Unless} ${Errors}</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

