<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 2170:c55d44c0a936ff3c39a32ce39e8af375961ec1f6</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ c55d44c0a936ff3c39a32ce39e8af375961ec1f6" />
<meta property="og:url" content="/comm-central/rev/c55d44c0a936ff3c39a32ce39e8af375961ec1f6" />
<meta property="og:description" content="Bug 473091 - &quot;Saved Search doesnt allow &quot;Tags isn't empty&quot;&quot; [r=kent sr=bienvenu]" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / c55d44c0a936ff3c39a32ce39e8af375961ec1f6 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/c55d44c0a936ff3c39a32ce39e8af375961ec1f6">shortlog</a> |
<a href="/comm-central/log/c55d44c0a936ff3c39a32ce39e8af375961ec1f6">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/c55d44c0a936ff3c39a32ce39e8af375961ec1f6">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/c55d44c0a936ff3c39a32ce39e8af375961ec1f6">files</a> |
changeset |
<a href="/comm-central/raw-rev/c55d44c0a936ff3c39a32ce39e8af375961ec1f6">raw</a>  | <a href="/comm-central/archive/c55d44c0a936ff3c39a32ce39e8af375961ec1f6.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=473091">Bug 473091</a> - &quot;Saved Search doesnt allow &quot;Tags isn't empty&quot;&quot; [r=kent sr=bienvenu]
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#101;&#110;&#116;&#32;&#74;&#97;&#109;&#101;&#115;&#32;&#60;&#107;&#101;&#110;&#116;&#64;&#99;&#97;&#115;&#112;&#105;&#97;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 10 Mar 2009 09:24:42 +0000</td></tr>

<tr>
 <td>changeset 2170</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/c55d44c0a936ff3c39a32ce39e8af375961ec1f6">c55d44c0a936ff3c39a32ce39e8af375961ec1f6</a></td>
</tr>



<tr>
<td>parent 2169</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b2161ed4236af25bbeb62f0f4df3ac6c9869d74f">b2161ed4236af25bbeb62f0f4df3ac6c9869d74f</a>
</td>
</tr>

<tr>
<td>child 2171</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/052188a962d523f3ce8d718f63597df2a4bc983d">052188a962d523f3ce8d718f63597df2a4bc983d</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=c55d44c0a936ff3c39a32ce39e8af375961ec1f6">1756</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 10 Mar 2009 09:30:39 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@c55d44c0a936 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c55d44c0a936ff3c39a32ce39e8af375961ec1f6">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c55d44c0a936ff3c39a32ce39e8af375961ec1f6&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c55d44c0a936ff3c39a32ce39e8af375961ec1f6&newProject=comm-central&newRevision=bb5b6688c2ba2c7a296efebe9083c13a75c95440&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c55d44c0a936ff3c39a32ce39e8af375961ec1f6&newProject=comm-central&newRevision=bb5b6688c2ba2c7a296efebe9083c13a75c95440&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c55d44c0a936ff3c39a32ce39e8af375961ec1f6&newProject=comm-central&newRevision=bb5b6688c2ba2c7a296efebe9083c13a75c95440&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28kent%29&revcount=50">kent</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=473091">473091</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=473091">Bug 473091</a> - &quot;Saved Search doesnt allow &quot;Tags isn't empty&quot;&quot; [r=kent sr=bienvenu]</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/base/content/mailWidgets.xml">mail/base/content/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/base/content/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/base/content/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/base/content/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/base/content/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/base/content/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/locales/en-US/chrome/messenger/search-operators.properties">mail/locales/en-US/chrome/messenger/search-operators.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/locales/en-US/chrome/messenger/search-operators.properties">file</a> |
<a href="/comm-central/annotate/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/locales/en-US/chrome/messenger/search-operators.properties">annotate</a> |
<a href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/locales/en-US/chrome/messenger/search-operators.properties">diff</a> |
<a href="/comm-central/comparison/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/locales/en-US/chrome/messenger/search-operators.properties">comparison</a> |
<a href="/comm-central/log/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mail/locales/en-US/chrome/messenger/search-operators.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/public/nsMsgSearchCore.idl">mailnews/base/search/public/nsMsgSearchCore.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/public/nsMsgSearchCore.idl">file</a> |
<a href="/comm-central/annotate/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/public/nsMsgSearchCore.idl">annotate</a> |
<a href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/public/nsMsgSearchCore.idl">diff</a> |
<a href="/comm-central/comparison/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/public/nsMsgSearchCore.idl">comparison</a> |
<a href="/comm-central/log/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/public/nsMsgSearchCore.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgImapSearch.cpp">mailnews/base/search/src/nsMsgImapSearch.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgImapSearch.cpp">file</a> |
<a href="/comm-central/annotate/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgImapSearch.cpp">annotate</a> |
<a href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgImapSearch.cpp">diff</a> |
<a href="/comm-central/comparison/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgImapSearch.cpp">comparison</a> |
<a href="/comm-central/log/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgImapSearch.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/test/unit/test_searchTag.js">mailnews/base/test/unit/test_searchTag.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/test/unit/test_searchTag.js">file</a> |
<a href="/comm-central/annotate/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/test/unit/test_searchTag.js">annotate</a> |
<a href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/test/unit/test_searchTag.js">diff</a> |
<a href="/comm-central/comparison/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/test/unit/test_searchTag.js">comparison</a> |
<a href="/comm-central/log/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/mailnews/base/test/unit/test_searchTag.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/locales/en-US/chrome/mailnews/search-operators.properties">suite/locales/en-US/chrome/mailnews/search-operators.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/locales/en-US/chrome/mailnews/search-operators.properties">file</a> |
<a href="/comm-central/annotate/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/locales/en-US/chrome/mailnews/search-operators.properties">annotate</a> |
<a href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/locales/en-US/chrome/mailnews/search-operators.properties">diff</a> |
<a href="/comm-central/comparison/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/locales/en-US/chrome/mailnews/search-operators.properties">comparison</a> |
<a href="/comm-central/log/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/locales/en-US/chrome/mailnews/search-operators.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/mailnews/mailWidgets.xml">suite/mailnews/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/mailnews/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/mailnews/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/mailnews/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/mailnews/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/c55d44c0a936ff3c39a32ce39e8af375961ec1f6/suite/mailnews/mailWidgets.xml">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mailWidgets.xml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.xml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1105,17 +1105,18 @@</span>
<a href="#l1.4"></a><span id="l1.4">       &lt;property name=&quot;opParentValue&quot; onget=&quot;return this.internalOperator;&quot;&gt;</span>
<a href="#l1.5"></a><span id="l1.5">         &lt;setter&gt;</span>
<a href="#l1.6"></a><span id="l1.6">           &lt;![CDATA[</span>
<a href="#l1.7"></a><span id="l1.7">             // noop if we're not changing it</span>
<a href="#l1.8"></a><span id="l1.8">             if (this.internalOperator == val) return val;</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">             // Keywords has the null field IsEmpty</span>
<a href="#l1.11"></a><span id="l1.11">             if (this.searchAttribute == Components.interfaces.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-              if (val == Components.interfaces.nsMsgSearchOp.IsEmpty)</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+              if (val == Components.interfaces.nsMsgSearchOp.IsEmpty ||</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+                  val == Components.interfaces.nsMsgSearchOp.IsntEmpty)</span>
<a href="#l1.15"></a><span id="l1.15">                 this.setAttribute(&quot;selectedIndex&quot;, &quot;-1&quot;);</span>
<a href="#l1.16"></a><span id="l1.16">               else</span>
<a href="#l1.17"></a><span id="l1.17">                 this.setAttribute(&quot;selectedIndex&quot;, &quot;5&quot;);</span>
<a href="#l1.18"></a><span id="l1.18">             }</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">               // if it's not sender, to, cc, alladdresses, or toorcc, we don't care</span>
<a href="#l1.21"></a><span id="l1.21">               if (this.searchAttribute != Components.interfaces.nsMsgSearchAttrib.Sender &amp;&amp; </span>
<a href="#l1.22"></a><span id="l1.22">                 this.searchAttribute != Components.interfaces.nsMsgSearchAttrib.To &amp;&amp; </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/search-operators.properties</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/search-operators.properties</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -17,9 +17,10 @@ 11=sounds like</span>
<a href="#l2.4"></a><span id="l2.4"> 12=LdapDwim</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6"> 13=is greater than</span>
<a href="#l2.7"></a><span id="l2.7"> 14=is less than</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> 15=NameCompletion</span>
<a href="#l2.10"></a><span id="l2.10"> 16=is in my address book</span>
<a href="#l2.11"></a><span id="l2.11"> 17=isn't in my address book</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+18=isn't empty</span>
<a href="#l2.13"></a><span id="l2.13"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgSearchCore.idl</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgSearchCore.idl</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -145,17 +145,18 @@ interface nsMsgSearchOp {</span>
<a href="#l3.4"></a><span id="l3.4">     const nsMsgSearchOpValue LdapDwim = 12; /* Do What I Mean for simple search */</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">     const nsMsgSearchOpValue IsGreaterThan = 13;</span>
<a href="#l3.7"></a><span id="l3.7">     const nsMsgSearchOpValue IsLessThan = 14;</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">     const nsMsgSearchOpValue NameCompletion = 15; /* Name Completion operator...as the name implies =) */</span>
<a href="#l3.10"></a><span id="l3.10">     const nsMsgSearchOpValue IsInAB = 16;</span>
<a href="#l3.11"></a><span id="l3.11">     const nsMsgSearchOpValue IsntInAB = 17;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    const nsMsgSearchOpValue kNumMsgSearchOperators  = 18;     /* must be last operator */</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    const nsMsgSearchOpValue IsntEmpty = 18; /* primarily for tags */</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+    const nsMsgSearchOpValue kNumMsgSearchOperators  = 19;     /* must be last operator */</span>
<a href="#l3.15"></a><span id="l3.15"> };</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> typedef long nsMsgSearchWidgetValue;</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> /* FEs use this to help build the search dialog box */</span>
<a href="#l3.20"></a><span id="l3.20"> [scriptable,uuid(903dd2e8-304e-11d3-92e6-00a0c900d445)]</span>
<a href="#l3.21"></a><span id="l3.21"> interface nsMsgSearchWidget {</span>
<a href="#l3.22"></a><span id="l3.22">     const nsMsgSearchWidgetValue Text = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgImapSearch.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgImapSearch.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -351,16 +351,18 @@ nsMsgSearchValidityManager::InitOfflineM</span>
<a href="#l4.4"></a><span id="l4.4">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l4.5"></a><span id="l4.5">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l4.6"></a><span id="l4.6">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.7"></a><span id="l4.7">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.8"></a><span id="l4.8">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l4.9"></a><span id="l4.9">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l4.10"></a><span id="l4.10">   m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l4.11"></a><span id="l4.11">   m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+  m_offlineMailTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  m_offlineMailTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l4.14"></a><span id="l4.14">   return rv;</span>
<a href="#l4.15"></a><span id="l4.15"> }</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18"> nsresult </span>
<a href="#l4.19"></a><span id="l4.19"> nsMsgSearchValidityManager::InitOnlineMailTable()</span>
<a href="#l4.20"></a><span id="l4.20"> {</span>
<a href="#l4.21"></a><span id="l4.21">   NS_ASSERTION(!m_onlineMailTable, &quot;Online mail table already initted!&quot;);</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -570,16 +572,18 @@ nsMsgSearchValidityManager::InitOnlineMa</span>
<a href="#l4.23"></a><span id="l4.23">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l4.24"></a><span id="l4.24">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l4.25"></a><span id="l4.25">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.26"></a><span id="l4.26">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.27"></a><span id="l4.27">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l4.28"></a><span id="l4.28">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l4.29"></a><span id="l4.29">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l4.30"></a><span id="l4.30">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+  m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l4.33"></a><span id="l4.33"> </span>
<a href="#l4.34"></a><span id="l4.34">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l4.35"></a><span id="l4.35">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l4.36"></a><span id="l4.36">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.37"></a><span id="l4.37">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.38"></a><span id="l4.38">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l4.39"></a><span id="l4.39">   m_onlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l4.40"></a><span id="l4.40">   m_onlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineat">@@ -738,16 +742,18 @@ nsMsgSearchValidityManager::InitOfflineM</span>
<a href="#l4.42"></a><span id="l4.42">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l4.43"></a><span id="l4.43">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l4.44"></a><span id="l4.44">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.45"></a><span id="l4.45">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.46"></a><span id="l4.46">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l4.47"></a><span id="l4.47">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l4.48"></a><span id="l4.48">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l4.49"></a><span id="l4.49">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+  m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+  m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l4.52"></a><span id="l4.52"> </span>
<a href="#l4.53"></a><span id="l4.53">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l4.54"></a><span id="l4.54">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l4.55"></a><span id="l4.55">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l4.56"></a><span id="l4.56">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l4.57"></a><span id="l4.57">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.58"></a><span id="l4.58">   m_offlineMailFilterTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l4.59"></a><span id="l4.59">   m_offlineMailFilterTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Isnt, 1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -228,16 +228,17 @@ typedef struct</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> nsMsgSearchOperatorEntry SearchOperatorEntryTable[] =</span>
<a href="#l5.6"></a><span id="l5.6"> {</span>
<a href="#l5.7"></a><span id="l5.7">   {nsMsgSearchOp::Contains, &quot;contains&quot;},</span>
<a href="#l5.8"></a><span id="l5.8">   {nsMsgSearchOp::DoesntContain,&quot;doesn't contain&quot;},</span>
<a href="#l5.9"></a><span id="l5.9">   {nsMsgSearchOp::Is,&quot;is&quot;},</span>
<a href="#l5.10"></a><span id="l5.10">   {nsMsgSearchOp::Isnt,  &quot;isn't&quot;},</span>
<a href="#l5.11"></a><span id="l5.11">   {nsMsgSearchOp::IsEmpty, &quot;is empty&quot;},</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+  {nsMsgSearchOp::IsntEmpty, &quot;isn't empty&quot;},</span>
<a href="#l5.13"></a><span id="l5.13">   {nsMsgSearchOp::IsBefore, &quot;is before&quot;},</span>
<a href="#l5.14"></a><span id="l5.14">   {nsMsgSearchOp::IsAfter, &quot;is after&quot;},</span>
<a href="#l5.15"></a><span id="l5.15">   {nsMsgSearchOp::IsHigherThan, &quot;is higher than&quot;},</span>
<a href="#l5.16"></a><span id="l5.16">   {nsMsgSearchOp::IsLowerThan, &quot;is lower than&quot;},</span>
<a href="#l5.17"></a><span id="l5.17">   {nsMsgSearchOp::BeginsWith, &quot;begins with&quot;},</span>
<a href="#l5.18"></a><span id="l5.18">   {nsMsgSearchOp::EndsWith, &quot;ends with&quot;},</span>
<a href="#l5.19"></a><span id="l5.19">   {nsMsgSearchOp::IsInAB, &quot;is in ab&quot;},</span>
<a href="#l5.20"></a><span id="l5.20">   {nsMsgSearchOp::IsntInAB, &quot;isn't in ab&quot;},</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -988,18 +989,18 @@ nsresult nsMsgSearchTerm::MatchString (c</span>
<a href="#l5.22"></a><span id="l5.22"> {</span>
<a href="#l5.23"></a><span id="l5.23">   NS_ENSURE_ARG_POINTER(pResult);</span>
<a href="#l5.24"></a><span id="l5.24">   PRBool result = PR_FALSE;</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26">   nsresult err = NS_OK;</span>
<a href="#l5.27"></a><span id="l5.27">   nsAutoString utf16StrToMatch;</span>
<a href="#l5.28"></a><span id="l5.28">   nsAutoString needle;</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-  // Save some performance for opIsEmpty</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-  if(nsMsgSearchOp::IsEmpty != m_operator)</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+  // Save some performance for opIsEmpty / opIsntEmpty</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+  if(nsMsgSearchOp::IsEmpty != m_operator &amp;&amp; nsMsgSearchOp::IsntEmpty != m_operator)</span>
<a href="#l5.34"></a><span id="l5.34">   {</span>
<a href="#l5.35"></a><span id="l5.35">     NS_ASSERTION(MsgIsUTF8(nsDependentCString(m_value.string)),</span>
<a href="#l5.36"></a><span id="l5.36">                  &quot;m_value.string is not UTF-8&quot;);</span>
<a href="#l5.37"></a><span id="l5.37">     CopyUTF8toUTF16(nsDependentCString(m_value.string), needle);</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">     if (charset != nsnull)</span>
<a href="#l5.40"></a><span id="l5.40">     {</span>
<a href="#l5.41"></a><span id="l5.41">       ConvertToUnicode(charset, stringToMatch ? stringToMatch : &quot;&quot;,</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineat">@@ -1046,16 +1047,21 @@ nsresult nsMsgSearchTerm::MatchString (c</span>
<a href="#l5.43"></a><span id="l5.43"> #endif</span>
<a href="#l5.44"></a><span id="l5.44">       result = PR_TRUE;</span>
<a href="#l5.45"></a><span id="l5.45">     break;</span>
<a href="#l5.46"></a><span id="l5.46">   case nsMsgSearchOp::IsEmpty:</span>
<a href="#l5.47"></a><span id="l5.47">     // For IsEmpty, we didn't copy stringToMatch to utf16StrToMatch.</span>
<a href="#l5.48"></a><span id="l5.48">     if (!PL_strlen(stringToMatch))</span>
<a href="#l5.49"></a><span id="l5.49">       result = PR_TRUE;</span>
<a href="#l5.50"></a><span id="l5.50">     break;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+  case nsMsgSearchOp::IsntEmpty:</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+    // For IsntEmpty, we didn't copy stringToMatch to utf16StrToMatch.</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+    if (PL_strlen(stringToMatch))</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+      result = PR_TRUE;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+    break;</span>
<a href="#l5.56"></a><span id="l5.56">   case nsMsgSearchOp::BeginsWith:</span>
<a href="#l5.57"></a><span id="l5.57"> #ifdef MOZILLA_INTERNAL_API</span>
<a href="#l5.58"></a><span id="l5.58">     if (StringBeginsWith(utf16StrToMatch, needle,</span>
<a href="#l5.59"></a><span id="l5.59">                          nsCaseInsensitiveStringComparator()))</span>
<a href="#l5.60"></a><span id="l5.60"> #else</span>
<a href="#l5.61"></a><span id="l5.61">     if (StringBeginsWith(utf16StrToMatch, needle, CaseInsensitiveCompare))</span>
<a href="#l5.62"></a><span id="l5.62"> #endif</span>
<a href="#l5.63"></a><span id="l5.63">       result = PR_TRUE;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineat">@@ -1426,33 +1432,34 @@ nsresult nsMsgSearchTerm::MatchStatus(PR</span>
<a href="#l5.65"></a><span id="l5.65"> </span>
<a href="#l5.66"></a><span id="l5.66">   *pResult = matches;</span>
<a href="#l5.67"></a><span id="l5.67">   return rv;</span>
<a href="#l5.68"></a><span id="l5.68"> }</span>
<a href="#l5.69"></a><span id="l5.69"> </span>
<a href="#l5.70"></a><span id="l5.70"> /*</span>
<a href="#l5.71"></a><span id="l5.71">  * MatchKeyword Logic table (*pResult: + is true, - is false)</span>
<a href="#l5.72"></a><span id="l5.72">  *</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">- *         # Valid Tokens IsEmpty Contains DoesntContain Is     Isnt</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">- *                0           +       -         +         -       +</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">- * Term found?                      N   Y     N   Y     N   Y   N   Y</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">- *                1           -     -   +     +   -     -   +   +   -</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">- *               &gt;1           -     -   +     +   -     -   -   +   +</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+ *         # Valid Tokens IsEmpty IsntEmpty Contains DoesntContain Is     Isnt</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+ *                0           +         -      -         +         -       +</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+ * Term found?                               N   Y     N   Y     N   Y   N   Y</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+ *                1           -         +    -   +     +   -     -   +   +   -</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+ *               &gt;1           -         +    -   +     +   -     -   -   +   +</span>
<a href="#l5.83"></a><span id="l5.83">  */</span>
<a href="#l5.84"></a><span id="l5.84"> // look up nsMsgSearchTerm::m_value in space-delimited keywordList</span>
<a href="#l5.85"></a><span id="l5.85"> nsresult nsMsgSearchTerm::MatchKeyword(const nsACString&amp; keywordList, PRBool *pResult)</span>
<a href="#l5.86"></a><span id="l5.86"> {</span>
<a href="#l5.87"></a><span id="l5.87">   NS_ENSURE_ARG_POINTER(pResult);</span>
<a href="#l5.88"></a><span id="l5.88">   PRBool matches = PR_FALSE;</span>
<a href="#l5.89"></a><span id="l5.89"> </span>
<a href="#l5.90"></a><span id="l5.90">   // special-case empty for performance reasons</span>
<a href="#l5.91"></a><span id="l5.91">   if (keywordList.IsEmpty())</span>
<a href="#l5.92"></a><span id="l5.92">   {</span>
<a href="#l5.93"></a><span id="l5.93">     *pResult =  m_operator != nsMsgSearchOp::Contains &amp;&amp;</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-                m_operator != nsMsgSearchOp::Is;</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+                m_operator != nsMsgSearchOp::Is &amp;&amp;</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+                m_operator != nsMsgSearchOp::IsntEmpty;</span>
<a href="#l5.97"></a><span id="l5.97">     return NS_OK;</span>
<a href="#l5.98"></a><span id="l5.98">   }</span>
<a href="#l5.99"></a><span id="l5.99"> </span>
<a href="#l5.100"></a><span id="l5.100">   // check if we can skip expensive valid keywordList test</span>
<a href="#l5.101"></a><span id="l5.101">   if (m_operator == nsMsgSearchOp::DoesntContain ||</span>
<a href="#l5.102"></a><span id="l5.102">       m_operator == nsMsgSearchOp::Contains)</span>
<a href="#l5.103"></a><span id="l5.103">   {</span>
<a href="#l5.104"></a><span id="l5.104">     nsCString keywordString(keywordList);</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineat">@@ -1498,16 +1505,23 @@ nsresult nsMsgSearchTerm::MatchKeyword(c</span>
<a href="#l5.106"></a><span id="l5.106">     {</span>
<a href="#l5.107"></a><span id="l5.107">       // IsEmpty fails on any valid token</span>
<a href="#l5.108"></a><span id="l5.108">       if (m_operator == nsMsgSearchOp::IsEmpty)</span>
<a href="#l5.109"></a><span id="l5.109">       {</span>
<a href="#l5.110"></a><span id="l5.110">         *pResult = PR_FALSE;</span>
<a href="#l5.111"></a><span id="l5.111">         return rv;</span>
<a href="#l5.112"></a><span id="l5.112">       }</span>
<a href="#l5.113"></a><span id="l5.113"> </span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+      // IsntEmpty succeeds on any valid token</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+      if (m_operator == nsMsgSearchOp::IsntEmpty)</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineplus">+      {</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineplus">+        *pResult = PR_TRUE;</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+        return rv;</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineplus">+      }</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineplus">+</span>
<a href="#l5.121"></a><span id="l5.121">       // Does this valid tag key match our search term?</span>
<a href="#l5.122"></a><span id="l5.122">       matches = keywordArray[i].Equals(m_value.string);</span>
<a href="#l5.123"></a><span id="l5.123"> </span>
<a href="#l5.124"></a><span id="l5.124">       // Is or Isn't partly determined on a single unmatched token</span>
<a href="#l5.125"></a><span id="l5.125">       if (!matches)</span>
<a href="#l5.126"></a><span id="l5.126">       {</span>
<a href="#l5.127"></a><span id="l5.127">         if (m_operator == nsMsgSearchOp::Is)</span>
<a href="#l5.128"></a><span id="l5.128">         {</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineat">@@ -1536,16 +1550,23 @@ nsresult nsMsgSearchTerm::MatchKeyword(c</span>
<a href="#l5.130"></a><span id="l5.130">   }</span>
<a href="#l5.131"></a><span id="l5.131"> </span>
<a href="#l5.132"></a><span id="l5.132">   if (m_operator == nsMsgSearchOp::IsEmpty)</span>
<a href="#l5.133"></a><span id="l5.133">   {</span>
<a href="#l5.134"></a><span id="l5.134">     *pResult = PR_TRUE;</span>
<a href="#l5.135"></a><span id="l5.135">     return NS_OK;</span>
<a href="#l5.136"></a><span id="l5.136">   }</span>
<a href="#l5.137"></a><span id="l5.137"> </span>
<a href="#l5.138"></a><span id="l5.138" class="difflineplus">+  if (m_operator == nsMsgSearchOp::IsntEmpty)</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineplus">+  {</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineplus">+    *pResult = PR_FALSE;</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineplus">+    return NS_OK;</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineplus">+  }</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+</span>
<a href="#l5.145"></a><span id="l5.145">   // no valid match operator found</span>
<a href="#l5.146"></a><span id="l5.146">   NS_ERROR(&quot;invalid compare op for msg status&quot;);</span>
<a href="#l5.147"></a><span id="l5.147">   return NS_ERROR_FAILURE;</span>
<a href="#l5.148"></a><span id="l5.148"> }</span>
<a href="#l5.149"></a><span id="l5.149"> </span>
<a href="#l5.150"></a><span id="l5.150"> nsresult</span>
<a href="#l5.151"></a><span id="l5.151"> nsMsgSearchTerm::MatchPriority (nsMsgPriorityValue priorityToMatch,</span>
<a href="#l5.152"></a><span id="l5.152">                                 PRBool *pResult)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchTag.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchTag.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -50,16 +50,17 @@ const copyService = Cc[&quot;@mozilla.org/mes</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5"> const nsMsgSearchScope = Ci.nsMsgSearchScope;</span>
<a href="#l6.6"></a><span id="l6.6"> const nsMsgSearchAttrib = Ci.nsMsgSearchAttrib;</span>
<a href="#l6.7"></a><span id="l6.7"> const nsMsgSearchOp = Ci.nsMsgSearchOp;</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> const Isnt = nsMsgSearchOp.Isnt;</span>
<a href="#l6.10"></a><span id="l6.10"> const Is = nsMsgSearchOp.Is;</span>
<a href="#l6.11"></a><span id="l6.11"> const IsEmpty = nsMsgSearchOp.IsEmpty;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+const IsntEmpty = nsMsgSearchOp.IsntEmpty;</span>
<a href="#l6.13"></a><span id="l6.13"> const Contains = nsMsgSearchOp.Contains;</span>
<a href="#l6.14"></a><span id="l6.14"> const DoesntContain = nsMsgSearchOp.DoesntContain;</span>
<a href="#l6.15"></a><span id="l6.15"> const IsBefore = nsMsgSearchOp.IsBefore; // control entry not enabled</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17"> const offlineMail = nsMsgSearchScope.offlineMail;</span>
<a href="#l6.18"></a><span id="l6.18"> const onlineMail = nsMsgSearchScope.onlineMail;</span>
<a href="#l6.19"></a><span id="l6.19"> const offlineMailFilter = nsMsgSearchScope.offlineMailFilter;</span>
<a href="#l6.20"></a><span id="l6.20"> const onlineMailFilter = nsMsgSearchScope.onlineMailFilter;</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -95,16 +96,20 @@ var Tests =</span>
<a href="#l6.22"></a><span id="l6.22">   { msgTag: Tag1,</span>
<a href="#l6.23"></a><span id="l6.23">     testTag: Tag1,</span>
<a href="#l6.24"></a><span id="l6.24">     op: DoesntContain,</span>
<a href="#l6.25"></a><span id="l6.25">     count: 0 },</span>
<a href="#l6.26"></a><span id="l6.26">   { msgTag: Tag1,</span>
<a href="#l6.27"></a><span id="l6.27">     testTag: Tag1,</span>
<a href="#l6.28"></a><span id="l6.28">     op: IsEmpty,</span>
<a href="#l6.29"></a><span id="l6.29">     count: 0 },</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+  { msgTag: Tag1,</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+    testTag: Tag1,</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+    op: IsntEmpty,</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+    count: 1 },</span>
<a href="#l6.34"></a><span id="l6.34">   //test an invalid tag, should act like empty</span>
<a href="#l6.35"></a><span id="l6.35">   { msgTag: Tag2,</span>
<a href="#l6.36"></a><span id="l6.36">     testTag: Tag1,</span>
<a href="#l6.37"></a><span id="l6.37">     op: Contains,</span>
<a href="#l6.38"></a><span id="l6.38">     count: 0 },</span>
<a href="#l6.39"></a><span id="l6.39">   { msgTag: Tag2,</span>
<a href="#l6.40"></a><span id="l6.40">     testTag: Tag1,</span>
<a href="#l6.41"></a><span id="l6.41">     op: DoesntContain,</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineat">@@ -116,16 +121,20 @@ var Tests =</span>
<a href="#l6.43"></a><span id="l6.43">   { msgTag: Tag2,</span>
<a href="#l6.44"></a><span id="l6.44">     testTag: Tag1,</span>
<a href="#l6.45"></a><span id="l6.45">     op: Isnt,</span>
<a href="#l6.46"></a><span id="l6.46">     count: 1 },</span>
<a href="#l6.47"></a><span id="l6.47">   { msgTag: Tag2,</span>
<a href="#l6.48"></a><span id="l6.48">     testTag: Tag1,</span>
<a href="#l6.49"></a><span id="l6.49">     op: IsEmpty,</span>
<a href="#l6.50"></a><span id="l6.50">     count: 1 },</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+  { msgTag: Tag2,</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+    testTag: Tag1,</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+    op: IsntEmpty,</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+    count: 0 },</span>
<a href="#l6.55"></a><span id="l6.55"> //   Message has two valid tags</span>
<a href="#l6.56"></a><span id="l6.56">   // test first tag</span>
<a href="#l6.57"></a><span id="l6.57">   { msgTag: Tag1Tag4,</span>
<a href="#l6.58"></a><span id="l6.58">     testTag: Tag1,</span>
<a href="#l6.59"></a><span id="l6.59">     op: Is,</span>
<a href="#l6.60"></a><span id="l6.60">     count: 0 },</span>
<a href="#l6.61"></a><span id="l6.61">   { msgTag: Tag1Tag4,</span>
<a href="#l6.62"></a><span id="l6.62">     testTag: Tag1,</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineat">@@ -138,16 +147,20 @@ var Tests =</span>
<a href="#l6.64"></a><span id="l6.64">   { msgTag: Tag1Tag4,</span>
<a href="#l6.65"></a><span id="l6.65">     testTag: Tag1,</span>
<a href="#l6.66"></a><span id="l6.66">     op: DoesntContain,</span>
<a href="#l6.67"></a><span id="l6.67">     count: 0 },</span>
<a href="#l6.68"></a><span id="l6.68">   { msgTag: Tag1Tag4,</span>
<a href="#l6.69"></a><span id="l6.69">     testTag: Tag1,</span>
<a href="#l6.70"></a><span id="l6.70">     op: IsEmpty,</span>
<a href="#l6.71"></a><span id="l6.71">     count: 0 },</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+  { msgTag: Tag1Tag4,</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+    testTag: Tag1,</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineplus">+    op: IsntEmpty,</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+    count: 1 },</span>
<a href="#l6.76"></a><span id="l6.76">   // test second tag</span>
<a href="#l6.77"></a><span id="l6.77">   { msgTag: Tag1Tag4,</span>
<a href="#l6.78"></a><span id="l6.78">     testTag: Tag4,</span>
<a href="#l6.79"></a><span id="l6.79">     op: Is,</span>
<a href="#l6.80"></a><span id="l6.80">     count: 0 },</span>
<a href="#l6.81"></a><span id="l6.81">   { msgTag: Tag1Tag4,</span>
<a href="#l6.82"></a><span id="l6.82">     testTag: Tag4,</span>
<a href="#l6.83"></a><span id="l6.83">     op: Isnt,</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineat">@@ -159,16 +172,20 @@ var Tests =</span>
<a href="#l6.85"></a><span id="l6.85">   { msgTag: Tag1Tag4,</span>
<a href="#l6.86"></a><span id="l6.86">     testTag: Tag4,</span>
<a href="#l6.87"></a><span id="l6.87">     op: DoesntContain,</span>
<a href="#l6.88"></a><span id="l6.88">     count: 0 },</span>
<a href="#l6.89"></a><span id="l6.89">   { msgTag: Tag1Tag4,</span>
<a href="#l6.90"></a><span id="l6.90">     testTag: Tag4,</span>
<a href="#l6.91"></a><span id="l6.91">     op: IsEmpty,</span>
<a href="#l6.92"></a><span id="l6.92">     count: 0 },</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineplus">+  { msgTag: Tag1Tag4,</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineplus">+    testTag: Tag4,</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineplus">+    op: IsntEmpty,</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+    count: 1 },</span>
<a href="#l6.97"></a><span id="l6.97">   // test tag not in message</span>
<a href="#l6.98"></a><span id="l6.98">   { msgTag: Tag1Tag4,</span>
<a href="#l6.99"></a><span id="l6.99">     testTag: Tag2,</span>
<a href="#l6.100"></a><span id="l6.100">     op: Is,</span>
<a href="#l6.101"></a><span id="l6.101">     count: 0 },</span>
<a href="#l6.102"></a><span id="l6.102">   { msgTag: Tag1Tag4,</span>
<a href="#l6.103"></a><span id="l6.103">     testTag: Tag2,</span>
<a href="#l6.104"></a><span id="l6.104">     op: Isnt,</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineat">@@ -180,16 +197,20 @@ var Tests =</span>
<a href="#l6.106"></a><span id="l6.106">   { msgTag: Tag1Tag4,</span>
<a href="#l6.107"></a><span id="l6.107">     testTag: Tag2,</span>
<a href="#l6.108"></a><span id="l6.108">     op: DoesntContain,</span>
<a href="#l6.109"></a><span id="l6.109">     count: 1 },</span>
<a href="#l6.110"></a><span id="l6.110">   { msgTag: Tag1Tag4,</span>
<a href="#l6.111"></a><span id="l6.111">     testTag: Tag2,</span>
<a href="#l6.112"></a><span id="l6.112">     op: IsEmpty,</span>
<a href="#l6.113"></a><span id="l6.113">     count: 0 },</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineplus">+  { msgTag: Tag1Tag4,</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineplus">+    testTag: Tag2,</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineplus">+    op: IsntEmpty,</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineplus">+    count: 1 },</span>
<a href="#l6.118"></a><span id="l6.118">   // empty message</span>
<a href="#l6.119"></a><span id="l6.119">   { msgTag: &quot;&quot;,</span>
<a href="#l6.120"></a><span id="l6.120">     testTag: Tag2,</span>
<a href="#l6.121"></a><span id="l6.121">     op: Is,</span>
<a href="#l6.122"></a><span id="l6.122">     count: 0 },</span>
<a href="#l6.123"></a><span id="l6.123">   { msgTag: &quot;&quot;,</span>
<a href="#l6.124"></a><span id="l6.124">     testTag: Tag2,</span>
<a href="#l6.125"></a><span id="l6.125">     op: Isnt,</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineat">@@ -201,16 +222,20 @@ var Tests =</span>
<a href="#l6.127"></a><span id="l6.127">   { msgTag: &quot;&quot;,</span>
<a href="#l6.128"></a><span id="l6.128">     testTag: Tag2,</span>
<a href="#l6.129"></a><span id="l6.129">     op: DoesntContain,</span>
<a href="#l6.130"></a><span id="l6.130">     count: 1 },</span>
<a href="#l6.131"></a><span id="l6.131">   { msgTag: &quot;&quot;,</span>
<a href="#l6.132"></a><span id="l6.132">     testTag: Tag2,</span>
<a href="#l6.133"></a><span id="l6.133">     op: IsEmpty,</span>
<a href="#l6.134"></a><span id="l6.134">     count: 1 },</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineplus">+  { msgTag: &quot;&quot;,</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineplus">+    testTag: Tag2,</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineplus">+    op: IsntEmpty,</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineplus">+    count: 0 },</span>
<a href="#l6.139"></a><span id="l6.139"> // message with two tags, only one is valid</span>
<a href="#l6.140"></a><span id="l6.140">   // test with the single valid tag  </span>
<a href="#l6.141"></a><span id="l6.141">   { msgTag: Tag1Tag3,</span>
<a href="#l6.142"></a><span id="l6.142">     testTag: Tag1,</span>
<a href="#l6.143"></a><span id="l6.143">     op: Is,</span>
<a href="#l6.144"></a><span id="l6.144">     count: 1 },</span>
<a href="#l6.145"></a><span id="l6.145">   { msgTag: Tag1Tag3,</span>
<a href="#l6.146"></a><span id="l6.146">     testTag: Tag1,</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineat">@@ -223,16 +248,20 @@ var Tests =</span>
<a href="#l6.148"></a><span id="l6.148">   { msgTag: Tag1Tag3,</span>
<a href="#l6.149"></a><span id="l6.149">     testTag: Tag1,</span>
<a href="#l6.150"></a><span id="l6.150">     op: DoesntContain,</span>
<a href="#l6.151"></a><span id="l6.151">     count: 0 },</span>
<a href="#l6.152"></a><span id="l6.152">   { msgTag: Tag1Tag3,</span>
<a href="#l6.153"></a><span id="l6.153">     testTag: Tag1,</span>
<a href="#l6.154"></a><span id="l6.154">     op: IsEmpty,</span>
<a href="#l6.155"></a><span id="l6.155">     count: 0 },</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineplus">+  { msgTag: Tag1Tag3,</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineplus">+    testTag: Tag1,</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineplus">+    op: IsntEmpty,</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineplus">+    count: 1 },</span>
<a href="#l6.160"></a><span id="l6.160">   // test with a tag not in the message  </span>
<a href="#l6.161"></a><span id="l6.161">   { msgTag: Tag1Tag3,</span>
<a href="#l6.162"></a><span id="l6.162">     testTag: Tag2,</span>
<a href="#l6.163"></a><span id="l6.163">     op: Is,</span>
<a href="#l6.164"></a><span id="l6.164">     count: 0 },</span>
<a href="#l6.165"></a><span id="l6.165">   { msgTag: Tag1Tag3,</span>
<a href="#l6.166"></a><span id="l6.166">     testTag: Tag2,</span>
<a href="#l6.167"></a><span id="l6.167">     op: Isnt,</span>
<a href="#l6.168"></a><span id="l6.168" class="difflineat">@@ -244,16 +273,20 @@ var Tests =</span>
<a href="#l6.169"></a><span id="l6.169">   { msgTag: Tag1Tag3,</span>
<a href="#l6.170"></a><span id="l6.170">     testTag: Tag2,</span>
<a href="#l6.171"></a><span id="l6.171">     op: DoesntContain,</span>
<a href="#l6.172"></a><span id="l6.172">     count: 1 },</span>
<a href="#l6.173"></a><span id="l6.173">   { msgTag: Tag1Tag3,</span>
<a href="#l6.174"></a><span id="l6.174">     testTag: Tag2,</span>
<a href="#l6.175"></a><span id="l6.175">     op: IsEmpty,</span>
<a href="#l6.176"></a><span id="l6.176">     count: 0 },</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineplus">+  { msgTag: Tag1Tag3,</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineplus">+    testTag: Tag2,</span>
<a href="#l6.179"></a><span id="l6.179" class="difflineplus">+    op: IsntEmpty,</span>
<a href="#l6.180"></a><span id="l6.180" class="difflineplus">+    count: 1 },</span>
<a href="#l6.181"></a><span id="l6.181"> //   Message has a duplicated tag</span>
<a href="#l6.182"></a><span id="l6.182">   // test the tag</span>
<a href="#l6.183"></a><span id="l6.183">   { msgTag: Tag1Tag1,</span>
<a href="#l6.184"></a><span id="l6.184">     testTag: Tag1,</span>
<a href="#l6.185"></a><span id="l6.185">     op: Is,</span>
<a href="#l6.186"></a><span id="l6.186">     count: 1 },</span>
<a href="#l6.187"></a><span id="l6.187">   { msgTag: Tag1Tag1,</span>
<a href="#l6.188"></a><span id="l6.188">     testTag: Tag1,</span>
<a href="#l6.189"></a><span id="l6.189" class="difflineat">@@ -266,16 +299,20 @@ var Tests =</span>
<a href="#l6.190"></a><span id="l6.190">   { msgTag: Tag1Tag1,</span>
<a href="#l6.191"></a><span id="l6.191">     testTag: Tag1,</span>
<a href="#l6.192"></a><span id="l6.192">     op: DoesntContain,</span>
<a href="#l6.193"></a><span id="l6.193">     count: 0 },</span>
<a href="#l6.194"></a><span id="l6.194">   { msgTag: Tag1Tag1,</span>
<a href="#l6.195"></a><span id="l6.195">     testTag: Tag1,</span>
<a href="#l6.196"></a><span id="l6.196">     op: IsEmpty,</span>
<a href="#l6.197"></a><span id="l6.197">     count: 0 },</span>
<a href="#l6.198"></a><span id="l6.198" class="difflineplus">+  { msgTag: Tag1Tag1,</span>
<a href="#l6.199"></a><span id="l6.199" class="difflineplus">+    testTag: Tag1,</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineplus">+    op: IsntEmpty,</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineplus">+    count: 1 },</span>
<a href="#l6.202"></a><span id="l6.202"> </span>
<a href="#l6.203"></a><span id="l6.203"> ];</span>
<a href="#l6.204"></a><span id="l6.204"> </span>
<a href="#l6.205"></a><span id="l6.205"> var hdr;</span>
<a href="#l6.206"></a><span id="l6.206"> </span>
<a href="#l6.207"></a><span id="l6.207"> function run_test()</span>
<a href="#l6.208"></a><span id="l6.208"> {</span>
<a href="#l6.209"></a><span id="l6.209">   loadLocalMailAccount();</span>
<a href="#l6.210"></a><span id="l6.210" class="difflineat">@@ -283,48 +320,53 @@ function run_test()</span>
<a href="#l6.211"></a><span id="l6.211">   // test that validity table terms are valid</span>
<a href="#l6.212"></a><span id="l6.212"> </span>
<a href="#l6.213"></a><span id="l6.213">   // offline mail table</span>
<a href="#l6.214"></a><span id="l6.214">   testValidityTable(offlineMail, Contains, Keywords, true);</span>
<a href="#l6.215"></a><span id="l6.215">   testValidityTable(offlineMail, DoesntContain, Keywords, true);</span>
<a href="#l6.216"></a><span id="l6.216">   testValidityTable(offlineMail, Is, Keywords, true);</span>
<a href="#l6.217"></a><span id="l6.217">   testValidityTable(offlineMail, Isnt, Keywords, true);</span>
<a href="#l6.218"></a><span id="l6.218">   testValidityTable(offlineMail, IsEmpty, Keywords, true);</span>
<a href="#l6.219"></a><span id="l6.219" class="difflineplus">+  testValidityTable(offlineMail, IsntEmpty, Keywords, true);</span>
<a href="#l6.220"></a><span id="l6.220">   testValidityTable(offlineMail, IsBefore, Keywords, false);</span>
<a href="#l6.221"></a><span id="l6.221"> </span>
<a href="#l6.222"></a><span id="l6.222">   // offline mail filter table</span>
<a href="#l6.223"></a><span id="l6.223">   testValidityTable(offlineMailFilter, Contains, Keywords, true);</span>
<a href="#l6.224"></a><span id="l6.224">   testValidityTable(offlineMailFilter, DoesntContain, Keywords, true);</span>
<a href="#l6.225"></a><span id="l6.225">   testValidityTable(offlineMailFilter, Is, Keywords, true);</span>
<a href="#l6.226"></a><span id="l6.226">   testValidityTable(offlineMailFilter, Isnt, Keywords, true);</span>
<a href="#l6.227"></a><span id="l6.227">   testValidityTable(offlineMailFilter, IsEmpty, Keywords, true);</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineplus">+  testValidityTable(offlineMailFilter, IsntEmpty, Keywords, true);</span>
<a href="#l6.229"></a><span id="l6.229">   testValidityTable(offlineMailFilter, IsBefore, Keywords, false);</span>
<a href="#l6.230"></a><span id="l6.230"> </span>
<a href="#l6.231"></a><span id="l6.231">   // online mail</span>
<a href="#l6.232"></a><span id="l6.232">   testValidityTable(onlineMail, Contains, Keywords, true);</span>
<a href="#l6.233"></a><span id="l6.233">   testValidityTable(onlineMail, DoesntContain, Keywords, true);</span>
<a href="#l6.234"></a><span id="l6.234">   testValidityTable(onlineMail, Is, Keywords, false);</span>
<a href="#l6.235"></a><span id="l6.235">   testValidityTable(onlineMail, Isnt, Keywords, false);</span>
<a href="#l6.236"></a><span id="l6.236">   testValidityTable(onlineMail, IsEmpty, Keywords, false);</span>
<a href="#l6.237"></a><span id="l6.237" class="difflineplus">+  testValidityTable(onlineMail, IsntEmpty, Keywords, false);</span>
<a href="#l6.238"></a><span id="l6.238">   testValidityTable(onlineMail, IsBefore, Keywords, false);</span>
<a href="#l6.239"></a><span id="l6.239"> </span>
<a href="#l6.240"></a><span id="l6.240">   // online mail filter  </span>
<a href="#l6.241"></a><span id="l6.241">   testValidityTable(onlineMailFilter, Contains, Keywords, true);</span>
<a href="#l6.242"></a><span id="l6.242">   testValidityTable(onlineMailFilter, DoesntContain, Keywords, true);</span>
<a href="#l6.243"></a><span id="l6.243">   testValidityTable(onlineMailFilter, Is, Keywords, true);</span>
<a href="#l6.244"></a><span id="l6.244">   testValidityTable(onlineMailFilter, Isnt, Keywords, true);</span>
<a href="#l6.245"></a><span id="l6.245">   testValidityTable(onlineMailFilter, IsEmpty, Keywords, true);</span>
<a href="#l6.246"></a><span id="l6.246" class="difflineplus">+  testValidityTable(onlineMailFilter, IsntEmpty, Keywords, true);</span>
<a href="#l6.247"></a><span id="l6.247">   testValidityTable(onlineMailFilter, IsBefore, Keywords, false);</span>
<a href="#l6.248"></a><span id="l6.248"> </span>
<a href="#l6.249"></a><span id="l6.249">   // news</span>
<a href="#l6.250"></a><span id="l6.250">   testValidityTable(news, Contains, Keywords, false);</span>
<a href="#l6.251"></a><span id="l6.251">   testValidityTable(news, DoesntContain, Keywords, false);</span>
<a href="#l6.252"></a><span id="l6.252">   testValidityTable(news, Is, Keywords, false);</span>
<a href="#l6.253"></a><span id="l6.253">   testValidityTable(news, Isnt, Keywords, false);</span>
<a href="#l6.254"></a><span id="l6.254">   testValidityTable(news, IsEmpty, Keywords, false);</span>
<a href="#l6.255"></a><span id="l6.255" class="difflineplus">+  testValidityTable(news, IsntEmpty, Keywords, false);</span>
<a href="#l6.256"></a><span id="l6.256">   testValidityTable(news, IsBefore, Keywords, false);</span>
<a href="#l6.257"></a><span id="l6.257"> </span>
<a href="#l6.258"></a><span id="l6.258">   // delete any existing tags</span>
<a href="#l6.259"></a><span id="l6.259">   var tagArray = tagService.getAllTags({});</span>
<a href="#l6.260"></a><span id="l6.260">   for (var i = 0; i &lt; tagArray.length; i++)</span>
<a href="#l6.261"></a><span id="l6.261">     tagService.deleteKey(tagArray[i].key);</span>
<a href="#l6.262"></a><span id="l6.262"> </span>
<a href="#l6.263"></a><span id="l6.263">   // add as valid tags Tag1 and Tag4</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/search-operators.properties</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/search-operators.properties</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -17,9 +17,9 @@ 11=sounds like</span>
<a href="#l7.4"></a><span id="l7.4"> 12=LdapDwim</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> 13=is greater than</span>
<a href="#l7.7"></a><span id="l7.7"> 14=is less than</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> 15=NameCompletion</span>
<a href="#l7.10"></a><span id="l7.10"> 16=is in my address book</span>
<a href="#l7.11"></a><span id="l7.11"> 17=isn't in my address book</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+18=isn't empty</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/mailnews/mailWidgets.xml</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/mailnews/mailWidgets.xml</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1080,17 +1080,18 @@</span>
<a href="#l8.4"></a><span id="l8.4">       &lt;property name=&quot;opParentValue&quot; onget=&quot;return this.internalOperator;&quot;&gt;</span>
<a href="#l8.5"></a><span id="l8.5">         &lt;setter&gt;</span>
<a href="#l8.6"></a><span id="l8.6">           &lt;![CDATA[</span>
<a href="#l8.7"></a><span id="l8.7">             // noop if we're not changing it</span>
<a href="#l8.8"></a><span id="l8.8">             if (this.internalOperator == val) return val;</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">             // Keywords has the null field IsEmpty</span>
<a href="#l8.11"></a><span id="l8.11">             if (this.searchAttribute == Components.interfaces.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-              if (val == Components.interfaces.nsMsgSearchOp.IsEmpty)</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+              if (val == Components.interfaces.nsMsgSearchOp.IsEmpty ||</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+                  val == Components.interfaces.nsMsgSearchOp.IsntEmpty)</span>
<a href="#l8.15"></a><span id="l8.15">                 this.setAttribute(&quot;selectedIndex&quot;, &quot;-1&quot;);</span>
<a href="#l8.16"></a><span id="l8.16">               else</span>
<a href="#l8.17"></a><span id="l8.17">                 this.setAttribute(&quot;selectedIndex&quot;, &quot;5&quot;);</span>
<a href="#l8.18"></a><span id="l8.18">             }</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">               // if it's not sender, to, cc, alladdresses, or toorcc, we don't care</span>
<a href="#l8.21"></a><span id="l8.21">               if (this.searchAttribute != Components.interfaces.nsMsgSearchAttrib.Sender &amp;&amp; </span>
<a href="#l8.22"></a><span id="l8.22">                 this.searchAttribute != Components.interfaces.nsMsgSearchAttrib.To &amp;&amp; </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

