<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 19978:e3a88b8c91e2267ace82651ec29049f1f451aaca</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ e3a88b8c91e2267ace82651ec29049f1f451aaca" />
<meta property="og:url" content="/comm-central/rev/e3a88b8c91e2267ace82651ec29049f1f451aaca" />
<meta property="og:description" content="Bug 1208849 - Use array.includes in chat and im code instead of indexOf != / == -1: im/. r=aleth" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / e3a88b8c91e2267ace82651ec29049f1f451aaca 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/e3a88b8c91e2267ace82651ec29049f1f451aaca">shortlog</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/e3a88b8c91e2267ace82651ec29049f1f451aaca">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca">files</a> |
changeset |
<a href="/comm-central/raw-rev/e3a88b8c91e2267ace82651ec29049f1f451aaca">raw</a>  | <a href="/comm-central/archive/e3a88b8c91e2267ace82651ec29049f1f451aaca.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1208849">Bug 1208849</a> - Use array.includes in chat and im code instead of indexOf != / == -1: im/. r=aleth
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#101;&#98;&#97;&#115;&#116;&#105;&#97;&#110;&#32;&#72;&#101;&#110;&#103;&#115;&#116;&#32;&#60;&#97;&#114;&#99;&#104;&#97;&#101;&#111;&#112;&#116;&#101;&#114;&#121;&#120;&#64;&#99;&#111;&#111;&#108;&#101;&#45;&#102;&#105;&#108;&#101;&#115;&#46;&#100;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 05 Sep 2016 11:22:01 +0200</td></tr>

<tr>
 <td>changeset 19978</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/e3a88b8c91e2267ace82651ec29049f1f451aaca">e3a88b8c91e2267ace82651ec29049f1f451aaca</a></td>
</tr>



<tr>
<td>parent 19977</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f823ce6ce813a08654bbf92759f46a3d8d30de59">f823ce6ce813a08654bbf92759f46a3d8d30de59</a>
</td>
</tr>

<tr>
<td>child 19979</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1fad29fc243d1e9b2f9f835c622ec5b19b02a59d">1fad29fc243d1e9b2f9f835c622ec5b19b02a59d</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=e3a88b8c91e2267ace82651ec29049f1f451aaca">12256</a></td></tr>
<tr><td>push user</td><td>archaeopteryx@coole-files.de</td></tr>
<tr><td>push date</td><td class="date age">Mon, 05 Sep 2016 09:22:23 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@e3a88b8c91e2 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=e3a88b8c91e2267ace82651ec29049f1f451aaca">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=e3a88b8c91e2267ace82651ec29049f1f451aaca&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e3a88b8c91e2267ace82651ec29049f1f451aaca&newProject=comm-central&newRevision=e3a88b8c91e2267ace82651ec29049f1f451aaca&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e3a88b8c91e2267ace82651ec29049f1f451aaca&newProject=comm-central&newRevision=e3a88b8c91e2267ace82651ec29049f1f451aaca&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=e3a88b8c91e2267ace82651ec29049f1f451aaca&newProject=comm-central&newRevision=e3a88b8c91e2267ace82651ec29049f1f451aaca&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aleth%29&revcount=50">aleth</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1208849">1208849</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1208849">Bug 1208849</a> - Use array.includes in chat and im code instead of indexOf != / == -1: im/. r=aleth</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imContacts.js">chat/components/src/imContacts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imContacts.js">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imContacts.js">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imContacts.js">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imContacts.js">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imContacts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imConversations.js">chat/components/src/imConversations.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imConversations.js">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imConversations.js">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imConversations.js">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imConversations.js">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imConversations.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imCore.js">chat/components/src/imCore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imCore.js">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imCore.js">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imCore.js">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imCore.js">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/components/src/imCore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/content/convbrowser.xml">chat/content/convbrowser.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/content/convbrowser.xml">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/content/convbrowser.xml">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/content/convbrowser.xml">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/content/convbrowser.xml">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/content/convbrowser.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imTextboxUtils.jsm">chat/modules/imTextboxUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imTextboxUtils.jsm">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imTextboxUtils.jsm">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imTextboxUtils.jsm">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imTextboxUtils.jsm">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imTextboxUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imThemes.jsm">chat/modules/imThemes.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imThemes.jsm">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imThemes.jsm">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imThemes.jsm">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imThemes.jsm">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/imThemes.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/jsProtoHelper.jsm">chat/modules/jsProtoHelper.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/jsProtoHelper.jsm">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/jsProtoHelper.jsm">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/jsProtoHelper.jsm">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/jsProtoHelper.jsm">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/modules/jsProtoHelper.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/irc.js">chat/protocols/irc/irc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/irc.js">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/irc.js">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/irc.js">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/irc.js">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/irc.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/ircBase.jsm">chat/protocols/irc/ircBase.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/ircBase.jsm">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/ircBase.jsm">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/ircBase.jsm">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/ircBase.jsm">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/irc/ircBase.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/skype/skype.js">chat/protocols/skype/skype.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/skype/skype.js">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/skype/skype.js">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/skype/skype.js">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/skype/skype.js">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/skype/skype.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-session.jsm">chat/protocols/xmpp/xmpp-session.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-session.jsm">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-session.jsm">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-session.jsm">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-session.jsm">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-session.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-xml.jsm">chat/protocols/xmpp/xmpp-xml.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-xml.jsm">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-xml.jsm">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-xml.jsm">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-xml.jsm">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp-xml.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp.jsm">chat/protocols/xmpp/xmpp.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp.jsm">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp.jsm">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp.jsm">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp.jsm">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/chat/protocols/xmpp/xmpp.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/components/ibConvStatsService.js">im/components/ibConvStatsService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/components/ibConvStatsService.js">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/components/ibConvStatsService.js">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/components/ibConvStatsService.js">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/components/ibConvStatsService.js">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/components/ibConvStatsService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/conversation.xml">im/content/conversation.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/conversation.xml">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/conversation.xml">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/conversation.xml">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/conversation.xml">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/conversation.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/group.xml">im/content/group.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/group.xml">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/group.xml">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/group.xml">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/group.xml">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/group.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/joinchat.js">im/content/joinchat.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/joinchat.js">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/joinchat.js">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/joinchat.js">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/joinchat.js">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/joinchat.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/jsTreeView.js">im/content/jsTreeView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/jsTreeView.js">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/jsTreeView.js">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/jsTreeView.js">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/jsTreeView.js">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/jsTreeView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/applications.js">im/content/preferences/applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/applications.js">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/applications.js">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/applications.js">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/applications.js">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/applications.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/messagestyle.js">im/content/preferences/messagestyle.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/messagestyle.js">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/messagestyle.js">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/messagestyle.js">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/messagestyle.js">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/preferences/messagestyle.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/tabbrowser.xml">im/content/tabbrowser.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/tabbrowser.xml">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/tabbrowser.xml">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/tabbrowser.xml">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/tabbrowser.xml">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/content/tabbrowser.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/ibInterruptions.jsm">im/modules/ibInterruptions.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/ibInterruptions.jsm">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/ibInterruptions.jsm">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/ibInterruptions.jsm">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/ibInterruptions.jsm">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/ibInterruptions.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/imWindows.jsm">im/modules/imWindows.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/imWindows.jsm">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/imWindows.jsm">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/imWindows.jsm">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/imWindows.jsm">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/im/modules/imWindows.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/imconversation.xml">mail/components/im/content/imconversation.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/imconversation.xml">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/imconversation.xml">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/imconversation.xml">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/imconversation.xml">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/imconversation.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/joinchat.js">mail/components/im/content/joinchat.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/joinchat.js">file</a> |
<a href="/comm-central/annotate/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/joinchat.js">annotate</a> |
<a href="/comm-central/diff/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/joinchat.js">diff</a> |
<a href="/comm-central/comparison/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/joinchat.js">comparison</a> |
<a href="/comm-central/log/e3a88b8c91e2267ace82651ec29049f1f451aaca/mail/components/im/content/joinchat.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/chat/components/src/imContacts.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/chat/components/src/imContacts.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -221,17 +221,17 @@ Tag.prototype = {</span>
<a href="#l1.4"></a><span id="l1.4">   },</span>
<a href="#l1.5"></a><span id="l1.5">   _removeContact: function (aContact) {</span>
<a href="#l1.6"></a><span id="l1.6">     let index = this._contacts.indexOf(aContact);</span>
<a href="#l1.7"></a><span id="l1.7">     if (index != -1)</span>
<a href="#l1.8"></a><span id="l1.8">       this._contacts.splice(index, 1);</span>
<a href="#l1.9"></a><span id="l1.9">   },</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11">   addObserver: function(aObserver) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    if (this._observers.indexOf(aObserver) == -1)</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    if (!this._observers.includes(aObserver))</span>
<a href="#l1.14"></a><span id="l1.14">       this._observers.push(aObserver);</span>
<a href="#l1.15"></a><span id="l1.15">   },</span>
<a href="#l1.16"></a><span id="l1.16">   removeObserver: function(aObserver) {</span>
<a href="#l1.17"></a><span id="l1.17">     this._observers = this._observers.filter(o =&gt; o !== aObserver);</span>
<a href="#l1.18"></a><span id="l1.18">   },</span>
<a href="#l1.19"></a><span id="l1.19">   notifyObservers: function(aSubject, aTopic, aData) {</span>
<a href="#l1.20"></a><span id="l1.20">     for (let observer of this._observers)</span>
<a href="#l1.21"></a><span id="l1.21">       observer.observe(aSubject, aTopic, aData);</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -355,17 +355,17 @@ var otherContactsTag = {</span>
<a href="#l1.23"></a><span id="l1.23">     delete this._contacts[aContact.id];</span>
<a href="#l1.24"></a><span id="l1.24">     aContact.removeObserver(this._observer);</span>
<a href="#l1.25"></a><span id="l1.25">     this.notifyObservers(aContact, &quot;contact-moved-out&quot;);</span>
<a href="#l1.26"></a><span id="l1.26">     for (let observer of ContactsById[aContact.id]._observers)</span>
<a href="#l1.27"></a><span id="l1.27">       observer.observe(this, &quot;contact-moved-out&quot;, null);</span>
<a href="#l1.28"></a><span id="l1.28">   },</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30">   addObserver: function(aObserver) {</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-    if (this._observers.indexOf(aObserver) == -1)</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+    if (!this._observers.includes(aObserver))</span>
<a href="#l1.33"></a><span id="l1.33">       this._observers.push(aObserver);</span>
<a href="#l1.34"></a><span id="l1.34">   },</span>
<a href="#l1.35"></a><span id="l1.35">   removeObserver: function(aObserver) {</span>
<a href="#l1.36"></a><span id="l1.36">     this._observers = this._observers.filter(o =&gt; o !== aObserver);</span>
<a href="#l1.37"></a><span id="l1.37">   },</span>
<a href="#l1.38"></a><span id="l1.38">   notifyObservers: function(aSubject, aTopic, aData) {</span>
<a href="#l1.39"></a><span id="l1.39">     for (let observer of this._observers)</span>
<a href="#l1.40"></a><span id="l1.40">       observer.observe(aSubject, aTopic, aData);</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineat">@@ -846,17 +846,17 @@ Contact.prototype = {</span>
<a href="#l1.42"></a><span id="l1.42">   createConversation: function() {</span>
<a href="#l1.43"></a><span id="l1.43">     let uiConv = Services.conversations.getUIConversationByContactId(this.id);</span>
<a href="#l1.44"></a><span id="l1.44">     if (uiConv)</span>
<a href="#l1.45"></a><span id="l1.45">       return uiConv.target;</span>
<a href="#l1.46"></a><span id="l1.46">     return this.preferredBuddy.createConversation();</span>
<a href="#l1.47"></a><span id="l1.47">   },</span>
<a href="#l1.48"></a><span id="l1.48"> </span>
<a href="#l1.49"></a><span id="l1.49">   addObserver: function(aObserver) {</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-    if (this._observers.indexOf(aObserver) == -1)</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+    if (!this._observers.includes(aObserver))</span>
<a href="#l1.52"></a><span id="l1.52">       this._observers.push(aObserver);</span>
<a href="#l1.53"></a><span id="l1.53">   },</span>
<a href="#l1.54"></a><span id="l1.54">   removeObserver: function(aObserver) {</span>
<a href="#l1.55"></a><span id="l1.55">     if (!this.hasOwnProperty(&quot;_observers&quot;))</span>
<a href="#l1.56"></a><span id="l1.56">       return;</span>
<a href="#l1.57"></a><span id="l1.57"> </span>
<a href="#l1.58"></a><span id="l1.58">     this._observers = this._observers.filter(o =&gt; o !== aObserver);</span>
<a href="#l1.59"></a><span id="l1.59">   },</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineat">@@ -989,17 +989,17 @@ Buddy.prototype = {</span>
<a href="#l1.61"></a><span id="l1.61">     if (aAccountBuddyCount)</span>
<a href="#l1.62"></a><span id="l1.62">       aAccountBuddyCount.value = this._accounts.length;</span>
<a href="#l1.63"></a><span id="l1.63">     return this._accounts;</span>
<a href="#l1.64"></a><span id="l1.64">   },</span>
<a href="#l1.65"></a><span id="l1.65"> </span>
<a href="#l1.66"></a><span id="l1.66">   _addAccount: function(aAccountBuddy, aTag) {</span>
<a href="#l1.67"></a><span id="l1.67">     this._accounts.push(aAccountBuddy);</span>
<a href="#l1.68"></a><span id="l1.68">     let contact = this._contact;</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-    if (this._contact._tags.indexOf(aTag) == -1) {</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+    if (!this._contact._tags.includes(aTag)) {</span>
<a href="#l1.71"></a><span id="l1.71">       this._contact._tags.push(aTag);</span>
<a href="#l1.72"></a><span id="l1.72">       aTag._addContact(contact);</span>
<a href="#l1.73"></a><span id="l1.73">     }</span>
<a href="#l1.74"></a><span id="l1.74"> </span>
<a href="#l1.75"></a><span id="l1.75">     if (!this._preferredAccount)</span>
<a href="#l1.76"></a><span id="l1.76">       this._preferredAccount = aAccountBuddy;</span>
<a href="#l1.77"></a><span id="l1.77">   },</span>
<a href="#l1.78"></a><span id="l1.78">   get _empty() { return this._accounts.length == 0; },</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineat">@@ -1121,17 +1121,17 @@ Buddy.prototype = {</span>
<a href="#l1.80"></a><span id="l1.80">   _availabilityDetails: 0,</span>
<a href="#l1.81"></a><span id="l1.81">   get availabilityDetails() { return this._availabilityDetails; },</span>
<a href="#l1.82"></a><span id="l1.82">   get canSendMessage() { return this._preferredAccount.canSendMessage; },</span>
<a href="#l1.83"></a><span id="l1.83">   //XXX should we list the accounts in the tooltip?</span>
<a href="#l1.84"></a><span id="l1.84">   getTooltipInfo: function() { return this._preferredAccount.getTooltipInfo(); },</span>
<a href="#l1.85"></a><span id="l1.85">   createConversation: function() { return this._preferredAccount.createConversation(); },</span>
<a href="#l1.86"></a><span id="l1.86"> </span>
<a href="#l1.87"></a><span id="l1.87">   addObserver: function(aObserver) {</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineminus">-    if (this._observers.indexOf(aObserver) == -1)</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+    if (!this._observers.includes(aObserver))</span>
<a href="#l1.90"></a><span id="l1.90">       this._observers.push(aObserver);</span>
<a href="#l1.91"></a><span id="l1.91">   },</span>
<a href="#l1.92"></a><span id="l1.92">   removeObserver: function(aObserver) {</span>
<a href="#l1.93"></a><span id="l1.93">     if (!this._observers)</span>
<a href="#l1.94"></a><span id="l1.94">       return;</span>
<a href="#l1.95"></a><span id="l1.95">     this._observers = this._observers.filter(o =&gt; o !== aObserver);</span>
<a href="#l1.96"></a><span id="l1.96">   },</span>
<a href="#l1.97"></a><span id="l1.97">   // internal calls + calls from add-ons</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/chat/components/src/imConversations.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/chat/components/src/imConversations.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -401,17 +401,17 @@ UIConversation.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">     }</span>
<a href="#l2.5"></a><span id="l2.5">     if (!this.hasOwnProperty(&quot;_currentTargetId&quot;))</span>
<a href="#l2.6"></a><span id="l2.6">       return;</span>
<a href="#l2.7"></a><span id="l2.7">     delete this._currentTargetId;</span>
<a href="#l2.8"></a><span id="l2.8">     this.notifyObservers(this, &quot;ui-conversation-closed&quot;);</span>
<a href="#l2.9"></a><span id="l2.9">     Services.obs.notifyObservers(this, &quot;ui-conversation-closed&quot;, null);</span>
<a href="#l2.10"></a><span id="l2.10">   },</span>
<a href="#l2.11"></a><span id="l2.11">   addObserver: function(aObserver) {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    if (this._observers.indexOf(aObserver) == -1)</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    if (!this._observers.includes(aObserver))</span>
<a href="#l2.14"></a><span id="l2.14">       this._observers.push(aObserver);</span>
<a href="#l2.15"></a><span id="l2.15">   },</span>
<a href="#l2.16"></a><span id="l2.16">   removeObserver: function(aObserver) {</span>
<a href="#l2.17"></a><span id="l2.17">     this._observers = this._observers.filter(o =&gt; o !== aObserver);</span>
<a href="#l2.18"></a><span id="l2.18">   },</span>
<a href="#l2.19"></a><span id="l2.19">   notifyObservers: function(aSubject, aTopic, aData) {</span>
<a href="#l2.20"></a><span id="l2.20">     if (aTopic == &quot;new-text&quot;) {</span>
<a href="#l2.21"></a><span id="l2.21">       aSubject = new imMessage(aSubject);</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -425,17 +425,17 @@ UIConversation.prototype = {</span>
<a href="#l2.23"></a><span id="l2.23">       if (aSubject.incoming &amp;&amp; !aSubject.system) {</span>
<a href="#l2.24"></a><span id="l2.24">         ++this._unreadIncomingMessageCount;</span>
<a href="#l2.25"></a><span id="l2.25">         if (!this.isChat || aSubject.containsNick)</span>
<a href="#l2.26"></a><span id="l2.26">           ++this._unreadTargetedMessageCount;</span>
<a href="#l2.27"></a><span id="l2.27">       }</span>
<a href="#l2.28"></a><span id="l2.28">     }</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30">     for (let observer of this._observers) {</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-      if (!observer.observe &amp;&amp; this._observers.indexOf(observer) == -1)</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+      if (!observer.observe &amp;&amp; !this._observers.includes(observer))</span>
<a href="#l2.33"></a><span id="l2.33">         continue; // observer removed by a previous call to another observer.</span>
<a href="#l2.34"></a><span id="l2.34">       observer.observe(aSubject, aTopic, aData);</span>
<a href="#l2.35"></a><span id="l2.35">     }</span>
<a href="#l2.36"></a><span id="l2.36">     this._notifyUnreadCountChanged();</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38">     if (aTopic == &quot;new-text&quot;) {</span>
<a href="#l2.39"></a><span id="l2.39">       Services.obs.notifyObservers(aSubject, aTopic, aData);</span>
<a href="#l2.40"></a><span id="l2.40">       if (aSubject.incoming &amp;&amp; !aSubject.system &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/chat/components/src/imCore.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/chat/components/src/imCore.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -222,17 +222,17 @@ UserStatus.prototype = {</span>
<a href="#l3.4"></a><span id="l3.4">               .createInstance(Ci.nsISupportsString);</span>
<a href="#l3.5"></a><span id="l3.5">     str.data = aDisplayName;</span>
<a href="#l3.6"></a><span id="l3.6">     Services.prefs.setComplexValue(kPrefUserDisplayname, Ci.nsISupportsString,</span>
<a href="#l3.7"></a><span id="l3.7">                                    str);</span>
<a href="#l3.8"></a><span id="l3.8">     this._notifyObservers(&quot;user-display-name-changed&quot;, aDisplayName);</span>
<a href="#l3.9"></a><span id="l3.9">   },</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   addObserver: function(aObserver) {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    if (this._observers.indexOf(aObserver) == -1)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    if (!this._observers.includes(aObserver))</span>
<a href="#l3.14"></a><span id="l3.14">       this._observers.push(aObserver);</span>
<a href="#l3.15"></a><span id="l3.15">   },</span>
<a href="#l3.16"></a><span id="l3.16">   removeObserver: function(aObserver) {</span>
<a href="#l3.17"></a><span id="l3.17">     this._observers = this._observers.filter(o =&gt; o !== aObserver);</span>
<a href="#l3.18"></a><span id="l3.18">   },</span>
<a href="#l3.19"></a><span id="l3.19">   _notifyObservers: function(aTopic, aData) {</span>
<a href="#l3.20"></a><span id="l3.20">     for (let observer of this._observers)</span>
<a href="#l3.21"></a><span id="l3.21">       observer.observe(this, aTopic, aData);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/chat/content/convbrowser.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/chat/content/convbrowser.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -360,17 +360,17 @@</span>
<a href="#l4.4"></a><span id="l4.4">       &lt;/method&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6">       &lt;field name=&quot;_textModifiers&quot;&gt;[smileTextNode]&lt;/field&gt;</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">       &lt;method name=&quot;addTextModifier&quot;&gt;</span>
<a href="#l4.9"></a><span id="l4.9">         &lt;parameter name=&quot;aModifier&quot;/&gt;</span>
<a href="#l4.10"></a><span id="l4.10">         &lt;body&gt;</span>
<a href="#l4.11"></a><span id="l4.11">           &lt;![CDATA[</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-            if (this._textModifiers.indexOf(aModifier) == -1)</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+            if (!this._textModifiers.includes(aModifier))</span>
<a href="#l4.14"></a><span id="l4.14">               this._textModifiers.push(aModifier);</span>
<a href="#l4.15"></a><span id="l4.15">           ]]&gt;</span>
<a href="#l4.16"></a><span id="l4.16">         &lt;/body&gt;</span>
<a href="#l4.17"></a><span id="l4.17">       &lt;/method&gt;</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">       &lt;!-- These variables are reset in onStateChange. --&gt;</span>
<a href="#l4.20"></a><span id="l4.20">       &lt;field name=&quot;_lastMessage&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.21"></a><span id="l4.21">       &lt;field name=&quot;_lastMessageIsContext&quot;&gt;true&lt;/field&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/chat/modules/imTextboxUtils.jsm</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/chat/modules/imTextboxUtils.jsm</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -84,17 +84,17 @@ var MessageFormat = {</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">     if (!this._values.fontIsDefault)</span>
<a href="#l5.6"></a><span id="l5.6">       result.fontFamily = this._values.font;</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">     return result;</span>
<a href="#l5.9"></a><span id="l5.9">   },</span>
<a href="#l5.10"></a><span id="l5.10">   _textboxes: [],</span>
<a href="#l5.11"></a><span id="l5.11">   registerTextbox: function mf_registerTextbox(aTextbox) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    if (this._textboxes.indexOf(aTextbox) == -1)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    if (!this._textboxes.includes(aTextbox))</span>
<a href="#l5.14"></a><span id="l5.14">       this._textboxes.push(aTextbox);</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16">     if (this._textboxes.length == 1)</span>
<a href="#l5.17"></a><span id="l5.17">       this.getValues();</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19">     this.styleTextbox(aTextbox);</span>
<a href="#l5.20"></a><span id="l5.20">   },</span>
<a href="#l5.21"></a><span id="l5.21">   unregisterTextbox: function(aTextbox) {</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -139,17 +139,17 @@ var TextboxSpellChecker = {</span>
<a href="#l5.23"></a><span id="l5.23">     if (this._enabled)</span>
<a href="#l5.24"></a><span id="l5.24">       aTextbox.setAttribute(&quot;spellcheck&quot;, &quot;true&quot;);</span>
<a href="#l5.25"></a><span id="l5.25">     else</span>
<a href="#l5.26"></a><span id="l5.26">       aTextbox.removeAttribute(&quot;spellcheck&quot;);</span>
<a href="#l5.27"></a><span id="l5.27">   },</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29">   _textboxes: [],</span>
<a href="#l5.30"></a><span id="l5.30">   registerTextbox: function tsc_registerTextbox(aTextbox) {</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-    if (this._textboxes.indexOf(aTextbox) == -1)</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+    if (!this._textboxes.includes(aTextbox))</span>
<a href="#l5.33"></a><span id="l5.33">       this._textboxes.push(aTextbox);</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35">     if (this._textboxes.length == 1) {</span>
<a href="#l5.36"></a><span id="l5.36">       Services.prefs.addObserver(this._spellCheckPrefName, this, false);</span>
<a href="#l5.37"></a><span id="l5.37">       this.getValue();</span>
<a href="#l5.38"></a><span id="l5.38">     }</span>
<a href="#l5.39"></a><span id="l5.39"> </span>
<a href="#l5.40"></a><span id="l5.40">     this.applyValue(aTextbox);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/chat/modules/imThemes.jsm</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/chat/modules/imThemes.jsm</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -175,17 +175,17 @@ function getInfoPlistContent(aBaseURI)</span>
<a href="#l6.4"></a><span id="l6.4">   } catch(e) {</span>
<a href="#l6.5"></a><span id="l6.5">     Components.utils.reportError(e);</span>
<a href="#l6.6"></a><span id="l6.6">     return null;</span>
<a href="#l6.7"></a><span id="l6.7">   }</span>
<a href="#l6.8"></a><span id="l6.8"> }</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10"> function getChromeBaseURI(aThemeName)</span>
<a href="#l6.11"></a><span id="l6.11"> {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  if (DEFAULT_THEMES.indexOf(aThemeName) != -1)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  if (DEFAULT_THEMES.includes(aThemeName))</span>
<a href="#l6.14"></a><span id="l6.14">     return &quot;chrome://instantbird-messagestyles/skin/&quot; + aThemeName + &quot;/&quot;;</span>
<a href="#l6.15"></a><span id="l6.15">   return &quot;chrome://&quot; + aThemeName + &quot;/skin/&quot;;</span>
<a href="#l6.16"></a><span id="l6.16"> }</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> function getThemeByName(aName)</span>
<a href="#l6.19"></a><span id="l6.19"> {</span>
<a href="#l6.20"></a><span id="l6.20">   let baseURI = getChromeBaseURI(aName);</span>
<a href="#l6.21"></a><span id="l6.21">   let metadata = getInfoPlistContent(baseURI);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/chat/modules/jsProtoHelper.jsm</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/chat/modules/jsProtoHelper.jsm</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -465,17 +465,17 @@ var GenericConversationPrototype = {</span>
<a href="#l7.4"></a><span id="l7.4">   get id() { return this._id; },</span>
<a href="#l7.5"></a><span id="l7.5">   set id(aId) {</span>
<a href="#l7.6"></a><span id="l7.6">     if (this._id)</span>
<a href="#l7.7"></a><span id="l7.7">       throw Cr.NS_ERROR_ALREADY_INITIALIZED;</span>
<a href="#l7.8"></a><span id="l7.8">     this._id = aId;</span>
<a href="#l7.9"></a><span id="l7.9">   },</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">   addObserver: function(aObserver) {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    if (this._observers.indexOf(aObserver) == -1)</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    if (!this._observers.includes(aObserver))</span>
<a href="#l7.14"></a><span id="l7.14">       this._observers.push(aObserver);</span>
<a href="#l7.15"></a><span id="l7.15">   },</span>
<a href="#l7.16"></a><span id="l7.16">   removeObserver: function(aObserver) {</span>
<a href="#l7.17"></a><span id="l7.17">     this._observers = this._observers.filter(o =&gt; o !== aObserver);</span>
<a href="#l7.18"></a><span id="l7.18">   },</span>
<a href="#l7.19"></a><span id="l7.19">   notifyObservers: function(aSubject, aTopic, aData) {</span>
<a href="#l7.20"></a><span id="l7.20">     for (let observer of this._observers) {</span>
<a href="#l7.21"></a><span id="l7.21">       try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/chat/protocols/irc/irc.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/chat/protocols/irc/irc.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -414,17 +414,17 @@ ircChannel.prototype = {</span>
<a href="#l8.4"></a><span id="l8.4">     let channelModes = [];</span>
<a href="#l8.5"></a><span id="l8.5">     let userModes = new NormalizedMap(this.normalizeNick.bind(this));</span>
<a href="#l8.6"></a><span id="l8.6">     let msg;</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">     for (let i = aNewMode.length - 1; i &gt; 0; --i) {</span>
<a href="#l8.9"></a><span id="l8.9">       // Since some modes are conflicted between different server</span>
<a href="#l8.10"></a><span id="l8.10">       // implementations, check if a participant with that name exists. If this</span>
<a href="#l8.11"></a><span id="l8.11">       // is true, then update the mode of the ConvChatBuddy.</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      if (this._account.memberStatuses.indexOf(aNewMode[i]) != -1 &amp;&amp;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+      if (this._account.memberStatuses.includes(aNewMode[i]) &amp;&amp;</span>
<a href="#l8.14"></a><span id="l8.14">           aModeParams.length &amp;&amp; this._participants.has(peekNextParam())) {</span>
<a href="#l8.15"></a><span id="l8.15">         // Store the new modes for this nick (so each participant's mode is only</span>
<a href="#l8.16"></a><span id="l8.16">         // updated once).</span>
<a href="#l8.17"></a><span id="l8.17">         let nick = getNextParam();</span>
<a href="#l8.18"></a><span id="l8.18">         if (!userModes.has(nick))</span>
<a href="#l8.19"></a><span id="l8.19">           userModes.set(nick, []);</span>
<a href="#l8.20"></a><span id="l8.20">         userModes.get(nick).push(aNewMode[i]);</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -463,17 +463,17 @@ ircChannel.prototype = {</span>
<a href="#l8.23"></a><span id="l8.23">         }</span>
<a href="#l8.24"></a><span id="l8.24">         else {</span>
<a href="#l8.25"></a><span id="l8.25">           this.banMasks =</span>
<a href="#l8.26"></a><span id="l8.26">             this.banMasks.filter(aBanMask =&gt; banMask != aBanMask);</span>
<a href="#l8.27"></a><span id="l8.27">           msgKey += &quot;Removed&quot;;</span>
<a href="#l8.28"></a><span id="l8.28">         }</span>
<a href="#l8.29"></a><span id="l8.29">         this.writeMessage(aSetter, _(msgKey, banMask, aSetter), {system: true});</span>
<a href="#l8.30"></a><span id="l8.30">       }</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-      else if ([&quot;e&quot;, &quot;I&quot;, &quot;l&quot;].indexOf(aNewMode[i]) != -1) {</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+      else if ([&quot;e&quot;, &quot;I&quot;, &quot;l&quot;].includes(aNewMode[i])) {</span>
<a href="#l8.33"></a><span id="l8.33">         // TODO The following have parameters that must be accounted for.</span>
<a href="#l8.34"></a><span id="l8.34">         getNextParam();</span>
<a href="#l8.35"></a><span id="l8.35">       }</span>
<a href="#l8.36"></a><span id="l8.36">       else if (aNewMode[i] == &quot;R&quot; &amp;&amp; aModeParams.length &amp;&amp;</span>
<a href="#l8.37"></a><span id="l8.37">                peekNextParam().match(hostMaskExp)) {</span>
<a href="#l8.38"></a><span id="l8.38">         // REOP_LIST takes a mask as a parameter, since R is a conflicted mode,</span>
<a href="#l8.39"></a><span id="l8.39">         // try to match the parameter. Implemented by IRCNet.</span>
<a href="#l8.40"></a><span id="l8.40">         // TODO The parameter must be acounted for.</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineat">@@ -865,27 +865,27 @@ ircAccount.prototype = {</span>
<a href="#l8.42"></a><span id="l8.42">   // Handle Scandanavian lower case (optionally remove status indicators).</span>
<a href="#l8.43"></a><span id="l8.43">   // See Section 2.2 of RFC 2812: the characters {}|^ are considered to be the</span>
<a href="#l8.44"></a><span id="l8.44">   // lower case equivalents of the characters []\~, respectively.</span>
<a href="#l8.45"></a><span id="l8.45">   normalizeExpression: /[\x41-\x5E]/g,</span>
<a href="#l8.46"></a><span id="l8.46">   normalize: function(aStr, aPrefixes) {</span>
<a href="#l8.47"></a><span id="l8.47">     let str = aStr;</span>
<a href="#l8.48"></a><span id="l8.48"> </span>
<a href="#l8.49"></a><span id="l8.49">     if (aPrefixes) {</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-      while (aPrefixes.indexOf(str[0]) != -1)</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+      while (aPrefixes.includes(str[0]))</span>
<a href="#l8.52"></a><span id="l8.52">         str = str.slice(1);</span>
<a href="#l8.53"></a><span id="l8.53">     }</span>
<a href="#l8.54"></a><span id="l8.54"> </span>
<a href="#l8.55"></a><span id="l8.55">     return str.replace(this.normalizeExpression,</span>
<a href="#l8.56"></a><span id="l8.56">                        c =&gt; String.fromCharCode(c.charCodeAt(0) + 0x20));</span>
<a href="#l8.57"></a><span id="l8.57">   },</span>
<a href="#l8.58"></a><span id="l8.58">   normalizeNick: function(aNick) { return this.normalize(aNick, this.userPrefixes); },</span>
<a href="#l8.59"></a><span id="l8.59"> </span>
<a href="#l8.60"></a><span id="l8.60">   isMUCName: function(aStr) {</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-    return (this.channelPrefixes.indexOf(aStr[0]) != -1);</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+    return this.channelPrefixes.includes(aStr[0]);</span>
<a href="#l8.63"></a><span id="l8.63">   },</span>
<a href="#l8.64"></a><span id="l8.64"> </span>
<a href="#l8.65"></a><span id="l8.65">   // Tell the server about status changes. IRC is only away or not away;</span>
<a href="#l8.66"></a><span id="l8.66">   // consider the away, idle and unavailable status type to be away.</span>
<a href="#l8.67"></a><span id="l8.67">   isAway: false,</span>
<a href="#l8.68"></a><span id="l8.68">   observe: function(aSubject, aTopic, aData) {</span>
<a href="#l8.69"></a><span id="l8.69">     if (aTopic != &quot;status-changed&quot;)</span>
<a href="#l8.70"></a><span id="l8.70">       return;</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineat">@@ -1613,17 +1613,17 @@ ircAccount.prototype = {</span>
<a href="#l8.72"></a><span id="l8.72">     if (!channel) {</span>
<a href="#l8.73"></a><span id="l8.73">       this.ERROR(&quot;joinChat called without a valid channel name.&quot;);</span>
<a href="#l8.74"></a><span id="l8.74">       return null;</span>
<a href="#l8.75"></a><span id="l8.75">     }</span>
<a href="#l8.76"></a><span id="l8.76"> </span>
<a href="#l8.77"></a><span id="l8.77">     // A channel prefix is required. If the user didn't include one,</span>
<a href="#l8.78"></a><span id="l8.78">     // we prepend # automatically to match the behavior of other</span>
<a href="#l8.79"></a><span id="l8.79">     // clients. Not doing it used to cause user confusion.</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-    if (this.channelPrefixes.indexOf(channel[0]) == -1)</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineplus">+    if (!this.channelPrefixes.includes(channel[0]))</span>
<a href="#l8.82"></a><span id="l8.82">       channel = &quot;#&quot; + channel;</span>
<a href="#l8.83"></a><span id="l8.83"> </span>
<a href="#l8.84"></a><span id="l8.84">     if (this.conversations.has(channel)) {</span>
<a href="#l8.85"></a><span id="l8.85">       let conv = this.getConversation(channel);</span>
<a href="#l8.86"></a><span id="l8.86">       if (!conv.left) {</span>
<a href="#l8.87"></a><span id="l8.87">         // No need to join a channel we are already in.</span>
<a href="#l8.88"></a><span id="l8.88">         return conv;</span>
<a href="#l8.89"></a><span id="l8.89">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/chat/protocols/irc/ircBase.jsm</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/chat/protocols/irc/ircBase.jsm</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -681,17 +681,17 @@ var ircBase = {</span>
<a href="#l9.4"></a><span id="l9.4">       // The buddy names as returned by the server.</span>
<a href="#l9.5"></a><span id="l9.5">       if (aMessage.params.length &gt; 1)</span>
<a href="#l9.6"></a><span id="l9.6">         receivedBuddyNames = aMessage.params[1].trim().split(&quot; &quot;);</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8">       // This was received in response to the last ISON message sent.</span>
<a href="#l9.9"></a><span id="l9.9">       for (let buddyName of this.pendingIsOnQueue) {</span>
<a href="#l9.10"></a><span id="l9.10">         // If the buddy name is in the list returned from the server, they're</span>
<a href="#l9.11"></a><span id="l9.11">         // online.</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-        let status = (receivedBuddyNames.indexOf(buddyName) == -1) ?</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+        let status = !receivedBuddyNames.includes(buddyName) ?</span>
<a href="#l9.14"></a><span id="l9.14">                        Ci.imIStatusInfo.STATUS_OFFLINE :</span>
<a href="#l9.15"></a><span id="l9.15">                        Ci.imIStatusInfo.STATUS_AVAILABLE;</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17">         // Set the status with no status message, only if the buddy actually</span>
<a href="#l9.18"></a><span id="l9.18">         // exists in the buddy list.</span>
<a href="#l9.19"></a><span id="l9.19">         let buddy = this.buddies.get(buddyName);</span>
<a href="#l9.20"></a><span id="l9.20">         if (buddy)</span>
<a href="#l9.21"></a><span id="l9.21">           buddy.setStatus(status, &quot;&quot;);</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -976,17 +976,17 @@ var ircBase = {</span>
<a href="#l9.23"></a><span id="l9.23">       return true;</span>
<a href="#l9.24"></a><span id="l9.24">     },</span>
<a href="#l9.25"></a><span id="l9.25">     /*</span>
<a href="#l9.26"></a><span id="l9.26">      * End of a bunch of lists</span>
<a href="#l9.27"></a><span id="l9.27">      */</span>
<a href="#l9.28"></a><span id="l9.28">     &quot;367&quot;: function(aMessage) { // RPL_BANLIST</span>
<a href="#l9.29"></a><span id="l9.29">       // &lt;channel&gt; &lt;banmask&gt;</span>
<a href="#l9.30"></a><span id="l9.30">       let conv = this.getConversation(aMessage.params[1]);</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-      if (conv.banMasks.indexOf(aMessage.params[2]) == -1)</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+      if (!conv.banMasks.includes(aMessage.params[2]))</span>
<a href="#l9.33"></a><span id="l9.33">         conv.banMasks.push(aMessage.params[2]);</span>
<a href="#l9.34"></a><span id="l9.34">       return true;</span>
<a href="#l9.35"></a><span id="l9.35">     },</span>
<a href="#l9.36"></a><span id="l9.36">     &quot;368&quot;: function(aMessage) { // RPL_ENDOFBANLIST</span>
<a href="#l9.37"></a><span id="l9.37">       // &lt;channel&gt; :End of channel ban list</span>
<a href="#l9.38"></a><span id="l9.38">       let conv = this.getConversation(aMessage.params[1]);</span>
<a href="#l9.39"></a><span id="l9.39">       let msg;</span>
<a href="#l9.40"></a><span id="l9.40">       if (conv.banMasks.length) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/chat/protocols/skype/skype.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/chat/protocols/skype/skype.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -669,17 +669,17 @@ SkypeAccount.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">                     resource.from);</span>
<a href="#l10.5"></a><span id="l10.5">           return;</span>
<a href="#l10.6"></a><span id="l10.6">         }</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8">         // TODO Handle composetime field?</span>
<a href="#l10.9"></a><span id="l10.9">         let conversationLink = resource.conversationLink;</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11">         // Check if the conversation is a chat.</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-        if (conversationLink.indexOf(&quot;/19:&quot;) != -1) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+        if (conversationLink.includes(&quot;/19:&quot;)) {</span>
<a href="#l10.14"></a><span id="l10.14">           // TODO</span>
<a href="#l10.15"></a><span id="l10.15">           this.WARN(&quot;Received message from MUC.&quot;);</span>
<a href="#l10.16"></a><span id="l10.16">           continue;</span>
<a href="#l10.17"></a><span id="l10.17">         }</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19">         // Get or create the conversation.</span>
<a href="#l10.20"></a><span id="l10.20">         let conversationName = contactUrlToName(conversationLink);</span>
<a href="#l10.21"></a><span id="l10.21">         let conv = this._conversations.get(conversationName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/chat/protocols/xmpp/xmpp-session.jsm</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/chat/protocols/xmpp/xmpp-session.jsm</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -273,17 +273,17 @@ XMPPSession.prototype = {</span>
<a href="#l11.4"></a><span id="l11.4">     this.sendStanza(Stanza.iq(&quot;set&quot;, null, null,</span>
<a href="#l11.5"></a><span id="l11.5">                               Stanza.node(&quot;bind&quot;, Stanza.NS.bind, null,</span>
<a href="#l11.6"></a><span id="l11.6">                                           resourceNode)));</span>
<a href="#l11.7"></a><span id="l11.7">   },</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">   /* Socket events */</span>
<a href="#l11.10"></a><span id="l11.10">   /* The connection is established */</span>
<a href="#l11.11"></a><span id="l11.11">   onConnection: function() {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    if (this._security.indexOf(&quot;ssl&quot;) != -1) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    if (this._security.includes(&quot;ssl&quot;)) {</span>
<a href="#l11.14"></a><span id="l11.14">       this.onXmppStanza = this.stanzaListeners.startAuth;</span>
<a href="#l11.15"></a><span id="l11.15">       this._encrypted = true;</span>
<a href="#l11.16"></a><span id="l11.16">     }</span>
<a href="#l11.17"></a><span id="l11.17">     else</span>
<a href="#l11.18"></a><span id="l11.18">       this.onXmppStanza = this.stanzaListeners.initStream;</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20">     // Clear SRV results since we have connected.</span>
<a href="#l11.21"></a><span id="l11.21">     this._srvRecords = [];</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -343,17 +343,17 @@ XMPPSession.prototype = {</span>
<a href="#l11.23"></a><span id="l11.23">     initStream: function(aStanza) {</span>
<a href="#l11.24"></a><span id="l11.24">       if (aStanza.localName != &quot;features&quot;) {</span>
<a href="#l11.25"></a><span id="l11.25">         this.ERROR(&quot;Unexpected stanza &quot; + aStanza.localName + &quot;, expected 'features'&quot;);</span>
<a href="#l11.26"></a><span id="l11.26">         this._networkError(_(&quot;connection.error.incorrectResponse&quot;));</span>
<a href="#l11.27"></a><span id="l11.27">         return;</span>
<a href="#l11.28"></a><span id="l11.28">       }</span>
<a href="#l11.29"></a><span id="l11.29"> </span>
<a href="#l11.30"></a><span id="l11.30">       let starttls = aStanza.getElement([&quot;starttls&quot;]);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-      if (starttls &amp;&amp; this._security.indexOf(&quot;starttls&quot;) != -1) {</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+      if (starttls &amp;&amp; this._security.includes(&quot;starttls&quot;)) {</span>
<a href="#l11.33"></a><span id="l11.33">         this._account.reportConnecting(_(&quot;connection.initializingEncryption&quot;));</span>
<a href="#l11.34"></a><span id="l11.34">         this.sendStanza(Stanza.node(&quot;starttls&quot;, Stanza.NS.tls));</span>
<a href="#l11.35"></a><span id="l11.35">         this.onXmppStanza = this.stanzaListeners.startTLS;</span>
<a href="#l11.36"></a><span id="l11.36">         return;</span>
<a href="#l11.37"></a><span id="l11.37">       }</span>
<a href="#l11.38"></a><span id="l11.38">       if (starttls &amp;&amp;</span>
<a href="#l11.39"></a><span id="l11.39">           starttls.children.some(c =&gt; c.localName == &quot;required&quot;)) {</span>
<a href="#l11.40"></a><span id="l11.40">         this.onError(Ci.prplIAccount.ERROR_ENCRYPTION_ERROR,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/chat/protocols/xmpp/xmpp-xml.jsm</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/chat/protocols/xmpp/xmpp-xml.jsm</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -272,17 +272,17 @@ XMLNode.prototype = {</span>
<a href="#l12.4"></a><span id="l12.4">     return this.children.filter((c) =&gt; (c.type != &quot;text&quot; &amp;&amp; c.localName == aName));</span>
<a href="#l12.5"></a><span id="l12.5">   },</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7">   // Test if the node is a stanza and its namespace is valid.</span>
<a href="#l12.8"></a><span id="l12.8">   isXmppStanza: function() {</span>
<a href="#l12.9"></a><span id="l12.9">     if (!TOP_LEVEL_ELEMENTS.hasOwnProperty(this.qName))</span>
<a href="#l12.10"></a><span id="l12.10">       return false;</span>
<a href="#l12.11"></a><span id="l12.11">     let ns = TOP_LEVEL_ELEMENTS[this.qName];</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    return ns == this.uri || (Array.isArray(ns) &amp;&amp; ns.indexOf(this.uri) != -1);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    return ns == this.uri || (Array.isArray(ns) &amp;&amp; ns.includes(this.uri));</span>
<a href="#l12.14"></a><span id="l12.14">   },</span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16">   /* Returns indented XML */</span>
<a href="#l12.17"></a><span id="l12.17">   convertToString: function(aIndent = &quot;&quot;) {</span>
<a href="#l12.18"></a><span id="l12.18">     let s =</span>
<a href="#l12.19"></a><span id="l12.19">       aIndent + &quot;&lt;&quot; + this.qName + this._getXmlns() + this._getAttributeText();</span>
<a href="#l12.20"></a><span id="l12.20">     let content = &quot;&quot;;</span>
<a href="#l12.21"></a><span id="l12.21">     for (let child of this.children)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/chat/protocols/xmpp/xmpp.jsm</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/chat/protocols/xmpp/xmpp.jsm</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -294,17 +294,17 @@ var XMPPMUCConversationPrototype = {</span>
<a href="#l13.4"></a><span id="l13.4">     };</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6">     if (aStanza.attributes[&quot;type&quot;] == &quot;unavailable&quot;) {</span>
<a href="#l13.7"></a><span id="l13.7">       if (!this._participants.has(nick)) {</span>
<a href="#l13.8"></a><span id="l13.8">         this.WARN(&quot;received unavailable presence for an unknown MUC participant: &quot; +</span>
<a href="#l13.9"></a><span id="l13.9">                   from);</span>
<a href="#l13.10"></a><span id="l13.10">         return;</span>
<a href="#l13.11"></a><span id="l13.11">       }</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-      if (codes.indexOf(&quot;303&quot;) != -1) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+      if (codes.includes(&quot;303&quot;)) {</span>
<a href="#l13.14"></a><span id="l13.14">         // XEP-0045 (7.6): Changing Nickname.</span>
<a href="#l13.15"></a><span id="l13.15">         // Service Updates Nick for user.</span>
<a href="#l13.16"></a><span id="l13.16">         changeNick();</span>
<a href="#l13.17"></a><span id="l13.17">         return;</span>
<a href="#l13.18"></a><span id="l13.18">       }</span>
<a href="#l13.19"></a><span id="l13.19">       if (item &amp;&amp; item.attributes[&quot;role&quot;] == &quot;none&quot;) {</span>
<a href="#l13.20"></a><span id="l13.20">         // XEP-0045: an occupant has left the room.</span>
<a href="#l13.21"></a><span id="l13.21">         this.removeParticipant(nick);</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -320,31 +320,31 @@ var XMPPMUCConversationPrototype = {</span>
<a href="#l13.23"></a><span id="l13.23">         let isReason = reason ? &quot;.reason&quot; : &quot;&quot;;</span>
<a href="#l13.24"></a><span id="l13.24"> </span>
<a href="#l13.25"></a><span id="l13.25">         let isYou = nick == this.nick ? &quot;.you&quot; : &quot;&quot;;</span>
<a href="#l13.26"></a><span id="l13.26">         let affectedNick = isYou ? &quot;&quot; : nick;</span>
<a href="#l13.27"></a><span id="l13.27">         if (isYou)</span>
<a href="#l13.28"></a><span id="l13.28">           this.left = true;</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30">         let message;</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-        if (codes.indexOf(&quot;301&quot;) != -1) {</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+        if (codes.includes(&quot;301&quot;)) {</span>
<a href="#l13.33"></a><span id="l13.33">           // XEP-0045 (9.1): Banning a User.</span>
<a href="#l13.34"></a><span id="l13.34">           message = &quot;conversation.message.banned&quot;;</span>
<a href="#l13.35"></a><span id="l13.35">         }</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-        else if (codes.indexOf(&quot;307&quot;) != -1) {</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+        else if (codes.includes(&quot;307&quot;)) {</span>
<a href="#l13.38"></a><span id="l13.38">           // XEP-0045 (8.2): Kicking an Occupant.</span>
<a href="#l13.39"></a><span id="l13.39">           message = &quot;conversation.message.kicked&quot;;</span>
<a href="#l13.40"></a><span id="l13.40">         }</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-        else if (codes.indexOf(&quot;322&quot;) != -1 || codes.indexOf(&quot;321&quot;) != -1) {</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+        else if (codes.includes(&quot;322&quot;) || codes.includes(&quot;321&quot;)) {</span>
<a href="#l13.43"></a><span id="l13.43">           // XEP-0045: Inform user that he or she is being removed from the</span>
<a href="#l13.44"></a><span id="l13.44">           // room because the room has been changed to members-only and the</span>
<a href="#l13.45"></a><span id="l13.45">           // user is not a member.</span>
<a href="#l13.46"></a><span id="l13.46">           message = &quot;conversation.message.removedNonMember&quot;;</span>
<a href="#l13.47"></a><span id="l13.47">         }</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-        else if (codes.indexOf(&quot;332&quot;) != -1) {</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineplus">+        else if (codes.includes(&quot;332&quot;)) {</span>
<a href="#l13.50"></a><span id="l13.50">           // XEP-0045: Inform user that he or she is being removed from the</span>
<a href="#l13.51"></a><span id="l13.51">           // room because the MUC service is being shut down.</span>
<a href="#l13.52"></a><span id="l13.52">           message = &quot;conversation.message.mucShutdown&quot;;</span>
<a href="#l13.53"></a><span id="l13.53"> </span>
<a href="#l13.54"></a><span id="l13.54">           // The reason here just duplicates what's in the system message.</span>
<a href="#l13.55"></a><span id="l13.55">           reason = isReason = &quot;&quot;;</span>
<a href="#l13.56"></a><span id="l13.56">         }</span>
<a href="#l13.57"></a><span id="l13.57">         else {</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineat">@@ -363,17 +363,17 @@ var XMPPMUCConversationPrototype = {</span>
<a href="#l13.59"></a><span id="l13.59">           this.writeMessage(this.name, _(messageID, ...params), {system: true});</span>
<a href="#l13.60"></a><span id="l13.60">         }</span>
<a href="#l13.61"></a><span id="l13.61">       }</span>
<a href="#l13.62"></a><span id="l13.62">       else</span>
<a href="#l13.63"></a><span id="l13.63">         this.WARN(&quot;Unhandled type==unavailable MUC presence stanza.&quot;);</span>
<a href="#l13.64"></a><span id="l13.64">       return;</span>
<a href="#l13.65"></a><span id="l13.65">     }</span>
<a href="#l13.66"></a><span id="l13.66"> </span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-    if (codes.indexOf(&quot;201&quot;) != -1) {</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+    if (codes.includes(&quot;201&quot;)) {</span>
<a href="#l13.69"></a><span id="l13.69">       // XEP-0045 (10.1): Creating room.</span>
<a href="#l13.70"></a><span id="l13.70">       // Service Acknowledges Room Creation</span>
<a href="#l13.71"></a><span id="l13.71">       // and Room is awaiting configuration.</span>
<a href="#l13.72"></a><span id="l13.72">       // XEP-0045 (10.1.2): Instant room.</span>
<a href="#l13.73"></a><span id="l13.73">       let query = Stanza.node(&quot;query&quot;, Stanza.NS.muc_owner, null,</span>
<a href="#l13.74"></a><span id="l13.74">                               Stanza.node(&quot;x&quot;, Stanza.NS.xdata,</span>
<a href="#l13.75"></a><span id="l13.75">                                           {type: &quot;submit&quot;}));</span>
<a href="#l13.76"></a><span id="l13.76">       let s = Stanza.iq(&quot;set&quot;, null, jid, query);</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineat">@@ -383,24 +383,24 @@ var XMPPMUCConversationPrototype = {</span>
<a href="#l13.78"></a><span id="l13.78"> </span>
<a href="#l13.79"></a><span id="l13.79">         // XEP-0045: Service Informs New Room Owner of Success</span>
<a href="#l13.80"></a><span id="l13.80">         // for instant and reserved rooms.</span>
<a href="#l13.81"></a><span id="l13.81">         this.left = false;</span>
<a href="#l13.82"></a><span id="l13.82">         this.joining = false;</span>
<a href="#l13.83"></a><span id="l13.83">         return true;</span>
<a href="#l13.84"></a><span id="l13.84">       });</span>
<a href="#l13.85"></a><span id="l13.85">     }</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineminus">-    else if (codes.indexOf(&quot;210&quot;) != -1) {</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineplus">+    else if (codes.includes(&quot;210&quot;)) {</span>
<a href="#l13.88"></a><span id="l13.88">       // XEP-0045 (7.6): Changing Nickname.</span>
<a href="#l13.89"></a><span id="l13.89">       // Service modifies this user's nickname in accordance with local service</span>
<a href="#l13.90"></a><span id="l13.90">       // policies.</span>
<a href="#l13.91"></a><span id="l13.91">       changeNick();</span>
<a href="#l13.92"></a><span id="l13.92">       return;</span>
<a href="#l13.93"></a><span id="l13.93">     }</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineminus">-    else if (codes.indexOf(&quot;110&quot;) != -1) {</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+    else if (codes.includes(&quot;110&quot;)) {</span>
<a href="#l13.96"></a><span id="l13.96">       // XEP-0045: Room exists and joined successfully.</span>
<a href="#l13.97"></a><span id="l13.97">       this.left = false;</span>
<a href="#l13.98"></a><span id="l13.98">       this.joining = false;</span>
<a href="#l13.99"></a><span id="l13.99">       // TODO (Bug 1172350): Implement Service Discovery Extensions (XEP-0128) to obtain</span>
<a href="#l13.100"></a><span id="l13.100">       // configuration of this room.</span>
<a href="#l13.101"></a><span id="l13.101">     }</span>
<a href="#l13.102"></a><span id="l13.102"> </span>
<a href="#l13.103"></a><span id="l13.103">     if (!this._participants.get(nick)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/im/components/ibConvStatsService.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/im/components/ibConvStatsService.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -342,17 +342,17 @@ ConvStatsService.prototype = {</span>
<a href="#l14.4"></a><span id="l14.4">       let searchWords = aFilterStr.toLowerCase().split(/\s+/);</span>
<a href="#l14.5"></a><span id="l14.5">       filteredConvs = filteredConvs.filter(function(c) {</span>
<a href="#l14.6"></a><span id="l14.6">         let words = c.lowerCaseName.split(/\s+/);</span>
<a href="#l14.7"></a><span id="l14.7">         return searchWords.every(function(s) {</span>
<a href="#l14.8"></a><span id="l14.8">           return words.some(function(word) {</span>
<a href="#l14.9"></a><span id="l14.9">             if (word.startsWith(s))</span>
<a href="#l14.10"></a><span id="l14.10">               return true;</span>
<a href="#l14.11"></a><span id="l14.11">             // Ignore channel prefix characters.</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-            while (word.length &amp;&amp; &quot;#&amp;+!@_*&quot;.indexOf(word[0]) != -1) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+            while (word.length &amp;&amp; &quot;#&amp;+!@_*&quot;.includes(word[0])) {</span>
<a href="#l14.14"></a><span id="l14.14">               word = word.substr(1);</span>
<a href="#l14.15"></a><span id="l14.15">               if (word.startsWith(s))</span>
<a href="#l14.16"></a><span id="l14.16">                 return true;</span>
<a href="#l14.17"></a><span id="l14.17">             }</span>
<a href="#l14.18"></a><span id="l14.18">             return false;</span>
<a href="#l14.19"></a><span id="l14.19">           });</span>
<a href="#l14.20"></a><span id="l14.20">         });</span>
<a href="#l14.21"></a><span id="l14.21">       });</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -408,17 +408,17 @@ ConvStatsService.prototype = {</span>
<a href="#l14.23"></a><span id="l14.23">             Cu.reportError(e);</span>
<a href="#l14.24"></a><span id="l14.24">           continue;</span>
<a href="#l14.25"></a><span id="l14.25">         }</span>
<a href="#l14.26"></a><span id="l14.26">       }</span>
<a href="#l14.27"></a><span id="l14.27">     }</span>
<a href="#l14.28"></a><span id="l14.28">   },</span>
<a href="#l14.29"></a><span id="l14.29"> </span>
<a href="#l14.30"></a><span id="l14.30">   addObserver: function(aObserver) {</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-    if (this._observers.indexOf(aObserver) != -1)</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+    if (this._observers.includes(aObserver))</span>
<a href="#l14.33"></a><span id="l14.33">       return;</span>
<a href="#l14.34"></a><span id="l14.34">     this._observers.push(aObserver);</span>
<a href="#l14.35"></a><span id="l14.35"> </span>
<a href="#l14.36"></a><span id="l14.36">     if (gLogParser.inProgress)</span>
<a href="#l14.37"></a><span id="l14.37">       aObserver.observe(this, &quot;stats-service-log-sweeping&quot;, &quot;ongoing&quot;);</span>
<a href="#l14.38"></a><span id="l14.38"> </span>
<a href="#l14.39"></a><span id="l14.39">     this._repositionConvsWithUpdatedStats();</span>
<a href="#l14.40"></a><span id="l14.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/im/content/conversation.xml</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/im/content/conversation.xml</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -512,17 +512,17 @@</span>
<a href="#l15.4"></a><span id="l15.4">           let text = inputBox.value;</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6">           const navKeyCodes = [KeyEvent.DOM_VK_PAGE_UP, KeyEvent.DOM_VK_PAGE_DOWN,</span>
<a href="#l15.7"></a><span id="l15.7">                                KeyEvent.DOM_VK_HOME, KeyEvent.DOM_VK_END,</span>
<a href="#l15.8"></a><span id="l15.8">                                KeyEvent.DOM_VK_UP, KeyEvent.DOM_VK_DOWN];</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">           // Pass navigation keys to the browser if</span>
<a href="#l15.11"></a><span id="l15.11">           // 1) the textbox is empty or 2) it's an IB-specific key combination</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-          if ((!text &amp;&amp; navKeyCodes.indexOf(event.keyCode) != -1) ||</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+          if (!text &amp;&amp; navKeyCodes.includes(event.keyCode) ||</span>
<a href="#l15.14"></a><span id="l15.14">               ((event.shiftKey || event.altKey) &amp;&amp; (event.keyCode == KeyEvent.DOM_VK_PAGE_UP ||</span>
<a href="#l15.15"></a><span id="l15.15">                                                     event.keyCode == KeyEvent.DOM_VK_PAGE_DOWN))) {</span>
<a href="#l15.16"></a><span id="l15.16">             let newEvent = document.createEvent(&quot;KeyboardEvent&quot;);</span>
<a href="#l15.17"></a><span id="l15.17">             newEvent.initKeyEvent(&quot;keypress&quot;, event.bubbles, event.cancelable, null,</span>
<a href="#l15.18"></a><span id="l15.18">                                   event.ctrlKey, event.altKey, event.shiftKey, event.metaKey,</span>
<a href="#l15.19"></a><span id="l15.19">                                   event.keyCode, event.charCode);</span>
<a href="#l15.20"></a><span id="l15.20">             event.preventDefault();</span>
<a href="#l15.21"></a><span id="l15.21">             event.stopPropagation();</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -533,17 +533,17 @@</span>
<a href="#l15.23"></a><span id="l15.23">             return;</span>
<a href="#l15.24"></a><span id="l15.24">           }</span>
<a href="#l15.25"></a><span id="l15.25"> </span>
<a href="#l15.26"></a><span id="l15.26">           // When attempting to copy an empty selection, copy the</span>
<a href="#l15.27"></a><span id="l15.27">           // browser selection instead (see bug 693).</span>
<a href="#l15.28"></a><span id="l15.28">           // The 'C' won't be lowercase if caps lock is enabled.</span>
<a href="#l15.29"></a><span id="l15.29">           if ((event.charCode == 99 /* 'c' */ ||</span>
<a href="#l15.30"></a><span id="l15.30">                (event.charCode == 67 /* 'C' */ &amp;&amp; !event.shiftKey)) &amp;&amp;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-              (navigator.platform.indexOf(&quot;Mac&quot;) &gt;= 0 ? event.metaKey : event.ctrlKey) &amp;&amp;</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+              (navigator.platform.includes(&quot;Mac&quot;) ? event.metaKey : event.ctrlKey) &amp;&amp;</span>
<a href="#l15.33"></a><span id="l15.33">               inputBox.selectionStart == inputBox.selectionEnd) {</span>
<a href="#l15.34"></a><span id="l15.34">             this.browser.doCommand();</span>
<a href="#l15.35"></a><span id="l15.35">             return;</span>
<a href="#l15.36"></a><span id="l15.36">           }</span>
<a href="#l15.37"></a><span id="l15.37"> </span>
<a href="#l15.38"></a><span id="l15.38">           // We don't want to enable tab completion if the user has selected</span>
<a href="#l15.39"></a><span id="l15.39">           // some text, as it's not clear what the user would expect</span>
<a href="#l15.40"></a><span id="l15.40">           // to happen in that case.</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineat">@@ -567,17 +567,17 @@</span>
<a href="#l15.42"></a><span id="l15.42">               //   &quot;nick1: &quot; -&gt; &quot;nick1&quot;</span>
<a href="#l15.43"></a><span id="l15.43">               let pos = inputBox.selectionStart;</span>
<a href="#l15.44"></a><span id="l15.44">               const suffix = &quot;: &quot;;</span>
<a href="#l15.45"></a><span id="l15.45">               if (pos &gt; suffix.length &amp;&amp;</span>
<a href="#l15.46"></a><span id="l15.46">                   text.substring(pos - suffix.length, pos) == suffix) {</span>
<a href="#l15.47"></a><span id="l15.47">                 let completions = Array.from(this.buddies.keys());</span>
<a href="#l15.48"></a><span id="l15.48">                 // Check if the preceding words are a sequence of nick completions.</span>
<a href="#l15.49"></a><span id="l15.49">                 let preceding = text.substring(0, pos - suffix.length).split(&quot;, &quot;);</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-                if (preceding.every(n =&gt; completions.indexOf(n) != -1)) {</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineplus">+                if (preceding.every(n =&gt; completions.includes(n))) {</span>
<a href="#l15.52"></a><span id="l15.52">                   let s = preceding.pop();</span>
<a href="#l15.53"></a><span id="l15.53">                   if (preceding.length)</span>
<a href="#l15.54"></a><span id="l15.54">                     s = suffix + s;</span>
<a href="#l15.55"></a><span id="l15.55">                   inputBox.selectionStart -= s.length + suffix.length;</span>
<a href="#l15.56"></a><span id="l15.56">                   this.addString(s);</span>
<a href="#l15.57"></a><span id="l15.57">                   if (this._completions[0].slice(-suffix.length) == suffix) {</span>
<a href="#l15.58"></a><span id="l15.58">                     this._completions =</span>
<a href="#l15.59"></a><span id="l15.59">                       this._completions.map(c =&gt; c.slice(0, -suffix.length));</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineat">@@ -643,17 +643,17 @@</span>
<a href="#l15.61"></a><span id="l15.61"> </span>
<a href="#l15.62"></a><span id="l15.62">             // Check if we are completing a command.</span>
<a href="#l15.63"></a><span id="l15.63">             let completingCommand = isFirstWord &amp;&amp; word[0] == &quot;/&quot;;</span>
<a href="#l15.64"></a><span id="l15.64">             if (completingCommand) {</span>
<a href="#l15.65"></a><span id="l15.65">               for (let cmd of Services.cmd.listCommandsForConversation(this._conv)) {</span>
<a href="#l15.66"></a><span id="l15.66">                 // It's possible to have a global and a protocol specific command</span>
<a href="#l15.67"></a><span id="l15.67">                 // with the same name. Avoid duplicates in the |completions| array.</span>
<a href="#l15.68"></a><span id="l15.68">                 let name = &quot;/&quot; + cmd.name;</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-                if (completions.indexOf(name) == -1)</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineplus">+                if (!completions.includes(name))</span>
<a href="#l15.71"></a><span id="l15.71">                   completions.push(name);</span>
<a href="#l15.72"></a><span id="l15.72">               }</span>
<a href="#l15.73"></a><span id="l15.73">             }</span>
<a href="#l15.74"></a><span id="l15.74">             else {</span>
<a href="#l15.75"></a><span id="l15.75">               // If it's not a command, the only thing we can complete is a nick.</span>
<a href="#l15.76"></a><span id="l15.76">               if (!this._conv.isChat)</span>
<a href="#l15.77"></a><span id="l15.77">                 return;</span>
<a href="#l15.78"></a><span id="l15.78"> </span>
<a href="#l15.79"></a><span id="l15.79" class="difflineat">@@ -677,22 +677,22 @@</span>
<a href="#l15.80"></a><span id="l15.80">               completions = completions.filter(c =&gt; c != outgoingNick);</span>
<a href="#l15.81"></a><span id="l15.81"> </span>
<a href="#l15.82"></a><span id="l15.82">               // Check if the preceding words are a sequence of nick completions.</span>
<a href="#l15.83"></a><span id="l15.83">               let wordStart = inputBox.selectionStart - word.length;</span>
<a href="#l15.84"></a><span id="l15.84">               if (wordStart &gt; 2) {</span>
<a href="#l15.85"></a><span id="l15.85">                 let separator = text.substring(wordStart - 2, wordStart);</span>
<a href="#l15.86"></a><span id="l15.86">                 if (separator == &quot;: &quot; || separator == &quot;, &quot;) {</span>
<a href="#l15.87"></a><span id="l15.87">                   let preceding = text.substring(0, wordStart - 2).split(&quot;, &quot;);</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-                  if (preceding.every(n =&gt; completions.indexOf(n) != -1)) {</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineplus">+                  if (preceding.every(n =&gt; completions.includes(n))) {</span>
<a href="#l15.90"></a><span id="l15.90">                     secondNick = true;</span>
<a href="#l15.91"></a><span id="l15.91">                     isFirstWord = true;</span>
<a href="#l15.92"></a><span id="l15.92">                     // Remove preceding completions from possible completions.</span>
<a href="#l15.93"></a><span id="l15.93">                     completions = completions.filter(c =&gt;</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineminus">-                      preceding.indexOf(c) == -1);</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineplus">+                      !preceding.includes(c));</span>
<a href="#l15.96"></a><span id="l15.96">                   }</span>
<a href="#l15.97"></a><span id="l15.97">                 }</span>
<a href="#l15.98"></a><span id="l15.98">               }</span>
<a href="#l15.99"></a><span id="l15.99">             }</span>
<a href="#l15.100"></a><span id="l15.100"> </span>
<a href="#l15.101"></a><span id="l15.101">             // Keep only the completions that share |word| as a prefix.</span>
<a href="#l15.102"></a><span id="l15.102">             // Be case insensitive only if |word| is entirely lower case.</span>
<a href="#l15.103"></a><span id="l15.103">             let condition;</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineat">@@ -755,17 +755,17 @@</span>
<a href="#l15.105"></a><span id="l15.105">                   this._completions.splice(this._completions.indexOf(c), 1);</span>
<a href="#l15.106"></a><span id="l15.106">                   this._completions.unshift(c);</span>
<a href="#l15.107"></a><span id="l15.107">                 }, this);</span>
<a href="#l15.108"></a><span id="l15.108">               }</span>
<a href="#l15.109"></a><span id="l15.109"> </span>
<a href="#l15.110"></a><span id="l15.110">               // If one of the completions is the sender of the last ping,</span>
<a href="#l15.111"></a><span id="l15.111">               // take it, if it was less than an hour ago.</span>
<a href="#l15.112"></a><span id="l15.112">               if (this._lastPing &amp;&amp; this.buddies.has(this._lastPing) &amp;&amp;</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineminus">-                  this._completions.indexOf(this._lastPing) != -1 &amp;&amp;</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineplus">+                  this._completions.includes(this._lastPing) &amp;&amp;</span>
<a href="#l15.115"></a><span id="l15.115">                   (Date.now() / 1000 - this._lastPingTime) &lt; 3600) {</span>
<a href="#l15.116"></a><span id="l15.116">                 preferredNick = true;</span>
<a href="#l15.117"></a><span id="l15.117">                 this._completionsIndex = this._completions.indexOf(this._lastPing);</span>
<a href="#l15.118"></a><span id="l15.118">               }</span>
<a href="#l15.119"></a><span id="l15.119">             }</span>
<a href="#l15.120"></a><span id="l15.120"> </span>
<a href="#l15.121"></a><span id="l15.121">             // Display the possible completions in a system message.</span>
<a href="#l15.122"></a><span id="l15.122">             delete this._shouldListCompletionsLater;</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineat">@@ -1009,17 +1009,17 @@</span>
<a href="#l15.124"></a><span id="l15.124">         ]]&gt;</span>
<a href="#l15.125"></a><span id="l15.125">         &lt;/body&gt;</span>
<a href="#l15.126"></a><span id="l15.126">       &lt;/method&gt;</span>
<a href="#l15.127"></a><span id="l15.127"> </span>
<a href="#l15.128"></a><span id="l15.128">       &lt;method name=&quot;browserKeyPress&quot;&gt;</span>
<a href="#l15.129"></a><span id="l15.129">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l15.130"></a><span id="l15.130">         &lt;body&gt;</span>
<a href="#l15.131"></a><span id="l15.131">         &lt;![CDATA[</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineminus">-          let isMac = navigator.platform.indexOf(&quot;Mac&quot;) &gt;= 0;</span>
<a href="#l15.133"></a><span id="l15.133" class="difflineplus">+          let isMac = navigator.platform.includes(&quot;Mac&quot;);</span>
<a href="#l15.134"></a><span id="l15.134">           let accelKeyPressed = isMac? event.metaKey : event.ctrlKey;</span>
<a href="#l15.135"></a><span id="l15.135"> </span>
<a href="#l15.136"></a><span id="l15.136">           // 118 is the decimal code for &quot;v&quot; character, 13 keyCode for &quot;return&quot; key</span>
<a href="#l15.137"></a><span id="l15.137">           if (((accelKeyPressed &amp;&amp; event.charCode != 118) || event.altKey) &amp;&amp;</span>
<a href="#l15.138"></a><span id="l15.138">               event.keyCode != 13)</span>
<a href="#l15.139"></a><span id="l15.139">             return;</span>
<a href="#l15.140"></a><span id="l15.140"> </span>
<a href="#l15.141"></a><span id="l15.141">           if (event.charCode == 0 &amp;&amp;  // it's not a character, it's a command key</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineat">@@ -1072,25 +1072,25 @@</span>
<a href="#l15.143"></a><span id="l15.143">                 actions[0].run();</span>
<a href="#l15.144"></a><span id="l15.144">                 return;</span>
<a href="#l15.145"></a><span id="l15.145">               }</span>
<a href="#l15.146"></a><span id="l15.146">               if (msg.system || msg.outgoing || !msg.incoming || msg.error ||</span>
<a href="#l15.147"></a><span id="l15.147">                   !this._conv.isChat)</span>
<a href="#l15.148"></a><span id="l15.148">                 return;</span>
<a href="#l15.149"></a><span id="l15.149">               // Add msg.who to leading list of nicks.</span>
<a href="#l15.150"></a><span id="l15.150">               let text = this.editor.value;</span>
<a href="#l15.151"></a><span id="l15.151" class="difflineminus">-              if (text.indexOf(msg.who) != -1)</span>
<a href="#l15.152"></a><span id="l15.152" class="difflineplus">+              if (text.includes(msg.who))</span>
<a href="#l15.153"></a><span id="l15.153">                 return;</span>
<a href="#l15.154"></a><span id="l15.154">               let secondNick = false;</span>
<a href="#l15.155"></a><span id="l15.155">               let pos = text.indexOf(&quot;:&quot;);</span>
<a href="#l15.156"></a><span id="l15.156">               if (pos != -1) {</span>
<a href="#l15.157"></a><span id="l15.157">                 let completions = Array.from(this.buddies.keys());</span>
<a href="#l15.158"></a><span id="l15.158">                 // Check if the preceding words are a sequence of nicks.</span>
<a href="#l15.159"></a><span id="l15.159">                 let preceding = text.substring(0, pos).split(&quot;, &quot;);</span>
<a href="#l15.160"></a><span id="l15.160" class="difflineminus">-                if (preceding.every(n =&gt; completions.indexOf(n) != -1))</span>
<a href="#l15.161"></a><span id="l15.161" class="difflineplus">+                if (preceding.every(n =&gt; completions.includes(n)))</span>
<a href="#l15.162"></a><span id="l15.162">                   secondNick = true;</span>
<a href="#l15.163"></a><span id="l15.163">               }</span>
<a href="#l15.164"></a><span id="l15.164">               this.addPrompt(msg.who + (secondNick ? &quot;, &quot; : &quot;: &quot;));</span>
<a href="#l15.165"></a><span id="l15.165">               if (this._completions)</span>
<a href="#l15.166"></a><span id="l15.166">                 delete this._completions;</span>
<a href="#l15.167"></a><span id="l15.167">               return;</span>
<a href="#l15.168"></a><span id="l15.168">             }</span>
<a href="#l15.169"></a><span id="l15.169">           }</span>
<a href="#l15.170"></a><span id="l15.170" class="difflineat">@@ -1119,17 +1119,17 @@</span>
<a href="#l15.171"></a><span id="l15.171">       &lt;/method&gt;</span>
<a href="#l15.172"></a><span id="l15.172"> </span>
<a href="#l15.173"></a><span id="l15.173">       &lt;method name=&quot;addPrompt&quot;&gt;</span>
<a href="#l15.174"></a><span id="l15.174">         &lt;parameter name=&quot;aPrompt&quot;/&gt;</span>
<a href="#l15.175"></a><span id="l15.175">         &lt;body&gt;</span>
<a href="#l15.176"></a><span id="l15.176">         &lt;![CDATA[</span>
<a href="#l15.177"></a><span id="l15.177">           let editor = this.editor;</span>
<a href="#l15.178"></a><span id="l15.178">           let currentEditorValue = editor.value;</span>
<a href="#l15.179"></a><span id="l15.179" class="difflineminus">-          if (currentEditorValue.indexOf(aPrompt) != 0)</span>
<a href="#l15.180"></a><span id="l15.180" class="difflineplus">+          if (!currentEditorValue.startsWith(aPrompt))</span>
<a href="#l15.181"></a><span id="l15.181">             editor.value = aPrompt + currentEditorValue;</span>
<a href="#l15.182"></a><span id="l15.182">           editor.focus();</span>
<a href="#l15.183"></a><span id="l15.183">           this.inputValueChanged();</span>
<a href="#l15.184"></a><span id="l15.184">         ]]&gt;</span>
<a href="#l15.185"></a><span id="l15.185">         &lt;/body&gt;</span>
<a href="#l15.186"></a><span id="l15.186">       &lt;/method&gt;</span>
<a href="#l15.187"></a><span id="l15.187"> </span>
<a href="#l15.188"></a><span id="l15.188">       &lt;!-- Update the participant count of a chat conversation --&gt;</span>
<a href="#l15.189"></a><span id="l15.189" class="difflineat">@@ -2087,17 +2087,17 @@</span>
<a href="#l15.190"></a><span id="l15.190">     &lt;implementation&gt;</span>
<a href="#l15.191"></a><span id="l15.191">       &lt;constructor&gt;</span>
<a href="#l15.192"></a><span id="l15.192">         &lt;![CDATA[</span>
<a href="#l15.193"></a><span id="l15.193">           this.topic</span>
<a href="#l15.194"></a><span id="l15.194">               .addEventListener(&quot;click&quot;, this.startEditTopic.bind(this));</span>
<a href="#l15.195"></a><span id="l15.195">           // Cancel any ongoing edit if the binding changes.</span>
<a href="#l15.196"></a><span id="l15.196">           this.editing = false;</span>
<a href="#l15.197"></a><span id="l15.197"> </span>
<a href="#l15.198"></a><span id="l15.198" class="difflineminus">-          if (navigator.platform.indexOf(&quot;Mac&quot;) &gt;= 0) {</span>
<a href="#l15.199"></a><span id="l15.199" class="difflineplus">+          if (navigator.platform.includes(&quot;Mac&quot;)) {</span>
<a href="#l15.200"></a><span id="l15.200">             if (&quot;draghandle&quot; in this)</span>
<a href="#l15.201"></a><span id="l15.201">               return;</span>
<a href="#l15.202"></a><span id="l15.202">             if (!(&quot;WindowDraggingElement&quot; in window))</span>
<a href="#l15.203"></a><span id="l15.203">               Components.utils.import(&quot;resource://gre/modules/WindowDraggingUtils.jsm&quot;);</span>
<a href="#l15.204"></a><span id="l15.204">             this.draghandle = new WindowDraggingElement(this, window);</span>
<a href="#l15.205"></a><span id="l15.205">           }</span>
<a href="#l15.206"></a><span id="l15.206">         ]]&gt;</span>
<a href="#l15.207"></a><span id="l15.207">       &lt;/constructor&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/im/content/group.xml</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/im/content/group.xml</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -105,17 +105,17 @@</span>
<a href="#l16.4"></a><span id="l16.4">      &lt;/property&gt;</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6">      &lt;field name=&quot;_selectListener&quot;&gt;null&lt;/field&gt;</span>
<a href="#l16.7"></a><span id="l16.7">      &lt;field name=&quot;_pendingReorders&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l16.8"></a><span id="l16.8">      &lt;method name=&quot;_reorderContactLater&quot;&gt;</span>
<a href="#l16.9"></a><span id="l16.9">        &lt;parameter name=&quot;aContactElt&quot;/&gt;</span>
<a href="#l16.10"></a><span id="l16.10">        &lt;body&gt;</span>
<a href="#l16.11"></a><span id="l16.11">        &lt;![CDATA[</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-         if (this._pendingReorders.indexOf(aContactElt) != -1)</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+         if (this._pendingReorders.includes(aContactElt))</span>
<a href="#l16.14"></a><span id="l16.14">            return;</span>
<a href="#l16.15"></a><span id="l16.15"> </span>
<a href="#l16.16"></a><span id="l16.16">          this._pendingReorders.push(aContactElt);</span>
<a href="#l16.17"></a><span id="l16.17">          if (!this._selectListener) {</span>
<a href="#l16.18"></a><span id="l16.18">            this._selectListener = (function() {</span>
<a href="#l16.19"></a><span id="l16.19">              let remaining = [];</span>
<a href="#l16.20"></a><span id="l16.20">              for (let contactElt of this._pendingReorders) {</span>
<a href="#l16.21"></a><span id="l16.21">                if (!contactElt.hasAttribute(&quot;selected&quot;) &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/im/content/joinchat.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/im/content/joinchat.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -130,17 +130,17 @@ var joinChat = {</span>
<a href="#l17.4"></a><span id="l17.4">       let autojoin = [];</span>
<a href="#l17.5"></a><span id="l17.5">       if (prefBranch.prefHasUserValue(autoJoinPref)) {</span>
<a href="#l17.6"></a><span id="l17.6">         let prefValue =</span>
<a href="#l17.7"></a><span id="l17.7">           prefBranch.getComplexValue(autoJoinPref, Ci.nsISupportsString).data;</span>
<a href="#l17.8"></a><span id="l17.8">         if (prefValue)</span>
<a href="#l17.9"></a><span id="l17.9">           autojoin = prefValue.split(&quot;,&quot;);</span>
<a href="#l17.10"></a><span id="l17.10">       }</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-      if (autojoin.indexOf(name) == -1) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+      if (!autojoin.includes(name)) {</span>
<a href="#l17.14"></a><span id="l17.14">         autojoin.push(name);</span>
<a href="#l17.15"></a><span id="l17.15">         let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l17.16"></a><span id="l17.16">                     .createInstance(Ci.nsISupportsString);</span>
<a href="#l17.17"></a><span id="l17.17">         str.data = autojoin.join(&quot;,&quot;);</span>
<a href="#l17.18"></a><span id="l17.18">         prefBranch.setComplexValue(autoJoinPref, Ci.nsISupportsString, str);</span>
<a href="#l17.19"></a><span id="l17.19">       }</span>
<a href="#l17.20"></a><span id="l17.20">     }</span>
<a href="#l17.21"></a><span id="l17.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/im/content/jsTreeView.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/im/content/jsTreeView.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -170,17 +170,17 @@ PROTO_TREE_VIEW.prototype = {</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5">       // Note that these children may have been open when we were last closed,</span>
<a href="#l18.6"></a><span id="l18.6">       // and if they are, we also have to add those grandchildren to the map</span>
<a href="#l18.7"></a><span id="l18.7">       let oldCount = this._rowMap.length;</span>
<a href="#l18.8"></a><span id="l18.8">       this.recursivelyAddToMap(this._rowMap[aIndex], aIndex);</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">       // Add this container to the persist map</span>
<a href="#l18.11"></a><span id="l18.11">       let id = this._rowMap[aIndex].id;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-      if (this._persistOpenMap.indexOf(id) == -1)</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+      if (!this._persistOpenMap.includes(id))</span>
<a href="#l18.14"></a><span id="l18.14">         this._persistOpenMap.push(id);</span>
<a href="#l18.15"></a><span id="l18.15"> </span>
<a href="#l18.16"></a><span id="l18.16">       // Notify the tree of changes</span>
<a href="#l18.17"></a><span id="l18.17">       if (this._tree)</span>
<a href="#l18.18"></a><span id="l18.18">         this._tree.rowCountChanged(aIndex + 1, this._rowMap.length - oldCount);</span>
<a href="#l18.19"></a><span id="l18.19">     }</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21">     // Invalidate the toggled row, so that the open/closed marker changes</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -215,17 +215,17 @@ PROTO_TREE_VIEW.prototype = {</span>
<a href="#l18.23"></a><span id="l18.23">    * This is a javascript map of which containers we had open, so that we can</span>
<a href="#l18.24"></a><span id="l18.24">    * persist their state over-time.  It is designed to be used as a JSON object.</span>
<a href="#l18.25"></a><span id="l18.25">    */</span>
<a href="#l18.26"></a><span id="l18.26">   _persistOpenMap: null,</span>
<a href="#l18.27"></a><span id="l18.27"> </span>
<a href="#l18.28"></a><span id="l18.28">   _restoreOpenStates: function jstv__restoreOpenStates() {</span>
<a href="#l18.29"></a><span id="l18.29">     // Note that as we iterate through here, .length may grow</span>
<a href="#l18.30"></a><span id="l18.30">     for (let i = 0; i &lt; this._rowMap.length; i++) {</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-      if (this._persistOpenMap.indexOf(this._rowMap[i].id) != -1)</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+      if (this._persistOpenMap.includes(this._rowMap[i].id))</span>
<a href="#l18.33"></a><span id="l18.33">         this.toggleOpenState(i);</span>
<a href="#l18.34"></a><span id="l18.34">     }</span>
<a href="#l18.35"></a><span id="l18.35">   },</span>
<a href="#l18.36"></a><span id="l18.36"> </span>
<a href="#l18.37"></a><span id="l18.37">   QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l18.38"></a><span id="l18.38">     if (aIID.equals(Components.interfaces.nsITreeView) ||</span>
<a href="#l18.39"></a><span id="l18.39">         aIID.equals(Components.interfaces.nsISupports))</span>
<a href="#l18.40"></a><span id="l18.40">       return this;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/im/content/preferences/applications.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/im/content/preferences/applications.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -512,18 +512,18 @@ var gApplicationsPane = {</span>
<a href="#l19.4"></a><span id="l19.4">       this._list.appendChild(item);</span>
<a href="#l19.5"></a><span id="l19.5">     }</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7">     this._selectLastSelectedType();</span>
<a href="#l19.8"></a><span id="l19.8">   },</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10">   _matchesFilter: function(aType) {</span>
<a href="#l19.11"></a><span id="l19.11">     var filterValue = this._filter.value.toLowerCase();</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    return this._describeType(aType).toLowerCase().indexOf(filterValue) != -1 ||</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-           this._describePreferredAction(aType).toLowerCase().indexOf(filterValue) != -1;</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+    return this._describeType(aType).toLowerCase().includes(filterValue) ||</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+           this._describePreferredAction(aType).toLowerCase().includes(filterValue);</span>
<a href="#l19.16"></a><span id="l19.16">   },</span>
<a href="#l19.17"></a><span id="l19.17"> </span>
<a href="#l19.18"></a><span id="l19.18">   /**</span>
<a href="#l19.19"></a><span id="l19.19">    * Describe, in a human-readable fashion, the type represented by the given</span>
<a href="#l19.20"></a><span id="l19.20">    * handler info object.  Normally this is just the description provided by</span>
<a href="#l19.21"></a><span id="l19.21">    * the info object, but if more than one object presents the same description,</span>
<a href="#l19.22"></a><span id="l19.22">    * then we annotate the duplicate descriptions with the type itself to help</span>
<a href="#l19.23"></a><span id="l19.23">    * users distinguish between those types.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/im/content/preferences/messagestyle.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/im/content/preferences/messagestyle.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -110,17 +110,17 @@ var previewObserver = {</span>
<a href="#l20.4"></a><span id="l20.4">     let menulist = document.getElementById(&quot;themevariant&quot;);</span>
<a href="#l20.5"></a><span id="l20.5">     if (menulist.firstChild)</span>
<a href="#l20.6"></a><span id="l20.6">       menulist.firstChild.remove();</span>
<a href="#l20.7"></a><span id="l20.7">     let popup = menulist.appendChild(document.createElement(&quot;menupopup&quot;));</span>
<a href="#l20.8"></a><span id="l20.8">     let variants = getThemeVariants(this.theme);</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10">     let defaultVariant = &quot;&quot;;</span>
<a href="#l20.11"></a><span id="l20.11">     if ((&quot;DefaultVariant&quot; in this.theme.metadata) &amp;&amp;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-        variants.indexOf(this.theme.metadata.DefaultVariant) != -1)</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+        variants.includes(this.theme.metadata.DefaultVariant))</span>
<a href="#l20.14"></a><span id="l20.14">       defaultVariant = this.theme.metadata.DefaultVariant.replace(/_/g, &quot; &quot;);</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16">     let defaultText = defaultVariant;</span>
<a href="#l20.17"></a><span id="l20.17">     if (!defaultText &amp;&amp; (&quot;DisplayNameForNoVariant&quot; in this.theme.metadata))</span>
<a href="#l20.18"></a><span id="l20.18">       defaultText = this.theme.metadata.DisplayNameForNoVariant;</span>
<a href="#l20.19"></a><span id="l20.19">     // if the name in the metadata is 'Default', use the localized version</span>
<a href="#l20.20"></a><span id="l20.20">     if (!defaultText || defaultText.toLowerCase() == &quot;default&quot;)</span>
<a href="#l20.21"></a><span id="l20.21">       defaultText = document.getElementById(&quot;themesBundle&quot;).getString(&quot;default&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/im/content/tabbrowser.xml</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/im/content/tabbrowser.xml</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -285,17 +285,17 @@</span>
<a href="#l21.4"></a><span id="l21.4">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l21.5"></a><span id="l21.5">         &lt;body&gt;</span>
<a href="#l21.6"></a><span id="l21.6">           &lt;![CDATA[</span>
<a href="#l21.7"></a><span id="l21.7">             const tabKeyCodes = [KeyEvent.DOM_VK_TAB,</span>
<a href="#l21.8"></a><span id="l21.8">                                  KeyEvent.DOM_VK_HOME, KeyEvent.DOM_VK_END,</span>
<a href="#l21.9"></a><span id="l21.9">                                  KeyEvent.DOM_VK_UP, KeyEvent.DOM_VK_DOWN,</span>
<a href="#l21.10"></a><span id="l21.10">                                  KeyEvent.DOM_VK_LEFT, KeyEvent.DOM_VK_RIGHT];</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-            if (tabKeyCodes.indexOf(event.keyCode) != -1)</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+            if (tabKeyCodes.includes(event.keyCode))</span>
<a href="#l21.14"></a><span id="l21.14">               return;</span>
<a href="#l21.15"></a><span id="l21.15"> </span>
<a href="#l21.16"></a><span id="l21.16">             // Focus the panel and pass the key to it.</span>
<a href="#l21.17"></a><span id="l21.17">             event.preventDefault();</span>
<a href="#l21.18"></a><span id="l21.18">             event.stopPropagation();</span>
<a href="#l21.19"></a><span id="l21.19">             this.selectedPanel.focus();</span>
<a href="#l21.20"></a><span id="l21.20"> </span>
<a href="#l21.21"></a><span id="l21.21">             const masks = Components.interfaces.nsIDOMNSEvent;</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineat">@@ -304,18 +304,18 @@</span>
<a href="#l21.23"></a><span id="l21.23">               modifiers |= masks.SHIFT_MASK;</span>
<a href="#l21.24"></a><span id="l21.24">             if (event.ctrlKey)</span>
<a href="#l21.25"></a><span id="l21.25">               modifiers |= masks.CONTROL_MASK;</span>
<a href="#l21.26"></a><span id="l21.26">             if (event.altKey)</span>
<a href="#l21.27"></a><span id="l21.27">               modifiers |= masks.ALT_MASK;</span>
<a href="#l21.28"></a><span id="l21.28">             if (event.metaKey)</span>
<a href="#l21.29"></a><span id="l21.29">               modifiers |= masks.META_MASK;</span>
<a href="#l21.30"></a><span id="l21.30">             if (event.accelKey)</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-              modifiers |= (navigator.platform.indexOf(&quot;Mac&quot;) &gt;= 0) ? masks.META_MASK</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-                                                                    : masks.CONTROL_MASK;</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+              modifiers |= (navigator.platform.includes(&quot;Mac&quot;)) ? masks.META_MASK</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+                                                                : masks.CONTROL_MASK;</span>
<a href="#l21.35"></a><span id="l21.35">             // Can't use dispatchEvent to the textbox as these refuse untrusted key events.</span>
<a href="#l21.36"></a><span id="l21.36">             this.selectedPanel.ownerDocument.defaultView</span>
<a href="#l21.37"></a><span id="l21.37">               .QueryInterface(Components.interfaces.nsIInterfaceRequestor)</span>
<a href="#l21.38"></a><span id="l21.38">               .getInterface(Components.interfaces.nsIDOMWindowUtils)</span>
<a href="#l21.39"></a><span id="l21.39">               .sendKeyEvent(event.type, event.keyCode, event.charCode, modifiers);</span>
<a href="#l21.40"></a><span id="l21.40">           ]]&gt;</span>
<a href="#l21.41"></a><span id="l21.41">         &lt;/body&gt;</span>
<a href="#l21.42"></a><span id="l21.42">       &lt;/method&gt;</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineat">@@ -629,17 +629,17 @@</span>
<a href="#l21.44"></a><span id="l21.44"> </span>
<a href="#l21.45"></a><span id="l21.45">       &lt;!-- Returns everything that _endRemoveTab needs in an array. --&gt;</span>
<a href="#l21.46"></a><span id="l21.46">       &lt;method name=&quot;_beginRemoveTab&quot;&gt;</span>
<a href="#l21.47"></a><span id="l21.47">         &lt;parameter name=&quot;aTab&quot;/&gt;</span>
<a href="#l21.48"></a><span id="l21.48">         &lt;parameter name=&quot;aTabWillBeMoved&quot;/&gt;</span>
<a href="#l21.49"></a><span id="l21.49">         &lt;parameter name=&quot;aCloseWindowFastpath&quot;/&gt;</span>
<a href="#l21.50"></a><span id="l21.50">         &lt;body&gt;</span>
<a href="#l21.51"></a><span id="l21.51">           &lt;![CDATA[</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineminus">-            if (this._removingTabs.indexOf(aTab) &gt; -1 || this._windowIsClosing)</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+            if (this._removingTabs.includes(aTab) || this._windowIsClosing)</span>
<a href="#l21.54"></a><span id="l21.54">               return null;</span>
<a href="#l21.55"></a><span id="l21.55"> </span>
<a href="#l21.56"></a><span id="l21.56">             var browser = aTab.linkedBrowser;</span>
<a href="#l21.57"></a><span id="l21.57"> </span>
<a href="#l21.58"></a><span id="l21.58">             if (!aTabWillBeMoved &amp;&amp; browser) {</span>
<a href="#l21.59"></a><span id="l21.59">               let ds = browser.docShell;</span>
<a href="#l21.60"></a><span id="l21.60">               if (ds.contentViewer &amp;&amp; !ds.contentViewer.permitUnload())</span>
<a href="#l21.61"></a><span id="l21.61">                 return null;</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineat">@@ -758,24 +758,24 @@</span>
<a href="#l21.63"></a><span id="l21.63">           &lt;![CDATA[</span>
<a href="#l21.64"></a><span id="l21.64">             if (this.mCurrentTab != aTab)</span>
<a href="#l21.65"></a><span id="l21.65">               return;</span>
<a href="#l21.66"></a><span id="l21.66"> </span>
<a href="#l21.67"></a><span id="l21.67">             var tab = aTab;</span>
<a href="#l21.68"></a><span id="l21.68"> </span>
<a href="#l21.69"></a><span id="l21.69">             do {</span>
<a href="#l21.70"></a><span id="l21.70">               tab = tab.nextSibling;</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineminus">-            } while (tab &amp;&amp; this._removingTabs.indexOf(tab) != -1);</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+            } while (tab &amp;&amp; this._removingTabs.includes(tab));</span>
<a href="#l21.73"></a><span id="l21.73"> </span>
<a href="#l21.74"></a><span id="l21.74">             if (!tab) {</span>
<a href="#l21.75"></a><span id="l21.75">               tab = aTab;</span>
<a href="#l21.76"></a><span id="l21.76"> </span>
<a href="#l21.77"></a><span id="l21.77">               do {</span>
<a href="#l21.78"></a><span id="l21.78">                 tab = tab.previousSibling;</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineminus">-              } while (tab &amp;&amp; this._removingTabs.indexOf(tab) != -1);</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineplus">+              } while (tab &amp;&amp; this._removingTabs.includes(tab));</span>
<a href="#l21.81"></a><span id="l21.81">             }</span>
<a href="#l21.82"></a><span id="l21.82"> </span>
<a href="#l21.83"></a><span id="l21.83">             this.selectedTab = tab;</span>
<a href="#l21.84"></a><span id="l21.84">           ]]&gt;</span>
<a href="#l21.85"></a><span id="l21.85">         &lt;/body&gt;</span>
<a href="#l21.86"></a><span id="l21.86">       &lt;/method&gt;</span>
<a href="#l21.87"></a><span id="l21.87"> </span>
<a href="#l21.88"></a><span id="l21.88">       &lt;method name=&quot;importPanel&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/im/modules/ibInterruptions.jsm</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/im/modules/ibInterruptions.jsm</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l22.4"></a><span id="l22.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.5"></a><span id="l22.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7"> this.EXPORTED_SYMBOLS = [&quot;Interruptions&quot;];</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9"> var Interruptions = {</span>
<a href="#l22.10"></a><span id="l22.10">   _listeners: [],</span>
<a href="#l22.11"></a><span id="l22.11">   addListener: function(aListener) {</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    if (this._listeners.indexOf(aListener) == -1)</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+    if (!this._listeners.includes(aListener))</span>
<a href="#l22.14"></a><span id="l22.14">       this._listeners.push(aListener);</span>
<a href="#l22.15"></a><span id="l22.15">   },</span>
<a href="#l22.16"></a><span id="l22.16">   removeListener: function(aListener) {</span>
<a href="#l22.17"></a><span id="l22.17">     this._listeners = this._listeners.filter(o =&gt; o !== aListener);</span>
<a href="#l22.18"></a><span id="l22.18">   },</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20">   /* All code about to perform an action that could interrupt the</span>
<a href="#l22.21"></a><span id="l22.21">    * user's train of thoughts should call this method.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/im/modules/imWindows.jsm</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/im/modules/imWindows.jsm</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -14,17 +14,17 @@ var Conversations = {</span>
<a href="#l23.4"></a><span id="l23.4">   set unreadCount(val) {</span>
<a href="#l23.5"></a><span id="l23.5">     if (val == this._unreadCount)</span>
<a href="#l23.6"></a><span id="l23.6">       return val;</span>
<a href="#l23.7"></a><span id="l23.7">     Services.obs.notifyObservers(null, &quot;unread-im-count-changed&quot;, val);</span>
<a href="#l23.8"></a><span id="l23.8">     return (this._unreadCount = val);</span>
<a href="#l23.9"></a><span id="l23.9">   },</span>
<a href="#l23.10"></a><span id="l23.10">   _windows: [],</span>
<a href="#l23.11"></a><span id="l23.11">   registerWindow: function(aWindow) {</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    if (this._windows.indexOf(aWindow) == -1)</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+    if (!this._windows.includes(aWindow))</span>
<a href="#l23.14"></a><span id="l23.14">       this._windows.unshift(aWindow);</span>
<a href="#l23.15"></a><span id="l23.15"> </span>
<a href="#l23.16"></a><span id="l23.16">     if (this._pendingConversations) {</span>
<a href="#l23.17"></a><span id="l23.17">       // Cache in a variable and delete the existing notification array</span>
<a href="#l23.18"></a><span id="l23.18">       // before redispatching the notifications so that the observe</span>
<a href="#l23.19"></a><span id="l23.19">       // method can recreate it.</span>
<a href="#l23.20"></a><span id="l23.20">       let notifications = this._pendingConversations;</span>
<a href="#l23.21"></a><span id="l23.21">       this._pendingConversations = null;</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineat">@@ -36,17 +36,17 @@ var Conversations = {</span>
<a href="#l23.23"></a><span id="l23.23">     let index = this._windows.indexOf(aWindow);</span>
<a href="#l23.24"></a><span id="l23.24">     if (index != -1)</span>
<a href="#l23.25"></a><span id="l23.25">       this._windows.splice(index, 1);</span>
<a href="#l23.26"></a><span id="l23.26">   },</span>
<a href="#l23.27"></a><span id="l23.27"> </span>
<a href="#l23.28"></a><span id="l23.28">   _uiConv: {},</span>
<a href="#l23.29"></a><span id="l23.29">   _conversations: [],</span>
<a href="#l23.30"></a><span id="l23.30">   registerConversation: function(aConversation) {</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-    if (this._conversations.indexOf(aConversation) == -1)</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+    if (!this._conversations.includes(aConversation))</span>
<a href="#l23.33"></a><span id="l23.33">       this._conversations.push(aConversation);</span>
<a href="#l23.34"></a><span id="l23.34"> </span>
<a href="#l23.35"></a><span id="l23.35">     let uiConv = aConversation.conv;</span>
<a href="#l23.36"></a><span id="l23.36">     this._uiConv[uiConv.id] = aConversation;</span>
<a href="#l23.37"></a><span id="l23.37"> </span>
<a href="#l23.38"></a><span id="l23.38">     this.forgetHiddenConversation(uiConv);</span>
<a href="#l23.39"></a><span id="l23.39">   },</span>
<a href="#l23.40"></a><span id="l23.40">   unregisterConversation: function(aConversation, aShouldClose) {</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineat">@@ -180,17 +180,17 @@ var Conversations = {</span>
<a href="#l23.42"></a><span id="l23.42">   },</span>
<a href="#l23.43"></a><span id="l23.43"> </span>
<a href="#l23.44"></a><span id="l23.44">   _requestShowConversation: (aTopic, aSubject) =&gt;</span>
<a href="#l23.45"></a><span id="l23.45">     Interruptions.requestInterrupt(aTopic, aSubject, &quot;show-conversation&quot;),</span>
<a href="#l23.46"></a><span id="l23.46"> </span>
<a href="#l23.47"></a><span id="l23.47">   showConversation: function(aConv) {</span>
<a href="#l23.48"></a><span id="l23.48">     if (this.isUIConversationDisplayed(aConv) ||</span>
<a href="#l23.49"></a><span id="l23.49">         (this._pendingConversations &amp;&amp;</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineminus">-        this._pendingConversations.indexOf(aConv) != -1))</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineplus">+        this._pendingConversations.includes(aConv)))</span>
<a href="#l23.52"></a><span id="l23.52">       return;</span>
<a href="#l23.53"></a><span id="l23.53"> </span>
<a href="#l23.54"></a><span id="l23.54">     Services.obs.notifyObservers(aConv, &quot;showing-ui-conversation&quot;, null);</span>
<a href="#l23.55"></a><span id="l23.55">     // The conversation is not displayed anywhere yet.</span>
<a href="#l23.56"></a><span id="l23.56">     // First, check if an existing conversation window can accept it.</span>
<a href="#l23.57"></a><span id="l23.57">     for (let win of this._windows)</span>
<a href="#l23.58"></a><span id="l23.58">       if (win.document.getElementById(&quot;conversations&quot;).addConversation(aConv))</span>
<a href="#l23.59"></a><span id="l23.59">         return;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mail/components/im/content/imconversation.xml</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mail/components/im/content/imconversation.xml</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -435,17 +435,17 @@</span>
<a href="#l24.4"></a><span id="l24.4">         let text = inputBox.value;</span>
<a href="#l24.5"></a><span id="l24.5"> </span>
<a href="#l24.6"></a><span id="l24.6">         const navKeyCodes = [KeyEvent.DOM_VK_PAGE_UP, KeyEvent.DOM_VK_PAGE_DOWN,</span>
<a href="#l24.7"></a><span id="l24.7">                              KeyEvent.DOM_VK_HOME, KeyEvent.DOM_VK_END,</span>
<a href="#l24.8"></a><span id="l24.8">                              KeyEvent.DOM_VK_UP, KeyEvent.DOM_VK_DOWN];</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10">         // Pass navigation keys to the browser if</span>
<a href="#l24.11"></a><span id="l24.11">         // 1) the textbox is empty or 2) it's an IB-specific key combination</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-        if ((!text &amp;&amp; navKeyCodes.indexOf(event.keyCode) != -1) ||</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+        if ((!text &amp;&amp; navKeyCodes.includes(event.keyCode)) ||</span>
<a href="#l24.14"></a><span id="l24.14">             ((event.shiftKey || event.altKey) &amp;&amp; (event.keyCode == KeyEvent.DOM_VK_PAGE_UP ||</span>
<a href="#l24.15"></a><span id="l24.15">                                                   event.keyCode == KeyEvent.DOM_VK_PAGE_DOWN))) {</span>
<a href="#l24.16"></a><span id="l24.16">           let newEvent = document.createEvent(&quot;KeyboardEvent&quot;);</span>
<a href="#l24.17"></a><span id="l24.17">           newEvent.initKeyEvent(&quot;keypress&quot;, event.bubbles, event.cancelable, null,</span>
<a href="#l24.18"></a><span id="l24.18">                                 event.ctrlKey, event.altKey, event.shiftKey, event.metaKey,</span>
<a href="#l24.19"></a><span id="l24.19">                                 event.keyCode, event.charCode);</span>
<a href="#l24.20"></a><span id="l24.20">           event.preventDefault();</span>
<a href="#l24.21"></a><span id="l24.21">           event.stopPropagation();</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -456,17 +456,17 @@</span>
<a href="#l24.23"></a><span id="l24.23">           return;</span>
<a href="#l24.24"></a><span id="l24.24">         }</span>
<a href="#l24.25"></a><span id="l24.25"> </span>
<a href="#l24.26"></a><span id="l24.26">         // When attempting to copy an empty selection, copy the</span>
<a href="#l24.27"></a><span id="l24.27">         // browser selection instead (see bug 693).</span>
<a href="#l24.28"></a><span id="l24.28">         // The 'C' won't be lowercase if caps lock is enabled.</span>
<a href="#l24.29"></a><span id="l24.29">         if ((event.charCode == 99 /* 'c' */ ||</span>
<a href="#l24.30"></a><span id="l24.30">              (event.charCode == 67 /* 'C' */ &amp;&amp; !event.shiftKey)) &amp;&amp;</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-            (navigator.platform.indexOf(&quot;Mac&quot;) &gt;= 0 ? event.metaKey : event.ctrlKey) &amp;&amp;</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+            (navigator.platform.includes(&quot;Mac&quot;) ? event.metaKey : event.ctrlKey) &amp;&amp;</span>
<a href="#l24.33"></a><span id="l24.33">             inputBox.selectionStart == inputBox.selectionEnd) {</span>
<a href="#l24.34"></a><span id="l24.34">           this.browser.doCommand();</span>
<a href="#l24.35"></a><span id="l24.35">           return;</span>
<a href="#l24.36"></a><span id="l24.36">         }</span>
<a href="#l24.37"></a><span id="l24.37"> </span>
<a href="#l24.38"></a><span id="l24.38">         // We don't want to enable tab completion if the user has selected</span>
<a href="#l24.39"></a><span id="l24.39">         // some text, as it's not clear what the user would expect</span>
<a href="#l24.40"></a><span id="l24.40">         // to happen in that case.</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineat">@@ -490,17 +490,17 @@</span>
<a href="#l24.42"></a><span id="l24.42">             //   &quot;nick1: &quot; -&gt; &quot;nick1&quot;</span>
<a href="#l24.43"></a><span id="l24.43">             let pos = inputBox.selectionStart;</span>
<a href="#l24.44"></a><span id="l24.44">             const suffix = &quot;: &quot;;</span>
<a href="#l24.45"></a><span id="l24.45">             if (pos &gt; suffix.length &amp;&amp;</span>
<a href="#l24.46"></a><span id="l24.46">                 text.substring(pos - suffix.length, pos) == suffix) {</span>
<a href="#l24.47"></a><span id="l24.47">               let completions = Array.from(this.buddies.keys());</span>
<a href="#l24.48"></a><span id="l24.48">               // Check if the preceding words are a sequence of nick completions.</span>
<a href="#l24.49"></a><span id="l24.49">               let preceding = text.substring(0, pos - suffix.length).split(&quot;, &quot;);</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-              if (preceding.every(n =&gt; completions.indexOf(n) != -1)) {</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+              if (preceding.every(n =&gt; completions.includes(n))) {</span>
<a href="#l24.52"></a><span id="l24.52">                 let s = preceding.pop();</span>
<a href="#l24.53"></a><span id="l24.53">                 if (preceding.length)</span>
<a href="#l24.54"></a><span id="l24.54">                   s = suffix + s;</span>
<a href="#l24.55"></a><span id="l24.55">                 inputBox.selectionStart -= s.length + suffix.length;</span>
<a href="#l24.56"></a><span id="l24.56">                 this.addString(s);</span>
<a href="#l24.57"></a><span id="l24.57">                 if (this._completions[0].slice(-suffix.length) == suffix) {</span>
<a href="#l24.58"></a><span id="l24.58">                   this._completions =</span>
<a href="#l24.59"></a><span id="l24.59">                     this._completions.map(c =&gt; c.slice(0, -suffix.length));</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineat">@@ -566,17 +566,17 @@</span>
<a href="#l24.61"></a><span id="l24.61"> </span>
<a href="#l24.62"></a><span id="l24.62">           // Check if we are completing a command.</span>
<a href="#l24.63"></a><span id="l24.63">           let completingCommand = isFirstWord &amp;&amp; word[0] == &quot;/&quot;;</span>
<a href="#l24.64"></a><span id="l24.64">           if (completingCommand) {</span>
<a href="#l24.65"></a><span id="l24.65">             for (let cmd of Services.cmd.listCommandsForConversation(this._conv)) {</span>
<a href="#l24.66"></a><span id="l24.66">               // It's possible to have a global and a protocol specific command</span>
<a href="#l24.67"></a><span id="l24.67">               // with the same name. Avoid duplicates in the |completions| array.</span>
<a href="#l24.68"></a><span id="l24.68">               let name = &quot;/&quot; + cmd.name;</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineminus">-              if (completions.indexOf(name) == -1)</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineplus">+              if (!completions.includes(name))</span>
<a href="#l24.71"></a><span id="l24.71">                 completions.push(name);</span>
<a href="#l24.72"></a><span id="l24.72">             }</span>
<a href="#l24.73"></a><span id="l24.73">           }</span>
<a href="#l24.74"></a><span id="l24.74">           else {</span>
<a href="#l24.75"></a><span id="l24.75">             // If it's not a command, the only thing we can complete is a nick.</span>
<a href="#l24.76"></a><span id="l24.76">             if (!this._conv.isChat)</span>
<a href="#l24.77"></a><span id="l24.77">               return;</span>
<a href="#l24.78"></a><span id="l24.78"> </span>
<a href="#l24.79"></a><span id="l24.79" class="difflineat">@@ -602,22 +602,22 @@</span>
<a href="#l24.80"></a><span id="l24.80">             completions = completions.filter(c =&gt; c != outgoingNick);</span>
<a href="#l24.81"></a><span id="l24.81"> </span>
<a href="#l24.82"></a><span id="l24.82">             // Check if the preceding words are a sequence of nick completions.</span>
<a href="#l24.83"></a><span id="l24.83">             let wordStart = inputBox.selectionStart - word.length;</span>
<a href="#l24.84"></a><span id="l24.84">             if (wordStart &gt; 2) {</span>
<a href="#l24.85"></a><span id="l24.85">               let separator = text.substring(wordStart - 2, wordStart);</span>
<a href="#l24.86"></a><span id="l24.86">               if (separator == &quot;: &quot; || separator == &quot;, &quot;) {</span>
<a href="#l24.87"></a><span id="l24.87">                 let preceding = text.substring(0, wordStart - 2).split(&quot;, &quot;);</span>
<a href="#l24.88"></a><span id="l24.88" class="difflineminus">-                if (preceding.every(n =&gt; completions.indexOf(n) != -1)) {</span>
<a href="#l24.89"></a><span id="l24.89" class="difflineplus">+                if (preceding.every(n =&gt; completions.includes(n))) {</span>
<a href="#l24.90"></a><span id="l24.90">                   secondNick = true;</span>
<a href="#l24.91"></a><span id="l24.91">                   isFirstWord = true;</span>
<a href="#l24.92"></a><span id="l24.92">                   // Remove preceding completions from possible completions.</span>
<a href="#l24.93"></a><span id="l24.93">                   completions = completions.filter(c =&gt;</span>
<a href="#l24.94"></a><span id="l24.94" class="difflineminus">-                    preceding.indexOf(c) == -1);</span>
<a href="#l24.95"></a><span id="l24.95" class="difflineplus">+                    !preceding.includes(c));</span>
<a href="#l24.96"></a><span id="l24.96">                 }</span>
<a href="#l24.97"></a><span id="l24.97">               }</span>
<a href="#l24.98"></a><span id="l24.98">             }</span>
<a href="#l24.99"></a><span id="l24.99">           }</span>
<a href="#l24.100"></a><span id="l24.100"> </span>
<a href="#l24.101"></a><span id="l24.101">           // Keep only the completions that share |word| as a prefix.</span>
<a href="#l24.102"></a><span id="l24.102">           // Be case insensitive only if |word| is entirely lower case.</span>
<a href="#l24.103"></a><span id="l24.103">           let condition;</span>
<a href="#l24.104"></a><span id="l24.104" class="difflineat">@@ -680,17 +680,17 @@</span>
<a href="#l24.105"></a><span id="l24.105">                 this._completions.splice(this._completions.indexOf(c), 1);</span>
<a href="#l24.106"></a><span id="l24.106">                 this._completions.unshift(c);</span>
<a href="#l24.107"></a><span id="l24.107">               }, this);</span>
<a href="#l24.108"></a><span id="l24.108">             }</span>
<a href="#l24.109"></a><span id="l24.109"> </span>
<a href="#l24.110"></a><span id="l24.110">             // If one of the completions is the sender of the last ping,</span>
<a href="#l24.111"></a><span id="l24.111">             // take it, if it was less than an hour ago.</span>
<a href="#l24.112"></a><span id="l24.112">             if (this._lastPing &amp;&amp; this.buddies.has(this._lastPing) &amp;&amp;</span>
<a href="#l24.113"></a><span id="l24.113" class="difflineminus">-                this._completions.indexOf(this._lastPing) != -1 &amp;&amp;</span>
<a href="#l24.114"></a><span id="l24.114" class="difflineplus">+                this._completions.includes(this._lastPing) &amp;&amp;</span>
<a href="#l24.115"></a><span id="l24.115">                 (Date.now() / 1000 - this._lastPingTime) &lt; 3600) {</span>
<a href="#l24.116"></a><span id="l24.116">               preferredNick = true;</span>
<a href="#l24.117"></a><span id="l24.117">               this._completionsIndex = this._completions.indexOf(this._lastPing);</span>
<a href="#l24.118"></a><span id="l24.118">             }</span>
<a href="#l24.119"></a><span id="l24.119">           }</span>
<a href="#l24.120"></a><span id="l24.120"> </span>
<a href="#l24.121"></a><span id="l24.121">           // Display the possible completions in a system message.</span>
<a href="#l24.122"></a><span id="l24.122">           delete this._shouldListCompletionsLater;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/components/im/content/joinchat.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/components/im/content/joinchat.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -139,17 +139,17 @@ var joinChat = {</span>
<a href="#l25.4"></a><span id="l25.4">       let autojoin = [];</span>
<a href="#l25.5"></a><span id="l25.5">       if (prefBranch.prefHasUserValue(autoJoinPref)) {</span>
<a href="#l25.6"></a><span id="l25.6">         let prefValue =</span>
<a href="#l25.7"></a><span id="l25.7">           prefBranch.getComplexValue(autoJoinPref, Ci.nsISupportsString).data;</span>
<a href="#l25.8"></a><span id="l25.8">         if (prefValue)</span>
<a href="#l25.9"></a><span id="l25.9">           autojoin = prefValue.split(&quot;,&quot;);</span>
<a href="#l25.10"></a><span id="l25.10">       }</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-      if (autojoin.indexOf(name) == -1) {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+      if (!autojoin.includes(name)) {</span>
<a href="#l25.14"></a><span id="l25.14">         autojoin.push(name);</span>
<a href="#l25.15"></a><span id="l25.15">         let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l25.16"></a><span id="l25.16">                     .createInstance(Ci.nsISupportsString);</span>
<a href="#l25.17"></a><span id="l25.17">         str.data = autojoin.join(&quot;,&quot;);</span>
<a href="#l25.18"></a><span id="l25.18">         prefBranch.setComplexValue(autoJoinPref, Ci.nsISupportsString, str);</span>
<a href="#l25.19"></a><span id="l25.19">       }</span>
<a href="#l25.20"></a><span id="l25.20">     }</span>
<a href="#l25.21"></a><span id="l25.21"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

