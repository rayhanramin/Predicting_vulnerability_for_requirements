<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 18470:32eb613ad2eb74dab38722910b4e4e2b08ee780e</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 32eb613ad2eb74dab38722910b4e4e2b08ee780e" />
<meta property="og:url" content="/comm-central/rev/32eb613ad2eb74dab38722910b4e4e2b08ee780e" />
<meta property="og:description" content="Bug 1014609 - Part 5: Remove jquery in accountProvisioner.js. r=mkmelin,ui-r=Paenglab" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 32eb613ad2eb74dab38722910b4e4e2b08ee780e 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/32eb613ad2eb74dab38722910b4e4e2b08ee780e">shortlog</a> |
<a href="/comm-central/log/32eb613ad2eb74dab38722910b4e4e2b08ee780e">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/32eb613ad2eb74dab38722910b4e4e2b08ee780e">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/32eb613ad2eb74dab38722910b4e4e2b08ee780e">files</a> |
changeset |
<a href="/comm-central/raw-rev/32eb613ad2eb74dab38722910b4e4e2b08ee780e">raw</a>  | <a href="/comm-central/archive/32eb613ad2eb74dab38722910b4e4e2b08ee780e.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1014609">Bug 1014609</a> - Part 5: Remove jquery in accountProvisioner.js. r=mkmelin,ui-r=Paenglab
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#108;&#101;&#116;&#104;&#32;&#60;&#97;&#108;&#101;&#116;&#104;&#64;&#105;&#110;&#115;&#116;&#97;&#110;&#116;&#98;&#105;&#114;&#100;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 30 Sep 2015 23:01:57 +0200</td></tr>

<tr>
 <td>changeset 18470</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/32eb613ad2eb74dab38722910b4e4e2b08ee780e">32eb613ad2eb74dab38722910b4e4e2b08ee780e</a></td>
</tr>



<tr>
<td>parent 18469</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3ddf3a3eaf07d5e6c1a98bfbe184dab32841ed03">3ddf3a3eaf07d5e6c1a98bfbe184dab32841ed03</a>
</td>
</tr>

<tr>
<td>child 18471</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c5401915af893260262edddd66921570370fe3c3">c5401915af893260262edddd66921570370fe3c3</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=32eb613ad2eb74dab38722910b4e4e2b08ee780e">11305</a></td></tr>
<tr><td>push user</td><td>aleth@instantbird.org</td></tr>
<tr><td>push date</td><td class="date age">Wed, 30 Sep 2015 21:06:54 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@180bafc8f18c [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=180bafc8f18cc4bae161fa14b192d356b9284bd8">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=180bafc8f18cc4bae161fa14b192d356b9284bd8&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=180bafc8f18cc4bae161fa14b192d356b9284bd8&newProject=comm-central&newRevision=32eb613ad2eb74dab38722910b4e4e2b08ee780e&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=180bafc8f18cc4bae161fa14b192d356b9284bd8&newProject=comm-central&newRevision=32eb613ad2eb74dab38722910b4e4e2b08ee780e&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=180bafc8f18cc4bae161fa14b192d356b9284bd8&newProject=comm-central&newRevision=32eb613ad2eb74dab38722910b4e4e2b08ee780e&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a>, <a href="/comm-central/log?rev=reviewer%28Paenglab%29&revcount=50">Paenglab</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1014609">1014609</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1014609">Bug 1014609</a> - Part 5: Remove jquery in accountProvisioner.js. r=mkmelin,ui-r=Paenglab</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.js">mail/components/newmailaccount/content/accountProvisioner.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.js">file</a> |
<a href="/comm-central/annotate/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.js">annotate</a> |
<a href="/comm-central/diff/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.js">diff</a> |
<a href="/comm-central/comparison/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.js">comparison</a> |
<a href="/comm-central/log/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.xhtml">mail/components/newmailaccount/content/accountProvisioner.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.xhtml">file</a> |
<a href="/comm-central/annotate/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.xhtml">annotate</a> |
<a href="/comm-central/diff/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.xhtml">diff</a> |
<a href="/comm-central/comparison/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.xhtml">comparison</a> |
<a href="/comm-central/log/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/components/newmailaccount/content/accountProvisioner.xhtml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/locales/en-US/chrome/messenger/newmailaccount/accountProvisioner.dtd">mail/locales/en-US/chrome/messenger/newmailaccount/accountProvisioner.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/locales/en-US/chrome/messenger/newmailaccount/accountProvisioner.dtd">file</a> |
<a href="/comm-central/annotate/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/locales/en-US/chrome/messenger/newmailaccount/accountProvisioner.dtd">annotate</a> |
<a href="/comm-central/diff/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/locales/en-US/chrome/messenger/newmailaccount/accountProvisioner.dtd">diff</a> |
<a href="/comm-central/comparison/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/locales/en-US/chrome/messenger/newmailaccount/accountProvisioner.dtd">comparison</a> |
<a href="/comm-central/log/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/locales/en-US/chrome/messenger/newmailaccount/accountProvisioner.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/themes/shared/mail/accountProvisioner.css">mail/themes/shared/mail/accountProvisioner.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/themes/shared/mail/accountProvisioner.css">file</a> |
<a href="/comm-central/annotate/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/themes/shared/mail/accountProvisioner.css">annotate</a> |
<a href="/comm-central/diff/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/themes/shared/mail/accountProvisioner.css">diff</a> |
<a href="/comm-central/comparison/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/themes/shared/mail/accountProvisioner.css">comparison</a> |
<a href="/comm-central/log/32eb613ad2eb74dab38722910b4e4e2b08ee780e/mail/themes/shared/mail/accountProvisioner.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/newmailaccount/content/accountProvisioner.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/newmailaccount/content/accountProvisioner.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -105,115 +105,109 @@ var EmailAccountProvisioner = {</span>
<a href="#l1.4"></a><span id="l1.4">   get userLanguage() {</span>
<a href="#l1.5"></a><span id="l1.5">     return Services.prefs.getCharPref(&quot;general.useragent.locale&quot;);</span>
<a href="#l1.6"></a><span id="l1.6">   },</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">   /**</span>
<a href="#l1.9"></a><span id="l1.9">    * A helper function to enable or disable the Search button.</span>
<a href="#l1.10"></a><span id="l1.10">    */</span>
<a href="#l1.11"></a><span id="l1.11">   searchButtonEnabled: function EAP_searchButtonEnabled(aVal) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    if (aVal) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-      $(&quot;#searchSubmit&quot;).removeAttr(&quot;disabled&quot;);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-    } else {</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-      $(&quot;#searchSubmit&quot;).attr(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-    }</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+    document.getElementById(&quot;searchSubmit&quot;).disabled = !aVal;</span>
<a href="#l1.18"></a><span id="l1.18">   },</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">   /**</span>
<a href="#l1.21"></a><span id="l1.21">    * A setter for enabling / disabling the search fields.</span>
<a href="#l1.22"></a><span id="l1.22">    */</span>
<a href="#l1.23"></a><span id="l1.23">   searchEnabled: function EAP_searchEnabled(aVal) {</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-    if (aVal) {</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-      $(&quot;#name&quot;).removeAttr(&quot;disabled&quot;);</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-      $(&quot;.providerCheckbox&quot;).removeAttr(&quot;disabled&quot;);</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-    } else {</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-      $(&quot;#name&quot;).attr(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-      $(&quot;.providerCheckbox&quot;).attr(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+    document.getElementById(&quot;name&quot;).disabled = !aVal;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+    for (let node of document.querySelectorAll(&quot;.providerCheckbox&quot;)) {</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+      node.disabled = !aVal;</span>
<a href="#l1.33"></a><span id="l1.33">     }</span>
<a href="#l1.34"></a><span id="l1.34">     this.searchButtonEnabled(aVal);</span>
<a href="#l1.35"></a><span id="l1.35">   },</span>
<a href="#l1.36"></a><span id="l1.36"> </span>
<a href="#l1.37"></a><span id="l1.37">   /**</span>
<a href="#l1.38"></a><span id="l1.38">    * If aVal is true, show the spinner, else hide.</span>
<a href="#l1.39"></a><span id="l1.39">    */</span>
<a href="#l1.40"></a><span id="l1.40">   spinning: function EAP_spinning(aVal) {</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-    if (aVal) {</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-      $(&quot;#notifications .spinner&quot;).css('display', 'block');</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-    } else {</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-      $(&quot;#notifications .spinner&quot;).css('display', 'none');</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+    let display = aVal ? &quot;block&quot; : &quot;none&quot;;</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+    for (let node of document.querySelectorAll(&quot;#notifications .spinner&quot;)) {</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+      node.style.display = display;</span>
<a href="#l1.48"></a><span id="l1.48">     }</span>
<a href="#l1.49"></a><span id="l1.49">   },</span>
<a href="#l1.50"></a><span id="l1.50"> </span>
<a href="#l1.51"></a><span id="l1.51">   /**</span>
<a href="#l1.52"></a><span id="l1.52">    * Sets the current window state to display the &quot;success&quot; page, with options</span>
<a href="#l1.53"></a><span id="l1.53">    * for composing messages, setting a signature, finding add-ons, etc.</span>
<a href="#l1.54"></a><span id="l1.54">    */</span>
<a href="#l1.55"></a><span id="l1.55">   showSuccessPage: function EAP_showSuccessPage() {</span>
<a href="#l1.56"></a><span id="l1.56">     gLog.info(&quot;Showing the success page&quot;);</span>
<a href="#l1.57"></a><span id="l1.57">     let engine = Services.search.getEngineByName(window.arguments[0].search_engine);</span>
<a href="#l1.58"></a><span id="l1.58">     let account = window.arguments[0].account;</span>
<a href="#l1.59"></a><span id="l1.59"> </span>
<a href="#l1.60"></a><span id="l1.60">     if (engine &amp;&amp; Services.search.defaultEngine != engine) {</span>
<a href="#l1.61"></a><span id="l1.61">       // Expose the search engine checkbox</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-      $(&quot;#search_engine_wrap&quot;).show()</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-                              .click(function(event) {</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-        $(&quot;#search_engine_check&quot;).click();</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+      let searchEngineWrap = document.getElementById(&quot;search_engine_wrap&quot;);</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+      let searchEngineCheck = document.getElementById(&quot;search_engine_check&quot;);</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+      searchEngineWrap.style.display = &quot;block&quot;;</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+      searchEngineWrap.addEventListener(&quot;click&quot;, function() {</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+        searchEngineCheck.click();</span>
<a href="#l1.70"></a><span id="l1.70">         return false;</span>
<a href="#l1.71"></a><span id="l1.71">       });</span>
<a href="#l1.72"></a><span id="l1.72"> </span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-      $(&quot;#search_engine_check&quot;).click(function(event) {</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+      searchEngineCheck.addEventListener(&quot;click&quot;, function(event) {</span>
<a href="#l1.75"></a><span id="l1.75">         event.stopPropagation();</span>
<a href="#l1.76"></a><span id="l1.76">       });</span>
<a href="#l1.77"></a><span id="l1.77"> </span>
<a href="#l1.78"></a><span id="l1.78">       // Set up the fields...</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-      $(&quot;#search_engine_check&quot;).prop(&quot;checked&quot;, true);</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineminus">-      $(&quot;#search_engine_desc&quot;).html(stringBundle.get(&quot;searchDesc&quot;, [engine.name]));</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+      searchEngineCheck.checked = true;</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+      document.getElementById(&quot;search_engine_desc&quot;).innerHTML =</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+        stringBundle.get(&quot;searchDesc&quot;, [engine.name]);</span>
<a href="#l1.84"></a><span id="l1.84">     }</span>
<a href="#l1.85"></a><span id="l1.85"> </span>
<a href="#l1.86"></a><span id="l1.86" class="difflineminus">-    $(&quot;#success-compose&quot;).click(function() {</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+    document.getElementById(&quot;success-compose&quot;).addEventListener(&quot;click&quot;, function() {</span>
<a href="#l1.88"></a><span id="l1.88">       MailServices.compose.OpenComposeWindow(null, null, null,</span>
<a href="#l1.89"></a><span id="l1.89">                                              Ci.nsIMsgCompType.New,</span>
<a href="#l1.90"></a><span id="l1.90">                                              Ci.nsIMsgCompFormat.Default,</span>
<a href="#l1.91"></a><span id="l1.91">                                              account.defaultIdentity, null);</span>
<a href="#l1.92"></a><span id="l1.92">     });</span>
<a href="#l1.93"></a><span id="l1.93"> </span>
<a href="#l1.94"></a><span id="l1.94" class="difflineminus">-    $(&quot;#success-addons&quot;).click(function() {</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+    document.getElementById(&quot;success-addons&quot;).addEventListener(&quot;click&quot;, function() {</span>
<a href="#l1.96"></a><span id="l1.96">       EmailAccountProvisioner.openAddonsMgr();</span>
<a href="#l1.97"></a><span id="l1.97">     });</span>
<a href="#l1.98"></a><span id="l1.98"> </span>
<a href="#l1.99"></a><span id="l1.99" class="difflineminus">-    $(&quot;#success-signature&quot;).click(function() {</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+    document.getElementById(&quot;success-signature&quot;).addEventListener(&quot;click&quot;, function() {</span>
<a href="#l1.101"></a><span id="l1.101">       var existingAccountManager =</span>
<a href="#l1.102"></a><span id="l1.102">         Services.wm.getMostRecentWindow(&quot;mailnews:accountmanager&quot;);</span>
<a href="#l1.103"></a><span id="l1.103"> </span>
<a href="#l1.104"></a><span id="l1.104">       if (existingAccountManager)</span>
<a href="#l1.105"></a><span id="l1.105">         existingAccountManager.focus();</span>
<a href="#l1.106"></a><span id="l1.106">       else</span>
<a href="#l1.107"></a><span id="l1.107">         window.openDialog(&quot;chrome://messenger/content/AccountManager.xul&quot;,</span>
<a href="#l1.108"></a><span id="l1.108">                           &quot;AccountManager&quot;, &quot;chrome,centerscreen,modal,titlebar&quot;,</span>
<a href="#l1.109"></a><span id="l1.109">                           {server: account.incomingServer});</span>
<a href="#l1.110"></a><span id="l1.110">     });</span>
<a href="#l1.111"></a><span id="l1.111"> </span>
<a href="#l1.112"></a><span id="l1.112" class="difflineminus">-    $(&quot;#window&quot;).hide();</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineminus">-    $(&quot;#successful_account&quot;).show();</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineplus">+    document.getElementById(&quot;window&quot;).style.display = &quot;none&quot;;</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineplus">+    document.getElementById(&quot;successful_account&quot;).style.display = &quot;block&quot;;</span>
<a href="#l1.116"></a><span id="l1.116">   },</span>
<a href="#l1.117"></a><span id="l1.117"> </span>
<a href="#l1.118"></a><span id="l1.118">   /**</span>
<a href="#l1.119"></a><span id="l1.119">    * Save the name inputted in the search field to localstorage, so we can</span>
<a href="#l1.120"></a><span id="l1.120">    * reconstitute it on respawn later.</span>
<a href="#l1.121"></a><span id="l1.121">    */</span>
<a href="#l1.122"></a><span id="l1.122">   saveName: function EAP_saveName() {</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineminus">-    var name = String.trim($(&quot;#name&quot;).val());</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineplus">+    let name = document.getElementById(&quot;name&quot;).value.trim();</span>
<a href="#l1.125"></a><span id="l1.125">     this.storage.setItem(&quot;name&quot;, name);</span>
<a href="#l1.126"></a><span id="l1.126">   },</span>
<a href="#l1.127"></a><span id="l1.127"> </span>
<a href="#l1.128"></a><span id="l1.128">   onSearchInputOrProvidersChanged: function EAP_onSearchInputOrProvidersChanged(event) {</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineminus">-    let emptyName = $(&quot;#name&quot;).val() == &quot;&quot;;</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineminus">-    EmailAccountProvisioner.searchButtonEnabled(!emptyName</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineminus">-                                                &amp;&amp; EmailAccountProvisioner</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineminus">-                                                   .someProvidersChecked);</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineplus">+    let emptyName = document.getElementById(&quot;name&quot;).value == &quot;&quot;;</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineplus">+    EmailAccountProvisioner.searchButtonEnabled(!emptyName &amp;&amp;</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineplus">+      EmailAccountProvisioner.someProvidersChecked);</span>
<a href="#l1.136"></a><span id="l1.136">   },</span>
<a href="#l1.137"></a><span id="l1.137"> </span>
<a href="#l1.138"></a><span id="l1.138">   /**</span>
<a href="#l1.139"></a><span id="l1.139">    * Hook up our events, populate the DOM, set our hooks, do all of our</span>
<a href="#l1.140"></a><span id="l1.140">    * prep work.  Since this is called via jQuery on document ready,</span>
<a href="#l1.141"></a><span id="l1.141">    * the value for &quot;this&quot; is the actual window document, hence the need</span>
<a href="#l1.142"></a><span id="l1.142">    * to explicitly refer to EmailAccountProvisioner.</span>
<a href="#l1.143"></a><span id="l1.143">    */</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineat">@@ -224,216 +218,308 @@ var EmailAccountProvisioner = {</span>
<a href="#l1.145"></a><span id="l1.145"> </span>
<a href="#l1.146"></a><span id="l1.146">     gLog.info(&quot;Initializing Email Account Provisioner&quot;);</span>
<a href="#l1.147"></a><span id="l1.147"> </span>
<a href="#l1.148"></a><span id="l1.148">     // For any anchor element that gets the &quot;external&quot; class, make it so that</span>
<a href="#l1.149"></a><span id="l1.149">     // when we click on that element, instead of loading up the href in the</span>
<a href="#l1.150"></a><span id="l1.150">     // window itself, we open up the link in the default browser.</span>
<a href="#l1.151"></a><span id="l1.151">     let opener = Cc[&quot;@mozilla.org/uriloader/external-protocol-service;1&quot;]</span>
<a href="#l1.152"></a><span id="l1.152">                            .getService(Ci.nsIExternalProtocolService);</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineminus">-    $(&quot;a.external&quot;).live(&quot;click&quot;, function (e) {</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineminus">-      e.preventDefault();</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineminus">-      opener.loadUrl(Services.io.newURI($(e.target).attr(&quot;href&quot;), &quot;UTF-8&quot;, null));</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineplus">+    document.addEventListener(&quot;click&quot;, function(e) {</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineplus">+      if (e.target.tagName == &quot;a&quot; &amp;&amp;</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineplus">+          e.target.classList.contains(&quot;external&quot;)) {</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineplus">+        e.preventDefault();</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineplus">+        let uri = e.target.getAttribute(&quot;href&quot;);</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineplus">+        opener.loadUrl(Services.io.newURI(uri, &quot;UTF-8&quot;, null));</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineplus">+      }</span>
<a href="#l1.163"></a><span id="l1.163">     });</span>
<a href="#l1.164"></a><span id="l1.164"> </span>
<a href="#l1.165"></a><span id="l1.165">     // Throw the disclaimer into the window.  In the future, this should probably</span>
<a href="#l1.166"></a><span id="l1.166">     // be done in the actual XHTML page, instead of injected via JS.</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineminus">-    let commentary = $(&quot;.commentary&quot;)</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineminus">-      .append($(&quot;&lt;span&gt;&quot; + stringBundle.get(&quot;disclaimer&quot;,</span>
<a href="#l1.169"></a><span id="l1.169" class="difflineminus">-      [&quot;https://www.mozilla.org/thunderbird/legal/privacy/&quot;]) + &quot;&lt;/span&gt;&quot;));</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineplus">+    let commentary = document.querySelector(&quot;.commentary&quot;);</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineplus">+    commentary.innerHTML =</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineplus">+      commentary.innerHTML +</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineplus">+      &quot;&lt;span&gt;&quot; +</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineplus">+      stringBundle.get(&quot;disclaimer&quot;, [&quot;https://www.mozilla.org/thunderbird/legal/privacy/&quot;]) +</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineplus">+      &quot;&lt;/span&gt;&quot;;</span>
<a href="#l1.176"></a><span id="l1.176"> </span>
<a href="#l1.177"></a><span id="l1.177">     EmailAccountProvisioner.tryToPopulateProviderList();</span>
<a href="#l1.178"></a><span id="l1.178"> </span>
<a href="#l1.179"></a><span id="l1.179">     // Link the keypress function to the name field so that we can enable and</span>
<a href="#l1.180"></a><span id="l1.180">     // disable the search button.</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineminus">-    $(&quot;#name&quot;).keyup(EmailAccountProvisioner.onSearchInputOrProvidersChanged);</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineplus">+    let nameElement = document.getElementById(&quot;name&quot;);</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineplus">+    nameElement.addEventListener(&quot;keyup&quot;,</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineplus">+      EmailAccountProvisioner.onSearchInputOrProvidersChanged);</span>
<a href="#l1.185"></a><span id="l1.185"> </span>
<a href="#l1.186"></a><span id="l1.186">     // If we have a name stored in local storage from an earlier session,</span>
<a href="#l1.187"></a><span id="l1.187">     // populate the search field with it.</span>
<a href="#l1.188"></a><span id="l1.188">     let name = EmailAccountProvisioner.storage.getItem(&quot;name&quot;) ||</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineminus">-               $(&quot;#name&quot;).text();</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineplus">+               nameElement.value;</span>
<a href="#l1.191"></a><span id="l1.191">     if (!name) {</span>
<a href="#l1.192"></a><span id="l1.192">       try {</span>
<a href="#l1.193"></a><span id="l1.193">         let userInfo = Cc[&quot;@mozilla.org/userinfo;1&quot;].getService(Ci.nsIUserInfo);</span>
<a href="#l1.194"></a><span id="l1.194">         name = userInfo.fullname;</span>
<a href="#l1.195"></a><span id="l1.195">       } catch(e) {</span>
<a href="#l1.196"></a><span id="l1.196">         // nsIUserInfo may not be implemented on all platforms, and name might</span>
<a href="#l1.197"></a><span id="l1.197">         // not be avaialble even if it is.</span>
<a href="#l1.198"></a><span id="l1.198">       }</span>
<a href="#l1.199"></a><span id="l1.199">     }</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineminus">-    $(&quot;#name&quot;).val(name);</span>
<a href="#l1.201"></a><span id="l1.201" class="difflineplus">+    nameElement.value = name;</span>
<a href="#l1.202"></a><span id="l1.202">     EmailAccountProvisioner.saveName();</span>
<a href="#l1.203"></a><span id="l1.203"> </span>
<a href="#l1.204"></a><span id="l1.204">     // Pretend like we've typed something into the search input to set the</span>
<a href="#l1.205"></a><span id="l1.205">     // initial enabled/disabled state of the search button.</span>
<a href="#l1.206"></a><span id="l1.206">     EmailAccountProvisioner.onSearchInputOrProvidersChanged();</span>
<a href="#l1.207"></a><span id="l1.207"> </span>
<a href="#l1.208"></a><span id="l1.208" class="difflineminus">-    $(&quot;#window&quot;).css(&quot;height&quot;, window.innerHeight - 1);</span>
<a href="#l1.209"></a><span id="l1.209" class="difflineplus">+    document.getElementById(&quot;window&quot;).style.height = window.innerHeight - 1;</span>
<a href="#l1.210"></a><span id="l1.210"> </span>
<a href="#l1.211"></a><span id="l1.211" class="difflineminus">-    $(&quot;button.existing&quot;).click(function() {</span>
<a href="#l1.212"></a><span id="l1.212" class="difflineplus">+    document.querySelector(&quot;button.existing&quot;).addEventListener(&quot;click&quot;, function() {</span>
<a href="#l1.213"></a><span id="l1.213">       EmailAccountProvisioner.saveName();</span>
<a href="#l1.214"></a><span id="l1.214">       EmailAccountProvisioner.NewMailAccount(EmailAccountProvisioner.msgWindow,</span>
<a href="#l1.215"></a><span id="l1.215">                                              null,</span>
<a href="#l1.216"></a><span id="l1.216">                                              window.arguments[0]);</span>
<a href="#l1.217"></a><span id="l1.217">       window.close();</span>
<a href="#l1.218"></a><span id="l1.218">     });</span>
<a href="#l1.219"></a><span id="l1.219"> </span>
<a href="#l1.220"></a><span id="l1.220">     // Handle Ctrl-W and Esc</span>
<a href="#l1.221"></a><span id="l1.221" class="difflineminus">-    $(window).keypress(function(event) {</span>
<a href="#l1.222"></a><span id="l1.222" class="difflineplus">+    window.addEventListener(&quot;keypress&quot;, function(event) {</span>
<a href="#l1.223"></a><span id="l1.223">       if ((event.which == &quot;119&quot; &amp;&amp; isAccel(event))</span>
<a href="#l1.224"></a><span id="l1.224">           || event.keyCode == 27) {</span>
<a href="#l1.225"></a><span id="l1.225">         window.close();</span>
<a href="#l1.226"></a><span id="l1.226">       }</span>
<a href="#l1.227"></a><span id="l1.227">     });</span>
<a href="#l1.228"></a><span id="l1.228"> </span>
<a href="#l1.229"></a><span id="l1.229" class="difflineminus">-    $(&quot;#search&quot;).submit(EmailAccountProvisioner.onSearchSubmit);</span>
<a href="#l1.230"></a><span id="l1.230" class="difflineplus">+    document.getElementById(&quot;search&quot;).addEventListener(&quot;submit&quot;,</span>
<a href="#l1.231"></a><span id="l1.231" class="difflineplus">+      EmailAccountProvisioner.onSearchSubmit);</span>
<a href="#l1.232"></a><span id="l1.232"> </span>
<a href="#l1.233"></a><span id="l1.233" class="difflineminus">-    $(&quot;#notifications&quot;).delegate(&quot;button.create&quot;, &quot;click&quot;,</span>
<a href="#l1.234"></a><span id="l1.234" class="difflineminus">-                                 EmailAccountProvisioner.onAddressSelected);</span>
<a href="#l1.235"></a><span id="l1.235" class="difflineplus">+    let notifications = document.getElementById(&quot;notifications&quot;);</span>
<a href="#l1.236"></a><span id="l1.236" class="difflineplus">+    notifications.addEventListener(&quot;click&quot;, function(event) {</span>
<a href="#l1.237"></a><span id="l1.237" class="difflineplus">+      if (event.target.tagName == &quot;button&quot; &amp;&amp;</span>
<a href="#l1.238"></a><span id="l1.238" class="difflineplus">+          event.target.classList.contains(&quot;create&quot;)) {</span>
<a href="#l1.239"></a><span id="l1.239" class="difflineplus">+        EmailAccountProvisioner.onAddressSelected(event.target);</span>
<a href="#l1.240"></a><span id="l1.240" class="difflineplus">+      }</span>
<a href="#l1.241"></a><span id="l1.241" class="difflineplus">+    });</span>
<a href="#l1.242"></a><span id="l1.242"> </span>
<a href="#l1.243"></a><span id="l1.243">     // Handle clicking on both email address suggestions, as well</span>
<a href="#l1.244"></a><span id="l1.244">     // as the headers for the providers of those suggestions.</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineminus">-    $(&quot;#results&quot;).delegate(&quot;div.selection&quot;, &quot;click&quot;, function() {</span>
<a href="#l1.246"></a><span id="l1.246" class="difflineminus">-      let self = $(this);</span>
<a href="#l1.247"></a><span id="l1.247" class="difflineminus">-      let resultsGroup = self.closest(&quot;.resultsGroup&quot;);</span>
<a href="#l1.248"></a><span id="l1.248" class="difflineplus">+    let results = document.getElementById(&quot;results&quot;);</span>
<a href="#l1.249"></a><span id="l1.249" class="difflineplus">+    results.addEventListener(&quot;click&quot;, event =&gt; {</span>
<a href="#l1.250"></a><span id="l1.250" class="difflineplus">+      // Find the resultsGroup this click was in.</span>
<a href="#l1.251"></a><span id="l1.251" class="difflineplus">+      let resultsGroup = event.target;</span>
<a href="#l1.252"></a><span id="l1.252" class="difflineplus">+      while (resultsGroup) {</span>
<a href="#l1.253"></a><span id="l1.253" class="difflineplus">+        if (resultsGroup.classList.contains(&quot;resultsGroup&quot;)) {</span>
<a href="#l1.254"></a><span id="l1.254" class="difflineplus">+          break;</span>
<a href="#l1.255"></a><span id="l1.255" class="difflineplus">+        }</span>
<a href="#l1.256"></a><span id="l1.256" class="difflineplus">+        resultsGroup = resultsGroup.parentElement;</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineplus">+      }</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineplus">+      if (!resultsGroup)</span>
<a href="#l1.259"></a><span id="l1.259" class="difflineplus">+        throw(&quot;Unexpected error finding resultsGroup.&quot;);</span>
<a href="#l1.260"></a><span id="l1.260"> </span>
<a href="#l1.261"></a><span id="l1.261">       // Return if we're already expanded</span>
<a href="#l1.262"></a><span id="l1.262" class="difflineminus">-      if (resultsGroup.hasClass(&quot;expanded&quot;))</span>
<a href="#l1.263"></a><span id="l1.263" class="difflineplus">+      if (resultsGroup.classList.contains(&quot;expanded&quot;))</span>
<a href="#l1.264"></a><span id="l1.264">         return;</span>
<a href="#l1.265"></a><span id="l1.265"> </span>
<a href="#l1.266"></a><span id="l1.266" class="difflineminus">-      resultsGroup.siblings().removeClass(&quot;expanded&quot;);</span>
<a href="#l1.267"></a><span id="l1.267" class="difflineminus">-      resultsGroup.addClass(&quot;expanded&quot;);</span>
<a href="#l1.268"></a><span id="l1.268" class="difflineminus">-</span>
<a href="#l1.269"></a><span id="l1.269" class="difflineminus">-      // Hide the other boxes.</span>
<a href="#l1.270"></a><span id="l1.270" class="difflineminus">-      resultsGroup.siblings().children(&quot;.extra&quot;).slideUp();</span>
<a href="#l1.271"></a><span id="l1.271" class="difflineminus">-      resultsGroup.siblings().find(&quot;.more&quot;).show();</span>
<a href="#l1.272"></a><span id="l1.272" class="difflineminus">-      resultsGroup.siblings().find(&quot;.pricing&quot;).fadeOut(&quot;fast&quot;);</span>
<a href="#l1.273"></a><span id="l1.273" class="difflineminus">-      resultsGroup.siblings().find(&quot;.price&quot;).fadeIn(&quot;fast&quot;);</span>
<a href="#l1.274"></a><span id="l1.274" class="difflineminus">-</span>
<a href="#l1.275"></a><span id="l1.275" class="difflineminus">-      // And show this box.</span>
<a href="#l1.276"></a><span id="l1.276" class="difflineminus">-      resultsGroup.find(&quot;.more&quot;).hide();</span>
<a href="#l1.277"></a><span id="l1.277" class="difflineminus">-      resultsGroup.children().find(&quot;.pricing&quot;).fadeIn(&quot;fast&quot;);</span>
<a href="#l1.278"></a><span id="l1.278" class="difflineminus">-      resultsGroup.children().find(&quot;.price&quot;).fadeOut(&quot;fast&quot;);</span>
<a href="#l1.279"></a><span id="l1.279" class="difflineminus">-      self.siblings(&quot;.extra&quot;).slideDown();</span>
<a href="#l1.280"></a><span id="l1.280" class="difflineplus">+      for (let child of resultsGroup.parentElement.children) {</span>
<a href="#l1.281"></a><span id="l1.281" class="difflineplus">+        if (child != resultsGroup) {</span>
<a href="#l1.282"></a><span id="l1.282" class="difflineplus">+          child.classList.remove(&quot;expanded&quot;);</span>
<a href="#l1.283"></a><span id="l1.283" class="difflineplus">+          // Hide the other boxes.</span>
<a href="#l1.284"></a><span id="l1.284" class="difflineplus">+          for (let node of child.querySelectorAll(&quot;.extra&quot;)) {</span>
<a href="#l1.285"></a><span id="l1.285" class="difflineplus">+            node.classList.add(&quot;slideUp&quot;);</span>
<a href="#l1.286"></a><span id="l1.286" class="difflineplus">+            for (let address of node.querySelectorAll(&quot;.address&quot;)) {</span>
<a href="#l1.287"></a><span id="l1.287" class="difflineplus">+              address.classList.remove(&quot;showWithFade&quot;);</span>
<a href="#l1.288"></a><span id="l1.288" class="difflineplus">+              address.classList.add(&quot;hideWithFade&quot;);</span>
<a href="#l1.289"></a><span id="l1.289" class="difflineplus">+            }</span>
<a href="#l1.290"></a><span id="l1.290" class="difflineplus">+          }</span>
<a href="#l1.291"></a><span id="l1.291" class="difflineplus">+          let more = child.querySelector(&quot;.more&quot;);</span>
<a href="#l1.292"></a><span id="l1.292" class="difflineplus">+          let makeListener = (aNode, aMore) =&gt; {</span>
<a href="#l1.293"></a><span id="l1.293" class="difflineplus">+            let listener = () =&gt; {</span>
<a href="#l1.294"></a><span id="l1.294" class="difflineplus">+              if (aMore)</span>
<a href="#l1.295"></a><span id="l1.295" class="difflineplus">+                aMore.style.display = &quot;block&quot;;</span>
<a href="#l1.296"></a><span id="l1.296" class="difflineplus">+              aNode.querySelector(&quot;button&quot;).disabled = true;</span>
<a href="#l1.297"></a><span id="l1.297" class="difflineplus">+              aNode.removeEventListener(&quot;transitionend&quot;, listener);</span>
<a href="#l1.298"></a><span id="l1.298" class="difflineplus">+            };</span>
<a href="#l1.299"></a><span id="l1.299" class="difflineplus">+            return listener;</span>
<a href="#l1.300"></a><span id="l1.300" class="difflineplus">+          };</span>
<a href="#l1.301"></a><span id="l1.301" class="difflineplus">+          for (let node of child.querySelectorAll(&quot;.pricing&quot;)) {</span>
<a href="#l1.302"></a><span id="l1.302" class="difflineplus">+            node.classList.remove(&quot;showWithFade&quot;);</span>
<a href="#l1.303"></a><span id="l1.303" class="difflineplus">+            // Disable the pricing button and show the &quot;more&quot; text</span>
<a href="#l1.304"></a><span id="l1.304" class="difflineplus">+            // after the transition is complete.</span>
<a href="#l1.305"></a><span id="l1.305" class="difflineplus">+            node.addEventListener(&quot;transitionend&quot;, makeListener(node, more));</span>
<a href="#l1.306"></a><span id="l1.306" class="difflineplus">+            node.classList.add(&quot;hideWithFade&quot;);</span>
<a href="#l1.307"></a><span id="l1.307" class="difflineplus">+          }</span>
<a href="#l1.308"></a><span id="l1.308" class="difflineplus">+          for (let node of child.querySelectorAll(&quot;.price&quot;)) {</span>
<a href="#l1.309"></a><span id="l1.309" class="difflineplus">+            node.classList.remove(&quot;hideWithFade&quot;);</span>
<a href="#l1.310"></a><span id="l1.310" class="difflineplus">+            node.classList.add(&quot;showWithFade&quot;);</span>
<a href="#l1.311"></a><span id="l1.311" class="difflineplus">+          }</span>
<a href="#l1.312"></a><span id="l1.312" class="difflineplus">+        } else {</span>
<a href="#l1.313"></a><span id="l1.313" class="difflineplus">+          child.classList.add(&quot;expanded&quot;);</span>
<a href="#l1.314"></a><span id="l1.314" class="difflineplus">+          // And show this box.</span>
<a href="#l1.315"></a><span id="l1.315" class="difflineplus">+          let more = child.querySelector(&quot;.more&quot;);</span>
<a href="#l1.316"></a><span id="l1.316" class="difflineplus">+          if (more)</span>
<a href="#l1.317"></a><span id="l1.317" class="difflineplus">+            more.style.display = &quot;none&quot;;</span>
<a href="#l1.318"></a><span id="l1.318" class="difflineplus">+          for (let node of child.querySelectorAll(&quot;.pricing&quot;)) {</span>
<a href="#l1.319"></a><span id="l1.319" class="difflineplus">+            node.classList.remove(&quot;hideWithFade&quot;);</span>
<a href="#l1.320"></a><span id="l1.320" class="difflineplus">+            node.classList.add(&quot;showWithFade&quot;);</span>
<a href="#l1.321"></a><span id="l1.321" class="difflineplus">+            node.querySelector(&quot;button&quot;).disabled = false;</span>
<a href="#l1.322"></a><span id="l1.322" class="difflineplus">+          }</span>
<a href="#l1.323"></a><span id="l1.323" class="difflineplus">+          for (let node of child.querySelectorAll(&quot;.price&quot;)) {</span>
<a href="#l1.324"></a><span id="l1.324" class="difflineplus">+            node.classList.remove(&quot;showWithFade&quot;);</span>
<a href="#l1.325"></a><span id="l1.325" class="difflineplus">+            node.classList.add(&quot;hideWithFade&quot;);</span>
<a href="#l1.326"></a><span id="l1.326" class="difflineplus">+          }</span>
<a href="#l1.327"></a><span id="l1.327" class="difflineplus">+          for (let node of child.querySelectorAll(&quot;.extra&quot;)) {</span>
<a href="#l1.328"></a><span id="l1.328" class="difflineplus">+            node.classList.remove(&quot;slideUp&quot;);</span>
<a href="#l1.329"></a><span id="l1.329" class="difflineplus">+            for (let address of node.querySelectorAll(&quot;.address&quot;)) {</span>
<a href="#l1.330"></a><span id="l1.330" class="difflineplus">+              address.classList.remove(&quot;hideWithFade&quot;);</span>
<a href="#l1.331"></a><span id="l1.331" class="difflineplus">+              address.classList.add(&quot;showWithFade&quot;);</span>
<a href="#l1.332"></a><span id="l1.332" class="difflineplus">+            }</span>
<a href="#l1.333"></a><span id="l1.333" class="difflineplus">+          }</span>
<a href="#l1.334"></a><span id="l1.334" class="difflineplus">+        }</span>
<a href="#l1.335"></a><span id="l1.335" class="difflineplus">+      }</span>
<a href="#l1.336"></a><span id="l1.336">     });</span>
<a href="#l1.337"></a><span id="l1.337"> </span>
<a href="#l1.338"></a><span id="l1.338" class="difflineminus">-    $(&quot;button.close&quot;).click(function() {</span>
<a href="#l1.339"></a><span id="l1.339" class="difflineminus">-      window.close();</span>
<a href="#l1.340"></a><span id="l1.340" class="difflineminus">-    });</span>
<a href="#l1.341"></a><span id="l1.341" class="difflineplus">+    for (let node of document.querySelectorAll(&quot;button.close&quot;)) {</span>
<a href="#l1.342"></a><span id="l1.342" class="difflineplus">+      node.addEventListener(&quot;click&quot;, () =&gt; window.close());</span>
<a href="#l1.343"></a><span id="l1.343" class="difflineplus">+    }</span>
<a href="#l1.344"></a><span id="l1.344"> </span>
<a href="#l1.345"></a><span id="l1.345" class="difflineminus">-    $(window).unload(function() {</span>
<a href="#l1.346"></a><span id="l1.346" class="difflineminus">-      if (window.arguments[0].search_engine</span>
<a href="#l1.347"></a><span id="l1.347" class="difflineminus">-          &amp;&amp; $(&quot;#search_engine_check&quot;).prop(&quot;checked&quot;)) {</span>
<a href="#l1.348"></a><span id="l1.348" class="difflineplus">+    window.addEventListener(&quot;unload&quot;, function() {</span>
<a href="#l1.349"></a><span id="l1.349" class="difflineplus">+      let searchEngineCheck = document.getElementById(&quot;search_engine_check&quot;);</span>
<a href="#l1.350"></a><span id="l1.350" class="difflineplus">+      if (window.arguments[0].search_engine &amp;&amp; searchEngineCheck.checked) {</span>
<a href="#l1.351"></a><span id="l1.351">         let engine = Services.search.getEngineByName(window.arguments[0].search_engine);</span>
<a href="#l1.352"></a><span id="l1.352">         Services.search.currentEngine = engine;</span>
<a href="#l1.353"></a><span id="l1.353">       }</span>
<a href="#l1.354"></a><span id="l1.354">     });</span>
<a href="#l1.355"></a><span id="l1.355"> </span>
<a href="#l1.356"></a><span id="l1.356">     if (window.arguments[0].success) {</span>
<a href="#l1.357"></a><span id="l1.357">       // Show the success page which lets a user compose mail, find add-ons,</span>
<a href="#l1.358"></a><span id="l1.358">       // set a signature, etc.</span>
<a href="#l1.359"></a><span id="l1.359">       gLog.info(&quot;Looks like we just finished ordering an address - showing the success page...&quot;);</span>
<a href="#l1.360"></a><span id="l1.360">       EmailAccountProvisioner.showSuccessPage();</span>
<a href="#l1.361"></a><span id="l1.361">     } else {</span>
<a href="#l1.362"></a><span id="l1.362">       // The default mode, where we display the search input, providers, etc</span>
<a href="#l1.363"></a><span id="l1.363" class="difflineminus">-      $(&quot;#window&quot;).show();</span>
<a href="#l1.364"></a><span id="l1.364" class="difflineminus">-      $(&quot;#successful_account&quot;).hide();</span>
<a href="#l1.365"></a><span id="l1.365" class="difflineplus">+      document.getElementById(&quot;window&quot;).style.display = &quot;block&quot;;</span>
<a href="#l1.366"></a><span id="l1.366" class="difflineplus">+      document.getElementById(&quot;successful_account&quot;).style.display = &quot;none&quot;;</span>
<a href="#l1.367"></a><span id="l1.367">     }</span>
<a href="#l1.368"></a><span id="l1.368"> </span>
<a href="#l1.369"></a><span id="l1.369">     gLog.info(&quot;Email Account Provisioner init complete.&quot;);</span>
<a href="#l1.370"></a><span id="l1.370"> </span>
<a href="#l1.371"></a><span id="l1.371">     EmailAccountProvisioner._inited = true;</span>
<a href="#l1.372"></a><span id="l1.372">   },</span>
<a href="#l1.373"></a><span id="l1.373"> </span>
<a href="#l1.374"></a><span id="l1.374">   /**</span>
<a href="#l1.375"></a><span id="l1.375">    * Event handler for when the user submits the search request for their</span>
<a href="#l1.376"></a><span id="l1.376">    * name to the suggestFromName service.</span>
<a href="#l1.377"></a><span id="l1.377">    */</span>
<a href="#l1.378"></a><span id="l1.378">   onSearchSubmit: function EAP_onSearchSubmit() {</span>
<a href="#l1.379"></a><span id="l1.379" class="difflineminus">-    $(&quot;#notifications&quot;).children().hide();</span>
<a href="#l1.380"></a><span id="l1.380" class="difflineminus">-    $(&quot;#instructions&quot;).fadeOut();</span>
<a href="#l1.381"></a><span id="l1.381" class="difflineplus">+    for (let node of document.getElementById(&quot;notifications&quot;).children) {</span>
<a href="#l1.382"></a><span id="l1.382" class="difflineplus">+      node.style.display = &quot;none&quot;;</span>
<a href="#l1.383"></a><span id="l1.383" class="difflineplus">+    }</span>
<a href="#l1.384"></a><span id="l1.384" class="difflineplus">+    document.getElementById(&quot;instructions&quot;).classList.add(&quot;hide&quot;);</span>
<a href="#l1.385"></a><span id="l1.385">     EmailAccountProvisioner.saveName();</span>
<a href="#l1.386"></a><span id="l1.386" class="difflineplus">+</span>
<a href="#l1.387"></a><span id="l1.387">     // Here's where we do some kind of hack-y client-side sanitization.</span>
<a href="#l1.388"></a><span id="l1.388">     // Believe it or not, this is how you sanitize stuff to HTML elements</span>
<a href="#l1.389"></a><span id="l1.389">     // via jQuery.</span>
<a href="#l1.390"></a><span id="l1.390" class="difflineminus">-    let name = String.trim($(&quot;&lt;div&gt;&lt;/div&gt;&quot;).text($(&quot;#name&quot;).val()).html());</span>
<a href="#l1.391"></a><span id="l1.391" class="difflineminus">-    if (name.length &lt;= 0) {</span>
<a href="#l1.392"></a><span id="l1.392" class="difflineminus">-      $(&quot;#name&quot;).select().focus();</span>
<a href="#l1.393"></a><span id="l1.393" class="difflineplus">+    // let name = String.trim($(&quot;&lt;div&gt;&lt;/div&gt;&quot;).text($(&quot;#name&quot;).val()).html());</span>
<a href="#l1.394"></a><span id="l1.394" class="difflineplus">+    // Not quite sure what this was for, but here's the hack converted</span>
<a href="#l1.395"></a><span id="l1.395" class="difflineplus">+    // to vanilla JS.</span>
<a href="#l1.396"></a><span id="l1.396" class="difflineplus">+    let nameElement = document.getElementById(&quot;name&quot;);</span>
<a href="#l1.397"></a><span id="l1.397" class="difflineplus">+    let div = document.createElement(&quot;div&quot;);</span>
<a href="#l1.398"></a><span id="l1.398" class="difflineplus">+    div.textContent = nameElement.value;</span>
<a href="#l1.399"></a><span id="l1.399" class="difflineplus">+    let name = div.innerHTML.trim();</span>
<a href="#l1.400"></a><span id="l1.400" class="difflineplus">+    if (!name) {</span>
<a href="#l1.401"></a><span id="l1.401" class="difflineplus">+      nameElement.select();</span>
<a href="#l1.402"></a><span id="l1.402" class="difflineplus">+      nameElement.focus();</span>
<a href="#l1.403"></a><span id="l1.403">       return;</span>
<a href="#l1.404"></a><span id="l1.404">     }</span>
<a href="#l1.405"></a><span id="l1.405"> </span>
<a href="#l1.406"></a><span id="l1.406">     EmailAccountProvisioner.searchEnabled(false);</span>
<a href="#l1.407"></a><span id="l1.407">     EmailAccountProvisioner.spinning(true);</span>
<a href="#l1.408"></a><span id="l1.408">     let [firstname, lastname] = splitName(name);</span>
<a href="#l1.409"></a><span id="l1.409" class="difflineminus">-    let providerList = $(&quot;.provider input:checked&quot;).map(function() {</span>
<a href="#l1.410"></a><span id="l1.410" class="difflineminus">-      return $(this).val();</span>
<a href="#l1.411"></a><span id="l1.411" class="difflineminus">-    }).get().join(',');</span>
<a href="#l1.412"></a><span id="l1.412" class="difflineplus">+    let selectedProviderList =</span>
<a href="#l1.413"></a><span id="l1.413" class="difflineplus">+      [...document.querySelectorAll(&quot;.provider input:checked&quot;)];</span>
<a href="#l1.414"></a><span id="l1.414" class="difflineplus">+    let providerList = selectedProviderList.map(node =&gt; node.value).join(',');</span>
<a href="#l1.415"></a><span id="l1.415"> </span>
<a href="#l1.416"></a><span id="l1.416" class="difflineminus">-    $.ajax({</span>
<a href="#l1.417"></a><span id="l1.417" class="difflineminus">-      url: EmailAccountProvisioner.suggestFromName,</span>
<a href="#l1.418"></a><span id="l1.418" class="difflineminus">-      dataType: 'json',</span>
<a href="#l1.419"></a><span id="l1.419" class="difflineminus">-      data: {&quot;first_name&quot;: firstname,</span>
<a href="#l1.420"></a><span id="l1.420" class="difflineminus">-             &quot;last_name&quot;: lastname,</span>
<a href="#l1.421"></a><span id="l1.421" class="difflineminus">-             &quot;providers&quot;: providerList,</span>
<a href="#l1.422"></a><span id="l1.422" class="difflineminus">-             &quot;version&quot;: 2},</span>
<a href="#l1.423"></a><span id="l1.423" class="difflineminus">-      timeout: CONNECTION_TIMEOUT,</span>
<a href="#l1.424"></a><span id="l1.424" class="difflineminus">-      success: EmailAccountProvisioner.onSearchResults})</span>
<a href="#l1.425"></a><span id="l1.425" class="difflineminus">-      .error(EmailAccountProvisioner.showSearchError)</span>
<a href="#l1.426"></a><span id="l1.426" class="difflineminus">-      .complete(function() {</span>
<a href="#l1.427"></a><span id="l1.427" class="difflineminus">-        $(&quot;#FirstAndLastName&quot;).html(String.trim(firstname + &quot; &quot; + lastname));</span>
<a href="#l1.428"></a><span id="l1.428" class="difflineminus">-        EmailAccountProvisioner.searchEnabled(true);</span>
<a href="#l1.429"></a><span id="l1.429" class="difflineminus">-        EmailAccountProvisioner.spinning(false);</span>
<a href="#l1.430"></a><span id="l1.430" class="difflineminus">-      });</span>
<a href="#l1.431"></a><span id="l1.431" class="difflineplus">+    let request = new XMLHttpRequest();</span>
<a href="#l1.432"></a><span id="l1.432" class="difflineplus">+    request.open(&quot;GET&quot;, EmailAccountProvisioner.suggestFromName +</span>
<a href="#l1.433"></a><span id="l1.433" class="difflineplus">+      &quot;?first_name=&quot; + encodeURIComponent(firstname) +</span>
<a href="#l1.434"></a><span id="l1.434" class="difflineplus">+      &quot;&amp;last_name=&quot; + encodeURIComponent(lastname) +</span>
<a href="#l1.435"></a><span id="l1.435" class="difflineplus">+      &quot;&amp;providers=&quot; + encodeURIComponent(providerList) +</span>
<a href="#l1.436"></a><span id="l1.436" class="difflineplus">+      &quot;&amp;version=2&quot;);</span>
<a href="#l1.437"></a><span id="l1.437" class="difflineplus">+    request.onload = function () {</span>
<a href="#l1.438"></a><span id="l1.438" class="difflineplus">+      let data;</span>
<a href="#l1.439"></a><span id="l1.439" class="difflineplus">+      try {</span>
<a href="#l1.440"></a><span id="l1.440" class="difflineplus">+        data = JSON.parse(request.responseText);</span>
<a href="#l1.441"></a><span id="l1.441" class="difflineplus">+      } catch(e) {};</span>
<a href="#l1.442"></a><span id="l1.442" class="difflineplus">+      EmailAccountProvisioner.onSearchResults(data);</span>
<a href="#l1.443"></a><span id="l1.443" class="difflineplus">+    };</span>
<a href="#l1.444"></a><span id="l1.444" class="difflineplus">+    request.onerror = () =&gt; {</span>
<a href="#l1.445"></a><span id="l1.445" class="difflineplus">+      gLog.info(&quot;Error response of XMLHttpRequest fetching address data.&quot;);</span>
<a href="#l1.446"></a><span id="l1.446" class="difflineplus">+      EmailAccountProvisioner.showSearchError();</span>
<a href="#l1.447"></a><span id="l1.447" class="difflineplus">+    };</span>
<a href="#l1.448"></a><span id="l1.448" class="difflineplus">+    request.ontimeout = () =&gt; {</span>
<a href="#l1.449"></a><span id="l1.449" class="difflineplus">+      gLog.info(&quot;Timeout of XMLHttpRequest fetching address data.&quot;);</span>
<a href="#l1.450"></a><span id="l1.450" class="difflineplus">+      EmailAccountProvisioner.showSearchError();</span>
<a href="#l1.451"></a><span id="l1.451" class="difflineplus">+    }</span>
<a href="#l1.452"></a><span id="l1.452" class="difflineplus">+    request.onloadend = function() {</span>
<a href="#l1.453"></a><span id="l1.453" class="difflineplus">+      // Also called if we timeout.</span>
<a href="#l1.454"></a><span id="l1.454" class="difflineplus">+      let firstAndLastName = document.getElementById(&quot;FirstAndLastName&quot;);</span>
<a href="#l1.455"></a><span id="l1.455" class="difflineplus">+      firstAndLastName.innerHTML = String.trim(firstname + &quot; &quot; + lastname);</span>
<a href="#l1.456"></a><span id="l1.456" class="difflineplus">+      EmailAccountProvisioner.searchEnabled(true);</span>
<a href="#l1.457"></a><span id="l1.457" class="difflineplus">+      EmailAccountProvisioner.spinning(false);</span>
<a href="#l1.458"></a><span id="l1.458" class="difflineplus">+    };</span>
<a href="#l1.459"></a><span id="l1.459" class="difflineplus">+    request.timeout = CONNECTION_TIMEOUT;</span>
<a href="#l1.460"></a><span id="l1.460" class="difflineplus">+    request.send(null);</span>
<a href="#l1.461"></a><span id="l1.461">   },</span>
<a href="#l1.462"></a><span id="l1.462"> </span>
<a href="#l1.463"></a><span id="l1.463">   /**</span>
<a href="#l1.464"></a><span id="l1.464">    * Event handler for when the user selects an address by clicking on</span>
<a href="#l1.465"></a><span id="l1.465">    * the price button for that address.  This function spawns the content</span>
<a href="#l1.466"></a><span id="l1.466">    * tab for the address order form, and then closes the Account Provisioner</span>
<a href="#l1.467"></a><span id="l1.467">    * window.</span>
<a href="#l1.468"></a><span id="l1.468">    */</span>
<a href="#l1.469"></a><span id="l1.469" class="difflineminus">-  onAddressSelected: function EAP_onAddressSelected() {</span>
<a href="#l1.470"></a><span id="l1.470" class="difflineplus">+  onAddressSelected: function EAP_onAddressSelected(aTarget) {</span>
<a href="#l1.471"></a><span id="l1.471">     gLog.info(&quot;An address was selected by the user.&quot;);</span>
<a href="#l1.472"></a><span id="l1.472" class="difflineminus">-    let provider = EmailAccountProvisioner.providers[$(this).data(&quot;provider&quot;)];</span>
<a href="#l1.473"></a><span id="l1.473" class="difflineplus">+    let provider = EmailAccountProvisioner.providers[aTarget.dataset[&quot;provider&quot;]];</span>
<a href="#l1.474"></a><span id="l1.474"> </span>
<a href="#l1.475"></a><span id="l1.475">     // Replace the variables in the url.</span>
<a href="#l1.476"></a><span id="l1.476">     let url = provider.api;</span>
<a href="#l1.477"></a><span id="l1.477" class="difflineminus">-    let [firstName, lastName] = splitName(String.trim($(&quot;#name&quot;).val()));</span>
<a href="#l1.478"></a><span id="l1.478" class="difflineminus">-    let email = $(this).attr(&quot;address&quot;);</span>
<a href="#l1.479"></a><span id="l1.479" class="difflineplus">+    let [firstName, lastName] = splitName(document.getElementById(&quot;name&quot;).value.trim());</span>
<a href="#l1.480"></a><span id="l1.480" class="difflineplus">+    let email = aTarget.getAttribute(&quot;address&quot;);</span>
<a href="#l1.481"></a><span id="l1.481">     url = url.replace(&quot;{firstname}&quot;, firstName);</span>
<a href="#l1.482"></a><span id="l1.482">     url = url.replace(&quot;{lastname}&quot;, lastName);</span>
<a href="#l1.483"></a><span id="l1.483">     url = url.replace(&quot;{email}&quot;, email);</span>
<a href="#l1.484"></a><span id="l1.484"> </span>
<a href="#l1.485"></a><span id="l1.485">     // And add the extra data.</span>
<a href="#l1.486"></a><span id="l1.486">     let data = storedData[provider.id];</span>
<a href="#l1.487"></a><span id="l1.487">     delete data.provider;</span>
<a href="#l1.488"></a><span id="l1.488">     for (let name in data) {</span>
<a href="#l1.489"></a><span id="l1.489">       url += (url.indexOf(&quot;?&quot;) == -1 ? &quot;?&quot; : &quot;&amp;&quot;) +</span>
<a href="#l1.490"></a><span id="l1.490">               name + &quot;=&quot; + encodeURIComponent(data[name]);</span>
<a href="#l1.491"></a><span id="l1.491">     }</span>
<a href="#l1.492"></a><span id="l1.492"> </span>
<a href="#l1.493"></a><span id="l1.493">     gLog.info(&quot;Opening up a contentTab with the order form.&quot;);</span>
<a href="#l1.494"></a><span id="l1.494">     // Then open a content tab.</span>
<a href="#l1.495"></a><span id="l1.495">     let mail3Pane = Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;);</span>
<a href="#l1.496"></a><span id="l1.496" class="difflineminus">-</span>
<a href="#l1.497"></a><span id="l1.497">     let tabmail = mail3Pane.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l1.498"></a><span id="l1.498">     tabmail.openTab(&quot;accountProvisionerTab&quot;, {</span>
<a href="#l1.499"></a><span id="l1.499">       contentPage: url,</span>
<a href="#l1.500"></a><span id="l1.500">       realName: String.trim(firstName + &quot; &quot; + lastName),</span>
<a href="#l1.501"></a><span id="l1.501">       email: email,</span>
<a href="#l1.502"></a><span id="l1.502">       searchEngine: provider.search_engine,</span>
<a href="#l1.503"></a><span id="l1.503">       onLoad: function (aEvent, aBrowser) {</span>
<a href="#l1.504"></a><span id="l1.504">         window.close();</span>
<a href="#l1.505"></a><span id="l1.505">       },</span>
<a href="#l1.506"></a><span id="l1.506">     });</span>
<a href="#l1.507"></a><span id="l1.507"> </span>
<a href="#l1.508"></a><span id="l1.508">     // Wait for the handler to close us.</span>
<a href="#l1.509"></a><span id="l1.509">     EmailAccountProvisioner.spinning(true);</span>
<a href="#l1.510"></a><span id="l1.510">     EmailAccountProvisioner.searchEnabled(false);</span>
<a href="#l1.511"></a><span id="l1.511" class="difflineminus">-    $(&quot;#notifications&quot;).children().not(&quot;.spinner&quot;).hide();</span>
<a href="#l1.512"></a><span id="l1.512" class="difflineplus">+    for (let node of document.querySelectorAll(&quot;#notifications &gt; :not(.spinner)&quot;)) {</span>
<a href="#l1.513"></a><span id="l1.513" class="difflineplus">+      node.style.display = &quot;none&quot;;</span>
<a href="#l1.514"></a><span id="l1.514" class="difflineplus">+    }</span>
<a href="#l1.515"></a><span id="l1.515">   },</span>
<a href="#l1.516"></a><span id="l1.516"> </span>
<a href="#l1.517"></a><span id="l1.517">   /**</span>
<a href="#l1.518"></a><span id="l1.518">    * Attempt to fetch the provider list from the server.  If it fails,</span>
<a href="#l1.519"></a><span id="l1.519">    * display an error message, and queue for retry.</span>
<a href="#l1.520"></a><span id="l1.520">    */</span>
<a href="#l1.521"></a><span id="l1.521">   tryToPopulateProviderList: function EAP_tryToPopulateProviderList() {</span>
<a href="#l1.522"></a><span id="l1.522">     // If we're already in the middle of getting the provider list, or</span>
<a href="#l1.523"></a><span id="l1.523" class="difflineat">@@ -444,45 +530,53 @@ var EmailAccountProvisioner = {</span>
<a href="#l1.524"></a><span id="l1.524">     gLog.info(&quot;Trying to populate provider list...&quot;);</span>
<a href="#l1.525"></a><span id="l1.525"> </span>
<a href="#l1.526"></a><span id="l1.526">     // If there's a timeout ID for waking the account provisioner, clear it.</span>
<a href="#l1.527"></a><span id="l1.527">     if (this._loadProviderRetryId) {</span>
<a href="#l1.528"></a><span id="l1.528">       window.clearTimeout(this._loadProviderRetryId)</span>
<a href="#l1.529"></a><span id="l1.529">       this._loadProviderRetryId = null;</span>
<a href="#l1.530"></a><span id="l1.530">     }</span>
<a href="#l1.531"></a><span id="l1.531"> </span>
<a href="#l1.532"></a><span id="l1.532" class="difflineminus">-    var self = this;</span>
<a href="#l1.533"></a><span id="l1.533" class="difflineminus">-</span>
<a href="#l1.534"></a><span id="l1.534" class="difflineminus">-    self.searchEnabled(false);</span>
<a href="#l1.535"></a><span id="l1.535" class="difflineminus">-    self.spinning(true);</span>
<a href="#l1.536"></a><span id="l1.536" class="difflineplus">+    this.searchEnabled(false);</span>
<a href="#l1.537"></a><span id="l1.537" class="difflineplus">+    this.spinning(true);</span>
<a href="#l1.538"></a><span id="l1.538"> </span>
<a href="#l1.539"></a><span id="l1.539">     let providerListUrl = Services.prefs.getCharPref(&quot;mail.provider.providerList&quot;);</span>
<a href="#l1.540"></a><span id="l1.540"> </span>
<a href="#l1.541"></a><span id="l1.541" class="difflineminus">-    $.ajax({</span>
<a href="#l1.542"></a><span id="l1.542" class="difflineminus">-      url: providerListUrl,</span>
<a href="#l1.543"></a><span id="l1.543" class="difflineminus">-      dataType: 'json',</span>
<a href="#l1.544"></a><span id="l1.544" class="difflineminus">-      data: '',</span>
<a href="#l1.545"></a><span id="l1.545" class="difflineminus">-      timeout: CONNECTION_TIMEOUT,</span>
<a href="#l1.546"></a><span id="l1.546" class="difflineminus">-      success: EmailAccountProvisioner.populateProviderList,</span>
<a href="#l1.547"></a><span id="l1.547" class="difflineminus">-      }).error(function() {</span>
<a href="#l1.548"></a><span id="l1.548" class="difflineminus">-        // Ugh, we couldn't get the JSON file.  Maybe we're not online.  Or maybe</span>
<a href="#l1.549"></a><span id="l1.549" class="difflineminus">-        // the server is down, or the file isn't being served.  Regardless, if</span>
<a href="#l1.550"></a><span id="l1.550" class="difflineminus">-        // we get here, none of this stuff is going to work.</span>
<a href="#l1.551"></a><span id="l1.551" class="difflineminus">-        EmailAccountProvisioner._loadProviderRetryId = window.setTimeout(EmailAccountProvisioner.tryToPopulateProviderList</span>
<a href="#l1.552"></a><span id="l1.552" class="difflineminus">-                                                                                                .bind(self),</span>
<a href="#l1.553"></a><span id="l1.553" class="difflineminus">-                                                                         RETRY_TIMEOUT);</span>
<a href="#l1.554"></a><span id="l1.554" class="difflineminus">-        EmailAccountProvisioner._loadingProviders = false;</span>
<a href="#l1.555"></a><span id="l1.555" class="difflineminus">-        EmailAccountProvisioner.beOffline();</span>
<a href="#l1.556"></a><span id="l1.556" class="difflineminus">-        gLog.error(&quot;Something went wrong loading the provider list JSON file. &quot;</span>
<a href="#l1.557"></a><span id="l1.557" class="difflineminus">-                   + &quot;Going into offline mode.&quot;);</span>
<a href="#l1.558"></a><span id="l1.558" class="difflineminus">-      }).complete(function() {</span>
<a href="#l1.559"></a><span id="l1.559" class="difflineminus">-        EmailAccountProvisioner._loadingProviders = false;</span>
<a href="#l1.560"></a><span id="l1.560" class="difflineminus">-        EmailAccountProvisioner.spinning(false);</span>
<a href="#l1.561"></a><span id="l1.561" class="difflineminus">-        gLog.info(&quot;Got provider list JSON.&quot;);</span>
<a href="#l1.562"></a><span id="l1.562" class="difflineminus">-      });</span>
<a href="#l1.563"></a><span id="l1.563" class="difflineplus">+    let request = new XMLHttpRequest();</span>
<a href="#l1.564"></a><span id="l1.564" class="difflineplus">+    request.open(&quot;GET&quot;, providerListUrl);</span>
<a href="#l1.565"></a><span id="l1.565" class="difflineplus">+    request.onload = function() {</span>
<a href="#l1.566"></a><span id="l1.566" class="difflineplus">+      let data;</span>
<a href="#l1.567"></a><span id="l1.567" class="difflineplus">+      try {</span>
<a href="#l1.568"></a><span id="l1.568" class="difflineplus">+        data = JSON.parse(request.responseText);</span>
<a href="#l1.569"></a><span id="l1.569" class="difflineplus">+      } catch(e) {};</span>
<a href="#l1.570"></a><span id="l1.570" class="difflineplus">+      EmailAccountProvisioner.populateProviderList(data);</span>
<a href="#l1.571"></a><span id="l1.571" class="difflineplus">+    };</span>
<a href="#l1.572"></a><span id="l1.572" class="difflineplus">+    request.onerror = () =&gt; {</span>
<a href="#l1.573"></a><span id="l1.573" class="difflineplus">+      // Ugh, we couldn't get the JSON file. Maybe we're not online. Or maybe</span>
<a href="#l1.574"></a><span id="l1.574" class="difflineplus">+      // the server is down, or the file isn't being served. Regardless, if</span>
<a href="#l1.575"></a><span id="l1.575" class="difflineplus">+      // we get here, none of this stuff is going to work.</span>
<a href="#l1.576"></a><span id="l1.576" class="difflineplus">+      EmailAccountProvisioner._loadProviderRetryId =</span>
<a href="#l1.577"></a><span id="l1.577" class="difflineplus">+        window.setTimeout(() =&gt; EmailAccountProvisioner.tryToPopulateProviderList(),</span>
<a href="#l1.578"></a><span id="l1.578" class="difflineplus">+                          RETRY_TIMEOUT);</span>
<a href="#l1.579"></a><span id="l1.579" class="difflineplus">+      EmailAccountProvisioner._loadingProviders = false;</span>
<a href="#l1.580"></a><span id="l1.580" class="difflineplus">+      EmailAccountProvisioner.beOffline();</span>
<a href="#l1.581"></a><span id="l1.581" class="difflineplus">+      gLog.error(&quot;Something went wrong loading the provider list JSON file. &quot; +</span>
<a href="#l1.582"></a><span id="l1.582" class="difflineplus">+                 &quot;Going into offline mode.&quot;);</span>
<a href="#l1.583"></a><span id="l1.583" class="difflineplus">+    };</span>
<a href="#l1.584"></a><span id="l1.584" class="difflineplus">+    request.onloadend = function() {</span>
<a href="#l1.585"></a><span id="l1.585" class="difflineplus">+      EmailAccountProvisioner._loadingProviders = false;</span>
<a href="#l1.586"></a><span id="l1.586" class="difflineplus">+      EmailAccountProvisioner.spinning(false);</span>
<a href="#l1.587"></a><span id="l1.587" class="difflineplus">+      gLog.info(&quot;Got provider list JSON.&quot;);</span>
<a href="#l1.588"></a><span id="l1.588" class="difflineplus">+    };</span>
<a href="#l1.589"></a><span id="l1.589" class="difflineplus">+    request.timeout = CONNECTION_TIMEOUT;</span>
<a href="#l1.590"></a><span id="l1.590" class="difflineplus">+    request.ontimeout = () =&gt; {</span>
<a href="#l1.591"></a><span id="l1.591" class="difflineplus">+      glog.info(&quot;Timeout of XMLHttpRequest fetching provider list.&quot;);</span>
<a href="#l1.592"></a><span id="l1.592" class="difflineplus">+      request.onError();</span>
<a href="#l1.593"></a><span id="l1.593" class="difflineplus">+    };</span>
<a href="#l1.594"></a><span id="l1.594" class="difflineplus">+    request.send(null);</span>
<a href="#l1.595"></a><span id="l1.595"> </span>
<a href="#l1.596"></a><span id="l1.596">     EmailAccountProvisioner._loadingProviders = true;</span>
<a href="#l1.597"></a><span id="l1.597">     gLog.info(&quot;We've kicked off a request for the provider list JSON file...&quot;);</span>
<a href="#l1.598"></a><span id="l1.598">   },</span>
<a href="#l1.599"></a><span id="l1.599"> </span>
<a href="#l1.600"></a><span id="l1.600">   providerHasCorrectFields: function EAP_providerHasCorrectFields(provider) {</span>
<a href="#l1.601"></a><span id="l1.601">     let result = true;</span>
<a href="#l1.602"></a><span id="l1.602"> </span>
<a href="#l1.603"></a><span id="l1.603" class="difflineat">@@ -509,216 +603,207 @@ var EmailAccountProvisioner = {</span>
<a href="#l1.604"></a><span id="l1.604">     gLog.info(&quot;Populating the provider list&quot;);</span>
<a href="#l1.605"></a><span id="l1.605"> </span>
<a href="#l1.606"></a><span id="l1.606">     if (!data || !data.length) {</span>
<a href="#l1.607"></a><span id="l1.607">       gLog.error(&quot;The provider list we got back from the server was empty!&quot;);</span>
<a href="#l1.608"></a><span id="l1.608">       EmailAccountProvisioner.beOffline();</span>
<a href="#l1.609"></a><span id="l1.609">       return;</span>
<a href="#l1.610"></a><span id="l1.610">     }</span>
<a href="#l1.611"></a><span id="l1.611"> </span>
<a href="#l1.612"></a><span id="l1.612" class="difflineminus">-    let providerList = $(&quot;#providerList&quot;);</span>
<a href="#l1.613"></a><span id="l1.613" class="difflineplus">+    let providerList = document.getElementById(&quot;providerList&quot;);</span>
<a href="#l1.614"></a><span id="l1.614">     let otherLangProviders = [];</span>
<a href="#l1.615"></a><span id="l1.615"> </span>
<a href="#l1.616"></a><span id="l1.616">     EmailAccountProvisioner.providers = {};</span>
<a href="#l1.617"></a><span id="l1.617"> </span>
<a href="#l1.618"></a><span id="l1.618">     data.forEach(function(provider) {</span>
<a href="#l1.619"></a><span id="l1.619" class="difflineminus">-</span>
<a href="#l1.620"></a><span id="l1.620">       if (!(EmailAccountProvisioner.providerHasCorrectFields(provider))) {</span>
<a href="#l1.621"></a><span id="l1.621">         gLog.error(&quot;A provider had incorrect fields, and has been skipped&quot;);</span>
<a href="#l1.622"></a><span id="l1.622">         return;</span>
<a href="#l1.623"></a><span id="l1.623">       }</span>
<a href="#l1.624"></a><span id="l1.624"> </span>
<a href="#l1.625"></a><span id="l1.625">       EmailAccountProvisioner.providers[provider.id] = provider;</span>
<a href="#l1.626"></a><span id="l1.626"> </span>
<a href="#l1.627"></a><span id="l1.627">       // Let's go through the array of languages for this provider, and</span>
<a href="#l1.628"></a><span id="l1.628">       // check to see if at least one of them matches general.useragent.locale.</span>
<a href="#l1.629"></a><span id="l1.629">       // If so, we'll show / select this provider by default.</span>
<a href="#l1.630"></a><span id="l1.630" class="difflineminus">-      let supportsSomeUserLang = provider</span>
<a href="#l1.631"></a><span id="l1.631" class="difflineminus">-                                 .languages</span>
<a href="#l1.632"></a><span id="l1.632" class="difflineminus">-                                 .some(function (x) {</span>
<a href="#l1.633"></a><span id="l1.633" class="difflineminus">-                                   return x == &quot;*&quot; ||</span>
<a href="#l1.634"></a><span id="l1.634" class="difflineminus">-                                          x == EmailAccountProvisioner.userLanguage</span>
<a href="#l1.635"></a><span id="l1.635" class="difflineminus">-                                 });</span>
<a href="#l1.636"></a><span id="l1.636" class="difflineplus">+      let supportsSomeUserLang = provider.languages.some(function (x) {</span>
<a href="#l1.637"></a><span id="l1.637" class="difflineplus">+        return x == &quot;*&quot; || x == EmailAccountProvisioner.userLanguage;</span>
<a href="#l1.638"></a><span id="l1.638" class="difflineplus">+      });</span>
<a href="#l1.639"></a><span id="l1.639"> </span>
<a href="#l1.640"></a><span id="l1.640">       let checkboxId = provider.id + &quot;-check&quot;;</span>
<a href="#l1.641"></a><span id="l1.641"> </span>
<a href="#l1.642"></a><span id="l1.642" class="difflineminus">-      let providerCheckbox = $('&lt;input type=&quot;checkbox&quot; /&gt;')</span>
<a href="#l1.643"></a><span id="l1.643" class="difflineminus">-                             .val(provider.id)</span>
<a href="#l1.644"></a><span id="l1.644" class="difflineminus">-                             .addClass(&quot;providerCheckbox&quot;)</span>
<a href="#l1.645"></a><span id="l1.645" class="difflineminus">-                             .attr(&quot;id&quot;, checkboxId);</span>
<a href="#l1.646"></a><span id="l1.646" class="difflineplus">+      let providerCheckbox = document.createElement(&quot;input&quot;);</span>
<a href="#l1.647"></a><span id="l1.647" class="difflineplus">+      providerCheckbox.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l1.648"></a><span id="l1.648" class="difflineplus">+      providerCheckbox.setAttribute(&quot;value&quot;, provider.id);</span>
<a href="#l1.649"></a><span id="l1.649" class="difflineplus">+      providerCheckbox.className = &quot;providerCheckbox&quot;;</span>
<a href="#l1.650"></a><span id="l1.650" class="difflineplus">+      providerCheckbox.setAttribute(&quot;id&quot;, checkboxId);</span>
<a href="#l1.651"></a><span id="l1.651"> </span>
<a href="#l1.652"></a><span id="l1.652" class="difflineminus">-      let providerEntry = $('&lt;li class=&quot;provider&quot; /&gt;')</span>
<a href="#l1.653"></a><span id="l1.653" class="difflineminus">-                          .append(providerCheckbox);</span>
<a href="#l1.654"></a><span id="l1.654" class="difflineplus">+      let providerEntry = document.createElement(&quot;li&quot;);</span>
<a href="#l1.655"></a><span id="l1.655" class="difflineplus">+      providerEntry.className = &quot;provider&quot;;</span>
<a href="#l1.656"></a><span id="l1.656" class="difflineplus">+      providerEntry.appendChild(providerCheckbox);</span>
<a href="#l1.657"></a><span id="l1.657"> </span>
<a href="#l1.658"></a><span id="l1.658" class="difflineminus">-      let labelSpan = $('&lt;label class=&quot;providerLabel&quot; /&gt;')</span>
<a href="#l1.659"></a><span id="l1.659" class="difflineminus">-                      .append(provider.label)</span>
<a href="#l1.660"></a><span id="l1.660" class="difflineminus">-                      .appendTo(providerEntry)</span>
<a href="#l1.661"></a><span id="l1.661" class="difflineminus">-                      .attr(&quot;for&quot;, checkboxId);</span>
<a href="#l1.662"></a><span id="l1.662" class="difflineplus">+      let icon = document.createElement(&quot;img&quot;);</span>
<a href="#l1.663"></a><span id="l1.663" class="difflineplus">+      icon.className = &quot;icon&quot;;</span>
<a href="#l1.664"></a><span id="l1.664" class="difflineplus">+      // We add this even if there is no icon, so that the alignment with</span>
<a href="#l1.665"></a><span id="l1.665" class="difflineplus">+      // providers without icons isn't broken.</span>
<a href="#l1.666"></a><span id="l1.666" class="difflineplus">+      providerEntry.appendChild(icon);</span>
<a href="#l1.667"></a><span id="l1.667" class="difflineplus">+      if (provider.icon) {</span>
<a href="#l1.668"></a><span id="l1.668" class="difflineplus">+        // Note this favicon must be fetched, which takes a noticeable</span>
<a href="#l1.669"></a><span id="l1.669" class="difflineplus">+        // time the first time it happens.</span>
<a href="#l1.670"></a><span id="l1.670" class="difflineplus">+        icon.setAttribute(&quot;src&quot;, provider.icon);</span>
<a href="#l1.671"></a><span id="l1.671" class="difflineplus">+      }</span>
<a href="#l1.672"></a><span id="l1.672"> </span>
<a href="#l1.673"></a><span id="l1.673" class="difflineminus">-      if (provider.icon)</span>
<a href="#l1.674"></a><span id="l1.674" class="difflineminus">-        providerCheckbox.after('&lt;img class=&quot;icon&quot; src=&quot;' + provider.icon + '&quot;/&gt;');</span>
<a href="#l1.675"></a><span id="l1.675" class="difflineplus">+      let labelSpan = document.createElement(&quot;label&quot;);</span>
<a href="#l1.676"></a><span id="l1.676" class="difflineplus">+      labelSpan.className = &quot;providerLabel&quot;;</span>
<a href="#l1.677"></a><span id="l1.677" class="difflineplus">+      labelSpan.setAttribute(&quot;for&quot;, checkboxId);</span>
<a href="#l1.678"></a><span id="l1.678" class="difflineplus">+      labelSpan.innerHTML = provider.label;</span>
<a href="#l1.679"></a><span id="l1.679" class="difflineplus">+      providerEntry.appendChild(labelSpan);</span>
<a href="#l1.680"></a><span id="l1.680"> </span>
<a href="#l1.681"></a><span id="l1.681" class="difflineminus">-      providerCheckbox.change(function() {</span>
<a href="#l1.682"></a><span id="l1.682" class="difflineminus">-        EmailAccountProvisioner.populateTermsAndPrivacyLinks();</span>
<a href="#l1.683"></a><span id="l1.683" class="difflineminus">-      });</span>
<a href="#l1.684"></a><span id="l1.684" class="difflineplus">+      providerCheckbox.addEventListener(&quot;change&quot;,</span>
<a href="#l1.685"></a><span id="l1.685" class="difflineplus">+        EmailAccountProvisioner.populateTermsAndPrivacyLinks);</span>
<a href="#l1.686"></a><span id="l1.686"> </span>
<a href="#l1.687"></a><span id="l1.687">       if (supportsSomeUserLang) {</span>
<a href="#l1.688"></a><span id="l1.688" class="difflineminus">-        providerCheckbox.attr('checked', 'checked');</span>
<a href="#l1.689"></a><span id="l1.689" class="difflineminus">-        providerEntry.css('display', 'inline-block');</span>
<a href="#l1.690"></a><span id="l1.690" class="difflineminus">-        providerList.append(providerEntry);</span>
<a href="#l1.691"></a><span id="l1.691" class="difflineplus">+        providerCheckbox.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l1.692"></a><span id="l1.692" class="difflineplus">+        providerEntry.style.display = &quot;inline-block&quot;;</span>
<a href="#l1.693"></a><span id="l1.693" class="difflineplus">+        providerList.appendChild(providerEntry);</span>
<a href="#l1.694"></a><span id="l1.694">       }</span>
<a href="#l1.695"></a><span id="l1.695">       else {</span>
<a href="#l1.696"></a><span id="l1.696" class="difflineminus">-        providerEntry.addClass(&quot;otherLanguage&quot;);</span>
<a href="#l1.697"></a><span id="l1.697" class="difflineplus">+        providerEntry.classList.add(&quot;otherLanguage&quot;);</span>
<a href="#l1.698"></a><span id="l1.698">         otherLangProviders.push(providerEntry);</span>
<a href="#l1.699"></a><span id="l1.699">       }</span>
<a href="#l1.700"></a><span id="l1.700">     });</span>
<a href="#l1.701"></a><span id="l1.701"> </span>
<a href="#l1.702"></a><span id="l1.702" class="difflineminus">-    for (let provider of otherLangProviders) {</span>
<a href="#l1.703"></a><span id="l1.703" class="difflineminus">-      providerList.append(provider);</span>
<a href="#l1.704"></a><span id="l1.704" class="difflineminus">-    }</span>
<a href="#l1.705"></a><span id="l1.705" class="difflineplus">+    if (otherLangProviders.length) {</span>
<a href="#l1.706"></a><span id="l1.706" class="difflineplus">+      for (let provider of otherLangProviders) {</span>
<a href="#l1.707"></a><span id="l1.707" class="difflineplus">+        providerList.appendChild(provider);</span>
<a href="#l1.708"></a><span id="l1.708" class="difflineplus">+      }</span>
<a href="#l1.709"></a><span id="l1.709"> </span>
<a href="#l1.710"></a><span id="l1.710" class="difflineminus">-    if (otherLangProviders.length) {</span>
<a href="#l1.711"></a><span id="l1.711">       let otherLangDesc = document.getElementById(&quot;otherLangDesc&quot;);</span>
<a href="#l1.712"></a><span id="l1.712">       otherLangDesc.classList.remove(&quot;fadeOut&quot;);</span>
<a href="#l1.713"></a><span id="l1.713">       otherLangDesc.classList.add(&quot;fadeIn&quot;);</span>
<a href="#l1.714"></a><span id="l1.714" class="difflineminus">-      $(&quot;#otherLangDesc&quot;).click(function() {</span>
<a href="#l1.715"></a><span id="l1.715" class="difflineplus">+      otherLangDesc.addEventListener(&quot;click&quot;, function() {</span>
<a href="#l1.716"></a><span id="l1.716">         otherLangDesc.classList.remove(&quot;fadeIn&quot;);</span>
<a href="#l1.717"></a><span id="l1.717">         otherLangDesc.classList.add(&quot;fadeOut&quot;);</span>
<a href="#l1.718"></a><span id="l1.718" class="difflineminus">-        $(&quot;.otherLanguage&quot;).fadeIn().css(&quot;display&quot;, &quot;inline-block&quot;);</span>
<a href="#l1.719"></a><span id="l1.719" class="difflineplus">+        for (let node of document.querySelectorAll(&quot;.otherLanguage&quot;)) {</span>
<a href="#l1.720"></a><span id="l1.720" class="difflineplus">+          node.style.display = &quot;inline-block&quot;;</span>
<a href="#l1.721"></a><span id="l1.721" class="difflineplus">+          node.classList.add(&quot;showWithFade&quot;);</span>
<a href="#l1.722"></a><span id="l1.722" class="difflineplus">+        }</span>
<a href="#l1.723"></a><span id="l1.723">       });</span>
<a href="#l1.724"></a><span id="l1.724">     }</span>
<a href="#l1.725"></a><span id="l1.725"> </span>
<a href="#l1.726"></a><span id="l1.726">     EmailAccountProvisioner.populateTermsAndPrivacyLinks();</span>
<a href="#l1.727"></a><span id="l1.727">     EmailAccountProvisioner.beOnline();</span>
<a href="#l1.728"></a><span id="l1.728">     EmailAccountProvisioner._loadedProviders = true;</span>
<a href="#l1.729"></a><span id="l1.729">     EmailAccountProvisioner.onSearchInputOrProvidersChanged();</span>
<a href="#l1.730"></a><span id="l1.730">   },</span>
<a href="#l1.731"></a><span id="l1.731"> </span>
<a href="#l1.732"></a><span id="l1.732">   /**</span>
<a href="#l1.733"></a><span id="l1.733">    * Go through each of the checked providers, and add the appropriate</span>
<a href="#l1.734"></a><span id="l1.734">    * ToS and privacy links to the disclaimer.</span>
<a href="#l1.735"></a><span id="l1.735">    */</span>
<a href="#l1.736"></a><span id="l1.736">   populateTermsAndPrivacyLinks: function EAP_populateTOSandPrivacyLinks() {</span>
<a href="#l1.737"></a><span id="l1.737">     gLog.info(&quot;Refreshing terms and privacy links&quot;);</span>
<a href="#l1.738"></a><span id="l1.738">     // Empty the Terms of Service and Privacy links placeholder.</span>
<a href="#l1.739"></a><span id="l1.739" class="difflineminus">-    let commentary = $(&quot;.commentary&quot;);</span>
<a href="#l1.740"></a><span id="l1.740" class="difflineminus">-    let placeholder = commentary.find(&quot;.placeholder&quot;);</span>
<a href="#l1.741"></a><span id="l1.741" class="difflineminus">-    placeholder.empty();</span>
<a href="#l1.742"></a><span id="l1.742" class="difflineminus">-</span>
<a href="#l1.743"></a><span id="l1.743" class="difflineminus">-    let selectedProviders = $(&quot;.provider input:checked&quot;);</span>
<a href="#l1.744"></a><span id="l1.744" class="difflineminus">-</span>
<a href="#l1.745"></a><span id="l1.745" class="difflineminus">-    EmailAccountProvisioner.someProvidersChecked = selectedProviders.length &gt; 0;</span>
<a href="#l1.746"></a><span id="l1.746" class="difflineplus">+    let placeholder = document.querySelector(&quot;.commentary .placeholder&quot;);</span>
<a href="#l1.747"></a><span id="l1.747" class="difflineplus">+    placeholder.innerHTML = &quot;&quot;;</span>
<a href="#l1.748"></a><span id="l1.748"> </span>
<a href="#l1.749"></a><span id="l1.749" class="difflineminus">-    let termsAndPrivacyLinks = [];</span>
<a href="#l1.750"></a><span id="l1.750" class="difflineminus">-    selectedProviders.each(function(i, checkbox) {</span>
<a href="#l1.751"></a><span id="l1.751" class="difflineminus">-      let providerId = $(checkbox).val();</span>
<a href="#l1.752"></a><span id="l1.752" class="difflineminus">-      let provider = EmailAccountProvisioner.providers[providerId];</span>
<a href="#l1.753"></a><span id="l1.753" class="difflineminus">-      let providerLinks = $(&quot;&lt;span /&gt;&quot;).text(provider.label + &quot; (&quot;)</span>
<a href="#l1.754"></a><span id="l1.754" class="difflineminus">-        .append($(&quot;&lt;a /&gt;&quot;)</span>
<a href="#l1.755"></a><span id="l1.755" class="difflineminus">-          .attr(&quot;href&quot;, provider.privacy_url)</span>
<a href="#l1.756"></a><span id="l1.756" class="difflineminus">-          .text(stringBundle.get(&quot;privacyPolicy&quot;))</span>
<a href="#l1.757"></a><span id="l1.757" class="difflineminus">-          .addClass(&quot;privacy&quot;).addClass(&quot;external&quot;).addClass(provider.id)</span>
<a href="#l1.758"></a><span id="l1.758" class="difflineminus">-        )</span>
<a href="#l1.759"></a><span id="l1.759" class="difflineminus">-        .append($(&quot;&lt;span /&gt;&quot;).text(stringBundle.get(&quot;sepComma&quot;)))</span>
<a href="#l1.760"></a><span id="l1.760" class="difflineminus">-        .append($(&quot;&lt;a /&gt;&quot;)</span>
<a href="#l1.761"></a><span id="l1.761" class="difflineminus">-          .attr(&quot;href&quot;, provider.tos_url)</span>
<a href="#l1.762"></a><span id="l1.762" class="difflineminus">-          .text(stringBundle.get(&quot;tos&quot;))</span>
<a href="#l1.763"></a><span id="l1.763" class="difflineminus">-          .addClass(&quot;tos&quot;).addClass(&quot;external&quot;).addClass(provider.id)</span>
<a href="#l1.764"></a><span id="l1.764" class="difflineminus">-        ).append($(&quot;&lt;span /&gt;&quot;).text(&quot;)&quot;));</span>
<a href="#l1.765"></a><span id="l1.765" class="difflineminus">-      termsAndPrivacyLinks.push(providerLinks);</span>
<a href="#l1.766"></a><span id="l1.766" class="difflineminus">-    });</span>
<a href="#l1.767"></a><span id="l1.767" class="difflineplus">+    let selectedProviders =</span>
<a href="#l1.768"></a><span id="l1.768" class="difflineplus">+      [...document.querySelectorAll(&quot;.provider input:checked&quot;)];</span>
<a href="#l1.769"></a><span id="l1.769" class="difflineplus">+    let len = selectedProviders.length;</span>
<a href="#l1.770"></a><span id="l1.770"> </span>
<a href="#l1.771"></a><span id="l1.771" class="difflineminus">-    if (termsAndPrivacyLinks.length &lt;= 0) {</span>
<a href="#l1.772"></a><span id="l1.772" class="difflineplus">+    EmailAccountProvisioner.someProvidersChecked = len &gt; 0;</span>
<a href="#l1.773"></a><span id="l1.773" class="difflineplus">+    if (!len) {</span>
<a href="#l1.774"></a><span id="l1.774">       // Something went really wrong - we shouldn't have gotten here. Bail out.</span>
<a href="#l1.775"></a><span id="l1.775">       return;</span>
<a href="#l1.776"></a><span id="l1.776" class="difflineminus">-    } else if (termsAndPrivacyLinks.length == 1) {</span>
<a href="#l1.777"></a><span id="l1.777" class="difflineminus">-      placeholder.append(termsAndPrivacyLinks[0]);</span>
<a href="#l1.778"></a><span id="l1.778" class="difflineminus">-      return;</span>
<a href="#l1.779"></a><span id="l1.779" class="difflineminus">-    } else {</span>
<a href="#l1.780"></a><span id="l1.780" class="difflineminus">-      // Pop off the last terms and privacy links...</span>
<a href="#l1.781"></a><span id="l1.781" class="difflineminus">-      let lastTermsAndPrivacyLink = termsAndPrivacyLinks.pop();</span>
<a href="#l1.782"></a><span id="l1.782" class="difflineminus">-      // Join the remaining terms and privacy links with the comma separator...</span>
<a href="#l1.783"></a><span id="l1.783" class="difflineminus">-      $(termsAndPrivacyLinks).each(function(i, termsAndPrivacyLink) {</span>
<a href="#l1.784"></a><span id="l1.784" class="difflineminus">-        placeholder.append(termsAndPrivacyLink);</span>
<a href="#l1.785"></a><span id="l1.785" class="difflineminus">-        if (i &lt; termsAndPrivacyLinks.length - 1)</span>
<a href="#l1.786"></a><span id="l1.786" class="difflineminus">-          placeholder.append($(&quot;&lt;span /&gt;&quot;).text(stringBundle.get(&quot;sepComma&quot;)));</span>
<a href="#l1.787"></a><span id="l1.787" class="difflineminus">-      });</span>
<a href="#l1.788"></a><span id="l1.788" class="difflineminus">-      placeholder.append($(&quot;&lt;span /&gt;&quot;).text(stringBundle.get(&quot;sepAnd&quot;)));</span>
<a href="#l1.789"></a><span id="l1.789" class="difflineminus">-      placeholder.append(lastTermsAndPrivacyLink);</span>
<a href="#l1.790"></a><span id="l1.790">     }</span>
<a href="#l1.791"></a><span id="l1.791" class="difflineminus">-  },</span>
<a href="#l1.792"></a><span id="l1.792" class="difflineplus">+</span>
<a href="#l1.793"></a><span id="l1.793" class="difflineplus">+    let innerHTML = &quot;&quot;;</span>
<a href="#l1.794"></a><span id="l1.794" class="difflineplus">+    selectedProviders.forEach((checkbox, i) =&gt; {</span>
<a href="#l1.795"></a><span id="l1.795" class="difflineplus">+      let providerId = checkbox.value;</span>
<a href="#l1.796"></a><span id="l1.796" class="difflineplus">+      let provider = EmailAccountProvisioner.providers[providerId];</span>
<a href="#l1.797"></a><span id="l1.797" class="difflineplus">+</span>
<a href="#l1.798"></a><span id="l1.798" class="difflineplus">+      innerHTML += '&lt;span&gt;' + provider.label + ' (&lt;/span&gt;';</span>
<a href="#l1.799"></a><span id="l1.799" class="difflineplus">+      innerHTML += '&lt;a href=&quot;' + provider.privacy_url + '&quot; ';</span>
<a href="#l1.800"></a><span id="l1.800" class="difflineplus">+      innerHTML += 'class=&quot;privary external ' + provider.id + '&quot;&gt;';</span>
<a href="#l1.801"></a><span id="l1.801" class="difflineplus">+      innerHTML += stringBundle.get(&quot;privacyPolicy&quot;) + '&lt;/a&gt;';</span>
<a href="#l1.802"></a><span id="l1.802" class="difflineplus">+</span>
<a href="#l1.803"></a><span id="l1.803" class="difflineplus">+      innerHTML += '&lt;span&gt;' + stringBundle.get(&quot;sepComma&quot;) + '&lt;/span&gt;';</span>
<a href="#l1.804"></a><span id="l1.804"> </span>
<a href="#l1.805"></a><span id="l1.805" class="difflineminus">-  /**</span>
<a href="#l1.806"></a><span id="l1.806" class="difflineminus">-   * Make the search pane a little bit taller, and the existing account</span>
<a href="#l1.807"></a><span id="l1.807" class="difflineminus">-   * pane a little bit shorter.</span>
<a href="#l1.808"></a><span id="l1.808" class="difflineminus">-   */</span>
<a href="#l1.809"></a><span id="l1.809" class="difflineminus">-  expandSearchPane: function() {</span>
<a href="#l1.810"></a><span id="l1.810" class="difflineminus">-    // Don't expand twice.</span>
<a href="#l1.811"></a><span id="l1.811" class="difflineminus">-    if ($(&quot;#existing&quot;).data(&quot;expanded&quot;))</span>
<a href="#l1.812"></a><span id="l1.812" class="difflineminus">-      return;</span>
<a href="#l1.813"></a><span id="l1.813" class="difflineplus">+      innerHTML += '&lt;a href=&quot;' + provider.tos_url + '&quot; ';</span>
<a href="#l1.814"></a><span id="l1.814" class="difflineplus">+      innerHTML += 'class=&quot;tos external ' + provider.id + '&quot;&gt;';</span>
<a href="#l1.815"></a><span id="l1.815" class="difflineplus">+      innerHTML += stringBundle.get('tos') + '&lt;/a&gt;';</span>
<a href="#l1.816"></a><span id="l1.816" class="difflineplus">+</span>
<a href="#l1.817"></a><span id="l1.817" class="difflineplus">+      innerHTML += '&lt;span&gt;)&lt;/span&gt;';</span>
<a href="#l1.818"></a><span id="l1.818"> </span>
<a href="#l1.819"></a><span id="l1.819" class="difflineminus">-    $(&quot;#existing&quot;).animate({&quot;height&quot;: &quot;50px&quot;,</span>
<a href="#l1.820"></a><span id="l1.820" class="difflineminus">-                            &quot;font-size&quot;: &quot;10pt&quot;}, &quot;fast&quot;,</span>
<a href="#l1.821"></a><span id="l1.821" class="difflineminus">-      function() {</span>
<a href="#l1.822"></a><span id="l1.822" class="difflineminus">-        $(&quot;#providers&quot;).fadeIn();</span>
<a href="#l1.823"></a><span id="l1.823" class="difflineminus">-        $(&quot;#content .description&quot;).fadeIn();</span>
<a href="#l1.824"></a><span id="l1.824" class="difflineminus">-        $(&quot;#existing .header&quot;).hide();</span>
<a href="#l1.825"></a><span id="l1.825" class="difflineminus">-        $(&quot;.tinyheader .title&quot;).css({&quot;opacity&quot;: &quot;1.0&quot;}).fadeIn(&quot;fast&quot;);</span>
<a href="#l1.826"></a><span id="l1.826" class="difflineminus">-        $(&quot;#existing&quot;).data(&quot;expanded&quot;, true);</span>
<a href="#l1.827"></a><span id="l1.827" class="difflineminus">-      });</span>
<a href="#l1.828"></a><span id="l1.828" class="difflineplus">+      if (len != 1) {</span>
<a href="#l1.829"></a><span id="l1.829" class="difflineplus">+        if (i &lt; len - 2) {</span>
<a href="#l1.830"></a><span id="l1.830" class="difflineplus">+          innerHTML += '&lt;span&gt;' + stringBundle.get(&quot;sepComma&quot;) + '&lt;/span&gt;';</span>
<a href="#l1.831"></a><span id="l1.831" class="difflineplus">+        } else if (i == len - 2) {</span>
<a href="#l1.832"></a><span id="l1.832" class="difflineplus">+          innerHTML += '&lt;span&gt;' + stringBundle.get(&quot;sepAnd&quot;) + '&lt;/span&gt;';</span>
<a href="#l1.833"></a><span id="l1.833" class="difflineplus">+        }</span>
<a href="#l1.834"></a><span id="l1.834" class="difflineplus">+      }</span>
<a href="#l1.835"></a><span id="l1.835" class="difflineplus">+    });</span>
<a href="#l1.836"></a><span id="l1.836" class="difflineplus">+</span>
<a href="#l1.837"></a><span id="l1.837" class="difflineplus">+    placeholder.innerHTML = innerHTML;</span>
<a href="#l1.838"></a><span id="l1.838">   },</span>
<a href="#l1.839"></a><span id="l1.839"> </span>
<a href="#l1.840"></a><span id="l1.840">   /**</span>
<a href="#l1.841"></a><span id="l1.841">    * Something went wrong during search.  Show a generic error.  In the future,</span>
<a href="#l1.842"></a><span id="l1.842">    * we might want to show something a bit more descriptive.</span>
<a href="#l1.843"></a><span id="l1.843">    */</span>
<a href="#l1.844"></a><span id="l1.844">   showSearchError: function() {</span>
<a href="#l1.845"></a><span id="l1.845" class="difflineminus">-    $(&quot;#notifications&quot;).children().hide();</span>
<a href="#l1.846"></a><span id="l1.846" class="difflineminus">-    $(&quot;#notifications .error&quot;).fadeIn();</span>
<a href="#l1.847"></a><span id="l1.847" class="difflineplus">+    for (let node of document.getElementById(&quot;notifications&quot;).children) {</span>
<a href="#l1.848"></a><span id="l1.848" class="difflineplus">+      node.style.display = &quot;none&quot;;</span>
<a href="#l1.849"></a><span id="l1.849" class="difflineplus">+    }</span>
<a href="#l1.850"></a><span id="l1.850" class="difflineplus">+    for (let node of document.querySelectorAll(&quot;#notifications .error&quot;)) {</span>
<a href="#l1.851"></a><span id="l1.851" class="difflineplus">+      node.style.display = &quot;block&quot;</span>
<a href="#l1.852"></a><span id="l1.852" class="difflineplus">+      node.getBoundingClientRect();</span>
<a href="#l1.853"></a><span id="l1.853" class="difflineplus">+      node.classList.add(&quot;showWithFade&quot;);</span>
<a href="#l1.854"></a><span id="l1.854" class="difflineplus">+    }</span>
<a href="#l1.855"></a><span id="l1.855">   },</span>
<a href="#l1.856"></a><span id="l1.856"> </span>
<a href="#l1.857"></a><span id="l1.857">   /**</span>
<a href="#l1.858"></a><span id="l1.858">    * Once we've received search results from the server, create some</span>
<a href="#l1.859"></a><span id="l1.859">    * elements to display those results, and inject them into the DOM.</span>
<a href="#l1.860"></a><span id="l1.860">    */</span>
<a href="#l1.861"></a><span id="l1.861">   onSearchResults: function(data) {</span>
<a href="#l1.862"></a><span id="l1.862">     gLog.info(&quot;Got back search results&quot;);</span>
<a href="#l1.863"></a><span id="l1.863" class="difflineminus">-    // Expand the search pane if it hasn't been expanded yet.</span>
<a href="#l1.864"></a><span id="l1.864" class="difflineminus">-    EmailAccountProvisioner.expandSearchPane();</span>
<a href="#l1.865"></a><span id="l1.865"> </span>
<a href="#l1.866"></a><span id="l1.866">     // Empty any old results.</span>
<a href="#l1.867"></a><span id="l1.867" class="difflineminus">-    let results = $(&quot;#results&quot;).empty();</span>
<a href="#l1.868"></a><span id="l1.868" class="difflineplus">+    let results = document.getElementById(&quot;results&quot;);</span>
<a href="#l1.869"></a><span id="l1.869" class="difflineplus">+    results.innerHTML = &quot;&quot;;</span>
<a href="#l1.870"></a><span id="l1.870"> </span>
<a href="#l1.871"></a><span id="l1.871">     if (!data || !data.length) {</span>
<a href="#l1.872"></a><span id="l1.872">       // If we've gotten back nonsense, display the generic</span>
<a href="#l1.873"></a><span id="l1.873">       // error message, and bail out.</span>
<a href="#l1.874"></a><span id="l1.874">       gLog.error(&quot;We got nothing back from the server for search results!&quot;);</span>
<a href="#l1.875"></a><span id="l1.875">       EmailAccountProvisioner.showSearchError();</span>
<a href="#l1.876"></a><span id="l1.876">       return;</span>
<a href="#l1.877"></a><span id="l1.877">     }</span>
<a href="#l1.878"></a><span id="l1.878"> </span>
<a href="#l1.879"></a><span id="l1.879">     // Get a list of the providers that the user checked - we'll</span>
<a href="#l1.880"></a><span id="l1.880">     // check against these to make sure the server didn't send any</span>
<a href="#l1.881"></a><span id="l1.881">     // back from a provider that the user did not select.</span>
<a href="#l1.882"></a><span id="l1.882" class="difflineminus">-    let selectedProviders = $(&quot;.provider input:checked&quot;).map(function() {</span>
<a href="#l1.883"></a><span id="l1.883" class="difflineminus">-      return $(this).val();</span>
<a href="#l1.884"></a><span id="l1.884" class="difflineminus">-    });</span>
<a href="#l1.885"></a><span id="l1.885" class="difflineplus">+    let selectedProviderList =</span>
<a href="#l1.886"></a><span id="l1.886" class="difflineplus">+      [...document.querySelectorAll(&quot;.provider input:checked&quot;)];</span>
<a href="#l1.887"></a><span id="l1.887" class="difflineplus">+    let selectedProviders = selectedProviderList.map(node =&gt; node.value);</span>
<a href="#l1.888"></a><span id="l1.888" class="difflineplus">+    gLog.info(selectedProviders.length + &quot; selected providers.&quot;);</span>
<a href="#l1.889"></a><span id="l1.889"> </span>
<a href="#l1.890"></a><span id="l1.890">     // Filter out any results that don't match our requirements...</span>
<a href="#l1.891"></a><span id="l1.891">     let returnedProviders = data.filter(function(aResult) {</span>
<a href="#l1.892"></a><span id="l1.892">       // We require that the search succeeded for a provider, that we</span>
<a href="#l1.893"></a><span id="l1.893">       // got at least one result, and that the provider is actually in</span>
<a href="#l1.894"></a><span id="l1.894">       // the list of providers that we care about.</span>
<a href="#l1.895"></a><span id="l1.895">       let providerInList = (aResult.provider in EmailAccountProvisioner.providers);</span>
<a href="#l1.896"></a><span id="l1.896"> </span>
<a href="#l1.897"></a><span id="l1.897">       if (!providerInList)</span>
<a href="#l1.898"></a><span id="l1.898">         gLog.error(&quot;Got a result back for a provider that was not &quot;</span>
<a href="#l1.899"></a><span id="l1.899">                    + &quot;in the original providerList: &quot; + aResult.provider);</span>
<a href="#l1.900"></a><span id="l1.900"> </span>
<a href="#l1.901"></a><span id="l1.901" class="difflineminus">-      let providerSelected = $.inArray(aResult.provider, selectedProviders) != -1;</span>
<a href="#l1.902"></a><span id="l1.902" class="difflineplus">+      let providerSelected = selectedProviders.indexOf(aResult.provider) != -1;</span>
<a href="#l1.903"></a><span id="l1.903"> </span>
<a href="#l1.904"></a><span id="l1.904">       if (!providerSelected)</span>
<a href="#l1.905"></a><span id="l1.905">         gLog.error(&quot;Got a result back for a provider that the user did &quot;</span>
<a href="#l1.906"></a><span id="l1.906">                    + &quot;not select: &quot; + aResult.provider);</span>
<a href="#l1.907"></a><span id="l1.907"> </span>
<a href="#l1.908"></a><span id="l1.908">       return (aResult.succeeded</span>
<a href="#l1.909"></a><span id="l1.909">               &amp;&amp; aResult.addresses.length &gt; 0</span>
<a href="#l1.910"></a><span id="l1.910">               &amp;&amp; providerInList</span>
<a href="#l1.911"></a><span id="l1.911" class="difflineat">@@ -728,31 +813,35 @@ var EmailAccountProvisioner = {</span>
<a href="#l1.912"></a><span id="l1.912">     if (returnedProviders.length == 0) {</span>
<a href="#l1.913"></a><span id="l1.913">       gLog.info(&quot;There weren't any results for the selected providers.&quot;);</span>
<a href="#l1.914"></a><span id="l1.914">       // Display the generic error message, and bail out.</span>
<a href="#l1.915"></a><span id="l1.915">       EmailAccountProvisioner.showSearchError();</span>
<a href="#l1.916"></a><span id="l1.916">       return;</span>
<a href="#l1.917"></a><span id="l1.917">     }</span>
<a href="#l1.918"></a><span id="l1.918"> </span>
<a href="#l1.919"></a><span id="l1.919">     for (let provider of returnedProviders) {</span>
<a href="#l1.920"></a><span id="l1.920" class="difflineminus">-      let group = $(&quot;&lt;div class='resultsGroup'&gt;&lt;/div&gt;&quot;);</span>
<a href="#l1.921"></a><span id="l1.921" class="difflineminus">-      let header = $(&quot;#resultsHeader&quot;)</span>
<a href="#l1.922"></a><span id="l1.922" class="difflineminus">-                   .clone()</span>
<a href="#l1.923"></a><span id="l1.923" class="difflineminus">-                   .removeClass(&quot;displayNone&quot;)</span>
<a href="#l1.924"></a><span id="l1.924" class="difflineminus">-                   .addClass(&quot;selection&quot;);</span>
<a href="#l1.925"></a><span id="l1.925" class="difflineplus">+      let group = document.createElement(&quot;div&quot;);</span>
<a href="#l1.926"></a><span id="l1.926" class="difflineplus">+      group.className = &quot;resultsGroup&quot;;</span>
<a href="#l1.927"></a><span id="l1.927" class="difflineplus">+</span>
<a href="#l1.928"></a><span id="l1.928" class="difflineplus">+      let header = document.getElementById(&quot;resultsHeader&quot;).cloneNode(true);</span>
<a href="#l1.929"></a><span id="l1.929" class="difflineplus">+      header.classList.remove(&quot;displayNone&quot;);</span>
<a href="#l1.930"></a><span id="l1.930" class="difflineplus">+      header.classList.add(&quot;selection&quot;);</span>
<a href="#l1.931"></a><span id="l1.931"> </span>
<a href="#l1.932"></a><span id="l1.932" class="difflineminus">-      header.children(&quot;.provider&quot;)</span>
<a href="#l1.933"></a><span id="l1.933" class="difflineminus">-            .text(EmailAccountProvisioner.providers[provider.provider].label);</span>
<a href="#l1.934"></a><span id="l1.934" class="difflineplus">+      let providerLabel =</span>
<a href="#l1.935"></a><span id="l1.935" class="difflineplus">+        document.createTextNode(EmailAccountProvisioner.providers[provider.provider].label);</span>
<a href="#l1.936"></a><span id="l1.936" class="difflineplus">+      header.querySelector(&quot;.provider&quot;).appendChild(providerLabel);</span>
<a href="#l1.937"></a><span id="l1.937"> </span>
<a href="#l1.938"></a><span id="l1.938" class="difflineplus">+      let providerPrice;</span>
<a href="#l1.939"></a><span id="l1.939">       if (provider.price &amp;&amp; provider.price != &quot;0&quot;)</span>
<a href="#l1.940"></a><span id="l1.940" class="difflineminus">-        header.children(&quot;.price&quot;).text(provider.price);</span>
<a href="#l1.941"></a><span id="l1.941" class="difflineplus">+        providerPrice = document.createTextNode(provider.price);</span>
<a href="#l1.942"></a><span id="l1.942">       else</span>
<a href="#l1.943"></a><span id="l1.943" class="difflineminus">-        header.children(&quot;.price&quot;).text(stringBundle.get(&quot;free&quot;));</span>
<a href="#l1.944"></a><span id="l1.944" class="difflineplus">+        providerPrice = document.createTextNode(stringBundle.get(&quot;free&quot;));</span>
<a href="#l1.945"></a><span id="l1.945" class="difflineplus">+      header.querySelector(&quot;.price&quot;).appendChild(providerPrice);</span>
<a href="#l1.946"></a><span id="l1.946"> </span>
<a href="#l1.947"></a><span id="l1.947" class="difflineminus">-      group.append(header);</span>
<a href="#l1.948"></a><span id="l1.948" class="difflineplus">+      group.appendChild(header);</span>
<a href="#l1.949"></a><span id="l1.949"> </span>
<a href="#l1.950"></a><span id="l1.950">       let renderedAddresses = 0;</span>
<a href="#l1.951"></a><span id="l1.951">       let addrIndex = 0;</span>
<a href="#l1.952"></a><span id="l1.952">       for (let address of provider.addresses) {</span>
<a href="#l1.953"></a><span id="l1.953">         addrIndex++;</span>
<a href="#l1.954"></a><span id="l1.954"> </span>
<a href="#l1.955"></a><span id="l1.955">         // Figure out the price to display on the address button, as so:</span>
<a href="#l1.956"></a><span id="l1.956">         // If there is a per-address price of &gt; 0, use that.</span>
<a href="#l1.957"></a><span id="l1.957" class="difflineat">@@ -772,71 +861,93 @@ var EmailAccountProvisioner = {</span>
<a href="#l1.958"></a><span id="l1.958"> </span>
<a href="#l1.959"></a><span id="l1.959">         let templateElement = document.querySelector(&quot;#result_tmpl&quot;);</span>
<a href="#l1.960"></a><span id="l1.960">         let result = document.importNode(templateElement.content, true).children[0];</span>
<a href="#l1.961"></a><span id="l1.961">         result.innerHTML =</span>
<a href="#l1.962"></a><span id="l1.962">           result.innerHTML.replace(/\${address}/g,</span>
<a href="#l1.963"></a><span id="l1.963">                                    address.address ? address.address : address)</span>
<a href="#l1.964"></a><span id="l1.964">                           .replace(/\${priceStr}/g, priceStr);</span>
<a href="#l1.965"></a><span id="l1.965"> </span>
<a href="#l1.966"></a><span id="l1.966" class="difflineminus">-        group.append(result);</span>
<a href="#l1.967"></a><span id="l1.967" class="difflineplus">+        group.appendChild(result);</span>
<a href="#l1.968"></a><span id="l1.968">         // Keep a count of the rendered addresses for the &quot;More&quot; buttons, etc.</span>
<a href="#l1.969"></a><span id="l1.969">         renderedAddresses++;</span>
<a href="#l1.970"></a><span id="l1.970"> </span>
<a href="#l1.971"></a><span id="l1.971" class="difflineminus">-        if (addrIndex &gt;= MAX_SMALL_ADDRESSES) {</span>
<a href="#l1.972"></a><span id="l1.972" class="difflineplus">+        if (addrIndex &gt; MAX_SMALL_ADDRESSES) {</span>
<a href="#l1.973"></a><span id="l1.973">           result.classList.add(&quot;extra&quot;);</span>
<a href="#l1.974"></a><span id="l1.974" class="difflineminus">-          result.style.display = &quot;none&quot;;</span>
<a href="#l1.975"></a><span id="l1.975" class="difflineplus">+          for (let address of result.querySelectorAll(&quot;.address&quot;)) {</span>
<a href="#l1.976"></a><span id="l1.976" class="difflineplus">+            address.classList.add(&quot;hideWithFade&quot;);</span>
<a href="#l1.977"></a><span id="l1.977" class="difflineplus">+          }</span>
<a href="#l1.978"></a><span id="l1.978" class="difflineplus">+          result.classList.add(&quot;slideUp&quot;);</span>
<a href="#l1.979"></a><span id="l1.979">         }</span>
<a href="#l1.980"></a><span id="l1.980">       }</span>
<a href="#l1.981"></a><span id="l1.981" class="difflineplus">+      gLog.info(&quot;Added &quot; + renderedAddresses + &quot; addresses, showing at most &quot; +</span>
<a href="#l1.982"></a><span id="l1.982" class="difflineplus">+        MAX_SMALL_ADDRESSES + &quot;.&quot;);</span>
<a href="#l1.983"></a><span id="l1.983"> </span>
<a href="#l1.984"></a><span id="l1.984">       if (renderedAddresses &gt; MAX_SMALL_ADDRESSES) {</span>
<a href="#l1.985"></a><span id="l1.985">         let more = renderedAddresses - MAX_SMALL_ADDRESSES;</span>
<a href="#l1.986"></a><span id="l1.986">         let moreStr = PluralForm.get(more, stringBundle.get(&quot;moreOptions&quot;)).replace(&quot;#1&quot;, more);</span>
<a href="#l1.987"></a><span id="l1.987" class="difflineminus">-        let last = group.children(&quot;.row:nth-child(&quot; + (MAX_SMALL_ADDRESSES + 1) + &quot;)&quot;);</span>
<a href="#l1.988"></a><span id="l1.988" class="difflineminus">-        last.append('&lt;div class=&quot;more&quot;&gt;' + moreStr + '&lt;/div&gt;');</span>
<a href="#l1.989"></a><span id="l1.989" class="difflineplus">+        let last = group.querySelector(&quot;.row:nth-child(&quot; + (MAX_SMALL_ADDRESSES + 1) + &quot;)&quot;);</span>
<a href="#l1.990"></a><span id="l1.990" class="difflineplus">+        last.innerHTML += '&lt;div class=&quot;more&quot;&gt;' + moreStr + '&lt;/div&gt;';</span>
<a href="#l1.991"></a><span id="l1.991" class="difflineplus">+      }</span>
<a href="#l1.992"></a><span id="l1.992" class="difflineplus">+      for (let node of group.querySelectorAll(&quot;button.create&quot;)) {</span>
<a href="#l1.993"></a><span id="l1.993" class="difflineplus">+        node.dataset.provider = provider.provider;</span>
<a href="#l1.994"></a><span id="l1.994">       }</span>
<a href="#l1.995"></a><span id="l1.995" class="difflineminus">-      group.find(&quot;button.create&quot;).data(&quot;provider&quot;, provider.provider);</span>
<a href="#l1.996"></a><span id="l1.996" class="difflineminus">-      group.append($(&quot;#resultsFooter&quot;).clone().removeClass(&quot;displayNone&quot;));</span>
<a href="#l1.997"></a><span id="l1.997" class="difflineminus">-      results.append(group);</span>
<a href="#l1.998"></a><span id="l1.998" class="difflineplus">+</span>
<a href="#l1.999"></a><span id="l1.999" class="difflineplus">+      // There doesn't seem to be a #resultsFooter anywhere.</span>
<a href="#l1.1000"></a><span id="l1.1000" class="difflineplus">+      // let footer = document.getElementById(&quot;resultsFooter&quot;).cloneNode(true);</span>
<a href="#l1.1001"></a><span id="l1.1001" class="difflineplus">+      // footer.classList.remove(&quot;displayNone&quot;);</span>
<a href="#l1.1002"></a><span id="l1.1002" class="difflineplus">+      // group.append(footer);</span>
<a href="#l1.1003"></a><span id="l1.1003" class="difflineplus">+</span>
<a href="#l1.1004"></a><span id="l1.1004" class="difflineplus">+      results.appendChild(group);</span>
<a href="#l1.1005"></a><span id="l1.1005">     }</span>
<a href="#l1.1006"></a><span id="l1.1006"> </span>
<a href="#l1.1007"></a><span id="l1.1007" class="difflineminus">-    $(&quot;#notifications&quot;).children().hide();</span>
<a href="#l1.1008"></a><span id="l1.1008" class="difflineminus">-    $(&quot;#notifications .success&quot;).show();</span>
<a href="#l1.1009"></a><span id="l1.1009" class="difflineminus">-</span>
<a href="#l1.1010"></a><span id="l1.1010" class="difflineplus">+    for (let node of document.getElementById(&quot;notifications&quot;).children) {</span>
<a href="#l1.1011"></a><span id="l1.1011" class="difflineplus">+      if (node.classList.contains(&quot;success&quot;)) {</span>
<a href="#l1.1012"></a><span id="l1.1012" class="difflineplus">+        node.style.display = &quot;block&quot;;</span>
<a href="#l1.1013"></a><span id="l1.1013" class="difflineplus">+      } else {</span>
<a href="#l1.1014"></a><span id="l1.1014" class="difflineplus">+        node.style.display = &quot;none&quot;;</span>
<a href="#l1.1015"></a><span id="l1.1015" class="difflineplus">+      }</span>
<a href="#l1.1016"></a><span id="l1.1016" class="difflineplus">+    }</span>
<a href="#l1.1017"></a><span id="l1.1017">     for (let provider of data) {</span>
<a href="#l1.1018"></a><span id="l1.1018">       delete provider.succeeded;</span>
<a href="#l1.1019"></a><span id="l1.1019">       delete provider.addresses;</span>
<a href="#l1.1020"></a><span id="l1.1020">       delete provider.price;</span>
<a href="#l1.1021"></a><span id="l1.1021">       storedData[provider.provider] = provider;</span>
<a href="#l1.1022"></a><span id="l1.1022">     }</span>
<a href="#l1.1023"></a><span id="l1.1023">   },</span>
<a href="#l1.1024"></a><span id="l1.1024"> </span>
<a href="#l1.1025"></a><span id="l1.1025">   /**</span>
<a href="#l1.1026"></a><span id="l1.1026">    * If we cannot retrieve the provider list from the server, display a</span>
<a href="#l1.1027"></a><span id="l1.1027">    * message about connection problems, and disable the search fields.</span>
<a href="#l1.1028"></a><span id="l1.1028">    */</span>
<a href="#l1.1029"></a><span id="l1.1029">   beOffline: function EAP_beOffline() {</span>
<a href="#l1.1030"></a><span id="l1.1030">     let offlineMsg = stringBundle.get(&quot;cannotConnect&quot;);</span>
<a href="#l1.1031"></a><span id="l1.1031" class="difflineminus">-    $('#cannotConnectMessage').text(offlineMsg).show();</span>
<a href="#l1.1032"></a><span id="l1.1032" class="difflineplus">+    let element = document.getElementById(&quot;cannotConnectMessage&quot;);</span>
<a href="#l1.1033"></a><span id="l1.1033" class="difflineplus">+    element.appendChild(document.createTextNode(offlineMsg));</span>
<a href="#l1.1034"></a><span id="l1.1034" class="difflineplus">+    element.style.display = &quot;block&quot;;</span>
<a href="#l1.1035"></a><span id="l1.1035" class="difflineplus">+    element.style.opacity = 1;</span>
<a href="#l1.1036"></a><span id="l1.1036">     this.searchEnabled(false);</span>
<a href="#l1.1037"></a><span id="l1.1037">     gLog.info(&quot;Email Account Provisioner is in offline mode.&quot;);</span>
<a href="#l1.1038"></a><span id="l1.1038">   },</span>
<a href="#l1.1039"></a><span id="l1.1039"> </span>
<a href="#l1.1040"></a><span id="l1.1040">   /**</span>
<a href="#l1.1041"></a><span id="l1.1041">    * If we're suddenly able to get the provider list, hide the connection</span>
<a href="#l1.1042"></a><span id="l1.1042">    * error message and re-enable the search fields.</span>
<a href="#l1.1043"></a><span id="l1.1043">    */</span>
<a href="#l1.1044"></a><span id="l1.1044">   beOnline: function EAP_beOnline() {</span>
<a href="#l1.1045"></a><span id="l1.1045" class="difflineminus">-    $('#cannotConnectMessage').hide().text('');</span>
<a href="#l1.1046"></a><span id="l1.1046" class="difflineplus">+    let element = document.getElementById(&quot;cannotConnectMessage&quot;);</span>
<a href="#l1.1047"></a><span id="l1.1047" class="difflineplus">+    element.style.display = &quot;none&quot;;</span>
<a href="#l1.1048"></a><span id="l1.1048" class="difflineplus">+    element.innerHTML = &quot;&quot;;</span>
<a href="#l1.1049"></a><span id="l1.1049">     this.searchEnabled(true);</span>
<a href="#l1.1050"></a><span id="l1.1050">     gLog.info(&quot;Email Account Provisioner is in online mode.&quot;);</span>
<a href="#l1.1051"></a><span id="l1.1051">   }</span>
<a href="#l1.1052"></a><span id="l1.1052"> }</span>
<a href="#l1.1053"></a><span id="l1.1053"> </span>
<a href="#l1.1054"></a><span id="l1.1054"> </span>
<a href="#l1.1055"></a><span id="l1.1055"> XPCOMUtils.defineLazyGetter(EmailAccountProvisioner, &quot;storage&quot;, function() {</span>
<a href="#l1.1056"></a><span id="l1.1056">   return getLocalStorage(&quot;accountProvisioner&quot;);</span>
<a href="#l1.1057"></a><span id="l1.1057"> });</span>
<a href="#l1.1058"></a><span id="l1.1058"> </span>
<a href="#l1.1059"></a><span id="l1.1059"> window.addEventListener(&quot;online&quot;,</span>
<a href="#l1.1060"></a><span id="l1.1060">                         EmailAccountProvisioner.tryToPopulateProviderList);</span>
<a href="#l1.1061"></a><span id="l1.1061"> </span>
<a href="#l1.1062"></a><span id="l1.1062" class="difflineminus">-$(EmailAccountProvisioner.init);</span>
<a href="#l1.1063"></a><span id="l1.1063" class="difflineplus">+document.addEventListener(&quot;DOMContentLoaded&quot;,</span>
<a href="#l1.1064"></a><span id="l1.1064" class="difflineplus">+                          EmailAccountProvisioner.init);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/newmailaccount/content/accountProvisioner.xhtml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/newmailaccount/content/accountProvisioner.xhtml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -16,22 +16,16 @@</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">   &lt;title&gt;&amp;window.title;&lt;/title&gt;</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">   &lt;link rel=&quot;stylesheet&quot;</span>
<a href="#l2.8"></a><span id="l2.8">         type=&quot;text/css&quot;</span>
<a href="#l2.9"></a><span id="l2.9">         href=&quot;chrome://messenger/skin/newmailaccount/accountProvisioner.css&quot; /&gt;</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">   &lt;script type=&quot;text/javascript;version=1.8&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-          src=&quot;chrome://messenger/content/jquery.js&quot;&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-  &lt;/script&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-  &lt;script type=&quot;text/javascript;version=1.8&quot;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-          src=&quot;chrome://messenger/content/jquery-ui.js&quot;&gt;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-  &lt;/script&gt;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-  &lt;script type=&quot;text/javascript;version=1.8&quot;</span>
<a href="#l2.18"></a><span id="l2.18">           src=&quot;chrome://messenger/content/accountcreation/util.js&quot;&gt;</span>
<a href="#l2.19"></a><span id="l2.19">   &lt;/script&gt;</span>
<a href="#l2.20"></a><span id="l2.20">   &lt;script type=&quot;text/javascript;version=1.8&quot;</span>
<a href="#l2.21"></a><span id="l2.21">           src=&quot;chrome://messenger/content/accountcreation/accountConfig.js&quot;&gt;</span>
<a href="#l2.22"></a><span id="l2.22">   &lt;/script&gt;</span>
<a href="#l2.23"></a><span id="l2.23">   &lt;script type=&quot;text/javascript;version=1.8&quot;</span>
<a href="#l2.24"></a><span id="l2.24">           src=&quot;chrome://messenger/content/accountcreation/sanitizeDatatypes.js&quot;&gt;</span>
<a href="#l2.25"></a><span id="l2.25">   &lt;/script&gt;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineat">@@ -150,18 +144,18 @@</span>
<a href="#l2.27"></a><span id="l2.27">     &lt;/div&gt;</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29">     &lt;button id=&quot;closeWindow&quot; class=&quot;close&quot;&gt;&amp;successful.close;&lt;/button&gt;</span>
<a href="#l2.30"></a><span id="l2.30">   &lt;/div&gt;</span>
<a href="#l2.31"></a><span id="l2.31"> </span>
<a href="#l2.32"></a><span id="l2.32">   &lt;template id=&quot;result_tmpl&quot;&gt;</span>
<a href="#l2.33"></a><span id="l2.33">     &lt;div class=&quot;hbox row selection&quot;&gt;</span>
<a href="#l2.34"></a><span id="l2.34">       &lt;div class=&quot;boxFlex address&quot;&gt;${address}&lt;/div&gt;</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-      &lt;div class=&quot;pricing&quot;&gt;</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-        &lt;button class=&quot;create&quot;</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+      &lt;div class=&quot;pricing hideWithFade&quot;&gt;</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+        &lt;button class=&quot;create&quot; disabled=&quot;true&quot;</span>
<a href="#l2.39"></a><span id="l2.39">           address=&quot;${address}&quot;&gt;${priceStr}&lt;/button&gt;</span>
<a href="#l2.40"></a><span id="l2.40">         &lt;span class=&quot;create&quot;</span>
<a href="#l2.41"></a><span id="l2.41">           address=&quot;${address}&quot;&gt;${priceStr}&lt;/span&gt;</span>
<a href="#l2.42"></a><span id="l2.42">       &lt;/div&gt;</span>
<a href="#l2.43"></a><span id="l2.43">     &lt;/div&gt;</span>
<a href="#l2.44"></a><span id="l2.44">   &lt;/template&gt;</span>
<a href="#l2.45"></a><span id="l2.45"> </span>
<a href="#l2.46"></a><span id="l2.46"> &lt;/body&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/newmailaccount/accountProvisioner.dtd</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/newmailaccount/accountProvisioner.dtd</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.5"></a><span id="l3.5">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.6"></a><span id="l3.6">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> &lt;!ENTITY window.title &quot;Welcome to &amp;brandShortName;&quot;&gt;</span>
<a href="#l3.9"></a><span id="l3.9"> &lt;!ENTITY header2.label &quot;Would you like a new email address?&quot;&gt;</span>
<a href="#l3.10"></a><span id="l3.10"> &lt;!ENTITY other.languages &quot;We are only displaying the providers offering addresses in your area.  Click here to show all providers.&quot;&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> &lt;!ENTITY error.line1 &quot;Sorry, we could not find any suggested email addresses.&quot;&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-&lt;!ENTITY error.line2 &quot;You try can search for nicknames or any other term to find more emails&quot;&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+&lt;!ENTITY error.line2 &quot;You can try to search for nicknames or any other term to find more emails.&quot;&gt;</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> &lt;!-- LOCALIZATION NOTE(error.suggest.before, error.suggest.middle, error.suggest.after):</span>
<a href="#l3.16"></a><span id="l3.16">      error.suggest.before, error.suggest.middle, and error.suggest.after all go into</span>
<a href="#l3.17"></a><span id="l3.17">      one line with error.suggest.middle that links to a site which provides download</span>
<a href="#l3.18"></a><span id="l3.18">      of free account alternatives. --&gt;</span>
<a href="#l3.19"></a><span id="l3.19"> &lt;!ENTITY error.suggest.before &quot;Also you might try one of the &quot;&gt;</span>
<a href="#l3.20"></a><span id="l3.20"> &lt;!ENTITY error.suggest.middle &quot;free email account alternatives&quot;&gt;</span>
<a href="#l3.21"></a><span id="l3.21"> &lt;!ENTITY error.suggest.after &quot;.&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/themes/shared/mail/accountProvisioner.css</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/themes/shared/mail/accountProvisioner.css</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -66,16 +66,25 @@ input[type=&quot;submit&quot;][disabled=&quot;true&quot;], i</span>
<a href="#l4.4"></a><span id="l4.4">   display: none;</span>
<a href="#l4.5"></a><span id="l4.5"> }</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> #instructions {</span>
<a href="#l4.8"></a><span id="l4.8">   font-size: smaller;</span>
<a href="#l4.9"></a><span id="l4.9">   color: #444;</span>
<a href="#l4.10"></a><span id="l4.10">   margin-bottom: 19px;</span>
<a href="#l4.11"></a><span id="l4.11">   margin-top: 6px;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+  max-height: 80px;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  transition: all 0.4s;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+}</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+#instructions.hide {</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+  max-height: 0;</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+  margin: 0;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+  opacity: 0;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+  pointer-events: none;</span>
<a href="#l4.21"></a><span id="l4.21"> }</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23"> #content .description {</span>
<a href="#l4.24"></a><span id="l4.24">   font-size: smaller;</span>
<a href="#l4.25"></a><span id="l4.25">   color: gray;</span>
<a href="#l4.26"></a><span id="l4.26"> }</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28"> .header .commentary {</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineat">@@ -87,26 +96,29 @@ input[type=&quot;submit&quot;][disabled=&quot;true&quot;], i</span>
<a href="#l4.30"></a><span id="l4.30">   list-style-type: none;</span>
<a href="#l4.31"></a><span id="l4.31">   padding: 0;</span>
<a href="#l4.32"></a><span id="l4.32">   margin: 0;</span>
<a href="#l4.33"></a><span id="l4.33"> }</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35"> #providers .icon {</span>
<a href="#l4.36"></a><span id="l4.36">   margin-left: 5px;</span>
<a href="#l4.37"></a><span id="l4.37">   margin-right: 5px;</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+  min-width: 16px;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+  max-width: 16px;</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+  max-height: 16px;</span>
<a href="#l4.41"></a><span id="l4.41">   vertical-align: middle;</span>
<a href="#l4.42"></a><span id="l4.42"> }</span>
<a href="#l4.43"></a><span id="l4.43"> </span>
<a href="#l4.44"></a><span id="l4.44"> #providers .provider {</span>
<a href="#l4.45"></a><span id="l4.45">   width: 280px;</span>
<a href="#l4.46"></a><span id="l4.46"> }</span>
<a href="#l4.47"></a><span id="l4.47"> </span>
<a href="#l4.48"></a><span id="l4.48"> #providers .providerLabel {</span>
<a href="#l4.49"></a><span id="l4.49">   vertical-align: top;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-  width: 240px;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+  width: 240px; /* as #providers.provider, minus space for icon and checkbox */</span>
<a href="#l4.52"></a><span id="l4.52">   display: inline-block;</span>
<a href="#l4.53"></a><span id="l4.53">   word-wrap: break-word;</span>
<a href="#l4.54"></a><span id="l4.54"> }</span>
<a href="#l4.55"></a><span id="l4.55"> </span>
<a href="#l4.56"></a><span id="l4.56"> #providers input[type=&quot;checkbox&quot;] {</span>
<a href="#l4.57"></a><span id="l4.57">   vertical-align: middle;</span>
<a href="#l4.58"></a><span id="l4.58"> }</span>
<a href="#l4.59"></a><span id="l4.59"> </span>
<a href="#l4.60"></a><span id="l4.60" class="difflineat">@@ -117,16 +129,20 @@ input[type=&quot;submit&quot;][disabled=&quot;true&quot;], i</span>
<a href="#l4.61"></a><span id="l4.61"> </span>
<a href="#l4.62"></a><span id="l4.62"> #otherLangDesc {</span>
<a href="#l4.63"></a><span id="l4.63">   text-decoration: underline;</span>
<a href="#l4.64"></a><span id="l4.64">   cursor: pointer;</span>
<a href="#l4.65"></a><span id="l4.65">   font-size: x-small;</span>
<a href="#l4.66"></a><span id="l4.66">   margin-top: 9px;</span>
<a href="#l4.67"></a><span id="l4.67"> }</span>
<a href="#l4.68"></a><span id="l4.68"> </span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+.otherLanguage {</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+  opacity: 0;</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+}</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+</span>
<a href="#l4.73"></a><span id="l4.73"> /* External things are links that open in a browser, so underline them. */</span>
<a href="#l4.74"></a><span id="l4.74"> .external {</span>
<a href="#l4.75"></a><span id="l4.75">   text-decoration: underline;</span>
<a href="#l4.76"></a><span id="l4.76"> }</span>
<a href="#l4.77"></a><span id="l4.77"> </span>
<a href="#l4.78"></a><span id="l4.78"> #content,</span>
<a href="#l4.79"></a><span id="l4.79"> #existing {</span>
<a href="#l4.80"></a><span id="l4.80">   background-color: rgba(255,255,255,0.9);</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineat">@@ -202,18 +218,18 @@ input[type=&quot;submit&quot;].search {</span>
<a href="#l4.82"></a><span id="l4.82">   margin-left: auto;</span>
<a href="#l4.83"></a><span id="l4.83">   margin-right: auto;</span>
<a href="#l4.84"></a><span id="l4.84">   margin-top: 25px;</span>
<a href="#l4.85"></a><span id="l4.85">   margin-bottom: 25px;</span>
<a href="#l4.86"></a><span id="l4.86">   display: block;</span>
<a href="#l4.87"></a><span id="l4.87"> }</span>
<a href="#l4.88"></a><span id="l4.88"> </span>
<a href="#l4.89"></a><span id="l4.89"> .error {</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+  opacity: 0;</span>
<a href="#l4.91"></a><span id="l4.91">   color: red;</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-  display: block;</span>
<a href="#l4.93"></a><span id="l4.93"> }</span>
<a href="#l4.94"></a><span id="l4.94"> </span>
<a href="#l4.95"></a><span id="l4.95"> .success .title {</span>
<a href="#l4.96"></a><span id="l4.96">   color: #333;</span>
<a href="#l4.97"></a><span id="l4.97"> }</span>
<a href="#l4.98"></a><span id="l4.98"> </span>
<a href="#l4.99"></a><span id="l4.99"> #FirstAndLastName {</span>
<a href="#l4.100"></a><span id="l4.100">   font-weight: bold;</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineat">@@ -234,19 +250,22 @@ input[type=&quot;submit&quot;].search {</span>
<a href="#l4.102"></a><span id="l4.102"> #results .provider {</span>
<a href="#l4.103"></a><span id="l4.103">   font-weight: bold;</span>
<a href="#l4.104"></a><span id="l4.104"> }</span>
<a href="#l4.105"></a><span id="l4.105"> </span>
<a href="#l4.106"></a><span id="l4.106"> #results .row {</span>
<a href="#l4.107"></a><span id="l4.107">   width: 100%;</span>
<a href="#l4.108"></a><span id="l4.108">   padding: 7px;</span>
<a href="#l4.109"></a><span id="l4.109">   background-color: #fff;</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineminus">-  -moz-box-align: center;</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineminus">-  -moz-box-pack: center;</span>
<a href="#l4.112"></a><span id="l4.112">   border-bottom: 1px solid #ccc;</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+  align-content: center;</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineplus">+  align-items: center;</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineplus">+  max-height: 100px;</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineplus">+  overflow-y: hidden;</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineplus">+  transition: all 0.4s;</span>
<a href="#l4.118"></a><span id="l4.118"> }</span>
<a href="#l4.119"></a><span id="l4.119"> </span>
<a href="#l4.120"></a><span id="l4.120"> #results :-moz-any(div.selection) {</span>
<a href="#l4.121"></a><span id="l4.121">   cursor: pointer;</span>
<a href="#l4.122"></a><span id="l4.122"> }</span>
<a href="#l4.123"></a><span id="l4.123"> </span>
<a href="#l4.124"></a><span id="l4.124"> #results .row:last-child {</span>
<a href="#l4.125"></a><span id="l4.125">   border-bottom: none;</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineat">@@ -259,20 +278,16 @@ input[type=&quot;submit&quot;].search {</span>
<a href="#l4.127"></a><span id="l4.127"> #results .row.th:hover {</span>
<a href="#l4.128"></a><span id="l4.128">   background-color: #f2f2f2;</span>
<a href="#l4.129"></a><span id="l4.129"> }</span>
<a href="#l4.130"></a><span id="l4.130"> </span>
<a href="#l4.131"></a><span id="l4.131"> #results .row.th {</span>
<a href="#l4.132"></a><span id="l4.132">   background-color: #f2f2f2;</span>
<a href="#l4.133"></a><span id="l4.133"> }</span>
<a href="#l4.134"></a><span id="l4.134"> </span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-#results .row.more {</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineminus">-  text-align: right;</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineminus">-}</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineminus">-</span>
<a href="#l4.139"></a><span id="l4.139"> #results:not(.showAll) .noUserLang {</span>
<a href="#l4.140"></a><span id="l4.140">   display: none;</span>
<a href="#l4.141"></a><span id="l4.141"> }</span>
<a href="#l4.142"></a><span id="l4.142"> .footer {</span>
<a href="#l4.143"></a><span id="l4.143">   margin-bottom: 10px;</span>
<a href="#l4.144"></a><span id="l4.144"> }</span>
<a href="#l4.145"></a><span id="l4.145"> </span>
<a href="#l4.146"></a><span id="l4.146"> .row .address.th {</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineat">@@ -287,37 +302,41 @@ input[type=&quot;submit&quot;].search {</span>
<a href="#l4.148"></a><span id="l4.148"> </span>
<a href="#l4.149"></a><span id="l4.149"> .row .address {</span>
<a href="#l4.150"></a><span id="l4.150">   font-weight: normal;</span>
<a href="#l4.151"></a><span id="l4.151"> }</span>
<a href="#l4.152"></a><span id="l4.152"> </span>
<a href="#l4.153"></a><span id="l4.153"> .row .pricing {</span>
<a href="#l4.154"></a><span id="l4.154">   text-align: right;</span>
<a href="#l4.155"></a><span id="l4.155">   min-width: 200px;</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineminus">-  display: none;</span>
<a href="#l4.157"></a><span id="l4.157"> }</span>
<a href="#l4.158"></a><span id="l4.158"> </span>
<a href="#l4.159"></a><span id="l4.159"> .pricing button.create {</span>
<a href="#l4.160"></a><span id="l4.160">   border-radius: 12px;</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineplus">+  transition: min-height 0.2s;</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineplus">+}</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineplus">+</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineplus">+.pricing button:disabled.create {</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineplus">+  min-height: 0px;</span>
<a href="#l4.166"></a><span id="l4.166"> }</span>
<a href="#l4.167"></a><span id="l4.167"> </span>
<a href="#l4.168"></a><span id="l4.168"> .pricing span.create {</span>
<a href="#l4.169"></a><span id="l4.169">   display: none;</span>
<a href="#l4.170"></a><span id="l4.170"> }</span>
<a href="#l4.171"></a><span id="l4.171"> </span>
<a href="#l4.172"></a><span id="l4.172"> #existing {</span>
<a href="#l4.173"></a><span id="l4.173">   width: 100%;</span>
<a href="#l4.174"></a><span id="l4.174">   color: graytext;</span>
<a href="#l4.175"></a><span id="l4.175">   font-weight: bold;</span>
<a href="#l4.176"></a><span id="l4.176">   text-align: center;</span>
<a href="#l4.177"></a><span id="l4.177">   padding: 15px;</span>
<a href="#l4.178"></a><span id="l4.178"> }</span>
<a href="#l4.179"></a><span id="l4.179"> </span>
<a href="#l4.180"></a><span id="l4.180"> #existing .header {</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineminus">-    text-align: left;</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineplus">+  text-align: left;</span>
<a href="#l4.183"></a><span id="l4.183"> }</span>
<a href="#l4.184"></a><span id="l4.184"> </span>
<a href="#l4.185"></a><span id="l4.185"> .contentPadded {</span>
<a href="#l4.186"></a><span id="l4.186">   padding: 15px;</span>
<a href="#l4.187"></a><span id="l4.187"> }</span>
<a href="#l4.188"></a><span id="l4.188"> </span>
<a href="#l4.189"></a><span id="l4.189"> /* === NEW ACCOUNT FORM === */</span>
<a href="#l4.190"></a><span id="l4.190"> </span>
<a href="#l4.191"></a><span id="l4.191" class="difflineat">@@ -365,29 +384,18 @@ input[type=&quot;submit&quot;].search {</span>
<a href="#l4.192"></a><span id="l4.192"> #search_engine_wrap {</span>
<a href="#l4.193"></a><span id="l4.193">   display: none;</span>
<a href="#l4.194"></a><span id="l4.194"> }</span>
<a href="#l4.195"></a><span id="l4.195"> </span>
<a href="#l4.196"></a><span id="l4.196"> /* START hbox/vbox normalization from http://alex.dojotoolkit.org/2009/08/css-3-progress/ */</span>
<a href="#l4.197"></a><span id="l4.197"> /* hbox and vbox classes for Mozilla only */</span>
<a href="#l4.198"></a><span id="l4.198"> </span>
<a href="#l4.199"></a><span id="l4.199"> .hbox {</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineminus">-  display: -moz-box;</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineminus">-  -moz-box-orient: horizontal;</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineminus">-  -moz-box-align: stretch;</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-  /*display: box;*/</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineminus">-  /*box-orient: horizontal;*/</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineminus">-  /*box-align: stretch;*/</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineminus">-}</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineminus">-</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineminus">-.hbox &gt; * {</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineminus">-  -moz-box-flex: 0;</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineminus">-  /*box-flex: 0;*/</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineminus">-  display: block;</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineplus">+  display: flex;</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineplus">+  flex-direction: row;</span>
<a href="#l4.215"></a><span id="l4.215"> }</span>
<a href="#l4.216"></a><span id="l4.216"> </span>
<a href="#l4.217"></a><span id="l4.217"> .vbox {</span>
<a href="#l4.218"></a><span id="l4.218">   display: -moz-box;</span>
<a href="#l4.219"></a><span id="l4.219">   -moz-box-orient: vertical;</span>
<a href="#l4.220"></a><span id="l4.220">   -moz-box-align: stretch;</span>
<a href="#l4.221"></a><span id="l4.221"> </span>
<a href="#l4.222"></a><span id="l4.222">   /*display: box;*/</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineat">@@ -410,17 +418,21 @@ input[type=&quot;submit&quot;].search {</span>
<a href="#l4.224"></a><span id="l4.224">   /*box-direction: reverse;*/</span>
<a href="#l4.225"></a><span id="l4.225"> }</span>
<a href="#l4.226"></a><span id="l4.226"> </span>
<a href="#l4.227"></a><span id="l4.227"> .boxFlex0 {</span>
<a href="#l4.228"></a><span id="l4.228">   -moz-box-flex: 0;</span>
<a href="#l4.229"></a><span id="l4.229">   /*box-flex: 0;*/</span>
<a href="#l4.230"></a><span id="l4.230"> }</span>
<a href="#l4.231"></a><span id="l4.231"> </span>
<a href="#l4.232"></a><span id="l4.232" class="difflineminus">-.boxFlex1, .boxFlex {</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineplus">+.boxFlex {</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineplus">+  flex: 1 1 auto;</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineplus">+}</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineplus">+</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineplus">+.boxFlex1 /*, .boxFlex*/ {</span>
<a href="#l4.238"></a><span id="l4.238">   -moz-box-flex: 1;</span>
<a href="#l4.239"></a><span id="l4.239">   /*box-flex: 1;*/</span>
<a href="#l4.240"></a><span id="l4.240"> }</span>
<a href="#l4.241"></a><span id="l4.241"> </span>
<a href="#l4.242"></a><span id="l4.242"> .boxFlex2 {</span>
<a href="#l4.243"></a><span id="l4.243">   -moz-box-flex: 2;</span>
<a href="#l4.244"></a><span id="l4.244">   /*box-flex: 2;*/</span>
<a href="#l4.245"></a><span id="l4.245"> }</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineat">@@ -522,8 +534,25 @@ input[type=&quot;submit&quot;].search {</span>
<a href="#l4.247"></a><span id="l4.247">     opacity: 0.0;</span>
<a href="#l4.248"></a><span id="l4.248">     display: none;</span>
<a href="#l4.249"></a><span id="l4.249">   }</span>
<a href="#l4.250"></a><span id="l4.250">   100% {</span>
<a href="#l4.251"></a><span id="l4.251">     opacity: 0.0;</span>
<a href="#l4.252"></a><span id="l4.252">     display: none;</span>
<a href="#l4.253"></a><span id="l4.253">   }</span>
<a href="#l4.254"></a><span id="l4.254"> }</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineplus">+</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineplus">+.hideWithFade {</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineplus">+  opacity: 0;</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineplus">+  transition: opacity 0.3s;</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineplus">+}</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineplus">+</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineplus">+.showWithFade {</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineplus">+  opacity: 1;</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineplus">+  transition: opacity 0.3s;</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineplus">+}</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineplus">+</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineplus">+#results .slideUp {</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineplus">+  max-height: 0;</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineplus">+  border: none;</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineplus">+  padding-top: 0;</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineplus">+  padding-bottom: 0;</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineplus">+}</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

