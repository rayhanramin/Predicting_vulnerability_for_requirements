<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28020:dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24" />
<meta property="og:url" content="/comm-central/rev/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24" />
<meta property="og:description" content="Bug 1547096 - Remove use of nsIBadCertListener2 in comm-central. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24">shortlog</a> |
<a href="/comm-central/log/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24">files</a> |
changeset |
<a href="/comm-central/raw-rev/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24">raw</a>  | <a href="/comm-central/archive/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1547096">Bug 1547096</a> - Remove use of nsIBadCertListener2 in comm-central. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#97;&#105;&#32;&#69;&#110;&#103;&#101;&#114;&#116;&#32;&#60;&#107;&#97;&#105;&#101;&#64;&#107;&#117;&#105;&#120;&#46;&#100;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 23 Oct 2019 11:38:41 +0200</td></tr>

<tr>
 <td>changeset 28020</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24">dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24</a></td>
</tr>



<tr>
<td>parent 28019</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/80a194afbb0f2c034e190e5db73ba3b3d0badd18">80a194afbb0f2c034e190e5db73ba3b3d0badd18</a>
</td>
</tr>

<tr>
<td>child 28021</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3834c3b9390008ae060ae886534cc4e3e8347fe9">3834c3b9390008ae060ae886534cc4e3e8347fe9</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24">16610</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 25 Oct 2019 17:18:29 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@dee2511f17fb [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24&newProject=comm-central&newRevision=dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24&newProject=comm-central&newRevision=dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24&newProject=comm-central&newRevision=dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1547096">1547096</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1547096">Bug 1547096</a> - Remove use of nsIBadCertListener2 in comm-central. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/calendar/base/modules/utils/calProviderUtils.jsm">calendar/base/modules/utils/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/calendar/base/modules/utils/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/calendar/base/modules/utils/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/calendar/base/modules/utils/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/calendar/base/modules/utils/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/calendar/base/modules/utils/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/chat/modules/socket.jsm">chat/modules/socket.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/chat/modules/socket.jsm">file</a> |
<a href="/comm-central/annotate/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/chat/modules/socket.jsm">annotate</a> |
<a href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/chat/modules/socket.jsm">diff</a> |
<a href="/comm-central/comparison/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/chat/modules/socket.jsm">comparison</a> |
<a href="/comm-central/log/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/chat/modules/socket.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/base/content/mailWindow.js">mail/base/content/mailWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/base/content/mailWindow.js">file</a> |
<a href="/comm-central/annotate/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/base/content/mailWindow.js">annotate</a> |
<a href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/base/content/mailWindow.js">diff</a> |
<a href="/comm-central/comparison/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/base/content/mailWindow.js">comparison</a> |
<a href="/comm-central/log/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/base/content/mailWindow.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/MyBadCertHandler.js">mail/components/accountcreation/content/MyBadCertHandler.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/MyBadCertHandler.js">diff</a> |
<a href="/comm-central/comparison/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/MyBadCertHandler.js">comparison</a> |
<a href="/comm-central/log/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/MyBadCertHandler.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.js">mail/components/accountcreation/content/emailWizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.js">file</a> |
<a href="/comm-central/annotate/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.js">annotate</a> |
<a href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.js">diff</a> |
<a href="/comm-central/comparison/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.js">comparison</a> |
<a href="/comm-central/log/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.xul">mail/components/accountcreation/content/emailWizard.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.xul">file</a> |
<a href="/comm-central/annotate/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.xul">annotate</a> |
<a href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.xul">diff</a> |
<a href="/comm-central/comparison/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.xul">comparison</a> |
<a href="/comm-central/log/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/emailWizard.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/guessConfig.js">mail/components/accountcreation/content/guessConfig.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/guessConfig.js">file</a> |
<a href="/comm-central/annotate/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/guessConfig.js">annotate</a> |
<a href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/guessConfig.js">diff</a> |
<a href="/comm-central/comparison/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/guessConfig.js">comparison</a> |
<a href="/comm-central/log/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/guessConfig.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/verifyConfig.js">mail/components/accountcreation/content/verifyConfig.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/verifyConfig.js">file</a> |
<a href="/comm-central/annotate/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/verifyConfig.js">annotate</a> |
<a href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/verifyConfig.js">diff</a> |
<a href="/comm-central/comparison/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/verifyConfig.js">comparison</a> |
<a href="/comm-central/log/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/content/verifyConfig.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/jar.mn">mail/components/accountcreation/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/jar.mn">file</a> |
<a href="/comm-central/annotate/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/jar.mn">annotate</a> |
<a href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/jar.mn">diff</a> |
<a href="/comm-central/comparison/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/jar.mn">comparison</a> |
<a href="/comm-central/log/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/accountcreation/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/newmailaccount/content/uriListener.js">mail/components/newmailaccount/content/uriListener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/newmailaccount/content/uriListener.js">file</a> |
<a href="/comm-central/annotate/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/newmailaccount/content/uriListener.js">annotate</a> |
<a href="/comm-central/diff/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/newmailaccount/content/uriListener.js">diff</a> |
<a href="/comm-central/comparison/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/newmailaccount/content/uriListener.js">comparison</a> |
<a href="/comm-central/log/dee2511f17fb354c6cfcc06b0c0ec2a2066d5f24/mail/components/newmailaccount/content/uriListener.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/modules/utils/calProviderUtils.jsm</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/modules/utils/calProviderUtils.jsm</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -154,37 +154,29 @@ var calprovider = {</span>
<a href="#l1.4"></a><span id="l1.4">       // Support Auth Prompt Interfaces</span>
<a href="#l1.5"></a><span id="l1.5">       if (aIID.equals(Ci.nsIAuthPrompt2)) {</span>
<a href="#l1.6"></a><span id="l1.6">         if (!this.calAuthPrompt) {</span>
<a href="#l1.7"></a><span id="l1.7">           this.calAuthPrompt = new cal.auth.Prompt();</span>
<a href="#l1.8"></a><span id="l1.8">         }</span>
<a href="#l1.9"></a><span id="l1.9">         return this.calAuthPrompt;</span>
<a href="#l1.10"></a><span id="l1.10">       } else if (aIID.equals(Ci.nsIAuthPromptProvider) || aIID.equals(Ci.nsIPrompt)) {</span>
<a href="#l1.11"></a><span id="l1.11">         return Services.ww.getNewPrompter(null);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      } else if (aIID.equals(Ci.nsIBadCertListener2)) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-        if (!this.badCertHandler) {</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-          this.badCertHandler = new cal.provider.BadCertHandler(this);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-        }</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-        return this.badCertHandler;</span>
<a href="#l1.17"></a><span id="l1.17">       } else {</span>
<a href="#l1.18"></a><span id="l1.18">         Components.returnCode = e;</span>
<a href="#l1.19"></a><span id="l1.19">       }</span>
<a href="#l1.20"></a><span id="l1.20">     }</span>
<a href="#l1.21"></a><span id="l1.21">     return null;</span>
<a href="#l1.22"></a><span id="l1.22">   },</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+  // TODO: Add new error handling that uses this code. See bug 1547096.</span>
<a href="#l1.25"></a><span id="l1.25">   /**</span>
<a href="#l1.26"></a><span id="l1.26">    * Bad Certificate Handler for Network Requests. Shows the Network Exception</span>
<a href="#l1.27"></a><span id="l1.27">    * Dialog if a certificate Problem occurs.</span>
<a href="#l1.28"></a><span id="l1.28">    */</span>
<a href="#l1.29"></a><span id="l1.29">   BadCertHandler: class {</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-    QueryInterface() {</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-      return ChromeUtils.generateQI([Ci.nsIBadCertListener2]);</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-    }</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-</span>
<a href="#l1.34"></a><span id="l1.34">     constructor(thisProvider) {</span>
<a href="#l1.35"></a><span id="l1.35">       this.thisProvider = thisProvider;</span>
<a href="#l1.36"></a><span id="l1.36">       this.timer = null;</span>
<a href="#l1.37"></a><span id="l1.37">     }</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">     notifyCertProblem(socketInfo, secInfo, targetSite) {</span>
<a href="#l1.40"></a><span id="l1.40">       // Unfortunately we can't pass js objects using the window watcher, so</span>
<a href="#l1.41"></a><span id="l1.41">       // we'll just take the first available calendar window. We also need to</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/chat/modules/socket.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/chat/modules/socket.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -2,18 +2,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.5"></a><span id="l2.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> /*</span>
<a href="#l2.8"></a><span id="l2.8">  * Combines a lot of the Mozilla networking interfaces into a sane interface for</span>
<a href="#l2.9"></a><span id="l2.9">  * simple(r) use of sockets code.</span>
<a href="#l2.10"></a><span id="l2.10">  *</span>
<a href="#l2.11"></a><span id="l2.11">  * This implements nsIServerSocketListener, nsIStreamListener,</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">- * nsIRequestObserver, nsITransportEventSink, nsIBadCertListener2,</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">- * and nsIProtocolProxyCallback.</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+ * nsIRequestObserver, nsITransportEventSink and nsIProtocolProxyCallback.</span>
<a href="#l2.15"></a><span id="l2.15">  *</span>
<a href="#l2.16"></a><span id="l2.16">  * This uses nsIRoutedSocketTransportService, nsIServerSocket, nsIThreadManager,</span>
<a href="#l2.17"></a><span id="l2.17">  * nsIBinaryInputStream, nsIScriptableInputStream, nsIInputStreamPump,</span>
<a href="#l2.18"></a><span id="l2.18">  * nsIProxyService, nsIProxyInfo.</span>
<a href="#l2.19"></a><span id="l2.19">  *</span>
<a href="#l2.20"></a><span id="l2.20">  * High-level methods:</span>
<a href="#l2.21"></a><span id="l2.21">  *   connect(&lt;originHost&gt;, &lt;originPort&gt;[, (&quot;starttls&quot; | &quot;ssl&quot; | &quot;udp&quot;)</span>
<a href="#l2.22"></a><span id="l2.22">  *           [, &lt;proxy&gt;[, &lt;host&gt;, &lt;port&gt;]]])</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineat">@@ -545,26 +544,16 @@ var Socket = {</span>
<a href="#l2.24"></a><span id="l2.24">         );</span>
<a href="#l2.25"></a><span id="l2.25">         return;</span>
<a href="#l2.26"></a><span id="l2.26">       }</span>
<a href="#l2.27"></a><span id="l2.27">     }</span>
<a href="#l2.28"></a><span id="l2.28">     this.onConnectionClosed();</span>
<a href="#l2.29"></a><span id="l2.29">   },</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31">   /*</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-   * nsIBadCertListener2</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-   */</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-  // Called when there's an error, return true to suppress the modal alert.</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-  // Whatever this function returns, NSS will close the connection.</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-  notifyCertProblem(aSocketInfo, aSecInfo, aTargetSite) {</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-    this.secInfo = aSecInfo;</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-    return true;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-  },</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-  /*</span>
<a href="#l2.42"></a><span id="l2.42">    * nsITransportEventSink methods</span>
<a href="#l2.43"></a><span id="l2.43">    */</span>
<a href="#l2.44"></a><span id="l2.44">   onTransportStatus(aTransport, aStatus, aProgress, aProgressmax) {</span>
<a href="#l2.45"></a><span id="l2.45">     // Don't send status change notifications after the socket has been closed.</span>
<a href="#l2.46"></a><span id="l2.46">     // The event sink can't be removed after opening the transport, so we can't</span>
<a href="#l2.47"></a><span id="l2.47">     // do better than adding a null check here.</span>
<a href="#l2.48"></a><span id="l2.48">     if (!this.transport) {</span>
<a href="#l2.49"></a><span id="l2.49">       return;</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineat">@@ -621,18 +610,17 @@ var Socket = {</span>
<a href="#l2.51"></a><span id="l2.51">       this.proxy</span>
<a href="#l2.52"></a><span id="l2.52">     );</span>
<a href="#l2.53"></a><span id="l2.53"> </span>
<a href="#l2.54"></a><span id="l2.54">     this._openStreams();</span>
<a href="#l2.55"></a><span id="l2.55">   },</span>
<a href="#l2.56"></a><span id="l2.56"> </span>
<a href="#l2.57"></a><span id="l2.57">   // Open the incoming and outgoing streams, and init the nsISocketTransport.</span>
<a href="#l2.58"></a><span id="l2.58">   _openStreams() {</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-    // Security notification callbacks (must support nsIBadCertListener2</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-    // for SSL connections, and possibly other interfaces).</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+    // TODO: is this still required after bug 1547096?</span>
<a href="#l2.62"></a><span id="l2.62">     this.transport.securityCallbacks = this;</span>
<a href="#l2.63"></a><span id="l2.63"> </span>
<a href="#l2.64"></a><span id="l2.64">     // Set the timeouts for the nsISocketTransport for both a connect event and</span>
<a href="#l2.65"></a><span id="l2.65">     // a read/write. Only set them if the user has provided them.</span>
<a href="#l2.66"></a><span id="l2.66">     if (this.connectTimeout) {</span>
<a href="#l2.67"></a><span id="l2.67">       this.transport.setTimeout(</span>
<a href="#l2.68"></a><span id="l2.68">         Ci.nsISocketTransport.TIMEOUT_CONNECT,</span>
<a href="#l2.69"></a><span id="l2.69">         this.connectTimeout</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineat">@@ -727,16 +715,15 @@ var Socket = {</span>
<a href="#l2.71"></a><span id="l2.71">   // should be sent on the socket.</span>
<a href="#l2.72"></a><span id="l2.72">   sendPing() {},</span>
<a href="#l2.73"></a><span id="l2.73"> </span>
<a href="#l2.74"></a><span id="l2.74">   /* QueryInterface and nsIInterfaceRequestor implementations */</span>
<a href="#l2.75"></a><span id="l2.75">   QueryInterface: ChromeUtils.generateQI([</span>
<a href="#l2.76"></a><span id="l2.76">     &quot;nsIStreamListener&quot;,</span>
<a href="#l2.77"></a><span id="l2.77">     &quot;nsIRequestObserver&quot;,</span>
<a href="#l2.78"></a><span id="l2.78">     &quot;nsITransportEventSink&quot;,</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-    &quot;nsIBadCertListener2&quot;,</span>
<a href="#l2.80"></a><span id="l2.80">     &quot;nsIProtocolProxyCallback&quot;,</span>
<a href="#l2.81"></a><span id="l2.81">   ]),</span>
<a href="#l2.82"></a><span id="l2.82"> </span>
<a href="#l2.83"></a><span id="l2.83">   getInterface(iid) {</span>
<a href="#l2.84"></a><span id="l2.84">     return this.QueryInterface(iid);</span>
<a href="#l2.85"></a><span id="l2.85">   },</span>
<a href="#l2.86"></a><span id="l2.86"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/mailWindow.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/mailWindow.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -205,18 +205,16 @@ function CreateMailWindowGlobals() {</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">   // Create message window object</span>
<a href="#l3.6"></a><span id="l3.6">   // eslint-disable-next-line no-global-assign</span>
<a href="#l3.7"></a><span id="l3.7">   msgWindow = Cc[&quot;@mozilla.org/messenger/msgwindow;1&quot;].createInstance(</span>
<a href="#l3.8"></a><span id="l3.8">     Ci.nsIMsgWindow</span>
<a href="#l3.9"></a><span id="l3.9">   );</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   accountManager = MailServices.accounts;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-  msgWindow.notificationCallbacks = new BadCertHandler();</span>
<a href="#l3.14"></a><span id="l3.14"> }</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> function InitMsgWindow() {</span>
<a href="#l3.17"></a><span id="l3.17">   msgWindow.windowCommands = new nsMsgWindowCommands();</span>
<a href="#l3.18"></a><span id="l3.18">   // set the domWindow before setting the status feedback and header sink objects</span>
<a href="#l3.19"></a><span id="l3.19">   msgWindow.domWindow = window;</span>
<a href="#l3.20"></a><span id="l3.20">   msgWindow.statusFeedback = statusFeedback;</span>
<a href="#l3.21"></a><span id="l3.21">   msgWindow.msgHeaderSink = messageHeaderSink;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -671,43 +669,17 @@ function OpenInboxForServer(server) {</span>
<a href="#l3.23"></a><span id="l3.23"> }</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25"> /** Update state of zoom type (text vs. full) menu item. */</span>
<a href="#l3.26"></a><span id="l3.26"> function UpdateFullZoomMenu() {</span>
<a href="#l3.27"></a><span id="l3.27">   let cmdItem = document.getElementById(&quot;cmd_fullZoomToggle&quot;);</span>
<a href="#l3.28"></a><span id="l3.28">   cmdItem.setAttribute(&quot;checked&quot;, !ZoomManager.useFullZoom);</span>
<a href="#l3.29"></a><span id="l3.29"> }</span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-/**</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">- * This class implements nsIBadCertListener2.  Its job is to prevent &quot;bad cert&quot;</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">- * security dialogs from being shown to the user.  Currently it puts up the</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">- * cert override dialog, though we'd like to give the user more detailed</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">- * information in the future.</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">- */</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-function BadCertHandler() {}</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-BadCertHandler.prototype = {</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-  // Suppress any certificate errors</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-  notifyCertProblem(socketInfo, status, targetSite) {</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-    setTimeout(InformUserOfCertError, 0, socketInfo, status, targetSite);</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-    return true;</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-  },</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-  // nsIInterfaceRequestor</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-  getInterface(iid) {</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-    return this.QueryInterface(iid);</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-  },</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-  // nsISupports</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-  QueryInterface: ChromeUtils.generateQI([</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-    &quot;nsIBadCertListener2&quot;,</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-    &quot;nsIInterfaceRequestor&quot;,</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-  ]),</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-};</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+// TODO: Add new error handling that uses this code. See bug 1547096.</span>
<a href="#l3.59"></a><span id="l3.59"> function InformUserOfCertError(socketInfo, secInfo, targetSite) {</span>
<a href="#l3.60"></a><span id="l3.60">   let params = {</span>
<a href="#l3.61"></a><span id="l3.61">     exceptionAdded: false,</span>
<a href="#l3.62"></a><span id="l3.62">     securityInfo: secInfo,</span>
<a href="#l3.63"></a><span id="l3.63">     prefetchCert: true,</span>
<a href="#l3.64"></a><span id="l3.64">     location: targetSite,</span>
<a href="#l3.65"></a><span id="l3.65">   };</span>
<a href="#l3.66"></a><span id="l3.66">   window.openDialog(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">deleted file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- a/mail/components/accountcreation/content/MyBadCertHandler.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ /dev/null</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -1,36 +0,0 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">-</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">-/**</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">- * This class implements nsIBadCertListener.  It's job is to prevent &quot;bad cert&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">- * security dialogs from being shown to the user.  We call back to the</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">- * 'callback' object's method &quot;processCertError&quot; so that it can deal with it as</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">- * needed (in the case of autoconfig, setting up temporary overrides).</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">- */</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-function BadCertHandler(callback) {</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-  this._init(callback);</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-}</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-BadCertHandler.prototype = {</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-  _init(callback) {</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-    this._callback = callback;</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-  },</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-  // Suppress any certificate errors</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-  notifyCertProblem(socketInfo, status, targetSite) {</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-    return this._callback.processCertError(socketInfo, status, targetSite);</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-  },</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-  // nsIInterfaceRequestor</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-  getInterface(iid) {</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-    return this.QueryInterface(iid);</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-  },</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-  // nsISupports</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-  QueryInterface: ChromeUtils.generateQI([</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-    &quot;nsIBadCertListener2&quot;,</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-    &quot;nsIInterfaceRequestor&quot;,</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-  ]),</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/accountcreation/content/emailWizard.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/accountcreation/content/emailWizard.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -6,17 +6,16 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* import-globals-from ../../../../mailnews/base/prefs/content/accountUtils.js */</span>
<a href="#l5.5"></a><span id="l5.5"> /* import-globals-from accountConfig.js */</span>
<a href="#l5.6"></a><span id="l5.6"> /* import-globals-from createInBackend.js */</span>
<a href="#l5.7"></a><span id="l5.7"> /* import-globals-from emailWizard.js */</span>
<a href="#l5.8"></a><span id="l5.8"> /* import-globals-from exchangeAutoDiscover.js */</span>
<a href="#l5.9"></a><span id="l5.9"> /* import-globals-from fetchConfig.js */</span>
<a href="#l5.10"></a><span id="l5.10"> /* import-globals-from fetchhttp.js */</span>
<a href="#l5.11"></a><span id="l5.11"> /* import-globals-from guessConfig.js */</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-/* import-globals-from MyBadCertHandler.js */</span>
<a href="#l5.13"></a><span id="l5.13"> /* import-globals-from readFromXML.js */</span>
<a href="#l5.14"></a><span id="l5.14"> /* import-globals-from sanitizeDatatypes.js */</span>
<a href="#l5.15"></a><span id="l5.15"> /* import-globals-from util.js */</span>
<a href="#l5.16"></a><span id="l5.16"> /* import-globals-from verifyConfig.js */</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l5.19"></a><span id="l5.19"> var { MailServices } = ChromeUtils.import(</span>
<a href="#l5.20"></a><span id="l5.20">   &quot;resource:///modules/MailServices.jsm&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/accountcreation/content/emailWizard.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/accountcreation/content/emailWizard.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -43,17 +43,16 @@</span>
<a href="#l6.4"></a><span id="l6.4">   &lt;script src=&quot;chrome://messenger/content/accountcreation/sanitizeDatatypes.js&quot;/&gt;</span>
<a href="#l6.5"></a><span id="l6.5">   &lt;script src=&quot;chrome://messenger/content/accountcreation/fetchhttp.js&quot;/&gt;</span>
<a href="#l6.6"></a><span id="l6.6">   &lt;script src=&quot;chrome://messenger/content/accountcreation/readFromXML.js&quot;/&gt;</span>
<a href="#l6.7"></a><span id="l6.7">   &lt;script src=&quot;chrome://messenger/content/accountcreation/guessConfig.js&quot;/&gt;</span>
<a href="#l6.8"></a><span id="l6.8">   &lt;script src=&quot;chrome://messenger/content/accountcreation/verifyConfig.js&quot;/&gt;</span>
<a href="#l6.9"></a><span id="l6.9">   &lt;script src=&quot;chrome://messenger/content/accountcreation/fetchConfig.js&quot;/&gt;</span>
<a href="#l6.10"></a><span id="l6.10">   &lt;script src=&quot;chrome://messenger/content/accountcreation/exchangeAutoDiscover.js&quot;/&gt;</span>
<a href="#l6.11"></a><span id="l6.11">   &lt;script src=&quot;chrome://messenger/content/accountcreation/createInBackend.js&quot;/&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  &lt;script src=&quot;chrome://messenger/content/accountcreation/MyBadCertHandler.js&quot;/&gt;</span>
<a href="#l6.13"></a><span id="l6.13">   &lt;script src=&quot;chrome://messenger/content/accountUtils.js&quot;/&gt;</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15">   &lt;keyset id=&quot;mailKeys&quot;&gt;</span>
<a href="#l6.16"></a><span id="l6.16">     &lt;key keycode=&quot;VK_ESCAPE&quot; oncommand=&quot;window.close();&quot;/&gt;</span>
<a href="#l6.17"></a><span id="l6.17">   &lt;/keyset&gt;</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19">   &lt;vbox id=&quot;mainContainer&quot; class=&quot;hub-container&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l6.20"></a><span id="l6.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/accountcreation/content/guessConfig.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/accountcreation/content/guessConfig.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -997,19 +997,18 @@ function protocolToString(type) {</span>
<a href="#l7.4"></a><span id="l7.4">     return &quot;smtp&quot;;</span>
<a href="#l7.5"></a><span id="l7.5">   }</span>
<a href="#l7.6"></a><span id="l7.6">   throw new NotReached(&quot;unexpected protocol&quot;);</span>
<a href="#l7.7"></a><span id="l7.7"> }</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> // ----------------------</span>
<a href="#l7.10"></a><span id="l7.10"> // SSL cert error handler</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+// TODO: Add new error handling that uses this code. See bug 1547096.</span>
<a href="#l7.13"></a><span id="l7.13"> /**</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">- * Called by MyBadCertHandler.js, which called by PSM</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">- * to tell us about SSL certificate errors.</span>
<a href="#l7.16"></a><span id="l7.16">  * @param thisTry {HostTry}</span>
<a href="#l7.17"></a><span id="l7.17">  * @param logger {Log4Moz logger}</span>
<a href="#l7.18"></a><span id="l7.18">  */</span>
<a href="#l7.19"></a><span id="l7.19"> function SSLErrorHandler(thisTry, logger) {</span>
<a href="#l7.20"></a><span id="l7.20">   this._try = thisTry;</span>
<a href="#l7.21"></a><span id="l7.21">   this._log = logger;</span>
<a href="#l7.22"></a><span id="l7.22">   // _ gotCertError will be set to an error code (one of those defined in</span>
<a href="#l7.23"></a><span id="l7.23">   // nsICertOverrideService)</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineat">@@ -1173,21 +1172,17 @@ function SocketUtil(</span>
<a href="#l7.25"></a><span id="l7.25">     socketTypeName,</span>
<a href="#l7.26"></a><span id="l7.26">     hostname,</span>
<a href="#l7.27"></a><span id="l7.27">     port,</span>
<a href="#l7.28"></a><span id="l7.28">     proxy</span>
<a href="#l7.29"></a><span id="l7.29">   );</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31">   transport.setTimeout(Ci.nsISocketTransport.TIMEOUT_CONNECT, timeout);</span>
<a href="#l7.32"></a><span id="l7.32">   transport.setTimeout(Ci.nsISocketTransport.TIMEOUT_READ_WRITE, timeout);</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-  try {</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-    transport.securityCallbacks = new BadCertHandler(sslErrorHandler);</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-  } catch (e) {</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-    _error(e);</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-  }</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+</span>
<a href="#l7.39"></a><span id="l7.39">   var outstream = transport.openOutputStream(0, 0, 0);</span>
<a href="#l7.40"></a><span id="l7.40">   var stream = transport.openInputStream(0, 0, 0);</span>
<a href="#l7.41"></a><span id="l7.41">   var instream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;].createInstance(</span>
<a href="#l7.42"></a><span id="l7.42">     Ci.nsIScriptableInputStream</span>
<a href="#l7.43"></a><span id="l7.43">   );</span>
<a href="#l7.44"></a><span id="l7.44">   instream.init(stream);</span>
<a href="#l7.45"></a><span id="l7.45"> </span>
<a href="#l7.46"></a><span id="l7.46">   var dataListener = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/components/accountcreation/content/verifyConfig.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/components/accountcreation/content/verifyConfig.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -198,23 +198,16 @@ function verifyLogon(</span>
<a href="#l8.4"></a><span id="l8.4">     gEmailWizardLogger.error(&quot;verifyLogon failed: &quot; + e);</span>
<a href="#l8.5"></a><span id="l8.5">     throw e;</span>
<a href="#l8.6"></a><span id="l8.6">   } finally {</span>
<a href="#l8.7"></a><span id="l8.7">     // restore them</span>
<a href="#l8.8"></a><span id="l8.8">     msgWindow.notificationCallbacks = saveCallbacks;</span>
<a href="#l8.9"></a><span id="l8.9">   }</span>
<a href="#l8.10"></a><span id="l8.10"> }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-/**</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">- * The url listener also implements nsIBadCertListener2.  Its job is to prevent</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">- * &quot;bad cert&quot; security dialogs from being shown to the user.  Currently it puts</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">- * up the cert override dialog, though we'd like to give the user more detailed</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">- * information in the future.</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">- */</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-</span>
<a href="#l8.19"></a><span id="l8.19"> function urlListener(</span>
<a href="#l8.20"></a><span id="l8.20">   config,</span>
<a href="#l8.21"></a><span id="l8.21">   server,</span>
<a href="#l8.22"></a><span id="l8.22">   alter,</span>
<a href="#l8.23"></a><span id="l8.23">   msgWindow,</span>
<a href="#l8.24"></a><span id="l8.24">   successCallback,</span>
<a href="#l8.25"></a><span id="l8.25">   errorCallback</span>
<a href="#l8.26"></a><span id="l8.26"> ) {</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineat">@@ -382,31 +375,17 @@ urlListener.prototype = {</span>
<a href="#l8.28"></a><span id="l8.28">         &quot;chrome://messenger/locale/accountCreationModel.properties&quot;</span>
<a href="#l8.29"></a><span id="l8.29">       ).GetStringFromName(&quot;cannot_login.error&quot;);</span>
<a href="#l8.30"></a><span id="l8.30">     }</span>
<a href="#l8.31"></a><span id="l8.31">     var ex = new Exception(msg);</span>
<a href="#l8.32"></a><span id="l8.32">     ex.code = code;</span>
<a href="#l8.33"></a><span id="l8.33">     this.mErrorCallback(ex);</span>
<a href="#l8.34"></a><span id="l8.34">   },</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-  // Suppress any certificate errors</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-  notifyCertProblem(socketInfo, status, targetSite) {</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-    this.mCertError = true;</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-    this._log.error(&quot;cert error&quot;);</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-    let self = this;</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-    setTimeout(function() {</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-      try {</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-        self.informUserOfCertError(socketInfo, status, targetSite);</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-      } catch (e) {</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-        logException(e);</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-      }</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-    }, 0);</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-    return true;</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-  },</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+  // TODO: Add new error handling that uses this code. See bug 1547096.</span>
<a href="#l8.52"></a><span id="l8.52">   informUserOfCertError(socketInfo, secInfo, targetSite) {</span>
<a href="#l8.53"></a><span id="l8.53">     var params = {</span>
<a href="#l8.54"></a><span id="l8.54">       exceptionAdded: false,</span>
<a href="#l8.55"></a><span id="l8.55">       securityInfo: secInfo,</span>
<a href="#l8.56"></a><span id="l8.56">       prefetchCert: true,</span>
<a href="#l8.57"></a><span id="l8.57">       location: targetSite,</span>
<a href="#l8.58"></a><span id="l8.58">     };</span>
<a href="#l8.59"></a><span id="l8.59">     window.openDialog(</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineat">@@ -438,13 +417,12 @@ urlListener.prototype = {</span>
<a href="#l8.61"></a><span id="l8.61"> </span>
<a href="#l8.62"></a><span id="l8.62">   // nsIInterfaceRequestor</span>
<a href="#l8.63"></a><span id="l8.63">   getInterface(iid) {</span>
<a href="#l8.64"></a><span id="l8.64">     return this.QueryInterface(iid);</span>
<a href="#l8.65"></a><span id="l8.65">   },</span>
<a href="#l8.66"></a><span id="l8.66"> </span>
<a href="#l8.67"></a><span id="l8.67">   // nsISupports</span>
<a href="#l8.68"></a><span id="l8.68">   QueryInterface: ChromeUtils.generateQI([</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-    &quot;nsIBadCertListener2&quot;,</span>
<a href="#l8.70"></a><span id="l8.70">     &quot;nsIInterfaceRequestor&quot;,</span>
<a href="#l8.71"></a><span id="l8.71">     &quot;nsIUrlListener&quot;,</span>
<a href="#l8.72"></a><span id="l8.72">   ]),</span>
<a href="#l8.73"></a><span id="l8.73"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/accountcreation/jar.mn</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/accountcreation/jar.mn</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -6,13 +6,12 @@ messenger.jar:</span>
<a href="#l9.4"></a><span id="l9.4">   content/messenger/accountcreation/accountConfig.js      (content/accountConfig.js)</span>
<a href="#l9.5"></a><span id="l9.5">   content/messenger/accountcreation/createInBackend.js    (content/createInBackend.js)</span>
<a href="#l9.6"></a><span id="l9.6">   content/messenger/accountcreation/emailWizard.js        (content/emailWizard.js)</span>
<a href="#l9.7"></a><span id="l9.7">   content/messenger/accountcreation/emailWizard.xul       (content/emailWizard.xul)</span>
<a href="#l9.8"></a><span id="l9.8">   content/messenger/accountcreation/exchangeAutoDiscover.js        (content/exchangeAutoDiscover.js)</span>
<a href="#l9.9"></a><span id="l9.9">   content/messenger/accountcreation/fetchConfig.js        (content/fetchConfig.js)</span>
<a href="#l9.10"></a><span id="l9.10">   content/messenger/accountcreation/fetchhttp.js          (content/fetchhttp.js)</span>
<a href="#l9.11"></a><span id="l9.11">   content/messenger/accountcreation/guessConfig.js        (content/guessConfig.js)</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  content/messenger/accountcreation/MyBadCertHandler.js   (content/MyBadCertHandler.js)</span>
<a href="#l9.13"></a><span id="l9.13">   content/messenger/accountcreation/readFromXML.js        (content/readFromXML.js)</span>
<a href="#l9.14"></a><span id="l9.14">   content/messenger/accountcreation/sanitizeDatatypes.js  (content/sanitizeDatatypes.js)</span>
<a href="#l9.15"></a><span id="l9.15">   content/messenger/accountcreation/util.js               (content/util.js)</span>
<a href="#l9.16"></a><span id="l9.16">   content/messenger/accountcreation/verifyConfig.js       (content/verifyConfig.js)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/newmailaccount/content/uriListener.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/newmailaccount/content/uriListener.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -176,20 +176,16 @@ TracingListener.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">     Services.scriptloader.loadSubScript(</span>
<a href="#l10.5"></a><span id="l10.5">       &quot;chrome://messenger/content/accountcreation/fetchConfig.js&quot;,</span>
<a href="#l10.6"></a><span id="l10.6">       accountCreationFuncs</span>
<a href="#l10.7"></a><span id="l10.7">     );</span>
<a href="#l10.8"></a><span id="l10.8">     Services.scriptloader.loadSubScript(</span>
<a href="#l10.9"></a><span id="l10.9">       &quot;chrome://messenger/content/accountcreation/createInBackend.js&quot;,</span>
<a href="#l10.10"></a><span id="l10.10">       accountCreationFuncs</span>
<a href="#l10.11"></a><span id="l10.11">     );</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    Services.scriptloader.loadSubScript(</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-      &quot;chrome://messenger/content/accountcreation/MyBadCertHandler.js&quot;,</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-      accountCreationFuncs</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-    );</span>
<a href="#l10.16"></a><span id="l10.16"> </span>
<a href="#l10.17"></a><span id="l10.17">     let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l10.18"></a><span id="l10.18">     let success = false;</span>
<a href="#l10.19"></a><span id="l10.19">     let account;</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21">     try {</span>
<a href="#l10.22"></a><span id="l10.22">       // Attempt to construct the downloaded data into XML</span>
<a href="#l10.23"></a><span id="l10.23">       let data = this.chunks.join(&quot;&quot;);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

