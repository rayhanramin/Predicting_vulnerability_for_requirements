<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 9580:0683a22dac2b2936542fa3fef62d3adbfcdbdf24</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 0683a22dac2b2936542fa3fef62d3adbfcdbdf24" />
<meta property="og:url" content="/comm-central/rev/0683a22dac2b2936542fa3fef62d3adbfcdbdf24" />
<meta property="og:description" content="Bug 731262 - TB compile warning squash part 1. r=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 0683a22dac2b2936542fa3fef62d3adbfcdbdf24 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/0683a22dac2b2936542fa3fef62d3adbfcdbdf24">shortlog</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/0683a22dac2b2936542fa3fef62d3adbfcdbdf24">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24">files</a> |
changeset |
<a href="/comm-central/raw-rev/0683a22dac2b2936542fa3fef62d3adbfcdbdf24">raw</a>  | <a href="/comm-central/archive/0683a22dac2b2936542fa3fef62d3adbfcdbdf24.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=731262">Bug 731262</a> - TB compile warning squash part 1. r=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#73;&#114;&#118;&#105;&#110;&#103;&#32;&#82;&#101;&#105;&#100;&#32;&#60;&#105;&#114;&#118;&#105;&#110;&#103;&#64;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 09 Feb 2012 10:09:22 -0500</td></tr>

<tr>
 <td>changeset 9580</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/0683a22dac2b2936542fa3fef62d3adbfcdbdf24">0683a22dac2b2936542fa3fef62d3adbfcdbdf24</a></td>
</tr>



<tr>
<td>parent 9579</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1bb9b9a58eeae9ef2f94ed9796e643d95a6ff8d5">1bb9b9a58eeae9ef2f94ed9796e643d95a6ff8d5</a>
</td>
</tr>

<tr>
<td>child 9581</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/946cf51e832725b778ac63e566d45e88b30f33a2">946cf51e832725b778ac63e566d45e88b30f33a2</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=0683a22dac2b2936542fa3fef62d3adbfcdbdf24">7315</a></td></tr>
<tr><td>push user</td><td>ryanvm@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 08 Mar 2012 00:46:22 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@946cf51e8327 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=946cf51e832725b778ac63e566d45e88b30f33a2">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=946cf51e832725b778ac63e566d45e88b30f33a2&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=946cf51e832725b778ac63e566d45e88b30f33a2&newProject=comm-central&newRevision=1bb9b9a58eeae9ef2f94ed9796e643d95a6ff8d5&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=946cf51e832725b778ac63e566d45e88b30f33a2&newProject=comm-central&newRevision=1bb9b9a58eeae9ef2f94ed9796e643d95a6ff8d5&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=946cf51e832725b778ac63e566d45e88b30f33a2&newProject=comm-central&newRevision=1bb9b9a58eeae9ef2f94ed9796e643d95a6ff8d5&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=731262">731262</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=731262">Bug 731262</a> - TB compile warning squash part 1. r=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgBodyHandler.cpp">mailnews/base/search/src/nsMsgBodyHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgBodyHandler.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgBodyHandler.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgBodyHandler.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgBodyHandler.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgBodyHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchAdapter.cpp">mailnews/base/search/src/nsMsgSearchAdapter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchAdapter.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchAdapter.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchAdapter.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchAdapter.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchAdapter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchSession.cpp">mailnews/base/search/src/nsMsgSearchSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchSession.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchSession.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchSession.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchSession.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/search/src/nsMsgSearchSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgDBView.h">mailnews/base/src/nsMsgDBView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgDBView.h">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgDBView.h">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgDBView.h">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgDBView.h">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgDBView.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.cpp">mailnews/base/src/nsMsgFolderCompactor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.h">mailnews/base/src/nsMsgFolderCompactor.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.h">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.h">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.h">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.h">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderCompactor.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderDataSource.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgGroupThread.cpp">mailnews/base/src/nsMsgGroupThread.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgGroupThread.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgGroupThread.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgGroupThread.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgGroupThread.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgGroupThread.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgMailSession.h">mailnews/base/src/nsMsgMailSession.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgMailSession.h">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgMailSession.h">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgMailSession.h">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgMailSession.h">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgMailSession.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgPrintEngine.cpp">mailnews/base/src/nsMsgPrintEngine.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgPrintEngine.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgPrintEngine.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgPrintEngine.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgPrintEngine.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgPrintEngine.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.cpp">mailnews/base/src/nsMsgQuickSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.h">mailnews/base/src/nsMsgQuickSearchDBView.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.h">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.h">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.h">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.h">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgQuickSearchDBView.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgSearchDBView.cpp">mailnews/base/src/nsMsgSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgThreadedDBView.cpp">mailnews/base/src/nsMsgThreadedDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgThreadedDBView.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgThreadedDBView.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgThreadedDBView.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgThreadedDBView.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgThreadedDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.cpp">mailnews/base/src/nsMsgXFViewThread.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.h">mailnews/base/src/nsMsgXFViewThread.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.h">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.h">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.h">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.h">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/src/nsMsgXFViewThread.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsImapMoveCoalescer.cpp">mailnews/base/util/nsImapMoveCoalescer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsImapMoveCoalescer.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsImapMoveCoalescer.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsImapMoveCoalescer.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsImapMoveCoalescer.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsImapMoveCoalescer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSendLater.cpp">mailnews/compose/src/nsMsgSendLater.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSendLater.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSendLater.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSendLater.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSendLater.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/compose/src/nsMsgSendLater.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/public/nsIMsgDatabase.idl">mailnews/db/msgdb/public/nsIMsgDatabase.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/public/nsIMsgDatabase.idl">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/public/nsIMsgDatabase.idl">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/public/nsIMsgDatabase.idl">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/public/nsIMsgDatabase.idl">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/public/nsIMsgDatabase.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgHdr.cpp">mailnews/db/msgdb/src/nsMsgHdr.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgHdr.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgHdr.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgHdr.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgHdr.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/db/msgdb/src/nsMsgHdr.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.cpp">mailnews/imap/src/nsIMAPHostSessionList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.cpp">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.cpp">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.cpp">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.cpp">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.h">mailnews/imap/src/nsIMAPHostSessionList.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.h">file</a> |
<a href="/comm-central/annotate/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.h">annotate</a> |
<a href="/comm-central/diff/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.h">diff</a> |
<a href="/comm-central/comparison/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.h">comparison</a> |
<a href="/comm-central/log/0683a22dac2b2936542fa3fef62d3adbfcdbdf24/mailnews/imap/src/nsIMAPHostSessionList.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -161,16 +161,18 @@ PRInt32 nsMsgBodyHandler::GetNextLine (n</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">   return outLength;</span>
<a href="#l1.6"></a><span id="l1.6"> }</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> void nsMsgBodyHandler::OpenLocalFolder()</span>
<a href="#l1.9"></a><span id="l1.9"> {</span>
<a href="#l1.10"></a><span id="l1.10">   nsCOMPtr &lt;nsIInputStream&gt; inputStream;</span>
<a href="#l1.11"></a><span id="l1.11">   nsresult rv = m_scope-&gt;GetInputStream(m_msgHdr, getter_AddRefs(inputStream));</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+  // Warn and return if GetInputStream fails</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l1.14"></a><span id="l1.14">   m_fileLineStream = do_QueryInterface(inputStream);</span>
<a href="#l1.15"></a><span id="l1.15"> }</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> PRInt32 nsMsgBodyHandler::GetNextFilterLine(nsCString &amp;buf)</span>
<a href="#l1.18"></a><span id="l1.18"> {</span>
<a href="#l1.19"></a><span id="l1.19">   // m_nextHdr always points to the next header in the list....the list is NULL terminated...</span>
<a href="#l1.20"></a><span id="l1.20">   PRUint32 numBytesCopied = 0;</span>
<a href="#l1.21"></a><span id="l1.21">   if (m_headersSize &gt; 0)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1114,17 +1114,17 @@ NS_IMETHODIMP nsMsgSearchValidityManager</span>
<a href="#l2.4"></a><span id="l2.4">   }</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6">   NS_IF_ADDREF(*ppOutTable);</span>
<a href="#l2.7"></a><span id="l2.7">   return rv;</span>
<a href="#l2.8"></a><span id="l2.8"> }</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> // mapping between ordered attribute values, and property strings</span>
<a href="#l2.11"></a><span id="l2.11"> // see search-attributes.properties</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-struct</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+static struct</span>
<a href="#l2.14"></a><span id="l2.14"> {</span>
<a href="#l2.15"></a><span id="l2.15">   nsMsgSearchAttribValue id;</span>
<a href="#l2.16"></a><span id="l2.16">   const char* property;</span>
<a href="#l2.17"></a><span id="l2.17"> }</span>
<a href="#l2.18"></a><span id="l2.18"> nsMsgSearchAttribMap[] =</span>
<a href="#l2.19"></a><span id="l2.19"> {</span>
<a href="#l2.20"></a><span id="l2.20">   {nsMsgSearchAttrib::Subject, &quot;Subject&quot;},</span>
<a href="#l2.21"></a><span id="l2.21">   {nsMsgSearchAttrib::Sender, &quot;From&quot;},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchSession.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -270,17 +270,17 @@ nsMsgSearchSession::AddAllScopes(nsMsgSe</span>
<a href="#l3.4"></a><span id="l3.4"> /* void Search (); */</span>
<a href="#l3.5"></a><span id="l3.5"> NS_IMETHODIMP nsMsgSearchSession::Search(nsIMsgWindow *aWindow)</span>
<a href="#l3.6"></a><span id="l3.6"> {</span>
<a href="#l3.7"></a><span id="l3.7">   nsresult rv = Initialize();</span>
<a href="#l3.8"></a><span id="l3.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">   nsCOMPtr&lt;nsIMsgSearchNotify&gt; listener;</span>
<a href="#l3.11"></a><span id="l3.11">   m_iListener = 0;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  while (m_iListener != -1 &amp;&amp; m_iListener &lt; m_listenerList.Length())</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  while (m_iListener != -1 &amp;&amp; m_iListener &lt; (signed)m_listenerList.Length())</span>
<a href="#l3.14"></a><span id="l3.14">   {</span>
<a href="#l3.15"></a><span id="l3.15">     listener = m_listenerList[m_iListener];</span>
<a href="#l3.16"></a><span id="l3.16">     PRInt32 listenerFlags = m_listenerFlagList[m_iListener++];</span>
<a href="#l3.17"></a><span id="l3.17">     if (!listenerFlags || (listenerFlags &amp; nsIMsgSearchSession::onNewSearch))</span>
<a href="#l3.18"></a><span id="l3.18">       listener-&gt;OnNewSearch();</span>
<a href="#l3.19"></a><span id="l3.19">   }</span>
<a href="#l3.20"></a><span id="l3.20">   m_iListener = -1;</span>
<a href="#l3.21"></a><span id="l3.21"> </span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -581,17 +581,17 @@ NS_IMETHODIMP nsMsgSearchSession::GetRun</span>
<a href="#l3.23"></a><span id="l3.23">   return NS_OK;</span>
<a href="#l3.24"></a><span id="l3.24"> }</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26"> NS_IMETHODIMP nsMsgSearchSession::AddSearchHit(nsIMsgDBHdr *aHeader,</span>
<a href="#l3.27"></a><span id="l3.27">                                                nsIMsgFolder *aFolder)</span>
<a href="#l3.28"></a><span id="l3.28"> {</span>
<a href="#l3.29"></a><span id="l3.29">   nsCOMPtr&lt;nsIMsgSearchNotify&gt; listener;</span>
<a href="#l3.30"></a><span id="l3.30">   m_iListener = 0;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-  while (m_iListener != -1 &amp;&amp; m_iListener &lt; m_listenerList.Length())</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+  while (m_iListener != -1 &amp;&amp; m_iListener &lt; (signed)m_listenerList.Length())</span>
<a href="#l3.33"></a><span id="l3.33">   {</span>
<a href="#l3.34"></a><span id="l3.34">     listener = m_listenerList[m_iListener];</span>
<a href="#l3.35"></a><span id="l3.35">     PRInt32 listenerFlags = m_listenerFlagList[m_iListener++];</span>
<a href="#l3.36"></a><span id="l3.36">     if (!listenerFlags || (listenerFlags &amp; nsIMsgSearchSession::onSearchHit))</span>
<a href="#l3.37"></a><span id="l3.37">       listener-&gt;OnSearchHit(aHeader, aFolder);</span>
<a href="#l3.38"></a><span id="l3.38">   }</span>
<a href="#l3.39"></a><span id="l3.39">   m_iListener = -1;</span>
<a href="#l3.40"></a><span id="l3.40">   return NS_OK;</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineat">@@ -600,17 +600,17 @@ NS_IMETHODIMP nsMsgSearchSession::AddSea</span>
<a href="#l3.42"></a><span id="l3.42"> nsresult nsMsgSearchSession::NotifyListenersDone(nsresult aStatus)</span>
<a href="#l3.43"></a><span id="l3.43"> {</span>
<a href="#l3.44"></a><span id="l3.44">   // need to stabilize &quot;this&quot; in case one of the listeners releases the last</span>
<a href="#l3.45"></a><span id="l3.45">   // reference to us.</span>
<a href="#l3.46"></a><span id="l3.46">   nsRefPtr &lt;nsIMsgSearchSession&gt; kungFuDeathGrip(this);</span>
<a href="#l3.47"></a><span id="l3.47"> </span>
<a href="#l3.48"></a><span id="l3.48">   nsCOMPtr&lt;nsIMsgSearchNotify&gt; listener;</span>
<a href="#l3.49"></a><span id="l3.49">   m_iListener = 0;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-  while (m_iListener != -1 &amp;&amp; m_iListener &lt; m_listenerList.Length())</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+  while (m_iListener != -1 &amp;&amp; m_iListener &lt; (signed)m_listenerList.Length())</span>
<a href="#l3.52"></a><span id="l3.52">   {</span>
<a href="#l3.53"></a><span id="l3.53">     listener = m_listenerList[m_iListener];</span>
<a href="#l3.54"></a><span id="l3.54">     PRInt32 listenerFlags = m_listenerFlagList[m_iListener++];</span>
<a href="#l3.55"></a><span id="l3.55">     if (!listenerFlags || (listenerFlags &amp; nsIMsgSearchSession::onSearchDone))</span>
<a href="#l3.56"></a><span id="l3.56">       listener-&gt;OnSearchDone(aStatus);</span>
<a href="#l3.57"></a><span id="l3.57">   }</span>
<a href="#l3.58"></a><span id="l3.58">   m_iListener = -1;</span>
<a href="#l3.59"></a><span id="l3.59">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -2258,54 +2258,57 @@ NS_IMETHODIMP nsMessenger::OnItemEvent(n</span>
<a href="#l4.4"></a><span id="l4.4"> {</span>
<a href="#l4.5"></a><span id="l4.5">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l4.6"></a><span id="l4.6"> }</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l4.9"></a><span id="l4.9"> // Detach/Delete Attachments</span>
<a href="#l4.10"></a><span id="l4.10"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-static char * GetAttachmentPartId(const char * aAttachmentUrl)</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+static const char * GetAttachmentPartId(const char * aAttachmentUrl)</span>
<a href="#l4.14"></a><span id="l4.14"> {</span>
<a href="#l4.15"></a><span id="l4.15">   static const char partIdPrefix[] = &quot;part=&quot;;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-  char * partId = PL_strstr(aAttachmentUrl, partIdPrefix);</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+  const char * partId = PL_strstr(aAttachmentUrl, partIdPrefix);</span>
<a href="#l4.18"></a><span id="l4.18">   return partId ? (partId + sizeof(partIdPrefix) - 1) : nsnull;</span>
<a href="#l4.19"></a><span id="l4.19"> }</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21"> static int CompareAttachmentPartId(const char * aAttachUrlLeft, const char * aAttachUrlRight)</span>
<a href="#l4.22"></a><span id="l4.22"> {</span>
<a href="#l4.23"></a><span id="l4.23">   // part ids are numbers separated by periods, like &quot;1.2.3.4&quot;.</span>
<a href="#l4.24"></a><span id="l4.24">   // we sort by doing a numerical comparison on each item in turn. e.g. &quot;1.4&quot; &lt; &quot;1.25&quot;</span>
<a href="#l4.25"></a><span id="l4.25">   // shorter entries come before longer entries. e.g. &quot;1.4&quot; &lt; &quot;1.4.1.2&quot;</span>
<a href="#l4.26"></a><span id="l4.26">   // return values:</span>
<a href="#l4.27"></a><span id="l4.27">   //  -2  left is a parent of right</span>
<a href="#l4.28"></a><span id="l4.28">   //  -1  left is less than right</span>
<a href="#l4.29"></a><span id="l4.29">   //   0  left == right</span>
<a href="#l4.30"></a><span id="l4.30">   //   1  right is greater than left</span>
<a href="#l4.31"></a><span id="l4.31">   //   2  right is a parent of left</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-  char * partIdLeft  = GetAttachmentPartId(aAttachUrlLeft);</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-  char * partIdRight = GetAttachmentPartId(aAttachUrlRight);</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+  const char * partIdLeft  = GetAttachmentPartId(aAttachUrlLeft);</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+  const char * partIdRight = GetAttachmentPartId(aAttachUrlRight);</span>
<a href="#l4.37"></a><span id="l4.37"> </span>
<a href="#l4.38"></a><span id="l4.38">   // for detached attachments the URL does not contain any &quot;part=xx&quot;</span>
<a href="#l4.39"></a><span id="l4.39">   if(!partIdLeft)</span>
<a href="#l4.40"></a><span id="l4.40">     partIdLeft = &quot;0&quot;;</span>
<a href="#l4.41"></a><span id="l4.41"> </span>
<a href="#l4.42"></a><span id="l4.42">   if(!partIdRight)</span>
<a href="#l4.43"></a><span id="l4.43">     partIdRight = &quot;0&quot;;</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45">   long idLeft, idRight;</span>
<a href="#l4.46"></a><span id="l4.46">   do</span>
<a href="#l4.47"></a><span id="l4.47">   {</span>
<a href="#l4.48"></a><span id="l4.48">     NS_ABORT_IF_FALSE(partIdLeft &amp;&amp; IS_DIGIT(*partIdLeft), &quot;Invalid character in part id string&quot;);</span>
<a href="#l4.49"></a><span id="l4.49">     NS_ABORT_IF_FALSE(partIdRight &amp;&amp; IS_DIGIT(*partIdRight), &quot;Invalid character in part id string&quot;);</span>
<a href="#l4.50"></a><span id="l4.50"> </span>
<a href="#l4.51"></a><span id="l4.51">     // if the part numbers are different then the numerically smaller one is first</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-    idLeft  = strtol(partIdLeft, &amp;partIdLeft, 10);</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-    idRight = strtol(partIdRight, &amp;partIdRight, 10);</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+    char *fixConstLoss;</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+    idLeft  = strtol(partIdLeft, &amp;fixConstLoss, 10);</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+    partIdLeft = fixConstLoss;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+    idRight = strtol(partIdRight, &amp;fixConstLoss, 10);</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+    partIdRight = fixConstLoss;</span>
<a href="#l4.59"></a><span id="l4.59">     if (idLeft != idRight)</span>
<a href="#l4.60"></a><span id="l4.60">       return idLeft &lt; idRight ? -1 : 1;</span>
<a href="#l4.61"></a><span id="l4.61"> </span>
<a href="#l4.62"></a><span id="l4.62">     // if one part id is complete but the other isn't, then the shortest one</span>
<a href="#l4.63"></a><span id="l4.63">     // is first (parents before children)</span>
<a href="#l4.64"></a><span id="l4.64">     if (*partIdLeft != *partIdRight)</span>
<a href="#l4.65"></a><span id="l4.65">       return *partIdRight ? -2 : 2;</span>
<a href="#l4.66"></a><span id="l4.66"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -326,17 +326,17 @@ protected:</span>
<a href="#l5.4"></a><span id="l5.4">   virtual nsresult GetDBForViewIndex(nsMsgViewIndex index, nsIMsgDatabase **db);</span>
<a href="#l5.5"></a><span id="l5.5">   virtual nsCOMArray&lt;nsIMsgFolder&gt;* GetFolders();</span>
<a href="#l5.6"></a><span id="l5.6">   virtual nsresult GetFolderFromMsgURI(const char *aMsgURI, nsIMsgFolder **aFolder);</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">   virtual nsresult ListIdsInThread(nsIMsgThread *threadHdr, nsMsgViewIndex viewIndex, PRUint32 *pNumListed);</span>
<a href="#l5.9"></a><span id="l5.9">   nsresult ListUnreadIdsInThread(nsIMsgThread *threadHdr, nsMsgViewIndex startOfThreadViewIndex, PRUint32 *pNumListed);</span>
<a href="#l5.10"></a><span id="l5.10">   nsMsgViewIndex FindParentInThread(nsMsgKey parentKey, nsMsgViewIndex startOfThreadViewIndex);</span>
<a href="#l5.11"></a><span id="l5.11">   virtual nsresult ListIdsInThreadOrder(nsIMsgThread *threadHdr,</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-                                        nsMsgKey parentKey, PRInt32 level,</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+                                        nsMsgKey parentKey, PRUint32 level,</span>
<a href="#l5.14"></a><span id="l5.14">                                         nsMsgViewIndex *viewIndex,</span>
<a href="#l5.15"></a><span id="l5.15">                                         PRUint32 *pNumListed);</span>
<a href="#l5.16"></a><span id="l5.16">   PRUint32 GetSize(void) {return(m_keys.Length());}</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18">   // notification api's</span>
<a href="#l5.19"></a><span id="l5.19">   void  NoteChange(nsMsgViewIndex firstlineChanged, PRInt32 numChanged,</span>
<a href="#l5.20"></a><span id="l5.20">                     nsMsgViewNotificationCodeValue changeType);</span>
<a href="#l5.21"></a><span id="l5.21">   void  NoteStartChange(nsMsgViewIndex firstlineChanged, PRInt32 numChanged,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -71,17 +71,17 @@</span>
<a href="#l6.4"></a><span id="l6.4"> //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> NS_IMPL_ISUPPORTS5(nsFolderCompactState, nsIMsgFolderCompactor, nsIRequestObserver, nsIStreamListener, nsICopyMessageStreamListener, nsIUrlListener)</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> nsFolderCompactState::nsFolderCompactState()</span>
<a href="#l6.9"></a><span id="l6.9"> {</span>
<a href="#l6.10"></a><span id="l6.10">   m_fileStream = nsnull;</span>
<a href="#l6.11"></a><span id="l6.11">   m_size = 0;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  m_curIndex = -1;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  m_curIndex = 0;</span>
<a href="#l6.14"></a><span id="l6.14">   m_status = NS_OK;</span>
<a href="#l6.15"></a><span id="l6.15">   m_compactAll = false;</span>
<a href="#l6.16"></a><span id="l6.16">   m_compactOfflineAlso = false;</span>
<a href="#l6.17"></a><span id="l6.17">   m_compactingOfflineFolders = false;</span>
<a href="#l6.18"></a><span id="l6.18">   m_parsingFolder=false;</span>
<a href="#l6.19"></a><span id="l6.19">   m_folderIndex = 0;</span>
<a href="#l6.20"></a><span id="l6.20">   m_startOfMsg = true;</span>
<a href="#l6.21"></a><span id="l6.21">   m_needStatusLine = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCompactor.h</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCompactor.h</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -91,17 +91,17 @@ protected:</span>
<a href="#l7.4"></a><span id="l7.4">   nsCOMPtr &lt;nsIOutputStream&gt; m_fileStream; // output file stream for writing</span>
<a href="#l7.5"></a><span id="l7.5">   // all message keys that need to be copied over</span>
<a href="#l7.6"></a><span id="l7.6">   nsRefPtr&lt;nsMsgKeyArray&gt; m_keyArray;</span>
<a href="#l7.7"></a><span id="l7.7">   PRUint32 m_size;</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">    // sum of the sizes of the messages, accumulated as we visit each msg.</span>
<a href="#l7.10"></a><span id="l7.10">   PRUint32 m_totalMsgSize;</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  PRInt32 m_curIndex; // index of the current copied message key in key array</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  PRUint32 m_curIndex; // index of the current copied message key in key array</span>
<a href="#l7.14"></a><span id="l7.14">   PRUint64 m_startOfNewMsg; // offset in mailbox of new message</span>
<a href="#l7.15"></a><span id="l7.15">   char m_dataBuffer[COMPACTOR_READ_BUFF_SIZE + 1]; // temp data buffer for copying message</span>
<a href="#l7.16"></a><span id="l7.16">   nsresult m_status; // the status of the copying operation</span>
<a href="#l7.17"></a><span id="l7.17">   nsCOMPtr &lt;nsIMsgMessageService&gt; m_messageService; // message service for copying </span>
<a href="#l7.18"></a><span id="l7.18">   nsCOMPtr&lt;nsIArray&gt; m_folderArray; // folders we are compacting, if compacting multiple.</span>
<a href="#l7.19"></a><span id="l7.19">   nsCOMPtr &lt;nsIMsgWindow&gt; m_window;</span>
<a href="#l7.20"></a><span id="l7.20">   nsCOMPtr &lt;nsIMsgDBHdr&gt; m_curSrcHdr;</span>
<a href="#l7.21"></a><span id="l7.21">   PRUint32 m_folderIndex; // tells which folder to compact in case of compact all</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -155,17 +155,16 @@ static const PRUint32 kDisplayBlankCount</span>
<a href="#l8.4"></a><span id="l8.4"> static const PRUint32 kDisplayQuestionCount = 0xFFFFFFFF;</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> nsMsgFolderDataSource::nsMsgFolderDataSource()</span>
<a href="#l8.7"></a><span id="l8.7"> {</span>
<a href="#l8.8"></a><span id="l8.8">   // one-time initialization here</span>
<a href="#l8.9"></a><span id="l8.9">   nsIRDFService* rdf = getRDFService();</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">   if (gFolderResourceRefCnt++ == 0) {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    nsresult res = NS_OK;</span>
<a href="#l8.13"></a><span id="l8.13">     nsCOMPtr&lt;nsIStringBundle&gt; sMessengerStringBundle;</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CHILD),   &amp;kNC_Child);</span>
<a href="#l8.16"></a><span id="l8.16">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_FOLDER),  &amp;kNC_Folder);</span>
<a href="#l8.17"></a><span id="l8.17">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_NAME),    &amp;kNC_Name);</span>
<a href="#l8.18"></a><span id="l8.18">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_OPEN),    &amp;kNC_Open);</span>
<a href="#l8.19"></a><span id="l8.19">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_FOLDERTREENAME),    &amp;kNC_FolderTreeName);</span>
<a href="#l8.20"></a><span id="l8.20">     rdf-&gt;GetResource(NS_LITERAL_CSTRING(&quot;mailnewsunreadfolders:/&quot;),    &amp;kNC_UnreadFolders);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupThread.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupThread.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -231,25 +231,25 @@ nsresult nsMsgGroupThread::ReparentNonRe</span>
<a href="#l9.4"></a><span id="l9.4">                                                             nsIDBChangeAnnouncer *announcer)</span>
<a href="#l9.5"></a><span id="l9.5"> {</span>
<a href="#l9.6"></a><span id="l9.6">   return NS_OK;</span>
<a href="#l9.7"></a><span id="l9.7"> }</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> NS_IMETHODIMP nsMsgGroupThread::GetChildKeyAt(PRInt32 aIndex, nsMsgKey *aResult)</span>
<a href="#l9.10"></a><span id="l9.10"> {</span>
<a href="#l9.11"></a><span id="l9.11">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  if (aIndex &lt; 0 || aIndex &gt;= m_keys.Length())</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  if (aIndex &lt; 0 || (PRUint32)aIndex &gt;= m_keys.Length())</span>
<a href="#l9.14"></a><span id="l9.14">     return NS_ERROR_INVALID_ARG;</span>
<a href="#l9.15"></a><span id="l9.15">   *aResult = m_keys[aIndex];</span>
<a href="#l9.16"></a><span id="l9.16">   return NS_OK;</span>
<a href="#l9.17"></a><span id="l9.17"> }</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19"> NS_IMETHODIMP nsMsgGroupThread::GetChildHdrAt(PRInt32 aIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l9.20"></a><span id="l9.20"> {</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-  if (aIndex &lt; 0 || aIndex &gt;= m_keys.Length())</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+  if (aIndex &lt; 0 || (PRUint32)aIndex &gt;= m_keys.Length())</span>
<a href="#l9.23"></a><span id="l9.23">     return NS_MSG_MESSAGE_NOT_FOUND;</span>
<a href="#l9.24"></a><span id="l9.24">   return m_db-&gt;GetMsgHdrForKey(m_keys[aIndex], aResult);</span>
<a href="#l9.25"></a><span id="l9.25"> }</span>
<a href="#l9.26"></a><span id="l9.26"> </span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28"> NS_IMETHODIMP nsMsgGroupThread::GetChild(nsMsgKey msgKey, nsIMsgDBHdr **aResult)</span>
<a href="#l9.29"></a><span id="l9.29"> {</span>
<a href="#l9.30"></a><span id="l9.30">   return GetChildHdrAt((PRInt32) m_keys.IndexOf(msgKey), aResult);</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineat">@@ -861,17 +861,17 @@ nsMsgViewIndex nsMsgXFGroupThread::FindM</span>
<a href="#l9.32"></a><span id="l9.32"> {</span>
<a href="#l9.33"></a><span id="l9.33">   nsMsgKey msgKey;</span>
<a href="#l9.34"></a><span id="l9.34">   hdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l9.35"></a><span id="l9.35">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l9.36"></a><span id="l9.36">   hdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l9.37"></a><span id="l9.37">   PRUint32 index = 0;</span>
<a href="#l9.38"></a><span id="l9.38">   while (true) {</span>
<a href="#l9.39"></a><span id="l9.39">     index = m_keys.IndexOf(msgKey, index);</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-    if (index == -1 || m_folders[index] == folder)</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+    if (index == m_keys.NoIndex || m_folders[index] == folder)</span>
<a href="#l9.42"></a><span id="l9.42">       break;</span>
<a href="#l9.43"></a><span id="l9.43">     index++;</span>
<a href="#l9.44"></a><span id="l9.44">   }</span>
<a href="#l9.45"></a><span id="l9.45">   return (nsMsgViewIndex)index;</span>
<a href="#l9.46"></a><span id="l9.46"> }</span>
<a href="#l9.47"></a><span id="l9.47"> </span>
<a href="#l9.48"></a><span id="l9.48"> nsMsgViewIndex nsMsgXFGroupThread::AddMsgHdrInDateOrder(nsIMsgDBHdr *child, nsMsgDBView *view)</span>
<a href="#l9.49"></a><span id="l9.49"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/src/nsMsgMailSession.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgMailSession.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -122,16 +122,16 @@ public:</span>
<a href="#l10.4"></a><span id="l10.4">     </span>
<a href="#l10.5"></a><span id="l10.5"> protected:</span>
<a href="#l10.6"></a><span id="l10.6">   nsresult ProcessNextTask();</span>
<a href="#l10.7"></a><span id="l10.7">   void AttemptShutdown();</span>
<a href="#l10.8"></a><span id="l10.8">   </span>
<a href="#l10.9"></a><span id="l10.9"> private:</span>
<a href="#l10.10"></a><span id="l10.10">   nsCOMArray&lt;nsIMsgShutdownTask&gt; mShutdownTasks;</span>
<a href="#l10.11"></a><span id="l10.11">   nsCOMPtr&lt;nsIMsgProgress&gt;       mMsgProgress;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  PRUint32                       mTaskIndex;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  PRInt32                        mTaskIndex;</span>
<a href="#l10.14"></a><span id="l10.14">   PRUint32                       mQuitMode;</span>
<a href="#l10.15"></a><span id="l10.15">   bool mProcessedShutdown;</span>
<a href="#l10.16"></a><span id="l10.16">   bool mQuitForced;</span>
<a href="#l10.17"></a><span id="l10.17">   bool mReadyToQuit;</span>
<a href="#l10.18"></a><span id="l10.18"> };</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> #endif /* nsMsgMailSession_h__ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPrintEngine.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -440,17 +440,17 @@ nsMsgPrintEngine::StartNextPrintOperatio</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5">   // Only do this the first time through...</span>
<a href="#l11.6"></a><span id="l11.6">   if (mCurrentlyPrintingURI == -1)</span>
<a href="#l11.7"></a><span id="l11.7">     InitializeDisplayCharset();</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">   mCurrentlyPrintingURI++;</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">   // First, check if we are at the end of this stuff!</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  if (mCurrentlyPrintingURI &gt;= mURIArray.Length())</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  if (mCurrentlyPrintingURI &gt;= (PRInt32)mURIArray.Length())</span>
<a href="#l11.14"></a><span id="l11.14">   {</span>
<a href="#l11.15"></a><span id="l11.15">     // This is the end...dum, dum, dum....my only friend...the end</span>
<a href="#l11.16"></a><span id="l11.16">     mWindow-&gt;Close();</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18">     // Tell the user we are done...</span>
<a href="#l11.19"></a><span id="l11.19">     nsString msg;</span>
<a href="#l11.20"></a><span id="l11.20">     GetString(NS_LITERAL_STRING(&quot;PrintingComplete&quot;).get(), msg);</span>
<a href="#l11.21"></a><span id="l11.21">     SetStatusMessage(msg);</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -485,17 +485,17 @@ nsMsgPrintEngine::FireThatLoadOperationS</span>
<a href="#l11.23"></a><span id="l11.23">     mLoadURI = uri;</span>
<a href="#l11.24"></a><span id="l11.24">   else</span>
<a href="#l11.25"></a><span id="l11.25">     mLoadURI.Truncate();</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27">   bool     notify = false;</span>
<a href="#l11.28"></a><span id="l11.28">   nsresult rv     = NS_ERROR_FAILURE;</span>
<a href="#l11.29"></a><span id="l11.29">   // Don't show dialog if we are out of URLs</span>
<a href="#l11.30"></a><span id="l11.30">   //if ( mCurrentlyPrintingURI &lt; mURIArray.Length() &amp;&amp; !mIsDoingPrintPreview)</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-  if ( mCurrentlyPrintingURI &lt; mURIArray.Length())</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+  if ( mCurrentlyPrintingURI &lt; (PRInt32)mURIArray.Length())</span>
<a href="#l11.33"></a><span id="l11.33">     rv = ShowProgressDialog(!mIsDoingPrintPreview, notify);</span>
<a href="#l11.34"></a><span id="l11.34">   if (NS_FAILED(rv) || !notify) </span>
<a href="#l11.35"></a><span id="l11.35">     return FireThatLoadOperation(uri);</span>
<a href="#l11.36"></a><span id="l11.36">   return NS_OK;</span>
<a href="#l11.37"></a><span id="l11.37"> }</span>
<a href="#l11.38"></a><span id="l11.38"> </span>
<a href="#l11.39"></a><span id="l11.39"> nsresult</span>
<a href="#l11.40"></a><span id="l11.40"> nsMsgPrintEngine::FireThatLoadOperation(const nsString&amp; uri)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/src/nsMsgQuickSearchDBView.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgQuickSearchDBView.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -122,17 +122,17 @@ nsresult nsMsgQuickSearchDBView::DeleteM</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> NS_IMETHODIMP nsMsgQuickSearchDBView::DoCommand(nsMsgViewCommandTypeValue aCommand)</span>
<a href="#l12.6"></a><span id="l12.6"> {</span>
<a href="#l12.7"></a><span id="l12.7">   if (aCommand == nsMsgViewCommandType::markAllRead)</span>
<a href="#l12.8"></a><span id="l12.8">   {</span>
<a href="#l12.9"></a><span id="l12.9">     nsresult rv = NS_OK;</span>
<a href="#l12.10"></a><span id="l12.10">     m_folder-&gt;EnableNotifications(nsIMsgFolder::allMessageCountNotifications, false, true /*dbBatching*/);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    for (PRInt32 i=0;NS_SUCCEEDED(rv) &amp;&amp; i &lt; GetSize();i++)</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    for (PRUint32 i = 0; NS_SUCCEEDED(rv) &amp;&amp; i &lt; GetSize(); i++)</span>
<a href="#l12.14"></a><span id="l12.14">     {</span>
<a href="#l12.15"></a><span id="l12.15">       nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l12.16"></a><span id="l12.16">       m_db-&gt;GetMsgHdrForKey(m_keys[i],getter_AddRefs(msgHdr)); </span>
<a href="#l12.17"></a><span id="l12.17">       rv = m_db-&gt;MarkHdrRead(msgHdr, true, nsnull);</span>
<a href="#l12.18"></a><span id="l12.18">     }</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20">     m_folder-&gt;EnableNotifications(nsIMsgFolder::allMessageCountNotifications, true, true /*dbBatching*/);</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -155,17 +155,17 @@ NS_IMETHODIMP nsMsgQuickSearchDBView::Ge</span>
<a href="#l12.23"></a><span id="l12.23">     return NS_OK;</span>
<a href="#l12.24"></a><span id="l12.24"> }</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26"> nsresult nsMsgQuickSearchDBView::AddHdr(nsIMsgDBHdr *msgHdr, nsMsgViewIndex *resultIndex)</span>
<a href="#l12.27"></a><span id="l12.27"> {</span>
<a href="#l12.28"></a><span id="l12.28">   nsMsgKey msgKey;</span>
<a href="#l12.29"></a><span id="l12.29">   msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l12.30"></a><span id="l12.30">   // protect against duplication.</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-  if (m_origKeys.BinaryIndexOf(msgKey)== -1)</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+  if (m_origKeys.BinaryIndexOf(msgKey) == m_origKeys.NoIndex)</span>
<a href="#l12.33"></a><span id="l12.33">   {</span>
<a href="#l12.34"></a><span id="l12.34">     nsMsgViewIndex insertIndex = GetInsertIndexHelper(msgHdr, m_origKeys, nsnull,</span>
<a href="#l12.35"></a><span id="l12.35">                     nsMsgViewSortOrder::ascending, nsMsgViewSortType::byId);</span>
<a href="#l12.36"></a><span id="l12.36">     m_origKeys.InsertElementAt(insertIndex, msgKey);</span>
<a href="#l12.37"></a><span id="l12.37">   }</span>
<a href="#l12.38"></a><span id="l12.38">   if (m_viewFlags &amp; (nsMsgViewFlagsType::kGroupBySort|</span>
<a href="#l12.39"></a><span id="l12.39">                      nsMsgViewFlagsType::kThreadedDisplay))</span>
<a href="#l12.40"></a><span id="l12.40">   {</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineat">@@ -475,17 +475,17 @@ nsresult nsMsgQuickSearchDBView::GetFirs</span>
<a href="#l12.42"></a><span id="l12.42">     rv = threadHdr-&gt;GetChildHdrAt(childIndex, getter_AddRefs(child));</span>
<a href="#l12.43"></a><span id="l12.43">     if (NS_SUCCEEDED(rv) &amp;&amp; child)</span>
<a href="#l12.44"></a><span id="l12.44">     {</span>
<a href="#l12.45"></a><span id="l12.45">       nsMsgKey msgKey;</span>
<a href="#l12.46"></a><span id="l12.46">       child-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l12.47"></a><span id="l12.47"> </span>
<a href="#l12.48"></a><span id="l12.48">       // this works because we've already sorted m_keys by id.</span>
<a href="#l12.49"></a><span id="l12.49">       nsMsgViewIndex keyIndex = m_origKeys.BinaryIndexOf(msgKey);</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-      if (keyIndex != kNotFound)</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+      if (keyIndex != nsMsgViewIndex_None)</span>
<a href="#l12.52"></a><span id="l12.52">       {</span>
<a href="#l12.53"></a><span id="l12.53">         // this is the root, so it's the best we're going to do.</span>
<a href="#l12.54"></a><span id="l12.54">         if (msgKey == threadRootKey)</span>
<a href="#l12.55"></a><span id="l12.55">         {</span>
<a href="#l12.56"></a><span id="l12.56">           retHdr = child;</span>
<a href="#l12.57"></a><span id="l12.57">           break;</span>
<a href="#l12.58"></a><span id="l12.58">         }</span>
<a href="#l12.59"></a><span id="l12.59">         PRUint8 level = 0;</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineat">@@ -539,17 +539,17 @@ nsresult nsMsgQuickSearchDBView::SortThr</span>
<a href="#l12.61"></a><span id="l12.61">     GetMsgHdrForViewIndex(i, getter_AddRefs(msgHdr));</span>
<a href="#l12.62"></a><span id="l12.62">     m_db-&gt;GetThreadContainingMsgHdr(msgHdr, getter_AddRefs(threadHdr));</span>
<a href="#l12.63"></a><span id="l12.63">     if (threadHdr)</span>
<a href="#l12.64"></a><span id="l12.64">     {</span>
<a href="#l12.65"></a><span id="l12.65">       nsMsgKey rootKey;</span>
<a href="#l12.66"></a><span id="l12.66">       threadHdr-&gt;GetChildKeyAt(0, &amp;rootKey);</span>
<a href="#l12.67"></a><span id="l12.67">       nsMsgViewIndex threadRootIndex = threadRootIds.BinaryIndexOf(rootKey);</span>
<a href="#l12.68"></a><span id="l12.68">       // if we already have that id in top level threads, ignore this msg.</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-      if (threadRootIndex != kNotFound)</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+      if (threadRootIndex != nsMsgViewIndex_None)</span>
<a href="#l12.71"></a><span id="l12.71">         continue;</span>
<a href="#l12.72"></a><span id="l12.72">       // it would be nice if GetInsertIndexHelper always found the hdr, but it doesn't.</span>
<a href="#l12.73"></a><span id="l12.73">       threadHdr-&gt;GetChildHdrAt(0, getter_AddRefs(rootHdr));</span>
<a href="#l12.74"></a><span id="l12.74">       if (!rootHdr)</span>
<a href="#l12.75"></a><span id="l12.75">         continue;</span>
<a href="#l12.76"></a><span id="l12.76">       threadRootIndex = GetInsertIndexHelper(rootHdr, threadRootIds, nsnull,</span>
<a href="#l12.77"></a><span id="l12.77">                                              nsMsgViewSortOrder::ascending,</span>
<a href="#l12.78"></a><span id="l12.78">                                              nsMsgViewSortType::byId);</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineat">@@ -623,17 +623,17 @@ nsMsgQuickSearchDBView::ListCollapsedChi</span>
<a href="#l12.80"></a><span id="l12.80">     threadHdr-&gt;GetChildHdrAt(i, getter_AddRefs(msgHdr));</span>
<a href="#l12.81"></a><span id="l12.81">     if (msgHdr)</span>
<a href="#l12.82"></a><span id="l12.82">     {</span>
<a href="#l12.83"></a><span id="l12.83">       nsMsgKey msgKey;</span>
<a href="#l12.84"></a><span id="l12.84">       msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l12.85"></a><span id="l12.85">       if (msgKey != rootKey || (GroupViewUsesDummyRow() &amp;&amp; rootKeySkipped))</span>
<a href="#l12.86"></a><span id="l12.86">       {</span>
<a href="#l12.87"></a><span id="l12.87">         // if this hdr is in the original view, add it to new view.</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-        if (m_origKeys.BinaryIndexOf(msgKey) != kNotFound)</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+        if (m_origKeys.BinaryIndexOf(msgKey) != m_origKeys.NoIndex)</span>
<a href="#l12.90"></a><span id="l12.90">           messageArray-&gt;AppendElement(msgHdr, false);</span>
<a href="#l12.91"></a><span id="l12.91">       }</span>
<a href="#l12.92"></a><span id="l12.92">       else</span>
<a href="#l12.93"></a><span id="l12.93">       {</span>
<a href="#l12.94"></a><span id="l12.94">         rootKeySkipped = true;</span>
<a href="#l12.95"></a><span id="l12.95">       }</span>
<a href="#l12.96"></a><span id="l12.96">     }</span>
<a href="#l12.97"></a><span id="l12.97">   }</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineat">@@ -668,17 +668,17 @@ nsresult nsMsgQuickSearchDBView::ListIds</span>
<a href="#l12.99"></a><span id="l12.99">     if (msgHdr != nsnull)</span>
<a href="#l12.100"></a><span id="l12.100">     {</span>
<a href="#l12.101"></a><span id="l12.101">       nsMsgKey msgKey;</span>
<a href="#l12.102"></a><span id="l12.102">       msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l12.103"></a><span id="l12.103">       if (msgKey != rootKey || (GroupViewUsesDummyRow() &amp;&amp; rootKeySkipped))</span>
<a href="#l12.104"></a><span id="l12.104">       {</span>
<a href="#l12.105"></a><span id="l12.105">         nsMsgViewIndex threadRootIndex = m_origKeys.BinaryIndexOf(msgKey);</span>
<a href="#l12.106"></a><span id="l12.106">         // if this hdr is in the original view, add it to new view.</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-        if (threadRootIndex != kNotFound)</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineplus">+        if (threadRootIndex != nsMsgViewIndex_None)</span>
<a href="#l12.109"></a><span id="l12.109">         {</span>
<a href="#l12.110"></a><span id="l12.110">           PRUint32 childFlags;</span>
<a href="#l12.111"></a><span id="l12.111">           msgHdr-&gt;GetFlags(&amp;childFlags);</span>
<a href="#l12.112"></a><span id="l12.112">           InsertMsgHdrAt(viewIndex, msgHdr, msgKey, childFlags, </span>
<a href="#l12.113"></a><span id="l12.113">                         FindLevelInThread(msgHdr, startOfThreadViewIndex, viewIndex));</span>
<a href="#l12.114"></a><span id="l12.114">           if (! (rootFlags &amp; MSG_VIEW_FLAG_HASCHILDREN))</span>
<a href="#l12.115"></a><span id="l12.115">             m_flags[startOfThreadViewIndex] = rootFlags | MSG_VIEW_FLAG_HASCHILDREN;</span>
<a href="#l12.116"></a><span id="l12.116"> </span>
<a href="#l12.117"></a><span id="l12.117" class="difflineat">@@ -692,18 +692,18 @@ nsresult nsMsgQuickSearchDBView::ListIds</span>
<a href="#l12.118"></a><span id="l12.118">       }</span>
<a href="#l12.119"></a><span id="l12.119">     }</span>
<a href="#l12.120"></a><span id="l12.120">   }</span>
<a href="#l12.121"></a><span id="l12.121">   return NS_OK;</span>
<a href="#l12.122"></a><span id="l12.122"> }</span>
<a href="#l12.123"></a><span id="l12.123"> </span>
<a href="#l12.124"></a><span id="l12.124"> nsresult</span>
<a href="#l12.125"></a><span id="l12.125"> nsMsgQuickSearchDBView::ListIdsInThreadOrder(nsIMsgThread *threadHdr,</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineminus">-                                             nsMsgKey parentKey, PRInt32 level,</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineminus">-                                             PRInt32 callLevel,</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineplus">+                                             nsMsgKey parentKey, PRUint32 level,</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineplus">+                                             PRUint32 callLevel,</span>
<a href="#l12.130"></a><span id="l12.130">                                              nsMsgKey keyToSkip,</span>
<a href="#l12.131"></a><span id="l12.131">                                              nsMsgViewIndex *viewIndex,</span>
<a href="#l12.132"></a><span id="l12.132">                                              PRUint32 *pNumListed)</span>
<a href="#l12.133"></a><span id="l12.133"> {</span>
<a href="#l12.134"></a><span id="l12.134">   nsCOMPtr &lt;nsISimpleEnumerator&gt; msgEnumerator;</span>
<a href="#l12.135"></a><span id="l12.135">   nsresult rv = threadHdr-&gt;EnumerateMessages(parentKey, getter_AddRefs(msgEnumerator));</span>
<a href="#l12.136"></a><span id="l12.136">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.137"></a><span id="l12.137">   </span>
<a href="#l12.138"></a><span id="l12.138" class="difflineat">@@ -732,17 +732,17 @@ nsMsgQuickSearchDBView::ListIdsInThreadO</span>
<a href="#l12.139"></a><span id="l12.139">       // is too destructive so we just return.</span>
<a href="#l12.140"></a><span id="l12.140">       if (*pNumListed &gt; numChildren || callLevel &gt; numChildren)</span>
<a href="#l12.141"></a><span id="l12.141">       {</span>
<a href="#l12.142"></a><span id="l12.142">         NS_ERROR(&quot;loop in message threading while listing children&quot;);</span>
<a href="#l12.143"></a><span id="l12.143">         return NS_OK;</span>
<a href="#l12.144"></a><span id="l12.144">       }</span>
<a href="#l12.145"></a><span id="l12.145"> </span>
<a href="#l12.146"></a><span id="l12.146">       PRInt32 childLevel = level;</span>
<a href="#l12.147"></a><span id="l12.147" class="difflineminus">-      if (m_origKeys.BinaryIndexOf(msgKey) != -1)</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineplus">+      if (m_origKeys.BinaryIndexOf(msgKey) != m_origKeys.NoIndex)</span>
<a href="#l12.149"></a><span id="l12.149">       {</span>
<a href="#l12.150"></a><span id="l12.150">         PRUint32 msgFlags;</span>
<a href="#l12.151"></a><span id="l12.151">         msgHdr-&gt;GetFlags(&amp;msgFlags);</span>
<a href="#l12.152"></a><span id="l12.152">         InsertMsgHdrAt(*viewIndex, msgHdr, msgKey, msgFlags &amp; ~MSG_VIEW_FLAGS, level);</span>
<a href="#l12.153"></a><span id="l12.153">         (*pNumListed)++;</span>
<a href="#l12.154"></a><span id="l12.154">         (*viewIndex)++;</span>
<a href="#l12.155"></a><span id="l12.155">         childLevel++;</span>
<a href="#l12.156"></a><span id="l12.156">       }</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineat">@@ -750,17 +750,17 @@ nsMsgQuickSearchDBView::ListIdsInThreadO</span>
<a href="#l12.158"></a><span id="l12.158">                                 keyToSkip, viewIndex, pNumListed);</span>
<a href="#l12.159"></a><span id="l12.159">     }</span>
<a href="#l12.160"></a><span id="l12.160">   }</span>
<a href="#l12.161"></a><span id="l12.161">   return rv;</span>
<a href="#l12.162"></a><span id="l12.162"> }</span>
<a href="#l12.163"></a><span id="l12.163"> </span>
<a href="#l12.164"></a><span id="l12.164"> nsresult</span>
<a href="#l12.165"></a><span id="l12.165"> nsMsgQuickSearchDBView::ListIdsInThreadOrder(nsIMsgThread *threadHdr,</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineminus">-                                             nsMsgKey parentKey, PRInt32 level,</span>
<a href="#l12.167"></a><span id="l12.167" class="difflineplus">+                                             nsMsgKey parentKey, PRUint32 level,</span>
<a href="#l12.168"></a><span id="l12.168">                                              nsMsgViewIndex *viewIndex,</span>
<a href="#l12.169"></a><span id="l12.169">                                              PRUint32 *pNumListed)</span>
<a href="#l12.170"></a><span id="l12.170"> {</span>
<a href="#l12.171"></a><span id="l12.171">   nsresult rv = ListIdsInThreadOrder(threadHdr, parentKey, level, level,</span>
<a href="#l12.172"></a><span id="l12.172">                                      nsMsgKey_None, viewIndex, pNumListed);</span>
<a href="#l12.173"></a><span id="l12.173">   // Because a quick search view might not have the actual thread root</span>
<a href="#l12.174"></a><span id="l12.174">   // as its root, and thus might have a message that potentially has siblings</span>
<a href="#l12.175"></a><span id="l12.175">   // as its root, and the enumerator will miss the siblings, we might need to</span>
<a href="#l12.176"></a><span id="l12.176" class="difflineat">@@ -813,17 +813,17 @@ nsresult nsMsgQuickSearchDBView::Expansi</span>
<a href="#l12.177"></a><span id="l12.177">     threadHdr-&gt;GetChildHdrAt(i, getter_AddRefs(msgHdr));</span>
<a href="#l12.178"></a><span id="l12.178">     if (msgHdr)</span>
<a href="#l12.179"></a><span id="l12.179">     {</span>
<a href="#l12.180"></a><span id="l12.180">       nsMsgKey msgKey;</span>
<a href="#l12.181"></a><span id="l12.181">       msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l12.182"></a><span id="l12.182">       if (msgKey != rootKey || (GroupViewUsesDummyRow() &amp;&amp; rootKeySkipped))</span>
<a href="#l12.183"></a><span id="l12.183">       {</span>
<a href="#l12.184"></a><span id="l12.184">         // if this hdr is in the original view, add it to new view.</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineminus">-        if (m_origKeys.BinaryIndexOf(msgKey) != kNotFound)</span>
<a href="#l12.186"></a><span id="l12.186" class="difflineplus">+        if (m_origKeys.BinaryIndexOf(msgKey) != m_origKeys.NoIndex)</span>
<a href="#l12.187"></a><span id="l12.187">           (*expansionDelta)++;</span>
<a href="#l12.188"></a><span id="l12.188">       }</span>
<a href="#l12.189"></a><span id="l12.189">       else</span>
<a href="#l12.190"></a><span id="l12.190">       {</span>
<a href="#l12.191"></a><span id="l12.191">         rootKeySkipped = true;</span>
<a href="#l12.192"></a><span id="l12.192">       }</span>
<a href="#l12.193"></a><span id="l12.193">     }</span>
<a href="#l12.194"></a><span id="l12.194">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/src/nsMsgQuickSearchDBView.h</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgQuickSearchDBView.h</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -96,22 +96,22 @@ protected:</span>
<a href="#l13.4"></a><span id="l13.4">   virtual nsresult DeleteMessages(nsIMsgWindow *window, nsMsgViewIndex *indices, PRInt32 numIndices, bool deleteStorage);</span>
<a href="#l13.5"></a><span id="l13.5">   virtual nsresult SortThreads(nsMsgViewSortTypeValue sortType, nsMsgViewSortOrderValue sortOrder);</span>
<a href="#l13.6"></a><span id="l13.6">   virtual nsresult GetFirstMessageHdrToDisplayInThread(nsIMsgThread *threadHdr, nsIMsgDBHdr **result);</span>
<a href="#l13.7"></a><span id="l13.7">   virtual nsresult ExpansionDelta(nsMsgViewIndex index, PRInt32 *expansionDelta);</span>
<a href="#l13.8"></a><span id="l13.8">   virtual nsresult ListCollapsedChildren(nsMsgViewIndex viewIndex,</span>
<a href="#l13.9"></a><span id="l13.9">                                          nsIMutableArray *messageArray);</span>
<a href="#l13.10"></a><span id="l13.10">   virtual nsresult ListIdsInThread(nsIMsgThread *threadHdr, nsMsgViewIndex startOfThreadViewIndex, PRUint32 *pNumListed);</span>
<a href="#l13.11"></a><span id="l13.11">   virtual nsresult ListIdsInThreadOrder(nsIMsgThread *threadHdr,</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-                                        nsMsgKey parentKey, PRInt32 level,</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+                                        nsMsgKey parentKey, PRUint32 level,</span>
<a href="#l13.14"></a><span id="l13.14">                                         nsMsgViewIndex *viewIndex,</span>
<a href="#l13.15"></a><span id="l13.15">                                         PRUint32 *pNumListed);</span>
<a href="#l13.16"></a><span id="l13.16">   virtual nsresult ListIdsInThreadOrder(nsIMsgThread *threadHdr,</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-                                        nsMsgKey parentKey, PRInt32 level,</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-                                        PRInt32 callLevel,</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+                                        nsMsgKey parentKey, PRUint32 level,</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+                                        PRUint32 callLevel,</span>
<a href="#l13.21"></a><span id="l13.21">                                         nsMsgKey keyToSkip,</span>
<a href="#l13.22"></a><span id="l13.22">                                         nsMsgViewIndex *viewIndex,</span>
<a href="#l13.23"></a><span id="l13.23">                                         PRUint32 *pNumListed);</span>
<a href="#l13.24"></a><span id="l13.24">   virtual nsresult GetMessageEnumerator(nsISimpleEnumerator **enumerator);</span>
<a href="#l13.25"></a><span id="l13.25">   void      SavePreSearchInfo();</span>
<a href="#l13.26"></a><span id="l13.26">   void      ClearPreSearchInfo();</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -596,17 +596,17 @@ void nsMsgSearchDBView::MoveThreadAt(nsM</span>
<a href="#l14.4"></a><span id="l14.4">   bool threadIsExpanded = !(saveFlags &amp; nsMsgMessageFlags::Elided);</span>
<a href="#l14.5"></a><span id="l14.5">   PRInt32 childCount = 0;</span>
<a href="#l14.6"></a><span id="l14.6">   nsMsgKey preservedKey;</span>
<a href="#l14.7"></a><span id="l14.7">   nsAutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l14.8"></a><span id="l14.8">   PRInt32 selectionCount;</span>
<a href="#l14.9"></a><span id="l14.9">   PRInt32 currentIndex;</span>
<a href="#l14.10"></a><span id="l14.10">   bool hasSelection = mTree &amp;&amp; mTreeSelection &amp;&amp;</span>
<a href="#l14.11"></a><span id="l14.11">                         ((NS_SUCCEEDED(mTreeSelection-&gt;GetCurrentIndex(&amp;currentIndex)) &amp;&amp;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-                         currentIndex &gt;= 0 &amp;&amp; currentIndex &lt; GetSize()) ||</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+                         currentIndex &gt;= 0 &amp;&amp; (PRUint32)currentIndex &lt; GetSize()) ||</span>
<a href="#l14.14"></a><span id="l14.14">                          (NS_SUCCEEDED(mTreeSelection-&gt;GetRangeCount(&amp;selectionCount)) &amp;&amp;</span>
<a href="#l14.15"></a><span id="l14.15">                           selectionCount &gt; 0));</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18">   if (hasSelection)</span>
<a href="#l14.19"></a><span id="l14.19">     SaveAndClearSelection(&amp;preservedKey, preservedSelection);</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21">   if (threadIsExpanded)</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -1078,17 +1078,17 @@ nsMsgSearchDBView::GetMessageId(nsACStri</span>
<a href="#l14.23"></a><span id="l14.23"> }</span>
<a href="#l14.24"></a><span id="l14.24"> </span>
<a href="#l14.25"></a><span id="l14.25"> NS_IMETHODIMP</span>
<a href="#l14.26"></a><span id="l14.26"> nsMsgSearchDBView::OnStopCopy(nsresult aStatus)</span>
<a href="#l14.27"></a><span id="l14.27"> {</span>
<a href="#l14.28"></a><span id="l14.28">   if (NS_SUCCEEDED(aStatus))</span>
<a href="#l14.29"></a><span id="l14.29">   {</span>
<a href="#l14.30"></a><span id="l14.30">     mCurIndex++;</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-    if (mCurIndex &lt; (PRUint32) m_uniqueFoldersSelected.Count())</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+    if ((PRInt32) mCurIndex &lt; m_uniqueFoldersSelected.Count())</span>
<a href="#l14.33"></a><span id="l14.33">     {</span>
<a href="#l14.34"></a><span id="l14.34">       nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow(do_QueryReferent(mMsgWindowWeak));</span>
<a href="#l14.35"></a><span id="l14.35">       ProcessRequestsInOneFolder(msgWindow);</span>
<a href="#l14.36"></a><span id="l14.36">     }</span>
<a href="#l14.37"></a><span id="l14.37">   }</span>
<a href="#l14.38"></a><span id="l14.38">   return NS_OK;</span>
<a href="#l14.39"></a><span id="l14.39"> }</span>
<a href="#l14.40"></a><span id="l14.40"> </span>
<a href="#l14.41"></a><span id="l14.41" class="difflineat">@@ -1263,17 +1263,17 @@ nsMsgSearchDBView::GetFolderFromMsgURI(c</span>
<a href="#l14.42"></a><span id="l14.42">   </span>
<a href="#l14.43"></a><span id="l14.43">   return msgHdr-&gt;GetFolder(aFolder);</span>
<a href="#l14.44"></a><span id="l14.44"> }</span>
<a href="#l14.45"></a><span id="l14.45"> </span>
<a href="#l14.46"></a><span id="l14.46"> nsMsgViewIndex nsMsgSearchDBView::FindHdr(nsIMsgDBHdr *msgHdr, nsMsgViewIndex startIndex,</span>
<a href="#l14.47"></a><span id="l14.47">                                           bool allowDummy)</span>
<a href="#l14.48"></a><span id="l14.48"> {</span>
<a href="#l14.49"></a><span id="l14.49">   nsCOMPtr&lt;nsIMsgDBHdr&gt; curHdr;</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-  PRInt32 index;</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+  PRUint32 index;</span>
<a href="#l14.52"></a><span id="l14.52">   // it would be nice to take advantage of sorted views when possible.</span>
<a href="#l14.53"></a><span id="l14.53">   for (index = startIndex; index &lt; GetSize(); index++)</span>
<a href="#l14.54"></a><span id="l14.54">   {</span>
<a href="#l14.55"></a><span id="l14.55">     GetMsgHdrForViewIndex(index, getter_AddRefs(curHdr));</span>
<a href="#l14.56"></a><span id="l14.56">     if (curHdr == msgHdr &amp;&amp;</span>
<a href="#l14.57"></a><span id="l14.57">         (allowDummy ||</span>
<a href="#l14.58"></a><span id="l14.58">          !(m_flags[index] &amp; MSG_VIEW_FLAG_DUMMY) ||</span>
<a href="#l14.59"></a><span id="l14.59">          (m_flags[index] &amp; nsMsgMessageFlags::Elided)))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsMsgThreadedDBView.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgThreadedDBView.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -768,17 +768,17 @@ void nsMsgThreadedDBView::MoveThreadAt(n</span>
<a href="#l15.4"></a><span id="l15.4">   PRInt32 childCount = 0;</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6">   nsMsgKey preservedKey;</span>
<a href="#l15.7"></a><span id="l15.7">   nsAutoTArray&lt;nsMsgKey, 1&gt; preservedSelection;</span>
<a href="#l15.8"></a><span id="l15.8">   PRInt32 selectionCount;</span>
<a href="#l15.9"></a><span id="l15.9">   PRInt32 currentIndex;</span>
<a href="#l15.10"></a><span id="l15.10">   bool hasSelection = mTree &amp;&amp; mTreeSelection &amp;&amp;</span>
<a href="#l15.11"></a><span id="l15.11">                         ((NS_SUCCEEDED(mTreeSelection-&gt;GetCurrentIndex(&amp;currentIndex)) &amp;&amp;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-                         currentIndex &gt;= 0 &amp;&amp; currentIndex &lt; GetSize()) ||</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+                         currentIndex &gt;= 0 &amp;&amp; (PRUint32)currentIndex &lt; GetSize()) ||</span>
<a href="#l15.14"></a><span id="l15.14">                          (NS_SUCCEEDED(mTreeSelection-&gt;GetRangeCount(&amp;selectionCount)) &amp;&amp;</span>
<a href="#l15.15"></a><span id="l15.15">                           selectionCount &gt; 0));</span>
<a href="#l15.16"></a><span id="l15.16">   if (hasSelection)</span>
<a href="#l15.17"></a><span id="l15.17">     SaveAndClearSelection(&amp;preservedKey, preservedSelection);</span>
<a href="#l15.18"></a><span id="l15.18">   PRUint32 saveFlags = m_flags[threadIndex];</span>
<a href="#l15.19"></a><span id="l15.19">   bool threadIsExpanded = !(saveFlags &amp; nsMsgMessageFlags::Elided);</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21">   if (threadIsExpanded)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFViewThread.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFViewThread.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -185,32 +185,33 @@ nsresult nsMsgXFViewThread::AddHdr(nsIMs</span>
<a href="#l16.4"></a><span id="l16.4">       }</span>
<a href="#l16.5"></a><span id="l16.5">       break;</span>
<a href="#l16.6"></a><span id="l16.6">     }</span>
<a href="#l16.7"></a><span id="l16.7">   }</span>
<a href="#l16.8"></a><span id="l16.8">   if (parent)</span>
<a href="#l16.9"></a><span id="l16.9">   {</span>
<a href="#l16.10"></a><span id="l16.10">     if (outParent)</span>
<a href="#l16.11"></a><span id="l16.11">       NS_ADDREF(*outParent = parent);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    PRUint8 parentLevel = m_levels[parentIndex];</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+    PRUint32 parentLevel = m_levels[parentIndex];</span>
<a href="#l16.14"></a><span id="l16.14">     nsMsgKey parentKey;</span>
<a href="#l16.15"></a><span id="l16.15">     parent-&gt;GetMessageKey(&amp;parentKey);</span>
<a href="#l16.16"></a><span id="l16.16">     nsCOMPtr&lt;nsIMsgFolder&gt; parentFolder;</span>
<a href="#l16.17"></a><span id="l16.17">     parent-&gt;GetFolder(getter_AddRefs(parentFolder));</span>
<a href="#l16.18"></a><span id="l16.18">     // iterate over our parents' children until we find one we're older than,</span>
<a href="#l16.19"></a><span id="l16.19">     // and insert ourselves before it, or as the last child. In other words,</span>
<a href="#l16.20"></a><span id="l16.20">     // insert, sorted by date.</span>
<a href="#l16.21"></a><span id="l16.21">     PRUint32 msgDate, childDate;</span>
<a href="#l16.22"></a><span id="l16.22">     newHdr-&gt;GetDateInSeconds(&amp;msgDate);</span>
<a href="#l16.23"></a><span id="l16.23">     nsCOMPtr&lt;nsIMsgDBHdr&gt; child;</span>
<a href="#l16.24"></a><span id="l16.24">     nsMsgViewIndex i;</span>
<a href="#l16.25"></a><span id="l16.25">     nsMsgViewIndex insertIndex = m_keys.Length();</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-    PRUint8 insertLevel = parentLevel + 1;</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+    PRUint32 insertLevel = parentLevel + 1;</span>
<a href="#l16.28"></a><span id="l16.28">     for (i = parentIndex; </span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">-         i &lt; m_keys.Length() &amp;&amp; (i == parentIndex ||  m_levels[i] &gt;= parentLevel); i++)</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+         i &lt; m_keys.Length() &amp;&amp; (i == (nsMsgViewIndex)parentIndex || m_levels[i] &gt;= parentLevel);</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+         i++)</span>
<a href="#l16.32"></a><span id="l16.32">     {</span>
<a href="#l16.33"></a><span id="l16.33">       GetChildHdrAt(i, getter_AddRefs(child));</span>
<a href="#l16.34"></a><span id="l16.34">       if (child)</span>
<a href="#l16.35"></a><span id="l16.35">       {</span>
<a href="#l16.36"></a><span id="l16.36">         if (reparentChildren &amp;&amp; IsHdrParentOf(newHdr, child))</span>
<a href="#l16.37"></a><span id="l16.37">         {</span>
<a href="#l16.38"></a><span id="l16.38">           insertIndex = i;</span>
<a href="#l16.39"></a><span id="l16.39">           // bump all the children of the current child, and the child</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineat">@@ -373,17 +374,17 @@ NS_IMETHODIMP nsMsgXFViewThread::GetChil</span>
<a href="#l16.41"></a><span id="l16.41"> </span>
<a href="#l16.42"></a><span id="l16.42"> NS_IMETHODIMP nsMsgXFViewThread::GetChild(nsMsgKey msgKey, nsIMsgDBHdr **aResult)</span>
<a href="#l16.43"></a><span id="l16.43"> {</span>
<a href="#l16.44"></a><span id="l16.44">   NS_ASSERTION(false, &quot;shouldn't call this&quot;);</span>
<a href="#l16.45"></a><span id="l16.45">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l16.46"></a><span id="l16.46"> }</span>
<a href="#l16.47"></a><span id="l16.47"> </span>
<a href="#l16.48"></a><span id="l16.48"> </span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-PRUint32 nsMsgXFViewThread::HdrIndex(nsIMsgDBHdr *hdr)</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineplus">+PRInt32 nsMsgXFViewThread::HdrIndex(nsIMsgDBHdr *hdr)</span>
<a href="#l16.51"></a><span id="l16.51"> {</span>
<a href="#l16.52"></a><span id="l16.52">   nsMsgKey msgKey;</span>
<a href="#l16.53"></a><span id="l16.53">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l16.54"></a><span id="l16.54">   hdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l16.55"></a><span id="l16.55">   hdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l16.56"></a><span id="l16.56">   for (PRUint32 i = 0; i &lt; m_keys.Length(); i++)</span>
<a href="#l16.57"></a><span id="l16.57">   {</span>
<a href="#l16.58"></a><span id="l16.58">     if (m_keys[i] == msgKey &amp;&amp; m_folders[i] == folder)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFViewThread.h</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFViewThread.h</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -62,17 +62,17 @@ public:</span>
<a href="#l17.4"></a><span id="l17.4">   bool      IsHdrParentOf(nsIMsgDBHdr *possibleParent,</span>
<a href="#l17.5"></a><span id="l17.5">                           nsIMsgDBHdr *possibleChild);</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7">   void      ChangeUnreadChildCount(PRInt32 delta);</span>
<a href="#l17.8"></a><span id="l17.8">   void      ChangeChildCount(PRInt32 delta);</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10">   nsresult  AddHdr(nsIMsgDBHdr *newHdr, bool reparentChildren, </span>
<a href="#l17.11"></a><span id="l17.11">                    PRUint32 &amp;whereInserted, nsIMsgDBHdr **outParent);</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  PRUint32  HdrIndex(nsIMsgDBHdr *hdr);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  PRInt32   HdrIndex(nsIMsgDBHdr *hdr);</span>
<a href="#l17.14"></a><span id="l17.14">   PRUint32  ChildLevelAt(PRUint32 msgIndex) {return m_levels[msgIndex];}</span>
<a href="#l17.15"></a><span id="l17.15">   PRUint32  MsgCount() {return m_numChildren;};</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17"> protected:</span>
<a href="#l17.18"></a><span id="l17.18">   nsMsgSearchDBView *m_view;</span>
<a href="#l17.19"></a><span id="l17.19">   PRUint32        m_numUnreadChildren;</span>
<a href="#l17.20"></a><span id="l17.20">   PRUint32        m_numChildren;</span>
<a href="#l17.21"></a><span id="l17.21">   PRUint32        m_flags;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/util/nsImapMoveCoalescer.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/util/nsImapMoveCoalescer.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -75,17 +75,17 @@ nsresult nsImapMoveCoalescer::AddMove(ns</span>
<a href="#l18.4"></a><span id="l18.4">   else</span>
<a href="#l18.5"></a><span id="l18.5">   {</span>
<a href="#l18.6"></a><span id="l18.6">     m_destFolders.AppendObject(folder);</span>
<a href="#l18.7"></a><span id="l18.7">     keysToAdd = m_sourceKeyArrays.AppendElement();</span>
<a href="#l18.8"></a><span id="l18.8">     if (!keysToAdd)</span>
<a href="#l18.9"></a><span id="l18.9">       return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l18.10"></a><span id="l18.10">   }</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  if (keysToAdd-&gt;IndexOf(key) == -1)</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  if (keysToAdd-&gt;IndexOf(key) == nsTArray&lt;nsMsgKey&gt;::NoIndex)</span>
<a href="#l18.14"></a><span id="l18.14">     keysToAdd-&gt;AppendElement(key);</span>
<a href="#l18.15"></a><span id="l18.15"> </span>
<a href="#l18.16"></a><span id="l18.16">   return NS_OK;</span>
<a href="#l18.17"></a><span id="l18.17"> }</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19"> nsresult nsImapMoveCoalescer::PlaybackMoves(bool doNewMailNotification /* = false */)</span>
<a href="#l18.20"></a><span id="l18.20"> {</span>
<a href="#l18.21"></a><span id="l18.21">   PRInt32 numFolders = m_destFolders.Count();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -5869,17 +5869,17 @@ NS_IMETHODIMP nsMsgDBFolder::RemoveKeywo</span>
<a href="#l19.4"></a><span id="l19.4">         {</span>
<a href="#l19.5"></a><span id="l19.5">           // delete any leading space delimiters</span>
<a href="#l19.6"></a><span id="l19.6">           while (startOffset &amp;&amp; keywords.CharAt(startOffset - 1) == ' ')</span>
<a href="#l19.7"></a><span id="l19.7">           {</span>
<a href="#l19.8"></a><span id="l19.8">             startOffset--;</span>
<a href="#l19.9"></a><span id="l19.9">             length++;</span>
<a href="#l19.10"></a><span id="l19.10">           }</span>
<a href="#l19.11"></a><span id="l19.11">           // but if the keyword is at the start then delete the following space</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-          if (!startOffset &amp;&amp; length &lt; keywords.Length() &amp;&amp;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+          if (!startOffset &amp;&amp; length &lt; static_cast&lt;PRInt32&gt;(keywords.Length()) &amp;&amp;</span>
<a href="#l19.14"></a><span id="l19.14">               keywords.CharAt(length) == ' ')</span>
<a href="#l19.15"></a><span id="l19.15">             length++;</span>
<a href="#l19.16"></a><span id="l19.16">           keywords.Cut(startOffset, length);</span>
<a href="#l19.17"></a><span id="l19.17">           removeCount++;</span>
<a href="#l19.18"></a><span id="l19.18">         }</span>
<a href="#l19.19"></a><span id="l19.19">       }</span>
<a href="#l19.20"></a><span id="l19.20"> </span>
<a href="#l19.21"></a><span id="l19.21">       if (removeCount)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -2310,27 +2310,27 @@ MsgDetectCharsetFromFile(nsILocalFile *a</span>
<a href="#l20.4"></a><span id="l20.4">     aCharset = observer-&gt;GetDetectedCharset();</span>
<a href="#l20.5"></a><span id="l20.5">   } else {</span>
<a href="#l20.6"></a><span id="l20.6">     // no charset detector available, check the BOM</span>
<a href="#l20.7"></a><span id="l20.7">     char sniffBuf[3];</span>
<a href="#l20.8"></a><span id="l20.8">     PRUint32 numRead;</span>
<a href="#l20.9"></a><span id="l20.9">     rv = inputStream-&gt;Read(sniffBuf, sizeof(sniffBuf), &amp;numRead);</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">     if (numRead &gt;= 2 &amp;&amp;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-               sniffBuf[0] == 0xfe &amp;&amp;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-               sniffBuf[1] == 0xff) {</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+               sniffBuf[0] == (char)0xfe &amp;&amp;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+               sniffBuf[1] == (char)0xff) {</span>
<a href="#l20.16"></a><span id="l20.16">       aCharset = &quot;UTF-16BE&quot;;</span>
<a href="#l20.17"></a><span id="l20.17">     } else if (numRead &gt;= 2 &amp;&amp;</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">-               sniffBuf[0] == 0xff &amp;&amp;</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">-               sniffBuf[1] == 0xfe) {</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+               sniffBuf[0] == (char)0xff &amp;&amp;</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+               sniffBuf[1] == (char)0xfe) {</span>
<a href="#l20.22"></a><span id="l20.22">       aCharset = &quot;UTF-16LE&quot;;</span>
<a href="#l20.23"></a><span id="l20.23">     } else if (numRead &gt;= 3 &amp;&amp;</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">-               sniffBuf[0] == 0xef &amp;&amp;</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineminus">-               sniffBuf[1] == 0xbb &amp;&amp;</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineminus">-               sniffBuf[2] == 0xbf) {</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineplus">+               sniffBuf[0] == (char)0xef &amp;&amp;</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineplus">+               sniffBuf[1] == (char)0xbb &amp;&amp;</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineplus">+               sniffBuf[2] == (char)0xbf) {</span>
<a href="#l20.30"></a><span id="l20.30">       aCharset = &quot;UTF-8&quot;;</span>
<a href="#l20.31"></a><span id="l20.31">     }</span>
<a href="#l20.32"></a><span id="l20.32">   }</span>
<a href="#l20.33"></a><span id="l20.33"> </span>
<a href="#l20.34"></a><span id="l20.34">   if (aCharset.IsEmpty()) {</span>
<a href="#l20.35"></a><span id="l20.35">     // no charset detected, default to the system charset</span>
<a href="#l20.36"></a><span id="l20.36">     nsCOMPtr&lt;nsIPlatformCharset&gt; platformCharset =</span>
<a href="#l20.37"></a><span id="l20.37">       do_GetService(NS_PLATFORMCHARSET_CONTRACTID, &amp;rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1252,17 +1252,17 @@ mime_write_message_body(nsIMsgSend *stat</span>
<a href="#l21.4"></a><span id="l21.4">   state-&gt;GetCryptoclosure(getter_AddRefs(crypto_closure));</span>
<a href="#l21.5"></a><span id="l21.5">   if (crypto_closure)</span>
<a href="#l21.6"></a><span id="l21.6">   {</span>
<a href="#l21.7"></a><span id="l21.7">     return crypto_closure-&gt;MimeCryptoWriteBlock (buf, size);</span>
<a href="#l21.8"></a><span id="l21.8">   }</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10">   PRUint32 n;</span>
<a href="#l21.11"></a><span id="l21.11">   nsresult rv = output-&gt;Write(buf, size, &amp;n);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  if (NS_FAILED(rv) || n != size)</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  if (NS_FAILED(rv) || n != (PRUint32)size)</span>
<a href="#l21.14"></a><span id="l21.14">   {</span>
<a href="#l21.15"></a><span id="l21.15">     return NS_MSG_ERROR_WRITING_FILE;</span>
<a href="#l21.16"></a><span id="l21.16">   }</span>
<a href="#l21.17"></a><span id="l21.17">   else</span>
<a href="#l21.18"></a><span id="l21.18">   {</span>
<a href="#l21.19"></a><span id="l21.19">     return NS_OK;</span>
<a href="#l21.20"></a><span id="l21.20">   }</span>
<a href="#l21.21"></a><span id="l21.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1243,17 +1243,17 @@ nsMsgSendLater::DeliverQueuedLine(char *</span>
<a href="#l22.4"></a><span id="l22.4">         return NS_MSG_ERROR_WRITING_FILE;</span>
<a href="#l22.5"></a><span id="l22.5"> </span>
<a href="#l22.6"></a><span id="l22.6">       nsresult status = BuildHeaders();</span>
<a href="#l22.7"></a><span id="l22.7">       if (NS_FAILED(status))</span>
<a href="#l22.8"></a><span id="l22.8">         return status;</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10">       PRUint32 n;</span>
<a href="#l22.11"></a><span id="l22.11">       rv = mOutFile-&gt;Write(m_headers, m_headersFP, &amp;n);</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-      if (NS_FAILED(rv) || n != m_headersFP)</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+      if (NS_FAILED(rv) || n != (PRUint32)m_headersFP)</span>
<a href="#l22.14"></a><span id="l22.14">         return NS_MSG_ERROR_WRITING_FILE;</span>
<a href="#l22.15"></a><span id="l22.15">     }</span>
<a href="#l22.16"></a><span id="l22.16">     else</span>
<a href="#l22.17"></a><span id="l22.17">     {</span>
<a href="#l22.18"></a><span id="l22.18">       // Otherwise, this line belongs to a header.  So append it to the</span>
<a href="#l22.19"></a><span id="l22.19">       // header data.</span>
<a href="#l22.20"></a><span id="l22.20">       </span>
<a href="#l22.21"></a><span id="l22.21">       if (!PL_strncasecmp (line, HEADER_X_MOZILLA_STATUS, PL_strlen(HEADER_X_MOZILLA_STATUS)))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/db/msgdb/public/nsIMsgDatabase.idl</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/db/msgdb/public/nsIMsgDatabase.idl</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -187,17 +187,17 @@ interface nsIMsgDBService : nsISupports</span>
<a href="#l23.4"></a><span id="l23.4">    * @param aTimeHint approximate number of milliseconds to spend</span>
<a href="#l23.5"></a><span id="l23.5">    *                  before returning. This is more of a floor than</span>
<a href="#l23.6"></a><span id="l23.6">                       a ceiling, since we can't guarantee that there</span>
<a href="#l23.7"></a><span id="l23.7">                       won't be one big chunk that we can't interrupt.</span>
<a href="#l23.8"></a><span id="l23.8">    * @return true if db is ready to use, false if openMore needs to</span>
<a href="#l23.9"></a><span id="l23.9">    *         be called again.</span>
<a href="#l23.10"></a><span id="l23.10">    * @see nsIMsgDBService::openFolderDB</span>
<a href="#l23.11"></a><span id="l23.11">    */</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  boolean openMore(in nsIMsgDatabase aDB, in long aTimeHint);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  boolean openMore(in nsIMsgDatabase aDB, in unsigned long aTimeHint);</span>
<a href="#l23.14"></a><span id="l23.14"> </span>
<a href="#l23.15"></a><span id="l23.15">   /**</span>
<a href="#l23.16"></a><span id="l23.16">    * Creates a new database for the given folder.</span>
<a href="#l23.17"></a><span id="l23.17">    *</span>
<a href="#l23.18"></a><span id="l23.18">    * If the database already exists, it will return the database, emit a</span>
<a href="#l23.19"></a><span id="l23.19">    * warning, but not fully initialize it. For this reason, it should only be</span>
<a href="#l23.20"></a><span id="l23.20">    * used when it is known that the database does not exist, such as when</span>
<a href="#l23.21"></a><span id="l23.21">    * nsIMsgDBService::openFolderDB throws an error.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -242,17 +242,17 @@ NS_IMETHODIMP nsMsgDBService::AsyncOpenF</span>
<a href="#l24.4"></a><span id="l24.4">     return rv;</span>
<a href="#l24.5"></a><span id="l24.5">   }</span>
<a href="#l24.6"></a><span id="l24.6"> </span>
<a href="#l24.7"></a><span id="l24.7">   FinishDBOpen(aFolder, msgDatabase);</span>
<a href="#l24.8"></a><span id="l24.8">   return rv;</span>
<a href="#l24.9"></a><span id="l24.9"> }</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11"> NS_IMETHODIMP nsMsgDBService::OpenMore(nsIMsgDatabase *aDB,</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-                                       PRInt32 aTimeHint,</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+                                       PRUint32 aTimeHint,</span>
<a href="#l24.14"></a><span id="l24.14">                                        bool *_retval)</span>
<a href="#l24.15"></a><span id="l24.15"> {</span>
<a href="#l24.16"></a><span id="l24.16">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l24.17"></a><span id="l24.17">   nsMsgDatabase *msgDatabase = static_cast&lt;nsMsgDatabase *&gt;(aDB);</span>
<a href="#l24.18"></a><span id="l24.18">   NS_ENSURE_TRUE(msgDatabase, NS_ERROR_INVALID_ARG);</span>
<a href="#l24.19"></a><span id="l24.19">   // Check if this db has been opened.</span>
<a href="#l24.20"></a><span id="l24.20">   if (!msgDatabase-&gt;m_thumb)</span>
<a href="#l24.21"></a><span id="l24.21">   {</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -544,38 +544,38 @@ NS_IMETHODIMP nsMsgDatabase::ClearCached</span>
<a href="#l24.23"></a><span id="l24.23"> }</span>
<a href="#l24.24"></a><span id="l24.24"> </span>
<a href="#l24.25"></a><span id="l24.25"> void nsMsgDatabase::ClearEnumerators()</span>
<a href="#l24.26"></a><span id="l24.26"> {</span>
<a href="#l24.27"></a><span id="l24.27">   // clear out existing enumerators</span>
<a href="#l24.28"></a><span id="l24.28">   nsTArray&lt;nsMsgDBEnumerator *&gt; copyEnumerators;</span>
<a href="#l24.29"></a><span id="l24.29">   copyEnumerators.SwapElements(m_enumerators);</span>
<a href="#l24.30"></a><span id="l24.30"> </span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-  PRInt32 numEnums = copyEnumerators.Length();</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+  PRUint32 numEnums = copyEnumerators.Length();</span>
<a href="#l24.33"></a><span id="l24.33">   for (PRUint32 i = 0; i &lt; numEnums; i++)</span>
<a href="#l24.34"></a><span id="l24.34">     copyEnumerators[i]-&gt;Clear();</span>
<a href="#l24.35"></a><span id="l24.35"> }</span>
<a href="#l24.36"></a><span id="l24.36"> </span>
<a href="#l24.37"></a><span id="l24.37"> nsMsgThread *nsMsgDatabase::FindExistingThread(nsMsgKey threadId)</span>
<a href="#l24.38"></a><span id="l24.38"> {</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">-  PRInt32 numThreads = m_threads.Length();</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+  PRUint32 numThreads = m_threads.Length();</span>
<a href="#l24.41"></a><span id="l24.41">   for (PRUint32 i = 0; i &lt; numThreads; i++)</span>
<a href="#l24.42"></a><span id="l24.42">     if (m_threads[i]-&gt;m_threadKey == threadId)</span>
<a href="#l24.43"></a><span id="l24.43">       return m_threads[i];</span>
<a href="#l24.44"></a><span id="l24.44"> </span>
<a href="#l24.45"></a><span id="l24.45">   return nsnull;</span>
<a href="#l24.46"></a><span id="l24.46"> }</span>
<a href="#l24.47"></a><span id="l24.47"> </span>
<a href="#l24.48"></a><span id="l24.48"> void nsMsgDatabase::ClearThreads()</span>
<a href="#l24.49"></a><span id="l24.49"> {</span>
<a href="#l24.50"></a><span id="l24.50">   // clear out existing threads</span>
<a href="#l24.51"></a><span id="l24.51">   nsTArray&lt;nsMsgThread *&gt; copyThreads;</span>
<a href="#l24.52"></a><span id="l24.52">   copyThreads.SwapElements(m_threads);</span>
<a href="#l24.53"></a><span id="l24.53"> </span>
<a href="#l24.54"></a><span id="l24.54" class="difflineminus">-  PRInt32 numThreads = copyThreads.Length();</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineplus">+  PRUint32 numThreads = copyThreads.Length();</span>
<a href="#l24.56"></a><span id="l24.56">   for (PRUint32 i = 0; i &lt; numThreads; i++)</span>
<a href="#l24.57"></a><span id="l24.57">     copyThreads[i]-&gt;Clear();</span>
<a href="#l24.58"></a><span id="l24.58"> }</span>
<a href="#l24.59"></a><span id="l24.59"> </span>
<a href="#l24.60"></a><span id="l24.60"> void nsMsgDatabase::ClearCachedObjects(bool dbGoingAway)</span>
<a href="#l24.61"></a><span id="l24.61"> {</span>
<a href="#l24.62"></a><span id="l24.62">   ClearHdrCache(false);</span>
<a href="#l24.63"></a><span id="l24.63"> #ifdef DEBUG_DavidBienvenu</span>
<a href="#l24.64"></a><span id="l24.64" class="difflineat">@@ -1036,17 +1036,16 @@ nsMsgDatabase::nsMsgDatabase()</span>
<a href="#l24.65"></a><span id="l24.65">         m_HeaderParser(nsnull),</span>
<a href="#l24.66"></a><span id="l24.66">         m_headersInUse(nsnull),</span>
<a href="#l24.67"></a><span id="l24.67">         m_cachedHeaders(nsnull),</span>
<a href="#l24.68"></a><span id="l24.68">         m_bCacheHeaders(true),</span>
<a href="#l24.69"></a><span id="l24.69">         m_cachedThreadId(nsMsgKey_None),</span>
<a href="#l24.70"></a><span id="l24.70">         m_msgReferences(nsnull),</span>
<a href="#l24.71"></a><span id="l24.71">         m_cacheSize(kMaxHdrsInCache)</span>
<a href="#l24.72"></a><span id="l24.72"> {</span>
<a href="#l24.73"></a><span id="l24.73" class="difflineminus">-  static int dbCount = 0;</span>
<a href="#l24.74"></a><span id="l24.74"> }</span>
<a href="#l24.75"></a><span id="l24.75"> </span>
<a href="#l24.76"></a><span id="l24.76"> nsMsgDatabase::~nsMsgDatabase()</span>
<a href="#l24.77"></a><span id="l24.77"> {</span>
<a href="#l24.78"></a><span id="l24.78">   //  Close(FALSE);  // better have already been closed.</span>
<a href="#l24.79"></a><span id="l24.79">   ClearCachedObjects(true);</span>
<a href="#l24.80"></a><span id="l24.80">   ClearEnumerators();</span>
<a href="#l24.81"></a><span id="l24.81">   delete m_cachedHeaders;</span>
<a href="#l24.82"></a><span id="l24.82" class="difflineat">@@ -1918,17 +1917,17 @@ NS_IMETHODIMP nsMsgDatabase::DeleteHeade</span>
<a href="#l24.83"></a><span id="l24.83">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l24.84"></a><span id="l24.84"> </span>
<a href="#l24.85"></a><span id="l24.85">   nsMsgHdr* msgHdr = static_cast&lt;nsMsgHdr*&gt;(msg);  // closed system, so this is ok</span>
<a href="#l24.86"></a><span id="l24.86">   nsMsgKey key;</span>
<a href="#l24.87"></a><span id="l24.87">   (void)msg-&gt;GetMessageKey(&amp;key);</span>
<a href="#l24.88"></a><span id="l24.88">   // only need to do this for mail - will this speed up news expiration?</span>
<a href="#l24.89"></a><span id="l24.89">   SetHdrFlag(msg, true, nsMsgMessageFlags::Expunged);  // tell mailbox (mail)</span>
<a href="#l24.90"></a><span id="l24.90"> </span>
<a href="#l24.91"></a><span id="l24.91" class="difflineminus">-  bool hdrWasNew = m_newSet.BinaryIndexOf(key) != -1;</span>
<a href="#l24.92"></a><span id="l24.92" class="difflineplus">+  bool hdrWasNew = m_newSet.BinaryIndexOf(key) != m_newSet.NoIndex;</span>
<a href="#l24.93"></a><span id="l24.93">   m_newSet.RemoveElement(key);</span>
<a href="#l24.94"></a><span id="l24.94"> </span>
<a href="#l24.95"></a><span id="l24.95">   if (m_dbFolderInfo != NULL)</span>
<a href="#l24.96"></a><span id="l24.96">   {</span>
<a href="#l24.97"></a><span id="l24.97">     bool isRead;</span>
<a href="#l24.98"></a><span id="l24.98">     m_dbFolderInfo-&gt;ChangeNumMessages(-1);</span>
<a href="#l24.99"></a><span id="l24.99">     IsRead(key, &amp;isRead);</span>
<a href="#l24.100"></a><span id="l24.100">     if (!isRead)</span>
<a href="#l24.101"></a><span id="l24.101" class="difflineat">@@ -2035,17 +2034,18 @@ nsresult nsMsgDatabase::IsRead(nsMsgKey </span>
<a href="#l24.102"></a><span id="l24.102"> </span>
<a href="#l24.103"></a><span id="l24.103"> PRUint32  nsMsgDatabase::GetStatusFlags(nsIMsgDBHdr *msgHdr, PRUint32 origFlags)</span>
<a href="#l24.104"></a><span id="l24.104"> {</span>
<a href="#l24.105"></a><span id="l24.105">   PRUint32  statusFlags = origFlags;</span>
<a href="#l24.106"></a><span id="l24.106">   bool    isRead = true;</span>
<a href="#l24.107"></a><span id="l24.107"> </span>
<a href="#l24.108"></a><span id="l24.108">   nsMsgKey key;</span>
<a href="#l24.109"></a><span id="l24.109">   (void)msgHdr-&gt;GetMessageKey(&amp;key);</span>
<a href="#l24.110"></a><span id="l24.110" class="difflineminus">-  if (!m_newSet.IsEmpty() &amp;&amp; m_newSet[m_newSet.Length() - 1] == key || m_newSet.BinaryIndexOf(key) != -1)</span>
<a href="#l24.111"></a><span id="l24.111" class="difflineplus">+  if (!m_newSet.IsEmpty() &amp;&amp; m_newSet[m_newSet.Length() - 1] == key ||</span>
<a href="#l24.112"></a><span id="l24.112" class="difflineplus">+      m_newSet.BinaryIndexOf(key) != m_newSet.NoIndex)</span>
<a href="#l24.113"></a><span id="l24.113">     statusFlags |= nsMsgMessageFlags::New;</span>
<a href="#l24.114"></a><span id="l24.114">   if (IsHeaderRead(msgHdr, &amp;isRead) == NS_OK &amp;&amp; isRead)</span>
<a href="#l24.115"></a><span id="l24.115">     statusFlags |= nsMsgMessageFlags::Read;</span>
<a href="#l24.116"></a><span id="l24.116">   return statusFlags;</span>
<a href="#l24.117"></a><span id="l24.117"> }</span>
<a href="#l24.118"></a><span id="l24.118"> </span>
<a href="#l24.119"></a><span id="l24.119"> nsresult nsMsgDatabase::IsHeaderRead(nsIMsgDBHdr *msgHdr, bool *pRead)</span>
<a href="#l24.120"></a><span id="l24.120"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgHdr.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgHdr.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -624,18 +624,18 @@ NS_IMETHODIMP nsMsgHdr::GetAccountKey(ch</span>
<a href="#l25.4"></a><span id="l25.4"> }</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6"> </span>
<a href="#l25.7"></a><span id="l25.7"> NS_IMETHODIMP nsMsgHdr::GetMessageOffset(PRUint64 *result)</span>
<a href="#l25.8"></a><span id="l25.8"> {</span>
<a href="#l25.9"></a><span id="l25.9">   NS_ENSURE_ARG(result);</span>
<a href="#l25.10"></a><span id="l25.10"> </span>
<a href="#l25.11"></a><span id="l25.11">   // if there is a message offset, use it, otherwise, we'll use the message key.</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  (void) GetUInt64Column(m_mdb-&gt;m_offlineMsgOffsetColumnToken, result, -1);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-  if (*result == -1)</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+  (void) GetUInt64Column(m_mdb-&gt;m_offlineMsgOffsetColumnToken, result, (unsigned)-1);</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+  if (*result == (unsigned)-1)</span>
<a href="#l25.16"></a><span id="l25.16">     *result = m_messageKey;</span>
<a href="#l25.17"></a><span id="l25.17">   return NS_OK;</span>
<a href="#l25.18"></a><span id="l25.18"> }</span>
<a href="#l25.19"></a><span id="l25.19"> </span>
<a href="#l25.20"></a><span id="l25.20"> NS_IMETHODIMP nsMsgHdr::SetMessageOffset(PRUint64 offset)</span>
<a href="#l25.21"></a><span id="l25.21"> {</span>
<a href="#l25.22"></a><span id="l25.22">   SetUInt64Column(offset, m_mdb-&gt;m_offlineMsgOffsetColumnToken);</span>
<a href="#l25.23"></a><span id="l25.23">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -2860,18 +2860,16 @@ CorpusStore::UpdateData(nsILocalFile *aF</span>
<a href="#l26.4"></a><span id="l26.4">   return NS_OK;</span>
<a href="#l26.5"></a><span id="l26.5"> }</span>
<a href="#l26.6"></a><span id="l26.6"> </span>
<a href="#l26.7"></a><span id="l26.7"> nsresult CorpusStore::ClearTrait(PRUint32 aTrait)</span>
<a href="#l26.8"></a><span id="l26.8"> {</span>
<a href="#l26.9"></a><span id="l26.9">   // clear message counts</span>
<a href="#l26.10"></a><span id="l26.10">   setMessageCount(aTrait, 0);</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  // clear token counts</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-  PRUint32 tokenCount = countTokens();</span>
<a href="#l26.14"></a><span id="l26.14">   TokenEnumeration tokens = getTokens();</span>
<a href="#l26.15"></a><span id="l26.15">   while (tokens.hasMoreTokens())</span>
<a href="#l26.16"></a><span id="l26.16">   {</span>
<a href="#l26.17"></a><span id="l26.17">     CorpusToken* token = static_cast&lt;CorpusToken*&gt;(tokens.nextToken());</span>
<a href="#l26.18"></a><span id="l26.18">     PRInt32 wordCount = static_cast&lt;PRInt32&gt;(getTraitCount(token, aTrait));</span>
<a href="#l26.19"></a><span id="l26.19">     updateTrait(token, aTrait, -wordCount);</span>
<a href="#l26.20"></a><span id="l26.20">   }</span>
<a href="#l26.21"></a><span id="l26.21">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPHostSessionList.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPHostSessionList.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -538,17 +538,19 @@ NS_IMETHODIMP	nsIMAPHostSessionList::Get</span>
<a href="#l27.4"></a><span id="l27.4">   PR_EnterMonitor(gCachedHostInfoMonitor);</span>
<a href="#l27.5"></a><span id="l27.5">   nsIMAPHostInfo *host = FindHost(serverKey);</span>
<a href="#l27.6"></a><span id="l27.6">   if (host)</span>
<a href="#l27.7"></a><span id="l27.7">     result = host-&gt;fNamespaceList-&gt;GetNamespaceNumber(n);</span>
<a href="#l27.8"></a><span id="l27.8">   PR_ExitMonitor(gCachedHostInfoMonitor);</span>
<a href="#l27.9"></a><span id="l27.9">   return (host == NULL) ? NS_ERROR_ILLEGAL_VALUE : NS_OK;</span>
<a href="#l27.10"></a><span id="l27.10"> }</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-nsresult nsIMAPHostSessionList::SetNamespacesPrefForHost(nsIImapIncomingServer *aHost, EIMAPNamespaceType type, char *pref)</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+nsresult nsIMAPHostSessionList::SetNamespacesPrefForHost(nsIImapIncomingServer *aHost,</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+                                                         EIMAPNamespaceType type,</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+                                                         const char *pref)</span>
<a href="#l27.16"></a><span id="l27.16"> {</span>
<a href="#l27.17"></a><span id="l27.17">   if (type == kPersonalNamespace)</span>
<a href="#l27.18"></a><span id="l27.18">     aHost-&gt;SetPersonalNamespace(nsDependentCString(pref));</span>
<a href="#l27.19"></a><span id="l27.19">   else if (type == kPublicNamespace)</span>
<a href="#l27.20"></a><span id="l27.20">     aHost-&gt;SetPublicNamespace(nsDependentCString(pref));</span>
<a href="#l27.21"></a><span id="l27.21">   else if (type == kOtherUsersNamespace)</span>
<a href="#l27.22"></a><span id="l27.22">     aHost-&gt;SetOtherUsersNamespace(nsDependentCString(pref));</span>
<a href="#l27.23"></a><span id="l27.23">   else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/imap/src/nsIMAPHostSessionList.h</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/imap/src/nsIMAPHostSessionList.h</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -155,12 +155,14 @@ public:</span>
<a href="#l28.4"></a><span id="l28.4"> </span>
<a href="#l28.5"></a><span id="l28.5">   // Message Body Shells</span>
<a href="#l28.6"></a><span id="l28.6">   NS_IMETHOD AddShellToCacheForHost(const char *serverKey, nsIMAPBodyShell *shell);</span>
<a href="#l28.7"></a><span id="l28.7">   NS_IMETHOD FindShellInCacheForHost(const char *serverKey, const char *mailboxName, const char *UID, IMAP_ContentModifiedType modType, nsIMAPBodyShell	**result);</span>
<a href="#l28.8"></a><span id="l28.8">   NS_IMETHOD ClearShellCacheForHost(const char *serverKey);</span>
<a href="#l28.9"></a><span id="l28.9">   PRMonitor *gCachedHostInfoMonitor;</span>
<a href="#l28.10"></a><span id="l28.10">   nsIMAPHostInfo *fHostInfoList;</span>
<a href="#l28.11"></a><span id="l28.11"> protected:</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  nsresult SetNamespacesPrefForHost(nsIImapIncomingServer *aHost, EIMAPNamespaceType type, char *pref);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  nsresult SetNamespacesPrefForHost(nsIImapIncomingServer *aHost,</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+                                    EIMAPNamespaceType type,</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+                                    const char *pref);</span>
<a href="#l28.16"></a><span id="l28.16">   nsIMAPHostInfo *FindHost(const char *serverKey);</span>
<a href="#l28.17"></a><span id="l28.17"> };</span>
<a href="#l28.18"></a><span id="l28.18"> #endif</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

